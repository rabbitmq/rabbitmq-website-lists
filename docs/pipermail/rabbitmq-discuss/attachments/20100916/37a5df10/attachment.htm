<tt>
&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&nbsp;&quot;&gt;What&nbsp;about&nbsp;the&nbsp;number&nbsp;of&nbsp;erlang&nbsp;processes?&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;We&nbsp;had&nbsp;a&nbsp;problem&nbsp;of&nbsp;RabbitMQ&nbsp;crashing&nbsp;due&nbsp;to&nbsp;too&nbsp;many&nbsp;processes.&nbsp;The&nbsp;problem&nbsp;was&nbsp;that&nbsp;our&nbsp;library&nbsp;was&nbsp;creating&nbsp;thousand&nbsp;of&nbsp;channels&nbsp;per&nbsp;PHP&nbsp;process&nbsp;and&nbsp;that&nbsp;was&nbsp;bad&nbsp;as&nbsp;in&nbsp;really&nbsp;bad.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Regards,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Alvaro&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;div&gt;&lt;div&gt;On&nbsp;Sep&nbsp;16,&nbsp;2010,&nbsp;at&nbsp;5:32&nbsp;PM,&nbsp;Romary&nbsp;Kremer&nbsp;wrote:&lt;/div&gt;&lt;br&nbsp;class=&quot;Apple-interchange-newline&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&nbsp;&quot;&gt;We&nbsp;are&nbsp;performing&nbsp;evaluation&nbsp;on&nbsp;rabbitmq&nbsp;message&nbsp;broker,&nbsp;and&nbsp;we&nbsp;currently&nbsp;encounter&nbsp;difficulties&nbsp;with&nbsp;release&nbsp;2.0.0:&lt;div&gt;&lt;br&gt;-&nbsp;Our&nbsp;application&nbsp;implies&nbsp;10&nbsp;000&nbsp;peers&nbsp;producing&nbsp;messages&nbsp;periodically&nbsp;to&nbsp;a&nbsp;unique&nbsp;queue.&nbsp;This&nbsp;queue&nbsp;is&nbsp;listen&nbsp;asynchronously&nbsp;by&nbsp;another&nbsp;peer.&lt;br&gt;-&nbsp;All&nbsp;peer&nbsp;are&nbsp;written&nbsp;in&nbsp;Java.&lt;br&gt;-&nbsp;The&nbsp;production&nbsp;rate&nbsp;of&nbsp;a&nbsp;single&nbsp;peer&nbsp;is&nbsp;4&nbsp;messages&nbsp;/&nbsp;hour.&lt;br&gt;-&nbsp;We&nbsp;can&nbsp;simulate&nbsp;a&nbsp;time-consuming&nbsp;task&nbsp;in&nbsp;the&nbsp;consumer&nbsp;callback,&nbsp;simulating&nbsp;more&nbsp;or&nbsp;less&nbsp;fast&nbsp;consumer.&lt;br&gt;-&nbsp;we&nbsp;are&nbsp;using&nbsp;SSL&nbsp;certificate&nbsp;on&nbsp;the&nbsp;broker&nbsp;side&nbsp;to&nbsp;allow&nbsp;the&nbsp;peer&nbsp;to&nbsp;authenticate&nbsp;the&nbsp;broker.&lt;br&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;-&nbsp;we&nbsp;have&nbsp;noticed&nbsp;that&nbsp;the&nbsp;use&nbsp;of&nbsp;SSL&nbsp;as&nbsp;dramatic&nbsp;incidence&nbsp;on&nbsp;the&nbsp;memory&nbsp;occupied&nbsp;by&nbsp;Rabbitmq&nbsp;process&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Since&nbsp;we&nbsp;upgraded&nbsp;to&nbsp;version&nbsp;&lt;b&gt;2.0.0&lt;/b&gt;,&nbsp;we&nbsp;are&nbsp;no&nbsp;longer&nbsp;able&nbsp;to&nbsp;make&nbsp;a&nbsp;test&nbsp;scenario&nbsp;running.&nbsp;The&nbsp;symptoms&nbsp;are&nbsp;listed&nbsp;bellow&nbsp;:&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;on&nbsp;the&nbsp;broker&nbsp;console&nbsp;first,&nbsp;we&nbsp;get&nbsp;the&nbsp;message&nbsp;:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&nbsp;style=&quot;font-family:&nbsp;Helvetica;&nbsp;&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;'Courier&nbsp;New'&quot;&gt;Erlang&nbsp;has&nbsp;closed&lt;/font&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-family:&nbsp;Helvetica;&nbsp;&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;'Courier&nbsp;New'&quot;&gt;Error:&nbsp;unable&nbsp;to&nbsp;connect&nbsp;to&nbsp;node&nbsp;rabbit@murphys:&nbsp;nodedown&lt;/font&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-family:&nbsp;Helvetica;&nbsp;&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;'Courier&nbsp;New'&quot;&gt;diagnostics:&lt;/font&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-family:&nbsp;Helvetica;&nbsp;&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;'Courier&nbsp;New'&quot;&gt;-&nbsp;nodes&nbsp;and&nbsp;their&nbsp;ports&nbsp;on&nbsp;murphys:&nbsp;[{rabbitmqctl22609,42767}]&lt;/font&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-family:&nbsp;Helvetica;&nbsp;&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;'Courier&nbsp;New'&quot;&gt;-&nbsp;current&nbsp;node:&nbsp;rabbitmqctl22609@murphys&lt;/font&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-family:&nbsp;Helvetica;&nbsp;&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;'Courier&nbsp;New'&quot;&gt;-&nbsp;current&nbsp;node&nbsp;home&nbsp;dir:&nbsp;/var/lib/rabbitmq&lt;/font&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-family:&nbsp;Helvetica;&nbsp;&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;'Courier&nbsp;New'&quot;&gt;-&nbsp;current&nbsp;node&nbsp;cookie&nbsp;hash:&nbsp;qu0gh1hg7j7LKyzK0GLk+A==&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-family:&nbsp;Helvetica;&nbsp;&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;'Courier&nbsp;New'&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-family:&nbsp;Helvetica;&nbsp;&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;'Courier&nbsp;New'&quot;&gt;&lt;div&nbsp;style=&quot;font-family:&nbsp;Helvetica;&nbsp;&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;'Courier&nbsp;New'&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;Helvetica&quot;&gt;we&nbsp;have&nbsp;kept&nbsp;the&nbsp;erl_crash.dump&nbsp;in&nbsp;case,&nbsp;but&nbsp;since&nbsp;i's&nbsp;about&nbsp;200&nbsp;MB&nbsp;&amp;nbsp;I&nbsp;cannot&nbsp;do&nbsp;nothing&nbsp;to&nbsp;send&nbsp;it&nbsp;to&nbsp;you.&lt;/font&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-family:&nbsp;Helvetica;&nbsp;&quot;&gt;Maybe&nbsp;some&nbsp;one&nbsp;can&nbsp;give&nbsp;us&nbsp;some&nbsp;hints&nbsp;or&nbsp;some&nbsp;indicators&nbsp;to&nbsp;look&nbsp;out&nbsp;in&nbsp;the&nbsp;dump&nbsp;to&nbsp;help&nbsp;diagnostics,&nbsp;but&nbsp;we&nbsp;are&nbsp;not&nbsp;Erlang&nbsp;fluent&nbsp;!&lt;/div&gt;&lt;div&nbsp;style=&quot;font-family:&nbsp;Helvetica;&nbsp;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-family:&nbsp;Helvetica;&nbsp;&quot;&gt;What&nbsp;we&nbsp;know&nbsp;for&nbsp;sure&nbsp;is&nbsp;that&nbsp;the&nbsp;crash&amp;nbsp;happens&nbsp;while&nbsp;the&nbsp;10&nbsp;000&nbsp;connections&nbsp;are&nbsp;established,&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;test.&amp;nbsp;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-family:&nbsp;Helvetica;&nbsp;&quot;&gt;We&nbsp;have&nbsp;monitored&nbsp;the&nbsp;&amp;nbsp;number&nbsp;of&nbsp;connections&amp;nbsp;established&amp;nbsp;and&nbsp;the&nbsp;crashes&nbsp;happens&nbsp;always&nbsp;around&nbsp;4500&nbsp;-&nbsp;5000&nbsp;connections,&nbsp;but&nbsp;never&nbsp;the&nbsp;same&nbsp;exact&nbsp;number.&amp;nbsp;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-family:&nbsp;Helvetica;&nbsp;&quot;&gt;We&nbsp;also&nbsp;tried&nbsp;with&nbsp;and&nbsp;without&nbsp;SSL&nbsp;but&nbsp;this&amp;nbsp;does&nbsp;not&nbsp;help&nbsp;at&nbsp;all&nbsp;(same&nbsp;symptoms).&lt;/div&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;On&nbsp;the&nbsp;client&nbsp;side,&nbsp;our&nbsp;application&nbsp;registers&nbsp;a&nbsp;ShutdownListener&nbsp;to&nbsp;implement&nbsp;a&nbsp;connection&nbsp;retry&nbsp;logic&nbsp;upon&nbsp;shutdown.&amp;nbsp;&lt;/div&gt;&lt;div&gt;The&nbsp;retries&nbsp;always&nbsp;failed&amp;nbsp;with&nbsp;the&nbsp;error&nbsp;:&nbsp;connection&nbsp;refused.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;here&nbsp;are&nbsp;some&nbsp;figures&nbsp;we&nbsp;gathered&nbsp;during&nbsp;the&nbsp;test&nbsp;start&nbsp;up&nbsp;about&nbsp;the&nbsp;maximum&nbsp;number&nbsp;of&nbsp;connection&nbsp;established&nbsp;before&nbsp;it&nbsp;crashes&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;-&nbsp;with&nbsp;SSL&nbsp;:&nbsp;5404,&nbsp;4493,&nbsp;4399&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;-&nbsp;without&nbsp;SSL&nbsp;:&nbsp;4673&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;&lt;/div&gt;&lt;div&gt;we&nbsp;dont&nbsp;think&nbsp;that&nbsp;the&nbsp;problem&nbsp;is&nbsp;about&nbsp;file&nbsp;descriptors&nbsp;since&nbsp;we&nbsp;haven't&nbsp;changed&nbsp;anything&nbsp;in&nbsp;the&nbsp;configuration&nbsp;when&nbsp;we&nbsp;upgraded&nbsp;to&nbsp;2.0.0.&lt;/div&gt;&lt;div&gt;The&nbsp;same&nbsp;test&nbsp;used&nbsp;to&nbsp;run&nbsp;successfully&nbsp;on&nbsp;previous&nbsp;version&nbsp;of&nbsp;the&nbsp;broker&nbsp;(1.7.2,&nbsp;and&nbsp;1.8.1).&lt;/div&gt;&lt;div&gt;Moreover,&nbsp;the&nbsp;rabbit_status&nbsp;plugin&nbsp;tells&nbsp;us&nbsp;we&nbsp;have&nbsp;enough&nbsp;file&nbsp;descriptors&nbsp;as&nbsp;well&nbsp;as&nbsp;erlang&nbsp;processes&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;-&nbsp;file&nbsp;descriptors&nbsp;(used&nbsp;/&nbsp;available)=&nbsp;34&nbsp;/&nbsp;65535&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;-&nbsp;elrang&nbsp;processes&nbsp;(used&nbsp;/&nbsp;available)=&nbsp;160&nbsp;/&nbsp;1&nbsp;000&nbsp;000&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;-&nbsp;memory&nbsp;(used&nbsp;/&nbsp;available)=&nbsp;40&nbsp;MB&nbsp;/&nbsp;1609&nbsp;MB&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;We&nbsp;haven't&nbsp;try&nbsp;the&nbsp;&lt;b&gt;2.1.0&lt;/b&gt;&nbsp;yet&nbsp;because&nbsp;we&nbsp;would&nbsp;like&nbsp;to&nbsp;have&nbsp;your&nbsp;feedback&nbsp;about&nbsp;this&nbsp;issue&nbsp;before.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;We&nbsp;would&nbsp;appreciate&nbsp;your&nbsp;feedbacks&nbsp;on&nbsp;that&nbsp;point&nbsp;before&nbsp;we&nbsp;migrate&nbsp;to&nbsp;release&nbsp;2.1.0.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Best&nbsp;regards,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Romary.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;'Courier&nbsp;New'&quot;&gt;&lt;div&nbsp;style=&quot;font-family:&nbsp;Helvetica;&nbsp;&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;'Courier&nbsp;New'&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;_______________________________________________&lt;br&gt;rabbitmq-discuss&nbsp;mailing&nbsp;list&lt;br&gt;&lt;a&nbsp;href=&quot;mailto:rabbitmq-discuss@lists.rabbitmq.com&quot;&gt;rabbitmq-discuss@lists.rabbitmq.com&lt;/a&gt;&lt;br&gt;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
