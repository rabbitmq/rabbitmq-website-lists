<tt>
&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;17&nbsp;August&nbsp;2011&nbsp;10:39,&nbsp;Michael&nbsp;Bridgen&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:mikeb@rabbitmq.com&quot;&gt;mikeb@rabbitmq.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex;&quot;&gt;<br>
Hi&nbsp;Pete,&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
I&nbsp;have&nbsp;been&nbsp;playing&nbsp;with&nbsp;rabbitmq&nbsp;and&nbsp;am&nbsp;thinking&nbsp;through&nbsp;some&nbsp;common&lt;br&gt;<br>
scenarios&nbsp;I&nbsp;think&nbsp;I&nbsp;will&nbsp;need&nbsp;to&nbsp;deal&nbsp;with,&nbsp;I&nbsp;was&nbsp;wondering&nbsp;if&nbsp;anyone&lt;br&gt;<br>
would&nbsp;be&nbsp;able&nbsp;to&nbsp;take&nbsp;the&nbsp;time&nbsp;to&nbsp;read&nbsp;my&nbsp;thoughts&nbsp;and&nbsp;validate&nbsp;them&nbsp;or&lt;br&gt;<br>
throw&nbsp;a&nbsp;few&nbsp;more&nbsp;options&nbsp;in/give&nbsp;me&nbsp;some&nbsp;article&nbsp;links?&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;have&nbsp;a&nbsp;topic&nbsp;exchange&nbsp;and&nbsp;need&nbsp;to&nbsp;attach&nbsp;some&nbsp;consumers&nbsp;to&nbsp;process&lt;br&gt;<br>
messages.&lt;br&gt;<br>
&lt;br&gt;<br>
If&nbsp;I&nbsp;attach&nbsp;a&nbsp;consumer&nbsp;with&nbsp;no&nbsp;queue&nbsp;name,&nbsp;a&nbsp;unique&nbsp;one&nbsp;time&nbsp;queue&nbsp;will&lt;br&gt;<br>
be&nbsp;created&nbsp;and&nbsp;I&nbsp;can&nbsp;bind&nbsp;the&nbsp;exchange&nbsp;to&nbsp;this&nbsp;queue&nbsp;using&nbsp;a&nbsp;routing&nbsp;key&lt;br&gt;<br>
like&nbsp;&amp;#39;animal.mammals.#&amp;#39;.&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;&lt;/div&gt;<br>
Not&nbsp;quite;&nbsp;you&nbsp;have&nbsp;to&nbsp;create&nbsp;the&nbsp;queue&nbsp;with&nbsp;an&nbsp;empty&nbsp;name,&nbsp;then&nbsp;consume&nbsp;from&nbsp;it&nbsp;using&nbsp;the&nbsp;name&nbsp;you&nbsp;get&nbsp;back&nbsp;in&nbsp;queue.declare_ok&nbsp;(and&nbsp;then&nbsp;bind&nbsp;it&nbsp;to&nbsp;the&nbsp;exchange).&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
This&nbsp;is&nbsp;great&nbsp;until&lt;br&gt;<br>
&lt;br&gt;<br>
-&nbsp;the&nbsp;consumer&nbsp;crashes,&nbsp;meaning&nbsp;the&nbsp;exchange&nbsp;will&nbsp;drop&nbsp;all&nbsp;messages&nbsp;(or&lt;br&gt;<br>
they&nbsp;get&nbsp;rejected&nbsp;depending&nbsp;on&nbsp;the&nbsp;publish&nbsp;settings&nbsp;I&nbsp;use)&lt;br&gt;<br>
or&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;&lt;/div&gt;<br>
Yes,&nbsp;that&nbsp;can&nbsp;happen.&nbsp;Though&nbsp;if&nbsp;the&nbsp;queue&nbsp;isn&amp;#39;t&nbsp;exclusive&nbsp;or&nbsp;auto_delete&nbsp;(and&nbsp;thereby&nbsp;destroyed&nbsp;when&nbsp;the&nbsp;connection&nbsp;drops&nbsp;or&nbsp;consumer&nbsp;goes&nbsp;away),&nbsp;it&nbsp;will&nbsp;happily&nbsp;collect&nbsp;messages&nbsp;until&nbsp;the&nbsp;consumer&nbsp;returns.&nbsp;Of&nbsp;course,&nbsp;you&amp;#39;d&nbsp;have&nbsp;to&nbsp;have&nbsp;recorded&nbsp;its&nbsp;name&nbsp;somewhere,&nbsp;or&nbsp;generated&nbsp;the&nbsp;name&nbsp;yourself&nbsp;in&nbsp;a&nbsp;way&nbsp;you&nbsp;can&nbsp;repeat.&lt;div&nbsp;class=&quot;im&quot;&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
-&nbsp;I&nbsp;need&nbsp;another&nbsp;consumer&nbsp;to&nbsp;process&nbsp;animals.mammals.#,&nbsp;which&nbsp;I&nbsp;can&amp;#39;t&nbsp;do&lt;br&gt;<br>
as&nbsp;I&nbsp;am&nbsp;using&nbsp;a&nbsp;one&nbsp;time&nbsp;queue&nbsp;and&nbsp;adding&nbsp;another&nbsp;will&nbsp;mean&nbsp;each&nbsp;message&lt;br&gt;<br>
is&nbsp;delivered&nbsp;to&nbsp;2&nbsp;queues.&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;&lt;/div&gt;<br>
What&nbsp;is&nbsp;the&nbsp;problem&nbsp;with&nbsp;delivering&nbsp;to&nbsp;two&nbsp;queues?&nbsp;If&nbsp;you&nbsp;are&nbsp;using&nbsp;a&nbsp;topic&nbsp;exchange,&nbsp;creating&nbsp;an&nbsp;anonymous,&nbsp;exclusive&nbsp;queue&nbsp;for&nbsp;each&nbsp;consumer&nbsp;is&nbsp;usually&nbsp;appropriate.&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
Are&nbsp;the&nbsp;above&nbsp;assumptions&nbsp;correct?&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
So&nbsp;my&nbsp;second&nbsp;option&nbsp;is&nbsp;to&nbsp;use&nbsp;a&nbsp;named&nbsp;queue.&nbsp;I&nbsp;attach&nbsp;a&nbsp;consumer&nbsp;with&nbsp;a&lt;br&gt;<br>
queue&nbsp;name&nbsp;and&nbsp;bind&nbsp;the&nbsp;exchange&nbsp;to&nbsp;this&nbsp;queue&nbsp;using&nbsp;a&nbsp;routing&nbsp;key&nbsp;like&lt;br&gt;<br>
&amp;#39;animal.mammals.#&amp;#39;.&lt;br&gt;<br>
&lt;br&gt;<br>
Now&nbsp;if&nbsp;I&nbsp;need&nbsp;another&nbsp;consumer&nbsp;I&nbsp;simply&nbsp;bring&nbsp;another&nbsp;one&nbsp;up&nbsp;and&nbsp;attach&lt;br&gt;<br>
it&nbsp;to&nbsp;the&nbsp;same&nbsp;queue&nbsp;name,&nbsp;and&nbsp;they&nbsp;get&nbsp;the&nbsp;messages&nbsp;in&nbsp;round&nbsp;robin&lt;br&gt;<br>
which&nbsp;is&nbsp;great.&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;&lt;/div&gt;<br>
It&nbsp;is&nbsp;certainly&nbsp;an&nbsp;established&nbsp;pattern&nbsp;to&nbsp;use&nbsp;a&nbsp;durable,&nbsp;named&nbsp;queue&nbsp;for&nbsp;sharing&nbsp;out&nbsp;messages.&nbsp; Queues&nbsp;do&nbsp;double&nbsp;duty&nbsp;in&nbsp;AMQP&nbsp;--&nbsp;firstly&nbsp;as&nbsp;&amp;quot;work&nbsp;queues&amp;quot;&nbsp;of&nbsp;this&nbsp;kind,&nbsp;secondly&nbsp;as&nbsp;buffers&nbsp;for&nbsp;transmission.&lt;br&gt;&lt;/blockquote&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;That&amp;#39;s&nbsp;good&nbsp;to&nbsp;know,&nbsp;after&nbsp;experimenting&nbsp;this&nbsp;is&nbsp;the&nbsp;thinking&nbsp;I&nbsp;have&nbsp;come&nbsp;round&nbsp;to&nbsp;as&nbsp;it&nbsp;allows&nbsp;the&nbsp;consumers&nbsp;to&nbsp;die&nbsp;if&nbsp;they&nbsp;need&nbsp;to&nbsp;and&nbsp;the&nbsp;queues&nbsp;will&nbsp;still&nbsp;be&nbsp;written&nbsp;to,&nbsp;using&nbsp;a&nbsp;named&nbsp;queue&nbsp;also&nbsp;enables&nbsp;more&nbsp;than&nbsp;one&nbsp;consumer&nbsp;to&nbsp;attach&nbsp;to&nbsp;a&nbsp;queue&nbsp;and&nbsp;receive&nbsp;the&nbsp;messages&nbsp;in&nbsp;round&nbsp;robin,&nbsp;which&nbsp;is&nbsp;a&nbsp;nice&nbsp;quick&nbsp;way&nbsp;to&nbsp;add&nbsp;process&nbsp;capacity&nbsp;if&nbsp;it&amp;#39;s&nbsp;ever&nbsp;required.&lt;/div&gt;<br>
&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex;&quot;&gt;<br>
&lt;br&gt;<br>
Take&nbsp;care&nbsp;with&nbsp;the&nbsp;order&nbsp;in&nbsp;which&nbsp;you&nbsp;do&nbsp;things,&nbsp;or&nbsp;at&nbsp;least&nbsp;be&nbsp;aware&nbsp;that&nbsp;unless&nbsp;you&nbsp;set&nbsp;a&nbsp;prefetch&nbsp;value,&nbsp;the&nbsp;first&nbsp;consumer&nbsp;will&nbsp;get&nbsp;all&nbsp;the&nbsp;messages&nbsp;in&nbsp;the&nbsp;queue&nbsp;at&nbsp;that&nbsp;time.&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;noticed&nbsp;that&nbsp;with&nbsp;my&nbsp;experiments,&nbsp;prefetch&nbsp;is&nbsp;now&nbsp;set.&lt;/div&gt;<br>
&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex;&quot;&gt;&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
What&amp;#39;s&nbsp;not&nbsp;so&nbsp;great&nbsp;is&nbsp;if&nbsp;I&nbsp;then&nbsp;decide&nbsp;to&nbsp;attach&nbsp;a&nbsp;consumer&nbsp;to&nbsp;this&lt;br&gt;<br>
queue&nbsp;name&nbsp;(maybe&nbsp;by&nbsp;accident)&nbsp;and&nbsp;bind&nbsp;the&nbsp;exchange&nbsp;to&nbsp;a&nbsp;routing&nbsp;key&lt;br&gt;<br>
&amp;#39;animal.mammals.rabbit&amp;#39;&lt;br&gt;<br>
&lt;br&gt;<br>
Then&nbsp;the&nbsp;queue&nbsp;gets&nbsp;2&nbsp;copies&nbsp;of&nbsp;each&nbsp;message.&nbsp;Is&nbsp;there&nbsp;any&nbsp;way&nbsp;to&nbsp;avoid&lt;br&gt;<br>
this&nbsp;other&nbsp;than&nbsp;careful&nbsp;management&nbsp;of&nbsp;bindings?&nbsp;Maybe&nbsp;a&nbsp;way&nbsp;of&nbsp;telling&lt;br&gt;<br>
the&nbsp;exchange&nbsp;to&nbsp;only&nbsp;deliver&nbsp;the&nbsp;message&nbsp;once&nbsp;to&nbsp;a&nbsp;given&nbsp;queue?&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;&lt;/div&gt;<br>
No,&nbsp;it&nbsp;won&amp;#39;t&nbsp;get&nbsp;two&nbsp;copies.&nbsp; The&nbsp;routing&nbsp;will&nbsp;only&nbsp;ever&nbsp;deliver&nbsp;any&nbsp;given&nbsp;message&nbsp;once&nbsp;to&nbsp;a&nbsp;queue.&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;combination&nbsp;of&nbsp;wildcard&nbsp;routing&nbsp;and&nbsp;round-robin&nbsp;is&nbsp;unusual.&nbsp;Would&nbsp;you&nbsp;go&nbsp;into&nbsp;more&nbsp;detail&nbsp;about&nbsp;what&nbsp;you&nbsp;are&nbsp;trying&nbsp;to&nbsp;achieve?&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;think&nbsp;I&nbsp;could&nbsp;have&nbsp;confused&nbsp;the&nbsp;issue&nbsp;here&nbsp;somewhat&nbsp;-&nbsp;because&nbsp;of&nbsp;how&nbsp;the&nbsp;tutorials&nbsp;are&nbsp;laid&nbsp;out&nbsp;I&nbsp;mistakenly&nbsp;thought&nbsp;that&nbsp;the&nbsp;consumer&nbsp;could&nbsp;consume&nbsp;on&nbsp;a&nbsp;given&nbsp;routing&nbsp;key,&nbsp;rather&nbsp;than&nbsp;the&nbsp;routing&nbsp;key&nbsp;just&nbsp;being&nbsp;a&nbsp;binding&nbsp;between&nbsp;an&nbsp;exchange&nbsp;and&nbsp;a&nbsp;queue.&nbsp;So&nbsp;I&nbsp;was&nbsp;thinking&nbsp;I&nbsp;was&nbsp;consuming&nbsp;on&nbsp;a&nbsp;routing&nbsp;key,&nbsp;whereas&nbsp;in&nbsp;reality&nbsp;that&amp;#39;s&nbsp;not&nbsp;the&nbsp;case.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;tutorials&nbsp;(and&nbsp;further&nbsp;experimentation)&nbsp;It&amp;#39;s&nbsp;been&nbsp;a&nbsp;useful&nbsp;exercise&nbsp;in&nbsp;finding&nbsp;out&nbsp;just&nbsp;how&nbsp;flexible&nbsp;rabbitmq&nbsp;is,&nbsp;and&nbsp;with&nbsp;that&nbsp;flexibility&nbsp;comes&nbsp;the&nbsp;potential&nbsp;to&nbsp;really&nbsp;break&nbsp;the&nbsp;queues&nbsp;and&nbsp;bindings&nbsp;(especially&nbsp;if&nbsp;the&nbsp;application&nbsp;is&nbsp;allowed&nbsp;to&nbsp;blindly&nbsp;create&nbsp;queues&nbsp;and&nbsp;bindings).&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;am&nbsp;going&nbsp;to&nbsp;go&nbsp;with&nbsp;an&nbsp;approach&nbsp;that&nbsp;means&nbsp;bindings&nbsp;and&nbsp;queues&nbsp;must&nbsp;be&nbsp;manually&nbsp;created,&nbsp;and&nbsp;only&nbsp;give&nbsp;the&nbsp;application&nbsp;code&nbsp;permission&nbsp;to&nbsp;write&nbsp;to&nbsp;the&nbsp;exchanges,&nbsp;and&nbsp;read&nbsp;from&nbsp;the&nbsp;queues.&lt;/div&gt;&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex;&quot;&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
--Michael&lt;br&gt;<br>
______________________________&lt;u&gt;&lt;/u&gt;_________________&lt;br&gt;<br>
rabbitmq-discuss&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:rabbitmq-discuss@lists.rabbitmq.com&quot;&nbsp;target=&quot;_blank&quot;&gt;rabbitmq-discuss@lists.&lt;u&gt;&lt;/u&gt;rabbitmq.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&quot;&nbsp;target=&quot;_blank&quot;&gt;https://lists.rabbitmq.com/&lt;u&gt;&lt;/u&gt;cgi-bin/mailman/listinfo/&lt;u&gt;&lt;/u&gt;rabbitmq-discuss&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;<br>

</tt>
