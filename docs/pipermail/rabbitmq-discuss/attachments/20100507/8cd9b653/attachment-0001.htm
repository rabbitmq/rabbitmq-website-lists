<tt>
&lt;!DOCTYPE&nbsp;html&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;4.01&nbsp;Transitional//EN&quot;&gt;<br>
&lt;html&gt;<br>
&lt;head&gt;<br>
&nbsp;&nbsp;&lt;meta&nbsp;content=&quot;text/html;charset=ISO-8859-1&quot;&nbsp;http-equiv=&quot;Content-Type&quot;&gt;<br>
&lt;/head&gt;<br>
&lt;body&nbsp;bgcolor=&quot;#ffffff&quot;&nbsp;text=&quot;#000000&quot;&gt;<br>
Mathew&nbsp;explained&nbsp;everything&nbsp;with&nbsp;the&nbsp;high&nbsp;memory&nbsp;watermark&nbsp;setting.&nbsp;The<br>
machine&nbsp;is&nbsp;not&nbsp;dedicated&nbsp;to&nbsp;RabbitMQ&nbsp;and&nbsp;is&nbsp;running&nbsp;other&nbsp;things.<br>
Erlang&nbsp;thinks&nbsp;it&nbsp;can&nbsp;have&nbsp;40%&nbsp;of&nbsp;memory&nbsp;which&nbsp;I&nbsp;guess&nbsp;can&nbsp;go&nbsp;to&nbsp;80%<br>
before&nbsp;forcing&nbsp;GC.&nbsp;On&nbsp;this&nbsp;machine&nbsp;RabbitMQ&nbsp;crashes&nbsp;well&nbsp;before&nbsp;it<br>
reaches&nbsp;80%&nbsp;as&nbsp;that&nbsp;much&nbsp;memory&nbsp;is&nbsp;not&nbsp;available.&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;argue&nbsp;that&nbsp;is&nbsp;a&nbsp;poor&nbsp;assumption&nbsp;for&nbsp;a&nbsp;default&nbsp;setting.&nbsp;Nothing&nbsp;should<br>
assume&nbsp;out&nbsp;of&nbsp;the&nbsp;box&nbsp;it&nbsp;can&nbsp;have&nbsp;80%&nbsp;of&nbsp;physical&nbsp;memory&nbsp;(regardless&nbsp;of<br>
what&nbsp;is&nbsp;running).&nbsp;I&nbsp;hope&nbsp;the&nbsp;new&nbsp;persister&nbsp;takes&nbsp;away&nbsp;some&nbsp;of&nbsp;those<br>
assumptions.&nbsp;It&nbsp;should&nbsp;be&nbsp;smart&nbsp;enough&nbsp;to&nbsp;work&nbsp;with&nbsp;the&nbsp;memory<br>
available.&nbsp;&lt;br&gt;<br>
&lt;br&gt;<br>
David&nbsp;Wragg&nbsp;wrote:<br>
&lt;blockquote&nbsp;cite=&quot;mid:k5aasbdg41.fsf@mrbraver.lshift.net&quot;&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;Hi&nbsp;Wayne,<br>
<br>
Wayne&nbsp;Van&nbsp;Den&nbsp;Handel&nbsp;&lt;a&nbsp;class=&quot;moz-txt-link-rfc2396E&quot;&nbsp;href=&quot;mailto:wvandenhandel@dataraker.com&quot;&gt;&amp;lt;wvandenhandel@dataraker.com&amp;gt;&lt;/a&gt;&nbsp;writes:<br>
&nbsp;&nbsp;&lt;/pre&gt;<br>
&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;Watching&nbsp;top&nbsp;I&nbsp;see&nbsp;RabbitMQ&nbsp;take&nbsp;up&nbsp;more&nbsp;and&nbsp;<br>
more&nbsp;memory&nbsp;over&nbsp;time.&nbsp;It&nbsp;seems&nbsp;that&nbsp;it&nbsp;can&nbsp;only&nbsp;process&nbsp;30-40k&nbsp;messages&nbsp;<br>
in&nbsp;total/aggregate&nbsp;before&nbsp;it&nbsp;crashes&nbsp;(even&nbsp;though&nbsp;there&nbsp;is&nbsp;never&nbsp;more&nbsp;<br>
than&nbsp;1000&nbsp;messages&nbsp;in&nbsp;all&nbsp;queues&nbsp;at&nbsp;one&nbsp;time).<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/pre&gt;<br>
&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;&lt;!----&gt;<br>
I&nbsp;wonder&nbsp;if&nbsp;you&nbsp;could&nbsp;boil&nbsp;down&nbsp;your&nbsp;code&nbsp;to&nbsp;a&nbsp;simple&nbsp;consumer&nbsp;and<br>
producer&nbsp;program&nbsp;that&nbsp;demonstrate&nbsp;the&nbsp;problem?&nbsp;&nbsp;We're&nbsp;having&nbsp;trouble<br>
explaining&nbsp;the&nbsp;behaviour&nbsp;you&nbsp;describe,&nbsp;so&nbsp;that&nbsp;would&nbsp;probably&nbsp;be&nbsp;the<br>
best&nbsp;way&nbsp;to&nbsp;get&nbsp;to&nbsp;the&nbsp;bottom&nbsp;of&nbsp;it.<br>
<br>
David<br>
<br>
&nbsp;&nbsp;&lt;/pre&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;<br>
&lt;pre&nbsp;class=&quot;moz-signature&quot;&nbsp;cols=&quot;72&quot;&gt;<br>
&lt;/pre&gt;<br>
&lt;/body&gt;<br>
&lt;/html&gt;<br>
<br>
<br>

</tt>
