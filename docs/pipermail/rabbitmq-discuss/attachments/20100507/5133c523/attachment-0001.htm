<tt>
On&nbsp;Fri,&nbsp;May&nbsp;7,&nbsp;2010&nbsp;at&nbsp;2:49&nbsp;PM,&nbsp;Matthew&nbsp;Sackman&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:matthew@lshift.net&quot;&gt;matthew@lshift.net&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex;&quot;&gt;<br>
<br>
Hi&nbsp;Mario,&lt;br&gt;<br>
&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;br&gt;<br>
On&nbsp;Fri,&nbsp;May&nbsp;07,&nbsp;2010&nbsp;at&nbsp;02:43:42PM&nbsp;+0100,&nbsp;&lt;a&nbsp;href=&quot;mailto:mmenti@gmail.com&quot;&gt;mmenti@gmail.com&lt;/a&gt;&nbsp;wrote:&lt;br&gt;<br>
&amp;gt;&nbsp;We&amp;#39;ve&nbsp;been&nbsp;seeing&nbsp;an&nbsp;issue&nbsp;where&nbsp;the&nbsp;number&nbsp;of&nbsp;unack&amp;#39;ed&nbsp;messages&nbsp;suddenly&lt;br&gt;<br>
&amp;gt;&nbsp;starts&nbsp;growing&nbsp;much&nbsp;larger&nbsp;than&nbsp;the&nbsp;number&nbsp;of&nbsp;connected&nbsp;consumers,&nbsp;whenever&lt;br&gt;<br>
&amp;gt;&nbsp;the&nbsp;queue&nbsp;gets&nbsp;to&nbsp;a&nbsp;certain&nbsp;size&nbsp; (somewhere&nbsp;around&nbsp;50k&nbsp;messages&nbsp;in&nbsp;the&lt;br&gt;<br>
&amp;gt;&nbsp;queue,&nbsp;with&nbsp;250&nbsp;consumers&nbsp;connected).&nbsp;We&amp;#39;ve&nbsp;noticed&nbsp;that&nbsp;by&nbsp;reducing&nbsp;the&lt;br&gt;<br>
&amp;gt;&nbsp;number&nbsp;of&nbsp;consumers,&nbsp;the&nbsp;issue&nbsp;becomes&nbsp;less&nbsp;pronounced,&nbsp;but&nbsp;was&nbsp;wondering&nbsp;if&lt;br&gt;<br>
&amp;gt;&nbsp;anyone&nbsp;else&nbsp;is&nbsp;seeing&nbsp;this,&nbsp;and&nbsp;if&nbsp;there&amp;#39;s&nbsp;any&nbsp;ways&nbsp;to&nbsp;avoid&nbsp;this?&nbsp;We&amp;#39;re&lt;br&gt;<br>
&amp;gt;&nbsp;using&nbsp;rabbitmq&nbsp;1.7.0&nbsp;on&nbsp;an&nbsp;64-bit&nbsp;Amazon&nbsp;EC2&nbsp;Ubuntu&nbsp;8.04&nbsp;hardy&nbsp;AMI.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;There&nbsp;are&nbsp;two&nbsp;parts&nbsp;to&nbsp;this&nbsp;issue.&nbsp;Firstly,&nbsp;some&nbsp;priorities&nbsp;of&nbsp;messages&lt;br&gt;<br>
internally&nbsp;were&nbsp;changed&nbsp;either&nbsp;in&nbsp;1.7.1&nbsp;or&nbsp;1.7.2&nbsp;so&nbsp;that&nbsp;acks&nbsp;would&nbsp;have&lt;br&gt;<br>
higher&nbsp;priority&nbsp;internally&nbsp;than&nbsp;publishes.&nbsp;This&nbsp;helps&nbsp;solve&nbsp;this&lt;br&gt;<br>
problem,&nbsp;and&nbsp;so&nbsp;I&nbsp;would&nbsp;recommend&nbsp;you&nbsp;upgrade.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks,&nbsp;good&nbsp;to&nbsp;know&nbsp;-&nbsp;we&amp;#39;ll&nbsp;try&nbsp;and&nbsp;do&nbsp;that&nbsp;as&nbsp;soon&nbsp;as&nbsp;is&nbsp;feasible.&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex;&quot;&gt;<br>
<br>
<br>
&lt;br&gt;<br>
Secondly,&nbsp;you&nbsp;can&nbsp;help&nbsp;by&nbsp;setting&nbsp;a&nbsp;qos&nbsp;prefetch&nbsp;count&nbsp;on&nbsp;your&nbsp;consumers&lt;br&gt;<br>
-&nbsp;if,&nbsp;say,&nbsp;you&nbsp;set&nbsp;it&nbsp;to&nbsp;10,&nbsp;then&nbsp;you&amp;#39;re&nbsp;ensuring&nbsp;that&nbsp;each&nbsp;consumer&lt;br&gt;<br>
will&nbsp;only&nbsp;receive&nbsp;10&nbsp;messages&nbsp;before&nbsp;it&nbsp;must&nbsp;a)&nbsp;ack&nbsp;a&nbsp;message&nbsp;and&nbsp;b)&lt;br&gt;<br>
that&nbsp;ack&nbsp;is&nbsp;received&nbsp;*and*processed*&nbsp;by&nbsp;Rabbit.&nbsp;This&nbsp;will&nbsp;ensure&nbsp;the&lt;br&gt;<br>
unacked&nbsp;message&nbsp;count&nbsp;stays&nbsp;low.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Strangely&nbsp;we&nbsp;already&nbsp;have&nbsp;prefetch&nbsp;set&nbsp;to&nbsp;1&nbsp;on&nbsp;the&nbsp;consumers,&nbsp;and&nbsp;still&nbsp;see&nbsp;this&nbsp;issue.&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;/div&gt;<br>

</tt>
