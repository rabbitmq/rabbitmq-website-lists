<tt>
&lt;!DOCTYPE&nbsp;html&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;4.01&nbsp;Transitional//EN&quot;&gt;<br>
&lt;html&gt;<br>
&lt;head&gt;<br>
&nbsp;&nbsp;&lt;meta&nbsp;content=&quot;text/html;charset=ISO-8859-1&quot;&nbsp;http-equiv=&quot;Content-Type&quot;&gt;<br>
&lt;/head&gt;<br>
&lt;body&nbsp;bgcolor=&quot;#ffffff&quot;&nbsp;text=&quot;#000000&quot;&gt;<br>
I&nbsp;tried&nbsp;the&nbsp;high&nbsp;water&nbsp;mark&nbsp;setting&nbsp;and&nbsp;it&nbsp;now&nbsp;prevents&nbsp;too&nbsp;much&nbsp;memory<br>
from&nbsp;being&nbsp;used&nbsp;(barely)&nbsp;but&nbsp;as&nbsp;my&nbsp;test&nbsp;continued&nbsp;it&nbsp;eventually&nbsp;had&nbsp;a<br>
hard&nbsp;crash&nbsp;for&nbsp;another&nbsp;reason.&nbsp;I&nbsp;was&nbsp;hitting&nbsp;it&nbsp;with&nbsp;2&nbsp;producers<br>
throttled&nbsp;to&nbsp;1000&nbsp;messages&nbsp;each&nbsp;to&nbsp;a&nbsp;separate&nbsp;queue&nbsp;and&nbsp;5&nbsp;consumers.<br>
There&nbsp;was&nbsp;always&nbsp;1000&nbsp;messages&nbsp;each&nbsp;in&nbsp;the&nbsp;2&nbsp;queues&nbsp;and&nbsp;after&nbsp;15<br>
minutes&nbsp;one&nbsp;of&nbsp;the&nbsp;producers&nbsp;crashed&nbsp;with&nbsp;an&nbsp;error&nbsp;(from&nbsp;the&nbsp;logs)<br>
{amqp_error,not_found,&quot;no&nbsp;queue&nbsp;'xxx'&nbsp;in&nbsp;vhost&nbsp;'/'&quot;,&nbsp;queue.declare'}.&nbsp;I<br>
figured&nbsp;this&nbsp;was&nbsp;a&nbsp;timeout&nbsp;or&nbsp;something&nbsp;as&nbsp;the&nbsp;queue&nbsp;did&nbsp;exist&nbsp;and&nbsp;was<br>
being&nbsp;emptied&nbsp;by&nbsp;3&nbsp;different&nbsp;consumers&nbsp;actively.&lt;br&gt;<br>
&lt;br&gt;<br>
5&nbsp;seconds&nbsp;later&nbsp;the&nbsp;entire&nbsp;process&nbsp;died&nbsp;with&nbsp;an&nbsp;error&nbsp;(from&nbsp;the&nbsp;logs)<br>
&quot;exception&nbsp;on&nbsp;TCP&nbsp;connection&nbsp;...&nbsp;connection_closed_abruptly&quot;&nbsp;and&nbsp;then<br>
&quot;closing&nbsp;TCP&nbsp;connection&quot;.&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;am&nbsp;new&nbsp;to&nbsp;queuing&nbsp;but&nbsp;frankly&nbsp;I&nbsp;don't&nbsp;know&nbsp;what&nbsp;to&nbsp;do.&nbsp;My&nbsp;Experience<br>
with&nbsp;this&nbsp;and&nbsp;other&nbsp;MQ&nbsp;products&nbsp;is&nbsp;less&nbsp;than&nbsp;compelling.&nbsp;Does&nbsp;this&nbsp;take<br>
a&nbsp;ton&nbsp;of&nbsp;tweaking&nbsp;to&nbsp;get&nbsp;stable?&nbsp;How&nbsp;do&nbsp;people&nbsp;manage&nbsp;to&nbsp;push&nbsp;500k<br>
messages&nbsp;a&nbsp;day?&nbsp;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Wayne&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Matthew&nbsp;Sackman&nbsp;wrote:<br>
&lt;blockquote&nbsp;cite=&quot;mid:20100507120026.GJ2739@mrnibble.lshift.net&quot;<br>
&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;Hi&nbsp;Wayne,<br>
<br>
On&nbsp;Fri,&nbsp;May&nbsp;07,&nbsp;2010&nbsp;at&nbsp;07:48:54AM&nbsp;-0400,&nbsp;Wayne&nbsp;Van&nbsp;Den&nbsp;Handel&nbsp;wrote:<br>
&nbsp;&nbsp;&lt;/pre&gt;<br>
&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;I&nbsp;will&nbsp;test&nbsp;the&nbsp;basic&nbsp;consume,&nbsp;thanks&nbsp;for&nbsp;the&nbsp;tip.&nbsp;The&nbsp;machine&nbsp;I&nbsp;am&nbsp;running<br>
is&nbsp;a&nbsp;single&nbsp;socket&nbsp;4&nbsp;core&nbsp;with&nbsp;4&nbsp;gigs&nbsp;ram&nbsp;but&nbsp;there&nbsp;are&nbsp;other&nbsp;things&nbsp;running<br>
and&nbsp;taking&nbsp;up&nbsp;memory.&nbsp;Is&nbsp;there&nbsp;a&nbsp;gc&nbsp;interval&nbsp;that&nbsp;can&nbsp;be&nbsp;set&nbsp;to&nbsp;get&nbsp;memory<br>
back&nbsp;sooner?&nbsp;As&nbsp;I&nbsp;add&nbsp;messages&nbsp;and&nbsp;remove&nbsp;them&nbsp;I&nbsp;can&nbsp;see&nbsp;the&nbsp;exact&nbsp;memory<br>
taken&nbsp;with&nbsp;the&nbsp;admin&nbsp;tool&nbsp;and&nbsp;it&nbsp;keeps&nbsp;going&nbsp;up.&nbsp;It&nbsp;seems&nbsp;the&nbsp;rate&nbsp;at&nbsp;which<br>
I&nbsp;add&nbsp;to&nbsp;the&nbsp;queue&nbsp;exceeds&nbsp;the&nbsp;ability&nbsp;the&nbsp;clear&nbsp;memory.&nbsp;Basically&nbsp;even<br>
though&nbsp;there&nbsp;is&nbsp;little&nbsp;in&nbsp;the&nbsp;queue&nbsp;at&nbsp;any&nbsp;time&nbsp;the&nbsp;memory&nbsp;use&nbsp;keeps&nbsp;going<br>
up.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/pre&gt;<br>
&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;&lt;!----&gt;<br>
Rabbit&nbsp;assumes&nbsp;it&nbsp;gets&nbsp;the&nbsp;whole&nbsp;machine's&nbsp;memory&nbsp;to&nbsp;itself.&nbsp;If&nbsp;that's<br>
not&nbsp;the&nbsp;case&nbsp;then&nbsp;you&nbsp;need&nbsp;to&nbsp;reduce&nbsp;the&nbsp;memory&nbsp;high&nbsp;watermark&nbsp;from&nbsp;0.4<br>
to&nbsp;some&nbsp;much&nbsp;lower&nbsp;figure&nbsp;-&nbsp;say,&nbsp;0.1.<br>
See&nbsp;&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://www.rabbitmq.com/extensions.html#memsup&quot;&gt;http://www.rabbitmq.com/extensions.html#memsup&lt;/a&gt;<br>
<br>
&nbsp;&nbsp;&lt;/pre&gt;<br>
&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;At&nbsp;this&nbsp;point&nbsp;I&nbsp;am&nbsp;ready&nbsp;to&nbsp;give&nbsp;up&nbsp;until&nbsp;they&nbsp;harden&nbsp;the&nbsp;persister&nbsp;to<br>
go&nbsp;to&nbsp;disk&nbsp;as&nbsp;I&nbsp;assume&nbsp;the&nbsp;persister&nbsp;is&nbsp;the&nbsp;problem.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/pre&gt;<br>
&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;&lt;!----&gt;<br>
Yup.&nbsp;The&nbsp;new&nbsp;persister&nbsp;currently&nbsp;requires&nbsp;you&nbsp;build&nbsp;from&nbsp;source,&nbsp;but&nbsp;it<br>
is&nbsp;actively&nbsp;being&nbsp;QA'd&nbsp;and&nbsp;great&nbsp;progress&nbsp;has&nbsp;been&nbsp;made&nbsp;getting&nbsp;it&nbsp;into<br>
default.&nbsp;We've&nbsp;gone&nbsp;from&nbsp;about&nbsp;100&nbsp;hunks&nbsp;difference&nbsp;a&nbsp;couple&nbsp;of&nbsp;weeks<br>
ago&nbsp;to&nbsp;now&nbsp;about&nbsp;13&nbsp;-&nbsp;so&nbsp;things&nbsp;are&nbsp;very&nbsp;much&nbsp;moving&nbsp;in&nbsp;this&nbsp;direction.<br>
<br>
In&nbsp;the&nbsp;mean&nbsp;time,&nbsp;many&nbsp;people&nbsp;are&nbsp;already&nbsp;using&nbsp;the&nbsp;new&nbsp;persister,&nbsp;which<br>
is&nbsp;on&nbsp;branch&nbsp;&quot;bug21673&quot;&nbsp;and&nbsp;if&nbsp;you're&nbsp;comfortable&nbsp;compiling&nbsp;from&nbsp;source<br>
and&nbsp;using&nbsp;some&nbsp;code&nbsp;which&nbsp;has&nbsp;not&nbsp;yet&nbsp;completed&nbsp;our&nbsp;QA&nbsp;process,&nbsp;then&nbsp;we<br>
would&nbsp;encourage&nbsp;you&nbsp;to&nbsp;use&nbsp;it,&nbsp;with&nbsp;the&nbsp;understanding&nbsp;that&nbsp;there&nbsp;may<br>
still&nbsp;be&nbsp;bugs&nbsp;in&nbsp;it.&nbsp;Further&nbsp;battle&nbsp;testing&nbsp;is&nbsp;always&nbsp;welcome&nbsp;and&nbsp;should<br>
you&nbsp;come&nbsp;across&nbsp;any&nbsp;bugs,&nbsp;any&nbsp;bug&nbsp;reports&nbsp;you&nbsp;make&nbsp;are&nbsp;very&nbsp;gratefully<br>
received.<br>
<br>
Matthew<br>
<br>
&nbsp;&nbsp;&lt;/pre&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/body&gt;<br>
&lt;/html&gt;<br>
<br>

</tt>
