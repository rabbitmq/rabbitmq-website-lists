<tt>
Brief&nbsp;glance&nbsp;at&nbsp;the&nbsp;code&nbsp;-&nbsp;it&nbsp;looks&nbsp;good&nbsp;to&nbsp;me,&nbsp;except&nbsp;for&nbsp;the&nbsp;FD_SET(...)&nbsp;line&nbsp;which&nbsp;seems&nbsp;to&nbsp;have&nbsp;an&nbsp;extra&nbsp;)&nbsp;after&nbsp;the&nbsp;sock&nbsp;variable.&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;would&nbsp;uncomment&nbsp;the&nbsp;line&nbsp;you&nbsp;have&nbsp;commented.&nbsp;Its&nbsp;likely&nbsp;that&nbsp;if&nbsp;you&nbsp;run&nbsp;this&nbsp;program&nbsp;after&nbsp;amqp_producer.c&nbsp;program,&nbsp;that&nbsp;a&nbsp;frame&nbsp;or&nbsp;two&nbsp;is&nbsp;cached&nbsp;and&nbsp;that&nbsp;the&nbsp;result&nbsp;of&nbsp;amqp_frames_enqueued()&nbsp;is&nbsp;returning&nbsp;true&lt;br&gt;<br>
&lt;br&gt;Also&nbsp;check&nbsp;with&nbsp;the&nbsp;management&nbsp;plugin&nbsp;see&nbsp;if&nbsp;there&nbsp;is&nbsp;a&nbsp;message&nbsp;in&nbsp;the&nbsp;queue&nbsp;ready&nbsp;to&nbsp;be&nbsp;consumed.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;-Alan&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Thu,&nbsp;Feb&nbsp;16,&nbsp;2012&nbsp;at&nbsp;1:08&nbsp;PM,&nbsp;Brett&nbsp;Cameron&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:brett.r.cameron@gmail.com&quot;&gt;brett.r.cameron@gmail.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;Arun,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;A&nbsp;couple&nbsp;of&nbsp;random&nbsp;early&nbsp;in&nbsp;the morning pre-caffeine thoughts:&nbsp;is&nbsp;sock&nbsp;set&nbsp;to&nbsp;non-blocking?&nbsp;What&amp;#39;s&nbsp;the&nbsp;errno&nbsp;value&nbsp;after&nbsp;the&nbsp;select()&nbsp;returns?&lt;/div&gt;<br>
&lt;span&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Brett&lt;/div&gt;&lt;/font&gt;&lt;/span&gt;&lt;div&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;div&gt;<br>
&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Fri,&nbsp;Feb&nbsp;17,&nbsp;2012&nbsp;at&nbsp;6:14&nbsp;AM,&nbsp;Arun&nbsp;Chandrasekaran&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:visionofarun@gmail.com&quot;&nbsp;target=&quot;_blank&quot;&gt;visionofarun@gmail.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
<br>
Thanks&nbsp;for&nbsp;reply&nbsp;Alan.&lt;br&gt;&lt;br&gt;I&nbsp;modified&nbsp;the&nbsp;amqp_consumer.c&nbsp;sample&nbsp;code&nbsp;to&nbsp;simulate&nbsp;the&nbsp;non-blocking&nbsp;behaviour&nbsp;as&nbsp;you&nbsp;mentioned.&lt;br&gt;&lt;br&gt;&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;   &nbsp;/*&nbsp;if&nbsp;(!amqp_frames_enqueued(conn)&nbsp;&amp;amp;&amp;amp;&nbsp;!amqp_data_in_buffer(conn))&nbsp;{&nbsp;*/&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;<br>
<br>
<br>
&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;   &nbsp;if&nbsp;(1)&nbsp;{&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;      &nbsp;int&nbsp;sock&nbsp;=&nbsp;amqp_get_sockfd(conn);&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;<br>
<br>
<br>
&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;      &nbsp;printf(&amp;quot;socket:&nbsp;%d\n&amp;quot;,&nbsp;sock);&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;      &nbsp;/*&nbsp;Watch&nbsp;socket&nbsp;fd&nbsp;to&nbsp;see&nbsp;when&nbsp;it&nbsp;has&nbsp;input.&nbsp;*/&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;<br>
<br>
<br>
&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;      &nbsp;fd_set&nbsp;read_flags;&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;      &nbsp;FD_ZERO(&amp;amp;read_flags);&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;<br>
<br>
<br>
&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;      &nbsp;FD_SET(sock),&nbsp;&amp;amp;read_flags);&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;      &nbsp;int&nbsp;ret&nbsp;=&nbsp;0;&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;<br>
<br>
<br>
&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;      &nbsp;do&nbsp;{&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;         &nbsp;struct&nbsp;timeval&nbsp;timeout;&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;<br>
<br>
<br>
&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;         &nbsp;/*&nbsp;Wait&nbsp;upto&nbsp;a&nbsp;second.&nbsp;*/&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;         &nbsp;timeout.tv_sec&nbsp;=&nbsp;1;&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;<br>
<br>
<br>
&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;         &nbsp;timeout.tv_usec&nbsp;=&nbsp;0;&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;         &nbsp;ret&nbsp;=&nbsp;select(sock+1,&nbsp;&amp;amp;read_flags,&nbsp;NULL,&nbsp;NULL,&nbsp;&amp;amp;timeout);&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;<br>
<br>
<br>
&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;         &nbsp;if&nbsp;(ret&nbsp;==&nbsp;-1)&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;            &nbsp;printf(&amp;quot;select:&nbsp;%s\n&amp;quot;,&nbsp;strerror(errno));&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;<br>
<br>
<br>
&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;         &nbsp;else&nbsp;if&nbsp;(ret&nbsp;==&nbsp;0)&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;            &nbsp;printf(&amp;quot;select&nbsp;timedout\n&amp;quot;);&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;<br>
<br>
<br>
&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;         &nbsp;if&nbsp;(FD_ISSET(sock,&nbsp;&amp;amp;read_flags))&nbsp;{&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;            &nbsp;printf(&amp;quot;Flag&nbsp;is&nbsp;set\n&amp;quot;);&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;<br>
<br>
<br>
&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;         &nbsp;}&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;      &nbsp;}&nbsp;while&nbsp;(ret&nbsp;==&nbsp;0);&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;<br>
<br>
<br>
&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;   &nbsp;}&lt;/span&gt;&lt;br&gt;&lt;br&gt;But&nbsp;this&nbsp;always&nbsp;results&nbsp;in&nbsp;a&nbsp;timeout.&nbsp;Any&nbsp;idea&nbsp;where&nbsp;I&nbsp;might&nbsp;be&nbsp;going&nbsp;wrong?&nbsp;I&nbsp;have&nbsp;commented&nbsp;the&nbsp;first&nbsp;two&nbsp;checks&nbsp;that&nbsp;you&nbsp;mentioned&nbsp;just&nbsp;for&nbsp;sake&nbsp;of&nbsp;clarity&nbsp;on&nbsp;select().&lt;span&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;&lt;br&gt;<br>
<br>
<br>
&lt;br&gt;-Arun&lt;br&gt;<br>
&lt;/font&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
