<tt>
Thanks&nbsp;for&nbsp;reply&nbsp;Alan.&lt;br&gt;&lt;br&gt;I&nbsp;modified&nbsp;the&nbsp;amqp_consumer.c&nbsp;sample&nbsp;code&nbsp;to&nbsp;simulate&nbsp;the&nbsp;non-blocking&nbsp;behaviour&nbsp;as&nbsp;you&nbsp;mentioned.&lt;br&gt;&lt;br&gt;&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;   &nbsp;/*&nbsp;if&nbsp;(!amqp_frames_enqueued(conn)&nbsp;&amp;amp;&amp;amp;&nbsp;!amqp_data_in_buffer(conn))&nbsp;{&nbsp;*/&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;<br>
&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;   &nbsp;if&nbsp;(1)&nbsp;{&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;      &nbsp;int&nbsp;sock&nbsp;=&nbsp;amqp_get_sockfd(conn);&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;<br>
&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;      &nbsp;printf(&amp;quot;socket:&nbsp;%d\n&amp;quot;,&nbsp;sock);&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;      &nbsp;/*&nbsp;Watch&nbsp;socket&nbsp;fd&nbsp;to&nbsp;see&nbsp;when&nbsp;it&nbsp;has&nbsp;input.&nbsp;*/&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;<br>
&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;      &nbsp;fd_set&nbsp;read_flags;&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;      &nbsp;FD_ZERO(&amp;amp;read_flags);&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;<br>
&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;      &nbsp;FD_SET(sock),&nbsp;&amp;amp;read_flags);&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;      &nbsp;int&nbsp;ret&nbsp;=&nbsp;0;&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;<br>
&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;      &nbsp;do&nbsp;{&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;         &nbsp;struct&nbsp;timeval&nbsp;timeout;&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;<br>
&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;         &nbsp;/*&nbsp;Wait&nbsp;upto&nbsp;a&nbsp;second.&nbsp;*/&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;         &nbsp;timeout.tv_sec&nbsp;=&nbsp;1;&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;<br>
&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;         &nbsp;timeout.tv_usec&nbsp;=&nbsp;0;&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;         &nbsp;ret&nbsp;=&nbsp;select(sock+1,&nbsp;&amp;amp;read_flags,&nbsp;NULL,&nbsp;NULL,&nbsp;&amp;amp;timeout);&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;<br>
&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;         &nbsp;if&nbsp;(ret&nbsp;==&nbsp;-1)&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;            &nbsp;printf(&amp;quot;select:&nbsp;%s\n&amp;quot;,&nbsp;strerror(errno));&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;<br>
&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;         &nbsp;else&nbsp;if&nbsp;(ret&nbsp;==&nbsp;0)&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;            &nbsp;printf(&amp;quot;select&nbsp;timedout\n&amp;quot;);&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;<br>
&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;         &nbsp;if&nbsp;(FD_ISSET(sock,&nbsp;&amp;amp;read_flags))&nbsp;{&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;            &nbsp;printf(&amp;quot;Flag&nbsp;is&nbsp;set\n&amp;quot;);&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;<br>
&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;         &nbsp;}&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;      &nbsp;}&nbsp;while&nbsp;(ret&nbsp;==&nbsp;0);&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;<br>
&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;   &nbsp;}&lt;/span&gt;&lt;br&gt;&lt;br&gt;But&nbsp;this&nbsp;always&nbsp;results&nbsp;in&nbsp;a&nbsp;timeout.&nbsp;Any&nbsp;idea&nbsp;where&nbsp;I&nbsp;might&nbsp;be&nbsp;going&nbsp;wrong?&nbsp;I&nbsp;have&nbsp;commented&nbsp;the&nbsp;first&nbsp;two&nbsp;checks&nbsp;that&nbsp;you&nbsp;mentioned&nbsp;just&nbsp;for&nbsp;sake&nbsp;of&nbsp;clarity&nbsp;on&nbsp;select().&lt;br&gt;<br>
&lt;br&gt;-Arun&lt;br&gt;<br>

</tt>
