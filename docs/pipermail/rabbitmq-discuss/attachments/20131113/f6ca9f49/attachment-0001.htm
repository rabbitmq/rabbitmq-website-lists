<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi&nbsp;Emile,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Firstly,&nbsp;thanks&nbsp;for&nbsp;the&nbsp;reply&nbsp;and&nbsp;for&nbsp;raising&nbsp;the&nbsp;priority&nbsp;of&nbsp;this&nbsp;feature.&nbsp;I&nbsp;am&nbsp;sure&nbsp;it&nbsp;won&amp;#39;t&nbsp;only&nbsp;be&nbsp;us&nbsp;that&nbsp;will&nbsp;appreciate&nbsp;this.&nbsp;:)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;totally&nbsp;understand&nbsp;that&nbsp;doing&nbsp;a&nbsp;&amp;#39;proper&amp;#39;&nbsp;implementation&nbsp;of&nbsp;toxic&nbsp;message&nbsp;handling&nbsp;is&nbsp;a&nbsp;complex&nbsp;task&nbsp;and&nbsp;would&nbsp;not&nbsp;be&nbsp;suitable&nbsp;for&nbsp;a&nbsp;plugin.&nbsp;What&nbsp;I&nbsp;am&nbsp;after&nbsp;is&nbsp;something&nbsp;that&nbsp;would&nbsp;satisfy&nbsp;our&nbsp;system&nbsp;specific&nbsp;requirements&nbsp;in&nbsp;the&nbsp;meantime.&nbsp;The&nbsp;idea&nbsp;I&nbsp;had&nbsp;was&nbsp;to&nbsp;simply&nbsp;plug&nbsp;something&nbsp;into&nbsp;the&nbsp;channel&nbsp;deliver/redeliver&nbsp;function&nbsp;to&nbsp;add&nbsp;/&nbsp;increment&nbsp;a&nbsp;custom&nbsp;header&nbsp;value&nbsp;that&nbsp;we&nbsp;could&nbsp;later&nbsp;inspect&nbsp;in&nbsp;the&nbsp;consumers.&nbsp;This&nbsp;value&nbsp;doesn&amp;#39;t&nbsp;even&nbsp;have&nbsp;to&nbsp;be&nbsp;very&nbsp;accurate&nbsp;(e.g.&nbsp;taking&nbsp;replication&nbsp;/&nbsp;failover&nbsp;into&nbsp;account).&nbsp;All&nbsp;we&nbsp;want&nbsp;to&nbsp;achieve&nbsp;is&nbsp;to&nbsp;have&nbsp;some&nbsp;indication&nbsp;of&nbsp;a&nbsp;message&nbsp;being&nbsp;one&nbsp;that&nbsp;has&nbsp;been&nbsp;redelivered&nbsp;multiple&nbsp;times&nbsp;and&nbsp;then&nbsp;take&nbsp;some&nbsp;action&nbsp;based&nbsp;on&nbsp;that. &lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Is&nbsp;it&nbsp;technically&nbsp;possible&nbsp;to&nbsp;do&nbsp;this&nbsp;using&nbsp;the&nbsp;plugin&nbsp;architecture?&nbsp;If&nbsp;so,&nbsp;I&amp;#39;d&nbsp;appreciate&nbsp;any&nbsp;pointers&nbsp;of&nbsp;as&nbsp;to&nbsp;how. &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Using&nbsp;multiple&nbsp;queues&nbsp;is&nbsp;an&nbsp;additional&nbsp;complexity&nbsp;that&nbsp;I&amp;#39;d&nbsp;like&nbsp;to&nbsp;try&nbsp;to&nbsp;avoid&nbsp;as&nbsp;long&nbsp;as&nbsp;possible.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Karl&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;13&nbsp;November&nbsp;2013&nbsp;12:18,&nbsp;Emile&nbsp;Joubert&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:emile@rabbitmq.com&quot;&nbsp;target=&quot;_blank&quot;&gt;emile@rabbitmq.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;br&gt;<br>
Hi,&lt;br&gt;<br>
&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
On&nbsp;13/11/13&nbsp;11:55,&nbsp;Karl&nbsp;Nilsson&nbsp;wrote:&lt;br&gt;<br>
&lt;br&gt;<br>
&amp;gt;&nbsp;I&nbsp;know&nbsp;there&nbsp;is&nbsp;a&nbsp;planned&nbsp;feature&nbsp;for&nbsp;this&nbsp;(basic&nbsp;/&nbsp;deliver&nbsp;/&nbsp;01)&nbsp;but&nbsp;I&lt;br&gt;<br>
&amp;gt;&nbsp;checked&nbsp;with&nbsp;Alvaro&nbsp;who&nbsp;has&nbsp;confirmed&nbsp;it&nbsp;isn&amp;#39;t&nbsp;a&nbsp;priority&nbsp;at&nbsp;this&nbsp;time&lt;br&gt;<br>
&amp;gt;&nbsp;so&nbsp;we&nbsp;could&nbsp;do&nbsp;with&nbsp;some&nbsp;kind&nbsp;of&nbsp;half-way&nbsp;house&nbsp;in&nbsp;the&nbsp;meantime.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;The&nbsp;priority&nbsp;of&nbsp;this&nbsp;feature&nbsp;has&nbsp;just&nbsp;raised&nbsp;because&nbsp;it&nbsp;is&nbsp;determined&nbsp;in&lt;br&gt;<br>
part&nbsp;by&nbsp;demand.&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;complete&nbsp;implementation&nbsp;of&nbsp;toxic&nbsp;message&nbsp;handling&nbsp;is&nbsp;complicated&nbsp;by&lt;br&gt;<br>
the&nbsp;need&nbsp;for&nbsp;on-disk&nbsp;representations&nbsp;to&nbsp;change&nbsp;in&nbsp;order&nbsp;to&nbsp;accommodate&lt;br&gt;<br>
the&nbsp;counter&nbsp;information.&nbsp;Maintaining&nbsp;the&nbsp;counter&nbsp;in&nbsp;RAM&nbsp;is&nbsp;not&nbsp;an&nbsp;option&lt;br&gt;<br>
since&nbsp;the&nbsp;redelivery&nbsp;information&nbsp;could&nbsp;be&nbsp;unbounded.&lt;br&gt;<br>
&lt;br&gt;<br>
This&nbsp;feature&nbsp;would&nbsp;need&nbsp;to&nbsp;modify&nbsp;and&nbsp;interact&nbsp;with&nbsp;multiple&nbsp;broker&lt;br&gt;<br>
subsystems,&nbsp;so&nbsp;not&nbsp;the&nbsp;ideal&nbsp;for&nbsp;a&nbsp;plugin.&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;best&nbsp;alternative&nbsp;at&nbsp;present&nbsp;is&nbsp;to&nbsp;use&nbsp;the&nbsp;redelivery&nbsp;flag&nbsp;as&nbsp;an&lt;br&gt;<br>
indicator&nbsp;that&nbsp;a&nbsp;message&nbsp;may&nbsp;be&nbsp;suspect.&nbsp;It&nbsp;is&nbsp;possible&nbsp;to&nbsp;extend&nbsp;the&lt;br&gt;<br>
utility&nbsp;of&nbsp;the&nbsp;redelivery&nbsp;flag&nbsp;slightly&nbsp;by&nbsp;republishing&nbsp;redelivered&lt;br&gt;<br>
messages&nbsp;to&nbsp;a&nbsp;separate&nbsp;queue&nbsp;for&nbsp;high-risk&nbsp;messages.&nbsp;If&nbsp;messages&nbsp;from&lt;br&gt;<br>
the&nbsp;high-disk&nbsp;queue&nbsp;again&nbsp;have&nbsp;the&nbsp;redelivery&nbsp;flag&nbsp;set&nbsp;then&nbsp;the&nbsp;message&lt;br&gt;<br>
is&nbsp;probably&nbsp;toxic&nbsp;and&nbsp;should&nbsp;be&nbsp;handled&nbsp;as&nbsp;an&nbsp;exception.&lt;br&gt;<br>
&lt;span&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
-Emile&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/font&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;--&nbsp;&lt;br&gt;&lt;b&gt;Karl&nbsp;Nilsson&lt;/b&gt;&lt;div&gt;twitter:&nbsp;@kjnilsson&lt;/div&gt;&lt;div&gt;blog: &lt;a&nbsp;href=&quot;http://coderkarl.wordpress.com/&quot;&nbsp;target=&quot;_blank&quot;&gt;coderkarl.wordpress.com&lt;/a&gt;&lt;/div&gt;<br>
<br>
&lt;/div&gt;<br>

</tt>
