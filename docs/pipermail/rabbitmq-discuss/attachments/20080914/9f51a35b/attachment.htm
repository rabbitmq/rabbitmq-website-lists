<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi&nbsp;Ben,&lt;br&gt;&lt;br&gt;Actually,&nbsp;we&nbsp;have&nbsp;a&nbsp;bit&nbsp;of&nbsp;a&nbsp;different&nbsp;use&nbsp;case.&nbsp;Our&nbsp;company&nbsp;(my&nbsp;client,&nbsp;as&nbsp;it&nbsp;were)&nbsp;provides&nbsp;SMS&nbsp;aggregation&nbsp;services.&nbsp;Essentially,&nbsp;we&nbsp;provide&nbsp;a&nbsp;unified&nbsp;interface&nbsp;for&nbsp;SMS,&nbsp;MMS,&nbsp;USSD&nbsp;and&nbsp;other&nbsp;types&nbsp;of&nbsp;messages&nbsp;on&nbsp;behalf&nbsp;of&nbsp;our&nbsp;customers,&nbsp;who&nbsp;are&nbsp;content&nbsp;providers.&nbsp;The&nbsp;main&nbsp;value&nbsp;add&nbsp;is&nbsp;that&nbsp;they&nbsp;only&nbsp;have&nbsp;to&nbsp;deal&nbsp;with&nbsp;us&nbsp;and&nbsp;our&nbsp;interface,&nbsp;and&nbsp;not&nbsp;the&nbsp;interfaces&nbsp;of&nbsp;multiple&nbsp;cellular&nbsp;companies.&nbsp;Without&nbsp;disclosing&nbsp;confidential&nbsp;information,&nbsp;I&nbsp;can&nbsp;tell&nbsp;you&nbsp;that&nbsp;the&nbsp;way&nbsp;it&nbsp;works&nbsp;is&nbsp;as&nbsp;follows:&lt;br&gt;<br>
&lt;ol&gt;&lt;li&gt;SMS&nbsp;and&nbsp;other&nbsp;kinds&nbsp;of&nbsp;messages&nbsp;(MMS,&nbsp;USSD,&nbsp;and&nbsp;others)&nbsp;sent&nbsp;by&nbsp;the&nbsp;content&nbsp;providers&nbsp;(i.e.&nbsp;MT&nbsp;messages,&nbsp;not&nbsp;from&nbsp;cell&nbsp;phones)&nbsp;arrive&nbsp;at&nbsp;a&nbsp;non-Erlang&nbsp;front&nbsp;end&nbsp;where&nbsp;they&nbsp;are&nbsp;captured&nbsp;into&nbsp;a&nbsp;database.&lt;/li&gt;&lt;li&gt;The&nbsp;messages&nbsp;are&nbsp;forwarded&nbsp;to&nbsp;the&nbsp;appropriate&nbsp;cell&nbsp;phone&nbsp;companies.&lt;/li&gt;<br>
&lt;li&gt;At&nbsp;the&nbsp;same&nbsp;time,&nbsp;MO&nbsp;messages&nbsp;are&nbsp;sent&nbsp;from&nbsp;the&nbsp;cell&nbsp;phone&nbsp;companies&nbsp;which&nbsp;are&nbsp;destined&nbsp;for&nbsp;the&nbsp;content&nbsp;providers&nbsp;(our&nbsp;customers).&nbsp;These&nbsp;MO&nbsp;messages&nbsp;go&nbsp;thought&nbsp;the&nbsp;Erlang&nbsp;portion&nbsp;of&nbsp;the&nbsp;system.&lt;br&gt;&lt;/li&gt;&lt;li&gt;Status&nbsp;notifications&nbsp;are&nbsp;also&nbsp;sent&nbsp;to&nbsp;the&nbsp;Erlang&nbsp;portion&nbsp;of&nbsp;the&nbsp;system&nbsp;as&nbsp;the&nbsp;messages&nbsp;go&nbsp;through&nbsp;various&nbsp;processing&nbsp;states&nbsp;(e.g.&nbsp;Queued,&nbsp;Acknowledged,&nbsp;Delivered,&nbsp;Failed&nbsp;etc).&lt;/li&gt;<br>
&lt;li&gt;The&nbsp;front-end&nbsp;sends&nbsp;these&nbsp;status&nbsp;notifications&nbsp;as&nbsp;fast&nbsp;as&nbsp;the&nbsp;Erlang&nbsp;back-end&nbsp;can&nbsp;take&nbsp;them.&nbsp;The&nbsp;back&nbsp;end&nbsp;then&nbsp;splits&nbsp;the&nbsp;messages&nbsp;into&nbsp;multiple&nbsp;RabbitMQ&nbsp;queues&nbsp;based&nbsp;on&nbsp;content&nbsp;and&nbsp;provider&nbsp;(e.g.&nbsp;SMS&nbsp;for&nbsp;company&nbsp;X&nbsp;goes&nbsp;to&nbsp;one&nbsp;queue,&nbsp;while&nbsp;MMS&nbsp;for&nbsp;company&nbsp;Y&nbsp;will&nbsp;go&nbsp;to&nbsp;another).&nbsp;Each&nbsp;queue&nbsp;has&nbsp;a&nbsp;consumer&nbsp;that&nbsp;delivers&nbsp;the&nbsp;status&nbsp;messages&nbsp;to&nbsp;a&nbsp;content-provider&amp;#39;s&nbsp;web&nbsp;site\URL.&nbsp;The&nbsp;status&nbsp;notifications&nbsp;are&nbsp;essentially&nbsp;the&nbsp;final&nbsp;step&nbsp;in&nbsp;the&nbsp;process,&nbsp;confirming&nbsp;what&nbsp;the&nbsp;content&nbsp;provider&nbsp;initially&nbsp;sent.&nbsp;It&nbsp;is&nbsp;necessary&nbsp;to&nbsp;split&nbsp;the&nbsp;initial&nbsp;transmission&nbsp;from&nbsp;the&nbsp;status&nbsp;messages&nbsp;like&nbsp;this&nbsp;because&nbsp;delivery&nbsp;could&nbsp;take&nbsp;minutes&nbsp;or&nbsp;hours&nbsp;in&nbsp;some&nbsp;cases,&nbsp;and&nbsp;the&nbsp;sender&nbsp;can&amp;#39;t&nbsp;wait&nbsp;around&nbsp;for&nbsp;that&nbsp;long&nbsp;to&nbsp;get&nbsp;a&nbsp;response.&nbsp;So&nbsp;the&nbsp;request&nbsp;is&nbsp;sent&nbsp;in&nbsp;one&nbsp;operation&nbsp;to&nbsp;us,&nbsp;and&nbsp;the&nbsp;actual&nbsp;response&nbsp;is&nbsp;sent&nbsp;in&nbsp;a&nbsp;separate&nbsp;operation&nbsp;back&nbsp;to&nbsp;them.&lt;br&gt;<br>
&lt;/li&gt;&lt;li&gt;The&nbsp;rationale&nbsp;behind&nbsp;having&nbsp;queues&nbsp;like&nbsp;this&nbsp;is&nbsp;to&nbsp;avoid&nbsp;a&nbsp;bottleneck&nbsp;where,&nbsp;if&nbsp;there&nbsp;was&nbsp;just&nbsp;one&nbsp;delivery&nbsp;process&nbsp;and&nbsp;a&nbsp;URL&nbsp;choked&nbsp;up,&nbsp;all&nbsp;deliveries&nbsp;would&nbsp;be&nbsp;held&nbsp;back&nbsp;unnecessarily.&lt;/li&gt;&lt;li&gt;If&nbsp;one&nbsp;of&nbsp;the&nbsp;URLs&nbsp;is&nbsp;offline,&nbsp;or&nbsp;incorrectly&nbsp;specified,&nbsp;the&nbsp;associated&nbsp;queue&nbsp;will&nbsp;build&nbsp;up&nbsp;persistent&nbsp;messages&nbsp;until&nbsp;the&nbsp;situation&nbsp;is&nbsp;rectified.&nbsp;This&nbsp;is&nbsp;where&nbsp;the&nbsp;scenario&nbsp;we&nbsp;discussed&nbsp;could&nbsp;come&nbsp;into&nbsp;play.&nbsp;Where&nbsp;the&nbsp;real&nbsp;problem&nbsp;comes&nbsp;in&nbsp;is&nbsp;that&nbsp;sometimes&nbsp;a&nbsp;client&nbsp;will&nbsp;send&nbsp;a&nbsp;batch&nbsp;of&nbsp;a&nbsp;few&nbsp;hundred&nbsp;thousand&nbsp;messages.&nbsp;Ideally,&nbsp;this&nbsp;batch&nbsp;would&nbsp;be&nbsp;queued&nbsp;up&nbsp;by&nbsp;Rabbit&nbsp;and&nbsp;drained&nbsp;as&nbsp;the&nbsp;system&nbsp;is&nbsp;able&nbsp;to&nbsp;process&nbsp;the&nbsp;load.&nbsp;It&nbsp;may&nbsp;even&nbsp;be&nbsp;kept&nbsp;for&nbsp;off-peak&nbsp;times.&lt;/li&gt;<br>
&lt;li&gt;I&nbsp;was&nbsp;hoping&nbsp;that&nbsp;I&nbsp;could&nbsp;use&nbsp;Rabbit&nbsp;the&nbsp;way&nbsp;I&nbsp;used&nbsp;to&nbsp;use&nbsp;MQ,&nbsp;which&nbsp;is&nbsp;as&nbsp;a&nbsp;database-backed&nbsp;queue.&nbsp;Now&nbsp;that&nbsp;I&nbsp;understand&nbsp;I&nbsp;cannot,&nbsp;I&nbsp;must&nbsp;make&nbsp;other&nbsp;design&nbsp;decisions.&nbsp;The&nbsp;batches,&nbsp;for&nbsp;example,&nbsp;will&nbsp;have&nbsp;to&nbsp;be&nbsp;stored&nbsp;in&nbsp;files&nbsp;or&nbsp;database,&nbsp;and&nbsp;trickled&nbsp;into&nbsp;the&nbsp;system&nbsp;at&nbsp;the&nbsp;correct&nbsp;rate.&nbsp;Now&nbsp;here&nbsp;is&nbsp;the&nbsp;second&nbsp;kicker:&nbsp;without&nbsp;any&nbsp;flow&nbsp;control,&nbsp;it&nbsp;is&nbsp;not&nbsp;trivial&nbsp;to&nbsp;figure&nbsp;out&nbsp;what&nbsp;the&nbsp;optimum&nbsp;rate&nbsp;is.&nbsp;Too&nbsp;slow,&nbsp;and&nbsp;the&nbsp;batch&nbsp;does&nbsp;not&nbsp;compete&nbsp;quickly&nbsp;enough.&nbsp;Too&nbsp;fast,&nbsp;and&nbsp;I&nbsp;risk&nbsp;excessive&nbsp;loading&nbsp;the&nbsp;Rabbit&nbsp;node&amp;#39;s&nbsp;memory.&lt;/li&gt;<br>
&lt;li&gt;Distributing&nbsp;the&nbsp;load&nbsp;across&nbsp;multiple&nbsp;Rabbit&nbsp;nodes&nbsp;may&nbsp;solve&nbsp;individual&nbsp;node&amp;#39;s&nbsp;memory&nbsp;issues,&nbsp;but&nbsp;will&nbsp;place&nbsp;more&nbsp;pressure&nbsp;on&nbsp;the&nbsp;overall&nbsp;system&amp;#39;s&nbsp;memory&nbsp;load.&nbsp;This&nbsp;will&nbsp;have&nbsp;cost&nbsp;implications&nbsp;because&nbsp;additional&nbsp;hardware&nbsp;will&nbsp;need&nbsp;to&nbsp;be&nbsp;purchased,&nbsp;and&nbsp;additional&nbsp;complexity&nbsp;added&nbsp;to&nbsp;distribute&nbsp;traffic&nbsp;to,&nbsp;and&nbsp;manage&nbsp;and&nbsp;monitor,&nbsp;the&nbsp;additional&nbsp;nodes.&nbsp;Sure,&nbsp;we&nbsp;have&nbsp;os-mon&nbsp;and&nbsp;SNMP&nbsp;and&nbsp;all&nbsp;that,&nbsp;but&nbsp;it&nbsp;has&nbsp;to&nbsp;be&nbsp;set&nbsp;up&nbsp;and&nbsp;configured,&nbsp;and&nbsp;ultimately&nbsp;someone&nbsp;has&nbsp;to&nbsp;sit&nbsp;and&nbsp;watch&nbsp;that.&nbsp;With&nbsp;more&nbsp;nodes,&nbsp;it&nbsp;just&nbsp;becomes&nbsp;more&nbsp;of&nbsp;an&nbsp;administrative&nbsp;burden,&nbsp;especially&nbsp;if&nbsp;traffic-wise,&nbsp;a&nbsp;single&nbsp;node&nbsp;would&nbsp;do&nbsp;the&nbsp;job&nbsp;just&nbsp;fine,&nbsp;but&nbsp;because&nbsp;of&nbsp;implementation-specific&nbsp;behavior,&nbsp;it&nbsp;will&nbsp;not&nbsp;be&nbsp;good&nbsp;enough&nbsp;without&nbsp;incurring&nbsp;some&nbsp;risk.&lt;/li&gt;<br>
&lt;li&gt;The&nbsp;bottom&nbsp;line&nbsp;is,&nbsp;having&nbsp;all&nbsp;the&nbsp;persistent&nbsp;data&nbsp;needing&nbsp;to&nbsp;be&nbsp;in&nbsp;memory&nbsp;is&nbsp;a&nbsp;regrettable&nbsp;situation&nbsp;for&nbsp;the&nbsp;reasons&nbsp;outlined&nbsp;above,&nbsp;a&nbsp;situation&nbsp;which&nbsp;I&nbsp;accept,&nbsp;but&nbsp;the&nbsp;consequences&nbsp;of&nbsp;which&nbsp;I&nbsp;wish&nbsp;you,&nbsp;the&nbsp;developers,&nbsp;to&nbsp;be&nbsp;fully&nbsp;aware;&nbsp;not&nbsp;to&nbsp;feel&nbsp;bad&nbsp;or&nbsp;be&nbsp;beaten&nbsp;up,&nbsp;but&nbsp;simply&nbsp;to&nbsp;know&nbsp;and&nbsp;to&nbsp;use&nbsp;in&nbsp;decision-making&nbsp;processes&nbsp;as&nbsp;appropriate.&lt;br&gt;<br>
&lt;/li&gt;&lt;/ol&gt;Thanks&nbsp;for&nbsp;your&nbsp;time.&nbsp;I&nbsp;hope&nbsp;the&nbsp;above&nbsp;information&nbsp;gives&nbsp;you&nbsp;a&nbsp;better&nbsp;feel&nbsp;for&nbsp;what&nbsp;I&nbsp;am&nbsp;trying&nbsp;to&nbsp;achieve,&nbsp;and&nbsp;perhaps&nbsp;will&nbsp;generate&nbsp;some&nbsp;more&nbsp;useful&nbsp;thoughts&nbsp;about&nbsp;how&nbsp;I&nbsp;can&nbsp;do&nbsp;so&nbsp;using&nbsp;your&nbsp;very&nbsp;excellent&nbsp;product&nbsp;(which&nbsp;I&nbsp;am&nbsp;committed&nbsp;to&nbsp;using,&nbsp;by&nbsp;the&nbsp;way).&lt;br&gt;<br>
&lt;br&gt;Best&nbsp;regards,&lt;br&gt;Edwin&nbsp;Fine&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Sun,&nbsp;Sep&nbsp;14,&nbsp;2008&nbsp;at&nbsp;7:05&nbsp;AM,&nbsp;Ben&nbsp;Hood&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:0x6e6562@gmail.com&quot;&gt;0x6e6562@gmail.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
Alexis,&lt;br&gt;<br>
&lt;div&nbsp;class=&quot;Ih2E3d&quot;&gt;&lt;br&gt;<br>
On&nbsp;Sat,&nbsp;Sep&nbsp;13,&nbsp;2008&nbsp;at&nbsp;10:07&nbsp;AM,&nbsp;Alexis&nbsp;Richardson&lt;br&gt;<br>
&amp;lt;&lt;a&nbsp;href=&quot;mailto:alexis.richardson@cohesiveft.com&quot;&gt;alexis.richardson@cohesiveft.com&lt;/a&gt;&amp;gt;&nbsp;wrote:&lt;br&gt;<br>
&amp;gt;&nbsp;Note&nbsp;that&nbsp;case&nbsp;(a)&nbsp;is&nbsp;solved&nbsp;by&nbsp;2&nbsp;above.&nbsp;&amp;nbsp;Add&nbsp;more&nbsp;nodes.&nbsp;&amp;nbsp;How&nbsp;often&nbsp;would&nbsp;you&lt;br&gt;<br>
&amp;gt;&nbsp;have&nbsp;to&nbsp;add&nbsp;more&nbsp;nodes?&nbsp;&amp;nbsp;Due&nbsp;to&nbsp;1,&nbsp;you&nbsp;can&nbsp;work&nbsp;this&nbsp;out&nbsp;based&nbsp;on&nbsp;your&nbsp;message&lt;br&gt;<br>
&amp;gt;&nbsp;size.&nbsp;&amp;nbsp;For&nbsp;almost&nbsp;all&nbsp;use&nbsp;cases&nbsp;the&nbsp;consumers&nbsp;will&nbsp;have&nbsp;to&nbsp;lag&lt;br&gt;<br>
&amp;gt;&nbsp;producers&nbsp;by&nbsp;several&lt;br&gt;<br>
&amp;gt;&nbsp;days.&nbsp;&amp;nbsp;Think&nbsp;about&nbsp;it.&nbsp;&amp;nbsp;And&nbsp;don&amp;#39;t&nbsp;forget&nbsp;you&nbsp;can&nbsp;add&nbsp;more&nbsp;consumers.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;Good&nbsp;point.&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;main&nbsp;reason&nbsp;why&nbsp;I&nbsp;asked&nbsp;Edwin&nbsp;about&nbsp;his&nbsp;realsitic&nbsp;expectations&lt;br&gt;<br>
surrounding&nbsp;volumetrics&nbsp;was&nbsp;to&nbsp;find&nbsp;out&nbsp;what&nbsp;the&nbsp;breaking&nbsp;point&nbsp;was&lt;br&gt;<br>
for&nbsp;a&nbsp;simple&nbsp;OTS&nbsp;Rabbit&nbsp;installation&nbsp;to&nbsp;do&nbsp;a&nbsp;*very*&nbsp;naive&nbsp;reality&lt;br&gt;<br>
check.&lt;br&gt;<br>
&lt;br&gt;<br>
So&nbsp;in&nbsp;the&nbsp;absense&nbsp;of&nbsp;better&nbsp;knowledge,&nbsp;I&nbsp;just&nbsp;thought&nbsp;to&nbsp;myself&nbsp;that&lt;br&gt;<br>
an&nbsp;SMS&nbsp;is&nbsp;roughly&nbsp;160&nbsp;bytes&nbsp;long&nbsp;(160&nbsp;chars&nbsp;with&nbsp;an&nbsp;encoding&nbsp;that&nbsp;is&lt;br&gt;<br>
something&nbsp;less&nbsp;than&nbsp;8&nbsp;bit/char&nbsp;plus&nbsp;some&nbsp;routing&nbsp;headers)&nbsp;and&nbsp;just&lt;br&gt;<br>
created&nbsp;an&nbsp;infinite&nbsp;loop&nbsp;to&nbsp;publish&nbsp;them.&nbsp;A&nbsp;sinlge&nbsp;instance&nbsp;of&nbsp;Rabbit&lt;br&gt;<br>
got&nbsp;overfed&nbsp;after&nbsp;publishing&nbsp;2.5&nbsp;million&nbsp;of&nbsp;these&nbsp;messages&nbsp;(on&nbsp;a&lt;br&gt;<br>
simple&nbsp;pizzabox&nbsp;setup).&lt;br&gt;<br>
&lt;br&gt;<br>
So&nbsp;under&nbsp;the&nbsp;assumption&nbsp;that&nbsp;you&nbsp;may&nbsp;also&nbsp;use&nbsp;more&nbsp;than&nbsp;one&nbsp;logical&lt;br&gt;<br>
queue&nbsp;(by&nbsp;way&nbsp;of&nbsp;natural&nbsp;application&nbsp;partitioning),&nbsp;you&nbsp;may&nbsp;be&lt;br&gt;<br>
spreading&nbsp;the&nbsp;total&nbsp;system&nbsp;load&nbsp;over&nbsp;multiple&nbsp;queues&nbsp;that&nbsp;reside&nbsp;in&lt;br&gt;<br>
memory&nbsp;on&nbsp;different&nbsp;nodes.&lt;br&gt;<br>
&lt;br&gt;<br>
In&nbsp;the&nbsp;degenerate&nbsp;case&nbsp;that&nbsp;you&nbsp;send&nbsp;1&nbsp;million&nbsp;messages&nbsp;per&nbsp;day&nbsp;to&nbsp;a&lt;br&gt;<br>
single&nbsp;instance,&nbsp;you&nbsp;still&nbsp;have&nbsp;a&nbsp;day&nbsp;and&nbsp;a&nbsp;bit&nbsp;to&nbsp;find&nbsp;some&nbsp;way&nbsp;to&lt;br&gt;<br>
drain&nbsp;the&nbsp;queues.&nbsp;Presumeably,&nbsp;if&nbsp;no&nbsp;SMS&amp;#39;s&nbsp;were&nbsp;getting&nbsp;delivered&nbsp;to&lt;br&gt;<br>
the&nbsp;downstream&nbsp;consumers&nbsp;over&nbsp;the&nbsp;course&nbsp;of&nbsp;a&nbsp;day,&nbsp;somebody&nbsp;would&lt;br&gt;<br>
start&nbsp;to&nbsp;care&nbsp;about&nbsp;the&nbsp;fact&nbsp;that&nbsp;the&nbsp;system&nbsp;wasn&amp;#39;t&nbsp;actually&nbsp;doing&lt;br&gt;<br>
something.&nbsp;This&nbsp;person&nbsp;would&nbsp;still&nbsp;have&nbsp;a&nbsp;fair&nbsp;amount&nbsp;of&nbsp;time&nbsp;to&nbsp;find&lt;br&gt;<br>
out&nbsp;what&nbsp;is&nbsp;going&nbsp;on&nbsp;and&nbsp;drain&nbsp;the&nbsp;queues&nbsp;before&nbsp;resource&nbsp;consumption&lt;br&gt;<br>
becomes&nbsp;acute.&lt;br&gt;<br>
&lt;font&nbsp;color=&quot;#888888&quot;&gt;&lt;br&gt;<br>
Ben&lt;br&gt;<br>
&lt;/font&gt;&lt;div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;Wj3C7c&quot;&gt;&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
rabbitmq-discuss&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:rabbitmq-discuss@lists.rabbitmq.com&quot;&gt;rabbitmq-discuss@lists.rabbitmq.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
