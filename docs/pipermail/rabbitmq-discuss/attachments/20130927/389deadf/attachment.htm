<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;font&nbsp;size=&quot;2&quot;&gt;Hi,&lt;/font&gt;&lt;div&gt;&lt;font&nbsp;size=&quot;2&quot;&gt;&amp;nbsp;&nbsp;&amp;nbsp;I'm&nbsp;a&nbsp;Rabbit&nbsp;newbie,&nbsp;I&nbsp;use&lt;font&nbsp;color=&quot;#ff0000&quot;&gt;&amp;nbsp;register_confirm_handler/2&amp;nbsp;&lt;/font&gt;to&amp;nbsp;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;font-family:&nbsp;Verdana,&nbsp;Arial,&nbsp;Helvetica,&nbsp;sans-serif;&quot;&gt;register&nbsp;a&nbsp;handler&nbsp;which&nbsp;deals&nbsp;with&nbsp;confirm-related&nbsp;messages,&nbsp;but&nbsp;it&nbsp;didn't&nbsp;receive&nbsp;any&nbsp;acks&nbsp;or&nbsp;nacks.&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;size=&quot;2&quot;&gt;&lt;font&nbsp;color=&quot;#000000&quot;&nbsp;face=&quot;Verdana,&nbsp;Arial,&nbsp;Helvetica,&nbsp;sans-serif&quot;&gt;Then&nbsp;I&nbsp;&amp;nbsp;add&nbsp;&amp;nbsp;code1&amp;nbsp;&lt;/font&gt;after&nbsp;&lt;font&nbsp;color=&quot;#ff0000&quot;&gt;amqp_channel:cast(Channel,&nbsp;Publish,&nbsp;Msg&lt;/font&gt;),&amp;nbsp;It&nbsp;can&nbsp;work.&nbsp;so&nbsp;why?&nbsp;I&nbsp;want&nbsp;to&nbsp;publish&nbsp;msg&amp;nbsp;&lt;/font&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(85,&nbsp;85,&nbsp;85);&nbsp;font-family:&nbsp;Verdana,&nbsp;sans-serif;&nbsp;line-height:&nbsp;18px;&nbsp;background-color:&nbsp;rgb(238,&nbsp;238,&nbsp;238);&quot;&gt;In&nbsp;the&nbsp;asynchronous&nbsp;mode.&lt;/span&gt;&lt;span&nbsp;style=&quot;font-size:&nbsp;small;&quot;&gt;&amp;nbsp;&nbsp;Thanks!!!!&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;Verdana,&nbsp;Arial,&nbsp;Helvetica,&nbsp;sans-serif&quot;&nbsp;color=&quot;#ff0000&quot;&nbsp;size=&quot;2&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;Verdana,&nbsp;Arial,&nbsp;Helvetica,&nbsp;sans-serif&quot;&nbsp;color=&quot;#000000&quot;&nbsp;size=&quot;2&quot;&gt;code1:&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;Verdana,&nbsp;Arial,&nbsp;Helvetica,&nbsp;sans-serif&quot;&nbsp;color=&quot;#000000&quot;&nbsp;size=&quot;2&quot;&gt;receive&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;Verdana,&nbsp;Arial,&nbsp;Helvetica,&nbsp;sans-serif&quot;&nbsp;color=&quot;#000000&quot;&nbsp;size=&quot;2&quot;&gt;&amp;nbsp;&nbsp;&amp;nbsp;Any&nbsp;-&amp;gt;&nbsp;void&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;color=&quot;#000000&quot;&nbsp;size=&quot;2&quot;&gt;end&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;color=&quot;#000000&quot;&nbsp;size=&quot;2&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;color=&quot;#000000&quot;&nbsp;size=&quot;2&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;color=&quot;#000000&quot;&nbsp;size=&quot;2&quot;&gt;my&nbsp;code:&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;color=&quot;#000000&quot;&nbsp;size=&quot;2&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;font&nbsp;size=&quot;2&quot;&gt;deal_confirm(Pid)&nbsp;-&amp;gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;size=&quot;2&quot;&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;loop(Pid,&nbsp;S).&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;size=&quot;2&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;size=&quot;2&quot;&gt;loop(Pid,&nbsp;S)&nbsp;-&amp;gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;size=&quot;2&quot;&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;receive&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;size=&quot;2&quot;&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;#'basic.ack'{delivery_tag&nbsp;=&nbsp;Tag}&nbsp;&amp;nbsp;-&amp;gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;size=&quot;2&quot;&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;io:format(&quot;********&quot;),&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;size=&quot;2&quot;&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;loop(Pid,&nbsp;S);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;size=&quot;2&quot;&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;#'basic.nack'{delivery_tag&nbsp;=&nbsp;Tag}&nbsp;-&amp;gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;size=&quot;2&quot;&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;io:format(&quot;XXXXXXXXXXXX&quot;);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;size=&quot;2&quot;&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;_&nbsp;-&amp;gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;size=&quot;2&quot;&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;io:format(&quot;??????????~n&quot;)&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;size=&quot;2&quot;&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;end,&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;size=&quot;2&quot;&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;loop(Pid,&nbsp;S).&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;size=&quot;2&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;size=&quot;2&quot;&gt;send_message(_,&nbsp;_,&nbsp;_,&nbsp;100)&nbsp;-&amp;gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;size=&quot;2&quot;&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;void;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;size=&quot;2&quot;&gt;send_message(Channel,&nbsp;Publish,&nbsp;Msg,&nbsp;A)&nbsp;-&amp;gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;size=&quot;2&quot;&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;amqp_channel:cast(Channel,&nbsp;Publish,&nbsp;Msg),&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;size=&quot;2&quot;&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;send_message(Channel,&nbsp;Publish,&nbsp;Msg,&nbsp;A+1).&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;size=&quot;2&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;size=&quot;2&quot;&gt;start()&nbsp;-&amp;gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;size=&quot;2&quot;&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;{ok,&nbsp;Connection}&nbsp;=&nbsp;amqp_connection:start(#amqp_params_network{}),&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;size=&quot;2&quot;&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;{ok,&nbsp;Channel}&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;=&nbsp;amqp_connection:open_channel(Connection),&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;size=&quot;2&quot;&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;#'confirm.select_ok'{}&nbsp;=&nbsp;amqp_channel:call(Channel,&nbsp;#'confirm.select'{}),&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;size=&quot;2&quot;&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;S&nbsp;=&nbsp;self(),&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;size=&quot;2&quot;&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;amqp_channel:register_confirm_handler(Channel,&nbsp;spawn(fun()&nbsp;-&amp;gt;&nbsp;deal_confirm(S)&nbsp;end)),&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;size=&quot;2&quot;&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;Payload&nbsp;=&nbsp;&amp;lt;&amp;lt;&quot;helloworld&quot;&amp;gt;&amp;gt;,&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;size=&quot;2&quot;&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;Publish&nbsp;=&nbsp;#'basic.publish'{exchange&nbsp;=&nbsp;&amp;lt;&amp;lt;&quot;infoexchange&quot;&amp;gt;&amp;gt;,&nbsp;routing_key&nbsp;=&nbsp;&amp;lt;&amp;lt;&quot;info&quot;&amp;gt;&amp;gt;},&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;size=&quot;2&quot;&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;Props&nbsp;&amp;nbsp;&nbsp;=&nbsp;#'P_basic'{delivery_mode&nbsp;=&nbsp;2},&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;size=&quot;2&quot;&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;Msg&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;=&nbsp;#amqp_msg{props&nbsp;=&nbsp;Props,&nbsp;payload&nbsp;=&nbsp;Payload},&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;size=&quot;2&quot;&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;send_message(Channel,&nbsp;Publish,&nbsp;Msg,&nbsp;0),&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;size=&quot;2&quot;&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;amqp_channel:close(Channel),&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;size=&quot;2&quot;&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;amqp_connection:close(Connection).&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;
</tt>
