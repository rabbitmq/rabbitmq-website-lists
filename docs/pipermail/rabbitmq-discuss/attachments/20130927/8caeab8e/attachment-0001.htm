<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;I'm&nbsp;seeing&nbsp;the&nbsp;same&nbsp;issue.&nbsp;Has&nbsp;anyone&nbsp;found&nbsp;out&nbsp;the&nbsp;reason&nbsp;why?&lt;br&gt;&lt;br&gt;On&nbsp;Sunday,&nbsp;September&nbsp;1,&nbsp;2013&nbsp;1:11:57&nbsp;PM&nbsp;UTC-7,&nbsp;Tyson&nbsp;Stewart&nbsp;wrote:&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:&nbsp;0;margin-left:&nbsp;0.8ex;border-left:&nbsp;1px&nbsp;#ccc&nbsp;solid;padding-left:&nbsp;1ex;&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;I&nbsp;have&nbsp;yet&nbsp;more&nbsp;details&nbsp;to&nbsp;add&nbsp;in&nbsp;case&nbsp;they&nbsp;help.&lt;div&gt;&lt;ul&gt;&lt;li&gt;&lt;span&nbsp;style=&quot;line-height:normal&quot;&gt;Technically,&nbsp;it's&nbsp;a&nbsp;3-node&nbsp;cluster,&nbsp;but&nbsp;we&nbsp;took&nbsp;one&nbsp;of&nbsp;the&nbsp;nodes&nbsp;down&nbsp;last&nbsp;week&nbsp;and&nbsp;have&nbsp;not&nbsp;added&nbsp;it&nbsp;back&nbsp;in&nbsp;because&nbsp;we've&nbsp;had&nbsp;some&nbsp;problems&nbsp;with&nbsp;RabbitMQ&nbsp;becoming&nbsp;unresponsive&nbsp;when&nbsp;making&nbsp;those&nbsp;kinds&nbsp;of&nbsp;changes&nbsp;to&nbsp;an&nbsp;active&nbsp;cluster.&nbsp;So&nbsp;we&nbsp;have&nbsp;two&nbsp;reporting&nbsp;nodes&nbsp;and&nbsp;one&nbsp;down&nbsp;node.&lt;/span&gt;&lt;/li&gt;&lt;li&gt;&lt;span&nbsp;style=&quot;line-height:normal&quot;&gt;This&nbsp;morning,&nbsp;all&nbsp;15&nbsp;consumers&nbsp;maintained&nbsp;30&nbsp;messages&nbsp;per&nbsp;second&nbsp;pretty&nbsp;constantly,&nbsp;but&nbsp;then&nbsp;we&nbsp;hit&nbsp;some&nbsp;delivery&nbsp;threshold&nbsp;(I'm&nbsp;not&nbsp;exactly&nbsp;sure&nbsp;where),&nbsp;and&nbsp;they&nbsp;started&nbsp;the&nbsp;sawtooth&nbsp;behavior&nbsp;again&nbsp;and&nbsp;has&nbsp;been&nbsp;that&nbsp;way&nbsp;since.&amp;nbsp;&lt;/span&gt;&lt;/li&gt;&lt;li&gt;&lt;span&nbsp;style=&quot;line-height:normal&quot;&gt;We&nbsp;see&nbsp;publish&nbsp;spikes&nbsp;of&nbsp;2-3x&nbsp;the&nbsp;normal&nbsp;rate&nbsp;every&nbsp;other&nbsp;minute,&nbsp;but&nbsp;the&nbsp;consumers&nbsp;bounce&nbsp;from&nbsp;40&nbsp;messages/second&nbsp;to&nbsp;0&nbsp;four&nbsp;to&nbsp;five&nbsp;times&nbsp;per&nbsp;minute,&nbsp;so&nbsp;it's&nbsp;not&nbsp;a&nbsp;direct&nbsp;correlation&nbsp;between&nbsp;the&nbsp;publish&nbsp;spikes&nbsp;and&nbsp;delivery&nbsp;drops.&lt;/span&gt;&lt;/li&gt;&lt;/ul&gt;&lt;br&gt;On&nbsp;Saturday,&nbsp;August&nbsp;31,&nbsp;2013&nbsp;6:30:24&nbsp;PM&nbsp;UTC-5,&nbsp;Tyson&nbsp;Stewart&nbsp;wrote:&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0;margin-left:0.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hello&nbsp;everyone!&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;We've&nbsp;been&nbsp;experiencing&nbsp;some&nbsp;behavior&nbsp;that&nbsp;I&nbsp;don't&nbsp;understand,&nbsp;and&nbsp;none&nbsp;of&nbsp;my&nbsp;searching&nbsp;or&nbsp;documentation-reading&nbsp;has&nbsp;been&nbsp;fruitful,&nbsp;so&nbsp;I'm&nbsp;here&nbsp;to&nbsp;ask&nbsp;you&nbsp;all&nbsp;for&nbsp;expert&nbsp;knowledge.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Broadly,&nbsp;we're&nbsp;seeing&nbsp;a&nbsp;lower&nbsp;delivery&nbsp;rate&nbsp;than&nbsp;publish&nbsp;rate.&nbsp;I've&nbsp;attached&nbsp;an&nbsp;image&nbsp;to&nbsp;this&nbsp;message&nbsp;that&nbsp;shows&nbsp;how&nbsp;we're&nbsp;able&nbsp;to&nbsp;keep&nbsp;up&nbsp;when&nbsp;the&nbsp;publish&nbsp;rate&nbsp;is&nbsp;less&nbsp;than&nbsp;600&nbsp;messages/second,&nbsp;but&nbsp;above&nbsp;that,&nbsp;consumption&nbsp;falls&nbsp;behind&nbsp;publication.&nbsp;Around&nbsp;16:00&nbsp;on&nbsp;that&nbsp;chart,&nbsp;we&nbsp;doubled&nbsp;the&nbsp;number&nbsp;of&nbsp;consumers,&nbsp;and&nbsp;it&nbsp;made&nbsp;no&nbsp;difference&nbsp;that&nbsp;we&nbsp;could&nbsp;tell.&nbsp;The&nbsp;erratic&nbsp;behavior&nbsp;of&nbsp;the&nbsp;publish&nbsp;rate&nbsp;is&nbsp;us&nbsp;turning&nbsp;off&nbsp;publishes&nbsp;of&nbsp;the&nbsp;most&nbsp;active&nbsp;queue&nbsp;because&nbsp;we&nbsp;were&nbsp;falling&nbsp;far&nbsp;enough&nbsp;behind&nbsp;that&nbsp;we&nbsp;became&nbsp;worried.&nbsp;When&nbsp;the&nbsp;backlog&nbsp;would&nbsp;get&nbsp;low&nbsp;enough,&nbsp;we&nbsp;would&nbsp;turn&nbsp;it&nbsp;back&nbsp;on,&nbsp;and&nbsp;we&nbsp;did&nbsp;that&nbsp;a&nbsp;few&nbsp;times.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Here&nbsp;are&nbsp;some&nbsp;vitals&nbsp;to&nbsp;our&nbsp;cluster:&lt;/div&gt;&lt;div&gt;&lt;ul&gt;&lt;li&gt;&lt;span&nbsp;style=&quot;line-height:normal&quot;&gt;2&nbsp;nodes&lt;/span&gt;&lt;/li&gt;&lt;li&gt;&lt;span&nbsp;style=&quot;line-height:normal&quot;&gt;Each&nbsp;node&nbsp;is&nbsp;a&nbsp;m1.xlarge&nbsp;instance&nbsp;hosted&nbsp;in&nbsp;EC2&lt;/span&gt;&lt;/li&gt;&lt;li&gt;&lt;span&nbsp;style=&quot;line-height:normal&quot;&gt;We&nbsp;have&nbsp;133&nbsp;queues&nbsp;in&nbsp;the&nbsp;cluster&nbsp;(see&nbsp;note&nbsp;below)&lt;/span&gt;&lt;/li&gt;&lt;li&gt;&lt;span&nbsp;style=&quot;line-height:normal&quot;&gt;All&nbsp;queues&nbsp;are&nbsp;mirrored&nbsp;(they&nbsp;all&nbsp;use&nbsp;a&nbsp;policy&nbsp;that&nbsp;makes&nbsp;them&nbsp;highly&nbsp;available)&lt;/span&gt;&lt;/li&gt;&lt;li&gt;&lt;span&nbsp;style=&quot;line-height:normal&quot;&gt;All&nbsp;queues&nbsp;are&nbsp;durable;&nbsp;we&nbsp;use&nbsp;AWS&nbsp;provisioned&nbsp;IOPS&nbsp;to&nbsp;guarantee&nbsp;enough&nbsp;throughput&lt;/span&gt;&lt;/li&gt;&lt;li&gt;&lt;span&nbsp;style=&quot;line-height:normal&quot;&gt;We&nbsp;only&nbsp;use&nbsp;the&nbsp;direct&nbsp;exchange&lt;/span&gt;&lt;/li&gt;&lt;/ul&gt;&lt;div&gt;Regarding&nbsp;the&nbsp;number&nbsp;of&nbsp;queues,&nbsp;there&nbsp;are&nbsp;four&nbsp;kinds:&nbsp;the&nbsp;&quot;main&quot;&nbsp;queues,&nbsp;retry-a&nbsp;queues,&nbsp;retry-b&nbsp;queues,&nbsp;and&nbsp;poison&nbsp;queues.&nbsp;Messages&nbsp;that&nbsp;fail&nbsp;for&nbsp;whatever&nbsp;reason&nbsp;during&nbsp;consumption&nbsp;will&nbsp;get&nbsp;put&nbsp;into&nbsp;the&nbsp;retry&nbsp;queues,&nbsp;and&nbsp;if&nbsp;they&nbsp;fail&nbsp;long&nbsp;enough,&nbsp;they'll&nbsp;wind&nbsp;up&nbsp;in&nbsp;the&nbsp;poison&nbsp;queue&nbsp;where&nbsp;they&nbsp;will&nbsp;stay&nbsp;until&nbsp;we&nbsp;do&nbsp;something&nbsp;with&nbsp;them&nbsp;manually&nbsp;much&nbsp;later.&nbsp;The&nbsp;main&nbsp;queues&nbsp;then&nbsp;see&nbsp;the&nbsp;majority&nbsp;of&nbsp;activity.&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;average&nbsp;message&nbsp;size&nbsp;is&nbsp;less&nbsp;than&nbsp;1MB.&nbsp;At&nbsp;nearly&nbsp;one&nbsp;million&nbsp;messages,&nbsp;we&nbsp;were&nbsp;still&nbsp;under&nbsp;1GB&nbsp;of&nbsp;memory&nbsp;usage,&nbsp;and&nbsp;our&nbsp;high&nbsp;watermark&nbsp;is&nbsp;5.9GB.&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Disk&nbsp;IOPS&nbsp;don't&nbsp;appear&nbsp;to&nbsp;be&nbsp;the&nbsp;problem.&nbsp;Metrics&nbsp;indicated&nbsp;we&nbsp;still&nbsp;had&nbsp;plenty&nbsp;of&nbsp;headroom.&nbsp;Furthermore,&nbsp;if&nbsp;IOPS&nbsp;were&nbsp;the&nbsp;limitation,&nbsp;I&nbsp;would&nbsp;have&nbsp;expected&nbsp;the&nbsp;delivery&nbsp;rate&nbsp;to&nbsp;increase&nbsp;as&nbsp;the&nbsp;publish&nbsp;rate&nbsp;decreased&nbsp;while&nbsp;the&nbsp;consumers&nbsp;worked&nbsp;through&nbsp;the&nbsp;queue.&nbsp;It&nbsp;did&nbsp;not,&nbsp;however,&nbsp;as&nbsp;shown&nbsp;on&nbsp;the&nbsp;chart.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;My&nbsp;question&nbsp;primarily&nbsp;is:&nbsp;&lt;b&gt;What&nbsp;do&nbsp;you&nbsp;think&nbsp;is&nbsp;limiting&nbsp;our&nbsp;consumption&nbsp;rate?&lt;/b&gt;&amp;nbsp;I'm&nbsp;curious&nbsp;about&nbsp;what&nbsp;affects&nbsp;consumption&nbsp;rate&nbsp;in&nbsp;general,&nbsp;though.&nbsp;Any&nbsp;advice&nbsp;would&nbsp;be&nbsp;appreciated&nbsp;at&nbsp;this&nbsp;point.&nbsp;Questions&nbsp;for&nbsp;clarification&nbsp;are&nbsp;also&nbsp;welcome!&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;
</tt>
