<tt>
I'm&nbsp;trying&nbsp;to&nbsp;perform&nbsp;rpc&nbsp;on&nbsp;top&nbsp;of&nbsp;rabbitmq.&nbsp;&amp;nbsp;However,&nbsp;if&nbsp;a&nbsp;rpc&nbsp;request&nbsp;sits&nbsp;idle&nbsp;in&nbsp;the&nbsp;queue&nbsp;for&nbsp;2&nbsp;seconds,&nbsp;I&nbsp;want&nbsp;the&nbsp;message&nbsp;to&nbsp;be&nbsp;dropped&nbsp;from&nbsp;the&nbsp;queue&nbsp;and&nbsp;for&nbsp;the&nbsp;client&nbsp;to&nbsp;throw&nbsp;an&nbsp;error.&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;To&nbsp;do&nbsp;this,&nbsp;I've&nbsp;been&nbsp;playing&nbsp;around&nbsp;with&nbsp;dead&nbsp;letter&nbsp;exchanges.&nbsp;&amp;nbsp;However,&nbsp;I&nbsp;keep&nbsp;seeing:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;blockquote&nbsp;style=&quot;margin:&nbsp;0&nbsp;0&nbsp;0&nbsp;40px;&nbsp;border:&nbsp;none;&nbsp;padding:&nbsp;0px;&quot;&gt;&lt;div&gt;&lt;div&gt;/Users/jordan/agles/web/back/node_modules/amqp/amqp.js:350&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;throw&nbsp;new&nbsp;Error(&quot;Unknown&nbsp;field&nbsp;value&nbsp;type&nbsp;&quot;&nbsp;+&nbsp;buffer[buffer.read-1]);&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;^&lt;/div&gt;&lt;div&gt;Error:&nbsp;Unknown&nbsp;field&nbsp;value&nbsp;type&nbsp;65&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;at&nbsp;parseTable&nbsp;(/Users/jordan/agles/web/back/node_modules/amqp/amqp.js:350:15)&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;at&nbsp;parseFields&nbsp;(/Users/jordan/agles/web/back/node_modules/amqp/amqp.js:410:17)&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;at&nbsp;AMQPParser._parseHeaderFrame&nbsp;(/Users/jordan/agles/web/back/node_modules/amqp/amqp.js:469:20)&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;at&nbsp;frameEnd&nbsp;(/Users/jordan/agles/web/back/node_modules/amqp/amqp.js:190:16)&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;at&nbsp;frame&nbsp;(/Users/jordan/agles/web/back/node_modules/amqp/amqp.js:172:14)&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;at&nbsp;header&nbsp;(/Users/jordan/agles/web/back/node_modules/amqp/amqp.js:159:14)&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;at&nbsp;frameEnd&nbsp;(/Users/jordan/agles/web/back/node_modules/amqp/amqp.js:205:16)&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;at&nbsp;frame&nbsp;(/Users/jordan/agles/web/back/node_modules/amqp/amqp.js:172:14)&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;at&nbsp;AMQPParser.header&nbsp;[as&nbsp;parse]&nbsp;(/Users/jordan/agles/web/back/node_modules/amqp/amqp.js:159:14)&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;at&nbsp;AMQPParser.execute&nbsp;(/Users/jordan/agles/web/back/node_modules/amqp/amqp.js:231:21)&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Here's&nbsp;my&nbsp;clientTest.coffee:&lt;/div&gt;&lt;div&gt;&lt;blockquote&nbsp;style=&quot;margin:&nbsp;0&nbsp;0&nbsp;0&nbsp;40px;&nbsp;border:&nbsp;none;&nbsp;padding:&nbsp;0px;&quot;&gt;&lt;div&gt;&lt;div&gt;amqp&nbsp;=&nbsp;require&nbsp;'amqp'&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;connection&nbsp;=&nbsp;amqp.createConnection()&lt;/div&gt;&lt;div&gt;connection.on&nbsp;'ready',&nbsp;()&nbsp;-&amp;gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;await&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;connection.exchange&nbsp;'rpc&nbsp;exchange',&nbsp;type:&nbsp;'direct',&nbsp;defer&nbsp;exchange&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;connection.exchange&nbsp;'dead&nbsp;letter&nbsp;exchange',&nbsp;type:&nbsp;'fanout',&nbsp;defer&nbsp;deadLetterExchange&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;await&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;connection.queue&nbsp;'',&nbsp;exclusive:&nbsp;true,&nbsp;defer&nbsp;responseQueue&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;connection.queue&nbsp;'',&nbsp;exclusive:&nbsp;true,&nbsp;defer&nbsp;deadLetterQueue&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;deadLetterQueue.bind&nbsp;deadLetterExchange,&nbsp;''&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;responseQueue.subscribe&nbsp;(message,&nbsp;headers,&nbsp;deliveryInformation)&nbsp;=&amp;gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;console.log&nbsp;'responseQueue&nbsp;received:&nbsp;'&nbsp;+&nbsp;message.data&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;deadLetterQueue.subscribe&nbsp;(message,&nbsp;headers,&nbsp;deliveryInformation)&nbsp;=&amp;gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;console.log&nbsp;'deadLetterQueue&nbsp;received:&nbsp;'&nbsp;+&nbsp;message.data&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;startMakingRandomRequests&nbsp;exchange,&nbsp;responseQueue&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;startMakingRandomRequests&nbsp;=&nbsp;(exchange,&nbsp;responseQueue)&nbsp;-&amp;gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;setInterval&nbsp;(()-&amp;gt;&nbsp;makeRandomRequest&nbsp;exchange,&nbsp;responseQueue),&nbsp;2000&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;makeRandomRequest&nbsp;=&nbsp;(exchange,&nbsp;responseQueue)&nbsp;-&amp;gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;message&nbsp;=&nbsp;Math.random().toString()&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;exchange.publish&nbsp;'rpc',&nbsp;message,&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;replyTo:&nbsp;responseQueue.name&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;console.log&nbsp;'sent:&nbsp;'&nbsp;+&nbsp;message&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;And&nbsp;here's&nbsp;my&nbsp;serverTest.coffee:&lt;/div&gt;&lt;div&gt;&lt;blockquote&nbsp;style=&quot;margin:&nbsp;0&nbsp;0&nbsp;0&nbsp;40px;&nbsp;border:&nbsp;none;&nbsp;padding:&nbsp;0px;&quot;&gt;&lt;div&gt;&lt;div&gt;amqp&nbsp;=&nbsp;require&nbsp;'amqp'&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;connection&nbsp;=&nbsp;amqp.createConnection()&lt;/div&gt;&lt;div&gt;connection.on&nbsp;'ready',&nbsp;()&nbsp;=&amp;gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;await&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;connection.exchange&nbsp;'rpc&nbsp;exchange',&nbsp;type:&nbsp;'direct',&nbsp;defer&nbsp;exchange&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;connection.exchange&nbsp;'dead&nbsp;letter&nbsp;exchange',&nbsp;type:&nbsp;'fanout',&nbsp;defer&nbsp;deadLetterExchange&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;queueArguments&nbsp;=&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;'x-message-ttl':&nbsp;0&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;'x-dead-letter-exchange':&nbsp;'dead&nbsp;letter&nbsp;exchange'&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;await&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;connection.queue&nbsp;'',&nbsp;arguments:&nbsp;queueArguments,&nbsp;defer&nbsp;queue&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;queue.bind&nbsp;exchange,&nbsp;'rpc'&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;queue.subscribe&nbsp;ack:&nbsp;true,&nbsp;(message,&nbsp;headers,&nbsp;deliveryInformation)&nbsp;-&amp;gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;console.log&nbsp;'received:&nbsp;'&nbsp;+&nbsp;message.data&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;connection.publish&nbsp;deliveryInformation.replyTo,&nbsp;message.data&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;console.log&nbsp;'sent:&nbsp;'&nbsp;+&nbsp;message.data&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;#&nbsp;queue.shift()&nbsp;&amp;nbsp;NOT&nbsp;GOING&nbsp;TO&nbsp;SHIFT&nbsp;SO&nbsp;I&nbsp;CAN&nbsp;TEST&nbsp;DEAD&nbsp;LETTER&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Does&nbsp;anyone&nbsp;have&nbsp;any&nbsp;idea&nbsp;what's&nbsp;going&nbsp;on&nbsp;here?&nbsp;&amp;nbsp;Hopefully&nbsp;I'm&nbsp;making&nbsp;a&nbsp;stupid&nbsp;mistake&nbsp;:(&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks&nbsp;guys,&lt;/div&gt;&lt;div&gt;Jordan&amp;nbsp;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;
</tt>
