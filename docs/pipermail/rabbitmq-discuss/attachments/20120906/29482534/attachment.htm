<tt>
&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;br&gt;<br>
&lt;div&gt;I&nbsp;have&nbsp;attached&nbsp;the&nbsp;code&nbsp;that&nbsp;i&nbsp;have&nbsp;implemented.&lt;/div&gt;<br>
&lt;div&gt; &lt;/div&gt;<br>
&lt;div&gt; &lt;/div&gt;<br>
&lt;div&gt; //declare&nbsp;a&nbsp;Input&nbsp;queue&lt;br&gt;               &nbsp;strQueue&nbsp;=&nbsp;InputQueue&nbsp;+&nbsp;&amp;quot;.&amp;quot;&nbsp;+&nbsp;objMessage.InputKey;&lt;br&gt;               &nbsp;model&nbsp;=&nbsp;GetModel();&lt;br&gt;               &nbsp;model.QueueDeclare(strQueue);&lt;br&gt;               &nbsp;model.QueueBind(strQueue,&nbsp;Exchange,&nbsp;objMessage.InputKey,&nbsp;true,&nbsp;null);&lt;/div&gt;<br>
<br>
&lt;div&gt;               &nbsp;//declare&nbsp;a&nbsp;Response&nbsp;queue&lt;br&gt;               &nbsp;strResponseQueue&nbsp;=&nbsp;ResponseQueue&nbsp;+&nbsp;&amp;quot;.&amp;quot;&nbsp;+&nbsp;objMessage.InputKey;&nbsp;;&lt;br&gt;               &nbsp;modelResponse&nbsp;=&nbsp;GetModelForResponse();&lt;br&gt;               &nbsp;modelResponse.QueueDeclare(strResponseQueue);&lt;/div&gt;<br>
<br>
&lt;div&gt;               &nbsp;object&nbsp;msgTask&nbsp;=&nbsp;objMessage.Action;&lt;/div&gt;<br>
&lt;div&gt;               &nbsp;//Serialize&nbsp;the&nbsp;Message&nbsp;object&lt;br&gt;               &nbsp;MemoryStream&nbsp;stream&nbsp;=&nbsp;new&nbsp;MemoryStream();&lt;br&gt;               &nbsp;DataContractJsonSerializer&nbsp;jsonSerializer&nbsp;=&nbsp;new&nbsp;DataContractJsonSerializer(typeof(Message));&lt;br&gt;<br>
               &nbsp;jsonSerializer.WriteObject(stream,&nbsp;objMessage);&lt;/div&gt;<br>
&lt;div&gt;               &nbsp;byte[]&nbsp;messageBody&nbsp;=&nbsp;stream.ToArray();&lt;br&gt;               &nbsp;IBasicProperties&nbsp;msgProperties&nbsp;=&nbsp;model.CreateBasicProperties();&lt;br&gt;               &nbsp;msgProperties.AppId&nbsp;=&nbsp;RabbitHelper.AppID;&lt;br&gt;               &nbsp;msgProperties.Headers&nbsp;=&nbsp;new&nbsp;Dictionary&amp;lt;string,&nbsp;object&amp;gt;();&lt;br&gt;<br>
               &nbsp;msgProperties.Headers.Add(&amp;quot;MessageTask&amp;quot;,&nbsp;msgTask);&lt;br&gt;               &nbsp;msgProperties.MessageId&nbsp;=&nbsp;Guid.NewGuid().ToString();&lt;br&gt;               &nbsp;MessageID&nbsp;=&nbsp;msgProperties.MessageId;&lt;br&gt;               &nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;               &nbsp;modelResponse.QueueBind(strResponseQueue,&nbsp;Exchange,&nbsp;MessageID,&nbsp;true,&nbsp;null);&lt;/div&gt;<br>
&lt;div&gt;               &nbsp;model.BasicPublish(Exchange,&nbsp;objMessage.InputKey,&nbsp;msgProperties,&nbsp;messageBody);&lt;br&gt; subscription&nbsp;=&nbsp;new&nbsp;Subscription(modelResponse,&nbsp;strResponseQueue,&nbsp;false);&lt;/div&gt;<br>
&lt;div&gt;               &nbsp;while&nbsp;(subscription.Next(-1,&nbsp;out&nbsp;basicArgs))&lt;br&gt;               &nbsp;{&lt;br&gt;                   &nbsp;if&nbsp;(!object.ReferenceEquals(basicArgs,&nbsp;null))&lt;br&gt;                   &nbsp;{&lt;br&gt;                       &nbsp;IBasicProperties&nbsp;props&nbsp;=&nbsp;basicArgs.BasicProperties;&lt;br&gt;<br>
                       &nbsp;byte[]&nbsp;responseMessageBody&nbsp;=&nbsp;basicArgs.Body;&lt;/div&gt;<br>
&lt;div&gt;                       &nbsp;//Deserialize&nbsp;the&nbsp;message&nbsp;object&lt;br&gt;                       &nbsp;IMessage&nbsp;recvMessage&nbsp;=&nbsp;RabbitHelper.ConvertJsonToObject&amp;lt;Message&amp;gt;(responseMessageBody);&lt;br&gt; //validate&nbsp;if&nbsp;this&nbsp;is&nbsp;the&nbsp;desired&nbsp;response&lt;br&gt;<br>
                       &nbsp;if&nbsp;(props.MessageId&nbsp;==&nbsp;MessageID)&lt;br&gt;                       &nbsp;{&lt;br&gt;                           &nbsp;retVal&nbsp;=&nbsp;recvMessage.ReturnValue;&lt;br&gt;                           &nbsp;//acknowledge&nbsp;the&nbsp;queue&nbsp;&lt;br&gt;                           &nbsp;subscription.Ack(basicArgs);&lt;br&gt;<br>
                       &nbsp;}&lt;br&gt;                   &nbsp;}&lt;br&gt;               &nbsp;} &lt;/div&gt;<br>
&lt;div&gt; &lt;/div&gt;<br>
&lt;div&gt; &lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;Thanks&nbsp;and&nbsp;Regards,&lt;/div&gt;<br>
&lt;div&gt;Joe&nbsp;&lt;br&gt;&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;HOEnZb&quot;&gt;<br>
&lt;div&nbsp;class=&quot;h5&quot;&gt;<br>
&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Thu,&nbsp;Sep&nbsp;6,&nbsp;2012&nbsp;at&nbsp;5:00&nbsp;PM,&nbsp;Emile&nbsp;Joubert&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:emile@rabbitmq.com&quot;&nbsp;target=&quot;_blank&quot;&gt;emile@rabbitmq.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;style=&quot;BORDER-LEFT:#ccc&nbsp;1px&nbsp;solid;MARGIN:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;PADDING-LEFT:1ex&quot;&nbsp;class=&quot;gmail_quote&quot;&gt;Hi&nbsp;Joemon,&lt;br&gt;<br>
&lt;div&gt;&lt;br&gt;On&nbsp;06/09/12&nbsp;11:53,&nbsp;Joemon&nbsp;Varghese&nbsp;wrote:&lt;br&gt;&amp;gt;&nbsp; We&nbsp;are&nbsp;not&nbsp;able&nbsp;to&nbsp;reproduce&nbsp;this&nbsp;issue.We&nbsp;are&nbsp; getting&nbsp;thread&nbsp;abort&nbsp;error.&lt;br&gt;&lt;br&gt;&lt;/div&gt;Ok,&nbsp;but&nbsp;that&nbsp;does&nbsp;not&nbsp;sound&nbsp;like&nbsp;deadlock.&lt;br&gt;<br>
&lt;div&gt;&lt;br&gt;&amp;gt;&nbsp; &nbsp; Is&nbsp;there&nbsp;any&nbsp;chances&nbsp;of&nbsp;message&nbsp;being&nbsp;automatically&lt;br&gt;&amp;gt;&nbsp;deleted&nbsp;from&nbsp;Queue&nbsp;after&nbsp;certain&nbsp;amount&nbsp;of&nbsp;time.?&lt;br&gt;&lt;br&gt;&lt;/div&gt;Yes:&nbsp;messages&nbsp;may&nbsp;be&nbsp;removed&nbsp;from&nbsp;a&nbsp;queue&nbsp;if&nbsp;the&nbsp;queue&nbsp;was&nbsp;declared&nbsp;with&lt;br&gt;TTL:&nbsp;&lt;a&nbsp;href=&quot;http://www.rabbitmq.com/ttl.html#per-queue-message-ttl&quot;&nbsp;target=&quot;_blank&quot;&gt;http://www.rabbitmq.com/ttl.html#per-queue-message-ttl&lt;/a&gt;&lt;br&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&amp;gt;&nbsp; because&nbsp; sometimes&nbsp;my&nbsp;queries&nbsp;will&nbsp;take&nbsp;more&nbsp;than&nbsp;1&nbsp;hour&nbsp;but&nbsp;still&nbsp;i&nbsp;am&lt;br&gt;&amp;gt;&nbsp;keep&nbsp;on&nbsp;polling&nbsp;for&nbsp;the&nbsp;Response&nbsp;queue&nbsp; for&nbsp;this&nbsp; &nbsp; &nbsp;mesage&nbsp;id.&lt;br&gt;&lt;br&gt;&lt;/div&gt;I&amp;#39;m&nbsp;afraid&nbsp;you&nbsp;have&nbsp;not&nbsp;provided&nbsp;enough&nbsp;information&nbsp;for&nbsp;me&nbsp;to&lt;br&gt;<br>
investigate&nbsp;any&nbsp;further.&nbsp;If&nbsp;you&nbsp;can&nbsp;reproduce&nbsp;the&nbsp;problem&nbsp;then&nbsp;please&lt;br&gt;provide&nbsp;a&nbsp;description&nbsp;of&nbsp;the&nbsp;steps&nbsp;to&nbsp;reproduce,&nbsp;or&nbsp;a&nbsp;minimal&lt;br&gt;self-contained&nbsp;piece&nbsp;of&nbsp;code&nbsp;that&nbsp;triggers&nbsp;the&nbsp;failure.&nbsp;In&nbsp;the&nbsp;meantime&lt;br&gt;here&nbsp;are&nbsp;some&nbsp;suggestions:&lt;br&gt;<br>
&lt;br&gt;-&nbsp;v2.7.1&nbsp;is&nbsp;very&nbsp;old&nbsp;now.&nbsp;Upgrade&nbsp;to&nbsp;the&nbsp;latest&nbsp;version&lt;br&gt;-&nbsp;Try&nbsp;not&nbsp;to&nbsp;use&nbsp;polling&lt;br&gt;&lt;span&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;-Emile&lt;br&gt;&lt;br&gt;&lt;/font&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&gt;<br>

</tt>
