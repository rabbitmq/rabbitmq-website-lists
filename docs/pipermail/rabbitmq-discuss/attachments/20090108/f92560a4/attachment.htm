<tt>
&lt;!DOCTYPE&nbsp;html&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;4.01&nbsp;Transitional//EN&quot;&gt;<br>
&lt;html&gt;<br>
&lt;head&gt;<br>
&nbsp;&nbsp;&lt;meta&nbsp;content=&quot;text/html;charset=ISO-8859-1&quot;&nbsp;http-equiv=&quot;Content-Type&quot;&gt;<br>
&nbsp;&nbsp;&lt;title&gt;&lt;/title&gt;<br>
&lt;/head&gt;<br>
&lt;body&nbsp;bgcolor=&quot;#ffffff&quot;&nbsp;text=&quot;#000000&quot;&gt;<br>
&lt;br&gt;<br>
fwiw:&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;suspect&nbsp;there&nbsp;is&nbsp;no&nbsp;point&nbsp;in&nbsp;looking&nbsp;prior&nbsp;to&nbsp;committing&nbsp;if&nbsp;the&nbsp;state<br>
isn&amp;acute;t&nbsp;saved,&nbsp;because&nbsp;you&nbsp;get&nbsp;into&nbsp;an&nbsp;endless&nbsp;recursion...&nbsp;say&nbsp;10<br>
systems&nbsp;have&nbsp;to&nbsp;be&nbsp;updated.&nbsp;&amp;nbsp;&nbsp;When&nbsp;you&nbsp;look,&nbsp;all&nbsp;10&nbsp;are&nbsp;ok,&nbsp;but&nbsp;the<br>
situation&nbsp;in&nbsp;any&nbsp;of&nbsp;the&nbsp;10&nbsp;systems&nbsp;could&nbsp;change.&amp;nbsp;&nbsp;When&nbsp;it&nbsp;comes&nbsp;time&nbsp;to<br>
commit,&nbsp;2&nbsp;out&nbsp;of&nbsp;the&nbsp;10&nbsp;systems&nbsp;could&nbsp;have&nbsp;run&nbsp;out&nbsp;of&nbsp;whatever&nbsp;they<br>
need&nbsp;to&nbsp;reserve,&nbsp;so&nbsp;you&nbsp;end&nbsp;up&nbsp;having&nbsp;to&nbsp;check&nbsp;all&nbsp;10&nbsp;again,&nbsp;prior&nbsp;to<br>
committing&nbsp;to&nbsp;any&nbsp;one.&amp;nbsp;&nbsp;If&nbsp;they&nbsp;don&amp;acute;t&nbsp;lock&nbsp;this&nbsp;time&nbsp;either,&nbsp;then<br>
recurse,&nbsp;recurse&nbsp;again&nbsp;with&nbsp;ever&nbsp;smaller&nbsp;intervals...&amp;nbsp;&nbsp;It&nbsp;doesn&amp;acute;t&nbsp;sound<br>
like&nbsp;a&nbsp;robust&nbsp;way&nbsp;to&nbsp;proceed.&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;From&nbsp;the&nbsp;client&nbsp;perspective,&nbsp;it&nbsp;will&nbsp;look&nbsp;odd&nbsp;as&nbsp;well,&nbsp;the&nbsp;initial<br>
attempt&nbsp;will&nbsp;work,&nbsp;but&nbsp;when&nbsp;they&nbsp;say&nbsp;confirm&nbsp;it&nbsp;might&nbsp;not.&amp;nbsp;&nbsp;You&nbsp;aren&amp;acute;t<br>
giving&nbsp;the&nbsp;client&nbsp;something&nbsp;they&nbsp;can&nbsp;actually&nbsp;purchase.&lt;br&gt;<br>
&lt;br&gt;<br>
It&nbsp;makes&nbsp;more&nbsp;sense&nbsp;is&nbsp;if&nbsp;the&nbsp;tentative&nbsp;booking&nbsp;is<br>
itself&nbsp;a&nbsp;transaction,&nbsp;which&nbsp;does&nbsp;something&nbsp;(ie.&nbsp;grabs&nbsp;the&nbsp;resources<br>
being&nbsp;reserved)&nbsp;If&nbsp;you&nbsp;want&nbsp;to&nbsp;back&nbsp;out&nbsp;later,&nbsp;that&nbsp;would&nbsp;have&nbsp;to&nbsp;be<br>
another&nbsp;transaction.&amp;nbsp;&nbsp;There&nbsp;needs&nbsp;to&nbsp;be&nbsp;an&nbsp;application&nbsp;level&nbsp;tag&nbsp;that<br>
does&nbsp;everything&nbsp;a&nbsp;real&nbsp;reservation&nbsp;does,&nbsp;but&nbsp;marks&nbsp;it&nbsp;as<br>
provisional.&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;A&nbsp;completely&nbsp;separate&nbsp;application&nbsp;process&nbsp;could&nbsp;back<br>
out&nbsp;of&nbsp;provisional&nbsp;reservations&nbsp;which&nbsp;were&nbsp;not&nbsp;confirmed&nbsp;after&nbsp;some<br>
period&nbsp;of&nbsp;time.&nbsp;(cancelling&nbsp;provisional&nbsp;reservations&nbsp;is&nbsp;a&nbsp;separate<br>
application&nbsp;transaction.)&lt;br&gt;<br>
&lt;br&gt;<br>
Tim&nbsp;Coote&nbsp;wrote:<br>
&lt;blockquote&nbsp;cite=&quot;mid2CC00877-4438-4B1F-8A38-AC5FD42B8088@coote.org&quot;<br>
&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;Hi&nbsp;Ben<br>
On&nbsp;7&nbsp;Jan&nbsp;2009,&nbsp;at&nbsp;22:18,&nbsp;Ben&nbsp;Hood&nbsp;wrote:<br>
<br>
&nbsp;&nbsp;&lt;/pre&gt;<br>
&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;Tim,<br>
<br>
On&nbsp;Wed,&nbsp;Jan&nbsp;7,&nbsp;2009&nbsp;at&nbsp;12:31&nbsp;PM,&nbsp;Tim&nbsp;Coote&nbsp;&amp;lt;tim&nbsp;<br>
+rabbitmq.com@coote.org&amp;gt;&nbsp;wrote:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;Not&nbsp;sure&nbsp;what&nbsp;you&nbsp;mean&nbsp;here?&nbsp;why&nbsp;do&nbsp;I&nbsp;need&nbsp;any&nbsp;exclusive&nbsp;lock?<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;Because&nbsp;of&nbsp;the&nbsp;implication&nbsp;of&nbsp;this&nbsp;statement&nbsp;from&nbsp;you:<br>
<br>
&quot;eg,&nbsp;in&nbsp;the&nbsp;real&nbsp;world,&nbsp;I&nbsp;can&nbsp;make&nbsp;a&nbsp;provisional&nbsp;booking,&nbsp;which&nbsp;times<br>
out&nbsp;if&nbsp;I&nbsp;don't&nbsp;commit&nbsp;to&nbsp;a&nbsp;firm&nbsp;booking&nbsp;within&nbsp;a&nbsp;known&nbsp;(possibly<br>
variable)&nbsp;timeline.&quot;<br>
<br>
Unless&nbsp;I&nbsp;see&nbsp;this&nbsp;incorrectly,&nbsp;a&nbsp;provisional&nbsp;booking&nbsp;implies<br>
temporally&nbsp;exclusive&nbsp;access&nbsp;to&nbsp;the&nbsp;resource&nbsp;that&nbsp;you&nbsp;have&nbsp;requested.<br>
Were&nbsp;this&nbsp;not&nbsp;the&nbsp;case,&nbsp;a&nbsp;provisional&nbsp;booking&nbsp;would&nbsp;be&nbsp;of&nbsp;questionable<br>
value,&nbsp;because&nbsp;it&nbsp;would&nbsp;only&nbsp;reflect&nbsp;resource&nbsp;availability&nbsp;at&nbsp;the<br>
point&nbsp;in&nbsp;time&nbsp;that&nbsp;the&nbsp;request&nbsp;was&nbsp;processed.&nbsp;Beyond&nbsp;that,&nbsp;this<br>
*booking*&nbsp;would&nbsp;be&nbsp;meaningless.<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/pre&gt;<br>
&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;&lt;!----&gt;As&nbsp;far&nbsp;as&nbsp;my&nbsp;apps&nbsp;concerned&nbsp;it&nbsp;has&nbsp;exclusive&nbsp;access&nbsp;to&nbsp;some&nbsp;resource&nbsp;&nbsp;<br>
while&nbsp;it's&nbsp;in&nbsp;the&nbsp;transaction.&nbsp;However,&nbsp;the&nbsp;tx&nbsp;can&nbsp;fail&nbsp;for&nbsp;any&nbsp;number&nbsp;&nbsp;<br>
of&nbsp;reasons&nbsp;before&nbsp;it&nbsp;commits.&nbsp;&nbsp;What&nbsp;that&nbsp;means&nbsp;in&nbsp;the&nbsp;real&nbsp;world&nbsp;may&nbsp;&nbsp;<br>
vary.<br>
&nbsp;&nbsp;&lt;/pre&gt;<br>
&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;If&nbsp;the&nbsp;resource&nbsp;that&nbsp;my&nbsp;app's&nbsp;looking&nbsp;to&nbsp;'get&nbsp;a&nbsp;lock&nbsp;on'&nbsp;gets&nbsp;&nbsp;<br>
consumed,&nbsp;the<br>
transaction&nbsp;aborts.&nbsp;What's&nbsp;the&nbsp;problem?<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;As&nbsp;indicated&nbsp;above,&nbsp;what&nbsp;would&nbsp;be&nbsp;the&nbsp;value&nbsp;of&nbsp;this&nbsp;lock&nbsp;if&nbsp;doesn't<br>
actually&nbsp;lock&nbsp;anything?<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/pre&gt;<br>
&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;&lt;!----&gt;I&nbsp;don't&nbsp;think&nbsp;it's&nbsp;a&nbsp;lock.&nbsp;My&nbsp;app&nbsp;just&nbsp;sees&nbsp;the&nbsp;world&nbsp;in&nbsp;a&nbsp;consistent&nbsp;&nbsp;<br>
state.&nbsp;If&nbsp;I&nbsp;use&nbsp;Oracle,&nbsp;it&nbsp;doesn't&nbsp;lock&nbsp;data&nbsp;that's&nbsp;read,&nbsp;it&nbsp;just&nbsp;&nbsp;<br>
notes&nbsp;what's&nbsp;been&nbsp;looked&nbsp;at&nbsp;and&nbsp;keeps&nbsp;a&nbsp;copy&nbsp;if&nbsp;the&nbsp;data&nbsp;changes.&nbsp;if&nbsp;&nbsp;<br>
the&nbsp;app&nbsp;then&nbsp;tries&nbsp;to&nbsp;commit&nbsp;a&nbsp;tx&nbsp;based&nbsp;on&nbsp;that&nbsp;data,&nbsp;it&nbsp;will&nbsp;fail.&nbsp;&nbsp;&nbsp;<br>
You&nbsp;could&nbsp;implement&nbsp;a&nbsp;lock&nbsp;here&nbsp;if&nbsp;you&nbsp;want,&nbsp;but&nbsp;the&nbsp;type&nbsp;would&nbsp;depend&nbsp;&nbsp;<br>
on&nbsp;how&nbsp;much&nbsp;contention&nbsp;you're&nbsp;expecting.<br>
&nbsp;&nbsp;&lt;/pre&gt;<br>
&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;<br>
If&nbsp;it's&nbsp;not&nbsp;really&nbsp;a&nbsp;lock,&nbsp;then&nbsp;what&nbsp;implication&nbsp;does&nbsp;this&nbsp;have&nbsp;for<br>
the&nbsp;I&nbsp;in&nbsp;ACID?<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/pre&gt;<br>
&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;&lt;!----&gt;None.&nbsp;The&nbsp;I&nbsp;in&nbsp;ACID&nbsp;is&nbsp;about&nbsp;interleaved&nbsp;updates&nbsp;or&nbsp;read&nbsp;&nbsp;<br>
inconsistencies.&nbsp;It's&nbsp;valid&nbsp;for&nbsp;a&nbsp;tx&nbsp;to&nbsp;abort&nbsp;if&nbsp;the&nbsp;world&nbsp;changes.&nbsp;&nbsp;&nbsp;<br>
don't&nbsp;need&nbsp;an&nbsp;exclusive&nbsp;lock&nbsp;to&nbsp;achieve&nbsp;that.<br>
&nbsp;&nbsp;&lt;/pre&gt;<br>
&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;<br>
What&nbsp;I&nbsp;fail&nbsp;to&nbsp;see&nbsp;here&nbsp;is&nbsp;where&nbsp;the&nbsp;logical&nbsp;unit&nbsp;of&nbsp;work&nbsp;is&nbsp;here&nbsp;if<br>
an&nbsp;external&nbsp;process&nbsp;can&nbsp;affect&nbsp;the&nbsp;outcome&nbsp;of&nbsp;your&nbsp;transaction&nbsp;-&nbsp;e.g.<br>
somebody&nbsp;else&nbsp;actually&nbsp;booking&nbsp;and&nbsp;paying&nbsp;for&nbsp;the&nbsp;plane&nbsp;seats&nbsp;you&nbsp;were<br>
eyeballing&nbsp;whilst&nbsp;your&nbsp;code&nbsp;was&nbsp;waiting&nbsp;for&nbsp;each&nbsp;TX-participant&nbsp;to<br>
reach&nbsp;a&nbsp;consensus.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/pre&gt;<br>
&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;&lt;!----&gt;So,&nbsp;how&nbsp;would&nbsp;you&nbsp;approach&nbsp;this?&nbsp;&nbsp;Change&nbsp;the&nbsp;high&nbsp;level&nbsp;service&nbsp;so&nbsp;&nbsp;<br>
that&nbsp;it&nbsp;cannot&nbsp;guarantee&nbsp;atomic&nbsp;holiday&nbsp;bookings&nbsp;and&nbsp;leave&nbsp;the&nbsp;process&nbsp;&nbsp;<br>
of&nbsp;sorting&nbsp;out&nbsp;the&nbsp;mess&nbsp;as&nbsp;an&nbsp;exercise&nbsp;for&nbsp;the&nbsp;user?&nbsp;&nbsp;Or&nbsp;build&nbsp;code&nbsp;in&nbsp;&nbsp;<br>
the&nbsp;holiday&nbsp;booking&nbsp;app&nbsp;that&nbsp;tries&nbsp;to&nbsp;second&nbsp;guess&nbsp;what&nbsp;the&nbsp;individual&nbsp;&nbsp;<br>
booking&nbsp;failures&nbsp;mean,&nbsp;which&nbsp;typically&nbsp;leads&nbsp;to&nbsp;a&nbsp;bigger&nbsp;mess,&nbsp;&nbsp;<br>
especially&nbsp;as&nbsp;the&nbsp;failure&nbsp;types&nbsp;change&nbsp;over&nbsp;time.&nbsp;In&nbsp;the&nbsp;meantime,&nbsp;&nbsp;<br>
there's&nbsp;no&nbsp;sensible&nbsp;legal&nbsp;framework&nbsp;for&nbsp;the&nbsp;holiday&nbsp;booking&nbsp;app&nbsp;to&nbsp;&nbsp;<br>
work&nbsp;in,&nbsp;so&nbsp;you&nbsp;don't&nbsp;know&nbsp;who&nbsp;owns&nbsp;any&nbsp;costs&nbsp;of&nbsp;component&nbsp;booking&nbsp;&nbsp;<br>
failures.<br>
&nbsp;&nbsp;&lt;/pre&gt;<br>
&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;<br>
BTW&nbsp;-&nbsp;did&nbsp;Carl&nbsp;ever&nbsp;post&nbsp;you&nbsp;his&nbsp;answer&nbsp;to&nbsp;your&nbsp;problem?<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/pre&gt;<br>
&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;&lt;!----&gt;No.<br>
&nbsp;&nbsp;&lt;/pre&gt;<br>
&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;<br>
Ben<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/pre&gt;<br>
&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;&lt;!----&gt;<br>
Tim&nbsp;Coote<br>
&lt;a&nbsp;class=&quot;moz-txt-link-abbreviated&quot;&nbsp;href=&quot;mailto:tim@coote.org&quot;&gt;tim@coote.org&lt;/a&gt;<br>
vincit&nbsp;veritas<br>
<br>
<br>
<br>
<br>
_______________________________________________<br>
rabbitmq-discuss&nbsp;mailing&nbsp;list<br>
&lt;a&nbsp;class=&quot;moz-txt-link-abbreviated&quot;&nbsp;href=&quot;mailto:rabbitmq-discuss@lists.rabbitmq.com&quot;&gt;rabbitmq-discuss@lists.rabbitmq.com&lt;/a&gt;<br>
&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&quot;&gt;http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&lt;/a&gt;<br>
&nbsp;&nbsp;&lt;/pre&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;<br>
&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
