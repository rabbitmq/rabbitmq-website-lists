<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;I&#39;ve&nbsp;got&nbsp;a&nbsp;pretty&nbsp;basic&nbsp;consumer&nbsp;running&nbsp;on&nbsp;an&nbsp;exchange&nbsp;that&nbsp;routes&nbsp;various&nbsp;different&nbsp;messages&nbsp;to&nbsp;client-specific&nbsp;queues.&nbsp;To&nbsp;better&nbsp;manage&nbsp;resources,&nbsp;I&#39;d&nbsp;like&nbsp;for&nbsp;the&nbsp;consumers&nbsp;to&nbsp;expire&nbsp;after&nbsp;not&nbsp;receiving&nbsp;a&nbsp;message&nbsp;for&nbsp;a&nbsp;period&nbsp;of&nbsp;time&nbsp;(low-usage&nbsp;clients). &lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&#39;ve&nbsp;been&nbsp;trying&nbsp;to&nbsp;figure&nbsp;out&nbsp;where&nbsp;to&nbsp;call&nbsp;basic_cancel&nbsp;in&nbsp;this&nbsp;code,&nbsp;but&nbsp;not&nbsp;finding&nbsp;the&nbsp;right&nbsp;solution.&nbsp;Any&nbsp;tips&nbsp;on&nbsp;how&nbsp;to&nbsp;refactor&nbsp;and&nbsp;get&nbsp;what&nbsp;I&nbsp;want?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp;public&nbsp;function&nbsp;consume()&nbsp;{&lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp;$callback&nbsp;=&nbsp;function($msg)&nbsp;{&nbsp; &nbsp; &nbsp; &lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;$pMsg&nbsp;=&nbsp;new&nbsp;ProcessorMessage();&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;$pMsg-&gt;onMessage($msg-&gt;body);&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;$msg-&gt;delivery_info[&#39;channel&#39;]-&gt;basic_ack($msg-&gt;delivery_info[&#39;delivery_tag&#39;]);&lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp;};&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;$this-&gt;channel-&gt;basic_qos(null,&nbsp;1,&nbsp;null);&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;$this-&gt;channel-&gt;basic_consume($queue_name,&nbsp;&#39;&#39;,&nbsp;false,&nbsp;false,&nbsp;false,&nbsp;false,&nbsp;$callback);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp;while(count($this-&gt;channel-&gt;callbacks))&nbsp;{&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;$this-&gt;channel-&gt;wait();&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;--&nbsp;&lt;br&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;style=&quot;text-align:-webkit-auto;font-size:14px;font-family:Helvetica&quot;&gt;<br>
&lt;b&nbsp;style=&quot;color:rgb(111,116,122);text-align:-webkit-auto&quot;&gt;Sean&nbsp;M.&nbsp;Joyce&lt;/b&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;text-align:-webkit-auto;font-size:14px;font-family:Helvetica&quot;&gt;&lt;font&nbsp;color=&quot;#6f747a&quot;&gt;Director&nbsp;of&nbsp;Product&nbsp;Engineering&nbsp;| Patientco&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;text-align:-webkit-auto;font-size:14px;font-family:Helvetica&quot;&gt;&lt;font&nbsp;color=&quot;#128b48&quot;&gt;&lt;a&nbsp;href=&quot;mailto:sean.joyce@patientco.com&quot;&nbsp;target=&quot;_blank&quot;&gt;sean.joyce&lt;font&nbsp;color=&quot;#1155cc&quot;&gt;@patientco.com&lt;/font&gt;&lt;/a&gt;&lt;/font&gt;&lt;/div&gt;<br>
888.747.2455&nbsp;x412&lt;div&nbsp;style=&quot;text-align:-webkit-auto;font-size:14px;font-family:Helvetica&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;a&nbsp;href=&quot;http://info.patientco.com/himss&quot;&nbsp;style=&quot;color:rgb(17,85,204);font-family:Helvetica;font-size:14px&quot;&nbsp;target=&quot;_blank&quot;&gt;&lt;br&gt;<br>
&lt;/a&gt;&lt;a&nbsp;href=&quot;http://info.patientco.com/happy-providers&quot;&nbsp;style=&quot;color:rgb(17,85,204);font-family:Helvetica;font-size:medium&quot;&nbsp;target=&quot;_blank&quot;&gt;&lt;img&nbsp;src=&quot;http://info.patientco.com/l/25272/2014-01-17/44swk/25272/23818/happyprovider_email_banner.jpg&quot;&gt;&lt;/a&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;/div&gt;<br>
<br>
&lt;br&gt;<br>
&lt;div&gt;&lt;p&nbsp;style=&quot;margin:0in&nbsp;0in&nbsp;0.0001pt&quot;&gt;&lt;font&nbsp;size=&quot;2&quot;&gt;As&nbsp;a&nbsp;friendly&nbsp;reminder,&nbsp;never&nbsp;send&nbsp;Protected&nbsp;Health&nbsp;Information&nbsp;(PHI)&nbsp;via&nbsp;email. &lt;/font&gt;&lt;/p&gt;&lt;p&nbsp;style=&quot;margin:0in&nbsp;0in&nbsp;0.0001pt&quot;&gt;&lt;font&nbsp;size=&quot;1&quot;&gt; &lt;/font&gt;&lt;/p&gt;&lt;/div&gt;&lt;div&gt;&lt;p&nbsp;style=&quot;margin:0in&nbsp;0in&nbsp;0.0001pt&quot;&gt;&lt;font&nbsp;size=&quot;1&quot;&gt;&lt;span&nbsp;style=&quot;background-image:initial;background-repeat:initial&quot;&gt;CONFIDENTIALITY&nbsp;NOTICE:&lt;/span&gt;  The&nbsp;information&nbsp;contained&nbsp;in&nbsp;this&nbsp;email message&nbsp;may&nbsp;be&nbsp;privileged,&nbsp;confidential, and&nbsp;protected&nbsp;from&nbsp;disclosure.&nbsp;Any unauthorized&nbsp;use,&nbsp;printing,&nbsp;copying, disclosure,&nbsp;dissemination&nbsp;of&nbsp;or&nbsp;reliance upon&nbsp;this&nbsp;communication&nbsp;by&nbsp;persons&nbsp;other than&nbsp;the&nbsp;intended&nbsp;recipient&nbsp;may&nbsp;be&nbsp;subject to&nbsp;legal&nbsp;restriction&nbsp;or&nbsp;sanction. &lt;span&nbsp;style=&quot;background-image:initial;background-repeat:initial&quot;&gt;If&nbsp;you&nbsp;are&nbsp;not&nbsp;the&nbsp;intended&nbsp;recipient,&nbsp;you&nbsp;are&nbsp;hereby&nbsp;notified&nbsp;that&nbsp;you&nbsp;are&nbsp;not&nbsp;authorized&nbsp;to&nbsp;read,&nbsp;print,&nbsp;retain,&nbsp;copy,&nbsp;or&nbsp;disseminate&nbsp;this&nbsp;message,&nbsp;any&nbsp;part&nbsp;of&nbsp;it,&nbsp;or&nbsp;any&nbsp;attachments.&lt;/span&gt;  If&nbsp;you&nbsp;think that&nbsp;you&nbsp;have&nbsp;received&nbsp;this&nbsp;email&nbsp;message in&nbsp;error,&nbsp;please&nbsp;reply&nbsp;to&nbsp;the&nbsp;sender&nbsp;and delete&nbsp;this&nbsp;email &lt;span&nbsp;style=&quot;background-image:initial;background-repeat:initial&quot;&gt;and&nbsp;any&nbsp;attachments&nbsp;and&nbsp;all&nbsp;copies&nbsp;thereof&nbsp;from&nbsp;your&nbsp;system&nbsp;without&nbsp;reading&nbsp;the&nbsp;content&nbsp;and&nbsp;destroy&nbsp;any&nbsp;printouts&nbsp;of&nbsp;the&nbsp;e-mail&nbsp;or&nbsp;attachments &lt;/span&gt;&lt;span&nbsp;style=&quot;background-image:initial;background-repeat:initial&quot;&gt;promptly.&lt;/span&gt; &lt;/font&gt;&lt;/p&gt;&lt;/div&gt;
</tt>
