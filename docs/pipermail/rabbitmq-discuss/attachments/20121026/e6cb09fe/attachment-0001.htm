<tt>
&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&nbsp;&quot;&gt;&lt;br&gt;&lt;div&gt;&lt;div&gt;On&nbsp;Oct&nbsp;25,&nbsp;2012,&nbsp;at&nbsp;11:54&nbsp;,&nbsp;Tim&nbsp;Watson&nbsp;wrote:&lt;/div&gt;&lt;br&nbsp;class=&quot;Apple-interchange-newline&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&gt;Hi&lt;br&gt;&lt;br&gt;On&nbsp;10/25/2012&nbsp;06:33&nbsp;AM,&nbsp;Srdan&nbsp;Kvrgic&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;Hi,&lt;br&gt;&lt;/blockquote&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;Short&nbsp;story:&lt;br&gt;&lt;/blockquote&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;Are&nbsp;there&nbsp;any&nbsp;plans&nbsp;to&nbsp;support&nbsp;batching&nbsp;of&nbsp;messages&nbsp;within&nbsp;the&nbsp;rabbitmq&nbsp;eco-system?&lt;br&gt;&lt;/blockquote&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;Long&nbsp;story:&lt;br&gt;&lt;/blockquote&gt;[snip]&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;Optimally&nbsp;you&nbsp;would&nbsp;want&nbsp;a&nbsp;system&nbsp;that&nbsp;sends&nbsp;and&nbsp;receives&nbsp;batches&nbsp;of&nbsp;messages&nbsp;but&nbsp;allows&nbsp;you&nbsp;to&nbsp;reject&nbsp;single&nbsp;messages.&nbsp;Have&nbsp;your&nbsp;cake&nbsp;and&nbsp;eat&nbsp;it,&nbsp;as&nbsp;it&nbsp;were...&lt;br&gt;&lt;/blockquote&gt;&lt;br&gt;Sounds&nbsp;good,&nbsp;but...&lt;br&gt;&lt;br&gt;AMQP&nbsp;already&nbsp;provides&nbsp;batching&nbsp;delivery&nbsp;capabilities&nbsp;and&nbsp;these&nbsp;have&nbsp;been&nbsp;discussed&nbsp;previously,&nbsp;for&nbsp;example&nbsp;&lt;a&nbsp;href=&quot;https://groups.google.com/forum/?fromgroups=#!topic/rabbitmq-discuss/CidFKmJrBFI&quot;&gt;https://groups.google.com/forum/?fromgroups=#!topic/rabbitmq-discuss/CidFKmJrBFI&lt;/a&gt;.&nbsp;But&nbsp;what&nbsp;you&nbsp;seem&nbsp;to&nbsp;be&nbsp;running&nbsp;up&nbsp;against&nbsp;is&nbsp;the&nbsp;fact&nbsp;that&nbsp;your&nbsp;many&nbsp;small&nbsp;messages&nbsp;limit&nbsp;throughput,&nbsp;so&nbsp;you&nbsp;want&nbsp;to&nbsp;bundle&nbsp;them&nbsp;up.&nbsp;I&nbsp;would&nbsp;suggest&nbsp;putting&nbsp;a&nbsp;processor&nbsp;between&nbsp;the&nbsp;publisher&nbsp;and&nbsp;consumer&nbsp;which&nbsp;unpacks&nbsp;the&nbsp;batches&nbsp;and&nbsp;forwards&nbsp;individual&nbsp;messages&nbsp;to&nbsp;the&nbsp;target&nbsp;exchange.&nbsp;This&nbsp;could&nbsp;be&nbsp;achieved&nbsp;by&nbsp;writing&nbsp;a&nbsp;custom&nbsp;exchange&nbsp;type,&nbsp;configured&nbsp;to&nbsp;understand&nbsp;how&nbsp;to&nbsp;'unpack'&nbsp;the&nbsp;batch&nbsp;and&nbsp;where&nbsp;to&nbsp;route&nbsp;the&nbsp;forwarded&nbsp;messages&nbsp;to.&nbsp;The&nbsp;consumers&nbsp;would&nbsp;then&nbsp;receive&nbsp;these&nbsp;individual&nbsp;messages&nbsp;(possibly&nbsp;in&nbsp;batches!)&nbsp;and&nbsp;could&nbsp;reject&nbsp;some&nbsp;or&nbsp;all&nbsp;of&nbsp;them,&nbsp;but&nbsp;that&nbsp;rejection&nbsp;would&nbsp;not&nbsp;be&nbsp;apparent&nbsp;to&nbsp;the&nbsp;outside&nbsp;world&nbsp;in&nbsp;any&nbsp;way!&nbsp;So&nbsp;you'd&nbsp;need&nbsp;to&nbsp;then&nbsp;change&nbsp;your&nbsp;design&nbsp;somewhat,&nbsp;perhaps&nbsp;by&nbsp;putting&nbsp;'failed'&nbsp;messages&nbsp;onto&nbsp;a&nbsp;different&nbsp;'error&nbsp;queue'&nbsp;*or*&nbsp;by&nbsp;rejecting&nbsp;them&nbsp;and&nbsp;setting&nbsp;up&nbsp;a&nbsp;TTL&nbsp;and&nbsp;Dead&nbsp;Letter&nbsp;eXchange&nbsp;on&nbsp;the&nbsp;destination&nbsp;queue&nbsp;so&nbsp;that&nbsp;you&nbsp;can&nbsp;identify&nbsp;failures&nbsp;transparently.&nbsp;In&nbsp;either&nbsp;case,&nbsp;you'd&nbsp;want&nbsp;to&nbsp;add&nbsp;some&nbsp;kind&nbsp;of&nbsp;x-batch-id&nbsp;header&nbsp;to&nbsp;the&nbsp;'broken&nbsp;up'&nbsp;messages&nbsp;so&nbsp;that&nbsp;your&nbsp;reprocessing&nbsp;procedure&nbsp;is&nbsp;able&nbsp;to&nbsp;identify&nbsp;the&nbsp;source&nbsp;batch&nbsp;from&nbsp;which&nbsp;they&nbsp;came.&lt;br&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Are&nbsp;you&nbsp;talking&nbsp;about&nbsp;writing&nbsp;an&nbsp;extension&nbsp;to&nbsp;rabbit-mq&nbsp;as&nbsp;such?&nbsp;I'm&nbsp;not&nbsp;sure&nbsp;I&nbsp;follow&nbsp;your&nbsp;solution.&nbsp;Or&nbsp;rather,&nbsp;it&nbsp;doesn't&nbsp;seem&nbsp;like&nbsp;something&nbsp;it's&nbsp;very&nbsp;easy&nbsp;or&nbsp;practical.&nbsp;=)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&gt;Doing&nbsp;this&nbsp;'in&nbsp;the&nbsp;broker'&nbsp;doesn't&nbsp;really&nbsp;make&nbsp;sense&nbsp;to&nbsp;me.&nbsp;How&nbsp;would&nbsp;transactions&nbsp;and/or&nbsp;confirms&nbsp;continue&nbsp;to&nbsp;work,&nbsp;for&nbsp;example?&lt;br&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Actually&nbsp;the&nbsp;consumer&nbsp;parts&nbsp;seems&nbsp;to&nbsp;be&nbsp;to&nbsp;be&nbsp;already&nbsp;working&nbsp;like&nbsp;this..&nbsp;You&nbsp;already&nbsp;get&nbsp;prefetches&nbsp;and&nbsp;what&nbsp;not,&nbsp;I&nbsp;don't&nbsp;see&nbsp;why&nbsp;those&nbsp;shouldn't&nbsp;be&nbsp;delivered&nbsp;in&nbsp;a&nbsp;single&nbsp;data&nbsp;transfer.&nbsp;Perhaps&nbsp;they&nbsp;already&nbsp;are?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;publisher&nbsp;side&nbsp;of&nbsp;this&nbsp;on&nbsp;the&nbsp;other&nbsp;hand&nbsp;doesn't&nbsp;do&nbsp;this&nbsp;by&nbsp;default.&nbsp;I'll&nbsp;have&nbsp;to&nbsp;try&nbsp;disabling&amp;nbsp;Nagle's&nbsp;algorithm&nbsp;to&nbsp;see&nbsp;if&nbsp;that&nbsp;gives&nbsp;use&nbsp;the&nbsp;wings..&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;Also&nbsp;automatic&nbsp;de-/compression&nbsp;in&nbsp;the&nbsp;driver.&nbsp;That&nbsp;also&nbsp;was&nbsp;a&nbsp;great&nbsp;performance&nbsp;boost&nbsp;when&nbsp;the&nbsp;batches&nbsp;started&nbsp;getting&nbsp;big.&nbsp;Lzf&nbsp;ftw!&lt;br&gt;&lt;/blockquote&gt;&lt;br&gt;Hmn,&nbsp;that's&nbsp;an&nbsp;interesting&nbsp;one!&nbsp;Which&nbsp;client&nbsp;library&nbsp;are&nbsp;you&nbsp;using?&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#007421&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Running&nbsp;jruby&nbsp;we&nbsp;use&nbsp;java&nbsp;libraries&nbsp;for&nbsp;anything&nbsp;performance&nbsp;critical.&nbsp;Like&nbsp;com.ning.compress.lzf.LZFEncoder&nbsp;for&nbsp;compressions.&nbsp;Unless&nbsp;you're&nbsp;talking&nbsp;about&nbsp;the&nbsp;entire&nbsp;library&nbsp;for&nbsp;tracking,&nbsp;batching,&nbsp;routing&nbsp;and&nbsp;compressing.&nbsp;In&nbsp;that&nbsp;case&nbsp;we&nbsp;use&nbsp;autobahn&amp;nbsp;&lt;a&nbsp;href=&quot;https://github.com/burtcorp/autobahn/&quot;&gt;https://github.com/burtcorp/autobahn/&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;//S&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;br&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
