<tt>
OK,&nbsp;so&nbsp;I&nbsp;have&nbsp;looked&nbsp;over&nbsp;the&nbsp;spec&nbsp;a&nbsp;little&nbsp;more&nbsp;thoroughly&nbsp;now,&amp;nbsp;&nbsp;thinking&nbsp;about&nbsp;my&nbsp;application.&amp;nbsp;&nbsp;It&amp;#39;s&nbsp;still&nbsp;very&nbsp;hypothetical&nbsp;for&nbsp;me&nbsp;at&nbsp;this&nbsp;point.&amp;nbsp;&amp;nbsp;&nbsp;I&nbsp;can&nbsp;easily&nbsp;see&nbsp;using&nbsp;it&nbsp;for&nbsp;some&nbsp;of&nbsp;the&nbsp;simpler&lt;br&gt;applications,&nbsp;but&nbsp;the&nbsp;most&nbsp;troubling&nbsp;thing&nbsp;I&nbsp;noticed&nbsp;in&nbsp;0-10,&nbsp;is&nbsp;that&nbsp;&amp;quot;header&nbsp;exchange&nbsp;type&amp;quot;&nbsp;support&nbsp;is&nbsp;optional.&amp;nbsp;&amp;nbsp;&nbsp;Having&nbsp;optional&nbsp;bits&nbsp;in&nbsp;a&nbsp;spec&nbsp;is&nbsp;bad,&nbsp;especially&nbsp;when&nbsp;they&nbsp;are&nbsp;the&nbsp;bits&nbsp;I&nbsp;want,&nbsp;and&nbsp;rabbit&nbsp;doesn&amp;#39;t&nbsp;implement&nbsp;them&nbsp;:-)&lt;br&gt;<br>
&lt;br&gt;I&nbsp;found&nbsp;the&nbsp;FAQ&nbsp;explanation&nbsp;that&nbsp;though&nbsp;fanout/topic/direct&nbsp;are&nbsp;successive&nbsp;specializations,&nbsp;having&nbsp;it&nbsp;in&nbsp;the&nbsp;spec&nbsp;permits&nbsp;broker&nbsp;side&nbsp;optimizations&nbsp;unconvincing.&amp;nbsp;&nbsp;If&nbsp;people&nbsp;keep&nbsp;bringing&nbsp;it&nbsp;up,&nbsp;then&nbsp;maybe&nbsp;it&amp;#39;s&nbsp;a&nbsp;sign&nbsp;that&nbsp;the&nbsp;spec&nbsp;is&nbsp;doing&nbsp;something&nbsp;that&nbsp;violates&nbsp;the&nbsp;principle&nbsp;of&nbsp;least&nbsp;surprise.&amp;nbsp;&nbsp;The&nbsp;broker&nbsp;could&nbsp;just&nbsp;perform&nbsp;optimizations&nbsp;on&nbsp;the&nbsp;bindings&nbsp;in&nbsp;place&nbsp;and&nbsp;not&nbsp;clutter&nbsp;up&nbsp;the&nbsp;standard.&amp;nbsp;&nbsp;The&nbsp;really&nbsp;general&nbsp;thing&nbsp;to&nbsp;do&nbsp;is&nbsp;the&nbsp;header&nbsp;type,&nbsp;using&nbsp;a&nbsp;matching&nbsp;syntax.&nbsp;&lt;br&gt;<br>
&lt;br&gt;Nor&nbsp;do&nbsp;I&nbsp;grasp&nbsp;why&nbsp;an&nbsp;exchange&nbsp;is&nbsp;anything&nbsp;special.&amp;nbsp;&amp;nbsp;&nbsp;The&nbsp;exchange&nbsp;name&nbsp;could&nbsp;easily&nbsp;be&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;the&nbsp;routing&nbsp;key&nbsp;to&nbsp;apply&nbsp;the&nbsp;pattern&nbsp;to.&amp;nbsp;&nbsp;One&nbsp;can&nbsp;bind&nbsp;to&nbsp;all&nbsp;exchanges&nbsp;or&nbsp;a&nbsp;pattern&nbsp;of&nbsp;exchanges,&nbsp;rather&nbsp;than&nbsp;having&nbsp;to&nbsp;specify&nbsp;each&nbsp;exchange&nbsp;individually.&amp;nbsp;&nbsp;If&nbsp;you&nbsp;make&nbsp;an&nbsp;exchange&nbsp;name&nbsp;part&nbsp;of&nbsp;the&nbsp;binding&nbsp;key,&nbsp;you&nbsp;could&nbsp;even&nbsp;add&nbsp;the&nbsp;queue&nbsp;to&nbsp;the&nbsp;end&nbsp;of&nbsp;it,&nbsp;so&nbsp;you&nbsp;get&nbsp;binding&nbsp;patterns&nbsp;that&nbsp;look&nbsp;like:&lt;br&gt;<br>
&lt;br&gt;bind.add&nbsp;&amp;lt;exchange&amp;gt;.&amp;lt;topic&amp;gt;.&amp;lt;sub-topic&amp;gt;....&amp;lt;queue&amp;gt;&amp;nbsp;&amp;nbsp;&nbsp;to&nbsp;&amp;lt;queue&amp;gt;&lt;br&gt;&lt;br&gt;and&nbsp;bindings&nbsp;become&nbsp;stand-alone&nbsp;entities,&nbsp;potentially&nbsp;with&nbsp;permissions,&nbsp;separate&nbsp;from&nbsp;exchanges&nbsp;and&nbsp;queues.&nbsp;Bindings&nbsp;essentially&nbsp;become&nbsp;entries&nbsp;in&nbsp;a&nbsp;global&nbsp;routing&nbsp;table.&amp;nbsp;&amp;nbsp;&nbsp;All&nbsp;the&nbsp;Exchange&nbsp;types&nbsp;naturally&nbsp;specialize&nbsp;from&nbsp;it.&amp;nbsp;&nbsp;the&nbsp;above&nbsp;example&nbsp;is&nbsp;obviously&nbsp;topic&nbsp;routing,&nbsp;below&nbsp;are&nbsp;the&nbsp;others.&lt;br&gt;<br>
&lt;br&gt;&amp;lt;exchange&amp;gt;.#&amp;nbsp;&amp;nbsp;&nbsp;&amp;lt;--&nbsp;fanout&lt;br&gt;&amp;lt;exchange&amp;gt;.&amp;lt;random&nbsp;stuff&amp;gt;.&amp;nbsp;&amp;nbsp;&nbsp;&amp;lt;--&nbsp;header&nbsp;routing,&nbsp;trailing&nbsp;dot&nbsp;means&nbsp;last&nbsp;element&nbsp;not&nbsp;a&nbsp;queue.&lt;br&gt;&amp;lt;exchange&amp;gt;.&amp;lt;queue&amp;gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;lt;--&nbsp;direct:&nbsp;note,&nbsp;no&nbsp;trailing&nbsp;dot&nbsp;--&amp;gt;&nbsp;the&nbsp;last&nbsp;item&nbsp;is&nbsp;a&nbsp;queue.&lt;br&gt;<br>
&lt;br&gt;Lastly,&nbsp;the&nbsp;pattern&nbsp;matching&nbsp;is&nbsp;a&nbsp;bit&nbsp;too&nbsp;simple.&nbsp;would&nbsp;really&nbsp;prefer&nbsp;the&nbsp;ability&nbsp;to&nbsp;use&nbsp;full&nbsp;regular&nbsp;expressions,&nbsp;rather&nbsp;than&nbsp;just&nbsp;word&nbsp;matching.&amp;nbsp;&amp;nbsp;&nbsp;of&nbsp;course&nbsp;then&nbsp;&amp;#39;.&amp;#39;&nbsp;becomes&nbsp;a&nbsp;significant&nbsp;symbol&nbsp;and&nbsp;you&nbsp;want&nbsp;to&nbsp;use&nbsp;something&nbsp;else&nbsp;as&nbsp;a&nbsp;separator.&amp;nbsp;&nbsp;&amp;#39;:&amp;#39;&nbsp;is&nbsp;a&nbsp;good&nbsp;choice.&amp;nbsp;&amp;nbsp;&nbsp;On&nbsp;the&nbsp;other&nbsp;hand,&nbsp;going&nbsp;through&nbsp;long&nbsp;lists&nbsp;of&nbsp;regular&nbsp;expression&nbsp;evaluations&nbsp;can&nbsp;kill&nbsp;performance.&nbsp;&lt;br&gt;<br>
&lt;br&gt;and&nbsp;now&nbsp;for&nbsp;something&nbsp;completely&nbsp;different...&lt;br&gt;&lt;br&gt;The&nbsp;switching&nbsp;system&nbsp;I&amp;#39;m&nbsp;used&nbsp;to&nbsp;is&nbsp;actually&nbsp;remarkably&nbsp;similar&nbsp;to&nbsp;the&nbsp;AMQP&nbsp;model.&amp;nbsp;&nbsp;It&nbsp;has&nbsp;exactly&nbsp;the&nbsp;same&nbsp;concept&nbsp;of&nbsp;exchanges&nbsp;(called&nbsp;receivers),&nbsp;and&nbsp;queues&nbsp;(called&nbsp;senders)&lt;br&gt;<br>
but&nbsp;has&nbsp;much&nbsp;more&nbsp;flexible/powerful&nbsp;matching/routing,&nbsp;while&nbsp;retaining&nbsp;sufficient&nbsp;(for&nbsp;my&nbsp;application!)&nbsp;performance.&amp;nbsp;&amp;nbsp;&nbsp;In&nbsp;this&nbsp;other&nbsp;MSS,&nbsp;you&nbsp;define,&nbsp;using&nbsp;full&nbsp;regular&nbsp;expressions,&nbsp;a&nbsp;series&nbsp;of&nbsp;key_extraction&nbsp;bindings&nbsp;for&nbsp;each&nbsp;exchange.&amp;nbsp;&nbsp;The&nbsp;first&nbsp;matching&nbsp;extraction&nbsp;derives&nbsp;a&nbsp;routing&nbsp;key&nbsp;for&nbsp;the&nbsp;message.&amp;nbsp;&nbsp;You&nbsp;then&nbsp;look&nbsp;up&nbsp;the&nbsp;derived&nbsp;key&nbsp;in&nbsp;a&nbsp;table&nbsp;(associative&nbsp;array&nbsp;in&nbsp;python,&nbsp;quite&nbsp;fast&nbsp;lookup)&nbsp;and&nbsp;it&nbsp;gives&nbsp;you&nbsp;a&nbsp;list&nbsp;of&nbsp;queues&nbsp;to&nbsp;route&nbsp;to&nbsp;(what&nbsp;do&nbsp;you&nbsp;call&nbsp;that...&nbsp;multiple&nbsp;direct&nbsp;routing?).&amp;nbsp;&nbsp;We&nbsp;have&nbsp;a&nbsp;only&nbsp;two&nbsp;such&nbsp;tables&nbsp;for&nbsp;a&nbsp;few&nbsp;dozen&nbsp;exchanges,&nbsp;but&nbsp;one&nbsp;can&nbsp;use&nbsp;per&nbsp;exchange&nbsp;tables&nbsp;if&nbsp;desired,&nbsp;and&nbsp;regular&nbsp;expressions&nbsp;can&nbsp;be&nbsp;used&nbsp;there&nbsp;as&nbsp;well.&amp;nbsp;&amp;nbsp;&nbsp;Once&nbsp;the&nbsp;messages&amp;#39;&nbsp;queues&nbsp;are&nbsp;selected,&nbsp;the&nbsp;queue&nbsp;specific&nbsp;bindings&nbsp;are&nbsp;applied&nbsp;to&nbsp;winnow&nbsp;down&nbsp;further.&lt;br&gt;<br>
&lt;br&gt;The&nbsp;above&nbsp;may&nbsp;sound&nbsp;complicated,&nbsp;but&nbsp;it&nbsp;is&nbsp;the&nbsp;only&nbsp;thing&nbsp;that&nbsp;could&nbsp;achieve&nbsp;the&nbsp;generality&nbsp;we&nbsp;needed,&nbsp;and&nbsp;the&nbsp;speed&nbsp;is&nbsp;good&nbsp;enough&nbsp;(if&nbsp;you&nbsp;don&amp;#39;t&nbsp;need&nbsp;all&nbsp;the&nbsp;various&nbsp;bindings,&nbsp;then&nbsp;just&nbsp;have&nbsp;a&nbsp;null&nbsp;set&nbsp;of&nbsp;them&nbsp;and&nbsp;there&nbsp;should&nbsp;be&nbsp;no&nbsp;performance&nbsp;penalty.)&amp;nbsp;&amp;nbsp;&nbsp;&lt;br&gt;<br>
&lt;br&gt;Does&nbsp;anyone&nbsp;else&nbsp;use&nbsp;complicated&nbsp;routing&nbsp;like&nbsp;us?&amp;nbsp;&nbsp;Does&nbsp;it&nbsp;sound&nbsp;like&nbsp;something&nbsp;that&nbsp;AMQP&nbsp;might&nbsp;get&nbsp;to&nbsp;later?&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Sun,&nbsp;Nov&nbsp;9,&nbsp;2008&nbsp;at&nbsp;1:19&nbsp;PM,&nbsp;Peter&nbsp;Silva&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:Peter.A.Silva@gmail.com&quot;&gt;Peter.A.Silva@gmail.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;cool!&lt;div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;Wj3C7c&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Sun,&nbsp;Nov&nbsp;9,&nbsp;2008&nbsp;at&nbsp;12:55&nbsp;PM,&nbsp;Barry&nbsp;Pederson&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:bp@barryp.org&quot;&nbsp;target=&quot;_blank&quot;&gt;bp@barryp.org&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
Ben&nbsp;Hood&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
Peter,&lt;br&gt;<br>
&lt;br&gt;<br>
On&nbsp;Sat,&nbsp;Nov&nbsp;8,&nbsp;2008&nbsp;at&nbsp;7:29&nbsp;PM,&nbsp;Peter&nbsp;Silva&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;mailto:Peter.A.Silva@gmail.com&quot;&nbsp;target=&quot;_blank&quot;&gt;Peter.A.Silva@gmail.com&lt;/a&gt;&amp;gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
That&amp;#39;s&nbsp;strange...&nbsp;maybe&nbsp;I&amp;#39;m&nbsp;just&nbsp;getting&nbsp;confused&nbsp;by&lt;br&gt;<br>
a&nbsp;client&nbsp;code...&nbsp;Here&nbsp;is&nbsp;an&nbsp;example&nbsp;from&nbsp;the&nbsp;demo&nbsp;in&nbsp;py-amqplib...&lt;br&gt;<br>
&lt;br&gt;<br>
&amp;nbsp;ch.basic_publish(msg,&nbsp;EXCHANGE_NAME,&nbsp;routing_key=topic)&lt;br&gt;<br>
&lt;br&gt;<br>
the&nbsp;&amp;#39;routing_key&amp;#39;&nbsp;in&nbsp;this&nbsp;api,&nbsp;afaict,&nbsp;is&nbsp;one&nbsp;of&nbsp;three&nbsp;keywords:&nbsp;topic,&lt;br&gt;<br>
fanout,&nbsp;direct.&nbsp;&amp;nbsp;&nbsp;what&nbsp;is&nbsp;called&nbsp;exchange_type&nbsp;in&nbsp;the&nbsp;AMQP&nbsp;spec.&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;<br>
Are&nbsp;you&nbsp;referring&nbsp;to&nbsp;amqp_clock.py?&lt;br&gt;<br>
&lt;br&gt;<br>
If&nbsp;so,&nbsp;I&nbsp;think&nbsp;that&nbsp;the&nbsp;topic&nbsp;is&nbsp;a&nbsp;the&nbsp;name&nbsp;of&nbsp;a&nbsp;string&nbsp;variable:&lt;br&gt;<br>
&lt;br&gt;<br>
TOPIC_PATTERN&nbsp;=&nbsp;&amp;#39;%Y.%m.%d.%w.%H.%M&amp;#39;&nbsp;#&nbsp;Python&nbsp;datetime.strftime()&nbsp;pattern&lt;br&gt;<br>
.....&lt;br&gt;<br>
topic&nbsp;=&nbsp;now.strftime(TOPIC_PATTERN)&lt;br&gt;<br>
ch.basic_publish(msg,&nbsp;EXCHANGE_NAME,&nbsp;routing_key=topic)&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;<br>
Peter:&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;can&nbsp;see&nbsp;where&nbsp;that&nbsp;could&nbsp;be&nbsp;a&nbsp;bit&nbsp;confusing&nbsp;to&nbsp;have&nbsp;a&nbsp;variable&nbsp;with&nbsp;the&nbsp;same&nbsp;name&nbsp;as&nbsp;an&nbsp;exchange&nbsp;type.&lt;br&gt;<br>
&lt;br&gt;<br>
I&amp;#39;ve&nbsp;updated&nbsp;the&nbsp;example&nbsp;in&nbsp;Mercurial&nbsp;to&nbsp;use&nbsp;a&nbsp;different&nbsp;variable&nbsp;name&nbsp;so&nbsp;it&nbsp;now&nbsp;says:&lt;br&gt;<br>
&lt;br&gt;<br>
&nbsp;&amp;nbsp;...&lt;br&gt;<br>
&nbsp;&amp;nbsp;msg_topic&nbsp;=&nbsp;now.strftime(TOPIC_PATTERN)&lt;br&gt;<br>
&nbsp;&amp;nbsp;ch.basic_publish(msg,&nbsp;EXCHANGE_NAME,&nbsp;routing_key=msg_topic)&lt;br&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;<br>
&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;Barry&lt;br&gt;<br>
&lt;/font&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;<br>

</tt>
