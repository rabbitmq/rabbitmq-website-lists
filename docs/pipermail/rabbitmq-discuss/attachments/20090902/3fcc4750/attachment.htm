<tt>
Hi&nbsp;Ben,&lt;br&gt;&lt;br&gt;<br>
&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;The&nbsp;rabbit_memsup_linux&nbsp;module&nbsp;parses&nbsp;these&nbsp;values&nbsp;out&nbsp;of&nbsp;/proc/meminfo:&lt;br&gt;<br>
<br>
&amp;#39;MemTotal&amp;#39;,&nbsp;&amp;#39;MemFree&amp;#39;,&nbsp;&amp;#39;Buffers&amp;#39;,&nbsp;&amp;#39;Cached&amp;#39;&lt;br&gt;<br>
such&nbsp;that&lt;br&gt;<br>
MemUsed&nbsp;=&nbsp;MemTotal&nbsp;-&nbsp;MemFree&nbsp;-&nbsp;Buffers&nbsp;-&nbsp;Cached&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;Thanks&nbsp;for&nbsp;that..&lt;br&gt;&lt;br&gt;Hacked&nbsp;up&nbsp;the&nbsp;following&nbsp;script&nbsp;for&nbsp;Nagios&nbsp;so&nbsp;I&nbsp;could&nbsp;keep&nbsp;an&nbsp;eye&nbsp;on&nbsp;memory&nbsp;approaching&nbsp;threshold..&lt;br&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;<br>
<br>
&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;#!/bin/bash&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;STATE_OK=0&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;<br>
<br>
&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;STATE_WARNING=1&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;STATE_CRITICAL=2&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;<br>
<br>
&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;STATE_UNKNOWN=3&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;STATE_DEPENDENT=4&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;<br>
<br>
&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;MEMTOTAL=&amp;quot;`grep&nbsp;&amp;quot;^MemTotal:&nbsp;&amp;quot;&nbsp;/proc/meminfo&nbsp;|\&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;       &nbsp;awk&nbsp;&amp;#39;{print&nbsp;$2}&amp;#39;`&amp;quot;&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;<br>
<br>
&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;MEMFREEEQN=&amp;quot;`egrep&nbsp;&amp;quot;^(MemTotal|MemFree|Buffers|Cached):&amp;quot;&nbsp;/proc/meminfo&nbsp;|\&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;<br>
<br>
&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;       &nbsp;awk&nbsp;&amp;#39;{print&nbsp;$1&nbsp;&amp;quot;&nbsp;&amp;quot;&nbsp;$2}&amp;#39;&nbsp;|\&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;       &nbsp;sed&nbsp;-r&nbsp;&amp;#39;s/^MemTotal:/+/g&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;<br>
<br>
&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;               &nbsp;s/^(MemFree|Buffers|Cached):/-/g&amp;#39;`&amp;quot;&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;MEMFREE=&amp;quot;$((&nbsp;${MEMFREEEQN}&nbsp;))&amp;quot;&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;<br>
<br>
&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;MEMPCFREE=&amp;quot;$((&nbsp;(&nbsp;${MEMFREE}&nbsp;*&nbsp;100&nbsp;)&nbsp;/&nbsp;${MEMTOTAL}&nbsp;))&amp;quot;&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;MEMPCFREECRIT=5&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;<br>
<br>
&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;MEMPCFREEWARN=10&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;if&nbsp;[&nbsp;${MEMPCFREE}&nbsp;-gt&nbsp;${MEMPCFREEWARN}&nbsp;];&nbsp;then&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;<br>
<br>
&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;       &nbsp;echo&nbsp;&amp;quot;OK:&nbsp;${MEMFREE}&nbsp;(${MEMPCFREE}%)&nbsp;&amp;gt;&nbsp;${MEMPCFREEWARN}%&nbsp;free&amp;quot;&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;       &nbsp;exit&nbsp;$STATE_OK&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;<br>
<br>
&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;elif&nbsp;[&nbsp;${MEMPCFREE}&nbsp;-gt&nbsp;${MEMPCFREECRIT}&nbsp;];&nbsp;then&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;       &nbsp;echo&nbsp;&amp;quot;WARNING:&nbsp;${MEMPCFREECRIT}%&nbsp;&amp;lt;&nbsp;${MEMFREE}&nbsp;(${MEMPCFREE}%)&nbsp;&amp;lt;&nbsp;${MEMPCFREEWARN}%&amp;quot;&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;<br>
<br>
&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;       &nbsp;exit&nbsp;$STATE_WARNING&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;elif&nbsp;[&nbsp;${MEMPCFREE}&nbsp;-le&nbsp;${MEMPCFREECRIT}&nbsp;];&nbsp;then&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;<br>
<br>
&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;       &nbsp;echo&nbsp;&amp;quot;CRITICAL:&nbsp;${MEMFREE}&nbsp;(${MEMPCFREE}%)&nbsp;&amp;lt;=&nbsp;${MEMPCFREECRIT}%&amp;quot;&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;       &nbsp;exit&nbsp;$STATE_CRITICAL&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;<br>
<br>
&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;fi&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;echo&nbsp;&amp;quot;UNKNOWN:&nbsp;Something&nbsp;went&nbsp;awry!&amp;quot;&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;<br>
<br>
&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;exit&nbsp;$STATE_UNKNOWN&lt;/span&gt;&lt;br&gt;&lt;br&gt;This&amp;#39;ll&nbsp;let&nbsp;me&nbsp;go&nbsp;hunt&nbsp;down&nbsp;issues&nbsp;before&nbsp;they&nbsp;start&nbsp;causing&nbsp;throttle&nbsp;problems.&nbsp;In&nbsp;the&nbsp;event&nbsp;others&nbsp;are&nbsp;interested,&nbsp;this&nbsp;is&nbsp;the&nbsp;quick&nbsp;check&nbsp;I&nbsp;use&nbsp;to&nbsp;see&nbsp;if&nbsp;AMQP&nbsp;daemon&nbsp;is&nbsp;contactable&nbsp;in&nbsp;Nagios...&lt;br&gt;<br>
&lt;br&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;define&nbsp;command{&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;       &nbsp;command_name   &nbsp;check_amqp&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;<br>
&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;       &nbsp;command_line   &nbsp;$USER1$/check_tcp&nbsp;-H&nbsp;$HOSTADDRESS$&nbsp;-p&nbsp;5672&nbsp;-d&nbsp;1&nbsp;-E&nbsp;-s&nbsp;&amp;#39;AMQP\r\n\r\n\r\n&amp;#39;&nbsp;-e&nbsp;&amp;#39;AMQP&amp;#39;&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;<br>
&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;       &nbsp;}&lt;/span&gt;&lt;br&gt;&lt;br&gt;(Wait&nbsp;1&nbsp;second,&nbsp;send&nbsp;&amp;quot;AMQP&amp;quot;&nbsp;followed&nbsp;by&nbsp;three&nbsp;EOL&nbsp;sequences&nbsp;and&nbsp;expect&nbsp;the&nbsp;string&nbsp;&amp;quot;AMQP&amp;quot;&nbsp;returned)&lt;br&gt;&lt;br&gt;<br>

</tt>
