<tt>
k,&nbsp;&lt;br&gt;&lt;br&gt;So&nbsp;i&nbsp;think&nbsp;you&nbsp;are&nbsp;agreeing&nbsp;with&nbsp;me&nbsp;that&nbsp;when&nbsp;I&nbsp;call&nbsp;...&nbsp;new&nbsp;ConnectionFactory().CreateConnection(&amp;quot;localhost:5672&amp;quot;)...&lt;br&gt;&lt;br&gt;that&nbsp;I&nbsp;am&nbsp;using&nbsp;the&nbsp;same&nbsp;socket&nbsp;over&nbsp;and&nbsp;over&nbsp;again,&nbsp;but&nbsp;creating&nbsp;new&nbsp;connections&nbsp;to&nbsp;it...&lt;br&gt;<br>
&lt;br&gt;The&nbsp;following...&nbsp;&amp;quot;Error:&nbsp;RabbitMQ.Client.ConnectionFactory.cs&nbsp;-&nbsp;&amp;quot;Only&nbsp;one&nbsp;usage&nbsp;of&nbsp;each&nbsp;socket&nbsp;address&nbsp;(protocol/network&nbsp;address/port)&nbsp;is&nbsp;normally&nbsp;permitted&amp;quot;...&lt;br&gt;&lt;br&gt;Is&nbsp;not&nbsp;a&nbsp;result&nbsp;of&nbsp;exhausting&nbsp;all&nbsp;available&nbsp;sockets&nbsp;on&nbsp;the&nbsp;system,&nbsp;its&nbsp;a&nbsp;result&nbsp;of&nbsp;TCP&nbsp;being&nbsp;unable&nbsp;to&nbsp;dispose&nbsp;fast&nbsp;enough...&nbsp;so&nbsp;even&nbsp;though&nbsp;I&nbsp;have&nbsp;already&nbsp;closed&nbsp;the&nbsp;socket&nbsp;explicitly&nbsp;the&nbsp;system&nbsp;has&nbsp;not&nbsp;disposed&nbsp;of&nbsp;it&nbsp;yet,&nbsp;so&nbsp;it&nbsp;thinks&nbsp;I&nbsp;am&nbsp;trying&nbsp;to&nbsp;reuse&nbsp;the&nbsp;same&nbsp;socket...&nbsp;(This&nbsp;is&nbsp;confirmed&nbsp;using&nbsp;the&nbsp;debugger&nbsp;&amp;amp;&nbsp;wireshark&nbsp;(packetsniffer)...&lt;br&gt;<br>
&lt;br&gt;Additionally,&nbsp;this&nbsp;only&nbsp;occurs&nbsp;after&nbsp;thousands&nbsp;of&nbsp;consecutive&nbsp;calls&nbsp;to&nbsp;the&nbsp;PublishMessage&nbsp;method&nbsp;i&nbsp;posted&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;this&nbsp;thread...&lt;br&gt;&lt;br&gt;So...&lt;br&gt;&lt;br&gt;Taking&nbsp;your&nbsp;suggestion&nbsp;to&nbsp;make&nbsp;IModel&nbsp;and&nbsp;IConnection&nbsp;module&nbsp;level,&nbsp;my&nbsp;threaded&nbsp;PublishMessage&nbsp;method&nbsp;now&nbsp;looks&nbsp;like&nbsp;the&nbsp;following...&nbsp;&lt;br&gt;<br>
&lt;br&gt;&nbsp;public&nbsp;void&nbsp;PublishMessage(string&nbsp;pstrExchangeName,&nbsp;string&nbsp;pstrReturnKey,&nbsp;string&nbsp;pstrXml)&lt;br&gt;       &nbsp;{&lt;br&gt;           &nbsp;try&lt;br&gt;           &nbsp;{&lt;br&gt;               &nbsp;if&nbsp;(null&nbsp;==&nbsp;m_Conn)&lt;br&gt;               &nbsp;{&lt;br&gt;                   &nbsp;m_Conn&nbsp;=&nbsp;new&nbsp;ConnectionFactory().CreateConnection(m_strRabbitMqHost);&lt;br&gt;<br>
               &nbsp;}&lt;br&gt;&lt;br&gt;               &nbsp;if&nbsp;(null&nbsp;==&nbsp;m_Channel)&lt;br&gt;               &nbsp;{&lt;br&gt;                   &nbsp;m_Channel&nbsp;=&nbsp;m_Conn.CreateModel();&lt;br&gt;               &nbsp;}&lt;br&gt;&lt;br&gt;               &nbsp;IBasicProperties&nbsp;props&nbsp;=&nbsp;m_Channel.CreateBasicProperties();&lt;br&gt;<br>
               &nbsp;IStreamMessageBuilder&nbsp;b&nbsp;=&nbsp;new&nbsp;StreamMessageBuilder(m_Channel);&lt;br&gt;               &nbsp;byte[]&nbsp;bytes&nbsp;=&nbsp;Encoding.UTF8.GetBytes(pstrXml);&lt;br&gt;               &nbsp;b.WriteBytes(bytes);&lt;br&gt;               &nbsp;m_Channel.BasicPublish(pstrExchangeName,&nbsp;pstrReturnKey,&nbsp;null,&nbsp;bytes);&lt;br&gt;<br>
           &nbsp;}&lt;br&gt;&lt;br&gt;         &nbsp;catch(Exception&nbsp;ex)&lt;br&gt;         &nbsp;{&lt;br&gt;                &nbsp;throw&nbsp;ex;&lt;br&gt;         &nbsp;}&lt;br&gt;&lt;br&gt;so&nbsp;the&nbsp;error&nbsp;is&nbsp;fixed,&nbsp;but...&nbsp;I&nbsp;still&nbsp;cannot&nbsp;even&nbsp;come&nbsp;close&nbsp;to&nbsp;the&nbsp;4000&nbsp;messages&nbsp;per&nbsp;second&nbsp;capability&nbsp;(with&nbsp;better&nbsp;then&nbsp;twice&nbsp;the&nbsp;hardware)&nbsp;described&nbsp;at:&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://www.rabbitmq.com/faq.html&quot;&gt;http://www.rabbitmq.com/faq.html&lt;/a&gt;&lt;br&gt;&lt;br&gt;Q.&nbsp;How&nbsp;fast&nbsp;is&nbsp;RabbitMQ&nbsp;in&nbsp;persistent&nbsp;mode?&lt;br&gt;&lt;br&gt;A.&nbsp;From&nbsp;our&nbsp;testing,&nbsp;we&nbsp;expect&nbsp;easily-achievable&nbsp;throughputs&nbsp;of&nbsp;4000&nbsp;persistent,&nbsp;non-transacted&nbsp;one-kilobyte&nbsp;messages&nbsp;per&nbsp;second&nbsp;(Intel&nbsp;Pentium&nbsp;D,&nbsp;2.8GHz,&nbsp;dual&nbsp;core,&nbsp;gigabit&nbsp;ethernet)&nbsp;from&nbsp;a&nbsp;single&nbsp;RabbitMQ&nbsp;broker&nbsp;node&nbsp;writing&nbsp;to&nbsp;a&nbsp;single&nbsp;spindle.&nbsp;&lt;br&gt;<br>
&lt;br&gt;so&nbsp;what&nbsp;kind&nbsp;of&nbsp;tcp&nbsp;configuration&nbsp;tweaks&nbsp;or&nbsp;otherwise&nbsp;did&nbsp;you&nbsp;guys&nbsp;have&nbsp;to&nbsp;make&nbsp;to&nbsp;accomplish&nbsp;this?&lt;br&gt;&lt;br&gt;I&nbsp;am&nbsp;getting&nbsp;about&nbsp;10%&nbsp;of&nbsp;that&nbsp;advertised&nbsp;4000&nbsp;per&nbsp;second&nbsp;capability...&lt;br&gt;&lt;br&gt;thanks&nbsp;in&nbsp;advance.&lt;br&gt;&lt;br&gt;
</tt>
