<tt>
Updated&nbsp;to&amp;nbsp;amqp-client&nbsp;3.1.0&nbsp;but&nbsp;still&nbsp;same&nbsp;problem.&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Tried&nbsp;to&nbsp;close&nbsp;channel&nbsp;instead&nbsp;od&nbsp;basicCancel..&nbsp;same&nbsp;problem.&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;br&gt;On&nbsp;Tuesday,&nbsp;May&nbsp;21,&nbsp;2013&nbsp;4:02:59&nbsp;PM&nbsp;UTC-7,&nbsp;Kristian&nbsp;Lind&nbsp;wrote:&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:&nbsp;0;margin-left:&nbsp;0.8ex;border-left:&nbsp;1px&nbsp;#ccc&nbsp;solid;padding-left:&nbsp;1ex;&quot;&gt;&lt;div&gt;&amp;lt;dependency&amp;gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;&amp;lt;groupId&amp;gt;com.rabbitmq&amp;lt;/&lt;wbr&gt;groupId&amp;gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;&amp;lt;artifactId&amp;gt;amqp-client&amp;lt;/&lt;wbr&gt;artifactId&amp;gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;&amp;lt;version&amp;gt;3.0.4&amp;lt;/version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;lt;/dependency&amp;gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(68,68,68);font-family:Verdana,sans-serif;font-size:12px;text-align:right&quot;&gt;RabbitMQ&nbsp;3.0.2,&nbsp;Erlang&nbsp;R16A&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(68,68,68);font-family:Verdana,sans-serif;font-size:12px;text-align:right&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(68,68,68);font-family:Verdana,sans-serif;font-size:12px;text-align:right&quot;&gt;I&nbsp;have&nbsp;a&nbsp;webpage&nbsp;that&nbsp;has&nbsp;a&nbsp;start&nbsp;button&nbsp;and&nbsp;a&nbsp;stop&nbsp;button.&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(68,68,68);font-family:Verdana,sans-serif;font-size:12px;text-align:right&quot;&gt;These&nbsp;to&nbsp;buttons&nbsp;should&nbsp;start&nbsp;and&nbsp;stop&nbsp;the&nbsp;consuming&nbsp;messages.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(68,68,68);font-family:Verdana,sans-serif;font-size:12px;text-align:right&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(68,68,68);font-family:Verdana,sans-serif;font-size:12px;text-align:right&quot;&gt;When&nbsp;the&nbsp;user&nbsp;presses&nbsp;start&nbsp;button&nbsp;the&nbsp;consuming&nbsp;starts...&nbsp;when&nbsp;the&nbsp;user&nbsp;presses&nbsp;the&nbsp;stop&nbsp;button&nbsp;the&nbsp;consuming&nbsp;stops&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(68,68,68);font-family:Verdana,sans-serif;font-size:12px;text-align:right&quot;&gt;BUT..&nbsp;the&nbsp;user&nbsp;cannot&nbsp;start&nbsp;the&nbsp;consuming&nbsp;again.&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(68,68,68);font-family:Verdana,sans-serif;font-size:12px;text-align:right&quot;&gt;While&nbsp;debugging&nbsp;the&nbsp;code,&nbsp;I&nbsp;see&nbsp;the&nbsp;method&nbsp;call&amp;nbsp;&lt;/span&gt;&lt;font&nbsp;color=&quot;#444444&quot;&nbsp;face=&quot;Verdana,&nbsp;sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12px&quot;&gt;channel.basicCancel&nbsp;hangs...&nbsp;and&nbsp;the&nbsp;debugger&nbsp;stops...&amp;nbsp;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;color=&quot;#444444&quot;&nbsp;face=&quot;Verdana,&nbsp;sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12px&quot;&gt;When&nbsp;I&nbsp;stop&nbsp;the&nbsp;JBoss&nbsp;server&nbsp;where&nbsp;the&nbsp;application&nbsp;is&nbsp;deployd&nbsp;I&nbsp;see&nbsp;this&nbsp;exception&nbsp;coming&nbsp;in&nbsp;the&nbsp;catch&nbsp;when&nbsp;doing&amp;nbsp;channel.basicCancel.&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-size:12px;color:rgb(68,68,68);font-family:Verdana,sans-serif;text-align:right&quot;&gt;com.rabbitmq.client.&lt;wbr&gt;ShutdownSignalException:&nbsp;clean&nbsp;channel&nbsp;shutdown;&nbsp;reason:&nbsp;#method&amp;lt;channel.close&amp;gt;(reply-&lt;wbr&gt;code=200,&nbsp;reply-text=OK,&nbsp;class-id=0,&nbsp;method-id=0)&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;text-align:right&quot;&gt;&lt;font&nbsp;color=&quot;#444444&quot;&nbsp;face=&quot;Verdana,&nbsp;sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12px&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;text-align:start&quot;&gt;&lt;span&nbsp;style=&quot;text-align:right&quot;&gt;&lt;font&nbsp;color=&quot;#444444&quot;&nbsp;face=&quot;Verdana,&nbsp;sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12px&quot;&gt;And&nbsp;in&nbsp;the&nbsp;method&amp;nbsp;&lt;/span&gt;&lt;/font&gt;&lt;/span&gt;&lt;font&nbsp;color=&quot;#444444&quot;&nbsp;face=&quot;Verdana,&nbsp;sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12px&quot;&gt;handleDelivery&nbsp;I&nbsp;see&amp;nbsp;ShutdownSignalException...&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;text-align:start&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12px;color:rgb(68,68,68);font-family:Verdana,sans-serif;text-align:right&quot;&gt;com.rabbitmq.client.&lt;wbr&gt;AlreadyClosedException:&nbsp;clean&nbsp;connection&nbsp;shutdown;&nbsp;reason:&nbsp;Attempt&nbsp;to&nbsp;use&nbsp;closed&nbsp;channe&lt;/span&gt;&lt;span&nbsp;style=&quot;text-align:right&quot;&gt;l&lt;/span&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;text-align:start&quot;&gt;&lt;span&nbsp;style=&quot;text-align:right&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;text-align:start&quot;&gt;&lt;span&nbsp;style=&quot;text-align:right&quot;&gt;The&nbsp;call&nbsp;to&amp;nbsp;&lt;/span&gt;basicCancel&nbsp;only&nbsp;hangs&nbsp;when&nbsp;consuming&nbsp;is&nbsp;going&nbsp;on..&nbsp;if&nbsp;I&nbsp;start&nbsp;the&nbsp;consuming,&nbsp;but&nbsp;no&nbsp;messages&nbsp;are&nbsp;on&nbsp;the&nbsp;queue,&nbsp;I&nbsp;can&nbsp;stop&nbsp;it..&nbsp;and&nbsp;start&nbsp;it&nbsp;again.&amp;nbsp;&lt;/div&gt;&lt;div&nbsp;style=&quot;text-align:start&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;text-align:start&quot;&gt;&lt;div&gt;@Override&lt;/div&gt;&lt;div&gt;protected&nbsp;final&nbsp;synchronized&nbsp;void&nbsp;service(final&nbsp;HttpServletRequest&nbsp;req,&nbsp;final&nbsp;HttpServletResponse&nbsp;resp)&nbsp;throws&nbsp;ServletException,&nbsp;IOException&nbsp;{&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;String&nbsp;task&nbsp;=&nbsp;req.getParameter(&quot;task&quot;);&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;...&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;if&nbsp;(StringUtils.isNotBlank(task)&nbsp;&amp;amp;&amp;amp;&nbsp;task.equals(&quot;stop&quot;))&nbsp;{&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;consuming&nbsp;=&nbsp;false;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;try&nbsp;{&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;channel.basicCancel(&quot;&lt;wbr&gt;MonitorConsumer&quot;);&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;}&nbsp;catch&nbsp;(Exception&nbsp;e)&nbsp;{&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;e.printStackTrace();&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;}&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;}&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;}&nbsp;else&nbsp;{&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;if&nbsp;(connection&nbsp;==&nbsp;null&nbsp;||&nbsp;channel&nbsp;==&nbsp;null)&nbsp;{&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;createRabbitConnection();&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;}&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;if&nbsp;(!consuming)&nbsp;{&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;channel.basicConsume(&lt;wbr&gt;Configuration.QUEUE_JSI_TO_&lt;wbr&gt;DASHBOARD,&nbsp;false,&nbsp;&quot;MonitorConsumer&quot;,&nbsp;this);&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;consuming&nbsp;=&nbsp;true;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;}&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;}&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;public&nbsp;synchronized&nbsp;void&nbsp;handleDelivery(String&nbsp;consumerTag,&nbsp;Envelope&nbsp;envelope,&nbsp;BasicProperties&nbsp;properties,&nbsp;byte[]&nbsp;body)&nbsp;throws&nbsp;IOException&nbsp;{&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;...&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;try&nbsp;{&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;channel.basicAck(deliveryTag,&nbsp;false);&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;}&nbsp;catch&nbsp;(ShutdownSignalException&nbsp;e)&nbsp;{&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;e.printStackTrace();&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;}&lt;/div&gt;&lt;div&gt;}&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;text-align:right&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;text-align:right&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;text-align:right&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(68,68,68);font-family:Verdana,sans-serif;font-size:12px;text-align:right&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(68,68,68);font-family:Verdana,sans-serif;font-size:12px;text-align:right&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(68,68,68);font-family:Verdana,sans-serif;font-size:12px;text-align:right&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;
</tt>
