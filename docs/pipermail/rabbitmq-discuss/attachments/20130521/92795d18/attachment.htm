<tt>
Hi,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;We&nbsp;operate&nbsp;two&nbsp;dual-node&nbsp;brokers,&nbsp;each&nbsp;broker&nbsp;having&nbsp;quite&nbsp;different&nbsp;queues&nbsp;and&nbsp;workloads.&nbsp;Each&nbsp;box&nbsp;has&nbsp;24&nbsp;cores&nbsp;(H/T)&nbsp;worth&nbsp;of&nbsp;Xeon&nbsp;E5645&nbsp;@&nbsp;2.4GHz&nbsp;with&nbsp;48GB&nbsp;RAM,&nbsp;connected&nbsp;by&nbsp;Gigabit&nbsp;LAN&nbsp;with&nbsp;~150Î¼s&nbsp;latency,&nbsp;running&nbsp;RHEL&nbsp;5.6,&nbsp;RabbitMQ&nbsp;3.1,&nbsp;Erlang&nbsp;R16B&nbsp;with&nbsp;HiPE&nbsp;off.&nbsp;We've&nbsp;tried&nbsp;with&nbsp;HiPE&nbsp;on&nbsp;but&nbsp;it&nbsp;made&nbsp;no&nbsp;noticeable&nbsp;performance&nbsp;impact,&nbsp;and&nbsp;was&nbsp;very&nbsp;crashy.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;We&nbsp;appear&nbsp;to&nbsp;have&nbsp;hit&nbsp;a&nbsp;ceiling&nbsp;for&nbsp;our&nbsp;message&nbsp;rates&nbsp;of&nbsp;between&nbsp;1,000/s&nbsp;and&nbsp;1,400/s&nbsp;both&nbsp;in&nbsp;and&nbsp;out.&nbsp;This&nbsp;is&nbsp;broker-wide,&nbsp;not&nbsp;per-queue.&nbsp;Adding&nbsp;more&nbsp;consumers&nbsp;doesn't&nbsp;improve&nbsp;throughput&nbsp;overall,&nbsp;just&nbsp;gives&nbsp;that&nbsp;particular&nbsp;queue&nbsp;a&nbsp;bigger&nbsp;slice&nbsp;of&nbsp;this&nbsp;apparent&nbsp;&quot;pool&quot;&nbsp;of&nbsp;resource.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Every&nbsp;queue&nbsp;is&nbsp;mirrored&nbsp;across&nbsp;the&nbsp;two&nbsp;nodes&nbsp;that&nbsp;make&nbsp;up&nbsp;the&nbsp;broker.&nbsp;Our&nbsp;publishers&nbsp;and&nbsp;consumers&nbsp;connect&nbsp;equally&nbsp;to&nbsp;both&nbsp;nodes&nbsp;in&nbsp;a&nbsp;persistant&nbsp;way.&nbsp;We&nbsp;notice&nbsp;an&nbsp;ADSL-like&nbsp;asymmetry&nbsp;in&nbsp;the&nbsp;rates&nbsp;too;&nbsp;if&nbsp;we&nbsp;manage&nbsp;to&nbsp;publish&nbsp;a&nbsp;high&nbsp;rate&nbsp;of&nbsp;messages&nbsp;the&nbsp;deliver&nbsp;rate&nbsp;drops&nbsp;to&nbsp;high&nbsp;double&nbsp;digits.&nbsp;Testing&nbsp;with&nbsp;an&nbsp;un-mirrored&nbsp;queue&nbsp;has&nbsp;much&nbsp;higher&nbsp;throughput,&nbsp;as&nbsp;expected.&nbsp;Queues&nbsp;and&nbsp;Exchanges&nbsp;are&nbsp;durable,&nbsp;messages&nbsp;are&nbsp;not&nbsp;persistent.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;We'd&nbsp;like&nbsp;to&nbsp;know&nbsp;what&nbsp;we&nbsp;can&nbsp;do&nbsp;to&nbsp;improve&nbsp;the&nbsp;situation.&nbsp;The&nbsp;CPU&nbsp;on&nbsp;the&nbsp;box&nbsp;is&nbsp;fine,&nbsp;beam&nbsp;takes&nbsp;a&nbsp;core&nbsp;and&nbsp;a&nbsp;half&nbsp;for&nbsp;1&nbsp;process,&nbsp;then&nbsp;another&nbsp;80%&nbsp;each&nbsp;of&nbsp;two&nbsp;cores&nbsp;for&nbsp;another&nbsp;couple&nbsp;of&nbsp;processes.&nbsp;The&nbsp;rest&nbsp;of&nbsp;the&nbsp;box&nbsp;is&nbsp;essentially&nbsp;idle.&nbsp;We&nbsp;are&nbsp;using&nbsp;~20GB&nbsp;of&nbsp;RAM&nbsp;in&nbsp;userland&nbsp;with&nbsp;system&nbsp;cache&nbsp;filling&nbsp;the&nbsp;rest.&nbsp;IO&nbsp;rates&nbsp;are&nbsp;fine.&nbsp;Network&nbsp;is&nbsp;fine.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Is&nbsp;there&nbsp;any&nbsp;Erlang/OTP&nbsp;tuning&nbsp;we&nbsp;can&nbsp;do?&nbsp;delegate_count&nbsp;is&nbsp;the&nbsp;default&nbsp;16,&nbsp;could&nbsp;someone&nbsp;explain&nbsp;what&nbsp;this&nbsp;does&nbsp;in&nbsp;a&nbsp;bit&nbsp;more&nbsp;detail&nbsp;please?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Any&nbsp;thoughts&nbsp;anyone&nbsp;has&nbsp;on&nbsp;this&nbsp;would&nbsp;be&nbsp;much&nbsp;appreciated.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Many&nbsp;thanks,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Paul&nbsp;Bowsher&lt;/div&gt;&lt;div&gt;Senior&nbsp;Software&nbsp;Engineer&lt;/div&gt;&lt;div&gt;Globaldev&lt;/div&gt;
</tt>
