<tt>
&lt;html&gt;<br>
&nbsp;&nbsp;&lt;head&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;http-equiv=&quot;content-type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=ISO-8859-1&quot;&gt;<br>
&nbsp;&nbsp;&lt;/head&gt;<br>
&nbsp;&nbsp;&lt;body&nbsp;bgcolor=&quot;#FFFFFF&quot;&nbsp;text=&quot;#000000&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Hello.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;I&nbsp;have&nbsp;some&nbsp;unpleasant&nbsp;issues&nbsp;while&nbsp;clustering&nbsp;disc&nbsp;nodes.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Two&nbsp;brokers&nbsp;located&nbsp;on&nbsp;two&nbsp;hosts.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Steps&nbsp;to&nbsp;reproduce:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;1.&nbsp;Cluster&nbsp;&lt;b&gt;second&lt;/b&gt;&nbsp;machine&nbsp;&lt;b&gt;with&nbsp;first&lt;/b&gt;&nbsp;as&nbsp;disc&nbsp;node.<br>
&nbsp;&nbsp;&nbsp;&nbsp;(RABBITMQ_NODENAME=wosnfs).&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;tt&gt;[root@epbyminw2482t3&nbsp;~]#&amp;nbsp;&nbsp;rabbitmqctl&nbsp;stop_app&nbsp;&amp;amp;&amp;amp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rabbitmqctl&nbsp;reset&nbsp;&amp;amp;&amp;amp;&nbsp;rabbitmqctl&nbsp;cluster&nbsp;wosnfs@`hostname<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-s`&nbsp;wosnfs@epbyminw2482t2&nbsp;&amp;amp;&amp;amp;&nbsp;rabbitmqctl&nbsp;start_app&lt;/tt&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;2.&nbsp;Remove&nbsp;first&nbsp;node&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;tt&gt;[root@epbyminw2482t2]#&nbsp;rabbitmqctl&nbsp;stop_app&nbsp;&amp;amp;&amp;amp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rabbitmqctl&nbsp;cluster&nbsp;wosnfs@`hostname&nbsp;-s`&nbsp;&amp;amp;&amp;amp;&nbsp;rabbitmqctl<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reset&nbsp;&amp;amp;&amp;amp;&nbsp;rabbitmqctl&nbsp;start_app&lt;/tt&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;3.&nbsp;Restart&nbsp;rabbitmq-server&nbsp;service&nbsp;on&nbsp;second&nbsp;node.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;tt&gt;[root@epbyminw2482t3&nbsp;~]#&nbsp;service&nbsp;rabbitmq-server&nbsp;restart&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Restarting&nbsp;rabbitmq-server:&nbsp;FAILED&nbsp;-&nbsp;check<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/var/log/rabbitmq/startup_{log,&nbsp;_err}&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rabbitmq-server.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[root@epbyminw2482t3&nbsp;~]#&nbsp;cat&nbsp;/var/log/rabbitmq/startup_err&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Erlang&nbsp;has&nbsp;closed&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Crash&nbsp;dump&nbsp;was&nbsp;written&nbsp;to:&nbsp;erl_crash.dump&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Kernel&nbsp;pid&nbsp;terminated&nbsp;(application_controller)<br>
({application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}})&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[root@epbyminw2482t3&nbsp;~]#&nbsp;cat&nbsp;/var/log/rabbitmq/startup_log&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Activating&nbsp;RabbitMQ&nbsp;plugins&nbsp;...&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;plugins&nbsp;activated:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;i&gt;&amp;lt;-CUT-&amp;gt;&lt;/i&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;erlang&nbsp;version&nbsp;:&nbsp;5.8.4&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;rabbit&nbsp;boot&nbsp;start&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;starting&nbsp;file&nbsp;handle&nbsp;cache<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;server&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;...done&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;starting&nbsp;worker<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pool&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;...done&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;starting<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;database&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...BOOT&nbsp;ERROR:&nbsp;FAILED&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Reason:&nbsp;{error,&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;{unable_to_join_cluster,&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;[wosnfs@epbyminw2482t3,wosnfs@epbyminw2482t2],&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;{merge_schema_failed,&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&quot;Bad&nbsp;cookie&nbsp;in&nbsp;table&nbsp;definition<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mirrored_sup_childspec:&nbsp;wosnfs@epbyminw2482t3&nbsp;=<br>
{cstruct,mirrored_sup_childspec,ordered_set,[wosnfs@epbyminw2482t3],[],[],0,read_write,false,[],[],false,mirrored_sup_childspec,[key,mirroring_pid,childspec],[],[],{{1327,663993,999525},&lt;b&gt;wosnfs@epbyminw2482t2&lt;/b&gt;},{{3,1},{wosnfs@epbyminw2482t3,{1327,664433,471064}}}},<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;b&gt;wosnfs@epbyminw2482t2&lt;/b&gt;&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{cstruct,mirrored_sup_childspec,ordered_set,[&lt;b&gt;wosnfs@epbyminw2482t2&lt;/b&gt;],[],[],0,read_write,false,[],[],false,mirrored_sup_childspec,[key,mirroring_pid,childspec],[],[],{{1327,664434,761441},&lt;b&gt;wosnfs@epbyminw2482t2&lt;/b&gt;},{{2,0},[]}}\n&quot;}}}&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Stacktrace:&nbsp;[{rabbit_mnesia,init_db,3},&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;{rabbit_mnesia,init,0},&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;{rabbit,'-run_boot_step/1-lc$^1/1-1-',1},&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;{rabbit,run_boot_step,1},&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;{rabbit,'-start/2-lc$^0/1-0-',1},&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;{rabbit,start,2},&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;{application_master,start_it_old,4}]&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&quot;Kernel&nbsp;pid<br>
terminated&quot;,application_controller,&quot;{application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}}&quot;}&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tt&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;All&nbsp;commands&nbsp;finished&nbsp;successfully&nbsp;except&nbsp;the&nbsp;last.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Could&nbsp;you&nbsp;help&nbsp;me&nbsp;to&nbsp;find&nbsp;out&nbsp;what&nbsp;kind&nbsp;of&nbsp;error&nbsp;appeared&nbsp;and&nbsp;why?&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;It&nbsp;seems&nbsp;that&nbsp;first&nbsp;node&nbsp;(epbyminw2482t2)&nbsp;has&nbsp;already&nbsp;been&nbsp;removed<br>
&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;the&nbsp;cluster,&nbsp;why&nbsp;some&nbsp;information&nbsp;about&nbsp;the&nbsp;one&nbsp;left&nbsp;in&nbsp;mnesia<br>
&nbsp;&nbsp;&nbsp;&nbsp;on&nbsp;another&nbsp;node&nbsp;and&nbsp;appears&nbsp;in&nbsp;error&nbsp;log?&nbsp;I&nbsp;suppose&nbsp;that&nbsp;that<br>
&nbsp;&nbsp;&nbsp;&nbsp;correct&nbsp;removing&nbsp;of&nbsp;any&nbsp;node&nbsp;from&nbsp;cluster&nbsp;should&nbsp;not&nbsp;influence&nbsp;on<br>
&nbsp;&nbsp;&nbsp;&nbsp;others.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Problem&nbsp;is&nbsp;reproducible&nbsp;with&nbsp;arbitrary&nbsp;number&nbsp;of&nbsp;disc&nbsp;nodes.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;It&nbsp;is&nbsp;interesting,&nbsp;that&nbsp;if&nbsp;we&nbsp;change&nbsp;an&nbsp;order&nbsp;joining&nbsp;to&nbsp;cluster&nbsp;-<br>
&nbsp;&nbsp;&nbsp;&nbsp;join&nbsp;first&nbsp;node&nbsp;to&nbsp;second,&amp;nbsp;&nbsp;then&nbsp;no&nbsp;error&nbsp;will&nbsp;appear.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Environment:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;CentOS&nbsp;6.0&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Erlang&nbsp;R1403&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;RabbitMQ&nbsp;2.7.1&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;--&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Best&nbsp;regards,&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Artsiom&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
