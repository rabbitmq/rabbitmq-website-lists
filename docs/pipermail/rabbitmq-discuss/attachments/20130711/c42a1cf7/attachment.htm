<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi&nbsp;Matthias,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;There&nbsp;is&nbsp;no&nbsp;other&nbsp;vhosts.&nbsp;I&nbsp;can&amp;#39;t&nbsp;keep&nbsp;the&nbsp;problem&nbsp;for&nbsp;investigation&nbsp;since&nbsp;it&nbsp;is&nbsp;a&nbsp;production&nbsp;server.&nbsp;&amp;quot;rabbitmqctl&nbsp;stop_app;&nbsp;rabbitmqctl&nbsp;start_app&amp;quot;&nbsp;frees&nbsp;the&nbsp;memory.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;am&nbsp;new&nbsp;to&nbsp;rabbit&nbsp;and&nbsp;this&nbsp;is&nbsp;just&nbsp;one&nbsp;of&nbsp;a&nbsp;series&nbsp;problems&nbsp;I&nbsp;meet.&nbsp;I&nbsp;am&nbsp;not&nbsp;sure&nbsp;whether&nbsp;it&nbsp;helps&nbsp;but&nbsp;I&nbsp;am&nbsp;going&nbsp;to&nbsp;list&nbsp;the&nbsp;problems&nbsp;I&nbsp;experienced&nbsp;to&nbsp;provide&nbsp;more&nbsp;context.&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;<br>
&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;Environment:&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&nbsp;style&gt;-&nbsp;Debian&nbsp;7.1&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;-&nbsp;A&nbsp;cluster&nbsp;with&nbsp;3&nbsp;servers&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;-&nbsp;A&nbsp;virtual&nbsp;ip&nbsp;is&nbsp;assigned&nbsp;to&nbsp;the&nbsp;servers,&nbsp;using&nbsp;keepalive&nbsp;to&nbsp;shift&nbsp;the&nbsp;virtual&nbsp;ip(automatic)&lt;br&gt;<br>
-&nbsp;use&nbsp;default&nbsp;exchange&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&nbsp;style&gt;-&nbsp;6&nbsp;queues&nbsp;(&lt;span&nbsp;style=&quot;font-family:arial,sans-serif;font-size:12.727272033691406px&quot;&gt;ha.snssdk.log,&amp;nbsp;&lt;/span&gt;&lt;span&nbsp;style=&quot;font-family:arial,sans-serif;font-size:12.727272033691406px&quot;&gt;ha.snssdk.log.dispatch,&amp;nbsp;&lt;/span&gt;&lt;span&nbsp;style=&quot;font-family:arial,sans-serif;font-size:12.727272033691406px&quot;&gt;ha.snssdk.log.output,&amp;nbsp;&lt;/span&gt;&lt;span&nbsp;style=&quot;font-family:arial,sans-serif;font-size:12.727272033691406px&quot;&gt;ssesion,&nbsp;session.log,&nbsp;session.output&lt;/span&gt;),&nbsp;queues&nbsp;whose&nbsp;name&nbsp;begin&nbsp;with&nbsp;&amp;#39;ha.&amp;#39;&nbsp;are&nbsp;mirrored&nbsp;queues&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;gmail_extra&quot;&nbsp;style&gt;-&nbsp;all&nbsp;queues&nbsp;and&nbsp;messages&nbsp;are&nbsp;none-durable&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&nbsp;style&gt;-&nbsp;message&nbsp;publish&nbsp;rate:&nbsp;4000&nbsp;~&nbsp;10000&nbsp;msg/s&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&nbsp;style&gt;<br>
Problems(with&nbsp;actions&nbsp;I&nbsp;took):&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&nbsp;style&gt;1.&nbsp;Initially&nbsp;use&nbsp;rabbit&nbsp;version&nbsp;3.1.1,&nbsp;the&nbsp;rabbit&nbsp;server&nbsp;crash&nbsp;with&nbsp;message&nbsp;like&nbsp;following&nbsp;sometime:&amp;nbsp;&lt;span&nbsp;style=&quot;font-family:arial,sans-serif;font-size:12.727272033691406px&quot;&gt;Slogan:&nbsp;std_alloc:&nbsp;Cannot&nbsp;allocate&nbsp;1119579832804544&nbsp;bytes&nbsp;of&nbsp;memory&nbsp;(of&nbsp;type&amp;nbsp;&lt;/span&gt;&lt;span&nbsp;style=&quot;font-size:12.727272033691406px;font-family:arial,sans-serif&quot;&gt;&amp;quot;arg_reg&amp;quot;).&lt;/span&gt;&amp;nbsp;&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;gmail_extra&quot;&nbsp;style&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;-&nbsp;action:&nbsp;upgrade&nbsp;both&nbsp;rabbit&nbsp;and&nbsp;erlang&nbsp;to&nbsp;the&nbsp;latest&nbsp;version.&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&nbsp;style&gt;2.&nbsp;rabbit&nbsp;take&nbsp;up&nbsp;to&nbsp;much&nbsp;memory&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&nbsp;style&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;-&nbsp;action:&nbsp;rabbitmqctl&nbsp;stop_app;&nbsp;rabbitmqctl&nbsp;start_app&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;gmail_extra&quot;&nbsp;style&gt;3.&nbsp;block&nbsp;on&nbsp;declaring&nbsp;queue&nbsp;&amp;#39;&lt;span&nbsp;style=&quot;font-family:arial,sans-serif;font-size:12.727272033691406px&quot;&gt;ha.snssdk.log.dispatch&lt;/span&gt;&amp;#39;,&nbsp;but&nbsp;it&nbsp;is&nbsp;OK&nbsp;to&nbsp;declare&nbsp;other&nbsp;queues,&nbsp;including&nbsp;&amp;#39;&lt;span&nbsp;style=&quot;font-family:arial,sans-serif;font-size:12.727272033691406px&quot;&gt;ha.snssdk.log.dispatch2&lt;/span&gt;&amp;#39;&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;gmail_extra&quot;&nbsp;style&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;-&nbsp;action:&nbsp;stop&nbsp;rabbit,&nbsp;remove&nbsp;mnesia&nbsp;folder,&nbsp;start&nbsp;rabbit&nbsp;and&nbsp;rebuild&nbsp;the&nbsp;cluster.&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&nbsp;style&gt;4.&nbsp;the&nbsp;management_plugin&nbsp;doesn&amp;#39;t&nbsp;work,&nbsp;with&nbsp;message&nbsp;like&nbsp;&amp;quot;&lt;span&nbsp;style=&quot;color:rgb(72,72,72);font-family:Verdana,sans-serif;font-size:12px&quot;&gt;TypeError:&nbsp;Cannot&nbsp;read&nbsp;property&nbsp;&amp;#39;connections&amp;#39;&nbsp;of&nbsp;undefined&lt;/span&gt;&amp;quot;&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;gmail_extra&quot;&nbsp;style&gt;&amp;nbsp;&nbsp;&amp;nbsp;-&nbsp;action:&nbsp;asking&nbsp;in&nbsp;maillist&nbsp;but&nbsp;no&nbsp;action&nbsp;is&nbsp;taken&nbsp;so&nbsp;far&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&nbsp;style&gt;5.&nbsp;though&nbsp;all&nbsp;the&nbsp;queues&nbsp;and&nbsp;messages&nbsp;are&nbsp;none-durable,&nbsp;and&nbsp;the&nbsp;memory&nbsp;consumption&nbsp;is&nbsp;far&nbsp;below&nbsp;configured&nbsp;by&nbsp;&amp;#39;vm_memory_high_watermark&amp;#39;,&nbsp;the&nbsp;mnesia&nbsp;folder&nbsp;sometimes&nbsp;can&nbsp;take&nbsp;up&nbsp;much&nbsp;space(e.g.&nbsp;19G),&nbsp;it&nbsp;is&nbsp;basically&nbsp;taken&nbsp;by&nbsp;&amp;#39;msg_store_transient&amp;#39;&nbsp;folder.&nbsp;I&nbsp;don&amp;#39;t&nbsp;understand&nbsp;why.&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;gmail_extra&quot;&nbsp;style&gt;&amp;nbsp;&nbsp;&amp;nbsp;-&nbsp;action:&nbsp;none&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&nbsp;style&gt;6.&nbsp;sometimes&nbsp;rabbit&nbsp;doesn&amp;#39;t&nbsp;push&nbsp;message&nbsp;to&nbsp;consumers&nbsp;in&nbsp;time:&nbsp;I&nbsp;found&nbsp;some&nbsp;consumers&nbsp;don&amp;#39;t&nbsp;get&nbsp;message&nbsp;from&nbsp;time&nbsp;to&nbsp;time&nbsp;even&nbsp;there&nbsp;are&nbsp;messages&nbsp;in&nbsp;the&nbsp;queue.&nbsp;But&nbsp;this&nbsp;seems&nbsp;to&nbsp;be&nbsp;transient&nbsp;(lasting&nbsp;for&nbsp;about&nbsp;1&nbsp;minute).&amp;nbsp;&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;gmail_extra&quot;&nbsp;style&gt;&amp;nbsp;&nbsp;&amp;nbsp;-&nbsp;action:&nbsp;none&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&nbsp;style&gt;Thanks.&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Thu,&nbsp;Jul&nbsp;11,&nbsp;2013&nbsp;at&nbsp;12:55&nbsp;AM,&nbsp;Matthias&nbsp;Radestock&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:matthias@rabbitmq.com&quot;&nbsp;target=&quot;_blank&quot;&gt;matthias@rabbitmq.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;&lt;div&nbsp;class=&quot;im&quot;&gt;On&nbsp;09/07/13&nbsp;15:59,&nbsp;Rubo&nbsp;Liang&nbsp;wrote:&lt;br&gt;<br>
&lt;/div&gt;&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;<br>
My&nbsp;rabbit&nbsp;eats&nbsp;25G&nbsp;memory,&nbsp;but&nbsp;the&nbsp;queues&nbsp;don&amp;#39;t&nbsp;take&nbsp;to&nbsp;much&nbsp;as&nbsp;shown&nbsp;by&lt;br&gt;<br>
this&nbsp;command:&nbsp;&amp;#39;rabbitmqctl&nbsp;list_queues&nbsp;name&nbsp;messages&nbsp;memory&amp;#39;:&lt;br&gt;<br>
Listing&nbsp;queues&nbsp;...&lt;br&gt;<br>
ha.snssdk.log&nbsp;&amp;nbsp;&nbsp;695954&nbsp;&amp;nbsp;16426216&lt;br&gt;<br>
ha.snssdk.log.dispatch&nbsp;&amp;nbsp;660748&nbsp;&amp;nbsp;102698808&lt;br&gt;<br>
ha.snssdk.log.output&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;63573&nbsp;&amp;nbsp;&nbsp;32800680&lt;br&gt;<br>
ssesion&nbsp;0&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;25952&lt;br&gt;<br>
ssesion.log&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;101&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;436328&lt;br&gt;<br>
ssesion.output&nbsp;&amp;nbsp;0&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;148816&lt;br&gt;<br>
...done.&lt;br&gt;<br>
&lt;br&gt;<br>
As&nbsp;shown&nbsp;above&nbsp;the&nbsp;queues&nbsp;only&nbsp;take&nbsp;about&nbsp;150M&nbsp;memory.&nbsp;But&nbsp;the&nbsp;rabbit&lt;br&gt;<br>
process&nbsp;actually&nbsp;takes&nbsp;about&nbsp;25G.&lt;br&gt;<br>
&lt;br&gt;<br>
&amp;#39;rabbitmqctl&nbsp;status&amp;#39;&nbsp;gives&nbsp;me&nbsp;following&nbsp;output&nbsp;on&nbsp;memory:&lt;br&gt;<br>
&lt;br&gt;<br>
&amp;nbsp;&nbsp;{memory,&lt;br&gt;<br>
&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;[{total,25394382848},&lt;br&gt;<br>
&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;{connection_procs,140253648},&lt;br&gt;<br>
&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;{queue_procs,19311874888},&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;&lt;/div&gt;<br>
So&nbsp;that&nbsp;shows&nbsp;queue&nbsp;processes&nbsp;taking&nbsp;up&nbsp;19G.&nbsp;Perhaps&nbsp;you&nbsp;have&nbsp;queue&amp;#39;s&nbsp;in&nbsp;vhosts&nbsp;other&nbsp;than&nbsp;&amp;#39;/&amp;#39;?&nbsp;Note&nbsp;that&nbsp;&amp;#39;rabbitmqctl&nbsp;list_queues&amp;#39;&nbsp;only&nbsp;shows&nbsp;information&nbsp;on&nbsp;one&nbsp;vhost&nbsp;(&amp;#39;/&amp;#39;&nbsp;by&nbsp;default).&lt;span&nbsp;class=&quot;&quot;&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;&lt;br&gt;<br>
<br>
&lt;br&gt;<br>
Matthias.&lt;br&gt;<br>
&lt;/font&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;--&nbsp;&lt;br&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;梁汝波&lt;div&gt;手机：+86-18600464396&lt;/div&gt;&lt;div&gt;地址：&lt;span&nbsp;style=&quot;color:rgb(0,0,0);font-family:Arial,Helvetica,FreeSans,sans-serif;font-size:13.63636302947998px;line-height:15.454545021057129px&quot;&gt;北京市海淀区知春路甲48号盈都大厦B座10层&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;font&nbsp;face=&quot;Arial,&nbsp;Helvetica,&nbsp;FreeSans,&nbsp;sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;line-height:17px&quot;&gt;邮编：100088&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;Arial,&nbsp;Helvetica,&nbsp;FreeSans,&nbsp;sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;line-height:17px&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
