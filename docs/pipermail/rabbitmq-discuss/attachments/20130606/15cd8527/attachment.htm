<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Thu,&nbsp;Jun&nbsp;6,&nbsp;2013&nbsp;at&nbsp;10:03&nbsp;AM,&nbsp;Ceri&nbsp;Storey&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:ceri@lshift.net&quot;&nbsp;target=&quot;_blank&quot;&gt;ceri@lshift.net&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;div&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;(06/06/13&nbsp;14:45),&nbsp;Sean&nbsp;Allen&nbsp;wrote:&lt;br&gt;<br>
&amp;gt;&nbsp;I&amp;#39;m&nbsp;trying&nbsp;to&nbsp;understand&nbsp;memory&nbsp;usage&nbsp;in&nbsp;rabbitmq.&nbsp;Pointers&nbsp;to&lt;br&gt;<br>
&amp;gt;&nbsp;relevant&nbsp;docs,&nbsp;salient&nbsp;comments&nbsp;etc&nbsp;greatly&nbsp;welcomed.&nbsp;We&nbsp;have&nbsp;a&nbsp;number&lt;br&gt;<br>
&amp;gt;&nbsp;of&nbsp;batch&nbsp;jobs&nbsp;that&nbsp;are&nbsp;handled&nbsp;by&nbsp;one&nbsp;process&nbsp;putting&nbsp;information&nbsp;on&nbsp;a&lt;br&gt;<br>
&amp;gt;&nbsp;queue&nbsp;and&nbsp;then&nbsp;storm&nbsp;spouts&nbsp;read&nbsp;the&nbsp;info&nbsp;off&nbsp;and&nbsp;process.&nbsp;In&nbsp;the&nbsp;case&lt;br&gt;<br>
&amp;gt;&nbsp;of&nbsp;one&nbsp;job,&nbsp;we&nbsp;put&nbsp;about&nbsp;5.9&nbsp;million&nbsp;integers&nbsp;on&nbsp;a&nbsp;queue&nbsp;as&nbsp;individual&lt;br&gt;<br>
&amp;gt;&nbsp;messages&nbsp;and&nbsp;process.&nbsp;When&nbsp;those&nbsp;5.9&nbsp;go&nbsp;on,&nbsp;rabbitmq&nbsp;usage&nbsp;jumps&nbsp;up&nbsp;by&lt;br&gt;<br>
&amp;gt;&nbsp;about&nbsp;a&nbsp;gig.&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;Currently&nbsp;with&nbsp;5.6&nbsp;million&nbsp;still&nbsp;in&nbsp;the&nbsp;queue,&nbsp;we&nbsp;have&nbsp;the&nbsp;following&lt;br&gt;<br>
&amp;gt;&nbsp;memory&nbsp;usage&nbsp;on&nbsp;the&nbsp;node&nbsp;as&nbsp;determind&nbsp;by&nbsp;rabbitmqctl&nbsp;status:&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp; {memory,&lt;br&gt;<br>
&amp;gt;&nbsp; &nbsp; &nbsp; [{total,1178020816},&lt;br&gt;<br>
&amp;gt;&nbsp; &nbsp; &nbsp; &nbsp;{processes,131791280},&lt;br&gt;<br>
&amp;gt;&nbsp; &nbsp; &nbsp; &nbsp;{processes_used,130916744},&lt;br&gt;<br>
&amp;gt;&nbsp; &nbsp; &nbsp; &nbsp;{system,1046229536},&lt;br&gt;<br>
&amp;gt;&nbsp; &nbsp; &nbsp; &nbsp;{atom,1338193},&lt;br&gt;<br>
&amp;gt;&nbsp; &nbsp; &nbsp; &nbsp;{atom_used,1314590},&lt;br&gt;<br>
&amp;gt;&nbsp; &nbsp; &nbsp; &nbsp;{binary,12936792},&lt;br&gt;<br>
&amp;gt;&nbsp; &nbsp; &nbsp; &nbsp;{code,15696033},&lt;br&gt;<br>
&amp;gt;&nbsp; &nbsp; &nbsp; &nbsp;{ets,975434504}]},&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;Can&nbsp;anyone&nbsp;shed&nbsp;light&nbsp;on&nbsp;the&nbsp;high&nbsp;level&nbsp;of&nbsp;memory&nbsp;usage&nbsp;and&nbsp;what&nbsp;we&lt;br&gt;<br>
&amp;gt;&nbsp;could&nbsp;do&nbsp;to&nbsp;cut&nbsp;down&nbsp;on&nbsp;it?&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;I&amp;#39;m&nbsp;sure&nbsp;that&nbsp;one&nbsp;of&nbsp;the&nbsp;Rabbit&nbsp;team&nbsp;themselves&nbsp;can&nbsp;shed&nbsp;a&nbsp;bit&nbsp;more&lt;br&gt;<br>
light&nbsp;on&nbsp;this,&nbsp;but&nbsp;AIUI&nbsp;RabbitMQ&nbsp;uses&nbsp;ETS&nbsp;in-memory&nbsp;tables&nbsp;to&nbsp;index&nbsp;the&lt;br&gt;<br>
queues,&nbsp;so&nbsp;with&nbsp;some&nbsp;back&nbsp;of&nbsp;the&nbsp;envelope&nbsp;arithmetic&nbsp;your&nbsp;rabbit&nbsp;is&lt;br&gt;<br>
using&nbsp;approximately&nbsp;175bytes&nbsp;per&nbsp;message.&nbsp;So&nbsp;on&nbsp;the&nbsp;face&nbsp;of&nbsp;it,&nbsp;that&lt;br&gt;<br>
might&nbsp;look&nbsp;a&nbsp;bit&nbsp;odd,&nbsp;but&nbsp;doesn&amp;#39;t&nbsp;seem&nbsp;unreasonable.&lt;br&gt;<br>
&lt;br&gt;<br>
Are&nbsp;you&nbsp;seeing&nbsp;any&nbsp;concrete&nbsp;issues&nbsp;because&nbsp;of&nbsp;this,&nbsp;or&nbsp;are&nbsp;you&nbsp;more&lt;br&gt;<br>
concerned&nbsp;about&nbsp;resource&nbsp;usage?&nbsp;Also,&nbsp;do&nbsp;you&nbsp;anticipate&nbsp;having&nbsp;to&lt;br&gt;<br>
process&nbsp;batches&nbsp;many&nbsp;factors&nbsp;larger&nbsp;than&nbsp;that?&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;We&nbsp;are&nbsp;adding&nbsp;more&nbsp;batch&nbsp;processes&nbsp;and&nbsp;with&nbsp;2&nbsp;gigs&nbsp;per&nbsp;node,&nbsp;we&nbsp;are&nbsp;able&nbsp;to&nbsp;push&nbsp;past&nbsp;that.&lt;/div&gt;&lt;div&nbsp;style&gt;So&nbsp;yes,&nbsp;that&nbsp;are&nbsp;some&nbsp;concerns&nbsp;there. &lt;/div&gt;<br>
&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>
&lt;/div&gt;&lt;/div&gt;<br>

</tt>
