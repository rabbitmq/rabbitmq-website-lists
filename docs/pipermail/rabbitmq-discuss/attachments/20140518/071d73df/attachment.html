<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;I&nbsp;mentioned&nbsp;this&nbsp;on&nbsp;Twitter&nbsp;and&nbsp;a&nbsp;couple&nbsp;of&nbsp;people&nbsp;have&nbsp;requested&nbsp;that&nbsp;I&nbsp;bring&nbsp;this&nbsp;up&nbsp;on&nbsp;the&nbsp;mailing&nbsp;list.&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;It&nbsp;seems&nbsp;to&nbsp;be&nbsp;a&nbsp;given&nbsp;that&nbsp;RabbitMQ&nbsp;was&nbsp;not&nbsp;designed&nbsp;for&nbsp;the&nbsp;batch&nbsp;processing&nbsp;use&nbsp;case&nbsp;(i.e.&nbsp;using&nbsp;RabbitMQ&nbsp;as&nbsp;a&nbsp;buffer&nbsp;between&nbsp;large&nbsp;serial&nbsp;steps).&nbsp;We&nbsp;have&nbsp;a&nbsp;system&nbsp;in&nbsp;place&nbsp;that&nbsp;attempts&nbsp;to&nbsp;do&nbsp;just&nbsp;that,&nbsp;however.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;have&nbsp;been&nbsp;working&nbsp;with&nbsp;the&nbsp;developers&nbsp;of&nbsp;the&nbsp;software&nbsp;involved&nbsp;in&nbsp;an&nbsp;attempt&nbsp;to&nbsp;help&nbsp;them&nbsp;redesign&nbsp;around&nbsp;a&nbsp;more&nbsp;ideal&nbsp;use&nbsp;of&nbsp;RabbitMQ&nbsp;(or&nbsp;to&nbsp;help&nbsp;them&nbsp;move&nbsp;to&nbsp;a&nbsp;different&nbsp;bus&nbsp;altogether&nbsp;--&nbsp;database&nbsp;or&nbsp;something&nbsp;like&nbsp;kafka)&nbsp;and&nbsp;some&nbsp;of&nbsp;them&nbsp;have&nbsp;been&nbsp;able&nbsp;to&nbsp;simply&nbsp;operate&nbsp;in&nbsp;smaller&nbsp;batch&nbsp;sizes&nbsp;(thus&nbsp;keeping&nbsp;their&nbsp;queues&nbsp;relatively&nbsp;small).&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;However,&nbsp;I&nbsp;cannot&nbsp;stem&nbsp;the&nbsp;tide&nbsp;of&nbsp;improper&nbsp;RabbitMQ&nbsp;use.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;When&nbsp;things&nbsp;go&nbsp;poorly,&nbsp;millions&nbsp;of&nbsp;messages&nbsp;end&nbsp;up&nbsp;in&nbsp;the&nbsp;queues.Â &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;In&nbsp;3.1.x&nbsp;we&nbsp;saw&nbsp;this&nbsp;regularly&nbsp;cause&nbsp;our&nbsp;clusters&nbsp;to&nbsp;partition.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;In&nbsp;3.1.x&nbsp;and&nbsp;3.2.x&nbsp;when&nbsp;we&nbsp;would&nbsp;delete&nbsp;large&nbsp;queues&nbsp;(5+&nbsp;million&nbsp;messages&nbsp;enqueued),&nbsp;this&nbsp;would&nbsp;cause&nbsp;the&nbsp;cluster&nbsp;to&nbsp;become&nbsp;unresponsive,&nbsp;run&nbsp;out&nbsp;of&nbsp;memory,&nbsp;and&nbsp;then&nbsp;crash.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;During&nbsp;the&nbsp;3.1&nbsp;-&gt;&nbsp;3.2&nbsp;upgrade,&nbsp;we&nbsp;had&nbsp;to&nbsp;completely&nbsp;rebuild&nbsp;our&nbsp;clusters.&nbsp;When&nbsp;3.2&nbsp;came&nbsp;up,&nbsp;it&nbsp;soon&nbsp;crashed.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;In&nbsp;the&nbsp;most&nbsp;recent&nbsp;upgrade,&nbsp;we&nbsp;saw&nbsp;a&nbsp;3.2.3&nbsp;cluster&nbsp;in&nbsp;our&nbsp;dev&nbsp;environment&nbsp;crash.&nbsp;I&nbsp;performed&nbsp;an&nbsp;opportunistic&nbsp;upgrade&nbsp;to&nbsp;3.3.1,&nbsp;because&nbsp;hey...&nbsp;downtime&nbsp;already,&nbsp;so&nbsp;let&#39;s&nbsp;see&nbsp;if&nbsp;3.3.1&nbsp;addresses&nbsp;some&nbsp;of&nbsp;the&nbsp;issues&nbsp;we&#39;ve&nbsp;been&nbsp;seeing.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;a&nbsp;href=&quot;https://gist.github.com/grepory/384410ac90186ed0ce2a&quot;&gt;https://gist.github.com/grepory/384410ac90186ed0ce2a&lt;/a&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;After&nbsp;the&nbsp;upgrade,&nbsp;3.3.1&nbsp;would&nbsp;not&nbsp;startup&nbsp;at&nbsp;all.&nbsp;I&nbsp;removed&nbsp;/var/lib/rabbitmq/mnesia&nbsp;on&nbsp;all&nbsp;of&nbsp;the&nbsp;nodes&nbsp;and&nbsp;brought&nbsp;RabbitMQ&nbsp;back&nbsp;up.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;3.3.1&nbsp;has&nbsp;been&nbsp;up&nbsp;and&nbsp;running&nbsp;alright&nbsp;so&nbsp;far,&nbsp;but&nbsp;we&nbsp;haven&#39;t&nbsp;done&nbsp;another&nbsp;end-to-end&nbsp;test&nbsp;in&nbsp;our&nbsp;development&nbsp;environment&nbsp;in&nbsp;a&nbsp;while.&nbsp;One&nbsp;of&nbsp;these&nbsp;tests&nbsp;can&nbsp;lead&nbsp;to&nbsp;at&nbsp;least&nbsp;a&nbsp;million&nbsp;messages&nbsp;in&nbsp;the&nbsp;queue&nbsp;over&nbsp;a&nbsp;period&nbsp;of&nbsp;time&nbsp;on&nbsp;average.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;So,&nbsp;I&nbsp;guess&nbsp;my&nbsp;question&nbsp;is:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;If&nbsp;I&nbsp;know&nbsp;that&nbsp;I&nbsp;have&nbsp;people&nbsp;using&nbsp;RabbitMQ&nbsp;like&nbsp;this,&nbsp;and&nbsp;there&nbsp;is&nbsp;nothing&nbsp;I&nbsp;can&nbsp;do&nbsp;to&nbsp;change&nbsp;that&nbsp;fact...&nbsp;what&nbsp;do&nbsp;I&nbsp;do?&lt;/div&gt;&lt;/div&gt;<br>

</tt>
