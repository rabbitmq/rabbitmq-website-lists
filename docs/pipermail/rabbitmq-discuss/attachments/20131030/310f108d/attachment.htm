<tt>
&lt;html&gt;<br>
&nbsp;&nbsp;&lt;head&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;http-equiv=&quot;content-type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=UTF-8&quot;&gt;<br>
&nbsp;&nbsp;&lt;/head&gt;<br>
&nbsp;&nbsp;&lt;body&nbsp;bgcolor=&quot;#FFFFFF&quot;&nbsp;text=&quot;#000000&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Hi,&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;We&nbsp;noticed&nbsp;that&nbsp;one&nbsp;of&nbsp;our&nbsp;customers&nbsp;has&nbsp;created&nbsp;some&nbsp;queues&nbsp;whose<br>
&nbsp;&nbsp;&nbsp;&nbsp;names&nbsp;aren't&nbsp;valid&nbsp;UTF-8.&nbsp;From&nbsp;the&nbsp;AMQP&nbsp;spec&nbsp;it&nbsp;looks&nbsp;like<br>
&nbsp;&nbsp;&nbsp;&nbsp;short-strings&nbsp;should&nbsp;be&nbsp;valid&nbsp;UTF-8,&nbsp;and&nbsp;contain&nbsp;only&nbsp;certain<br>
&nbsp;&nbsp;&nbsp;&nbsp;character&nbsp;classes.&nbsp;However,&nbsp;my&nbsp;colleague&nbsp;Frank&nbsp;has&nbsp;tracked&nbsp;down&nbsp;some<br>
&nbsp;&nbsp;&nbsp;&nbsp;code&nbsp;in&nbsp;&lt;a<br>
href=&quot;https://github.com/rabbitmq/rabbitmq-server/blob/dc37e725f535861f6d98e7b9c4592978aae57a04/src/rabbit_channel.erl#L560&quot;&gt;rabbit_channel:check_name/2&lt;/a&gt;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;where&nbsp;there's&nbsp;a&nbsp;comment&nbsp;to&nbsp;the&nbsp;effect&nbsp;that&nbsp;those&nbsp;rules&nbsp;aren't<br>
&nbsp;&nbsp;&nbsp;&nbsp;enforced&nbsp;deliberately.&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;However,&nbsp;if&nbsp;we&nbsp;try&nbsp;to&nbsp;request&nbsp;the&nbsp;list&nbsp;of&nbsp;queues&nbsp;via&nbsp;the&nbsp;API,&nbsp;we&nbsp;get<br>
&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;following&nbsp;backtrace:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;tt&gt;webmachine&nbsp;error:&nbsp;path=&quot;/api/queues&quot;&lt;/tt&gt;&lt;tt&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tt&gt;&lt;tt&gt;{error,{exit,{ucs,{bad_utf8_character_code}},&lt;/tt&gt;&lt;tt&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tt&gt;&lt;tt&gt;            <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[{xmerl_ucs,from_utf8,1,[{file,&quot;xmerl_ucs.erl&quot;},{line,185}]},&lt;/tt&gt;&lt;tt&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tt&gt;&lt;tt&gt;             &nbsp;{mochijson2,json_encode_string,2,[]},&lt;/tt&gt;&lt;tt&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tt&gt;&lt;tt&gt;             <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{mochijson2,'-json_encode_proplist/2-fun-0-',3,[]},&lt;/tt&gt;&lt;tt&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tt&gt;&lt;tt&gt;             <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{lists,foldl,3,[{file,&quot;lists.erl&quot;},{line,1248}]},&lt;/tt&gt;&lt;tt&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tt&gt;&lt;tt&gt;             &nbsp;{mochijson2,json_encode_proplist,2,[]},&lt;/tt&gt;&lt;tt&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tt&gt;&lt;tt&gt;             <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{mochijson2,'-json_encode_array/2-fun-0-',3,[]},&lt;/tt&gt;&lt;tt&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tt&gt;&lt;tt&gt;             <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{lists,foldl,3,[{file,&quot;lists.erl&quot;},{line,1248}]},&lt;/tt&gt;&lt;tt&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tt&gt;&lt;tt&gt;             &nbsp;{mochijson2,json_encode_array,2,[]}]}}&lt;/tt&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Which&nbsp;seems&nbsp;to&nbsp;indicate&nbsp;that&nbsp;the&nbsp;management&nbsp;console&nbsp;assumes&nbsp;that<br>
&nbsp;&nbsp;&nbsp;&nbsp;entity&nbsp;names&nbsp;are&nbsp;valid&nbsp;UTF-8.&nbsp;We've&nbsp;advised&nbsp;our&nbsp;customer&nbsp;to&nbsp;consider<br>
&nbsp;&nbsp;&nbsp;&nbsp;renaming&nbsp;their&nbsp;queues,&nbsp;but&nbsp;it'd&nbsp;be&nbsp;good&nbsp;to&nbsp;somehow&nbsp;rectify&nbsp;the<br>
&nbsp;&nbsp;&nbsp;&nbsp;difference&nbsp;in&nbsp;assumptions&nbsp;around&nbsp;name&nbsp;encodings.&nbsp;My&nbsp;first&nbsp;thought<br>
&nbsp;&nbsp;&nbsp;&nbsp;might&nbsp;be&nbsp;to&nbsp;percent-encoded&nbsp;non-utf8&nbsp;data.&nbsp;but&nbsp;there's&nbsp;likely&nbsp;better<br>
&nbsp;&nbsp;&nbsp;&nbsp;ways&nbsp;to&nbsp;handle&nbsp;this.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;quickest&nbsp;way&nbsp;to&nbsp;reproduce&nbsp;the&nbsp;problem&nbsp;would&nbsp;be&nbsp;to&nbsp;run&nbsp;this&nbsp;ruby<br>
&nbsp;&nbsp;&nbsp;&nbsp;script&nbsp;using&nbsp;Bunny&nbsp;(assuming&nbsp;you&nbsp;have&nbsp;a&nbsp;local&nbsp;rabbit&nbsp;with&nbsp;the<br>
&nbsp;&nbsp;&nbsp;&nbsp;default&nbsp;credentials):&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;tt&gt;require&nbsp;'bunny'&lt;/tt&gt;&lt;tt&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tt&gt;&lt;tt&gt;bunny&nbsp;=&nbsp;Bunny.new().tap&nbsp;{&nbsp;|b|&nbsp;b.start&nbsp;}&lt;/tt&gt;&lt;tt&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tt&gt;&lt;tt&gt;q&nbsp;=&nbsp;bunny.queue(&quot;foo\316null&quot;)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tt&gt;Once&nbsp;you've&nbsp;done&nbsp;that,&nbsp;if&nbsp;you&nbsp;try&nbsp;to&nbsp;list&nbsp;the&nbsp;queues&nbsp;in&nbsp;the<br>
&nbsp;&nbsp;&nbsp;&nbsp;root&nbsp;virtualhost,&nbsp;you'll&nbsp;find&nbsp;you&nbsp;get&nbsp;the&nbsp;above&nbsp;exception.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Thanks!&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;tt&gt;&lt;/tt&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
