<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:rabbit="http://www.springframework.org/schema/rabbit"
 	xmlns:util="http://www.springframework.org/schema/util"  
xmlns:task="http://www.springframework.org/schema/task"
		xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
	http://www.springframework.org/schema/rabbit http://www.springframework.org/schema/rabbit/spring-rabbit-1.2.xsd
http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-2.0.xsd 
 http://www.springframework.org/schema/task http://www.springframework.org/schema/task/spring-task-3.0.xsd">

		  <bean id="propertyConfigurer"
     class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
     	<property name="ignoreResourceNotFound" value="true" />
		<property name="ignoreUnresolvablePlaceholders" value="false" />
		<property name="searchSystemEnvironment" value="true" />
        <property name="locations">
            <list>
                <value>file:${dlcore.mbus.consumer.config.path}</value>
			</list>
        </property>
       
        </bean>
         <task:annotation-driven />
<bean class="org.springframework.context.annotation.CommonAnnotationBeanPostProcessor"/>

<bean class="com.att.dlife.dlcore.mbus.client.common.BindingBean"/>
  
	<bean name="cf" class="com.rabbitmq.client.DLCoreRabbitMQConnectionFactory">
		<!--<property name="host" value="${hostname}"/>
		<property name="port" value="${port}"/>-->
		<property name="username" value="${username}"/>
		<property name="password" value="${password}"/>
		<property name="virtualHost" value="${vhost}"/>
		<property name="addresses" value="${addresses}"/>

		<property name="requestedChannelMax" value="${session.size}"/>
		<property name="connectionTimeout" value="${connectionTimeout}"/>

		<property name="ssl" value="${ssl.enable}"/>
		<property name="keystorePath" value="${keystore.file}"/>
		<property name="keystorePasswd" value="${keystore.password}"/>
		<property name="truststorePath" value="${truststore.file}"/>
		<property name="truststorePasswd" value="${truststore.password}"/>
	</bean>

<rabbit:connection-factory id="connectionFactory" connection-factory="cf" addresses="${addresses}" channel-cache-size="${session.size}" />

	<rabbit:admin id="admin" connection-factory="connectionFactory" />

	<!-- Message Listener 1 ### Exchange -    -->
	
	<rabbit:queue id="queue1" name="${username}.${jndiname1}.QUEUE" durable="true" auto-delete="false" />
	


	
	<!--rabbit:topic-exchange id="exchange1" name="${jndiname1}">
		<rabbit:bindings>
			<rabbit:binding
		queue="queue1" pattern="#.#">
			</rabbit:binding>
		</rabbit:bindings>
	</rabbit:topic-exchange-->
	
 <!--rabbit:headers-exchange name="${jndiname1}">
    	<rabbit:bindings>
    		<rabbit:binding queue="queue1" key="srcGwyGuId" value="123456" />
       	</rabbit:bindings>
    </rabbit:headers-exchange-->


 <rabbit:headers-exchange  id="exchange1" name="${jndiname1}"/>
    
    <bean name="binding1"  class="org.springframework.amqp.rabbit.config.BindingFactoryBean">
    	<property name="exchange" value="${jndiname1}" />
    	<property name="destinationQueue" ref="queue1" />
    		<property name="arguments">
    		<util:map>
    			   		
    			<entry key="x-match" value="any" />

    		</util:map>
    	</property>
    
    </bean>

 <!--bean  class="org.springframework.amqp.rabbit.config.BindingFactoryBean">
    	<property name="exchange" value="${jndiname1}" />
    	<property name="destinationQueue" ref="queue1" />
    	<property name="arguments">
    		<util:map>
    			<entry key="srcGwyGuId" value="2" />
    		
    			<entry key="x-match" value="any" />

    		</util:map>
    	</property>
    </bean-->


	<bean id="listener1" class="${listener1}"/>
	
	<!--bean id="listener1" class="java.lang.Class" factory-method="forName">
	<constructor-arg><value>${listener1}</value></constructor-arg>
</bean>
<bean factory-bean="listener1" factory-method="newInstance"/-->

	<rabbit:listener-container id="dlListenerContainer" concurrency="${listener.thread.size}"
		connection-factory="connectionFactory">
		<rabbit:listener ref="listener1"  queues="queue1" />
	</rabbit:listener-container>
	
<!-- Message Listener 2 ### Exchange -    -->


</beans> 
