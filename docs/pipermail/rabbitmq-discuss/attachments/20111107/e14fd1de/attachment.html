<tt>
Hi&nbsp;all,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;We&nbsp;were&nbsp;hoping&nbsp;to&nbsp;go&nbsp;into&nbsp;production&nbsp;next&nbsp;week&nbsp;with&nbsp;Rabbit&amp;#39;s&nbsp;HA&nbsp;queues,&nbsp;however&nbsp;testing&nbsp;by&nbsp;randomly&nbsp;killing&nbsp;processes&nbsp;has&nbsp;shown&nbsp;some&nbsp;odd&nbsp;behaviour.&nbsp;I&amp;#39;m&nbsp;not&nbsp;sure&nbsp;whether&nbsp;it&amp;#39;s&nbsp;something&nbsp;odd&nbsp;with&nbsp;our&nbsp;setup,&nbsp;or&nbsp;a&nbsp;set&nbsp;of&nbsp;interacting&nbsp;bugs.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;When&nbsp;started,&nbsp;we&nbsp;create&nbsp;three&nbsp;queues:&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;ul&gt;&lt;li&gt;storm-classifications&lt;/li&gt;&lt;li&gt;storm-meta&lt;/li&gt;&lt;li&gt;storm-tracking&lt;/li&gt;&lt;/ul&gt;&lt;div&gt;There&nbsp;are&nbsp;3&nbsp;nodes&nbsp;in&nbsp;the&nbsp;cluster,&nbsp;with&nbsp;queues&nbsp;replicated&nbsp;to&nbsp;all&nbsp;nodes.&nbsp;In&nbsp;testing,&nbsp;I&amp;#39;ve&nbsp;been&nbsp;issuing&nbsp;kill&nbsp;commands&nbsp;to&nbsp;take&nbsp;out&nbsp;beam,&nbsp;rabbit&nbsp;and&nbsp;erlang&nbsp;processes,&nbsp;which&nbsp;close&nbsp;the&nbsp;channels&nbsp;and&nbsp;make&nbsp;clients&nbsp;reconnect&nbsp;to&nbsp;a&nbsp;different&nbsp;nodes.&nbsp;I&nbsp;allow&nbsp;the&nbsp;downed&nbsp;node&nbsp;to&nbsp;recover&nbsp;and&nbsp;come&nbsp;back&nbsp;up&nbsp;before&nbsp;killing&nbsp;another&nbsp;one&nbsp;(also&nbsp;allowing&nbsp;queues&nbsp;to&nbsp;synchronize).&lt;/div&gt;<br>
<br>
<br>
&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;After&nbsp;doing&nbsp;this&nbsp;a&nbsp;couple&nbsp;of&nbsp;times,&nbsp;we&nbsp;see&nbsp;the&nbsp;following:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;a&nbsp;href=&quot;http://www.evernote.com/shard/s53/sh/448a967e-b995-4f54-986d-50194955550f/416d4e71af91f6e2f6d5311f7ea9fb44&quot;&nbsp;target=&quot;_blank&quot;&gt;http://www.evernote.com/shard/s53/sh/448a967e-b995-4f54-986d-50194955550f/416d4e71af91f6e2f6d5311f7ea9fb44&lt;/a&gt;&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;classifications&nbsp;queue&nbsp;is&nbsp;gone&nbsp;(taking&nbsp;any&nbsp;messages&nbsp;with&nbsp;it),&nbsp;the&nbsp;meta&nbsp;queue&nbsp;is&nbsp;only&nbsp;replicated&nbsp;to&nbsp;one&nbsp;other&nbsp;node.&nbsp;The&nbsp;tracking&nbsp;queue&nbsp;is&nbsp;OK,&nbsp;but&nbsp;only&nbsp;because&nbsp;it&nbsp;disappeared&nbsp;and&nbsp;was&nbsp;recreated&nbsp;empty.&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;meta&nbsp;queue&nbsp;-&nbsp;despite&nbsp;not&nbsp;having&nbsp;any&nbsp;messages&nbsp;flowing&nbsp;through&nbsp;it&nbsp;in&nbsp;the&nbsp;test&nbsp;system&nbsp;-&nbsp;sometimes&nbsp;shows&nbsp;that&nbsp;one&nbsp;of&nbsp;the&nbsp;nodes&nbsp;is&nbsp;not&nbsp;synchronised&nbsp;for&nbsp;minutes&nbsp;after&nbsp;rejoining.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;<br>
<br>
<br>
I&amp;#39;ve&nbsp;also&nbsp;found&nbsp;that&nbsp;sometimes&nbsp;queues&nbsp;stop&nbsp;delivering&nbsp;messages&nbsp;when&nbsp;certain&nbsp;nodes&nbsp;go&nbsp;down&nbsp;(even&nbsp;after&nbsp;being&nbsp;left&nbsp;for&nbsp;minutes),&nbsp;despite&nbsp;being&nbsp;in&nbsp;HA&nbsp;mode&nbsp;(haven&amp;#39;t&nbsp;been&nbsp;able&nbsp;to&nbsp;dig&nbsp;into&nbsp;this&nbsp;more&nbsp;yet).&nbsp;Sometimes&nbsp;connections&nbsp;to&nbsp;nodes&nbsp;which&nbsp;have&nbsp;gone&nbsp;down&nbsp;are&nbsp;still&nbsp;shown&nbsp;and&nbsp;get&nbsp;stuck.&nbsp;Using&nbsp;netstat&nbsp;reveals&nbsp;that&nbsp;those&nbsp;connections&nbsp;do&nbsp;not&nbsp;exist&nbsp;at&nbsp;TCP&nbsp;level,&nbsp;and&nbsp;using&nbsp;the&nbsp;Web&nbsp;UI&nbsp;to&nbsp;&amp;#39;Force&nbsp;Close&amp;#39;&nbsp;them&nbsp;generates&nbsp;an&nbsp;error&nbsp;(red&nbsp;box&nbsp;saying&nbsp;unable&nbsp;to&nbsp;connect&nbsp;to&nbsp;server&nbsp;-&nbsp;however&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;UI&nbsp;works&nbsp;fine).&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;&lt;div&gt;This&nbsp;seems&nbsp;like&nbsp;rather&nbsp;odd&nbsp;behaviour,&nbsp;and&nbsp;means&nbsp;we&nbsp;can&amp;#39;t&nbsp;put&nbsp;it&nbsp;into&nbsp;production.&nbsp;I&amp;#39;m&nbsp;having&nbsp;trouble&nbsp;replicating&nbsp;it,&nbsp;all&nbsp;I&nbsp;know&nbsp;is&nbsp;that&nbsp;after&nbsp;cycling&nbsp;nodes&nbsp;a&nbsp;few&nbsp;times&nbsp;it&nbsp;stops&nbsp;working&nbsp;as&nbsp;we&amp;#39;d&nbsp;expect.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Today,&nbsp;while&nbsp;bringing&nbsp;up&nbsp;the&nbsp;cluster&nbsp;from&nbsp;scratch&nbsp;(shutdown&nbsp;all&nbsp;instances,&nbsp;wipe&nbsp;mnesia,&nbsp;restart)&nbsp;I&amp;#39;ve&nbsp;got&nbsp;3&nbsp;nodes&nbsp;running,&nbsp;but&nbsp;an&nbsp;HA&nbsp;queue&nbsp;with&nbsp;1&nbsp;master,&nbsp;2&nbsp;synced&nbsp;slaves&nbsp;and&nbsp;1&nbsp;unsynced&nbsp;slave.&nbsp;Other&nbsp;queues&nbsp;are&nbsp;showing&nbsp;1&nbsp;master&nbsp;and&nbsp;2&nbsp;synced&nbsp;slaves&nbsp;as&nbsp;expected.&nbsp;(see&nbsp;&lt;a&nbsp;href=&quot;http://www.evernote.com/shard/s53/sh/b6345885-88d1-4d21-9614-24abda75a1cb/c2a0dd265b39d21f3e8c336c67ced979&quot;&gt;http://www.evernote.com/shard/s53/sh/b6345885-88d1-4d21-9614-24abda75a1cb/c2a0dd265b39d21f3e8c336c67ced979&lt;/a&gt;)&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Currently&nbsp;on&nbsp;2.6.0,&nbsp;Ubuntu&nbsp;11.04&nbsp;on&nbsp;EC2.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Quite&nbsp;infuriating,&nbsp;and&nbsp;no&nbsp;idea&nbsp;how&nbsp;to&nbsp;fix&nbsp;it.&lt;/div&gt;<br>
<br>
&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;A&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;--&nbsp;&lt;br&gt;Dr&nbsp;Ashley&nbsp;Brown&lt;br&gt;Chief&nbsp;Architect&lt;br&gt;&lt;br&gt;e: &lt;a&nbsp;href=&quot;mailto:ashley@spider.io&quot;&nbsp;target=&quot;_blank&quot;&gt;ashley@spider.io&lt;/a&gt;&lt;br&gt;a:&nbsp;&lt;a&nbsp;href=&quot;http://spider.io&quot;&nbsp;target=&quot;_blank&quot;&gt;spider.io&lt;/a&gt;,&nbsp;353&nbsp;The&nbsp;Strand,&nbsp;WC2R&nbsp;0HS&lt;br&gt;<br>
<br>
<br>
w:&nbsp;&lt;a&nbsp;href=&quot;http://spider.io/&quot;&nbsp;target=&quot;_blank&quot;&gt;http://spider.io/&lt;/a&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>

</tt>
