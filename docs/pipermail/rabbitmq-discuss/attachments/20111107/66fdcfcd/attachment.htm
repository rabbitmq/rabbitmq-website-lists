<tt>
&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex;&quot;&gt;&lt;br&gt;<br>
Could&nbsp;you&nbsp;describe&nbsp;accurately&nbsp;what&nbsp;your&nbsp;tests&nbsp;are&nbsp;so&nbsp;that&nbsp;we&nbsp;can&nbsp;try&nbsp;and&lt;br&gt;<br>
reproduce?&lt;br&gt;<br>
&lt;div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&amp;#39;m&nbsp;afraid&nbsp;the&nbsp;tests&nbsp;are&nbsp;of&nbsp;the&nbsp;system&nbsp;overall,&nbsp;and&nbsp;I&nbsp;haven&amp;#39;t&nbsp;been&nbsp;able&nbsp;to&nbsp;produce&nbsp;a&nbsp;minimal&nbsp;test&nbsp;case&nbsp;so&nbsp;far.&nbsp;This&nbsp;evening&amp;#39;s&nbsp;test&nbsp;involved&nbsp;dropping&nbsp;backed&nbsp;up&nbsp;messages&nbsp;into&nbsp;the&nbsp;queues&nbsp;quickly,&nbsp;while&nbsp;draining&nbsp;them&nbsp;slowly.&nbsp;Effectively: &lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;5&nbsp;HA&nbsp;queues,&nbsp;replicated&nbsp;to&nbsp;all&nbsp;nodes.&nbsp;3&nbsp;nodes&nbsp;in&nbsp;the&nbsp;cluster,&nbsp;15GB&nbsp;machines,&nbsp;high&nbsp;water&nbsp;mark&nbsp;at&nbsp;5.9GB.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Start&nbsp;producers&nbsp;and&nbsp;consumers,&nbsp;consumers&nbsp;running&nbsp;slowly,&nbsp;allowing&nbsp;queues&nbsp;to&nbsp;build&nbsp;to&nbsp;500k.&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;background-color:&nbsp;transparent;&nbsp;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;background-color:&nbsp;transparent;&nbsp;&quot;&gt;Stop&nbsp;producers&nbsp;and&nbsp;consumers,&nbsp;delete&nbsp;queues.&nbsp;Deletions&nbsp;take&nbsp;a&nbsp;long&nbsp;time.&nbsp;Although&nbsp;I&amp;#39;ve&nbsp;also&nbsp;seen&nbsp;this&nbsp;with&nbsp;no-HA&nbsp;queues&nbsp;-&nbsp;it&nbsp;can&nbsp;take&nbsp;tens&nbsp;of&nbsp;minutes&nbsp;to&nbsp;delete&nbsp;a&nbsp;queue&nbsp;with&nbsp;250k+&nbsp;messages&nbsp;in.&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;background-color:&nbsp;transparent;&nbsp;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;background-color:&nbsp;transparent;&nbsp;&quot;&gt;Previously&nbsp;we&amp;#39;ve&nbsp;had&nbsp;queues&nbsp;in&nbsp;a&nbsp;steady&nbsp;state,&nbsp;with&nbsp;approximately&nbsp;25,000&nbsp;unacked&nbsp;messages&nbsp;(they&nbsp;take&nbsp;several&nbsp;minutes&nbsp;to&nbsp;process,&nbsp;aren&amp;#39;t&nbsp;acked&nbsp;until&nbsp;complete).&nbsp;Then&lt;/span&gt;&lt;span&nbsp;style=&quot;background-color:&nbsp;transparent;&nbsp;&quot;&gt; kill&nbsp;some&nbsp;nodes&nbsp;off,&nbsp;forcing&nbsp;the&nbsp;messages&nbsp;to&nbsp;be&nbsp;requeued&nbsp;and&nbsp;replayed&nbsp;on&nbsp;the&nbsp;slaves.&nbsp;It&nbsp;all&nbsp;gets&nbsp;out&nbsp;of&nbsp;sync&nbsp;after&nbsp;that.&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;background-color:&nbsp;transparent;&nbsp;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;might&nbsp;be&nbsp;able&nbsp;to&nbsp;give&nbsp;you&nbsp;a&nbsp;better&nbsp;test&nbsp;case&nbsp;once&nbsp;we&amp;#39;ve&nbsp;pushed&nbsp;our&nbsp;non-HA&nbsp;release&nbsp;out&nbsp;and&nbsp;I&nbsp;have&nbsp;a&nbsp;bit&nbsp;more&nbsp;time.&lt;/div&gt;&lt;/div&gt;<br>

</tt>
