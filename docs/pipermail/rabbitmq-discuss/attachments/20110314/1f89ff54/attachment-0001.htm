<tt>
&lt;div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&gt;&lt;/span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&nbsp;style=&quot;color:&nbsp;#a0a0a0;&quot;&gt;On&nbsp;Monday,&nbsp;March&nbsp;14,&nbsp;2011&nbsp;at&nbsp;11:28&nbsp;AM,&nbsp;Vukasin&nbsp;Toroman&nbsp;wrote:&lt;/p&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;style=&quot;border-left-style:solid;border-width:1px;margin-left:0px;padding-left:10px;&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&gt;&lt;div&gt;&lt;div&gt;Hi&nbsp;everyone,&lt;br&gt;&lt;br&gt;we&nbsp;have&nbsp;been&nbsp;using&nbsp;rabbitmq&nbsp;for&nbsp;a&nbsp;while&nbsp;now&nbsp;to&nbsp;route&nbsp;documents&nbsp;through&nbsp;a&nbsp;processing&nbsp;workflow.&nbsp;each&nbsp;step&nbsp;is&nbsp;represented&nbsp;by&nbsp;one&nbsp;or&nbsp;more&nbsp;processes&nbsp;working&nbsp;on&nbsp;one&nbsp;queue.&nbsp;the&nbsp;messages&nbsp;are&nbsp;small&nbsp;(maybe&nbsp;a&nbsp;few&nbsp;k)&nbsp;but&nbsp;there&nbsp;are&nbsp;quite&nbsp;a&nbsp;few&nbsp;of&nbsp;them&nbsp;(multiple&nbsp;thousand&nbsp;per&nbsp;second).&nbsp;This&nbsp;has&nbsp;been&nbsp;working&nbsp;fine&nbsp;for&nbsp;a&nbsp;while&nbsp;but&nbsp;then&nbsp;we&nbsp;have&nbsp;noticed&nbsp;that&nbsp;the&nbsp;rates&nbsp;(each&nbsp;step&nbsp;of&nbsp;the&nbsp;processing&nbsp;workflow&nbsp;delivers&nbsp;stats)&nbsp;do&nbsp;not&nbsp;add&nbsp;up.&nbsp;namely&nbsp;we&nbsp;seem&nbsp;to&nbsp;be&nbsp;losing&nbsp;messages&nbsp;(around&nbsp;200&nbsp;messages/sec)&nbsp;and&nbsp;this&nbsp;is&nbsp;quite&nbsp;discerning.&nbsp;The&nbsp;reason&nbsp;is&nbsp;that&nbsp;these&nbsp;messages&nbsp;do&nbsp;not&nbsp;show&nbsp;up&nbsp;in&nbsp;the&nbsp;queue&nbsp;and&nbsp;are&nbsp;also&nbsp;not&nbsp;visible&nbsp;as&nbsp;being&nbsp;recieved&nbsp;and&nbsp;un-acked.&nbsp;we&nbsp;are&nbsp;using&nbsp;non-durable&nbsp;queues&nbsp;and&nbsp;a&nbsp;combination&nbsp;of&nbsp;java&nbsp;and&nbsp;python&nbsp;processing&nbsp;clients.&lt;/div&gt;&lt;/div&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;div&gt;How&nbsp;are&nbsp;you&nbsp;quantifying&nbsp;the&nbsp;counts?&nbsp;&amp;nbsp;Do&nbsp;you&nbsp;keep&nbsp;track&nbsp;on&nbsp;your&nbsp;own&nbsp;outside&nbsp;of&nbsp;RabbitMQ&nbsp;message&nbsp;counts&nbsp;on&nbsp;your&nbsp;consumers&nbsp;and&nbsp;publishers?&amp;nbsp;&lt;/div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;style=&quot;border-left-style:solid;border-width:1px;margin-left:0px;padding-left:10px;&quot;&gt;&lt;span&gt;&lt;div&gt;&lt;div&gt;&lt;span&gt;&lt;/span&gt;oh&nbsp;yes,&nbsp;this&nbsp;only&nbsp;happens&nbsp;after&nbsp;the&nbsp;system&nbsp;has&nbsp;been&nbsp;running&nbsp;for&nbsp;a&nbsp;while&nbsp;and&nbsp;a&nbsp;traffic&nbsp;spike&nbsp;has&nbsp;occurred.&nbsp;the&nbsp;rabbitmq&nbsp;process&nbsp;also&nbsp;seems&nbsp;to&nbsp;be&nbsp;gaining&nbsp;memory.&nbsp;&lt;/div&gt;&lt;/div&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;div&gt;I&nbsp;have&nbsp;found&nbsp;that&nbsp;if&nbsp;I&nbsp;am&nbsp;over&nbsp;saturating&nbsp;a&nbsp;single&nbsp;node&nbsp;with&nbsp;regard&nbsp;to&nbsp;message&nbsp;throughput,&nbsp;I&nbsp;see&nbsp;a&nbsp;pattern&nbsp;where&nbsp;memory&nbsp;use&nbsp;increases&nbsp;without&nbsp;being&nbsp;able&nbsp;to&nbsp;reconcile&nbsp;where&nbsp;it&nbsp;is&nbsp;used.&nbsp;During&nbsp;spikes&nbsp;like&nbsp;this,&nbsp;I&nbsp;did&nbsp;see&nbsp;abnormal&nbsp;behavior&nbsp;with&nbsp;messages&nbsp;as&nbsp;well.&nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;In&nbsp;my&nbsp;case,&nbsp;I&nbsp;was&nbsp;seeing&nbsp;this&nbsp;behavior&nbsp;when&nbsp;throughput&nbsp;exceeded&nbsp;~25k&nbsp;messages&nbsp;per&nbsp;second&nbsp;being&nbsp;published&nbsp;into&nbsp;a&nbsp;single&nbsp;node&nbsp;on&nbsp;a&nbsp;single&nbsp;exchange&nbsp;while&nbsp;consuming&nbsp;from&nbsp;multiple&nbsp;queues&nbsp;bound&nbsp;to&nbsp;the&nbsp;exchange&nbsp;connected&nbsp;to&nbsp;other&nbsp;nodes&nbsp;in&nbsp;the&nbsp;rabbitmq&nbsp;cluster.&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;To&nbsp;address&nbsp;this,&nbsp;I&nbsp;changed&nbsp;the&nbsp;publishing&nbsp;strategy&nbsp;and&nbsp;added&nbsp;a&nbsp;few&nbsp;nodes&nbsp;to&nbsp;the&nbsp;cluster.&nbsp;I&nbsp;still&nbsp;use&nbsp;the&nbsp;same&nbsp;exchange&nbsp;and&nbsp;routing&nbsp;key&nbsp;structure,&nbsp;however&nbsp;I&nbsp;am&nbsp;now&nbsp;publishing&nbsp;into&nbsp;the&nbsp;exchange&nbsp;across&nbsp;multiple&nbsp;nodes&nbsp;instead&nbsp;of&nbsp;one.&nbsp;I&nbsp;have&nbsp;not&nbsp;seen&nbsp;any&nbsp;issues&nbsp;since&nbsp;this&nbsp;change&nbsp;and&nbsp;am&nbsp;now&nbsp;operating&nbsp;at&nbsp;2x&nbsp;the&nbsp;previous&nbsp;message&nbsp;velocity&nbsp;across&nbsp;the&nbsp;cluster.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Hope&nbsp;this&nbsp;helps,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Gavin&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;
</tt>
