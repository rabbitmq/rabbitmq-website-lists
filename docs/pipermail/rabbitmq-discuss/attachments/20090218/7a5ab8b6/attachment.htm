<tt>
Hi&nbsp;Guys,&lt;br&gt;&lt;br&gt;I&nbsp;tried&nbsp;to&nbsp;bring&nbsp;this&nbsp;up&nbsp;in&nbsp;IRC&nbsp;but&nbsp;I&nbsp;couldn&amp;#39;t&nbsp;get&nbsp;a&nbsp;bite.&lt;br&gt;&lt;br&gt;I&amp;#39;ve&nbsp;created&nbsp;an&nbsp;application&nbsp;in&nbsp;an&nbsp;attempt&nbsp;to&nbsp;learn&nbsp;rabbitmq&nbsp;via&nbsp;the&nbsp;ruby&nbsp;gem&nbsp;amqp.&amp;nbsp;&amp;nbsp;&nbsp;My&nbsp;basic&nbsp;setup&nbsp;is&nbsp;that&nbsp;I&nbsp;have&nbsp;a&nbsp;very&nbsp;simple&nbsp;web&nbsp;app&nbsp;out&nbsp;front&nbsp;that&nbsp;recieves&nbsp;requests&nbsp;and&nbsp;creates&nbsp;the&nbsp;initial&nbsp;message&nbsp;in&nbsp;the&nbsp;system.&amp;nbsp;&nbsp;The&nbsp;flow&nbsp;goes&nbsp;like&nbsp;this:&lt;br&gt;<br>
&lt;br&gt;Web&nbsp;App&lt;br&gt;Direct&nbsp;Exchange&nbsp;+&nbsp;Queue&nbsp;-&amp;gt;&nbsp;do&nbsp;some&nbsp;work&nbsp;(forward&nbsp;1&nbsp;message)&nbsp;-&amp;gt;&lt;br&gt;Direct&nbsp;Exchange&nbsp;+&nbsp;Queue&nbsp;-&amp;gt;&nbsp;do&nbsp;stuff&amp;nbsp;&nbsp;(forward&nbsp;2&nbsp;messages&nbsp;for&nbsp;each&nbsp;one)-&amp;gt;&nbsp;&lt;br&gt;Direct&nbsp;Exchange&nbsp;+&nbsp;Queue&nbsp;-&amp;gt;&nbsp;do&nbsp;stuff&nbsp;(forward&nbsp;2&nbsp;messages&nbsp;for&nbsp;each&nbsp;one)&nbsp;-&amp;gt;&lt;br&gt;<br>
Topic&nbsp;Exchange&nbsp;+&nbsp;routed&nbsp;to&nbsp;a&nbsp;queue&nbsp;(forward&nbsp;0&nbsp;messages&nbsp;for&nbsp;each&nbsp;one)&nbsp;-&amp;gt;&nbsp;finish&lt;br&gt;&lt;br&gt;Firstly,&nbsp;this&nbsp;is&nbsp;all&nbsp;being&nbsp;done&nbsp;on&nbsp;my&nbsp;laptop&nbsp;and&nbsp;I&amp;#39;m&nbsp;hammering&nbsp;it&nbsp;with&nbsp;ab&nbsp;and&nbsp;3&nbsp;instances&nbsp;of&nbsp;the&nbsp;web&nbsp;app.&lt;br&gt;&lt;br&gt;So&nbsp;firstly&nbsp;this&nbsp;is&nbsp;really&nbsp;slow.&amp;nbsp;&nbsp;I&nbsp;was&nbsp;expecting&nbsp;that&nbsp;with&nbsp;3&nbsp;instances&nbsp;of&nbsp;the&nbsp;web&nbsp;app&nbsp;out&nbsp;front&nbsp;would&nbsp;increase&nbsp;it&amp;#39;s&nbsp;concurrency&nbsp;a&nbsp;bit.&amp;nbsp;&nbsp;What&nbsp;I&nbsp;found&nbsp;though&nbsp;was&nbsp;unexpected&nbsp;by&nbsp;me.&lt;br&gt;<br>
&lt;br&gt;I&nbsp;hit&nbsp;the&nbsp;system&nbsp;with&nbsp;3&nbsp;ab&amp;#39;s&nbsp;and&nbsp;sent&nbsp;in&nbsp;1000&nbsp;requests&nbsp;each&nbsp;with&nbsp;a&nbsp;concurrecy&nbsp;of&nbsp;40.&amp;nbsp;&nbsp;This&nbsp;went&nbsp;through&nbsp;a&nbsp;rack&nbsp;app&nbsp;so&nbsp;the&nbsp;concurrency&nbsp;may&nbsp;not&nbsp;actually&nbsp;matter&nbsp;all&nbsp;that&nbsp;much.&lt;br&gt;&lt;br&gt;Throughout&nbsp;the&nbsp;run,&nbsp;the&nbsp;output&nbsp;from&nbsp;each&nbsp;worker&nbsp;(single&nbsp;worker&nbsp;on&nbsp;a&nbsp;queue)&nbsp;was&nbsp;sporadic.&amp;nbsp;&nbsp;It&nbsp;would&nbsp;hammer&nbsp;for&nbsp;a&nbsp;bit,&nbsp;then&nbsp;pause&nbsp;then&nbsp;go&nbsp;again.&nbsp;Once&nbsp;the&nbsp;ab&amp;#39;s&nbsp;had&nbsp;finished&nbsp;making&nbsp;requests&nbsp;to&nbsp;the&nbsp;web&nbsp;apps,&nbsp;and&nbsp;they&amp;#39;d&nbsp;finished&nbsp;creating&nbsp;messages&nbsp;on&nbsp;the&nbsp;rabbitmq&nbsp;network,&nbsp;the&nbsp;downstream&nbsp;workers&nbsp;didn&amp;#39;t&nbsp;stop.&amp;nbsp;&nbsp;Instead&nbsp;they&nbsp;continued,&nbsp;basically&nbsp;in&nbsp;order.&amp;nbsp;&amp;nbsp;&nbsp;The&nbsp;upstream&nbsp;one&nbsp;would&nbsp;empty,&nbsp;with&nbsp;the&nbsp;downstream&nbsp;ones&nbsp;paused&nbsp;and&nbsp;only&nbsp;consuming&nbsp;messages&nbsp;sporadically.&amp;nbsp;&nbsp;Then&nbsp;once&nbsp;that&nbsp;queue&nbsp;was&nbsp;effectively&nbsp;finished&nbsp;the&nbsp;next&nbsp;consumer&nbsp;would&nbsp;become&nbsp;active&nbsp;and&nbsp;empty&nbsp;etc.&lt;br&gt;<br>
&lt;br&gt;It&nbsp;took&nbsp;a&nbsp;significant&nbsp;ammount&nbsp;of&nbsp;time&nbsp;to&nbsp;empty&nbsp;the&nbsp;queues&nbsp;and&nbsp;I&nbsp;was&nbsp;only&nbsp;getting&nbsp;18rps&nbsp;from&nbsp;each&nbsp;web&nbsp;app!&amp;nbsp;&nbsp;This&nbsp;is&nbsp;one&nbsp;of&nbsp;the&nbsp;most&nbsp;unscientific&nbsp;benchmarks&nbsp;possible&nbsp;and&nbsp;this&nbsp;was&nbsp;only&nbsp;observed&nbsp;by&nbsp;watching&nbsp;the&nbsp;logs&nbsp;of&nbsp;the&nbsp;consumers.&amp;nbsp;&nbsp;Each&nbsp;hop&nbsp;reads&nbsp;from&nbsp;a&nbsp;couchdb&nbsp;for&nbsp;some&nbsp;information.&lt;br&gt;<br>
&lt;br&gt;This&nbsp;is&nbsp;about&nbsp;all&nbsp;I&nbsp;can&nbsp;think&nbsp;to&nbsp;list&nbsp;at&nbsp;the&nbsp;moment.&amp;nbsp;&nbsp;I&amp;#39;d&nbsp;really&nbsp;appreciate&nbsp;any&nbsp;insights&nbsp;into&nbsp;why&nbsp;I&amp;#39;m&nbsp;seeing&nbsp;this&nbsp;build&nbsp;up&nbsp;of&nbsp;messages.&amp;nbsp;&nbsp;I&nbsp;would&nbsp;think&nbsp;this&nbsp;should&nbsp;barely&nbsp;stress&nbsp;the&nbsp;rabbitmq&nbsp;network&nbsp;at&nbsp;all.&amp;nbsp;&nbsp;Is&nbsp;it&nbsp;possible&nbsp;to&nbsp;attach&nbsp;many&nbsp;queues&nbsp;to&nbsp;a&nbsp;single&nbsp;Direct&nbsp;Exchange?&amp;nbsp;&nbsp;&lt;br&gt;<br>
&lt;br&gt;All&nbsp;my&nbsp;consumers&nbsp;are&nbsp;setup&nbsp;as&nbsp;subscribers&nbsp;to&nbsp;a&nbsp;queue,&nbsp;and&nbsp;all&nbsp;direct&nbsp;exchanges&nbsp;have&nbsp;only&nbsp;one&nbsp;queue.&lt;br&gt;&lt;br&gt;Cheers&lt;br&gt;Daniel&lt;br&gt;<br>

</tt>
