<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;Hello,&lt;br&gt;&lt;br&gt;&lt;/div&gt;I&nbsp;tried&nbsp;to&nbsp;search&nbsp;some&nbsp;discussion&nbsp;on&nbsp;this&nbsp;topic&nbsp;but&nbsp;didn&amp;#39;t&nbsp;find.&lt;br&gt;&lt;br&gt;&lt;/div&gt;The<br>
&nbsp;problem&nbsp;:&nbsp;the&nbsp;client&nbsp;sends&nbsp;some&nbsp;messages&nbsp;to&nbsp;the&nbsp;server&nbsp;on&nbsp;another&nbsp;host&nbsp;<br>
and&nbsp;at&nbsp;some&nbsp;moment&nbsp;server&nbsp;host&nbsp;becomes&nbsp;unreachable&nbsp;(network&nbsp;is&nbsp;down,&nbsp;<br>
host&nbsp;is&nbsp;powered&nbsp;off,&nbsp;etc).&nbsp;&lt;br&gt;<br>
&lt;/div&gt;As&nbsp;a&nbsp;result&nbsp;the&nbsp;sender&nbsp;thread&nbsp;is&nbsp;blocked&nbsp;while&nbsp;writing&nbsp;to&nbsp;socket&nbsp;<br>
and&nbsp;recognizes&nbsp;network&nbsp;failure&nbsp;after&nbsp;some&nbsp;time&nbsp;which&nbsp;is&nbsp;not&nbsp;comfortable&nbsp;<br>
(&amp;gt;&nbsp;15&nbsp;min&nbsp;for&nbsp;our&nbsp;rhel&nbsp;machine).&nbsp;I&nbsp;tried&nbsp;to&nbsp;tune&nbsp;some&nbsp;tcp/socket&nbsp;<br>
settings&nbsp;but&nbsp;didn&amp;#39;t&nbsp;succeed.&lt;br&gt;<br>
&lt;br&gt;Here&nbsp;is&nbsp;a&nbsp;part&nbsp;of&nbsp;thread&nbsp;dump&nbsp;when&nbsp;the&nbsp;thread&nbsp;is&nbsp;stuck:&lt;br&gt;&lt;br&gt;&amp;quot;main&amp;quot;&nbsp;prio=10&nbsp;tid=0xf7505800&nbsp;nid=0x2c3e&nbsp;runnable&nbsp;[0xf7728000]&lt;br&gt;  &nbsp;java.lang.Thread.State:&nbsp;RUNNABLE&lt;br&gt;       &nbsp;at&nbsp;java.net.SocketOutputStream.socketWrite0(Native&nbsp;Method)&lt;br&gt;<br>
<br>
       &nbsp;at&nbsp;java.net.SocketOutputStream.socketWrite(SocketOutputStream.java:109)&lt;br&gt;       &nbsp;at&nbsp;java.net.SocketOutputStream.write(SocketOutputStream.java:153)&lt;br&gt;       &nbsp;at&nbsp;java.io.BufferedOutputStream.flushBuffer(BufferedOutputStream.java:82)&lt;br&gt;<br>
<br>
       &nbsp;at&nbsp;java.io.BufferedOutputStream.flush(BufferedOutputStream.java:140)&lt;br&gt;       &nbsp;-&nbsp;locked&nbsp;&amp;lt;0xb4532608&amp;gt;&nbsp;(a&nbsp;java.io.BufferedOutputStream)&lt;br&gt;       &nbsp;at&nbsp;java.io.DataOutputStream.flush(DataOutputStream.java:123)&lt;br&gt;<br>
<br>
       &nbsp;at&nbsp;com.rabbitmq.client.impl.SocketFrameHandler.flush(SocketFrameHandler.java:142)&lt;br&gt;       &nbsp;at&nbsp;com.rabbitmq.client.impl.AMQConnection.flush(AMQConnection.java:488)&lt;br&gt;       &nbsp;at&nbsp;com.rabbitmq.client.impl.AMQCommand.transmit(AMQCommand.java:125)&lt;br&gt;<br>
<br>
       &nbsp;at&nbsp;com.rabbitmq.client.impl.AMQChannel.quiescingTransmit(AMQChannel.java:316)&lt;br&gt;       &nbsp;-&nbsp;locked&nbsp;&amp;lt;0xb4532ee8&amp;gt;&nbsp;(a&nbsp;java.lang.Object)&lt;br&gt;       &nbsp;at&nbsp;com.rabbitmq.client.impl.AMQChannel.transmit(AMQChannel.java:292)&lt;br&gt;<br>
<br>
       &nbsp;-&nbsp;locked&nbsp;&amp;lt;0xb4532ee8&amp;gt;&nbsp;(a&nbsp;java.lang.Object)&lt;br&gt;       &nbsp;at&nbsp;com.rabbitmq.client.impl.ChannelN.basicPublish(ChannelN.java:634)&lt;br&gt;       &nbsp;at&nbsp;com.rabbitmq.client.impl.ChannelN.basicPublish(ChannelN.java:617)&lt;br&gt;<br>
       &nbsp;at&nbsp;com.rabbitmq.client.impl.ChannelN.basicPublish(ChannelN.java:608)&lt;br&gt;<br>
&lt;br&gt;&amp;quot;AMQP&nbsp;Connection&nbsp;&lt;a&nbsp;href=&quot;http://172.17.32.170:5672&quot;&nbsp;target=&quot;_blank&quot;&gt;172.17.32.170:5672&lt;/a&gt;&amp;quot;&nbsp;prio=10&nbsp;tid=0xac15d800&nbsp;nid=0x2c5c&nbsp;waiting&nbsp;for&nbsp;monitor&nbsp;entry&nbsp;[0xacb56000]&lt;br&gt;  &nbsp;java.lang.Thread.State:&nbsp;BLOCKED&nbsp;(on&nbsp;object&nbsp;monitor)&lt;br&gt;<br>
<br>
       &nbsp;at&nbsp;com.rabbitmq.client.impl.AMQChannel.processShutdownSignal(AMQChannel.java:263)&lt;br&gt;       &nbsp;-&nbsp;waiting&nbsp;to&nbsp;lock&nbsp;&amp;lt;0xb4532ee8&amp;gt;&nbsp;(a&nbsp;java.lang.Object)&lt;br&gt;       &nbsp;at&nbsp;com.rabbitmq.client.impl.ChannelN.startProcessShutdownSignal(ChannelN.java:259)&lt;br&gt;<br>
<br>
       &nbsp;at&nbsp;com.rabbitmq.client.impl.ChannelN.processShutdownSignal(ChannelN.java:283)&lt;br&gt;       &nbsp;at&nbsp;com.rabbitmq.client.impl.ChannelManager.handleSignal(ChannelManager.java:90)&lt;br&gt;       &nbsp;at&nbsp;com.rabbitmq.client.impl.AMQConnection.finishShutdown(AMQConnection.java:696)&lt;br&gt;<br>
<br>
       &nbsp;at&nbsp;com.rabbitmq.client.impl.AMQConnection.shutdown(AMQConnection.java:669)&lt;br&gt;       &nbsp;at&nbsp;com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:550)&lt;br&gt;&lt;br&gt;&amp;quot;pool-2-thread-1&amp;quot;&nbsp;prio=10&nbsp;tid=0xac167000&nbsp;nid=0x2c60&nbsp;waiting&nbsp;for&nbsp;monitor&nbsp;entry&nbsp;[0xac77d000]&lt;br&gt;<br>
<br>
  &nbsp;java.lang.Thread.State:&nbsp;BLOCKED&nbsp;(on&nbsp;object&nbsp;monitor)&lt;br&gt;       &nbsp;at&nbsp;java.io.BufferedOutputStream.write(BufferedOutputStream.java:94)&lt;br&gt;       &nbsp;-&nbsp;waiting&nbsp;to&nbsp;lock&nbsp;&amp;lt;0xb4532608&amp;gt;&nbsp;(a&nbsp;java.io.BufferedOutputStream)&lt;br&gt;       &nbsp;at&nbsp;java.io.DataOutputStream.writeByte(DataOutputStream.java:153)&lt;br&gt;<br>
<br>
       &nbsp;at&nbsp;com.rabbitmq.client.impl.Frame.writeTo(Frame.java:189)&lt;br&gt;       &nbsp;at&nbsp;com.rabbitmq.client.impl.SocketFrameHandler.writeFrame(SocketFrameHandler.java:137)&lt;br&gt;       &nbsp;-&nbsp;locked&nbsp;&amp;lt;0xb45325f0&amp;gt;&nbsp;(a&nbsp;java.io.DataOutputStream)&lt;br&gt;<br>
<br>
       &nbsp;at&nbsp;com.rabbitmq.client.impl.HeartbeatSender$HeartbeatRunnable.run(HeartbeatSender.java:133)&lt;br&gt;       &nbsp;at&nbsp;java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)&lt;br&gt;       &nbsp;at&nbsp;java.util.concurrent.FutureTask$Sync.innerRunAndReset(FutureTask.java:351)&lt;br&gt;<br>
<br>
       &nbsp;at&nbsp;java.util.concurrent.FutureTask.runAndReset(FutureTask.java:178)&lt;br&gt;       &nbsp;at&nbsp;java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$301(ScheduledThreadPoolExecutor.java:178)&lt;br&gt;       &nbsp;at&nbsp;java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)&lt;br&gt;<br>
<br>
       &nbsp;at&nbsp;java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)&lt;br&gt;       &nbsp;at&nbsp;java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)&lt;br&gt;       &nbsp;at&nbsp;java.lang.Thread.run(Thread.java:722)&lt;br&gt;<br>
<br>
&lt;br&gt;&lt;/div&gt;RabbitMQ&nbsp;server&nbsp;v&nbsp;3.0.2,&nbsp;client&nbsp;(java)&nbsp;v&nbsp;3.0.1,&nbsp;both&nbsp;run&nbsp;on&nbsp;rhel&nbsp;6.4.&lt;br&gt;&lt;br&gt;&lt;/div&gt;Do&nbsp;you&nbsp;know&nbsp;if&nbsp;there&nbsp;is&nbsp;some&nbsp;setting&nbsp;which&nbsp;can&nbsp;manage&nbsp;this&nbsp;timeout&nbsp;period&nbsp;(OS&nbsp;level&nbsp;/&nbsp;JVM&nbsp;level&nbsp;/&nbsp;client&nbsp;library&nbsp;level)?&lt;br&gt;&lt;/div&gt;<br>
<br>
&lt;div&gt;Also&nbsp;the&nbsp;thread&nbsp;&amp;quot;AMQP&nbsp;Connection&nbsp;...&amp;quot;&nbsp;seems&nbsp;is&nbsp;blocked&nbsp;on&nbsp;monitor&nbsp;<br>
object&nbsp;while&nbsp;trying&nbsp;to&nbsp;make&nbsp;shutdown&nbsp;-&nbsp;could&nbsp;it&nbsp;be&nbsp;a&nbsp;bug&nbsp;which&nbsp;prevents&nbsp;to&nbsp;<br>
make&nbsp;shutdown&nbsp;in&nbsp;time?&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;Thanks,&lt;br&gt;&lt;/div&gt;Oleg&lt;/div&gt;<br>

</tt>
