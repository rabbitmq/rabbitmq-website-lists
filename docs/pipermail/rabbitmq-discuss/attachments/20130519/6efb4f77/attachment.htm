<tt>
&lt;html&gt;<br>
&nbsp;&nbsp;&lt;head&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;content=&quot;text/html;&nbsp;charset=ISO-8859-1&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http-equiv=&quot;Content-Type&quot;&gt;<br>
&nbsp;&nbsp;&lt;/head&gt;<br>
&nbsp;&nbsp;&lt;body&nbsp;bgcolor=&quot;#FFFFFF&quot;&nbsp;text=&quot;#000000&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;class=&quot;moz-cite-prefix&quot;&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Hi,&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Thank&nbsp;you&nbsp;for&nbsp;prompt&nbsp;reply!&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Web&nbsp;application&nbsp;is&nbsp;coded&nbsp;in&nbsp;PHP.&nbsp;We&nbsp;tried&nbsp;both&nbsp;PHP&nbsp;AMQP&nbsp;extension<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;php-amqplib.&nbsp;We&nbsp;ended&nbsp;up&nbsp;using&nbsp;AMQP&nbsp;extension,&nbsp;because&nbsp;it<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;works&nbsp;much&nbsp;faster,&nbsp;since&nbsp;php-amqplib&nbsp;took&nbsp;80-100ms&nbsp;to&nbsp;connect&nbsp;and<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;send&nbsp;single&nbsp;message&nbsp;(but&nbsp;that's&nbsp;different&nbsp;issue).&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;With&nbsp;every&nbsp;execution,&nbsp;PHP&nbsp;scripts&nbsp;connects&nbsp;to&nbsp;RabbitMQ&nbsp;and&nbsp;post<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1-3&nbsp;messages.&nbsp;Since&nbsp;we're&nbsp;tracking&nbsp;banner&nbsp;displaying,&nbsp;additionally<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;when&nbsp;displayed&nbsp;to&nbsp;user,&nbsp;each&nbsp;page&nbsp;generates&nbsp;3-5&nbsp;more&nbsp;messages.&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;So,&nbsp;on&nbsp;producer&nbsp;side,&nbsp;we&nbsp;have&nbsp;many&nbsp;connections&nbsp;being&nbsp;made&nbsp;and&nbsp;1-3<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;short&nbsp;messages&nbsp;sent&nbsp;on&nbsp;single&nbsp;queue.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;On&nbsp;consumer&nbsp;side&nbsp;we&nbsp;have&nbsp;worker&nbsp;PHP&nbsp;processes,&nbsp;which&nbsp;are&nbsp;connected<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;once&nbsp;and&nbsp;receive&nbsp;messages.&nbsp;From&nbsp;time&nbsp;to&nbsp;time,&nbsp;we're&nbsp;sending&nbsp;ECHO<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(loopback&nbsp;messages)&nbsp;from&nbsp;producers&nbsp;to&nbsp;themselves,&nbsp;because&nbsp;we<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;noticed&nbsp;that&nbsp;producers&nbsp;do&nbsp;not&nbsp;recognize&nbsp;RabbitMQ&nbsp;server&nbsp;has&nbsp;gone<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;away&nbsp;or&nbsp;that&nbsp;VIP&nbsp;has&nbsp;switched&nbsp;to&nbsp;different&nbsp;server.&nbsp;With&nbsp;each&nbsp;ECHO<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;message&nbsp;new&nbsp;connection&nbsp;is&nbsp;established.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Regards,&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Nikola&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;On&nbsp;05/18/2013&nbsp;10:33&nbsp;PM,&nbsp;Michael&nbsp;Klishin&nbsp;wrote:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote<br>
cite=&quot;mid:CAE3HoVTT_bgQkpe_=E=X+FHtgAWZr4=rkehEmMS+=MKk51a+bg@mail.gmail.com&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;2013/5/18&nbsp;nikolasavic77&nbsp;&lt;span<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;moz-do-not-send=&quot;true&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;href=&quot;mailto:niksav@osic.rs&quot;&nbsp;target=&quot;_blank&quot;&gt;niksav@osic.rs&lt;/a&gt;&amp;gt;&lt;/span&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;What&nbsp;is&nbsp;expected&nbsp;value&nbsp;of&nbsp;consumed&nbsp;msg/s&nbsp;per&nbsp;CPU&nbsp;code<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;running&nbsp;at&nbsp;2.4GHz?&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;We're&nbsp;using&nbsp;4&nbsp;core&nbsp;VM&nbsp;running&nbsp;only&nbsp;RabbitMQ.&nbsp;When<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;under&nbsp;load&nbsp;of&nbsp;about&nbsp;500msg/s,&nbsp;IDLE&nbsp;is&nbsp;only&nbsp;about&nbsp;50%.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;This&nbsp;sounds&nbsp;like&nbsp;far&nbsp;away&nbsp;from&nbsp;high&nbsp;performance,&nbsp;since<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;we're&nbsp;expecting&nbsp;much&nbsp;much&nbsp;more&nbsp;msg/s&nbsp;:(&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;It&nbsp;depends&nbsp;on&nbsp;message&nbsp;size&nbsp;but&nbsp;500&nbsp;sounds&nbsp;way&nbsp;too&nbsp;low.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;However,&nbsp;consumer&nbsp;throughput&nbsp;greatly&nbsp;depends&nbsp;on&nbsp;the&nbsp;client&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;and&nbsp;consumer&nbsp;code.&nbsp;Can&nbsp;you&nbsp;post&nbsp;any?<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;What&nbsp;are&nbsp;your&nbsp;prefetch&nbsp;settings?&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MK&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;a&nbsp;moz-do-not-send=&quot;true&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;href=&quot;http://github.com/michaelklishin&quot;&nbsp;target=&quot;_blank&quot;&gt;http://github.com/michaelklishin&lt;/a&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;a&nbsp;moz-do-not-send=&quot;true&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;href=&quot;http://twitter.com/michaelklishin&quot;&nbsp;target=&quot;_blank&quot;&gt;http://twitter.com/michaelklishin&lt;/a&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;fieldset&nbsp;class=&quot;mimeAttachmentHeader&quot;&gt;&lt;/fieldset&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;_______________________________________________<br>
rabbitmq-discuss&nbsp;mailing&nbsp;list<br>
&lt;a&nbsp;class=&quot;moz-txt-link-abbreviated&quot;&nbsp;href=&quot;mailto:rabbitmq-discuss@lists.rabbitmq.com&quot;&gt;rabbitmq-discuss@lists.rabbitmq.com&lt;/a&gt;<br>
&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&quot;&gt;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&lt;/a&gt;<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
