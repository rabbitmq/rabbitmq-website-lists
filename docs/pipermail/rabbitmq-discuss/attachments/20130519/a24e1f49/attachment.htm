<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;php-amqplib&nbsp;from&nbsp;here &lt;a&nbsp;href=&quot;https://github.com/videlalvaro/php-amqplib&quot;&gt;https://github.com/videlalvaro/php-amqplib&lt;/a&gt;&nbsp;can&nbsp;easily&nbsp;publish&nbsp;4000&nbsp;msgs&nbsp;in&nbsp;1.5&nbsp;seconds&nbsp;and&nbsp;it&nbsp;can&nbsp;consume&nbsp;them&nbsp;in&nbsp;about&nbsp;the&nbsp;same&nbsp;time,&nbsp;using&nbsp;just&nbsp;1&nbsp;producer&nbsp;and&nbsp;1&nbsp;consumer.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;Is&nbsp;worth&nbsp;noting&nbsp;that&nbsp;the&nbsp;consumers&nbsp;in&nbsp;the&nbsp;benchmark&nbsp;code&nbsp;are&nbsp;doing&nbsp;a &lt;span&nbsp;style=&quot;color:rgb(0,128,128);font-family:Consolas,&amp;#39;Liberation&nbsp;Mono&amp;#39;,Courier,monospace;font-size:12px;line-height:18px;white-space:pre&quot;&gt;basic_consume&lt;/span&gt; on&nbsp;the&nbsp;queue&nbsp;and&nbsp;not&nbsp;a&nbsp;basic_get.&nbsp;The&nbsp;benchmark&nbsp;code&nbsp;can&nbsp;be&nbsp;easily&nbsp;run&nbsp;if&nbsp;you&nbsp;check&nbsp;out&nbsp;the&nbsp;library&nbsp;form&nbsp;Github&nbsp;and&nbsp;run&nbsp;&lt;b&gt;make&nbsp;benchmark&lt;/b&gt;.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;I&nbsp;think&nbsp;the&nbsp;problem&nbsp;you&nbsp;have&nbsp;on&nbsp;the&nbsp;producing&nbsp;side&nbsp;is&nbsp;the&nbsp;way&nbsp;PHP&nbsp;work,&nbsp;where&nbsp;sharing&nbsp;resources&nbsp;is&nbsp;not&nbsp;so&nbsp;easy&nbsp;due&nbsp;to&nbsp;the&nbsp;script&nbsp;state&nbsp;being&nbsp;cleaned&nbsp;after&nbsp;every&nbsp;request,&nbsp;thus&nbsp;the&nbsp;need&nbsp;of&nbsp;opening&nbsp;one&nbsp;connection&nbsp;per&nbsp;request.&lt;/div&gt;<br>
&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;Regarding&nbsp;persisting&nbsp;connections&nbsp;with&nbsp;PHP,&nbsp;while&nbsp;the&nbsp;socket&nbsp;connection&nbsp;to&nbsp;RabbitMQ&nbsp;could&nbsp;be&nbsp;persisted&nbsp;across&nbsp;requests,&nbsp;what&nbsp;do&nbsp;we&nbsp;do&nbsp;about&nbsp;channels&nbsp;and&nbsp;the whole connection&nbsp;state?&nbsp;With&nbsp;PHP&nbsp;this&nbsp;is&nbsp;not&nbsp;so&nbsp;easy&nbsp;to&nbsp;solve.&lt;/div&gt;<br>
&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;If&nbsp;you&nbsp;need&nbsp;to&nbsp;achieve&nbsp;max&nbsp;speed&nbsp;from&nbsp;your&nbsp;publishing&nbsp;side&nbsp;I&nbsp;would&nbsp;consider&nbsp;using&nbsp;a&nbsp;REST&nbsp;endpoint&nbsp;as&nbsp;someone&nbsp;suggested&nbsp;already.&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;On&nbsp;the&nbsp;other&nbsp;hand&nbsp;if&nbsp;your&nbsp;concern&nbsp;regarding&nbsp;publishing&nbsp;speed&nbsp;is&nbsp;to&nbsp;not&nbsp;make&nbsp;the&nbsp;users&nbsp;wait for&nbsp;the&nbsp;request&nbsp;to&nbsp;finish,&nbsp;then&nbsp;keep&nbsp;in&nbsp;mind&nbsp;that&nbsp;php-fpm&nbsp;has&nbsp;a&nbsp;function&nbsp;called &lt;span&nbsp;style=&quot;color:rgb(68,68,68);font-family:arial,sans-serif;line-height:17.77777862548828px&quot;&gt;fastcgi_finish_request.&nbsp;You&nbsp;can&nbsp;call&nbsp;it&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;your&nbsp;script&nbsp;and&nbsp;then&nbsp;send&nbsp;the&nbsp;messages&nbsp;to&nbsp;RabbitMQ.&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style&gt;&lt;span&nbsp;style=&quot;color:rgb(68,68,68);font-family:arial,sans-serif;line-height:17.77777862548828px&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;span&nbsp;style=&quot;color:rgb(68,68,68);font-family:arial,sans-serif;line-height:17.77777862548828px&quot;&gt;Regards,&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style&gt;&lt;span&nbsp;style=&quot;color:rgb(68,68,68);font-family:arial,sans-serif;line-height:17.77777862548828px&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;span&nbsp;style=&quot;color:rgb(68,68,68);font-family:arial,sans-serif;line-height:17.77777862548828px&quot;&gt;Alvaro&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Sun,&nbsp;May&nbsp;19,&nbsp;2013&nbsp;at&nbsp;4:11&nbsp;PM,&nbsp;Nikola&nbsp;Savic&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:niks@osic.rs&quot;&nbsp;target=&quot;_blank&quot;&gt;niks@osic.rs&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;&lt;div&nbsp;bgcolor=&quot;#FFFFFF&quot;&nbsp;text=&quot;#000000&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Consumers&nbsp;are&nbsp;not&nbsp;restarting&nbsp;...&nbsp;producers&nbsp;are.&nbsp;Every&nbsp;page&nbsp;request<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is&nbsp;new&nbsp;execution&nbsp;of&nbsp;PHP&nbsp;script,&nbsp;which&nbsp;must&nbsp;open&nbsp;new&nbsp;connection<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;when&nbsp;trying&nbsp;to&nbsp;send&nbsp;first&nbsp;message,&nbsp;and&nbsp;close&nbsp;it&nbsp;when&nbsp;it&nbsp;finishes.&lt;div&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;On&nbsp;05/19/2013&nbsp;04:08&nbsp;PM,&nbsp;Michael&nbsp;Klishin&nbsp;wrote:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;2013/5/19&nbsp;Nikola&nbsp;Savic&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:niks@osic.rs&quot;&nbsp;target=&quot;_blank&quot;&gt;niks@osic.rs&lt;/a&gt;&amp;gt;&lt;/span&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Yes&nbsp;...&nbsp;it&amp;#39;s&nbsp;the&nbsp;same&nbsp;app&nbsp;which&nbsp;postpones&nbsp;execution&nbsp;of<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;some&nbsp;actions&nbsp;using&nbsp;MQ.&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Then&nbsp;cluster&nbsp;won&amp;#39;t&nbsp;solve&nbsp;your&nbsp;problem&nbsp;because&nbsp;the&nbsp;issue&nbsp;is&nbsp;not<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;node&nbsp;delivery&nbsp;rate.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;You&nbsp;need&nbsp;to&nbsp;avoid&nbsp;constant&nbsp;restarts&nbsp;and&nbsp;reconnections&nbsp;for&nbsp;your<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;consumers&nbsp;or&nbsp;simply&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;increase&nbsp;their&nbsp;number&nbsp;and/or<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throughput.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MK&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;a&nbsp;href=&quot;http://github.com/michaelklishin&quot;&nbsp;target=&quot;_blank&quot;&gt;http://github.com/michaelklishin&lt;/a&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;a&nbsp;href=&quot;http://twitter.com/michaelklishin&quot;&nbsp;target=&quot;_blank&quot;&gt;http://twitter.com/michaelklishin&lt;/a&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;fieldset&gt;&lt;/fieldset&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;pre&gt;_______________________________________________<br>
rabbitmq-discuss&nbsp;mailing&nbsp;list<br>
&lt;a&nbsp;href=&quot;mailto:rabbitmq-discuss@lists.rabbitmq.com&quot;&nbsp;target=&quot;_blank&quot;&gt;rabbitmq-discuss@lists.rabbitmq.com&lt;/a&gt;<br>
&lt;a&nbsp;href=&quot;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&quot;&nbsp;target=&quot;_blank&quot;&gt;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&lt;/a&gt;<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;/div&gt;<br>
<br>
&lt;br&gt;_______________________________________________&lt;br&gt;<br>
rabbitmq-discuss&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:rabbitmq-discuss@lists.rabbitmq.com&quot;&gt;rabbitmq-discuss@lists.rabbitmq.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&quot;&nbsp;target=&quot;_blank&quot;&gt;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
