<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;&lt;div&nbsp;style&gt;I&nbsp;think&nbsp;it&amp;#39;s&nbsp;a&nbsp;problem&nbsp;of&nbsp;this&nbsp;particular&nbsp;instance.&nbsp;I&amp;#39;ve&nbsp;downgraded&nbsp;RabbitMQ&nbsp;to&nbsp;2.8.7,&nbsp;and&nbsp;still&nbsp;have&nbsp;same behavior -&nbsp;no&nbsp;reaction&nbsp;to&nbsp;invalid&nbsp;action,&nbsp;no&nbsp;errors&nbsp;at&nbsp;all.&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;<br>
<br>
&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;I&amp;#39;ve&nbsp;checked&nbsp;RabbitMQ&nbsp;logs&nbsp;-&nbsp;nothing&nbsp;related&nbsp;to&nbsp;my&nbsp;actions.&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;I&amp;#39;ve&nbsp;executed&nbsp;&amp;quot;rabbitmqctl&nbsp;status&amp;quot;&nbsp;to&nbsp;ensure&nbsp;that&nbsp;version&nbsp;is&nbsp;correct:&lt;/div&gt;&lt;div&nbsp;style&gt;<br>
<br>
&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;div&gt; rabbitmqctl&nbsp;status&lt;/div&gt;&lt;div&gt;Status&nbsp;of&nbsp;node&nbsp;&amp;#39;rabbit@ip-10-182-22-183&amp;#39;&nbsp;...&lt;/div&gt;&lt;div&gt;[{pid,30523},&lt;/div&gt;&lt;div&gt; {running_applications,[{rabbit,&amp;quot;RabbitMQ&amp;quot;,&amp;quot;2.8.7&amp;quot;},&lt;/div&gt;<br>
<br>
&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{os_mon,&amp;quot;CPO&nbsp; CXC&nbsp;138&nbsp;46&amp;quot;,&amp;quot;2.2.10&amp;quot;},&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{sasl,&amp;quot;SASL&nbsp; CXC&nbsp;138&nbsp;11&amp;quot;,&amp;quot;2.2.1&amp;quot;},&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{mnesia,&amp;quot;MNESIA&nbsp; CXC&nbsp;138&nbsp;12&amp;quot;,&amp;quot;4.7.1&amp;quot;},&lt;/div&gt;<br>
<br>
&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{stdlib,&amp;quot;ERTS&nbsp; CXC&nbsp;138&nbsp;10&amp;quot;,&amp;quot;1.18.2&amp;quot;},&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{kernel,&amp;quot;ERTS&nbsp; CXC&nbsp;138&nbsp;10&amp;quot;,&amp;quot;2.15.2&amp;quot;}]},&lt;/div&gt;&lt;div&gt; {os,{unix,linux}},&lt;/div&gt;&lt;div&gt;<br>
<br>
 {erlang_version,&amp;quot;Erlang&nbsp;R15B02&nbsp;(erts-5.9.2)&nbsp;[source]&nbsp;[64-bit]&nbsp;[smp:2:2]&nbsp;[async-threads:30]&nbsp;[hipe]&nbsp;[kernel-poll:true]\n&amp;quot;},&lt;/div&gt;&lt;div&gt; {memory,[{total,27509232},&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{processes,10481394},&lt;/div&gt;&lt;div&gt;<br>
<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{processes_used,10481380},&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{system,17027838},&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{atom,504409},&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{atom_used,476697},&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{binary,640152},&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{code,11973387},&lt;/div&gt;<br>
<br>
&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{ets,823696}]},&lt;/div&gt;&lt;div&gt; {vm_memory_high_watermark,0.4},&lt;/div&gt;&lt;div&gt; {vm_memory_limit,3221225472},&lt;/div&gt;&lt;div&gt; {disk_free_limit,1000000000},&lt;/div&gt;&lt;div&gt; {disk_free,267063296},&lt;/div&gt;&lt;div&gt; {file_descriptors,[{total_limit,924},&lt;/div&gt;<br>
<br>
&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{total_used,4},&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{sockets_limit,829},&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{sockets_used,2}]},&lt;/div&gt;&lt;div&gt; {processes,[{limit,1048576},{used,127}]},&lt;/div&gt;&lt;div&gt; {run_queue,0},&lt;/div&gt;<br>
<br>
&lt;div&gt; {uptime,173}]&lt;/div&gt;&lt;div&gt;...done.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&nbsp;style&gt;Is&nbsp;there&nbsp;anything&nbsp;else&nbsp;I&nbsp;can&nbsp;check?&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;<br>
<br>
&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;2013/1/17&nbsp;Matthias&nbsp;Radestock&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:matthias@rabbitmq.com&quot;&nbsp;target=&quot;_blank&quot;&gt;matthias@rabbitmq.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
<br>
On&nbsp;17/01/13&nbsp;23:04,&nbsp;Dmitriy&nbsp;Bannikov&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
I&amp;#39;ve&nbsp;created&nbsp;a&nbsp;test&nbsp;Java&nbsp;class&nbsp;which&nbsp;tries&nbsp;to&nbsp;publish&nbsp;message&nbsp;into&nbsp;a&lt;br&gt;<br>
fake&nbsp;queue.&lt;br&gt;<br>
In&nbsp;Windows&nbsp;this&nbsp;message&nbsp;is&nbsp;failing,&nbsp;and&nbsp;ReturnListener&nbsp;shows&nbsp;it&amp;#39;s&lt;br&gt;<br>
output.&nbsp;In&nbsp;Linux&nbsp;there&amp;#39;re&nbsp;not&nbsp;error&nbsp;or&nbsp;fails.&lt;br&gt;<br>
&lt;br&gt;<br>
I&amp;#39;ve&nbsp;just&nbsp;upgraded&nbsp;rabbitmq&nbsp;from&nbsp;2.8.6&nbsp;to&nbsp;3.0.1&nbsp;on&nbsp;both&nbsp;WIndows&nbsp;and&lt;br&gt;<br>
Linux&nbsp;machines.&lt;br&gt;<br>
&lt;br&gt;<br>
Code&nbsp;is&nbsp;following:&nbsp; [...]&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; channel.basicPublish(&amp;quot;&amp;quot;,&nbsp;&amp;quot;fake_queue_112233&amp;quot;,&nbsp;true,&nbsp;true,&lt;br&gt;<br>
props,&nbsp;&amp;quot;Test&nbsp;String&amp;quot;.getBytes());&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;<br>
That&nbsp;call&nbsp;has&nbsp;the&nbsp;&amp;#39;immediate&amp;#39;&nbsp;flag&nbsp;set.&nbsp;The&nbsp;RabbitMQ&nbsp;server&nbsp;stopped&nbsp;supporting&nbsp;that&nbsp;in&nbsp;3.0.0,&nbsp;so&nbsp;the&nbsp;above&nbsp;will&nbsp;result&nbsp;in&nbsp;an&nbsp;connection-level&nbsp;error.&lt;br&gt;<br>
&lt;br&gt;<br>
But&nbsp;since&nbsp;publishing&nbsp;is&nbsp;asynchronous,&nbsp;a&nbsp;client&nbsp;won&amp;#39;t&nbsp;see&nbsp;that&nbsp;error&nbsp;unless&nbsp;it&nbsp;a)&nbsp;stays&nbsp;around&nbsp;long&nbsp;enough&nbsp;for&nbsp;the&nbsp;error&nbsp;to&nbsp;arrive,&nbsp;and&nbsp;b)&nbsp;either&nbsp;performs&nbsp;some&nbsp;other&nbsp;action&nbsp;on&nbsp;the&nbsp;channel&nbsp;or&nbsp;has&nbsp;an&nbsp;appropriate&nbsp;error&nbsp;handler&nbsp;(in&nbsp;case&nbsp;of&nbsp;the&nbsp;Java&nbsp;client&nbsp;a&nbsp;ShutdownListener)&nbsp;configured&nbsp;on&nbsp;the&nbsp;channel.&nbsp;Since&nbsp;the&nbsp;basicPublish&nbsp;is&nbsp;the&nbsp;last&nbsp;thing&nbsp;your&nbsp;program&nbsp;does,&nbsp;and&nbsp;no&nbsp;handler&nbsp;is&nbsp;installed,&nbsp;the&nbsp;error&nbsp;won&amp;#39;t&nbsp;show&nbsp;up.&nbsp;And&nbsp;since&nbsp;the&nbsp;error&nbsp;that&nbsp;is&nbsp;generated&nbsp;is&nbsp;a&nbsp;connection&nbsp;level&nbsp;error,&nbsp;the&nbsp;connection&nbsp;will&nbsp;be&nbsp;closed&nbsp;and&nbsp;the&nbsp;program&nbsp;terminates.&nbsp;If&nbsp;you,&nbsp;say,&nbsp;added&nbsp;a&nbsp;connection.close()&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;your&nbsp;program,&nbsp;you&amp;#39;d&nbsp;get&nbsp;an&nbsp;error.&lt;br&gt;<br>
<br>
<br>
&lt;br&gt;<br>
Now,&nbsp;if&nbsp;you&nbsp;were&nbsp;just&nbsp;setting&nbsp;mandatory,&nbsp;or&nbsp;running&nbsp;2.8.6&nbsp;(where&nbsp;&amp;#39;immediate&amp;#39;&nbsp;doesn&amp;#39;t&nbsp;result&nbsp;in&nbsp;an&nbsp;error)&nbsp;then&nbsp;the&nbsp;return&nbsp;listener&nbsp;should&nbsp;get&nbsp;invoked.&nbsp;And&nbsp;since&nbsp;a&nbsp;return&nbsp;is&nbsp;a&nbsp;not&nbsp;an&nbsp;error,&nbsp;the&nbsp;connection&nbsp;will&nbsp;stay&nbsp;alive&nbsp;and&nbsp;the&nbsp;program&nbsp;won&amp;#39;t&nbsp;terminate.&nbsp;Indeed&nbsp;all&nbsp;that&nbsp;happens&nbsp;for&nbsp;me,&nbsp;on&nbsp;Linux,&nbsp;when&nbsp;I&nbsp;try&nbsp;it.&lt;br&gt;<br>
<br>
<br>
&lt;br&gt;<br>
As&nbsp;to&nbsp;why&nbsp;this&nbsp;would&nbsp;behave&nbsp;differently&nbsp;on&nbsp;windows&nbsp;and&nbsp;linux,&nbsp;I&nbsp;suspect&nbsp;the&nbsp;upgrade&nbsp;of&nbsp;the&nbsp;broker&nbsp;didn&amp;#39;t&nbsp;actually&nbsp;happen&nbsp;on&nbsp;the&nbsp;former,&nbsp;so&nbsp;it&amp;#39;s&nbsp;still&nbsp;running&nbsp;2.8.6.&lt;br&gt;<br>
&lt;br&gt;<br>
Regards,&lt;br&gt;<br>
&lt;br&gt;<br>
Matthias.&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
