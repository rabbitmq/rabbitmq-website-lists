<tt>
Hi,&lt;br&gt;&lt;br&gt;I&nbsp;recently&nbsp;upgraded&nbsp;from&nbsp;RabbitMQ&nbsp;1.8.1&nbsp;to&nbsp;2.3.1&nbsp;and&nbsp;am&nbsp;running&nbsp;in&nbsp;Mac&nbsp;and&nbsp;Ubuntu&nbsp;enviroments.&nbsp;I&nbsp;have&nbsp;a&nbsp;plugin&nbsp;that&nbsp;uses&nbsp;the&nbsp;amqp_client&nbsp;to&nbsp;access&nbsp;a&nbsp;local&nbsp;queue.&nbsp;With&nbsp;2.3.1&nbsp;when&nbsp;shutting&nbsp;down&nbsp;I&nbsp;get&nbsp;the&nbsp;error&nbsp;below,&nbsp;which&nbsp;I&nbsp;never&nbsp;encountered&nbsp;previously.&nbsp;There&nbsp;is&nbsp;no&nbsp;load&nbsp;when&nbsp;the&nbsp;shutdown&nbsp;is&nbsp;happening.&lt;br&gt;<br>
&lt;br&gt;I&nbsp;tried&nbsp;to&nbsp;determine&nbsp;the&nbsp;cause.&nbsp;It&nbsp;appears&nbsp;that&nbsp;it&nbsp;may&nbsp;be&nbsp;something&nbsp;of&nbsp;a&nbsp;race&nbsp;in&nbsp;that&nbsp;when&nbsp;I&nbsp;insert&nbsp;a&nbsp;500&nbsp;msec&nbsp;delay&nbsp;in&nbsp;amqp_channels_manger:handle_channel_down/4&nbsp;I&nbsp;get&nbsp;the&nbsp;initial&nbsp;internal&nbsp;error&nbsp;indication,&nbsp;but&nbsp;no&nbsp;following&nbsp;error&nbsp;report.&nbsp;My&nbsp;plugin&nbsp;is&nbsp;listed&nbsp;before&nbsp;the&nbsp;amqp_client&nbsp;application&nbsp;when&nbsp;I&nbsp;do&nbsp;a&nbsp;&amp;#39;rabbitmqctl&nbsp;status&amp;#39;&nbsp;so&nbsp;I&nbsp;it&nbsp;should&nbsp;be&nbsp;the&nbsp;first&nbsp;getting&nbsp;a&nbsp;chance&nbsp;to&nbsp;shutdown&nbsp;and&nbsp;close&nbsp;its&nbsp;amqp&nbsp;connection,&nbsp;i.e.,&nbsp;before&nbsp;the&nbsp;amqp_client&nbsp;shuts&nbsp;down,&nbsp;but&nbsp;I&nbsp;suppose&nbsp;applications&nbsp;shutdown&nbsp;asynchronously.&lt;br&gt;<br>
&lt;br&gt;Is&nbsp;this&nbsp;a&nbsp;bug&nbsp;or&nbsp;am&nbsp;I&nbsp;violating&nbsp;some&nbsp;RabbitMQ&nbsp;design&nbsp;assumption.&nbsp;Like&nbsp;I&nbsp;said,&nbsp;it&nbsp;wasn&amp;#39;t&nbsp;happening&nbsp;with&nbsp;1.8.1&nbsp;over&nbsp;the&nbsp;last&nbsp;10&nbsp;months&nbsp;of&nbsp;use.&lt;br&gt;&lt;br&gt;Lee&nbsp;Kirchhoff&lt;br&gt;&lt;br&gt;&lt;br&gt;=WARNING&nbsp;REPORT====&nbsp;10-Mar-2011::16:19:53&nbsp;===&lt;br&gt;<br>
Connection&nbsp;(&amp;lt;0.258.0&amp;gt;)&nbsp;closing:&nbsp;internal&nbsp;error&nbsp;in&nbsp;channel&nbsp;(&amp;lt;0.263.0&amp;gt;):&nbsp;shutdown&lt;br&gt;&lt;br&gt;=INFO&nbsp;REPORT====&nbsp;10-Mar-2011::16:19:53&nbsp;===&lt;br&gt;stopped&nbsp;TCP&nbsp;Listener&nbsp;on&nbsp;&lt;a&nbsp;href=&quot;http://0.0.0.0:5672&quot;&gt;0.0.0.0:5672&lt;/a&gt;&lt;br&gt;&lt;br&gt;<br>
=ERROR&nbsp;REPORT====&nbsp;10-Mar-2011::16:19:53&nbsp;===&lt;br&gt;**&nbsp;Generic&nbsp;server&nbsp;&amp;lt;0.258.0&amp;gt;&nbsp;terminating&nbsp;&lt;br&gt;**&nbsp;Last&nbsp;message&nbsp;in&nbsp;was&nbsp;{&amp;#39;$gen_cast&amp;#39;,channels_terminated}&lt;br&gt;**&nbsp;When&nbsp;Server&nbsp;state&nbsp;==&nbsp;{state,amqp_direct_connection,&lt;br&gt;<br>
                        &nbsp;{state,&amp;#39;rabbit@Lee-Kirchoffs-MacBook-Pro-9&amp;#39;,&lt;br&gt;                         &nbsp;{user,&amp;lt;&amp;lt;&amp;quot;admin&amp;quot;&amp;gt;&amp;gt;,false,&lt;br&gt;                          &nbsp;rabbit_auth_backend_internal,&lt;br&gt;                          &nbsp;{internal_user,&amp;lt;&amp;lt;&amp;quot;admin&amp;quot;&amp;gt;&amp;gt;,&lt;br&gt;<br>
                           &nbsp;&amp;lt;&amp;lt;167,250,242,115,130,251,81,144,147,129,52,74,15,&lt;br&gt;                             &nbsp;106,4,17,219,130,101,154&amp;gt;&amp;gt;,&lt;br&gt;                           &nbsp;false}},&lt;br&gt;                         &nbsp;&amp;lt;&amp;lt;&amp;quot;/right_net&amp;quot;&amp;gt;&amp;gt;,&amp;lt;0.261.0&amp;gt;,&lt;br&gt;<br>
                         &nbsp;{internal_error,541,&amp;lt;&amp;lt;&amp;gt;&amp;gt;}},&lt;br&gt;                        &nbsp;&amp;lt;0.256.0&amp;gt;,&amp;lt;0.259.0&amp;gt;,&lt;br&gt;                        &nbsp;{amqp_params,&amp;lt;&amp;lt;&amp;quot;admin&amp;quot;&amp;gt;&amp;gt;,&amp;lt;&amp;lt;&amp;quot;71a8B521&amp;quot;&amp;gt;&amp;gt;,&lt;br&gt;<br>
                         &nbsp;&amp;lt;&amp;lt;&amp;quot;/right_net&amp;quot;&amp;gt;&amp;gt;,&amp;quot;localhost&amp;quot;,5672,&lt;br&gt;                         &nbsp;&amp;#39;rabbit@Lee-Kirchoffs-MacBook-Pro-9&amp;#39;,0,0,0,none,&lt;br&gt;                         &nbsp;[#Fun&amp;lt;amqp_auth_mechanisms.plain.3&amp;gt;,&lt;br&gt;<br>
                          &nbsp;#Fun&amp;lt;amqp_auth_mechanisms.amqplain.3&amp;gt;],&lt;br&gt;                         &nbsp;[]},&lt;br&gt;                        &nbsp;0,&lt;br&gt;                        &nbsp;[{&amp;lt;&amp;lt;&amp;quot;copyright&amp;quot;&amp;gt;&amp;gt;,longstr,&lt;br&gt;                          &nbsp;&amp;lt;&amp;lt;&amp;quot;Copyright&nbsp;(C)&nbsp;2007-2011&nbsp;VMware,&nbsp;Inc.&amp;quot;&amp;gt;&amp;gt;},&lt;br&gt;<br>
                         &nbsp;{&amp;lt;&amp;lt;&amp;quot;information&amp;quot;&amp;gt;&amp;gt;,longstr,&lt;br&gt;                          &nbsp;&amp;lt;&amp;lt;&amp;quot;Licensed&nbsp;under&nbsp;the&nbsp;MPL. &nbsp;See&nbsp;&lt;a&nbsp;href=&quot;http://www.rabbitmq.com/&quot;&gt;http://www.rabbitmq.com/&lt;/a&gt;&amp;quot;&amp;gt;&amp;gt;},&lt;br&gt;<br>
                         &nbsp;{&amp;lt;&amp;lt;&amp;quot;platform&amp;quot;&amp;gt;&amp;gt;,longstr,&amp;lt;&amp;lt;&amp;quot;Erlang/OTP&amp;quot;&amp;gt;&amp;gt;},&lt;br&gt;                         &nbsp;{&amp;lt;&amp;lt;&amp;quot;product&amp;quot;&amp;gt;&amp;gt;,longstr,&amp;lt;&amp;lt;&amp;quot;RabbitMQ&amp;quot;&amp;gt;&amp;gt;},&lt;br&gt;<br>
                         &nbsp;{&amp;lt;&amp;lt;&amp;quot;version&amp;quot;&amp;gt;&amp;gt;,longstr,&amp;lt;&amp;lt;&amp;quot;%%VSN%%&amp;quot;&amp;gt;&amp;gt;}],&lt;br&gt;                        &nbsp;#Fun&amp;lt;amqp_connection_sup.1.27217533&amp;gt;,&lt;br&gt;                        &nbsp;#Fun&amp;lt;amqp_connection_sup.2.105785818&amp;gt;,&lt;br&gt;<br>
                        &nbsp;{closing,internal_error,&lt;br&gt;                         &nbsp;{&amp;#39;connection.close&amp;#39;,541,&amp;lt;&amp;lt;&amp;gt;&amp;gt;,0,0},&lt;br&gt;                         &nbsp;none}}&lt;br&gt;**&nbsp;Reason&nbsp;for&nbsp;termination&nbsp;==&nbsp;&lt;br&gt;**&nbsp;{internal_error,541,&amp;lt;&amp;lt;&amp;gt;&amp;gt;}&lt;br&gt;<br>
&lt;br&gt;
</tt>
