<tt>
I&nbsp;have&nbsp;a&nbsp;simple,&nbsp;single&nbsp;threaded&nbsp;program&nbsp;using&nbsp;Pika&amp;#39;s&nbsp;SelectConnection&nbsp;with&nbsp;RabbitMQ&nbsp;2.8.5&nbsp;that&nbsp;simply&nbsp;listens&nbsp;for&nbsp;request&nbsp;messages&nbsp;and&nbsp;replies&nbsp;to&nbsp;them.&lt;br&gt;&lt;br&gt;This&nbsp;code&nbsp;generally&nbsp;works&nbsp;-&nbsp;It&nbsp;can&nbsp;receive&nbsp;many&nbsp;thousands&nbsp;of&nbsp;messages&nbsp;<br>
before&nbsp;it&nbsp;croaks.&nbsp;When&nbsp;it&nbsp;does&nbsp;croak,&nbsp;it&amp;#39;s&nbsp;with&nbsp;the&nbsp;following&nbsp;error:&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;b&gt;CHANNEL_ERROR&nbsp;-&nbsp;unexpected&nbsp;command&nbsp;while&nbsp;processing&nbsp;&amp;#39;tx.commit&amp;#39;&lt;br&gt;&lt;br&gt;&lt;/b&gt;The&nbsp;code&nbsp;looks&nbsp;like&nbsp;this:&lt;br&gt;&lt;br&gt;def&nbsp;handle_delivery(channel,&nbsp;method,&nbsp;header,&nbsp;body):&lt;br&gt;   &nbsp;print&nbsp;&amp;quot;Received&nbsp;message&amp;quot;&lt;br&gt;&lt;br&gt;<br>
   &nbsp;channel.tx_select()&lt;br&gt;   &nbsp;channel.basic_publish(exchange=&amp;quot;skytap&amp;quot;,&lt;br&gt;       &nbsp;routing_key=&amp;#39;foo.bar&amp;#39;,&lt;br&gt;       &nbsp;body=&amp;#39;reply&amp;#39;,&lt;br&gt;       &nbsp;mandatory=True,&lt;br&gt;       &nbsp;properties=BasicProperties(delivery_mode=2))&lt;br&gt;<br>
   &nbsp;channel.tx_commit()&lt;br&gt;&lt;br&gt;   &nbsp;channel.tx_select()&lt;br&gt;   &nbsp;channel.basic_ack(delivery_tag=method.delivery_tag)&lt;br&gt;   &nbsp;channel.tx_commit()&lt;br&gt;&lt;br&gt;From&nbsp;looking&nbsp;at&nbsp;the&nbsp;code,&nbsp;nothing&amp;#39;s&nbsp;obviously&nbsp;wrong&nbsp;so&nbsp;I&nbsp;fired&nbsp;up&nbsp;WireShark.&nbsp;For&nbsp;the&nbsp;first&nbsp;several&nbsp;thousand&nbsp;messages,&nbsp;everything&nbsp;looks&nbsp;groovy,&nbsp;in&nbsp;particular,&nbsp;all&nbsp;Tx.Commit&nbsp;messages&nbsp;are&nbsp;always&nbsp;followed&nbsp;immediately&nbsp;by&nbsp;at&nbsp;Tx.Commit-Ok.&lt;br&gt;<br>
&lt;br&gt;However,&nbsp;when&nbsp;it&nbsp;dies,&nbsp;the&nbsp;sequence&nbsp;looks&nbsp;like&nbsp;this:&lt;br&gt;&lt;br&gt;--------&lt;br&gt;No.    &nbsp;Time       &nbsp;Source               &nbsp;Destination          &nbsp;Protocol&nbsp;Length&nbsp;Info&lt;br&gt;  &nbsp;3477&nbsp;60.138041  &nbsp;192.168.78.17        &nbsp;192.168.78.17        &nbsp;AMQP    &nbsp;99    &nbsp;Basic.Ack&nbsp;Tx.Commit&nbsp;&lt;br&gt;<br>
&lt;br&gt;Frame&nbsp;3477:&nbsp;99&nbsp;bytes&nbsp;on&nbsp;wire&nbsp;(792&nbsp;bits),&nbsp;99&nbsp;bytes&nbsp;captured&nbsp;(792&nbsp;bits)&lt;br&gt;Ethernet&nbsp;II,&nbsp;Src:&nbsp;00:00:00_00:00:00&nbsp;(00:00:00:00:00:00),&nbsp;Dst:&nbsp;00:00:00_00:00:00&nbsp;(00:00:00:00:00:00)&lt;br&gt;Internet&nbsp;Protocol&nbsp;Version&nbsp;4,&nbsp;Src:&nbsp;192.168.78.17&nbsp;(192.168.78.17),&nbsp;Dst:&nbsp;192.168.78.17&nbsp;(192.168.78.17)&lt;br&gt;<br>
Transmission&nbsp;Control&nbsp;Protocol,&nbsp;Src&nbsp;Port:&nbsp;38680&nbsp;(38680),&nbsp;Dst&nbsp;Port:&nbsp;amqp&nbsp;(5672),&nbsp;Seq:&nbsp;21061,&nbsp;Ack:&nbsp;41128,&nbsp;Len:&nbsp;33&lt;br&gt;Advanced&nbsp;Message&nbsp;Queueing&nbsp;Protocol&lt;br&gt;Advanced&nbsp;Message&nbsp;Queueing&nbsp;Protocol&lt;br&gt;&lt;br&gt;No.    &nbsp;Time       &nbsp;Source               &nbsp;Destination          &nbsp;Protocol&nbsp;Length&nbsp;Info&lt;br&gt;<br>
  &nbsp;3478&nbsp;60.139960  &nbsp;192.168.78.17        &nbsp;192.168.78.17        &nbsp;AMQP    &nbsp;318   &nbsp;Basic.Deliver&nbsp;Content-Header&nbsp;Content-Body&nbsp;&lt;br&gt;&lt;br&gt;Frame&nbsp;3478:&nbsp;318&nbsp;bytes&nbsp;on&nbsp;wire&nbsp;(2544&nbsp;bits),&nbsp;318&nbsp;bytes&nbsp;captured&nbsp;(2544&nbsp;bits)&lt;br&gt;Ethernet&nbsp;II,&nbsp;Src:&nbsp;00:00:00_00:00:00&nbsp;(00:00:00:00:00:00),&nbsp;Dst:&nbsp;00:00:00_00:00:00&nbsp;(00:00:00:00:00:00)&lt;br&gt;<br>
Internet&nbsp;Protocol&nbsp;Version&nbsp;4,&nbsp;Src:&nbsp;192.168.78.17&nbsp;(192.168.78.17),&nbsp;Dst:&nbsp;192.168.78.17&nbsp;(192.168.78.17)&lt;br&gt;Transmission&nbsp;Control&nbsp;Protocol,&nbsp;Src&nbsp;Port:&nbsp;amqp&nbsp;(5672),&nbsp;Dst&nbsp;Port:&nbsp;38680&nbsp;(38680),&nbsp;Seq:&nbsp;41128,&nbsp;Ack:&nbsp;21094,&nbsp;Len:&nbsp;252&lt;br&gt;Advanced&nbsp;Message&nbsp;Queueing&nbsp;Protocol&lt;br&gt;<br>
Advanced&nbsp;Message&nbsp;Queueing&nbsp;Protocol&lt;br&gt;Advanced&nbsp;Message&nbsp;Queueing&nbsp;Protocol&lt;br&gt;&lt;br&gt;No.    &nbsp;Time       &nbsp;Source               &nbsp;Destination          &nbsp;Protocol&nbsp;Length&nbsp;Info&lt;br&gt;  &nbsp;3479&nbsp;60.141903  &nbsp;192.168.78.17        &nbsp;192.168.78.17        &nbsp;AMQP    &nbsp;150   &nbsp;Basic.Publish&nbsp;Content-Header&nbsp;Content-Body&nbsp;&lt;br&gt;<br>
&lt;br&gt;Frame&nbsp;3479:&nbsp;150&nbsp;bytes&nbsp;on&nbsp;wire&nbsp;(1200&nbsp;bits),&nbsp;150&nbsp;bytes&nbsp;captured&nbsp;(1200&nbsp;bits)&lt;br&gt;Ethernet&nbsp;II,&nbsp;Src:&nbsp;00:00:00_00:00:00&nbsp;(00:00:00:00:00:00),&nbsp;Dst:&nbsp;00:00:00_00:00:00&nbsp;(00:00:00:00:00:00)&lt;br&gt;Internet&nbsp;Protocol&nbsp;Version&nbsp;4,&nbsp;Src:&nbsp;192.168.78.17&nbsp;(192.168.78.17),&nbsp;Dst:&nbsp;192.168.78.17&nbsp;(192.168.78.17)&lt;br&gt;<br>
Transmission&nbsp;Control&nbsp;Protocol,&nbsp;Src&nbsp;Port:&nbsp;38680&nbsp;(38680),&nbsp;Dst&nbsp;Port:&nbsp;amqp&nbsp;(5672),&nbsp;Seq:&nbsp;21094,&nbsp;Ack:&nbsp;41380,&nbsp;Len:&nbsp;84&lt;br&gt;Advanced&nbsp;Message&nbsp;Queueing&nbsp;Protocol&lt;br&gt;Advanced&nbsp;Message&nbsp;Queueing&nbsp;Protocol&lt;br&gt;Advanced&nbsp;Message&nbsp;Queueing&nbsp;Protocol&lt;br&gt;<br>
&lt;br&gt;No.    &nbsp;Time       &nbsp;Source               &nbsp;Destination          &nbsp;Protocol&nbsp;Length&nbsp;Info&lt;br&gt;  &nbsp;3489&nbsp;60.227975  &nbsp;192.168.78.17        &nbsp;192.168.78.17        &nbsp;AMQP    &nbsp;148   &nbsp;Connection.Close&nbsp;&lt;br&gt;&lt;br&gt;Frame&nbsp;3489:&nbsp;148&nbsp;bytes&nbsp;on&nbsp;wire&nbsp;(1184&nbsp;bits),&nbsp;148&nbsp;bytes&nbsp;captured&nbsp;(1184&nbsp;bits)&lt;br&gt;<br>
Ethernet&nbsp;II,&nbsp;Src:&nbsp;00:00:00_00:00:00&nbsp;(00:00:00:00:00:00),&nbsp;Dst:&nbsp;00:00:00_00:00:00&nbsp;(00:00:00:00:00:00)&lt;br&gt;Internet&nbsp;Protocol&nbsp;Version&nbsp;4,&nbsp;Src:&nbsp;192.168.78.17&nbsp;(192.168.78.17),&nbsp;Dst:&nbsp;192.168.78.17&nbsp;(192.168.78.17)&lt;br&gt;Transmission&nbsp;Control&nbsp;Protocol,&nbsp;Src&nbsp;Port:&nbsp;amqp&nbsp;(5672),&nbsp;Dst&nbsp;Port:&nbsp;38680&nbsp;(38680),&nbsp;Seq:&nbsp;41380,&nbsp;Ack:&nbsp;21178,&nbsp;Len:&nbsp;82&lt;br&gt;<br>
Advanced&nbsp;Message&nbsp;Queueing&nbsp;Protocol&lt;br&gt;--------&lt;br&gt;&lt;br&gt;That&nbsp;is,&nbsp;it&nbsp;looks&nbsp;like&nbsp;a&nbsp;Basic.Deliver&nbsp;and&nbsp;a&nbsp;Basic.Publish&nbsp;are&nbsp;sneaking&nbsp;in&nbsp;before&nbsp;the&nbsp;Tx.Commit-Ok&nbsp;comes&nbsp;back.&lt;br&gt;&lt;br&gt;I&nbsp;suspect&nbsp;this&nbsp;is&nbsp;a&nbsp;Pika&nbsp;issue,&nbsp;but&nbsp;my&nbsp;reading&nbsp;of&nbsp;the&nbsp;code&nbsp;doesn&amp;#39;t&nbsp;show&nbsp;any&nbsp;obvious&nbsp;problems.&lt;br&gt;<br>
&lt;br&gt;Thanks,&lt;br&gt;&lt;br&gt;Matt&lt;br&gt;&lt;br&gt;<br>

</tt>
