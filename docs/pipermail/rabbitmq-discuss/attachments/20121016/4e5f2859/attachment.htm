<tt>
&lt;html&gt;<br>
&nbsp;&nbsp;&lt;head&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;http-equiv=&quot;content-type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=UTF-8&quot;&gt;<br>
&nbsp;&nbsp;&lt;/head&gt;<br>
&nbsp;&nbsp;&lt;body&nbsp;bgcolor=&quot;#FFFFFF&quot;&nbsp;text=&quot;#000000&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;I've&nbsp;been&nbsp;tasked&nbsp;with&nbsp;monitoring&nbsp;a&nbsp;queue&nbsp;used&nbsp;by&nbsp;two&nbsp;applications,<br>
&nbsp;&nbsp;&nbsp;&nbsp;which&nbsp;are&nbsp;considered&nbsp;black&nbsp;boxes&nbsp;from&nbsp;my&nbsp;point&nbsp;of&nbsp;view&nbsp;(App&nbsp;A&nbsp;puts<br>
&nbsp;&nbsp;&nbsp;&nbsp;messages&nbsp;into&nbsp;a&nbsp;queue,&nbsp;App&nbsp;B&nbsp;consumes&nbsp;them;&nbsp;I&nbsp;have&nbsp;no&nbsp;control&nbsp;over<br>
&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;code&nbsp;for&nbsp;either&nbsp;app).&nbsp;I&nbsp;need&nbsp;to&nbsp;measure&nbsp;the&nbsp;rate&nbsp;of&nbsp;messages<br>
&nbsp;&nbsp;&nbsp;&nbsp;(messages/second)&nbsp;moving&nbsp;successfully&nbsp;from&nbsp;App&nbsp;A&nbsp;to&nbsp;App&nbsp;B&nbsp;through<br>
&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;queue.&nbsp;We're&nbsp;concerned&nbsp;with&nbsp;both&nbsp;pileups&nbsp;in&nbsp;the&nbsp;queue&nbsp;(producer<br>
&nbsp;&nbsp;&nbsp;&nbsp;working&nbsp;normally,&nbsp;consumer&nbsp;halted)&nbsp;and&nbsp;lack&nbsp;of&nbsp;new&nbsp;messages<br>
&nbsp;&nbsp;&nbsp;&nbsp;(producer&nbsp;halted).&nbsp;The&nbsp;end&nbsp;result&nbsp;will&nbsp;be&nbsp;a&nbsp;Nagios&nbsp;check&nbsp;plugin,<br>
&nbsp;&nbsp;&nbsp;&nbsp;which&nbsp;alerts&nbsp;when&nbsp;messages/second&nbsp;throughput&nbsp;falls&nbsp;below&nbsp;a&nbsp;given<br>
&nbsp;&nbsp;&nbsp;&nbsp;level,&nbsp;and&nbsp;also&nbsp;produces&nbsp;performance&nbsp;data&nbsp;for&nbsp;graphing.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;I've&nbsp;been&nbsp;examining&nbsp;the&nbsp;JSON&nbsp;results&nbsp;from&nbsp;the&nbsp;management&nbsp;API<br>
&nbsp;&nbsp;&nbsp;&nbsp;(/api/queues/vhost_name/queue_name),&nbsp;and&nbsp;have&nbsp;come&nbsp;to&nbsp;the&nbsp;following<br>
&nbsp;&nbsp;&nbsp;&nbsp;conclusions:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;1)&nbsp;There&nbsp;are&nbsp;no&nbsp;monotonically&nbsp;increasing&nbsp;counters&nbsp;of&nbsp;the&nbsp;number&nbsp;of<br>
&nbsp;&nbsp;&nbsp;&nbsp;messages&nbsp;in&nbsp;to&nbsp;the&nbsp;queue&nbsp;and&nbsp;number&nbsp;of&nbsp;messages&nbsp;out&nbsp;of&nbsp;the&nbsp;queue.<br>
&nbsp;&nbsp;&nbsp;&nbsp;Therefore,&nbsp;there's&nbsp;no&nbsp;way&nbsp;for&nbsp;me&nbsp;to&nbsp;figure&nbsp;the&nbsp;rate&nbsp;on&nbsp;an&nbsp;arbitrary<br>
&nbsp;&nbsp;&nbsp;&nbsp;time&nbsp;scale.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;2)&nbsp;The&nbsp;&quot;messages&quot;&nbsp;element&nbsp;in&nbsp;the&nbsp;JSON&nbsp;array&nbsp;is&nbsp;the&nbsp;number&nbsp;of<br>
&nbsp;&nbsp;&nbsp;&nbsp;messages&nbsp;currently&nbsp;sitting&nbsp;in&nbsp;the&nbsp;queue,&nbsp;not&nbsp;a&nbsp;counter&nbsp;of&nbsp;the&nbsp;number<br>
&nbsp;&nbsp;&nbsp;&nbsp;that&nbsp;have&nbsp;passed&nbsp;through&nbsp;it.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;3)&nbsp;The&nbsp;API&nbsp;does&nbsp;provide&nbsp;backing_queue_status.avg_ingress_rate&nbsp;and<br>
&nbsp;&nbsp;&nbsp;&nbsp;backing_queue_status.avg_egress_rate.&nbsp;Going&nbsp;by&nbsp;Matthew's&nbsp;post&nbsp;to<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;Monitoring&nbsp;Message&nbsp;Throughput&quot;&nbsp;(&lt;a<br>
href=&quot;http://rabbitmq.1065348.n5.nabble.com/Monitoring-Message-Throughput-td17436.html#a17438&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;target=&quot;_blank&quot;&gt;http://rabbitmq.1065348.n5.&lt;wbr&gt;nabble.com/Monitoring-Message-&lt;wbr&gt;Throughput-td17436.html#a17438&lt;/a&gt;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;February,&nbsp;2010,&nbsp;I&nbsp;gather&nbsp;that&nbsp;these&nbsp;values&nbsp;are&nbsp;averaged&nbsp;over<br>
&nbsp;&nbsp;&nbsp;&nbsp;approx.&nbsp;10&nbsp;seconds.&nbsp;I'm&nbsp;also&nbsp;assuming&nbsp;that&nbsp;ingress&nbsp;is&nbsp;*every*<br>
&nbsp;&nbsp;&nbsp;&nbsp;message&nbsp;into&nbsp;the&nbsp;queue,&nbsp;and&nbsp;egress&nbsp;is...&nbsp;*every*&nbsp;message&nbsp;grabbed<br>
&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;the&nbsp;queue,&nbsp;regardless&nbsp;of&nbsp;ACK?&nbsp;So&nbsp;even&nbsp;if&nbsp;consumers&nbsp;are&nbsp;not<br>
&nbsp;&nbsp;&nbsp;&nbsp;acking&nbsp;any&nbsp;messages,&nbsp;this&nbsp;rate&nbsp;will&nbsp;still&nbsp;show&nbsp;them?&nbsp;And&nbsp;I&nbsp;assume<br>
&nbsp;&nbsp;&nbsp;&nbsp;that&nbsp;means&nbsp;these&nbsp;values&nbsp;wouldn't&nbsp;be&nbsp;useful&nbsp;for&nbsp;a&nbsp;low-utilization,<br>
&nbsp;&nbsp;&nbsp;&nbsp;bursty&nbsp;queue&nbsp;(i.e.,&nbsp;say,&nbsp;a&nbsp;30-message&nbsp;burst&nbsp;every&nbsp;few&nbsp;minutes)?&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Are&nbsp;these&nbsp;correct?&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;It&nbsp;would&nbsp;be&nbsp;really&nbsp;helpful&nbsp;if&nbsp;someone&nbsp;could&nbsp;explain&nbsp;exactly&nbsp;what<br>
&nbsp;&nbsp;&nbsp;&nbsp;avg_in/egress_rate&nbsp;and&nbsp;avg_ack_in/egress_rate&nbsp;mean&nbsp;in&nbsp;the&nbsp;JSON<br>
&nbsp;&nbsp;&nbsp;&nbsp;output&nbsp;-&nbsp;I've&nbsp;done&nbsp;a&nbsp;bunch&nbsp;of&nbsp;testing&nbsp;with&nbsp;a&nbsp;Pika&nbsp;client&nbsp;connected<br>
&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;RabbitMQ&nbsp;2.8.7&nbsp;on&nbsp;my&nbsp;workstation,&nbsp;but&nbsp;I&nbsp;can't&nbsp;seem&nbsp;to&nbsp;draw&nbsp;a<br>
&nbsp;&nbsp;&nbsp;&nbsp;clear&nbsp;connection&nbsp;between&nbsp;what&nbsp;my&nbsp;client&nbsp;is&nbsp;doing&nbsp;and&nbsp;what<br>
&nbsp;&nbsp;&nbsp;&nbsp;avg_ingress_rate&nbsp;and&nbsp;avg_egress_rate&nbsp;show&nbsp;in&nbsp;the&nbsp;JSON,&nbsp;or&nbsp;what&nbsp;the<br>
&nbsp;&nbsp;&nbsp;&nbsp;avg_ack_[in|e]gress_rateÂ &nbsp;show,&nbsp;when&nbsp;I&nbsp;watch&nbsp;everything<br>
&nbsp;&nbsp;&nbsp;&nbsp;simultaneously.&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;I&nbsp;also&nbsp;found&nbsp;some&nbsp;reference&nbsp;to&nbsp;a&nbsp;Ticket&nbsp;23&nbsp;(though&nbsp;I&nbsp;don't&nbsp;see&nbsp;any<br>
&nbsp;&nbsp;&nbsp;&nbsp;links&nbsp;to&nbsp;the&nbsp;RMQ&nbsp;ticketing&nbsp;system)&nbsp;that&nbsp;dealt&nbsp;with&nbsp;monitoring,&nbsp;but<br>
&nbsp;&nbsp;&nbsp;&nbsp;no&nbsp;reference&nbsp;to&nbsp;any&nbsp;updates&nbsp;to&nbsp;it:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;a<br>
href=&quot;http://grokbase.com/t/rabbitmq/rabbitmq-discuss/10ag2hejbb/ticket-23-new-comment-monitoring-message-throughput&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;target=&quot;_blank&quot;&gt;http://grokbase.com/t/&lt;wbr&gt;rabbitmq/rabbitmq-discuss/&lt;wbr&gt;10ag2hejbb/ticket-23-new-&lt;wbr&gt;comment-monitoring-message-&lt;wbr&gt;throughput&lt;/a&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Any&nbsp;guidance/advice/pointers&nbsp;would&nbsp;be&nbsp;greatly&nbsp;appreciated.&nbsp;I've&nbsp;been<br>
&nbsp;&nbsp;&nbsp;&nbsp;working&nbsp;on&nbsp;this&nbsp;monitoring&nbsp;for&nbsp;two&nbsp;days&nbsp;now,&nbsp;and&nbsp;I&nbsp;can't&nbsp;find<br>
&nbsp;&nbsp;&nbsp;&nbsp;anything&nbsp;that&nbsp;I'm&nbsp;confident&nbsp;is&nbsp;a&nbsp;correct&nbsp;solution...&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Thanks,&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Jason&nbsp;Antman&lt;br&gt;<br>
&nbsp;&nbsp;&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
