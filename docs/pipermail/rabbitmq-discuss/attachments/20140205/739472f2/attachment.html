<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;p&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;clear:&nbsp;both;&nbsp;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;font-family:&nbsp;Arial,&nbsp;'Liberation&nbsp;Sans',&nbsp;'DejaVu&nbsp;Sans',&nbsp;sans-serif;&nbsp;line-height:&nbsp;17.804800033569336px;&quot;&gt;I'm&nbsp;using&nbsp;different&nbsp;&quot;Per&nbsp;Message&nbsp;TTL&quot;&nbsp;in&nbsp;RabbitMQ&nbsp;queue,&nbsp;and&nbsp;I&nbsp;expect&nbsp;that&nbsp;messages&nbsp;with&nbsp;different&nbsp;TTL&nbsp;should&nbsp;be&nbsp;processed&nbsp;by&nbsp;consumer&nbsp;in&nbsp;due&nbsp;time.&lt;/p&gt;&lt;p&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;clear:&nbsp;both;&nbsp;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;font-family:&nbsp;Arial,&nbsp;'Liberation&nbsp;Sans',&nbsp;'DejaVu&nbsp;Sans',&nbsp;sans-serif;&nbsp;line-height:&nbsp;17.804800033569336px;&quot;&gt;To&nbsp;provide&nbsp;this&nbsp;behaviour,&nbsp;I&nbsp;use&nbsp;RabbitMQ&nbsp;queue&nbsp;with&nbsp;huge&nbsp;&quot;x-message-ttl&quot;,&nbsp;I&nbsp;add&nbsp;messages&nbsp;to&nbsp;this&nbsp;queue&nbsp;with&nbsp;own&nbsp;value&nbsp;of&nbsp;&quot;Per&nbsp;Message&nbsp;TTL&quot;(see&nbsp;code&nbsp;below).&nbsp;For&nbsp;example&nbsp;add&nbsp;to&nbsp;queue&nbsp;messages&nbsp;with&nbsp;TTL&nbsp;30,&nbsp;20&nbsp;and&nbsp;10&nbsp;seconds.&lt;/p&gt;&lt;p&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;clear:&nbsp;both;&nbsp;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;font-family:&nbsp;Arial,&nbsp;'Liberation&nbsp;Sans',&nbsp;'DejaVu&nbsp;Sans',&nbsp;sans-serif;&nbsp;line-height:&nbsp;17.804800033569336px;&quot;&gt;The&nbsp;problem&nbsp;in&nbsp;behaviour,&nbsp;how&nbsp;RabbitMQ&nbsp;process&nbsp;the&nbsp;messages&nbsp;with&nbsp;different&nbsp;&quot;Per&nbsp;MessageTTL&quot;&nbsp;in&nbsp;queue,&nbsp;the&nbsp;messages&nbsp;with&nbsp;largest&nbsp;TTL&nbsp;stop&nbsp;the&nbsp;messages&nbsp;with&nbsp;less&nbsp;TTL.&nbsp;So&nbsp;consumer&nbsp;process&nbsp;all&nbsp;mesages&nbsp;together,&nbsp;when&nbsp;largest&nbsp;TTL&nbsp;expire.&lt;/p&gt;&lt;p&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;clear:&nbsp;both;&nbsp;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;font-family:&nbsp;Arial,&nbsp;'Liberation&nbsp;Sans',&nbsp;'DejaVu&nbsp;Sans',&nbsp;sans-serif;&nbsp;line-height:&nbsp;17.804800033569336px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;clear:&nbsp;both;&nbsp;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;font-family:&nbsp;Arial,&nbsp;'Liberation&nbsp;Sans',&nbsp;'DejaVu&nbsp;Sans',&nbsp;sans-serif;&nbsp;line-height:&nbsp;17.804800033569336px;&quot;&gt;&lt;strong&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;transparent;&quot;&gt;Publish&nbsp;message&nbsp;code:&lt;/strong&gt;&lt;/p&gt;&lt;pre&nbsp;class=&quot;lang-php&nbsp;prettyprint&nbsp;prettyprinted&quot;&nbsp;style=&quot;margin-bottom:&nbsp;10px;&nbsp;padding:&nbsp;5px;&nbsp;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;rgb(238,&nbsp;238,&nbsp;238);&nbsp;font-family:&nbsp;Consolas,&nbsp;Menlo,&nbsp;Monaco,&nbsp;'Lucida&nbsp;Console',&nbsp;'Liberation&nbsp;Mono',&nbsp;'DejaVu&nbsp;Sans&nbsp;Mono',&nbsp;'Bitstream&nbsp;Vera&nbsp;Sans&nbsp;Mono',&nbsp;'Courier&nbsp;New',&nbsp;monospace,&nbsp;serif;&nbsp;overflow:&nbsp;auto;&nbsp;width:&nbsp;auto;&nbsp;max-height:&nbsp;600px;&nbsp;word-wrap:&nbsp;normal;&nbsp;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;line-height:&nbsp;17.804800033569336px;&quot;&gt;&lt;code&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;font-family:&nbsp;Consolas,&nbsp;Menlo,&nbsp;Monaco,&nbsp;'Lucida&nbsp;Console',&nbsp;'Liberation&nbsp;Mono',&nbsp;'DejaVu&nbsp;Sans&nbsp;Mono',&nbsp;'Bitstream&nbsp;Vera&nbsp;Sans&nbsp;Mono',&nbsp;'Courier&nbsp;New',&nbsp;monospace,&nbsp;serif;&quot;&gt;&lt;span&nbsp;class=&quot;pln&quot;&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;transparent;&quot;&gt;$channel&nbsp;&lt;/span&gt;&lt;span&nbsp;class=&quot;pun&quot;&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;transparent;&quot;&gt;=&lt;/span&gt;&lt;span&nbsp;class=&quot;pln&quot;&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;transparent;&quot;&gt;&nbsp;&lt;/span&gt;&lt;span&nbsp;class=&quot;kwd&quot;&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;transparent;&nbsp;color:&nbsp;rgb(0,&nbsp;0,&nbsp;139);&quot;&gt;new&lt;/span&gt;&lt;span&nbsp;class=&quot;pln&quot;&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;transparent;&quot;&gt;&nbsp;&lt;/span&gt;&lt;span&nbsp;class=&quot;typ&quot;&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;transparent;&nbsp;color:&nbsp;rgb(43,&nbsp;145,&nbsp;175);&quot;&gt;AMQPChannel&lt;/span&gt;&lt;span&nbsp;class=&quot;pun&quot;&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;transparent;&quot;&gt;(&lt;/span&gt;&lt;span&nbsp;class=&quot;pln&quot;&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;transparent;&quot;&gt;$this&lt;/span&gt;&lt;span&nbsp;class=&quot;pun&quot;&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;transparent;&quot;&gt;-&gt;&lt;/span&gt;&lt;span&nbsp;class=&quot;pln&quot;&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;transparent;&quot;&gt;connection&lt;/span&gt;&lt;span&nbsp;class=&quot;pun&quot;&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;transparent;&quot;&gt;);&lt;/span&gt;&lt;span&nbsp;class=&quot;pln&quot;&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;transparent;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;<br>
$exchange&nbsp;&lt;/span&gt;&lt;span&nbsp;class=&quot;pun&quot;&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;transparent;&quot;&gt;=&lt;/span&gt;&lt;span&nbsp;class=&quot;pln&quot;&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;transparent;&quot;&gt;&nbsp;&lt;/span&gt;&lt;span&nbsp;class=&quot;kwd&quot;&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;transparent;&nbsp;color:&nbsp;rgb(0,&nbsp;0,&nbsp;139);&quot;&gt;new&lt;/span&gt;&lt;span&nbsp;class=&quot;pln&quot;&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;transparent;&quot;&gt;&nbsp;&lt;/span&gt;&lt;span&nbsp;class=&quot;typ&quot;&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;transparent;&nbsp;color:&nbsp;rgb(43,&nbsp;145,&nbsp;175);&quot;&gt;AMQPExchange&lt;/span&gt;&lt;span&nbsp;class=&quot;pun&quot;&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;transparent;&quot;&gt;(&lt;/span&gt;&lt;span&nbsp;class=&quot;pln&quot;&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;transparent;&quot;&gt;$channel&lt;/span&gt;&lt;span&nbsp;class=&quot;pun&quot;&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;transparent;&quot;&gt;);&lt;/span&gt;&lt;span&nbsp;class=&quot;pln&quot;&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;transparent;&quot;&gt;<br>
$exchange&lt;/span&gt;&lt;span&nbsp;class=&quot;pun&quot;&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;transparent;&quot;&gt;-&gt;&lt;/span&gt;&lt;span&nbsp;class=&quot;pln&quot;&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;transparent;&quot;&gt;setName&lt;/span&gt;&lt;span&nbsp;class=&quot;pun&quot;&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;transparent;&quot;&gt;(&lt;/span&gt;&lt;span&nbsp;class=&quot;pln&quot;&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;transparent;&quot;&gt;$exchangeName&lt;/span&gt;&lt;span&nbsp;class=&quot;pun&quot;&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;transparent;&quot;&gt;);&lt;/span&gt;&lt;span&nbsp;class=&quot;pln&quot;&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;transparent;&quot;&gt;<br>
$exchange&lt;/span&gt;&lt;span&nbsp;class=&quot;pun&quot;&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;transparent;&quot;&gt;-&gt;&lt;/span&gt;&lt;span&nbsp;class=&quot;pln&quot;&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;transparent;&quot;&gt;setType&lt;/span&gt;&lt;span&nbsp;class=&quot;pun&quot;&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;transparent;&quot;&gt;(&lt;/span&gt;&lt;span&nbsp;class=&quot;pln&quot;&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;transparent;&quot;&gt;AMQP_EX_TYPE_DIRECT&lt;/span&gt;&lt;span&nbsp;class=&quot;pun&quot;&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;transparent;&quot;&gt;);&lt;/span&gt;&lt;span&nbsp;class=&quot;pln&quot;&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;transparent;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
$ttl&nbsp;&lt;/span&gt;&lt;span&nbsp;class=&quot;pun&quot;&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;transparent;&quot;&gt;=&lt;/span&gt;&lt;span&nbsp;class=&quot;pln&quot;&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;transparent;&quot;&gt;&nbsp;$ttl&lt;/span&gt;&lt;span&nbsp;class=&quot;pun&quot;&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;transparent;&quot;&gt;*&lt;/span&gt;&lt;span&nbsp;class=&quot;lit&quot;&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;transparent;&nbsp;color:&nbsp;rgb(128,&nbsp;0,&nbsp;0);&quot;&gt;1000&lt;/span&gt;&lt;span&nbsp;class=&quot;pun&quot;&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;transparent;&quot;&gt;;&lt;/span&gt;&lt;span&nbsp;class=&quot;pln&quot;&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;transparent;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;<br>
$params&nbsp;&lt;/span&gt;&lt;span&nbsp;class=&quot;pun&quot;&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;transparent;&quot;&gt;=&lt;/span&gt;&lt;span&nbsp;class=&quot;pln&quot;&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;transparent;&quot;&gt;&nbsp;array&lt;/span&gt;&lt;span&nbsp;class=&quot;pun&quot;&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;transparent;&quot;&gt;(&lt;/span&gt;&lt;span&nbsp;class=&quot;str&quot;&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;transparent;&nbsp;color:&nbsp;rgb(128,&nbsp;0,&nbsp;0);&quot;&gt;'expiration'&lt;/span&gt;&lt;span&nbsp;class=&quot;pun&quot;&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;transparent;&quot;&gt;=&gt;&lt;/span&gt;&lt;span&nbsp;class=&quot;pln&quot;&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;transparent;&quot;&gt;$ttl&lt;/span&gt;&lt;span&nbsp;class=&quot;pun&quot;&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;transparent;&quot;&gt;);&lt;/span&gt;&lt;span&nbsp;class=&quot;pln&quot;&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;transparent;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;<br>
$message&nbsp;&lt;/span&gt;&lt;span&nbsp;class=&quot;pun&quot;&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;transparent;&quot;&gt;=&lt;/span&gt;&lt;span&nbsp;class=&quot;pln&quot;&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;transparent;&quot;&gt;&nbsp;$exchange&lt;/span&gt;&lt;span&nbsp;class=&quot;pun&quot;&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;transparent;&quot;&gt;-&gt;&lt;/span&gt;&lt;span&nbsp;class=&quot;pln&quot;&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;transparent;&quot;&gt;publish&lt;/span&gt;&lt;span&nbsp;class=&quot;pun&quot;&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;transparent;&quot;&gt;(&lt;/span&gt;&lt;span&nbsp;class=&quot;pln&quot;&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;transparent;&quot;&gt;$msg&lt;/span&gt;&lt;span&nbsp;class=&quot;pun&quot;&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;transparent;&quot;&gt;,&lt;/span&gt;&lt;span&nbsp;class=&quot;pln&quot;&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;transparent;&quot;&gt;&nbsp;$this&lt;/span&gt;&lt;span&nbsp;class=&quot;pun&quot;&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;transparent;&quot;&gt;-&gt;&lt;/span&gt;&lt;span&nbsp;class=&quot;pln&quot;&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;transparent;&quot;&gt;queueNotDelayedName&lt;/span&gt;&lt;span&nbsp;class=&quot;pun&quot;&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;transparent;&quot;&gt;,&lt;/span&gt;&lt;span&nbsp;class=&quot;pln&quot;&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;transparent;&quot;&gt;&nbsp;&lt;/span&gt;&lt;span&nbsp;class=&quot;kwd&quot;&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;transparent;&nbsp;color:&nbsp;rgb(0,&nbsp;0,&nbsp;139);&quot;&gt;null&lt;/span&gt;&lt;span&nbsp;class=&quot;pun&quot;&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;transparent;&quot;&gt;,&lt;/span&gt;&lt;span&nbsp;class=&quot;pln&quot;&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;transparent;&quot;&gt;&nbsp;$params&lt;/span&gt;&lt;span&nbsp;class=&quot;pun&quot;&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;background-color:&nbsp;transparent;&quot;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&nbsp;style=&quot;font-size:&nbsp;13.600000381469727px;&nbsp;clear:&nbsp;both;&nbsp;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;font-family:&nbsp;Arial,&nbsp;'Liberation&nbsp;Sans',&nbsp;'DejaVu&nbsp;Sans',&nbsp;sans-serif;&nbsp;line-height:&nbsp;17.804800033569336px;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;/div&gt;
</tt>
