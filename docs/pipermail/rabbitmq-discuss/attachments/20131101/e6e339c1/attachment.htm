<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi&nbsp;Matthais,&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Fri,&nbsp;Nov&nbsp;1,&nbsp;2013&nbsp;at&nbsp;7:05&nbsp;AM,&nbsp;Matthias&nbsp;Radestock&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:matthias@rabbitmq.com&quot;&nbsp;target=&quot;_blank&quot;&gt;matthias@rabbitmq.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;Jonathan,&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
On&nbsp;31/10/13&nbsp;18:54,&nbsp;Jonathan&nbsp;Halterman&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;<br>
I&nbsp;don&amp;#39;t&nbsp;suppose&nbsp;you&amp;#39;re&nbsp;open&nbsp;to&nbsp;enhancing&nbsp;the&nbsp;amqp-client&nbsp;API&nbsp;to&nbsp;include&lt;br&gt;<br>
something&nbsp;like&nbsp;this?&nbsp;:)&nbsp;One&nbsp;possible&nbsp;change&nbsp;would&nbsp;be&nbsp;the&nbsp;inclusion&nbsp;of&nbsp;a&lt;br&gt;<br>
VersionedDeliveryTag&nbsp;like&nbsp;object&nbsp;in&nbsp;the&nbsp;Envelope&nbsp;along&nbsp;with&nbsp;some&lt;br&gt;<br>
corresponding&nbsp;basic&nbsp;ack/nack/reject(&lt;u&gt;&lt;/u&gt;VersionedDeliveryTag)&nbsp;methods&nbsp;on&nbsp;the&lt;br&gt;<br>
Channel&nbsp;interface.&nbsp;The&nbsp;channel&amp;#39;s&nbsp;&amp;quot;version&amp;quot;&nbsp;would&nbsp;just&nbsp;be&nbsp;another&nbsp;piece&lt;br&gt;<br>
of&nbsp;meta&nbsp;information&nbsp;that&nbsp;the&nbsp;user&nbsp;could&nbsp;specify.&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;&lt;/div&gt;<br>
Such&nbsp;an&nbsp;API&nbsp;extension&nbsp;doesn&amp;#39;t&nbsp;really&nbsp;make&nbsp;sense&nbsp;in&nbsp;the&nbsp;existing&nbsp;client.&nbsp;Plus,&nbsp;in&nbsp;order&nbsp;to&nbsp;take&nbsp;advantage&nbsp;of&nbsp;it&nbsp;client&nbsp;code&nbsp;would&nbsp;have&nbsp;to&nbsp;change,&nbsp;so&nbsp;you&nbsp;might&nbsp;as&nbsp;well&nbsp;bite&nbsp;the&nbsp;bullet&nbsp;and&nbsp;design&nbsp;a&nbsp;recovery-enabled&nbsp;API&nbsp;that&nbsp;wraps&nbsp;the&nbsp;existing&nbsp;API.&lt;div&nbsp;class=&quot;im&quot;&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;<br>
One&nbsp;other&nbsp;idea&nbsp;-&nbsp;Brett&nbsp;Cameron&nbsp;suggested&nbsp;tracking&nbsp;the&nbsp;last&nbsp;delivery&nbsp;tag&lt;br&gt;<br>
for&nbsp;each&nbsp;channel&nbsp;and&nbsp;dropping&nbsp;any&nbsp;ack/nack/reject&nbsp;requests&nbsp;for&nbsp;delivery&lt;br&gt;<br>
tags&nbsp;greater&nbsp;than&nbsp;that.&nbsp;If&nbsp;a&nbsp;channel&nbsp;is&nbsp;recovered,&nbsp;the&nbsp;last&nbsp;delivery&nbsp;tag&lt;br&gt;<br>
for&nbsp;the&nbsp;new&nbsp;channel&nbsp;will&nbsp;most&nbsp;likely&nbsp;be&nbsp;less&nbsp;than&nbsp;any&nbsp;delivery&nbsp;tags&nbsp;for&lt;br&gt;<br>
messages&nbsp;consumed&nbsp;on&nbsp;the&nbsp;previously&nbsp;closed&nbsp;channel.&nbsp;This&nbsp;is&nbsp;obviously&lt;br&gt;<br>
not&nbsp;foolproof,&nbsp;but&nbsp;it&amp;#39;s&nbsp;not&nbsp;a&nbsp;bad&nbsp;start.&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;&lt;/div&gt;<br>
That&amp;#39;s&nbsp;better&nbsp;than&nbsp;the&nbsp;present&nbsp;situation,&nbsp;I&nbsp;suppose,&nbsp;but&nbsp;doesn&amp;#39;t&nbsp;catch&nbsp;the&nbsp;more&nbsp;dangerous&nbsp;of&nbsp;the&nbsp;two&nbsp;ways&nbsp;things&nbsp;can&nbsp;go&nbsp;wrong,&nbsp;i.e.&nbsp;when&nbsp;the&nbsp;old&nbsp;delivery&nbsp;tags&nbsp;*are*&nbsp;in&nbsp;range&nbsp;of&nbsp;the&nbsp;new&nbsp;ones&nbsp;then&nbsp;the&nbsp;wrong&nbsp;messages&nbsp;get&nbsp;acknowledged.&lt;/blockquote&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Another&nbsp;approach&nbsp;suggested&nbsp;by&nbsp;Brett&nbsp;-&nbsp;this&nbsp;one&nbsp;seems&nbsp;pretty&nbsp;sound.&nbsp;Start&nbsp;by&nbsp;tracking&nbsp;the&nbsp;max&nbsp;delivery&nbsp;tag&nbsp;for&nbsp;a&nbsp;channel.&nbsp;If&nbsp;a&nbsp;channel&nbsp;is&nbsp;closed&nbsp;and&nbsp;recovered,&nbsp;we&nbsp;increment&nbsp;subsequent&nbsp;delivery&nbsp;tags&nbsp;by&nbsp;the&nbsp;max&nbsp;tag&nbsp;we&nbsp;observed&nbsp;for&nbsp;the&nbsp;previous&nbsp;channel.&nbsp;When&nbsp;the&nbsp;user&nbsp;acks/nacks/rejects&nbsp;a&nbsp;delivery&nbsp;tag,&nbsp;we&nbsp;decrement&nbsp;by&nbsp;the&nbsp;max&nbsp;tag.&nbsp;If&nbsp;the&nbsp;decremented&nbsp;value&nbsp;is&nbsp;&amp;lt;=&nbsp;0,&nbsp;then&nbsp;we&nbsp;know&nbsp;the&nbsp;delivery&nbsp;tag&nbsp;is&nbsp;for&nbsp;a&nbsp;previously&nbsp;closed&nbsp;channel. &lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;From&nbsp;the&nbsp;user&amp;#39;s&nbsp;perspective&nbsp;this&nbsp;means&nbsp;delivery&nbsp;tags&nbsp;simply&nbsp;increase&nbsp;forever&nbsp;even&nbsp;as&nbsp;channels&nbsp;are&nbsp;recovered,&nbsp;but&nbsp;I&nbsp;don&amp;#39;t&nbsp;this&nbsp;is&nbsp;a&nbsp;problem&nbsp;since&nbsp;all&nbsp;usage&nbsp;of&nbsp;those&nbsp;tags&nbsp;will&nbsp;be&nbsp;through&nbsp;Lyra&amp;#39;s&nbsp;proxied&nbsp;channel&nbsp;which&nbsp;will&nbsp;re-adjust&nbsp;them&nbsp;before&nbsp;sending&nbsp;an&nbsp;ack/nack/reject. &lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;What&nbsp;do&nbsp;you&nbsp;think&nbsp;of&nbsp;this&nbsp;approach? &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Cheers,&lt;/div&gt;&lt;div&gt;Jonathan &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;<br>
&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
Matthias.&lt;br&gt;<br>
______________________________&lt;u&gt;&lt;/u&gt;_________________&lt;br&gt;<br>
rabbitmq-discuss&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:rabbitmq-discuss@lists.rabbitmq.com&quot;&nbsp;target=&quot;_blank&quot;&gt;rabbitmq-discuss@lists.&lt;u&gt;&lt;/u&gt;rabbitmq.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&quot;&nbsp;target=&quot;_blank&quot;&gt;https://lists.rabbitmq.com/&lt;u&gt;&lt;/u&gt;cgi-bin/mailman/listinfo/&lt;u&gt;&lt;/u&gt;rabbitmq-discuss&lt;/a&gt;&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
