<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Replicated message queue?  DRDB+Hearbeat?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Replicated%20message%20queue%3F%20%20DRDB%2BHearbeat%3F&In-Reply-To=10837132.5991203493224371.JavaMail.root%40ly.sdf.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000498.html">
   <LINK REL="Next"  HREF="000511.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Replicated message queue?  DRDB+Hearbeat?</H1>
    <B>Dmitriy Samovskiy</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Replicated%20message%20queue%3F%20%20DRDB%2BHearbeat%3F&In-Reply-To=10837132.5991203493224371.JavaMail.root%40ly.sdf.com"
       TITLE="[rabbitmq-discuss] Replicated message queue?  DRDB+Hearbeat?">dmitriy.samovskiy at cohesiveft.com
       </A><BR>
    <I>Wed Feb 20 14:39:21 GMT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="000498.html">[rabbitmq-discuss] Replicated message queue?  DRDB+Hearbeat?
</A></li>
        <LI>Next message: <A HREF="000511.html">[rabbitmq-discuss] Replicated message queue?  DRDB+Hearbeat?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#501">[ date ]</a>
              <a href="thread.html#501">[ thread ]</a>
              <a href="subject.html#501">[ subject ]</a>
              <a href="author.html#501">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Hi Tom,

Tom Samplonius wrote:
&gt;<i>   I see that RabbitMQ does not yet have replication for message queues.  I need a high-available message queue that never loses messages.  I'm not terribly concerned about performance, as I just need to process several thousand messages per day.  It is just hard to repair consistency if any are lost.
</I>
I am also in a very similar situation - HA is more important for my project than 
throughput. It is my understanding that if you define your queues as durable and send 
messages as persistent, your messages will be saved on disk until consumed. A bigger 
question is how long it will take between a message is sent and the message is consumed. 
Out of the box, I guess it depends on how fast you can restore the original broker (app, 
system and/or network connectivity, depending on what failed).

&gt;<i>   I thought about using DRDB to replicate RabbitMQ's on-disk Mnesia store to a standby node.  I've used DRDB successfully for MySQL, and it works well.  And then use Hearbeat to start RabbitMQ on the standby node, which would then recover the Mnesia tables, and start running.
</I>So you are planning to produce to a broker and consume from the same broker. And once that 
broker fails, you will have both producers and consumers shift to another broker, which 
you will start on DRBD-cloned disk after the first broker failed?


I am currently leaning towards a cluster of rabbitmq brokers. Producers will send messages 
to one broker, consumers will connect to *all* brokers in a cluster and will  have 
application logic to identify duplicate messages (just in case). Producers will get an 
exception if their broker failed to properly receive their message and will reconnect and 
resend (tested with QPid python, planning to switch py-amqplib shortly). Consumers might 
not get an exception about broker failure soon enough, therefore for now I will have them 
consuming from all brokers in the cluster.

I hope that latter approach will work better for me, since in my case I might have trouble 
convincing all consumers at the same time that one particular broker is not available 
(some of my consumers are over LAN, some are over WAN; if I lose WAN access, consumers on 
the WAN will think the broker is gone, while consumers on LAN will still be able to talk 
to it).


Please let us know if you get to deploy rabbitmq with DRBD-backed storage and how it works 
for you.

Thanks,
Dmitriy


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000498.html">[rabbitmq-discuss] Replicated message queue?  DRDB+Hearbeat?
</A></li>
	<LI>Next message: <A HREF="000511.html">[rabbitmq-discuss] Replicated message queue?  DRDB+Hearbeat?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#501">[ date ]</a>
              <a href="thread.html#501">[ thread ]</a>
              <a href="subject.html#501">[ subject ]</a>
              <a href="author.html#501">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
