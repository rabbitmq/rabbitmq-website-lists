<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Replicated message queue?  DRDB+Hearbeat?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Replicated%20message%20queue%3F%20%20DRDB%2BHearbeat%3F&In-Reply-To=47BC3B99.4000408%40cohesiveft.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000501.html">
   <LINK REL="Next"  HREF="000531.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Replicated message queue?  DRDB+Hearbeat?</H1>
    <B>Tom Samplonius</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Replicated%20message%20queue%3F%20%20DRDB%2BHearbeat%3F&In-Reply-To=47BC3B99.4000408%40cohesiveft.com"
       TITLE="[rabbitmq-discuss] Replicated message queue?  DRDB+Hearbeat?">tom at samplonius.org
       </A><BR>
    <I>Fri Feb 22 03:26:12 GMT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="000501.html">[rabbitmq-discuss] Replicated message queue?  DRDB+Hearbeat?
</A></li>
        <LI>Next message: <A HREF="000531.html">[rabbitmq-discuss] State and idempotency (was Re: Replicated message queue? DRDB+Hearbeat?)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#511">[ date ]</a>
              <a href="thread.html#511">[ thread ]</a>
              <a href="subject.html#511">[ subject ]</a>
              <a href="author.html#511">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>----- &quot;Dmitriy Samovskiy&quot; &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">dmitriy.samovskiy at cohesiveft.com</A>&gt; wrote:

&gt;<i> ... A bigger 
</I>&gt;<i> question is how long it will take between a message is sent and the
</I>&gt;<i> message is consumed. 
</I>&gt;<i> Out of the box, I guess it depends on how fast you can restore the
</I>&gt;<i> original broker (app, 
</I>&gt;<i> system and/or network connectivity, depending on what failed).
</I>
  Yes, only you will be able to answer that.  In my case, the time to fix a unresponsive server is about an hour.

&gt;<i> &gt;   I thought about using DRDB to replicate RabbitMQ's on-disk Mnesia
</I>&gt;<i> store to a standby node.  I've used DRDB successfully for MySQL, and
</I>&gt;<i> it works well.  And then use Hearbeat to start RabbitMQ on the standby
</I>&gt;<i> node, which would then recover the Mnesia tables, and start running.
</I>&gt;<i> So you are planning to produce to a broker and consume from the same
</I>&gt;<i> broker. And once that 
</I>&gt;<i> broker fails, you will have both producers and consumers shift to
</I>&gt;<i> another broker, which 
</I>&gt;<i> you will start on DRBD-cloned disk after the first broker failed?
</I>
  Yes.  DRDB keeps the master disk synced to the slave disk.  Hearbeat determines if the master fails, and switches the direction of the syncing, and can also move the virtual IP from the master to the slave.  Everything just connects to the virtual IP.  Obviously clients (producers and consumers) need to be robust, and have the ability to recovery from timeouts, and reconnect.


...
&gt;<i> application logic to identify duplicate messages (just in case).
</I>...

  I've never come across a good way of doing this.  I can attach a unique id to each message, but then the clients have to keep state on which ids they've processed.  And if you multiple clients, they need to talk to each other too.  I don't want consumers to have to keep state.  

  Now depending on the message, of course, processing it twice may not matter that much.  For example, if the message is &quot;Turn switch 2 On&quot;, then if you do that twice, it is harmless.  But obviously you don't want to processing every message twice just for high-availability.  

...
&gt;<i> Please let us know if you get to deploy rabbitmq with DRBD-backed
</I>&gt;<i> storage and how it works 
</I>&gt;<i> for you.
</I>
  I have to do a lot of testing of this configuration first.


&gt;<i> Thanks,
</I>&gt;<i> Dmitriy
</I>

Tom


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000501.html">[rabbitmq-discuss] Replicated message queue?  DRDB+Hearbeat?
</A></li>
	<LI>Next message: <A HREF="000531.html">[rabbitmq-discuss] State and idempotency (was Re: Replicated message queue? DRDB+Hearbeat?)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#511">[ date ]</a>
              <a href="thread.html#511">[ thread ]</a>
              <a href="subject.html#511">[ subject ]</a>
              <a href="author.html#511">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
