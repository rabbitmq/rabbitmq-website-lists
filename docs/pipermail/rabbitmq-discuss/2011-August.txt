From simon at rabbitmq.com  Mon Aug  1 10:54:16 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 01 Aug 2011 10:54:16 +0100
Subject: [rabbitmq-discuss] Message payload encoding
In-Reply-To: <BDE140BF4C952041931EF8CAAC83341D026B6B8D70@exch-mbx-111.vmware.com>
References: <BDE140BF4C952041931EF8CAAC83341D026B6B8D70@exch-mbx-111.vmware.com>
Message-ID: <4E3677C8.3070801@rabbitmq.com>

On 29/07/11 19:00, Helena Edelson wrote:
> UTF-8 or base64

I'm curious - those are the two options supported by the management 
plugin - are you sending messages through that?

If so, the idea is that UTF-8 is more convenient if your message payload 
is a string, but if your message needs to contain arbitrary binary 
content then we need to encode it somehow (as the message will end up as 
a string in a JSON document).

If you're using AMQP then this doesn't apply, the message contents can 
be any binary, and using base64 encoding would be an odd choice!

It you are sending messages via the management API, be aware that it's 
designed for testing / diagnostics / experimentation - performance is 
not great, and there's no way to get greater reliability than consuming 
with noack.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Mon Aug  1 11:01:05 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 01 Aug 2011 11:01:05 +0100
Subject: [rabbitmq-discuss] RabbitMQ + CEP
In-Reply-To: <CABzW0g5vsVTc0d3Wnj9G_UM7bLPx0ZENE+n4TqLfKcesEGoX3g@mail.gmail.com>
References: <CABzW0g5vsVTc0d3Wnj9G_UM7bLPx0ZENE+n4TqLfKcesEGoX3g@mail.gmail.com>
Message-ID: <4E367961.2000709@rabbitmq.com>

Hi Cris,

On 29/07/11 12:05, Cristoforo Seccia wrote:
> Hi All,
> is there anyone who has used or is using RabbitMQ in conjunction with a
> CEP engine, for example Esper. I know this should not be a problem but I
> can't find (at least googling does not help me) any information or
> useful tips on how to implement this kind of stuff. Thanks in advance.

There are RabbitMQ users that also make use of Esper, but unfortunately
not in open-source projects that can be shared. If you have any
questions about specific integration issues then feel free to ask.



Regards

Emile

From sameek at arosys.com  Mon Aug  1 11:17:28 2011
From: sameek at arosys.com (sam_mis)
Date: Mon, 1 Aug 2011 03:17:28 -0700 (PDT)
Subject: [rabbitmq-discuss] How to recover publish message when server is
 shutdown or crash?
Message-ID: <32168460.post@talk.nabble.com>


Hi 


I'm using Rabbitmq-server-windows-2.5.0.I have certain doubt:

1.if Rabbitmq server is shutdown or crash.How i'm able to recover my publish
message from server.
2.if number of queue are created over server it effects the performance of
server or it's logical(queue).if yes then the queue delete is necessary from
server,after using queue.

Thanks


 
-- 
View this message in context: http://old.nabble.com/How-to-recover-publish-message-when-server-is-shutdown-or-crash--tp32168460p32168460.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From ekirpichov at gmail.com  Mon Aug  1 11:20:54 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Mon, 1 Aug 2011 14:20:54 +0400
Subject: [rabbitmq-discuss] How to recover publish message when server
 is shutdown or crash?
In-Reply-To: <32168460.post@talk.nabble.com>
References: <32168460.post@talk.nabble.com>
Message-ID: <CANVKUrVjSrtQYpt+3dWoJcChXFRsAQL3eaRn7gUXrvLn02DQ7w@mail.gmail.com>

1 - you can't (except perhaps with the recent queue mirroring feature
which hasn't yet been released). However you can at least guarantee
that the message has been persisted - either by publishing it within a
transaction (once the transaction is committed, you're sure its
effects are permanent), or by using "publisher confirms"
http://www.rabbitmq.com/blog/2011/02/10/introducing-publisher-confirms/
.
2 - yes, it does effect the performance IIRC. I had a server slowed
down to a crawl and then crash when it had several thousand (mostly
unused) queues.

2011/8/1 sam_mis <sameek at arosys.com>:
>
> Hi
>
>
> I'm using Rabbitmq-server-windows-2.5.0.I have certain doubt:
>
> 1.if Rabbitmq server is shutdown or crash.How i'm able to recover my publish
> message from server.
> 2.if number of queue are created over server it effects the performance of
> server or it's logical(queue).if yes then the queue delete is necessary from
> server,after using queue.
>
> Thanks
>
>
>
> --
> View this message in context: http://old.nabble.com/How-to-recover-publish-message-when-server-is-shutdown-or-crash--tp32168460p32168460.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/

From simon at rabbitmq.com  Mon Aug  1 11:27:07 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 01 Aug 2011 11:27:07 +0100
Subject: [rabbitmq-discuss] running rabbitmqadmin CLI on windows 7
In-Reply-To: <CAGErLKX907Muig-ui5iAhyxH7PofHY+M-nChDKdHk=LqP2YbNw@mail.gmail.com>
References: <03e801cc4e28$c39bd590$4ad380b0$@vmware.com>
	<CAGErLKX907Muig-ui5iAhyxH7PofHY+M-nChDKdHk=LqP2YbNw@mail.gmail.com>
Message-ID: <4E367F7B.2080201@rabbitmq.com>

On 29/07/11 21:27, Bryan Alves wrote:
> That print statement is python 2 syntax. Get python 2 installed instead
> of python 3.

At some point I suppose I should port it to Python 3. But I'm not sure 
that this would solve more problems than it would cause, right now. But 
this should be documented...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From ekirpichov at gmail.com  Mon Aug  1 12:26:59 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Mon, 1 Aug 2011 15:26:59 +0400
Subject: [rabbitmq-discuss] Extremely uneven distribution of latencies under
	high load
Message-ID: <CANVKUrVYoPZ8qkGjv=8T19vthP4isVvY2Cs84W+Z_onpGKQX_A@mail.gmail.com>

Hi.

I've got a large cluster (several hundred machines) "load-testing" a
smaller rabbitmq cluster (4 machines - 1 on one rack, 3 on another, 8
queues) in a ~balanced and partitioned fashion (probably I don't even
need an actual rmq cluster).

I'm publishing about 6000 messages/s, each about 10kb in size, in
roundrobin to these 4 nodes.
Messages are persistent and durable; I have publisher confirms turned
on. Autoack is turned off; I have a cycle of "get, process, publish
result, ack". Each message takes ~800ms to process.

I'm experiencing things like "rabbitmq not giving a message to a
consumer for several minutes", i.e. a large portion of my cluster is
idle waiting for messages.
RabbitMQ is also rather frequently dropping connections but I'm reconnecting.

The distribution of message waiting times is like "75% < 50ms, 90% <
1s, 99% < 60s, 100% < 180s".
Some consumers are served very well (a constant stream of messages),
some wait for minutes. Some have periods of both kinds.
The ones that are served really well don't experience reconnects,
though the poor ones also have only a few reconnects per minute at
most.

I also graphed the publish confirmations from RabbitMQ (actually the
number of unack'd messages remaining) and I'm seeing that most of the
brokers keep this number under a couple of thousand for all queues,
however one other broker (the one on a solitary rack) has it grow
seemingly without bound - to ~25k and more, again on all queues.

1) Is this expected behavior?
2) How can this behavior be explained? Are there any
performance-related quirks in clustered RabbitMQ?
3) Is it likely that I'll be able to get rid of this behavior and make
it at least more predictable by e.g. reconnecting if I don't receive a
message for, say, 15s?

-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/

From ekirpichov at gmail.com  Mon Aug  1 12:27:21 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Mon, 1 Aug 2011 15:27:21 +0400
Subject: [rabbitmq-discuss] Extremely uneven distribution of latencies
	under high load
In-Reply-To: <CANVKUrVYoPZ8qkGjv=8T19vthP4isVvY2Cs84W+Z_onpGKQX_A@mail.gmail.com>
References: <CANVKUrVYoPZ8qkGjv=8T19vthP4isVvY2Cs84W+Z_onpGKQX_A@mail.gmail.com>
Message-ID: <CANVKUrUfaTDPm1VCSf0XOCYST9=UpVLnFgeEH0DvmHZqK5ejkg@mail.gmail.com>

Forgot to say, I'm on rabbitmq 2.5.1, on Windows, Erlang R14B02.

2011/8/1 Eugene Kirpichov <ekirpichov at gmail.com>:
> Hi.
>
> I've got a large cluster (several hundred machines) "load-testing" a
> smaller rabbitmq cluster (4 machines - 1 on one rack, 3 on another, 8
> queues) in a ~balanced and partitioned fashion (probably I don't even
> need an actual rmq cluster).
>
> I'm publishing about 6000 messages/s, each about 10kb in size, in
> roundrobin to these 4 nodes.
> Messages are persistent and durable; I have publisher confirms turned
> on. Autoack is turned off; I have a cycle of "get, process, publish
> result, ack". Each message takes ~800ms to process.
>
> I'm experiencing things like "rabbitmq not giving a message to a
> consumer for several minutes", i.e. a large portion of my cluster is
> idle waiting for messages.
> RabbitMQ is also rather frequently dropping connections but I'm reconnecting.
>
> The distribution of message waiting times is like "75% < 50ms, 90% <
> 1s, 99% < 60s, 100% < 180s".
> Some consumers are served very well (a constant stream of messages),
> some wait for minutes. Some have periods of both kinds.
> The ones that are served really well don't experience reconnects,
> though the poor ones also have only a few reconnects per minute at
> most.
>
> I also graphed the publish confirmations from RabbitMQ (actually the
> number of unack'd messages remaining) and I'm seeing that most of the
> brokers keep this number under a couple of thousand for all queues,
> however one other broker (the one on a solitary rack) has it grow
> seemingly without bound - to ~25k and more, again on all queues.
>
> 1) Is this expected behavior?
> 2) How can this behavior be explained? Are there any
> performance-related quirks in clustered RabbitMQ?
> 3) Is it likely that I'll be able to get rid of this behavior and make
> it at least more predictable by e.g. reconnecting if I don't receive a
> message for, say, 15s?
>
> --
> Eugene Kirpichov
> Principal Engineer, Mirantis Inc. http://www.mirantis.com/
> Editor, http://fprog.ru/
>



-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/

From sameek at arosys.com  Mon Aug  1 13:18:38 2011
From: sameek at arosys.com (sam_mis)
Date: Mon, 1 Aug 2011 05:18:38 -0700 (PDT)
Subject: [rabbitmq-discuss] How to recover publish message when server
 is shutdown or crash?
In-Reply-To: <CANVKUrVjSrtQYpt+3dWoJcChXFRsAQL3eaRn7gUXrvLn02DQ7w@mail.gmail.com>
References: <32168460.post@talk.nabble.com>
	<CANVKUrVjSrtQYpt+3dWoJcChXFRsAQL3eaRn7gUXrvLn02DQ7w@mail.gmail.com>
Message-ID: <32169144.post@talk.nabble.com>




jkff wrote:
> 
> 1 - you can't (except perhaps with the recent queue mirroring feature
> which hasn't yet been released). However you can at least guarantee
> that the message has been persisted - either by publishing it within a
> transaction (once the transaction is committed, you're sure its
> effects are permanent), or by using "publisher confirms"
> http://www.rabbitmq.com/blog/2011/02/10/introducing-publisher-confirms/
> .
> 2 - yes, it does effect the performance IIRC. I had a server slowed
> down to a crawl and then crash when it had several thousand (mostly
> unused) queues.
> 
> Thank for reply.which java API will help me to delete the queue and when
> queue is deleted after sending ack or before?
> 
> 2011/8/1 sam_mis <sameek at arosys.com>:
>>
>> Hi
>>
>>
>> I'm using Rabbitmq-server-windows-2.5.0.I have certain doubt:
>>
>> 1.if Rabbitmq server is shutdown or crash.How i'm able to recover my
>> publish
>> message from server.
>> 2.if number of queue are created over server it effects the performance
>> of
>> server or it's logical(queue).if yes then the queue delete is necessary
>> from
>> server,after using queue.
>>
>> Thanks
>>
>>
>>
>> --
>> View this message in context:
>> http://old.nabble.com/How-to-recover-publish-message-when-server-is-shutdown-or-crash--tp32168460p32168460.html
>> Sent from the RabbitMQ mailing list archive at Nabble.com.
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
> 
> 
> 
> -- 
> Eugene Kirpichov
> Principal Engineer, Mirantis Inc. http://www.mirantis.com/
> Editor, http://fprog.ru/
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://old.nabble.com/How-to-recover-publish-message-when-server-is-shutdown-or-crash--tp32168460p32169144.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From michael.s.klishin at gmail.com  Mon Aug  1 13:19:07 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 1 Aug 2011 16:19:07 +0400
Subject: [rabbitmq-discuss] Recommended ways of basic queue introspection
Message-ID: <CAE3HoVTezeLLWnEkF=kFGsDgJ8HAbywGup_CR-W97k+4FS-1jw@mail.gmail.com>

Hi,

I have a need of introspecting some queues (very basic form of querying:
list all messages in the queue) and draining with basic.get + requeuing is
not an option
for various reasons. Number of messages at any given time will always be low
(< 100).

Does RabbitMQ HTTP management API offer anything like this? If I am willing
to put together a small extension that will query Mnesia, are there any
caveats
or extension points or something I should be aware of? Finally, would it
make sense to try to extend HTTP API of the management plugin and contribute
back to it?

Thanks,
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110801/c1955a19/attachment.htm>

From ekirpichov at gmail.com  Mon Aug  1 13:20:38 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Mon, 1 Aug 2011 16:20:38 +0400
Subject: [rabbitmq-discuss] How to recover publish message when server
 is shutdown or crash?
In-Reply-To: <32169144.post@talk.nabble.com>
References: <32168460.post@talk.nabble.com>
	<CANVKUrVjSrtQYpt+3dWoJcChXFRsAQL3eaRn7gUXrvLn02DQ7w@mail.gmail.com>
	<32169144.post@talk.nabble.com>
Message-ID: <CANVKUrVvjpzgnGvmWWypF+8x_JrX=ZpQpabodG-4vLS_teUJ+Q@mail.gmail.com>

2011/8/1 sam_mis <sameek at arosys.com>:
>
>
>
> jkff wrote:
>>
>> 1 - you can't (except perhaps with the recent queue mirroring feature
>> which hasn't yet been released). However you can at least guarantee
>> that the message has been persisted - either by publishing it within a
>> transaction (once the transaction is committed, you're sure its
>> effects are permanent), or by using "publisher confirms"
>> http://www.rabbitmq.com/blog/2011/02/10/introducing-publisher-confirms/
>> .
>> 2 - yes, it does effect the performance IIRC. I had a server slowed
>> down to a crawl and then crash when it had several thousand (mostly
>> unused) queues.
>>
>> Thank for reply.which java API will help me to delete the queue and when
>> queue is deleted after sending ack or before?
Well, there's an API named queueDelete somewhere, I suppose. Search
through the docs, it's probably not hidden too far...

Can you please rephrase your second question?

>>
>> 2011/8/1 sam_mis <sameek at arosys.com>:
>>>
>>> Hi
>>>
>>>
>>> I'm using Rabbitmq-server-windows-2.5.0.I have certain doubt:
>>>
>>> 1.if Rabbitmq server is shutdown or crash.How i'm able to recover my
>>> publish
>>> message from server.
>>> 2.if number of queue are created over server it effects the performance
>>> of
>>> server or it's logical(queue).if yes then the queue delete is necessary
>>> from
>>> server,after using queue.
>>>
>>> Thanks
>>>
>>>
>>>
>>> --
>>> View this message in context:
>>> http://old.nabble.com/How-to-recover-publish-message-when-server-is-shutdown-or-crash--tp32168460p32168460.html
>>> Sent from the RabbitMQ mailing list archive at Nabble.com.
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>
>>
>>
>> --
>> Eugene Kirpichov
>> Principal Engineer, Mirantis Inc. http://www.mirantis.com/
>> Editor, http://fprog.ru/
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> --
> View this message in context: http://old.nabble.com/How-to-recover-publish-message-when-server-is-shutdown-or-crash--tp32168460p32169144.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/

From emile at rabbitmq.com  Mon Aug  1 14:03:56 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 01 Aug 2011 14:03:56 +0100
Subject: [rabbitmq-discuss] Recommended ways of basic queue introspection
In-Reply-To: <CAE3HoVTezeLLWnEkF=kFGsDgJ8HAbywGup_CR-W97k+4FS-1jw@mail.gmail.com>
References: <CAE3HoVTezeLLWnEkF=kFGsDgJ8HAbywGup_CR-W97k+4FS-1jw@mail.gmail.com>
Message-ID: <4E36A43C.3070901@rabbitmq.com>

Hi Michael,

On 01/08/11 13:19, Michael Klishin wrote:
> I have a need of introspecting some queues (very basic form of querying:
> list all messages in the queue) and draining with basic.get + requeuing
> is not an option
> for various reasons. Number of messages at any given time will always be
> low (< 100).
> 
> Does RabbitMQ HTTP management API offer anything like this? If I am
> willing to put together a small extension that will query Mnesia, are
> there any caveats
> or extension points or something I should be aware of? Finally, would it
> make sense to try to extend HTTP API of the management plugin and
> contribute back to it?

The feature you are asking for is "queue browsing". RabbitMQ queues are
strictly FIFO, precluding queue browsing. If you don't care about
message order then you could attempt to emulate browsing by fetching and
requeueing messages, but you say that is not possible in your case.

The other possibility is to provide your own browsable queue
implementation. This is not a trivial undertaking, but it is possible to
slot in your own implementation and make it free from FIFO restrictions.

The HTTP management API does not have privileged access to queue
contents. You can fetch and requeue messages, but not in a way that
ignores the FIFO property of queues.

Queue contents are not stored in Mnesia, but in an optimised persistent
format. But knowing that is not much help because transient messages are
not guaranteed to be on disk. If you are only interested in browsing
persistent messages then you could use a database message store and
browse that. See http://hg.rabbitmq.com/rabbitmq-toke for a possible
starting point.


-Emile

From mikeb at rabbitmq.com  Mon Aug  1 14:23:28 2011
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Mon, 01 Aug 2011 14:23:28 +0100
Subject: [rabbitmq-discuss] Recommended ways of basic queue introspection
In-Reply-To: <4E36A43C.3070901@rabbitmq.com>
References: <CAE3HoVTezeLLWnEkF=kFGsDgJ8HAbywGup_CR-W97k+4FS-1jw@mail.gmail.com>
	<4E36A43C.3070901@rabbitmq.com>
Message-ID: <4E36A8D0.4010901@rabbitmq.com>

>> Does RabbitMQ HTTP management API offer anything like this? If I am
>> willing to put together a small extension that will query Mnesia, are
>> there any caveats
>> or extension points or something I should be aware of? Finally, would it
>> make sense to try to extend HTTP API of the management plugin and
>> contribute back to it?
>
> The feature you are asking for is "queue browsing". RabbitMQ queues are
> strictly FIFO, precluding queue browsing. If you don't care about
> message order then you could attempt to emulate browsing by fetching and
> requeueing messages, but you say that is not possible in your case.

It's not queues being FIFO that is constraining, but the fact that reads 
are destructive.  For example, one can't peek at the first message in 
the queue, either -- which would be FIFO, but not destructive.

mkb

From michael.s.klishin at gmail.com  Mon Aug  1 15:11:59 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 1 Aug 2011 18:11:59 +0400
Subject: [rabbitmq-discuss] Recommended ways of basic queue introspection
In-Reply-To: <4E36A8D0.4010901@rabbitmq.com>
References: <CAE3HoVTezeLLWnEkF=kFGsDgJ8HAbywGup_CR-W97k+4FS-1jw@mail.gmail.com>
	<4E36A43C.3070901@rabbitmq.com> <4E36A8D0.4010901@rabbitmq.com>
Message-ID: <CAE3HoVQ+y7iFDr6aOabsBcORdQr=JmJzarRRgNtcWL+aHRsbDg@mail.gmail.com>

2011/8/1 Michael Bridgen <mikeb at rabbitmq.com>

> It's not queues being FIFO that is constraining, but the fact that reads
> are destructive.  For example, one can't peek at the first message in the
> queue, either -- which would be FIFO, but not destructive.


That's my main concern. I am totally fine with FIFO ordering, I just need a
way to have a way to read messages (both persistent and transient), for
example, via HTTP API.
Consistency requirements are also nothing special: if my solution will get a
slightly inconsistent snapshot once in a while, that's OK.

If messages are not stored in Mnesia, is there a way to query them in the
rabbitmq internal API? does Rabbit itself or one of existing plugins do
something like this?

-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110801/830e75c6/attachment.htm>

From aph at repido.co.uk  Mon Aug  1 17:37:57 2011
From: aph at repido.co.uk (Andrew)
Date: Mon, 1 Aug 2011 09:37:57 -0700 (PDT)
Subject: [rabbitmq-discuss] Queuing fundamentals.
Message-ID: <ef8e1fbb-d982-4087-8ea1-a4a9152fe92a@bl1g2000vbb.googlegroups.com>

Hi everybody,

I wondered if somebody might be able to clarify some behaviour for me
as I am getting confused about whether the scenario I am experiencing
is due to a lack of understanding of how RabbitMQ works or something
else.

I have one reader process which may die due to system failure and at
restart I'd like the same single consumer process to start up again
and pick up where it left off. So a summary of what I'd like to happen
is:

(1) My transmitter process sends and queues up messages 1, 2, 3, 4, 5
& 6.
(2) My single consumer process reads and acknowledges messages 1 and 2
in sequence.
(3) My consumer process reads message 3 and then dies without
acknowledging.
(4) I restart my consumer process which will request the next message,
which should be the unacknowledged message (3).
(5) My consumer process would then continue reading messages from the
queue (4, 5, & 6) in sequence.

What I am experiencing is that when my consumer process is restarted
messages 3, 4, 5 & 6 are delivered out of sequence and all with a
redelivery count of 1. I understand that message 3 might be out of
sequence because it was unacknowledged and from what I have read, when
a message is redelivered then it's sequence is no longer guaranteed.
However I'm not clear as to why the remaining queued messages are out
of sequence too.

More importantly is what I am trying to do is something that is
contrary to how RabbitMQ works, or am I just going about it the wrong
way?

Many thanks for your help,
Andrew


From ekirpichov at gmail.com  Mon Aug  1 17:41:09 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Mon, 1 Aug 2011 20:41:09 +0400
Subject: [rabbitmq-discuss] Queuing fundamentals.
In-Reply-To: <ef8e1fbb-d982-4087-8ea1-a4a9152fe92a@bl1g2000vbb.googlegroups.com>
References: <ef8e1fbb-d982-4087-8ea1-a4a9152fe92a@bl1g2000vbb.googlegroups.com>
Message-ID: <CANVKUrUUzdabtSg4c5CS3N3MYLyKSQ6QR-ikq5bySkSWSf7GNA@mail.gmail.com>

I suppose that you haven't set the prefetch count to 1.

So in fact you had messages 3,4,5,6 all delivered to you (so thought
the broker) and when the consumer died, the broker requeued all of
them in no particular sequence.

2011/8/1 Andrew <aph at repido.co.uk>:
> Hi everybody,
>
> I wondered if somebody might be able to clarify some behaviour for me
> as I am getting confused about whether the scenario I am experiencing
> is due to a lack of understanding of how RabbitMQ works or something
> else.
>
> I have one reader process which may die due to system failure and at
> restart I'd like the same single consumer process to start up again
> and pick up where it left off. So a summary of what I'd like to happen
> is:
>
> (1) My transmitter process sends and queues up messages 1, 2, 3, 4, 5
> & 6.
> (2) My single consumer process reads and acknowledges messages 1 and 2
> in sequence.
> (3) My consumer process reads message 3 and then dies without
> acknowledging.
> (4) I restart my consumer process which will request the next message,
> which should be the unacknowledged message (3).
> (5) My consumer process would then continue reading messages from the
> queue (4, 5, & 6) in sequence.
>
> What I am experiencing is that when my consumer process is restarted
> messages 3, 4, 5 & 6 are delivered out of sequence and all with a
> redelivery count of 1. I understand that message 3 might be out of
> sequence because it was unacknowledged and from what I have read, when
> a message is redelivered then it's sequence is no longer guaranteed.
> However I'm not clear as to why the remaining queued messages are out
> of sequence too.
>
> More importantly is what I am trying to do is something that is
> contrary to how RabbitMQ works, or am I just going about it the wrong
> way?
>
> Many thanks for your help,
> Andrew
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/

From aph at repido.co.uk  Mon Aug  1 18:49:01 2011
From: aph at repido.co.uk (Andrew)
Date: Mon, 1 Aug 2011 10:49:01 -0700 (PDT)
Subject: [rabbitmq-discuss] Queuing fundamentals.
In-Reply-To: <CANVKUrUUzdabtSg4c5CS3N3MYLyKSQ6QR-ikq5bySkSWSf7GNA@mail.gmail.com>
References: <ef8e1fbb-d982-4087-8ea1-a4a9152fe92a@bl1g2000vbb.googlegroups.com>
	<CANVKUrUUzdabtSg4c5CS3N3MYLyKSQ6QR-ikq5bySkSWSf7GNA@mail.gmail.com>
Message-ID: <dd527a80-418f-415b-bd0b-4d5ae24354f1@g2g2000vbl.googlegroups.com>

Hi Eugene ,

My code is written in PHP and is using the PHP AMQP library (http://
www.php.net/manual/en/book.amqp.php) and in my calls to the consume()
method I am setting parameters that specify a minimum delivery of zero
messages and a maximum of one. This I had hoped would just get one
message from the queue at a time for me to process.

Certainly what you suggest would explain the behaviour so perhaps my
understanding of the parameters to the consume() method is wrong.

Do you think that what I am trying to achieve should in theory work?
If so, what should happen to message 3 after it's failed ACK? i.e.
should my next request to the queue retrieve it, or will it always be
delivered out of sequence after a failed ACK? If the latter is the
case, how do I achieve ordered delivery of my messages even when my
consume process dies and restarts?

Thanks,
Andrew

On Aug 1, 5:41?pm, Eugene Kirpichov <ekirpic... at gmail.com> wrote:
> I suppose that you haven't set the prefetch count to 1.
>
> So in fact you had messages 3,4,5,6 all delivered to you (so thought
> the broker) and when the consumer died, the broker requeued all of
> them in no particular sequence.
>
> 2011/8/1 Andrew <a... at repido.co.uk>:
>
>
>
>
>
>
>
>
>
> > Hi everybody,
>
> > I wondered if somebody might be able to clarify some behaviour for me
> > as I am getting confused about whether the scenario I am experiencing
> > is due to a lack of understanding of how RabbitMQ works or something
> > else.
>
> > I have one reader process which may die due to system failure and at
> > restart I'd like the same single consumer process to start up again
> > and pick up where it left off. So a summary of what I'd like to happen
> > is:
>
> > (1) My transmitter process sends and queues up messages 1, 2, 3, 4, 5
> > & 6.
> > (2) My single consumer process reads and acknowledges messages 1 and 2
> > in sequence.
> > (3) My consumer process reads message 3 and then dies without
> > acknowledging.
> > (4) I restart my consumer process which will request the next message,
> > which should be the unacknowledged message (3).
> > (5) My consumer process would then continue reading messages from the
> > queue (4, 5, & 6) in sequence.
>
> > What I am experiencing is that when my consumer process is restarted
> > messages 3, 4, 5 & 6 are delivered out of sequence and all with a
> > redelivery count of 1. I understand that message 3 might be out of
> > sequence because it was unacknowledged and from what I have read, when
> > a message is redelivered then it's sequence is no longer guaranteed.
> > However I'm not clear as to why the remaining queued messages are out
> > of sequence too.
>
> > More importantly is what I am trying to do is something that is
> > contrary to how RabbitMQ works, or am I just going about it the wrong
> > way?
>
> > Many thanks for your help,
> > Andrew
>
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> --
> Eugene Kirpichov
> Principal Engineer, Mirantis Inc.http://www.mirantis.com/
> Editor,http://fprog.ru/
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From emile at rabbitmq.com  Mon Aug  1 19:28:24 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 01 Aug 2011 19:28:24 +0100
Subject: [rabbitmq-discuss] Queuing fundamentals.
In-Reply-To: <dd527a80-418f-415b-bd0b-4d5ae24354f1@g2g2000vbl.googlegroups.com>
References: <ef8e1fbb-d982-4087-8ea1-a4a9152fe92a@bl1g2000vbb.googlegroups.com>	<CANVKUrUUzdabtSg4c5CS3N3MYLyKSQ6QR-ikq5bySkSWSf7GNA@mail.gmail.com>
	<dd527a80-418f-415b-bd0b-4d5ae24354f1@g2g2000vbl.googlegroups.com>
Message-ID: <4E36F048.2020305@rabbitmq.com>

Hi Andrew,

Op 01/08/11 18:49, het Andrew geskryf:

> Do you think that what I am trying to achieve should in theory work?
> If so, what should happen to message 3 after it's failed ACK? i.e.
> should my next request to the queue retrieve it, or will it always be
> delivered out of sequence after a failed ACK? If the latter is the
> case, how do I achieve ordered delivery of my messages even when my
> consume process dies and restarts?

Current versions of RabbitMQ requeue messages at the tail of the queue.
You can imagine requeue as a combination of acknowledgement and
publishing a fresh copy of the message.

In your example message 3 will go back to the tail of the queue and
subsequent messages (4 - 6) will be at the front of the queue and
maintain their relative order.

We are working on a feature that will allow the order of messages to be
preserved when messages are requeued to queues that have a single
consumer, so this may become available at a future date.


-Emile

From emile at rabbitmq.com  Tue Aug  2 09:43:17 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 02 Aug 2011 09:43:17 +0100
Subject: [rabbitmq-discuss] Recommended ways of basic queue introspection
In-Reply-To: <CAE3HoVTezeLLWnEkF=kFGsDgJ8HAbywGup_CR-W97k+4FS-1jw@mail.gmail.com>
References: <CAE3HoVTezeLLWnEkF=kFGsDgJ8HAbywGup_CR-W97k+4FS-1jw@mail.gmail.com>
Message-ID: <4E37B8A5.1020802@rabbitmq.com>

Hi Michael,

On 01/08/11 13:19, Michael Klishin wrote:
> Hi,
> 
> I have a need of introspecting some queues (very basic form of querying:
> list all messages in the queue) and draining with basic.get + requeuing
> is not an option
> for various reasons. Number of messages at any given time will always be
> low (< 100).

Can you provide some details about your use-case explaining why you need
queue browsing? Perhaps there are other ways of achieving the same aim.


-Emile

From ekirpichov at gmail.com  Tue Aug  2 10:04:56 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Tue, 2 Aug 2011 13:04:56 +0400
Subject: [rabbitmq-discuss] Queuing fundamentals.
In-Reply-To: <dd527a80-418f-415b-bd0b-4d5ae24354f1@g2g2000vbl.googlegroups.com>
References: <ef8e1fbb-d982-4087-8ea1-a4a9152fe92a@bl1g2000vbb.googlegroups.com>
	<CANVKUrUUzdabtSg4c5CS3N3MYLyKSQ6QR-ikq5bySkSWSf7GNA@mail.gmail.com>
	<dd527a80-418f-415b-bd0b-4d5ae24354f1@g2g2000vbl.googlegroups.com>
Message-ID: <CANVKUrVUyXvSHxQe+ZPj5B4r4=aMHFrP2NGnvdMug=bMb-PvcQ@mail.gmail.com>

Hi,

I'm not sure how to set the prefetch size with the PHP library, and I
don't know whether the 'min' and 'max' parameters are related to it.
I believe that in theory, your scenario should work as you wished, if
you set prefetch to 1. It did for me at least, with the .NET client.

2011/8/1 Andrew <aph at repido.co.uk>:
> Hi Eugene ,
>
> My code is written in PHP and is using the PHP AMQP library (http://
> www.php.net/manual/en/book.amqp.php) and in my calls to the consume()
> method I am setting parameters that specify a minimum delivery of zero
> messages and a maximum of one. This I had hoped would just get one
> message from the queue at a time for me to process.
>
> Certainly what you suggest would explain the behaviour so perhaps my
> understanding of the parameters to the consume() method is wrong.
>
> Do you think that what I am trying to achieve should in theory work?
> If so, what should happen to message 3 after it's failed ACK? i.e.
> should my next request to the queue retrieve it, or will it always be
> delivered out of sequence after a failed ACK? If the latter is the
> case, how do I achieve ordered delivery of my messages even when my
> consume process dies and restarts?
>
> Thanks,
> Andrew
>
> On Aug 1, 5:41?pm, Eugene Kirpichov <ekirpic... at gmail.com> wrote:
>> I suppose that you haven't set the prefetch count to 1.
>>
>> So in fact you had messages 3,4,5,6 all delivered to you (so thought
>> the broker) and when the consumer died, the broker requeued all of
>> them in no particular sequence.
>>
>> 2011/8/1 Andrew <a... at repido.co.uk>:
>>
>>
>>
>>
>>
>>
>>
>>
>>
>> > Hi everybody,
>>
>> > I wondered if somebody might be able to clarify some behaviour for me
>> > as I am getting confused about whether the scenario I am experiencing
>> > is due to a lack of understanding of how RabbitMQ works or something
>> > else.
>>
>> > I have one reader process which may die due to system failure and at
>> > restart I'd like the same single consumer process to start up again
>> > and pick up where it left off. So a summary of what I'd like to happen
>> > is:
>>
>> > (1) My transmitter process sends and queues up messages 1, 2, 3, 4, 5
>> > & 6.
>> > (2) My single consumer process reads and acknowledges messages 1 and 2
>> > in sequence.
>> > (3) My consumer process reads message 3 and then dies without
>> > acknowledging.
>> > (4) I restart my consumer process which will request the next message,
>> > which should be the unacknowledged message (3).
>> > (5) My consumer process would then continue reading messages from the
>> > queue (4, 5, & 6) in sequence.
>>
>> > What I am experiencing is that when my consumer process is restarted
>> > messages 3, 4, 5 & 6 are delivered out of sequence and all with a
>> > redelivery count of 1. I understand that message 3 might be out of
>> > sequence because it was unacknowledged and from what I have read, when
>> > a message is redelivered then it's sequence is no longer guaranteed.
>> > However I'm not clear as to why the remaining queued messages are out
>> > of sequence too.
>>
>> > More importantly is what I am trying to do is something that is
>> > contrary to how RabbitMQ works, or am I just going about it the wrong
>> > way?
>>
>> > Many thanks for your help,
>> > Andrew
>>
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-disc... at lists.rabbitmq.com
>> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>> --
>> Eugene Kirpichov
>> Principal Engineer, Mirantis Inc.http://www.mirantis.com/
>> Editor,http://fprog.ru/
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/

From alfonso.pantoja at gmail.com  Tue Aug  2 10:06:23 2011
From: alfonso.pantoja at gmail.com (Alfonso Pantoja)
Date: Tue, 2 Aug 2011 02:06:23 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ actively refuses connections after
	connectity issues
Message-ID: <968a1a05-b848-4794-b8ad-9a865489ce51@p20g2000yqp.googlegroups.com>

Hi,

we are running RabbitMQ v. 2.2.0 on Ubuntu and yesterday we
experienced a problem in our production server after a connectivity
issue that caused the consumers couldn't access to Rabbit.
After the connectivity issue was solved the consumers couldn't connect
to Rabbit anymore (they are windows services).
Our RabbitMQ works with Ejabberd using a custom mod_rabbitmq.

In some consumers we saw the error
System.Net.Sockets.SocketException: An operation on a socket could not
be performed because the system lacked sufficient buffer space or
because a queue was full"
And after some time this error turned into

System.Net.Sockets.TcpClient.Connect(String hostname, Int32 port)
  at RabbitMQ.Client.Impl.SocketFrameHandler_0_9..ctor(AmqpTcpEndpoint
endpoint)
  at
RabbitMQ.Client.Framing.Impl.v0_9.ProtocolBase.CreateFrameHandler(AmqpTcpEndpoint
endpoint)
  at RabbitMQ.Client.ConnectionFactory.FollowRedirectChain(Int32
maxRedirects, IDictionary connectionAttempts, IDictionary
connectionErrors, AmqpTcpEndpoint[]& mostRecentKnownHosts,
AmqpTcpEndpoint endpoint)amqp-0-9://xx.xx.xxx.xxx:5672 -
System.Net.Sockets.SocketException: No connection could be made
because the target machine actively refused it

I've been doing a research about this problem and found that some
services are using BasicGet for getting the messages continously. In
this group I've found a reference to a issue with BasicGet which
caused the consumer to hang after a certain number of messages.
Maybe BasicGet is using too connections (and also those services are
using Qos=1) but the most strange thing is the error where Rabbit
refuses the connections.
Is there any limitation on RabbitMQ or a security system for avoiding
continous short living connections (as far as

I know BasicGet opens and closes channel connections)?
By the way the rabbit connections is constructed with a heartbeat=3.

Moreover when the problem arised we tried to connect other consumers
using another Windows machine and Rabbit still refused the
connections. The problem couldn't be solved immediatly
and a couple of Rabbit restarts were needed. They also tried to
replace the rabbit with another rabbit server (they use pacemaker).

Finally the problem gone (magically?) and the consumers worked again.

Any ideas?






From michael.s.klishin at gmail.com  Tue Aug  2 10:09:15 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 2 Aug 2011 13:09:15 +0400
Subject: [rabbitmq-discuss] Recommended ways of basic queue introspection
In-Reply-To: <4E37B8A5.1020802@rabbitmq.com>
References: <CAE3HoVTezeLLWnEkF=kFGsDgJ8HAbywGup_CR-W97k+4FS-1jw@mail.gmail.com>
	<4E37B8A5.1020802@rabbitmq.com>
Message-ID: <CAE3HoVSzP4FozQ3ejtgKC26-ZXF9dQujxe7WP5PqH5V3UxmsTg@mail.gmail.com>

2011/8/2 Emile Joubert <emile at rabbitmq.com>

> Can you provide some details about your use-case explaining why you need
> queue browsing? Perhaps there are other ways of achieving the same aim.
>

We outgrew our existing Redis-based solution we use for
http://travis-ci.orgso I am migrating build distribution over to AMQP.
On the right hand side in
the UI there is the queued builds list.

There are 2 steps invovled:

* GitHub POSTs us a Web hook
* We fetch a YAML file with information about how to run the build and
popular the same queue with different kind of messages

While we can keep a copy of the queue around in something like Redis, we
would rather not add more steps to this process so I am looking into adding
a way to do very basic queue instrospection over HTTP.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110802/93ca4d87/attachment.htm>

From michael.s.klishin at gmail.com  Tue Aug  2 10:26:10 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 2 Aug 2011 13:26:10 +0400
Subject: [rabbitmq-discuss] Introducing "AMQP 0.9.1 Model Explained"
Message-ID: <CAE3HoVT4r7aXw9aYd0KY5mDE9EKd9Lcm+RBxM0hYGkpBPDKv3Q@mail.gmail.com>

I have a little announcement to make.

As I have been using RabbitMQ for over 2 years now, I kept explaining AMQP
Model concepts, featurse & why they exist to numerous people. After a while
it became clear that there is simply
no decent introduction to the protocol. There are

* Shallow blog posts
* http://www.rabbitmq.com/faq.html#what-is-amqp which does not really focus
on explaining what AMQP has to offer (and, lets be honest, is written for
CIOs/CTOs and not developers).
* Full specification document

None of these options is really good in my opinion. The spec is pretty good
at explaining what features AMQP has and why it has them but reading 40 page
long specifications is not what most people want to do
to learn the fundamentals. I also have no way to edit rabbitmq.com content.

So I decided to go ahead and write a 2 page long introduction that focumes
on

* Concepts
* Features
* Why those features exist (what problems do they solve)
* Explaining what all those basic.get and queue.declare-ok really mean.

As a result we now have a new "AMQP 0.9.1 Model Explained" in the amqp gem
documentation guides:

http://bit.ly/amqp-model-explained

I ran it by a few dozens of people with AMQP knowledge ranging from 0 (some
of them are not really software engineers) to one of the RabbitMQ team
members (Emile Joubert) and the feed back so far is
"this is so much better than shallow blog posts, FAQs and 40 page long
specifications". I intentionally left out some details that are irrelevant
for understanding high-level protocol concepts.

This work is licensed it under the Creative Commons Attribution 3.0 Unported
License <http://creativecommons.org/licenses/by/3.0/> that lets RabbitMQ
team take any parts of this guide, edit it and put it to
rabbitmq.com(please concult with VMware legal department first but
this is what Creative
Commons site's "Choose a license" feature suggested me). The source is in
Textile and up on github:

https://github.com/ruby-amqp/amqp/blob/master/docs/AMQP091ModelExplained.textile

I hope this helps with lowering the learning curve. I will keep refining
that document and adding more diagrams when I have some more time.

Have a good day.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110802/05bb9515/attachment.htm>

From majek04 at gmail.com  Tue Aug  2 10:30:22 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Tue, 2 Aug 2011 10:30:22 +0100
Subject: [rabbitmq-discuss]
	=?utf-8?b?fFNwYW18IOi9rOWPke+8mlJlOiByYWJiaXRt?=
	=?utf-8?q?q_overwriting_messages?=
In-Reply-To: <tencent_4B042BFC58871FCF4999A79F@qq.com>
References: <tencent_4B042BFC58871FCF4999A79F@qq.com>
Message-ID: <CABzX+qwxuTvTq6F_+-0V01e_exTqH5Sj-=-o1imfBLuqbsoE0Q@mail.gmail.com>

2011/7/24 ???? <214575002 at qq.com>:
>> sorry to bother you all because the bug i report is not the bug of
>> rabbitmq.? i use tcpdump to find out that the data transfered from
>> both direction(send and recv) is right, but when i use the php pecl
>> client function consume() to get the message, it is wrong!
>>
>>
>> when i use the php pecl client function get(), it is ok!!!

Well, in the meantime you can use the code from our tutorials:
  https://github.com/rabbitmq/rabbitmq-tutorials/tree/master/php

which does use basic.consume and is proved to work.

Cheers,
   Marek

From alexis at rabbitmq.com  Tue Aug  2 10:31:22 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Tue, 2 Aug 2011 10:31:22 +0100
Subject: [rabbitmq-discuss] Introducing "AMQP 0.9.1 Model Explained"
In-Reply-To: <CAE3HoVT4r7aXw9aYd0KY5mDE9EKd9Lcm+RBxM0hYGkpBPDKv3Q@mail.gmail.com>
References: <CAE3HoVT4r7aXw9aYd0KY5mDE9EKd9Lcm+RBxM0hYGkpBPDKv3Q@mail.gmail.com>
Message-ID: <CACOPnvcVMRFUVP3sJ3npwQuxWZ1G74SsyRw7LO6O8KmAigJVDg@mail.gmail.com>

Michael

Thanks very very much for posting this!

alexis


On Tue, Aug 2, 2011 at 10:26 AM, Michael Klishin
<michael.s.klishin at gmail.com> wrote:
> I have a little announcement to make.
>
> As I have been using RabbitMQ for over 2 years now, I kept explaining AMQP
> Model concepts, featurse & why they exist to numerous people. After a while
> it became clear that there is simply
> no decent introduction to the protocol. There are
>
> * Shallow blog posts
> * http://www.rabbitmq.com/faq.html#what-is-amqp which does not really focus
> on explaining what AMQP has to offer (and, lets be honest, is written for
> CIOs/CTOs and not developers).
> * Full specification document
>
> None of these options is really good in my opinion. The spec is pretty good
> at explaining what features AMQP has and why it has them but reading 40 page
> long specifications is not what most people want to do
> to learn the fundamentals. I also have no way to edit rabbitmq.com content.
>
> So I decided to go ahead and write a 2 page long introduction that focumes
> on
>
> * Concepts
> * Features
> * Why those features exist (what problems do they solve)
> * Explaining what all those basic.get and queue.declare-ok really mean.
>
> As a result we now have a new "AMQP 0.9.1 Model Explained" in the amqp gem
> documentation guides:
>
> http://bit.ly/amqp-model-explained
>
> I ran it by a few dozens of people with AMQP knowledge ranging from 0 (some
> of them are not really software engineers) to one of the RabbitMQ team
> members (Emile Joubert) and the feed back so far is
> "this is so much better than shallow blog posts, FAQs and 40 page long
> specifications". I intentionally left out some details that are irrelevant
> for understanding high-level protocol concepts.
>
> This work is licensed it under the Creative Commons Attribution 3.0 Unported
> License that lets RabbitMQ team take any parts of this guide, edit it and
> put it to rabbitmq.com (please concult with VMware legal department first
> but this is what Creative Commons site's "Choose a license" feature
> suggested me). The source is in Textile and up on github:
>
> https://github.com/ruby-amqp/amqp/blob/master/docs/AMQP091ModelExplained.textile
>
> I hope this helps with lowering the learning curve. I will keep refining
> that document and adding more diagrams when I have some more time.
>
> Have a good day.
> --
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From majek04 at gmail.com  Tue Aug  2 10:34:29 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Tue, 2 Aug 2011 10:34:29 +0100
Subject: [rabbitmq-discuss] Introducing "AMQP 0.9.1 Model Explained"
In-Reply-To: <CAE3HoVT4r7aXw9aYd0KY5mDE9EKd9Lcm+RBxM0hYGkpBPDKv3Q@mail.gmail.com>
References: <CAE3HoVT4r7aXw9aYd0KY5mDE9EKd9Lcm+RBxM0hYGkpBPDKv3Q@mail.gmail.com>
Message-ID: <CABzX+qzQctVGti=3rPu-iEB03Jf0XoQU7tWX_fNhm-4gC316Pw@mail.gmail.com>

Looks great, good job!

Marek

On Tue, Aug 2, 2011 at 10:26, Michael Klishin
<michael.s.klishin at gmail.com> wrote:
> I have a little announcement to make.
>
> As I have been using RabbitMQ for over 2 years now, I kept explaining AMQP
> Model concepts, featurse & why they exist to numerous people. After a while
> it became clear that there is simply
> no decent introduction to the protocol. There are
>
> * Shallow blog posts
> * http://www.rabbitmq.com/faq.html#what-is-amqp which does not really focus
> on explaining what AMQP has to offer (and, lets be honest, is written for
> CIOs/CTOs and not developers).
> * Full specification document
>
> None of these options is really good in my opinion. The spec is pretty good
> at explaining what features AMQP has and why it has them but reading 40 page
> long specifications is not what most people want to do
> to learn the fundamentals. I also have no way to edit rabbitmq.com content.
>
> So I decided to go ahead and write a 2 page long introduction that focumes
> on
>
> * Concepts
> * Features
> * Why those features exist (what problems do they solve)
> * Explaining what all those basic.get and queue.declare-ok really mean.
>
> As a result we now have a new "AMQP 0.9.1 Model Explained" in the amqp gem
> documentation guides:
>
> http://bit.ly/amqp-model-explained
>
> I ran it by a few dozens of people with AMQP knowledge ranging from 0 (some
> of them are not really software engineers) to one of the RabbitMQ team
> members (Emile Joubert) and the feed back so far is
> "this is so much better than shallow blog posts, FAQs and 40 page long
> specifications". I intentionally left out some details that are irrelevant
> for understanding high-level protocol concepts.
>
> This work is licensed it under the Creative Commons Attribution 3.0 Unported
> License that lets RabbitMQ team take any parts of this guide, edit it and
> put it to rabbitmq.com (please concult with VMware legal department first
> but this is what Creative Commons site's "Choose a license" feature
> suggested me). The source is in Textile and up on github:
>
> https://github.com/ruby-amqp/amqp/blob/master/docs/AMQP091ModelExplained.textile
>
> I hope this helps with lowering the learning curve. I will keep refining
> that document and adding more diagrams when I have some more time.
>
> Have a good day.
> --
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From alfonso.pantoja at gmail.com  Tue Aug  2 10:44:44 2011
From: alfonso.pantoja at gmail.com (Alfonso Pantoja)
Date: Tue, 2 Aug 2011 02:44:44 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ actively refuses connections after
	connectity issues
In-Reply-To: <968a1a05-b848-4794-b8ad-9a865489ce51@p20g2000yqp.googlegroups.com>
References: <968a1a05-b848-4794-b8ad-9a865489ce51@p20g2000yqp.googlegroups.com>
Message-ID: <65dd7dd1-b45c-48d7-b80b-69978911fb9e@k27g2000yqn.googlegroups.com>

More info:
when we had the problem, in RabbitMQ web admin we could see that file
descriptors monitor were in red (file descriptors were near the
maximum)



On 2 ago, 11:06, Alfonso Pantoja <alfonso.pant... at gmail.com> wrote:
> Hi,
>
> we are running RabbitMQ v. 2.2.0 on Ubuntu and yesterday we
> experienced a problem in our production server after a connectivity
> issue that caused the consumers couldn't access to Rabbit.
> After the connectivity issue was solved the consumers couldn't connect
> to Rabbit anymore (they are windows services).
> Our RabbitMQ works with Ejabberd using a custom mod_rabbitmq.
>
> In some consumers we saw the error
> System.Net.Sockets.SocketException: An operation on a socket could not
> be performed because the system lacked sufficient buffer space or
> because a queue was full"
> And after some time this error turned into
>
> System.Net.Sockets.TcpClient.Connect(String hostname, Int32 port)
> ? at RabbitMQ.Client.Impl.SocketFrameHandler_0_9..ctor(AmqpTcpEndpoint
> endpoint)
> ? at
> RabbitMQ.Client.Framing.Impl.v0_9.ProtocolBase.CreateFrameHandler(AmqpTcpEndpoint
> endpoint)
> ? at RabbitMQ.Client.ConnectionFactory.FollowRedirectChain(Int32
> maxRedirects, IDictionary connectionAttempts, IDictionary
> connectionErrors, AmqpTcpEndpoint[]& mostRecentKnownHosts,
> AmqpTcpEndpoint endpoint)amqp-0-9://xx.xx.xxx.xxx:5672 -
> System.Net.Sockets.SocketException: No connection could be made
> because the target machine actively refused it
>
> I've been doing a research about this problem and found that some
> services are using BasicGet for getting the messages continously. In
> this group I've found a reference to a issue with BasicGet which
> caused the consumer to hang after a certain number of messages.
> Maybe BasicGet is using too connections (and also those services are
> using Qos=1) but the most strange thing is the error where Rabbit
> refuses the connections.
> Is there any limitation on RabbitMQ or a security system for avoiding
> continous short living connections (as far as
>
> I know BasicGet opens and closes channel connections)?
> By the way the rabbit connections is constructed with a heartbeat=3.
>
> Moreover when the problem arised we tried to connect other consumers
> using another Windows machine and Rabbit still refused the
> connections. The problem couldn't be solved immediatly
> and a couple of Rabbit restarts were needed. They also tried to
> replace the rabbit with another rabbit server (they use pacemaker).
>
> Finally the problem gone (magically?) and the consumers worked again.
>
> Any ideas?
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simon at rabbitmq.com  Tue Aug  2 10:53:34 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 02 Aug 2011 10:53:34 +0100
Subject: [rabbitmq-discuss] RabbitMQ actively refuses connections after
 connectity issues
In-Reply-To: <65dd7dd1-b45c-48d7-b80b-69978911fb9e@k27g2000yqn.googlegroups.com>
References: <968a1a05-b848-4794-b8ad-9a865489ce51@p20g2000yqp.googlegroups.com>
	<65dd7dd1-b45c-48d7-b80b-69978911fb9e@k27g2000yqn.googlegroups.com>
Message-ID: <4E37C91E.3010902@rabbitmq.com>

On 02/08/11 10:44, Alfonso Pantoja wrote:
> More info:
> when we had the problem, in RabbitMQ web admin we could see that file
> descriptors monitor were in red (file descriptors were near the
> maximum)

Well that's basically your problem - when RabbitMQ runs out of file 
descriptors it simply can't accept any more TCP connections. In practice 
it will stop accepting connections slightly before it runs out 
completely, to give itself some wriggle room when writing new files.

This is a pure OS-level limitation, Rabbit gives you some monitoring of 
the situation but that's it.

The most likely problem was that something was holding connections open 
- check the connections page in mgmt to see what that was.

Ubuntu has a fairly low limit on file descriptors by default (1000) - if 
you think you could legitimately want to accept more than ~800 
connections at once you might want to add something like:

rabbitmq        soft    nofile          100000
rabbitmq        hard    nofile          100000

to /etc/security/limits.conf and restart Rabbit.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From alfonso.pantoja at gmail.com  Tue Aug  2 11:17:17 2011
From: alfonso.pantoja at gmail.com (Alfonso Pantoja)
Date: Tue, 2 Aug 2011 03:17:17 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ actively refuses connections after
	connectity issues
In-Reply-To: <4E37C91E.3010902@rabbitmq.com>
References: <968a1a05-b848-4794-b8ad-9a865489ce51@p20g2000yqp.googlegroups.com>
	<65dd7dd1-b45c-48d7-b80b-69978911fb9e@k27g2000yqn.googlegroups.com>
	<4E37C91E.3010902@rabbitmq.com>
Message-ID: <da4c18d6-20a4-49cd-88c9-0690cce14701@t5g2000yqj.googlegroups.com>


Simon,

Thanks for your response.
We have about 8 windows services and all use the heartbeat feature. 6
of them use the basicGet approach (this should be changed)
I think default Ubuntu's configuration has not been modified so I
think it is strange that those few consumers/publishers could run out
the file descriptors.

Windows services try to connect to RabbitMQ continously so when the
connection is lost there are trying to connect permanently. Can these
behavior lead to a  file descriptor lack while Rabbit is restarting
and about to be operative?

After reading some posts in this group I'm wondering if a large amount
of queues could be a problem. We have more 1000 durable queues. The
most of them are created due to the use of a custom mod_rabbitmq in
Ejabberd where all users have their message queue.


Thank you in advance

Regards,

Alfonso



On 2 ago, 11:53, Simon MacMullen <si... at rabbitmq.com> wrote:
> On 02/08/11 10:44, Alfonso Pantoja wrote:
>
> > More info:
> > when we had the problem, in RabbitMQ web admin we could see that file
> > descriptors monitor were in red (file descriptors were near the
> > maximum)
>
> Well that's basically your problem - when RabbitMQ runs out of file
> descriptors it simply can't accept any more TCP connections. In practice
> it will stop accepting connections slightly before it runs out
> completely, to give itself some wriggle room when writing new files.
>
> This is a pure OS-level limitation, Rabbit gives you some monitoring of
> the situation but that's it.
>
> The most likely problem was that something was holding connections open
> - check the connections page in mgmt to see what that was.
>
> Ubuntu has a fairly low limit on file descriptors by default (1000) - if
> you think you could legitimately want to accept more than ~800
> connections at once you might want to add something like:
>
> rabbitmq ? ? ? ?soft ? ?nofile ? ? ? ? ?100000
> rabbitmq ? ? ? ?hard ? ?nofile ? ? ? ? ?100000
>
> to /etc/security/limits.conf and restart Rabbit.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From alexis at rabbitmq.com  Tue Aug  2 11:47:39 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Tue, 2 Aug 2011 11:47:39 +0100
Subject: [rabbitmq-discuss] RabbitMQ + CEP
In-Reply-To: <4E367961.2000709@rabbitmq.com>
References: <CABzW0g5vsVTc0d3Wnj9G_UM7bLPx0ZENE+n4TqLfKcesEGoX3g@mail.gmail.com>
	<4E367961.2000709@rabbitmq.com>
Message-ID: <CACOPnvcaF-KYc5U3xvtjNvNDqiO1FR+03BJnjQWQp1aYBKUXiA@mail.gmail.com>

Here is an open source project using RabbitMQ + Esper for management
and monitoring at Google:

http://code.google.com/p/rocksteady/



On Mon, Aug 1, 2011 at 11:01 AM, Emile Joubert <emile at rabbitmq.com> wrote:
> Hi Cris,
>
> On 29/07/11 12:05, Cristoforo Seccia wrote:
>> Hi All,
>> is there anyone who has used or is using RabbitMQ in conjunction with a
>> CEP engine, for example Esper. I know this should not be a problem but I
>> can't find (at least googling does not help me) any information or
>> useful tips on how to implement this kind of stuff. Thanks in advance.
>
> There are RabbitMQ users that also make use of Esper, but unfortunately
> not in open-source projects that can be shared. If you have any
> questions about specific integration issues then feel free to ask.
>
>
>
> Regards
>
> Emile
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From cristofer.seccia at gmail.com  Tue Aug  2 12:03:21 2011
From: cristofer.seccia at gmail.com (Cristoforo Seccia)
Date: Tue, 2 Aug 2011 13:03:21 +0200
Subject: [rabbitmq-discuss] RabbitMQ + CEP
In-Reply-To: <CACOPnvcaF-KYc5U3xvtjNvNDqiO1FR+03BJnjQWQp1aYBKUXiA@mail.gmail.com>
References: <CABzW0g5vsVTc0d3Wnj9G_UM7bLPx0ZENE+n4TqLfKcesEGoX3g@mail.gmail.com>
	<4E367961.2000709@rabbitmq.com>
	<CACOPnvcaF-KYc5U3xvtjNvNDqiO1FR+03BJnjQWQp1aYBKUXiA@mail.gmail.com>
Message-ID: <CABzW0g5_X-EAriHDd4kPdR4JCuddgbre0rZ37Un-YDjerAMGdw@mail.gmail.com>

Hi, thanks for the hints!

2011/8/2 Alexis Richardson <alexis at rabbitmq.com>

> Here is an open source project using RabbitMQ + Esper for management
> and monitoring at Google:
>
> http://code.google.com/p/rocksteady/
>
>
>
> On Mon, Aug 1, 2011 at 11:01 AM, Emile Joubert <emile at rabbitmq.com> wrote:
> > Hi Cris,
> >
> > On 29/07/11 12:05, Cristoforo Seccia wrote:
> >> Hi All,
> >> is there anyone who has used or is using RabbitMQ in conjunction with a
> >> CEP engine, for example Esper. I know this should not be a problem but I
> >> can't find (at least googling does not help me) any information or
> >> useful tips on how to implement this kind of stuff. Thanks in advance.
> >
> > There are RabbitMQ users that also make use of Esper, but unfortunately
> > not in open-source projects that can be shared. If you have any
> > questions about specific integration issues then feel free to ask.
> >
> >
> >
> > Regards
> >
> > Emile
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110802/fe9b8b11/attachment.htm>

From andrea.rosa at hp.com  Tue Aug  2 12:08:18 2011
From: andrea.rosa at hp.com (Andrea Rosa)
Date: Tue, 02 Aug 2011 12:08:18 +0100
Subject: [rabbitmq-discuss] CRL support
Message-ID: <1312283298.17699.15.camel@vicbristol6.hpl.hp.com>

Hi 

I am working with RabbitMQ with the SSL encryption enabled and
everything works fine.
I implemented a client and server authentication but if a client send a
revoked certificate the server accept the connection, I read that the
CRL is not yet supported by the new_ssl Erlang module, but I need to
manage also CRLs.
Do someone else facing with the same problem?
Have you experienced with some workaround to guarantee that a revoked
certificate is not accepted by Rabbit?

Cheers
--
Andrea



From pablo.ruiz at gmail.com  Tue Aug  2 12:37:10 2011
From: pablo.ruiz at gmail.com (Pablo Ruiz)
Date: Tue, 2 Aug 2011 13:37:10 +0200
Subject: [rabbitmq-discuss] Slow startup/recovery time
Message-ID: <CAHfDCQJwhJzLE_uVQqs59pXiGbpqXZEfesY7f6m3N90BudTr=A@mail.gmail.com>

Hi,

Since upgraded to 2.5.1 from 2.1.1, one of our rabbit servers refuses to
finish startup procedures.. starup_log shows:

AMQP 0-9-1 / 0-9 / 0-8
Copyright (C) 2007-2011 VMware, Inc.
Licensed under the MPL.  See http://www.rabbitmq.com/

node           : rabbit at qa
app descriptor :
/usr/lib/rabbitmq/lib/rabbitmq_server-2.5.1/sbin/../ebin/rabbit.app
home dir       : /var/lib/rabbitmq
config file(s) : (none)
cookie hash    : kiHDz4b553meuCVcbBEI4w==
log            : /var/log/rabbitmq/rabbit at qa.log
sasl log       : /var/log/rabbitmq/rabbit at qa-sasl.log
database dir   : /var/lib/rabbitmq/mnesia/rabbit at qa
erlang version : 5.8

-- rabbit boot start
starting file handle cache server
...done
starting worker pool
 ...done
starting database
...done
starting codec correctness check
 ...done
-- external infrastructure ready
starting plugin registry
 ...done
starting auth mechanism cr-demo
...done
starting auth mechanism amqplain
 ...done
starting auth mechanism plain
...done
starting statistics event manager
...done
starting logging server
...done
starting exchange type direct
...done
starting exchange type fanout
...done
starting exchange type headers
 ...done
starting exchange type topic
 ...done
-- kernel ready
starting alarm handler
 ...done
starting node monitor
...done
starting cluster delegate
...done
starting guid generator
...done
starting memory monitor
...done
-- core initialized
starting empty DB check
...done
starting exchange, queue and binding recovery                         ...

At this point it keeps 'doing nothing' forever.. which makes me think it's
just re-indexing/recovering queues and messajes, however, the mail log files
show the following error:

=ERROR REPORT==== 2-Aug-2011::13:27:55 ===
** Generic server <0.127.0> terminating
** Last message in was {'$gen_cast',
                           {submit_async,
                               #Fun<rabbit_queue_index.24.55115249>}}
** When Server state == 2
** Reason for termination ==
** {function_clause,
       [{rabbit_queue_index,journal_minus_segment1,
            [{no_pub,no_del,ack},
             {{<<144,186,140,223,68,195,225,104,84,142,97,239,10,35,24,96>>,
               {message_properties,undefined,false},
               true},
              no_del,no_ack}]},
        {rabbit_queue_index,'-journal_minus_segment/2-fun-0-',4},
        {array,sparse_foldl_3,7},
        {array,sparse_foldl_2,9},
        {rabbit_queue_index,'-recover_journal/1-fun-0-',1},
        {dict,map_bucket,2},
        {dict,map_bkt_list,2},
        {dict,map_bkt_list,2}]}

Should I ignore such error??

Greets
Pablo

PD: I can zip & send our mnesia files just in case they are needed to debug
the issue.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110802/4b57756e/attachment.htm>

From hedelson at vmware.com  Tue Aug  2 13:13:38 2011
From: hedelson at vmware.com (Helena Edelson)
Date: Tue, 2 Aug 2011 05:13:38 -0700
Subject: [rabbitmq-discuss] Message payload encoding
In-Reply-To: <AC22A5D6-03C9-41C3-85A0-4334D611D2A9@ohler.com>
References: <BDE140BF4C952041931EF8CAAC83341D026B6B8D70@exch-mbx-111.vmware.com>,
	<AC22A5D6-03C9-41C3-85A0-4334D611D2A9@ohler.com>
Message-ID: <BDE140BF4C952041931EF8CAAC83341D026B6B8D7E@exch-mbx-111.vmware.com>

Thanks Pete. Some payloads are Scala objects (serialized/deser by scalaxb/base64) and some plain xsl schemas (which some are doing base64 but I'd prefer UTF-8).
 
cheers,
Helena
________________________________________
From: Peter Ohler [peter at ohler.com]
Sent: Friday, July 29, 2011 8:12 PM
To: Helena Edelson
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Message payload encoding

If you don't mind I will take a shot at that one.

There are a few consideration that should be looked at. It is often the case that message size is not the most significant factor in performance, especially if the message size is small. Consider what it is you are sending. If it is a UTF-8 string then sending the string directly takes no preparation and is smaller than base64 encoding which also incurs and overhead in serialization and deserialization.

If what you are sending is an Java, Python, or Ruby object then there will be significant overhead in the serialization itself. For Ruby I wrote a fast object to XML serializer (Ox gem) that is much faster than the native Marshal encoding and that alone improved performance of our systems significantly.

Something else worth considering besides is how difficult it will be to debug and trace message exchanges. A binary format or base64 requires extra decoding to see what is in the body of a message while UTF-8 strings or XML can be viewed and understood directly. That is a real time saver during development and even in production when trying to fix a problem quickly.

-Pete

On Jul 30, 2011, at 3:00 AM, Helena Edelson wrote:

> Is there a preference, as in performance or other reason (please specify if so) for a message payload to be encoded for Rabbit as UTF-8 or base64?
> I have been doing UTF-8; just curious.
>
> Thanks,
> Helena
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From michael.s.klishin at gmail.com  Tue Aug  2 13:27:40 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 2 Aug 2011 16:27:40 +0400
Subject: [rabbitmq-discuss] Recommended ways of basic queue introspection
In-Reply-To: <4E36A43C.3070901@rabbitmq.com>
References: <CAE3HoVTezeLLWnEkF=kFGsDgJ8HAbywGup_CR-W97k+4FS-1jw@mail.gmail.com>
	<4E36A43C.3070901@rabbitmq.com>
Message-ID: <CAE3HoVQg+9TGSzcRyNzQnM-WErLCHo=KZUGsmH127VAu-0ZMbg@mail.gmail.com>

2011/8/1 Emile Joubert <emile at rabbitmq.com>

>
> The other possibility is to provide your own browsable queue
> implementation. This is not a trivial undertaking, but it is possible to
> slot in your own implementation and make it free from FIFO restrictions.


Would it be easier to implement queue event nofications ("messages was put
to the queue", "messages was confirmed")?

Also, if messages not stored in mnesia, how are they stored then? In our
case we don't really need a perfectly consistent snapshot
of what's in the queue, just something that is reasonably up to date and
won't result in message reordering (that's why basic.get with requeueing is
not an option).

RabbitMQ offers 95% of what we need, this is the last 5%. So please help me
a little with this :)
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110802/ce55352d/attachment.htm>

From emile at rabbitmq.com  Tue Aug  2 13:57:52 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 02 Aug 2011 13:57:52 +0100
Subject: [rabbitmq-discuss] Slow startup/recovery time
In-Reply-To: <CAHfDCQJwhJzLE_uVQqs59pXiGbpqXZEfesY7f6m3N90BudTr=A@mail.gmail.com>
References: <CAHfDCQJwhJzLE_uVQqs59pXiGbpqXZEfesY7f6m3N90BudTr=A@mail.gmail.com>
Message-ID: <4E37F450.1050302@rabbitmq.com>

Hi Pablo,

On 02/08/11 12:37, Pablo Ruiz wrote:
> Hi,
> 
> Since upgraded to 2.5.1 from 2.1.1, one of our rabbit servers refuses to
> finish startup procedures.. starup_log shows:

> =ERROR REPORT==== 2-Aug-2011::13:27:55 ===
> ** Generic server <0.127.0> terminating
> ** Last message in was {'$gen_cast',
>                            {submit_async,
>                                #Fun<rabbit_queue_index.24.55115249>}}
> ** When Server state == 2
> ** Reason for termination ==
> ** {function_clause,
>        [{rabbit_queue_index,journal_minus_segment1,
>             [{no_pub,no_del,ack},
>              {{<<144,186,140,223,68,195,225,104,84,142,97,239,10,35,24,96>>,
>                {message_properties,undefined,false},
>                true},
>               no_del,no_ack}]},
>         {rabbit_queue_index,'-journal_minus_segment/2-fun-0-',4},
>         {array,sparse_foldl_3,7},
>         {array,sparse_foldl_2,9},
>         {rabbit_queue_index,'-recover_journal/1-fun-0-',1},
>         {dict,map_bucket,2},
>         {dict,map_bkt_list,2},
>         {dict,map_bkt_list,2}]}
> 
> Should I ignore such error??
> 
> Greets
> Pablo
> 
> PD: I can zip & send our mnesia files just in case they are needed to
> debug the issue.

We'd be interested in receiving those files, if you can make them
available offlist. The error points to an unexpected logical
inconsistency during the upgrade procedure. Can you also confirm whether
the v2.1.1 broker was shut down cleanly?


Regards

Emile

From fisher at yun.io  Tue Aug  2 14:43:46 2011
From: fisher at yun.io (Fisher Yu)
Date: Tue, 2 Aug 2011 21:43:46 +0800
Subject: [rabbitmq-discuss] Error while connect to rabbitmq using
	rabbitmq-erlang-client library
Message-ID: <CAPnrV9_EfM-r7XGA=mJfsT1JB8u6ptvX-Pp8BwQEoziuZkNEHg@mail.gmail.com>

Hi

  I kept get error message while connect to rabbitmq server using
rabbitmq-erlang-client library. Anyone can help, thanks.

Erlang R14B03 (erts-5.8.4) [source] [64-bit] [smp:24:24] [rq:24]
[async-threads:0] [kernel-poll:false]
Eshell V5.8.4  (abort with ^G)
1> test:start().
=ERROR REPORT==== 2-Aug-2011::08:40:18 ===
** Generic server <0.46.0> terminating
** Last message in was
{inet_async,#Port<0.1109>,1,{ok,<<65,77,81,80,1,1,8>>}}
** When Server state == {state,#Port<0.1109>,<0.39.0>,<0.41.0>,
                               {method,rabbit_framing_amqp_0_9_1},
                               none}
** Reason for termination ==
** {{badmatch,{error,enomem}},
    [{amqp_main_reader,handle_inet_async,2},
     {gen_server,handle_msg,5},
     {proc_lib,init_p_do_apply,3}]}



%%test.erl

-module(test).
-include_lib("amqp_client/include/amqp_client.hrl").
-compile(export_all).
start() ->
        {ok, Connection} =
amqp_connection:start(#amqp_params_network{username= <<"myuser">>, password=
<<"mypassword">>}),
        {ok, Channel} = amqp_connection:open_channel(Connection),
        Queue = "my_queue",
        Declare = #'queue.declare'{queue = list_to_binary(Queue),
durable=true},
        #'queue.declare_ok'{} = amqp_channel:call(Channel, Declare),
        Get = #'basic.get'{queue = Queue},
        {#'basic.get_ok'{delivery_tag = Tag}, Content}
                       = amqp_channel:call(Channel, Get),
        io:format("received message ~p", [Content]),
        %% Close the channel
        amqp_channel:close(Channel),
        %% Close the connection
        amqp_connection:close(Connection),
        ok.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110802/81a66697/attachment.htm>

From stammailbox at gmail.com  Tue Aug  2 14:46:40 2011
From: stammailbox at gmail.com (mysurf mail)
Date: Tue, 2 Aug 2011 14:46:40 +0100
Subject: [rabbitmq-discuss] jspon rpc
Message-ID: <CAJ2-VrnOtbrp5A45Ji-X6t+x-psy5rDn-0Srb+_APMBt-+e1DA@mail.gmail.com>

Hi all,
I am still getting a lot of trouble using json rpc server client.
I use -

      new JsonRpcClient(channel,"",SomeStringNotUniqueToApp)

Sometimes it works great and it sometimes it does  not return at all. The
system just halts.
Are there any suggestions?

Should I give it an exchange specific name?
thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110802/aa42fff9/attachment.htm>

From abhishek.kona at gmail.com  Tue Aug  2 15:00:29 2011
From: abhishek.kona at gmail.com (Abhishek K)
Date: Tue, 2 Aug 2011 19:30:29 +0530
Subject: [rabbitmq-discuss] RabbitMQ Issues -> Losing confidence in it.
Message-ID: <CAGTBvKv+LDMh7TzO2LeuUviMv=fJGgQG-+w2hix4D7-wZzqd=Q@mail.gmail.com>

Hi,

We have been running a single RabbitMQ instance for 6 months now (RabbitMQ
2.2).
Off late we observed RabbitMQ was consuming 11G of Memory when the entire
queue-size was about 7MB.
We decided to do a restart of RabbitMQ (thinking this was a memory leak).
On doing a restart of the APP we kept getting restart TIME-OUT without any
messages in the startup_{err,log).

We kept on retrying the restart and after 10minutes RabbitMQ restarted on
its own, without any message or log of what went wrong.

What was an expected down time of <1min ended up being a down time of 10
min.
Also it forced our team to frantically set up RabbittMQ on a new machine
with all the queues and Exchanges (the original Rabbit came back up in the
meanwhile).

We are trying to analyze why this happened to us. Specifically answer the
following questions

   - Why was rabbitmq consuming high amounts of memory? Was it a memory
   leak? Is the memory leak fixed in the later version.
   - Why did rabbitMQ not restart immediately? Why was no message present in
   the log.
   - In situations like these how do we start a new rabbitmq instance
   automatically with all the queues and preferably data.
   - How do we upgrade to latest Rabbit without any data loss?

Any opinions and thoughts on this are welcome.

-Abhishek Kona
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110802/05857590/attachment.htm>

From alexandru at rabbitmq.com  Tue Aug  2 15:09:12 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Tue, 2 Aug 2011 15:09:12 +0100
Subject: [rabbitmq-discuss] Error while connect to rabbitmq using
 rabbitmq-erlang-client library
In-Reply-To: <CAPnrV9_EfM-r7XGA=mJfsT1JB8u6ptvX-Pp8BwQEoziuZkNEHg@mail.gmail.com>
References: <CAPnrV9_EfM-r7XGA=mJfsT1JB8u6ptvX-Pp8BwQEoziuZkNEHg@mail.gmail.com>
Message-ID: <20110802140912.GA25255@dakota.eng.vmware.com>

Hi,

> ** Reason for termination ==
> ** {{badmatch,{error,enomem}},
>     [{amqp_main_reader,handle_inet_async,2},
>      {gen_server,handle_msg,5},
>      {proc_lib,init_p_do_apply,3}]}

Strictly speaking, that means you've run out of memory.  Not sure how
that could happen, though.

There's an error in your example:

>         Get = #'basic.get'{queue = Queue},

should be

>         Get = #'basic.get'{queue = list_to_binary(Queue)},

Actually, you'd probably be better off converting Queue to a binary from
the start.

Still, the failure is during the initial handshake, so that can't be the
cause.

Have a look in the server logs: is there a matching error?  Is there any mention
of the memory alarms being set off?

What OS are you using?  What version of Erlang?  Is there anything
special about the system's configuration?  Is it under heavy load?

>   I kept get error message while connect to rabbitmq server using
> rabbitmq-erlang-client library. Anyone can help, thanks.

Does this mean you *always* get this error?  Or only occasionally?

Cheers,
Alex

On Tue, Aug 02, 2011 at 09:43:46PM +0800, Fisher Yu wrote:
> Hi
> 
>   I kept get error message while connect to rabbitmq server using
> rabbitmq-erlang-client library. Anyone can help, thanks.
> 
> Erlang R14B03 (erts-5.8.4) [source] [64-bit] [smp:24:24] [rq:24]
> [async-threads:0] [kernel-poll:false]
> Eshell V5.8.4  (abort with ^G)
> 1> test:start().
> =ERROR REPORT==== 2-Aug-2011::08:40:18 ===
> ** Generic server <0.46.0> terminating
> ** Last message in was
> {inet_async,#Port<0.1109>,1,{ok,<<65,77,81,80,1,1,8>>}}
> ** When Server state == {state,#Port<0.1109>,<0.39.0>,<0.41.0>,
>                                {method,rabbit_framing_amqp_0_9_1},
>                                none}
> ** Reason for termination ==
> ** {{badmatch,{error,enomem}},
>     [{amqp_main_reader,handle_inet_async,2},
>      {gen_server,handle_msg,5},
>      {proc_lib,init_p_do_apply,3}]}
> 
> 
> 
> %%test.erl
> 
> -module(test).
> -include_lib("amqp_client/include/amqp_client.hrl").
> -compile(export_all).
> start() ->
>         {ok, Connection} =
> amqp_connection:start(#amqp_params_network{username= <<"myuser">>, password=
> <<"mypassword">>}),
>         {ok, Channel} = amqp_connection:open_channel(Connection),
>         Queue = "my_queue",
>         Declare = #'queue.declare'{queue = list_to_binary(Queue),
> durable=true},
>         #'queue.declare_ok'{} = amqp_channel:call(Channel, Declare),
>         Get = #'basic.get'{queue = Queue},
>         {#'basic.get_ok'{delivery_tag = Tag}, Content}
>                        = amqp_channel:call(Channel, Get),
>         io:format("received message ~p", [Content]),
>         %% Close the channel
>         amqp_channel:close(Channel),
>         %% Close the connection
>         amqp_connection:close(Connection),
>         ok.

> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From simon at rabbitmq.com  Tue Aug  2 15:14:02 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 02 Aug 2011 15:14:02 +0100
Subject: [rabbitmq-discuss] RabbitMQ actively refuses connections after
	connectity issues
In-Reply-To: <da4c18d6-20a4-49cd-88c9-0690cce14701@t5g2000yqj.googlegroups.com>
References: <968a1a05-b848-4794-b8ad-9a865489ce51@p20g2000yqp.googlegroups.com>
	<65dd7dd1-b45c-48d7-b80b-69978911fb9e@k27g2000yqn.googlegroups.com>
	<4E37C91E.3010902@rabbitmq.com>
	<da4c18d6-20a4-49cd-88c9-0690cce14701@t5g2000yqj.googlegroups.com>
Message-ID: <4E38062A.7040608@rabbitmq.com>

On 02/08/11 11:17, Alfonso Pantoja wrote:
> Thanks for your response.

No problem!

> We have about 8 windows services and all use the heartbeat feature. 6
> of them use the basicGet approach (this should be changed)
> I think default Ubuntu's configuration has not been modified so I
> think it is strange that those few consumers/publishers could run out
> the file descriptors.

Yes.

> Windows services try to connect to RabbitMQ continously so when the
> connection is lost there are trying to connect permanently. Can these
> behavior lead to a  file descriptor lack while Rabbit is restarting
> and about to be operative?

It shouldn't: one of the last things RabbitMQ does when starting up is 
to listen for network connections, by the time it's capable of starting 
to consume file descriptors everything else should already be running.

> After reading some posts in this group I'm wondering if a large amount
> of queues could be a problem. We have more 1000 durable queues. The
> most of them are created due to the use of a custom mod_rabbitmq in
> Ejabberd where all users have their message queue.

No, RabbitMQ will use a pool of file descriptors for reading and writing 
to queues, so you can easily have more queues than FDs (but you'll get 
some FD-swapping; if you have large numbers of queues all writing to 
disc you may get better performance by increasing the number of FDs 
available).

I really think your problem is that one of your clients was somehow 
opening connections in an uncontrolled way. If this happens again I 
would strongly recommend checking the connections list in mgmt or 
rabbitmqctl list_connections to see where they all are.

Obviously it's too late now but if you still have the log files from 
around then you might be able to cross reference "accepted TCP 
connection" and "closing TCP connection" and see what you have left over.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From alfonso.pantoja at gmail.com  Tue Aug  2 15:36:18 2011
From: alfonso.pantoja at gmail.com (Alfonso Pantoja)
Date: Tue, 2 Aug 2011 16:36:18 +0200
Subject: [rabbitmq-discuss] RabbitMQ actively refuses connections after
	connectity issues
In-Reply-To: <4E38062A.7040608@rabbitmq.com>
References: <968a1a05-b848-4794-b8ad-9a865489ce51@p20g2000yqp.googlegroups.com>
	<65dd7dd1-b45c-48d7-b80b-69978911fb9e@k27g2000yqn.googlegroups.com>
	<4E37C91E.3010902@rabbitmq.com>
	<da4c18d6-20a4-49cd-88c9-0690cce14701@t5g2000yqj.googlegroups.com>
	<4E38062A.7040608@rabbitmq.com>
Message-ID: <CAGVpBACEMfdsxHK1Pp4WZ3tnaP=9XYG5iG1yxCV3-av_q92hsQ@mail.gmail.com>

2011/8/2 Simon MacMullen <simon at rabbitmq.com>

> On 02/08/11 11:17, Alfonso Pantoja wrote:
>
>> Thanks for your response.
>>
>
>
> I really think your problem is that one of your clients was somehow opening
> connections in an uncontrolled way. If this happens again I would strongly
> recommend checking the connections list in mgmt or rabbitmqctl
> list_connections to see where they all are.
>
>
Ok, we'll try to monitor the numer of connections.

By the way  Since we are using RequestedHeartbeat feature is it possible to
open a connection to rabbit and not use it anymore without being
disconnected?
(setting RequestedHeartbea with a value > 0 is enough or additional code is
needed?)




> Obviously it's too late now but if you still have the log files from around
> then you might be able to cross reference "accepted TCP connection" and
> "closing TCP connection" and see what you have left over.
>
>
Yes, maybe is too late but I'll try to get them.


Thanks

Regards,


Alfonso
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110802/67ae61ee/attachment.htm>

From stastny at 101ideas.cz  Tue Aug  2 19:00:01 2011
From: stastny at 101ideas.cz (=?UTF-8?B?SmFrdWIgxaDFpWFzdG7DvQ==?=)
Date: Tue, 2 Aug 2011 11:00:01 -0700
Subject: [rabbitmq-discuss] [amqp] Introducing "AMQP 0.9.1 Model
	Explained"
In-Reply-To: <CAE3HoVT4r7aXw9aYd0KY5mDE9EKd9Lcm+RBxM0hYGkpBPDKv3Q@mail.gmail.com>
References: <CAE3HoVT4r7aXw9aYd0KY5mDE9EKd9Lcm+RBxM0hYGkpBPDKv3Q@mail.gmail.com>
Message-ID: <CA+1R4g4V+pEchT+i5Wh9-DxH-1eKTNRogii60ZR4wZfFTjkWUg@mail.gmail.com>

Very nice, thank you!

Jakub

http://www.flickr.com/photos/jakub-stastny
http://twitter.com/botanicus



On 2 August 2011 02:26, Michael Klishin <michael.s.klishin at gmail.com> wrote:

> I have a little announcement to make.
>
> As I have been using RabbitMQ for over 2 years now, I kept explaining AMQP
> Model concepts, featurse & why they exist to numerous people. After a while
> it became clear that there is simply
> no decent introduction to the protocol. There are
>
> * Shallow blog posts
> * http://www.rabbitmq.com/faq.html#what-is-amqp which does not really
> focus on explaining what AMQP has to offer (and, lets be honest, is written
> for CIOs/CTOs and not developers).
> * Full specification document
>
> None of these options is really good in my opinion. The spec is pretty good
> at explaining what features AMQP has and why it has them but reading 40 page
> long specifications is not what most people want to do
> to learn the fundamentals. I also have no way to edit rabbitmq.comcontent.
>
> So I decided to go ahead and write a 2 page long introduction that focumes
> on
>
> * Concepts
> * Features
> * Why those features exist (what problems do they solve)
> * Explaining what all those basic.get and queue.declare-ok really mean.
>
> As a result we now have a new "AMQP 0.9.1 Model Explained" in the amqp gem
> documentation guides:
>
> http://bit.ly/amqp-model-explained
>
> I ran it by a few dozens of people with AMQP knowledge ranging from 0 (some
> of them are not really software engineers) to one of the RabbitMQ team
> members (Emile Joubert) and the feed back so far is
> "this is so much better than shallow blog posts, FAQs and 40 page long
> specifications". I intentionally left out some details that are irrelevant
> for understanding high-level protocol concepts.
>
> This work is licensed it under the Creative Commons Attribution 3.0
> Unported License <http://creativecommons.org/licenses/by/3.0/> that lets
> RabbitMQ team take any parts of this guide, edit it and put it to
> rabbitmq.com (please concult with VMware legal department first but this
> is what Creative Commons site's "Choose a license" feature suggested me).
> The source is in Textile and up on github:
>
>
> https://github.com/ruby-amqp/amqp/blob/master/docs/AMQP091ModelExplained.textile
>
> I hope this helps with lowering the learning curve. I will keep refining
> that document and adding more diagrams when I have some more time.
>
> Have a good day.
> --
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
>  --
> Documentation guides: http://bit.ly/amqp-gem-docs
> Code examples: http://bit.ly/amq-gem-examples
> API reference: http://bit.ly/mDm1JE
>
> Drop by #rabbitmq on irc.freenode.net
> Bug tracker: https://github.com/ruby-amqp/amqp/issues
>
> Post to the group: ruby-amqp at googlegroups.com | unsubscribe:
> ruby-amqp+unsubscribe at googlegroups.com
>
> Group page: http://groups.google.com/group/ruby-amqp?hl=en
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110802/55fefe70/attachment.htm>

From simone.busoli at gmail.com  Tue Aug  2 22:05:11 2011
From: simone.busoli at gmail.com (Simone Busoli)
Date: Tue, 2 Aug 2011 23:05:11 +0200
Subject: [rabbitmq-discuss] Introducing "AMQP 0.9.1 Model Explained"
In-Reply-To: <CAE3HoVT4r7aXw9aYd0KY5mDE9EKd9Lcm+RBxM0hYGkpBPDKv3Q@mail.gmail.com>
References: <CAE3HoVT4r7aXw9aYd0KY5mDE9EKd9Lcm+RBxM0hYGkpBPDKv3Q@mail.gmail.com>
Message-ID: <CAOn7oW-3DbY3Q6o6j_zNehjskp1G2gcYx5UA4MPaJgVAS7G0+g@mail.gmail.com>

Thanks Michael, interesting read.

On Tue, Aug 2, 2011 at 11:26, Michael Klishin
<michael.s.klishin at gmail.com>wrote:

> I have a little announcement to make.
>
> As I have been using RabbitMQ for over 2 years now, I kept explaining AMQP
> Model concepts, featurse & why they exist to numerous people. After a while
> it became clear that there is simply
> no decent introduction to the protocol. There are
>
> * Shallow blog posts
> * http://www.rabbitmq.com/faq.html#what-is-amqp which does not really
> focus on explaining what AMQP has to offer (and, lets be honest, is written
> for CIOs/CTOs and not developers).
> * Full specification document
>
> None of these options is really good in my opinion. The spec is pretty good
> at explaining what features AMQP has and why it has them but reading 40 page
> long specifications is not what most people want to do
> to learn the fundamentals. I also have no way to edit rabbitmq.comcontent.
>
> So I decided to go ahead and write a 2 page long introduction that focumes
> on
>
> * Concepts
> * Features
> * Why those features exist (what problems do they solve)
> * Explaining what all those basic.get and queue.declare-ok really mean.
>
> As a result we now have a new "AMQP 0.9.1 Model Explained" in the amqp gem
> documentation guides:
>
> http://bit.ly/amqp-model-explained
>
> I ran it by a few dozens of people with AMQP knowledge ranging from 0 (some
> of them are not really software engineers) to one of the RabbitMQ team
> members (Emile Joubert) and the feed back so far is
> "this is so much better than shallow blog posts, FAQs and 40 page long
> specifications". I intentionally left out some details that are irrelevant
> for understanding high-level protocol concepts.
>
> This work is licensed it under the Creative Commons Attribution 3.0
> Unported License <http://creativecommons.org/licenses/by/3.0/> that lets
> RabbitMQ team take any parts of this guide, edit it and put it to
> rabbitmq.com (please concult with VMware legal department first but this
> is what Creative Commons site's "Choose a license" feature suggested me).
> The source is in Textile and up on github:
>
>
> https://github.com/ruby-amqp/amqp/blob/master/docs/AMQP091ModelExplained.textile
>
> I hope this helps with lowering the learning curve. I will keep refining
> that document and adding more diagrams when I have some more time.
>
> Have a good day.
> --
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110802/6513e77b/attachment.htm>

From shenyute at gmail.com  Wed Aug  3 01:52:16 2011
From: shenyute at gmail.com (Yu-Teh Shen)
Date: Wed, 3 Aug 2011 08:52:16 +0800
Subject: [rabbitmq-discuss] what's the difference between virtual host and
	clustering
Message-ID: <CABWH_X6gsq4=J=q5AvFtEcURD3irYmw77LkB2iERLbvJi-fDtw@mail.gmail.com>

According to the AMQP 0.9.1, the virtual host is a data partition within the
server and it comprises its own name space, a set of exchanges, queues
..etc.

I thought it just very similar to the clustering which combine many erlang
node together.

Or can I say that they are under different layer of abstraction. Once you
combine many rabbitmq erlang node together, it is called cluster.

And if you want to isolate no matter a single node or cluster into different
partition, it is called virtual host.

Is my understanding right?

Thanks

Shen, Yu-Teh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110803/92efad29/attachment.htm>

From jerryk at vmware.com  Wed Aug  3 02:33:09 2011
From: jerryk at vmware.com (Jerry Kuch)
Date: Tue, 2 Aug 2011 18:33:09 -0700 (PDT)
Subject: [rabbitmq-discuss] what's the difference between virtual host
 and	clustering
In-Reply-To: <CABWH_X6gsq4=J=q5AvFtEcURD3irYmw77LkB2iERLbvJi-fDtw@mail.gmail.com>
Message-ID: <509236754.88549.1312335189685.JavaMail.root@zimbra-prod-mbox-4.vmware.com>

Hi, Yu-Teh: 


The similarity you're speaking of doesn't run especially deep, and might even mislead you if you internalize it too thoroughly. 


You can, as you say, have many virtual hosts within a RabbitMQ server, but this is independent of the fact that you can cluster multiple RabbitMQ servers into a cooperating whole. 


Clustering involves the management of certain shared state across all of the Rabbit servers that participate in a cluster, but not all server state is shared (for example a given queue will exist only on one of the Rabbit servers in a cluster in the current implementation while the metadata used for maintaining users, exchanges, queues, bindings, and the like however is shared through Erlang's Mnesia database). 


Best regards, 
Jerry 

----- Original Message -----

From: "Yu-Teh Shen" <shenyute at gmail.com> 
To: rabbitmq-discuss at lists.rabbitmq.com 
Sent: Tuesday, August 2, 2011 5:52:16 PM 
Subject: [rabbitmq-discuss] what's the difference between virtual host and clustering 

According to the AMQP 0.9.1, the virtual host is a data partition within the server and it comprises its own name space, a set of exchanges, queues ..etc. 


I thought it just very similar to the clustering which combine many erlang node together. 


Or can I say that they are under different layer of abstraction. Once you combine many rabbitmq erlang node together, it is called cluster. 


And if you want to isolate no matter a single node or cluster into different partition, it is called virtual host. 


Is my understanding right? 


Thanks 



Shen, Yu-Teh 

_______________________________________________ 
rabbitmq-discuss mailing list 
rabbitmq-discuss at lists.rabbitmq.com 
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110802/012d9a16/attachment.htm>

From fisher at yun.io  Wed Aug  3 04:31:27 2011
From: fisher at yun.io (Fisher Yu)
Date: Wed, 3 Aug 2011 11:31:27 +0800
Subject: [rabbitmq-discuss] Error while connect to rabbitmq using
 rabbitmq-erlang-client library
In-Reply-To: <20110802140912.GA25255@dakota.eng.vmware.com>
References: <CAPnrV9_EfM-r7XGA=mJfsT1JB8u6ptvX-Pp8BwQEoziuZkNEHg@mail.gmail.com>
	<20110802140912.GA25255@dakota.eng.vmware.com>
Message-ID: <CAPnrV9_XPKqRnn9RHdf0=UerCJ71nT1mfD5gJ0iW_dk=z0WygQ@mail.gmail.com>

2011/8/2 Alexandru Scvor?ov <alexandru at rabbitmq.com>

> Hi,
>
> > ** Reason for termination ==
> > ** {{badmatch,{error,enomem}},
> >     [{amqp_main_reader,handle_inet_async,2},
> >      {gen_server,handle_msg,5},
> >      {proc_lib,init_p_do_apply,3}]}
>
> Strictly speaking, that means you've run out of memory.  Not sure how
> that could happen, though.
>
> There's an error in your example:
>
> >         Get = #'basic.get'{queue = Queue},
>
> should be
>
> >         Get = #'basic.get'{queue = list_to_binary(Queue)},
>
> Actually, you'd probably be better off converting Queue to a binary from
> the start.
>

Changed this, thanks.


>
> Still, the failure is during the initial handshake, so that can't be the
> cause.
>
> Have a look in the server logs: is there a matching error?  Is there any
> mention
> of the memory alarms being set off?
>

There is nothing happening in the server logs, at least nothing being
raised.  There is 24G RAM in here, with about 4G active and 11G free at the
time of testing.



>
> What OS are you using?  What version of Erlang?  Is there anything
> special about the system's configuration?  Is it under heavy load?
>


The distribution is Ubuntu 10.04,
uname -a
Linux fs21 2.6.32-31-generic #61-Ubuntu SMP Fri Apr 8 18:25:51 UTC 2011
x86_64 GNU/Linux

Erlang version
Erlang R14B03 (erts-5.8.4) [source] [64-bit] [smp:24:24] [rq:24]
[async-threads:0] [kernel-poll:false]

This machine is almost completely idle at the moment as it's a development
server.  There is nothing special for the configuration.


>
> >   I kept get error message while connect to rabbitmq server using
> > rabbitmq-erlang-client library. Anyone can help, thanks.
>
> Does this mean you *always* get this error?  Or only occasionally?
>

Every time the test case is run, this error is produced.


>
> Cheers,
> Alex
>
> On Tue, Aug 02, 2011 at 09:43:46PM +0800, Fisher Yu wrote:
> > Hi
> >
> >   I kept get error message while connect to rabbitmq server using
> > rabbitmq-erlang-client library. Anyone can help, thanks.
> >
> > Erlang R14B03 (erts-5.8.4) [source] [64-bit] [smp:24:24] [rq:24]
> > [async-threads:0] [kernel-poll:false]
> > Eshell V5.8.4  (abort with ^G)
> > 1> test:start().
> > =ERROR REPORT==== 2-Aug-2011::08:40:18 ===
> > ** Generic server <0.46.0> terminating
> > ** Last message in was
> > {inet_async,#Port<0.1109>,1,{ok,<<65,77,81,80,1,1,8>>}}
> > ** When Server state == {state,#Port<0.1109>,<0.39.0>,<0.41.0>,
> >                                {method,rabbit_framing_amqp_0_9_1},
> >                                none}
> > ** Reason for termination ==
> > ** {{badmatch,{error,enomem}},
> >     [{amqp_main_reader,handle_inet_async,2},
> >      {gen_server,handle_msg,5},
> >      {proc_lib,init_p_do_apply,3}]}
> >
> >
> >
> > %%test.erl
> >
> > -module(test).
> > -include_lib("amqp_client/include/amqp_client.hrl").
> > -compile(export_all).
> > start() ->
> >         {ok, Connection} =
> > amqp_connection:start(#amqp_params_network{username= <<"myuser">>,
> password=
> > <<"mypassword">>}),
> >         {ok, Channel} = amqp_connection:open_channel(Connection),
> >         Queue = "my_queue",
> >         Declare = #'queue.declare'{queue = list_to_binary(Queue),
> > durable=true},
> >         #'queue.declare_ok'{} = amqp_channel:call(Channel, Declare),
> >         Get = #'basic.get'{queue = Queue},
> >         {#'basic.get_ok'{delivery_tag = Tag}, Content}
> >                        = amqp_channel:call(Channel, Get),
> >         io:format("received message ~p", [Content]),
> >         %% Close the channel
> >         amqp_channel:close(Channel),
> >         %% Close the connection
> >         amqp_connection:close(Connection),
> >         ok.
>
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110803/a0941cea/attachment.htm>

From kamauallan at gmail.com  Wed Aug  3 08:09:05 2011
From: kamauallan at gmail.com (Allan Kamau)
Date: Wed, 3 Aug 2011 10:09:05 +0300
Subject: [rabbitmq-discuss] RabbitMQ Issues -> Losing confidence in it.
In-Reply-To: <CAGTBvKv+LDMh7TzO2LeuUviMv=fJGgQG-+w2hix4D7-wZzqd=Q@mail.gmail.com>
References: <CAGTBvKv+LDMh7TzO2LeuUviMv=fJGgQG-+w2hix4D7-wZzqd=Q@mail.gmail.com>
Message-ID: <CAF3N6oTgy_BLOKwhe_pDHzPt6tvNRFdo1w8w8kQPLNx4s6Loow@mail.gmail.com>

On Tue, Aug 2, 2011 at 5:00 PM, Abhishek K <abhishek.kona at gmail.com> wrote:
> Hi,
> We have been running a single RabbitMQ instance for 6 months now (RabbitMQ
> 2.2).
> Off late we observed RabbitMQ was consuming 11G of Memory when the entire
> queue-size was about 7MB.
> We decided to do a restart of RabbitMQ (thinking this was a memory leak).
> On doing a restart of the APP we kept getting restart TIME-OUT without any
> messages in the startup_{err,log).
> We kept on retrying the restart and after 10minutes RabbitMQ restarted on
> its own, without any message or log of what went wrong.
> What was an expected down time of <1min ended up being a down time of 10
> min.
> Also it forced our team to frantically set up RabbittMQ on a new machine
> with all the queues and Exchanges (the original Rabbit came back up in the
> meanwhile).
> We are trying to analyze why this happened to us. Specifically answer the
> following questions
>
> Why was rabbitmq consuming high amounts of memory? Was it a memory leak? Is
> the memory leak fixed in the later version.
> Why did rabbitMQ not restart immediately? Why was no message present in the
> log.
> In situations like these how do we start a new rabbitmq instance
> automatically with all the queues and preferably data.
> How do we upgrade to latest Rabbit without any data loss?
>
> Any opinions and thoughts on this are welcome.
> -Abhishek Kona
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

You may want to include specify the OS and version you are running and
perhaps detail changes you may have made recently that may shed some
light to the cause of behaviour you are observing.

Allan.

From vbernard42 at gmail.com  Wed Aug  3 09:42:06 2011
From: vbernard42 at gmail.com (Valentin BERNARD)
Date: Wed, 3 Aug 2011 10:42:06 +0200
Subject: [rabbitmq-discuss] errors from management plugin appear to stop
 messages delivery
In-Reply-To: <C8465CF5-F055-429E-A5AB-3EC87006965E@gmail.com>
References: <DAD0D2AF-547A-4FE6-8A8C-70589EBA6B09@gmail.com>
	<4DA4BC1E.80306@rabbitmq.com>
	<8375097F-D9A2-488B-AA14-BFC0FBD8D281@gmail.com>
	<4DA4BF7F.7000404@rabbitmq.com>
	<1EBCE559-5427-47D9-A058-ADB11F734F5D@gmail.com>
	<4DA4CBB0.2060203@rabbitmq.com>
	<F0A431BC-F7BC-46D0-BC11-9ED6481F85DE@gmail.com>
	<4DB2FF64.2040908@rabbitmq.com>
	<C8465CF5-F055-429E-A5AB-3EC87006965E@gmail.com>
Message-ID: <CAGGH2aMHdDVos_YQ4BZWd0YNr_xLWgzv32_XKBXyO4=VADpYZQ@mail.gmail.com>

Hi,

Could we have some updates on this issue, please? I think we experienced the
same thing with RabbitMQ 2.5.0. We temporarily disabled all plugins, and
everything seemed to work again. We didn't get anything worth of interest in
the logs this time, but we had the "JSON encode error:
{bad_term,{messages,0}}" error a few days ago (at this time we were still
using RabbitMQ 2.4.1). Could it be the same problem, if it has not been
fixed yet?

Regards,

Valentin.

2011/4/25 Ian Ragsdale <ian.ragsdale at gmail.com>

> On Apr 23, 2011, at 11:33 AM, Matthias Radestock wrote:
>
> > Ian Ragsdale wrote:
> >> This just happened again.
> >
> > Is this in 2.4.1 with Simon's patched management plug-in?
>
> Sorry, somehow I completely missed the message he sent with the updated
> plugin - I just installed it.  Thanks!
>
> >> every connection is listed as 'blocked'.
> >
> > That indicates rabbit has paused all producers since memory is tight.
> >
> > What memory limit does rabbit thinks it has? Check the rabbit.log file
> near the beginning.
>
> =INFO REPORT==== 25-Apr-2011::13:29:44 ===
> Memory limit set to 3080MB.
>
> >
> > Next time you see rabbit stuck like that, please capture the output of
> (nearly) all 'rabbitmqctl list_*' commands i.e. users, vhosts, exchanges,
> queues, bindings, connections, channels, consumers,
>
> Will do.  Hopefully the updated plugin will mean that I don't have to.
>
> >
> > Also, if you can, try not to mix producers and consumers on the same
> connection. That will allow consumers to continue receiving messages and ack
> them even when rabbit has blocked producer connections.
> >
>
> Thanks - that's good to know.
>
> - Ian
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110803/b203a8d7/attachment.htm>

From simon at rabbitmq.com  Wed Aug  3 10:42:27 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 03 Aug 2011 10:42:27 +0100
Subject: [rabbitmq-discuss] errors from management plugin appear to stop
 messages delivery
In-Reply-To: <CAGGH2aMHdDVos_YQ4BZWd0YNr_xLWgzv32_XKBXyO4=VADpYZQ@mail.gmail.com>
References: <DAD0D2AF-547A-4FE6-8A8C-70589EBA6B09@gmail.com>	<4DA4BC1E.80306@rabbitmq.com>	<8375097F-D9A2-488B-AA14-BFC0FBD8D281@gmail.com>	<4DA4BF7F.7000404@rabbitmq.com>	<1EBCE559-5427-47D9-A058-ADB11F734F5D@gmail.com>	<4DA4CBB0.2060203@rabbitmq.com>	<F0A431BC-F7BC-46D0-BC11-9ED6481F85DE@gmail.com>	<4DB2FF64.2040908@rabbitmq.com>	<C8465CF5-F055-429E-A5AB-3EC87006965E@gmail.com>
	<CAGGH2aMHdDVos_YQ4BZWd0YNr_xLWgzv32_XKBXyO4=VADpYZQ@mail.gmail.com>
Message-ID: <4E391803.8080101@rabbitmq.com>

On 03/08/11 09:42, Valentin BERNARD wrote:
>
> Could we have some updates on this issue, please? I think we experienced
> the same thing with RabbitMQ 2.5.0. We temporarily disabled all plugins,
> and everything seemed to work again. We didn't get anything worth of
> interest in the logs this time, but we had the "JSON encode error:
> {bad_term,{messages,0}}" error a few days ago (at this time we were
> still using RabbitMQ 2.4.1). Could it be the same problem, if it has not
> been fixed yet?
>

No, this definitely was fixed in 2.5.0. So if you are seeing the same 
problem now, that's something else I'm afraid.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From chris.rode at headshift.com  Wed Aug  3 10:51:16 2011
From: chris.rode at headshift.com (Chris Rode)
Date: Wed, 3 Aug 2011 10:51:16 +0100
Subject: [rabbitmq-discuss] Installation problems on Centos
Message-ID: <C23F3588-096C-4CB1-AC34-B41005F37715@headshift.com>

Hi RabbitMQ List

I have been trying to get RabbitMQ up and running on my Centos installation using the installation instuctions for RPM based Linux distro's here http://www.rabbitmq.com/server.html

This all works fine until I try and install the RPM itself using rpm -ivh rabbitmq-server-2.5.1-1.noarch.rpm

This results in the following error:

warning: rabbitmq-server-2.5.1-1.noarch.rpm: Header V4 DSA signature: NOKEY, key ID 056e8e56
error: Failed dependencies:
	erlang >= R12B-3 is needed by rabbitmq-server-2.5.1-1.noarch

For additional information here is the erlang part of our rpm -qa

$ rpm -qa | grep erlang
erlang-runtime_tools-R14B-02.1.el5
erlang-wx-R14B-02.1.el5
erlang-inets-R14B-02.1.el5
erlang-snmp-R14B-02.1.el5
erlang-observer-R14B-02.1.el5
erlang-common_test-R14B-02.1.el5
erlang-erts-R14B-02.1.el5
erlang-stdlib-R14B-02.1.el5
erlang-crypto-R14B-02.1.el5
erlang-gs-R14B-02.1.el5
erlang-public_key-R14B-02.1.el5
erlang-ssl-R14B-02.1.el5
erlang-webtool-R14B-02.1.el5
erlang-sasl-R14B-02.1.el5
erlang-ssh-R14B-02.1.el5
erlang-et-R14B-02.1.el5
erlang-test_server-R14B-02.1.el5
erlang-xmerl-R14B-02.1.el5
erlang-syntax_tools-R14B-02.1.el5
erlang-kernel-R14B-02.1.el5
erlang-compiler-R14B-02.1.el5
erlang-mnesia-R14B-02.1.el5
erlang-tools-R14B-02.1.el5
erlang-debugger-R14B-02.1.el5
erlang-hipe-R14B-02.1.el5


Any ideas?

Cheers

Chris Rode
--------------------------------------------
Headshift  |  Dachis Group
http://www.headshift.com
--------------------------------------------



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110803/ab79d547/attachment.htm>

From ali.ahsan at panasiangroup.com  Wed Aug  3 10:57:37 2011
From: ali.ahsan at panasiangroup.com (Ali Ahsan)
Date: Wed, 03 Aug 2011 14:57:37 +0500
Subject: [rabbitmq-discuss] Installation problems on Centos
In-Reply-To: <C23F3588-096C-4CB1-AC34-B41005F37715@headshift.com>
References: <C23F3588-096C-4CB1-AC34-B41005F37715@headshift.com>
Message-ID: <4E391B91.7030103@panasiangroup.com>

Hi

Install via repo

*Note to users of RHEL 5 and derived distributions (e.g. CentOS 5):* Due 
to the EPEL package update policy 
<http://fedoraproject.org/wiki/EPEL/GuidelinesAndPolicies>, EPEL 5 
contains Erlang version R12B-5, which is relatively old. rabbitmq-server 
supports R12B-5, but performance may be lower than for more recent 
Erlang versions, and certain non-core features are not supported (SSL 
support, HTTP-based plugins). Therefore, we recommend that you install 
the most recent stable version of Erlang. The easiest way to do this is 
to use a package repository provided for this purpose by the owner of 
the EPEL Erlang package. Enable it by invoking (as root):

wget -O /etc/yum.repos.d/epel-erlang.repo http://repos.fedorapeople.org/repos/peter/erlang/epel-erlang.repo

and then install or update erlang with yum install erlang.





On 08/03/2011 02:51 PM, Chris Rode wrote:
> Hi RabbitMQ List
>
> I have been trying to get RabbitMQ up and running on my Centos 
> installation using the installation instuctions for RPM based Linux 
> distro's here http://www.rabbitmq.com/server.html
>
> This all works fine until I try and install the RPM itself using rpm 
> -ivh rabbitmq-server-2.5.1-1.noarch.rpm
>
> This results in the following error:
>
> warning: rabbitmq-server-2.5.1-1.noarch.rpm: Header V4 DSA signature: 
> NOKEY, key ID 056e8e56
> error: Failed dependencies:
> erlang >= R12B-3 is needed by rabbitmq-server-2.5.1-1.noarch
>
> For additional information here is the erlang part of our rpm -qa
>
> $ rpm -qa | grep erlang
> erlang-runtime_tools-R14B-02.1.el5
> erlang-wx-R14B-02.1.el5
> erlang-inets-R14B-02.1.el5
> erlang-snmp-R14B-02.1.el5
> erlang-observer-R14B-02.1.el5
> erlang-common_test-R14B-02.1.el5
> erlang-erts-R14B-02.1.el5
> erlang-stdlib-R14B-02.1.el5
> erlang-crypto-R14B-02.1.el5
> erlang-gs-R14B-02.1.el5
> erlang-public_key-R14B-02.1.el5
> erlang-ssl-R14B-02.1.el5
> erlang-webtool-R14B-02.1.el5
> erlang-sasl-R14B-02.1.el5
> erlang-ssh-R14B-02.1.el5
> erlang-et-R14B-02.1.el5
> erlang-test_server-R14B-02.1.el5
> erlang-xmerl-R14B-02.1.el5
> erlang-syntax_tools-R14B-02.1.el5
> erlang-kernel-R14B-02.1.el5
> erlang-compiler-R14B-02.1.el5
> erlang-mnesia-R14B-02.1.el5
> erlang-tools-R14B-02.1.el5
> erlang-debugger-R14B-02.1.el5
> erlang-hipe-R14B-02.1.el5
>
>
> Any ideas?
>
> Cheers
>
> Chris Rode
> --------------------------------------------
> Headshift  |  Dachis Group
> http://www.headshift.com <http://www.headshift.com/>
> --------------------------------------------
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
S.Ali Ahsan

Senior System Engineer

e-Business (Pvt) Ltd

49-C Jail Road, Lahore, P.O. Box 676
Lahore 54000, Pakistan

Tel: +92 (0)42 3758 7140 Ext. 128

Mobile: +92 (0)345 831 8769

Fax: +92 (0)42 3758 0027

Email: ali.ahsan at panasiangroup.com



www.ebusiness-pg.com

www.panasiangroup.com

Confidentiality: This e-mail and any attachments may be confidential
and/or privileged. If you are not a named recipient, please notify the
sender immediately and do not disclose the contents to another person
use it for any purpose or store or copy the information in any medium.
Internet communications cannot be guaranteed to be timely, secure, error
or virus-free. We do not accept liability for any errors or omissions.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110803/32496357/attachment.htm>

From abhishek.kona at gmail.com  Wed Aug  3 11:15:43 2011
From: abhishek.kona at gmail.com (Abhishek K)
Date: Wed, 3 Aug 2011 15:45:43 +0530
Subject: [rabbitmq-discuss] RabbitMQ Issues -> Losing confidence in it.
In-Reply-To: <CAF3N6oTgy_BLOKwhe_pDHzPt6tvNRFdo1w8w8kQPLNx4s6Loow@mail.gmail.com>
References: <CAGTBvKv+LDMh7TzO2LeuUviMv=fJGgQG-+w2hix4D7-wZzqd=Q@mail.gmail.com>
	<CAF3N6oTgy_BLOKwhe_pDHzPt6tvNRFdo1w8w8kQPLNx4s6Loow@mail.gmail.com>
Message-ID: <CAGTBvKvgABj9YA=knES4Hi_Gi=DNYiJ14mnFmiD1Th-BO+eMvw@mail.gmail.com>

I am running RabbitMQ 2.20 on Debian Lenny (2.6.26).
There was no changes in the code using RabbitMQ, only the usage rate
increased by 20%.

-Abhishek Kona

On Wed, Aug 3, 2011 at 12:39 PM, Allan Kamau <kamauallan at gmail.com> wrote:

> On Tue, Aug 2, 2011 at 5:00 PM, Abhishek K <abhishek.kona at gmail.com>
> wrote:
> > Hi,
> > We have been running a single RabbitMQ instance for 6 months now
> (RabbitMQ
> > 2.2).
> > Off late we observed RabbitMQ was consuming 11G of Memory when the entire
> > queue-size was about 7MB.
> > We decided to do a restart of RabbitMQ (thinking this was a memory leak).
> > On doing a restart of the APP we kept getting restart TIME-OUT without
> any
> > messages in the startup_{err,log).
> > We kept on retrying the restart and after 10minutes RabbitMQ restarted on
> > its own, without any message or log of what went wrong.
> > What was an expected down time of <1min ended up being a down time of 10
> > min.
> > Also it forced our team to frantically set up RabbittMQ on a new machine
> > with all the queues and Exchanges (the original Rabbit came back up in
> the
> > meanwhile).
> > We are trying to analyze why this happened to us. Specifically answer the
> > following questions
> >
> > Why was rabbitmq consuming high amounts of memory? Was it a memory leak?
> Is
> > the memory leak fixed in the later version.
> > Why did rabbitMQ not restart immediately? Why was no message present in
> the
> > log.
> > In situations like these how do we start a new rabbitmq instance
> > automatically with all the queues and preferably data.
> > How do we upgrade to latest Rabbit without any data loss?
> >
> > Any opinions and thoughts on this are welcome.
> > -Abhishek Kona
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
>
> You may want to include specify the OS and version you are running and
> perhaps detail changes you may have made recently that may shed some
> light to the cause of behaviour you are observing.
>
> Allan.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110803/1154887e/attachment.htm>

From arno.puschmann at acodeas.de  Wed Aug  3 11:13:40 2011
From: arno.puschmann at acodeas.de (Arno Puschmann)
Date: Wed, 3 Aug 2011 12:13:40 +0200
Subject: [rabbitmq-discuss] RabbitMQ and Spring
In-Reply-To: <468ecd19-1a84-4b35-934c-b16a1c36c30e@e35g2000yqc.googlegroups.com>
References: <27D6B27DB616654BBEF4DDB8B31EAF916B590E9526@vs-msx01.IT-NG.local>,
	<468ecd19-1a84-4b35-934c-b16a1c36c30e@e35g2000yqc.googlegroups.com>
Message-ID: <27D6B27DB616654BBEF4DDB8B31EAF916B590E9527@vs-msx01.IT-NG.local>

Thanks, this has solved my problem. Now I use the Spring AMQP Version 1.0.0.0RC2 and RabbitClient 2.5.1. But now I have another questions.

Is there a possibility to set the ReplyTimeout for the template.receive function? The template.setReplyTimeout is only for the template.sendAndReceive function. But I need different Queues for sending an receiving. By the way template.sendAndReceive isn't working anyway for me. In addition my Queue is auto-delete and not durable, but it isn't deleted after the last message is read. At the Moment I have something like this.

	Thread.sleep(3000);
	Message message_response = template.receive("somequeue");
	admin.deleteQueue("somequeue", true, true);

The other thing ist the bean defintion. If I declare my Queues, Exchanges and MessageListener with the rabbit-Namespace like this 

<rabbit:queue name="queue1" durable="true" />

My IDE (SpringSource Tool Suite - Eclipse) shows my folliwing error:

Multiple annotations found at this line:
	- schema_reference.4: Failed to read schema document 'http://www.springframework.org/schema/
	 rabbit/spring-rabbit.xsd', because 1) could not find the document; 2) the document could not be read; 3) 
	 the root element of the document is not <xsd:schema>.
	- cvc-complex-type.2.4.c: The matching wildcard is strict, but no declaration can be found for 
	 element 'rabbit:queue'.

My Schema definition:

<beans xmlns="http://www.springframework.org/schema/beans"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:rabbit="http://www.springframework.org/schema/rabbit"
  xmlns:context="http://www.springframework.org/schema/context"
  xmlns:sws="http://www.springframework.org/schema/web-services"
  xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
  http://www.springframework.org/schema/web-services http://www.springframework.org/schema/web-services/web-services-2.0.xsd
  http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd
  http://www.springframework.org/schema/rabbit http://www.springframework.org/schema/rabbit/spring-rabbit.xsd">

I get no compilation error, but these errors are very annoying.

I found this thread but there is not acceptable solution

http://stackoverflow.com/questions/6746014/where-is-the-spring-rabbit-xsd-schema-location-for-the-rabbit-namespace

I tried to copy a xsd to my workspace but in xsd is no possiblity to define a schema file on a relative path.

Have somebody similiar problems?

Thanks.

From darach at gmail.com  Wed Aug  3 11:32:02 2011
From: darach at gmail.com (Darach)
Date: Wed, 3 Aug 2011 03:32:02 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ + CEP
In-Reply-To: <CABzW0g5vsVTc0d3Wnj9G_UM7bLPx0ZENE+n4TqLfKcesEGoX3g@mail.gmail.com>
References: <CABzW0g5vsVTc0d3Wnj9G_UM7bLPx0ZENE+n4TqLfKcesEGoX3g@mail.gmail.com>
Message-ID: <dafd1728-4fc8-4f8d-b5b9-119e1a10cd12@cf8g2000vbb.googlegroups.com>

Hi Cristoforo,

It looks like there is at least one open source project integrating
Esper with RabbitMQ. Esper is typically
embedded so I'd imagine integration is fairly easy if you wish to roll
your own for whatever reason.

I work for a commercial CEP vendor (StreamBase) and we support
RabbitMQ and other AMQP engines via
the RabbitMQ java client API. The source for the adapter (how we
integrate our CEP engine with
the outside world typically) is available on our website and can be
directly installed via a wizard in
the development environment.

http://www.streambase.com/sbx.htm

http://download.streambase.com/components/SB_SimpleRabbitMQ-1.0.zip

So feel free to use/adapt some of the source, integrate it with
another
CEP or, hell, you could download our product and play with that too
while you're at it!

Cheers,

Darach.

On Jul 29, 12:05?pm, Cristoforo Seccia <cristofer.sec... at gmail.com>
wrote:
> Hi All,
> is there anyone who has used or is using RabbitMQ in conjunction with a CEP
> engine, for example Esper. I know this should not be a problem but I can't
> find (at least googling does not help me) any information or useful tips on
> how to implement this kind of stuff. Thanks in advance. Cris.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From rmartele at gmail.com  Wed Aug  3 12:39:51 2011
From: rmartele at gmail.com (Renaud)
Date: Wed, 3 Aug 2011 04:39:51 -0700 (PDT)
Subject: [rabbitmq-discuss] =?utf-8?q?Re=C2=A0=3A_Re=3A__Connection_closed?=
 =?utf-8?q?_after_10_minutes=2E_Cause_=3A_end-of-stream?=
In-Reply-To: <93f4e0c5-bcd0-4f8f-a6fb-ed590ff7c9f0@gv8g2000vbb.googlegroups.com>
References: <ed37b4c6-8832-49e8-8761-f2da5e076973@y13g2000yqy.googlegroups.com>
	<20110728155121.GH28034@rabbitmq.com>
	<93f4e0c5-bcd0-4f8f-a6fb-ed590ff7c9f0@gv8g2000vbb.googlegroups.com>
Message-ID: <20218733.113.1312371591232.JavaMail.geo-discussion-forums@yqcj24>

Here are two diagrams that will maybe help you.

The first shows the case where, after 10 minutes, the connection between 
.NET client and RabbitMQ Server closes itself :
(the error stack appears in the .NET client console and specifies that the 
client closed the connection)

<https://lh3.googleusercontent.com/-OSowocu09QI/Tjkvsih77tI/AAAAAAAAADE/rpVSq3AXXfU/view1.png>


The second diagram shows an other test that works fine, without the 
constraint of 10 minutes :

<https://lh4.googleusercontent.com/-Wkr6rKokgo0/TjkxHYbtO3I/AAAAAAAAADI/TRYW7tMKQ00/view2.png>
So, if it was a firewall problem, I think the second test wouldn't work.
I also precise that ".NET client" from the first diagram, is not the same as 
".NET client 1" and ".NET client 2" from the second diagram. But, it 
establishes the connection exactly the same way...
Would the problem come from the Java clients?
Java clients doesn't seem to be affected by this closure of connection after 
10 minutes.

Thanks for any help!

Renaud
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110803/e2c8088a/attachment.htm>

From emile at rabbitmq.com  Wed Aug  3 12:51:10 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 03 Aug 2011 12:51:10 +0100
Subject: [rabbitmq-discuss] RabbitMQ Issues -> Losing confidence in it.
In-Reply-To: <CAGTBvKvgABj9YA=knES4Hi_Gi=DNYiJ14mnFmiD1Th-BO+eMvw@mail.gmail.com>
References: <CAGTBvKv+LDMh7TzO2LeuUviMv=fJGgQG-+w2hix4D7-wZzqd=Q@mail.gmail.com>	<CAF3N6oTgy_BLOKwhe_pDHzPt6tvNRFdo1w8w8kQPLNx4s6Loow@mail.gmail.com>
	<CAGTBvKvgABj9YA=knES4Hi_Gi=DNYiJ14mnFmiD1Th-BO+eMvw@mail.gmail.com>
Message-ID: <4E39362E.1040409@rabbitmq.com>

Hi Abhishek,

On 03/08/11 11:15, Abhishek K wrote:
> I am running RabbitMQ 2.20 on Debian Lenny (2.6.26).
> There was no changes in the code using RabbitMQ, only the usage rate
> increased by 20%.

You don't mention the version of Erlang you use. It is worth bearing in
mind that later versions of Erlang do better garbage collection. Also,
how much RAM is installed on the server? You should generally expect
that Erlang / RabbitMQ will use as much RAM as it can.

You said that the broker uses 11GB RAM and that the queue size was 7MB -
how were these figures determined? If that 7MB is distributed across a
large number of queues then that is a possible explanation for the high
memory usage. If the startup after a clean  shutdown takes an inordinate
amount of time then you might have more than 7MB worth of messages on
the broker.

You should also inspect the results from running all the "rabbitmqctl
list_*" commands to make sure your application isn't using up too many
resources (e.g. queues or exchanges) on the broker.

RabbitMQ version 2.5.1 adds more memory reporting features to the
"rabbitmqctl status" command, with a breakdown of where memory is being
used. This is not available on version 2.2.0, but it is another possible
reason to upgrade.



Regards

Emile

From ekirpichov at gmail.com  Wed Aug  3 13:20:57 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Wed, 3 Aug 2011 16:20:57 +0400
Subject: [rabbitmq-discuss] Unable to join cluster: "Bad cookie in table
	definition rabbit_queue"
Message-ID: <CANVKUrW8T2fk4V62Ythh5aNbt_YR8QAZ=1EraA8ZNjd5nf-HTQ@mail.gmail.com>

Hey.

I got the following error today: I was changing the composition of a
4-node RabbitMQ cluster (it was on nodes A,B,C,D and became B,C,D,E).
I killed rabbitmq on nodes B,C,D (forgot to kill it on A) and followed
the cluster start procedure on B,C,D,E (stop_app, reset, cluster all
to B, start_app).

Is this expected behavior in such a scenario?
Would the right way to avoid it be "kill on A before starting B,C,D,E cluster"?

=INFO REPORT==== 3-Aug-2011::04:50:23 ===
Limiting to approx 924 file handles (829 sockets)

=ERROR REPORT==== 3-Aug-2011::04:50:23 ===
Mnesia(rabbit at RACK2UNIT002): ** ERROR ** mnesia_event got
{inconsistent_database, running_partitioned_network,
rabbit at RACK2UNIT001}

=ERROR REPORT==== 3-Aug-2011::04:50:23 ===
Mnesia(rabbit at RACK2UNIT002): ** ERROR ** mnesia_event got
{inconsistent_database, starting_partitioned_network,
rabbit at RACK2UNIT001}

=ERROR REPORT==== 3-Aug-2011::04:50:23 ===
FAILED
Reason: {error,
            {unable_to_join_cluster,
                [rabbit at RACK2UNIT002,rabbit at RACK2UNIT001],
                {merge_schema_failed,
                    "Bad cookie in table definition rabbit_queue:
rabbit at RACK2UNIT002 =
{cstruct,rabbit_queue,set,[rabbit at RACK2UNIT002],[],[],0,read_write,[],[],false,amqqueue,[name,durable,auto_delete,exclusive_owner,arguments,pid],[],[],{{1312,371791,515002},rabbit at RACK2UNIT001},{{3,1},{rabbit at RACK2UNIT002,{1312,372070,234006}}}},
rabbit at RACK2UNIT001 =
{cstruct,rabbit_queue,set,[rabbit at RACK2UNIT004,rabbit at RACK2UNIT003,rabbit at RACK2UNIT001],[],[],0,read_write,[],[],false,amqqueue,[name,durable,auto_delete,exclusive_owner,arguments,pid],[],[],{{1312,372061,609002},rabbit at RACK2UNIT001},{{3,2},{rabbit at RACK2UNIT003,{1312,372100,781007}}}}\n"}}}
Stacktrace: [{rabbit_mnesia,init_db,3},
             {rabbit_mnesia,init,0},
             {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
             {rabbit,run_boot_step,1},
             {rabbit,'-start/2-lc$^0/1-0-',1},
             {rabbit,start,2},
             {application_master,start_it_old,4}]

=INFO REPORT==== 3-Aug-2011::04:50:24 ===
    application: rabbit
    exited: {bad_return,{{rabbit,start,[normal,[]]},
                         {'EXIT',{rabbit,failure_during_boot}}}}
    type: permanent

-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/

From alexandru at rabbitmq.com  Wed Aug  3 13:34:17 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Wed, 3 Aug 2011 13:34:17 +0100
Subject: [rabbitmq-discuss] Unable to join cluster: "Bad cookie in table
 definition rabbit_queue"
In-Reply-To: <CANVKUrW8T2fk4V62Ythh5aNbt_YR8QAZ=1EraA8ZNjd5nf-HTQ@mail.gmail.com>
References: <CANVKUrW8T2fk4V62Ythh5aNbt_YR8QAZ=1EraA8ZNjd5nf-HTQ@mail.gmail.com>
Message-ID: <20110803123417.GB2906@dakota.eng.vmware.com>

Hi,

As a rule, if you're breaking up a cluster completely, you need to reset
all nodes.  Otherwise, some nodes may still think they're in the cluster
and contact the nodes that aren't, leading to strange situations.

> (it was on nodes A,B,C,D and became B,C,D,E).
> I killed rabbitmq on nodes B,C,D (forgot to kill it on A) and followed
> the cluster start procedure on B,C,D,E (stop_app, reset, cluster all
> to B, start_app).

Reseting each of B, C, D should have been enough to inform A that they
have left the cluster, but getting the order of the commands even a bit
wrong might have led to your situation.

You were going from A, B, C, D to B, C, D, E.  If you wanted to destroy
the first cluster completely and create a new one reusing some of the
old machines, you should have "stop_app, reset, start_app" on each of
the original machines (maybe force_resetting the last one) and then run
the your commands to set up the new cluster.

If you just wanted to remove A and add E (i.e. keep the cluster but
change the machines in it), it should have been enough to "stop_app,
reset, start_app" on A and "stop_app, reset, cluster, start_app" on E.

> the cluster start procedure on B,C,D,E (stop_app, reset, cluster all
> to B, start_app).

If B is the only disc node, you should be able to break the cluster by
stopping all the other nodes and resetting B.

Hope this clears things up.

Cheers,
Alex

On Wed, Aug 03, 2011 at 04:20:57PM +0400, Eugene Kirpichov wrote:
> Hey.
> 
> I got the following error today: I was changing the composition of a
> 4-node RabbitMQ cluster (it was on nodes A,B,C,D and became B,C,D,E).
> I killed rabbitmq on nodes B,C,D (forgot to kill it on A) and followed
> the cluster start procedure on B,C,D,E (stop_app, reset, cluster all
> to B, start_app).
> 
> Is this expected behavior in such a scenario?
> Would the right way to avoid it be "kill on A before starting B,C,D,E cluster"?
> 
> =INFO REPORT==== 3-Aug-2011::04:50:23 ===
> Limiting to approx 924 file handles (829 sockets)
> 
> =ERROR REPORT==== 3-Aug-2011::04:50:23 ===
> Mnesia(rabbit at RACK2UNIT002): ** ERROR ** mnesia_event got
> {inconsistent_database, running_partitioned_network,
> rabbit at RACK2UNIT001}
> 
> =ERROR REPORT==== 3-Aug-2011::04:50:23 ===
> Mnesia(rabbit at RACK2UNIT002): ** ERROR ** mnesia_event got
> {inconsistent_database, starting_partitioned_network,
> rabbit at RACK2UNIT001}
> 
> =ERROR REPORT==== 3-Aug-2011::04:50:23 ===
> FAILED
> Reason: {error,
>             {unable_to_join_cluster,
>                 [rabbit at RACK2UNIT002,rabbit at RACK2UNIT001],
>                 {merge_schema_failed,
>                     "Bad cookie in table definition rabbit_queue:
> rabbit at RACK2UNIT002 =
> {cstruct,rabbit_queue,set,[rabbit at RACK2UNIT002],[],[],0,read_write,[],[],false,amqqueue,[name,durable,auto_delete,exclusive_owner,arguments,pid],[],[],{{1312,371791,515002},rabbit at RACK2UNIT001},{{3,1},{rabbit at RACK2UNIT002,{1312,372070,234006}}}},
> rabbit at RACK2UNIT001 =
> {cstruct,rabbit_queue,set,[rabbit at RACK2UNIT004,rabbit at RACK2UNIT003,rabbit at RACK2UNIT001],[],[],0,read_write,[],[],false,amqqueue,[name,durable,auto_delete,exclusive_owner,arguments,pid],[],[],{{1312,372061,609002},rabbit at RACK2UNIT001},{{3,2},{rabbit at RACK2UNIT003,{1312,372100,781007}}}}\n"}}}
> Stacktrace: [{rabbit_mnesia,init_db,3},
>              {rabbit_mnesia,init,0},
>              {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
>              {rabbit,run_boot_step,1},
>              {rabbit,'-start/2-lc$^0/1-0-',1},
>              {rabbit,start,2},
>              {application_master,start_it_old,4}]
> 
> =INFO REPORT==== 3-Aug-2011::04:50:24 ===
>     application: rabbit
>     exited: {bad_return,{{rabbit,start,[normal,[]]},
>                          {'EXIT',{rabbit,failure_during_boot}}}}
>     type: permanent
> 
> -- 
> Eugene Kirpichov
> Principal Engineer, Mirantis Inc. http://www.mirantis.com/
> Editor, http://fprog.ru/
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From michael.s.klishin at gmail.com  Wed Aug  3 15:43:41 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 3 Aug 2011 18:43:41 +0400
Subject: [rabbitmq-discuss] A few questions about custom
	rabbit_msg_store_index implementations
Message-ID: <CAE3HoVSpxNvrHVDY39OB0NAxat0-c=1kt+Lt2x+k1wCx1dURiw@mail.gmail.com>

Hi,

I am looking at implementing my own rabbit_msg_store_index that would use
Redis (probably with JSON serialization
of Erlang data types, I need basic queue inspection capabilities and don't
care much about performance degradation compared to
raw ETS).

My first question is, could someone from the rabbitmq team briefly explain
when each of the functions is used? insert and delete
are pretty self-explanatory but some others are not. This is what I am
referring to:

behaviour_info(callbacks) ->
    [{new,            1},
     {recover,        1},
     {lookup,         2},
     {insert,         2},
     {update,         2},
     {update_fields,  3},
     {delete,         2},
     {delete_by_file, 2},
     {terminate,      1}];


My 2nd question is: I see that rabbit_app.in instructs rabbit to use ETS
implementation. Does it mean that in order to use Redis backend I'd have
to build rabbit from source and build my own .deb packages? or is there a
way to do this from a "regular" dynamically loaded plugin?

Thank you.

-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110803/33dc15d4/attachment.htm>

From alexandru at rabbitmq.com  Wed Aug  3 17:31:48 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Wed, 3 Aug 2011 17:31:48 +0100
Subject: [rabbitmq-discuss] Error while connect to rabbitmq using
 rabbitmq-erlang-client library
In-Reply-To: <CAPnrV9_XPKqRnn9RHdf0=UerCJ71nT1mfD5gJ0iW_dk=z0WygQ@mail.gmail.com>
References: <CAPnrV9_EfM-r7XGA=mJfsT1JB8u6ptvX-Pp8BwQEoziuZkNEHg@mail.gmail.com>
	<20110802140912.GA25255@dakota.eng.vmware.com>
	<CAPnrV9_XPKqRnn9RHdf0=UerCJ71nT1mfD5gJ0iW_dk=z0WygQ@mail.gmail.com>
Message-ID: <20110803163148.GC2906@dakota.eng.vmware.com>

I'm having no luck in reproducing this.  It works fine on a freshly
install Ubuntu 10.04 x64 (so you may want to try it on a fresh machine
just to see if the problem goes away).

If you're up for a bit of debugging, could you: start up the Erlang
client with "make run", run the example, run and copy-paste the output
of "erlang:memory().".

Could you try the Java client to see if the problem is caused by the
Erlang client?
  wget 'http://www.rabbitmq.com/releases/rabbitmq-java-client/v2.5.1/rabbitmq-java-client-bin-2.5.1.tar.gz'
  tar xzvf rabbitmq-java-client-bin-2.5.1.tar.gz
  cd rabbitmq-java-client-bin-2.5.1
  sh runjava.sh com.rabbitmq.examples.MulticastMain -h localhost
That will run a simple program that publishes and consumes messages.

Also, you may want to try a different version of Erlang (maybe the 13b03
shipped with 10.04? Or a 14b03 but without SMP and hipe?).

Is the server running on the same machine?  If not, is there a firewall
of some sort between the client and the server?

Alex

On Wed, Aug 03, 2011 at 11:31:27AM +0800, Fisher Yu wrote:
> 2011/8/2 Alexandru Scvor?ov <alexandru at rabbitmq.com>
> 
> > Hi,
> >
> > > ** Reason for termination ==
> > > ** {{badmatch,{error,enomem}},
> > >     [{amqp_main_reader,handle_inet_async,2},
> > >      {gen_server,handle_msg,5},
> > >      {proc_lib,init_p_do_apply,3}]}
> >
> > Strictly speaking, that means you've run out of memory.  Not sure how
> > that could happen, though.
> >
> > There's an error in your example:
> >
> > >         Get = #'basic.get'{queue = Queue},
> >
> > should be
> >
> > >         Get = #'basic.get'{queue = list_to_binary(Queue)},
> >
> > Actually, you'd probably be better off converting Queue to a binary from
> > the start.
> >
> 
> Changed this, thanks.
> 
> 
> >
> > Still, the failure is during the initial handshake, so that can't be the
> > cause.
> >
> > Have a look in the server logs: is there a matching error?  Is there any
> > mention
> > of the memory alarms being set off?
> >
> 
> There is nothing happening in the server logs, at least nothing being
> raised.  There is 24G RAM in here, with about 4G active and 11G free at the
> time of testing.
> 
> 
> 
> >
> > What OS are you using?  What version of Erlang?  Is there anything
> > special about the system's configuration?  Is it under heavy load?
> >
> 
> 
> The distribution is Ubuntu 10.04,
> uname -a
> Linux fs21 2.6.32-31-generic #61-Ubuntu SMP Fri Apr 8 18:25:51 UTC 2011
> x86_64 GNU/Linux
> 
> Erlang version
> Erlang R14B03 (erts-5.8.4) [source] [64-bit] [smp:24:24] [rq:24]
> [async-threads:0] [kernel-poll:false]
> 
> This machine is almost completely idle at the moment as it's a development
> server.  There is nothing special for the configuration.
> 
> 
> >
> > >   I kept get error message while connect to rabbitmq server using
> > > rabbitmq-erlang-client library. Anyone can help, thanks.
> >
> > Does this mean you *always* get this error?  Or only occasionally?
> >
> 
> Every time the test case is run, this error is produced.
> 
> 
> >
> > Cheers,
> > Alex
> >
> > On Tue, Aug 02, 2011 at 09:43:46PM +0800, Fisher Yu wrote:
> > > Hi
> > >
> > >   I kept get error message while connect to rabbitmq server using
> > > rabbitmq-erlang-client library. Anyone can help, thanks.
> > >
> > > Erlang R14B03 (erts-5.8.4) [source] [64-bit] [smp:24:24] [rq:24]
> > > [async-threads:0] [kernel-poll:false]
> > > Eshell V5.8.4  (abort with ^G)
> > > 1> test:start().
> > > =ERROR REPORT==== 2-Aug-2011::08:40:18 ===
> > > ** Generic server <0.46.0> terminating
> > > ** Last message in was
> > > {inet_async,#Port<0.1109>,1,{ok,<<65,77,81,80,1,1,8>>}}
> > > ** When Server state == {state,#Port<0.1109>,<0.39.0>,<0.41.0>,
> > >                                {method,rabbit_framing_amqp_0_9_1},
> > >                                none}
> > > ** Reason for termination ==
> > > ** {{badmatch,{error,enomem}},
> > >     [{amqp_main_reader,handle_inet_async,2},
> > >      {gen_server,handle_msg,5},
> > >      {proc_lib,init_p_do_apply,3}]}
> > >
> > >
> > >
> > > %%test.erl
> > >
> > > -module(test).
> > > -include_lib("amqp_client/include/amqp_client.hrl").
> > > -compile(export_all).
> > > start() ->
> > >         {ok, Connection} =
> > > amqp_connection:start(#amqp_params_network{username= <<"myuser">>,
> > password=
> > > <<"mypassword">>}),
> > >         {ok, Channel} = amqp_connection:open_channel(Connection),
> > >         Queue = "my_queue",
> > >         Declare = #'queue.declare'{queue = list_to_binary(Queue),
> > > durable=true},
> > >         #'queue.declare_ok'{} = amqp_channel:call(Channel, Declare),
> > >         Get = #'basic.get'{queue = Queue},
> > >         {#'basic.get_ok'{delivery_tag = Tag}, Content}
> > >                        = amqp_channel:call(Channel, Get),
> > >         io:format("received message ~p", [Content]),
> > >         %% Close the channel
> > >         amqp_channel:close(Channel),
> > >         %% Close the connection
> > >         amqp_connection:close(Connection),
> > >         ok.
> >
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-discuss at lists.rabbitmq.com
> > > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >

From alexandru at rabbitmq.com  Wed Aug  3 17:57:17 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Wed, 3 Aug 2011 17:57:17 +0100
Subject: [rabbitmq-discuss] Error while connect to rabbitmq using
 rabbitmq-erlang-client library
In-Reply-To: <CAPnrV9_XPKqRnn9RHdf0=UerCJ71nT1mfD5gJ0iW_dk=z0WygQ@mail.gmail.com>
References: <CAPnrV9_EfM-r7XGA=mJfsT1JB8u6ptvX-Pp8BwQEoziuZkNEHg@mail.gmail.com>
	<20110802140912.GA25255@dakota.eng.vmware.com>
	<CAPnrV9_XPKqRnn9RHdf0=UerCJ71nT1mfD5gJ0iW_dk=z0WygQ@mail.gmail.com>
Message-ID: <20110803165717.GE2906@dakota.eng.vmware.com>

Also, could you please post the output of:
$ ulimit -a

Alex

On Wed, Aug 03, 2011 at 11:31:27AM +0800, Fisher Yu wrote:
> 2011/8/2 Alexandru Scvor?ov <alexandru at rabbitmq.com>
> 
> > Hi,
> >
> > > ** Reason for termination ==
> > > ** {{badmatch,{error,enomem}},
> > >     [{amqp_main_reader,handle_inet_async,2},
> > >      {gen_server,handle_msg,5},
> > >      {proc_lib,init_p_do_apply,3}]}
> >
> > Strictly speaking, that means you've run out of memory.  Not sure how
> > that could happen, though.
> >
> > There's an error in your example:
> >
> > >         Get = #'basic.get'{queue = Queue},
> >
> > should be
> >
> > >         Get = #'basic.get'{queue = list_to_binary(Queue)},
> >
> > Actually, you'd probably be better off converting Queue to a binary from
> > the start.
> >
> 
> Changed this, thanks.
> 
> 
> >
> > Still, the failure is during the initial handshake, so that can't be the
> > cause.
> >
> > Have a look in the server logs: is there a matching error?  Is there any
> > mention
> > of the memory alarms being set off?
> >
> 
> There is nothing happening in the server logs, at least nothing being
> raised.  There is 24G RAM in here, with about 4G active and 11G free at the
> time of testing.
> 
> 
> 
> >
> > What OS are you using?  What version of Erlang?  Is there anything
> > special about the system's configuration?  Is it under heavy load?
> >
> 
> 
> The distribution is Ubuntu 10.04,
> uname -a
> Linux fs21 2.6.32-31-generic #61-Ubuntu SMP Fri Apr 8 18:25:51 UTC 2011
> x86_64 GNU/Linux
> 
> Erlang version
> Erlang R14B03 (erts-5.8.4) [source] [64-bit] [smp:24:24] [rq:24]
> [async-threads:0] [kernel-poll:false]
> 
> This machine is almost completely idle at the moment as it's a development
> server.  There is nothing special for the configuration.
> 
> 
> >
> > >   I kept get error message while connect to rabbitmq server using
> > > rabbitmq-erlang-client library. Anyone can help, thanks.
> >
> > Does this mean you *always* get this error?  Or only occasionally?
> >
> 
> Every time the test case is run, this error is produced.
> 
> 
> >
> > Cheers,
> > Alex
> >
> > On Tue, Aug 02, 2011 at 09:43:46PM +0800, Fisher Yu wrote:
> > > Hi
> > >
> > >   I kept get error message while connect to rabbitmq server using
> > > rabbitmq-erlang-client library. Anyone can help, thanks.
> > >
> > > Erlang R14B03 (erts-5.8.4) [source] [64-bit] [smp:24:24] [rq:24]
> > > [async-threads:0] [kernel-poll:false]
> > > Eshell V5.8.4  (abort with ^G)
> > > 1> test:start().
> > > =ERROR REPORT==== 2-Aug-2011::08:40:18 ===
> > > ** Generic server <0.46.0> terminating
> > > ** Last message in was
> > > {inet_async,#Port<0.1109>,1,{ok,<<65,77,81,80,1,1,8>>}}
> > > ** When Server state == {state,#Port<0.1109>,<0.39.0>,<0.41.0>,
> > >                                {method,rabbit_framing_amqp_0_9_1},
> > >                                none}
> > > ** Reason for termination ==
> > > ** {{badmatch,{error,enomem}},
> > >     [{amqp_main_reader,handle_inet_async,2},
> > >      {gen_server,handle_msg,5},
> > >      {proc_lib,init_p_do_apply,3}]}
> > >
> > >
> > >
> > > %%test.erl
> > >
> > > -module(test).
> > > -include_lib("amqp_client/include/amqp_client.hrl").
> > > -compile(export_all).
> > > start() ->
> > >         {ok, Connection} =
> > > amqp_connection:start(#amqp_params_network{username= <<"myuser">>,
> > password=
> > > <<"mypassword">>}),
> > >         {ok, Channel} = amqp_connection:open_channel(Connection),
> > >         Queue = "my_queue",
> > >         Declare = #'queue.declare'{queue = list_to_binary(Queue),
> > > durable=true},
> > >         #'queue.declare_ok'{} = amqp_channel:call(Channel, Declare),
> > >         Get = #'basic.get'{queue = Queue},
> > >         {#'basic.get_ok'{delivery_tag = Tag}, Content}
> > >                        = amqp_channel:call(Channel, Get),
> > >         io:format("received message ~p", [Content]),
> > >         %% Close the channel
> > >         amqp_channel:close(Channel),
> > >         %% Close the connection
> > >         amqp_connection:close(Connection),
> > >         ok.
> >
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-discuss at lists.rabbitmq.com
> > > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >

From abhishek.kona at gmail.com  Wed Aug  3 18:17:41 2011
From: abhishek.kona at gmail.com (Abhishek K)
Date: Wed, 3 Aug 2011 22:47:41 +0530
Subject: [rabbitmq-discuss] RabbitMQ Issues -> Losing confidence in it.
In-Reply-To: <4E39362E.1040409@rabbitmq.com>
References: <CAGTBvKv+LDMh7TzO2LeuUviMv=fJGgQG-+w2hix4D7-wZzqd=Q@mail.gmail.com>
	<CAF3N6oTgy_BLOKwhe_pDHzPt6tvNRFdo1w8w8kQPLNx4s6Loow@mail.gmail.com>
	<CAGTBvKvgABj9YA=knES4Hi_Gi=DNYiJ14mnFmiD1Th-BO+eMvw@mail.gmail.com>
	<4E39362E.1040409@rabbitmq.com>
Message-ID: <CAGTBvKttZhiWSX3a=xCVtbOKB3cicdQ5CZLFvS7BV7TmXLCeuA@mail.gmail.com>

I am using Erlang R12B. The server had around 20GB of Ram.

There were around 30 queues on the server with the total memory consumption
calculated with
$ rabbitmqctl list_queues name memory

-Abhishek Kona

Abhishek Kona
Department of Computer Engineering
National Institute of Technology
Karnataka, India


On Wed, Aug 3, 2011 at 5:21 PM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi Abhishek,
>
> On 03/08/11 11:15, Abhishek K wrote:
> > I am running RabbitMQ 2.20 on Debian Lenny (2.6.26).
> > There was no changes in the code using RabbitMQ, only the usage rate
> > increased by 20%.
>
> You don't mention the version of Erlang you use. It is worth bearing in
> mind that later versions of Erlang do better garbage collection. Also,
> how much RAM is installed on the server? You should generally expect
> that Erlang / RabbitMQ will use as much RAM as it can.
>
> You said that the broker uses 11GB RAM and that the queue size was 7MB -
> how were these figures determined? If that 7MB is distributed across a
> large number of queues then that is a possible explanation for the high
> memory usage. If the startup after a clean  shutdown takes an inordinate
> amount of time then you might have more than 7MB worth of messages on
> the broker.
>
> You should also inspect the results from running all the "rabbitmqctl
> list_*" commands to make sure your application isn't using up too many
> resources (e.g. queues or exchanges) on the broker.
>
> RabbitMQ version 2.5.1 adds more memory reporting features to the
> "rabbitmqctl status" command, with a breakdown of where memory is being
> used. This is not available on version 2.2.0, but it is another possible
> reason to upgrade.
>
>
>
> Regards
>
> Emile
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110803/1611660b/attachment.htm>

From jasonjwwilliams at gmail.com  Wed Aug  3 18:25:31 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Wed, 3 Aug 2011 11:25:31 -0600
Subject: [rabbitmq-discuss] RabbitMQ Issues -> Losing confidence in it.
In-Reply-To: <CAGTBvKttZhiWSX3a=xCVtbOKB3cicdQ5CZLFvS7BV7TmXLCeuA@mail.gmail.com>
References: <CAGTBvKv+LDMh7TzO2LeuUviMv=fJGgQG-+w2hix4D7-wZzqd=Q@mail.gmail.com>
	<CAF3N6oTgy_BLOKwhe_pDHzPt6tvNRFdo1w8w8kQPLNx4s6Loow@mail.gmail.com>
	<CAGTBvKvgABj9YA=knES4Hi_Gi=DNYiJ14mnFmiD1Th-BO+eMvw@mail.gmail.com>
	<4E39362E.1040409@rabbitmq.com>
	<CAGTBvKttZhiWSX3a=xCVtbOKB3cicdQ5CZLFvS7BV7TmXLCeuA@mail.gmail.com>
Message-ID: <CAHZAEpdCYpkYqiZFgzNPtg3HRFN3RFuP-=JdTho6fc8DTg584Q@mail.gmail.com>

What was the configuration of the exchanges (type), queues (type and
flags) and bindings? Also were the queues long-lived or are they being
created and destroyed constantly?

-J

On Wed, Aug 3, 2011 at 11:17 AM, Abhishek K <abhishek.kona at gmail.com> wrote:
> I am using Erlang R12B. The server had around 20GB of Ram.
> There were around 30 queues on the server with the total memory consumption
> calculated with
> $ rabbitmqctl list_queues name memory
> -Abhishek Kona
>
> Abhishek Kona
> Department of Computer Engineering
> National Institute of Technology
> Karnataka, India
>
>
> On Wed, Aug 3, 2011 at 5:21 PM, Emile Joubert <emile at rabbitmq.com> wrote:
>>
>> Hi Abhishek,
>>
>> On 03/08/11 11:15, Abhishek K wrote:
>> > I am running RabbitMQ 2.20 on Debian Lenny (2.6.26).
>> > There was no changes in the code using RabbitMQ, only the usage rate
>> > increased by 20%.
>>
>> You don't mention the version of Erlang you use. It is worth bearing in
>> mind that later versions of Erlang do better garbage collection. Also,
>> how much RAM is installed on the server? You should generally expect
>> that Erlang / RabbitMQ will use as much RAM as it can.
>>
>> You said that the broker uses 11GB RAM and that the queue size was 7MB -
>> how were these figures determined? If that 7MB is distributed across a
>> large number of queues then that is a possible explanation for the high
>> memory usage. If the startup after a clean ?shutdown takes an inordinate
>> amount of time then you might have more than 7MB worth of messages on
>> the broker.
>>
>> You should also inspect the results from running all the "rabbitmqctl
>> list_*" commands to make sure your application isn't using up too many
>> resources (e.g. queues or exchanges) on the broker.
>>
>> RabbitMQ version 2.5.1 adds more memory reporting features to the
>> "rabbitmqctl status" command, with a breakdown of where memory is being
>> used. This is not available on version 2.2.0, but it is another possible
>> reason to upgrade.
>>
>>
>>
>> Regards
>>
>> Emile
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From michael.s.klishin at gmail.com  Wed Aug  3 21:13:57 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 4 Aug 2011 00:13:57 +0400
Subject: [rabbitmq-discuss] A few questions about custom
	rabbit_msg_store_index implementations
In-Reply-To: <CAE3HoVSpxNvrHVDY39OB0NAxat0-c=1kt+Lt2x+k1wCx1dURiw@mail.gmail.com>
References: <CAE3HoVSpxNvrHVDY39OB0NAxat0-c=1kt+Lt2x+k1wCx1dURiw@mail.gmail.com>
Message-ID: <CAE3HoVTMEsjbvFBTVXONupURbNpUam-jqvzdkSwpgrYGV2kbcA@mail.gmail.com>

2011/8/3 Michael Klishin <michael.s.klishin at gmail.com>

>
> My 2nd question is: I see that rabbit_app.in instructs rabbit to use ETS
> implementation. Does it mean that in order to use Redis backend I'd have
> to build rabbit from source and build my own .deb packages? or is there a
> way to do this from a "regular" dynamically loaded plugin?


Answering this part myself: it can be set in the config file:
http://www.rabbitmq.com/configure.html#configuration-file

-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110804/8903ac12/attachment.htm>

From pdezwart at rubiconproject.com  Thu Aug  4 01:08:07 2011
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Wed, 3 Aug 2011 19:08:07 -0500
Subject: [rabbitmq-discuss] Queuing fundamentals.
In-Reply-To: <CANVKUrVUyXvSHxQe+ZPj5B4r4=aMHFrP2NGnvdMug=bMb-PvcQ@mail.gmail.com>
Message-ID: <CA5F30D2.1D42A%pdezwart@rubiconproject.com>

I don?t actually think we support pre-fetch. If it is in the rabbitmq-c
library, then we can support it relatively easily. Andrew, can you please
file a bug and I will see if we can address this quickly.
me 







On 8/2/11 2:04 AM, "Eugene Kirpichov" <ekirpichov at gmail.com> wrote:

>Hi,
>
>I'm not sure how to set the prefetch size with the PHP library, and I
>don't know whether the 'min' and 'max' parameters are related to it.
>I believe that in theory, your scenario should work as you wished, if
>you set prefetch to 1. It did for me at least, with the .NET client.
>
>2011/8/1 Andrew <aph at repido.co.uk>:
>> Hi Eugene ,
>>
>> My code is written in PHP and is using the PHP AMQP library (http://
>> www.php.net/manual/en/book.amqp.php) and in my calls to the consume()
>> method I am setting parameters that specify a minimum delivery of zero
>> messages and a maximum of one. This I had hoped would just get one
>> message from the queue at a time for me to process.
>>
>> Certainly what you suggest would explain the behaviour so perhaps my
>> understanding of the parameters to the consume() method is wrong.
>>
>> Do you think that what I am trying to achieve should in theory work?
>> If so, what should happen to message 3 after it's failed ACK? i.e.
>> should my next request to the queue retrieve it, or will it always be
>> delivered out of sequence after a failed ACK? If the latter is the
>> case, how do I achieve ordered delivery of my messages even when my
>> consume process dies and restarts?
>>
>> Thanks,
>> Andrew
>>
>> On Aug 1, 5:41 pm, Eugene Kirpichov <ekirpic... at gmail.com> wrote:
>>> I suppose that you haven't set the prefetch count to 1.
>>>
>>> So in fact you had messages 3,4,5,6 all delivered to you (so thought
>>> the broker) and when the consumer died, the broker requeued all of
>>> them in no particular sequence.
>>>
>>> 2011/8/1 Andrew <a... at repido.co.uk>:
>>>
>>>
>>>
>>>
>>>
>>>
>>>
>>>
>>>
>>> > Hi everybody,
>>>
>>> > I wondered if somebody might be able to clarify some behaviour for me
>>> > as I am getting confused about whether the scenario I am experiencing
>>> > is due to a lack of understanding of how RabbitMQ works or something
>>> > else.
>>>
>>> > I have one reader process which may die due to system failure and at
>>> > restart I'd like the same single consumer process to start up again
>>> > and pick up where it left off. So a summary of what I'd like to
>>>happen
>>> > is:
>>>
>>> > (1) My transmitter process sends and queues up messages 1, 2, 3, 4, 5
>>> > & 6.
>>> > (2) My single consumer process reads and acknowledges messages 1 and
>>>2
>>> > in sequence.
>>> > (3) My consumer process reads message 3 and then dies without
>>> > acknowledging.
>>> > (4) I restart my consumer process which will request the next
>>>message,
>>> > which should be the unacknowledged message (3).
>>> > (5) My consumer process would then continue reading messages from the
>>> > queue (4, 5, & 6) in sequence.
>>>
>>> > What I am experiencing is that when my consumer process is restarted
>>> > messages 3, 4, 5 & 6 are delivered out of sequence and all with a
>>> > redelivery count of 1. I understand that message 3 might be out of
>>> > sequence because it was unacknowledged and from what I have read,
>>>when
>>> > a message is redelivered then it's sequence is no longer guaranteed.
>>> > However I'm not clear as to why the remaining queued messages are out
>>> > of sequence too.
>>>
>>> > More importantly is what I am trying to do is something that is
>>> > contrary to how RabbitMQ works, or am I just going about it the wrong
>>> > way?
>>>
>>> > Many thanks for your help,
>>> > Andrew
>>>
>>> > _______________________________________________
>>> > rabbitmq-discuss mailing list
>>> > rabbitmq-disc... at lists.rabbitmq.com
>>> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>> --
>>> Eugene Kirpichov
>>> Principal Engineer, Mirantis Inc.http://www.mirantis.com/
>>> Editor,http://fprog.ru/
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> 
>>>rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/ma
>>>ilman/listinfo/rabbitmq-discuss
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
>
>-- 
>Eugene Kirpichov
>Principal Engineer, Mirantis Inc. http://www.mirantis.com/
>Editor, http://fprog.ru/
>_______________________________________________
>rabbitmq-discuss mailing list
>rabbitmq-discuss at lists.rabbitmq.com
>https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From abhishek.kona at gmail.com  Thu Aug  4 03:30:00 2011
From: abhishek.kona at gmail.com (Abhishek K)
Date: Thu, 4 Aug 2011 08:00:00 +0530
Subject: [rabbitmq-discuss] RabbitMQ Issues -> Losing confidence in it.
In-Reply-To: <CAHZAEpdCYpkYqiZFgzNPtg3HRFN3RFuP-=JdTho6fc8DTg584Q@mail.gmail.com>
References: <CAGTBvKv+LDMh7TzO2LeuUviMv=fJGgQG-+w2hix4D7-wZzqd=Q@mail.gmail.com>
	<CAF3N6oTgy_BLOKwhe_pDHzPt6tvNRFdo1w8w8kQPLNx4s6Loow@mail.gmail.com>
	<CAGTBvKvgABj9YA=knES4Hi_Gi=DNYiJ14mnFmiD1Th-BO+eMvw@mail.gmail.com>
	<4E39362E.1040409@rabbitmq.com>
	<CAGTBvKttZhiWSX3a=xCVtbOKB3cicdQ5CZLFvS7BV7TmXLCeuA@mail.gmail.com>
	<CAHZAEpdCYpkYqiZFgzNPtg3HRFN3RFuP-=JdTho6fc8DTg584Q@mail.gmail.com>
Message-ID: <CAGTBvKvfNcFhEPzY8mwVDvUJnZLgd8N1uTVn4CDJJV82xKy7gw@mail.gmail.com>

Hi,

All the queues were long lived.
There was only a single exchange all queues bound to that exchange, all
queues were durable.

The routing key was an individual string for each queue.

-Abhishek Kona

On Wed, Aug 3, 2011 at 10:55 PM, Jason J. W. Williams <
jasonjwwilliams at gmail.com> wrote:

> What was the configuration of the exchanges (type), queues (type and
> flags) and bindings? Also were the queues long-lived or are they being
> created and destroyed constantly?
>
> -J
>
> On Wed, Aug 3, 2011 at 11:17 AM, Abhishek K <abhishek.kona at gmail.com>
> wrote:
> > I am using Erlang R12B. The server had around 20GB of Ram.
> > There were around 30 queues on the server with the total memory
> consumption
> > calculated with
> > $ rabbitmqctl list_queues name memory
> > -Abhishek Kona
> >
> > Abhishek Kona
> > Department of Computer Engineering
> > National Institute of Technology
> > Karnataka, India
> >
> >
> > On Wed, Aug 3, 2011 at 5:21 PM, Emile Joubert <emile at rabbitmq.com>
> wrote:
> >>
> >> Hi Abhishek,
> >>
> >> On 03/08/11 11:15, Abhishek K wrote:
> >> > I am running RabbitMQ 2.20 on Debian Lenny (2.6.26).
> >> > There was no changes in the code using RabbitMQ, only the usage rate
> >> > increased by 20%.
> >>
> >> You don't mention the version of Erlang you use. It is worth bearing in
> >> mind that later versions of Erlang do better garbage collection. Also,
> >> how much RAM is installed on the server? You should generally expect
> >> that Erlang / RabbitMQ will use as much RAM as it can.
> >>
> >> You said that the broker uses 11GB RAM and that the queue size was 7MB -
> >> how were these figures determined? If that 7MB is distributed across a
> >> large number of queues then that is a possible explanation for the high
> >> memory usage. If the startup after a clean  shutdown takes an inordinate
> >> amount of time then you might have more than 7MB worth of messages on
> >> the broker.
> >>
> >> You should also inspect the results from running all the "rabbitmqctl
> >> list_*" commands to make sure your application isn't using up too many
> >> resources (e.g. queues or exchanges) on the broker.
> >>
> >> RabbitMQ version 2.5.1 adds more memory reporting features to the
> >> "rabbitmqctl status" command, with a breakdown of where memory is being
> >> used. This is not available on version 2.2.0, but it is another possible
> >> reason to upgrade.
> >>
> >>
> >>
> >> Regards
> >>
> >> Emile
> >
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110804/d6f9e4ea/attachment.htm>

From alex.lovelltroy at gmail.com  Thu Aug  4 08:58:38 2011
From: alex.lovelltroy at gmail.com (Alex Lovell-Troy)
Date: Thu, 4 Aug 2011 08:58:38 +0100
Subject: [rabbitmq-discuss] RabbitMQ Issues -> Losing confidence in it.
In-Reply-To: <CAGTBvKvfNcFhEPzY8mwVDvUJnZLgd8N1uTVn4CDJJV82xKy7gw@mail.gmail.com>
References: <CAGTBvKv+LDMh7TzO2LeuUviMv=fJGgQG-+w2hix4D7-wZzqd=Q@mail.gmail.com>
	<CAF3N6oTgy_BLOKwhe_pDHzPt6tvNRFdo1w8w8kQPLNx4s6Loow@mail.gmail.com>
	<CAGTBvKvgABj9YA=knES4Hi_Gi=DNYiJ14mnFmiD1Th-BO+eMvw@mail.gmail.com>
	<4E39362E.1040409@rabbitmq.com>
	<CAGTBvKttZhiWSX3a=xCVtbOKB3cicdQ5CZLFvS7BV7TmXLCeuA@mail.gmail.com>
	<CAHZAEpdCYpkYqiZFgzNPtg3HRFN3RFuP-=JdTho6fc8DTg584Q@mail.gmail.com>
	<CAGTBvKvfNcFhEPzY8mwVDvUJnZLgd8N1uTVn4CDJJV82xKy7gw@mail.gmail.com>
Message-ID: <CAMACij5wW_OmFUm8ZkQ2DVpQfoTXY-fz8fGFat_Y-B=REJtJVw@mail.gmail.com>

This sounds like the behavior I've seen when you consume messages
without acking them.

Does that ring a bell for anyone else?

-alex

On Thu, Aug 4, 2011 at 3:30 AM, Abhishek K <abhishek.kona at gmail.com> wrote:
> Hi,
> All the queues were long lived.
> There was only a single exchange all queues bound to that exchange, all
> queues were durable.
> The routing key was an individual string for each queue.
> -Abhishek Kona
> On Wed, Aug 3, 2011 at 10:55 PM, Jason J. W. Williams
> <jasonjwwilliams at gmail.com> wrote:
>>
>> What was the configuration of the exchanges (type), queues (type and
>> flags) and bindings? Also were the queues long-lived or are they being
>> created and destroyed constantly?
>>
>> -J
>>
>> On Wed, Aug 3, 2011 at 11:17 AM, Abhishek K <abhishek.kona at gmail.com>
>> wrote:
>> > I am using Erlang R12B. The server had around 20GB of Ram.
>> > There were around 30 queues on the server with the total memory
>> > consumption
>> > calculated with
>> > $ rabbitmqctl list_queues name memory
>> > -Abhishek Kona
>> >
>> > Abhishek Kona
>> > Department of Computer Engineering
>> > National Institute of Technology
>> > Karnataka, India
>> >
>> >
>> > On Wed, Aug 3, 2011 at 5:21 PM, Emile Joubert <emile at rabbitmq.com>
>> > wrote:
>> >>
>> >> Hi Abhishek,
>> >>
>> >> On 03/08/11 11:15, Abhishek K wrote:
>> >> > I am running RabbitMQ 2.20 on Debian Lenny (2.6.26).
>> >> > There was no changes in the code using RabbitMQ, only the usage rate
>> >> > increased by 20%.
>> >>
>> >> You don't mention the version of Erlang you use. It is worth bearing in
>> >> mind that later versions of Erlang do better garbage collection. Also,
>> >> how much RAM is installed on the server? You should generally expect
>> >> that Erlang / RabbitMQ will use as much RAM as it can.
>> >>
>> >> You said that the broker uses 11GB RAM and that the queue size was 7MB
>> >> -
>> >> how were these figures determined? If that 7MB is distributed across a
>> >> large number of queues then that is a possible explanation for the high
>> >> memory usage. If the startup after a clean ?shutdown takes an
>> >> inordinate
>> >> amount of time then you might have more than 7MB worth of messages on
>> >> the broker.
>> >>
>> >> You should also inspect the results from running all the "rabbitmqctl
>> >> list_*" commands to make sure your application isn't using up too many
>> >> resources (e.g. queues or exchanges) on the broker.
>> >>
>> >> RabbitMQ version 2.5.1 adds more memory reporting features to the
>> >> "rabbitmqctl status" command, with a breakdown of where memory is being
>> >> used. This is not available on version 2.2.0, but it is another
>> >> possible
>> >> reason to upgrade.
>> >>
>> >>
>> >>
>> >> Regards
>> >>
>> >> Emile
>> >
>> >
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >
>> >
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From matthias at rabbitmq.com  Thu Aug  4 10:25:31 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 04 Aug 2011 10:25:31 +0100
Subject: [rabbitmq-discuss] Extremely uneven distribution of latencies
 under	high load
In-Reply-To: <CANVKUrVYoPZ8qkGjv=8T19vthP4isVvY2Cs84W+Z_onpGKQX_A@mail.gmail.com>
References: <CANVKUrVYoPZ8qkGjv=8T19vthP4isVvY2Cs84W+Z_onpGKQX_A@mail.gmail.com>
Message-ID: <4E3A658B.4020507@rabbitmq.com>

Eugene,

On 01/08/11 12:26, Eugene Kirpichov wrote:
> I'm publishing about 6000 messages/s, each about 10kb in size, in
> roundrobin to these 4 nodes. I have publisher confirms turned on.
> Autoack is turned off; I have a cycle of "get, process, publish
> result, ack". Each message takes ~800ms to process.

Where in the cycle do you wait for / process the publisher confirm?

Also, if you have a publishing rate of 6000Hz, but a consuming rate of 
1/0.8 = 1.25Hz, then you'll need thousands of consumers to keep up. 
Otherwise the number of messages in / disk usage of rabbit will just 
keep growing.

> I'm experiencing things like "rabbitmq not giving a message to a
> consumer for several minutes", i.e. a large portion of my cluster is
> idle waiting for messages.

I suggest you use the management plug-in to get a better insight into
what rabbit is doing. Also look at the rabbit logs for anything unusual.

> RabbitMQ is also rather frequently dropping connections but I'm
> reconnecting.

RabbitMQ will only drop connections for the following reasons:

- an error occurred, in which case an error message sent to the client
(which you should see there and in the rabbit logs) and a connection
shutdown handshake sequence is initiated

- heartbeats are enabled and a client didn't send anything (including
heartbeat frames) for a while; there should be a message in the logs for
when that happens

Any other connection drops will be due to the client, network,
firewalls, etc.

> I also graphed the publish confirmations from RabbitMQ (actually the
> number of unack'd messages remaining)

Those two are completely different things. Confirms relate to messages
published by the client to the broker, acks relate to messages delivered
by the broker to clients.


Regards,

Matthias.

From 214575002 at qq.com  Thu Aug  4 10:39:29 2011
From: 214575002 at qq.com (=?gbk?B?xr2zo9DEzKw=?=)
Date: Thu, 4 Aug 2011 17:39:29 +0800
Subject: [rabbitmq-discuss] Error: unable to connect to node rabbit@dev:
	nodedown
Message-ID: <tencent_17B44C826F07FF174C302952@qq.com>

hi, all
    some error come up when I want to get some status of my rabbitmq-server
    the site http://www.rabbitmq.com/install.html#troubleshooting said that I should make sure the erlang cookies are the same, but I am new to erlang ,I don't know how to make sure.


below is the output,
    /------------------------------------rabbitmqctl status-------------------------------/
dev at dev:~/source/rabbitmq/sbin$ ./rabbitmqctl status                   
Status of node rabbit at dev ...
Error: unable to connect to node rabbit at dev: nodedown


=ERROR REPORT==== 4-Aug-2011::09:29:10 ===
Error in process <0.36.0> on node 'rabbitmqctl14242 at dev' with exit value: {badarg,[{erlang,list_to_existing_atom,["rabbit at Fanqu-WorkStation"]},{dist_util,recv_challenge,1},{dist_util,handshake_we_started,1}]}


diagnostics:
- nodes and their ports on dev: [{rabbit,56129},{rabbitmqctl14242,38839}]
- current node: rabbitmqctl14242 at dev
- current node home dir: /home/dev
- current node cookie hash: t6gCD5tZzOtYsVS32gQgwA==



    /------------------------------------hostname -s-------------------------------/
dev at dev:~/source/rabbitmq/sbin$ hostname -s
dev
dev at dev:~/source/rabbitmq/sbin$ cat /etc/hosts
127.0.0.1       localhost
127.0.1.1       dev



    /------------------------------------ps aux | grep beam -------------------------------/
dev at dev:~/source/rabbitmq/sbin$ ps aux | grep beam
dev      21051  0.0  0.3  56980  8080 ?        Sl   Jul26   3:44 /usr/lib/erlang/erts-5.7.4/bin/beam.smp -W w -K true -A30 -P 1048576 -- -root /usr/lib/erlang -progname erl -- -home /home/dev -- -noshell -noinput -sname rabbit at Fanqu-WorkStation -boot /home/dev/rabbitmq/data/rabbit at Fanqu-WorkStation-plugins-expand/rabbit -kernel inet_default_listen_options [{nodelay,true}] -kernel inet_default_connect_options [{nodelay,true}] -sasl errlog_type error -kernel error_logger {file,"/home/dev/rabbitmq/log/rabbit at Fanqu-WorkStation.log"} -sasl sasl_error_logger {file,"/home/dev/rabbitmq/log/rabbit at Fanqu-WorkStation-sasl.log"} -os_mon start_cpu_sup true -os_mon start_disksup false -os_mon start_memsup false -mnesia dir "/home/dev/rabbitmq/data/rabbit at Fanqu-WorkStation" -noshell -noinput
dev      30911  0.0  0.0   3552   916 pts/2    S+   09:40   0:00 grep --color=auto beam
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110804/118b90a2/attachment.htm>

From matthias at rabbitmq.com  Thu Aug  4 11:02:54 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 04 Aug 2011 11:02:54 +0100
Subject: [rabbitmq-discuss] CRL support
In-Reply-To: <1312283298.17699.15.camel@vicbristol6.hpl.hp.com>
References: <1312283298.17699.15.camel@vicbristol6.hpl.hp.com>
Message-ID: <4E3A6E4E.9060205@rabbitmq.com>

Andrea,

On 02/08/11 12:08, Andrea Rosa wrote:
> I implemented a client and server authentication but if a client send a
> revoked certificate the server accept the connection, I read that the
> CRL is not yet supported by the new_ssl Erlang module, but I need to
> manage also CRLs.
> Do someone else facing with the same problem?
> Have you experienced with some workaround to guarantee that a revoked
> certificate is not accepted by Rabbit?

As suggested in response to your question in erlang-questions, you can 
define your own cert verification function with the verify_fun ssl 
option and have that perform all the checks you need. The erlang ssl 
docs (http://www.erlang.org/doc/man/ssl.html) for verify_fun describe 
how that function should behave.

To hook your verification function into rabbit (nb: this is untested) ...

1) write an erlang module containing (and exporting) that function

2) In the rabbit/ssl_options section of the rabbitmq.config, add an 
entry {verify_fun, {YourModuleName, YourFunctionName}}.


Regards,

Matthias.

From sjaymin at gmail.com  Thu Aug  4 11:12:23 2011
From: sjaymin at gmail.com (Jaymin Shah)
Date: Thu, 4 Aug 2011 15:42:23 +0530
Subject: [rabbitmq-discuss] RabbitMQ on EC2 performance challenge
In-Reply-To: <CAO=2P+Jg5Hp1hJDHjYkjJPGEtq0YWGt7Mf=W8iiapTY2CsmhZw@mail.gmail.com>
References: <CAO=2P+Jg5Hp1hJDHjYkjJPGEtq0YWGt7Mf=W8iiapTY2CsmhZw@mail.gmail.com>
Message-ID: <CAO=2P++ajSeJ_tN7Rye03EF4ezH-pCShC=hQCd4ez02kBzOTvA@mail.gmail.com>

What could be performance expectations of RabbitMQ on EC2? Would appreciate
sharing experience here.


I am trying to do some performance test of RabbitMQ on aws EC2. I have 3
separate EC2 instance running for RabbitMQ, Publisher and consumer/worker.


The scenario I have is that Publisher pushes JSON string (approx 165-200
bytes) to exchange type direct with durable set to true and bind queue with
durable set to true (i.e. both in persistent mode). Consumer/worker is
running on separate box - keeps pulling messages. (Moving forward these
messages at worker are expected to be persisted in MongoDB and Publisher
would be replaced with Restful  service using REST easy)


To keep things simple I have simulated this scenario by using Multicast
sample code. I had split multicast code in to two separate java file namely
?Producer? and ?Worker? to run each on separate box. I have used ?c1.mediam?
EC2 with Ubuntu server v11.4 32 bit for running producer and consumer and
?m1.large? with Ubuntu server v11.4 64 bit for RabbitMQ.


I am able to achieve a throughput of 3-5k messages per second i.e. keeping
study message push rate to 5K. (This concur
withhttp://www.rabbitmq.com/faq.html#performance-latency
)


Further, when I increase the push rate to 10-12k messages per second.
Consumer?s ability to consume messages drops to 1-2k messages per second and
it generates backlog (Many time it goes below 800 messages per second too).


With above scenario, I have following questions and would appreciate
thoughts/suggestion to improve throughput of consumer as well.  (NOTE: all
the messages in my scenario are expected to similar type giving no
opportunity to group them for setting routing therefore may need some kind
of load-balancer approach)


1) This performance is observed with one rabbitMQ server, one exchange and
one queue. Is anything further can be configured, fine-tuned to improvise
throughput to more than 5k with persistent mode.


2) I do understand, clustering could be another option. However, I need to
set cluster based on incoming load and I may not get message grouping /
identity to define routing (since messages are expected to be just log
description). Can I have clustering following load balancing option for
worker/consumer?


3) I am expected to process several hundred thousand requests per second. I
would appreciate sharing some experience and approach to achieve this.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110804/9ae7c51f/attachment.htm>

From matthias at rabbitmq.com  Thu Aug  4 11:12:59 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 04 Aug 2011 11:12:59 +0100
Subject: [rabbitmq-discuss] jspon rpc
In-Reply-To: <CAJ2-VrnOtbrp5A45Ji-X6t+x-psy5rDn-0Srb+_APMBt-+e1DA@mail.gmail.com>
References: <CAJ2-VrnOtbrp5A45Ji-X6t+x-psy5rDn-0Srb+_APMBt-+e1DA@mail.gmail.com>
Message-ID: <4E3A70AB.3000201@rabbitmq.com>

On 02/08/11 14:46, mysurf mail wrote:
> new JsonRpcClient(channel,"",SomeStringNotUniqueToApp)
>
> Sometimes it works great and it sometimes it does  not return at all.
> The system just halts.

That's odd. Are there any errors in the logs? When it halts, please get 
a stack trace of where it's stuck (kill -QUIT <java process>)

> Should I give it an exchange specific name?

No. Using the default exchange is fine.


Matthias.

From ekirpichov at gmail.com  Thu Aug  4 11:14:28 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Thu, 4 Aug 2011 14:14:28 +0400
Subject: [rabbitmq-discuss] Extremely uneven distribution of latencies
 under high load
In-Reply-To: <4E3A658B.4020507@rabbitmq.com>
References: <CANVKUrVYoPZ8qkGjv=8T19vthP4isVvY2Cs84W+Z_onpGKQX_A@mail.gmail.com>
	<4E3A658B.4020507@rabbitmq.com>
Message-ID: <CANVKUrWBnPjbjeg7iSnhNEvn70RgzFdsvonx8Yyj_eVx8RvcKg@mail.gmail.com>

Hi Matthias,

2011/8/4 Matthias Radestock <matthias at rabbitmq.com>:
> Eugene,
>
> On 01/08/11 12:26, Eugene Kirpichov wrote:
>>
>> I'm publishing about 6000 messages/s, each about 10kb in size, in
>> roundrobin to these 4 nodes. I have publisher confirms turned on.
>> Autoack is turned off; I have a cycle of "get, process, publish
>> result, ack". Each message takes ~800ms to process.
>
> Where in the cycle do you wait for / process the publisher confirm?
>
> Also, if you have a publishing rate of 6000Hz, but a consuming rate of 1/0.8
> = 1.25Hz, then you'll need thousands of consumers to keep up. Otherwise the
> number of messages in / disk usage of rabbit will just keep growing.
>
I do have thousands of consumers :)

>> I'm experiencing things like "rabbitmq not giving a message to a
>> consumer for several minutes", i.e. a large portion of my cluster is
>> idle waiting for messages.
>
> I suggest you use the management plug-in to get a better insight into
> what rabbit is doing. Also look at the rabbit logs for anything unusual.
>
>> RabbitMQ is also rather frequently dropping connections but I'm
>> reconnecting.
>
> RabbitMQ will only drop connections for the following reasons:
>
> - an error occurred, in which case an error message sent to the client
> (which you should see there and in the rabbit logs) and a connection
> shutdown handshake sequence is initiated
>
> - heartbeats are enabled and a client didn't send anything (including
> heartbeat frames) for a while; there should be a message in the logs for
> when that happens
>
> Any other connection drops will be due to the client, network,
> firewalls, etc.
>
Thanks, this is useful information.

>> I also graphed the publish confirmations from RabbitMQ (actually the
>> number of unack'd messages remaining)
>
> Those two are completely different things. Confirms relate to messages
> published by the client to the broker, acks relate to messages delivered
> by the broker to clients.
I did not express myself clearly enough - under "unackd" I mean
"number of messages that I have sent but not yet received a publish
confirmation about".

By the way, I had a kind of logic that tried to connect to another
queue when it had no messages on the current one.
Once I disabled this logic, this kind of behavior nearly immediately
disappeared.

So looks like in fact rabbit was having a hard time handling all the reconnects.

>
>
> Regards,
>
> Matthias.
>



-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/

From sjaymin at gmail.com  Thu Aug  4 10:40:57 2011
From: sjaymin at gmail.com (Jaymin Shah)
Date: Thu, 4 Aug 2011 15:10:57 +0530
Subject: [rabbitmq-discuss] RabbitMQ on EC2 performance challenge
Message-ID: <CAO=2P+Jg5Hp1hJDHjYkjJPGEtq0YWGt7Mf=W8iiapTY2CsmhZw@mail.gmail.com>

What could be performance expectations of RabbitMQ on EC2? Would appreciate
sharing experience here.


I am trying to do some performance test of RabbitMQ on aws EC2. I have 3
separate EC2 instance running for RabbitMQ, Publisher and consumer/worker.


The scenario I have is that Publisher pushes JSON string (approx 165-200
bytes) to exchange type direct with durable set to true and bind queue with
durable set to true (i.e. both in persistent mode). Consumer/worker is
running on separate box - keeps pulling messages. (Moving forward these
messages at worker are expected to be persisted in MongoDB and Publisher
would be replaced with Restful  service using REST easy)


To keep things simple I have simulated this scenario by using Multicast
sample code. I had split multicast code in to two separate java file namely
?Producer? and ?Worker? to run each on separate box. I have used ?c1.mediam?
EC2 with Ubuntu server v11.4 32 bit for running producer and consumer and
?m1.large? with Ubuntu server v11.4 64 bit for RabbitMQ.


I am able to achieve a throughput of 3-5k messages per second i.e. keeping
study message push rate to 5K. (This concur
withhttp://www.rabbitmq.com/faq.html#performance-latency
)


Further, when I increase the push rate to 10-12k messages per second.
Consumer?s ability to consume messages drops to 1-2k messages per second and
it generates backlog (Many time it goes below 800 messages per second too).


With above scenario, I have following questions and would appreciate
thoughts/suggestion to improve throughput of consumer as well.  (NOTE: all
the messages in my scenario are expected to similar type giving no
opportunity to group them for setting routing therefore may need some kind
of load-balancer approach)


1) This performance is observed with one rabbitMQ server, one exchange and
one queue. Is anything further can be configured, fine-tuned to improvise
throughput to more than 5k with persistent mode.


2) I do understand, clustering could be another option. However, I need to
set cluster based on incoming load and I may not get message grouping /
identity to define routing (since messages are expected to be just log
description). Can I have clustering following load balancing option for
worker/consumer?


3) I am expected to process several hundred thousand requests per second. I
would appreciate sharing some experience and approach to achieve this.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110804/80657e6b/attachment.htm>

From andrea.rosa at hp.com  Thu Aug  4 11:54:27 2011
From: andrea.rosa at hp.com (Rosa, Andrea)
Date: Thu, 4 Aug 2011 11:54:27 +0100
Subject: [rabbitmq-discuss] CRL support
In-Reply-To: <4E3A6E4E.9060205@rabbitmq.com>
References: <1312283298.17699.15.camel@vicbristol6.hpl.hp.com>
	<4E3A6E4E.9060205@rabbitmq.com>
Message-ID: <8097A4E725D78E41A8B862ACE60E963945EF69314E@GVW1355EXB.americas.hpqcorp.net>

Hi Matthias

Thank you for your reply.
Regards
--
Andrea

> As suggested in response to your question in erlang-questions, you can
> define your own cert verification function with the verify_fun ssl
> option and have that perform all the checks you need. The erlang ssl
> docs (http://www.erlang.org/doc/man/ssl.html) for verify_fun describe
> how that function should behave.
> 
> To hook your verification function into rabbit (nb: this is untested)
> ...
> 
> 1) write an erlang module containing (and exporting) that function
> 
> 2) In the rabbit/ssl_options section of the rabbitmq.config, add an
> entry {verify_fun, {YourModuleName, YourFunctionName}}.
> 
> 
> Regards,
> 
> Matthias.

From matthias at rabbitmq.com  Thu Aug  4 12:07:12 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 04 Aug 2011 12:07:12 +0100
Subject: [rabbitmq-discuss] RabbitMQ actively refuses connections after
 connectity issues
In-Reply-To: <CAGVpBACEMfdsxHK1Pp4WZ3tnaP=9XYG5iG1yxCV3-av_q92hsQ@mail.gmail.com>
References: <968a1a05-b848-4794-b8ad-9a865489ce51@p20g2000yqp.googlegroups.com>	<65dd7dd1-b45c-48d7-b80b-69978911fb9e@k27g2000yqn.googlegroups.com>	<4E37C91E.3010902@rabbitmq.com>	<da4c18d6-20a4-49cd-88c9-0690cce14701@t5g2000yqj.googlegroups.com>	<4E38062A.7040608@rabbitmq.com>
	<CAGVpBACEMfdsxHK1Pp4WZ3tnaP=9XYG5iG1yxCV3-av_q92hsQ@mail.gmail.com>
Message-ID: <4E3A7D60.1030207@rabbitmq.com>

Alfonso,

On 02/08/11 15:36, Alfonso Pantoja wrote:
> By the way  Since we are using RequestedHeartbeat feature is it possible
> to open a connection to rabbit and not use it anymore without being
> disconnected?
> (setting RequestedHeartbea with a value > 0 is enough or additional code
> is needed?)

Correct. Setting RequestedHeartbeat enables logic in the client library 
that automatically sends out heartbeat frames at the configured interval 
whenever no other data is being transmitted.

Regards,

Matthias.

From Massimo.Paladin at cern.ch  Thu Aug  4 12:18:45 2011
From: Massimo.Paladin at cern.ch (Massimo Paladin)
Date: Thu, 4 Aug 2011 13:18:45 +0200
Subject: [rabbitmq-discuss] RabbitMQ RPM and its dependencies
Message-ID: <CAMOXM29+Arw6wP1n-KGNsOnOZ9wu+oHYhwkZTecxEwh8-SUnpw@mail.gmail.com>

Hello,

RabbitMQ RPM requires erlang which is provided by a lot of sub-packages.

I wonder if rabbit really needs all those sub-packages,
did someone already spend some time shrinking down the required erlang
sub-packages?

Regards,
---
Massimo Paladin

email: massimo.paladin at gmail.com
website: http://www.mpaladin.com
flickr's page: http://flickr.com/photos/massimop
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110804/169061c3/attachment.htm>

From david at rabbitmq.com  Thu Aug  4 12:28:30 2011
From: david at rabbitmq.com (David Wragg)
Date: Thu, 04 Aug 2011 12:28:30 +0100
Subject: [rabbitmq-discuss] Installation problems on Centos
In-Reply-To: <C23F3588-096C-4CB1-AC34-B41005F37715@headshift.com> (Chris
	Rode's message of "Wed, 3 Aug 2011 10:51:16 +0100")
References: <C23F3588-096C-4CB1-AC34-B41005F37715@headshift.com>
Message-ID: <yrv4c39hh76w1.fsf@dwragg.eng.vmware.com>

Hi Chris,

Chris Rode <chris.rode at headshift.com> writes:
> I have been trying to get RabbitMQ up and running on my Centos
> installation using the installation instuctions for RPM based Linux
> distro's here http://www.rabbitmq.com/server.html
>
> This all works fine until I try and install the RPM itself using rpm
> -ivh rabbitmq-server-2.5.1-1.noarch.rpm
>
> This results in the following error:
>
> warning: rabbitmq-server-2.5.1-1.noarch.rpm: Header V4 DSA signature: NOKEY, key ID 056e8e56
> error: Failed dependencies:
> 	erlang >= R12B-3 is needed by rabbitmq-server-2.5.1-1.noarch

You need to install the "erlang-R14B-02.1.el5" package, not just the
erlang sub-packages.  For compatbility reasons, our RPMs still depend on
"erlang", which only the erlang package satisfies.  After the erlang RPM
was broken out, the erlang package became simply a stub which pulls in
all the sub-packages.  But you still need to install it.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
VMware, Inc.

From majek04 at gmail.com  Thu Aug  4 12:28:43 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Thu, 4 Aug 2011 12:28:43 +0100
Subject: [rabbitmq-discuss] Error: unable to connect to node rabbit@dev:
	nodedown
In-Reply-To: <tencent_17B44C826F07FF174C302952@qq.com>
References: <tencent_17B44C826F07FF174C302952@qq.com>
Message-ID: <CABzX+qy=X1FCe4PR0qxEyBFU_krgRvX6Mgm_UETbFmQDh_LJyQ@mail.gmail.com>

2011/8/4 ???? <214575002 at qq.com>:
> hi, all
> ? ? some error come up when I want to get some status of my rabbitmq-server
> ? ? the site http://www.rabbitmq.com/install.html#troubleshooting?said that
> I?should make sure the erlang cookies are the same, but I am new to erlang
> ,I don't know how to make sure.
> below is the output,
> ? ? /------------------------------------rabbitmqctl
> status-------------------------------/
> dev at dev:~/source/rabbitmq/sbin$ ./rabbitmqctl status
> Status of node rabbit at dev ...
> Error: unable to connect to node rabbit at dev: nodedown
> =ERROR REPORT==== 4-Aug-2011::09:29:10 ===
> Error in process <0.36.0> on node 'rabbitmqctl14242 at dev' with exit value:
> {badarg,[{erlang,list_to_existing_atom,["rabbit at Fanqu-WorkStation"]},{dist_util,recv_challenge,1},{dist_util,handshake_we_started,1}]}
> diagnostics:
> - nodes and their ports on dev: [{rabbit,56129},{rabbitmqctl14242,38839}]
> - current node: rabbitmqctl14242 at dev
> - current node home dir: /home/dev
> - current node cookie hash: t6gCD5tZzOtYsVS32gQgwA==
> ? ? /------------------------------------hostname
> -s-------------------------------/
> dev at dev:~/source/rabbitmq/sbin$ hostname -s
> dev
> dev at dev:~/source/rabbitmq/sbin$ cat /etc/hosts
> 127.0.0.1 ? ? ? localhost
> 127.0.1.1 ? ? ? dev
> ? ? /------------------------------------ps aux | grep beam
> -------------------------------/
> dev at dev:~/source/rabbitmq/sbin$ ps aux | grep beam
> dev ? ? ?21051 ?0.0 ?0.3 ?56980 ?8080 ? ? ? ? ?Sl ? Jul26 ? 3:44
> /usr/lib/erlang/erts-5.7.4/bin/beam.smp -W w -K true -A30 -P 1048576 --
> -root /usr/lib/erlang -progname erl -- -home /home/dev -- -noshell -noinput
> -sname rabbit at Fanqu-WorkStation -boot
> /home/dev/rabbitmq/data/rabbit at Fanqu-WorkStation-plugins-expand/rabbit
> -kernel inet_default_listen_options [{nodelay,true}] -kernel
> inet_default_connect_options [{nodelay,true}] -sasl errlog_type error
> -kernel error_logger
> {file,"/home/dev/rabbitmq/log/rabbit at Fanqu-WorkStation.log"} -sasl
> sasl_error_logger
> {file,"/home/dev/rabbitmq/log/rabbit at Fanqu-WorkStation-sasl.log"} -os_mon
> start_cpu_sup true -os_mon start_disksup false -os_mon start_memsup false
> -mnesia dir "/home/dev/rabbitmq/data/rabbit at Fanqu-WorkStation" -noshell
> -noinput
> dev ? ? ?30911 ?0.0 ?0.0 ? 3552 ? 916 pts/2 ? ?S+ ? 09:40 ? 0:00 grep
> --color=auto beam

You seem to have rabbit running as "rabbit at Fanqu-WorkStation" while your
rabbitmqctl asks for "rabbit at dev".

If "Fanqu-WorkStation" is a proper network name, you should be able to
do "rabbitmqctl -n rabbit at Fanqu-WorkStation status"

Cheers,
   Marek

From matthias at rabbitmq.com  Thu Aug  4 12:30:11 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 04 Aug 2011 12:30:11 +0100
Subject: [rabbitmq-discuss] RabbitMQ RPM and its dependencies
In-Reply-To: <CAMOXM29+Arw6wP1n-KGNsOnOZ9wu+oHYhwkZTecxEwh8-SUnpw@mail.gmail.com>
References: <CAMOXM29+Arw6wP1n-KGNsOnOZ9wu+oHYhwkZTecxEwh8-SUnpw@mail.gmail.com>
Message-ID: <4E3A82C3.9040609@rabbitmq.com>

On 04/08/11 12:18, Massimo Paladin wrote:
> RabbitMQ RPM requires erlang which is provided by a lot of sub-packages.
>
> I wonder if rabbit really needs all those sub-packages,
> did someone already spend some time shrinking down the required erlang
> sub-packages?

We used to depend on just the packages the broker needs. However, 
plug-ins may use more packages than the broker.

Matthias.

From simon at rabbitmq.com  Thu Aug  4 12:34:42 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 04 Aug 2011 12:34:42 +0100
Subject: [rabbitmq-discuss] RabbitMQ RPM and its dependencies
In-Reply-To: <4E3A82C3.9040609@rabbitmq.com>
References: <CAMOXM29+Arw6wP1n-KGNsOnOZ9wu+oHYhwkZTecxEwh8-SUnpw@mail.gmail.com>
	<4E3A82C3.9040609@rabbitmq.com>
Message-ID: <4E3A83D2.3060809@rabbitmq.com>

On 04/08/11 12:30, Matthias Radestock wrote:
> On 04/08/11 12:18, Massimo Paladin wrote:
>> RabbitMQ RPM requires erlang which is provided by a lot of sub-packages.
>>
>> I wonder if rabbit really needs all those sub-packages,
>> did someone already spend some time shrinking down the required erlang
>> sub-packages?
>
> We used to depend on just the packages the broker needs. However,
> plug-ins may use more packages than the broker.

We used to do that for Debian, not RPMs. I think RPMs having 
sub-packages at all is fairly recent.

Unfortunately to my untutored eye it still doesn't look like there's any 
equivalent of Debian's erlang-nox metapackage, so we drag in all sorts 
of X11 deps we don't need.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From majek04 at gmail.com  Thu Aug  4 12:56:29 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Thu, 4 Aug 2011 12:56:29 +0100
Subject: [rabbitmq-discuss] Re : Re: Connection closed after 10 minutes.
 Cause : end-of-stream
Message-ID: <CABzX+qxOHMd-0ndiqa_+nD8396hJWtKiqJUTENQuvfJ-LhrVjQ@mail.gmail.com>

Renaud,

On first glance it looks like a network problem.  Is the connection
between machines stable? Does 'ping' work all the time?

Have you tweaked any tcp/ip settings?

Apart from that, please show us the .net traceback and
rabbitmq logs.

If it is indeed a weird network issue, setting a heartbeat might
help, take a look:
http://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v2.5.1/rabbitmq-dotnet-client-2.5.1-client-htmldoc/html/type-RabbitMQ.Client.ConnectionFactory.html#field-F:RabbitMQ.Client.ConnectionFactory.RequestedHeartbeat

Cheers,
   Marek

On Wed, Aug 3, 2011 at 12:39, Renaud <rmartele at gmail.com> wrote:
>
> Here are two diagrams that will maybe help you.
> The first shows the case where, after 10 minutes, the connection between .NET client and RabbitMQ Server closes itself :
> (the error stack appears in the .NET client console and specifies that the client closed the connection)
>
> The second diagram shows an other test that works fine, without the constraint of 10 minutes :
>
> So, if it was a firewall problem, I think the second test wouldn't work.
> I also precise that ".NET client" from the first diagram, is not the same as ".NET client 1" and ".NET client 2" from the second diagram. But, it establishes the connection exactly the same way...
> Would the problem come from the Java clients?
> Java clients doesn't seem to be affected by this closure of connection after 10 minutes.
> Thanks for any help!
> Renaud
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From abhishek.kona at gmail.com  Thu Aug  4 13:13:52 2011
From: abhishek.kona at gmail.com (Abhishek K)
Date: Thu, 4 Aug 2011 17:43:52 +0530
Subject: [rabbitmq-discuss] RabbitMQ Issues -> Losing confidence in it.
In-Reply-To: <CAMACij5wW_OmFUm8ZkQ2DVpQfoTXY-fz8fGFat_Y-B=REJtJVw@mail.gmail.com>
References: <CAGTBvKv+LDMh7TzO2LeuUviMv=fJGgQG-+w2hix4D7-wZzqd=Q@mail.gmail.com>
	<CAF3N6oTgy_BLOKwhe_pDHzPt6tvNRFdo1w8w8kQPLNx4s6Loow@mail.gmail.com>
	<CAGTBvKvgABj9YA=knES4Hi_Gi=DNYiJ14mnFmiD1Th-BO+eMvw@mail.gmail.com>
	<4E39362E.1040409@rabbitmq.com>
	<CAGTBvKttZhiWSX3a=xCVtbOKB3cicdQ5CZLFvS7BV7TmXLCeuA@mail.gmail.com>
	<CAHZAEpdCYpkYqiZFgzNPtg3HRFN3RFuP-=JdTho6fc8DTg584Q@mail.gmail.com>
	<CAGTBvKvfNcFhEPzY8mwVDvUJnZLgd8N1uTVn4CDJJV82xKy7gw@mail.gmail.com>
	<CAMACij5wW_OmFUm8ZkQ2DVpQfoTXY-fz8fGFat_Y-B=REJtJVw@mail.gmail.com>
Message-ID: <CAGTBvKvkzky45SM-TusFctUtZZy62vOVeae_zmPrvnVkTsGHvQ@mail.gmail.com>

-Messages are regularly acked by the application using RabbitMQ.
The application is Thrift Server and before returning the Thrift RPC call,
the RabbitMQ ack is sent back.

-Abhishek Kona


On Thu, Aug 4, 2011 at 1:28 PM, Alex Lovell-Troy
<alex.lovelltroy at gmail.com>wrote:

> This sounds like the behavior I've seen when you consume messages
> without acking them.
>
> Does that ring a bell for anyone else?
>
> -alex
>
> On Thu, Aug 4, 2011 at 3:30 AM, Abhishek K <abhishek.kona at gmail.com>
> wrote:
> > Hi,
> > All the queues were long lived.
> > There was only a single exchange all queues bound to that exchange, all
> > queues were durable.
> > The routing key was an individual string for each queue.
> > -Abhishek Kona
> > On Wed, Aug 3, 2011 at 10:55 PM, Jason J. W. Williams
> > <jasonjwwilliams at gmail.com> wrote:
> >>
> >> What was the configuration of the exchanges (type), queues (type and
> >> flags) and bindings? Also were the queues long-lived or are they being
> >> created and destroyed constantly?
> >>
> >> -J
> >>
> >> On Wed, Aug 3, 2011 at 11:17 AM, Abhishek K <abhishek.kona at gmail.com>
> >> wrote:
> >> > I am using Erlang R12B. The server had around 20GB of Ram.
> >> > There were around 30 queues on the server with the total memory
> >> > consumption
> >> > calculated with
> >> > $ rabbitmqctl list_queues name memory
> >> > -Abhishek Kona
> >> >
> >> > Abhishek Kona
> >> > Department of Computer Engineering
> >> > National Institute of Technology
> >> > Karnataka, India
> >> >
> >> >
> >> > On Wed, Aug 3, 2011 at 5:21 PM, Emile Joubert <emile at rabbitmq.com>
> >> > wrote:
> >> >>
> >> >> Hi Abhishek,
> >> >>
> >> >> On 03/08/11 11:15, Abhishek K wrote:
> >> >> > I am running RabbitMQ 2.20 on Debian Lenny (2.6.26).
> >> >> > There was no changes in the code using RabbitMQ, only the usage
> rate
> >> >> > increased by 20%.
> >> >>
> >> >> You don't mention the version of Erlang you use. It is worth bearing
> in
> >> >> mind that later versions of Erlang do better garbage collection.
> Also,
> >> >> how much RAM is installed on the server? You should generally expect
> >> >> that Erlang / RabbitMQ will use as much RAM as it can.
> >> >>
> >> >> You said that the broker uses 11GB RAM and that the queue size was
> 7MB
> >> >> -
> >> >> how were these figures determined? If that 7MB is distributed across
> a
> >> >> large number of queues then that is a possible explanation for the
> high
> >> >> memory usage. If the startup after a clean  shutdown takes an
> >> >> inordinate
> >> >> amount of time then you might have more than 7MB worth of messages on
> >> >> the broker.
> >> >>
> >> >> You should also inspect the results from running all the "rabbitmqctl
> >> >> list_*" commands to make sure your application isn't using up too
> many
> >> >> resources (e.g. queues or exchanges) on the broker.
> >> >>
> >> >> RabbitMQ version 2.5.1 adds more memory reporting features to the
> >> >> "rabbitmqctl status" command, with a breakdown of where memory is
> being
> >> >> used. This is not available on version 2.2.0, but it is another
> >> >> possible
> >> >> reason to upgrade.
> >> >>
> >> >>
> >> >>
> >> >> Regards
> >> >>
> >> >> Emile
> >> >
> >> >
> >> > _______________________________________________
> >> > rabbitmq-discuss mailing list
> >> > rabbitmq-discuss at lists.rabbitmq.com
> >> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >> >
> >> >
> >
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110804/bb1e2c9f/attachment.htm>

From david_syer at hotmail.com  Thu Aug  4 13:18:05 2011
From: david_syer at hotmail.com (Dave Syer)
Date: Thu, 4 Aug 2011 05:18:05 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ and Spring
In-Reply-To: <27D6B27DB616654BBEF4DDB8B31EAF916B590E9527@vs-msx01.IT-NG.local>
References: <27D6B27DB616654BBEF4DDB8B31EAF916B590E9526@vs-msx01.IT-NG.local>, 
	<468ecd19-1a84-4b35-934c-b16a1c36c30e@e35g2000yqc.googlegroups.com>
	<27D6B27DB616654BBEF4DDB8B31EAF916B590E9527@vs-msx01.IT-NG.local>
Message-ID: <88bbe583-fa6e-4474-9e91-5316463ce721@o26g2000vbi.googlegroups.com>

> Is there a possibility to set the ReplyTimeout for the
>  template.receive function? The template.setReplyTimeout is only for
>  the template.sendAndReceive function.

There is a JIRA ticket for that
(https://jira.springsource.org/browse/AMQP-71, resolved as Won't Fix).
We can't implement it without unintended consequences because there is
no concept of a blocking receive with timeout in the AMQP protocol

> But I need different Queues for sending an receiving.

sendAndReceive uses different queues for sending and receiving.

> By the way template.sendAndReceive isn't working anyway for me.

Can you be more specific?

> In addition my Queue is auto-delete and not durable, but it isn't
> deleted after the last message is read.

Auto-delete queues are only removed when the Channel is closed (which
might be never if you use a CachingConnectionFactory.  You need an
exclusive queue to have it delete when not in use, and then you need
to use basicConsume, not basicGet to receive the message.  The whole
point of sendAdnReceive is to remove the burden of managing that.

> I get no compilation error, but these errors are very annoying.

There should be no XSD problems at runtime because Spring finds the
schema on the classpath.  From what you say this is the case.  So your
problem is in your XML editor, and all you need to do is find a way to
configure your editor to find the schema somewhere. how you do that
must depend on the editor.  If you use SpringSource ToolSuite it
should work (but you might need to use an explicit version number in
your schema declaration - i.e. */spring-rabbit-1.0.xsd).

From matthias at rabbitmq.com  Thu Aug  4 13:20:49 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 04 Aug 2011 13:20:49 +0100
Subject: [rabbitmq-discuss] RabbitMQ Issues -> Losing confidence in it.
In-Reply-To: <CAGTBvKvkzky45SM-TusFctUtZZy62vOVeae_zmPrvnVkTsGHvQ@mail.gmail.com>
References: <CAGTBvKv+LDMh7TzO2LeuUviMv=fJGgQG-+w2hix4D7-wZzqd=Q@mail.gmail.com>	<CAF3N6oTgy_BLOKwhe_pDHzPt6tvNRFdo1w8w8kQPLNx4s6Loow@mail.gmail.com>	<CAGTBvKvgABj9YA=knES4Hi_Gi=DNYiJ14mnFmiD1Th-BO+eMvw@mail.gmail.com>	<4E39362E.1040409@rabbitmq.com>	<CAGTBvKttZhiWSX3a=xCVtbOKB3cicdQ5CZLFvS7BV7TmXLCeuA@mail.gmail.com>	<CAHZAEpdCYpkYqiZFgzNPtg3HRFN3RFuP-=JdTho6fc8DTg584Q@mail.gmail.com>	<CAGTBvKvfNcFhEPzY8mwVDvUJnZLgd8N1uTVn4CDJJV82xKy7gw@mail.gmail.com>	<CAMACij5wW_OmFUm8ZkQ2DVpQfoTXY-fz8fGFat_Y-B=REJtJVw@mail.gmail.com>
	<CAGTBvKvkzky45SM-TusFctUtZZy62vOVeae_zmPrvnVkTsGHvQ@mail.gmail.com>
Message-ID: <4E3A8EA1.20501@rabbitmq.com>

Abhishek,

On 04/08/11 13:13, Abhishek K wrote:
> -Messages are regularly acked by the application using RabbitMQ.

As Emile suggested, please upgrade Erlang and RabbitMQ. I reckon the 
problem is more likely in the application than in either of these, but 
upgrading will make diagnosis easier. If after the upgrade the problem 
arises again, please send us the output of 'rabbitmqctl report'.

Regards,

Matthias.

From simon at rabbitmq.com  Thu Aug  4 13:22:56 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 04 Aug 2011 13:22:56 +0100
Subject: [rabbitmq-discuss] RabbitMQ and Spring
In-Reply-To: <88bbe583-fa6e-4474-9e91-5316463ce721@o26g2000vbi.googlegroups.com>
References: <27D6B27DB616654BBEF4DDB8B31EAF916B590E9526@vs-msx01.IT-NG.local>,
	<468ecd19-1a84-4b35-934c-b16a1c36c30e@e35g2000yqc.googlegroups.com>	<27D6B27DB616654BBEF4DDB8B31EAF916B590E9527@vs-msx01.IT-NG.local>
	<88bbe583-fa6e-4474-9e91-5316463ce721@o26g2000vbi.googlegroups.com>
Message-ID: <4E3A8F20.3090108@rabbitmq.com>

On 04/08/11 13:18, Dave Syer wrote:
> Auto-delete queues are only removed when the Channel is closed (which
> might be never if you use a CachingConnectionFactory.  You need an
> exclusive queue to have it delete when not in use, and then you need
> to use basicConsume, not basicGet to receive the message.

Isn't that the wrong way round? As in, exclusive queues delete when the 
connection owning them closes, and auto-delete ones go when the last 
consumer cancels.

Cheers, Simon
-- 
Simon MacMullen
RabbitMQ, VMware

From Massimo.Paladin at cern.ch  Thu Aug  4 13:36:44 2011
From: Massimo.Paladin at cern.ch (Massimo Paladin)
Date: Thu, 4 Aug 2011 14:36:44 +0200
Subject: [rabbitmq-discuss] RabbitMQ RPM and its dependencies
In-Reply-To: <4E3A83D2.3060809@rabbitmq.com>
References: <CAMOXM29+Arw6wP1n-KGNsOnOZ9wu+oHYhwkZTecxEwh8-SUnpw@mail.gmail.com>
	<4E3A82C3.9040609@rabbitmq.com> <4E3A83D2.3060809@rabbitmq.com>
Message-ID: <CAMOXM2-D4A1tyCuTB6UenxtM73eYJ=yDbQFtHYnQegKv+mOM8g@mail.gmail.com>

There are 56 sub-packages, I don't know erlang, could you try to guess a
subset of these?

erlang-snmp
erlang-sasl
erlang-cosEventDomain
erlang-erts
erlang-debugger
erlang-test_server
erlang-percept
erlang-stdlib
erlang-typer
erlang-pman
erlang-gs
erlang-orber
erlang-common_test
erlang-kernel
erlang-compiler
erlang-et
erlang-inets
erlang-cosTime
erlang-tv
erlang-appmon
erlang-jinterface
erlang-mnesia
erlang-dialyzer
erlang-tools
erlang-edoc
erlang-cosFileTransfer
erlang-ic
erlang-syntax_tools
erlang-wx
erlang-ssl
erlang-webtool
erlang-cosProperty
erlang-docbuilder
erlang-inviso
erlang-crypto
erlang-hipe
erlang-megaco
erlang-cosEvent
erlang-otp_mibs
erlang-reltool
erlang-parsetools
erlang-erl_docgen
erlang-asn1
erlang-ssh
erlang-eunit
erlang-runtime_tools
erlang-odbc
erlang-os_mon
erlang-examples
erlang-xmerl
erlang-observer
erlang-cosTransactions
erlang-erl_interface
erlang-public_key
erlang-cosNotification
erlang-toolbar

Regards,
---
Massimo Paladin

email: massimo.paladin at gmail.com
website: http://www.mpaladin.com
flickr's page: http://flickr.com/photos/massimop


On Thu, Aug 4, 2011 at 1:34 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 04/08/11 12:30, Matthias Radestock wrote:
>
>> On 04/08/11 12:18, Massimo Paladin wrote:
>>
>>> RabbitMQ RPM requires erlang which is provided by a lot of sub-packages.
>>>
>>> I wonder if rabbit really needs all those sub-packages,
>>> did someone already spend some time shrinking down the required erlang
>>> sub-packages?
>>>
>>
>> We used to depend on just the packages the broker needs. However,
>> plug-ins may use more packages than the broker.
>>
>
> We used to do that for Debian, not RPMs. I think RPMs having sub-packages
> at all is fairly recent.
>
> Unfortunately to my untutored eye it still doesn't look like there's any
> equivalent of Debian's erlang-nox metapackage, so we drag in all sorts of
> X11 deps we don't need.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110804/b2bf0e7e/attachment.htm>

From 214575002 at qq.com  Thu Aug  4 14:03:30 2011
From: 214575002 at qq.com (=?gbk?B?xr2zo9DEzKw=?=)
Date: Thu, 4 Aug 2011 21:03:30 +0800
Subject: [rabbitmq-discuss] =?gbk?b?fFNwYW18ILvYuLSjuiAgRXJyb3I6IHVuYWJs?=
	=?gbk?q?e_to_connect_to_node_rabbit=40dev=3A_nodedown?=
Message-ID: <tencent_3CFCB96826E4280278748829@qq.com>

i had tried "rabbitmqctl -n rabbit at Fanqu-WorkStation status" before, it didn't work!
 
 
------------------ ???? ------------------
???: "Marek Majkowski"; 
????: 2011?8?4?(???) ??7:28
???: "????"<214575002 at qq.com>; 
??: "rabbitmq-discuss"; 
??: Re: [rabbitmq-discuss] Error: unable to connect to node rabbit at dev: nodedown

 
2011/8/4 ???? <214575002 at qq.com>:
> hi, all
>     some error come up when I want to get some status of my rabbitmq-server
>     the site http://www.rabbitmq.com/install.html#troubleshooting said that
> I should make sure the erlang cookies are the same, but I am new to erlang
> ,I don't know how to make sure.
> below is the output,
>     /------------------------------------rabbitmqctl
> status-------------------------------/
> dev at dev:~/source/rabbitmq/sbin$ ./rabbitmqctl status
> Status of node rabbit at dev ...
> Error: unable to connect to node rabbit at dev: nodedown
> =ERROR REPORT==== 4-Aug-2011::09:29:10 ===
> Error in process <0.36.0> on node 'rabbitmqctl14242 at dev' with exit value:
> {badarg,[{erlang,list_to_existing_atom,["rabbit at Fanqu-WorkStation"]},{dist_util,recv_challenge,1},{dist_util,handshake_we_started,1}]}
> diagnostics:
> - nodes and their ports on dev: [{rabbit,56129},{rabbitmqctl14242,38839}]
> - current node: rabbitmqctl14242 at dev
> - current node home dir: /home/dev
> - current node cookie hash: t6gCD5tZzOtYsVS32gQgwA==
>     /------------------------------------hostname
> -s-------------------------------/
> dev at dev:~/source/rabbitmq/sbin$ hostname -s
> dev
> dev at dev:~/source/rabbitmq/sbin$ cat /etc/hosts
> 127.0.0.1       localhost
> 127.0.1.1       dev
>     /------------------------------------ps aux | grep beam
> -------------------------------/
> dev at dev:~/source/rabbitmq/sbin$ ps aux | grep beam
> dev      21051  0.0  0.3  56980  8080 ?        Sl   Jul26   3:44
> /usr/lib/erlang/erts-5.7.4/bin/beam.smp -W w -K true -A30 -P 1048576 --
> -root /usr/lib/erlang -progname erl -- -home /home/dev -- -noshell -noinput
> -sname rabbit at Fanqu-WorkStation -boot
> /home/dev/rabbitmq/data/rabbit at Fanqu-WorkStation-plugins-expand/rabbit
> -kernel inet_default_listen_options [{nodelay,true}] -kernel
> inet_default_connect_options [{nodelay,true}] -sasl errlog_type error
> -kernel error_logger
> {file,"/home/dev/rabbitmq/log/rabbit at Fanqu-WorkStation.log"} -sasl
> sasl_error_logger
> {file,"/home/dev/rabbitmq/log/rabbit at Fanqu-WorkStation-sasl.log"} -os_mon
> start_cpu_sup true -os_mon start_disksup false -os_mon start_memsup false
> -mnesia dir "/home/dev/rabbitmq/data/rabbit at Fanqu-WorkStation" -noshell
> -noinput
> dev      30911  0.0  0.0   3552   916 pts/2    S+   09:40   0:00 grep
> --color=auto beam

You seem to have rabbit running as "rabbit at Fanqu-WorkStation" while your
rabbitmqctl asks for "rabbit at dev".

If "Fanqu-WorkStation" is a proper network name, you should be able to
do "rabbitmqctl -n rabbit at Fanqu-WorkStation status"

Cheers,
   Marek
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110804/0951054b/attachment.htm>

From david at rabbitmq.com  Thu Aug  4 15:20:59 2011
From: david at rabbitmq.com (David Wragg)
Date: Thu, 04 Aug 2011 15:20:59 +0100
Subject: [rabbitmq-discuss] RabbitMQ RPM and its dependencies
In-Reply-To: <CAMOXM29+Arw6wP1n-KGNsOnOZ9wu+oHYhwkZTecxEwh8-SUnpw@mail.gmail.com>
	(Massimo Paladin's message of "Thu, 4 Aug 2011 13:18:45 +0200")
References: <CAMOXM29+Arw6wP1n-KGNsOnOZ9wu+oHYhwkZTecxEwh8-SUnpw@mail.gmail.com>
Message-ID: <yrv4cfwlh5kc4.fsf@dwragg.eng.vmware.com>

Massimo Paladin <Massimo.Paladin at cern.ch> writes:
> RabbitMQ RPM requires erlang which is provided by a lot of
> sub-packages.

The Fedora/EPEL erlang RPM only got separated up into many packages
relatively recently (about a year ago, I think).  So depending on the
sub-packages would limit which releases of distributions our RPM will
work on.
So, in order to support a wide range of distributions, our RPM still
depends simply on "erlang".

I expect we will reconsider this one day, but it is probably still too
early today.

(Unlike RPM, dpkg supports disjunctions of dependencies, so our Debian
packages don't present this dilemma.)

-- 
David Wragg
Staff Engineer, RabbitMQ
VMware, Inc.

From lemenkov at gmail.com  Thu Aug  4 15:49:59 2011
From: lemenkov at gmail.com (Peter Lemenkov)
Date: Thu, 4 Aug 2011 18:49:59 +0400
Subject: [rabbitmq-discuss] RabbitMQ RPM and its dependencies
In-Reply-To: <yrv4cfwlh5kc4.fsf@dwragg.eng.vmware.com>
References: <CAMOXM29+Arw6wP1n-KGNsOnOZ9wu+oHYhwkZTecxEwh8-SUnpw@mail.gmail.com>
	<yrv4cfwlh5kc4.fsf@dwragg.eng.vmware.com>
Message-ID: <CANDpMDuZfdCFjtG3_y+M=P1pekbThVRcnD-MGjFVQBa1DEQtcA@mail.gmail.com>

2011/8/4 David Wragg <david at rabbitmq.com>:
> Massimo Paladin <Massimo.Paladin at cern.ch> writes:
>> RabbitMQ RPM requires erlang which is provided by a lot of
>> sub-packages.
>
> The Fedora/EPEL erlang RPM only got separated up into many packages
> relatively recently (about a year ago, I think). ?So depending on the
> sub-packages would limit which releases of distributions our RPM will
> work on.
> So, in order to support a wide range of distributions, our RPM still
> depends simply on "erlang".
>
> I expect we will reconsider this one day, but it is probably still too
> early today.

I already wrote semi-automatically working bunch of scripts (with
hardcoded paths and variables and other ugly stuff like that) to
manage issues like these (automatic Erlang dependency extraction). We
(I and one brave intern from Erlang Solutions, Micha? Nie?) planned to
finish this task during GSoC but, unfortunately, we didn't get chosen.
Anyway I plan to return to this task as soon as I find free time, so
stay tuned.

As for RabbitMQ, I'll take a look - perhaps I could slim dependency
chain manually (with these semi-automatically working scripts
mentioned above).

BTW where is Hubert Plociniczak? Is he still around? I'm afraid that
he was offended by the angry mob after unsuccessful RabbitMQ 2.1
release:

https://bugzilla.redhat.com/show_bug.cgi?id=646861
-- 
With best regards, Peter Lemenkov.

From alexis at rabbitmq.com  Thu Aug  4 16:01:47 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Thu, 4 Aug 2011 16:01:47 +0100
Subject: [rabbitmq-discuss] RabbitMQ RPM and its dependencies
In-Reply-To: <CANDpMDuZfdCFjtG3_y+M=P1pekbThVRcnD-MGjFVQBa1DEQtcA@mail.gmail.com>
References: <CAMOXM29+Arw6wP1n-KGNsOnOZ9wu+oHYhwkZTecxEwh8-SUnpw@mail.gmail.com>
	<yrv4cfwlh5kc4.fsf@dwragg.eng.vmware.com>
	<CANDpMDuZfdCFjtG3_y+M=P1pekbThVRcnD-MGjFVQBa1DEQtcA@mail.gmail.com>
Message-ID: <CACOPnvf1JwAYy_04BGEB5-FAshRCYR-odExOZoLrEGLLaW0+Ug@mail.gmail.com>

I have bcc'd Hubert.

On Thu, Aug 4, 2011 at 3:49 PM, Peter Lemenkov <lemenkov at gmail.com> wrote:
> 2011/8/4 David Wragg <david at rabbitmq.com>:
>> Massimo Paladin <Massimo.Paladin at cern.ch> writes:
>>> RabbitMQ RPM requires erlang which is provided by a lot of
>>> sub-packages.
>>
>> The Fedora/EPEL erlang RPM only got separated up into many packages
>> relatively recently (about a year ago, I think). ?So depending on the
>> sub-packages would limit which releases of distributions our RPM will
>> work on.
>> So, in order to support a wide range of distributions, our RPM still
>> depends simply on "erlang".
>>
>> I expect we will reconsider this one day, but it is probably still too
>> early today.
>
> I already wrote semi-automatically working bunch of scripts (with
> hardcoded paths and variables and other ugly stuff like that) to
> manage issues like these (automatic Erlang dependency extraction). We
> (I and one brave intern from Erlang Solutions, Micha? Nie?) planned to
> finish this task during GSoC but, unfortunately, we didn't get chosen.
> Anyway I plan to return to this task as soon as I find free time, so
> stay tuned.
>
> As for RabbitMQ, I'll take a look - perhaps I could slim dependency
> chain manually (with these semi-automatically working scripts
> mentioned above).
>
> BTW where is Hubert Plociniczak? Is he still around? I'm afraid that
> he was offended by the angry mob after unsuccessful RabbitMQ 2.1
> release:
>
> https://bugzilla.redhat.com/show_bug.cgi?id=646861
> --
> With best regards, Peter Lemenkov.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From davegreggory at yahoo.com  Thu Aug  4 18:40:06 2011
From: davegreggory at yahoo.com (Dave Greggory)
Date: Thu, 4 Aug 2011 10:40:06 -0700 (PDT)
Subject: [rabbitmq-discuss] Channel error
Message-ID: <1312479606.50183.YahooMailNeo@web111005.mail.gq1.yahoo.com>

We upgraded to RabbitMQ 2.5.1 from 2.0.0 and have been running 2.5.1 in production for over month. We have monitoring in on rabbitmq log that alerts us whenever there's any entries in those logs that we do not expect. Basically we look for lines that match following query. 


Query Terms: 'host=rabbitmq* AND NOT
"starting TCP connection" AND NOT "closing TCP connection"
AND NOT "accepted TCP connection" AND NOT
"connection_closed_abruptly" AND NOT "timeout,running"' 

Several times within the last week or so, it alerted us with the following error in the SASL logs. Client functionality seems to be unaffected, but I'm curious to what this error means. Can anybody from the Rabbit team clarify?

=SUPERVISOR REPORT==== 3-Aug-2011::14:22:30 ===
???? Supervisor: {<0.16968.672>,
?????????????????????????????????????????? rabbit_channel_sup_sup}
???? Context:??? shutdown_error
???? Reason:???? shutdown
???? Offender:?? [{pid,<0.20327.672>},
????????????????? {name,channel_sup},
????????????????? {mfa,{rabbit_channel_sup,start_link,[]}},
????????????????? {restart_type,temporary},
????????????????? {shutdown,infinity},
????????????????? {child_type,supervisor}]



Usage pattern -

6 fanout exchanges used for publish/subscribe pattern with 56 exclusive, auto-deleting queues (total, not each) bound to them
37 topic exchanges used for work queue pattern with 34 durable queues (total, not each) bound to them

At peak times we have less than 100 messages/sec going through RabbitMQ
Total connections = ~60-70 (2 connections each per app node, 1 for producing, 1 for consuming)
Heartbeat of 30 seconds enabled, no transactions used, work queue messages are persistent


RabbitMQ setup info -

[13:22:00 rabbitmq at rabbitmq1 /opt/rabbitmq_server/sbin] ./rabbitmqctl status
Status of node rabbit at rabbitmq1 ...
[{pid,3841},
?{running_applications,
???? [{rabbitmq_management,"RabbitMQ Management Console","2.5.1"},
????? {webmachine,"webmachine","1.7.0-rmq2.5.1-hg0c4b60a"},
????? {rabbitmq_management_agent,"RabbitMQ Management Agent","2.5.1"},
????? {amqp_client,"RabbitMQ AMQP Client","2.5.1"},
????? {rabbit,"RabbitMQ","2.5.1"},
????? {os_mon,"CPO? CXC 138 46","2.2.5"},
????? {sasl,"SASL? CXC 138 11","2.1.9"},
????? {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.5.1"},
????? {mochiweb,"MochiMedia Web Server","1.3-rmq2.5.1-git9a53dbd"},
????? {inets,"INETS? CXC 138 49","5.3"},
????? {mnesia,"MNESIA? CXC 138 12","4.4.13"},
????? {stdlib,"ERTS? CXC 138 10","1.16.5"},
????? {kernel,"ERTS? CXC 138 10","2.13.5"}]},
?{os,{unix,linux}},
?{erlang_version,
???? "Erlang R13B04 (erts-5.7.5) [source] [64-bit] [smp:2:2] [rq:2] [async-threads:30] [hipe] [kernel-poll:true]\n"},
?{memory,
???? [{total,149009336},
????? {processes,82465760},
????? {processes_used,82358928},
????? {system,66543576},
????? {atom,1279561},
????? {atom_used,1275735},
????? {binary,5745136},
????? {code,15200224},
????? {ets,7624288}]}]
...done.


From alexandru at rabbitmq.com  Thu Aug  4 18:51:49 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Thu, 4 Aug 2011 18:51:49 +0100
Subject: [rabbitmq-discuss] Channel error
In-Reply-To: <1312479606.50183.YahooMailNeo@web111005.mail.gq1.yahoo.com>
References: <1312479606.50183.YahooMailNeo@web111005.mail.gq1.yahoo.com>
Message-ID: <20110804175149.GA2887@dakota.eng.vmware.com>

Hi,

We've had reports of similar errors to this (not exactly this one,
though).  We have a bug open, but we haven't been able to
reproduce them.

As far as we know, it doesn't cause any problems on either the client or
the server; it's just annoying.

> Usage pattern -
> 
> 6 fanout exchanges used for publish/subscribe pattern with 56 exclusive, auto-deleting queues (total, not each) bound to them
> 37 topic exchanges used for work queue pattern with 34 durable queues (total, not each) bound to them

Thanks for the info.  We'll have another look at this issue soon.

> We upgraded to RabbitMQ 2.5.1 from 2.0.0 and have been running 2.5.1 in production for over month. 

I don't suppose you had the script running for 2.0.0 and can confirm
that the error doesn't happen there, right?

Cheers,
Alex

On Thu, Aug 04, 2011 at 10:40:06AM -0700, Dave Greggory wrote:
> We upgraded to RabbitMQ 2.5.1 from 2.0.0 and have been running 2.5.1 in production for over month. We have monitoring in on rabbitmq log that alerts us whenever there's any entries in those logs that we do not expect. Basically we look for lines that match following query. 
> 
> 
> Query Terms: 'host=rabbitmq* AND NOT
> "starting TCP connection" AND NOT "closing TCP connection"
> AND NOT "accepted TCP connection" AND NOT
> "connection_closed_abruptly" AND NOT "timeout,running"' 
> 
> Several times within the last week or so, it alerted us with the following error in the SASL logs. Client functionality seems to be unaffected, but I'm curious to what this error means. Can anybody from the Rabbit team clarify?
> 
> =SUPERVISOR REPORT==== 3-Aug-2011::14:22:30 ===
> ???? Supervisor: {<0.16968.672>,
> ?????????????????????????????????????????? rabbit_channel_sup_sup}
> ???? Context:??? shutdown_error
> ???? Reason:???? shutdown
> ???? Offender:?? [{pid,<0.20327.672>},
> ????????????????? {name,channel_sup},
> ????????????????? {mfa,{rabbit_channel_sup,start_link,[]}},
> ????????????????? {restart_type,temporary},
> ????????????????? {shutdown,infinity},
> ????????????????? {child_type,supervisor}]
> 
> 
> 
> Usage pattern -
> 
> 6 fanout exchanges used for publish/subscribe pattern with 56 exclusive, auto-deleting queues (total, not each) bound to them
> 37 topic exchanges used for work queue pattern with 34 durable queues (total, not each) bound to them
> 
> At peak times we have less than 100 messages/sec going through RabbitMQ
> Total connections = ~60-70 (2 connections each per app node, 1 for producing, 1 for consuming)
> Heartbeat of 30 seconds enabled, no transactions used, work queue messages are persistent
> 
> 
> RabbitMQ setup info -
> 
> [13:22:00 rabbitmq at rabbitmq1 /opt/rabbitmq_server/sbin] ./rabbitmqctl status
> Status of node rabbit at rabbitmq1 ...
> [{pid,3841},
> ?{running_applications,
> ???? [{rabbitmq_management,"RabbitMQ Management Console","2.5.1"},
> ????? {webmachine,"webmachine","1.7.0-rmq2.5.1-hg0c4b60a"},
> ????? {rabbitmq_management_agent,"RabbitMQ Management Agent","2.5.1"},
> ????? {amqp_client,"RabbitMQ AMQP Client","2.5.1"},
> ????? {rabbit,"RabbitMQ","2.5.1"},
> ????? {os_mon,"CPO? CXC 138 46","2.2.5"},
> ????? {sasl,"SASL? CXC 138 11","2.1.9"},
> ????? {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.5.1"},
> ????? {mochiweb,"MochiMedia Web Server","1.3-rmq2.5.1-git9a53dbd"},
> ????? {inets,"INETS? CXC 138 49","5.3"},
> ????? {mnesia,"MNESIA? CXC 138 12","4.4.13"},
> ????? {stdlib,"ERTS? CXC 138 10","1.16.5"},
> ????? {kernel,"ERTS? CXC 138 10","2.13.5"}]},
> ?{os,{unix,linux}},
> ?{erlang_version,
> ???? "Erlang R13B04 (erts-5.7.5) [source] [64-bit] [smp:2:2] [rq:2] [async-threads:30] [hipe] [kernel-poll:true]\n"},
> ?{memory,
> ???? [{total,149009336},
> ????? {processes,82465760},
> ????? {processes_used,82358928},
> ????? {system,66543576},
> ????? {atom,1279561},
> ????? {atom_used,1275735},
> ????? {binary,5745136},
> ????? {code,15200224},
> ????? {ets,7624288}]}]
> ...done.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From davegreggory at yahoo.com  Thu Aug  4 19:24:34 2011
From: davegreggory at yahoo.com (Dave Greggory)
Date: Thu, 4 Aug 2011 11:24:34 -0700 (PDT)
Subject: [rabbitmq-discuss] Channel error
In-Reply-To: <20110804175149.GA2887@dakota.eng.vmware.com>
References: <1312479606.50183.YahooMailNeo@web111005.mail.gq1.yahoo.com>
	<20110804175149.GA2887@dakota.eng.vmware.com>
Message-ID: <1312482274.33057.YahooMailNeo@web111003.mail.gq1.yahoo.com>

I can confirm that error never happened on 2.0.0. Let me know if you need any other information. Can you tell me what this error means (does it mean a channel was closed by server? Does it affect producing channels or consuming channels?).



----- Original Message -----
From: Alexandru Scvor?ov <alexandru at rabbitmq.com>
To: Dave Greggory <davegreggory at yahoo.com>
Cc: "rabbitmq-discuss at lists.rabbitmq.com" <rabbitmq-discuss at lists.rabbitmq.com>
Sent: Thursday, August 4, 2011 1:51 PM
Subject: Re: [rabbitmq-discuss] Channel error

Hi,

We've had reports of similar errors to this (not exactly this one,
though).? We have a bug open, but we haven't been able to
reproduce them.

As far as we know, it doesn't cause any problems on either the client or
the server; it's just annoying.

> Usage pattern -
> 
> 6 fanout exchanges used for publish/subscribe pattern with 56 exclusive, auto-deleting queues (total, not each) bound to them
> 37 topic exchanges used for work queue pattern with 34 durable queues (total, not each) bound to them

Thanks for the info.? We'll have another look at this issue soon.

> We upgraded to RabbitMQ 2.5.1 from 2.0.0 and have been running 2.5.1 in production for over month. 

I don't suppose you had the script running for 2.0.0 and can confirm
that the error doesn't happen there, right?

Cheers,
Alex

On Thu, Aug 04, 2011 at 10:40:06AM -0700, Dave Greggory wrote:
> We upgraded to RabbitMQ 2.5.1 from 2.0.0 and have been running 2.5.1 in production for over month. We have monitoring in on rabbitmq log that alerts us whenever there's any entries in those logs that we do not expect. Basically we look for lines that match following query. 
> 
> 
> Query Terms: 'host=rabbitmq* AND NOT
> "starting TCP connection" AND NOT "closing TCP connection"
> AND NOT "accepted TCP connection" AND NOT
> "connection_closed_abruptly" AND NOT "timeout,running"' 
> 
> Several times within the last week or so, it alerted us with the following error in the SASL logs. Client functionality seems to be unaffected, but I'm curious to what this error means. Can anybody from the Rabbit team clarify?
> 
> =SUPERVISOR REPORT==== 3-Aug-2011::14:22:30 ===
> ???? Supervisor: {<0.16968.672>,
> ?????????????????????????????????????????? rabbit_channel_sup_sup}
> ???? Context:??? shutdown_error
> ???? Reason:???? shutdown
> ???? Offender:?? [{pid,<0.20327.672>},
> ????????????????? {name,channel_sup},
> ????????????????? {mfa,{rabbit_channel_sup,start_link,[]}},
> ????????????????? {restart_type,temporary},
> ????????????????? {shutdown,infinity},
> ????????????????? {child_type,supervisor}]
> 
> 
> 
> Usage pattern -
> 
> 6 fanout exchanges used for publish/subscribe pattern with 56 exclusive, auto-deleting queues (total, not each) bound to them
> 37 topic exchanges used for work queue pattern with 34 durable queues (total, not each) bound to them
> 
> At peak times we have less than 100 messages/sec going through RabbitMQ
> Total connections = ~60-70 (2 connections each per app node, 1 for producing, 1 for consuming)
> Heartbeat of 30 seconds enabled, no transactions used, work queue messages are persistent
> 
> 
> RabbitMQ setup info -
> 
> [13:22:00 rabbitmq at rabbitmq1 /opt/rabbitmq_server/sbin] ./rabbitmqctl status
> Status of node rabbit at rabbitmq1 ...
> [{pid,3841},
> ?{running_applications,
> ???? [{rabbitmq_management,"RabbitMQ Management Console","2.5.1"},
> ????? {webmachine,"webmachine","1.7.0-rmq2.5.1-hg0c4b60a"},
> ????? {rabbitmq_management_agent,"RabbitMQ Management Agent","2.5.1"},
> ????? {amqp_client,"RabbitMQ AMQP Client","2.5.1"},
> ????? {rabbit,"RabbitMQ","2.5.1"},
> ????? {os_mon,"CPO? CXC 138 46","2.2.5"},
> ????? {sasl,"SASL? CXC 138 11","2.1.9"},
> ????? {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.5.1"},
> ????? {mochiweb,"MochiMedia Web Server","1.3-rmq2.5.1-git9a53dbd"},
> ????? {inets,"INETS? CXC 138 49","5.3"},
> ????? {mnesia,"MNESIA? CXC 138 12","4.4.13"},
> ????? {stdlib,"ERTS? CXC 138 10","1.16.5"},
> ????? {kernel,"ERTS? CXC 138 10","2.13.5"}]},
> ?{os,{unix,linux}},
> ?{erlang_version,
> ???? "Erlang R13B04 (erts-5.7.5) [source] [64-bit] [smp:2:2] [rq:2] [async-threads:30] [hipe] [kernel-poll:true]\n"},
> ?{memory,
> ???? [{total,149009336},
> ????? {processes,82465760},
> ????? {processes_used,82358928},
> ????? {system,66543576},
> ????? {atom,1279561},
> ????? {atom_used,1275735},
> ????? {binary,5745136},
> ????? {code,15200224},
> ????? {ets,7624288}]}]
> ...done.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From sid.ravichandran at gmail.com  Thu Aug  4 20:19:08 2011
From: sid.ravichandran at gmail.com (sid__)
Date: Thu, 4 Aug 2011 12:19:08 -0700 (PDT)
Subject: [rabbitmq-discuss] How to use Long Polling with RabbitMQ and Rails
Message-ID: <9625a4e4-2e4c-4949-bd83-518ddb9056d2@a2g2000prf.googlegroups.com>

I have just begun using RabbitMQ with Ruby using the amqp ruby gem. I
built a simple multiuser chat application using Rails, which manages
the user subscription, authentication and rooms etc and the AMQP
server manages the messaging. My amqp server runs as a daemon process
and the Rails application communicates with it using websockets and
TCPSockets.

Since websockets is not supported on all browsers I think Long Polling
is the only other alternative to push message to the users in a
chatroom.

I am not completely sure on how to go about doing this since my AMQP
server runs on a different port so it would violate the same origin
policy unless I use JSONP which would work only with GET requests and
it would need some kind of HTTP request handler.

I am familiar with how orbited provides long polling for XMPP servers
but I was unable to find a similar javascript library for AMQP

I would also like to know if production amqp apps have their messaging
server running separately as a daemon or are they usually run as part
of the main application.

I would appreciate some guidance on how to go about building this. My
code is available on my github profile and is available at
https://github.com/supersid/AMQP-Server-Using-Websocket-OO  Please
ignore the amqp_server.rb file which is not really used and
oo_amqp_server.rb is the starting point

Thank you.




From michael.s.klishin at gmail.com  Thu Aug  4 21:03:57 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 5 Aug 2011 00:03:57 +0400
Subject: [rabbitmq-discuss] How to use Long Polling with RabbitMQ and
	Rails
In-Reply-To: <9625a4e4-2e4c-4949-bd83-518ddb9056d2@a2g2000prf.googlegroups.com>
References: <9625a4e4-2e4c-4949-bd83-518ddb9056d2@a2g2000prf.googlegroups.com>
Message-ID: <CAE3HoVTfDw5daJQ=aR0HOb2aioKiU0OTw=hbNRY-mi_1J=2+xg@mail.gmail.com>

2011/8/4 sid__ <sid.ravichandran at gmail.com>

> I am unable to figure how one would go about doing this. Since they
> run on separate ports there would be the issue of violating the same
> origin policy.
>
> I am familiar with how Orbited provides long polling support for XMPP
> but I was unable to find something similar for AMQP. But how would the
> AMQP server respond without and explicit HTTP Request handler.
>
> I would really appreciate some help on how this should be implemented.
> Some sample code would be great.
>
>
You can combined multiple EventMachine-based servers in the same process.
You can combine em-websocket, amqp gem and something that helps you with
long polling (it probably can be something Thin or Goliath-based).


> Also I would like to know if the general practice is to run the AMQP
> server as daemon or as part of Rails app.
>

I typically recommend running amqp daemons as satellite applications but
there are certainly cases when people run amqp daemons
basically embedded into Web applications. Just keep in mind Ruby 1.8.7
threading scheduler is not really fair (some threads may be given
significantly more time to run than others) and while 1.9.2 uses kernel
threads that are a lot better in this regard, I have seen obscure 1.9.2 VM
crashes with  multithreaded applications.

-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110805/867c1be5/attachment.htm>

From ludy at wawame.cn  Fri Aug  5 05:04:55 2011
From: ludy at wawame.cn (ludy)
Date: Fri, 05 Aug 2011 12:04:55 +0800
Subject: [rabbitmq-discuss] problem for a cluster
Message-ID: <1312517095.2479.12.camel@ludy-linux>

i created a cluster of two nodes,one is named rabbit,another is named
hare.if count of connections from clients is greater than socket
descriptors of a node ,then the socket descriptors of node rabbit is
full,is 829/829,my question is that why the socket descriptors of
another node hare is still 1/829 ,why not increased ?????


From hubert.plociniczak at gmail.com  Fri Aug  5 07:42:35 2011
From: hubert.plociniczak at gmail.com (Hubert Plociniczak)
Date: Fri, 05 Aug 2011 08:42:35 +0200
Subject: [rabbitmq-discuss] RabbitMQ RPM and its dependencies
In-Reply-To: <CACOPnvf1JwAYy_04BGEB5-FAshRCYR-odExOZoLrEGLLaW0+Ug@mail.gmail.com>
References: <CAMOXM29+Arw6wP1n-KGNsOnOZ9wu+oHYhwkZTecxEwh8-SUnpw@mail.gmail.com>	<yrv4cfwlh5kc4.fsf@dwragg.eng.vmware.com>	<CANDpMDuZfdCFjtG3_y+M=P1pekbThVRcnD-MGjFVQBa1DEQtcA@mail.gmail.com>
	<CACOPnvf1JwAYy_04BGEB5-FAshRCYR-odExOZoLrEGLLaW0+Ug@mail.gmail.com>
Message-ID: <4E3B90DB.3000102@gmail.com>

Hi all,

On 08/04/2011 05:01 PM, Alexis Richardson wrote:
> I have bcc'd Hubert.
>
> On Thu, Aug 4, 2011 at 3:49 PM, Peter Lemenkov<lemenkov at gmail.com>  wrote:
>> 2011/8/4 David Wragg<david at rabbitmq.com>:
>>> Massimo Paladin<Massimo.Paladin at cern.ch>  writes:
>>>> RabbitMQ RPM requires erlang which is provided by a lot of
>>>> sub-packages.
>>> The Fedora/EPEL erlang RPM only got separated up into many packages
>>> relatively recently (about a year ago, I think).  So depending on the
>>> sub-packages would limit which releases of distributions our RPM will
>>> work on.
>>> So, in order to support a wide range of distributions, our RPM still
>>> depends simply on "erlang".
>>>
>>> I expect we will reconsider this one day, but it is probably still too
>>> early today.
>> I already wrote semi-automatically working bunch of scripts (with
>> hardcoded paths and variables and other ugly stuff like that) to
>> manage issues like these (automatic Erlang dependency extraction). We
>> (I and one brave intern from Erlang Solutions, Micha? Nie?) planned to
>> finish this task during GSoC but, unfortunately, we didn't get chosen.
>> Anyway I plan to return to this task as soon as I find free time, so
>> stay tuned.
>>
>> As for RabbitMQ, I'll take a look - perhaps I could slim dependency
>> chain manually (with these semi-automatically working scripts
>> mentioned above).
>>
>> BTW where is Hubert Plociniczak? Is he still around? I'm afraid that
>> he was offended by the angry mob after unsuccessful RabbitMQ 2.1
>> release:
>>
>> https://bugzilla.redhat.com/show_bug.cgi?id=646861

I wasn't offended. I used to be able to do updates fairly regularly but 
because of my current work responsibilities (I do not work for rabbitmq) 
I have little time for my other hobbies (like fedora packaging).

So if there is any good soul with decent understanding of fedora 
packaging process and erlang/rabbitmq knowledge then I would be willing 
to pass it over to him/her.

Thanks Alexis for including me in the conversation, I admit I rarely 
look into this mailing list nowadays.

Thanks,
hubert

>> --
>> With best regards, Peter Lemenkov.
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>


From ekirpichov at gmail.com  Fri Aug  5 08:24:17 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Fri, 5 Aug 2011 11:24:17 +0400
Subject: [rabbitmq-discuss] problem for a cluster
In-Reply-To: <1312517095.2479.12.camel@ludy-linux>
References: <1312517095.2479.12.camel@ludy-linux>
Message-ID: <074308A4-5D42-4F01-8E85-B2853465E4DB@gmail.com>

Maybe because your clients request a connection to rabbit, not hare? Rabbitmq doesn't do connection redirection, you have to loadbalance manually.



05.08.2011, ? 8:04, ludy <ludy at wawame.cn> ???????(?):

> i created a cluster of two nodes,one is named rabbit,another is named
> hare.if count of connections from clients is greater than socket
> descriptors of a node ,then the socket descriptors of node rabbit is
> full,is 829/829,my question is that why the socket descriptors of
> another node hare is still 1/829 ,why not increased ?????
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From arno.puschmann at acodeas.de  Fri Aug  5 08:51:33 2011
From: arno.puschmann at acodeas.de (Arno Puschmann)
Date: Fri, 5 Aug 2011 09:51:33 +0200
Subject: [rabbitmq-discuss] RabbitMQ and Spring
In-Reply-To: <88bbe583-fa6e-4474-9e91-5316463ce721@o26g2000vbi.googlegroups.com>
References: <27D6B27DB616654BBEF4DDB8B31EAF916B590E9526@vs-msx01.IT-NG.local>, 
	<468ecd19-1a84-4b35-934c-b16a1c36c30e@e35g2000yqc.googlegroups.com>
	<27D6B27DB616654BBEF4DDB8B31EAF916B590E9527@vs-msx01.IT-NG.local>,
	<88bbe583-fa6e-4474-9e91-5316463ce721@o26g2000vbi.googlegroups.com>
Message-ID: <27D6B27DB616654BBEF4DDB8B31EAF916B590E9528@vs-msx01.IT-NG.local>

> Can you be more specific?

I use this Code 

			template.setExchange("exchange");
			template.setQueue("someQueue");
			template.setRoutingKey("someQueue");
			Message response = template.sendAndReceive("exchange", "anotherQueue" , message);

Because I couldn't find any manual about template.sendAndReceive, I believe that the message is written on the Queue which is set through the parameters and Messages are read from the Queue which is set Default through template.setQueue and template.setExchange. 

After this my response is Null, although there is a message on the Queue.

During the Receive I get this Error on my Management Plugin

Got response code 500 with body {"error":"JSON encode error: {bad_term,<0.6351.1>}","reason":"While encoding:\n[[{memory,4128},\n {owner_pid_details,[{name,<<\"127.0.0.1:46088\">>},\n {peer_address,<<\"127.0.0.1\">>},\n {peer_port,46088}]},\n {idle_since,<<\"2011-8-5 9:20:6\">>},\n {exclusive_consumer_pid,<0.6351.1>},\n {exclusive_consumer_tag,<<\"c4df9e97-a433-4011-8287-723181e0b0af\">>},\n {messages_ready,0},\n {messages_unacknowledged,0},\n {messages,0},\n {consumers,1},\n {backing_queue_status,{struct,[{q1,0},\n {q2,0},\n {delta,[delta,undefined,0,undefined]},\n {q3,0},\n {q4,0},\n {len,0},\n {pending_acks,0},\n {outstanding_txns,0},\n {target_ram_count,infinity},\n {ram_msg_count,0},\n {ram_ack_count,0},\n {ram_index_count,0},\n {next_seq_id,0},\n {persistent_count,0},\n {avg_ingress_rate,0.0},\n {avg_egress_rate,0.0},\n {avg_ack_ingress_rate,0.0},\n {avg_ack_egress_rate,0.0}]}},\n {name,<<\"amq.gen-hBMby7Fm+ry0WBI3SZVelA==\">>},\n {vhost,<<\"/\">>},\n {durable,false},\n {auto_delete,true},\n {arguments,{struct,[]}},\n {node,'rabbit at apuschmann-laptop'}],\n [{memory,34072},\n {idle_since,<<\"2011-8-5 9:20:7\">>},\n {exclusive_consumer_pid,''},\n {exclusive_consumer_tag,''},\n {messages_ready,3},\n {messages_unacknowledged,0},\n {messages,3},\n {consumers,0},\n {backing_queue_status,{struct,[{q1,0},\n {q2,0},\n {delta,[delta,0,0,0]},\n {q3,0},\n {q4,3},\n {len,3},\n {pending_acks,0},\n {outstanding_txns,0},\n {target_ram_count,infinity},\n {ram_msg_count,3},\n {ram_ack_count,0},\n {ram_index_count,0},\n {next_seq_id,4},\n {persistent_count,3},\n {avg_ingress_rate,0.0040401263408916714},\n {avg_egress_rate,0.0},\n {avg_ack_ingress_rate,0.0},\n {avg_ack_egress_rate,0.0}]}},\n {message_stats,[{publish,1}]},\n {name,<<\"bla\">>},\n {vhost,<<\"/\">>},\n {durable,true},\n {auto_delete,false},\n {arguments,{struct,[]}},\n {node,'rabbit at apuschmann-laptop'}],\n [{memory,6352},\n {idle_since,<<\"2011-8-5 9:13:4\">>},\n {exclusive_consumer_pid,''},\n {exclusive_consumer_tag,''},\n {messages_ready,1},\n {messages_unacknowledged,0},\n {messages,1},\n {consumers,0},\n {backing_queue_status,{struct,[{q1,0},\n {q2,0},\n {delta,[delta,0,0,0]},\n {q3,0},\n {q4,1},\n {len,1},\n {pending_acks,0},\n {outstanding_txns,0},\n {target_ram_count,infinity},\n {ram_msg_count,1},\n {ram_ack_count,0},\n {ram_index_count,0},\n {next_seq_id,5},\n {persistent_count,0},\n {avg_ingress_rate,0.0},\n {avg_egress_rate,0.0531915006790427},\n {avg_ack_ingress_rate,0.0},\n {avg_ack_egress_rate,0.0}]}},\n {name,<<\"blub\">>},\n ............and so on........

After a Refresh this error is gone.
The Message is written on the Queue but, the other Message isn't read.

On the same Queues with template.send and template.receive it works fine.

> If you use SpringSource ToolSuite it
>should work (but you might need to use an explicit version number in
>your schema declaration - i.e. */spring-rabbit-1.0.xsd).

Im using SpringSource ToolSuite with the decleration 

http://www.springframework.org/schema/rabbit http://www.springframework.org/schema/rabbit/spring-rabbit-1.0.xsd">

but the same behaviour.

Thanks again.

From christian.haintz at gmail.com  Fri Aug  5 09:16:42 2011
From: christian.haintz at gmail.com (Christian Haintz)
Date: Fri, 05 Aug 2011 10:16:42 +0200
Subject: [rabbitmq-discuss] Limit user to queue
Message-ID: <4E3BA6EA.9080403@gmail.com>

Hi,

Is it possible to limit users to specific routing keys on an exchange, 
so that they only can publish messages with that specific routing keys? 
Messages published on that exchange with other routing keys should fail 
or be ignored.

My second question: Is it possible to limit a user to consume only from 
a specific queue?

Third one: Is it possible to limit a user to publish only to a specific 
exchange?

Thx in advance,
Christian

From alexandru at rabbitmq.com  Fri Aug  5 09:25:05 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Fri, 5 Aug 2011 09:25:05 +0100
Subject: [rabbitmq-discuss] Channel error
In-Reply-To: <1312482274.33057.YahooMailNeo@web111003.mail.gq1.yahoo.com>
References: <1312479606.50183.YahooMailNeo@web111005.mail.gq1.yahoo.com>
	<20110804175149.GA2887@dakota.eng.vmware.com>
	<1312482274.33057.YahooMailNeo@web111003.mail.gq1.yahoo.com>
Message-ID: <20110805082505.GA2718@dakota.eng.vmware.com>

> I can confirm that error never happened on 2.0.0. Let me know if you need any other information.

Thank you.

> Can you tell me what this error means (does it mean a channel was closed by server?

It happens when the server is closing a connection.  The error seems to
mean that we're trying to shutdown the same process twice, and we're not
sure exactly how that can happen.

Channel_sup_sup is the process that supervises all the channels in a
connection.  Its supervisor is complaining that we tried to shut it down
twice.

> Does it affect producing channels or consuming channels?).

Not that we know of, no.  The error happens when closing a connection
and doesn't affect other connections.

Cheers,
Alex

On Thu, Aug 04, 2011 at 11:24:34AM -0700, Dave Greggory wrote:
> I can confirm that error never happened on 2.0.0. Let me know if you need any other information. Can you tell me what this error means (does it mean a channel was closed by server? Does it affect producing channels or consuming channels?).
> 
> 
> 
> ----- Original Message -----
> From: Alexandru Scvor?ov <alexandru at rabbitmq.com>
> To: Dave Greggory <davegreggory at yahoo.com>
> Cc: "rabbitmq-discuss at lists.rabbitmq.com" <rabbitmq-discuss at lists.rabbitmq.com>
> Sent: Thursday, August 4, 2011 1:51 PM
> Subject: Re: [rabbitmq-discuss] Channel error
> 
> Hi,
> 
> We've had reports of similar errors to this (not exactly this one,
> though).? We have a bug open, but we haven't been able to
> reproduce them.
> 
> As far as we know, it doesn't cause any problems on either the client or
> the server; it's just annoying.
> 
> > Usage pattern -
> > 
> > 6 fanout exchanges used for publish/subscribe pattern with 56 exclusive, auto-deleting queues (total, not each) bound to them
> > 37 topic exchanges used for work queue pattern with 34 durable queues (total, not each) bound to them
> 
> Thanks for the info.? We'll have another look at this issue soon.
> 
> > We upgraded to RabbitMQ 2.5.1 from 2.0.0 and have been running 2.5.1 in production for over month. 
> 
> I don't suppose you had the script running for 2.0.0 and can confirm
> that the error doesn't happen there, right?
> 
> Cheers,
> Alex
> 
> On Thu, Aug 04, 2011 at 10:40:06AM -0700, Dave Greggory wrote:
> > We upgraded to RabbitMQ 2.5.1 from 2.0.0 and have been running 2.5.1 in production for over month. We have monitoring in on rabbitmq log that alerts us whenever there's any entries in those logs that we do not expect. Basically we look for lines that match following query. 
> > 
> > 
> > Query Terms: 'host=rabbitmq* AND NOT
> > "starting TCP connection" AND NOT "closing TCP connection"
> > AND NOT "accepted TCP connection" AND NOT
> > "connection_closed_abruptly" AND NOT "timeout,running"' 
> > 
> > Several times within the last week or so, it alerted us with the following error in the SASL logs. Client functionality seems to be unaffected, but I'm curious to what this error means. Can anybody from the Rabbit team clarify?
> > 
> > =SUPERVISOR REPORT==== 3-Aug-2011::14:22:30 ===
> > ???? Supervisor: {<0.16968.672>,
> > ?????????????????????????????????????????? rabbit_channel_sup_sup}
> > ???? Context:??? shutdown_error
> > ???? Reason:???? shutdown
> > ???? Offender:?? [{pid,<0.20327.672>},
> > ????????????????? {name,channel_sup},
> > ????????????????? {mfa,{rabbit_channel_sup,start_link,[]}},
> > ????????????????? {restart_type,temporary},
> > ????????????????? {shutdown,infinity},
> > ????????????????? {child_type,supervisor}]
> > 
> > 
> > 
> > Usage pattern -
> > 
> > 6 fanout exchanges used for publish/subscribe pattern with 56 exclusive, auto-deleting queues (total, not each) bound to them
> > 37 topic exchanges used for work queue pattern with 34 durable queues (total, not each) bound to them
> > 
> > At peak times we have less than 100 messages/sec going through RabbitMQ
> > Total connections = ~60-70 (2 connections each per app node, 1 for producing, 1 for consuming)
> > Heartbeat of 30 seconds enabled, no transactions used, work queue messages are persistent
> > 
> > 
> > RabbitMQ setup info -
> > 
> > [13:22:00 rabbitmq at rabbitmq1 /opt/rabbitmq_server/sbin] ./rabbitmqctl status
> > Status of node rabbit at rabbitmq1 ...
> > [{pid,3841},
> > ?{running_applications,
> > ???? [{rabbitmq_management,"RabbitMQ Management Console","2.5.1"},
> > ????? {webmachine,"webmachine","1.7.0-rmq2.5.1-hg0c4b60a"},
> > ????? {rabbitmq_management_agent,"RabbitMQ Management Agent","2.5.1"},
> > ????? {amqp_client,"RabbitMQ AMQP Client","2.5.1"},
> > ????? {rabbit,"RabbitMQ","2.5.1"},
> > ????? {os_mon,"CPO? CXC 138 46","2.2.5"},
> > ????? {sasl,"SASL? CXC 138 11","2.1.9"},
> > ????? {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.5.1"},
> > ????? {mochiweb,"MochiMedia Web Server","1.3-rmq2.5.1-git9a53dbd"},
> > ????? {inets,"INETS? CXC 138 49","5.3"},
> > ????? {mnesia,"MNESIA? CXC 138 12","4.4.13"},
> > ????? {stdlib,"ERTS? CXC 138 10","1.16.5"},
> > ????? {kernel,"ERTS? CXC 138 10","2.13.5"}]},
> > ?{os,{unix,linux}},
> > ?{erlang_version,
> > ???? "Erlang R13B04 (erts-5.7.5) [source] [64-bit] [smp:2:2] [rq:2] [async-threads:30] [hipe] [kernel-poll:true]\n"},
> > ?{memory,
> > ???? [{total,149009336},
> > ????? {processes,82465760},
> > ????? {processes_used,82358928},
> > ????? {system,66543576},
> > ????? {atom,1279561},
> > ????? {atom_used,1275735},
> > ????? {binary,5745136},
> > ????? {code,15200224},
> > ????? {ets,7624288}]}]
> > ...done.
> > 
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 

From simon at rabbitmq.com  Fri Aug  5 10:10:15 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 05 Aug 2011 10:10:15 +0100
Subject: [rabbitmq-discuss] RabbitMQ and Spring
In-Reply-To: <27D6B27DB616654BBEF4DDB8B31EAF916B590E9528@vs-msx01.IT-NG.local>
References: <27D6B27DB616654BBEF4DDB8B31EAF916B590E9526@vs-msx01.IT-NG.local>,
	<468ecd19-1a84-4b35-934c-b16a1c36c30e@e35g2000yqc.googlegroups.com>	<27D6B27DB616654BBEF4DDB8B31EAF916B590E9527@vs-msx01.IT-NG.local>,
	<88bbe583-fa6e-4474-9e91-5316463ce721@o26g2000vbi.googlegroups.com>
	<27D6B27DB616654BBEF4DDB8B31EAF916B590E9528@vs-msx01.IT-NG.local>
Message-ID: <4E3BB377.2040204@rabbitmq.com>

On 05/08/11 08:51, Arno Puschmann wrote:
> During the Receive I get this Error on my Management Plugin

Hi Arno. This is a known bug in mgmt for 2.5.1. See the discussion 
starting here:

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-July/014023.html

There's a fixed version available here:

http://www.rabbitmq.com/releases/plugins/v2.5.1/rabbitmq_management-2.5.1-exclusive-consumer-fix.ez

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From michael.s.klishin at gmail.com  Fri Aug  5 10:59:39 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 5 Aug 2011 13:59:39 +0400
Subject: [rabbitmq-discuss] Limit user to queue
In-Reply-To: <4E3BA6EA.9080403@gmail.com>
References: <4E3BA6EA.9080403@gmail.com>
Message-ID: <CAE3HoVTrJknwt0Pn7Lrmj+BMueeBRY+B6hy=0A1rbUoT4nZrSw@mail.gmail.com>

2011/8/5 Christian Haintz <christian.haintz at gmail.com>

> Is it possible to limit users to specific routing keys on an exchange, so
> that they only can publish messages with that specific routing keys?
> Messages published on that exchange with other routing keys should fail or
> be ignored.
>
>
No


> My second question: Is it possible to limit a user to consume only from a
> specific queue?
>
>
Yes, using access control features [1]


> Third one: Is it possible to limit a user to publish only to a specific
> exchange?
>

Yes, using access control features [1]

1. http://www.rabbitmq.com/admin-guide.html#access-control
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110805/6f82abb6/attachment.htm>

From simon at rabbitmq.com  Fri Aug  5 11:01:01 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 05 Aug 2011 11:01:01 +0100
Subject: [rabbitmq-discuss] Limit user to queue
In-Reply-To: <4E3BA6EA.9080403@gmail.com>
References: <4E3BA6EA.9080403@gmail.com>
Message-ID: <4E3BBF5D.8030405@rabbitmq.com>

On 05/08/11 09:16, Christian Haintz wrote:
> Is it possible to limit users to specific routing keys on an exchange,
> so that they only can publish messages with that specific routing keys?
> Messages published on that exchange with other routing keys should fail
> or be ignored.

No, you'll have to partition users by exchange.

> My second question: Is it possible to limit a user to consume only from
> a specific queue?
>
> Third one: Is it possible to limit a user to publish only to a specific
> exchange?

Yes to both, see the access control guide here:

http://www.rabbitmq.com/admin-guide.html#access-control

Cheers, Simon
-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Fri Aug  5 11:04:11 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 05 Aug 2011 11:04:11 +0100
Subject: [rabbitmq-discuss] RabbitMQ RPM and its dependencies
In-Reply-To: <4E3B90DB.3000102@gmail.com>
References: <CAMOXM29+Arw6wP1n-KGNsOnOZ9wu+oHYhwkZTecxEwh8-SUnpw@mail.gmail.com>	<yrv4cfwlh5kc4.fsf@dwragg.eng.vmware.com>	<CANDpMDuZfdCFjtG3_y+M=P1pekbThVRcnD-MGjFVQBa1DEQtcA@mail.gmail.com>	<CACOPnvf1JwAYy_04BGEB5-FAshRCYR-odExOZoLrEGLLaW0+Ug@mail.gmail.com>
	<4E3B90DB.3000102@gmail.com>
Message-ID: <4E3BC01B.2080200@rabbitmq.com>

On 05/08/11 07:42, Hubert Plociniczak wrote:
> So if there is any good soul with decent understanding of fedora
> packaging process and erlang/rabbitmq knowledge then I would be willing
> to pass it over to him/her.

I should note that we (the RabbitMQ team) tend to make changes to the 
RPM spec as needed, so someone closer to the Fedora end could work out.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From news.anand11 at gmail.com  Fri Aug  5 11:11:20 2011
From: news.anand11 at gmail.com (News Aanad)
Date: Fri, 5 Aug 2011 15:41:20 +0530
Subject: [rabbitmq-discuss] Error Creating cluster in RabbitMQ on EC2
Message-ID: <CAL9wd7dSPCeA4a7_GUGVJuOrQAkHim40GyT1a5wXsXKtt62wVg@mail.gmail.com>

I want to create a cluster of RabbitMQ on EC2. I have created an AMI of
Ubantu and install the rabbitmq-server-2.3.1 on it. I have also installed
the management plugins for GUI. For cluster purpose I have also copied the
.erlang.cookie file in another node. My ploblem is when I am trying to
connect with another node it gives me following error:

Error: {failed_to_cluster_with,['rabbit at ip-10-58-54-170'], "Mnesia could not
connect to some nodes."}

Anybody has any idea why it is happening?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110805/43fad10b/attachment.htm>

From lionel.cons at cern.ch  Fri Aug  5 11:19:29 2011
From: lionel.cons at cern.ch (Lionel Cons)
Date: Fri, 5 Aug 2011 12:19:29 +0200
Subject: [rabbitmq-discuss] Inconsistent log rotation
Message-ID: <20110805121158.5768.abe10f7e5afbbb3a79ce619739541149@cern.ch>

It seems that RabbitMQ log rotation happens in two different places:
 - in the rabbitmq-server script, using cat and RABBITMQ_BACKUP_EXTENSION
 - in the init script, using rabbitmqctl and ROTATE_SUFFIX

Is the use of two different variables really intended?

If not, I would suggest to use only one (for instance
RABBITMQ_BACKUP_EXTENSION) and to document it at
http://www.rabbitmq.com/configure.html#define-environment-variables.

If it's really intended, it then requires even more documentation ;-)

Cheers,

Lionel

From juliette.delmedico at gmail.com  Fri Aug  5 11:48:10 2011
From: juliette.delmedico at gmail.com (Juliette)
Date: Fri, 5 Aug 2011 03:48:10 -0700 (PDT)
Subject: [rabbitmq-discuss] Beginners issue - How to run JSON RPC Chat
	Example
Message-ID: <8327141.1213.1312541290571.JavaMail.geo-discussion-forums@yqbp37>

Hi all,

I am trying to run JSON RPC chat example (from the source code) with my 
RabbitMQ server installed on the same machine.
But the channel opening don't work (a JSONError is thrown by the 
receiveReply function (in jsonrpc.js)).

I have set in rabbitmq.js :
- factoryServiceUrl: "http://localhost:55670/rpc/rabbitmq"
- rpcServiceUrlBase: "http://localhost:55670/rpc/"

What must I do to get this working ?
Have I set the right parameters ?
Which port must you listen to normally ?

Thx in advance,
Juliette.



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110805/3dfe81e8/attachment.htm>

From fisher at yun.io  Fri Aug  5 13:48:08 2011
From: fisher at yun.io (Fisher Yu)
Date: Fri, 5 Aug 2011 20:48:08 +0800
Subject: [rabbitmq-discuss] Error while connect to rabbitmq using
 rabbitmq-erlang-client library
In-Reply-To: <20110803165717.GE2906@dakota.eng.vmware.com>
References: <CAPnrV9_EfM-r7XGA=mJfsT1JB8u6ptvX-Pp8BwQEoziuZkNEHg@mail.gmail.com>
	<20110802140912.GA25255@dakota.eng.vmware.com>
	<CAPnrV9_XPKqRnn9RHdf0=UerCJ71nT1mfD5gJ0iW_dk=z0WygQ@mail.gmail.com>
	<20110803165717.GE2906@dakota.eng.vmware.com>
Message-ID: <CAPnrV9-4eF7PsAQeu0CTQ_5CCx5d1XWvQMoEZ5vGFN0eKKE+dg@mail.gmail.com>

Hi,

   This problem is solved. It is because the rabbitmq version is too old.
After i updated to last version, it works. Thanks for your help.

Fisher

2011/8/4 Alexandru Scvor?ov <alexandru at rabbitmq.com>

> Also, could you please post the output of:
> $ ulimit -a
>
> Alex
>
> On Wed, Aug 03, 2011 at 11:31:27AM +0800, Fisher Yu wrote:
>  > 2011/8/2 Alexandru Scvor?ov <alexandru at rabbitmq.com>
> >
> > > Hi,
> > >
> > > > ** Reason for termination ==
> > > > ** {{badmatch,{error,enomem}},
> > > >     [{amqp_main_reader,handle_inet_async,2},
> > > >      {gen_server,handle_msg,5},
> > > >      {proc_lib,init_p_do_apply,3}]}
> > >
> > > Strictly speaking, that means you've run out of memory.  Not sure how
> > > that could happen, though.
> > >
> > > There's an error in your example:
> > >
> > > >         Get = #'basic.get'{queue = Queue},
> > >
> > > should be
> > >
> > > >         Get = #'basic.get'{queue = list_to_binary(Queue)},
> > >
> > > Actually, you'd probably be better off converting Queue to a binary
> from
> > > the start.
> > >
> >
> > Changed this, thanks.
> >
> >
> > >
> > > Still, the failure is during the initial handshake, so that can't be
> the
> > > cause.
> > >
> > > Have a look in the server logs: is there a matching error?  Is there
> any
> > > mention
> > > of the memory alarms being set off?
> > >
> >
> > There is nothing happening in the server logs, at least nothing being
> > raised.  There is 24G RAM in here, with about 4G active and 11G free at
> the
> > time of testing.
> >
> >
> >
> > >
> > > What OS are you using?  What version of Erlang?  Is there anything
> > > special about the system's configuration?  Is it under heavy load?
> > >
> >
> >
> > The distribution is Ubuntu 10.04,
> > uname -a
> > Linux fs21 2.6.32-31-generic #61-Ubuntu SMP Fri Apr 8 18:25:51 UTC 2011
> > x86_64 GNU/Linux
> >
> > Erlang version
> > Erlang R14B03 (erts-5.8.4) [source] [64-bit] [smp:24:24] [rq:24]
> > [async-threads:0] [kernel-poll:false]
> >
> > This machine is almost completely idle at the moment as it's a
> development
> > server.  There is nothing special for the configuration.
> >
> >
> > >
> > > >   I kept get error message while connect to rabbitmq server using
> > > > rabbitmq-erlang-client library. Anyone can help, thanks.
> > >
> > > Does this mean you *always* get this error?  Or only occasionally?
> > >
> >
> > Every time the test case is run, this error is produced.
> >
> >
> > >
> > > Cheers,
> > > Alex
> > >
> > > On Tue, Aug 02, 2011 at 09:43:46PM +0800, Fisher Yu wrote:
> > > > Hi
> > > >
> > > >   I kept get error message while connect to rabbitmq server using
> > > > rabbitmq-erlang-client library. Anyone can help, thanks.
> > > >
> > > > Erlang R14B03 (erts-5.8.4) [source] [64-bit] [smp:24:24] [rq:24]
> > > > [async-threads:0] [kernel-poll:false]
> > > > Eshell V5.8.4  (abort with ^G)
> > > > 1> test:start().
> > > > =ERROR REPORT==== 2-Aug-2011::08:40:18 ===
> > > > ** Generic server <0.46.0> terminating
> > > > ** Last message in was
> > > > {inet_async,#Port<0.1109>,1,{ok,<<65,77,81,80,1,1,8>>}}
> > > > ** When Server state == {state,#Port<0.1109>,<0.39.0>,<0.41.0>,
> > > >                                {method,rabbit_framing_amqp_0_9_1},
> > > >                                none}
> > > > ** Reason for termination ==
> > > > ** {{badmatch,{error,enomem}},
> > > >     [{amqp_main_reader,handle_inet_async,2},
> > > >      {gen_server,handle_msg,5},
> > > >      {proc_lib,init_p_do_apply,3}]}
> > > >
> > > >
> > > >
> > > > %%test.erl
> > > >
> > > > -module(test).
> > > > -include_lib("amqp_client/include/amqp_client.hrl").
> > > > -compile(export_all).
> > > > start() ->
> > > >         {ok, Connection} =
> > > > amqp_connection:start(#amqp_params_network{username= <<"myuser">>,
> > > password=
> > > > <<"mypassword">>}),
> > > >         {ok, Channel} = amqp_connection:open_channel(Connection),
> > > >         Queue = "my_queue",
> > > >         Declare = #'queue.declare'{queue = list_to_binary(Queue),
> > > > durable=true},
> > > >         #'queue.declare_ok'{} = amqp_channel:call(Channel, Declare),
> > > >         Get = #'basic.get'{queue = Queue},
> > > >         {#'basic.get_ok'{delivery_tag = Tag}, Content}
> > > >                        = amqp_channel:call(Channel, Get),
> > > >         io:format("received message ~p", [Content]),
> > > >         %% Close the channel
> > > >         amqp_channel:close(Channel),
> > > >         %% Close the connection
> > > >         amqp_connection:close(Connection),
> > > >         ok.
> > >
> > > > _______________________________________________
> > > > rabbitmq-discuss mailing list
> > > > rabbitmq-discuss at lists.rabbitmq.com
> > > > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > >
> > >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110805/cef0df8e/attachment.htm>

From alexandru at rabbitmq.com  Fri Aug  5 13:56:29 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Fri, 5 Aug 2011 13:56:29 +0100
Subject: [rabbitmq-discuss] Error while connect to rabbitmq using
 rabbitmq-erlang-client library
In-Reply-To: <CAPnrV9-4eF7PsAQeu0CTQ_5CCx5d1XWvQMoEZ5vGFN0eKKE+dg@mail.gmail.com>
References: <CAPnrV9_EfM-r7XGA=mJfsT1JB8u6ptvX-Pp8BwQEoziuZkNEHg@mail.gmail.com>
	<20110802140912.GA25255@dakota.eng.vmware.com>
	<CAPnrV9_XPKqRnn9RHdf0=UerCJ71nT1mfD5gJ0iW_dk=z0WygQ@mail.gmail.com>
	<20110803165717.GE2906@dakota.eng.vmware.com>
	<CAPnrV9-4eF7PsAQeu0CTQ_5CCx5d1XWvQMoEZ5vGFN0eKKE+dg@mail.gmail.com>
Message-ID: <20110805125629.GB2718@dakota.eng.vmware.com>

Glad you solved the problem.

Quick question: what version of RabbitMQ were you using?

Cheers,
Alex

On Fri, Aug 05, 2011 at 08:48:08PM +0800, Fisher Yu wrote:
> Hi,
> 
>    This problem is solved. It is because the rabbitmq version is too old.
> After i updated to last version, it works. Thanks for your help.
> 
> Fisher
> 
> 2011/8/4 Alexandru Scvor?ov <alexandru at rabbitmq.com>
> 
> > Also, could you please post the output of:
> > $ ulimit -a
> >
> > Alex
> >
> > On Wed, Aug 03, 2011 at 11:31:27AM +0800, Fisher Yu wrote:
> >  > 2011/8/2 Alexandru Scvor?ov <alexandru at rabbitmq.com>
> > >
> > > > Hi,
> > > >
> > > > > ** Reason for termination ==
> > > > > ** {{badmatch,{error,enomem}},
> > > > >     [{amqp_main_reader,handle_inet_async,2},
> > > > >      {gen_server,handle_msg,5},
> > > > >      {proc_lib,init_p_do_apply,3}]}
> > > >
> > > > Strictly speaking, that means you've run out of memory.  Not sure how
> > > > that could happen, though.
> > > >
> > > > There's an error in your example:
> > > >
> > > > >         Get = #'basic.get'{queue = Queue},
> > > >
> > > > should be
> > > >
> > > > >         Get = #'basic.get'{queue = list_to_binary(Queue)},
> > > >
> > > > Actually, you'd probably be better off converting Queue to a binary
> > from
> > > > the start.
> > > >
> > >
> > > Changed this, thanks.
> > >
> > >
> > > >
> > > > Still, the failure is during the initial handshake, so that can't be
> > the
> > > > cause.
> > > >
> > > > Have a look in the server logs: is there a matching error?  Is there
> > any
> > > > mention
> > > > of the memory alarms being set off?
> > > >
> > >
> > > There is nothing happening in the server logs, at least nothing being
> > > raised.  There is 24G RAM in here, with about 4G active and 11G free at
> > the
> > > time of testing.
> > >
> > >
> > >
> > > >
> > > > What OS are you using?  What version of Erlang?  Is there anything
> > > > special about the system's configuration?  Is it under heavy load?
> > > >
> > >
> > >
> > > The distribution is Ubuntu 10.04,
> > > uname -a
> > > Linux fs21 2.6.32-31-generic #61-Ubuntu SMP Fri Apr 8 18:25:51 UTC 2011
> > > x86_64 GNU/Linux
> > >
> > > Erlang version
> > > Erlang R14B03 (erts-5.8.4) [source] [64-bit] [smp:24:24] [rq:24]
> > > [async-threads:0] [kernel-poll:false]
> > >
> > > This machine is almost completely idle at the moment as it's a
> > development
> > > server.  There is nothing special for the configuration.
> > >
> > >
> > > >
> > > > >   I kept get error message while connect to rabbitmq server using
> > > > > rabbitmq-erlang-client library. Anyone can help, thanks.
> > > >
> > > > Does this mean you *always* get this error?  Or only occasionally?
> > > >
> > >
> > > Every time the test case is run, this error is produced.
> > >
> > >
> > > >
> > > > Cheers,
> > > > Alex
> > > >
> > > > On Tue, Aug 02, 2011 at 09:43:46PM +0800, Fisher Yu wrote:
> > > > > Hi
> > > > >
> > > > >   I kept get error message while connect to rabbitmq server using
> > > > > rabbitmq-erlang-client library. Anyone can help, thanks.
> > > > >
> > > > > Erlang R14B03 (erts-5.8.4) [source] [64-bit] [smp:24:24] [rq:24]
> > > > > [async-threads:0] [kernel-poll:false]
> > > > > Eshell V5.8.4  (abort with ^G)
> > > > > 1> test:start().
> > > > > =ERROR REPORT==== 2-Aug-2011::08:40:18 ===
> > > > > ** Generic server <0.46.0> terminating
> > > > > ** Last message in was
> > > > > {inet_async,#Port<0.1109>,1,{ok,<<65,77,81,80,1,1,8>>}}
> > > > > ** When Server state == {state,#Port<0.1109>,<0.39.0>,<0.41.0>,
> > > > >                                {method,rabbit_framing_amqp_0_9_1},
> > > > >                                none}
> > > > > ** Reason for termination ==
> > > > > ** {{badmatch,{error,enomem}},
> > > > >     [{amqp_main_reader,handle_inet_async,2},
> > > > >      {gen_server,handle_msg,5},
> > > > >      {proc_lib,init_p_do_apply,3}]}
> > > > >
> > > > >
> > > > >
> > > > > %%test.erl
> > > > >
> > > > > -module(test).
> > > > > -include_lib("amqp_client/include/amqp_client.hrl").
> > > > > -compile(export_all).
> > > > > start() ->
> > > > >         {ok, Connection} =
> > > > > amqp_connection:start(#amqp_params_network{username= <<"myuser">>,
> > > > password=
> > > > > <<"mypassword">>}),
> > > > >         {ok, Channel} = amqp_connection:open_channel(Connection),
> > > > >         Queue = "my_queue",
> > > > >         Declare = #'queue.declare'{queue = list_to_binary(Queue),
> > > > > durable=true},
> > > > >         #'queue.declare_ok'{} = amqp_channel:call(Channel, Declare),
> > > > >         Get = #'basic.get'{queue = Queue},
> > > > >         {#'basic.get_ok'{delivery_tag = Tag}, Content}
> > > > >                        = amqp_channel:call(Channel, Get),
> > > > >         io:format("received message ~p", [Content]),
> > > > >         %% Close the channel
> > > > >         amqp_channel:close(Channel),
> > > > >         %% Close the connection
> > > > >         amqp_connection:close(Connection),
> > > > >         ok.
> > > >
> > > > > _______________________________________________
> > > > > rabbitmq-discuss mailing list
> > > > > rabbitmq-discuss at lists.rabbitmq.com
> > > > > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > > >
> > > >
> >

From majek04 at gmail.com  Fri Aug  5 15:29:57 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 5 Aug 2011 15:29:57 +0100
Subject: [rabbitmq-discuss] Error Creating cluster in RabbitMQ on EC2
In-Reply-To: <CAL9wd7dSPCeA4a7_GUGVJuOrQAkHim40GyT1a5wXsXKtt62wVg@mail.gmail.com>
References: <CAL9wd7dSPCeA4a7_GUGVJuOrQAkHim40GyT1a5wXsXKtt62wVg@mail.gmail.com>
Message-ID: <CABzX+qxxoJo2_80uXoGg87N9S32DhjaA4bUi7wgk19+13dghog@mail.gmail.com>

On Fri, Aug 5, 2011 at 11:11, News Aanad <news.anand11 at gmail.com> wrote:
> I want to create a cluster of RabbitMQ on EC2. I have created an AMI of
> Ubantu and install the rabbitmq-server-2.3.1 on it. I have also installed
> the management plugins for GUI. For cluster purpose I have also copied the
> .erlang.cookie file in another node. My ploblem is when I am trying to
> connect with another node it gives me following error:
>
> Error: {failed_to_cluster_with,['rabbit at ip-10-58-54-170'], "Mnesia could not
> connect to some nodes."}
>
> Anybody has any idea why it is happening?

Isn't that a firewall issue?

Cheers,
   Marek

From msteele at beringmedia.com  Fri Aug  5 18:33:22 2011
From: msteele at beringmedia.com (Mark Steele)
Date: Fri, 5 Aug 2011 13:33:22 -0400
Subject: [rabbitmq-discuss] CRL support
In-Reply-To: <8097A4E725D78E41A8B862ACE60E963945EF69314E@GVW1355EXB.americas.hpqcorp.net>
References: <1312283298.17699.15.camel@vicbristol6.hpl.hp.com>
	<4E3A6E4E.9060205@rabbitmq.com>
	<8097A4E725D78E41A8B862ACE60E963945EF69314E@GVW1355EXB.americas.hpqcorp.net>
Message-ID: <CAH24rBOvOaPe3+K1QVYU3T8FyMPCvgrFjmc0Cwo7Qu=xhQ1rdQ@mail.gmail.com>

If anyone does end up writing the code to do this, I'd be interested if you
want to share. As an aside, OCSP checks would also be awesome :-P

Thanks,

Mark Steele
Bering Media Inc.

On Thu, Aug 4, 2011 at 6:54 AM, Rosa, Andrea <andrea.rosa at hp.com> wrote:

> Hi Matthias
>
> Thank you for your reply.
> Regards
> --
> Andrea
>
> > As suggested in response to your question in erlang-questions, you can
> > define your own cert verification function with the verify_fun ssl
> > option and have that perform all the checks you need. The erlang ssl
> > docs (http://www.erlang.org/doc/man/ssl.html) for verify_fun describe
> > how that function should behave.
> >
> > To hook your verification function into rabbit (nb: this is untested)
> > ...
> >
> > 1) write an erlang module containing (and exporting) that function
> >
> > 2) In the rabbit/ssl_options section of the rabbitmq.config, add an
> > entry {verify_fun, {YourModuleName, YourFunctionName}}.
> >
> >
> > Regards,
> >
> > Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110805/d0fe8982/attachment.htm>

From james.r.carr at gmail.com  Fri Aug  5 21:56:05 2011
From: james.r.carr at gmail.com (James Carr)
Date: Fri, 5 Aug 2011 15:56:05 -0500
Subject: [rabbitmq-discuss] RabbitMQ actively refuses connections after
 connectity issues
In-Reply-To: <4E3A7D60.1030207@rabbitmq.com>
References: <968a1a05-b848-4794-b8ad-9a865489ce51@p20g2000yqp.googlegroups.com>
	<65dd7dd1-b45c-48d7-b80b-69978911fb9e@k27g2000yqn.googlegroups.com>
	<4E37C91E.3010902@rabbitmq.com>
	<da4c18d6-20a4-49cd-88c9-0690cce14701@t5g2000yqj.googlegroups.com>
	<4E38062A.7040608@rabbitmq.com>
	<CAGVpBACEMfdsxHK1Pp4WZ3tnaP=9XYG5iG1yxCV3-av_q92hsQ@mail.gmail.com>
	<4E3A7D60.1030207@rabbitmq.com>
Message-ID: <CAJreXKBFLccRE3rPpURGE13qWfBw9NidXoxiQM2riKodAvegYg@mail.gmail.com>

Is there anyway on the server side to limit the max number of
connections a single user or ip can make? We had the same issue
described above due to some erronous consumer logic deployed in one of
the applications using RabbitMQ. It quickly took up all the
connections and never closed them, which in turn impacted the other
applications that used that server. :(



Thanks,
James


On Thu, Aug 4, 2011 at 6:07 AM, Matthias Radestock
<matthias at rabbitmq.com> wrote:
> Alfonso,
>
> On 02/08/11 15:36, Alfonso Pantoja wrote:
>>
>> By the way ?Since we are using RequestedHeartbeat feature is it possible
>> to open a connection to rabbit and not use it anymore without being
>> disconnected?
>> (setting RequestedHeartbea with a value > 0 is enough or additional code
>> is needed?)
>
> Correct. Setting RequestedHeartbeat enables logic in the client library that
> automatically sends out heartbeat frames at the configured interval whenever
> no other data is being transmitted.
>
> Regards,
>
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From chrisch at ecollege.com  Fri Aug  5 22:18:05 2011
From: chrisch at ecollege.com (Chris Chew)
Date: Fri, 5 Aug 2011 21:18:05 +0000
Subject: [rabbitmq-discuss] RabbitMQ actively refuses connections after
 connectity issues
In-Reply-To: <CAJreXKBFLccRE3rPpURGE13qWfBw9NidXoxiQM2riKodAvegYg@mail.gmail.com>
References: <968a1a05-b848-4794-b8ad-9a865489ce51@p20g2000yqp.googlegroups.com>
	<65dd7dd1-b45c-48d7-b80b-69978911fb9e@k27g2000yqn.googlegroups.com>
	<4E37C91E.3010902@rabbitmq.com>
	<da4c18d6-20a4-49cd-88c9-0690cce14701@t5g2000yqj.googlegroups.com>
	<4E38062A.7040608@rabbitmq.com>
	<CAGVpBACEMfdsxHK1Pp4WZ3tnaP=9XYG5iG1yxCV3-av_q92hsQ@mail.gmail.com>
	<4E3A7D60.1030207@rabbitmq.com>,
	<CAJreXKBFLccRE3rPpURGE13qWfBw9NidXoxiQM2riKodAvegYg@mail.gmail.com>
Message-ID: <1C7E61787A08F34BBBBD9E7A7CBC368B0A36E948@EXMB02OSG.eclg.org>

> From: rabbitmq-discuss-bounces at lists.rabbitmq.com [rabbitmq-discuss-bounces at lists.rabbitmq.com] on behalf of > > James Carr [james.r.carr at gmail.com]
> Sent: Friday, August 05, 2011 2:56 PM
> To: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] RabbitMQ actively refuses connections after connectity issues

> Is there anyway on the server side to limit the max number of
> connections a single user or ip can make? We had the same issue
> described above due to some erronous consumer logic deployed in one of
> the applications using RabbitMQ. It quickly took up all the
> connections and never closed them, which in turn impacted the other
> applications that used that server. :(

Hi James.

Assuming Linux...what about using iptables?  IIRC, there's a "connection limit" rule available to limit the connections per source IP and destination port.

Cheers,

Chris

From news.anand11 at gmail.com  Sat Aug  6 06:40:19 2011
From: news.anand11 at gmail.com (News Aanad)
Date: Sat, 6 Aug 2011 11:10:19 +0530
Subject: [rabbitmq-discuss] Error Creating cluster in RabbitMQ on EC2
In-Reply-To: <CABzX+qxxoJo2_80uXoGg87N9S32DhjaA4bUi7wgk19+13dghog@mail.gmail.com>
References: <CAL9wd7dSPCeA4a7_GUGVJuOrQAkHim40GyT1a5wXsXKtt62wVg@mail.gmail.com>
	<CABzX+qxxoJo2_80uXoGg87N9S32DhjaA4bUi7wgk19+13dghog@mail.gmail.com>
Message-ID: <CAL9wd7fi3iP5ZoDG0=VsEFHLaPJVJqj3TfCCYvtiGqQQztRbBw@mail.gmail.com>

I have opened all the prot required for rabbitmq clustering i.e. 5672,4369.
I can also ping the host name of other AMI.

On Fri, Aug 5, 2011 at 7:59 PM, Marek Majkowski <majek04 at gmail.com> wrote:

> On Fri, Aug 5, 2011 at 11:11, News Aanad <news.anand11 at gmail.com> wrote:
> > I want to create a cluster of RabbitMQ on EC2. I have created an AMI of
> > Ubantu and install the rabbitmq-server-2.3.1 on it. I have also installed
> > the management plugins for GUI. For cluster purpose I have also copied
> the
> > .erlang.cookie file in another node. My ploblem is when I am trying to
> > connect with another node it gives me following error:
> >
> > Error: {failed_to_cluster_with,['rabbit at ip-10-58-54-170'], "Mnesia could
> not
> > connect to some nodes."}
> >
> > Anybody has any idea why it is happening?
>
> Isn't that a firewall issue?
>
> Cheers,
>    Marek
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110806/e4445590/attachment.htm>

From Massimo.Paladin at cern.ch  Sat Aug  6 13:11:42 2011
From: Massimo.Paladin at cern.ch (Massimo Paladin)
Date: Sat, 6 Aug 2011 14:11:42 +0200
Subject: [rabbitmq-discuss] RabbitMQ and Stomp topic behavior
Message-ID: <CAMOXM28j7MMaPtrCyFLsdS1p4-RbbBgp8zH27dvcvmSEXV1RKA@mail.gmail.com>

Hello,

I am doing some testing with RabbitMQ and Stomp.
I am using stomp-benchmark to run the scenario attached to this email.

It is producing small messages at highest rate possible on a topic on a
RabbitMQ server, the topic does not have any consumer attached.
I can be run with such a command:
sbt run --host host --login guest --passcode guest --port 61613
 --scenario-file custom.xml /tmp/rabbitmq_topic

I am running rabbitmq-server on a 16GB memory machine and 8GB swap with
watermark level of 0.5 (7.8GB watermark)
Memory level output from the web interface reach values > 20GB.
Why does the memory goes up if there are no consumers attached to the topic?
Messages are supposed to be discarded straight away.

Regards,
---
Massimo Paladin

email: massimo.paladin at gmail.com
website: http://www.mpaladin.com
flickr's page: http://flickr.com/photos/massimop
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110806/c03c61ec/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbitmq_topic.xml
Type: text/xml
Size: 1113 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110806/c03c61ec/attachment.bin>

From fisher at yun.io  Sat Aug  6 14:35:19 2011
From: fisher at yun.io (Fisher Yu)
Date: Sat, 6 Aug 2011 21:35:19 +0800
Subject: [rabbitmq-discuss] Error while connect to rabbitmq using
 rabbitmq-erlang-client library
In-Reply-To: <20110805125629.GB2718@dakota.eng.vmware.com>
References: <CAPnrV9_EfM-r7XGA=mJfsT1JB8u6ptvX-Pp8BwQEoziuZkNEHg@mail.gmail.com>
	<20110802140912.GA25255@dakota.eng.vmware.com>
	<CAPnrV9_XPKqRnn9RHdf0=UerCJ71nT1mfD5gJ0iW_dk=z0WygQ@mail.gmail.com>
	<20110803165717.GE2906@dakota.eng.vmware.com>
	<CAPnrV9-4eF7PsAQeu0CTQ_5CCx5d1XWvQMoEZ5vGFN0eKKE+dg@mail.gmail.com>
	<20110805125629.GB2718@dakota.eng.vmware.com>
Message-ID: <CAPnrV98pg8vx3OaowvNJAzUvf6BYvBpyNcbmmJbKcF2zasbq2w@mail.gmail.com>

2011/8/5 Alexandru Scvor?ov <alexandru at rabbitmq.com>

> Glad you solved the problem.
>
> Quick question: what version of RabbitMQ were you using?
>
>
I forget the version, It might be 0.9.1. It was installed with apt-get
install.


> Cheers,
> Alex
>
> On Fri, Aug 05, 2011 at 08:48:08PM +0800, Fisher Yu wrote:
> > Hi,
> >
> >    This problem is solved. It is because the rabbitmq version is too old.
> > After i updated to last version, it works. Thanks for your help.
> >
> > Fisher
> >
> > 2011/8/4 Alexandru Scvor?ov <alexandru at rabbitmq.com>
> >
> > > Also, could you please post the output of:
> > > $ ulimit -a
> > >
> > > Alex
> > >
> > > On Wed, Aug 03, 2011 at 11:31:27AM +0800, Fisher Yu wrote:
> > >  > 2011/8/2 Alexandru Scvor?ov <alexandru at rabbitmq.com>
> > > >
> > > > > Hi,
> > > > >
> > > > > > ** Reason for termination ==
> > > > > > ** {{badmatch,{error,enomem}},
> > > > > >     [{amqp_main_reader,handle_inet_async,2},
> > > > > >      {gen_server,handle_msg,5},
> > > > > >      {proc_lib,init_p_do_apply,3}]}
> > > > >
> > > > > Strictly speaking, that means you've run out of memory.  Not sure
> how
> > > > > that could happen, though.
> > > > >
> > > > > There's an error in your example:
> > > > >
> > > > > >         Get = #'basic.get'{queue = Queue},
> > > > >
> > > > > should be
> > > > >
> > > > > >         Get = #'basic.get'{queue = list_to_binary(Queue)},
> > > > >
> > > > > Actually, you'd probably be better off converting Queue to a binary
> > > from
> > > > > the start.
> > > > >
> > > >
> > > > Changed this, thanks.
> > > >
> > > >
> > > > >
> > > > > Still, the failure is during the initial handshake, so that can't
> be
> > > the
> > > > > cause.
> > > > >
> > > > > Have a look in the server logs: is there a matching error?  Is
> there
> > > any
> > > > > mention
> > > > > of the memory alarms being set off?
> > > > >
> > > >
> > > > There is nothing happening in the server logs, at least nothing being
> > > > raised.  There is 24G RAM in here, with about 4G active and 11G free
> at
> > > the
> > > > time of testing.
> > > >
> > > >
> > > >
> > > > >
> > > > > What OS are you using?  What version of Erlang?  Is there anything
> > > > > special about the system's configuration?  Is it under heavy load?
> > > > >
> > > >
> > > >
> > > > The distribution is Ubuntu 10.04,
> > > > uname -a
> > > > Linux fs21 2.6.32-31-generic #61-Ubuntu SMP Fri Apr 8 18:25:51 UTC
> 2011
> > > > x86_64 GNU/Linux
> > > >
> > > > Erlang version
> > > > Erlang R14B03 (erts-5.8.4) [source] [64-bit] [smp:24:24] [rq:24]
> > > > [async-threads:0] [kernel-poll:false]
> > > >
> > > > This machine is almost completely idle at the moment as it's a
> > > development
> > > > server.  There is nothing special for the configuration.
> > > >
> > > >
> > > > >
> > > > > >   I kept get error message while connect to rabbitmq server using
> > > > > > rabbitmq-erlang-client library. Anyone can help, thanks.
> > > > >
> > > > > Does this mean you *always* get this error?  Or only occasionally?
> > > > >
> > > >
> > > > Every time the test case is run, this error is produced.
> > > >
> > > >
> > > > >
> > > > > Cheers,
> > > > > Alex
> > > > >
> > > > > On Tue, Aug 02, 2011 at 09:43:46PM +0800, Fisher Yu wrote:
> > > > > > Hi
> > > > > >
> > > > > >   I kept get error message while connect to rabbitmq server using
> > > > > > rabbitmq-erlang-client library. Anyone can help, thanks.
> > > > > >
> > > > > > Erlang R14B03 (erts-5.8.4) [source] [64-bit] [smp:24:24] [rq:24]
> > > > > > [async-threads:0] [kernel-poll:false]
> > > > > > Eshell V5.8.4  (abort with ^G)
> > > > > > 1> test:start().
> > > > > > =ERROR REPORT==== 2-Aug-2011::08:40:18 ===
> > > > > > ** Generic server <0.46.0> terminating
> > > > > > ** Last message in was
> > > > > > {inet_async,#Port<0.1109>,1,{ok,<<65,77,81,80,1,1,8>>}}
> > > > > > ** When Server state == {state,#Port<0.1109>,<0.39.0>,<0.41.0>,
> > > > > >
>  {method,rabbit_framing_amqp_0_9_1},
> > > > > >                                none}
> > > > > > ** Reason for termination ==
> > > > > > ** {{badmatch,{error,enomem}},
> > > > > >     [{amqp_main_reader,handle_inet_async,2},
> > > > > >      {gen_server,handle_msg,5},
> > > > > >      {proc_lib,init_p_do_apply,3}]}
> > > > > >
> > > > > >
> > > > > >
> > > > > > %%test.erl
> > > > > >
> > > > > > -module(test).
> > > > > > -include_lib("amqp_client/include/amqp_client.hrl").
> > > > > > -compile(export_all).
> > > > > > start() ->
> > > > > >         {ok, Connection} =
> > > > > > amqp_connection:start(#amqp_params_network{username=
> <<"myuser">>,
> > > > > password=
> > > > > > <<"mypassword">>}),
> > > > > >         {ok, Channel} = amqp_connection:open_channel(Connection),
> > > > > >         Queue = "my_queue",
> > > > > >         Declare = #'queue.declare'{queue = list_to_binary(Queue),
> > > > > > durable=true},
> > > > > >         #'queue.declare_ok'{} = amqp_channel:call(Channel,
> Declare),
> > > > > >         Get = #'basic.get'{queue = Queue},
> > > > > >         {#'basic.get_ok'{delivery_tag = Tag}, Content}
> > > > > >                        = amqp_channel:call(Channel, Get),
> > > > > >         io:format("received message ~p", [Content]),
> > > > > >         %% Close the channel
> > > > > >         amqp_channel:close(Channel),
> > > > > >         %% Close the connection
> > > > > >         amqp_connection:close(Connection),
> > > > > >         ok.
> > > > >
> > > > > > _______________________________________________
> > > > > > rabbitmq-discuss mailing list
> > > > > > rabbitmq-discuss at lists.rabbitmq.com
> > > > > >
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > > > >
> > > > >
> > >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110806/0f086368/attachment.htm>

From ludy at wawame.cn  Sun Aug  7 12:00:18 2011
From: ludy at wawame.cn (ludy)
Date: Sun, 07 Aug 2011 19:00:18 +0800
Subject: [rabbitmq-discuss] problem for cluster
Message-ID: <1312714818.10328.0.camel@ludy-linux>

how to implement loadbalance????


From stammailbox at gmail.com  Sun Aug  7 13:19:12 2011
From: stammailbox at gmail.com (mysurf mail)
Date: Sun, 7 Aug 2011 15:19:12 +0300
Subject: [rabbitmq-discuss] encoding problem when using json rpc
Message-ID: <CAJ2-VrkODqzu5t1fywEiKF=6P=mkz+MYA2K83WydJNYrmdcH=Q@mail.gmail.com>

Hi.
1. Json Rpc question :

It seems that when I send a hebrew strings with rabbitmq - I get squares
instead of strings in the other side.
It is not the way when I send it with regular publishing.
Can I control the encoding whein I use JSON RPC?

2. Where Can i find a good json rpc documentation and examples?

Thank you.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110807/99b88ee8/attachment.htm>

From Massimo.Paladin at cern.ch  Sun Aug  7 20:52:04 2011
From: Massimo.Paladin at cern.ch (Massimo Paladin)
Date: Sun, 7 Aug 2011 21:52:04 +0200
Subject: [rabbitmq-discuss] RabbitMQ and Stomp topic behavior
In-Reply-To: <CAMOXM28j7MMaPtrCyFLsdS1p4-RbbBgp8zH27dvcvmSEXV1RKA@mail.gmail.com>
References: <CAMOXM28j7MMaPtrCyFLsdS1p4-RbbBgp8zH27dvcvmSEXV1RKA@mail.gmail.com>
Message-ID: <CAMOXM2-vt7fVArCVN_p_1Lmn8e+ubR+d3S2KFu9M=9Jy8FZRxA@mail.gmail.com>

Some details.

I am using rabbitmq 2.5.1 on a rhel based os with erlang R14B-02.

For stomp-benchmark details look at:
https://github.com/chirino/stomp-benchmark

The scenario provided makes memory increasing and if you let it run for some
time at some point rabbitmq crashes because it can not allocate memory.
If you are interested I kept the crash dumps.

Regards,
---
Massimo Paladin

email: massimo.paladin at gmail.com
website: http://www.mpaladin.com
flickr's page: http://flickr.com/photos/massimop


On Sat, Aug 6, 2011 at 2:11 PM, Massimo Paladin <Massimo.Paladin at cern.ch>wrote:

> Hello,
>
> I am doing some testing with RabbitMQ and Stomp.
> I am using stomp-benchmark to run the scenario attached to this email.
>
> It is producing small messages at highest rate possible on a topic on a
> RabbitMQ server, the topic does not have any consumer attached.
> I can be run with such a command:
> sbt run --host host --login guest --passcode guest --port 61613
>  --scenario-file custom.xml /tmp/rabbitmq_topic
>
> I am running rabbitmq-server on a 16GB memory machine and 8GB swap with
> watermark level of 0.5 (7.8GB watermark)
> Memory level output from the web interface reach values > 20GB.
> Why does the memory goes up if there are no consumers attached to the
> topic?
> Messages are supposed to be discarded straight away.
>
> Regards,
> ---
> Massimo Paladin
>
> email: massimo.paladin at gmail.com
> website: http://www.mpaladin.com
> flickr's page: http://flickr.com/photos/massimop
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110807/cbb3af78/attachment.htm>

From majek04 at gmail.com  Mon Aug  8 11:04:52 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Mon, 8 Aug 2011 11:04:52 +0100
Subject: [rabbitmq-discuss] Error Creating cluster in RabbitMQ on EC2
In-Reply-To: <CAL9wd7fi3iP5ZoDG0=VsEFHLaPJVJqj3TfCCYvtiGqQQztRbBw@mail.gmail.com>
References: <CAL9wd7dSPCeA4a7_GUGVJuOrQAkHim40GyT1a5wXsXKtt62wVg@mail.gmail.com>
	<CABzX+qxxoJo2_80uXoGg87N9S32DhjaA4bUi7wgk19+13dghog@mail.gmail.com>
	<CAL9wd7fi3iP5ZoDG0=VsEFHLaPJVJqj3TfCCYvtiGqQQztRbBw@mail.gmail.com>
Message-ID: <CABzX+qzOj40S9sVsKfBOQ1ePWBDYB-4ia5jEL=apuEKY8d49qA@mail.gmail.com>

On Sat, Aug 6, 2011 at 06:40, News Aanad <news.anand11 at gmail.com> wrote:
> I have opened all the prot required for rabbitmq clustering i.e. 5672,4369.
> I can also ping the host name of other AMI.

And what about erlang vm port controlled via inet_dist_listen_min and
inet_dist_listen_max?
http://www.erlang.org/faq/how_do_i.html#id55256

To check if the connectivity is all right, open an erlang interpreter, type
> net_adm:ping(nodename at host).

It should print 'pong', see the erlang docs:
http://www.erlang.org/doc/man/net_adm.html#ping-1

Cheers,
   Marek

> On Fri, Aug 5, 2011 at 7:59 PM, Marek Majkowski <majek04 at gmail.com> wrote:
>>
>> On Fri, Aug 5, 2011 at 11:11, News Aanad <news.anand11 at gmail.com> wrote:
>> > I want to create a cluster of RabbitMQ on EC2. I have created an AMI of
>> > Ubantu and install the rabbitmq-server-2.3.1 on it. I have also
>> > installed
>> > the management plugins for GUI. For cluster purpose I have also copied
>> > the
>> > .erlang.cookie file in another node. My ploblem is when I am trying to
>> > connect with another node it gives me following error:
>> >
>> > Error: {failed_to_cluster_with,['rabbit at ip-10-58-54-170'], "Mnesia could
>> > not
>> > connect to some nodes."}
>> >
>> > Anybody has any idea why it is happening?
>>
>> Isn't that a firewall issue?
>>
>> Cheers,
>> ? Marek
>
>

From rmartele at gmail.com  Mon Aug  8 11:02:57 2011
From: rmartele at gmail.com (Renaud)
Date: Mon, 8 Aug 2011 03:02:57 -0700 (PDT)
Subject: [rabbitmq-discuss] =?utf-8?b?UmXCoDogUmU6ICBSZSA6IFJlOiBDb25uZWN0?=
 =?utf-8?q?ion_closed_after_10_minutes=2E_Cause_=3A_end-of-stream?=
In-Reply-To: <CABzX+qxOHMd-0ndiqa_+nD8396hJWtKiqJUTENQuvfJ-LhrVjQ@mail.gmail.com>
References: <CABzX+qxOHMd-0ndiqa_+nD8396hJWtKiqJUTENQuvfJ-LhrVjQ@mail.gmail.com>
Message-ID: <28024328.77.1312797777928.JavaMail.geo-discussion-forums@yqic37>

Thx for the help,

So : yes the two computers ping well each other.

The traceback is here :
RabbitMQ.Client.Exceptions.AlreadyClosedException: The AMQP operation was 
interrupted: AMQP close-reason, initiated by Library, code=0, text="End of 
stream", classId=0, methodId=0, cause=System.IO.EndOfStreamException: Unable 
to read beyond the end of the stream.
   at RabbitMQ.Client.Impl.Frame.ReadFrom(NetworkBinaryReader reader)
   at RabbitMQ.Client.Impl.SocketFrameHandler_0_9.ReadFrame()
   at RabbitMQ.Client.Impl.ConnectionBase.MainLoopIteration()
   at RabbitMQ.Client.Impl.ConnectionBase.MainLoop()
   at RabbitMQ.Client.Impl.SessionBase.Transmit(Command cmd)
   at RabbitMQ.Client.Impl.ModelBase.ModelSend(MethodBase method, 
ContentHeaderBase header, Byte[] body)
   at RabbitMQ.Client.Framing.Impl.v0_9_1.Model._Private_BasicPublish(String 
exchange, String routingKey, Boolean mandatory, Boolean immediate, 
IBasicProperties basicProperties, Byte[] body)
   at RabbitMQ.Client.Impl.ModelBase.BasicPublish(String exchange, String 
routingKey, Boolean mandatory, Boolean immediate, IBasicProperties 
basicProperties, Byte[] body)
   at RabbitMQ.Client.Impl.ModelBase.BasicPublish(String exchange, String 
routingKey, IBasicProperties basicProperties, Byte[] body)
   at testDB.RMQ_Agent.sendData(String data, String routingKey, 
IBasicProperties props)

Unhandled Exception: System.IO.EndOfStreamException: SharedQueue closed
   at RabbitMQ.Util.SharedQueue.Dequeue()
   at testDB.RMQ_Agent.receiveData()
   at testDB.RMQ_Agent.waitForData()
   at System.Threading.ThreadHelper.ThreadStart_Context(Object state)
   at System.Threading.ExecutionContext.Run(ExecutionContext 
executionContext, ContextCallback callback, Object state)
   at System.Threading.ThreadHelper.ThreadStart()

And the RabbitMQ server logs are here :
----
***Reset of rabbitmq server, on Computer B***
INFO REPORT==== 29-Jul-2011::11:30:10 ===
Limiting to approx 924 file handles (829 sockets)

INFO REPORT==== 29-Jul-2011::11:30:10 ===
Memory limit set to 2997MB.

INFO REPORT==== 29-Jul-2011::11:30:10 ===
msg_store_transient: using rabbit_msg_store_ets_index to provide index

INFO REPORT==== 29-Jul-2011::11:30:10 ===
started TCP Listener on [::]:5672

INFO REPORT==== 29-Jul-2011::11:30:10 ===
msg_store_persistent: using rabbit_msg_store_ets_index to provide index
----
***Connection of Java client, Computer B***
INFO REPORT==== 29-Jul-2011::11:36:29 ===
accepted TCP connection on [::]:5672 from XXX.XXX.XXX.XXX:51886

INFO REPORT==== 29-Jul-2011::11:36:29 ===
starting TCP connection <0.730.0> from XXX.XXX.XXX.XXX:51886

***Connection of .NET client, Computer A***
INFO REPORT==== 29-Jul-2011::11:36:34 ===
accepted TCP connection on [::]:5672 from YYY.YYY.YYY.YYY:44352

INFO REPORT==== 29-Jul-2011::11:36:34 ===
starting TCP connection <0.746.0> from YYY.YYY.YYY.YYY:44352

***Connection of Java client, Computer C***
INFO REPORT==== 29-Jul-2011::11:36:54 ===
accepted TCP connection on [::]:5672 from ZZZ.ZZZ.ZZZ.ZZZ:39899

INFO REPORT==== 29-Jul-2011::11:36:54 ===
starting TCP connection <0.781.0> from ZZZ.ZZZ.ZZZ.ZZZ:39899
----
***Connection closure of .NET client, Computer A***
WARNING REPORT==== 29-Jul-2011::11:45:24 ===
exception on TCP connection <0.746.0> from YYY.YYY.YYY.YYY:44352
connection_closed_abruptly

INFO REPORT==== 29-Jul-2011::11:45:24 ===
closing TCP connection <0.746.0> from YYY.YYY.YYY.YYY:44352
----

And about the TCP/IP settings, I didn't modify them. These are default 
settings.

Recently, I made more tests and results are... strange :
I tried different .NET clients with different charges (1msg/sec, 10msg/sec, 
20msg/sec). The connection seems to fail every time but not after 10 
minutes. It closed after 8m30, 17m, ... I also tried with 1msg/2sec and it's 
running since more then 50 minutes now...

I looked for some limitations of VirtualBox, about TCP connections but it 
seems there are not.

About the heartbeat, if I understand well, it's a solution to detect 
connection failure, so it would be a good idea if the problem was, actually, 
a non stable network/connection. But if that's not the case, is it still 
useful?

By the way, here is the code of my .NET client, just the connection part :
            //factory is a ConnectionFactory
            factory.Protocol = Protocols.FromEnvironment();
            factory.HostName = hostName;//variable with IP address of my 
RabbitMQ server
            factory.VirtualHost = virtualHost;//the string "/"
            factory.Port = port;//5672
            factory.UserName = userName;//random string "userName"
            factory.Password = password;//random string "password"

            try
            {
                conn = factory.CreateConnection();//conn is a IConnection
                ch = conn.CreateModel();//ch is a IModel
...
            }

After that, I just do some "ch.basicPublish(...)" and "ch.basicConsume(...)" 
and it works fine during several minutes...

Someone can see some logic in that?

Thanks for your time, and for any help,

Renaud
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110808/c2160ac0/attachment.htm>

From majek04 at gmail.com  Mon Aug  8 11:06:47 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Mon, 8 Aug 2011 11:06:47 +0100
Subject: [rabbitmq-discuss] problem for cluster
In-Reply-To: <1312714818.10328.0.camel@ludy-linux>
References: <1312714818.10328.0.camel@ludy-linux>
Message-ID: <CABzX+qyfJRFQD+y=OQxks=w_Y6dwwVu1-KVx4crg-N06=ddfhA@mail.gmail.com>

On Sun, Aug 7, 2011 at 12:00, ludy <ludy at wawame.cn> wrote:
> how to implement loadbalance????

Don't.

Cheers,
  Marek

From emile at rabbitmq.com  Mon Aug  8 11:20:01 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 08 Aug 2011 11:20:01 +0100
Subject: [rabbitmq-discuss] encoding problem when using json rpc
In-Reply-To: <CAJ2-VrkODqzu5t1fywEiKF=6P=mkz+MYA2K83WydJNYrmdcH=Q@mail.gmail.com>
References: <CAJ2-VrkODqzu5t1fywEiKF=6P=mkz+MYA2K83WydJNYrmdcH=Q@mail.gmail.com>
Message-ID: <4E3FB851.8040708@rabbitmq.com>

On 07/08/11 13:19, mysurf mail wrote:
> Hi.
> 1. Json Rpc question : 
> 
> It seems that when I send a hebrew strings with rabbitmq - I get squares
> instead of strings in the other side. 
> It is not the way when I send it with regular publishing. 
> Can I control the encoding whein I use JSON RPC? 

Rabbit treats the message body as an opaque blob of bytes. This remains
true regardless of whether you use RPC. The message won't be modified by
the broker, so if you are seeing differences then the problem is
probably in your encoding or decoding process.

> 2. Where Can i find a good json rpc documentation and examples? 

The 6th tutorial covers RPC:
http://www.rabbitmq.com/tutorials/tutorial-six-java.html

Also see the JSON RPC examples included with the Java client:
http://hg.rabbitmq.com/rabbitmq-java-client/file/default/src/com/rabbitmq/tools/jsonrpc/



Regards

Emile

From dhivya.swaminathan at tcs.com  Mon Aug  8 11:38:17 2011
From: dhivya.swaminathan at tcs.com (Dhivya Swaminathan)
Date: Mon, 8 Aug 2011 16:08:17 +0530
Subject: [rabbitmq-discuss] Rabbitmq upgrade from 2.4.1 to 2.5.0
Message-ID: <OF3054005A.BAF25314-ON652578E6.0039AE89-652578E6.003A6DF1@tcs.com>


Hi,

I wanted to try Federation plugin,so tried to install
rabbitme-server-2.5.0 ,where in my m/c already had
rabbitmq-server-2.4.1.Before 2.5.0,2.4.1 server was working fine.When i
started 2.5.0 server both of them are failing to run and it shows the error
as below.

Error on 2.4.1 server

[318467 at CEG318 Rabbitmq-unix]$ cd rabbitmq_server-2.4.1/sbin/
[318467 at CEG318 sbin]$ ./rabbitmq-server
{error_logger,{{2011,8,8},{13,7,56}},"Error when
reading /home/318467/.erlang.cookie: eacces",[]}
{error_logger,{{2011,8,8},{13,7,56}},crash_report,[[{initial_call,{auth,init,['Argument__1']}},{pid,<0.19.0>},{registered_name,[]},{error_info,{exit,{"Error
 when reading /home/318467/.erlang.cookie:
eacces",[{auth,init_cookie,0},{auth,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]},[{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{ancestors,[net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[<0.17.0>]},{dictionary,[]},{trap_exit,true},{status,running},{heap_size,610},{stack_size,24},{reductions,598}],[]]}
{error_logger,{{2011,8,8},{13,7,56}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{"Error
 when reading /home/318467/.erlang.cookie:
eacces",[{auth,init_cookie,0},{auth,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{offender,[{pid,undefined},{name,auth},{mfargs,{auth,start_link,[]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
{error_logger,{{2011,8,8},{13,7,56}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfargs,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
{error_logger,{{2011,8,8},{13,7,56}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
{"Kernel pid
terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}
Kernel pid terminated (application_controller)
({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})


Error on server 2.5.0

[318467 at CEG318 rabbitmq]$
cd /home/318467/Rabbitmq-unix/rabbitmq_server-2.5.0/sbin
[318467 at CEG318 sbin]$ ./rabbitmq-server
{error_logger,{{2011,8,8},{13,5,48}},"Error when
reading /home/318467/.erlang.cookie: eacces",[]}
{error_logger,{{2011,8,8},{13,5,48}},crash_report,[[{initial_call,{auth,init,['Argument__1']}},{pid,<0.19.0>},{registered_name,[]},{error_info,{exit,{"Error
 when reading /home/318467/.erlang.cookie:
eacces",[{auth,init_cookie,0},{auth,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]},[{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{ancestors,[net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[<0.17.0>]},{dictionary,[]},{trap_exit,true},{status,running},{heap_size,610},{stack_size,24},{reductions,598}],[]]}
{error_logger,{{2011,8,8},{13,5,48}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{"Error
 when reading /home/318467/.erlang.cookie:
eacces",[{auth,init_cookie,0},{auth,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{offender,[{pid,undefined},{name,auth},{mfargs,{auth,start_link,[]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
{error_logger,{{2011,8,8},{13,5,48}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfargs,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
{error_logger,{{2011,8,8},{13,5,48}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
{"Kernel pid
terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}

Crash dump was written to: erl_crash.dump
Kernel pid terminated (application_controller)
({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})



I want to see how federation plugin works.So please suggest me something.

Dhivya Swaminathan
Tata Consultancy Services
Mailto: dhivya.swaminathan at tcs.com
Website: http://www.tcs.com
____________________________________________
Experience certainty.	IT Services
			Business Solutions
			Outsourcing
____________________________________________

=====-----=====-----=====
Notice: The information contained in this e-mail
message and/or attachments to it may contain 
confidential or privileged information. If you are 
not the intended recipient, any dissemination, use, 
review, distribution, printing or copying of the 
information contained in this e-mail message 
and/or attachments to it are strictly prohibited. If 
you have received this communication in error, 
please notify us by reply e-mail or telephone and 
immediately and permanently delete the message 
and any attachments. Thank you




From news.anand11 at gmail.com  Mon Aug  8 11:39:45 2011
From: news.anand11 at gmail.com (News Aanad)
Date: Mon, 8 Aug 2011 16:09:45 +0530
Subject: [rabbitmq-discuss] Error Creating cluster in RabbitMQ on EC2
In-Reply-To: <CABzX+qzOj40S9sVsKfBOQ1ePWBDYB-4ia5jEL=apuEKY8d49qA@mail.gmail.com>
References: <CAL9wd7dSPCeA4a7_GUGVJuOrQAkHim40GyT1a5wXsXKtt62wVg@mail.gmail.com>
	<CABzX+qxxoJo2_80uXoGg87N9S32DhjaA4bUi7wgk19+13dghog@mail.gmail.com>
	<CAL9wd7fi3iP5ZoDG0=VsEFHLaPJVJqj3TfCCYvtiGqQQztRbBw@mail.gmail.com>
	<CABzX+qzOj40S9sVsKfBOQ1ePWBDYB-4ia5jEL=apuEKY8d49qA@mail.gmail.com>
Message-ID: <CAL9wd7dsgn=S8oYx6B-s7TbX-Y1KFO7wMQFrjoGJWGfRaTjWRw@mail.gmail.com>

Thanks for reply Marek Majkowski,
    I have tried with that by setting up the port in erlang with command

        application:set_env(kernel, inet_dist_listen_min, 9100).
	application:set_env(kernel, inet_dist_listen_max, 9105).

and I have also open the port 9100-9105 and also open the port 4369.
But when I am checking  connectivity  by command net_adm:ping(nodename at host).
it gives me repies me as "pang"
Now I am confused that what should be the problem.
Is it mendatory to set it over both the EC2 Instance?


On Mon, Aug 8, 2011 at 3:34 PM, Marek Majkowski <majek04 at gmail.com> wrote:

> On Sat, Aug 6, 2011 at 06:40, News Aanad <news.anand11 at gmail.com> wrote:
> > I have opened all the prot required for rabbitmq clustering i.e.
> 5672,4369.
> > I can also ping the host name of other AMI.
>
> And what about erlang vm port controlled via inet_dist_listen_min and
> inet_dist_listen_max?
> http://www.erlang.org/faq/how_do_i.html#id55256
>
> To check if the connectivity is all right, open an erlang interpreter, type
> > net_adm:ping(nodename at host).
>
> It should print 'pong', see the erlang docs:
> http://www.erlang.org/doc/man/net_adm.html#ping-1
>
> Cheers,
>    Marek
>
> > On Fri, Aug 5, 2011 at 7:59 PM, Marek Majkowski <majek04 at gmail.com>
> wrote:
> >>
> >> On Fri, Aug 5, 2011 at 11:11, News Aanad <news.anand11 at gmail.com>
> wrote:
> >> > I want to create a cluster of RabbitMQ on EC2. I have created an AMI
> of
> >> > Ubantu and install the rabbitmq-server-2.3.1 on it. I have also
> >> > installed
> >> > the management plugins for GUI. For cluster purpose I have also copied
> >> > the
> >> > .erlang.cookie file in another node. My ploblem is when I am trying to
> >> > connect with another node it gives me following error:
> >> >
> >> > Error: {failed_to_cluster_with,['rabbit at ip-10-58-54-170'], "Mnesia
> could
> >> > not
> >> > connect to some nodes."}
> >> >
> >> > Anybody has any idea why it is happening?
> >>
> >> Isn't that a firewall issue?
> >>
> >> Cheers,
> >>   Marek
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110808/4c45d0d5/attachment.htm>

From majek04 at gmail.com  Mon Aug  8 11:57:30 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Mon, 8 Aug 2011 11:57:30 +0100
Subject: [rabbitmq-discuss] Error Creating cluster in RabbitMQ on EC2
In-Reply-To: <CAL9wd7dsgn=S8oYx6B-s7TbX-Y1KFO7wMQFrjoGJWGfRaTjWRw@mail.gmail.com>
References: <CAL9wd7dSPCeA4a7_GUGVJuOrQAkHim40GyT1a5wXsXKtt62wVg@mail.gmail.com>
	<CABzX+qxxoJo2_80uXoGg87N9S32DhjaA4bUi7wgk19+13dghog@mail.gmail.com>
	<CAL9wd7fi3iP5ZoDG0=VsEFHLaPJVJqj3TfCCYvtiGqQQztRbBw@mail.gmail.com>
	<CABzX+qzOj40S9sVsKfBOQ1ePWBDYB-4ia5jEL=apuEKY8d49qA@mail.gmail.com>
	<CAL9wd7dsgn=S8oYx6B-s7TbX-Y1KFO7wMQFrjoGJWGfRaTjWRw@mail.gmail.com>
Message-ID: <CABzX+qzTxZhic_MNNxGB4Y76yGt2_1au54S_t+r7j88N8QZKZA@mail.gmail.com>

On Mon, Aug 8, 2011 at 11:39, News Aanad <news.anand11 at gmail.com> wrote:
> Thanks for reply Marek Majkowski,
> ??? I have tried with that by setting up the port in erlang with command
>
>         application:set_env(kernel, inet_dist_listen_min, 9100).
> 	application:set_env(kernel, inet_dist_listen_max, 9105).
>
> and I have also open the port 9100-9105 and also open the port 4369.
> But when I am checking? connectivity? by command
> net_adm:ping(nodename at host).? it gives me repies me as "pang"
> Now I am confused that what should be the problem.
> Is it mendatory to set it over both the EC2 Instance?

RabbitMQ clustering is based on Erlang clustering. If you want to setup
a rabbitmq cluster, you should make sure that the firewall is properly
configured and that erlang clustering indeed works.

I propose that before you try to cluster rabbits, you should try
to set up the most straightforward erlang cluster, to prove
that the firewall and settings are correct.

One of the options to play with it is by using erlang interperter.

Actually I misled you, running erlang interpreter without any options
won't work,
you must set a cookie, make sure that the inet_dist_listen_min/max settings
are correct.

There is plenty of resources about erlang clustering available online.

Cheers,
  Marek

> On Mon, Aug 8, 2011 at 3:34 PM, Marek Majkowski <majek04 at gmail.com> wrote:
>>
>> On Sat, Aug 6, 2011 at 06:40, News Aanad <news.anand11 at gmail.com> wrote:
>> > I have opened all the prot required for rabbitmq clustering i.e.
>> > 5672,4369.
>> > I can also ping the host name of other AMI.
>>
>> And what about erlang vm port controlled via inet_dist_listen_min and
>> inet_dist_listen_max?
>> http://www.erlang.org/faq/how_do_i.html#id55256
>>
>> To check if the connectivity is all right, open an erlang interpreter,
>> type
>> > net_adm:ping(nodename at host).
>>
>> It should print 'pong', see the erlang docs:
>> http://www.erlang.org/doc/man/net_adm.html#ping-1
>>
>> Cheers,
>> ? Marek
>>
>> > On Fri, Aug 5, 2011 at 7:59 PM, Marek Majkowski <majek04 at gmail.com>
>> > wrote:
>> >>
>> >> On Fri, Aug 5, 2011 at 11:11, News Aanad <news.anand11 at gmail.com>
>> >> wrote:
>> >> > I want to create a cluster of RabbitMQ on EC2. I have created an AMI
>> >> > of
>> >> > Ubantu and install the rabbitmq-server-2.3.1 on it. I have also
>> >> > installed
>> >> > the management plugins for GUI. For cluster purpose I have also
>> >> > copied
>> >> > the
>> >> > .erlang.cookie file in another node. My ploblem is when I am trying
>> >> > to
>> >> > connect with another node it gives me following error:
>> >> >
>> >> > Error: {failed_to_cluster_with,['rabbit at ip-10-58-54-170'], "Mnesia
>> >> > could
>> >> > not
>> >> > connect to some nodes."}
>> >> >
>> >> > Anybody has any idea why it is happening?
>> >>
>> >> Isn't that a firewall issue?
>> >>
>> >> Cheers,
>> >> ? Marek
>> >
>> >
>
>

From abhijit.sinha at kiprosh.com  Mon Aug  8 15:09:19 2011
From: abhijit.sinha at kiprosh.com (Abhijit)
Date: Mon, 08 Aug 2011 19:39:19 +0530
Subject: [rabbitmq-discuss] facing issues with the SSL implementations with
 RabbitMQ + Windows + .Net
Message-ID: <4E3FEE0F.6000306@kiprosh.com>

Hi,

We had develop an application for the RabbitMQ both the publisher as 
well as subscriber using the fanout exchange, which is working fine. But 
now we want to implement the ssl with our publisher as well as 
subscriber to provide traffic encryption. But haven't been able to 
implement and getting it worked still, i have followed the steps as 
provided in this link : _http://www.rabbitmq.com/ssl.html_. I have 
created the certificates as instructed in this blog, also i have 
implemented the code for .net as provided. I have not been able to find 
out does my code refers to the rabbitmq.config file which i have created 
as per the rabbitmq blog and placed it in the appdata/rabbitMQ as for 
windows. But am not sure is this being referred,
the config file:
> [
>   {rabbit, [
>      {ssl_listeners, [5671]},
>      {ssl_options, [{cacertfile,"C:\testca/cacert.cer"},
>                     {certfile,"C:\server/cert.pem"},
>                     {keyfile,"C:\server/key.pem"},
>                     {verify,verify_peer},
>                     {fail_if_no_peer_cert,false}]}
>    ]}
> ]
we are using the rabbitMQ Service with the latest version of 2.5.1, 
Erlang R14B02 and on .Net on Windows. Am i missing something or do we 
need something extra for running on .net and windows.

Thanks and Regards,
Abhijit

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110808/c4b9d7ae/attachment.htm>

From alexandru at rabbitmq.com  Mon Aug  8 16:01:49 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Mon, 8 Aug 2011 16:01:49 +0100
Subject: [rabbitmq-discuss] facing issues with the SSL implementations
 with RabbitMQ + Windows + .Net
In-Reply-To: <4E3FEE0F.6000306@kiprosh.com>
References: <4E3FEE0F.6000306@kiprosh.com>
Message-ID: <20110808150149.GA2823@dakota.eng.vmware.com>

Hello Abhijit,

Could you please also post the broker log and the full stacktrace from
the .NET client?

In the meantime, I suspect your config is wrong.  It should probably be:
[
 {rabbit, [
	   {ssl_listeners, [{"0.0.0.0",5671}]},
	   {ssl_options,
	   [{cacertfile,"C:\\testca\\cacert.cer"},
	    {certfile,"C:\\server\\cert.pem"},
	    {keyfile,"C:\\server\\key.pem"},
	    {verify,verify_peer},
	    {fail_if_no_peer_cert,false}]}
	  ]}
].

(there should be a dot at the end of the file, ssl_listeners has the wrong
format, and the paths don't look properly escaped)

You can check the broker's log file to see if SSL is working or not as
suggested here:
  http://stackoverflow.com/questions/6978843/ssl-support-for-rabbit-net-windows

Cheers,
Alex

On Mon, Aug 08, 2011 at 07:39:19PM +0530, Abhijit wrote:
> Hi,
> 
> We had develop an application for the RabbitMQ both the publisher as 
> well as subscriber using the fanout exchange, which is working fine. But 
> now we want to implement the ssl with our publisher as well as 
> subscriber to provide traffic encryption. But haven't been able to 
> implement and getting it worked still, i have followed the steps as 
> provided in this link : _http://www.rabbitmq.com/ssl.html_. I have 
> created the certificates as instructed in this blog, also i have 
> implemented the code for .net as provided. I have not been able to find 
> out does my code refers to the rabbitmq.config file which i have created 
> as per the rabbitmq blog and placed it in the appdata/rabbitMQ as for 
> windows. But am not sure is this being referred,
> the config file:
> > [
> >   {rabbit, [
> >      {ssl_listeners, [5671]},
> >      {ssl_options, [{cacertfile,"C:\testca/cacert.cer"},
> >                     {certfile,"C:\server/cert.pem"},
> >                     {keyfile,"C:\server/key.pem"},
> >                     {verify,verify_peer},
> >                     {fail_if_no_peer_cert,false}]}
> >    ]}
> > ]
> we are using the rabbitMQ Service with the latest version of 2.5.1, 
> Erlang R14B02 and on .Net on Windows. Am i missing something or do we 
> need something extra for running on .net and windows.
> 
> Thanks and Regards,
> Abhijit
> 

> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From matthias at rabbitmq.com  Mon Aug  8 16:06:31 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 08 Aug 2011 16:06:31 +0100
Subject: [rabbitmq-discuss] RabbitMQ and Stomp topic behavior
In-Reply-To: <CAMOXM2-vt7fVArCVN_p_1Lmn8e+ubR+d3S2KFu9M=9Jy8FZRxA@mail.gmail.com>
References: <CAMOXM28j7MMaPtrCyFLsdS1p4-RbbBgp8zH27dvcvmSEXV1RKA@mail.gmail.com>
	<CAMOXM2-vt7fVArCVN_p_1Lmn8e+ubR+d3S2KFu9M=9Jy8FZRxA@mail.gmail.com>
Message-ID: <4E3FFB77.5060903@rabbitmq.com>

Massimo,

On 07/08/11 20:52, Massimo Paladin wrote:
> Why does the memory goes up if there are no consumers attached to the topic?

Messages are processed in a fully asynchronous pipeline, and the 
decision on whether to discard a message is made at a later stage.

Having this pipeline allows rabbit to absorb spikes in message load, 
i.e. it can read messages off the socket quickly and pass them to the 
next stage of the pipeline.

However, if the load is not a spike and instead is consistently high 
then obviously rabbit will run out of memory eventually. To prevent 
that, memory usage is monitored and producers are temporarily blocked to 
relieve memory pressure. So...

> The scenario provided makes memory increasing and if you let it run for
> some time at some point rabbitmq crashes because it can not allocate memory.

That shouldn't happen. Do you get any memory alarms in the rabbit logs? 
Also, does Rabbit run out of memory with the default threshold of 0.4?

Regards,

Matthias.

From majek04 at gmail.com  Mon Aug  8 16:16:54 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Mon, 8 Aug 2011 16:16:54 +0100
Subject: [rabbitmq-discuss] RabbitMQ on EC2 performance challenge
In-Reply-To: <CAO=2P+Jg5Hp1hJDHjYkjJPGEtq0YWGt7Mf=W8iiapTY2CsmhZw@mail.gmail.com>
References: <CAO=2P+Jg5Hp1hJDHjYkjJPGEtq0YWGt7Mf=W8iiapTY2CsmhZw@mail.gmail.com>
Message-ID: <CABzX+qyqnn3mjH11nvsEP2qcNrkaam18sZJkZnkDC3VHaemAFA@mail.gmail.com>

On Thu, Aug 4, 2011 at 10:40, Jaymin Shah <sjaymin at gmail.com> wrote:
> What could be performance expectations of RabbitMQ on EC2? Would appreciate
> sharing experience here.
>
> I am trying to do some performance test of RabbitMQ on aws EC2. I have 3
> separate EC2 instance running for RabbitMQ, Publisher and consumer/worker.
>
> The scenario I have is that Publisher pushes JSON string (approx 165-200
> bytes) to exchange type direct with durable set to true and bind queue with
> durable set to true (i.e. both in persistent mode). Consumer/worker is
> running on separate box - keeps pulling messages. (Moving forward these
> messages at worker are expected to be persisted in MongoDB and Publisher
> would be replaced with Restful ?service using REST easy)
>
> To keep things simple I have simulated this scenario by using Multicast
> sample code. I had split multicast code in to two separate java file namely
> ?Producer? and ?Worker? to run each on separate box. I have used ?c1.mediam?
> EC2 with Ubuntu server v11.4 32 bit for running producer and consumer and
> ?m1.large? with Ubuntu server v11.4 64 bit for RabbitMQ.

Sounds sensible.

> I am able to achieve a throughput of 3-5k messages per second i.e. keeping
> study message push rate to 5K. (This concur with
> http://www.rabbitmq.com/faq.html#performance-latency)
>
> Further, when I increase the push rate to 10-12k messages per second.
> Consumer?s ability to consume messages drops to 1-2k messages per second and
> it generates backlog (Many time it goes below 800 messages per second too).
>
> With above scenario, I have following questions and would appreciate
> thoughts/suggestion to improve throughput of consumer as well. ?(NOTE: all
> the messages in my scenario are expected to similar type giving no
> opportunity to group them for setting routing therefore may need some kind
> of load-balancer approach)
>
> 1)?This performance is observed with one rabbitMQ server, one exchange and
> one queue. Is anything further can be configured, fine-tuned to improvise
> throughput to more than 5k with persistent mode.

Oh, you're sending persistent messages. Can you repeat the test for the
transient messages?

Why are you using persistence? I'm not sure what's the point,
as you're running on ec2, you have no guarantees whatsoever,
ebs may die, your local storage may die.

BTW, are you using ebs or just local ec2 disk?

> 2)?I do understand, clustering could be another option. However, I need to
> set cluster based on incoming load and I may not get message grouping /
> identity to define routing (since messages are expected to be just log
> description). Can I have clustering following load balancing option for
> worker/consumer?

Clustering can increase performance only in a very few cases.
You must use multiple queues, configure clients to connect
to different nodes and have a good connectivity between nodes.
Clustering is a bit like setting few separate rabbitmq servers
that are able to exchange messages between them
(and obviously they share a namespace).

> 3)?I am expected to process several hundred thousand requests per second. I
> would appreciate sharing some experience and approach to achieve this.

You should think about setting few rabbitmq instances (using clustering or
as completely separate instances) and using at least one queue
on every rabbit.

Cheers,
   Marek

From matthias at rabbitmq.com  Mon Aug  8 16:19:03 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 08 Aug 2011 16:19:03 +0100
Subject: [rabbitmq-discuss] Rabbitmq upgrade from 2.4.1 to 2.5.0
In-Reply-To: <OF3054005A.BAF25314-ON652578E6.0039AE89-652578E6.003A6DF1@tcs.com>
References: <OF3054005A.BAF25314-ON652578E6.0039AE89-652578E6.003A6DF1@tcs.com>
Message-ID: <4E3FFE67.5040606@rabbitmq.com>

Dhivya,

On 08/08/11 11:38, Dhivya Swaminathan wrote:
> rabbitmq-server-2.4.1.Before 2.5.0,2.4.1 server was working fine.When i
> started 2.5.0 server both of them are failing to run and it shows the error
> as below.
>
> Error on 2.4.1 server
>
> [318467 at CEG318 Rabbitmq-unix]$ cd rabbitmq_server-2.4.1/sbin/
> [318467 at CEG318 sbin]$ ./rabbitmq-server
> {error_logger,{{2011,8,8},{13,7,56}},"Error when
> reading /home/318467/.erlang.cookie: eacces",[]}

There's your problem: the server doesn't have permission to read the 
.erlang.cookie file.

Regards,

Matthias.

From Massimo.Paladin at cern.ch  Mon Aug  8 16:19:11 2011
From: Massimo.Paladin at cern.ch (Massimo Paladin)
Date: Mon, 8 Aug 2011 17:19:11 +0200
Subject: [rabbitmq-discuss] RabbitMQ and Stomp topic behavior
In-Reply-To: <4E3FFB77.5060903@rabbitmq.com>
References: <CAMOXM28j7MMaPtrCyFLsdS1p4-RbbBgp8zH27dvcvmSEXV1RKA@mail.gmail.com>
	<CAMOXM2-vt7fVArCVN_p_1Lmn8e+ubR+d3S2KFu9M=9Jy8FZRxA@mail.gmail.com>
	<4E3FFB77.5060903@rabbitmq.com>
Message-ID: <CAMOXM28hGfczSAUH5ELmhYzaZ0QfQe3T_1D-Ju5Hmaf-Zmef3w@mail.gmail.com>

I tried in two machines, in one I had 0.5, in the other I did not set it
which means the default is 0.4.

They both crashed and I get many memory alarms and clears in the log.

The memory goes up and down through the test, and soon or later it fills
both memory and swap until it gets to crash.

Cheers,
---
Massimo Paladin

email: massimo.paladin at gmail.com
website: http://www.mpaladin.com
flickr's page: http://flickr.com/photos/massimop


On Mon, Aug 8, 2011 at 5:06 PM, Matthias Radestock <matthias at rabbitmq.com>wrote:

> Massimo,
>
>
> On 07/08/11 20:52, Massimo Paladin wrote:
>
>> Why does the memory goes up if there are no consumers attached to the
>> topic?
>>
>
> Messages are processed in a fully asynchronous pipeline, and the decision
> on whether to discard a message is made at a later stage.
>
> Having this pipeline allows rabbit to absorb spikes in message load, i.e.
> it can read messages off the socket quickly and pass them to the next stage
> of the pipeline.
>
> However, if the load is not a spike and instead is consistently high then
> obviously rabbit will run out of memory eventually. To prevent that, memory
> usage is monitored and producers are temporarily blocked to relieve memory
> pressure. So...
>
>
>  The scenario provided makes memory increasing and if you let it run for
>> some time at some point rabbitmq crashes because it can not allocate
>> memory.
>>
>
> That shouldn't happen. Do you get any memory alarms in the rabbit logs?
> Also, does Rabbit run out of memory with the default threshold of 0.4?
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110808/7bb9a00a/attachment.htm>

From matthias at rabbitmq.com  Mon Aug  8 16:23:07 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 08 Aug 2011 16:23:07 +0100
Subject: [rabbitmq-discuss] RabbitMQ and Stomp topic behavior
In-Reply-To: <CAMOXM28hGfczSAUH5ELmhYzaZ0QfQe3T_1D-Ju5Hmaf-Zmef3w@mail.gmail.com>
References: <CAMOXM28j7MMaPtrCyFLsdS1p4-RbbBgp8zH27dvcvmSEXV1RKA@mail.gmail.com>
	<CAMOXM2-vt7fVArCVN_p_1Lmn8e+ubR+d3S2KFu9M=9Jy8FZRxA@mail.gmail.com>
	<4E3FFB77.5060903@rabbitmq.com>
	<CAMOXM28hGfczSAUH5ELmhYzaZ0QfQe3T_1D-Ju5Hmaf-Zmef3w@mail.gmail.com>
Message-ID: <4E3FFF5B.5060105@rabbitmq.com>

Massimo,

On 08/08/11 16:19, Massimo Paladin wrote:
> I tried in two machines, in one I had 0.5, in the other I did not set it
> which means the default is 0.4.
>
> They both crashed and I get many memory alarms and clears in the log.
>
> The memory goes up and down through the test, and soon or later it fills
> both memory and swap until it gets to crash.

Interesting. To rule out one possibility, please repeat the test with 
the 0.4 setting *and without the management plug-in (or any other 
plug-ins except those needed for stomp)*.


Regards,

Matthias.

From rutherford218 at gmail.com  Mon Aug  8 16:34:33 2011
From: rutherford218 at gmail.com (Brian .)
Date: Mon, 8 Aug 2011 10:34:33 -0500
Subject: [rabbitmq-discuss] java.io.IOException because of Parameters
Message-ID: <CAMXQGZoEGU4ceO43OoPCNJcZ0wncN6CnZi7hq6NDCNQqbbDm4A@mail.gmail.com>

I get an error (pated below) when I try to configure spring integration with
rabbitmq. It says "parameters for queue 'translate.queue' in vhost '/' not
equivalent" is the reason. I am guessing that there are parameters in the
queue creation that need to be defined because of the spring integration.
Anyone know anything about the stack trace errors and a possible fix.

TIA,
Brian

org.springframework.amqp.AmqpIOException: java.io.IOException
at
org.springframework.amqp.rabbit.connection.RabbitUtils.convertRabbitAccessException(RabbitUtils.java:117)
at
org.springframework.amqp.rabbit.connection.RabbitAccessor.convertRabbitAccessException(RabbitAccessor.java:106)
at
org.springframework.amqp.rabbit.core.RabbitTemplate.execute(RabbitTemplate.java:314)
at
org.springframework.amqp.rabbit.core.RabbitAdmin.declareQueue(RabbitAdmin.java:109)
at
com.inwk.translate.transact.impl.MessageSendImpl.sendMessageToQueue(MessageSendImpl.java:37)
at
com.inwk.translate.test.message.MessageSendTest.testMessageSend(MessageSendTest.java:17)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at
sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
at java.lang.reflect.Method.invoke(Method.java:597)
at
org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:44)
at
org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:15)
at
org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:41)
at
org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:20)
at
org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:28)
at
org.springframework.test.context.junit4.statements.RunBeforeTestMethodCallbacks.evaluate(RunBeforeTestMethodCallbacks.java:74)
at
org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:31)
at
org.springframework.test.context.junit4.statements.RunAfterTestMethodCallbacks.evaluate(RunAfterTestMethodCallbacks.java:82)
at
org.springframework.test.context.junit4.statements.SpringRepeat.evaluate(SpringRepeat.java:72)
at
org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:240)
at
org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:46)
at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:180)
at org.junit.runners.ParentRunner.access$000(ParentRunner.java:41)
at org.junit.runners.ParentRunner$1.evaluate(ParentRunner.java:173)
at
org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:28)
at
org.springframework.test.context.junit4.statements.RunBeforeTestClassCallbacks.evaluate(RunBeforeTestClassCallbacks.java:61)
at
org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:31)
at
org.springframework.test.context.junit4.statements.RunAfterTestClassCallbacks.evaluate(RunAfterTestClassCallbacks.java:70)
at org.junit.runners.ParentRunner.run(ParentRunner.java:220)
at
org.springframework.test.context.junit4.SpringJUnit4ClassRunner.run(SpringJUnit4ClassRunner.java:180)
at
org.eclipse.jdt.internal.junit4.runner.JUnit4TestReference.run(JUnit4TestReference.java:49)
at
org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.java:38)
at
org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:467)
at
org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:683)
at
org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:390)
at
org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:197)
Caused by: java.io.IOException
at com.rabbitmq.client.impl.AMQChannel.wrap(AMQChannel.java:107)
at com.rabbitmq.client.impl.AMQChannel.exnWrappingRpc(AMQChannel.java:131)
at com.rabbitmq.client.impl.ChannelN.queueDeclare(ChannelN.java:608)
at com.rabbitmq.client.impl.ChannelN.queueDeclare(ChannelN.java:59)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at
sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
at java.lang.reflect.Method.invoke(Method.java:597)
at
org.springframework.amqp.rabbit.connection.CachingConnectionFactory$CachedChannelInvocationHandler.invoke(CachingConnectionFactory.java:220)
at $Proxy40.queueDeclare(Unknown Source)
at
org.springframework.amqp.rabbit.core.RabbitAdmin.declareQueues(RabbitAdmin.java:323)
at
org.springframework.amqp.rabbit.core.RabbitAdmin.access$100(RabbitAdmin.java:45)
at
org.springframework.amqp.rabbit.core.RabbitAdmin$3.doInRabbit(RabbitAdmin.java:111)
at
org.springframework.amqp.rabbit.core.RabbitTemplate.execute(RabbitTemplate.java:309)
... 33 more
Caused by: com.rabbitmq.client.ShutdownSignalException: channel error;
reason:
{#method<channel.close>(reply-code=406,reply-text=PRECONDITION_FAILED -
parameters for queue 'translate.queue' in vhost '/' not
equivalent,class-id=50,method-id=10),null,""}
at com.rabbitmq.utility.ValueOrException.getValue(ValueOrException.java:67)
at
com.rabbitmq.utility.BlockingValueOrException.uninterruptibleGetValue(BlockingValueOrException.java:33)
at
com.rabbitmq.client.impl.AMQChannel$BlockingRpcContinuation.getReply(AMQChannel.java:328)
at com.rabbitmq.client.impl.AMQChannel.rpc(AMQChannel.java:201)
at com.rabbitmq.client.impl.AMQChannel.exnWrappingRpc(AMQChannel.java:125)
... 45 more
Caused by: com.rabbitmq.client.ShutdownSignalException: channel error;
reason:
{#method<channel.close>(reply-code=406,reply-text=PRECONDITION_FAILED -
parameters for queue 'translate.queue' in vhost '/' not
equivalent,class-id=50,method-id=10),null,""}
at com.rabbitmq.client.impl.ChannelN.asyncShutdown(ChannelN.java:365)
at com.rabbitmq.client.impl.ChannelN.processAsync(ChannelN.java:235)
at
com.rabbitmq.client.impl.AMQChannel.handleCompleteInboundCommand(AMQChannel.java:151)
at com.rabbitmq.client.impl.AMQChannel.handleFrame(AMQChannel.java:96)
at
com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:446)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110808/4280e7a0/attachment.htm>

From trefor at tetrabyte.com  Mon Aug  8 16:41:15 2011
From: trefor at tetrabyte.com (TreforT)
Date: Mon, 8 Aug 2011 08:41:15 -0700 (PDT)
Subject: [rabbitmq-discuss] Issues starting RabbitMQ 2.5.1 on Ubuntu 10.04
Message-ID: <32219482.post@talk.nabble.com>


Hi All,

Wondering if you can all help me from going bald as I am pulling out my
hair, trying to get RabbitMQ working.

I install it and It comes up with:

Setting up rabbitmq-server (2.5.1-1) ...
Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/startup_{log,
_err}
rabbitmq-server.
invoke-rc.d: initscript rabbitmq-server, action "start" failed.
dpkg: error processing rabbitmq-server (--configure):
 subprocess installed post-installation script returned error exit status 1
Errors were encountered while processing:
 rabbitmq-server
E: Sub-process /usr/bin/dpkg returned an error code (1)

The logs look like this:

Startup_log:

Activating RabbitMQ plugins ...
0 plugins activated:

Startup_err:

Failed to create thread: Resource temporarily unavailable (11)


As you can see, its not a lot to look at! :(

Any ideas and anything else you would like me to do, please just let me
know.

Kind Regards,
Trefor
-- 
View this message in context: http://old.nabble.com/Issues-starting-RabbitMQ-2.5.1-on-Ubuntu-10.04-tp32219482p32219482.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110808/b3b59bdd/attachment.htm>

From matthias at rabbitmq.com  Mon Aug  8 16:43:01 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 08 Aug 2011 16:43:01 +0100
Subject: [rabbitmq-discuss] RabbitMQ and Stomp topic behavior
In-Reply-To: <4E3FFF5B.5060105@rabbitmq.com>
References: <CAMOXM28j7MMaPtrCyFLsdS1p4-RbbBgp8zH27dvcvmSEXV1RKA@mail.gmail.com>
	<CAMOXM2-vt7fVArCVN_p_1Lmn8e+ubR+d3S2KFu9M=9Jy8FZRxA@mail.gmail.com>
	<4E3FFB77.5060903@rabbitmq.com>
	<CAMOXM28hGfczSAUH5ELmhYzaZ0QfQe3T_1D-Ju5Hmaf-Zmef3w@mail.gmail.com>
	<4E3FFF5B.5060105@rabbitmq.com>
Message-ID: <4E400405.8000001@rabbitmq.com>

Massimo,

On 08/08/11 16:23, Matthias Radestock wrote:
> To rule out one possibility, please repeat the test with
> the 0.4 setting *and without the management plug-in (or any other
> plug-ins except those needed for stomp)*.

One more thing...It would also be helpful if you sent us the report 
produced by
   rabbitmqctl report > rabbit_report.txt
when the broker is getting close to running out of memory.

(the 'report' command only exists in rabbit >= 2.5.0).

Regards,

Matthias.

From dhivya.swaminathan at tcs.com  Tue Aug  9 06:45:01 2011
From: dhivya.swaminathan at tcs.com (Dhivya Swaminathan)
Date: Tue, 9 Aug 2011 11:15:01 +0530
Subject: [rabbitmq-discuss] Rabbitmq upgrade from 2.4.1 to 2.5.0
In-Reply-To: <4E3FFE67.5040606@rabbitmq.com>
References: <OF3054005A.BAF25314-ON652578E6.0039AE89-652578E6.003A6DF1@tcs.com>
	<4E3FFE67.5040606@rabbitmq.com>
Message-ID: <OF159919E7.29612363-ON652578E7.001F5CB9-652578E7.001F9445@tcs.com>



Hi Matthias,

Even after changing the permissions,I dnt have any luck.

Error

[318467 at CEG318 sbin]$ sudo chmod -R 777 /home/318467/.erlang.cookie
[318467 at CEG318 sbin]$ ./rabbitmq-server
{error_logger,{{2011,8,9},{11,5,32}},"Cookie
file /home/318467/.erlang.cookie must be accessible by owner only",[]}
{error_logger,{{2011,8,9},{11,5,32}},crash_report,[[{initial_call,{auth,init,['Argument__1']}},{pid,<0.19.0>},{registered_name,[]},{error_info,{exit,{"Cookie
 file /home/318467/.erlang.cookie must be accessible by owner
only",[{auth,init_cookie,0},{auth,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]},[{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{ancestors,[net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[<0.17.0>]},{dictionary,[]},{trap_exit,true},{status,running},{heap_size,987},{stack_size,24},{reductions,433}],[]]}
{error_logger,{{2011,8,9},{11,5,32}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{"Cookie
 file /home/318467/.erlang.cookie must be accessible by owner
only",[{auth,init_cookie,0},{auth,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{offender,[{pid,undefined},{name,auth},{mfargs,{auth,start_link,[]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
{error_logger,{{2011,8,9},{11,5,32}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfargs,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
{error_logger,{{2011,8,9},{11,5,32}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
{"Kernel pid
terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}

Crash dump was written to: erl_crash.dump
Kernel pid terminated (application_controller)
({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})
[318467 at CEG318 sbin]$

Dhivya Swaminathan
Tata Consultancy Services
Mailto: dhivya.swaminathan at tcs.com
Website: http://www.tcs.com
____________________________________________
Experience certainty.	IT Services
			Business Solutions
			Outsourcing
____________________________________________


                                                                                                                    
  From:       Matthias Radestock <matthias at rabbitmq.com>                                                            
                                                                                                                    
  To:         Dhivya Swaminathan <dhivya.swaminathan at tcs.com>                                                       
                                                                                                                    
  Cc:         rabbitmq-discuss at lists.rabbitmq.com                                                                   
                                                                                                                    
  Date:       08/08/2011 08:49 PM                                                                                   
                                                                                                                    
  Subject:    Re: [rabbitmq-discuss] Rabbitmq upgrade from 2.4.1 to 2.5.0                                           
                                                                                                                    





Dhivya,

On 08/08/11 11:38, Dhivya Swaminathan wrote:
> rabbitmq-server-2.4.1.Before 2.5.0,2.4.1 server was working fine.When i
> started 2.5.0 server both of them are failing to run and it shows the
error
> as below.
>
> Error on 2.4.1 server
>
> [318467 at CEG318 Rabbitmq-unix]$ cd rabbitmq_server-2.4.1/sbin/
> [318467 at CEG318 sbin]$ ./rabbitmq-server
> {error_logger,{{2011,8,8},{13,7,56}},"Error when
> reading /home/318467/.erlang.cookie: eacces",[]}

There's your problem: the server doesn't have permission to read the
.erlang.cookie file.

Regards,

Matthias.




=====-----=====-----=====
Notice: The information contained in this e-mail
message and/or attachments to it may contain 
confidential or privileged information. If you are 
not the intended recipient, any dissemination, use, 
review, distribution, printing or copying of the 
information contained in this e-mail message 
and/or attachments to it are strictly prohibited. If 
you have received this communication in error, 
please notify us by reply e-mail or telephone and 
immediately and permanently delete the message 
and any attachments. Thank you




From matthias at rabbitmq.com  Tue Aug  9 08:01:32 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 09 Aug 2011 08:01:32 +0100
Subject: [rabbitmq-discuss] Rabbitmq upgrade from 2.4.1 to 2.5.0
In-Reply-To: <OF159919E7.29612363-ON652578E7.001F5CB9-652578E7.001F9445@tcs.com>
References: <OF3054005A.BAF25314-ON652578E6.0039AE89-652578E6.003A6DF1@tcs.com>
	<4E3FFE67.5040606@rabbitmq.com>
	<OF159919E7.29612363-ON652578E7.001F5CB9-652578E7.001F9445@tcs.com>
Message-ID: <4E40DB4C.4030802@rabbitmq.com>

Dhivya,

On 09/08/11 06:45, Dhivya Swaminathan wrote:
> Even after changing the permissions,I dnt have any luck.
>
> Error
>
> [318467 at CEG318 sbin]$ sudo chmod -R 777 /home/318467/.erlang.cookie
> [318467 at CEG318 sbin]$ ./rabbitmq-server
> {error_logger,{{2011,8,9},{11,5,32}},"Cookie
> file /home/318467/.erlang.cookie must be accessible by owner only",[]}

Isn't it rather obvious from that error message what the problem is?

The cookie file contains sensitive information and therefore Erlang 
insists that only the user running Erlang has access to it. So you want 
to make sure that the file is owned by that user and permissions grant 
read access to that user only.

Regards,

Matthias.

From Massimo.Paladin at cern.ch  Tue Aug  9 08:39:55 2011
From: Massimo.Paladin at cern.ch (Massimo Paladin)
Date: Tue, 9 Aug 2011 09:39:55 +0200
Subject: [rabbitmq-discuss] RabbitMQ and Stomp topic behavior
In-Reply-To: <4E400405.8000001@rabbitmq.com>
References: <CAMOXM28j7MMaPtrCyFLsdS1p4-RbbBgp8zH27dvcvmSEXV1RKA@mail.gmail.com>
	<CAMOXM2-vt7fVArCVN_p_1Lmn8e+ubR+d3S2KFu9M=9Jy8FZRxA@mail.gmail.com>
	<4E3FFB77.5060903@rabbitmq.com>
	<CAMOXM28hGfczSAUH5ELmhYzaZ0QfQe3T_1D-Ju5Hmaf-Zmef3w@mail.gmail.com>
	<4E3FFF5B.5060105@rabbitmq.com> <4E400405.8000001@rabbitmq.com>
Message-ID: <CAMOXM29=Svs6JM+m+t45cKoQUimy=2KL75=heW9zJFt_0RXPHw@mail.gmail.com>

It crashed also with only stomp and amqp_client plugins.

Attached you can find the latest report I got in one run and a crash dump.

The configuration is minimal:
[
    {rabbit, [
        {default_vhost, <<"rabbitmq">>},
        {default_user, <<"guest">>},
        {default_pass, <<"guest">>},
        {default_permissions, [<<".*">>, <<".*">>, <<".*">>]},
        {tcp_listeners, []}
    ]},
    {rabbitmq_stomp, [
        {tcp_listeners, [61223]}
    ]}
].

Cheers,
---
Massimo Paladin

email: massimo.paladin at gmail.com
website: http://www.mpaladin.com
flickr's page: http://flickr.com/photos/massimop


On Mon, Aug 8, 2011 at 5:43 PM, Matthias Radestock <matthias at rabbitmq.com>wrote:

> Massimo,
>
>
> On 08/08/11 16:23, Matthias Radestock wrote:
>
>> To rule out one possibility, please repeat the test with
>> the 0.4 setting *and without the management plug-in (or any other
>> plug-ins except those needed for stomp)*.
>>
>
> One more thing...It would also be helpful if you sent us the report
> produced by
>  rabbitmqctl report > rabbit_report.txt
> when the broker is getting close to running out of memory.
>
> (the 'report' command only exists in rabbit >= 2.5.0).
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110809/44d5fb87/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 20110809_rabbitmq_report_dump.zip
Type: application/zip
Size: 197746 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110809/44d5fb87/attachment.zip>

From matthias at rabbitmq.com  Tue Aug  9 09:08:31 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 09 Aug 2011 09:08:31 +0100
Subject: [rabbitmq-discuss] RabbitMQ and Stomp topic behavior
In-Reply-To: <CAMOXM29=Svs6JM+m+t45cKoQUimy=2KL75=heW9zJFt_0RXPHw@mail.gmail.com>
References: <CAMOXM28j7MMaPtrCyFLsdS1p4-RbbBgp8zH27dvcvmSEXV1RKA@mail.gmail.com>
	<CAMOXM2-vt7fVArCVN_p_1Lmn8e+ubR+d3S2KFu9M=9Jy8FZRxA@mail.gmail.com>
	<4E3FFB77.5060903@rabbitmq.com>
	<CAMOXM28hGfczSAUH5ELmhYzaZ0QfQe3T_1D-Ju5Hmaf-Zmef3w@mail.gmail.com>
	<4E3FFF5B.5060105@rabbitmq.com> <4E400405.8000001@rabbitmq.com>
	<CAMOXM29=Svs6JM+m+t45cKoQUimy=2KL75=heW9zJFt_0RXPHw@mail.gmail.com>
Message-ID: <4E40EAFF.1010804@rabbitmq.com>

Massimo,

On 09/08/11 08:39, Massimo Paladin wrote:
> It crashed also with only stomp and amqp_client plugins.
>
> Attached you can find the latest report I got in one run and a crash dump.

According to the crash dump, rabbit is failing to allocate 6.9G when it 
already has 5.8G, giving a total of 12.7G. You said your machine has 
16GB of RAM and 8GB of swap, so growing a process to 12.7G shouldn't be 
a problem. What memory threshold does rabbit report in its logs? And do 
you have other programs running that consume a large amount of memory? 
Check with 'ps auxw --sort vsz'.

Regards,

Matthias.

From Massimo.Paladin at cern.ch  Tue Aug  9 09:38:11 2011
From: Massimo.Paladin at cern.ch (Massimo Paladin)
Date: Tue, 9 Aug 2011 10:38:11 +0200
Subject: [rabbitmq-discuss] RabbitMQ and Stomp topic behavior
In-Reply-To: <4E40EAFF.1010804@rabbitmq.com>
References: <CAMOXM28j7MMaPtrCyFLsdS1p4-RbbBgp8zH27dvcvmSEXV1RKA@mail.gmail.com>
	<CAMOXM2-vt7fVArCVN_p_1Lmn8e+ubR+d3S2KFu9M=9Jy8FZRxA@mail.gmail.com>
	<4E3FFB77.5060903@rabbitmq.com>
	<CAMOXM28hGfczSAUH5ELmhYzaZ0QfQe3T_1D-Ju5Hmaf-Zmef3w@mail.gmail.com>
	<4E3FFF5B.5060105@rabbitmq.com> <4E400405.8000001@rabbitmq.com>
	<CAMOXM29=Svs6JM+m+t45cKoQUimy=2KL75=heW9zJFt_0RXPHw@mail.gmail.com>
	<4E40EAFF.1010804@rabbitmq.com>
Message-ID: <CAMOXM2_2XbwMr5ajyVHvhwkoEuK1hWWHE9jLz+Wf7VhOuF17ZQ@mail.gmail.com>

This report and dump is related to another machine which has 8GB of memory
and 4GB of swap.

Do you also want a crash of the other machine?

Cheers,
---
Massimo Paladin

email: massimo.paladin at gmail.com
website: http://www.mpaladin.com
flickr's page: http://flickr.com/photos/massimop


On Tue, Aug 9, 2011 at 10:08 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Massimo,
>
>
> On 09/08/11 08:39, Massimo Paladin wrote:
>
>> It crashed also with only stomp and amqp_client plugins.
>>
>> Attached you can find the latest report I got in one run and a crash dump.
>>
>
> According to the crash dump, rabbit is failing to allocate 6.9G when it
> already has 5.8G, giving a total of 12.7G. You said your machine has 16GB of
> RAM and 8GB of swap, so growing a process to 12.7G shouldn't be a problem.
> What memory threshold does rabbit report in its logs? And do you have other
> programs running that consume a large amount of memory? Check with 'ps auxw
> --sort vsz'.
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110809/aac937d6/attachment.htm>

From matthias at rabbitmq.com  Tue Aug  9 09:41:41 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 09 Aug 2011 09:41:41 +0100
Subject: [rabbitmq-discuss] RabbitMQ and Stomp topic behavior
In-Reply-To: <CAMOXM2_2XbwMr5ajyVHvhwkoEuK1hWWHE9jLz+Wf7VhOuF17ZQ@mail.gmail.com>
References: <CAMOXM28j7MMaPtrCyFLsdS1p4-RbbBgp8zH27dvcvmSEXV1RKA@mail.gmail.com>
	<CAMOXM2-vt7fVArCVN_p_1Lmn8e+ubR+d3S2KFu9M=9Jy8FZRxA@mail.gmail.com>
	<4E3FFB77.5060903@rabbitmq.com>
	<CAMOXM28hGfczSAUH5ELmhYzaZ0QfQe3T_1D-Ju5Hmaf-Zmef3w@mail.gmail.com>
	<4E3FFF5B.5060105@rabbitmq.com> <4E400405.8000001@rabbitmq.com>
	<CAMOXM29=Svs6JM+m+t45cKoQUimy=2KL75=heW9zJFt_0RXPHw@mail.gmail.com>
	<4E40EAFF.1010804@rabbitmq.com>
	<CAMOXM2_2XbwMr5ajyVHvhwkoEuK1hWWHE9jLz+Wf7VhOuF17ZQ@mail.gmail.com>
Message-ID: <4E40F2C5.2000603@rabbitmq.com>

Massimo,

On 09/08/11 09:38, Massimo Paladin wrote:
> This report and dump is related to another machine which has 8GB of
> memory and 4GB of swap.

Ah ok. Would be good to see the rabbit.log file.

> Do you also want a crash of the other machine?

I don't think that's necessary. Having it fail in one place is good/bad 
enough.


Matthias.

From Massimo.Paladin at cern.ch  Tue Aug  9 09:47:41 2011
From: Massimo.Paladin at cern.ch (Massimo Paladin)
Date: Tue, 9 Aug 2011 10:47:41 +0200
Subject: [rabbitmq-discuss] RabbitMQ and Stomp topic behavior
In-Reply-To: <4E40F2C5.2000603@rabbitmq.com>
References: <CAMOXM28j7MMaPtrCyFLsdS1p4-RbbBgp8zH27dvcvmSEXV1RKA@mail.gmail.com>
	<CAMOXM2-vt7fVArCVN_p_1Lmn8e+ubR+d3S2KFu9M=9Jy8FZRxA@mail.gmail.com>
	<4E3FFB77.5060903@rabbitmq.com>
	<CAMOXM28hGfczSAUH5ELmhYzaZ0QfQe3T_1D-Ju5Hmaf-Zmef3w@mail.gmail.com>
	<4E3FFF5B.5060105@rabbitmq.com> <4E400405.8000001@rabbitmq.com>
	<CAMOXM29=Svs6JM+m+t45cKoQUimy=2KL75=heW9zJFt_0RXPHw@mail.gmail.com>
	<4E40EAFF.1010804@rabbitmq.com>
	<CAMOXM2_2XbwMr5ajyVHvhwkoEuK1hWWHE9jLz+Wf7VhOuF17ZQ@mail.gmail.com>
	<4E40F2C5.2000603@rabbitmq.com>
Message-ID: <CAMOXM296Yq5gKQsbNbkRmF_=1oprjwDzHqMUYLD5fFhr+b-P_Q@mail.gmail.com>

All log files attached.

Cheers,
---
Massimo Paladin

email: massimo.paladin at gmail.com
website: http://www.mpaladin.com
flickr's page: http://flickr.com/photos/massimop


On Tue, Aug 9, 2011 at 10:41 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Massimo,
>
>
> On 09/08/11 09:38, Massimo Paladin wrote:
>
>> This report and dump is related to another machine which has 8GB of
>> memory and 4GB of swap.
>>
>
> Ah ok. Would be good to see the rabbit.log file.
>
>
>  Do you also want a crash of the other machine?
>>
>
> I don't think that's necessary. Having it fail in one place is good/bad
> enough.
>
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110809/9e943b7b/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 20110809_rabbitmq_log.tgz
Type: application/x-gzip
Size: 1816 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110809/9e943b7b/attachment.bin>

From alexandru at rabbitmq.com  Tue Aug  9 11:24:26 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Tue, 9 Aug 2011 11:24:26 +0100
Subject: [rabbitmq-discuss] facing issues with the SSL implementations
 with RabbitMQ + Windows + .Net
In-Reply-To: <4E40D8C8.804@kiprosh.com>
References: <4E3FEE0F.6000306@kiprosh.com>
	<20110808150149.GA2823@dakota.eng.vmware.com>
	<4E40D8C8.804@kiprosh.com>
Message-ID: <20110809102426.GA3214@dakota.eng.vmware.com>

Hi Abhijit,

> Thanks for the reply, i had tried with those escape sequences in the 
> config earlier but without any success. i haven't used that dot in the 
> config , but tried that now and also restarted the rabbitMQ server 
> before running my application. But the application failed. Am posting 
> all the broker log's content and full stack trace from the .Net Client.

Great.

> Am getting the error, the moment am writing the code Ssl.Enabled = true; 
> else the connection is working fine.

Unless you use Ssl.Enabled = true, the client will just use a normal
(non-SSL) connection.

> > =INFO REPORT==== 9-Aug-2011::11:39:05 ===
> > Limiting to approx 924 file handles (829 sockets)
> >
> > =INFO REPORT==== 9-Aug-2011::11:39:05 ===
> > Memory limit set to 804MB.
> >
> > =INFO REPORT==== 9-Aug-2011::11:39:05 ===
> > msg_store_transient: using rabbit_msg_store_ets_index to provide index
> >
> > =INFO REPORT==== 9-Aug-2011::11:39:05 ===
> > msg_store_persistent: using rabbit_msg_store_ets_index to provide index
> >
> > =INFO REPORT==== 9-Aug-2011::11:39:05 ===
> > started TCP Listener on [::]:5672
> >
> > =INFO REPORT==== 9-Aug-2011::11:39:05 ===
> > started TCP Listener on 0.0.0.0:5672

If that's the entire log, then the SSL listener isn't started.  The SSL
Listener is started by the {ssl_listeners, [{"0.0.0.0",5671}]} entry.
It will start even if the other ssl_options are wrong or missing (so the
paths don't matter for this, at least).  When started, the next lines in
the log should be:

 =INFO REPORT==== 9-Aug-2011::10:38:08 ===
 started SSL Listener on 0.0.0.0:5671

Thinking about it, since you didn't get an error earlier when you forgot
the dot, I suspect rabbit isn't using the configuration file you wrote.

If you're using the default configuration (i.e. if you downloaded the
installer and are using the service), the configuration file should be
C:\Users\Administrator\AppData\Roaming\RabbitMQ\rabbitmq.config.  Is
that what you're editing?

You can also run the C:\Program Files\RabbitMQ
Server\rabbitmq-server-2.5.1\sbin\rabbitmq-server.bat from a console to
get slightly more detailed output.

Cheers,
Alex

On Tue, Aug 09, 2011 at 12:20:48PM +0530, Abhijit wrote:
> Hi Sir,
> 
> Thanks for the reply, i had tried with those escape sequences in the 
> config earlier but without any success. i haven't used that dot in the 
> config , but tried that now and also restarted the rabbitMQ server 
> before running my application. But the application failed. Am posting 
> all the broker log's content and full stack trace from the .Net Client.
> 
> Am getting the error, the moment am writing the code Ssl.Enabled = true; 
> else the connection is working fine.
> 
> _Exception Details and Stack-trace :_
> 
> > Exception Message: None of the specified endpoints were reachable
> >
> > Source: RabbitMQ.Client
> >
> > Stacktrace: at 
> > RabbitMQ.Client.ConnectionFactory.CreateConnection(Int32 maxRedirects)
> >                    at RabbitMQ.Client.ConnectionFactory.CreateConnection()
> >                    at RabbitProducer.Program.Main(String[] args) in 
> > C:\Users\pc 1\Documents\Visual Studio 
> > 2008\Projects\RabbitProducer\RabbitProducer\Program.cs:line 36
> 
> Brokers Log :
> 
> >
> > =INFO REPORT==== 9-Aug-2011::11:39:05 ===
> > Limiting to approx 924 file handles (829 sockets)
> >
> > =INFO REPORT==== 9-Aug-2011::11:39:05 ===
> > Memory limit set to 804MB.
> >
> > =INFO REPORT==== 9-Aug-2011::11:39:05 ===
> > msg_store_transient: using rabbit_msg_store_ets_index to provide index
> >
> > =INFO REPORT==== 9-Aug-2011::11:39:05 ===
> > msg_store_persistent: using rabbit_msg_store_ets_index to provide index
> >
> > =INFO REPORT==== 9-Aug-2011::11:39:05 ===
> > started TCP Listener on [::]:5672
> >
> > =INFO REPORT==== 9-Aug-2011::11:39:05 ===
> > started TCP Listener on 0.0.0.0:5672
> 
> Thanks and Regards,
> Abhijit
> 
> 
> 
> 
> 
> 
> On 8/8/2011 8:31 PM, Alexandru Scvor?ov wrote:
> > Hello Abhijit,
> >
> > Could you please also post the broker log and the full stacktrace from
> > the .NET client?
> >
> > In the meantime, I suspect your config is wrong.  It should probably be:
> > [
> >   {rabbit, [
> > 	   {ssl_listeners, [{"0.0.0.0",5671}]},
> > 	   {ssl_options,
> > 	   [{cacertfile,"C:\\testca\\cacert.cer"},
> > 	    {certfile,"C:\\server\\cert.pem"},
> > 	    {keyfile,"C:\\server\\key.pem"},
> > 	    {verify,verify_peer},
> > 	    {fail_if_no_peer_cert,false}]}
> > 	  ]}
> > ].
> >
> > (there should be a dot at the end of the file, ssl_listeners has the wrong
> > format, and the paths don't look properly escaped)
> >
> > You can check the broker's log file to see if SSL is working or not as
> > suggested here:
> >    http://stackoverflow.com/questions/6978843/ssl-support-for-rabbit-net-windows
> >
> > Cheers,
> > Alex
> >
> > On Mon, Aug 08, 2011 at 07:39:19PM +0530, Abhijit wrote:
> >    
> >> Hi,
> >>
> >> We had develop an application for the RabbitMQ both the publisher as
> >> well as subscriber using the fanout exchange, which is working fine. But
> >> now we want to implement the ssl with our publisher as well as
> >> subscriber to provide traffic encryption. But haven't been able to
> >> implement and getting it worked still, i have followed the steps as
> >> provided in this link : _http://www.rabbitmq.com/ssl.html_. I have
> >> created the certificates as instructed in this blog, also i have
> >> implemented the code for .net as provided. I have not been able to find
> >> out does my code refers to the rabbitmq.config file which i have created
> >> as per the rabbitmq blog and placed it in the appdata/rabbitMQ as for
> >> windows. But am not sure is this being referred,
> >> the config file:
> >>      
> >>> [
> >>>    {rabbit, [
> >>>       {ssl_listeners, [5671]},
> >>>       {ssl_options, [{cacertfile,"C:\testca/cacert.cer"},
> >>>                      {certfile,"C:\server/cert.pem"},
> >>>                      {keyfile,"C:\server/key.pem"},
> >>>                      {verify,verify_peer},
> >>>                      {fail_if_no_peer_cert,false}]}
> >>>     ]}
> >>> ]
> >>>        
> >> we are using the rabbitMQ Service with the latest version of 2.5.1,
> >> Erlang R14B02 and on .Net on Windows. Am i missing something or do we
> >> need something extra for running on .net and windows.
> >>
> >> Thanks and Regards,
> >> Abhijit
> >>
> >>      
> >    
> >> _______________________________________________
> >> rabbitmq-discuss mailing list
> >> rabbitmq-discuss at lists.rabbitmq.com
> >> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >>      
> >    
> 

From rmartele at gmail.com  Tue Aug  9 11:26:26 2011
From: rmartele at gmail.com (Renaud)
Date: Tue, 9 Aug 2011 03:26:26 -0700 (PDT)
Subject: [rabbitmq-discuss] =?utf-8?b?UmXCoDogUmU6ICBSZSA6IFJlOiBDb25uZWN0?=
 =?utf-8?q?ion_closed_after_10_minutes=2E_Cause_=3A_end-of-stream?=
In-Reply-To: <28024328.77.1312797777928.JavaMail.geo-discussion-forums@yqic37>
References: <CABzX+qxOHMd-0ndiqa_+nD8396hJWtKiqJUTENQuvfJ-LhrVjQ@mail.gmail.com>
	<28024328.77.1312797777928.JavaMail.geo-discussion-forums@yqic37>
Message-ID: <23955565.1346.1312885586691.JavaMail.geo-discussion-forums@yqah42>

Hi everyone,

Finally, I didn't find the answer to my problem but : it seems that this 
problem come from VirtualBox and not from RabbitMQ...

The outgoing trafic seems to be limited by VBox.

Thanks for your help,

Renaud


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110809/3cacf80f/attachment.htm>

From alexandru at rabbitmq.com  Tue Aug  9 11:49:18 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Tue, 9 Aug 2011 11:49:18 +0100
Subject: [rabbitmq-discuss] facing issues with the SSL implementations
 with RabbitMQ + Windows + .Net
In-Reply-To: <4E410E6E.5030000@kiprosh.com>
References: <4E3FEE0F.6000306@kiprosh.com>
	<20110808150149.GA2823@dakota.eng.vmware.com>
	<4E40D8C8.804@kiprosh.com>
	<20110809102426.GA3214@dakota.eng.vmware.com>
	<4E410E6E.5030000@kiprosh.com>
Message-ID: <20110809104918.GB3214@dakota.eng.vmware.com>

> Am using the same path, C:\Users\Administrator\AppData\Roaming\RabbitMQ\rabbitmq.config for including ssl in my app.

Ok.

> But the file wasn't present earlier i had created that file in order to have SSL in my app at the same location.

That's fine.

> i tried running the bat file for the rabbitmq-server that didn't help sir, do you need any part of code for inspection.

The code isn't the problem right now.  It's getting rabbit to enable
ssl.

I'm attaching a rabbitmq.config.  Please try using that one.  Restart
the broker and the last lines in the broker log should be:

=INFO REPORT==== 9-Aug-2011::11:44:37 ===
started TCP Listener on [::]:5672

=INFO REPORT==== 9-Aug-2011::11:44:37 ===
started SSL Listener on 0.0.0.0:5671

Let me know how it goes, please.

Cheers,
Alex

On Tue, Aug 09, 2011 at 04:09:42PM +0530, Abhijit wrote:
> Hi Sir,
> 
> Am using the same path, C:\Users\Administrator\AppData\Roaming\RabbitMQ\rabbitmq.config for including ssl in my app.
> 
> But the file wasn't present earlier i had created that file in order to have SSL in my app at the same location.
> 
> i tried running the bat file for the rabbitmq-server that didn't help sir, do you need any part of code for inspection.
> 
> Thanks a lot for your time and replies.
> 
> Regards,
> Abhijit
> 
-------------- next part --------------
[
 {rabbit, [
          {ssl_listeners, [{"0.0.0.0",5671}]}
         ,{ssl_options, [{cacertfile,"C:\\testca\\cacert.cer"},
                         {certfile,"C:\\server\\cert.pem"},
                         {keyfile,"C:\\server\\key.pem"},
                         {verify,verify_peer},
                         {fail_if_no_peer_cert,true}]}
          ]}
].

From emile at rabbitmq.com  Tue Aug  9 12:00:57 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 09 Aug 2011 12:00:57 +0100
Subject: [rabbitmq-discuss] Slow startup/recovery time
In-Reply-To: <4E37F450.1050302@rabbitmq.com>
References: <CAHfDCQJwhJzLE_uVQqs59pXiGbpqXZEfesY7f6m3N90BudTr=A@mail.gmail.com>
	<4E37F450.1050302@rabbitmq.com>
Message-ID: <4E411369.6040803@rabbitmq.com>

On 02/08/11 13:57, Emile Joubert wrote:
> Hi Pablo,

>> Should I ignore such error??
>>
>> Greets
>> Pablo
>>
>> PD: I can zip & send our mnesia files just in case they are needed to
>> debug the issue.
> 
> We'd be interested in receiving those files, if you can make them
> available offlist. The error points to an unexpected logical
> inconsistency during the upgrade procedure. Can you also confirm whether
> the v2.1.1 broker was shut down cleanly?

With Pablo's sterling help we've been able to identify and fix the cause
of this problem, which relates to upgrading from version 2.1.1. The fix
will be included in the next release.


-Emile

From alexandru at rabbitmq.com  Tue Aug  9 12:20:38 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Tue, 9 Aug 2011 12:20:38 +0100
Subject: [rabbitmq-discuss] facing issues with the SSL implementations
 with RabbitMQ + Windows + .Net
In-Reply-To: <4E411620.4070301@kiprosh.com>
References: <4E3FEE0F.6000306@kiprosh.com>
	<20110808150149.GA2823@dakota.eng.vmware.com>
	<4E40D8C8.804@kiprosh.com>
	<20110809102426.GA3214@dakota.eng.vmware.com>
	<4E410E6E.5030000@kiprosh.com>
	<20110809104918.GB3214@dakota.eng.vmware.com>
	<4E411620.4070301@kiprosh.com>
Message-ID: <20110809112038.GC3214@dakota.eng.vmware.com>

Ok.  Could you delete the dot at the end (or introduce some other
syntactic error) and try again?

If it still runs, it's using a different configuration file.

Could you also add the following line to the rabbitmq-server.bat file?
  echo CONFIG_FILE: !RABBITMQ_CONFIG_FILE!.config
It should go in towards the end, right before the "!ERLANG_HOME!\bin\erl.exe"
line.

That way, when you start the server manually with the .bat, we will know
which config file it's using.

Alex

On Tue, Aug 09, 2011 at 04:42:32PM +0530, Abhijit wrote:
> hi sir,
> 
> It didn't worked as we wanted...this are the last two phrases in the log 
> file of the broker.
> 
> > =INFO REPORT==== 9-Aug-2011::16:39:52 ===
> > started TCP Listener on [::]:5692
> >
> > =INFO REPORT==== 9-Aug-2011::16:39:53 ===
> > started TCP Listener on 0.0.0.0:5692
> 
> i copied the rabbitmq.config which you sent me but didn't worked out.
> 
> Thanks and Regards,
> Abhijit
> 
> 
> 
> 
> On 8/9/2011 4:19 PM, Alexandru Scvor?ov wrote:
> >> Am using the same path, C:\Users\Administrator\AppData\Roaming\RabbitMQ\rabbitmq.config for including ssl in my app.
> >>      
> > Ok.
> >
> >    
> >> But the file wasn't present earlier i had created that file in order to have SSL in my app at the same location.
> >>      
> > That's fine.
> >
> >    
> >> i tried running the bat file for the rabbitmq-server that didn't help sir, do you need any part of code for inspection.
> >>      
> > The code isn't the problem right now.  It's getting rabbit to enable
> > ssl.
> >
> > I'm attaching a rabbitmq.config.  Please try using that one.  Restart
> > the broker and the last lines in the broker log should be:
> >
> > =INFO REPORT==== 9-Aug-2011::11:44:37 ===
> > started TCP Listener on [::]:5672
> >
> > =INFO REPORT==== 9-Aug-2011::11:44:37 ===
> > started SSL Listener on 0.0.0.0:5671
> >
> > Let me know how it goes, please.
> >
> > Cheers,
> > Alex
> >
> > On Tue, Aug 09, 2011 at 04:09:42PM +0530, Abhijit wrote:
> >    
> >> Hi Sir,
> >>
> >> Am using the same path, C:\Users\Administrator\AppData\Roaming\RabbitMQ\rabbitmq.config for including ssl in my app.
> >>
> >> But the file wasn't present earlier i had created that file in order to have SSL in my app at the same location.
> >>
> >> i tried running the bat file for the rabbitmq-server that didn't help sir, do you need any part of code for inspection.
> >>
> >> Thanks a lot for your time and replies.
> >>
> >> Regards,
> >> Abhijit
> >>
> >>      
> 

From alexandru at rabbitmq.com  Tue Aug  9 12:33:02 2011
From: alexandru at rabbitmq.com (Alexandru Scvortov)
Date: Tue, 9 Aug 2011 12:33:02 +0100
Subject: [rabbitmq-discuss] facing issues with the SSL implementations
 with RabbitMQ + Windows + .Net
In-Reply-To: <20110809112038.GC3214@dakota.eng.vmware.com>
References: <4E3FEE0F.6000306@kiprosh.com>
	<20110808150149.GA2823@dakota.eng.vmware.com>
	<4E40D8C8.804@kiprosh.com>
	<20110809102426.GA3214@dakota.eng.vmware.com>
	<4E410E6E.5030000@kiprosh.com>
	<20110809104918.GB3214@dakota.eng.vmware.com>
	<4E411620.4070301@kiprosh.com>
	<20110809112038.GC3214@dakota.eng.vmware.com>
Message-ID: <20110809113302.GD3214@dakota.eng.vmware.com>

> That way, when you start the server manually with the .bat, we will know
> which config file it's using.

That's not needed actually.  When the server starts up, under the
banner, it tells you a few things, the location of the config file
included.

So, when you start up rabbitmq-server.bat, you should see something
along the lines of:

node           : rabbit at dakota
app descriptor :
/src/rabbitmq-umbrella/rabbitmq-server/scripts/../ebin/rabbit.app
home dir       : /home/scvalex
config file(s) : /etc/rabbitmq/rabbitmq.config
cookie hash    : baqRHQDjS5VLTBROrJQBzQ==
log            : /tmp/rabbit at dakota.log
sasl log       : /tmp/rabbit at dakota-sasl.log
database dir   : /tmp/rabbitmq-rabbit-mnesia
erlang version : 5.8.4

Could you please check that the config file is the one you're editing?

Alex

On Tue, Aug 09, 2011 at 12:20:38PM +0100, Alexandru Scvor?ov wrote:
> Ok.  Could you delete the dot at the end (or introduce some other
> syntactic error) and try again?
> 
> If it still runs, it's using a different configuration file.
> 
> Could you also add the following line to the rabbitmq-server.bat file?
>   echo CONFIG_FILE: !RABBITMQ_CONFIG_FILE!.config
> It should go in towards the end, right before the "!ERLANG_HOME!\bin\erl.exe"
> line.
> 
> That way, when you start the server manually with the .bat, we will know
> which config file it's using.
> 
> Alex
> 
> On Tue, Aug 09, 2011 at 04:42:32PM +0530, Abhijit wrote:
> > hi sir,
> > 
> > It didn't worked as we wanted...this are the last two phrases in the log 
> > file of the broker.
> > 
> > > =INFO REPORT==== 9-Aug-2011::16:39:52 ===
> > > started TCP Listener on [::]:5692
> > >
> > > =INFO REPORT==== 9-Aug-2011::16:39:53 ===
> > > started TCP Listener on 0.0.0.0:5692
> > 
> > i copied the rabbitmq.config which you sent me but didn't worked out.
> > 
> > Thanks and Regards,
> > Abhijit
> > 
> > 
> > 
> > 
> > On 8/9/2011 4:19 PM, Alexandru Scvor?ov wrote:
> > >> Am using the same path, C:\Users\Administrator\AppData\Roaming\RabbitMQ\rabbitmq.config for including ssl in my app.
> > >>      
> > > Ok.
> > >
> > >    
> > >> But the file wasn't present earlier i had created that file in order to have SSL in my app at the same location.
> > >>      
> > > That's fine.
> > >
> > >    
> > >> i tried running the bat file for the rabbitmq-server that didn't help sir, do you need any part of code for inspection.
> > >>      
> > > The code isn't the problem right now.  It's getting rabbit to enable
> > > ssl.
> > >
> > > I'm attaching a rabbitmq.config.  Please try using that one.  Restart
> > > the broker and the last lines in the broker log should be:
> > >
> > > =INFO REPORT==== 9-Aug-2011::11:44:37 ===
> > > started TCP Listener on [::]:5672
> > >
> > > =INFO REPORT==== 9-Aug-2011::11:44:37 ===
> > > started SSL Listener on 0.0.0.0:5671
> > >
> > > Let me know how it goes, please.
> > >
> > > Cheers,
> > > Alex
> > >
> > > On Tue, Aug 09, 2011 at 04:09:42PM +0530, Abhijit wrote:
> > >    
> > >> Hi Sir,
> > >>
> > >> Am using the same path, C:\Users\Administrator\AppData\Roaming\RabbitMQ\rabbitmq.config for including ssl in my app.
> > >>
> > >> But the file wasn't present earlier i had created that file in order to have SSL in my app at the same location.
> > >>
> > >> i tried running the bat file for the rabbitmq-server that didn't help sir, do you need any part of code for inspection.
> > >>
> > >> Thanks a lot for your time and replies.
> > >>
> > >> Regards,
> > >> Abhijit
> > >>
> > >>      
> > 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From alexandru at rabbitmq.com  Tue Aug  9 12:50:33 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Tue, 9 Aug 2011 12:50:33 +0100
Subject: [rabbitmq-discuss] facing issues with the SSL implementations
 with RabbitMQ + Windows + .Net
In-Reply-To: <4E411AB4.30706@kiprosh.com>
References: <4E3FEE0F.6000306@kiprosh.com>
	<20110808150149.GA2823@dakota.eng.vmware.com>
	<4E40D8C8.804@kiprosh.com>
	<20110809102426.GA3214@dakota.eng.vmware.com>
	<4E410E6E.5030000@kiprosh.com>
	<20110809104918.GB3214@dakota.eng.vmware.com>
	<4E411620.4070301@kiprosh.com>
	<20110809112038.GC3214@dakota.eng.vmware.com>
	<4E411AB4.30706@kiprosh.com>
Message-ID: <20110809115033.GF3214@dakota.eng.vmware.com>

That's a bit odd.  I'm not sure how that can happen.  It looks like you
somehow set the RABBITMQ_CONFIG_FILE variable at some point.

The file is normally in: 
...\AppData\Roaming\RabbitMQ\rabbitmq.config
but your system is looking for it in:
...\AppData\Roaming\RabbitMQ.config

Could you copy the config file to "...\AppData\Roaming\RabbitMQ.config"
and try again?  Alternatively, unset the RABBITMQ_CONFIG_FILE variable
and try again without copying the file.

Cheers,
Alex

On Tue, Aug 09, 2011 at 05:02:04PM +0530, Abhijit wrote:
> I deleted the dot as you asked to and also wrote the line find which 
> config we are using, and found we are using the same config file and 
> also broker is running successfully without the dot. Am attaching the 
> print-screen for the command line output i received when i tried running 
> rabbit-mq server
> 
> 
> 
> thanks and regards,
> Abhijit
> 
> On 8/9/2011 4:50 PM, Alexandru Scvor?ov wrote:
> > Ok.  Could you delete the dot at the end (or introduce some other
> > syntactic error) and try again?
> >
> > If it still runs, it's using a different configuration file.
> >
> > Could you also add the following line to the rabbitmq-server.bat file?
> >    echo CONFIG_FILE: !RABBITMQ_CONFIG_FILE!.config
> > It should go in towards the end, right before the "!ERLANG_HOME!\bin\erl.exe"
> > line.
> >
> > That way, when you start the server manually with the .bat, we will know
> > which config file it's using.
> >
> > Alex
> >
> > On Tue, Aug 09, 2011 at 04:42:32PM +0530, Abhijit wrote:
> >    
> >> hi sir,
> >>
> >> It didn't worked as we wanted...this are the last two phrases in the log
> >> file of the broker.
> >>
> >>      
> >>> =INFO REPORT==== 9-Aug-2011::16:39:52 ===
> >>> started TCP Listener on [::]:5692
> >>>
> >>> =INFO REPORT==== 9-Aug-2011::16:39:53 ===
> >>> started TCP Listener on 0.0.0.0:5692
> >>>        
> >> i copied the rabbitmq.config which you sent me but didn't worked out.
> >>
> >> Thanks and Regards,
> >> Abhijit
> >>
> >>
> >>
> >>
> >> On 8/9/2011 4:19 PM, Alexandru Scvor?ov wrote:
> >>      
> >>>> Am using the same path, C:\Users\Administrator\AppData\Roaming\RabbitMQ\rabbitmq.config for including ssl in my app.
> >>>>
> >>>>          
> >>> Ok.
> >>>
> >>>
> >>>        
> >>>> But the file wasn't present earlier i had created that file in order to have SSL in my app at the same location.
> >>>>
> >>>>          
> >>> That's fine.
> >>>
> >>>
> >>>        
> >>>> i tried running the bat file for the rabbitmq-server that didn't help sir, do you need any part of code for inspection.
> >>>>
> >>>>          
> >>> The code isn't the problem right now.  It's getting rabbit to enable
> >>> ssl.
> >>>
> >>> I'm attaching a rabbitmq.config.  Please try using that one.  Restart
> >>> the broker and the last lines in the broker log should be:
> >>>
> >>> =INFO REPORT==== 9-Aug-2011::11:44:37 ===
> >>> started TCP Listener on [::]:5672
> >>>
> >>> =INFO REPORT==== 9-Aug-2011::11:44:37 ===
> >>> started SSL Listener on 0.0.0.0:5671
> >>>
> >>> Let me know how it goes, please.
> >>>
> >>> Cheers,
> >>> Alex
> >>>
> >>> On Tue, Aug 09, 2011 at 04:09:42PM +0530, Abhijit wrote:
> >>>
> >>>        
> >>>> Hi Sir,
> >>>>
> >>>> Am using the same path, C:\Users\Administrator\AppData\Roaming\RabbitMQ\rabbitmq.config for including ssl in my app.
> >>>>
> >>>> But the file wasn't present earlier i had created that file in order to have SSL in my app at the same location.
> >>>>
> >>>> i tried running the bat file for the rabbitmq-server that didn't help sir, do you need any part of code for inspection.
> >>>>
> >>>> Thanks a lot for your time and replies.
> >>>>
> >>>> Regards,
> >>>> Abhijit
> >>>>
> >>>>
> >>>>          
> >>      
> 

From lionel.cons at cern.ch  Tue Aug  9 13:08:28 2011
From: lionel.cons at cern.ch (Lionel Cons)
Date: Tue, 9 Aug 2011 14:08:28 +0200
Subject: [rabbitmq-discuss] rabbitmq-stomp 2.5.1 does not respect the spec
	wrt content-type
Message-ID: <20110809140039.40ee.abe10f7e5afbbb3a79ce619739541149@cern.ch>

I sent with STOMP a test message with a binary body to a RabbitMQ
2.5.1 broker and got back a garbaged text body.

More precisely, the sent message did not contain any content-type
header but the received one did contain "content-type:text/plain",
wrongly added by the broker. Some bytes from the sent message have
been replaced by the Unicode replacement character U+FFFD.

The STOMP 1.1 specification [1] contains:
 | If the content-type header is not set, the receiver SHOULD consider
 | the body to be a binary blob.

Could some Rabbit expert confirm whether this is indeed a bug or not?

Cheers,

Lionel

[1] http://stomp.github.com/stomp-specification-1.1.html#Header_content-type

From alexandru at rabbitmq.com  Tue Aug  9 13:09:26 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Tue, 9 Aug 2011 13:09:26 +0100
Subject: [rabbitmq-discuss] facing issues with the SSL implementations
 with RabbitMQ + Windows + .Net
In-Reply-To: <4E412192.5080107@kiprosh.com>
References: <20110808150149.GA2823@dakota.eng.vmware.com>
	<4E40D8C8.804@kiprosh.com>
	<20110809102426.GA3214@dakota.eng.vmware.com>
	<4E410E6E.5030000@kiprosh.com>
	<20110809104918.GB3214@dakota.eng.vmware.com>
	<4E411620.4070301@kiprosh.com>
	<20110809112038.GC3214@dakota.eng.vmware.com>
	<4E411AB4.30706@kiprosh.com>
	<20110809115033.GF3214@dakota.eng.vmware.com>
	<4E412192.5080107@kiprosh.com>
Message-ID: <20110809120926.GA28785@dakota.eng.vmware.com>

> i would go ahead for now, if any queries i would again seek your help.

Excellent.  Don't hesitate to ask us any more questions.

Also, in the future, could you please make sure to CC the mailing list
when replying?

Cheers,
Alex

On Tue, Aug 09, 2011 at 05:31:22PM +0530, Abhijit wrote:
> hi sir,
> 
> finally got this:
> > =INFO REPORT==== 9-Aug-2011::17:28:33 ===
> > started TCP Listener on 0.0.0.0:5672
> >
> > =INFO REPORT==== 9-Aug-2011::17:28:33 ===
> > started SSL Listener on 0.0.0.0:5671
> 
> your this step
> 
> Could you copy the config file to "...\AppData\Roaming\RabbitMQ.config"
> and try again
> 
> helped...
> 
> i would go ahead for now, if any queries i would again seek your help.
> 
> Thanks and Regards,
> Abhijit
> 
> On 8/9/2011 5:20 PM, Alexandru Scvor?ov wrote:
> > That's a bit odd.  I'm not sure how that can happen.  It looks like you
> > somehow set the RABBITMQ_CONFIG_FILE variable at some point.
> >
> > The file is normally in:
> > ...\AppData\Roaming\RabbitMQ\rabbitmq.config
> > but your system is looking for it in:
> > ...\AppData\Roaming\RabbitMQ.config
> >
> > Could you copy the config file to "...\AppData\Roaming\RabbitMQ.config"
> > and try again?  Alternatively, unset the RABBITMQ_CONFIG_FILE variable
> > and try again without copying the file.
> >
> > Cheers,
> > Alex
> >
> > On Tue, Aug 09, 2011 at 05:02:04PM +0530, Abhijit wrote:
> >    
> >> I deleted the dot as you asked to and also wrote the line find which
> >> config we are using, and found we are using the same config file and
> >> also broker is running successfully without the dot. Am attaching the
> >> print-screen for the command line output i received when i tried running
> >> rabbit-mq server
> >>
> >>
> >>
> >> thanks and regards,
> >> Abhijit
> >>
> >> On 8/9/2011 4:50 PM, Alexandru Scvor?ov wrote:
> >>      
> >>> Ok.  Could you delete the dot at the end (or introduce some other
> >>> syntactic error) and try again?
> >>>
> >>> If it still runs, it's using a different configuration file.
> >>>
> >>> Could you also add the following line to the rabbitmq-server.bat file?
> >>>     echo CONFIG_FILE: !RABBITMQ_CONFIG_FILE!.config
> >>> It should go in towards the end, right before the "!ERLANG_HOME!\bin\erl.exe"
> >>> line.
> >>>
> >>> That way, when you start the server manually with the .bat, we will know
> >>> which config file it's using.
> >>>
> >>> Alex
> >>>
> >>> On Tue, Aug 09, 2011 at 04:42:32PM +0530, Abhijit wrote:
> >>>
> >>>        
> >>>> hi sir,
> >>>>
> >>>> It didn't worked as we wanted...this are the last two phrases in the log
> >>>> file of the broker.
> >>>>
> >>>>
> >>>>          
> >>>>> =INFO REPORT==== 9-Aug-2011::16:39:52 ===
> >>>>> started TCP Listener on [::]:5692
> >>>>>
> >>>>> =INFO REPORT==== 9-Aug-2011::16:39:53 ===
> >>>>> started TCP Listener on 0.0.0.0:5692
> >>>>>
> >>>>>            
> >>>> i copied the rabbitmq.config which you sent me but didn't worked out.
> >>>>
> >>>> Thanks and Regards,
> >>>> Abhijit
> >>>>
> >>>>
> >>>>
> >>>>
> >>>> On 8/9/2011 4:19 PM, Alexandru Scvor?ov wrote:
> >>>>
> >>>>          
> >>>>>> Am using the same path, C:\Users\Administrator\AppData\Roaming\RabbitMQ\rabbitmq.config for including ssl in my app.
> >>>>>>
> >>>>>>
> >>>>>>              
> >>>>> Ok.
> >>>>>
> >>>>>
> >>>>>
> >>>>>            
> >>>>>> But the file wasn't present earlier i had created that file in order to have SSL in my app at the same location.
> >>>>>>
> >>>>>>
> >>>>>>              
> >>>>> That's fine.
> >>>>>
> >>>>>
> >>>>>
> >>>>>            
> >>>>>> i tried running the bat file for the rabbitmq-server that didn't help sir, do you need any part of code for inspection.
> >>>>>>
> >>>>>>
> >>>>>>              
> >>>>> The code isn't the problem right now.  It's getting rabbit to enable
> >>>>> ssl.
> >>>>>
> >>>>> I'm attaching a rabbitmq.config.  Please try using that one.  Restart
> >>>>> the broker and the last lines in the broker log should be:
> >>>>>
> >>>>> =INFO REPORT==== 9-Aug-2011::11:44:37 ===
> >>>>> started TCP Listener on [::]:5672
> >>>>>
> >>>>> =INFO REPORT==== 9-Aug-2011::11:44:37 ===
> >>>>> started SSL Listener on 0.0.0.0:5671
> >>>>>
> >>>>> Let me know how it goes, please.
> >>>>>
> >>>>> Cheers,
> >>>>> Alex
> >>>>>
> >>>>> On Tue, Aug 09, 2011 at 04:09:42PM +0530, Abhijit wrote:
> >>>>>
> >>>>>
> >>>>>            
> >>>>>> Hi Sir,
> >>>>>>
> >>>>>> Am using the same path, C:\Users\Administrator\AppData\Roaming\RabbitMQ\rabbitmq.config for including ssl in my app.
> >>>>>>
> >>>>>> But the file wasn't present earlier i had created that file in order to have SSL in my app at the same location.
> >>>>>>
> >>>>>> i tried running the bat file for the rabbitmq-server that didn't help sir, do you need any part of code for inspection.
> >>>>>>
> >>>>>> Thanks a lot for your time and replies.
> >>>>>>
> >>>>>> Regards,
> >>>>>> Abhijit
> >>>>>>
> >>>>>>
> >>>>>>
> >>>>>>              
> >>>>
> >>>>          
> >>      
> 

From abhijit.sinha at kiprosh.com  Tue Aug  9 13:22:43 2011
From: abhijit.sinha at kiprosh.com (Abhijit)
Date: Tue, 09 Aug 2011 17:52:43 +0530
Subject: [rabbitmq-discuss] facing issues with the SSL implementations
 with RabbitMQ + Windows + .Net
In-Reply-To: <20110809120926.GA28785@dakota.eng.vmware.com>
References: <20110808150149.GA2823@dakota.eng.vmware.com>
	<4E40D8C8.804@kiprosh.com>
	<20110809102426.GA3214@dakota.eng.vmware.com>
	<4E410E6E.5030000@kiprosh.com>
	<20110809104918.GB3214@dakota.eng.vmware.com>
	<4E411620.4070301@kiprosh.com>
	<20110809112038.GC3214@dakota.eng.vmware.com>
	<4E411AB4.30706@kiprosh.com>
	<20110809115033.GF3214@dakota.eng.vmware.com>
	<4E412192.5080107@kiprosh.com>
	<20110809120926.GA28785@dakota.eng.vmware.com>
Message-ID: <4E412693.7000707@kiprosh.com>

hi sir,

i installed my rabbitmq service again and its working but getting errors.

i have attached the file since the errors are lengthy putting them in 
the mail would make it shabby.

yes sir i would definitely put mails in cc from now onwards.

Thanks and Regards,
Abhijit




On 8/9/2011 5:39 PM, Alexandru Scvor?ov wrote:
>> i would go ahead for now, if any queries i would again seek your help.
>>      
> Excellent.  Don't hesitate to ask us any more questions.
>
> Also, in the future, could you please make sure to CC the mailing list
> when replying?
>
> Cheers,
> Alex
>
> On Tue, Aug 09, 2011 at 05:31:22PM +0530, Abhijit wrote:
>    
>> hi sir,
>>
>> finally got this:
>>      
>>> =INFO REPORT==== 9-Aug-2011::17:28:33 ===
>>> started TCP Listener on 0.0.0.0:5672
>>>
>>> =INFO REPORT==== 9-Aug-2011::17:28:33 ===
>>> started SSL Listener on 0.0.0.0:5671
>>>        
>> your this step
>>
>> Could you copy the config file to "...\AppData\Roaming\RabbitMQ.config"
>> and try again
>>
>> helped...
>>
>> i would go ahead for now, if any queries i would again seek your help.
>>
>> Thanks and Regards,
>> Abhijit
>>
>> On 8/9/2011 5:20 PM, Alexandru Scvor?ov wrote:
>>      
>>> That's a bit odd.  I'm not sure how that can happen.  It looks like you
>>> somehow set the RABBITMQ_CONFIG_FILE variable at some point.
>>>
>>> The file is normally in:
>>> ...\AppData\Roaming\RabbitMQ\rabbitmq.config
>>> but your system is looking for it in:
>>> ...\AppData\Roaming\RabbitMQ.config
>>>
>>> Could you copy the config file to "...\AppData\Roaming\RabbitMQ.config"
>>> and try again?  Alternatively, unset the RABBITMQ_CONFIG_FILE variable
>>> and try again without copying the file.
>>>
>>> Cheers,
>>> Alex
>>>
>>> On Tue, Aug 09, 2011 at 05:02:04PM +0530, Abhijit wrote:
>>>
>>>        
>>>> I deleted the dot as you asked to and also wrote the line find which
>>>> config we are using, and found we are using the same config file and
>>>> also broker is running successfully without the dot. Am attaching the
>>>> print-screen for the command line output i received when i tried running
>>>> rabbit-mq server
>>>>
>>>>
>>>>
>>>> thanks and regards,
>>>> Abhijit
>>>>
>>>> On 8/9/2011 4:50 PM, Alexandru Scvor?ov wrote:
>>>>
>>>>          
>>>>> Ok.  Could you delete the dot at the end (or introduce some other
>>>>> syntactic error) and try again?
>>>>>
>>>>> If it still runs, it's using a different configuration file.
>>>>>
>>>>> Could you also add the following line to the rabbitmq-server.bat file?
>>>>>      echo CONFIG_FILE: !RABBITMQ_CONFIG_FILE!.config
>>>>> It should go in towards the end, right before the "!ERLANG_HOME!\bin\erl.exe"
>>>>> line.
>>>>>
>>>>> That way, when you start the server manually with the .bat, we will know
>>>>> which config file it's using.
>>>>>
>>>>> Alex
>>>>>
>>>>> On Tue, Aug 09, 2011 at 04:42:32PM +0530, Abhijit wrote:
>>>>>
>>>>>
>>>>>            
>>>>>> hi sir,
>>>>>>
>>>>>> It didn't worked as we wanted...this are the last two phrases in the log
>>>>>> file of the broker.
>>>>>>
>>>>>>
>>>>>>
>>>>>>              
>>>>>>> =INFO REPORT==== 9-Aug-2011::16:39:52 ===
>>>>>>> started TCP Listener on [::]:5692
>>>>>>>
>>>>>>> =INFO REPORT==== 9-Aug-2011::16:39:53 ===
>>>>>>> started TCP Listener on 0.0.0.0:5692
>>>>>>>
>>>>>>>
>>>>>>>                
>>>>>> i copied the rabbitmq.config which you sent me but didn't worked out.
>>>>>>
>>>>>> Thanks and Regards,
>>>>>> Abhijit
>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>> On 8/9/2011 4:19 PM, Alexandru Scvor?ov wrote:
>>>>>>
>>>>>>
>>>>>>              
>>>>>>>> Am using the same path, C:\Users\Administrator\AppData\Roaming\RabbitMQ\rabbitmq.config for including ssl in my app.
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>                  
>>>>>>> Ok.
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>                
>>>>>>>> But the file wasn't present earlier i had created that file in order to have SSL in my app at the same location.
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>                  
>>>>>>> That's fine.
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>                
>>>>>>>> i tried running the bat file for the rabbitmq-server that didn't help sir, do you need any part of code for inspection.
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>                  
>>>>>>> The code isn't the problem right now.  It's getting rabbit to enable
>>>>>>> ssl.
>>>>>>>
>>>>>>> I'm attaching a rabbitmq.config.  Please try using that one.  Restart
>>>>>>> the broker and the last lines in the broker log should be:
>>>>>>>
>>>>>>> =INFO REPORT==== 9-Aug-2011::11:44:37 ===
>>>>>>> started TCP Listener on [::]:5672
>>>>>>>
>>>>>>> =INFO REPORT==== 9-Aug-2011::11:44:37 ===
>>>>>>> started SSL Listener on 0.0.0.0:5671
>>>>>>>
>>>>>>> Let me know how it goes, please.
>>>>>>>
>>>>>>> Cheers,
>>>>>>> Alex
>>>>>>>
>>>>>>> On Tue, Aug 09, 2011 at 04:09:42PM +0530, Abhijit wrote:
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>                
>>>>>>>> Hi Sir,
>>>>>>>>
>>>>>>>> Am using the same path, C:\Users\Administrator\AppData\Roaming\RabbitMQ\rabbitmq.config for including ssl in my app.
>>>>>>>>
>>>>>>>> But the file wasn't present earlier i had created that file in order to have SSL in my app at the same location.
>>>>>>>>
>>>>>>>> i tried running the bat file for the rabbitmq-server that didn't help sir, do you need any part of code for inspection.
>>>>>>>>
>>>>>>>> Thanks a lot for your time and replies.
>>>>>>>>
>>>>>>>> Regards,
>>>>>>>> Abhijit
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>                  
>>>>>>
>>>>>>              
>>>>
>>>>          
>>      

-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: rabbit at KIPROSH7.log
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110809/03db8948/attachment.txt>

From abhijit.sinha at kiprosh.com  Tue Aug  9 13:38:19 2011
From: abhijit.sinha at kiprosh.com (Abhijit)
Date: Tue, 09 Aug 2011 18:08:19 +0530
Subject: [rabbitmq-discuss] facing issues with the SSL implementations
 with RabbitMQ + Windows + .Net
In-Reply-To: <20110809120926.GA28785@dakota.eng.vmware.com>
References: <20110808150149.GA2823@dakota.eng.vmware.com>
	<4E40D8C8.804@kiprosh.com>
	<20110809102426.GA3214@dakota.eng.vmware.com>
	<4E410E6E.5030000@kiprosh.com>
	<20110809104918.GB3214@dakota.eng.vmware.com>
	<4E411620.4070301@kiprosh.com>
	<20110809112038.GC3214@dakota.eng.vmware.com>
	<4E411AB4.30706@kiprosh.com>
	<20110809115033.GF3214@dakota.eng.vmware.com>
	<4E412192.5080107@kiprosh.com>
	<20110809120926.GA28785@dakota.eng.vmware.com>
Message-ID: <4E412A3B.60602@kiprosh.com>

hi sir,

Am basically getting this error, i tried debugging and solved most of 
the problems but still getting this:

> [{amqp-0-9://localhost:5671}] = 
> {System.Security.Authentication.AuthenticationException: A call to 
> SSPI failed, see inner exception. ---> 
> System.ComponentModel.Win32Exception: The certificate chain was issued 
> by an authority that is not trusted
>    --- End of inner exception stack trace -...

Thanks and Regards,
Abhijit




On 8/9/2011 5:39 PM, Alexandru Scvor?ov wrote:
>> i would go ahead for now, if any queries i would again seek your help.
>>      
> Excellent.  Don't hesitate to ask us any more questions.
>
> Also, in the future, could you please make sure to CC the mailing list
> when replying?
>
> Cheers,
> Alex
>
> On Tue, Aug 09, 2011 at 05:31:22PM +0530, Abhijit wrote:
>    
>> hi sir,
>>
>> finally got this:
>>      
>>> =INFO REPORT==== 9-Aug-2011::17:28:33 ===
>>> started TCP Listener on 0.0.0.0:5672
>>>
>>> =INFO REPORT==== 9-Aug-2011::17:28:33 ===
>>> started SSL Listener on 0.0.0.0:5671
>>>        
>> your this step
>>
>> Could you copy the config file to "...\AppData\Roaming\RabbitMQ.config"
>> and try again
>>
>> helped...
>>
>> i would go ahead for now, if any queries i would again seek your help.
>>
>> Thanks and Regards,
>> Abhijit
>>
>> On 8/9/2011 5:20 PM, Alexandru Scvor?ov wrote:
>>      
>>> That's a bit odd.  I'm not sure how that can happen.  It looks like you
>>> somehow set the RABBITMQ_CONFIG_FILE variable at some point.
>>>
>>> The file is normally in:
>>> ...\AppData\Roaming\RabbitMQ\rabbitmq.config
>>> but your system is looking for it in:
>>> ...\AppData\Roaming\RabbitMQ.config
>>>
>>> Could you copy the config file to "...\AppData\Roaming\RabbitMQ.config"
>>> and try again?  Alternatively, unset the RABBITMQ_CONFIG_FILE variable
>>> and try again without copying the file.
>>>
>>> Cheers,
>>> Alex
>>>
>>> On Tue, Aug 09, 2011 at 05:02:04PM +0530, Abhijit wrote:
>>>
>>>        
>>>> I deleted the dot as you asked to and also wrote the line find which
>>>> config we are using, and found we are using the same config file and
>>>> also broker is running successfully without the dot. Am attaching the
>>>> print-screen for the command line output i received when i tried running
>>>> rabbit-mq server
>>>>
>>>>
>>>>
>>>> thanks and regards,
>>>> Abhijit
>>>>
>>>> On 8/9/2011 4:50 PM, Alexandru Scvor?ov wrote:
>>>>
>>>>          
>>>>> Ok.  Could you delete the dot at the end (or introduce some other
>>>>> syntactic error) and try again?
>>>>>
>>>>> If it still runs, it's using a different configuration file.
>>>>>
>>>>> Could you also add the following line to the rabbitmq-server.bat file?
>>>>>      echo CONFIG_FILE: !RABBITMQ_CONFIG_FILE!.config
>>>>> It should go in towards the end, right before the "!ERLANG_HOME!\bin\erl.exe"
>>>>> line.
>>>>>
>>>>> That way, when you start the server manually with the .bat, we will know
>>>>> which config file it's using.
>>>>>
>>>>> Alex
>>>>>
>>>>> On Tue, Aug 09, 2011 at 04:42:32PM +0530, Abhijit wrote:
>>>>>
>>>>>
>>>>>            
>>>>>> hi sir,
>>>>>>
>>>>>> It didn't worked as we wanted...this are the last two phrases in the log
>>>>>> file of the broker.
>>>>>>
>>>>>>
>>>>>>
>>>>>>              
>>>>>>> =INFO REPORT==== 9-Aug-2011::16:39:52 ===
>>>>>>> started TCP Listener on [::]:5692
>>>>>>>
>>>>>>> =INFO REPORT==== 9-Aug-2011::16:39:53 ===
>>>>>>> started TCP Listener on 0.0.0.0:5692
>>>>>>>
>>>>>>>
>>>>>>>                
>>>>>> i copied the rabbitmq.config which you sent me but didn't worked out.
>>>>>>
>>>>>> Thanks and Regards,
>>>>>> Abhijit
>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>> On 8/9/2011 4:19 PM, Alexandru Scvor?ov wrote:
>>>>>>
>>>>>>
>>>>>>              
>>>>>>>> Am using the same path, C:\Users\Administrator\AppData\Roaming\RabbitMQ\rabbitmq.config for including ssl in my app.
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>                  
>>>>>>> Ok.
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>                
>>>>>>>> But the file wasn't present earlier i had created that file in order to have SSL in my app at the same location.
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>                  
>>>>>>> That's fine.
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>                
>>>>>>>> i tried running the bat file for the rabbitmq-server that didn't help sir, do you need any part of code for inspection.
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>                  
>>>>>>> The code isn't the problem right now.  It's getting rabbit to enable
>>>>>>> ssl.
>>>>>>>
>>>>>>> I'm attaching a rabbitmq.config.  Please try using that one.  Restart
>>>>>>> the broker and the last lines in the broker log should be:
>>>>>>>
>>>>>>> =INFO REPORT==== 9-Aug-2011::11:44:37 ===
>>>>>>> started TCP Listener on [::]:5672
>>>>>>>
>>>>>>> =INFO REPORT==== 9-Aug-2011::11:44:37 ===
>>>>>>> started SSL Listener on 0.0.0.0:5671
>>>>>>>
>>>>>>> Let me know how it goes, please.
>>>>>>>
>>>>>>> Cheers,
>>>>>>> Alex
>>>>>>>
>>>>>>> On Tue, Aug 09, 2011 at 04:09:42PM +0530, Abhijit wrote:
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>                
>>>>>>>> Hi Sir,
>>>>>>>>
>>>>>>>> Am using the same path, C:\Users\Administrator\AppData\Roaming\RabbitMQ\rabbitmq.config for including ssl in my app.
>>>>>>>>
>>>>>>>> But the file wasn't present earlier i had created that file in order to have SSL in my app at the same location.
>>>>>>>>
>>>>>>>> i tried running the bat file for the rabbitmq-server that didn't help sir, do you need any part of code for inspection.
>>>>>>>>
>>>>>>>> Thanks a lot for your time and replies.
>>>>>>>>
>>>>>>>> Regards,
>>>>>>>> Abhijit
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>                  
>>>>>>
>>>>>>              
>>>>
>>>>          
>>      


From alexandru at rabbitmq.com  Tue Aug  9 13:48:19 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Tue, 9 Aug 2011 13:48:19 +0100
Subject: [rabbitmq-discuss] facing issues with the SSL implementations
 with RabbitMQ + Windows + .Net
In-Reply-To: <4E412A3B.60602@kiprosh.com>
References: <20110809102426.GA3214@dakota.eng.vmware.com>
	<4E410E6E.5030000@kiprosh.com>
	<20110809104918.GB3214@dakota.eng.vmware.com>
	<4E411620.4070301@kiprosh.com>
	<20110809112038.GC3214@dakota.eng.vmware.com>
	<4E411AB4.30706@kiprosh.com>
	<20110809115033.GF3214@dakota.eng.vmware.com>
	<4E412192.5080107@kiprosh.com>
	<20110809120926.GA28785@dakota.eng.vmware.com>
	<4E412A3B.60602@kiprosh.com>
Message-ID: <20110809124819.GB28785@dakota.eng.vmware.com>

> Am basically getting this error, i tried debugging and solved most of 
> the problems but still getting this:

Oh, great. My guess about the really long error was that you needed some
clients to connect without providing certificates, but
fail_if_no_peer_cert was set to true in the config file.  Was that
right?

> > [{amqp-0-9://localhost:5671}] = 
> > {System.Security.Authentication.AuthenticationException: A call to 
> > SSPI failed, see inner exception. ---> 
> > System.ComponentModel.Win32Exception: The certificate chain was issued 
> > by an authority that is not trusted

I haven't seen that before.  Did you follow the steps in our SSL guide
to generate the certificate (in particular, were the client certificates
signed by the CA set in the broker)?

Alex

On Tue, Aug 09, 2011 at 06:08:19PM +0530, Abhijit wrote:
> hi sir,
> 
> Am basically getting this error, i tried debugging and solved most of 
> the problems but still getting this:
> 
> > [{amqp-0-9://localhost:5671}] = 
> > {System.Security.Authentication.AuthenticationException: A call to 
> > SSPI failed, see inner exception. ---> 
> > System.ComponentModel.Win32Exception: The certificate chain was issued 
> > by an authority that is not trusted
> >    --- End of inner exception stack trace -...
> 
> Thanks and Regards,
> Abhijit
> 
> 
> 
> 
> On 8/9/2011 5:39 PM, Alexandru Scvor?ov wrote:
> >> i would go ahead for now, if any queries i would again seek your help.
> >>      
> > Excellent.  Don't hesitate to ask us any more questions.
> >
> > Also, in the future, could you please make sure to CC the mailing list
> > when replying?
> >
> > Cheers,
> > Alex
> >
> > On Tue, Aug 09, 2011 at 05:31:22PM +0530, Abhijit wrote:
> >    
> >> hi sir,
> >>
> >> finally got this:
> >>      
> >>> =INFO REPORT==== 9-Aug-2011::17:28:33 ===
> >>> started TCP Listener on 0.0.0.0:5672
> >>>
> >>> =INFO REPORT==== 9-Aug-2011::17:28:33 ===
> >>> started SSL Listener on 0.0.0.0:5671
> >>>        
> >> your this step
> >>
> >> Could you copy the config file to "...\AppData\Roaming\RabbitMQ.config"
> >> and try again
> >>
> >> helped...
> >>
> >> i would go ahead for now, if any queries i would again seek your help.
> >>
> >> Thanks and Regards,
> >> Abhijit
> >>
> >> On 8/9/2011 5:20 PM, Alexandru Scvor?ov wrote:
> >>      
> >>> That's a bit odd.  I'm not sure how that can happen.  It looks like you
> >>> somehow set the RABBITMQ_CONFIG_FILE variable at some point.
> >>>
> >>> The file is normally in:
> >>> ...\AppData\Roaming\RabbitMQ\rabbitmq.config
> >>> but your system is looking for it in:
> >>> ...\AppData\Roaming\RabbitMQ.config
> >>>
> >>> Could you copy the config file to "...\AppData\Roaming\RabbitMQ.config"
> >>> and try again?  Alternatively, unset the RABBITMQ_CONFIG_FILE variable
> >>> and try again without copying the file.
> >>>
> >>> Cheers,
> >>> Alex
> >>>
> >>> On Tue, Aug 09, 2011 at 05:02:04PM +0530, Abhijit wrote:
> >>>
> >>>        
> >>>> I deleted the dot as you asked to and also wrote the line find which
> >>>> config we are using, and found we are using the same config file and
> >>>> also broker is running successfully without the dot. Am attaching the
> >>>> print-screen for the command line output i received when i tried running
> >>>> rabbit-mq server
> >>>>
> >>>>
> >>>>
> >>>> thanks and regards,
> >>>> Abhijit
> >>>>
> >>>> On 8/9/2011 4:50 PM, Alexandru Scvor?ov wrote:
> >>>>
> >>>>          
> >>>>> Ok.  Could you delete the dot at the end (or introduce some other
> >>>>> syntactic error) and try again?
> >>>>>
> >>>>> If it still runs, it's using a different configuration file.
> >>>>>
> >>>>> Could you also add the following line to the rabbitmq-server.bat file?
> >>>>>      echo CONFIG_FILE: !RABBITMQ_CONFIG_FILE!.config
> >>>>> It should go in towards the end, right before the "!ERLANG_HOME!\bin\erl.exe"
> >>>>> line.
> >>>>>
> >>>>> That way, when you start the server manually with the .bat, we will know
> >>>>> which config file it's using.
> >>>>>
> >>>>> Alex
> >>>>>
> >>>>> On Tue, Aug 09, 2011 at 04:42:32PM +0530, Abhijit wrote:
> >>>>>
> >>>>>
> >>>>>            
> >>>>>> hi sir,
> >>>>>>
> >>>>>> It didn't worked as we wanted...this are the last two phrases in the log
> >>>>>> file of the broker.
> >>>>>>
> >>>>>>
> >>>>>>
> >>>>>>              
> >>>>>>> =INFO REPORT==== 9-Aug-2011::16:39:52 ===
> >>>>>>> started TCP Listener on [::]:5692
> >>>>>>>
> >>>>>>> =INFO REPORT==== 9-Aug-2011::16:39:53 ===
> >>>>>>> started TCP Listener on 0.0.0.0:5692
> >>>>>>>
> >>>>>>>
> >>>>>>>                
> >>>>>> i copied the rabbitmq.config which you sent me but didn't worked out.
> >>>>>>
> >>>>>> Thanks and Regards,
> >>>>>> Abhijit
> >>>>>>
> >>>>>>
> >>>>>>
> >>>>>>
> >>>>>> On 8/9/2011 4:19 PM, Alexandru Scvor?ov wrote:
> >>>>>>
> >>>>>>
> >>>>>>              
> >>>>>>>> Am using the same path, C:\Users\Administrator\AppData\Roaming\RabbitMQ\rabbitmq.config for including ssl in my app.
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>                  
> >>>>>>> Ok.
> >>>>>>>
> >>>>>>>
> >>>>>>>
> >>>>>>>
> >>>>>>>                
> >>>>>>>> But the file wasn't present earlier i had created that file in order to have SSL in my app at the same location.
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>                  
> >>>>>>> That's fine.
> >>>>>>>
> >>>>>>>
> >>>>>>>
> >>>>>>>
> >>>>>>>                
> >>>>>>>> i tried running the bat file for the rabbitmq-server that didn't help sir, do you need any part of code for inspection.
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>                  
> >>>>>>> The code isn't the problem right now.  It's getting rabbit to enable
> >>>>>>> ssl.
> >>>>>>>
> >>>>>>> I'm attaching a rabbitmq.config.  Please try using that one.  Restart
> >>>>>>> the broker and the last lines in the broker log should be:
> >>>>>>>
> >>>>>>> =INFO REPORT==== 9-Aug-2011::11:44:37 ===
> >>>>>>> started TCP Listener on [::]:5672
> >>>>>>>
> >>>>>>> =INFO REPORT==== 9-Aug-2011::11:44:37 ===
> >>>>>>> started SSL Listener on 0.0.0.0:5671
> >>>>>>>
> >>>>>>> Let me know how it goes, please.
> >>>>>>>
> >>>>>>> Cheers,
> >>>>>>> Alex
> >>>>>>>
> >>>>>>> On Tue, Aug 09, 2011 at 04:09:42PM +0530, Abhijit wrote:
> >>>>>>>
> >>>>>>>
> >>>>>>>
> >>>>>>>                
> >>>>>>>> Hi Sir,
> >>>>>>>>
> >>>>>>>> Am using the same path, C:\Users\Administrator\AppData\Roaming\RabbitMQ\rabbitmq.config for including ssl in my app.
> >>>>>>>>
> >>>>>>>> But the file wasn't present earlier i had created that file in order to have SSL in my app at the same location.
> >>>>>>>>
> >>>>>>>> i tried running the bat file for the rabbitmq-server that didn't help sir, do you need any part of code for inspection.
> >>>>>>>>
> >>>>>>>> Thanks a lot for your time and replies.
> >>>>>>>>
> >>>>>>>> Regards,
> >>>>>>>> Abhijit
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>                  
> >>>>>>
> >>>>>>              
> >>>>
> >>>>          
> >>      
> 

From abhijit.sinha at kiprosh.com  Tue Aug  9 13:52:23 2011
From: abhijit.sinha at kiprosh.com (Abhijit)
Date: Tue, 09 Aug 2011 18:22:23 +0530
Subject: [rabbitmq-discuss] facing issues with the SSL implementations
 with RabbitMQ + Windows + .Net
In-Reply-To: <20110809124819.GB28785@dakota.eng.vmware.com>
References: <20110809102426.GA3214@dakota.eng.vmware.com>
	<4E410E6E.5030000@kiprosh.com>
	<20110809104918.GB3214@dakota.eng.vmware.com>
	<4E411620.4070301@kiprosh.com>
	<20110809112038.GC3214@dakota.eng.vmware.com>
	<4E411AB4.30706@kiprosh.com>
	<20110809115033.GF3214@dakota.eng.vmware.com>
	<4E412192.5080107@kiprosh.com>
	<20110809120926.GA28785@dakota.eng.vmware.com>
	<4E412A3B.60602@kiprosh.com>
	<20110809124819.GB28785@dakota.eng.vmware.com>
Message-ID: <4E412D87.2080806@kiprosh.com>

ya sir that was set true, i would go back and look at my certification 
creation steps and find out whether i did everything properly.

and would let you know once that i done.

Thanks and Regards,
Abhijit

On 8/9/2011 6:18 PM, Alexandru Scvor?ov wrote:
>> Am basically getting this error, i tried debugging and solved most of
>> the problems but still getting this:
>>      
> Oh, great. My guess about the really long error was that you needed some
> clients to connect without providing certificates, but
> fail_if_no_peer_cert was set to true in the config file.  Was that
> right?
>
>    
>>> [{amqp-0-9://localhost:5671}] =
>>> {System.Security.Authentication.AuthenticationException: A call to
>>> SSPI failed, see inner exception. --->
>>> System.ComponentModel.Win32Exception: The certificate chain was issued
>>> by an authority that is not trusted
>>>        
> I haven't seen that before.  Did you follow the steps in our SSL guide
> to generate the certificate (in particular, were the client certificates
> signed by the CA set in the broker)?
>
> Alex
>
> On Tue, Aug 09, 2011 at 06:08:19PM +0530, Abhijit wrote:
>    
>> hi sir,
>>
>> Am basically getting this error, i tried debugging and solved most of
>> the problems but still getting this:
>>
>>      
>>> [{amqp-0-9://localhost:5671}] =
>>> {System.Security.Authentication.AuthenticationException: A call to
>>> SSPI failed, see inner exception. --->
>>> System.ComponentModel.Win32Exception: The certificate chain was issued
>>> by an authority that is not trusted
>>>     --- End of inner exception stack trace -...
>>>        
>> Thanks and Regards,
>> Abhijit
>>
>>
>>
>>
>> On 8/9/2011 5:39 PM, Alexandru Scvor?ov wrote:
>>      
>>>> i would go ahead for now, if any queries i would again seek your help.
>>>>
>>>>          
>>> Excellent.  Don't hesitate to ask us any more questions.
>>>
>>> Also, in the future, could you please make sure to CC the mailing list
>>> when replying?
>>>
>>> Cheers,
>>> Alex
>>>
>>> On Tue, Aug 09, 2011 at 05:31:22PM +0530, Abhijit wrote:
>>>
>>>        
>>>> hi sir,
>>>>
>>>> finally got this:
>>>>
>>>>          
>>>>> =INFO REPORT==== 9-Aug-2011::17:28:33 ===
>>>>> started TCP Listener on 0.0.0.0:5672
>>>>>
>>>>> =INFO REPORT==== 9-Aug-2011::17:28:33 ===
>>>>> started SSL Listener on 0.0.0.0:5671
>>>>>
>>>>>            
>>>> your this step
>>>>
>>>> Could you copy the config file to "...\AppData\Roaming\RabbitMQ.config"
>>>> and try again
>>>>
>>>> helped...
>>>>
>>>> i would go ahead for now, if any queries i would again seek your help.
>>>>
>>>> Thanks and Regards,
>>>> Abhijit
>>>>
>>>> On 8/9/2011 5:20 PM, Alexandru Scvor?ov wrote:
>>>>
>>>>          
>>>>> That's a bit odd.  I'm not sure how that can happen.  It looks like you
>>>>> somehow set the RABBITMQ_CONFIG_FILE variable at some point.
>>>>>
>>>>> The file is normally in:
>>>>> ...\AppData\Roaming\RabbitMQ\rabbitmq.config
>>>>> but your system is looking for it in:
>>>>> ...\AppData\Roaming\RabbitMQ.config
>>>>>
>>>>> Could you copy the config file to "...\AppData\Roaming\RabbitMQ.config"
>>>>> and try again?  Alternatively, unset the RABBITMQ_CONFIG_FILE variable
>>>>> and try again without copying the file.
>>>>>
>>>>> Cheers,
>>>>> Alex
>>>>>
>>>>> On Tue, Aug 09, 2011 at 05:02:04PM +0530, Abhijit wrote:
>>>>>
>>>>>
>>>>>            
>>>>>> I deleted the dot as you asked to and also wrote the line find which
>>>>>> config we are using, and found we are using the same config file and
>>>>>> also broker is running successfully without the dot. Am attaching the
>>>>>> print-screen for the command line output i received when i tried running
>>>>>> rabbit-mq server
>>>>>>
>>>>>>
>>>>>>
>>>>>> thanks and regards,
>>>>>> Abhijit
>>>>>>
>>>>>> On 8/9/2011 4:50 PM, Alexandru Scvor?ov wrote:
>>>>>>
>>>>>>
>>>>>>              
>>>>>>> Ok.  Could you delete the dot at the end (or introduce some other
>>>>>>> syntactic error) and try again?
>>>>>>>
>>>>>>> If it still runs, it's using a different configuration file.
>>>>>>>
>>>>>>> Could you also add the following line to the rabbitmq-server.bat file?
>>>>>>>       echo CONFIG_FILE: !RABBITMQ_CONFIG_FILE!.config
>>>>>>> It should go in towards the end, right before the "!ERLANG_HOME!\bin\erl.exe"
>>>>>>> line.
>>>>>>>
>>>>>>> That way, when you start the server manually with the .bat, we will know
>>>>>>> which config file it's using.
>>>>>>>
>>>>>>> Alex
>>>>>>>
>>>>>>> On Tue, Aug 09, 2011 at 04:42:32PM +0530, Abhijit wrote:
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>                
>>>>>>>> hi sir,
>>>>>>>>
>>>>>>>> It didn't worked as we wanted...this are the last two phrases in the log
>>>>>>>> file of the broker.
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>                  
>>>>>>>>> =INFO REPORT==== 9-Aug-2011::16:39:52 ===
>>>>>>>>> started TCP Listener on [::]:5692
>>>>>>>>>
>>>>>>>>> =INFO REPORT==== 9-Aug-2011::16:39:53 ===
>>>>>>>>> started TCP Listener on 0.0.0.0:5692
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>                    
>>>>>>>> i copied the rabbitmq.config which you sent me but didn't worked out.
>>>>>>>>
>>>>>>>> Thanks and Regards,
>>>>>>>> Abhijit
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>> On 8/9/2011 4:19 PM, Alexandru Scvor?ov wrote:
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>                  
>>>>>>>>>> Am using the same path, C:\Users\Administrator\AppData\Roaming\RabbitMQ\rabbitmq.config for including ssl in my app.
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>                      
>>>>>>>>> Ok.
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>                    
>>>>>>>>>> But the file wasn't present earlier i had created that file in order to have SSL in my app at the same location.
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>                      
>>>>>>>>> That's fine.
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>                    
>>>>>>>>>> i tried running the bat file for the rabbitmq-server that didn't help sir, do you need any part of code for inspection.
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>                      
>>>>>>>>> The code isn't the problem right now.  It's getting rabbit to enable
>>>>>>>>> ssl.
>>>>>>>>>
>>>>>>>>> I'm attaching a rabbitmq.config.  Please try using that one.  Restart
>>>>>>>>> the broker and the last lines in the broker log should be:
>>>>>>>>>
>>>>>>>>> =INFO REPORT==== 9-Aug-2011::11:44:37 ===
>>>>>>>>> started TCP Listener on [::]:5672
>>>>>>>>>
>>>>>>>>> =INFO REPORT==== 9-Aug-2011::11:44:37 ===
>>>>>>>>> started SSL Listener on 0.0.0.0:5671
>>>>>>>>>
>>>>>>>>> Let me know how it goes, please.
>>>>>>>>>
>>>>>>>>> Cheers,
>>>>>>>>> Alex
>>>>>>>>>
>>>>>>>>> On Tue, Aug 09, 2011 at 04:09:42PM +0530, Abhijit wrote:
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>                    
>>>>>>>>>> Hi Sir,
>>>>>>>>>>
>>>>>>>>>> Am using the same path, C:\Users\Administrator\AppData\Roaming\RabbitMQ\rabbitmq.config for including ssl in my app.
>>>>>>>>>>
>>>>>>>>>> But the file wasn't present earlier i had created that file in order to have SSL in my app at the same location.
>>>>>>>>>>
>>>>>>>>>> i tried running the bat file for the rabbitmq-server that didn't help sir, do you need any part of code for inspection.
>>>>>>>>>>
>>>>>>>>>> Thanks a lot for your time and replies.
>>>>>>>>>>
>>>>>>>>>> Regards,
>>>>>>>>>> Abhijit
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>                      
>>>>>>>>
>>>>>>>>                  
>>>>>>
>>>>>>              
>>>>
>>>>          
>>      


From alackner at geomix.at  Tue Aug  9 14:11:58 2011
From: alackner at geomix.at (Andreas Lackner)
Date: Tue, 9 Aug 2011 06:11:58 -0700 (PDT)
Subject: [rabbitmq-discuss]  Number of consumers on a queue
Message-ID: <32225971.post@talk.nabble.com>


Hi,

I'd like to know if there is a way to get the number of consumers that are
currently bound to a queue.
I am using the .NET client.

Greets
  Andreas
-- 
View this message in context: http://old.nabble.com/Number-of-consumers-on-a-queue-tp32225971p32225971.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From majek04 at gmail.com  Tue Aug  9 14:37:50 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Tue, 9 Aug 2011 14:37:50 +0100
Subject: [rabbitmq-discuss] Number of consumers on a queue
In-Reply-To: <32225971.post@talk.nabble.com>
References: <32225971.post@talk.nabble.com>
Message-ID: <CABzX+qxQT1D6U2TOtTGhK-tzDC275XMa6nDPKCCOZp6mJr4_5A@mail.gmail.com>

On Tue, Aug 9, 2011 at 14:11, Andreas Lackner <alackner at geomix.at> wrote:
> I'd like to know if there is a way to get the number of consumers that are
> currently bound to a queue.
> I am using the .NET client.

Check out the return value of `Queue.declare`:
   http://www.rabbitmq.com/amqp-0-9-1-reference.html#exchange.declare-ok

It returns message count and number of consumers bound to a queue.

Cheers,
   Marek

From majek04 at gmail.com  Tue Aug  9 14:46:47 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Tue, 9 Aug 2011 14:46:47 +0100
Subject: [rabbitmq-discuss] Number of consumers on a queue
In-Reply-To: <CABzX+qxQT1D6U2TOtTGhK-tzDC275XMa6nDPKCCOZp6mJr4_5A@mail.gmail.com>
References: <32225971.post@talk.nabble.com>
	<CABzX+qxQT1D6U2TOtTGhK-tzDC275XMa6nDPKCCOZp6mJr4_5A@mail.gmail.com>
Message-ID: <CABzX+qx8=cthAOiGVkBck0Ws-ZXJNwiXe_Ldc_AO7kAehaZSKg@mail.gmail.com>

On Tue, Aug 9, 2011 at 14:37, Marek Majkowski <majek04 at gmail.com> wrote:
> On Tue, Aug 9, 2011 at 14:11, Andreas Lackner <alackner at geomix.at> wrote:
>> I'd like to know if there is a way to get the number of consumers that are
>> currently bound to a queue.
>> I am using the .NET client.
>
> Check out the return value of `Queue.declare`:
> ? http://www.rabbitmq.com/amqp-0-9-1-reference.html#exchange.declare-ok
>
> It returns message count and number of consumers bound to a queue.

Apparently .net client doesn't properly return queue.declare-ok, so
it appears that in .net there is now way to read the counters. sorry.

We have a bug opened for that.

Cheers,
   Marek

From alexandru at rabbitmq.com  Tue Aug  9 15:06:58 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Tue, 9 Aug 2011 15:06:58 +0100
Subject: [rabbitmq-discuss] facing issues with the SSL implementations
 with RabbitMQ + Windows + .Net
In-Reply-To: <4E412D87.2080806@kiprosh.com>
References: <20110809104918.GB3214@dakota.eng.vmware.com>
	<4E411620.4070301@kiprosh.com>
	<20110809112038.GC3214@dakota.eng.vmware.com>
	<4E411AB4.30706@kiprosh.com>
	<20110809115033.GF3214@dakota.eng.vmware.com>
	<4E412192.5080107@kiprosh.com>
	<20110809120926.GA28785@dakota.eng.vmware.com>
	<4E412A3B.60602@kiprosh.com>
	<20110809124819.GB28785@dakota.eng.vmware.com>
	<4E412D87.2080806@kiprosh.com>
Message-ID: <20110809140658.GC28785@dakota.eng.vmware.com>

I managed to reproduce your error.

Solution: do not use the .cer file in the broker config; use the .pem
file.  For some reason, rather than complaining that it can't read the
CA certificate, Erlang just silently ignores that and throws an "unknown
CA" error.  Hurray!

So, change
  {cacertfile,"C:\\testca\\cacert.cer"}
with
  {cacertfile,"C:\\testca\\cacert.pem"}

Please let me know if this helps.

Cheers,
Alex

On Tue, Aug 09, 2011 at 06:22:23PM +0530, Abhijit wrote:
> ya sir that was set true, i would go back and look at my certification 
> creation steps and find out whether i did everything properly.
> 
> and would let you know once that i done.
> 
> Thanks and Regards,
> Abhijit
> 
> On 8/9/2011 6:18 PM, Alexandru Scvor?ov wrote:
> >> Am basically getting this error, i tried debugging and solved most of
> >> the problems but still getting this:
> >>      
> > Oh, great. My guess about the really long error was that you needed some
> > clients to connect without providing certificates, but
> > fail_if_no_peer_cert was set to true in the config file.  Was that
> > right?
> >
> >    
> >>> [{amqp-0-9://localhost:5671}] =
> >>> {System.Security.Authentication.AuthenticationException: A call to
> >>> SSPI failed, see inner exception. --->
> >>> System.ComponentModel.Win32Exception: The certificate chain was issued
> >>> by an authority that is not trusted
> >>>        
> > I haven't seen that before.  Did you follow the steps in our SSL guide
> > to generate the certificate (in particular, were the client certificates
> > signed by the CA set in the broker)?
> >
> > Alex
> >
> > On Tue, Aug 09, 2011 at 06:08:19PM +0530, Abhijit wrote:
> >    
> >> hi sir,
> >>
> >> Am basically getting this error, i tried debugging and solved most of
> >> the problems but still getting this:
> >>
> >>      
> >>> [{amqp-0-9://localhost:5671}] =
> >>> {System.Security.Authentication.AuthenticationException: A call to
> >>> SSPI failed, see inner exception. --->
> >>> System.ComponentModel.Win32Exception: The certificate chain was issued
> >>> by an authority that is not trusted
> >>>     --- End of inner exception stack trace -...
> >>>        
> >> Thanks and Regards,
> >> Abhijit
> >>
> >>
> >>
> >>
> >> On 8/9/2011 5:39 PM, Alexandru Scvor?ov wrote:
> >>      
> >>>> i would go ahead for now, if any queries i would again seek your help.
> >>>>
> >>>>          
> >>> Excellent.  Don't hesitate to ask us any more questions.
> >>>
> >>> Also, in the future, could you please make sure to CC the mailing list
> >>> when replying?
> >>>
> >>> Cheers,
> >>> Alex
> >>>
> >>> On Tue, Aug 09, 2011 at 05:31:22PM +0530, Abhijit wrote:
> >>>
> >>>        
> >>>> hi sir,
> >>>>
> >>>> finally got this:
> >>>>
> >>>>          
> >>>>> =INFO REPORT==== 9-Aug-2011::17:28:33 ===
> >>>>> started TCP Listener on 0.0.0.0:5672
> >>>>>
> >>>>> =INFO REPORT==== 9-Aug-2011::17:28:33 ===
> >>>>> started SSL Listener on 0.0.0.0:5671
> >>>>>
> >>>>>            
> >>>> your this step
> >>>>
> >>>> Could you copy the config file to "...\AppData\Roaming\RabbitMQ.config"
> >>>> and try again
> >>>>
> >>>> helped...
> >>>>
> >>>> i would go ahead for now, if any queries i would again seek your help.
> >>>>
> >>>> Thanks and Regards,
> >>>> Abhijit
> >>>>
> >>>> On 8/9/2011 5:20 PM, Alexandru Scvor?ov wrote:
> >>>>
> >>>>          
> >>>>> That's a bit odd.  I'm not sure how that can happen.  It looks like you
> >>>>> somehow set the RABBITMQ_CONFIG_FILE variable at some point.
> >>>>>
> >>>>> The file is normally in:
> >>>>> ...\AppData\Roaming\RabbitMQ\rabbitmq.config
> >>>>> but your system is looking for it in:
> >>>>> ...\AppData\Roaming\RabbitMQ.config
> >>>>>
> >>>>> Could you copy the config file to "...\AppData\Roaming\RabbitMQ.config"
> >>>>> and try again?  Alternatively, unset the RABBITMQ_CONFIG_FILE variable
> >>>>> and try again without copying the file.
> >>>>>
> >>>>> Cheers,
> >>>>> Alex
> >>>>>
> >>>>> On Tue, Aug 09, 2011 at 05:02:04PM +0530, Abhijit wrote:
> >>>>>
> >>>>>
> >>>>>            
> >>>>>> I deleted the dot as you asked to and also wrote the line find which
> >>>>>> config we are using, and found we are using the same config file and
> >>>>>> also broker is running successfully without the dot. Am attaching the
> >>>>>> print-screen for the command line output i received when i tried running
> >>>>>> rabbit-mq server
> >>>>>>
> >>>>>>
> >>>>>>
> >>>>>> thanks and regards,
> >>>>>> Abhijit
> >>>>>>
> >>>>>> On 8/9/2011 4:50 PM, Alexandru Scvor?ov wrote:
> >>>>>>
> >>>>>>
> >>>>>>              
> >>>>>>> Ok.  Could you delete the dot at the end (or introduce some other
> >>>>>>> syntactic error) and try again?
> >>>>>>>
> >>>>>>> If it still runs, it's using a different configuration file.
> >>>>>>>
> >>>>>>> Could you also add the following line to the rabbitmq-server.bat file?
> >>>>>>>       echo CONFIG_FILE: !RABBITMQ_CONFIG_FILE!.config
> >>>>>>> It should go in towards the end, right before the "!ERLANG_HOME!\bin\erl.exe"
> >>>>>>> line.
> >>>>>>>
> >>>>>>> That way, when you start the server manually with the .bat, we will know
> >>>>>>> which config file it's using.
> >>>>>>>
> >>>>>>> Alex
> >>>>>>>
> >>>>>>> On Tue, Aug 09, 2011 at 04:42:32PM +0530, Abhijit wrote:
> >>>>>>>
> >>>>>>>
> >>>>>>>
> >>>>>>>                
> >>>>>>>> hi sir,
> >>>>>>>>
> >>>>>>>> It didn't worked as we wanted...this are the last two phrases in the log
> >>>>>>>> file of the broker.
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>                  
> >>>>>>>>> =INFO REPORT==== 9-Aug-2011::16:39:52 ===
> >>>>>>>>> started TCP Listener on [::]:5692
> >>>>>>>>>
> >>>>>>>>> =INFO REPORT==== 9-Aug-2011::16:39:53 ===
> >>>>>>>>> started TCP Listener on 0.0.0.0:5692
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>                    
> >>>>>>>> i copied the rabbitmq.config which you sent me but didn't worked out.
> >>>>>>>>
> >>>>>>>> Thanks and Regards,
> >>>>>>>> Abhijit
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>
> >>>>>>>> On 8/9/2011 4:19 PM, Alexandru Scvor?ov wrote:
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>                  
> >>>>>>>>>> Am using the same path, C:\Users\Administrator\AppData\Roaming\RabbitMQ\rabbitmq.config for including ssl in my app.
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>                      
> >>>>>>>>> Ok.
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>                    
> >>>>>>>>>> But the file wasn't present earlier i had created that file in order to have SSL in my app at the same location.
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>                      
> >>>>>>>>> That's fine.
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>                    
> >>>>>>>>>> i tried running the bat file for the rabbitmq-server that didn't help sir, do you need any part of code for inspection.
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>                      
> >>>>>>>>> The code isn't the problem right now.  It's getting rabbit to enable
> >>>>>>>>> ssl.
> >>>>>>>>>
> >>>>>>>>> I'm attaching a rabbitmq.config.  Please try using that one.  Restart
> >>>>>>>>> the broker and the last lines in the broker log should be:
> >>>>>>>>>
> >>>>>>>>> =INFO REPORT==== 9-Aug-2011::11:44:37 ===
> >>>>>>>>> started TCP Listener on [::]:5672
> >>>>>>>>>
> >>>>>>>>> =INFO REPORT==== 9-Aug-2011::11:44:37 ===
> >>>>>>>>> started SSL Listener on 0.0.0.0:5671
> >>>>>>>>>
> >>>>>>>>> Let me know how it goes, please.
> >>>>>>>>>
> >>>>>>>>> Cheers,
> >>>>>>>>> Alex
> >>>>>>>>>
> >>>>>>>>> On Tue, Aug 09, 2011 at 04:09:42PM +0530, Abhijit wrote:
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>                    
> >>>>>>>>>> Hi Sir,
> >>>>>>>>>>
> >>>>>>>>>> Am using the same path, C:\Users\Administrator\AppData\Roaming\RabbitMQ\rabbitmq.config for including ssl in my app.
> >>>>>>>>>>
> >>>>>>>>>> But the file wasn't present earlier i had created that file in order to have SSL in my app at the same location.
> >>>>>>>>>>
> >>>>>>>>>> i tried running the bat file for the rabbitmq-server that didn't help sir, do you need any part of code for inspection.
> >>>>>>>>>>
> >>>>>>>>>> Thanks a lot for your time and replies.
> >>>>>>>>>>
> >>>>>>>>>> Regards,
> >>>>>>>>>> Abhijit
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>                      
> >>>>>>>>
> >>>>>>>>                  
> >>>>>>
> >>>>>>              
> >>>>
> >>>>          
> >>      
> 

From alackner at geomix.at  Tue Aug  9 15:10:05 2011
From: alackner at geomix.at (Andreas Lackner)
Date: Tue, 9 Aug 2011 07:10:05 -0700 (PDT)
Subject: [rabbitmq-discuss] Number of consumers on a queue
In-Reply-To: <32225971.post@talk.nabble.com>
References: <32225971.post@talk.nabble.com>
Message-ID: <32226464.post@talk.nabble.com>


Thx for the fast replies :)


-- 
View this message in context: http://old.nabble.com/Number-of-consumers-on-a-queue-tp32225971p32226464.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From steve at rabbitmq.com  Tue Aug  9 15:07:43 2011
From: steve at rabbitmq.com (Steve Powell)
Date: Tue, 9 Aug 2011 15:07:43 +0100
Subject: [rabbitmq-discuss] rabbitmq-stomp 2.5.1 does not respect the
	spec wrt content-type
In-Reply-To: <20110809140039.40ee.abe10f7e5afbbb3a79ce619739541149@cern.ch>
References: <20110809140039.40ee.abe10f7e5afbbb3a79ce619739541149@cern.ch>
Message-ID: <1DEBAA7E-CDAE-486F-8FE4-5E5484C8C448@rabbitmq.com>

Dear Lionel,
Yes, indeed, this does look like a bug.

You do not say whether your test message included a content-length header.  You ought to know that without it there is no way a STOMP server can determine the length of a binary body, other than by using the NULL byte terminator (the usual rule).

If the SENDer gave a message with content-type binary (explicitly or implicitly) and omitted the content-length header, would you wish us to reject the message (with an ERROR) or use the NULL terminator rule, which would almost always indicate a potential error in the binary case?

Notice that the requirement to include a content-length header and the requirement to assume binary when the content-type is omitted are both imposed with the SHOULD keyword.  We are not clear what the force of that term is in this context.  We are going to clarify this.

Thank you for pointing this out.
Steve Powell  (a hoppy bunny)
----------some definitions from the SPD----------
Rigatoni n. A prime-ministerial grin.
Nigella n. The next bottle-size up from a Nebuchadnezzar.
Homily adv. Rather like a frenchman.

On 9 Aug 2011, at 13:08, Lionel Cons wrote:
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-August/014412.html
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110809/ff8c3463/attachment.htm>

From abhijit.sinha at kiprosh.com  Tue Aug  9 15:13:26 2011
From: abhijit.sinha at kiprosh.com (Abhijit)
Date: Tue, 09 Aug 2011 19:43:26 +0530
Subject: [rabbitmq-discuss] facing issues with the SSL implementations
 with RabbitMQ + Windows + .Net
In-Reply-To: <20110809140658.GC28785@dakota.eng.vmware.com>
References: <20110809104918.GB3214@dakota.eng.vmware.com>
	<4E411620.4070301@kiprosh.com>
	<20110809112038.GC3214@dakota.eng.vmware.com>
	<4E411AB4.30706@kiprosh.com>
	<20110809115033.GF3214@dakota.eng.vmware.com>
	<4E412192.5080107@kiprosh.com>
	<20110809120926.GA28785@dakota.eng.vmware.com>
	<4E412A3B.60602@kiprosh.com>
	<20110809124819.GB28785@dakota.eng.vmware.com>
	<4E412D87.2080806@kiprosh.com>
	<20110809140658.GC28785@dakota.eng.vmware.com>
Message-ID: <4E414086.7010706@kiprosh.com>

hello sir,

> [{amqp-0-9://localhost:5671}] = 
> {System.Security.Authentication.AuthenticationException: A call to 
> SSPI failed, see inner exception. ---> 
> System.ComponentModel.Win32Exception: The message received was 
> unexpected or badly formatted

i got this error after changing it to pem sir, and also i created the 
certificates properly as per the rabbitmq ssl steps but i haven't able 
to understand this steps mentioned:
http://www.rabbitmq.com/ssl.html#trust-dotNET,
i have executed them but all they do is opens the certmanager window.

Any suggestions.

Thanks and Regards,
Abhijit


On 8/9/2011 7:36 PM, Alexandru Scvor?ov wrote:
> I managed to reproduce your error.
>
> Solution: do not use the .cer file in the broker config; use the .pem
> file.  For some reason, rather than complaining that it can't read the
> CA certificate, Erlang just silently ignores that and throws an "unknown
> CA" error.  Hurray!
>
> So, change
>    {cacertfile,"C:\\testca\\cacert.cer"}
> with
>    {cacertfile,"C:\\testca\\cacert.pem"}
>
> Please let me know if this helps.
>
> Cheers,
> Alex
>
> On Tue, Aug 09, 2011 at 06:22:23PM +0530, Abhijit wrote:
>    
>> ya sir that was set true, i would go back and look at my certification
>> creation steps and find out whether i did everything properly.
>>
>> and would let you know once that i done.
>>
>> Thanks and Regards,
>> Abhijit
>>
>> On 8/9/2011 6:18 PM, Alexandru Scvor?ov wrote:
>>      
>>>> Am basically getting this error, i tried debugging and solved most of
>>>> the problems but still getting this:
>>>>
>>>>          
>>> Oh, great. My guess about the really long error was that you needed some
>>> clients to connect without providing certificates, but
>>> fail_if_no_peer_cert was set to true in the config file.  Was that
>>> right?
>>>
>>>
>>>        
>>>>> [{amqp-0-9://localhost:5671}] =
>>>>> {System.Security.Authentication.AuthenticationException: A call to
>>>>> SSPI failed, see inner exception. --->
>>>>> System.ComponentModel.Win32Exception: The certificate chain was issued
>>>>> by an authority that is not trusted
>>>>>
>>>>>            
>>> I haven't seen that before.  Did you follow the steps in our SSL guide
>>> to generate the certificate (in particular, were the client certificates
>>> signed by the CA set in the broker)?
>>>
>>> Alex
>>>
>>> On Tue, Aug 09, 2011 at 06:08:19PM +0530, Abhijit wrote:
>>>
>>>        
>>>> hi sir,
>>>>
>>>> Am basically getting this error, i tried debugging and solved most of
>>>> the problems but still getting this:
>>>>
>>>>
>>>>          
>>>>> [{amqp-0-9://localhost:5671}] =
>>>>> {System.Security.Authentication.AuthenticationException: A call to
>>>>> SSPI failed, see inner exception. --->
>>>>> System.ComponentModel.Win32Exception: The certificate chain was issued
>>>>> by an authority that is not trusted
>>>>>      --- End of inner exception stack trace -...
>>>>>
>>>>>            
>>>> Thanks and Regards,
>>>> Abhijit
>>>>
>>>>
>>>>
>>>>
>>>> On 8/9/2011 5:39 PM, Alexandru Scvor?ov wrote:
>>>>
>>>>          
>>>>>> i would go ahead for now, if any queries i would again seek your help.
>>>>>>
>>>>>>
>>>>>>              
>>>>> Excellent.  Don't hesitate to ask us any more questions.
>>>>>
>>>>> Also, in the future, could you please make sure to CC the mailing list
>>>>> when replying?
>>>>>
>>>>> Cheers,
>>>>> Alex
>>>>>
>>>>> On Tue, Aug 09, 2011 at 05:31:22PM +0530, Abhijit wrote:
>>>>>
>>>>>
>>>>>            
>>>>>> hi sir,
>>>>>>
>>>>>> finally got this:
>>>>>>
>>>>>>
>>>>>>              
>>>>>>> =INFO REPORT==== 9-Aug-2011::17:28:33 ===
>>>>>>> started TCP Listener on 0.0.0.0:5672
>>>>>>>
>>>>>>> =INFO REPORT==== 9-Aug-2011::17:28:33 ===
>>>>>>> started SSL Listener on 0.0.0.0:5671
>>>>>>>
>>>>>>>
>>>>>>>                
>>>>>> your this step
>>>>>>
>>>>>> Could you copy the config file to "...\AppData\Roaming\RabbitMQ.config"
>>>>>> and try again
>>>>>>
>>>>>> helped...
>>>>>>
>>>>>> i would go ahead for now, if any queries i would again seek your help.
>>>>>>
>>>>>> Thanks and Regards,
>>>>>> Abhijit
>>>>>>
>>>>>> On 8/9/2011 5:20 PM, Alexandru Scvor?ov wrote:
>>>>>>
>>>>>>
>>>>>>              
>>>>>>> That's a bit odd.  I'm not sure how that can happen.  It looks like you
>>>>>>> somehow set the RABBITMQ_CONFIG_FILE variable at some point.
>>>>>>>
>>>>>>> The file is normally in:
>>>>>>> ...\AppData\Roaming\RabbitMQ\rabbitmq.config
>>>>>>> but your system is looking for it in:
>>>>>>> ...\AppData\Roaming\RabbitMQ.config
>>>>>>>
>>>>>>> Could you copy the config file to "...\AppData\Roaming\RabbitMQ.config"
>>>>>>> and try again?  Alternatively, unset the RABBITMQ_CONFIG_FILE variable
>>>>>>> and try again without copying the file.
>>>>>>>
>>>>>>> Cheers,
>>>>>>> Alex
>>>>>>>
>>>>>>> On Tue, Aug 09, 2011 at 05:02:04PM +0530, Abhijit wrote:
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>                
>>>>>>>> I deleted the dot as you asked to and also wrote the line find which
>>>>>>>> config we are using, and found we are using the same config file and
>>>>>>>> also broker is running successfully without the dot. Am attaching the
>>>>>>>> print-screen for the command line output i received when i tried running
>>>>>>>> rabbit-mq server
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>> thanks and regards,
>>>>>>>> Abhijit
>>>>>>>>
>>>>>>>> On 8/9/2011 4:50 PM, Alexandru Scvor?ov wrote:
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>                  
>>>>>>>>> Ok.  Could you delete the dot at the end (or introduce some other
>>>>>>>>> syntactic error) and try again?
>>>>>>>>>
>>>>>>>>> If it still runs, it's using a different configuration file.
>>>>>>>>>
>>>>>>>>> Could you also add the following line to the rabbitmq-server.bat file?
>>>>>>>>>        echo CONFIG_FILE: !RABBITMQ_CONFIG_FILE!.config
>>>>>>>>> It should go in towards the end, right before the "!ERLANG_HOME!\bin\erl.exe"
>>>>>>>>> line.
>>>>>>>>>
>>>>>>>>> That way, when you start the server manually with the .bat, we will know
>>>>>>>>> which config file it's using.
>>>>>>>>>
>>>>>>>>> Alex
>>>>>>>>>
>>>>>>>>> On Tue, Aug 09, 2011 at 04:42:32PM +0530, Abhijit wrote:
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>                    
>>>>>>>>>> hi sir,
>>>>>>>>>>
>>>>>>>>>> It didn't worked as we wanted...this are the last two phrases in the log
>>>>>>>>>> file of the broker.
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>                      
>>>>>>>>>>> =INFO REPORT==== 9-Aug-2011::16:39:52 ===
>>>>>>>>>>> started TCP Listener on [::]:5692
>>>>>>>>>>>
>>>>>>>>>>> =INFO REPORT==== 9-Aug-2011::16:39:53 ===
>>>>>>>>>>> started TCP Listener on 0.0.0.0:5692
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>                        
>>>>>>>>>> i copied the rabbitmq.config which you sent me but didn't worked out.
>>>>>>>>>>
>>>>>>>>>> Thanks and Regards,
>>>>>>>>>> Abhijit
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>> On 8/9/2011 4:19 PM, Alexandru Scvor?ov wrote:
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>                      
>>>>>>>>>>>> Am using the same path, C:\Users\Administrator\AppData\Roaming\RabbitMQ\rabbitmq.config for including ssl in my app.
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>                          
>>>>>>>>>>> Ok.
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>                        
>>>>>>>>>>>> But the file wasn't present earlier i had created that file in order to have SSL in my app at the same location.
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>                          
>>>>>>>>>>> That's fine.
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>                        
>>>>>>>>>>>> i tried running the bat file for the rabbitmq-server that didn't help sir, do you need any part of code for inspection.
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>                          
>>>>>>>>>>> The code isn't the problem right now.  It's getting rabbit to enable
>>>>>>>>>>> ssl.
>>>>>>>>>>>
>>>>>>>>>>> I'm attaching a rabbitmq.config.  Please try using that one.  Restart
>>>>>>>>>>> the broker and the last lines in the broker log should be:
>>>>>>>>>>>
>>>>>>>>>>> =INFO REPORT==== 9-Aug-2011::11:44:37 ===
>>>>>>>>>>> started TCP Listener on [::]:5672
>>>>>>>>>>>
>>>>>>>>>>> =INFO REPORT==== 9-Aug-2011::11:44:37 ===
>>>>>>>>>>> started SSL Listener on 0.0.0.0:5671
>>>>>>>>>>>
>>>>>>>>>>> Let me know how it goes, please.
>>>>>>>>>>>
>>>>>>>>>>> Cheers,
>>>>>>>>>>> Alex
>>>>>>>>>>>
>>>>>>>>>>> On Tue, Aug 09, 2011 at 04:09:42PM +0530, Abhijit wrote:
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>                        
>>>>>>>>>>>> Hi Sir,
>>>>>>>>>>>>
>>>>>>>>>>>> Am using the same path, C:\Users\Administrator\AppData\Roaming\RabbitMQ\rabbitmq.config for including ssl in my app.
>>>>>>>>>>>>
>>>>>>>>>>>> But the file wasn't present earlier i had created that file in order to have SSL in my app at the same location.
>>>>>>>>>>>>
>>>>>>>>>>>> i tried running the bat file for the rabbitmq-server that didn't help sir, do you need any part of code for inspection.
>>>>>>>>>>>>
>>>>>>>>>>>> Thanks a lot for your time and replies.
>>>>>>>>>>>>
>>>>>>>>>>>> Regards,
>>>>>>>>>>>> Abhijit
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>                          
>>>>>>>>>>
>>>>>>>>>>                      
>>>>>>>>
>>>>>>>>                  
>>>>>>
>>>>>>              
>>>>
>>>>          
>>      


From ekirpichov at gmail.com  Tue Aug  9 15:16:24 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Tue, 9 Aug 2011 18:16:24 +0400
Subject: [rabbitmq-discuss] Number of consumers on a queue
In-Reply-To: <CABzX+qx8=cthAOiGVkBck0Ws-ZXJNwiXe_Ldc_AO7kAehaZSKg@mail.gmail.com>
References: <32225971.post@talk.nabble.com>
	<CABzX+qxQT1D6U2TOtTGhK-tzDC275XMa6nDPKCCOZp6mJr4_5A@mail.gmail.com>
	<CABzX+qx8=cthAOiGVkBck0Ws-ZXJNwiXe_Ldc_AO7kAehaZSKg@mail.gmail.com>
Message-ID: <CANVKUrU=rgO59aA1C71MW+b3XN+dCncSKqD01kCcxXJcTnXaOg@mail.gmail.com>

We not only have a bug, but also a pull request that fixes that - I
needed the queue message count and implemented it myself :)
https://github.com/rabbitmq/rabbitmq-dotnet-client/pull/2

Hopefully it will get merged :)

2011/8/9 Marek Majkowski <majek04 at gmail.com>:
> On Tue, Aug 9, 2011 at 14:37, Marek Majkowski <majek04 at gmail.com> wrote:
>> On Tue, Aug 9, 2011 at 14:11, Andreas Lackner <alackner at geomix.at> wrote:
>>> I'd like to know if there is a way to get the number of consumers that are
>>> currently bound to a queue.
>>> I am using the .NET client.
>>
>> Check out the return value of `Queue.declare`:
>> ? http://www.rabbitmq.com/amqp-0-9-1-reference.html#exchange.declare-ok
>>
>> It returns message count and number of consumers bound to a queue.
>
> Apparently .net client doesn't properly return queue.declare-ok, so
> it appears that in .net there is now way to read the counters. sorry.
>
> We have a bug opened for that.
>
> Cheers,
> ? Marek
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/

From alexandru at rabbitmq.com  Tue Aug  9 15:19:13 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Tue, 9 Aug 2011 15:19:13 +0100
Subject: [rabbitmq-discuss] facing issues with the SSL implementations
 with RabbitMQ + Windows + .Net
In-Reply-To: <4E412D87.2080806@kiprosh.com>
References: <20110809104918.GB3214@dakota.eng.vmware.com>
	<4E411620.4070301@kiprosh.com>
	<20110809112038.GC3214@dakota.eng.vmware.com>
	<4E411AB4.30706@kiprosh.com>
	<20110809115033.GF3214@dakota.eng.vmware.com>
	<4E412192.5080107@kiprosh.com>
	<20110809120926.GA28785@dakota.eng.vmware.com>
	<4E412A3B.60602@kiprosh.com>
	<20110809124819.GB28785@dakota.eng.vmware.com>
	<4E412D87.2080806@kiprosh.com>
Message-ID: <20110809141913.GD28785@dakota.eng.vmware.com>

BTW, I got a "The remote certificate is invalid according to the
validation procedure" error on the client side after getting the broker
to work.

That was probably due to my generating the certificates on a different
machine and thus the CN was not also the server's hostname.  The
solution was to mark that as an acceptable policy ssl policy error in
the client:
  cf.Ssl.AcceptablePolicyErrors =
      SslPolicyErrors.RemoteCertificateNameMismatch;

Cheers,
Alex

On Tue, Aug 09, 2011 at 06:22:23PM +0530, Abhijit wrote:
> ya sir that was set true, i would go back and look at my certification 
> creation steps and find out whether i did everything properly.
> 
> and would let you know once that i done.
> 
> Thanks and Regards,
> Abhijit
> 
> On 8/9/2011 6:18 PM, Alexandru Scvor?ov wrote:
> >> Am basically getting this error, i tried debugging and solved most of
> >> the problems but still getting this:
> >>      
> > Oh, great. My guess about the really long error was that you needed some
> > clients to connect without providing certificates, but
> > fail_if_no_peer_cert was set to true in the config file.  Was that
> > right?
> >
> >    
> >>> [{amqp-0-9://localhost:5671}] =
> >>> {System.Security.Authentication.AuthenticationException: A call to
> >>> SSPI failed, see inner exception. --->
> >>> System.ComponentModel.Win32Exception: The certificate chain was issued
> >>> by an authority that is not trusted
> >>>        
> > I haven't seen that before.  Did you follow the steps in our SSL guide
> > to generate the certificate (in particular, were the client certificates
> > signed by the CA set in the broker)?
> >
> > Alex
> >
> > On Tue, Aug 09, 2011 at 06:08:19PM +0530, Abhijit wrote:
> >    
> >> hi sir,
> >>
> >> Am basically getting this error, i tried debugging and solved most of
> >> the problems but still getting this:
> >>
> >>      
> >>> [{amqp-0-9://localhost:5671}] =
> >>> {System.Security.Authentication.AuthenticationException: A call to
> >>> SSPI failed, see inner exception. --->
> >>> System.ComponentModel.Win32Exception: The certificate chain was issued
> >>> by an authority that is not trusted
> >>>     --- End of inner exception stack trace -...
> >>>        
> >> Thanks and Regards,
> >> Abhijit
> >>
> >>
> >>
> >>
> >> On 8/9/2011 5:39 PM, Alexandru Scvor?ov wrote:
> >>      
> >>>> i would go ahead for now, if any queries i would again seek your help.
> >>>>
> >>>>          
> >>> Excellent.  Don't hesitate to ask us any more questions.
> >>>
> >>> Also, in the future, could you please make sure to CC the mailing list
> >>> when replying?
> >>>
> >>> Cheers,
> >>> Alex
> >>>
> >>> On Tue, Aug 09, 2011 at 05:31:22PM +0530, Abhijit wrote:
> >>>
> >>>        
> >>>> hi sir,
> >>>>
> >>>> finally got this:
> >>>>
> >>>>          
> >>>>> =INFO REPORT==== 9-Aug-2011::17:28:33 ===
> >>>>> started TCP Listener on 0.0.0.0:5672
> >>>>>
> >>>>> =INFO REPORT==== 9-Aug-2011::17:28:33 ===
> >>>>> started SSL Listener on 0.0.0.0:5671
> >>>>>
> >>>>>            
> >>>> your this step
> >>>>
> >>>> Could you copy the config file to "...\AppData\Roaming\RabbitMQ.config"
> >>>> and try again
> >>>>
> >>>> helped...
> >>>>
> >>>> i would go ahead for now, if any queries i would again seek your help.
> >>>>
> >>>> Thanks and Regards,
> >>>> Abhijit
> >>>>
> >>>> On 8/9/2011 5:20 PM, Alexandru Scvor?ov wrote:
> >>>>
> >>>>          
> >>>>> That's a bit odd.  I'm not sure how that can happen.  It looks like you
> >>>>> somehow set the RABBITMQ_CONFIG_FILE variable at some point.
> >>>>>
> >>>>> The file is normally in:
> >>>>> ...\AppData\Roaming\RabbitMQ\rabbitmq.config
> >>>>> but your system is looking for it in:
> >>>>> ...\AppData\Roaming\RabbitMQ.config
> >>>>>
> >>>>> Could you copy the config file to "...\AppData\Roaming\RabbitMQ.config"
> >>>>> and try again?  Alternatively, unset the RABBITMQ_CONFIG_FILE variable
> >>>>> and try again without copying the file.
> >>>>>
> >>>>> Cheers,
> >>>>> Alex
> >>>>>
> >>>>> On Tue, Aug 09, 2011 at 05:02:04PM +0530, Abhijit wrote:
> >>>>>
> >>>>>
> >>>>>            
> >>>>>> I deleted the dot as you asked to and also wrote the line find which
> >>>>>> config we are using, and found we are using the same config file and
> >>>>>> also broker is running successfully without the dot. Am attaching the
> >>>>>> print-screen for the command line output i received when i tried running
> >>>>>> rabbit-mq server
> >>>>>>
> >>>>>>
> >>>>>>
> >>>>>> thanks and regards,
> >>>>>> Abhijit
> >>>>>>
> >>>>>> On 8/9/2011 4:50 PM, Alexandru Scvor?ov wrote:
> >>>>>>
> >>>>>>
> >>>>>>              
> >>>>>>> Ok.  Could you delete the dot at the end (or introduce some other
> >>>>>>> syntactic error) and try again?
> >>>>>>>
> >>>>>>> If it still runs, it's using a different configuration file.
> >>>>>>>
> >>>>>>> Could you also add the following line to the rabbitmq-server.bat file?
> >>>>>>>       echo CONFIG_FILE: !RABBITMQ_CONFIG_FILE!.config
> >>>>>>> It should go in towards the end, right before the "!ERLANG_HOME!\bin\erl.exe"
> >>>>>>> line.
> >>>>>>>
> >>>>>>> That way, when you start the server manually with the .bat, we will know
> >>>>>>> which config file it's using.
> >>>>>>>
> >>>>>>> Alex
> >>>>>>>
> >>>>>>> On Tue, Aug 09, 2011 at 04:42:32PM +0530, Abhijit wrote:
> >>>>>>>
> >>>>>>>
> >>>>>>>
> >>>>>>>                
> >>>>>>>> hi sir,
> >>>>>>>>
> >>>>>>>> It didn't worked as we wanted...this are the last two phrases in the log
> >>>>>>>> file of the broker.
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>                  
> >>>>>>>>> =INFO REPORT==== 9-Aug-2011::16:39:52 ===
> >>>>>>>>> started TCP Listener on [::]:5692
> >>>>>>>>>
> >>>>>>>>> =INFO REPORT==== 9-Aug-2011::16:39:53 ===
> >>>>>>>>> started TCP Listener on 0.0.0.0:5692
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>                    
> >>>>>>>> i copied the rabbitmq.config which you sent me but didn't worked out.
> >>>>>>>>
> >>>>>>>> Thanks and Regards,
> >>>>>>>> Abhijit
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>
> >>>>>>>> On 8/9/2011 4:19 PM, Alexandru Scvor?ov wrote:
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>                  
> >>>>>>>>>> Am using the same path, C:\Users\Administrator\AppData\Roaming\RabbitMQ\rabbitmq.config for including ssl in my app.
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>                      
> >>>>>>>>> Ok.
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>                    
> >>>>>>>>>> But the file wasn't present earlier i had created that file in order to have SSL in my app at the same location.
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>                      
> >>>>>>>>> That's fine.
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>                    
> >>>>>>>>>> i tried running the bat file for the rabbitmq-server that didn't help sir, do you need any part of code for inspection.
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>                      
> >>>>>>>>> The code isn't the problem right now.  It's getting rabbit to enable
> >>>>>>>>> ssl.
> >>>>>>>>>
> >>>>>>>>> I'm attaching a rabbitmq.config.  Please try using that one.  Restart
> >>>>>>>>> the broker and the last lines in the broker log should be:
> >>>>>>>>>
> >>>>>>>>> =INFO REPORT==== 9-Aug-2011::11:44:37 ===
> >>>>>>>>> started TCP Listener on [::]:5672
> >>>>>>>>>
> >>>>>>>>> =INFO REPORT==== 9-Aug-2011::11:44:37 ===
> >>>>>>>>> started SSL Listener on 0.0.0.0:5671
> >>>>>>>>>
> >>>>>>>>> Let me know how it goes, please.
> >>>>>>>>>
> >>>>>>>>> Cheers,
> >>>>>>>>> Alex
> >>>>>>>>>
> >>>>>>>>> On Tue, Aug 09, 2011 at 04:09:42PM +0530, Abhijit wrote:
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>                    
> >>>>>>>>>> Hi Sir,
> >>>>>>>>>>
> >>>>>>>>>> Am using the same path, C:\Users\Administrator\AppData\Roaming\RabbitMQ\rabbitmq.config for including ssl in my app.
> >>>>>>>>>>
> >>>>>>>>>> But the file wasn't present earlier i had created that file in order to have SSL in my app at the same location.
> >>>>>>>>>>
> >>>>>>>>>> i tried running the bat file for the rabbitmq-server that didn't help sir, do you need any part of code for inspection.
> >>>>>>>>>>
> >>>>>>>>>> Thanks a lot for your time and replies.
> >>>>>>>>>>
> >>>>>>>>>> Regards,
> >>>>>>>>>> Abhijit
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>                      
> >>>>>>>>
> >>>>>>>>                  
> >>>>>>
> >>>>>>              
> >>>>
> >>>>          
> >>      
> 

From emile at rabbitmq.com  Tue Aug  9 15:30:36 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 09 Aug 2011 15:30:36 +0100
Subject: [rabbitmq-discuss] Number of consumers on a queue
In-Reply-To: <CANVKUrU=rgO59aA1C71MW+b3XN+dCncSKqD01kCcxXJcTnXaOg@mail.gmail.com>
References: <32225971.post@talk.nabble.com>	<CABzX+qxQT1D6U2TOtTGhK-tzDC275XMa6nDPKCCOZp6mJr4_5A@mail.gmail.com>	<CABzX+qx8=cthAOiGVkBck0Ws-ZXJNwiXe_Ldc_AO7kAehaZSKg@mail.gmail.com>
	<CANVKUrU=rgO59aA1C71MW+b3XN+dCncSKqD01kCcxXJcTnXaOg@mail.gmail.com>
Message-ID: <4E41448C.2050603@rabbitmq.com>

Hi Eugene,

On 09/08/11 15:16, Eugene Kirpichov wrote:
> We not only have a bug, but also a pull request that fixes that - I
> needed the queue message count and implemented it myself :)
> https://github.com/rabbitmq/rabbitmq-dotnet-client/pull/2
> 
> Hopefully it will get merged :)

Yes - thank you very much for your contribution. Will you be able to
sign & send a contributor agreement for that change?


Regards

Emile

From alexandru at rabbitmq.com  Tue Aug  9 15:28:07 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Tue, 9 Aug 2011 15:28:07 +0100
Subject: [rabbitmq-discuss] facing issues with the SSL implementations
 with RabbitMQ + Windows + .Net
In-Reply-To: <4E414086.7010706@kiprosh.com>
References: <20110809112038.GC3214@dakota.eng.vmware.com>
	<4E411AB4.30706@kiprosh.com>
	<20110809115033.GF3214@dakota.eng.vmware.com>
	<4E412192.5080107@kiprosh.com>
	<20110809120926.GA28785@dakota.eng.vmware.com>
	<4E412A3B.60602@kiprosh.com>
	<20110809124819.GB28785@dakota.eng.vmware.com>
	<4E412D87.2080806@kiprosh.com>
	<20110809140658.GC28785@dakota.eng.vmware.com>
	<4E414086.7010706@kiprosh.com>
Message-ID: <20110809142807.GE28785@dakota.eng.vmware.com>

> http://www.rabbitmq.com/ssl.html#trust-dotNET,
> i have executed them but all they do is opens the certmanager window.

There are two versions of the certmgr program.  One of the is shipped
with Windows and is the graphical version you use.  The other is shipped
with the Windows SDK and is a command line version.

You can use the graphical version: start it up, click Import, select
testca/cacert.cer, click Next, *IMPORTANT* select the Trusted Root
Certification Authorities store, click Next... until it's imported.

> > [{amqp-0-9://localhost:5671}] = 
> > {System.Security.Authentication.AuthenticationException: A call to 
> > SSPI failed, see inner exception. ---> 
> > System.ComponentModel.Win32Exception: The message received was 
> > unexpected or badly formatted

The error you're getting doesn't sound like it's because of this, but
you'll need to import the certificate anyway.  Maybe it will help.

Cheers,
Alex

On Tue, Aug 09, 2011 at 07:43:26PM +0530, Abhijit wrote:
> hello sir,
> 
> > [{amqp-0-9://localhost:5671}] = 
> > {System.Security.Authentication.AuthenticationException: A call to 
> > SSPI failed, see inner exception. ---> 
> > System.ComponentModel.Win32Exception: The message received was 
> > unexpected or badly formatted
> 
> i got this error after changing it to pem sir, and also i created the 
> certificates properly as per the rabbitmq ssl steps but i haven't able 
> to understand this steps mentioned:
> http://www.rabbitmq.com/ssl.html#trust-dotNET,
> i have executed them but all they do is opens the certmanager window.
> 
> Any suggestions.
> 
> Thanks and Regards,
> Abhijit
> 
> 
> On 8/9/2011 7:36 PM, Alexandru Scvor?ov wrote:
> > I managed to reproduce your error.
> >
> > Solution: do not use the .cer file in the broker config; use the .pem
> > file.  For some reason, rather than complaining that it can't read the
> > CA certificate, Erlang just silently ignores that and throws an "unknown
> > CA" error.  Hurray!
> >
> > So, change
> >    {cacertfile,"C:\\testca\\cacert.cer"}
> > with
> >    {cacertfile,"C:\\testca\\cacert.pem"}
> >
> > Please let me know if this helps.
> >
> > Cheers,
> > Alex
> >
> > On Tue, Aug 09, 2011 at 06:22:23PM +0530, Abhijit wrote:
> >    
> >> ya sir that was set true, i would go back and look at my certification
> >> creation steps and find out whether i did everything properly.
> >>
> >> and would let you know once that i done.
> >>
> >> Thanks and Regards,
> >> Abhijit
> >>
> >> On 8/9/2011 6:18 PM, Alexandru Scvor?ov wrote:
> >>      
> >>>> Am basically getting this error, i tried debugging and solved most of
> >>>> the problems but still getting this:
> >>>>
> >>>>          
> >>> Oh, great. My guess about the really long error was that you needed some
> >>> clients to connect without providing certificates, but
> >>> fail_if_no_peer_cert was set to true in the config file.  Was that
> >>> right?
> >>>
> >>>
> >>>        
> >>>>> [{amqp-0-9://localhost:5671}] =
> >>>>> {System.Security.Authentication.AuthenticationException: A call to
> >>>>> SSPI failed, see inner exception. --->
> >>>>> System.ComponentModel.Win32Exception: The certificate chain was issued
> >>>>> by an authority that is not trusted
> >>>>>
> >>>>>            
> >>> I haven't seen that before.  Did you follow the steps in our SSL guide
> >>> to generate the certificate (in particular, were the client certificates
> >>> signed by the CA set in the broker)?
> >>>
> >>> Alex
> >>>
> >>> On Tue, Aug 09, 2011 at 06:08:19PM +0530, Abhijit wrote:
> >>>
> >>>        
> >>>> hi sir,
> >>>>
> >>>> Am basically getting this error, i tried debugging and solved most of
> >>>> the problems but still getting this:
> >>>>
> >>>>
> >>>>          
> >>>>> [{amqp-0-9://localhost:5671}] =
> >>>>> {System.Security.Authentication.AuthenticationException: A call to
> >>>>> SSPI failed, see inner exception. --->
> >>>>> System.ComponentModel.Win32Exception: The certificate chain was issued
> >>>>> by an authority that is not trusted
> >>>>>      --- End of inner exception stack trace -...
> >>>>>
> >>>>>            
> >>>> Thanks and Regards,
> >>>> Abhijit
> >>>>
> >>>>
> >>>>
> >>>>
> >>>> On 8/9/2011 5:39 PM, Alexandru Scvor?ov wrote:
> >>>>
> >>>>          
> >>>>>> i would go ahead for now, if any queries i would again seek your help.
> >>>>>>
> >>>>>>
> >>>>>>              
> >>>>> Excellent.  Don't hesitate to ask us any more questions.
> >>>>>
> >>>>> Also, in the future, could you please make sure to CC the mailing list
> >>>>> when replying?
> >>>>>
> >>>>> Cheers,
> >>>>> Alex
> >>>>>
> >>>>> On Tue, Aug 09, 2011 at 05:31:22PM +0530, Abhijit wrote:
> >>>>>
> >>>>>
> >>>>>            
> >>>>>> hi sir,
> >>>>>>
> >>>>>> finally got this:
> >>>>>>
> >>>>>>
> >>>>>>              
> >>>>>>> =INFO REPORT==== 9-Aug-2011::17:28:33 ===
> >>>>>>> started TCP Listener on 0.0.0.0:5672
> >>>>>>>
> >>>>>>> =INFO REPORT==== 9-Aug-2011::17:28:33 ===
> >>>>>>> started SSL Listener on 0.0.0.0:5671
> >>>>>>>
> >>>>>>>
> >>>>>>>                
> >>>>>> your this step
> >>>>>>
> >>>>>> Could you copy the config file to "...\AppData\Roaming\RabbitMQ.config"
> >>>>>> and try again
> >>>>>>
> >>>>>> helped...
> >>>>>>
> >>>>>> i would go ahead for now, if any queries i would again seek your help.
> >>>>>>
> >>>>>> Thanks and Regards,
> >>>>>> Abhijit
> >>>>>>
> >>>>>> On 8/9/2011 5:20 PM, Alexandru Scvor?ov wrote:
> >>>>>>
> >>>>>>
> >>>>>>              
> >>>>>>> That's a bit odd.  I'm not sure how that can happen.  It looks like you
> >>>>>>> somehow set the RABBITMQ_CONFIG_FILE variable at some point.
> >>>>>>>
> >>>>>>> The file is normally in:
> >>>>>>> ...\AppData\Roaming\RabbitMQ\rabbitmq.config
> >>>>>>> but your system is looking for it in:
> >>>>>>> ...\AppData\Roaming\RabbitMQ.config
> >>>>>>>
> >>>>>>> Could you copy the config file to "...\AppData\Roaming\RabbitMQ.config"
> >>>>>>> and try again?  Alternatively, unset the RABBITMQ_CONFIG_FILE variable
> >>>>>>> and try again without copying the file.
> >>>>>>>
> >>>>>>> Cheers,
> >>>>>>> Alex
> >>>>>>>
> >>>>>>> On Tue, Aug 09, 2011 at 05:02:04PM +0530, Abhijit wrote:
> >>>>>>>
> >>>>>>>
> >>>>>>>
> >>>>>>>                
> >>>>>>>> I deleted the dot as you asked to and also wrote the line find which
> >>>>>>>> config we are using, and found we are using the same config file and
> >>>>>>>> also broker is running successfully without the dot. Am attaching the
> >>>>>>>> print-screen for the command line output i received when i tried running
> >>>>>>>> rabbit-mq server
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>
> >>>>>>>> thanks and regards,
> >>>>>>>> Abhijit
> >>>>>>>>
> >>>>>>>> On 8/9/2011 4:50 PM, Alexandru Scvor?ov wrote:
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>                  
> >>>>>>>>> Ok.  Could you delete the dot at the end (or introduce some other
> >>>>>>>>> syntactic error) and try again?
> >>>>>>>>>
> >>>>>>>>> If it still runs, it's using a different configuration file.
> >>>>>>>>>
> >>>>>>>>> Could you also add the following line to the rabbitmq-server.bat file?
> >>>>>>>>>        echo CONFIG_FILE: !RABBITMQ_CONFIG_FILE!.config
> >>>>>>>>> It should go in towards the end, right before the "!ERLANG_HOME!\bin\erl.exe"
> >>>>>>>>> line.
> >>>>>>>>>
> >>>>>>>>> That way, when you start the server manually with the .bat, we will know
> >>>>>>>>> which config file it's using.
> >>>>>>>>>
> >>>>>>>>> Alex
> >>>>>>>>>
> >>>>>>>>> On Tue, Aug 09, 2011 at 04:42:32PM +0530, Abhijit wrote:
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>                    
> >>>>>>>>>> hi sir,
> >>>>>>>>>>
> >>>>>>>>>> It didn't worked as we wanted...this are the last two phrases in the log
> >>>>>>>>>> file of the broker.
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>                      
> >>>>>>>>>>> =INFO REPORT==== 9-Aug-2011::16:39:52 ===
> >>>>>>>>>>> started TCP Listener on [::]:5692
> >>>>>>>>>>>
> >>>>>>>>>>> =INFO REPORT==== 9-Aug-2011::16:39:53 ===
> >>>>>>>>>>> started TCP Listener on 0.0.0.0:5692
> >>>>>>>>>>>
> >>>>>>>>>>>
> >>>>>>>>>>>
> >>>>>>>>>>>
> >>>>>>>>>>>                        
> >>>>>>>>>> i copied the rabbitmq.config which you sent me but didn't worked out.
> >>>>>>>>>>
> >>>>>>>>>> Thanks and Regards,
> >>>>>>>>>> Abhijit
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>> On 8/9/2011 4:19 PM, Alexandru Scvor?ov wrote:
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>                      
> >>>>>>>>>>>> Am using the same path, C:\Users\Administrator\AppData\Roaming\RabbitMQ\rabbitmq.config for including ssl in my app.
> >>>>>>>>>>>>
> >>>>>>>>>>>>
> >>>>>>>>>>>>
> >>>>>>>>>>>>
> >>>>>>>>>>>>
> >>>>>>>>>>>>                          
> >>>>>>>>>>> Ok.
> >>>>>>>>>>>
> >>>>>>>>>>>
> >>>>>>>>>>>
> >>>>>>>>>>>
> >>>>>>>>>>>
> >>>>>>>>>>>
> >>>>>>>>>>>                        
> >>>>>>>>>>>> But the file wasn't present earlier i had created that file in order to have SSL in my app at the same location.
> >>>>>>>>>>>>
> >>>>>>>>>>>>
> >>>>>>>>>>>>
> >>>>>>>>>>>>
> >>>>>>>>>>>>
> >>>>>>>>>>>>                          
> >>>>>>>>>>> That's fine.
> >>>>>>>>>>>
> >>>>>>>>>>>
> >>>>>>>>>>>
> >>>>>>>>>>>
> >>>>>>>>>>>
> >>>>>>>>>>>
> >>>>>>>>>>>                        
> >>>>>>>>>>>> i tried running the bat file for the rabbitmq-server that didn't help sir, do you need any part of code for inspection.
> >>>>>>>>>>>>
> >>>>>>>>>>>>
> >>>>>>>>>>>>
> >>>>>>>>>>>>
> >>>>>>>>>>>>
> >>>>>>>>>>>>                          
> >>>>>>>>>>> The code isn't the problem right now.  It's getting rabbit to enable
> >>>>>>>>>>> ssl.
> >>>>>>>>>>>
> >>>>>>>>>>> I'm attaching a rabbitmq.config.  Please try using that one.  Restart
> >>>>>>>>>>> the broker and the last lines in the broker log should be:
> >>>>>>>>>>>
> >>>>>>>>>>> =INFO REPORT==== 9-Aug-2011::11:44:37 ===
> >>>>>>>>>>> started TCP Listener on [::]:5672
> >>>>>>>>>>>
> >>>>>>>>>>> =INFO REPORT==== 9-Aug-2011::11:44:37 ===
> >>>>>>>>>>> started SSL Listener on 0.0.0.0:5671
> >>>>>>>>>>>
> >>>>>>>>>>> Let me know how it goes, please.
> >>>>>>>>>>>
> >>>>>>>>>>> Cheers,
> >>>>>>>>>>> Alex
> >>>>>>>>>>>
> >>>>>>>>>>> On Tue, Aug 09, 2011 at 04:09:42PM +0530, Abhijit wrote:
> >>>>>>>>>>>
> >>>>>>>>>>>
> >>>>>>>>>>>
> >>>>>>>>>>>
> >>>>>>>>>>>
> >>>>>>>>>>>                        
> >>>>>>>>>>>> Hi Sir,
> >>>>>>>>>>>>
> >>>>>>>>>>>> Am using the same path, C:\Users\Administrator\AppData\Roaming\RabbitMQ\rabbitmq.config for including ssl in my app.
> >>>>>>>>>>>>
> >>>>>>>>>>>> But the file wasn't present earlier i had created that file in order to have SSL in my app at the same location.
> >>>>>>>>>>>>
> >>>>>>>>>>>> i tried running the bat file for the rabbitmq-server that didn't help sir, do you need any part of code for inspection.
> >>>>>>>>>>>>
> >>>>>>>>>>>> Thanks a lot for your time and replies.
> >>>>>>>>>>>>
> >>>>>>>>>>>> Regards,
> >>>>>>>>>>>> Abhijit
> >>>>>>>>>>>>
> >>>>>>>>>>>>
> >>>>>>>>>>>>
> >>>>>>>>>>>>
> >>>>>>>>>>>>
> >>>>>>>>>>>>
> >>>>>>>>>>>>                          
> >>>>>>>>>>
> >>>>>>>>>>                      
> >>>>>>>>
> >>>>>>>>                  
> >>>>>>
> >>>>>>              
> >>>>
> >>>>          
> >>      
> 

From abhijit.sinha at kiprosh.com  Tue Aug  9 15:28:03 2011
From: abhijit.sinha at kiprosh.com (Abhijit)
Date: Tue, 09 Aug 2011 19:58:03 +0530
Subject: [rabbitmq-discuss] facing issues with the SSL implementations
 with RabbitMQ + Windows + .Net
In-Reply-To: <20110809141913.GD28785@dakota.eng.vmware.com>
References: <20110809104918.GB3214@dakota.eng.vmware.com>
	<4E411620.4070301@kiprosh.com>
	<20110809112038.GC3214@dakota.eng.vmware.com>
	<4E411AB4.30706@kiprosh.com>
	<20110809115033.GF3214@dakota.eng.vmware.com>
	<4E412192.5080107@kiprosh.com>
	<20110809120926.GA28785@dakota.eng.vmware.com>
	<4E412A3B.60602@kiprosh.com>
	<20110809124819.GB28785@dakota.eng.vmware.com>
	<4E412D87.2080806@kiprosh.com>
	<20110809141913.GD28785@dakota.eng.vmware.com>
Message-ID: <4E4143F3.6030804@kiprosh.com>

Am still getting the same error, The message received was unexpected or 
badly formatted

my code:

> ConnectionFactory factory = new ConnectionFactory();
>
>                 factory.Ssl.ServerName = "localhost";
>                 factory.Ssl.CertPath = @"C:\server\keycert.p12";
>                 factory.Ssl.CertPassphrase = "kiprosh";
>                 factory.Ssl.Enabled = true;
>
>                 At this point am getting the error==>>using 
> (IConnection connection = factory.CreateConnection())
>                 {
>                     using (IModel channel = connection.CreateModel())
>                     {
>                         channel.ExchangeDeclare(EXCHANGE_NAME, "fanout");
>                         byte[] payload = 
> Encoding.ASCII.GetBytes(work_demo);
>                         channel.BasicPublish(EXCHANGE_NAME, "", null, 
> payload);
>                         Console.WriteLine("started sending messages...");
>                         System.Threading.Thread.Sleep(3000);
>                     }
>                 }

Thanks and Regards,
Abhijit


On 8/9/2011 7:49 PM, Alexandru Scvor?ov wrote:
> BTW, I got a "The remote certificate is invalid according to the
> validation procedure" error on the client side after getting the broker
> to work.
>
> That was probably due to my generating the certificates on a different
> machine and thus the CN was not also the server's hostname.  The
> solution was to mark that as an acceptable policy ssl policy error in
> the client:
>    cf.Ssl.AcceptablePolicyErrors =
>        SslPolicyErrors.RemoteCertificateNameMismatch;
>
> Cheers,
> Alex
>
> On Tue, Aug 09, 2011 at 06:22:23PM +0530, Abhijit wrote:
>    
>> ya sir that was set true, i would go back and look at my certification
>> creation steps and find out whether i did everything properly.
>>
>> and would let you know once that i done.
>>
>> Thanks and Regards,
>> Abhijit
>>
>> On 8/9/2011 6:18 PM, Alexandru Scvor?ov wrote:
>>      
>>>> Am basically getting this error, i tried debugging and solved most of
>>>> the problems but still getting this:
>>>>
>>>>          
>>> Oh, great. My guess about the really long error was that you needed some
>>> clients to connect without providing certificates, but
>>> fail_if_no_peer_cert was set to true in the config file.  Was that
>>> right?
>>>
>>>
>>>        
>>>>> [{amqp-0-9://localhost:5671}] =
>>>>> {System.Security.Authentication.AuthenticationException: A call to
>>>>> SSPI failed, see inner exception. --->
>>>>> System.ComponentModel.Win32Exception: The certificate chain was issued
>>>>> by an authority that is not trusted
>>>>>
>>>>>            
>>> I haven't seen that before.  Did you follow the steps in our SSL guide
>>> to generate the certificate (in particular, were the client certificates
>>> signed by the CA set in the broker)?
>>>
>>> Alex
>>>
>>> On Tue, Aug 09, 2011 at 06:08:19PM +0530, Abhijit wrote:
>>>
>>>        
>>>> hi sir,
>>>>
>>>> Am basically getting this error, i tried debugging and solved most of
>>>> the problems but still getting this:
>>>>
>>>>
>>>>          
>>>>> [{amqp-0-9://localhost:5671}] =
>>>>> {System.Security.Authentication.AuthenticationException: A call to
>>>>> SSPI failed, see inner exception. --->
>>>>> System.ComponentModel.Win32Exception: The certificate chain was issued
>>>>> by an authority that is not trusted
>>>>>      --- End of inner exception stack trace -...
>>>>>
>>>>>            
>>>> Thanks and Regards,
>>>> Abhijit
>>>>
>>>>
>>>>
>>>>
>>>> On 8/9/2011 5:39 PM, Alexandru Scvor?ov wrote:
>>>>
>>>>          
>>>>>> i would go ahead for now, if any queries i would again seek your help.
>>>>>>
>>>>>>
>>>>>>              
>>>>> Excellent.  Don't hesitate to ask us any more questions.
>>>>>
>>>>> Also, in the future, could you please make sure to CC the mailing list
>>>>> when replying?
>>>>>
>>>>> Cheers,
>>>>> Alex
>>>>>
>>>>> On Tue, Aug 09, 2011 at 05:31:22PM +0530, Abhijit wrote:
>>>>>
>>>>>
>>>>>            
>>>>>> hi sir,
>>>>>>
>>>>>> finally got this:
>>>>>>
>>>>>>
>>>>>>              
>>>>>>> =INFO REPORT==== 9-Aug-2011::17:28:33 ===
>>>>>>> started TCP Listener on 0.0.0.0:5672
>>>>>>>
>>>>>>> =INFO REPORT==== 9-Aug-2011::17:28:33 ===
>>>>>>> started SSL Listener on 0.0.0.0:5671
>>>>>>>
>>>>>>>
>>>>>>>                
>>>>>> your this step
>>>>>>
>>>>>> Could you copy the config file to "...\AppData\Roaming\RabbitMQ.config"
>>>>>> and try again
>>>>>>
>>>>>> helped...
>>>>>>
>>>>>> i would go ahead for now, if any queries i would again seek your help.
>>>>>>
>>>>>> Thanks and Regards,
>>>>>> Abhijit
>>>>>>
>>>>>> On 8/9/2011 5:20 PM, Alexandru Scvor?ov wrote:
>>>>>>
>>>>>>
>>>>>>              
>>>>>>> That's a bit odd.  I'm not sure how that can happen.  It looks like you
>>>>>>> somehow set the RABBITMQ_CONFIG_FILE variable at some point.
>>>>>>>
>>>>>>> The file is normally in:
>>>>>>> ...\AppData\Roaming\RabbitMQ\rabbitmq.config
>>>>>>> but your system is looking for it in:
>>>>>>> ...\AppData\Roaming\RabbitMQ.config
>>>>>>>
>>>>>>> Could you copy the config file to "...\AppData\Roaming\RabbitMQ.config"
>>>>>>> and try again?  Alternatively, unset the RABBITMQ_CONFIG_FILE variable
>>>>>>> and try again without copying the file.
>>>>>>>
>>>>>>> Cheers,
>>>>>>> Alex
>>>>>>>
>>>>>>> On Tue, Aug 09, 2011 at 05:02:04PM +0530, Abhijit wrote:
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>                
>>>>>>>> I deleted the dot as you asked to and also wrote the line find which
>>>>>>>> config we are using, and found we are using the same config file and
>>>>>>>> also broker is running successfully without the dot. Am attaching the
>>>>>>>> print-screen for the command line output i received when i tried running
>>>>>>>> rabbit-mq server
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>> thanks and regards,
>>>>>>>> Abhijit
>>>>>>>>
>>>>>>>> On 8/9/2011 4:50 PM, Alexandru Scvor?ov wrote:
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>                  
>>>>>>>>> Ok.  Could you delete the dot at the end (or introduce some other
>>>>>>>>> syntactic error) and try again?
>>>>>>>>>
>>>>>>>>> If it still runs, it's using a different configuration file.
>>>>>>>>>
>>>>>>>>> Could you also add the following line to the rabbitmq-server.bat file?
>>>>>>>>>        echo CONFIG_FILE: !RABBITMQ_CONFIG_FILE!.config
>>>>>>>>> It should go in towards the end, right before the "!ERLANG_HOME!\bin\erl.exe"
>>>>>>>>> line.
>>>>>>>>>
>>>>>>>>> That way, when you start the server manually with the .bat, we will know
>>>>>>>>> which config file it's using.
>>>>>>>>>
>>>>>>>>> Alex
>>>>>>>>>
>>>>>>>>> On Tue, Aug 09, 2011 at 04:42:32PM +0530, Abhijit wrote:
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>                    
>>>>>>>>>> hi sir,
>>>>>>>>>>
>>>>>>>>>> It didn't worked as we wanted...this are the last two phrases in the log
>>>>>>>>>> file of the broker.
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>                      
>>>>>>>>>>> =INFO REPORT==== 9-Aug-2011::16:39:52 ===
>>>>>>>>>>> started TCP Listener on [::]:5692
>>>>>>>>>>>
>>>>>>>>>>> =INFO REPORT==== 9-Aug-2011::16:39:53 ===
>>>>>>>>>>> started TCP Listener on 0.0.0.0:5692
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>                        
>>>>>>>>>> i copied the rabbitmq.config which you sent me but didn't worked out.
>>>>>>>>>>
>>>>>>>>>> Thanks and Regards,
>>>>>>>>>> Abhijit
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>> On 8/9/2011 4:19 PM, Alexandru Scvor?ov wrote:
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>                      
>>>>>>>>>>>> Am using the same path, C:\Users\Administrator\AppData\Roaming\RabbitMQ\rabbitmq.config for including ssl in my app.
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>                          
>>>>>>>>>>> Ok.
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>                        
>>>>>>>>>>>> But the file wasn't present earlier i had created that file in order to have SSL in my app at the same location.
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>                          
>>>>>>>>>>> That's fine.
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>                        
>>>>>>>>>>>> i tried running the bat file for the rabbitmq-server that didn't help sir, do you need any part of code for inspection.
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>                          
>>>>>>>>>>> The code isn't the problem right now.  It's getting rabbit to enable
>>>>>>>>>>> ssl.
>>>>>>>>>>>
>>>>>>>>>>> I'm attaching a rabbitmq.config.  Please try using that one.  Restart
>>>>>>>>>>> the broker and the last lines in the broker log should be:
>>>>>>>>>>>
>>>>>>>>>>> =INFO REPORT==== 9-Aug-2011::11:44:37 ===
>>>>>>>>>>> started TCP Listener on [::]:5672
>>>>>>>>>>>
>>>>>>>>>>> =INFO REPORT==== 9-Aug-2011::11:44:37 ===
>>>>>>>>>>> started SSL Listener on 0.0.0.0:5671
>>>>>>>>>>>
>>>>>>>>>>> Let me know how it goes, please.
>>>>>>>>>>>
>>>>>>>>>>> Cheers,
>>>>>>>>>>> Alex
>>>>>>>>>>>
>>>>>>>>>>> On Tue, Aug 09, 2011 at 04:09:42PM +0530, Abhijit wrote:
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>                        
>>>>>>>>>>>> Hi Sir,
>>>>>>>>>>>>
>>>>>>>>>>>> Am using the same path, C:\Users\Administrator\AppData\Roaming\RabbitMQ\rabbitmq.config for including ssl in my app.
>>>>>>>>>>>>
>>>>>>>>>>>> But the file wasn't present earlier i had created that file in order to have SSL in my app at the same location.
>>>>>>>>>>>>
>>>>>>>>>>>> i tried running the bat file for the rabbitmq-server that didn't help sir, do you need any part of code for inspection.
>>>>>>>>>>>>
>>>>>>>>>>>> Thanks a lot for your time and replies.
>>>>>>>>>>>>
>>>>>>>>>>>> Regards,
>>>>>>>>>>>> Abhijit
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>                          
>>>>>>>>>>
>>>>>>>>>>                      
>>>>>>>>
>>>>>>>>                  
>>>>>>
>>>>>>              
>>>>
>>>>          
>>      


From Lionel.Cons at cern.ch  Tue Aug  9 15:40:01 2011
From: Lionel.Cons at cern.ch (Lionel Cons)
Date: Tue, 9 Aug 2011 14:40:01 +0000
Subject: [rabbitmq-discuss] rabbitmq-stomp 2.5.1 does not respect the
 spec wrt content-type
In-Reply-To: <1DEBAA7E-CDAE-486F-8FE4-5E5484C8C448@rabbitmq.com>
References: <20110809140039.40ee.abe10f7e5afbbb3a79ce619739541149@cern.ch>
	<1DEBAA7E-CDAE-486F-8FE4-5E5484C8C448@rabbitmq.com>
Message-ID: <1D9CBD89533EE94D8295DFBFD923C23F374BEC52@PLOXCHG03.cern.ch>

Steve,

I confirm that my test message did include a content-length header and no content-type. It should have been treated as binary.

Even if the spec indeed uses SHOULD for this matter, I consider it bad practice to add something to the message that can be incorrect.

Cheers,

Lionel

From: Steve Powell [mailto:steve at rabbitmq.com]
Sent: Tuesday, August 09, 2011 4:08 PM
To: rabbitmq-discuss at lists.rabbitmq.com
Cc: Lionel Cons
Subject: Re: [rabbitmq-discuss] rabbitmq-stomp 2.5.1 does not respect the spec wrt content-type

Dear Lionel,
Yes, indeed, this does look like a bug.

You do not say whether your test message included a content-length header.  You ought to know that without it there is no way a STOMP server can determine the length of a binary body, other than by using the NULL byte terminator (the usual rule).

If the SENDer gave a message with content-type binary (explicitly or implicitly) and omitted the content-length header, would you wish us to reject the message (with an ERROR) or use the NULL terminator rule, which would almost always indicate a potential error in the binary case?

Notice that the requirement to include a content-length header and the requirement to assume binary when the content-type is omitted are both imposed with the SHOULD keyword.  We are not clear what the force of that term is in this context.  We are going to clarify this.

Thank you for pointing this out.
Steve Powell  (a hoppy bunny)
----------some definitions from the SPD----------
Rigatoni n. A prime-ministerial grin.
Nigella n. The next bottle-size up from a Nebuchadnezzar.
Homily adv. Rather like a frenchman.

On 9 Aug 2011, at 13:08, Lionel Cons wrote:

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-August/014412.html
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110809/6521285f/attachment.htm>

From abhijit.sinha at kiprosh.com  Tue Aug  9 15:40:37 2011
From: abhijit.sinha at kiprosh.com (Abhijit)
Date: Tue, 09 Aug 2011 20:10:37 +0530
Subject: [rabbitmq-discuss] facing issues with the SSL implementations
 with RabbitMQ + Windows + .Net
In-Reply-To: <20110809142807.GE28785@dakota.eng.vmware.com>
References: <20110809112038.GC3214@dakota.eng.vmware.com>
	<4E411AB4.30706@kiprosh.com>
	<20110809115033.GF3214@dakota.eng.vmware.com>
	<4E412192.5080107@kiprosh.com>
	<20110809120926.GA28785@dakota.eng.vmware.com>
	<4E412A3B.60602@kiprosh.com>
	<20110809124819.GB28785@dakota.eng.vmware.com>
	<4E412D87.2080806@kiprosh.com>
	<20110809140658.GC28785@dakota.eng.vmware.com>
	<4E414086.7010706@kiprosh.com>
	<20110809142807.GE28785@dakota.eng.vmware.com>
Message-ID: <4E4146E5.4030101@kiprosh.com>

hi sir ,

i have added all those certificates as trusted, still am getting this

> base {System.Runtime.InteropServices.ExternalException} = {"The 
> certificate chain was issued by an authority that is not trusted"}

thanks a lot for the replies let me know if any suggestions.

Thanks and Regards,
Abhijit


On 8/9/2011 7:58 PM, Alexandru Scvor?ov wrote:
>> http://www.rabbitmq.com/ssl.html#trust-dotNET,
>> i have executed them but all they do is opens the certmanager window.
>>      
> There are two versions of the certmgr program.  One of the is shipped
> with Windows and is the graphical version you use.  The other is shipped
> with the Windows SDK and is a command line version.
>
> You can use the graphical version: start it up, click Import, select
> testca/cacert.cer, click Next, *IMPORTANT* select the Trusted Root
> Certification Authorities store, click Next... until it's imported.
>
>    
>>> [{amqp-0-9://localhost:5671}] =
>>> {System.Security.Authentication.AuthenticationException: A call to
>>> SSPI failed, see inner exception. --->
>>> System.ComponentModel.Win32Exception: The message received was
>>> unexpected or badly formatted
>>>        
> The error you're getting doesn't sound like it's because of this, but
> you'll need to import the certificate anyway.  Maybe it will help.
>
> Cheers,
> Alex
>
> On Tue, Aug 09, 2011 at 07:43:26PM +0530, Abhijit wrote:
>    
>> hello sir,
>>
>>      
>>> [{amqp-0-9://localhost:5671}] =
>>> {System.Security.Authentication.AuthenticationException: A call to
>>> SSPI failed, see inner exception. --->
>>> System.ComponentModel.Win32Exception: The message received was
>>> unexpected or badly formatted
>>>        
>> i got this error after changing it to pem sir, and also i created the
>> certificates properly as per the rabbitmq ssl steps but i haven't able
>> to understand this steps mentioned:
>> http://www.rabbitmq.com/ssl.html#trust-dotNET,
>> i have executed them but all they do is opens the certmanager window.
>>
>> Any suggestions.
>>
>> Thanks and Regards,
>> Abhijit
>>
>>
>> On 8/9/2011 7:36 PM, Alexandru Scvor?ov wrote:
>>      
>>> I managed to reproduce your error.
>>>
>>> Solution: do not use the .cer file in the broker config; use the .pem
>>> file.  For some reason, rather than complaining that it can't read the
>>> CA certificate, Erlang just silently ignores that and throws an "unknown
>>> CA" error.  Hurray!
>>>
>>> So, change
>>>     {cacertfile,"C:\\testca\\cacert.cer"}
>>> with
>>>     {cacertfile,"C:\\testca\\cacert.pem"}
>>>
>>> Please let me know if this helps.
>>>
>>> Cheers,
>>> Alex
>>>
>>> On Tue, Aug 09, 2011 at 06:22:23PM +0530, Abhijit wrote:
>>>
>>>        
>>>> ya sir that was set true, i would go back and look at my certification
>>>> creation steps and find out whether i did everything properly.
>>>>
>>>> and would let you know once that i done.
>>>>
>>>> Thanks and Regards,
>>>> Abhijit
>>>>
>>>> On 8/9/2011 6:18 PM, Alexandru Scvor?ov wrote:
>>>>
>>>>          
>>>>>> Am basically getting this error, i tried debugging and solved most of
>>>>>> the problems but still getting this:
>>>>>>
>>>>>>
>>>>>>              
>>>>> Oh, great. My guess about the really long error was that you needed some
>>>>> clients to connect without providing certificates, but
>>>>> fail_if_no_peer_cert was set to true in the config file.  Was that
>>>>> right?
>>>>>
>>>>>
>>>>>
>>>>>            
>>>>>>> [{amqp-0-9://localhost:5671}] =
>>>>>>> {System.Security.Authentication.AuthenticationException: A call to
>>>>>>> SSPI failed, see inner exception. --->
>>>>>>> System.ComponentModel.Win32Exception: The certificate chain was issued
>>>>>>> by an authority that is not trusted
>>>>>>>
>>>>>>>
>>>>>>>                
>>>>> I haven't seen that before.  Did you follow the steps in our SSL guide
>>>>> to generate the certificate (in particular, were the client certificates
>>>>> signed by the CA set in the broker)?
>>>>>
>>>>> Alex
>>>>>
>>>>> On Tue, Aug 09, 2011 at 06:08:19PM +0530, Abhijit wrote:
>>>>>
>>>>>
>>>>>            
>>>>>> hi sir,
>>>>>>
>>>>>> Am basically getting this error, i tried debugging and solved most of
>>>>>> the problems but still getting this:
>>>>>>
>>>>>>
>>>>>>
>>>>>>              
>>>>>>> [{amqp-0-9://localhost:5671}] =
>>>>>>> {System.Security.Authentication.AuthenticationException: A call to
>>>>>>> SSPI failed, see inner exception. --->
>>>>>>> System.ComponentModel.Win32Exception: The certificate chain was issued
>>>>>>> by an authority that is not trusted
>>>>>>>       --- End of inner exception stack trace -...
>>>>>>>
>>>>>>>
>>>>>>>                
>>>>>> Thanks and Regards,
>>>>>> Abhijit
>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>> On 8/9/2011 5:39 PM, Alexandru Scvor?ov wrote:
>>>>>>
>>>>>>
>>>>>>              
>>>>>>>> i would go ahead for now, if any queries i would again seek your help.
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>                  
>>>>>>> Excellent.  Don't hesitate to ask us any more questions.
>>>>>>>
>>>>>>> Also, in the future, could you please make sure to CC the mailing list
>>>>>>> when replying?
>>>>>>>
>>>>>>> Cheers,
>>>>>>> Alex
>>>>>>>
>>>>>>> On Tue, Aug 09, 2011 at 05:31:22PM +0530, Abhijit wrote:
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>                
>>>>>>>> hi sir,
>>>>>>>>
>>>>>>>> finally got this:
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>                  
>>>>>>>>> =INFO REPORT==== 9-Aug-2011::17:28:33 ===
>>>>>>>>> started TCP Listener on 0.0.0.0:5672
>>>>>>>>>
>>>>>>>>> =INFO REPORT==== 9-Aug-2011::17:28:33 ===
>>>>>>>>> started SSL Listener on 0.0.0.0:5671
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>                    
>>>>>>>> your this step
>>>>>>>>
>>>>>>>> Could you copy the config file to "...\AppData\Roaming\RabbitMQ.config"
>>>>>>>> and try again
>>>>>>>>
>>>>>>>> helped...
>>>>>>>>
>>>>>>>> i would go ahead for now, if any queries i would again seek your help.
>>>>>>>>
>>>>>>>> Thanks and Regards,
>>>>>>>> Abhijit
>>>>>>>>
>>>>>>>> On 8/9/2011 5:20 PM, Alexandru Scvor?ov wrote:
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>                  
>>>>>>>>> That's a bit odd.  I'm not sure how that can happen.  It looks like you
>>>>>>>>> somehow set the RABBITMQ_CONFIG_FILE variable at some point.
>>>>>>>>>
>>>>>>>>> The file is normally in:
>>>>>>>>> ...\AppData\Roaming\RabbitMQ\rabbitmq.config
>>>>>>>>> but your system is looking for it in:
>>>>>>>>> ...\AppData\Roaming\RabbitMQ.config
>>>>>>>>>
>>>>>>>>> Could you copy the config file to "...\AppData\Roaming\RabbitMQ.config"
>>>>>>>>> and try again?  Alternatively, unset the RABBITMQ_CONFIG_FILE variable
>>>>>>>>> and try again without copying the file.
>>>>>>>>>
>>>>>>>>> Cheers,
>>>>>>>>> Alex
>>>>>>>>>
>>>>>>>>> On Tue, Aug 09, 2011 at 05:02:04PM +0530, Abhijit wrote:
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>                    
>>>>>>>>>> I deleted the dot as you asked to and also wrote the line find which
>>>>>>>>>> config we are using, and found we are using the same config file and
>>>>>>>>>> also broker is running successfully without the dot. Am attaching the
>>>>>>>>>> print-screen for the command line output i received when i tried running
>>>>>>>>>> rabbit-mq server
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>> thanks and regards,
>>>>>>>>>> Abhijit
>>>>>>>>>>
>>>>>>>>>> On 8/9/2011 4:50 PM, Alexandru Scvor?ov wrote:
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>                      
>>>>>>>>>>> Ok.  Could you delete the dot at the end (or introduce some other
>>>>>>>>>>> syntactic error) and try again?
>>>>>>>>>>>
>>>>>>>>>>> If it still runs, it's using a different configuration file.
>>>>>>>>>>>
>>>>>>>>>>> Could you also add the following line to the rabbitmq-server.bat file?
>>>>>>>>>>>         echo CONFIG_FILE: !RABBITMQ_CONFIG_FILE!.config
>>>>>>>>>>> It should go in towards the end, right before the "!ERLANG_HOME!\bin\erl.exe"
>>>>>>>>>>> line.
>>>>>>>>>>>
>>>>>>>>>>> That way, when you start the server manually with the .bat, we will know
>>>>>>>>>>> which config file it's using.
>>>>>>>>>>>
>>>>>>>>>>> Alex
>>>>>>>>>>>
>>>>>>>>>>> On Tue, Aug 09, 2011 at 04:42:32PM +0530, Abhijit wrote:
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>                        
>>>>>>>>>>>> hi sir,
>>>>>>>>>>>>
>>>>>>>>>>>> It didn't worked as we wanted...this are the last two phrases in the log
>>>>>>>>>>>> file of the broker.
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>                          
>>>>>>>>>>>>> =INFO REPORT==== 9-Aug-2011::16:39:52 ===
>>>>>>>>>>>>> started TCP Listener on [::]:5692
>>>>>>>>>>>>>
>>>>>>>>>>>>> =INFO REPORT==== 9-Aug-2011::16:39:53 ===
>>>>>>>>>>>>> started TCP Listener on 0.0.0.0:5692
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>                            
>>>>>>>>>>>> i copied the rabbitmq.config which you sent me but didn't worked out.
>>>>>>>>>>>>
>>>>>>>>>>>> Thanks and Regards,
>>>>>>>>>>>> Abhijit
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>> On 8/9/2011 4:19 PM, Alexandru Scvor?ov wrote:
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>                          
>>>>>>>>>>>>>> Am using the same path, C:\Users\Administrator\AppData\Roaming\RabbitMQ\rabbitmq.config for including ssl in my app.
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>                              
>>>>>>>>>>>>> Ok.
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>                            
>>>>>>>>>>>>>> But the file wasn't present earlier i had created that file in order to have SSL in my app at the same location.
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>                              
>>>>>>>>>>>>> That's fine.
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>                            
>>>>>>>>>>>>>> i tried running the bat file for the rabbitmq-server that didn't help sir, do you need any part of code for inspection.
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>                              
>>>>>>>>>>>>> The code isn't the problem right now.  It's getting rabbit to enable
>>>>>>>>>>>>> ssl.
>>>>>>>>>>>>>
>>>>>>>>>>>>> I'm attaching a rabbitmq.config.  Please try using that one.  Restart
>>>>>>>>>>>>> the broker and the last lines in the broker log should be:
>>>>>>>>>>>>>
>>>>>>>>>>>>> =INFO REPORT==== 9-Aug-2011::11:44:37 ===
>>>>>>>>>>>>> started TCP Listener on [::]:5672
>>>>>>>>>>>>>
>>>>>>>>>>>>> =INFO REPORT==== 9-Aug-2011::11:44:37 ===
>>>>>>>>>>>>> started SSL Listener on 0.0.0.0:5671
>>>>>>>>>>>>>
>>>>>>>>>>>>> Let me know how it goes, please.
>>>>>>>>>>>>>
>>>>>>>>>>>>> Cheers,
>>>>>>>>>>>>> Alex
>>>>>>>>>>>>>
>>>>>>>>>>>>> On Tue, Aug 09, 2011 at 04:09:42PM +0530, Abhijit wrote:
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>                            
>>>>>>>>>>>>>> Hi Sir,
>>>>>>>>>>>>>>
>>>>>>>>>>>>>> Am using the same path, C:\Users\Administrator\AppData\Roaming\RabbitMQ\rabbitmq.config for including ssl in my app.
>>>>>>>>>>>>>>
>>>>>>>>>>>>>> But the file wasn't present earlier i had created that file in order to have SSL in my app at the same location.
>>>>>>>>>>>>>>
>>>>>>>>>>>>>> i tried running the bat file for the rabbitmq-server that didn't help sir, do you need any part of code for inspection.
>>>>>>>>>>>>>>
>>>>>>>>>>>>>> Thanks a lot for your time and replies.
>>>>>>>>>>>>>>
>>>>>>>>>>>>>> Regards,
>>>>>>>>>>>>>> Abhijit
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>                              
>>>>>>>>>>>>
>>>>>>>>>>>>                          
>>>>>>>>>>
>>>>>>>>>>                      
>>>>>>>>
>>>>>>>>                  
>>>>>>
>>>>>>              
>>>>
>>>>          
>>      


From alexandru at rabbitmq.com  Tue Aug  9 16:02:26 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Tue, 9 Aug 2011 16:02:26 +0100
Subject: [rabbitmq-discuss] facing issues with the SSL implementations
 with RabbitMQ + Windows + .Net
In-Reply-To: <4E4146E5.4030101@kiprosh.com>
References: <20110809115033.GF3214@dakota.eng.vmware.com>
	<4E412192.5080107@kiprosh.com>
	<20110809120926.GA28785@dakota.eng.vmware.com>
	<4E412A3B.60602@kiprosh.com>
	<20110809124819.GB28785@dakota.eng.vmware.com>
	<4E412D87.2080806@kiprosh.com>
	<20110809140658.GC28785@dakota.eng.vmware.com>
	<4E414086.7010706@kiprosh.com>
	<20110809142807.GE28785@dakota.eng.vmware.com>
	<4E4146E5.4030101@kiprosh.com>
Message-ID: <20110809150226.GF28785@dakota.eng.vmware.com>

Is there anything in the server logs other than an abrupt connection
termination?  If not, then it's strictly a client error.  I'd check that
the CA certificate is indeed in the Trusted Root Certificate Authorities store
and then I'd play around with setting the SslPolicyErrors.

Other than that, I don't have any suggestions.  I've just set up
something similar (RabbitMQ with SSL on Win2008 with .NET 3.5, OpenSSL
1.0 and RabbitMQ .NET on the same machine) and it works fine, so there's
not intrinsic reason why it wouldn't work.

Cheers,
Alex

On Tue, Aug 09, 2011 at 08:10:37PM +0530, Abhijit wrote:
> hi sir ,
> 
> i have added all those certificates as trusted, still am getting this
> 
> > base {System.Runtime.InteropServices.ExternalException} = {"The 
> > certificate chain was issued by an authority that is not trusted"}
> 
> thanks a lot for the replies let me know if any suggestions.
> 
> Thanks and Regards,
> Abhijit
> 
> 
> On 8/9/2011 7:58 PM, Alexandru Scvor?ov wrote:
> >> http://www.rabbitmq.com/ssl.html#trust-dotNET,
> >> i have executed them but all they do is opens the certmanager window.
> >>      
> > There are two versions of the certmgr program.  One of the is shipped
> > with Windows and is the graphical version you use.  The other is shipped
> > with the Windows SDK and is a command line version.
> >
> > You can use the graphical version: start it up, click Import, select
> > testca/cacert.cer, click Next, *IMPORTANT* select the Trusted Root
> > Certification Authorities store, click Next... until it's imported.
> >
> >    
> >>> [{amqp-0-9://localhost:5671}] =
> >>> {System.Security.Authentication.AuthenticationException: A call to
> >>> SSPI failed, see inner exception. --->
> >>> System.ComponentModel.Win32Exception: The message received was
> >>> unexpected or badly formatted
> >>>        
> > The error you're getting doesn't sound like it's because of this, but
> > you'll need to import the certificate anyway.  Maybe it will help.
> >
> > Cheers,
> > Alex
> >
> > On Tue, Aug 09, 2011 at 07:43:26PM +0530, Abhijit wrote:
> >    
> >> hello sir,
> >>
> >>      
> >>> [{amqp-0-9://localhost:5671}] =
> >>> {System.Security.Authentication.AuthenticationException: A call to
> >>> SSPI failed, see inner exception. --->
> >>> System.ComponentModel.Win32Exception: The message received was
> >>> unexpected or badly formatted
> >>>        
> >> i got this error after changing it to pem sir, and also i created the
> >> certificates properly as per the rabbitmq ssl steps but i haven't able
> >> to understand this steps mentioned:
> >> http://www.rabbitmq.com/ssl.html#trust-dotNET,
> >> i have executed them but all they do is opens the certmanager window.
> >>
> >> Any suggestions.
> >>
> >> Thanks and Regards,
> >> Abhijit
> >>
> >>
> >> On 8/9/2011 7:36 PM, Alexandru Scvor?ov wrote:
> >>      
> >>> I managed to reproduce your error.
> >>>
> >>> Solution: do not use the .cer file in the broker config; use the .pem
> >>> file.  For some reason, rather than complaining that it can't read the
> >>> CA certificate, Erlang just silently ignores that and throws an "unknown
> >>> CA" error.  Hurray!
> >>>
> >>> So, change
> >>>     {cacertfile,"C:\\testca\\cacert.cer"}
> >>> with
> >>>     {cacertfile,"C:\\testca\\cacert.pem"}
> >>>
> >>> Please let me know if this helps.
> >>>
> >>> Cheers,
> >>> Alex
> >>>
> >>> On Tue, Aug 09, 2011 at 06:22:23PM +0530, Abhijit wrote:
> >>>
> >>>        
> >>>> ya sir that was set true, i would go back and look at my certification
> >>>> creation steps and find out whether i did everything properly.
> >>>>
> >>>> and would let you know once that i done.
> >>>>
> >>>> Thanks and Regards,
> >>>> Abhijit
> >>>>
> >>>> On 8/9/2011 6:18 PM, Alexandru Scvor?ov wrote:
> >>>>
> >>>>          
> >>>>>> Am basically getting this error, i tried debugging and solved most of
> >>>>>> the problems but still getting this:
> >>>>>>
> >>>>>>
> >>>>>>              
> >>>>> Oh, great. My guess about the really long error was that you needed some
> >>>>> clients to connect without providing certificates, but
> >>>>> fail_if_no_peer_cert was set to true in the config file.  Was that
> >>>>> right?
> >>>>>
> >>>>>
> >>>>>
> >>>>>            
> >>>>>>> [{amqp-0-9://localhost:5671}] =
> >>>>>>> {System.Security.Authentication.AuthenticationException: A call to
> >>>>>>> SSPI failed, see inner exception. --->
> >>>>>>> System.ComponentModel.Win32Exception: The certificate chain was issued
> >>>>>>> by an authority that is not trusted
> >>>>>>>
> >>>>>>>
> >>>>>>>                
> >>>>> I haven't seen that before.  Did you follow the steps in our SSL guide
> >>>>> to generate the certificate (in particular, were the client certificates
> >>>>> signed by the CA set in the broker)?
> >>>>>
> >>>>> Alex
> >>>>>
> >>>>> On Tue, Aug 09, 2011 at 06:08:19PM +0530, Abhijit wrote:
> >>>>>
> >>>>>
> >>>>>            
> >>>>>> hi sir,
> >>>>>>
> >>>>>> Am basically getting this error, i tried debugging and solved most of
> >>>>>> the problems but still getting this:
> >>>>>>
> >>>>>>
> >>>>>>
> >>>>>>              
> >>>>>>> [{amqp-0-9://localhost:5671}] =
> >>>>>>> {System.Security.Authentication.AuthenticationException: A call to
> >>>>>>> SSPI failed, see inner exception. --->
> >>>>>>> System.ComponentModel.Win32Exception: The certificate chain was issued
> >>>>>>> by an authority that is not trusted
> >>>>>>>       --- End of inner exception stack trace -...
> >>>>>>>
> >>>>>>>
> >>>>>>>                
> >>>>>> Thanks and Regards,
> >>>>>> Abhijit
> >>>>>>
> >>>>>>
> >>>>>>
> >>>>>>
> >>>>>> On 8/9/2011 5:39 PM, Alexandru Scvor?ov wrote:
> >>>>>>
> >>>>>>
> >>>>>>              
> >>>>>>>> i would go ahead for now, if any queries i would again seek your help.
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>                  
> >>>>>>> Excellent.  Don't hesitate to ask us any more questions.
> >>>>>>>
> >>>>>>> Also, in the future, could you please make sure to CC the mailing list
> >>>>>>> when replying?
> >>>>>>>
> >>>>>>> Cheers,
> >>>>>>> Alex
> >>>>>>>
> >>>>>>> On Tue, Aug 09, 2011 at 05:31:22PM +0530, Abhijit wrote:
> >>>>>>>
> >>>>>>>
> >>>>>>>
> >>>>>>>                
> >>>>>>>> hi sir,
> >>>>>>>>
> >>>>>>>> finally got this:
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>                  
> >>>>>>>>> =INFO REPORT==== 9-Aug-2011::17:28:33 ===
> >>>>>>>>> started TCP Listener on 0.0.0.0:5672
> >>>>>>>>>
> >>>>>>>>> =INFO REPORT==== 9-Aug-2011::17:28:33 ===
> >>>>>>>>> started SSL Listener on 0.0.0.0:5671
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>                    
> >>>>>>>> your this step
> >>>>>>>>
> >>>>>>>> Could you copy the config file to "...\AppData\Roaming\RabbitMQ.config"
> >>>>>>>> and try again
> >>>>>>>>
> >>>>>>>> helped...
> >>>>>>>>
> >>>>>>>> i would go ahead for now, if any queries i would again seek your help.
> >>>>>>>>
> >>>>>>>> Thanks and Regards,
> >>>>>>>> Abhijit
> >>>>>>>>
> >>>>>>>> On 8/9/2011 5:20 PM, Alexandru Scvor?ov wrote:
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>                  
> >>>>>>>>> That's a bit odd.  I'm not sure how that can happen.  It looks like you
> >>>>>>>>> somehow set the RABBITMQ_CONFIG_FILE variable at some point.
> >>>>>>>>>
> >>>>>>>>> The file is normally in:
> >>>>>>>>> ...\AppData\Roaming\RabbitMQ\rabbitmq.config
> >>>>>>>>> but your system is looking for it in:
> >>>>>>>>> ...\AppData\Roaming\RabbitMQ.config
> >>>>>>>>>
> >>>>>>>>> Could you copy the config file to "...\AppData\Roaming\RabbitMQ.config"
> >>>>>>>>> and try again?  Alternatively, unset the RABBITMQ_CONFIG_FILE variable
> >>>>>>>>> and try again without copying the file.
> >>>>>>>>>
> >>>>>>>>> Cheers,
> >>>>>>>>> Alex
> >>>>>>>>>
> >>>>>>>>> On Tue, Aug 09, 2011 at 05:02:04PM +0530, Abhijit wrote:
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>                    
> >>>>>>>>>> I deleted the dot as you asked to and also wrote the line find which
> >>>>>>>>>> config we are using, and found we are using the same config file and
> >>>>>>>>>> also broker is running successfully without the dot. Am attaching the
> >>>>>>>>>> print-screen for the command line output i received when i tried running
> >>>>>>>>>> rabbit-mq server
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>> thanks and regards,
> >>>>>>>>>> Abhijit
> >>>>>>>>>>
> >>>>>>>>>> On 8/9/2011 4:50 PM, Alexandru Scvor?ov wrote:
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>                      
> >>>>>>>>>>> Ok.  Could you delete the dot at the end (or introduce some other
> >>>>>>>>>>> syntactic error) and try again?
> >>>>>>>>>>>
> >>>>>>>>>>> If it still runs, it's using a different configuration file.
> >>>>>>>>>>>
> >>>>>>>>>>> Could you also add the following line to the rabbitmq-server.bat file?
> >>>>>>>>>>>         echo CONFIG_FILE: !RABBITMQ_CONFIG_FILE!.config
> >>>>>>>>>>> It should go in towards the end, right before the "!ERLANG_HOME!\bin\erl.exe"
> >>>>>>>>>>> line.
> >>>>>>>>>>>
> >>>>>>>>>>> That way, when you start the server manually with the .bat, we will know
> >>>>>>>>>>> which config file it's using.
> >>>>>>>>>>>
> >>>>>>>>>>> Alex
> >>>>>>>>>>>
> >>>>>>>>>>> On Tue, Aug 09, 2011 at 04:42:32PM +0530, Abhijit wrote:
> >>>>>>>>>>>
> >>>>>>>>>>>
> >>>>>>>>>>>
> >>>>>>>>>>>
> >>>>>>>>>>>
> >>>>>>>>>>>                        
> >>>>>>>>>>>> hi sir,
> >>>>>>>>>>>>
> >>>>>>>>>>>> It didn't worked as we wanted...this are the last two phrases in the log
> >>>>>>>>>>>> file of the broker.
> >>>>>>>>>>>>
> >>>>>>>>>>>>
> >>>>>>>>>>>>
> >>>>>>>>>>>>
> >>>>>>>>>>>>
> >>>>>>>>>>>>
> >>>>>>>>>>>>                          
> >>>>>>>>>>>>> =INFO REPORT==== 9-Aug-2011::16:39:52 ===
> >>>>>>>>>>>>> started TCP Listener on [::]:5692
> >>>>>>>>>>>>>
> >>>>>>>>>>>>> =INFO REPORT==== 9-Aug-2011::16:39:53 ===
> >>>>>>>>>>>>> started TCP Listener on 0.0.0.0:5692
> >>>>>>>>>>>>>
> >>>>>>>>>>>>>
> >>>>>>>>>>>>>
> >>>>>>>>>>>>>
> >>>>>>>>>>>>>
> >>>>>>>>>>>>>                            
> >>>>>>>>>>>> i copied the rabbitmq.config which you sent me but didn't worked out.
> >>>>>>>>>>>>
> >>>>>>>>>>>> Thanks and Regards,
> >>>>>>>>>>>> Abhijit
> >>>>>>>>>>>>
> >>>>>>>>>>>>
> >>>>>>>>>>>>
> >>>>>>>>>>>>
> >>>>>>>>>>>> On 8/9/2011 4:19 PM, Alexandru Scvor?ov wrote:
> >>>>>>>>>>>>
> >>>>>>>>>>>>
> >>>>>>>>>>>>
> >>>>>>>>>>>>
> >>>>>>>>>>>>
> >>>>>>>>>>>>                          
> >>>>>>>>>>>>>> Am using the same path, C:\Users\Administrator\AppData\Roaming\RabbitMQ\rabbitmq.config for including ssl in my app.
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>>                              
> >>>>>>>>>>>>> Ok.
> >>>>>>>>>>>>>
> >>>>>>>>>>>>>
> >>>>>>>>>>>>>
> >>>>>>>>>>>>>
> >>>>>>>>>>>>>
> >>>>>>>>>>>>>
> >>>>>>>>>>>>>
> >>>>>>>>>>>>>                            
> >>>>>>>>>>>>>> But the file wasn't present earlier i had created that file in order to have SSL in my app at the same location.
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>>                              
> >>>>>>>>>>>>> That's fine.
> >>>>>>>>>>>>>
> >>>>>>>>>>>>>
> >>>>>>>>>>>>>
> >>>>>>>>>>>>>
> >>>>>>>>>>>>>
> >>>>>>>>>>>>>
> >>>>>>>>>>>>>
> >>>>>>>>>>>>>                            
> >>>>>>>>>>>>>> i tried running the bat file for the rabbitmq-server that didn't help sir, do you need any part of code for inspection.
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>>                              
> >>>>>>>>>>>>> The code isn't the problem right now.  It's getting rabbit to enable
> >>>>>>>>>>>>> ssl.
> >>>>>>>>>>>>>
> >>>>>>>>>>>>> I'm attaching a rabbitmq.config.  Please try using that one.  Restart
> >>>>>>>>>>>>> the broker and the last lines in the broker log should be:
> >>>>>>>>>>>>>
> >>>>>>>>>>>>> =INFO REPORT==== 9-Aug-2011::11:44:37 ===
> >>>>>>>>>>>>> started TCP Listener on [::]:5672
> >>>>>>>>>>>>>
> >>>>>>>>>>>>> =INFO REPORT==== 9-Aug-2011::11:44:37 ===
> >>>>>>>>>>>>> started SSL Listener on 0.0.0.0:5671
> >>>>>>>>>>>>>
> >>>>>>>>>>>>> Let me know how it goes, please.
> >>>>>>>>>>>>>
> >>>>>>>>>>>>> Cheers,
> >>>>>>>>>>>>> Alex
> >>>>>>>>>>>>>
> >>>>>>>>>>>>> On Tue, Aug 09, 2011 at 04:09:42PM +0530, Abhijit wrote:
> >>>>>>>>>>>>>
> >>>>>>>>>>>>>
> >>>>>>>>>>>>>
> >>>>>>>>>>>>>
> >>>>>>>>>>>>>
> >>>>>>>>>>>>>
> >>>>>>>>>>>>>                            
> >>>>>>>>>>>>>> Hi Sir,
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>> Am using the same path, C:\Users\Administrator\AppData\Roaming\RabbitMQ\rabbitmq.config for including ssl in my app.
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>> But the file wasn't present earlier i had created that file in order to have SSL in my app at the same location.
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>> i tried running the bat file for the rabbitmq-server that didn't help sir, do you need any part of code for inspection.
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>> Thanks a lot for your time and replies.
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>> Regards,
> >>>>>>>>>>>>>> Abhijit
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>>                              
> >>>>>>>>>>>>
> >>>>>>>>>>>>                          
> >>>>>>>>>>
> >>>>>>>>>>                      
> >>>>>>>>
> >>>>>>>>                  
> >>>>>>
> >>>>>>              
> >>>>
> >>>>          
> >>      
> 

From steve at rabbitmq.com  Tue Aug  9 16:24:02 2011
From: steve at rabbitmq.com (Steve Powell)
Date: Tue, 9 Aug 2011 16:24:02 +0100
Subject: [rabbitmq-discuss] rabbitmq-stomp 2.5.1 does not respect the
	spec wrt content-type
In-Reply-To: <1D9CBD89533EE94D8295DFBFD923C23F374BEC52@PLOXCHG03.cern.ch>
References: <20110809140039.40ee.abe10f7e5afbbb3a79ce619739541149@cern.ch>
	<1DEBAA7E-CDAE-486F-8FE4-5E5484C8C448@rabbitmq.com>
	<1D9CBD89533EE94D8295DFBFD923C23F374BEC52@PLOXCHG03.cern.ch>
Message-ID: <D07B60CC-CC36-4790-9677-91792FBDD4D1@rabbitmq.com>

Lionel,

Thanks for the confirmation that you included a content-length.  Any ideas on the proper behaviour when it is omitted?

Indeed, we would never want to add incorrect information to a message.  In this case, we clearly make the wrong default assumption.

Of course, knowing what the defaults MUST be is surely better than only knowing what they SHOULD be.  Perhaps you can help to improve the specification for us here.

Steve Powell  (a hippy bunny)
----------some definitions from the SPD----------
Rigatoni n. A prime-ministerial grin.
Nigella n. The next bottle-size up from a Nebuchadnezzar.
Homily adv. Rather like a frenchman.

On 9 Aug 2011, at 15:40, Lionel Cons wrote:
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-August/014430.html
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110809/3781258e/attachment.htm>

From steve at rabbitmq.com  Tue Aug  9 16:56:46 2011
From: steve at rabbitmq.com (Steve Powell)
Date: Tue, 9 Aug 2011 16:56:46 +0100
Subject: [rabbitmq-discuss] rabbitmq-stomp 2.5.1 does not respect the
	spec wrt content-type
In-Reply-To: <D07B60CC-CC36-4790-9677-91792FBDD4D1@rabbitmq.com>
References: <20110809140039.40ee.abe10f7e5afbbb3a79ce619739541149@cern.ch>
	<1DEBAA7E-CDAE-486F-8FE4-5E5484C8C448@rabbitmq.com>
	<1D9CBD89533EE94D8295DFBFD923C23F374BEC52@PLOXCHG03.cern.ch>
	<D07B60CC-CC36-4790-9677-91792FBDD4D1@rabbitmq.com>
Message-ID: <7D4996BD-AC54-4A8E-9E66-1AFE415427A3@rabbitmq.com>

Lionel,
Further to my last note, it has just occurred to me that you are suggesting that we do not add a default content-type header at all.  Is that it?
Otherwise I don't really know what the content-type default ought to be.
Please confirm if so.  The fix ought to be relatively simple.

Steve Powell  (a happy bunny)
----------some definitions from the SPD----------
Rigatoni n. A prime-ministerial grin.
Nigella n. The next bottle-size up from a Nebuchadnezzar.
Homily adv. Rather like a frenchman.

On 9 Aug 2011, at 15:40, Lionel Cons wrote:
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-August/014430.html

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110809/5e279e79/attachment.htm>

From tonygarnockjones+rabbitmq at gmail.com  Tue Aug  9 17:06:35 2011
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Tue, 9 Aug 2011 12:06:35 -0400
Subject: [rabbitmq-discuss] rabbitmq-stomp 2.5.1 does not respect the
 spec wrt content-type
In-Reply-To: <D07B60CC-CC36-4790-9677-91792FBDD4D1@rabbitmq.com>
References: <20110809140039.40ee.abe10f7e5afbbb3a79ce619739541149@cern.ch>
	<1DEBAA7E-CDAE-486F-8FE4-5E5484C8C448@rabbitmq.com>
	<1D9CBD89533EE94D8295DFBFD923C23F374BEC52@PLOXCHG03.cern.ch>
	<D07B60CC-CC36-4790-9677-91792FBDD4D1@rabbitmq.com>
Message-ID: <CAM8fPiRbkrY0H_XUovU0KrLd6kBR-Rq09oRQOWD3yHvCq=8OYg@mail.gmail.com>

[resending because numpty here forgot to reply-to-all. Sorry!]

On 9 August 2011 11:24, Steve Powell <steve at rabbitmq.com> wrote:

> Thanks for the confirmation that you included a content-length.  Any ideas
> on the proper behaviour when it is omitted?
>

Content-length should only control the frame delimiting process, and
shouldn't make any difference to the interpretation of the content of a
message.

Indeed, we would never want to add incorrect information to a message.  In
> this case, we clearly make the wrong default assumption.
>

If the content-type is absent when the broker receives a message, it should
remain absent when the broker processes and relays on that message. The
broker should *never* synthesize a content-type header.

Of course, knowing what the defaults MUST be is surely better than only
> knowing what they SHOULD be.  Perhaps you can help to improve the
> specification for us here.
>

Perhaps in section "Header content-type" the first paragraph could be
augmented with the sentence "A message broker or other relay MUST NOT
attempt to guess a content-type if one is not specified by the original
sender of a message."

I can see where the confusion arose: there's a sentence in that section, "It
SHOULD be set to a mime type which describes the format of the body to help
the receiver of the frame interpret it's contents", which chooses the word
"set" poorly. That sentence should probably be changed to read "When
present, the content-type header SHOULD be interpreted as being a mime type
which describes the format of the body to help the receiver of the frame
interpret its contents", as well, thus avoiding the suggestion that a relay
should "set" the header on the SENDer's behalf.

Cheers,
  Tony
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110809/31c14529/attachment.htm>

From alexandru at rabbitmq.com  Tue Aug  9 17:34:40 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Tue, 9 Aug 2011 17:34:40 +0100
Subject: [rabbitmq-discuss] Inconsistent log rotation
In-Reply-To: <20110805121158.5768.abe10f7e5afbbb3a79ce619739541149@cern.ch>
References: <20110805121158.5768.abe10f7e5afbbb3a79ce619739541149@cern.ch>
Message-ID: <20110809163440.GG28785@dakota.eng.vmware.com>

Hi Lionel,

Sorry for the late reply.

> It seems that RabbitMQ log rotation happens in two different places:
>  - in the rabbitmq-server script, using cat and RABBITMQ_BACKUP_EXTENSION
>  - in the init script, using rabbitmqctl and ROTATE_SUFFIX

That's absolutely right.

> Is the use of two different variables really intended?

As you've found out, the two "log rotations" are quite different:
  1. When RabbitMQ is started up, it will always start on a new file.
  To prevent loss of information, we always append the current log file
  to the end of a backup file (whose filename is constructed by
  appending RABBITMQ_BACKUP_EXTENSION).
  2. When a user manually rotates logs, that is, when a user manually
  executes rabbitmqctl rotate_logs or via the init script, the server
  appends it's current log to the backup log file (whose name is
  constructed by appending ROTATE_SUFFIX) and starts using a
  fresh log.

They are two different processes, started in two different ways, so it's
not quite clear that they should use the same variable (though, they
could).

I'll file a bug for this; not sure if it will get resolved soon, though.

Has this behaviour caused any problems for you?

Cheers,
Alex

On Fri, Aug 05, 2011 at 12:19:29PM +0200, Lionel Cons wrote:
> It seems that RabbitMQ log rotation happens in two different places:
>  - in the rabbitmq-server script, using cat and RABBITMQ_BACKUP_EXTENSION
>  - in the init script, using rabbitmqctl and ROTATE_SUFFIX
> 
> Is the use of two different variables really intended?
> 
> If not, I would suggest to use only one (for instance
> RABBITMQ_BACKUP_EXTENSION) and to document it at
> http://www.rabbitmq.com/configure.html#define-environment-variables.
> 
> If it's really intended, it then requires even more documentation ;-)
> 
> Cheers,
> 
> Lionel
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From joevandyk at gmail.com  Tue Aug  9 17:17:35 2011
From: joevandyk at gmail.com (Joe Van Dyk)
Date: Tue, 9 Aug 2011 09:17:35 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ warrens
Message-ID: <46edc8bc-3fc5-415c-902e-c617e7133867@l11g2000prh.googlegroups.com>

The Manning RabbitMQ In Action book states:

"Now if what we really need is absolute "high availability" with no
possibilities of message loss we can build a "warren" using two
standalone RabbitMQ servers with a load balancer making them appear as
one to our applications."

A "warren" is two unconnected rabbitmq instances with a load balancer
in front -- one rabbitmq is the master and the other is the standby.
If the load balancer notices the master is down, it will send the
traffic to the standby one, using a config like:

listen rabbitmq 0.0.0.0:5680
  mode tcp
  balance roundrobin
  server master :5675 check inter 5000 rise 2 fall 3
  server standby :5675 backup check inter 5000 rise 2 fall 3


I don't get how this prevents message loss.  If there's messages in
the master's queue and it goes down (hard drive explodes), those
messages are lost, right?

From michael.justin at gmx.net  Tue Aug  9 17:55:18 2011
From: michael.justin at gmx.net (Michael Justin)
Date: Tue, 09 Aug 2011 18:55:18 +0200
Subject: [rabbitmq-discuss] After force-closing STOMP connection in
 management interface client still can send messages
Message-ID: <j1ropp$p17$1@dough.gmane.org>

Tested with RabbitMQ 2.5.1:

Problem:
After force-closing STOMP connection in management interface clients 
still can send messages

Steps to reproduce:
* open a STOMP 1.0 client connection and continuously send messages to 
the broker
* in the Connections page of the management interface, click on the 
connection (peer address)
* click on the "Force Close" button and choose "OK" in the confirmation 
dialog

Expected result:
* the server should close the socket, so that the client encounters a 
socket error (connection reset by peer, or ) and can not continue sending

Actual result:
* the server still accepts incoming messages

Problem:
* the client assumes that the messages have been delivered successfully 
to the server.

But the messages are no longer counted in the "Queued messages" display 
on the Overview page - it looks like they are actually lost.

Maybe this is related to a STOMP / server configuration setting?

Regards
Michael Justin


From david_syer at hotmail.com  Tue Aug  9 18:10:48 2011
From: david_syer at hotmail.com (Dave Syer)
Date: Tue, 9 Aug 2011 10:10:48 -0700 (PDT)
Subject: [rabbitmq-discuss] java.io.IOException because of Parameters
In-Reply-To: <CAMXQGZoEGU4ceO43OoPCNJcZ0wncN6CnZi7hq6NDCNQqbbDm4A@mail.gmail.com>
References: <CAMXQGZoEGU4ceO43OoPCNJcZ0wncN6CnZi7hq6NDCNQqbbDm4A@mail.gmail.com>
Message-ID: <c47a7170-0f1c-4cea-8c8e-9eb7d40b9cd9@i15g2000vbk.googlegroups.com>

On Aug 8, 4:34?pm, "Brian ." <rutherford... at gmail.com> wrote:
> I get an error (pated below) when I try to configure spring integration with
> rabbitmq. It says "parameters for queue 'translate.queue' in vhost '/' not
> equivalent" is the reason.

The error message is a standard one from the broker telling you that
you have declared a queue with the same name twice but different
parameters (e.g. auto-delete).  If you declared all your queues using
Spring then it looks like you just changed the config between client
startups, and didn't reset the broker.  Or maybe someone else created
the queue for you and you need to sync up the parameters with them?
You can work around it by returning your config to the original
values, or simply deleting the queue and starting again.

From rutherford218 at gmail.com  Tue Aug  9 20:45:39 2011
From: rutherford218 at gmail.com (Brian .)
Date: Tue, 9 Aug 2011 14:45:39 -0500
Subject: [rabbitmq-discuss] java.io.IOException because of Parameters
In-Reply-To: <c47a7170-0f1c-4cea-8c8e-9eb7d40b9cd9@i15g2000vbk.googlegroups.com>
References: <CAMXQGZoEGU4ceO43OoPCNJcZ0wncN6CnZi7hq6NDCNQqbbDm4A@mail.gmail.com>
	<c47a7170-0f1c-4cea-8c8e-9eb7d40b9cd9@i15g2000vbk.googlegroups.com>
Message-ID: <CAMXQGZrTk2eyRSFQWftRbj=dqooS8dZPiyFq24nsLkXO0kAQ3g@mail.gmail.com>

Dave,

Thanks for the reply. But I do not have any duplicate queues. I deleted all
of the queues and started again. Also thought it might be an issue with the
web interface not deleting correctly so I uninstalled the instance and
reinstalled. When I start from a fresh queue the error still persists. I add
no parameters, just make it durable and save (basically the web interface
defaults). Does the java amqp client require some parameters? Are the web
interface defaults not correct? Any help would be appreciated.

On Tue, Aug 9, 2011 at 12:10 PM, Dave Syer <david_syer at hotmail.com> wrote:

> On Aug 8, 4:34 pm, "Brian ." <rutherford... at gmail.com> wrote:
> > I get an error (pated below) when I try to configure spring integration
> with
> > rabbitmq. It says "parameters for queue 'translate.queue' in vhost '/'
> not
> > equivalent" is the reason.
>
> The error message is a standard one from the broker telling you that
> you have declared a queue with the same name twice but different
> parameters (e.g. auto-delete).  If you declared all your queues using
> Spring then it looks like you just changed the config between client
> startups, and didn't reset the broker.  Or maybe someone else created
> the queue for you and you need to sync up the parameters with them?
> You can work around it by returning your config to the original
> values, or simply deleting the queue and starting again.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110809/77f50ec5/attachment.htm>

From david_syer at hotmail.com  Tue Aug  9 21:41:21 2011
From: david_syer at hotmail.com (Dave Syer)
Date: Tue, 9 Aug 2011 13:41:21 -0700 (PDT)
Subject: [rabbitmq-discuss] java.io.IOException because of Parameters
In-Reply-To: <CAMXQGZrTk2eyRSFQWftRbj=dqooS8dZPiyFq24nsLkXO0kAQ3g@mail.gmail.com>
References: <CAMXQGZoEGU4ceO43OoPCNJcZ0wncN6CnZi7hq6NDCNQqbbDm4A@mail.gmail.com>
	<c47a7170-0f1c-4cea-8c8e-9eb7d40b9cd9@i15g2000vbk.googlegroups.com>
	<CAMXQGZrTk2eyRSFQWftRbj=dqooS8dZPiyFq24nsLkXO0kAQ3g@mail.gmail.com>
Message-ID: <10449bbf-0988-44ab-8a20-ccc42753ae40@l37g2000yqd.googlegroups.com>

On Aug 9, 8:45?pm, "Brian ." <rutherford... at gmail.com> wrote:
> Thanks for the reply. But I do not have any duplicate queues. I deleted all
> of the queues and started again. Also thought it might be an issue with the
> web interface not deleting correctly so I uninstalled the instance and
> reinstalled. When I start from a fresh queue the error still persists. I add
> no parameters, just make it durable and save (basically the web interface
> defaults). Does the java amqp client require some parameters? Are the web
> interface defaults not correct? Any help would be appreciated.

I didn't say you had a duplicate queue.  You have two declarations of
the same queue with conflicting parameters.  From what you said, it
looks like one declaration is done by you manually in "the web
interface" (I don't know what that is), and the other is possibly done
by Spring AMQP via RabbitAdmin (I'm guessing here too).  You should
probably just pick one of those and stick to it, but if you want them
both to work you have to just use the same parameters in your Spring
config as you did for the manual declaration (probably only you know
what they are).  Assuming I am right: to switch off the Spring auto-
declaration, you need to set auto-startup=false on the RabbitAdmin; to
switch off the other declaration you just have to not do it.

From alexis at rabbitmq.com  Tue Aug  9 22:52:23 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Tue, 9 Aug 2011 22:52:23 +0100
Subject: [rabbitmq-discuss] RabbitMQ warrens
In-Reply-To: <46edc8bc-3fc5-415c-902e-c617e7133867@l11g2000prh.googlegroups.com>
References: <46edc8bc-3fc5-415c-902e-c617e7133867@l11g2000prh.googlegroups.com>
Message-ID: <CACOPnvc3Sju9yL=mWXHOXcm9iYMqs1gjqrmYUw0aNC0-dLGhUQ@mail.gmail.com>

Joe,

The idea is to send two (or more) copies of the whole data stream to
the brokers, such that each copy shares the fate of a broker.
Therefore the death of a broker does not imply the death of a copy of
the stream.

But hang in there because "active/active" HA is looming and this will
go further than the 'warren' approach..

alexis



On Tue, Aug 9, 2011 at 5:17 PM, Joe Van Dyk <joevandyk at gmail.com> wrote:
> The Manning RabbitMQ In Action book states:
>
> "Now if what we really need is absolute "high availability" with no
> possibilities of message loss we can build a "warren" using two
> standalone RabbitMQ servers with a load balancer making them appear as
> one to our applications."
>
> A "warren" is two unconnected rabbitmq instances with a load balancer
> in front -- one rabbitmq is the master and the other is the standby.
> If the load balancer notices the master is down, it will send the
> traffic to the standby one, using a config like:
>
> listen rabbitmq 0.0.0.0:5680
> ?mode tcp
> ?balance roundrobin
> ?server master :5675 check inter 5000 rise 2 fall 3
> ?server standby :5675 backup check inter 5000 rise 2 fall 3
>
>
> I don't get how this prevents message loss. ?If there's messages in
> the master's queue and it goes down (hard drive explodes), those
> messages are lost, right?
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From joevandyk at gmail.com  Tue Aug  9 22:54:17 2011
From: joevandyk at gmail.com (Joe Van Dyk)
Date: Tue, 9 Aug 2011 14:54:17 -0700
Subject: [rabbitmq-discuss] RabbitMQ warrens
In-Reply-To: <CACOPnvc3Sju9yL=mWXHOXcm9iYMqs1gjqrmYUw0aNC0-dLGhUQ@mail.gmail.com>
References: <46edc8bc-3fc5-415c-902e-c617e7133867@l11g2000prh.googlegroups.com>
	<CACOPnvc3Sju9yL=mWXHOXcm9iYMqs1gjqrmYUw0aNC0-dLGhUQ@mail.gmail.com>
Message-ID: <CACfv+p+t1kf7O0-DzjS+ca7R+WBNh8RXOnPEe7_m+D0NKb6FqQ@mail.gmail.com>

Hm -- that seems like it would work -- but the "RabbitMQ In Action"
seems to indicate that haproxy will only send traffic to the standby
if the master isn't up.

Do you have any details/links about the active/active HA approach?

On Tue, Aug 9, 2011 at 2:52 PM, Alexis Richardson <alexis at rabbitmq.com> wrote:
> Joe,
>
> The idea is to send two (or more) copies of the whole data stream to
> the brokers, such that each copy shares the fate of a broker.
> Therefore the death of a broker does not imply the death of a copy of
> the stream.
>
> But hang in there because "active/active" HA is looming and this will
> go further than the 'warren' approach..
>
> alexis
>
>
>
> On Tue, Aug 9, 2011 at 5:17 PM, Joe Van Dyk <joevandyk at gmail.com> wrote:
>> The Manning RabbitMQ In Action book states:
>>
>> "Now if what we really need is absolute "high availability" with no
>> possibilities of message loss we can build a "warren" using two
>> standalone RabbitMQ servers with a load balancer making them appear as
>> one to our applications."
>>
>> A "warren" is two unconnected rabbitmq instances with a load balancer
>> in front -- one rabbitmq is the master and the other is the standby.
>> If the load balancer notices the master is down, it will send the
>> traffic to the standby one, using a config like:
>>
>> listen rabbitmq 0.0.0.0:5680
>> ?mode tcp
>> ?balance roundrobin
>> ?server master :5675 check inter 5000 rise 2 fall 3
>> ?server standby :5675 backup check inter 5000 rise 2 fall 3
>>
>>
>> I don't get how this prevents message loss. ?If there's messages in
>> the master's queue and it goes down (hard drive explodes), those
>> messages are lost, right?
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>

From alexis at rabbitmq.com  Tue Aug  9 22:57:07 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Tue, 9 Aug 2011 22:57:07 +0100
Subject: [rabbitmq-discuss] RabbitMQ warrens
In-Reply-To: <CACfv+p+t1kf7O0-DzjS+ca7R+WBNh8RXOnPEe7_m+D0NKb6FqQ@mail.gmail.com>
References: <46edc8bc-3fc5-415c-902e-c617e7133867@l11g2000prh.googlegroups.com>
	<CACOPnvc3Sju9yL=mWXHOXcm9iYMqs1gjqrmYUw0aNC0-dLGhUQ@mail.gmail.com>
	<CACfv+p+t1kf7O0-DzjS+ca7R+WBNh8RXOnPEe7_m+D0NKb6FqQ@mail.gmail.com>
Message-ID: <CACOPnvcYgHHqzCntP-n3HQy-wyUuUfhfe-a6ycLGr74oqRkU3Q@mail.gmail.com>

Joe

I can't comment on the text of the book since it's not in front of me,
but have bcc'd the authors.

Re HA, I'll send you some draft docs offline.  It's imminent.

alexis


On Tue, Aug 9, 2011 at 10:54 PM, Joe Van Dyk <joevandyk at gmail.com> wrote:
> Hm -- that seems like it would work -- but the "RabbitMQ In Action"
> seems to indicate that haproxy will only send traffic to the standby
> if the master isn't up.
>
> Do you have any details/links about the active/active HA approach?
>
> On Tue, Aug 9, 2011 at 2:52 PM, Alexis Richardson <alexis at rabbitmq.com> wrote:
>> Joe,
>>
>> The idea is to send two (or more) copies of the whole data stream to
>> the brokers, such that each copy shares the fate of a broker.
>> Therefore the death of a broker does not imply the death of a copy of
>> the stream.
>>
>> But hang in there because "active/active" HA is looming and this will
>> go further than the 'warren' approach..
>>
>> alexis
>>
>>
>>
>> On Tue, Aug 9, 2011 at 5:17 PM, Joe Van Dyk <joevandyk at gmail.com> wrote:
>>> The Manning RabbitMQ In Action book states:
>>>
>>> "Now if what we really need is absolute "high availability" with no
>>> possibilities of message loss we can build a "warren" using two
>>> standalone RabbitMQ servers with a load balancer making them appear as
>>> one to our applications."
>>>
>>> A "warren" is two unconnected rabbitmq instances with a load balancer
>>> in front -- one rabbitmq is the master and the other is the standby.
>>> If the load balancer notices the master is down, it will send the
>>> traffic to the standby one, using a config like:
>>>
>>> listen rabbitmq 0.0.0.0:5680
>>> ?mode tcp
>>> ?balance roundrobin
>>> ?server master :5675 check inter 5000 rise 2 fall 3
>>> ?server standby :5675 backup check inter 5000 rise 2 fall 3
>>>
>>>
>>> I don't get how this prevents message loss. ?If there's messages in
>>> the master's queue and it goes down (hard drive explodes), those
>>> messages are lost, right?
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>
>

From jasonjwwilliams at gmail.com  Tue Aug  9 23:02:57 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Tue, 9 Aug 2011 16:02:57 -0600
Subject: [rabbitmq-discuss] RabbitMQ warrens
In-Reply-To: <46edc8bc-3fc5-415c-902e-c617e7133867@l11g2000prh.googlegroups.com>
References: <46edc8bc-3fc5-415c-902e-c617e7133867@l11g2000prh.googlegroups.com>
Message-ID: <CAHZAEpc=BR0kGwNGzBn=9nMPn7V4UBqdo5fF15nqEyxU49pPCQ@mail.gmail.com>

Hi Joe,


> I don't get how this prevents message loss. ?If there's messages in
> the master's queue and it goes down (hard drive explodes), those
> messages are lost, right?

I'm the guy who wrote that. It guarantees messages won't be lost from
the point of view of the software. As is normal whether you're running
a database, mail server, or anything else, protect your hard drives
with RAID at the hardware level to keep from a single drive failure
causing message loss.

-J

From joevandyk at gmail.com  Tue Aug  9 23:09:48 2011
From: joevandyk at gmail.com (Joe Van Dyk)
Date: Tue, 9 Aug 2011 15:09:48 -0700
Subject: [rabbitmq-discuss] RabbitMQ warrens
In-Reply-To: <CAHZAEpc=BR0kGwNGzBn=9nMPn7V4UBqdo5fF15nqEyxU49pPCQ@mail.gmail.com>
References: <46edc8bc-3fc5-415c-902e-c617e7133867@l11g2000prh.googlegroups.com>
	<CAHZAEpc=BR0kGwNGzBn=9nMPn7V4UBqdo5fF15nqEyxU49pPCQ@mail.gmail.com>
Message-ID: <CACfv+pLT1HUPbX=HUuw4_eO0oqm0OQpXyF4c=yiY9sebc89d2Q@mail.gmail.com>

On Tue, Aug 9, 2011 at 3:02 PM, Jason J. W. Williams
<jasonjwwilliams at gmail.com> wrote:
> Hi Joe,
>
>
>> I don't get how this prevents message loss. ?If there's messages in
>> the master's queue and it goes down (hard drive explodes), those
>> messages are lost, right?
>
> I'm the guy who wrote that. It guarantees messages won't be lost from
> the point of view of the software. As is normal whether you're running
> a database, mail server, or anything else, protect your hard drives
> with RAID at the hardware level to keep from a single drive failure
> causing message loss.

Hm, ok.  I'm running on EC2 where instances can disappear instantly,
so ideally stuff would be mirrored across multiple instances.  Perhaps
the Active/Active HA stuff Alexis mentioned will help this.

From jasonjwwilliams at gmail.com  Tue Aug  9 23:12:18 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Tue, 9 Aug 2011 16:12:18 -0600
Subject: [rabbitmq-discuss] RabbitMQ warrens
In-Reply-To: <CACfv+pLT1HUPbX=HUuw4_eO0oqm0OQpXyF4c=yiY9sebc89d2Q@mail.gmail.com>
References: <46edc8bc-3fc5-415c-902e-c617e7133867@l11g2000prh.googlegroups.com>
	<CAHZAEpc=BR0kGwNGzBn=9nMPn7V4UBqdo5fF15nqEyxU49pPCQ@mail.gmail.com>
	<CACfv+pLT1HUPbX=HUuw4_eO0oqm0OQpXyF4c=yiY9sebc89d2Q@mail.gmail.com>
Message-ID: <CAHZAEpc+egp6GfFjJUcaSC=bHg21ArFNE1zY7B=wfv=sfBPVpw@mail.gmail.com>

Hi Joe,

Yes the queue mirroring that's coming soon in the enhanced HA will be
what you're looking for then. That will give you "message RAID 1"  (my
analogy not Rabbit's) inside the broker. As soon as it's released
we'll be updating the book with a section on it.

-J

On Tue, Aug 9, 2011 at 4:09 PM, Joe Van Dyk <joevandyk at gmail.com> wrote:
> On Tue, Aug 9, 2011 at 3:02 PM, Jason J. W. Williams
> <jasonjwwilliams at gmail.com> wrote:
>> Hi Joe,
>>
>>
>>> I don't get how this prevents message loss. ?If there's messages in
>>> the master's queue and it goes down (hard drive explodes), those
>>> messages are lost, right?
>>
>> I'm the guy who wrote that. It guarantees messages won't be lost from
>> the point of view of the software. As is normal whether you're running
>> a database, mail server, or anything else, protect your hard drives
>> with RAID at the hardware level to keep from a single drive failure
>> causing message loss.
>
> Hm, ok. ?I'm running on EC2 where instances can disappear instantly,
> so ideally stuff would be mirrored across multiple instances. ?Perhaps
> the Active/Active HA stuff Alexis mentioned will help this.
>

From lionel.cons at cern.ch  Wed Aug 10 06:36:36 2011
From: lionel.cons at cern.ch (Lionel Cons)
Date: Wed, 10 Aug 2011 07:36:36 +0200
Subject: [rabbitmq-discuss] rabbitmq-stomp 2.5.1 does not respect the
	spec wrt content-type
In-Reply-To: <7D4996BD-AC54-4A8E-9E66-1AFE415427A3@rabbitmq.com>
References: <20110809140039.40ee.abe10f7e5afbbb3a79ce619739541149@cern.ch>
	<1DEBAA7E-CDAE-486F-8FE4-5E5484C8C448@rabbitmq.com>
	<1D9CBD89533EE94D8295DFBFD923C23F374BEC52@PLOXCHG03.cern.ch>
	<D07B60CC-CC36-4790-9677-91792FBDD4D1@rabbitmq.com>
	<7D4996BD-AC54-4A8E-9E66-1AFE415427A3@rabbitmq.com>
Message-ID: <20034.6372.247133.247487@mail.cern.ch>

Steve Powell writes:
 > Thanks for the confirmation that you included a content-length. Any
 > ideas on the proper behaviour when it is omitted?

End the frame on the first NULL.

For the record, Hiram's reply on the stomp-spec list is very clear:
http://groups.google.com/group/stomp-spec/browse_thread/thread/28b66d1fe71dbb4c

 > Further to my last note, it has just occurred to me that you are
 > suggesting that we do not add a default content-type header at
 > all. Is that it?

Correct: never add or modify a header that could be wrong.

Cheers,

Lionel

From lionel.cons at cern.ch  Wed Aug 10 06:58:47 2011
From: lionel.cons at cern.ch (Lionel Cons)
Date: Wed, 10 Aug 2011 07:58:47 +0200
Subject: [rabbitmq-discuss] Inconsistent log rotation
In-Reply-To: <20110809163440.GG28785@dakota.eng.vmware.com>
References: <20110805121158.5768.abe10f7e5afbbb3a79ce619739541149@cern.ch>
	<20110809163440.GG28785@dakota.eng.vmware.com>
Message-ID: <20034.7703.256826.616563@mail.cern.ch>

Alexandru Scvorcov writes:
 >   1. When RabbitMQ is started up, it will always start on a new file.
 >   To prevent loss of information, we always append the current log file
 >   to the end of a backup file (whose filename is constructed by
 >   appending RABBITMQ_BACKUP_EXTENSION).

RABBITMQ_BACKUP_EXTENSION defaults to ".1" so log information will be
lost anyway after a subsequent restart.

 >   2. When a user manually rotates logs, that is, when a user manually
 >   executes rabbitmqctl rotate_logs or via the init script, the server
 >   appends it's current log to the backup log file (whose name is
 >   constructed by appending ROTATE_SUFFIX) and starts using a
 >   fresh log.
 
AFAIK, ROTATE_SUFFIX defaults to "" so previous log information is
lost (unless copied outside of the init script).

 > Has this behaviour caused any problems for you?

Yes: multiple restarts wiped log information.

IMHO, rabbitmq should not rotate logs on startup but rather, like most
daemons, simply append. The log rotation policy should be external to
rabbitmq (logrotate is fine for this) and rabbitmq should cooperate by
providing an easy to re-open the logs. This is in line with
http://hg.rabbitmq.com/rabbitmq-server/annotate/e4bf0f9afb46/packaging/debs/Debian/debian/rabbitmq-server.logrotate

Cheers,

Lionel

From matthias at rabbitmq.com  Wed Aug 10 07:05:34 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 10 Aug 2011 07:05:34 +0100
Subject: [rabbitmq-discuss] Inconsistent log rotation
In-Reply-To: <20034.7703.256826.616563@mail.cern.ch>
References: <20110805121158.5768.abe10f7e5afbbb3a79ce619739541149@cern.ch>	<20110809163440.GG28785@dakota.eng.vmware.com>
	<20034.7703.256826.616563@mail.cern.ch>
Message-ID: <4E421FAE.8020905@rabbitmq.com>

Lionel,

On 10/08/11 06:58, Lionel Cons wrote:
> Alexandru Scvorcov writes:
>   >    1. When RabbitMQ is started up, it will always start on a new file.
>   >    To prevent loss of information, we always append the current log file
>   >    to the end of a backup file (whose filename is constructed by
>   >    appending RABBITMQ_BACKUP_EXTENSION).
>
> RABBITMQ_BACKUP_EXTENSION defaults to ".1" so log information will be
> lost anyway after a subsequent restart.

As Alexandru said, we *append* the log file to the backup extension. So 
if you bounce rabbit multiple times the .1 file will just keep growing. 
No log information is lost.

>   >    2. When a user manually rotates logs, that is, when a user manually
>   >    executes rabbitmqctl rotate_logs or via the init script, the server
>   >    appends it's current log to the backup log file (whose name is
>   >    constructed by appending ROTATE_SUFFIX) and starts using a
>   >    fresh log.
>
> AFAIK, ROTATE_SUFFIX defaults to "" so previous log information is
> lost (unless copied outside of the init script).

Right. That is intentional. The idea is that this allows you to work 
with existing log rotation apps (e.g. logrotate) which will mv/rename 
the main file and then simply invoke 'rabbitmqctl rotate_logs' to 
re-open the current log file.

> IMHO, rabbitmq should not rotate logs on startup but rather, like most
> daemons, simply append.

That is what we do; the current log gets *appended* to the .1 file.

> The log rotation policy should be external to rabbitmq (logrotate is
> fine for this) and rabbitmq should cooperate by providing an easy to
> re-open the logs.

Likewise.


Regards,

Matthias.

From lionel.cons at cern.ch  Wed Aug 10 07:25:00 2011
From: lionel.cons at cern.ch (Lionel Cons)
Date: Wed, 10 Aug 2011 08:25:00 +0200
Subject: [rabbitmq-discuss] Inconsistent log rotation
In-Reply-To: <4E421FAE.8020905@rabbitmq.com>
References: <20110805121158.5768.abe10f7e5afbbb3a79ce619739541149@cern.ch>
	<20110809163440.GG28785@dakota.eng.vmware.com>
	<20034.7703.256826.616563@mail.cern.ch>
	<4E421FAE.8020905@rabbitmq.com>
Message-ID: <20034.9276.935623.500325@mail.cern.ch>

Matthias Radestock writes:
 > As Alexandru said, we *append* the log file to the backup extension. So 
 > if you bounce rabbit multiple times the .1 file will just keep growing. 
 > No log information is lost.

You are correct, I missed the ">>"...

 > > IMHO, rabbitmq should not rotate logs on startup but rather, like most
 > > daemons, simply append.
 > 
 > That is what we do; the current log gets *appended* to the .1 file.

Most daemons only use one file (per type of log) and append to it so
logrotate's job is easy: just watch one file and act accordingly.

RabbitMQ uses two files (e.g. rabbitmq.log and rabbitmq.log.1) and
both can grow (= could become too large) so logrotate should watch and
rotate both files. This is unusual.

Cheers,

Lionel

From matthias at rabbitmq.com  Wed Aug 10 07:25:11 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 10 Aug 2011 07:25:11 +0100
Subject: [rabbitmq-discuss] Inconsistent log rotation
In-Reply-To: <4E421FAE.8020905@rabbitmq.com>
References: <20110805121158.5768.abe10f7e5afbbb3a79ce619739541149@cern.ch>	<20110809163440.GG28785@dakota.eng.vmware.com>	<20034.7703.256826.616563@mail.cern.ch>
	<4E421FAE.8020905@rabbitmq.com>
Message-ID: <4E422447.6070202@rabbitmq.com>

Lionel,

On 10/08/11 07:05, Matthias Radestock wrote:
> On 10/08/11 06:58, Lionel Cons wrote:
>> IMHO, rabbitmq should not rotate logs on startup but rather, like most
>> daemons, simply append.
>
> That is what we do; the current log gets *appended* to the .1 file.

...and in case you are wondering why rabbit doesn't simply continue 
using (and appending to) the current log file... that's because 
Erlang/OTP does not allow you to open the log file in append mode :(

Regards,

Matthias.

From abhijit.sinha at kiprosh.com  Wed Aug 10 08:10:19 2011
From: abhijit.sinha at kiprosh.com (Abhijit)
Date: Wed, 10 Aug 2011 12:40:19 +0530
Subject: [rabbitmq-discuss] facing issues with the SSL implementations
 with RabbitMQ + Windows + .Net
In-Reply-To: <20110809150226.GF28785@dakota.eng.vmware.com>
References: <20110809115033.GF3214@dakota.eng.vmware.com>
	<4E412192.5080107@kiprosh.com>
	<20110809120926.GA28785@dakota.eng.vmware.com>
	<4E412A3B.60602@kiprosh.com>
	<20110809124819.GB28785@dakota.eng.vmware.com>
	<4E412D87.2080806@kiprosh.com>
	<20110809140658.GC28785@dakota.eng.vmware.com>
	<4E414086.7010706@kiprosh.com>
	<20110809142807.GE28785@dakota.eng.vmware.com>
	<4E4146E5.4030101@kiprosh.com>
	<20110809150226.GF28785@dakota.eng.vmware.com>
Message-ID: <4E422EDB.60506@kiprosh.com>

Hi sir,

i gave it a try and checked log files and found these errors:

> =ERROR REPORT==== 10-Aug-2011::12:24:36 ===
> SSL: certify_certificate: ./ssl_handshake.erl:566:Fatal error: unknown ca
>
> =ERROR REPORT==== 10-Aug-2011::12:24:36 ===
> error on TCP connection <0.236.0>:{ssl_upgrade_error,"unknown ca"}
>
> =INFO REPORT==== 10-Aug-2011::12:24:36 ===
> closing TCP connection <0.236.0>

i checked for the trusted root certificates and found the certificates i 
made in this section.

Still am getting these errors sir,

> base {System.Runtime.InteropServices.ExternalException} = {"The
> certificate chain was issued by an authority that is not trusted"}

Any Suggestions.

Thanks and Regards,
Abhijit






On 8/9/2011 8:32 PM, Alexandru Scvor?ov wrote:
> Is there anything in the server logs other than an abrupt connection
> termination?  If not, then it's strictly a client error.  I'd check that
> the CA certificate is indeed in the Trusted Root Certificate Authorities store
> and then I'd play around with setting the SslPolicyErrors.
>
> Other than that, I don't have any suggestions.  I've just set up
> something similar (RabbitMQ with SSL on Win2008 with .NET 3.5, OpenSSL
> 1.0 and RabbitMQ .NET on the same machine) and it works fine, so there's
> not intrinsic reason why it wouldn't work.
>
> Cheers,
> Alex
>
> On Tue, Aug 09, 2011 at 08:10:37PM +0530, Abhijit wrote:
>    
>> hi sir ,
>>
>> i have added all those certificates as trusted, still am getting this
>>
>>      
>>> base {System.Runtime.InteropServices.ExternalException} = {"The
>>> certificate chain was issued by an authority that is not trusted"}
>>>        
>> thanks a lot for the replies let me know if any suggestions.
>>
>> Thanks and Regards,
>> Abhijit
>>
>>
>> On 8/9/2011 7:58 PM, Alexandru Scvor?ov wrote:
>>      
>>>> http://www.rabbitmq.com/ssl.html#trust-dotNET,
>>>> i have executed them but all they do is opens the certmanager window.
>>>>
>>>>          
>>> There are two versions of the certmgr program.  One of the is shipped
>>> with Windows and is the graphical version you use.  The other is shipped
>>> with the Windows SDK and is a command line version.
>>>
>>> You can use the graphical version: start it up, click Import, select
>>> testca/cacert.cer, click Next, *IMPORTANT* select the Trusted Root
>>> Certification Authorities store, click Next... until it's imported.
>>>
>>>
>>>        
>>>>> [{amqp-0-9://localhost:5671}] =
>>>>> {System.Security.Authentication.AuthenticationException: A call to
>>>>> SSPI failed, see inner exception. --->
>>>>> System.ComponentModel.Win32Exception: The message received was
>>>>> unexpected or badly formatted
>>>>>
>>>>>            
>>> The error you're getting doesn't sound like it's because of this, but
>>> you'll need to import the certificate anyway.  Maybe it will help.
>>>
>>> Cheers,
>>> Alex
>>>
>>> On Tue, Aug 09, 2011 at 07:43:26PM +0530, Abhijit wrote:
>>>
>>>        
>>>> hello sir,
>>>>
>>>>
>>>>          
>>>>> [{amqp-0-9://localhost:5671}] =
>>>>> {System.Security.Authentication.AuthenticationException: A call to
>>>>> SSPI failed, see inner exception. --->
>>>>> System.ComponentModel.Win32Exception: The message received was
>>>>> unexpected or badly formatted
>>>>>
>>>>>            
>>>> i got this error after changing it to pem sir, and also i created the
>>>> certificates properly as per the rabbitmq ssl steps but i haven't able
>>>> to understand this steps mentioned:
>>>> http://www.rabbitmq.com/ssl.html#trust-dotNET,
>>>> i have executed them but all they do is opens the certmanager window.
>>>>
>>>> Any suggestions.
>>>>
>>>> Thanks and Regards,
>>>> Abhijit
>>>>
>>>>
>>>> On 8/9/2011 7:36 PM, Alexandru Scvor?ov wrote:
>>>>
>>>>          
>>>>> I managed to reproduce your error.
>>>>>
>>>>> Solution: do not use the .cer file in the broker config; use the .pem
>>>>> file.  For some reason, rather than complaining that it can't read the
>>>>> CA certificate, Erlang just silently ignores that and throws an "unknown
>>>>> CA" error.  Hurray!
>>>>>
>>>>> So, change
>>>>>      {cacertfile,"C:\\testca\\cacert.cer"}
>>>>> with
>>>>>      {cacertfile,"C:\\testca\\cacert.pem"}
>>>>>
>>>>> Please let me know if this helps.
>>>>>
>>>>> Cheers,
>>>>> Alex
>>>>>
>>>>> On Tue, Aug 09, 2011 at 06:22:23PM +0530, Abhijit wrote:
>>>>>
>>>>>
>>>>>            
>>>>>> ya sir that was set true, i would go back and look at my certification
>>>>>> creation steps and find out whether i did everything properly.
>>>>>>
>>>>>> and would let you know once that i done.
>>>>>>
>>>>>> Thanks and Regards,
>>>>>> Abhijit
>>>>>>
>>>>>> On 8/9/2011 6:18 PM, Alexandru Scvor?ov wrote:
>>>>>>
>>>>>>
>>>>>>              
>>>>>>>> Am basically getting this error, i tried debugging and solved most of
>>>>>>>> the problems but still getting this:
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>                  
>>>>>>> Oh, great. My guess about the really long error was that you needed some
>>>>>>> clients to connect without providing certificates, but
>>>>>>> fail_if_no_peer_cert was set to true in the config file.  Was that
>>>>>>> right?
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>                
>>>>>>>>> [{amqp-0-9://localhost:5671}] =
>>>>>>>>> {System.Security.Authentication.AuthenticationException: A call to
>>>>>>>>> SSPI failed, see inner exception. --->
>>>>>>>>> System.ComponentModel.Win32Exception: The certificate chain was issued
>>>>>>>>> by an authority that is not trusted
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>                    
>>>>>>> I haven't seen that before.  Did you follow the steps in our SSL guide
>>>>>>> to generate the certificate (in particular, were the client certificates
>>>>>>> signed by the CA set in the broker)?
>>>>>>>
>>>>>>> Alex
>>>>>>>
>>>>>>> On Tue, Aug 09, 2011 at 06:08:19PM +0530, Abhijit wrote:
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>                
>>>>>>>> hi sir,
>>>>>>>>
>>>>>>>> Am basically getting this error, i tried debugging and solved most of
>>>>>>>> the problems but still getting this:
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>                  
>>>>>>>>> [{amqp-0-9://localhost:5671}] =
>>>>>>>>> {System.Security.Authentication.AuthenticationException: A call to
>>>>>>>>> SSPI failed, see inner exception. --->
>>>>>>>>> System.ComponentModel.Win32Exception: The certificate chain was issued
>>>>>>>>> by an authority that is not trusted
>>>>>>>>>        --- End of inner exception stack trace -...
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>                    
>>>>>>>> Thanks and Regards,
>>>>>>>> Abhijit
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>> On 8/9/2011 5:39 PM, Alexandru Scvor?ov wrote:
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>                  
>>>>>>>>>> i would go ahead for now, if any queries i would again seek your help.
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>                      
>>>>>>>>> Excellent.  Don't hesitate to ask us any more questions.
>>>>>>>>>
>>>>>>>>> Also, in the future, could you please make sure to CC the mailing list
>>>>>>>>> when replying?
>>>>>>>>>
>>>>>>>>> Cheers,
>>>>>>>>> Alex
>>>>>>>>>
>>>>>>>>> On Tue, Aug 09, 2011 at 05:31:22PM +0530, Abhijit wrote:
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>                    
>>>>>>>>>> hi sir,
>>>>>>>>>>
>>>>>>>>>> finally got this:
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>                      
>>>>>>>>>>> =INFO REPORT==== 9-Aug-2011::17:28:33 ===
>>>>>>>>>>> started TCP Listener on 0.0.0.0:5672
>>>>>>>>>>>
>>>>>>>>>>> =INFO REPORT==== 9-Aug-2011::17:28:33 ===
>>>>>>>>>>> started SSL Listener on 0.0.0.0:5671
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>                        
>>>>>>>>>> your this step
>>>>>>>>>>
>>>>>>>>>> Could you copy the config file to "...\AppData\Roaming\RabbitMQ.config"
>>>>>>>>>> and try again
>>>>>>>>>>
>>>>>>>>>> helped...
>>>>>>>>>>
>>>>>>>>>> i would go ahead for now, if any queries i would again seek your help.
>>>>>>>>>>
>>>>>>>>>> Thanks and Regards,
>>>>>>>>>> Abhijit
>>>>>>>>>>
>>>>>>>>>> On 8/9/2011 5:20 PM, Alexandru Scvor?ov wrote:
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>                      
>>>>>>>>>>> That's a bit odd.  I'm not sure how that can happen.  It looks like you
>>>>>>>>>>> somehow set the RABBITMQ_CONFIG_FILE variable at some point.
>>>>>>>>>>>
>>>>>>>>>>> The file is normally in:
>>>>>>>>>>> ...\AppData\Roaming\RabbitMQ\rabbitmq.config
>>>>>>>>>>> but your system is looking for it in:
>>>>>>>>>>> ...\AppData\Roaming\RabbitMQ.config
>>>>>>>>>>>
>>>>>>>>>>> Could you copy the config file to "...\AppData\Roaming\RabbitMQ.config"
>>>>>>>>>>> and try again?  Alternatively, unset the RABBITMQ_CONFIG_FILE variable
>>>>>>>>>>> and try again without copying the file.
>>>>>>>>>>>
>>>>>>>>>>> Cheers,
>>>>>>>>>>> Alex
>>>>>>>>>>>
>>>>>>>>>>> On Tue, Aug 09, 2011 at 05:02:04PM +0530, Abhijit wrote:
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>                        
>>>>>>>>>>>> I deleted the dot as you asked to and also wrote the line find which
>>>>>>>>>>>> config we are using, and found we are using the same config file and
>>>>>>>>>>>> also broker is running successfully without the dot. Am attaching the
>>>>>>>>>>>> print-screen for the command line output i received when i tried running
>>>>>>>>>>>> rabbit-mq server
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>> thanks and regards,
>>>>>>>>>>>> Abhijit
>>>>>>>>>>>>
>>>>>>>>>>>> On 8/9/2011 4:50 PM, Alexandru Scvor?ov wrote:
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>                          
>>>>>>>>>>>>> Ok.  Could you delete the dot at the end (or introduce some other
>>>>>>>>>>>>> syntactic error) and try again?
>>>>>>>>>>>>>
>>>>>>>>>>>>> If it still runs, it's using a different configuration file.
>>>>>>>>>>>>>
>>>>>>>>>>>>> Could you also add the following line to the rabbitmq-server.bat file?
>>>>>>>>>>>>>          echo CONFIG_FILE: !RABBITMQ_CONFIG_FILE!.config
>>>>>>>>>>>>> It should go in towards the end, right before the "!ERLANG_HOME!\bin\erl.exe"
>>>>>>>>>>>>> line.
>>>>>>>>>>>>>
>>>>>>>>>>>>> That way, when you start the server manually with the .bat, we will know
>>>>>>>>>>>>> which config file it's using.
>>>>>>>>>>>>>
>>>>>>>>>>>>> Alex
>>>>>>>>>>>>>
>>>>>>>>>>>>> On Tue, Aug 09, 2011 at 04:42:32PM +0530, Abhijit wrote:
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>                            
>>>>>>>>>>>>>> hi sir,
>>>>>>>>>>>>>>
>>>>>>>>>>>>>> It didn't worked as we wanted...this are the last two phrases in the log
>>>>>>>>>>>>>> file of the broker.
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>                              
>>>>>>>>>>>>>>> =INFO REPORT==== 9-Aug-2011::16:39:52 ===
>>>>>>>>>>>>>>> started TCP Listener on [::]:5692
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>> =INFO REPORT==== 9-Aug-2011::16:39:53 ===
>>>>>>>>>>>>>>> started TCP Listener on 0.0.0.0:5692
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>                                
>>>>>>>>>>>>>> i copied the rabbitmq.config which you sent me but didn't worked out.
>>>>>>>>>>>>>>
>>>>>>>>>>>>>> Thanks and Regards,
>>>>>>>>>>>>>> Abhijit
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>> On 8/9/2011 4:19 PM, Alexandru Scvor?ov wrote:
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>                              
>>>>>>>>>>>>>>>> Am using the same path, C:\Users\Administrator\AppData\Roaming\RabbitMQ\rabbitmq.config for including ssl in my app.
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>>                                  
>>>>>>>>>>>>>>> Ok.
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>                                
>>>>>>>>>>>>>>>> But the file wasn't present earlier i had created that file in order to have SSL in my app at the same location.
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>>                                  
>>>>>>>>>>>>>>> That's fine.
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>                                
>>>>>>>>>>>>>>>> i tried running the bat file for the rabbitmq-server that didn't help sir, do you need any part of code for inspection.
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>>                                  
>>>>>>>>>>>>>>> The code isn't the problem right now.  It's getting rabbit to enable
>>>>>>>>>>>>>>> ssl.
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>> I'm attaching a rabbitmq.config.  Please try using that one.  Restart
>>>>>>>>>>>>>>> the broker and the last lines in the broker log should be:
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>> =INFO REPORT==== 9-Aug-2011::11:44:37 ===
>>>>>>>>>>>>>>> started TCP Listener on [::]:5672
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>> =INFO REPORT==== 9-Aug-2011::11:44:37 ===
>>>>>>>>>>>>>>> started SSL Listener on 0.0.0.0:5671
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>> Let me know how it goes, please.
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>> Cheers,
>>>>>>>>>>>>>>> Alex
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>> On Tue, Aug 09, 2011 at 04:09:42PM +0530, Abhijit wrote:
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>                                
>>>>>>>>>>>>>>>> Hi Sir,
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>> Am using the same path, C:\Users\Administrator\AppData\Roaming\RabbitMQ\rabbitmq.config for including ssl in my app.
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>> But the file wasn't present earlier i had created that file in order to have SSL in my app at the same location.
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>> i tried running the bat file for the rabbitmq-server that didn't help sir, do you need any part of code for inspection.
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>> Thanks a lot for your time and replies.
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>> Regards,
>>>>>>>>>>>>>>>> Abhijit
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>>                                  
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>                              
>>>>>>>>>>>>
>>>>>>>>>>>>                          
>>>>>>>>>>
>>>>>>>>>>                      
>>>>>>>>
>>>>>>>>                  
>>>>>>
>>>>>>              
>>>>
>>>>          
>>      


From trefor at tetrabyte.com  Wed Aug 10 09:15:19 2011
From: trefor at tetrabyte.com (TreforT)
Date: Wed, 10 Aug 2011 01:15:19 -0700 (PDT)
Subject: [rabbitmq-discuss] Issues starting RabbitMQ 2.5.1 on Ubuntu
 10.04
In-Reply-To: <32219482.post@talk.nabble.com>
References: <32219482.post@talk.nabble.com>
Message-ID: <32232090.post@talk.nabble.com>


To add to what I have said already. 

I can get RabbitMQ to start if i run it from root at the prompt but it fails
if i try and start the service. 

I have checked all the permissions and have not found anything wrong there. 

I have also updated Erlang to the latest version but am still not getting
anywhere.

Any help or questions would be really appreciated.

Kind Regards,

Trefor


TreforT wrote:
> 
> Hi All,
> 
> Wondering if you can all help me from going bald as I am pulling out my
> hair, trying to get RabbitMQ working.
> 
> I install it and It comes up with:
> <pre>
> Setting up rabbitmq-server (2.5.1-1) ...
> Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/startup_{log,
> _err}
> rabbitmq-server.
> </quoote>
> 

-- 
View this message in context: http://old.nabble.com/Issues-starting-RabbitMQ-2.5.1-on-Ubuntu-10.04-tp32219482p32232090.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From steve at rabbitmq.com  Wed Aug 10 09:13:42 2011
From: steve at rabbitmq.com (Steve Powell)
Date: Wed, 10 Aug 2011 09:13:42 +0100
Subject: [rabbitmq-discuss] rabbitmq-stomp 2.5.1 does not respect the
	spec wrt content-type
In-Reply-To: <20034.6372.247133.247487@mail.cern.ch>
References: <20110809140039.40ee.abe10f7e5afbbb3a79ce619739541149@cern.ch>
	<1DEBAA7E-CDAE-486F-8FE4-5E5484C8C448@rabbitmq.com>
	<1D9CBD89533EE94D8295DFBFD923C23F374BEC52@PLOXCHG03.cern.ch>
	<D07B60CC-CC36-4790-9677-91792FBDD4D1@rabbitmq.com>
	<7D4996BD-AC54-4A8E-9E66-1AFE415427A3@rabbitmq.com>
	<20034.6372.247133.247487@mail.cern.ch>
Message-ID: <D07601C4-FE6E-491D-83E0-B6C0D737B141@rabbitmq.com>

Lionel,
I have replied to Hiram's note, thank you. It is now clear where we went wrong, thanks to Tony Garnock-Jones's clear interjection:

[http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-August/014435.html]

I'm now testing a fix that will prevent us inserting a content-type when one is not supplied, and this should make the next release.

Steve Powell  (a hippy bunny)
----------some definitions from the SPD----------
Rigatoni n. A prime-ministerial grin.
Nigella n. The next bottle-size up from a Nebuchadnezzar.
Homily adv. Rather like a frenchman.

On 10 Aug 2011, at 06:36, Lionel Cons wrote:
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-August/014448.html

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110810/943e8edb/attachment.htm>

From abhijit.sinha at kiprosh.com  Wed Aug 10 09:34:58 2011
From: abhijit.sinha at kiprosh.com (Abhijit)
Date: Wed, 10 Aug 2011 14:04:58 +0530
Subject: [rabbitmq-discuss] facing issues with the SSL implementations
 with RabbitMQ + Windows + .Net
In-Reply-To: <20110809150226.GF28785@dakota.eng.vmware.com>
References: <20110809115033.GF3214@dakota.eng.vmware.com>
	<4E412192.5080107@kiprosh.com>
	<20110809120926.GA28785@dakota.eng.vmware.com>
	<4E412A3B.60602@kiprosh.com>
	<20110809124819.GB28785@dakota.eng.vmware.com>
	<4E412D87.2080806@kiprosh.com>
	<20110809140658.GC28785@dakota.eng.vmware.com>
	<4E414086.7010706@kiprosh.com>
	<20110809142807.GE28785@dakota.eng.vmware.com>
	<4E4146E5.4030101@kiprosh.com>
	<20110809150226.GF28785@dakota.eng.vmware.com>
Message-ID: <4E4242B2.3020808@kiprosh.com>

hi sir,

i am posting all the code and config file let me know if this is the 
correct way and you are doing the same.

code:

>
>                 string work_orders = rabbit1.csvtoJson();
>
>                 ConnectionFactory factory = new ConnectionFactory();
>                 factory.Ssl.ServerName = System.Net.Dns.GetHostName();
>                 factory.Ssl.CertPath = @"C:\server\keycert.p12";
>                 factory.Ssl.CertPassphrase = "example";
>                 factory.Ssl.AcceptablePolicyErrors = 
> System.Net.Security.SslPolicyErrors.RemoteCertificateChainErrors;
>                 factory.Ssl.Enabled = true;
>
>                 using (IConnection connection = 
> factory.CreateConnection())
>                 {
>                     using (IModel channel = connection.CreateModel())
>                     {
>                         channel.ExchangeDeclare(EXCHANGE_NAME, "fanout");
>                         byte[] payload = 
> Encoding.ASCII.GetBytes(work_orders);
>                         channel.BasicPublish(EXCHANGE_NAME, "", null, 
> payload);
>                         Console.WriteLine("started sending messages...");
>                         System.Threading.Thread.Sleep(3000);
>                     }
>                 }

the config file:

> [
>  {rabbit, [
>           {ssl_listeners, [{"0.0.0.0",5671}]}
>          ,{ssl_options, [{cacertfile,"C:\\testca\\cacert.pem"},
>                          {certfile,"C:\\server\\cert.pem"},
>                          {keyfile,"C:\\server\\key.pem"},
>                          {verify,verify_peer},
>                          {fail_if_no_peer_cert,true}]}
>           ]}
> ].


Thanks and Regards,
Abhijit


On 8/9/2011 8:32 PM, Alexandru Scvor?ov wrote:
> Is there anything in the server logs other than an abrupt connection
> termination?  If not, then it's strictly a client error.  I'd check that
> the CA certificate is indeed in the Trusted Root Certificate Authorities store
> and then I'd play around with setting the SslPolicyErrors.
>
> Other than that, I don't have any suggestions.  I've just set up
> something similar (RabbitMQ with SSL on Win2008 with .NET 3.5, OpenSSL
> 1.0 and RabbitMQ .NET on the same machine) and it works fine, so there's
> not intrinsic reason why it wouldn't work.
>
> Cheers,
> Alex
>
> On Tue, Aug 09, 2011 at 08:10:37PM +0530, Abhijit wrote:
>    
>> hi sir ,
>>
>> i have added all those certificates as trusted, still am getting this
>>
>>      
>>> base {System.Runtime.InteropServices.ExternalException} = {"The
>>> certificate chain was issued by an authority that is not trusted"}
>>>        
>> thanks a lot for the replies let me know if any suggestions.
>>
>> Thanks and Regards,
>> Abhijit
>>
>>
>> On 8/9/2011 7:58 PM, Alexandru Scvor?ov wrote:
>>      
>>>> http://www.rabbitmq.com/ssl.html#trust-dotNET,
>>>> i have executed them but all they do is opens the certmanager window.
>>>>
>>>>          
>>> There are two versions of the certmgr program.  One of the is shipped
>>> with Windows and is the graphical version you use.  The other is shipped
>>> with the Windows SDK and is a command line version.
>>>
>>> You can use the graphical version: start it up, click Import, select
>>> testca/cacert.cer, click Next, *IMPORTANT* select the Trusted Root
>>> Certification Authorities store, click Next... until it's imported.
>>>
>>>
>>>        
>>>>> [{amqp-0-9://localhost:5671}] =
>>>>> {System.Security.Authentication.AuthenticationException: A call to
>>>>> SSPI failed, see inner exception. --->
>>>>> System.ComponentModel.Win32Exception: The message received was
>>>>> unexpected or badly formatted
>>>>>
>>>>>            
>>> The error you're getting doesn't sound like it's because of this, but
>>> you'll need to import the certificate anyway.  Maybe it will help.
>>>
>>> Cheers,
>>> Alex
>>>
>>> On Tue, Aug 09, 2011 at 07:43:26PM +0530, Abhijit wrote:
>>>
>>>        
>>>> hello sir,
>>>>
>>>>
>>>>          
>>>>> [{amqp-0-9://localhost:5671}] =
>>>>> {System.Security.Authentication.AuthenticationException: A call to
>>>>> SSPI failed, see inner exception. --->
>>>>> System.ComponentModel.Win32Exception: The message received was
>>>>> unexpected or badly formatted
>>>>>
>>>>>            
>>>> i got this error after changing it to pem sir, and also i created the
>>>> certificates properly as per the rabbitmq ssl steps but i haven't able
>>>> to understand this steps mentioned:
>>>> http://www.rabbitmq.com/ssl.html#trust-dotNET,
>>>> i have executed them but all they do is opens the certmanager window.
>>>>
>>>> Any suggestions.
>>>>
>>>> Thanks and Regards,
>>>> Abhijit
>>>>
>>>>
>>>> On 8/9/2011 7:36 PM, Alexandru Scvor?ov wrote:
>>>>
>>>>          
>>>>> I managed to reproduce your error.
>>>>>
>>>>> Solution: do not use the .cer file in the broker config; use the .pem
>>>>> file.  For some reason, rather than complaining that it can't read the
>>>>> CA certificate, Erlang just silently ignores that and throws an "unknown
>>>>> CA" error.  Hurray!
>>>>>
>>>>> So, change
>>>>>      {cacertfile,"C:\\testca\\cacert.cer"}
>>>>> with
>>>>>      {cacertfile,"C:\\testca\\cacert.pem"}
>>>>>
>>>>> Please let me know if this helps.
>>>>>
>>>>> Cheers,
>>>>> Alex
>>>>>
>>>>> On Tue, Aug 09, 2011 at 06:22:23PM +0530, Abhijit wrote:
>>>>>
>>>>>
>>>>>            
>>>>>> ya sir that was set true, i would go back and look at my certification
>>>>>> creation steps and find out whether i did everything properly.
>>>>>>
>>>>>> and would let you know once that i done.
>>>>>>
>>>>>> Thanks and Regards,
>>>>>> Abhijit
>>>>>>
>>>>>> On 8/9/2011 6:18 PM, Alexandru Scvor?ov wrote:
>>>>>>
>>>>>>
>>>>>>              
>>>>>>>> Am basically getting this error, i tried debugging and solved most of
>>>>>>>> the problems but still getting this:
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>                  
>>>>>>> Oh, great. My guess about the really long error was that you needed some
>>>>>>> clients to connect without providing certificates, but
>>>>>>> fail_if_no_peer_cert was set to true in the config file.  Was that
>>>>>>> right?
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>                
>>>>>>>>> [{amqp-0-9://localhost:5671}] =
>>>>>>>>> {System.Security.Authentication.AuthenticationException: A call to
>>>>>>>>> SSPI failed, see inner exception. --->
>>>>>>>>> System.ComponentModel.Win32Exception: The certificate chain was issued
>>>>>>>>> by an authority that is not trusted
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>                    
>>>>>>> I haven't seen that before.  Did you follow the steps in our SSL guide
>>>>>>> to generate the certificate (in particular, were the client certificates
>>>>>>> signed by the CA set in the broker)?
>>>>>>>
>>>>>>> Alex
>>>>>>>
>>>>>>> On Tue, Aug 09, 2011 at 06:08:19PM +0530, Abhijit wrote:
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>                
>>>>>>>> hi sir,
>>>>>>>>
>>>>>>>> Am basically getting this error, i tried debugging and solved most of
>>>>>>>> the problems but still getting this:
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>                  
>>>>>>>>> [{amqp-0-9://localhost:5671}] =
>>>>>>>>> {System.Security.Authentication.AuthenticationException: A call to
>>>>>>>>> SSPI failed, see inner exception. --->
>>>>>>>>> System.ComponentModel.Win32Exception: The certificate chain was issued
>>>>>>>>> by an authority that is not trusted
>>>>>>>>>        --- End of inner exception stack trace -...
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>                    
>>>>>>>> Thanks and Regards,
>>>>>>>> Abhijit
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>> On 8/9/2011 5:39 PM, Alexandru Scvor?ov wrote:
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>                  
>>>>>>>>>> i would go ahead for now, if any queries i would again seek your help.
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>                      
>>>>>>>>> Excellent.  Don't hesitate to ask us any more questions.
>>>>>>>>>
>>>>>>>>> Also, in the future, could you please make sure to CC the mailing list
>>>>>>>>> when replying?
>>>>>>>>>
>>>>>>>>> Cheers,
>>>>>>>>> Alex
>>>>>>>>>
>>>>>>>>> On Tue, Aug 09, 2011 at 05:31:22PM +0530, Abhijit wrote:
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>                    
>>>>>>>>>> hi sir,
>>>>>>>>>>
>>>>>>>>>> finally got this:
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>                      
>>>>>>>>>>> =INFO REPORT==== 9-Aug-2011::17:28:33 ===
>>>>>>>>>>> started TCP Listener on 0.0.0.0:5672
>>>>>>>>>>>
>>>>>>>>>>> =INFO REPORT==== 9-Aug-2011::17:28:33 ===
>>>>>>>>>>> started SSL Listener on 0.0.0.0:5671
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>                        
>>>>>>>>>> your this step
>>>>>>>>>>
>>>>>>>>>> Could you copy the config file to "...\AppData\Roaming\RabbitMQ.config"
>>>>>>>>>> and try again
>>>>>>>>>>
>>>>>>>>>> helped...
>>>>>>>>>>
>>>>>>>>>> i would go ahead for now, if any queries i would again seek your help.
>>>>>>>>>>
>>>>>>>>>> Thanks and Regards,
>>>>>>>>>> Abhijit
>>>>>>>>>>
>>>>>>>>>> On 8/9/2011 5:20 PM, Alexandru Scvor?ov wrote:
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>                      
>>>>>>>>>>> That's a bit odd.  I'm not sure how that can happen.  It looks like you
>>>>>>>>>>> somehow set the RABBITMQ_CONFIG_FILE variable at some point.
>>>>>>>>>>>
>>>>>>>>>>> The file is normally in:
>>>>>>>>>>> ...\AppData\Roaming\RabbitMQ\rabbitmq.config
>>>>>>>>>>> but your system is looking for it in:
>>>>>>>>>>> ...\AppData\Roaming\RabbitMQ.config
>>>>>>>>>>>
>>>>>>>>>>> Could you copy the config file to "...\AppData\Roaming\RabbitMQ.config"
>>>>>>>>>>> and try again?  Alternatively, unset the RABBITMQ_CONFIG_FILE variable
>>>>>>>>>>> and try again without copying the file.
>>>>>>>>>>>
>>>>>>>>>>> Cheers,
>>>>>>>>>>> Alex
>>>>>>>>>>>
>>>>>>>>>>> On Tue, Aug 09, 2011 at 05:02:04PM +0530, Abhijit wrote:
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>                        
>>>>>>>>>>>> I deleted the dot as you asked to and also wrote the line find which
>>>>>>>>>>>> config we are using, and found we are using the same config file and
>>>>>>>>>>>> also broker is running successfully without the dot. Am attaching the
>>>>>>>>>>>> print-screen for the command line output i received when i tried running
>>>>>>>>>>>> rabbit-mq server
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>> thanks and regards,
>>>>>>>>>>>> Abhijit
>>>>>>>>>>>>
>>>>>>>>>>>> On 8/9/2011 4:50 PM, Alexandru Scvor?ov wrote:
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>                          
>>>>>>>>>>>>> Ok.  Could you delete the dot at the end (or introduce some other
>>>>>>>>>>>>> syntactic error) and try again?
>>>>>>>>>>>>>
>>>>>>>>>>>>> If it still runs, it's using a different configuration file.
>>>>>>>>>>>>>
>>>>>>>>>>>>> Could you also add the following line to the rabbitmq-server.bat file?
>>>>>>>>>>>>>          echo CONFIG_FILE: !RABBITMQ_CONFIG_FILE!.config
>>>>>>>>>>>>> It should go in towards the end, right before the "!ERLANG_HOME!\bin\erl.exe"
>>>>>>>>>>>>> line.
>>>>>>>>>>>>>
>>>>>>>>>>>>> That way, when you start the server manually with the .bat, we will know
>>>>>>>>>>>>> which config file it's using.
>>>>>>>>>>>>>
>>>>>>>>>>>>> Alex
>>>>>>>>>>>>>
>>>>>>>>>>>>> On Tue, Aug 09, 2011 at 04:42:32PM +0530, Abhijit wrote:
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>                            
>>>>>>>>>>>>>> hi sir,
>>>>>>>>>>>>>>
>>>>>>>>>>>>>> It didn't worked as we wanted...this are the last two phrases in the log
>>>>>>>>>>>>>> file of the broker.
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>                              
>>>>>>>>>>>>>>> =INFO REPORT==== 9-Aug-2011::16:39:52 ===
>>>>>>>>>>>>>>> started TCP Listener on [::]:5692
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>> =INFO REPORT==== 9-Aug-2011::16:39:53 ===
>>>>>>>>>>>>>>> started TCP Listener on 0.0.0.0:5692
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>                                
>>>>>>>>>>>>>> i copied the rabbitmq.config which you sent me but didn't worked out.
>>>>>>>>>>>>>>
>>>>>>>>>>>>>> Thanks and Regards,
>>>>>>>>>>>>>> Abhijit
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>> On 8/9/2011 4:19 PM, Alexandru Scvor?ov wrote:
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>                              
>>>>>>>>>>>>>>>> Am using the same path, C:\Users\Administrator\AppData\Roaming\RabbitMQ\rabbitmq.config for including ssl in my app.
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>>                                  
>>>>>>>>>>>>>>> Ok.
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>                                
>>>>>>>>>>>>>>>> But the file wasn't present earlier i had created that file in order to have SSL in my app at the same location.
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>>                                  
>>>>>>>>>>>>>>> That's fine.
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>                                
>>>>>>>>>>>>>>>> i tried running the bat file for the rabbitmq-server that didn't help sir, do you need any part of code for inspection.
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>>                                  
>>>>>>>>>>>>>>> The code isn't the problem right now.  It's getting rabbit to enable
>>>>>>>>>>>>>>> ssl.
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>> I'm attaching a rabbitmq.config.  Please try using that one.  Restart
>>>>>>>>>>>>>>> the broker and the last lines in the broker log should be:
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>> =INFO REPORT==== 9-Aug-2011::11:44:37 ===
>>>>>>>>>>>>>>> started TCP Listener on [::]:5672
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>> =INFO REPORT==== 9-Aug-2011::11:44:37 ===
>>>>>>>>>>>>>>> started SSL Listener on 0.0.0.0:5671
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>> Let me know how it goes, please.
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>> Cheers,
>>>>>>>>>>>>>>> Alex
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>> On Tue, Aug 09, 2011 at 04:09:42PM +0530, Abhijit wrote:
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>                                
>>>>>>>>>>>>>>>> Hi Sir,
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>> Am using the same path, C:\Users\Administrator\AppData\Roaming\RabbitMQ\rabbitmq.config for including ssl in my app.
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>> But the file wasn't present earlier i had created that file in order to have SSL in my app at the same location.
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>> i tried running the bat file for the rabbitmq-server that didn't help sir, do you need any part of code for inspection.
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>> Thanks a lot for your time and replies.
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>> Regards,
>>>>>>>>>>>>>>>> Abhijit
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>>                                  
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>                              
>>>>>>>>>>>>
>>>>>>>>>>>>                          
>>>>>>>>>>
>>>>>>>>>>                      
>>>>>>>>
>>>>>>>>                  
>>>>>>
>>>>>>              
>>>>
>>>>          
>>      


From alexandru at rabbitmq.com  Wed Aug 10 09:42:24 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Wed, 10 Aug 2011 09:42:24 +0100
Subject: [rabbitmq-discuss] facing issues with the SSL implementations
 with RabbitMQ + Windows + .Net
In-Reply-To: <4E422EDB.60506@kiprosh.com>
References: <20110809120926.GA28785@dakota.eng.vmware.com>
	<4E412A3B.60602@kiprosh.com>
	<20110809124819.GB28785@dakota.eng.vmware.com>
	<4E412D87.2080806@kiprosh.com>
	<20110809140658.GC28785@dakota.eng.vmware.com>
	<4E414086.7010706@kiprosh.com>
	<20110809142807.GE28785@dakota.eng.vmware.com>
	<4E4146E5.4030101@kiprosh.com>
	<20110809150226.GF28785@dakota.eng.vmware.com>
	<4E422EDB.60506@kiprosh.com>
Message-ID: <20110810084224.GB2869@dakota.eng.vmware.com>

Hi Abhijit,

Please post the configuration file you're using right now.  Also, please
make sure this is indeed the file the server is using (maybe delete any
other configuration files that may be around and restart the service?)

Please run the following command over the certificates:
  openssl verify -CAfile testca/cacert.pem -verbose server/cert.pem
This will confirm that the certificate is indeed valid.

Cheers,
Alex

On Wed, Aug 10, 2011 at 12:40:19PM +0530, Abhijit wrote:
> Hi sir,
> 
> i gave it a try and checked log files and found these errors:
> 
> > =ERROR REPORT==== 10-Aug-2011::12:24:36 ===
> > SSL: certify_certificate: ./ssl_handshake.erl:566:Fatal error: unknown ca
> >
> > =ERROR REPORT==== 10-Aug-2011::12:24:36 ===
> > error on TCP connection <0.236.0>:{ssl_upgrade_error,"unknown ca"}
> >
> > =INFO REPORT==== 10-Aug-2011::12:24:36 ===
> > closing TCP connection <0.236.0>
> 
> i checked for the trusted root certificates and found the certificates i 
> made in this section.
> 
> Still am getting these errors sir,
> 
> > base {System.Runtime.InteropServices.ExternalException} = {"The
> > certificate chain was issued by an authority that is not trusted"}
> 
> Any Suggestions.
> 
> Thanks and Regards,
> Abhijit
> 
> 
> 
> 
> 
> 
> On 8/9/2011 8:32 PM, Alexandru Scvor?ov wrote:
> > Is there anything in the server logs other than an abrupt connection
> > termination?  If not, then it's strictly a client error.  I'd check that
> > the CA certificate is indeed in the Trusted Root Certificate Authorities store
> > and then I'd play around with setting the SslPolicyErrors.
> >
> > Other than that, I don't have any suggestions.  I've just set up
> > something similar (RabbitMQ with SSL on Win2008 with .NET 3.5, OpenSSL
> > 1.0 and RabbitMQ .NET on the same machine) and it works fine, so there's
> > not intrinsic reason why it wouldn't work.
> >
> > Cheers,
> > Alex
> >
> > On Tue, Aug 09, 2011 at 08:10:37PM +0530, Abhijit wrote:
> >    
> >> hi sir ,
> >>
> >> i have added all those certificates as trusted, still am getting this
> >>
> >>      
> >>> base {System.Runtime.InteropServices.ExternalException} = {"The
> >>> certificate chain was issued by an authority that is not trusted"}
> >>>        
> >> thanks a lot for the replies let me know if any suggestions.
> >>
> >> Thanks and Regards,
> >> Abhijit
> >>
> >>
> >> On 8/9/2011 7:58 PM, Alexandru Scvor?ov wrote:
> >>      
> >>>> http://www.rabbitmq.com/ssl.html#trust-dotNET,
> >>>> i have executed them but all they do is opens the certmanager window.
> >>>>
> >>>>          
> >>> There are two versions of the certmgr program.  One of the is shipped
> >>> with Windows and is the graphical version you use.  The other is shipped
> >>> with the Windows SDK and is a command line version.
> >>>
> >>> You can use the graphical version: start it up, click Import, select
> >>> testca/cacert.cer, click Next, *IMPORTANT* select the Trusted Root
> >>> Certification Authorities store, click Next... until it's imported.
> >>>
> >>>
> >>>        
> >>>>> [{amqp-0-9://localhost:5671}] =
> >>>>> {System.Security.Authentication.AuthenticationException: A call to
> >>>>> SSPI failed, see inner exception. --->
> >>>>> System.ComponentModel.Win32Exception: The message received was
> >>>>> unexpected or badly formatted
> >>>>>
> >>>>>            
> >>> The error you're getting doesn't sound like it's because of this, but
> >>> you'll need to import the certificate anyway.  Maybe it will help.
> >>>
> >>> Cheers,
> >>> Alex
> >>>
> >>> On Tue, Aug 09, 2011 at 07:43:26PM +0530, Abhijit wrote:
> >>>
> >>>        
> >>>> hello sir,
> >>>>
> >>>>
> >>>>          
> >>>>> [{amqp-0-9://localhost:5671}] =
> >>>>> {System.Security.Authentication.AuthenticationException: A call to
> >>>>> SSPI failed, see inner exception. --->
> >>>>> System.ComponentModel.Win32Exception: The message received was
> >>>>> unexpected or badly formatted
> >>>>>
> >>>>>            
> >>>> i got this error after changing it to pem sir, and also i created the
> >>>> certificates properly as per the rabbitmq ssl steps but i haven't able
> >>>> to understand this steps mentioned:
> >>>> http://www.rabbitmq.com/ssl.html#trust-dotNET,
> >>>> i have executed them but all they do is opens the certmanager window.
> >>>>
> >>>> Any suggestions.
> >>>>
> >>>> Thanks and Regards,
> >>>> Abhijit
> >>>>
> >>>>
> >>>> On 8/9/2011 7:36 PM, Alexandru Scvor?ov wrote:
> >>>>
> >>>>          
> >>>>> I managed to reproduce your error.
> >>>>>
> >>>>> Solution: do not use the .cer file in the broker config; use the .pem
> >>>>> file.  For some reason, rather than complaining that it can't read the
> >>>>> CA certificate, Erlang just silently ignores that and throws an "unknown
> >>>>> CA" error.  Hurray!
> >>>>>
> >>>>> So, change
> >>>>>      {cacertfile,"C:\\testca\\cacert.cer"}
> >>>>> with
> >>>>>      {cacertfile,"C:\\testca\\cacert.pem"}
> >>>>>
> >>>>> Please let me know if this helps.
> >>>>>
> >>>>> Cheers,
> >>>>> Alex
> >>>>>
> >>>>> On Tue, Aug 09, 2011 at 06:22:23PM +0530, Abhijit wrote:
> >>>>>
> >>>>>
> >>>>>            
> >>>>>> ya sir that was set true, i would go back and look at my certification
> >>>>>> creation steps and find out whether i did everything properly.
> >>>>>>
> >>>>>> and would let you know once that i done.
> >>>>>>
> >>>>>> Thanks and Regards,
> >>>>>> Abhijit
> >>>>>>
> >>>>>> On 8/9/2011 6:18 PM, Alexandru Scvor?ov wrote:
> >>>>>>
> >>>>>>
> >>>>>>              
> >>>>>>>> Am basically getting this error, i tried debugging and solved most of
> >>>>>>>> the problems but still getting this:
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>                  
> >>>>>>> Oh, great. My guess about the really long error was that you needed some
> >>>>>>> clients to connect without providing certificates, but
> >>>>>>> fail_if_no_peer_cert was set to true in the config file.  Was that
> >>>>>>> right?
> >>>>>>>
> >>>>>>>
> >>>>>>>
> >>>>>>>
> >>>>>>>                
> >>>>>>>>> [{amqp-0-9://localhost:5671}] =
> >>>>>>>>> {System.Security.Authentication.AuthenticationException: A call to
> >>>>>>>>> SSPI failed, see inner exception. --->
> >>>>>>>>> System.ComponentModel.Win32Exception: The certificate chain was issued
> >>>>>>>>> by an authority that is not trusted
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>                    
> >>>>>>> I haven't seen that before.  Did you follow the steps in our SSL guide
> >>>>>>> to generate the certificate (in particular, were the client certificates
> >>>>>>> signed by the CA set in the broker)?
> >>>>>>>
> >>>>>>> Alex
> >>>>>>>
> >>>>>>> On Tue, Aug 09, 2011 at 06:08:19PM +0530, Abhijit wrote:
> >>>>>>>
> >>>>>>>
> >>>>>>>
> >>>>>>>                
> >>>>>>>> hi sir,
> >>>>>>>>
> >>>>>>>> Am basically getting this error, i tried debugging and solved most of
> >>>>>>>> the problems but still getting this:
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>                  
> >>>>>>>>> [{amqp-0-9://localhost:5671}] =
> >>>>>>>>> {System.Security.Authentication.AuthenticationException: A call to
> >>>>>>>>> SSPI failed, see inner exception. --->
> >>>>>>>>> System.ComponentModel.Win32Exception: The certificate chain was issued
> >>>>>>>>> by an authority that is not trusted
> >>>>>>>>>        --- End of inner exception stack trace -...
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>                    
> >>>>>>>> Thanks and Regards,
> >>>>>>>> Abhijit
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>
> >>>>>>>> On 8/9/2011 5:39 PM, Alexandru Scvor?ov wrote:
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>                  
> >>>>>>>>>> i would go ahead for now, if any queries i would again seek your help.
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>                      
> >>>>>>>>> Excellent.  Don't hesitate to ask us any more questions.
> >>>>>>>>>
> >>>>>>>>> Also, in the future, could you please make sure to CC the mailing list
> >>>>>>>>> when replying?
> >>>>>>>>>
> >>>>>>>>> Cheers,
> >>>>>>>>> Alex
> >>>>>>>>>
> >>>>>>>>> On Tue, Aug 09, 2011 at 05:31:22PM +0530, Abhijit wrote:
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>                    
> >>>>>>>>>> hi sir,
> >>>>>>>>>>
> >>>>>>>>>> finally got this:
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>                      
> >>>>>>>>>>> =INFO REPORT==== 9-Aug-2011::17:28:33 ===
> >>>>>>>>>>> started TCP Listener on 0.0.0.0:5672
> >>>>>>>>>>>
> >>>>>>>>>>> =INFO REPORT==== 9-Aug-2011::17:28:33 ===
> >>>>>>>>>>> started SSL Listener on 0.0.0.0:5671
> >>>>>>>>>>>
> >>>>>>>>>>>
> >>>>>>>>>>>
> >>>>>>>>>>>
> >>>>>>>>>>>                        
> >>>>>>>>>> your this step
> >>>>>>>>>>
> >>>>>>>>>> Could you copy the config file to "...\AppData\Roaming\RabbitMQ.config"
> >>>>>>>>>> and try again
> >>>>>>>>>>
> >>>>>>>>>> helped...
> >>>>>>>>>>
> >>>>>>>>>> i would go ahead for now, if any queries i would again seek your help.
> >>>>>>>>>>
> >>>>>>>>>> Thanks and Regards,
> >>>>>>>>>> Abhijit
> >>>>>>>>>>
> >>>>>>>>>> On 8/9/2011 5:20 PM, Alexandru Scvor?ov wrote:
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>                      
> >>>>>>>>>>> That's a bit odd.  I'm not sure how that can happen.  It looks like you
> >>>>>>>>>>> somehow set the RABBITMQ_CONFIG_FILE variable at some point.
> >>>>>>>>>>>
> >>>>>>>>>>> The file is normally in:
> >>>>>>>>>>> ...\AppData\Roaming\RabbitMQ\rabbitmq.config
> >>>>>>>>>>> but your system is looking for it in:
> >>>>>>>>>>> ...\AppData\Roaming\RabbitMQ.config
> >>>>>>>>>>>
> >>>>>>>>>>> Could you copy the config file to "...\AppData\Roaming\RabbitMQ.config"
> >>>>>>>>>>> and try again?  Alternatively, unset the RABBITMQ_CONFIG_FILE variable
> >>>>>>>>>>> and try again without copying the file.
> >>>>>>>>>>>
> >>>>>>>>>>> Cheers,
> >>>>>>>>>>> Alex
> >>>>>>>>>>>
> >>>>>>>>>>> On Tue, Aug 09, 2011 at 05:02:04PM +0530, Abhijit wrote:
> >>>>>>>>>>>
> >>>>>>>>>>>
> >>>>>>>>>>>
> >>>>>>>>>>>
> >>>>>>>>>>>
> >>>>>>>>>>>                        
> >>>>>>>>>>>> I deleted the dot as you asked to and also wrote the line find which
> >>>>>>>>>>>> config we are using, and found we are using the same config file and
> >>>>>>>>>>>> also broker is running successfully without the dot. Am attaching the
> >>>>>>>>>>>> print-screen for the command line output i received when i tried running
> >>>>>>>>>>>> rabbit-mq server
> >>>>>>>>>>>>
> >>>>>>>>>>>>
> >>>>>>>>>>>>
> >>>>>>>>>>>> thanks and regards,
> >>>>>>>>>>>> Abhijit
> >>>>>>>>>>>>
> >>>>>>>>>>>> On 8/9/2011 4:50 PM, Alexandru Scvor?ov wrote:
> >>>>>>>>>>>>
> >>>>>>>>>>>>
> >>>>>>>>>>>>
> >>>>>>>>>>>>
> >>>>>>>>>>>>
> >>>>>>>>>>>>                          
> >>>>>>>>>>>>> Ok.  Could you delete the dot at the end (or introduce some other
> >>>>>>>>>>>>> syntactic error) and try again?
> >>>>>>>>>>>>>
> >>>>>>>>>>>>> If it still runs, it's using a different configuration file.
> >>>>>>>>>>>>>
> >>>>>>>>>>>>> Could you also add the following line to the rabbitmq-server.bat file?
> >>>>>>>>>>>>>          echo CONFIG_FILE: !RABBITMQ_CONFIG_FILE!.config
> >>>>>>>>>>>>> It should go in towards the end, right before the "!ERLANG_HOME!\bin\erl.exe"
> >>>>>>>>>>>>> line.
> >>>>>>>>>>>>>
> >>>>>>>>>>>>> That way, when you start the server manually with the .bat, we will know
> >>>>>>>>>>>>> which config file it's using.
> >>>>>>>>>>>>>
> >>>>>>>>>>>>> Alex
> >>>>>>>>>>>>>
> >>>>>>>>>>>>> On Tue, Aug 09, 2011 at 04:42:32PM +0530, Abhijit wrote:
> >>>>>>>>>>>>>
> >>>>>>>>>>>>>
> >>>>>>>>>>>>>
> >>>>>>>>>>>>>
> >>>>>>>>>>>>>
> >>>>>>>>>>>>>
> >>>>>>>>>>>>>                            
> >>>>>>>>>>>>>> hi sir,
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>> It didn't worked as we wanted...this are the last two phrases in the log
> >>>>>>>>>>>>>> file of the broker.
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>>                              
> >>>>>>>>>>>>>>> =INFO REPORT==== 9-Aug-2011::16:39:52 ===
> >>>>>>>>>>>>>>> started TCP Listener on [::]:5692
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>> =INFO REPORT==== 9-Aug-2011::16:39:53 ===
> >>>>>>>>>>>>>>> started TCP Listener on 0.0.0.0:5692
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>                                
> >>>>>>>>>>>>>> i copied the rabbitmq.config which you sent me but didn't worked out.
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>> Thanks and Regards,
> >>>>>>>>>>>>>> Abhijit
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>> On 8/9/2011 4:19 PM, Alexandru Scvor?ov wrote:
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>>                              
> >>>>>>>>>>>>>>>> Am using the same path, C:\Users\Administrator\AppData\Roaming\RabbitMQ\rabbitmq.config for including ssl in my app.
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>>                                  
> >>>>>>>>>>>>>>> Ok.
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>                                
> >>>>>>>>>>>>>>>> But the file wasn't present earlier i had created that file in order to have SSL in my app at the same location.
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>>                                  
> >>>>>>>>>>>>>>> That's fine.
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>                                
> >>>>>>>>>>>>>>>> i tried running the bat file for the rabbitmq-server that didn't help sir, do you need any part of code for inspection.
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>>                                  
> >>>>>>>>>>>>>>> The code isn't the problem right now.  It's getting rabbit to enable
> >>>>>>>>>>>>>>> ssl.
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>> I'm attaching a rabbitmq.config.  Please try using that one.  Restart
> >>>>>>>>>>>>>>> the broker and the last lines in the broker log should be:
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>> =INFO REPORT==== 9-Aug-2011::11:44:37 ===
> >>>>>>>>>>>>>>> started TCP Listener on [::]:5672
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>> =INFO REPORT==== 9-Aug-2011::11:44:37 ===
> >>>>>>>>>>>>>>> started SSL Listener on 0.0.0.0:5671
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>> Let me know how it goes, please.
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>> Cheers,
> >>>>>>>>>>>>>>> Alex
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>> On Tue, Aug 09, 2011 at 04:09:42PM +0530, Abhijit wrote:
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>                                
> >>>>>>>>>>>>>>>> Hi Sir,
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>> Am using the same path, C:\Users\Administrator\AppData\Roaming\RabbitMQ\rabbitmq.config for including ssl in my app.
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>> But the file wasn't present earlier i had created that file in order to have SSL in my app at the same location.
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>> i tried running the bat file for the rabbitmq-server that didn't help sir, do you need any part of code for inspection.
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>> Thanks a lot for your time and replies.
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>> Regards,
> >>>>>>>>>>>>>>>> Abhijit
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>>                                  
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>>                              
> >>>>>>>>>>>>
> >>>>>>>>>>>>                          
> >>>>>>>>>>
> >>>>>>>>>>                      
> >>>>>>>>
> >>>>>>>>                  
> >>>>>>
> >>>>>>              
> >>>>
> >>>>          
> >>      
> 

From alexandru at rabbitmq.com  Wed Aug 10 10:16:49 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Wed, 10 Aug 2011 10:16:49 +0100
Subject: [rabbitmq-discuss] facing issues with the SSL implementations
 with RabbitMQ + Windows + .Net
In-Reply-To: <4E422EDB.60506@kiprosh.com>
References: <20110809120926.GA28785@dakota.eng.vmware.com>
	<4E412A3B.60602@kiprosh.com>
	<20110809124819.GB28785@dakota.eng.vmware.com>
	<4E412D87.2080806@kiprosh.com>
	<20110809140658.GC28785@dakota.eng.vmware.com>
	<4E414086.7010706@kiprosh.com>
	<20110809142807.GE28785@dakota.eng.vmware.com>
	<4E4146E5.4030101@kiprosh.com>
	<20110809150226.GF28785@dakota.eng.vmware.com>
	<4E422EDB.60506@kiprosh.com>
Message-ID: <20110810091649.GC2869@dakota.eng.vmware.com>

I notice you already sent the config file.  Still, please ensure that
it's really the one in use.

You can check the certificates on both sides of the connection as
well:

To check the server:
  openssl s_client -connect localhost:5671 -CAfile testca/cacert.pem
  -cert client/cert.pem -key client/key.pem -showcerts
This will either result in a short error or will succeed and print the
certificate chain and details about the ssl session.

Doing this right now will probably just give you the server's
certificate chain and then:
...tlsv1 alert unknown ca:...:SSL alert number 48
I got this by using testca.cer rather than testca.pem, but it could
probably happen for a variety of reasons.


To check the client, first stop the server, then run:
  openssl s_server -accept 5671 -CAfile testca/cacert.pem -cert
  server/cert.pem -key server.key.pem -state
Then, run the client program.  S_server should accept the connection and
it should eventually fail with an "AMQP    ERROR".

I suspect this will work for you.


The default install of OpenSSL is in C:\, I see.  The executable is in
C:\OpenSSL-Win32\bin on my system.

Cheers,
Alex

On Wed, Aug 10, 2011 at 12:40:19PM +0530, Abhijit wrote:
> Hi sir,
> 
> i gave it a try and checked log files and found these errors:
> 
> > =ERROR REPORT==== 10-Aug-2011::12:24:36 ===
> > SSL: certify_certificate: ./ssl_handshake.erl:566:Fatal error: unknown ca
> >
> > =ERROR REPORT==== 10-Aug-2011::12:24:36 ===
> > error on TCP connection <0.236.0>:{ssl_upgrade_error,"unknown ca"}
> >
> > =INFO REPORT==== 10-Aug-2011::12:24:36 ===
> > closing TCP connection <0.236.0>
> 
> i checked for the trusted root certificates and found the certificates i 
> made in this section.
> 
> Still am getting these errors sir,
> 
> > base {System.Runtime.InteropServices.ExternalException} = {"The
> > certificate chain was issued by an authority that is not trusted"}
> 
> Any Suggestions.
> 
> Thanks and Regards,
> Abhijit
> 
> 
> 
> 
> 
> 
> On 8/9/2011 8:32 PM, Alexandru Scvor?ov wrote:
> > Is there anything in the server logs other than an abrupt connection
> > termination?  If not, then it's strictly a client error.  I'd check that
> > the CA certificate is indeed in the Trusted Root Certificate Authorities store
> > and then I'd play around with setting the SslPolicyErrors.
> >
> > Other than that, I don't have any suggestions.  I've just set up
> > something similar (RabbitMQ with SSL on Win2008 with .NET 3.5, OpenSSL
> > 1.0 and RabbitMQ .NET on the same machine) and it works fine, so there's
> > not intrinsic reason why it wouldn't work.
> >
> > Cheers,
> > Alex
> >
> > On Tue, Aug 09, 2011 at 08:10:37PM +0530, Abhijit wrote:
> >    
> >> hi sir ,
> >>
> >> i have added all those certificates as trusted, still am getting this
> >>
> >>      
> >>> base {System.Runtime.InteropServices.ExternalException} = {"The
> >>> certificate chain was issued by an authority that is not trusted"}
> >>>        
> >> thanks a lot for the replies let me know if any suggestions.
> >>
> >> Thanks and Regards,
> >> Abhijit
> >>
> >>
> >> On 8/9/2011 7:58 PM, Alexandru Scvor?ov wrote:
> >>      
> >>>> http://www.rabbitmq.com/ssl.html#trust-dotNET,
> >>>> i have executed them but all they do is opens the certmanager window.
> >>>>
> >>>>          
> >>> There are two versions of the certmgr program.  One of the is shipped
> >>> with Windows and is the graphical version you use.  The other is shipped
> >>> with the Windows SDK and is a command line version.
> >>>
> >>> You can use the graphical version: start it up, click Import, select
> >>> testca/cacert.cer, click Next, *IMPORTANT* select the Trusted Root
> >>> Certification Authorities store, click Next... until it's imported.
> >>>
> >>>
> >>>        
> >>>>> [{amqp-0-9://localhost:5671}] =
> >>>>> {System.Security.Authentication.AuthenticationException: A call to
> >>>>> SSPI failed, see inner exception. --->
> >>>>> System.ComponentModel.Win32Exception: The message received was
> >>>>> unexpected or badly formatted
> >>>>>
> >>>>>            
> >>> The error you're getting doesn't sound like it's because of this, but
> >>> you'll need to import the certificate anyway.  Maybe it will help.
> >>>
> >>> Cheers,
> >>> Alex
> >>>
> >>> On Tue, Aug 09, 2011 at 07:43:26PM +0530, Abhijit wrote:
> >>>
> >>>        
> >>>> hello sir,
> >>>>
> >>>>
> >>>>          
> >>>>> [{amqp-0-9://localhost:5671}] =
> >>>>> {System.Security.Authentication.AuthenticationException: A call to
> >>>>> SSPI failed, see inner exception. --->
> >>>>> System.ComponentModel.Win32Exception: The message received was
> >>>>> unexpected or badly formatted
> >>>>>
> >>>>>            
> >>>> i got this error after changing it to pem sir, and also i created the
> >>>> certificates properly as per the rabbitmq ssl steps but i haven't able
> >>>> to understand this steps mentioned:
> >>>> http://www.rabbitmq.com/ssl.html#trust-dotNET,
> >>>> i have executed them but all they do is opens the certmanager window.
> >>>>
> >>>> Any suggestions.
> >>>>
> >>>> Thanks and Regards,
> >>>> Abhijit
> >>>>
> >>>>
> >>>> On 8/9/2011 7:36 PM, Alexandru Scvor?ov wrote:
> >>>>
> >>>>          
> >>>>> I managed to reproduce your error.
> >>>>>
> >>>>> Solution: do not use the .cer file in the broker config; use the .pem
> >>>>> file.  For some reason, rather than complaining that it can't read the
> >>>>> CA certificate, Erlang just silently ignores that and throws an "unknown
> >>>>> CA" error.  Hurray!
> >>>>>
> >>>>> So, change
> >>>>>      {cacertfile,"C:\\testca\\cacert.cer"}
> >>>>> with
> >>>>>      {cacertfile,"C:\\testca\\cacert.pem"}
> >>>>>
> >>>>> Please let me know if this helps.
> >>>>>
> >>>>> Cheers,
> >>>>> Alex
> >>>>>
> >>>>> On Tue, Aug 09, 2011 at 06:22:23PM +0530, Abhijit wrote:
> >>>>>
> >>>>>
> >>>>>            
> >>>>>> ya sir that was set true, i would go back and look at my certification
> >>>>>> creation steps and find out whether i did everything properly.
> >>>>>>
> >>>>>> and would let you know once that i done.
> >>>>>>
> >>>>>> Thanks and Regards,
> >>>>>> Abhijit
> >>>>>>
> >>>>>> On 8/9/2011 6:18 PM, Alexandru Scvor?ov wrote:
> >>>>>>
> >>>>>>
> >>>>>>              
> >>>>>>>> Am basically getting this error, i tried debugging and solved most of
> >>>>>>>> the problems but still getting this:
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>                  
> >>>>>>> Oh, great. My guess about the really long error was that you needed some
> >>>>>>> clients to connect without providing certificates, but
> >>>>>>> fail_if_no_peer_cert was set to true in the config file.  Was that
> >>>>>>> right?
> >>>>>>>
> >>>>>>>
> >>>>>>>
> >>>>>>>
> >>>>>>>                
> >>>>>>>>> [{amqp-0-9://localhost:5671}] =
> >>>>>>>>> {System.Security.Authentication.AuthenticationException: A call to
> >>>>>>>>> SSPI failed, see inner exception. --->
> >>>>>>>>> System.ComponentModel.Win32Exception: The certificate chain was issued
> >>>>>>>>> by an authority that is not trusted
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>                    
> >>>>>>> I haven't seen that before.  Did you follow the steps in our SSL guide
> >>>>>>> to generate the certificate (in particular, were the client certificates
> >>>>>>> signed by the CA set in the broker)?
> >>>>>>>
> >>>>>>> Alex
> >>>>>>>
> >>>>>>> On Tue, Aug 09, 2011 at 06:08:19PM +0530, Abhijit wrote:
> >>>>>>>
> >>>>>>>
> >>>>>>>
> >>>>>>>                
> >>>>>>>> hi sir,
> >>>>>>>>
> >>>>>>>> Am basically getting this error, i tried debugging and solved most of
> >>>>>>>> the problems but still getting this:
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>                  
> >>>>>>>>> [{amqp-0-9://localhost:5671}] =
> >>>>>>>>> {System.Security.Authentication.AuthenticationException: A call to
> >>>>>>>>> SSPI failed, see inner exception. --->
> >>>>>>>>> System.ComponentModel.Win32Exception: The certificate chain was issued
> >>>>>>>>> by an authority that is not trusted
> >>>>>>>>>        --- End of inner exception stack trace -...
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>                    
> >>>>>>>> Thanks and Regards,
> >>>>>>>> Abhijit
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>
> >>>>>>>> On 8/9/2011 5:39 PM, Alexandru Scvor?ov wrote:
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>                  
> >>>>>>>>>> i would go ahead for now, if any queries i would again seek your help.
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>                      
> >>>>>>>>> Excellent.  Don't hesitate to ask us any more questions.
> >>>>>>>>>
> >>>>>>>>> Also, in the future, could you please make sure to CC the mailing list
> >>>>>>>>> when replying?
> >>>>>>>>>
> >>>>>>>>> Cheers,
> >>>>>>>>> Alex
> >>>>>>>>>
> >>>>>>>>> On Tue, Aug 09, 2011 at 05:31:22PM +0530, Abhijit wrote:
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>                    
> >>>>>>>>>> hi sir,
> >>>>>>>>>>
> >>>>>>>>>> finally got this:
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>                      
> >>>>>>>>>>> =INFO REPORT==== 9-Aug-2011::17:28:33 ===
> >>>>>>>>>>> started TCP Listener on 0.0.0.0:5672
> >>>>>>>>>>>
> >>>>>>>>>>> =INFO REPORT==== 9-Aug-2011::17:28:33 ===
> >>>>>>>>>>> started SSL Listener on 0.0.0.0:5671
> >>>>>>>>>>>
> >>>>>>>>>>>
> >>>>>>>>>>>
> >>>>>>>>>>>
> >>>>>>>>>>>                        
> >>>>>>>>>> your this step
> >>>>>>>>>>
> >>>>>>>>>> Could you copy the config file to "...\AppData\Roaming\RabbitMQ.config"
> >>>>>>>>>> and try again
> >>>>>>>>>>
> >>>>>>>>>> helped...
> >>>>>>>>>>
> >>>>>>>>>> i would go ahead for now, if any queries i would again seek your help.
> >>>>>>>>>>
> >>>>>>>>>> Thanks and Regards,
> >>>>>>>>>> Abhijit
> >>>>>>>>>>
> >>>>>>>>>> On 8/9/2011 5:20 PM, Alexandru Scvor?ov wrote:
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>                      
> >>>>>>>>>>> That's a bit odd.  I'm not sure how that can happen.  It looks like you
> >>>>>>>>>>> somehow set the RABBITMQ_CONFIG_FILE variable at some point.
> >>>>>>>>>>>
> >>>>>>>>>>> The file is normally in:
> >>>>>>>>>>> ...\AppData\Roaming\RabbitMQ\rabbitmq.config
> >>>>>>>>>>> but your system is looking for it in:
> >>>>>>>>>>> ...\AppData\Roaming\RabbitMQ.config
> >>>>>>>>>>>
> >>>>>>>>>>> Could you copy the config file to "...\AppData\Roaming\RabbitMQ.config"
> >>>>>>>>>>> and try again?  Alternatively, unset the RABBITMQ_CONFIG_FILE variable
> >>>>>>>>>>> and try again without copying the file.
> >>>>>>>>>>>
> >>>>>>>>>>> Cheers,
> >>>>>>>>>>> Alex
> >>>>>>>>>>>
> >>>>>>>>>>> On Tue, Aug 09, 2011 at 05:02:04PM +0530, Abhijit wrote:
> >>>>>>>>>>>
> >>>>>>>>>>>
> >>>>>>>>>>>
> >>>>>>>>>>>
> >>>>>>>>>>>
> >>>>>>>>>>>                        
> >>>>>>>>>>>> I deleted the dot as you asked to and also wrote the line find which
> >>>>>>>>>>>> config we are using, and found we are using the same config file and
> >>>>>>>>>>>> also broker is running successfully without the dot. Am attaching the
> >>>>>>>>>>>> print-screen for the command line output i received when i tried running
> >>>>>>>>>>>> rabbit-mq server
> >>>>>>>>>>>>
> >>>>>>>>>>>>
> >>>>>>>>>>>>
> >>>>>>>>>>>> thanks and regards,
> >>>>>>>>>>>> Abhijit
> >>>>>>>>>>>>
> >>>>>>>>>>>> On 8/9/2011 4:50 PM, Alexandru Scvor?ov wrote:
> >>>>>>>>>>>>
> >>>>>>>>>>>>
> >>>>>>>>>>>>
> >>>>>>>>>>>>
> >>>>>>>>>>>>
> >>>>>>>>>>>>                          
> >>>>>>>>>>>>> Ok.  Could you delete the dot at the end (or introduce some other
> >>>>>>>>>>>>> syntactic error) and try again?
> >>>>>>>>>>>>>
> >>>>>>>>>>>>> If it still runs, it's using a different configuration file.
> >>>>>>>>>>>>>
> >>>>>>>>>>>>> Could you also add the following line to the rabbitmq-server.bat file?
> >>>>>>>>>>>>>          echo CONFIG_FILE: !RABBITMQ_CONFIG_FILE!.config
> >>>>>>>>>>>>> It should go in towards the end, right before the "!ERLANG_HOME!\bin\erl.exe"
> >>>>>>>>>>>>> line.
> >>>>>>>>>>>>>
> >>>>>>>>>>>>> That way, when you start the server manually with the .bat, we will know
> >>>>>>>>>>>>> which config file it's using.
> >>>>>>>>>>>>>
> >>>>>>>>>>>>> Alex
> >>>>>>>>>>>>>
> >>>>>>>>>>>>> On Tue, Aug 09, 2011 at 04:42:32PM +0530, Abhijit wrote:
> >>>>>>>>>>>>>
> >>>>>>>>>>>>>
> >>>>>>>>>>>>>
> >>>>>>>>>>>>>
> >>>>>>>>>>>>>
> >>>>>>>>>>>>>
> >>>>>>>>>>>>>                            
> >>>>>>>>>>>>>> hi sir,
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>> It didn't worked as we wanted...this are the last two phrases in the log
> >>>>>>>>>>>>>> file of the broker.
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>>                              
> >>>>>>>>>>>>>>> =INFO REPORT==== 9-Aug-2011::16:39:52 ===
> >>>>>>>>>>>>>>> started TCP Listener on [::]:5692
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>> =INFO REPORT==== 9-Aug-2011::16:39:53 ===
> >>>>>>>>>>>>>>> started TCP Listener on 0.0.0.0:5692
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>                                
> >>>>>>>>>>>>>> i copied the rabbitmq.config which you sent me but didn't worked out.
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>> Thanks and Regards,
> >>>>>>>>>>>>>> Abhijit
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>> On 8/9/2011 4:19 PM, Alexandru Scvor?ov wrote:
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>>                              
> >>>>>>>>>>>>>>>> Am using the same path, C:\Users\Administrator\AppData\Roaming\RabbitMQ\rabbitmq.config for including ssl in my app.
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>>                                  
> >>>>>>>>>>>>>>> Ok.
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>                                
> >>>>>>>>>>>>>>>> But the file wasn't present earlier i had created that file in order to have SSL in my app at the same location.
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>>                                  
> >>>>>>>>>>>>>>> That's fine.
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>                                
> >>>>>>>>>>>>>>>> i tried running the bat file for the rabbitmq-server that didn't help sir, do you need any part of code for inspection.
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>>                                  
> >>>>>>>>>>>>>>> The code isn't the problem right now.  It's getting rabbit to enable
> >>>>>>>>>>>>>>> ssl.
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>> I'm attaching a rabbitmq.config.  Please try using that one.  Restart
> >>>>>>>>>>>>>>> the broker and the last lines in the broker log should be:
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>> =INFO REPORT==== 9-Aug-2011::11:44:37 ===
> >>>>>>>>>>>>>>> started TCP Listener on [::]:5672
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>> =INFO REPORT==== 9-Aug-2011::11:44:37 ===
> >>>>>>>>>>>>>>> started SSL Listener on 0.0.0.0:5671
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>> Let me know how it goes, please.
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>> Cheers,
> >>>>>>>>>>>>>>> Alex
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>> On Tue, Aug 09, 2011 at 04:09:42PM +0530, Abhijit wrote:
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>                                
> >>>>>>>>>>>>>>>> Hi Sir,
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>> Am using the same path, C:\Users\Administrator\AppData\Roaming\RabbitMQ\rabbitmq.config for including ssl in my app.
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>> But the file wasn't present earlier i had created that file in order to have SSL in my app at the same location.
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>> i tried running the bat file for the rabbitmq-server that didn't help sir, do you need any part of code for inspection.
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>> Thanks a lot for your time and replies.
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>> Regards,
> >>>>>>>>>>>>>>>> Abhijit
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>>
> >>>>>>>>>>>>>>>>                                  
> >>>>>>>>>>>>>>
> >>>>>>>>>>>>>>                              
> >>>>>>>>>>>>
> >>>>>>>>>>>>                          
> >>>>>>>>>>
> >>>>>>>>>>                      
> >>>>>>>>
> >>>>>>>>                  
> >>>>>>
> >>>>>>              
> >>>>
> >>>>          
> >>      
> 

From oded.maimon at gmail.com  Wed Aug 10 10:22:25 2011
From: oded.maimon at gmail.com (Maimon Oded)
Date: Wed, 10 Aug 2011 12:22:25 +0300
Subject: [rabbitmq-discuss] RabbitMQ as website presence system
Message-ID: <CACyzuYBa=_p+nug19AJ94qPa2oiJ9vsVXCy3X66htURZK8=sXg@mail.gmail.com>

Hi,
Do you know of anyone using RabbitMQ as a presence solution ? (like done
with XMPP servers).

if you use it for this purpose, can you describe how please?

thanks

-- 


Oded.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110810/d75b5e84/attachment.htm>

From majek04 at gmail.com  Wed Aug 10 10:23:48 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 10 Aug 2011 10:23:48 +0100
Subject: [rabbitmq-discuss] Issues starting RabbitMQ 2.5.1 on Ubuntu
	10.04
In-Reply-To: <32232090.post@talk.nabble.com>
References: <32219482.post@talk.nabble.com>
	<32232090.post@talk.nabble.com>
Message-ID: <CABzX+qzHS9+Ve49-T+=XpSfCK=2GmF-MwiH_U1Foka8=QyFU3w@mail.gmail.com>

On Wed, Aug 10, 2011 at 09:15, TreforT <trefor at tetrabyte.com> wrote:
> To add to what I have said already.
>
> I can get RabbitMQ to start if i run it from root at the prompt but it fails
> if i try and start the service.
>
> I have checked all the permissions and have not found anything wrong there.
>
> I have also updated Erlang to the latest version but am still not getting
> anywhere.
>
> Any help or questions would be really appreciated.

Well, what do logs say? /var/log/rabbitmq/startup_* and
/var/log/rabbitmq/*/*.log

Cheers,
   Marek

>
> TreforT wrote:
>>
>> Hi All,
>>
>> Wondering if you can all help me from going bald as I am pulling out my
>> hair, trying to get RabbitMQ working.
>>
>> I install it and It comes up with:
>> <pre>
>> Setting up rabbitmq-server (2.5.1-1) ...
>> Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/startup_{log,
>> _err}
>> rabbitmq-server.
>> </quoote>
>>
>
> --
> View this message in context: http://old.nabble.com/Issues-starting-RabbitMQ-2.5.1-on-Ubuntu-10.04-tp32219482p32232090.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From abhijit.sinha at kiprosh.com  Wed Aug 10 11:16:39 2011
From: abhijit.sinha at kiprosh.com (Abhijit)
Date: Wed, 10 Aug 2011 15:46:39 +0530
Subject: [rabbitmq-discuss] facing issues with the SSL implementations
 with RabbitMQ + Windows + .Net
In-Reply-To: <20110810091649.GC2869@dakota.eng.vmware.com>
References: <20110809120926.GA28785@dakota.eng.vmware.com>
	<4E412A3B.60602@kiprosh.com>
	<20110809124819.GB28785@dakota.eng.vmware.com>
	<4E412D87.2080806@kiprosh.com>
	<20110809140658.GC28785@dakota.eng.vmware.com>
	<4E414086.7010706@kiprosh.com>
	<20110809142807.GE28785@dakota.eng.vmware.com>
	<4E4146E5.4030101@kiprosh.com>
	<20110809150226.GF28785@dakota.eng.vmware.com>
	<4E422EDB.60506@kiprosh.com>
	<20110810091649.GC2869@dakota.eng.vmware.com>
Message-ID: <4E425A87.9050909@kiprosh.com>

hi sir,

Am still getting the same error am using the same config file.

But i was not able to run this command you sent me:

> openssl s_server -accept 5671 -CAfile testca/cacert.pem -cert 
> server/cert.pem -key server.key.pem -state

was getting an error: unable to load server certificate private key file.

Thanks and Regards,
Abhijit



From alexandru at rabbitmq.com  Wed Aug 10 11:27:10 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Wed, 10 Aug 2011 11:27:10 +0100
Subject: [rabbitmq-discuss] facing issues with the SSL implementations
 with RabbitMQ + Windows + .Net
In-Reply-To: <4E425A87.9050909@kiprosh.com>
References: <20110809124819.GB28785@dakota.eng.vmware.com>
	<4E412D87.2080806@kiprosh.com>
	<20110809140658.GC28785@dakota.eng.vmware.com>
	<4E414086.7010706@kiprosh.com>
	<20110809142807.GE28785@dakota.eng.vmware.com>
	<4E4146E5.4030101@kiprosh.com>
	<20110809150226.GF28785@dakota.eng.vmware.com>
	<4E422EDB.60506@kiprosh.com>
	<20110810091649.GC2869@dakota.eng.vmware.com>
	<4E425A87.9050909@kiprosh.com>
Message-ID: <20110810102710.GD2869@dakota.eng.vmware.com>

> Am still getting the same error am using the same config file.

Ok, but are you sure it's actually the file used by the server? (we had
some problems earlier about which file the server was using when started
from the command prompt or as a service)

> > openssl s_server -accept 5671 -CAfile testca/cacert.pem -cert 
> > server/cert.pem -key server.key.pem -state

My mistake.  That should be:
  openssl s_server -accept 5671 -CAfile testca/cacert.pem -cert 
  server/cert.pem -key server/key.pem -state

(dot instead of slash in server.key.pem)

BTW, if they're disposable, could you send the certificates and keys?
We've had problems before with the certificates generated by OpenSSL,
which were usually solved by using a different version.  Maybe this is
happening here.

Cheers,
Alex

On Wed, Aug 10, 2011 at 03:46:39PM +0530, Abhijit wrote:
> hi sir,
> 
> Am still getting the same error am using the same config file.
> 
> But i was not able to run this command you sent me:
> 
> > openssl s_server -accept 5671 -CAfile testca/cacert.pem -cert 
> > server/cert.pem -key server.key.pem -state
> 
> was getting an error: unable to load server certificate private key file.
> 
> Thanks and Regards,
> Abhijit
> 
> 

From abhijit.sinha at kiprosh.com  Wed Aug 10 11:30:26 2011
From: abhijit.sinha at kiprosh.com (Abhijit)
Date: Wed, 10 Aug 2011 16:00:26 +0530
Subject: [rabbitmq-discuss] facing issues with the SSL implementations
 with RabbitMQ + Windows + .Net
In-Reply-To: <20110810102710.GD2869@dakota.eng.vmware.com>
References: <20110809124819.GB28785@dakota.eng.vmware.com>
	<4E412D87.2080806@kiprosh.com>
	<20110809140658.GC28785@dakota.eng.vmware.com>
	<4E414086.7010706@kiprosh.com>
	<20110809142807.GE28785@dakota.eng.vmware.com>
	<4E4146E5.4030101@kiprosh.com>
	<20110809150226.GF28785@dakota.eng.vmware.com>
	<4E422EDB.60506@kiprosh.com>
	<20110810091649.GC2869@dakota.eng.vmware.com>
	<4E425A87.9050909@kiprosh.com>
	<20110810102710.GD2869@dakota.eng.vmware.com>
Message-ID: <4E425DC2.1050602@kiprosh.com>

yes sir
no problem i thought so after looking at client cmd lines i did put 
slash instead of dot, and now am getting this errors:

> AMQP server protocol negotiation failure: server version 
> unknown-unknown, client version 0-9

Can you tell me what are next steps?

Thanks and Regards,
Abhijit


On 8/10/2011 3:57 PM, Alexandru Scvor?ov wrote:
>> Am still getting the same error am using the same config file.
>>      
> Ok, but are you sure it's actually the file used by the server? (we had
> some problems earlier about which file the server was using when started
> from the command prompt or as a service)
>
>    
>>> openssl s_server -accept 5671 -CAfile testca/cacert.pem -cert
>>> server/cert.pem -key server.key.pem -state
>>>        
> My mistake.  That should be:
>    openssl s_server -accept 5671 -CAfile testca/cacert.pem -cert
>    server/cert.pem -key server/key.pem -state
>
> (dot instead of slash in server.key.pem)
>
> BTW, if they're disposable, could you send the certificates and keys?
> We've had problems before with the certificates generated by OpenSSL,
> which were usually solved by using a different version.  Maybe this is
> happening here.
>
> Cheers,
> Alex
>
> On Wed, Aug 10, 2011 at 03:46:39PM +0530, Abhijit wrote:
>    
>> hi sir,
>>
>> Am still getting the same error am using the same config file.
>>
>> But i was not able to run this command you sent me:
>>
>>      
>>> openssl s_server -accept 5671 -CAfile testca/cacert.pem -cert
>>> server/cert.pem -key server.key.pem -state
>>>        
>> was getting an error: unable to load server certificate private key file.
>>
>> Thanks and Regards,
>> Abhijit
>>
>>
>>      


From alexandru at rabbitmq.com  Wed Aug 10 11:40:00 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Wed, 10 Aug 2011 11:40:00 +0100
Subject: [rabbitmq-discuss] facing issues with the SSL implementations
 with RabbitMQ + Windows + .Net
In-Reply-To: <4E425DC2.1050602@kiprosh.com>
References: <20110809140658.GC28785@dakota.eng.vmware.com>
	<4E414086.7010706@kiprosh.com>
	<20110809142807.GE28785@dakota.eng.vmware.com>
	<4E4146E5.4030101@kiprosh.com>
	<20110809150226.GF28785@dakota.eng.vmware.com>
	<4E422EDB.60506@kiprosh.com>
	<20110810091649.GC2869@dakota.eng.vmware.com>
	<4E425A87.9050909@kiprosh.com>
	<20110810102710.GD2869@dakota.eng.vmware.com>
	<4E425DC2.1050602@kiprosh.com>
Message-ID: <20110810104000.GE2869@dakota.eng.vmware.com>

> > AMQP server protocol negotiation failure: server version 
> > unknown-unknown, client version 0-9

That means the client connected successfully but closed the connection
later because it wasn't talking to an AMQP server.

That means that the client and certificates are fine, so the problem is
configuring the server.

When you try the other command (the openssl s_client) on the server,
what output do you get?  Could you please post it?

Alex

On Wed, Aug 10, 2011 at 04:00:26PM +0530, Abhijit wrote:
> yes sir
> no problem i thought so after looking at client cmd lines i did put 
> slash instead of dot, and now am getting this errors:
> 
> > AMQP server protocol negotiation failure: server version 
> > unknown-unknown, client version 0-9
> 
> Can you tell me what are next steps?
> 
> Thanks and Regards,
> Abhijit
> 
> 
> On 8/10/2011 3:57 PM, Alexandru Scvor?ov wrote:
> >> Am still getting the same error am using the same config file.
> >>      
> > Ok, but are you sure it's actually the file used by the server? (we had
> > some problems earlier about which file the server was using when started
> > from the command prompt or as a service)
> >
> >    
> >>> openssl s_server -accept 5671 -CAfile testca/cacert.pem -cert
> >>> server/cert.pem -key server.key.pem -state
> >>>        
> > My mistake.  That should be:
> >    openssl s_server -accept 5671 -CAfile testca/cacert.pem -cert
> >    server/cert.pem -key server/key.pem -state
> >
> > (dot instead of slash in server.key.pem)
> >
> > BTW, if they're disposable, could you send the certificates and keys?
> > We've had problems before with the certificates generated by OpenSSL,
> > which were usually solved by using a different version.  Maybe this is
> > happening here.
> >
> > Cheers,
> > Alex
> >
> > On Wed, Aug 10, 2011 at 03:46:39PM +0530, Abhijit wrote:
> >    
> >> hi sir,
> >>
> >> Am still getting the same error am using the same config file.
> >>
> >> But i was not able to run this command you sent me:
> >>
> >>      
> >>> openssl s_server -accept 5671 -CAfile testca/cacert.pem -cert
> >>> server/cert.pem -key server.key.pem -state
> >>>        
> >> was getting an error: unable to load server certificate private key file.
> >>
> >> Thanks and Regards,
> >> Abhijit
> >>
> >>
> >>      
> 

From abhijit.sinha at kiprosh.com  Wed Aug 10 11:46:18 2011
From: abhijit.sinha at kiprosh.com (Abhijit)
Date: Wed, 10 Aug 2011 16:16:18 +0530
Subject: [rabbitmq-discuss] facing issues with the SSL implementations
 with RabbitMQ + Windows + .Net
In-Reply-To: <20110810104000.GE2869@dakota.eng.vmware.com>
References: <20110809140658.GC28785@dakota.eng.vmware.com>
	<4E414086.7010706@kiprosh.com>
	<20110809142807.GE28785@dakota.eng.vmware.com>
	<4E4146E5.4030101@kiprosh.com>
	<20110809150226.GF28785@dakota.eng.vmware.com>
	<4E422EDB.60506@kiprosh.com>
	<20110810091649.GC2869@dakota.eng.vmware.com>
	<4E425A87.9050909@kiprosh.com>
	<20110810102710.GD2869@dakota.eng.vmware.com>
	<4E425DC2.1050602@kiprosh.com>
	<20110810104000.GE2869@dakota.eng.vmware.com>
Message-ID: <4E42617A.3090601@kiprosh.com>

Ok sir thanks,

this is the post for the former command s_client:
> C:\>openssl s_client -connect localhost:5671 -CAfile testca/cacert.pem 
> -cert cli
> ent/cert.pem -key client/key.pem -showcerts
> Loading 'screen' into random state - done
> CONNECTED(00000160)
> depth=1 CN = Kiprosh7
> verify return:1
> depth=0 CN = Kiprosh7, O = server
> verify return:1
> ---
> Certificate chain
>  0 s:/CN=Kiprosh7/O=server
>    i:/CN=Kiprosh7
> -----BEGIN CERTIFICATE-----
> MIIC4TCCAcmgAwIBAgIBATANBgkqhkiG9w0BAQUFADATMREwDwYDVQQDEwhLaXBy
> b3NoNzAeFw0xMTA4MTAwODA1NTBaFw0xMjA4MDkwODA1NTBaMCQxETAPBgNVBAMM
> CEtpcHJvc2g3MQ8wDQYDVQQKDAZzZXJ2ZXIwggEiMA0GCSqGSIb3DQEBAQUAA4IB
> DwAwggEKAoIBAQDTDgQ3/vSBPvy0PAZYwk4H2qlFckaA75YfCYZ+HhIb+JUSrZ4r
> NcBEhvrH+7p1yft9IC4pgrgEbjmfQVTi8LGwtMRZmwpbmjqEfOALpra5x7Plb+7y
> CTT/iDc8uUwHLn2brXxNRn58IrEeD1X+rBxLNyek0pQu/hH31+REI5Sn1JZfi7gc
> 3PJEuaRzVJY4sE0neNWT+K+aD0n382qnziLEGOusXWNpggpoHVFKZR3Yojxj6Bfk
> 9lUvfUtIqz2zQ2dF0q6A0QVVlIenKzUK+rjHxQAUSb8P9CmCuRXUih3f61ahquQP
> CgSrkNnUV44D/wHfnxNm9QjxlQEGyr0DsTcFAgMBAAGjLzAtMAkGA1UdEwQCMAAw
> CwYDVR0PBAQDAgUgMBMGA1UdJQQMMAoGCCsGAQUFBwMBMA0GCSqGSIb3DQEBBQUA
> A4IBAQDE+cXjx6uNL/Kf/HmE7FeQ238iN7Gfb+I1QHmbRaR0qbTqcFzp7NCJ62uq
> nJ6Anj0+h1IFNMlQrCISSS0fnSj+mXMKDodZzV+cXFjdtoEXyqdDO0zphDMTRd8H
> oI79XSm5IK6vcPR+g2UTkhgrX1xfgeqZ8hmw0L0mMMGHXclwwaAF9HRNomFt32gr
> 1sVhFkhH/5epmgcl+8yI1E7UaQc91bYkUEuQFNu7irgc+/tvcXa4O4+dIfhnzrog
> 8piYUk4dxGME8LknQ213Gow9cgEKzcYadJ4DIr6gChkvAnYpHHHafWj/Ksvxyii6
> 8FxuTfgsrOYwkqEcSXeCGUS25nU9
> -----END CERTIFICATE-----
>  1 s:/CN=Kiprosh7
>    i:/CN=Kiprosh7
> -----BEGIN CERTIFICATE-----
> MIICxjCCAa6gAwIBAgIJANsNRAs/ueOoMA0GCSqGSIb3DQEBBQUAMBMxETAPBgNV
> BAMTCEtpcHJvc2g3MB4XDTExMDgxMDA4MDEzMloXDTEyMDgwOTA4MDEzMlowEzER
> MA8GA1UEAxMIS2lwcm9zaDcwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIB
> AQDorxS4o/H/w7f+VYWkQk3gS7g7gWFd3S4eCVV35a3GEcyP2OS4pUhhZXyB0lN7
> xmUHqeixx7aNRnrc130SQ4kke1fuxtdLjKxu+oeASMLCSkF356m8X5FhuTnPkf2W
> x64i6nk9SOO+jdQo/kMChy0H7psKS5I2M0nb5WLxN/JOACNnxJOhFy8cGw7l32q6
> rEfqLkdnZJR09fiuf0hEbb/UodOt2tXXGN0Pp3X2x4cXnD6E2Va9QSBYIvPAnWEn
> FN2Te+Qwg+AxwHIkCjH9bfQ7fOeuGHAoanSnlqS5rW/T5sKKlkBl95WeJoTFjrCt
> CVDLilsnLrfmZkg3ICQtPbgNAgMBAAGjHTAbMAwGA1UdEwQFMAMBAf8wCwYDVR0P
> BAQDAgEGMA0GCSqGSIb3DQEBBQUAA4IBAQBGtbJQyQ1pWVo+7snqxCOn/KVN++Jo
> 8YEB4/MGKgHyoTWRAa3IXOSPtpunW/6yDziwcLZeO09MATeKCCAJf64LXZr7aM6J
> ZX6hFFNUyqa5w9AaZ4sAe70QwDYPS6dPqcyTab/DVVRGhJAKhUc2lX+UfcBhHYaz
> egKDKyIybHMmcQQm//SO0jo3Ak0565ZAMCdaaO/9RNJpJSxJf+HSVUg4sPLe/sAK
> QlXcdt8XlKsEKBzUHzfRvpbU/8gn1HO5G+CTvEW2kO6nssuKX41g5hMfRqu248TT
> jbGWMkYFMPDY1m2QWPqzLvaETGOWHwqpVWXuMhu7/T5sduDf2n084ok7
> -----END CERTIFICATE-----
> ---
> Server certificate
> subject=/CN=Kiprosh7/O=server
> issuer=/CN=Kiprosh7
> ---
> Acceptable client certificate CA names
> /CN=Kiprosh7
> ---
> SSL handshake has read 1663 bytes and written 2276 bytes
> ---
> New, TLSv1/SSLv3, Cipher is AES256-SHA
> Server public key is 2048 bit
> Secure Renegotiation IS supported
> Compression: NONE
> Expansion: NONE
> SSL-Session:
>     Protocol  : TLSv1
>     Cipher    : AES256-SHA
>     Session-ID: 
> 8703D018C270CC932648333F61FE3C986CB336B7C8074ACF3560E415934E26F2
>
>     Session-ID-ctx:
>     Master-Key: 
> F5B8C5666355EE6C78910EBB649A65740104537ACEBB28E4A23DF51EA5DE9E6A
> FE3AC2C95B1929985DAFC09CDC6BDEAE
>     Key-Arg   : None
>     PSK identity: None
>     PSK identity hint: None
>     Start Time: 1312972974
>     Timeout   : 300 (sec)
>     Verify return code: 0 (ok)
> ---

Thanks and Regards,
Abhijit


On 8/10/2011 4:10 PM, Alexandru Scvor?ov wrote:
>>> AMQP server protocol negotiation failure: server version
>>> unknown-unknown, client version 0-9
>>>        
> That means the client connected successfully but closed the connection
> later because it wasn't talking to an AMQP server.
>
> That means that the client and certificates are fine, so the problem is
> configuring the server.
>
> When you try the other command (the openssl s_client) on the server,
> what output do you get?  Could you please post it?
>
> Alex
>
> On Wed, Aug 10, 2011 at 04:00:26PM +0530, Abhijit wrote:
>    
>> yes sir
>> no problem i thought so after looking at client cmd lines i did put
>> slash instead of dot, and now am getting this errors:
>>
>>      
>>> AMQP server protocol negotiation failure: server version
>>> unknown-unknown, client version 0-9
>>>        
>> Can you tell me what are next steps?
>>
>> Thanks and Regards,
>> Abhijit
>>
>>
>> On 8/10/2011 3:57 PM, Alexandru Scvor?ov wrote:
>>      
>>>> Am still getting the same error am using the same config file.
>>>>
>>>>          
>>> Ok, but are you sure it's actually the file used by the server? (we had
>>> some problems earlier about which file the server was using when started
>>> from the command prompt or as a service)
>>>
>>>
>>>        
>>>>> openssl s_server -accept 5671 -CAfile testca/cacert.pem -cert
>>>>> server/cert.pem -key server.key.pem -state
>>>>>
>>>>>            
>>> My mistake.  That should be:
>>>     openssl s_server -accept 5671 -CAfile testca/cacert.pem -cert
>>>     server/cert.pem -key server/key.pem -state
>>>
>>> (dot instead of slash in server.key.pem)
>>>
>>> BTW, if they're disposable, could you send the certificates and keys?
>>> We've had problems before with the certificates generated by OpenSSL,
>>> which were usually solved by using a different version.  Maybe this is
>>> happening here.
>>>
>>> Cheers,
>>> Alex
>>>
>>> On Wed, Aug 10, 2011 at 03:46:39PM +0530, Abhijit wrote:
>>>
>>>        
>>>> hi sir,
>>>>
>>>> Am still getting the same error am using the same config file.
>>>>
>>>> But i was not able to run this command you sent me:
>>>>
>>>>
>>>>          
>>>>> openssl s_server -accept 5671 -CAfile testca/cacert.pem -cert
>>>>> server/cert.pem -key server.key.pem -state
>>>>>
>>>>>            
>>>> was getting an error: unable to load server certificate private key file.
>>>>
>>>> Thanks and Regards,
>>>> Abhijit
>>>>
>>>>
>>>>
>>>>          
>>      


From taylste at gmail.com  Wed Aug 10 12:45:07 2011
From: taylste at gmail.com (Steven Taylor)
Date: Wed, 10 Aug 2011 12:45:07 +0100
Subject: [rabbitmq-discuss] BasicProperties
Message-ID: <CA+zYriSzpso86o8Ze3XTJfp-aQKLaJjPTuiM4XH0gMgL1t_CAQ@mail.gmail.com>

Does RabbitMQ do anything with ".Expiration"?

How about .ProtocolClassID & .ProtocolClassName?

Just checking... ReplyTo & a ReplyToAddress should mirror each other right?
 Does placing a value in one populate the other?

thanks,
-Steven
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110810/1710cc33/attachment.htm>

From alexandru at rabbitmq.com  Wed Aug 10 12:50:56 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Wed, 10 Aug 2011 12:50:56 +0100
Subject: [rabbitmq-discuss] facing issues with the SSL implementations
 with RabbitMQ + Windows + .Net
In-Reply-To: <4E42617A.3090601@kiprosh.com>
References: <20110809142807.GE28785@dakota.eng.vmware.com>
	<4E4146E5.4030101@kiprosh.com>
	<20110809150226.GF28785@dakota.eng.vmware.com>
	<4E422EDB.60506@kiprosh.com>
	<20110810091649.GC2869@dakota.eng.vmware.com>
	<4E425A87.9050909@kiprosh.com>
	<20110810102710.GD2869@dakota.eng.vmware.com>
	<4E425DC2.1050602@kiprosh.com>
	<20110810104000.GE2869@dakota.eng.vmware.com>
	<4E42617A.3090601@kiprosh.com>
Message-ID: <20110810115056.GF2869@dakota.eng.vmware.com>

:(  That seems perfectly fine.

Other ways to get an "unknown ca" error:
  - forget to add the CA certificate to the Trust store;
  - have the client use a certificate signed by a different authority
    than the one given to the server.

I'm out of ideas.  I'm attaching:
  - cacert.pem and cacert.cer;
  - keycert.p12 (password is "test");
  - server's cert.pem, key.pem.

You'll also need to set RemoteCertificateNameMismatch before starting the connection:
  cf.Ssl.AcceptablePolicyErrors =
    SslPolicyErrors.RemoteCertificateNameMismatch;

Could you please try with these and see if it works (or if you get a
different error)?

Cheers,
Alex

On Wed, Aug 10, 2011 at 04:16:18PM +0530, Abhijit wrote:
> Ok sir thanks,
> 
> this is the post for the former command s_client:
> > C:\>openssl s_client -connect localhost:5671 -CAfile testca/cacert.pem 
> > -cert cli
> > ent/cert.pem -key client/key.pem -showcerts
> > Loading 'screen' into random state - done
> > CONNECTED(00000160)
> > depth=1 CN = Kiprosh7
> > verify return:1
> > depth=0 CN = Kiprosh7, O = server
> > verify return:1
> > ---
> > Certificate chain
> >  0 s:/CN=Kiprosh7/O=server
> >    i:/CN=Kiprosh7
> > -----BEGIN CERTIFICATE-----
> > MIIC4TCCAcmgAwIBAgIBATANBgkqhkiG9w0BAQUFADATMREwDwYDVQQDEwhLaXBy
> > b3NoNzAeFw0xMTA4MTAwODA1NTBaFw0xMjA4MDkwODA1NTBaMCQxETAPBgNVBAMM
> > CEtpcHJvc2g3MQ8wDQYDVQQKDAZzZXJ2ZXIwggEiMA0GCSqGSIb3DQEBAQUAA4IB
> > DwAwggEKAoIBAQDTDgQ3/vSBPvy0PAZYwk4H2qlFckaA75YfCYZ+HhIb+JUSrZ4r
> > NcBEhvrH+7p1yft9IC4pgrgEbjmfQVTi8LGwtMRZmwpbmjqEfOALpra5x7Plb+7y
> > CTT/iDc8uUwHLn2brXxNRn58IrEeD1X+rBxLNyek0pQu/hH31+REI5Sn1JZfi7gc
> > 3PJEuaRzVJY4sE0neNWT+K+aD0n382qnziLEGOusXWNpggpoHVFKZR3Yojxj6Bfk
> > 9lUvfUtIqz2zQ2dF0q6A0QVVlIenKzUK+rjHxQAUSb8P9CmCuRXUih3f61ahquQP
> > CgSrkNnUV44D/wHfnxNm9QjxlQEGyr0DsTcFAgMBAAGjLzAtMAkGA1UdEwQCMAAw
> > CwYDVR0PBAQDAgUgMBMGA1UdJQQMMAoGCCsGAQUFBwMBMA0GCSqGSIb3DQEBBQUA
> > A4IBAQDE+cXjx6uNL/Kf/HmE7FeQ238iN7Gfb+I1QHmbRaR0qbTqcFzp7NCJ62uq
> > nJ6Anj0+h1IFNMlQrCISSS0fnSj+mXMKDodZzV+cXFjdtoEXyqdDO0zphDMTRd8H
> > oI79XSm5IK6vcPR+g2UTkhgrX1xfgeqZ8hmw0L0mMMGHXclwwaAF9HRNomFt32gr
> > 1sVhFkhH/5epmgcl+8yI1E7UaQc91bYkUEuQFNu7irgc+/tvcXa4O4+dIfhnzrog
> > 8piYUk4dxGME8LknQ213Gow9cgEKzcYadJ4DIr6gChkvAnYpHHHafWj/Ksvxyii6
> > 8FxuTfgsrOYwkqEcSXeCGUS25nU9
> > -----END CERTIFICATE-----
> >  1 s:/CN=Kiprosh7
> >    i:/CN=Kiprosh7
> > -----BEGIN CERTIFICATE-----
> > MIICxjCCAa6gAwIBAgIJANsNRAs/ueOoMA0GCSqGSIb3DQEBBQUAMBMxETAPBgNV
> > BAMTCEtpcHJvc2g3MB4XDTExMDgxMDA4MDEzMloXDTEyMDgwOTA4MDEzMlowEzER
> > MA8GA1UEAxMIS2lwcm9zaDcwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIB
> > AQDorxS4o/H/w7f+VYWkQk3gS7g7gWFd3S4eCVV35a3GEcyP2OS4pUhhZXyB0lN7
> > xmUHqeixx7aNRnrc130SQ4kke1fuxtdLjKxu+oeASMLCSkF356m8X5FhuTnPkf2W
> > x64i6nk9SOO+jdQo/kMChy0H7psKS5I2M0nb5WLxN/JOACNnxJOhFy8cGw7l32q6
> > rEfqLkdnZJR09fiuf0hEbb/UodOt2tXXGN0Pp3X2x4cXnD6E2Va9QSBYIvPAnWEn
> > FN2Te+Qwg+AxwHIkCjH9bfQ7fOeuGHAoanSnlqS5rW/T5sKKlkBl95WeJoTFjrCt
> > CVDLilsnLrfmZkg3ICQtPbgNAgMBAAGjHTAbMAwGA1UdEwQFMAMBAf8wCwYDVR0P
> > BAQDAgEGMA0GCSqGSIb3DQEBBQUAA4IBAQBGtbJQyQ1pWVo+7snqxCOn/KVN++Jo
> > 8YEB4/MGKgHyoTWRAa3IXOSPtpunW/6yDziwcLZeO09MATeKCCAJf64LXZr7aM6J
> > ZX6hFFNUyqa5w9AaZ4sAe70QwDYPS6dPqcyTab/DVVRGhJAKhUc2lX+UfcBhHYaz
> > egKDKyIybHMmcQQm//SO0jo3Ak0565ZAMCdaaO/9RNJpJSxJf+HSVUg4sPLe/sAK
> > QlXcdt8XlKsEKBzUHzfRvpbU/8gn1HO5G+CTvEW2kO6nssuKX41g5hMfRqu248TT
> > jbGWMkYFMPDY1m2QWPqzLvaETGOWHwqpVWXuMhu7/T5sduDf2n084ok7
> > -----END CERTIFICATE-----
> > ---
> > Server certificate
> > subject=/CN=Kiprosh7/O=server
> > issuer=/CN=Kiprosh7
> > ---
> > Acceptable client certificate CA names
> > /CN=Kiprosh7
> > ---
> > SSL handshake has read 1663 bytes and written 2276 bytes
> > ---
> > New, TLSv1/SSLv3, Cipher is AES256-SHA
> > Server public key is 2048 bit
> > Secure Renegotiation IS supported
> > Compression: NONE
> > Expansion: NONE
> > SSL-Session:
> >     Protocol  : TLSv1
> >     Cipher    : AES256-SHA
> >     Session-ID: 
> > 8703D018C270CC932648333F61FE3C986CB336B7C8074ACF3560E415934E26F2
> >
> >     Session-ID-ctx:
> >     Master-Key: 
> > F5B8C5666355EE6C78910EBB649A65740104537ACEBB28E4A23DF51EA5DE9E6A
> > FE3AC2C95B1929985DAFC09CDC6BDEAE
> >     Key-Arg   : None
> >     PSK identity: None
> >     PSK identity hint: None
> >     Start Time: 1312972974
> >     Timeout   : 300 (sec)
> >     Verify return code: 0 (ok)
> > ---
> 
> Thanks and Regards,
> Abhijit
> 
> 
> On 8/10/2011 4:10 PM, Alexandru Scvor?ov wrote:
> >>> AMQP server protocol negotiation failure: server version
> >>> unknown-unknown, client version 0-9
> >>>        
> > That means the client connected successfully but closed the connection
> > later because it wasn't talking to an AMQP server.
> >
> > That means that the client and certificates are fine, so the problem is
> > configuring the server.
> >
> > When you try the other command (the openssl s_client) on the server,
> > what output do you get?  Could you please post it?
> >
> > Alex
> >
> > On Wed, Aug 10, 2011 at 04:00:26PM +0530, Abhijit wrote:
> >    
> >> yes sir
> >> no problem i thought so after looking at client cmd lines i did put
> >> slash instead of dot, and now am getting this errors:
> >>
> >>      
> >>> AMQP server protocol negotiation failure: server version
> >>> unknown-unknown, client version 0-9
> >>>        
> >> Can you tell me what are next steps?
> >>
> >> Thanks and Regards,
> >> Abhijit
> >>
> >>
> >> On 8/10/2011 3:57 PM, Alexandru Scvor?ov wrote:
> >>      
> >>>> Am still getting the same error am using the same config file.
> >>>>
> >>>>          
> >>> Ok, but are you sure it's actually the file used by the server? (we had
> >>> some problems earlier about which file the server was using when started
> >>> from the command prompt or as a service)
> >>>
> >>>
> >>>        
> >>>>> openssl s_server -accept 5671 -CAfile testca/cacert.pem -cert
> >>>>> server/cert.pem -key server.key.pem -state
> >>>>>
> >>>>>            
> >>> My mistake.  That should be:
> >>>     openssl s_server -accept 5671 -CAfile testca/cacert.pem -cert
> >>>     server/cert.pem -key server/key.pem -state
> >>>
> >>> (dot instead of slash in server.key.pem)
> >>>
> >>> BTW, if they're disposable, could you send the certificates and keys?
> >>> We've had problems before with the certificates generated by OpenSSL,
> >>> which were usually solved by using a different version.  Maybe this is
> >>> happening here.
> >>>
> >>> Cheers,
> >>> Alex
> >>>
> >>> On Wed, Aug 10, 2011 at 03:46:39PM +0530, Abhijit wrote:
> >>>
> >>>        
> >>>> hi sir,
> >>>>
> >>>> Am still getting the same error am using the same config file.
> >>>>
> >>>> But i was not able to run this command you sent me:
> >>>>
> >>>>
> >>>>          
> >>>>> openssl s_server -accept 5671 -CAfile testca/cacert.pem -cert
> >>>>> server/cert.pem -key server.key.pem -state
> >>>>>
> >>>>>            
> >>>> was getting an error: unable to load server certificate private key file.
> >>>>
> >>>> Thanks and Regards,
> >>>> Abhijit
> >>>>
> >>>>
> >>>>
> >>>>          
> >>      
> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: keycert.p12
Type: application/x-pkcs12
Size: 2357 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110810/2eb7b0d4/attachment.p12>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: cacert.cer
Type: application/pkix-cert
Size: 746 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110810/2eb7b0d4/attachment.bin>
-------------- next part --------------
-----BEGIN CERTIFICATE-----
MIIC5jCCAc6gAwIBAgIJAL3Z+zQ26lqZMA0GCSqGSIb3DQEBBQUAMCMxETAPBgNV
BAMTCE15VGVzdENBMQ4wDAYDVQQHEwUxNzY5NDAeFw0xMTA3MTMxMDQ3MTJaFw0x
MjA3MTIxMDQ3MTJaMCMxETAPBgNVBAMTCE15VGVzdENBMQ4wDAYDVQQHEwUxNzY5
NDCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAMdYkpUlz0S02FrGgPQW
nl759SkeDvRSdfNIOzjSPx805oCfG5zPyVHVZes/GPaFyj8siqbLpTxDAL3cb08g
2yfVoQQnoM+Dz510Du4IJvhb+eWCL8bcLXO/STCZUz2ICj8zNnO/kUm3p7M23aAN
kPJoVG6mqcqR5zG5sCTIBp4T3ALQlWMJjRxhKgVfDj7ZQsO4U2/AsMvEeOjvN32x
Dd0b2CHYifJw4h2RXcQ5G1gCiFWNhmV9bos5EfE/HTf5gGUODvO0U8tn4TBIFhSV
NmOt0Rjo3mXZWnsNs4gVXQCV+oNg7yOuL3MWx21TntNWb98ZQcvTxbFon1ML5n3c
R6sCAwEAAaMdMBswDAYDVR0TBAUwAwEB/zALBgNVHQ8EBAMCAQYwDQYJKoZIhvcN
AQEFBQADggEBAL5tDd6ROWMsIdCgvao1c4frZSbXPr4QC2nEK3Dbpb0nCKj7Cza4
hcUC0szfEv3AcQfTao9V+vk/IbzxUsKcIlOBq5nLQUT3q0tRxYsONiL8PfetsFWe
SKMY+wQChTFVW7/NRnpLx8tAHtw5locK2f4N1bwog9ZquYQxTdPWDxNIO/y5lWFs
DoaHkCb3J7TYJKSnT8IJDvOz2BmWbbw2hPkIE9UDrJL/QjcYIoz4A740NEXvFqkC
ZeXQJbQnuJOsFR3W0HHgMYps3tqrL/tKo83yyee3lPQNFaMabtvm/+zzU9J6RqQJ
lc6FTn+VLWyqHe8qtXjLSD71RzjwEA5aXGE=
-----END CERTIFICATE-----
-------------- next part --------------
-----BEGIN RSA PRIVATE KEY-----
MIIEpAIBAAKCAQEAr6F8Lc6tyghJrLJfKXq2lRUUAaUBvCVUnQWlaMXWGSM9OboS
z5tXw00rLJhk3aurVcKbEAtuZ86q6P4M9AdxARA16VAd/XWR8AeYrPi1ImzNBeZO
MZMFfGXRAkTYN7MuET3DcPIwmiz5/eOXAhgqmNhP77opfFScTZl8iwTWQ5lbw20B
teTYNgJ11g4G68qK5omKPr3W0Za8VlZlYxNfIfEUdRxPMI/lGCClvikW7vcblyaB
VQ5K1q13eNXd2LjKnrF6078LVrYzdxPKVyinxreifblOTdH3FmIwd5dDtrbvSUUo
TbhyoGIGiPyzQi5ZTzN/TsDW1+lB153aYMyTAQIDAQABAoIBAGZhwL4DSZQImMov
gQHxIxZtHyiGRCilqlmOvQoCqfglbr+EFQspB1Q2XAC3JbWDKXHo6/PCdi3VcBQ6
ZNqsq9du176WkaT7MIO4KexLX2wd+LaDtvl3Ny95OwoTj+eIcEZkttXUmTiHF4RF
c/YomExZbN/WqfBscmFaJBv2SeFFQXCnkC5mrxFStkO8UQmyRY48qiR+0OlCYjL3
3vvRyjBKNsqBpjj3C3gjPrLPgz0IYYK1iBqP+xDPZmOFLfRZMzMTOQi+/Ui6pLI+
lCi2DFwkTVZMElx/CmetpQjRXGTVls75iMVwulnuoJunK2ccqTxvyvAg/NmDFjqU
4LXif0ECgYEA4NYAph+N3m3BpfGexY757oaXBYSCbZ91NrTcbbQP28MA5k6Zsejt
zM1XT+TLeuv0b2Q/VuVMG/McBVWO+DumsgtVIvm02l7LzMviZ9wWIsMk1H63Rsmd
qB2fS4+B24at2GK8Am16sBIItMIlfYbpljEC2vmwmtMMQ5MK6Y8emAUCgYEAx/mB
QkWI7XPdKNYvRS6VYVLFnr7xbITZ6B/eJVUAobmqT00vRwkXmTIOM4bgZYse/KRl
NCOHZGkBkfX0hRxdti2gEyeVBQoWwFIFyUACbimoIV1ELQmYiLcJ8gYWY/3Ymrdb
/F0+HB2Npkyy3uZXY2U2WvHkG/+3qGDbjln0K80CgYEAk0IW8rdACCsC5lk2kFZw
xBVK3MZJVttVvhr/NKr2qA00jaN1bt0Mw1LKmP1VeJEKa9rQ0W0lSDkWZTgAh/0p
1PsvK9U46r2j5eKzyyqPJP2DJdpI2Ag9RlsAdlDr0IiJXGxuj3h9Hszw/tMaEvlG
DKTVJe7cCMuqAKhSQV8HvrECgYB9PqFcNly6C3UaXHsiozhfyg2HjSN7ygEIRt1F
GGXa5IPsQvU3UlR7WERYtULZljaEGRphe1cS5klbd2X78HYo4Y5+MK4+h8EUFssU
7ogXIvPwYY+PfZERH0KVWIaxfY0p6WktN+Dsjv3mh+cHf9B/qiZO82zgtFn8lR0t
nN02iQKBgQCyNCuvnej3/26maZzMT1x7U1UNp6pVmhQtOXImbhMVG7cb889mEvNp
pA/p7Gus6anL63A5pGm+wjSTGdC4AXPQNlQjkrgHL4YPGuWAlAAehEtEAIv7vtpj
P4k2dU7oLmoOQdqHy1nmqzTXiNZap4hoZK0PN8K6xMlzexu9JTE4PA==
-----END RSA PRIVATE KEY-----
-------------- next part --------------
-----BEGIN CERTIFICATE-----
MIIC8DCCAdigAwIBAgIBAzANBgkqhkiG9w0BAQUFADAjMREwDwYDVQQDEwhNeVRl
c3RDQTEOMAwGA1UEBxMFMTc2OTQwHhcNMTEwODA5MTM0MzE0WhcNMTIwODA4MTM0
MzE0WjAjMRAwDgYDVQQDEwdXSU5IT1NUMQ8wDQYDVQQKEwZzZXJ2ZXIwggEiMA0G
CSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCvoXwtzq3KCEmssl8peraVFRQBpQG8
JVSdBaVoxdYZIz05uhLPm1fDTSssmGTdq6tVwpsQC25nzqro/gz0B3EBEDXpUB39
dZHwB5is+LUibM0F5k4xkwV8ZdECRNg3sy4RPcNw8jCaLPn945cCGCqY2E/vuil8
VJxNmXyLBNZDmVvDbQG15Ng2AnXWDgbryormiYo+vdbRlrxWVmVjE18h8RR1HE8w
j+UYIKW+KRbu9xuXJoFVDkrWrXd41d3YuMqesXrTvwtWtjN3E8pXKKfGt6J9uU5N
0fcWYjB3l0O2tu9JRShNuHKgYgaI/LNCLllPM39OwNbX6UHXndpgzJMBAgMBAAGj
LzAtMAkGA1UdEwQCMAAwCwYDVR0PBAQDAgUgMBMGA1UdJQQMMAoGCCsGAQUFBwMB
MA0GCSqGSIb3DQEBBQUAA4IBAQCwmhVuvZqCfKGjmm+nU24eleFFSQa0qucR79JM
exTD+w1/h+XeQQAtvkHR0NJrFBN5IJ2qYbXZ1rVb8dLBmjpEFlo3XkqANm/Xnxc8
6Ko5JrjUFRhsz+YD1njLHojYWr5sLnENozCN6x1fiPzwhfWf5pe0xhaX7Z7nC6BD
McM4zZ9j/zcNUwBR7kqJR88tb6M2srHTdRjr69Uz48J6eFPu5sWDG3PzbKazIL6v
eTnDDP0P7+5OEngU+IqiMqIH1ODCbh81soQrq+6INC3kK7XsMA/fDVMPwKmeWPnK
JJBo/g5zO4nUxZ4Dp4rW0hm3JY+DF1UTQ0FVUlWqhoqpJQef
-----END CERTIFICATE-----

From abhijit.sinha at kiprosh.com  Wed Aug 10 13:00:42 2011
From: abhijit.sinha at kiprosh.com (Abhijit)
Date: Wed, 10 Aug 2011 17:30:42 +0530
Subject: [rabbitmq-discuss] facing issues with the SSL implementations
 with RabbitMQ + Windows + .Net
In-Reply-To: <20110810115056.GF2869@dakota.eng.vmware.com>
References: <20110809142807.GE28785@dakota.eng.vmware.com>
	<4E4146E5.4030101@kiprosh.com>
	<20110809150226.GF28785@dakota.eng.vmware.com>
	<4E422EDB.60506@kiprosh.com>
	<20110810091649.GC2869@dakota.eng.vmware.com>
	<4E425A87.9050909@kiprosh.com>
	<20110810102710.GD2869@dakota.eng.vmware.com>
	<4E425DC2.1050602@kiprosh.com>
	<20110810104000.GE2869@dakota.eng.vmware.com>
	<4E42617A.3090601@kiprosh.com>
	<20110810115056.GF2869@dakota.eng.vmware.com>
Message-ID: <4E4272EA.9040308@kiprosh.com>

Hi sir,

The code worked now. the certificate you provided did work wondering why 
my certificates are not working??

Thanks and Regards,
Abhijit



On 8/10/2011 5:20 PM, Alexandru Scvor?ov wrote:
> :(  That seems perfectly fine.
>
> Other ways to get an "unknown ca" error:
>    - forget to add the CA certificate to the Trust store;
>    - have the client use a certificate signed by a different authority
>      than the one given to the server.
>
> I'm out of ideas.  I'm attaching:
>    - cacert.pem and cacert.cer;
>    - keycert.p12 (password is "test");
>    - server's cert.pem, key.pem.
>
> You'll also need to set RemoteCertificateNameMismatch before starting the connection:
>    cf.Ssl.AcceptablePolicyErrors =
>      SslPolicyErrors.RemoteCertificateNameMismatch;
>
> Could you please try with these and see if it works (or if you get a
> different error)?
>
> Cheers,
> Alex
>
> On Wed, Aug 10, 2011 at 04:16:18PM +0530, Abhijit wrote:
>    
>> Ok sir thanks,
>>
>> this is the post for the former command s_client:
>>      
>>> C:\>openssl s_client -connect localhost:5671 -CAfile testca/cacert.pem
>>> -cert cli
>>> ent/cert.pem -key client/key.pem -showcerts
>>> Loading 'screen' into random state - done
>>> CONNECTED(00000160)
>>> depth=1 CN = Kiprosh7
>>> verify return:1
>>> depth=0 CN = Kiprosh7, O = server
>>> verify return:1
>>> ---
>>> Certificate chain
>>>   0 s:/CN=Kiprosh7/O=server
>>>     i:/CN=Kiprosh7
>>> -----BEGIN CERTIFICATE-----
>>> MIIC4TCCAcmgAwIBAgIBATANBgkqhkiG9w0BAQUFADATMREwDwYDVQQDEwhLaXBy
>>> b3NoNzAeFw0xMTA4MTAwODA1NTBaFw0xMjA4MDkwODA1NTBaMCQxETAPBgNVBAMM
>>> CEtpcHJvc2g3MQ8wDQYDVQQKDAZzZXJ2ZXIwggEiMA0GCSqGSIb3DQEBAQUAA4IB
>>> DwAwggEKAoIBAQDTDgQ3/vSBPvy0PAZYwk4H2qlFckaA75YfCYZ+HhIb+JUSrZ4r
>>> NcBEhvrH+7p1yft9IC4pgrgEbjmfQVTi8LGwtMRZmwpbmjqEfOALpra5x7Plb+7y
>>> CTT/iDc8uUwHLn2brXxNRn58IrEeD1X+rBxLNyek0pQu/hH31+REI5Sn1JZfi7gc
>>> 3PJEuaRzVJY4sE0neNWT+K+aD0n382qnziLEGOusXWNpggpoHVFKZR3Yojxj6Bfk
>>> 9lUvfUtIqz2zQ2dF0q6A0QVVlIenKzUK+rjHxQAUSb8P9CmCuRXUih3f61ahquQP
>>> CgSrkNnUV44D/wHfnxNm9QjxlQEGyr0DsTcFAgMBAAGjLzAtMAkGA1UdEwQCMAAw
>>> CwYDVR0PBAQDAgUgMBMGA1UdJQQMMAoGCCsGAQUFBwMBMA0GCSqGSIb3DQEBBQUA
>>> A4IBAQDE+cXjx6uNL/Kf/HmE7FeQ238iN7Gfb+I1QHmbRaR0qbTqcFzp7NCJ62uq
>>> nJ6Anj0+h1IFNMlQrCISSS0fnSj+mXMKDodZzV+cXFjdtoEXyqdDO0zphDMTRd8H
>>> oI79XSm5IK6vcPR+g2UTkhgrX1xfgeqZ8hmw0L0mMMGHXclwwaAF9HRNomFt32gr
>>> 1sVhFkhH/5epmgcl+8yI1E7UaQc91bYkUEuQFNu7irgc+/tvcXa4O4+dIfhnzrog
>>> 8piYUk4dxGME8LknQ213Gow9cgEKzcYadJ4DIr6gChkvAnYpHHHafWj/Ksvxyii6
>>> 8FxuTfgsrOYwkqEcSXeCGUS25nU9
>>> -----END CERTIFICATE-----
>>>   1 s:/CN=Kiprosh7
>>>     i:/CN=Kiprosh7
>>> -----BEGIN CERTIFICATE-----
>>> MIICxjCCAa6gAwIBAgIJANsNRAs/ueOoMA0GCSqGSIb3DQEBBQUAMBMxETAPBgNV
>>> BAMTCEtpcHJvc2g3MB4XDTExMDgxMDA4MDEzMloXDTEyMDgwOTA4MDEzMlowEzER
>>> MA8GA1UEAxMIS2lwcm9zaDcwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIB
>>> AQDorxS4o/H/w7f+VYWkQk3gS7g7gWFd3S4eCVV35a3GEcyP2OS4pUhhZXyB0lN7
>>> xmUHqeixx7aNRnrc130SQ4kke1fuxtdLjKxu+oeASMLCSkF356m8X5FhuTnPkf2W
>>> x64i6nk9SOO+jdQo/kMChy0H7psKS5I2M0nb5WLxN/JOACNnxJOhFy8cGw7l32q6
>>> rEfqLkdnZJR09fiuf0hEbb/UodOt2tXXGN0Pp3X2x4cXnD6E2Va9QSBYIvPAnWEn
>>> FN2Te+Qwg+AxwHIkCjH9bfQ7fOeuGHAoanSnlqS5rW/T5sKKlkBl95WeJoTFjrCt
>>> CVDLilsnLrfmZkg3ICQtPbgNAgMBAAGjHTAbMAwGA1UdEwQFMAMBAf8wCwYDVR0P
>>> BAQDAgEGMA0GCSqGSIb3DQEBBQUAA4IBAQBGtbJQyQ1pWVo+7snqxCOn/KVN++Jo
>>> 8YEB4/MGKgHyoTWRAa3IXOSPtpunW/6yDziwcLZeO09MATeKCCAJf64LXZr7aM6J
>>> ZX6hFFNUyqa5w9AaZ4sAe70QwDYPS6dPqcyTab/DVVRGhJAKhUc2lX+UfcBhHYaz
>>> egKDKyIybHMmcQQm//SO0jo3Ak0565ZAMCdaaO/9RNJpJSxJf+HSVUg4sPLe/sAK
>>> QlXcdt8XlKsEKBzUHzfRvpbU/8gn1HO5G+CTvEW2kO6nssuKX41g5hMfRqu248TT
>>> jbGWMkYFMPDY1m2QWPqzLvaETGOWHwqpVWXuMhu7/T5sduDf2n084ok7
>>> -----END CERTIFICATE-----
>>> ---
>>> Server certificate
>>> subject=/CN=Kiprosh7/O=server
>>> issuer=/CN=Kiprosh7
>>> ---
>>> Acceptable client certificate CA names
>>> /CN=Kiprosh7
>>> ---
>>> SSL handshake has read 1663 bytes and written 2276 bytes
>>> ---
>>> New, TLSv1/SSLv3, Cipher is AES256-SHA
>>> Server public key is 2048 bit
>>> Secure Renegotiation IS supported
>>> Compression: NONE
>>> Expansion: NONE
>>> SSL-Session:
>>>      Protocol  : TLSv1
>>>      Cipher    : AES256-SHA
>>>      Session-ID:
>>> 8703D018C270CC932648333F61FE3C986CB336B7C8074ACF3560E415934E26F2
>>>
>>>      Session-ID-ctx:
>>>      Master-Key:
>>> F5B8C5666355EE6C78910EBB649A65740104537ACEBB28E4A23DF51EA5DE9E6A
>>> FE3AC2C95B1929985DAFC09CDC6BDEAE
>>>      Key-Arg   : None
>>>      PSK identity: None
>>>      PSK identity hint: None
>>>      Start Time: 1312972974
>>>      Timeout   : 300 (sec)
>>>      Verify return code: 0 (ok)
>>> ---
>>>        
>> Thanks and Regards,
>> Abhijit
>>
>>
>> On 8/10/2011 4:10 PM, Alexandru Scvor?ov wrote:
>>      
>>>>> AMQP server protocol negotiation failure: server version
>>>>> unknown-unknown, client version 0-9
>>>>>
>>>>>            
>>> That means the client connected successfully but closed the connection
>>> later because it wasn't talking to an AMQP server.
>>>
>>> That means that the client and certificates are fine, so the problem is
>>> configuring the server.
>>>
>>> When you try the other command (the openssl s_client) on the server,
>>> what output do you get?  Could you please post it?
>>>
>>> Alex
>>>
>>> On Wed, Aug 10, 2011 at 04:00:26PM +0530, Abhijit wrote:
>>>
>>>        
>>>> yes sir
>>>> no problem i thought so after looking at client cmd lines i did put
>>>> slash instead of dot, and now am getting this errors:
>>>>
>>>>
>>>>          
>>>>> AMQP server protocol negotiation failure: server version
>>>>> unknown-unknown, client version 0-9
>>>>>
>>>>>            
>>>> Can you tell me what are next steps?
>>>>
>>>> Thanks and Regards,
>>>> Abhijit
>>>>
>>>>
>>>> On 8/10/2011 3:57 PM, Alexandru Scvor?ov wrote:
>>>>
>>>>          
>>>>>> Am still getting the same error am using the same config file.
>>>>>>
>>>>>>
>>>>>>              
>>>>> Ok, but are you sure it's actually the file used by the server? (we had
>>>>> some problems earlier about which file the server was using when started
>>>>> from the command prompt or as a service)
>>>>>
>>>>>
>>>>>
>>>>>            
>>>>>>> openssl s_server -accept 5671 -CAfile testca/cacert.pem -cert
>>>>>>> server/cert.pem -key server.key.pem -state
>>>>>>>
>>>>>>>
>>>>>>>                
>>>>> My mistake.  That should be:
>>>>>      openssl s_server -accept 5671 -CAfile testca/cacert.pem -cert
>>>>>      server/cert.pem -key server/key.pem -state
>>>>>
>>>>> (dot instead of slash in server.key.pem)
>>>>>
>>>>> BTW, if they're disposable, could you send the certificates and keys?
>>>>> We've had problems before with the certificates generated by OpenSSL,
>>>>> which were usually solved by using a different version.  Maybe this is
>>>>> happening here.
>>>>>
>>>>> Cheers,
>>>>> Alex
>>>>>
>>>>> On Wed, Aug 10, 2011 at 03:46:39PM +0530, Abhijit wrote:
>>>>>
>>>>>
>>>>>            
>>>>>> hi sir,
>>>>>>
>>>>>> Am still getting the same error am using the same config file.
>>>>>>
>>>>>> But i was not able to run this command you sent me:
>>>>>>
>>>>>>
>>>>>>
>>>>>>              
>>>>>>> openssl s_server -accept 5671 -CAfile testca/cacert.pem -cert
>>>>>>> server/cert.pem -key server.key.pem -state
>>>>>>>
>>>>>>>
>>>>>>>                
>>>>>> was getting an error: unable to load server certificate private key file.
>>>>>>
>>>>>> Thanks and Regards,
>>>>>> Abhijit
>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>>              
>>>>
>>>>          
>>      


From alexandru at rabbitmq.com  Wed Aug 10 13:18:24 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Wed, 10 Aug 2011 13:18:24 +0100
Subject: [rabbitmq-discuss] facing issues with the SSL implementations
 with RabbitMQ + Windows + .Net
In-Reply-To: <4E4272EA.9040308@kiprosh.com>
References: <20110809150226.GF28785@dakota.eng.vmware.com>
	<4E422EDB.60506@kiprosh.com>
	<20110810091649.GC2869@dakota.eng.vmware.com>
	<4E425A87.9050909@kiprosh.com>
	<20110810102710.GD2869@dakota.eng.vmware.com>
	<4E425DC2.1050602@kiprosh.com>
	<20110810104000.GE2869@dakota.eng.vmware.com>
	<4E42617A.3090601@kiprosh.com>
	<20110810115056.GF2869@dakota.eng.vmware.com>
	<4E4272EA.9040308@kiprosh.com>
Message-ID: <20110810121824.GG2869@dakota.eng.vmware.com>

> The code worked now. the certificate you provided did work
Great to hear that.  

>  wondering why 
> my certificates are not working??

I suspect you got some step in the certificate generation wrong (I
generated the certificates following the instructions on the website).
It's ridiculously easy to get something wrong.

I'd delete all the certificates, and CA you generated and try again.
The website instructions are right.  You might want to try without
changing anything (the CA's name, for instance) just to see that it
works.

You could also try a different version of OpenSSL, but I'd be quite
surprised if that were the problem.

Let us how it goes.

Cheers,
Alex


On Wed, Aug 10, 2011 at 05:30:42PM +0530, Abhijit wrote:
> Hi sir,
> 
> The code worked now. the certificate you provided did work wondering why 
> my certificates are not working??
> 
> Thanks and Regards,
> Abhijit
> 
> 
> 
> On 8/10/2011 5:20 PM, Alexandru Scvor?ov wrote:
> > :(  That seems perfectly fine.
> >
> > Other ways to get an "unknown ca" error:
> >    - forget to add the CA certificate to the Trust store;
> >    - have the client use a certificate signed by a different authority
> >      than the one given to the server.
> >
> > I'm out of ideas.  I'm attaching:
> >    - cacert.pem and cacert.cer;
> >    - keycert.p12 (password is "test");
> >    - server's cert.pem, key.pem.
> >
> > You'll also need to set RemoteCertificateNameMismatch before starting the connection:
> >    cf.Ssl.AcceptablePolicyErrors =
> >      SslPolicyErrors.RemoteCertificateNameMismatch;
> >
> > Could you please try with these and see if it works (or if you get a
> > different error)?
> >
> > Cheers,
> > Alex
> >
> > On Wed, Aug 10, 2011 at 04:16:18PM +0530, Abhijit wrote:
> >    
> >> Ok sir thanks,
> >>
> >> this is the post for the former command s_client:
> >>      
> >>> C:\>openssl s_client -connect localhost:5671 -CAfile testca/cacert.pem
> >>> -cert cli
> >>> ent/cert.pem -key client/key.pem -showcerts
> >>> Loading 'screen' into random state - done
> >>> CONNECTED(00000160)
> >>> depth=1 CN = Kiprosh7
> >>> verify return:1
> >>> depth=0 CN = Kiprosh7, O = server
> >>> verify return:1
> >>> ---
> >>> Certificate chain
> >>>   0 s:/CN=Kiprosh7/O=server
> >>>     i:/CN=Kiprosh7
> >>> -----BEGIN CERTIFICATE-----
> >>> MIIC4TCCAcmgAwIBAgIBATANBgkqhkiG9w0BAQUFADATMREwDwYDVQQDEwhLaXBy
> >>> b3NoNzAeFw0xMTA4MTAwODA1NTBaFw0xMjA4MDkwODA1NTBaMCQxETAPBgNVBAMM
> >>> CEtpcHJvc2g3MQ8wDQYDVQQKDAZzZXJ2ZXIwggEiMA0GCSqGSIb3DQEBAQUAA4IB
> >>> DwAwggEKAoIBAQDTDgQ3/vSBPvy0PAZYwk4H2qlFckaA75YfCYZ+HhIb+JUSrZ4r
> >>> NcBEhvrH+7p1yft9IC4pgrgEbjmfQVTi8LGwtMRZmwpbmjqEfOALpra5x7Plb+7y
> >>> CTT/iDc8uUwHLn2brXxNRn58IrEeD1X+rBxLNyek0pQu/hH31+REI5Sn1JZfi7gc
> >>> 3PJEuaRzVJY4sE0neNWT+K+aD0n382qnziLEGOusXWNpggpoHVFKZR3Yojxj6Bfk
> >>> 9lUvfUtIqz2zQ2dF0q6A0QVVlIenKzUK+rjHxQAUSb8P9CmCuRXUih3f61ahquQP
> >>> CgSrkNnUV44D/wHfnxNm9QjxlQEGyr0DsTcFAgMBAAGjLzAtMAkGA1UdEwQCMAAw
> >>> CwYDVR0PBAQDAgUgMBMGA1UdJQQMMAoGCCsGAQUFBwMBMA0GCSqGSIb3DQEBBQUA
> >>> A4IBAQDE+cXjx6uNL/Kf/HmE7FeQ238iN7Gfb+I1QHmbRaR0qbTqcFzp7NCJ62uq
> >>> nJ6Anj0+h1IFNMlQrCISSS0fnSj+mXMKDodZzV+cXFjdtoEXyqdDO0zphDMTRd8H
> >>> oI79XSm5IK6vcPR+g2UTkhgrX1xfgeqZ8hmw0L0mMMGHXclwwaAF9HRNomFt32gr
> >>> 1sVhFkhH/5epmgcl+8yI1E7UaQc91bYkUEuQFNu7irgc+/tvcXa4O4+dIfhnzrog
> >>> 8piYUk4dxGME8LknQ213Gow9cgEKzcYadJ4DIr6gChkvAnYpHHHafWj/Ksvxyii6
> >>> 8FxuTfgsrOYwkqEcSXeCGUS25nU9
> >>> -----END CERTIFICATE-----
> >>>   1 s:/CN=Kiprosh7
> >>>     i:/CN=Kiprosh7
> >>> -----BEGIN CERTIFICATE-----
> >>> MIICxjCCAa6gAwIBAgIJANsNRAs/ueOoMA0GCSqGSIb3DQEBBQUAMBMxETAPBgNV
> >>> BAMTCEtpcHJvc2g3MB4XDTExMDgxMDA4MDEzMloXDTEyMDgwOTA4MDEzMlowEzER
> >>> MA8GA1UEAxMIS2lwcm9zaDcwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIB
> >>> AQDorxS4o/H/w7f+VYWkQk3gS7g7gWFd3S4eCVV35a3GEcyP2OS4pUhhZXyB0lN7
> >>> xmUHqeixx7aNRnrc130SQ4kke1fuxtdLjKxu+oeASMLCSkF356m8X5FhuTnPkf2W
> >>> x64i6nk9SOO+jdQo/kMChy0H7psKS5I2M0nb5WLxN/JOACNnxJOhFy8cGw7l32q6
> >>> rEfqLkdnZJR09fiuf0hEbb/UodOt2tXXGN0Pp3X2x4cXnD6E2Va9QSBYIvPAnWEn
> >>> FN2Te+Qwg+AxwHIkCjH9bfQ7fOeuGHAoanSnlqS5rW/T5sKKlkBl95WeJoTFjrCt
> >>> CVDLilsnLrfmZkg3ICQtPbgNAgMBAAGjHTAbMAwGA1UdEwQFMAMBAf8wCwYDVR0P
> >>> BAQDAgEGMA0GCSqGSIb3DQEBBQUAA4IBAQBGtbJQyQ1pWVo+7snqxCOn/KVN++Jo
> >>> 8YEB4/MGKgHyoTWRAa3IXOSPtpunW/6yDziwcLZeO09MATeKCCAJf64LXZr7aM6J
> >>> ZX6hFFNUyqa5w9AaZ4sAe70QwDYPS6dPqcyTab/DVVRGhJAKhUc2lX+UfcBhHYaz
> >>> egKDKyIybHMmcQQm//SO0jo3Ak0565ZAMCdaaO/9RNJpJSxJf+HSVUg4sPLe/sAK
> >>> QlXcdt8XlKsEKBzUHzfRvpbU/8gn1HO5G+CTvEW2kO6nssuKX41g5hMfRqu248TT
> >>> jbGWMkYFMPDY1m2QWPqzLvaETGOWHwqpVWXuMhu7/T5sduDf2n084ok7
> >>> -----END CERTIFICATE-----
> >>> ---
> >>> Server certificate
> >>> subject=/CN=Kiprosh7/O=server
> >>> issuer=/CN=Kiprosh7
> >>> ---
> >>> Acceptable client certificate CA names
> >>> /CN=Kiprosh7
> >>> ---
> >>> SSL handshake has read 1663 bytes and written 2276 bytes
> >>> ---
> >>> New, TLSv1/SSLv3, Cipher is AES256-SHA
> >>> Server public key is 2048 bit
> >>> Secure Renegotiation IS supported
> >>> Compression: NONE
> >>> Expansion: NONE
> >>> SSL-Session:
> >>>      Protocol  : TLSv1
> >>>      Cipher    : AES256-SHA
> >>>      Session-ID:
> >>> 8703D018C270CC932648333F61FE3C986CB336B7C8074ACF3560E415934E26F2
> >>>
> >>>      Session-ID-ctx:
> >>>      Master-Key:
> >>> F5B8C5666355EE6C78910EBB649A65740104537ACEBB28E4A23DF51EA5DE9E6A
> >>> FE3AC2C95B1929985DAFC09CDC6BDEAE
> >>>      Key-Arg   : None
> >>>      PSK identity: None
> >>>      PSK identity hint: None
> >>>      Start Time: 1312972974
> >>>      Timeout   : 300 (sec)
> >>>      Verify return code: 0 (ok)
> >>> ---
> >>>        
> >> Thanks and Regards,
> >> Abhijit
> >>
> >>
> >> On 8/10/2011 4:10 PM, Alexandru Scvor?ov wrote:
> >>      
> >>>>> AMQP server protocol negotiation failure: server version
> >>>>> unknown-unknown, client version 0-9
> >>>>>
> >>>>>            
> >>> That means the client connected successfully but closed the connection
> >>> later because it wasn't talking to an AMQP server.
> >>>
> >>> That means that the client and certificates are fine, so the problem is
> >>> configuring the server.
> >>>
> >>> When you try the other command (the openssl s_client) on the server,
> >>> what output do you get?  Could you please post it?
> >>>
> >>> Alex
> >>>
> >>> On Wed, Aug 10, 2011 at 04:00:26PM +0530, Abhijit wrote:
> >>>
> >>>        
> >>>> yes sir
> >>>> no problem i thought so after looking at client cmd lines i did put
> >>>> slash instead of dot, and now am getting this errors:
> >>>>
> >>>>
> >>>>          
> >>>>> AMQP server protocol negotiation failure: server version
> >>>>> unknown-unknown, client version 0-9
> >>>>>
> >>>>>            
> >>>> Can you tell me what are next steps?
> >>>>
> >>>> Thanks and Regards,
> >>>> Abhijit
> >>>>
> >>>>
> >>>> On 8/10/2011 3:57 PM, Alexandru Scvor?ov wrote:
> >>>>
> >>>>          
> >>>>>> Am still getting the same error am using the same config file.
> >>>>>>
> >>>>>>
> >>>>>>              
> >>>>> Ok, but are you sure it's actually the file used by the server? (we had
> >>>>> some problems earlier about which file the server was using when started
> >>>>> from the command prompt or as a service)
> >>>>>
> >>>>>
> >>>>>
> >>>>>            
> >>>>>>> openssl s_server -accept 5671 -CAfile testca/cacert.pem -cert
> >>>>>>> server/cert.pem -key server.key.pem -state
> >>>>>>>
> >>>>>>>
> >>>>>>>                
> >>>>> My mistake.  That should be:
> >>>>>      openssl s_server -accept 5671 -CAfile testca/cacert.pem -cert
> >>>>>      server/cert.pem -key server/key.pem -state
> >>>>>
> >>>>> (dot instead of slash in server.key.pem)
> >>>>>
> >>>>> BTW, if they're disposable, could you send the certificates and keys?
> >>>>> We've had problems before with the certificates generated by OpenSSL,
> >>>>> which were usually solved by using a different version.  Maybe this is
> >>>>> happening here.
> >>>>>
> >>>>> Cheers,
> >>>>> Alex
> >>>>>
> >>>>> On Wed, Aug 10, 2011 at 03:46:39PM +0530, Abhijit wrote:
> >>>>>
> >>>>>
> >>>>>            
> >>>>>> hi sir,
> >>>>>>
> >>>>>> Am still getting the same error am using the same config file.
> >>>>>>
> >>>>>> But i was not able to run this command you sent me:
> >>>>>>
> >>>>>>
> >>>>>>
> >>>>>>              
> >>>>>>> openssl s_server -accept 5671 -CAfile testca/cacert.pem -cert
> >>>>>>> server/cert.pem -key server.key.pem -state
> >>>>>>>
> >>>>>>>
> >>>>>>>                
> >>>>>> was getting an error: unable to load server certificate private key file.
> >>>>>>
> >>>>>> Thanks and Regards,
> >>>>>> Abhijit
> >>>>>>
> >>>>>>
> >>>>>>
> >>>>>>
> >>>>>>              
> >>>>
> >>>>          
> >>      
> 

From abhijit.sinha at kiprosh.com  Wed Aug 10 13:24:37 2011
From: abhijit.sinha at kiprosh.com (Abhijit)
Date: Wed, 10 Aug 2011 17:54:37 +0530
Subject: [rabbitmq-discuss] facing issues with the SSL implementations
 with RabbitMQ + Windows + .Net
In-Reply-To: <20110810121824.GG2869@dakota.eng.vmware.com>
References: <20110809150226.GF28785@dakota.eng.vmware.com>
	<4E422EDB.60506@kiprosh.com>
	<20110810091649.GC2869@dakota.eng.vmware.com>
	<4E425A87.9050909@kiprosh.com>
	<20110810102710.GD2869@dakota.eng.vmware.com>
	<4E425DC2.1050602@kiprosh.com>
	<20110810104000.GE2869@dakota.eng.vmware.com>
	<4E42617A.3090601@kiprosh.com>
	<20110810115056.GF2869@dakota.eng.vmware.com>
	<4E4272EA.9040308@kiprosh.com>
	<20110810121824.GG2869@dakota.eng.vmware.com>
Message-ID: <4E427885.8010703@kiprosh.com>

OK Sir,

Thanks a lot.

I will give it a try once again and let you know.

Thanks and Regards,
Abhijit

On 8/10/2011 5:48 PM, Alexandru Scvor?ov wrote:
>> The code worked now. the certificate you provided did work
>>      
> Great to hear that.
>
>    
>>   wondering why
>> my certificates are not working??
>>      
> I suspect you got some step in the certificate generation wrong (I
> generated the certificates following the instructions on the website).
> It's ridiculously easy to get something wrong.
>
> I'd delete all the certificates, and CA you generated and try again.
> The website instructions are right.  You might want to try without
> changing anything (the CA's name, for instance) just to see that it
> works.
>
> You could also try a different version of OpenSSL, but I'd be quite
> surprised if that were the problem.
>
> Let us how it goes.
>
> Cheers,
> Alex
>
>
> On Wed, Aug 10, 2011 at 05:30:42PM +0530, Abhijit wrote:
>    
>> Hi sir,
>>
>> The code worked now. the certificate you provided did work wondering why
>> my certificates are not working??
>>
>> Thanks and Regards,
>> Abhijit
>>
>>
>>
>> On 8/10/2011 5:20 PM, Alexandru Scvor?ov wrote:
>>      
>>> :(  That seems perfectly fine.
>>>
>>> Other ways to get an "unknown ca" error:
>>>     - forget to add the CA certificate to the Trust store;
>>>     - have the client use a certificate signed by a different authority
>>>       than the one given to the server.
>>>
>>> I'm out of ideas.  I'm attaching:
>>>     - cacert.pem and cacert.cer;
>>>     - keycert.p12 (password is "test");
>>>     - server's cert.pem, key.pem.
>>>
>>> You'll also need to set RemoteCertificateNameMismatch before starting the connection:
>>>     cf.Ssl.AcceptablePolicyErrors =
>>>       SslPolicyErrors.RemoteCertificateNameMismatch;
>>>
>>> Could you please try with these and see if it works (or if you get a
>>> different error)?
>>>
>>> Cheers,
>>> Alex
>>>
>>> On Wed, Aug 10, 2011 at 04:16:18PM +0530, Abhijit wrote:
>>>
>>>        
>>>> Ok sir thanks,
>>>>
>>>> this is the post for the former command s_client:
>>>>
>>>>          
>>>>> C:\>openssl s_client -connect localhost:5671 -CAfile testca/cacert.pem
>>>>> -cert cli
>>>>> ent/cert.pem -key client/key.pem -showcerts
>>>>> Loading 'screen' into random state - done
>>>>> CONNECTED(00000160)
>>>>> depth=1 CN = Kiprosh7
>>>>> verify return:1
>>>>> depth=0 CN = Kiprosh7, O = server
>>>>> verify return:1
>>>>> ---
>>>>> Certificate chain
>>>>>    0 s:/CN=Kiprosh7/O=server
>>>>>      i:/CN=Kiprosh7
>>>>> -----BEGIN CERTIFICATE-----
>>>>> MIIC4TCCAcmgAwIBAgIBATANBgkqhkiG9w0BAQUFADATMREwDwYDVQQDEwhLaXBy
>>>>> b3NoNzAeFw0xMTA4MTAwODA1NTBaFw0xMjA4MDkwODA1NTBaMCQxETAPBgNVBAMM
>>>>> CEtpcHJvc2g3MQ8wDQYDVQQKDAZzZXJ2ZXIwggEiMA0GCSqGSIb3DQEBAQUAA4IB
>>>>> DwAwggEKAoIBAQDTDgQ3/vSBPvy0PAZYwk4H2qlFckaA75YfCYZ+HhIb+JUSrZ4r
>>>>> NcBEhvrH+7p1yft9IC4pgrgEbjmfQVTi8LGwtMRZmwpbmjqEfOALpra5x7Plb+7y
>>>>> CTT/iDc8uUwHLn2brXxNRn58IrEeD1X+rBxLNyek0pQu/hH31+REI5Sn1JZfi7gc
>>>>> 3PJEuaRzVJY4sE0neNWT+K+aD0n382qnziLEGOusXWNpggpoHVFKZR3Yojxj6Bfk
>>>>> 9lUvfUtIqz2zQ2dF0q6A0QVVlIenKzUK+rjHxQAUSb8P9CmCuRXUih3f61ahquQP
>>>>> CgSrkNnUV44D/wHfnxNm9QjxlQEGyr0DsTcFAgMBAAGjLzAtMAkGA1UdEwQCMAAw
>>>>> CwYDVR0PBAQDAgUgMBMGA1UdJQQMMAoGCCsGAQUFBwMBMA0GCSqGSIb3DQEBBQUA
>>>>> A4IBAQDE+cXjx6uNL/Kf/HmE7FeQ238iN7Gfb+I1QHmbRaR0qbTqcFzp7NCJ62uq
>>>>> nJ6Anj0+h1IFNMlQrCISSS0fnSj+mXMKDodZzV+cXFjdtoEXyqdDO0zphDMTRd8H
>>>>> oI79XSm5IK6vcPR+g2UTkhgrX1xfgeqZ8hmw0L0mMMGHXclwwaAF9HRNomFt32gr
>>>>> 1sVhFkhH/5epmgcl+8yI1E7UaQc91bYkUEuQFNu7irgc+/tvcXa4O4+dIfhnzrog
>>>>> 8piYUk4dxGME8LknQ213Gow9cgEKzcYadJ4DIr6gChkvAnYpHHHafWj/Ksvxyii6
>>>>> 8FxuTfgsrOYwkqEcSXeCGUS25nU9
>>>>> -----END CERTIFICATE-----
>>>>>    1 s:/CN=Kiprosh7
>>>>>      i:/CN=Kiprosh7
>>>>> -----BEGIN CERTIFICATE-----
>>>>> MIICxjCCAa6gAwIBAgIJANsNRAs/ueOoMA0GCSqGSIb3DQEBBQUAMBMxETAPBgNV
>>>>> BAMTCEtpcHJvc2g3MB4XDTExMDgxMDA4MDEzMloXDTEyMDgwOTA4MDEzMlowEzER
>>>>> MA8GA1UEAxMIS2lwcm9zaDcwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIB
>>>>> AQDorxS4o/H/w7f+VYWkQk3gS7g7gWFd3S4eCVV35a3GEcyP2OS4pUhhZXyB0lN7
>>>>> xmUHqeixx7aNRnrc130SQ4kke1fuxtdLjKxu+oeASMLCSkF356m8X5FhuTnPkf2W
>>>>> x64i6nk9SOO+jdQo/kMChy0H7psKS5I2M0nb5WLxN/JOACNnxJOhFy8cGw7l32q6
>>>>> rEfqLkdnZJR09fiuf0hEbb/UodOt2tXXGN0Pp3X2x4cXnD6E2Va9QSBYIvPAnWEn
>>>>> FN2Te+Qwg+AxwHIkCjH9bfQ7fOeuGHAoanSnlqS5rW/T5sKKlkBl95WeJoTFjrCt
>>>>> CVDLilsnLrfmZkg3ICQtPbgNAgMBAAGjHTAbMAwGA1UdEwQFMAMBAf8wCwYDVR0P
>>>>> BAQDAgEGMA0GCSqGSIb3DQEBBQUAA4IBAQBGtbJQyQ1pWVo+7snqxCOn/KVN++Jo
>>>>> 8YEB4/MGKgHyoTWRAa3IXOSPtpunW/6yDziwcLZeO09MATeKCCAJf64LXZr7aM6J
>>>>> ZX6hFFNUyqa5w9AaZ4sAe70QwDYPS6dPqcyTab/DVVRGhJAKhUc2lX+UfcBhHYaz
>>>>> egKDKyIybHMmcQQm//SO0jo3Ak0565ZAMCdaaO/9RNJpJSxJf+HSVUg4sPLe/sAK
>>>>> QlXcdt8XlKsEKBzUHzfRvpbU/8gn1HO5G+CTvEW2kO6nssuKX41g5hMfRqu248TT
>>>>> jbGWMkYFMPDY1m2QWPqzLvaETGOWHwqpVWXuMhu7/T5sduDf2n084ok7
>>>>> -----END CERTIFICATE-----
>>>>> ---
>>>>> Server certificate
>>>>> subject=/CN=Kiprosh7/O=server
>>>>> issuer=/CN=Kiprosh7
>>>>> ---
>>>>> Acceptable client certificate CA names
>>>>> /CN=Kiprosh7
>>>>> ---
>>>>> SSL handshake has read 1663 bytes and written 2276 bytes
>>>>> ---
>>>>> New, TLSv1/SSLv3, Cipher is AES256-SHA
>>>>> Server public key is 2048 bit
>>>>> Secure Renegotiation IS supported
>>>>> Compression: NONE
>>>>> Expansion: NONE
>>>>> SSL-Session:
>>>>>       Protocol  : TLSv1
>>>>>       Cipher    : AES256-SHA
>>>>>       Session-ID:
>>>>> 8703D018C270CC932648333F61FE3C986CB336B7C8074ACF3560E415934E26F2
>>>>>
>>>>>       Session-ID-ctx:
>>>>>       Master-Key:
>>>>> F5B8C5666355EE6C78910EBB649A65740104537ACEBB28E4A23DF51EA5DE9E6A
>>>>> FE3AC2C95B1929985DAFC09CDC6BDEAE
>>>>>       Key-Arg   : None
>>>>>       PSK identity: None
>>>>>       PSK identity hint: None
>>>>>       Start Time: 1312972974
>>>>>       Timeout   : 300 (sec)
>>>>>       Verify return code: 0 (ok)
>>>>> ---
>>>>>
>>>>>            
>>>> Thanks and Regards,
>>>> Abhijit
>>>>
>>>>
>>>> On 8/10/2011 4:10 PM, Alexandru Scvor?ov wrote:
>>>>
>>>>          
>>>>>>> AMQP server protocol negotiation failure: server version
>>>>>>> unknown-unknown, client version 0-9
>>>>>>>
>>>>>>>
>>>>>>>                
>>>>> That means the client connected successfully but closed the connection
>>>>> later because it wasn't talking to an AMQP server.
>>>>>
>>>>> That means that the client and certificates are fine, so the problem is
>>>>> configuring the server.
>>>>>
>>>>> When you try the other command (the openssl s_client) on the server,
>>>>> what output do you get?  Could you please post it?
>>>>>
>>>>> Alex
>>>>>
>>>>> On Wed, Aug 10, 2011 at 04:00:26PM +0530, Abhijit wrote:
>>>>>
>>>>>
>>>>>            
>>>>>> yes sir
>>>>>> no problem i thought so after looking at client cmd lines i did put
>>>>>> slash instead of dot, and now am getting this errors:
>>>>>>
>>>>>>
>>>>>>
>>>>>>              
>>>>>>> AMQP server protocol negotiation failure: server version
>>>>>>> unknown-unknown, client version 0-9
>>>>>>>
>>>>>>>
>>>>>>>                
>>>>>> Can you tell me what are next steps?
>>>>>>
>>>>>> Thanks and Regards,
>>>>>> Abhijit
>>>>>>
>>>>>>
>>>>>> On 8/10/2011 3:57 PM, Alexandru Scvor?ov wrote:
>>>>>>
>>>>>>
>>>>>>              
>>>>>>>> Am still getting the same error am using the same config file.
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>                  
>>>>>>> Ok, but are you sure it's actually the file used by the server? (we had
>>>>>>> some problems earlier about which file the server was using when started
>>>>>>> from the command prompt or as a service)
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>                
>>>>>>>>> openssl s_server -accept 5671 -CAfile testca/cacert.pem -cert
>>>>>>>>> server/cert.pem -key server.key.pem -state
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>                    
>>>>>>> My mistake.  That should be:
>>>>>>>       openssl s_server -accept 5671 -CAfile testca/cacert.pem -cert
>>>>>>>       server/cert.pem -key server/key.pem -state
>>>>>>>
>>>>>>> (dot instead of slash in server.key.pem)
>>>>>>>
>>>>>>> BTW, if they're disposable, could you send the certificates and keys?
>>>>>>> We've had problems before with the certificates generated by OpenSSL,
>>>>>>> which were usually solved by using a different version.  Maybe this is
>>>>>>> happening here.
>>>>>>>
>>>>>>> Cheers,
>>>>>>> Alex
>>>>>>>
>>>>>>> On Wed, Aug 10, 2011 at 03:46:39PM +0530, Abhijit wrote:
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>                
>>>>>>>> hi sir,
>>>>>>>>
>>>>>>>> Am still getting the same error am using the same config file.
>>>>>>>>
>>>>>>>> But i was not able to run this command you sent me:
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>                  
>>>>>>>>> openssl s_server -accept 5671 -CAfile testca/cacert.pem -cert
>>>>>>>>> server/cert.pem -key server.key.pem -state
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>                    
>>>>>>>> was getting an error: unable to load server certificate private key file.
>>>>>>>>
>>>>>>>> Thanks and Regards,
>>>>>>>> Abhijit
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>                  
>>>>>>
>>>>>>              
>>>>
>>>>          
>>      


From alexis at rabbitmq.com  Wed Aug 10 13:32:55 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Wed, 10 Aug 2011 13:32:55 +0100
Subject: [rabbitmq-discuss] RabbitMQ on CloudFoundry
Message-ID: <CACOPnvfU8VJ_DMTuraDwnof2h9XKxuGX33TA6s5HpJuAZmg7NA@mail.gmail.com>

Hi,

We have released RabbitMQ on CloudFoundry.com

Please *do* go and take a look, try out the apps, and write your own.
Then tell us how to make it better ;-)

Details: http://blog.cloudfoundry.com/post/8713844574/rabbitmq-cloud-foundry-cloud-messaging-that-just-works

alexis

From majek04 at gmail.com  Wed Aug 10 13:33:53 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 10 Aug 2011 13:33:53 +0100
Subject: [rabbitmq-discuss] BasicProperties
In-Reply-To: <CA+zYriSzpso86o8Ze3XTJfp-aQKLaJjPTuiM4XH0gMgL1t_CAQ@mail.gmail.com>
References: <CA+zYriSzpso86o8Ze3XTJfp-aQKLaJjPTuiM4XH0gMgL1t_CAQ@mail.gmail.com>
Message-ID: <CABzX+qzcjpBLMaXNmBL3aVYc8VRSoAXMjqmKfzpDN0K-tLOyrA@mail.gmail.com>

On Wed, Aug 10, 2011 at 12:45, Steven Taylor <taylste at gmail.com> wrote:
> Does RabbitMQ do anything with ".Expiration"?
> How about .ProtocolClassID & .ProtocolClassName?
> Just checking... ReplyTo & a ReplyToAddress should mirror each other right?
> ?Does placing a value in one populate the other?

RabbitMQ doesn't even look at the majority of properties. User
is required to make sure that the values are meaningful.

Notable exceptions are:
   - delivery-mode which can only take value 1 or 2
   - user-id  which needs to be set to null or to username used by the
connection that sends a message. see:
http://www.rabbitmq.com/extensions.html#validated-user-id

Cheers,
   Marek

From arno.puschmann at acodeas.de  Wed Aug 10 13:51:55 2011
From: arno.puschmann at acodeas.de (Arno Puschmann)
Date: Wed, 10 Aug 2011 14:51:55 +0200
Subject: [rabbitmq-discuss] RabbitMQ and Spring
In-Reply-To: <4E3BB377.2040204@rabbitmq.com>
References: <27D6B27DB616654BBEF4DDB8B31EAF916B590E9526@vs-msx01.IT-NG.local>, 
	<468ecd19-1a84-4b35-934c-b16a1c36c30e@e35g2000yqc.googlegroups.com>
	<27D6B27DB616654BBEF4DDB8B31EAF916B590E9527@vs-msx01.IT-NG.local>,
	<88bbe583-fa6e-4474-9e91-5316463ce721@o26g2000vbi.googlegroups.com>
	<27D6B27DB616654BBEF4DDB8B31EAF916B590E9528@vs-msx01.IT-NG.local>,
	<4E3BB377.2040204@rabbitmq.com>
Message-ID: <27D6B27DB616654BBEF4DDB8B31EAF916B590E952B@vs-msx01.IT-NG.local>

Thanks for the fixed version.

With no setReplyTimeout for template.receiving I been forced to use template.sendandreceive. But i can't explain why i get always null as a response.

template.setExchange("exchange"); //direct and durable
template.setQueue("someQueue");
template.setRoutingKey("someQueue");
Message response = template.sendAndReceive("exchange", "anotherQueue" , message); 

Just to ensure. I should get a response from the Queue "someQueue" which is set to default or from which Queue reads sendandreceive? Should these message have some special Properties? Or just a simple Message?

template.sendAndReceive sends a message on "anotherQueue" but reads no message from "someQueue" although there is some Message to read.

I found no documentation about sendAndReceive in the spring-amqp-referenceRC2.pdf or on the internet.

Thanks for help.

From abhijit.sinha at kiprosh.com  Wed Aug 10 14:54:54 2011
From: abhijit.sinha at kiprosh.com (Abhijit)
Date: Wed, 10 Aug 2011 19:24:54 +0530
Subject: [rabbitmq-discuss] facing issues with the SSL implementations
 with RabbitMQ + Windows + .Net
In-Reply-To: <20110810121824.GG2869@dakota.eng.vmware.com>
References: <20110809150226.GF28785@dakota.eng.vmware.com>
	<4E422EDB.60506@kiprosh.com>
	<20110810091649.GC2869@dakota.eng.vmware.com>
	<4E425A87.9050909@kiprosh.com>
	<20110810102710.GD2869@dakota.eng.vmware.com>
	<4E425DC2.1050602@kiprosh.com>
	<20110810104000.GE2869@dakota.eng.vmware.com>
	<4E42617A.3090601@kiprosh.com>
	<20110810115056.GF2869@dakota.eng.vmware.com>
	<4E4272EA.9040308@kiprosh.com>
	<20110810121824.GG2869@dakota.eng.vmware.com>
Message-ID: <4E428DAE.4000703@kiprosh.com>

Hi sir,

i went through all the steps again to make certificates in this link:
> http://www.rabbitmq.com/ssl.html#keys-and-certs

but with no luck, do i need something more.

Thanking you,

Regards,
Abhijit


On 8/10/2011 5:48 PM, Alexandru Scvor?ov wrote:
>> The code worked now. the certificate you provided did work
>>      
> Great to hear that.
>
>    
>>   wondering why
>> my certificates are not working??
>>      
> I suspect you got some step in the certificate generation wrong (I
> generated the certificates following the instructions on the website).
> It's ridiculously easy to get something wrong.
>
> I'd delete all the certificates, and CA you generated and try again.
> The website instructions are right.  You might want to try without
> changing anything (the CA's name, for instance) just to see that it
> works.
>
> You could also try a different version of OpenSSL, but I'd be quite
> surprised if that were the problem.
>
> Let us how it goes.
>
> Cheers,
> Alex
>
>
> On Wed, Aug 10, 2011 at 05:30:42PM +0530, Abhijit wrote:
>    
>> Hi sir,
>>
>> The code worked now. the certificate you provided did work wondering why
>> my certificates are not working??
>>
>> Thanks and Regards,
>> Abhijit
>>
>>
>>
>> On 8/10/2011 5:20 PM, Alexandru Scvor?ov wrote:
>>      
>>> :(  That seems perfectly fine.
>>>
>>> Other ways to get an "unknown ca" error:
>>>     - forget to add the CA certificate to the Trust store;
>>>     - have the client use a certificate signed by a different authority
>>>       than the one given to the server.
>>>
>>> I'm out of ideas.  I'm attaching:
>>>     - cacert.pem and cacert.cer;
>>>     - keycert.p12 (password is "test");
>>>     - server's cert.pem, key.pem.
>>>
>>> You'll also need to set RemoteCertificateNameMismatch before starting the connection:
>>>     cf.Ssl.AcceptablePolicyErrors =
>>>       SslPolicyErrors.RemoteCertificateNameMismatch;
>>>
>>> Could you please try with these and see if it works (or if you get a
>>> different error)?
>>>
>>> Cheers,
>>> Alex
>>>
>>> On Wed, Aug 10, 2011 at 04:16:18PM +0530, Abhijit wrote:
>>>
>>>        
>>>> Ok sir thanks,
>>>>
>>>> this is the post for the former command s_client:
>>>>
>>>>          
>>>>> C:\>openssl s_client -connect localhost:5671 -CAfile testca/cacert.pem
>>>>> -cert cli
>>>>> ent/cert.pem -key client/key.pem -showcerts
>>>>> Loading 'screen' into random state - done
>>>>> CONNECTED(00000160)
>>>>> depth=1 CN = Kiprosh7
>>>>> verify return:1
>>>>> depth=0 CN = Kiprosh7, O = server
>>>>> verify return:1
>>>>> ---
>>>>> Certificate chain
>>>>>    0 s:/CN=Kiprosh7/O=server
>>>>>      i:/CN=Kiprosh7
>>>>> -----BEGIN CERTIFICATE-----
>>>>> MIIC4TCCAcmgAwIBAgIBATANBgkqhkiG9w0BAQUFADATMREwDwYDVQQDEwhLaXBy
>>>>> b3NoNzAeFw0xMTA4MTAwODA1NTBaFw0xMjA4MDkwODA1NTBaMCQxETAPBgNVBAMM
>>>>> CEtpcHJvc2g3MQ8wDQYDVQQKDAZzZXJ2ZXIwggEiMA0GCSqGSIb3DQEBAQUAA4IB
>>>>> DwAwggEKAoIBAQDTDgQ3/vSBPvy0PAZYwk4H2qlFckaA75YfCYZ+HhIb+JUSrZ4r
>>>>> NcBEhvrH+7p1yft9IC4pgrgEbjmfQVTi8LGwtMRZmwpbmjqEfOALpra5x7Plb+7y
>>>>> CTT/iDc8uUwHLn2brXxNRn58IrEeD1X+rBxLNyek0pQu/hH31+REI5Sn1JZfi7gc
>>>>> 3PJEuaRzVJY4sE0neNWT+K+aD0n382qnziLEGOusXWNpggpoHVFKZR3Yojxj6Bfk
>>>>> 9lUvfUtIqz2zQ2dF0q6A0QVVlIenKzUK+rjHxQAUSb8P9CmCuRXUih3f61ahquQP
>>>>> CgSrkNnUV44D/wHfnxNm9QjxlQEGyr0DsTcFAgMBAAGjLzAtMAkGA1UdEwQCMAAw
>>>>> CwYDVR0PBAQDAgUgMBMGA1UdJQQMMAoGCCsGAQUFBwMBMA0GCSqGSIb3DQEBBQUA
>>>>> A4IBAQDE+cXjx6uNL/Kf/HmE7FeQ238iN7Gfb+I1QHmbRaR0qbTqcFzp7NCJ62uq
>>>>> nJ6Anj0+h1IFNMlQrCISSS0fnSj+mXMKDodZzV+cXFjdtoEXyqdDO0zphDMTRd8H
>>>>> oI79XSm5IK6vcPR+g2UTkhgrX1xfgeqZ8hmw0L0mMMGHXclwwaAF9HRNomFt32gr
>>>>> 1sVhFkhH/5epmgcl+8yI1E7UaQc91bYkUEuQFNu7irgc+/tvcXa4O4+dIfhnzrog
>>>>> 8piYUk4dxGME8LknQ213Gow9cgEKzcYadJ4DIr6gChkvAnYpHHHafWj/Ksvxyii6
>>>>> 8FxuTfgsrOYwkqEcSXeCGUS25nU9
>>>>> -----END CERTIFICATE-----
>>>>>    1 s:/CN=Kiprosh7
>>>>>      i:/CN=Kiprosh7
>>>>> -----BEGIN CERTIFICATE-----
>>>>> MIICxjCCAa6gAwIBAgIJANsNRAs/ueOoMA0GCSqGSIb3DQEBBQUAMBMxETAPBgNV
>>>>> BAMTCEtpcHJvc2g3MB4XDTExMDgxMDA4MDEzMloXDTEyMDgwOTA4MDEzMlowEzER
>>>>> MA8GA1UEAxMIS2lwcm9zaDcwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIB
>>>>> AQDorxS4o/H/w7f+VYWkQk3gS7g7gWFd3S4eCVV35a3GEcyP2OS4pUhhZXyB0lN7
>>>>> xmUHqeixx7aNRnrc130SQ4kke1fuxtdLjKxu+oeASMLCSkF356m8X5FhuTnPkf2W
>>>>> x64i6nk9SOO+jdQo/kMChy0H7psKS5I2M0nb5WLxN/JOACNnxJOhFy8cGw7l32q6
>>>>> rEfqLkdnZJR09fiuf0hEbb/UodOt2tXXGN0Pp3X2x4cXnD6E2Va9QSBYIvPAnWEn
>>>>> FN2Te+Qwg+AxwHIkCjH9bfQ7fOeuGHAoanSnlqS5rW/T5sKKlkBl95WeJoTFjrCt
>>>>> CVDLilsnLrfmZkg3ICQtPbgNAgMBAAGjHTAbMAwGA1UdEwQFMAMBAf8wCwYDVR0P
>>>>> BAQDAgEGMA0GCSqGSIb3DQEBBQUAA4IBAQBGtbJQyQ1pWVo+7snqxCOn/KVN++Jo
>>>>> 8YEB4/MGKgHyoTWRAa3IXOSPtpunW/6yDziwcLZeO09MATeKCCAJf64LXZr7aM6J
>>>>> ZX6hFFNUyqa5w9AaZ4sAe70QwDYPS6dPqcyTab/DVVRGhJAKhUc2lX+UfcBhHYaz
>>>>> egKDKyIybHMmcQQm//SO0jo3Ak0565ZAMCdaaO/9RNJpJSxJf+HSVUg4sPLe/sAK
>>>>> QlXcdt8XlKsEKBzUHzfRvpbU/8gn1HO5G+CTvEW2kO6nssuKX41g5hMfRqu248TT
>>>>> jbGWMkYFMPDY1m2QWPqzLvaETGOWHwqpVWXuMhu7/T5sduDf2n084ok7
>>>>> -----END CERTIFICATE-----
>>>>> ---
>>>>> Server certificate
>>>>> subject=/CN=Kiprosh7/O=server
>>>>> issuer=/CN=Kiprosh7
>>>>> ---
>>>>> Acceptable client certificate CA names
>>>>> /CN=Kiprosh7
>>>>> ---
>>>>> SSL handshake has read 1663 bytes and written 2276 bytes
>>>>> ---
>>>>> New, TLSv1/SSLv3, Cipher is AES256-SHA
>>>>> Server public key is 2048 bit
>>>>> Secure Renegotiation IS supported
>>>>> Compression: NONE
>>>>> Expansion: NONE
>>>>> SSL-Session:
>>>>>       Protocol  : TLSv1
>>>>>       Cipher    : AES256-SHA
>>>>>       Session-ID:
>>>>> 8703D018C270CC932648333F61FE3C986CB336B7C8074ACF3560E415934E26F2
>>>>>
>>>>>       Session-ID-ctx:
>>>>>       Master-Key:
>>>>> F5B8C5666355EE6C78910EBB649A65740104537ACEBB28E4A23DF51EA5DE9E6A
>>>>> FE3AC2C95B1929985DAFC09CDC6BDEAE
>>>>>       Key-Arg   : None
>>>>>       PSK identity: None
>>>>>       PSK identity hint: None
>>>>>       Start Time: 1312972974
>>>>>       Timeout   : 300 (sec)
>>>>>       Verify return code: 0 (ok)
>>>>> ---
>>>>>
>>>>>            
>>>> Thanks and Regards,
>>>> Abhijit
>>>>
>>>>
>>>> On 8/10/2011 4:10 PM, Alexandru Scvor?ov wrote:
>>>>
>>>>          
>>>>>>> AMQP server protocol negotiation failure: server version
>>>>>>> unknown-unknown, client version 0-9
>>>>>>>
>>>>>>>
>>>>>>>                
>>>>> That means the client connected successfully but closed the connection
>>>>> later because it wasn't talking to an AMQP server.
>>>>>
>>>>> That means that the client and certificates are fine, so the problem is
>>>>> configuring the server.
>>>>>
>>>>> When you try the other command (the openssl s_client) on the server,
>>>>> what output do you get?  Could you please post it?
>>>>>
>>>>> Alex
>>>>>
>>>>> On Wed, Aug 10, 2011 at 04:00:26PM +0530, Abhijit wrote:
>>>>>
>>>>>
>>>>>            
>>>>>> yes sir
>>>>>> no problem i thought so after looking at client cmd lines i did put
>>>>>> slash instead of dot, and now am getting this errors:
>>>>>>
>>>>>>
>>>>>>
>>>>>>              
>>>>>>> AMQP server protocol negotiation failure: server version
>>>>>>> unknown-unknown, client version 0-9
>>>>>>>
>>>>>>>
>>>>>>>                
>>>>>> Can you tell me what are next steps?
>>>>>>
>>>>>> Thanks and Regards,
>>>>>> Abhijit
>>>>>>
>>>>>>
>>>>>> On 8/10/2011 3:57 PM, Alexandru Scvor?ov wrote:
>>>>>>
>>>>>>
>>>>>>              
>>>>>>>> Am still getting the same error am using the same config file.
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>                  
>>>>>>> Ok, but are you sure it's actually the file used by the server? (we had
>>>>>>> some problems earlier about which file the server was using when started
>>>>>>> from the command prompt or as a service)
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>                
>>>>>>>>> openssl s_server -accept 5671 -CAfile testca/cacert.pem -cert
>>>>>>>>> server/cert.pem -key server.key.pem -state
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>                    
>>>>>>> My mistake.  That should be:
>>>>>>>       openssl s_server -accept 5671 -CAfile testca/cacert.pem -cert
>>>>>>>       server/cert.pem -key server/key.pem -state
>>>>>>>
>>>>>>> (dot instead of slash in server.key.pem)
>>>>>>>
>>>>>>> BTW, if they're disposable, could you send the certificates and keys?
>>>>>>> We've had problems before with the certificates generated by OpenSSL,
>>>>>>> which were usually solved by using a different version.  Maybe this is
>>>>>>> happening here.
>>>>>>>
>>>>>>> Cheers,
>>>>>>> Alex
>>>>>>>
>>>>>>> On Wed, Aug 10, 2011 at 03:46:39PM +0530, Abhijit wrote:
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>                
>>>>>>>> hi sir,
>>>>>>>>
>>>>>>>> Am still getting the same error am using the same config file.
>>>>>>>>
>>>>>>>> But i was not able to run this command you sent me:
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>                  
>>>>>>>>> openssl s_server -accept 5671 -CAfile testca/cacert.pem -cert
>>>>>>>>> server/cert.pem -key server.key.pem -state
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>                    
>>>>>>>> was getting an error: unable to load server certificate private key file.
>>>>>>>>
>>>>>>>> Thanks and Regards,
>>>>>>>> Abhijit
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>                  
>>>>>>
>>>>>>              
>>>>
>>>>          
>>      


From alexandru at rabbitmq.com  Wed Aug 10 15:08:32 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Wed, 10 Aug 2011 15:08:32 +0100
Subject: [rabbitmq-discuss] facing issues with the SSL implementations
 with RabbitMQ + Windows + .Net
In-Reply-To: <4E428DAE.4000703@kiprosh.com>
References: <20110810091649.GC2869@dakota.eng.vmware.com>
	<4E425A87.9050909@kiprosh.com>
	<20110810102710.GD2869@dakota.eng.vmware.com>
	<4E425DC2.1050602@kiprosh.com>
	<20110810104000.GE2869@dakota.eng.vmware.com>
	<4E42617A.3090601@kiprosh.com>
	<20110810115056.GF2869@dakota.eng.vmware.com>
	<4E4272EA.9040308@kiprosh.com>
	<20110810121824.GG2869@dakota.eng.vmware.com>
	<4E428DAE.4000703@kiprosh.com>
Message-ID: <20110810140832.GH2869@dakota.eng.vmware.com>

> but with no luck, do i need something more.

Not that I can think of, no.

If you're using OpenSSL 1.0.0, could you try with OpenSSL 0.9.8?

Cheers,
Alex

On Wed, Aug 10, 2011 at 07:24:54PM +0530, Abhijit wrote:
> Hi sir,
> 
> i went through all the steps again to make certificates in this link:
> > http://www.rabbitmq.com/ssl.html#keys-and-certs
> 
> but with no luck, do i need something more.
> 
> Thanking you,
> 
> Regards,
> Abhijit
> 
> 
> On 8/10/2011 5:48 PM, Alexandru Scvor?ov wrote:
> >> The code worked now. the certificate you provided did work
> >>      
> > Great to hear that.
> >
> >    
> >>   wondering why
> >> my certificates are not working??
> >>      
> > I suspect you got some step in the certificate generation wrong (I
> > generated the certificates following the instructions on the website).
> > It's ridiculously easy to get something wrong.
> >
> > I'd delete all the certificates, and CA you generated and try again.
> > The website instructions are right.  You might want to try without
> > changing anything (the CA's name, for instance) just to see that it
> > works.
> >
> > You could also try a different version of OpenSSL, but I'd be quite
> > surprised if that were the problem.
> >
> > Let us how it goes.
> >
> > Cheers,
> > Alex
> >
> >
> > On Wed, Aug 10, 2011 at 05:30:42PM +0530, Abhijit wrote:
> >    
> >> Hi sir,
> >>
> >> The code worked now. the certificate you provided did work wondering why
> >> my certificates are not working??
> >>
> >> Thanks and Regards,
> >> Abhijit
> >>
> >>
> >>
> >> On 8/10/2011 5:20 PM, Alexandru Scvor?ov wrote:
> >>      
> >>> :(  That seems perfectly fine.
> >>>
> >>> Other ways to get an "unknown ca" error:
> >>>     - forget to add the CA certificate to the Trust store;
> >>>     - have the client use a certificate signed by a different authority
> >>>       than the one given to the server.
> >>>
> >>> I'm out of ideas.  I'm attaching:
> >>>     - cacert.pem and cacert.cer;
> >>>     - keycert.p12 (password is "test");
> >>>     - server's cert.pem, key.pem.
> >>>
> >>> You'll also need to set RemoteCertificateNameMismatch before starting the connection:
> >>>     cf.Ssl.AcceptablePolicyErrors =
> >>>       SslPolicyErrors.RemoteCertificateNameMismatch;
> >>>
> >>> Could you please try with these and see if it works (or if you get a
> >>> different error)?
> >>>
> >>> Cheers,
> >>> Alex
> >>>
> >>> On Wed, Aug 10, 2011 at 04:16:18PM +0530, Abhijit wrote:
> >>>
> >>>        
> >>>> Ok sir thanks,
> >>>>
> >>>> this is the post for the former command s_client:
> >>>>
> >>>>          
> >>>>> C:\>openssl s_client -connect localhost:5671 -CAfile testca/cacert.pem
> >>>>> -cert cli
> >>>>> ent/cert.pem -key client/key.pem -showcerts
> >>>>> Loading 'screen' into random state - done
> >>>>> CONNECTED(00000160)
> >>>>> depth=1 CN = Kiprosh7
> >>>>> verify return:1
> >>>>> depth=0 CN = Kiprosh7, O = server
> >>>>> verify return:1
> >>>>> ---
> >>>>> Certificate chain
> >>>>>    0 s:/CN=Kiprosh7/O=server
> >>>>>      i:/CN=Kiprosh7
> >>>>> -----BEGIN CERTIFICATE-----
> >>>>> MIIC4TCCAcmgAwIBAgIBATANBgkqhkiG9w0BAQUFADATMREwDwYDVQQDEwhLaXBy
> >>>>> b3NoNzAeFw0xMTA4MTAwODA1NTBaFw0xMjA4MDkwODA1NTBaMCQxETAPBgNVBAMM
> >>>>> CEtpcHJvc2g3MQ8wDQYDVQQKDAZzZXJ2ZXIwggEiMA0GCSqGSIb3DQEBAQUAA4IB
> >>>>> DwAwggEKAoIBAQDTDgQ3/vSBPvy0PAZYwk4H2qlFckaA75YfCYZ+HhIb+JUSrZ4r
> >>>>> NcBEhvrH+7p1yft9IC4pgrgEbjmfQVTi8LGwtMRZmwpbmjqEfOALpra5x7Plb+7y
> >>>>> CTT/iDc8uUwHLn2brXxNRn58IrEeD1X+rBxLNyek0pQu/hH31+REI5Sn1JZfi7gc
> >>>>> 3PJEuaRzVJY4sE0neNWT+K+aD0n382qnziLEGOusXWNpggpoHVFKZR3Yojxj6Bfk
> >>>>> 9lUvfUtIqz2zQ2dF0q6A0QVVlIenKzUK+rjHxQAUSb8P9CmCuRXUih3f61ahquQP
> >>>>> CgSrkNnUV44D/wHfnxNm9QjxlQEGyr0DsTcFAgMBAAGjLzAtMAkGA1UdEwQCMAAw
> >>>>> CwYDVR0PBAQDAgUgMBMGA1UdJQQMMAoGCCsGAQUFBwMBMA0GCSqGSIb3DQEBBQUA
> >>>>> A4IBAQDE+cXjx6uNL/Kf/HmE7FeQ238iN7Gfb+I1QHmbRaR0qbTqcFzp7NCJ62uq
> >>>>> nJ6Anj0+h1IFNMlQrCISSS0fnSj+mXMKDodZzV+cXFjdtoEXyqdDO0zphDMTRd8H
> >>>>> oI79XSm5IK6vcPR+g2UTkhgrX1xfgeqZ8hmw0L0mMMGHXclwwaAF9HRNomFt32gr
> >>>>> 1sVhFkhH/5epmgcl+8yI1E7UaQc91bYkUEuQFNu7irgc+/tvcXa4O4+dIfhnzrog
> >>>>> 8piYUk4dxGME8LknQ213Gow9cgEKzcYadJ4DIr6gChkvAnYpHHHafWj/Ksvxyii6
> >>>>> 8FxuTfgsrOYwkqEcSXeCGUS25nU9
> >>>>> -----END CERTIFICATE-----
> >>>>>    1 s:/CN=Kiprosh7
> >>>>>      i:/CN=Kiprosh7
> >>>>> -----BEGIN CERTIFICATE-----
> >>>>> MIICxjCCAa6gAwIBAgIJANsNRAs/ueOoMA0GCSqGSIb3DQEBBQUAMBMxETAPBgNV
> >>>>> BAMTCEtpcHJvc2g3MB4XDTExMDgxMDA4MDEzMloXDTEyMDgwOTA4MDEzMlowEzER
> >>>>> MA8GA1UEAxMIS2lwcm9zaDcwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIB
> >>>>> AQDorxS4o/H/w7f+VYWkQk3gS7g7gWFd3S4eCVV35a3GEcyP2OS4pUhhZXyB0lN7
> >>>>> xmUHqeixx7aNRnrc130SQ4kke1fuxtdLjKxu+oeASMLCSkF356m8X5FhuTnPkf2W
> >>>>> x64i6nk9SOO+jdQo/kMChy0H7psKS5I2M0nb5WLxN/JOACNnxJOhFy8cGw7l32q6
> >>>>> rEfqLkdnZJR09fiuf0hEbb/UodOt2tXXGN0Pp3X2x4cXnD6E2Va9QSBYIvPAnWEn
> >>>>> FN2Te+Qwg+AxwHIkCjH9bfQ7fOeuGHAoanSnlqS5rW/T5sKKlkBl95WeJoTFjrCt
> >>>>> CVDLilsnLrfmZkg3ICQtPbgNAgMBAAGjHTAbMAwGA1UdEwQFMAMBAf8wCwYDVR0P
> >>>>> BAQDAgEGMA0GCSqGSIb3DQEBBQUAA4IBAQBGtbJQyQ1pWVo+7snqxCOn/KVN++Jo
> >>>>> 8YEB4/MGKgHyoTWRAa3IXOSPtpunW/6yDziwcLZeO09MATeKCCAJf64LXZr7aM6J
> >>>>> ZX6hFFNUyqa5w9AaZ4sAe70QwDYPS6dPqcyTab/DVVRGhJAKhUc2lX+UfcBhHYaz
> >>>>> egKDKyIybHMmcQQm//SO0jo3Ak0565ZAMCdaaO/9RNJpJSxJf+HSVUg4sPLe/sAK
> >>>>> QlXcdt8XlKsEKBzUHzfRvpbU/8gn1HO5G+CTvEW2kO6nssuKX41g5hMfRqu248TT
> >>>>> jbGWMkYFMPDY1m2QWPqzLvaETGOWHwqpVWXuMhu7/T5sduDf2n084ok7
> >>>>> -----END CERTIFICATE-----
> >>>>> ---
> >>>>> Server certificate
> >>>>> subject=/CN=Kiprosh7/O=server
> >>>>> issuer=/CN=Kiprosh7
> >>>>> ---
> >>>>> Acceptable client certificate CA names
> >>>>> /CN=Kiprosh7
> >>>>> ---
> >>>>> SSL handshake has read 1663 bytes and written 2276 bytes
> >>>>> ---
> >>>>> New, TLSv1/SSLv3, Cipher is AES256-SHA
> >>>>> Server public key is 2048 bit
> >>>>> Secure Renegotiation IS supported
> >>>>> Compression: NONE
> >>>>> Expansion: NONE
> >>>>> SSL-Session:
> >>>>>       Protocol  : TLSv1
> >>>>>       Cipher    : AES256-SHA
> >>>>>       Session-ID:
> >>>>> 8703D018C270CC932648333F61FE3C986CB336B7C8074ACF3560E415934E26F2
> >>>>>
> >>>>>       Session-ID-ctx:
> >>>>>       Master-Key:
> >>>>> F5B8C5666355EE6C78910EBB649A65740104537ACEBB28E4A23DF51EA5DE9E6A
> >>>>> FE3AC2C95B1929985DAFC09CDC6BDEAE
> >>>>>       Key-Arg   : None
> >>>>>       PSK identity: None
> >>>>>       PSK identity hint: None
> >>>>>       Start Time: 1312972974
> >>>>>       Timeout   : 300 (sec)
> >>>>>       Verify return code: 0 (ok)
> >>>>> ---
> >>>>>
> >>>>>            
> >>>> Thanks and Regards,
> >>>> Abhijit
> >>>>
> >>>>
> >>>> On 8/10/2011 4:10 PM, Alexandru Scvor?ov wrote:
> >>>>
> >>>>          
> >>>>>>> AMQP server protocol negotiation failure: server version
> >>>>>>> unknown-unknown, client version 0-9
> >>>>>>>
> >>>>>>>
> >>>>>>>                
> >>>>> That means the client connected successfully but closed the connection
> >>>>> later because it wasn't talking to an AMQP server.
> >>>>>
> >>>>> That means that the client and certificates are fine, so the problem is
> >>>>> configuring the server.
> >>>>>
> >>>>> When you try the other command (the openssl s_client) on the server,
> >>>>> what output do you get?  Could you please post it?
> >>>>>
> >>>>> Alex
> >>>>>
> >>>>> On Wed, Aug 10, 2011 at 04:00:26PM +0530, Abhijit wrote:
> >>>>>
> >>>>>
> >>>>>            
> >>>>>> yes sir
> >>>>>> no problem i thought so after looking at client cmd lines i did put
> >>>>>> slash instead of dot, and now am getting this errors:
> >>>>>>
> >>>>>>
> >>>>>>
> >>>>>>              
> >>>>>>> AMQP server protocol negotiation failure: server version
> >>>>>>> unknown-unknown, client version 0-9
> >>>>>>>
> >>>>>>>
> >>>>>>>                
> >>>>>> Can you tell me what are next steps?
> >>>>>>
> >>>>>> Thanks and Regards,
> >>>>>> Abhijit
> >>>>>>
> >>>>>>
> >>>>>> On 8/10/2011 3:57 PM, Alexandru Scvor?ov wrote:
> >>>>>>
> >>>>>>
> >>>>>>              
> >>>>>>>> Am still getting the same error am using the same config file.
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>                  
> >>>>>>> Ok, but are you sure it's actually the file used by the server? (we had
> >>>>>>> some problems earlier about which file the server was using when started
> >>>>>>> from the command prompt or as a service)
> >>>>>>>
> >>>>>>>
> >>>>>>>
> >>>>>>>
> >>>>>>>                
> >>>>>>>>> openssl s_server -accept 5671 -CAfile testca/cacert.pem -cert
> >>>>>>>>> server/cert.pem -key server.key.pem -state
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>                    
> >>>>>>> My mistake.  That should be:
> >>>>>>>       openssl s_server -accept 5671 -CAfile testca/cacert.pem -cert
> >>>>>>>       server/cert.pem -key server/key.pem -state
> >>>>>>>
> >>>>>>> (dot instead of slash in server.key.pem)
> >>>>>>>
> >>>>>>> BTW, if they're disposable, could you send the certificates and keys?
> >>>>>>> We've had problems before with the certificates generated by OpenSSL,
> >>>>>>> which were usually solved by using a different version.  Maybe this is
> >>>>>>> happening here.
> >>>>>>>
> >>>>>>> Cheers,
> >>>>>>> Alex
> >>>>>>>
> >>>>>>> On Wed, Aug 10, 2011 at 03:46:39PM +0530, Abhijit wrote:
> >>>>>>>
> >>>>>>>
> >>>>>>>
> >>>>>>>                
> >>>>>>>> hi sir,
> >>>>>>>>
> >>>>>>>> Am still getting the same error am using the same config file.
> >>>>>>>>
> >>>>>>>> But i was not able to run this command you sent me:
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>                  
> >>>>>>>>> openssl s_server -accept 5671 -CAfile testca/cacert.pem -cert
> >>>>>>>>> server/cert.pem -key server.key.pem -state
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>                    
> >>>>>>>> was getting an error: unable to load server certificate private key file.
> >>>>>>>>
> >>>>>>>> Thanks and Regards,
> >>>>>>>> Abhijit
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>                  
> >>>>>>
> >>>>>>              
> >>>>
> >>>>          
> >>      
> 

From abhijit.sinha at kiprosh.com  Wed Aug 10 15:26:51 2011
From: abhijit.sinha at kiprosh.com (Abhijit)
Date: Wed, 10 Aug 2011 19:56:51 +0530
Subject: [rabbitmq-discuss] facing issues with the SSL implementations
 with RabbitMQ + Windows + .Net
In-Reply-To: <20110810140832.GH2869@dakota.eng.vmware.com>
References: <20110810091649.GC2869@dakota.eng.vmware.com>
	<4E425A87.9050909@kiprosh.com>
	<20110810102710.GD2869@dakota.eng.vmware.com>
	<4E425DC2.1050602@kiprosh.com>
	<20110810104000.GE2869@dakota.eng.vmware.com>
	<4E42617A.3090601@kiprosh.com>
	<20110810115056.GF2869@dakota.eng.vmware.com>
	<4E4272EA.9040308@kiprosh.com>
	<20110810121824.GG2869@dakota.eng.vmware.com>
	<4E428DAE.4000703@kiprosh.com>
	<20110810140832.GH2869@dakota.eng.vmware.com>
Message-ID: <4E42952B.5040207@kiprosh.com>

OK Sir

can you tell me did you create your certificates on windows?
or on linux machine?

openssl req -x509 -config openssl.cnf -newkey rsa:2048 -days 365 \
     -out cacert.pem -outform PEM -subj /CN=MyTestCA/ -nodes

i executed above as
openssl req -x509 -config openssl.cnf -newkey rsa:2048 -days 365 -out cacert.pem -outform PEM -subj /CN=MyTestCA/ -nodes

because as you told me that i need to do it similarly as in the website i skipped the '\' since it wasn't a valid element in openssl.

does that caused the error?

Thanks and Regards,
Abhijit



On 8/10/2011 7:38 PM, Alexandru Scvor?ov wrote:
>> but with no luck, do i need something more.
>>      
> Not that I can think of, no.
>
> If you're using OpenSSL 1.0.0, could you try with OpenSSL 0.9.8?
>
> Cheers,
> Alex
>
> On Wed, Aug 10, 2011 at 07:24:54PM +0530, Abhijit wrote:
>    
>> Hi sir,
>>
>> i went through all the steps again to make certificates in this link:
>>      
>>> http://www.rabbitmq.com/ssl.html#keys-and-certs
>>>        
>> but with no luck, do i need something more.
>>
>> Thanking you,
>>
>> Regards,
>> Abhijit
>>
>>
>> On 8/10/2011 5:48 PM, Alexandru Scvor?ov wrote:
>>      
>>>> The code worked now. the certificate you provided did work
>>>>
>>>>          
>>> Great to hear that.
>>>
>>>
>>>        
>>>>    wondering why
>>>> my certificates are not working??
>>>>
>>>>          
>>> I suspect you got some step in the certificate generation wrong (I
>>> generated the certificates following the instructions on the website).
>>> It's ridiculously easy to get something wrong.
>>>
>>> I'd delete all the certificates, and CA you generated and try again.
>>> The website instructions are right.  You might want to try without
>>> changing anything (the CA's name, for instance) just to see that it
>>> works.
>>>
>>> You could also try a different version of OpenSSL, but I'd be quite
>>> surprised if that were the problem.
>>>
>>> Let us how it goes.
>>>
>>> Cheers,
>>> Alex
>>>
>>>
>>> On Wed, Aug 10, 2011 at 05:30:42PM +0530, Abhijit wrote:
>>>
>>>        
>>>> Hi sir,
>>>>
>>>> The code worked now. the certificate you provided did work wondering why
>>>> my certificates are not working??
>>>>
>>>> Thanks and Regards,
>>>> Abhijit
>>>>
>>>>
>>>>
>>>> On 8/10/2011 5:20 PM, Alexandru Scvor?ov wrote:
>>>>
>>>>          
>>>>> :(  That seems perfectly fine.
>>>>>
>>>>> Other ways to get an "unknown ca" error:
>>>>>      - forget to add the CA certificate to the Trust store;
>>>>>      - have the client use a certificate signed by a different authority
>>>>>        than the one given to the server.
>>>>>
>>>>> I'm out of ideas.  I'm attaching:
>>>>>      - cacert.pem and cacert.cer;
>>>>>      - keycert.p12 (password is "test");
>>>>>      - server's cert.pem, key.pem.
>>>>>
>>>>> You'll also need to set RemoteCertificateNameMismatch before starting the connection:
>>>>>      cf.Ssl.AcceptablePolicyErrors =
>>>>>        SslPolicyErrors.RemoteCertificateNameMismatch;
>>>>>
>>>>> Could you please try with these and see if it works (or if you get a
>>>>> different error)?
>>>>>
>>>>> Cheers,
>>>>> Alex
>>>>>
>>>>> On Wed, Aug 10, 2011 at 04:16:18PM +0530, Abhijit wrote:
>>>>>
>>>>>
>>>>>            
>>>>>> Ok sir thanks,
>>>>>>
>>>>>> this is the post for the former command s_client:
>>>>>>
>>>>>>
>>>>>>              
>>>>>>> C:\>openssl s_client -connect localhost:5671 -CAfile testca/cacert.pem
>>>>>>> -cert cli
>>>>>>> ent/cert.pem -key client/key.pem -showcerts
>>>>>>> Loading 'screen' into random state - done
>>>>>>> CONNECTED(00000160)
>>>>>>> depth=1 CN = Kiprosh7
>>>>>>> verify return:1
>>>>>>> depth=0 CN = Kiprosh7, O = server
>>>>>>> verify return:1
>>>>>>> ---
>>>>>>> Certificate chain
>>>>>>>     0 s:/CN=Kiprosh7/O=server
>>>>>>>       i:/CN=Kiprosh7
>>>>>>> -----BEGIN CERTIFICATE-----
>>>>>>> MIIC4TCCAcmgAwIBAgIBATANBgkqhkiG9w0BAQUFADATMREwDwYDVQQDEwhLaXBy
>>>>>>> b3NoNzAeFw0xMTA4MTAwODA1NTBaFw0xMjA4MDkwODA1NTBaMCQxETAPBgNVBAMM
>>>>>>> CEtpcHJvc2g3MQ8wDQYDVQQKDAZzZXJ2ZXIwggEiMA0GCSqGSIb3DQEBAQUAA4IB
>>>>>>> DwAwggEKAoIBAQDTDgQ3/vSBPvy0PAZYwk4H2qlFckaA75YfCYZ+HhIb+JUSrZ4r
>>>>>>> NcBEhvrH+7p1yft9IC4pgrgEbjmfQVTi8LGwtMRZmwpbmjqEfOALpra5x7Plb+7y
>>>>>>> CTT/iDc8uUwHLn2brXxNRn58IrEeD1X+rBxLNyek0pQu/hH31+REI5Sn1JZfi7gc
>>>>>>> 3PJEuaRzVJY4sE0neNWT+K+aD0n382qnziLEGOusXWNpggpoHVFKZR3Yojxj6Bfk
>>>>>>> 9lUvfUtIqz2zQ2dF0q6A0QVVlIenKzUK+rjHxQAUSb8P9CmCuRXUih3f61ahquQP
>>>>>>> CgSrkNnUV44D/wHfnxNm9QjxlQEGyr0DsTcFAgMBAAGjLzAtMAkGA1UdEwQCMAAw
>>>>>>> CwYDVR0PBAQDAgUgMBMGA1UdJQQMMAoGCCsGAQUFBwMBMA0GCSqGSIb3DQEBBQUA
>>>>>>> A4IBAQDE+cXjx6uNL/Kf/HmE7FeQ238iN7Gfb+I1QHmbRaR0qbTqcFzp7NCJ62uq
>>>>>>> nJ6Anj0+h1IFNMlQrCISSS0fnSj+mXMKDodZzV+cXFjdtoEXyqdDO0zphDMTRd8H
>>>>>>> oI79XSm5IK6vcPR+g2UTkhgrX1xfgeqZ8hmw0L0mMMGHXclwwaAF9HRNomFt32gr
>>>>>>> 1sVhFkhH/5epmgcl+8yI1E7UaQc91bYkUEuQFNu7irgc+/tvcXa4O4+dIfhnzrog
>>>>>>> 8piYUk4dxGME8LknQ213Gow9cgEKzcYadJ4DIr6gChkvAnYpHHHafWj/Ksvxyii6
>>>>>>> 8FxuTfgsrOYwkqEcSXeCGUS25nU9
>>>>>>> -----END CERTIFICATE-----
>>>>>>>     1 s:/CN=Kiprosh7
>>>>>>>       i:/CN=Kiprosh7
>>>>>>> -----BEGIN CERTIFICATE-----
>>>>>>> MIICxjCCAa6gAwIBAgIJANsNRAs/ueOoMA0GCSqGSIb3DQEBBQUAMBMxETAPBgNV
>>>>>>> BAMTCEtpcHJvc2g3MB4XDTExMDgxMDA4MDEzMloXDTEyMDgwOTA4MDEzMlowEzER
>>>>>>> MA8GA1UEAxMIS2lwcm9zaDcwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIB
>>>>>>> AQDorxS4o/H/w7f+VYWkQk3gS7g7gWFd3S4eCVV35a3GEcyP2OS4pUhhZXyB0lN7
>>>>>>> xmUHqeixx7aNRnrc130SQ4kke1fuxtdLjKxu+oeASMLCSkF356m8X5FhuTnPkf2W
>>>>>>> x64i6nk9SOO+jdQo/kMChy0H7psKS5I2M0nb5WLxN/JOACNnxJOhFy8cGw7l32q6
>>>>>>> rEfqLkdnZJR09fiuf0hEbb/UodOt2tXXGN0Pp3X2x4cXnD6E2Va9QSBYIvPAnWEn
>>>>>>> FN2Te+Qwg+AxwHIkCjH9bfQ7fOeuGHAoanSnlqS5rW/T5sKKlkBl95WeJoTFjrCt
>>>>>>> CVDLilsnLrfmZkg3ICQtPbgNAgMBAAGjHTAbMAwGA1UdEwQFMAMBAf8wCwYDVR0P
>>>>>>> BAQDAgEGMA0GCSqGSIb3DQEBBQUAA4IBAQBGtbJQyQ1pWVo+7snqxCOn/KVN++Jo
>>>>>>> 8YEB4/MGKgHyoTWRAa3IXOSPtpunW/6yDziwcLZeO09MATeKCCAJf64LXZr7aM6J
>>>>>>> ZX6hFFNUyqa5w9AaZ4sAe70QwDYPS6dPqcyTab/DVVRGhJAKhUc2lX+UfcBhHYaz
>>>>>>> egKDKyIybHMmcQQm//SO0jo3Ak0565ZAMCdaaO/9RNJpJSxJf+HSVUg4sPLe/sAK
>>>>>>> QlXcdt8XlKsEKBzUHzfRvpbU/8gn1HO5G+CTvEW2kO6nssuKX41g5hMfRqu248TT
>>>>>>> jbGWMkYFMPDY1m2QWPqzLvaETGOWHwqpVWXuMhu7/T5sduDf2n084ok7
>>>>>>> -----END CERTIFICATE-----
>>>>>>> ---
>>>>>>> Server certificate
>>>>>>> subject=/CN=Kiprosh7/O=server
>>>>>>> issuer=/CN=Kiprosh7
>>>>>>> ---
>>>>>>> Acceptable client certificate CA names
>>>>>>> /CN=Kiprosh7
>>>>>>> ---
>>>>>>> SSL handshake has read 1663 bytes and written 2276 bytes
>>>>>>> ---
>>>>>>> New, TLSv1/SSLv3, Cipher is AES256-SHA
>>>>>>> Server public key is 2048 bit
>>>>>>> Secure Renegotiation IS supported
>>>>>>> Compression: NONE
>>>>>>> Expansion: NONE
>>>>>>> SSL-Session:
>>>>>>>        Protocol  : TLSv1
>>>>>>>        Cipher    : AES256-SHA
>>>>>>>        Session-ID:
>>>>>>> 8703D018C270CC932648333F61FE3C986CB336B7C8074ACF3560E415934E26F2
>>>>>>>
>>>>>>>        Session-ID-ctx:
>>>>>>>        Master-Key:
>>>>>>> F5B8C5666355EE6C78910EBB649A65740104537ACEBB28E4A23DF51EA5DE9E6A
>>>>>>> FE3AC2C95B1929985DAFC09CDC6BDEAE
>>>>>>>        Key-Arg   : None
>>>>>>>        PSK identity: None
>>>>>>>        PSK identity hint: None
>>>>>>>        Start Time: 1312972974
>>>>>>>        Timeout   : 300 (sec)
>>>>>>>        Verify return code: 0 (ok)
>>>>>>> ---
>>>>>>>
>>>>>>>
>>>>>>>                
>>>>>> Thanks and Regards,
>>>>>> Abhijit
>>>>>>
>>>>>>
>>>>>> On 8/10/2011 4:10 PM, Alexandru Scvor?ov wrote:
>>>>>>
>>>>>>
>>>>>>              
>>>>>>>>> AMQP server protocol negotiation failure: server version
>>>>>>>>> unknown-unknown, client version 0-9
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>                    
>>>>>>> That means the client connected successfully but closed the connection
>>>>>>> later because it wasn't talking to an AMQP server.
>>>>>>>
>>>>>>> That means that the client and certificates are fine, so the problem is
>>>>>>> configuring the server.
>>>>>>>
>>>>>>> When you try the other command (the openssl s_client) on the server,
>>>>>>> what output do you get?  Could you please post it?
>>>>>>>
>>>>>>> Alex
>>>>>>>
>>>>>>> On Wed, Aug 10, 2011 at 04:00:26PM +0530, Abhijit wrote:
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>                
>>>>>>>> yes sir
>>>>>>>> no problem i thought so after looking at client cmd lines i did put
>>>>>>>> slash instead of dot, and now am getting this errors:
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>                  
>>>>>>>>> AMQP server protocol negotiation failure: server version
>>>>>>>>> unknown-unknown, client version 0-9
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>                    
>>>>>>>> Can you tell me what are next steps?
>>>>>>>>
>>>>>>>> Thanks and Regards,
>>>>>>>> Abhijit
>>>>>>>>
>>>>>>>>
>>>>>>>> On 8/10/2011 3:57 PM, Alexandru Scvor?ov wrote:
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>                  
>>>>>>>>>> Am still getting the same error am using the same config file.
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>                      
>>>>>>>>> Ok, but are you sure it's actually the file used by the server? (we had
>>>>>>>>> some problems earlier about which file the server was using when started
>>>>>>>>> from the command prompt or as a service)
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>                    
>>>>>>>>>>> openssl s_server -accept 5671 -CAfile testca/cacert.pem -cert
>>>>>>>>>>> server/cert.pem -key server.key.pem -state
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>                        
>>>>>>>>> My mistake.  That should be:
>>>>>>>>>        openssl s_server -accept 5671 -CAfile testca/cacert.pem -cert
>>>>>>>>>        server/cert.pem -key server/key.pem -state
>>>>>>>>>
>>>>>>>>> (dot instead of slash in server.key.pem)
>>>>>>>>>
>>>>>>>>> BTW, if they're disposable, could you send the certificates and keys?
>>>>>>>>> We've had problems before with the certificates generated by OpenSSL,
>>>>>>>>> which were usually solved by using a different version.  Maybe this is
>>>>>>>>> happening here.
>>>>>>>>>
>>>>>>>>> Cheers,
>>>>>>>>> Alex
>>>>>>>>>
>>>>>>>>> On Wed, Aug 10, 2011 at 03:46:39PM +0530, Abhijit wrote:
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>                    
>>>>>>>>>> hi sir,
>>>>>>>>>>
>>>>>>>>>> Am still getting the same error am using the same config file.
>>>>>>>>>>
>>>>>>>>>> But i was not able to run this command you sent me:
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>                      
>>>>>>>>>>> openssl s_server -accept 5671 -CAfile testca/cacert.pem -cert
>>>>>>>>>>> server/cert.pem -key server.key.pem -state
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>                        
>>>>>>>>>> was getting an error: unable to load server certificate private key file.
>>>>>>>>>>
>>>>>>>>>> Thanks and Regards,
>>>>>>>>>> Abhijit
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>                      
>>>>>>>>
>>>>>>>>                  
>>>>>>
>>>>>>              
>>>>
>>>>          
>>      


From majek04 at gmail.com  Wed Aug 10 15:40:27 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 10 Aug 2011 15:40:27 +0100
Subject: [rabbitmq-discuss] RabbitMQ as website presence system
In-Reply-To: <CACyzuYBa=_p+nug19AJ94qPa2oiJ9vsVXCy3X66htURZK8=sXg@mail.gmail.com>
References: <CACyzuYBa=_p+nug19AJ94qPa2oiJ9vsVXCy3X66htURZK8=sXg@mail.gmail.com>
Message-ID: <CABzX+qzFPySS61T5yHd__vW4W4og7vYFRR-m_NLYA-vX2cRC2w@mail.gmail.com>

On Wed, Aug 10, 2011 at 10:22, Maimon Oded <oded.maimon at gmail.com> wrote:
> Do you know of anyone using RabbitMQ as a presence solution ? (like done
> with XMPP servers).
> if you use it for this purpose, can you describe how please?

Hi,

RabbitMQ (and AMQP in general) don't support anything related
to 'presence'. From RabbitMQ point of view, user produces
messages, user consumes messages and that's more or less it.

Maintaining presence is (in my opinion) application specific,
and in most cases you should end up implementing roster
in your application.

In ideal world you could do that by just sending a message to yourself
when user connects and disconnects, however in practice that's
usually not so trivial.

In order to do this simple thing server-side Tony wrote a x-presence
exchange plugin some time ago. Here it is, I dusted it off a bit:
  https://github.com/majek/rabbitmq-x-presence

Take a look, and please do tell us if it helps to solve your particular problem.

Cheers,
  Marek

From alexandru at rabbitmq.com  Wed Aug 10 15:45:46 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Wed, 10 Aug 2011 15:45:46 +0100
Subject: [rabbitmq-discuss] facing issues with the SSL implementations
 with RabbitMQ + Windows + .Net
In-Reply-To: <4E42952B.5040207@kiprosh.com>
References: <20110810102710.GD2869@dakota.eng.vmware.com>
	<4E425DC2.1050602@kiprosh.com>
	<20110810104000.GE2869@dakota.eng.vmware.com>
	<4E42617A.3090601@kiprosh.com>
	<20110810115056.GF2869@dakota.eng.vmware.com>
	<4E4272EA.9040308@kiprosh.com>
	<20110810121824.GG2869@dakota.eng.vmware.com>
	<4E428DAE.4000703@kiprosh.com>
	<20110810140832.GH2869@dakota.eng.vmware.com>
	<4E42952B.5040207@kiprosh.com>
Message-ID: <20110810144546.GI2869@dakota.eng.vmware.com>

> can you tell me did you create your certificates on windows?
> or on linux machine?

I generated the certificates on Windows Server 2008.

> openssl req -x509 -config openssl.cnf -newkey rsa:2048 -days 365 \
>      -out cacert.pem -outform PEM -subj /CN=MyTestCA/ -nodes
> 
> i executed above as
> openssl req -x509 -config openssl.cnf -newkey rsa:2048 -days 365 -out cacert.pem -outform PEM -subj /CN=MyTestCA/ -nodes

I did the same thing.

Could you send the certificates you're using? (same files I sent
earlier)  I'll see if I can find anything wrong with them.

Alex

On Wed, Aug 10, 2011 at 07:56:51PM +0530, Abhijit wrote:
> OK Sir
> 
> can you tell me did you create your certificates on windows?
> or on linux machine?
> 
> openssl req -x509 -config openssl.cnf -newkey rsa:2048 -days 365 \
>      -out cacert.pem -outform PEM -subj /CN=MyTestCA/ -nodes
> 
> i executed above as
> openssl req -x509 -config openssl.cnf -newkey rsa:2048 -days 365 -out cacert.pem -outform PEM -subj /CN=MyTestCA/ -nodes
> 
> because as you told me that i need to do it similarly as in the website i skipped the '\' since it wasn't a valid element in openssl.
> 
> does that caused the error?
> 
> Thanks and Regards,
> Abhijit
> 
> 
> 
> On 8/10/2011 7:38 PM, Alexandru Scvor?ov wrote:
> >> but with no luck, do i need something more.
> >>      
> > Not that I can think of, no.
> >
> > If you're using OpenSSL 1.0.0, could you try with OpenSSL 0.9.8?
> >
> > Cheers,
> > Alex
> >
> > On Wed, Aug 10, 2011 at 07:24:54PM +0530, Abhijit wrote:
> >    
> >> Hi sir,
> >>
> >> i went through all the steps again to make certificates in this link:
> >>      
> >>> http://www.rabbitmq.com/ssl.html#keys-and-certs
> >>>        
> >> but with no luck, do i need something more.
> >>
> >> Thanking you,
> >>
> >> Regards,
> >> Abhijit
> >>
> >>
> >> On 8/10/2011 5:48 PM, Alexandru Scvor?ov wrote:
> >>      
> >>>> The code worked now. the certificate you provided did work
> >>>>
> >>>>          
> >>> Great to hear that.
> >>>
> >>>
> >>>        
> >>>>    wondering why
> >>>> my certificates are not working??
> >>>>
> >>>>          
> >>> I suspect you got some step in the certificate generation wrong (I
> >>> generated the certificates following the instructions on the website).
> >>> It's ridiculously easy to get something wrong.
> >>>
> >>> I'd delete all the certificates, and CA you generated and try again.
> >>> The website instructions are right.  You might want to try without
> >>> changing anything (the CA's name, for instance) just to see that it
> >>> works.
> >>>
> >>> You could also try a different version of OpenSSL, but I'd be quite
> >>> surprised if that were the problem.
> >>>
> >>> Let us how it goes.
> >>>
> >>> Cheers,
> >>> Alex
> >>>
> >>>
> >>> On Wed, Aug 10, 2011 at 05:30:42PM +0530, Abhijit wrote:
> >>>
> >>>        
> >>>> Hi sir,
> >>>>
> >>>> The code worked now. the certificate you provided did work wondering why
> >>>> my certificates are not working??
> >>>>
> >>>> Thanks and Regards,
> >>>> Abhijit
> >>>>
> >>>>
> >>>>
> >>>> On 8/10/2011 5:20 PM, Alexandru Scvor?ov wrote:
> >>>>
> >>>>          
> >>>>> :(  That seems perfectly fine.
> >>>>>
> >>>>> Other ways to get an "unknown ca" error:
> >>>>>      - forget to add the CA certificate to the Trust store;
> >>>>>      - have the client use a certificate signed by a different authority
> >>>>>        than the one given to the server.
> >>>>>
> >>>>> I'm out of ideas.  I'm attaching:
> >>>>>      - cacert.pem and cacert.cer;
> >>>>>      - keycert.p12 (password is "test");
> >>>>>      - server's cert.pem, key.pem.
> >>>>>
> >>>>> You'll also need to set RemoteCertificateNameMismatch before starting the connection:
> >>>>>      cf.Ssl.AcceptablePolicyErrors =
> >>>>>        SslPolicyErrors.RemoteCertificateNameMismatch;
> >>>>>
> >>>>> Could you please try with these and see if it works (or if you get a
> >>>>> different error)?
> >>>>>
> >>>>> Cheers,
> >>>>> Alex
> >>>>>
> >>>>> On Wed, Aug 10, 2011 at 04:16:18PM +0530, Abhijit wrote:
> >>>>>
> >>>>>
> >>>>>            
> >>>>>> Ok sir thanks,
> >>>>>>
> >>>>>> this is the post for the former command s_client:
> >>>>>>
> >>>>>>
> >>>>>>              
> >>>>>>> C:\>openssl s_client -connect localhost:5671 -CAfile testca/cacert.pem
> >>>>>>> -cert cli
> >>>>>>> ent/cert.pem -key client/key.pem -showcerts
> >>>>>>> Loading 'screen' into random state - done
> >>>>>>> CONNECTED(00000160)
> >>>>>>> depth=1 CN = Kiprosh7
> >>>>>>> verify return:1
> >>>>>>> depth=0 CN = Kiprosh7, O = server
> >>>>>>> verify return:1
> >>>>>>> ---
> >>>>>>> Certificate chain
> >>>>>>>     0 s:/CN=Kiprosh7/O=server
> >>>>>>>       i:/CN=Kiprosh7
> >>>>>>> -----BEGIN CERTIFICATE-----
> >>>>>>> MIIC4TCCAcmgAwIBAgIBATANBgkqhkiG9w0BAQUFADATMREwDwYDVQQDEwhLaXBy
> >>>>>>> b3NoNzAeFw0xMTA4MTAwODA1NTBaFw0xMjA4MDkwODA1NTBaMCQxETAPBgNVBAMM
> >>>>>>> CEtpcHJvc2g3MQ8wDQYDVQQKDAZzZXJ2ZXIwggEiMA0GCSqGSIb3DQEBAQUAA4IB
> >>>>>>> DwAwggEKAoIBAQDTDgQ3/vSBPvy0PAZYwk4H2qlFckaA75YfCYZ+HhIb+JUSrZ4r
> >>>>>>> NcBEhvrH+7p1yft9IC4pgrgEbjmfQVTi8LGwtMRZmwpbmjqEfOALpra5x7Plb+7y
> >>>>>>> CTT/iDc8uUwHLn2brXxNRn58IrEeD1X+rBxLNyek0pQu/hH31+REI5Sn1JZfi7gc
> >>>>>>> 3PJEuaRzVJY4sE0neNWT+K+aD0n382qnziLEGOusXWNpggpoHVFKZR3Yojxj6Bfk
> >>>>>>> 9lUvfUtIqz2zQ2dF0q6A0QVVlIenKzUK+rjHxQAUSb8P9CmCuRXUih3f61ahquQP
> >>>>>>> CgSrkNnUV44D/wHfnxNm9QjxlQEGyr0DsTcFAgMBAAGjLzAtMAkGA1UdEwQCMAAw
> >>>>>>> CwYDVR0PBAQDAgUgMBMGA1UdJQQMMAoGCCsGAQUFBwMBMA0GCSqGSIb3DQEBBQUA
> >>>>>>> A4IBAQDE+cXjx6uNL/Kf/HmE7FeQ238iN7Gfb+I1QHmbRaR0qbTqcFzp7NCJ62uq
> >>>>>>> nJ6Anj0+h1IFNMlQrCISSS0fnSj+mXMKDodZzV+cXFjdtoEXyqdDO0zphDMTRd8H
> >>>>>>> oI79XSm5IK6vcPR+g2UTkhgrX1xfgeqZ8hmw0L0mMMGHXclwwaAF9HRNomFt32gr
> >>>>>>> 1sVhFkhH/5epmgcl+8yI1E7UaQc91bYkUEuQFNu7irgc+/tvcXa4O4+dIfhnzrog
> >>>>>>> 8piYUk4dxGME8LknQ213Gow9cgEKzcYadJ4DIr6gChkvAnYpHHHafWj/Ksvxyii6
> >>>>>>> 8FxuTfgsrOYwkqEcSXeCGUS25nU9
> >>>>>>> -----END CERTIFICATE-----
> >>>>>>>     1 s:/CN=Kiprosh7
> >>>>>>>       i:/CN=Kiprosh7
> >>>>>>> -----BEGIN CERTIFICATE-----
> >>>>>>> MIICxjCCAa6gAwIBAgIJANsNRAs/ueOoMA0GCSqGSIb3DQEBBQUAMBMxETAPBgNV
> >>>>>>> BAMTCEtpcHJvc2g3MB4XDTExMDgxMDA4MDEzMloXDTEyMDgwOTA4MDEzMlowEzER
> >>>>>>> MA8GA1UEAxMIS2lwcm9zaDcwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIB
> >>>>>>> AQDorxS4o/H/w7f+VYWkQk3gS7g7gWFd3S4eCVV35a3GEcyP2OS4pUhhZXyB0lN7
> >>>>>>> xmUHqeixx7aNRnrc130SQ4kke1fuxtdLjKxu+oeASMLCSkF356m8X5FhuTnPkf2W
> >>>>>>> x64i6nk9SOO+jdQo/kMChy0H7psKS5I2M0nb5WLxN/JOACNnxJOhFy8cGw7l32q6
> >>>>>>> rEfqLkdnZJR09fiuf0hEbb/UodOt2tXXGN0Pp3X2x4cXnD6E2Va9QSBYIvPAnWEn
> >>>>>>> FN2Te+Qwg+AxwHIkCjH9bfQ7fOeuGHAoanSnlqS5rW/T5sKKlkBl95WeJoTFjrCt
> >>>>>>> CVDLilsnLrfmZkg3ICQtPbgNAgMBAAGjHTAbMAwGA1UdEwQFMAMBAf8wCwYDVR0P
> >>>>>>> BAQDAgEGMA0GCSqGSIb3DQEBBQUAA4IBAQBGtbJQyQ1pWVo+7snqxCOn/KVN++Jo
> >>>>>>> 8YEB4/MGKgHyoTWRAa3IXOSPtpunW/6yDziwcLZeO09MATeKCCAJf64LXZr7aM6J
> >>>>>>> ZX6hFFNUyqa5w9AaZ4sAe70QwDYPS6dPqcyTab/DVVRGhJAKhUc2lX+UfcBhHYaz
> >>>>>>> egKDKyIybHMmcQQm//SO0jo3Ak0565ZAMCdaaO/9RNJpJSxJf+HSVUg4sPLe/sAK
> >>>>>>> QlXcdt8XlKsEKBzUHzfRvpbU/8gn1HO5G+CTvEW2kO6nssuKX41g5hMfRqu248TT
> >>>>>>> jbGWMkYFMPDY1m2QWPqzLvaETGOWHwqpVWXuMhu7/T5sduDf2n084ok7
> >>>>>>> -----END CERTIFICATE-----
> >>>>>>> ---
> >>>>>>> Server certificate
> >>>>>>> subject=/CN=Kiprosh7/O=server
> >>>>>>> issuer=/CN=Kiprosh7
> >>>>>>> ---
> >>>>>>> Acceptable client certificate CA names
> >>>>>>> /CN=Kiprosh7
> >>>>>>> ---
> >>>>>>> SSL handshake has read 1663 bytes and written 2276 bytes
> >>>>>>> ---
> >>>>>>> New, TLSv1/SSLv3, Cipher is AES256-SHA
> >>>>>>> Server public key is 2048 bit
> >>>>>>> Secure Renegotiation IS supported
> >>>>>>> Compression: NONE
> >>>>>>> Expansion: NONE
> >>>>>>> SSL-Session:
> >>>>>>>        Protocol  : TLSv1
> >>>>>>>        Cipher    : AES256-SHA
> >>>>>>>        Session-ID:
> >>>>>>> 8703D018C270CC932648333F61FE3C986CB336B7C8074ACF3560E415934E26F2
> >>>>>>>
> >>>>>>>        Session-ID-ctx:
> >>>>>>>        Master-Key:
> >>>>>>> F5B8C5666355EE6C78910EBB649A65740104537ACEBB28E4A23DF51EA5DE9E6A
> >>>>>>> FE3AC2C95B1929985DAFC09CDC6BDEAE
> >>>>>>>        Key-Arg   : None
> >>>>>>>        PSK identity: None
> >>>>>>>        PSK identity hint: None
> >>>>>>>        Start Time: 1312972974
> >>>>>>>        Timeout   : 300 (sec)
> >>>>>>>        Verify return code: 0 (ok)
> >>>>>>> ---
> >>>>>>>
> >>>>>>>
> >>>>>>>                
> >>>>>> Thanks and Regards,
> >>>>>> Abhijit
> >>>>>>
> >>>>>>
> >>>>>> On 8/10/2011 4:10 PM, Alexandru Scvor?ov wrote:
> >>>>>>
> >>>>>>
> >>>>>>              
> >>>>>>>>> AMQP server protocol negotiation failure: server version
> >>>>>>>>> unknown-unknown, client version 0-9
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>                    
> >>>>>>> That means the client connected successfully but closed the connection
> >>>>>>> later because it wasn't talking to an AMQP server.
> >>>>>>>
> >>>>>>> That means that the client and certificates are fine, so the problem is
> >>>>>>> configuring the server.
> >>>>>>>
> >>>>>>> When you try the other command (the openssl s_client) on the server,
> >>>>>>> what output do you get?  Could you please post it?
> >>>>>>>
> >>>>>>> Alex
> >>>>>>>
> >>>>>>> On Wed, Aug 10, 2011 at 04:00:26PM +0530, Abhijit wrote:
> >>>>>>>
> >>>>>>>
> >>>>>>>
> >>>>>>>                
> >>>>>>>> yes sir
> >>>>>>>> no problem i thought so after looking at client cmd lines i did put
> >>>>>>>> slash instead of dot, and now am getting this errors:
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>                  
> >>>>>>>>> AMQP server protocol negotiation failure: server version
> >>>>>>>>> unknown-unknown, client version 0-9
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>                    
> >>>>>>>> Can you tell me what are next steps?
> >>>>>>>>
> >>>>>>>> Thanks and Regards,
> >>>>>>>> Abhijit
> >>>>>>>>
> >>>>>>>>
> >>>>>>>> On 8/10/2011 3:57 PM, Alexandru Scvor?ov wrote:
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>                  
> >>>>>>>>>> Am still getting the same error am using the same config file.
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>                      
> >>>>>>>>> Ok, but are you sure it's actually the file used by the server? (we had
> >>>>>>>>> some problems earlier about which file the server was using when started
> >>>>>>>>> from the command prompt or as a service)
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>                    
> >>>>>>>>>>> openssl s_server -accept 5671 -CAfile testca/cacert.pem -cert
> >>>>>>>>>>> server/cert.pem -key server.key.pem -state
> >>>>>>>>>>>
> >>>>>>>>>>>
> >>>>>>>>>>>
> >>>>>>>>>>>
> >>>>>>>>>>>                        
> >>>>>>>>> My mistake.  That should be:
> >>>>>>>>>        openssl s_server -accept 5671 -CAfile testca/cacert.pem -cert
> >>>>>>>>>        server/cert.pem -key server/key.pem -state
> >>>>>>>>>
> >>>>>>>>> (dot instead of slash in server.key.pem)
> >>>>>>>>>
> >>>>>>>>> BTW, if they're disposable, could you send the certificates and keys?
> >>>>>>>>> We've had problems before with the certificates generated by OpenSSL,
> >>>>>>>>> which were usually solved by using a different version.  Maybe this is
> >>>>>>>>> happening here.
> >>>>>>>>>
> >>>>>>>>> Cheers,
> >>>>>>>>> Alex
> >>>>>>>>>
> >>>>>>>>> On Wed, Aug 10, 2011 at 03:46:39PM +0530, Abhijit wrote:
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>                    
> >>>>>>>>>> hi sir,
> >>>>>>>>>>
> >>>>>>>>>> Am still getting the same error am using the same config file.
> >>>>>>>>>>
> >>>>>>>>>> But i was not able to run this command you sent me:
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>                      
> >>>>>>>>>>> openssl s_server -accept 5671 -CAfile testca/cacert.pem -cert
> >>>>>>>>>>> server/cert.pem -key server.key.pem -state
> >>>>>>>>>>>
> >>>>>>>>>>>
> >>>>>>>>>>>
> >>>>>>>>>>>
> >>>>>>>>>>>                        
> >>>>>>>>>> was getting an error: unable to load server certificate private key file.
> >>>>>>>>>>
> >>>>>>>>>> Thanks and Regards,
> >>>>>>>>>> Abhijit
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>                      
> >>>>>>>>
> >>>>>>>>                  
> >>>>>>
> >>>>>>              
> >>>>
> >>>>          
> >>      
> 

From ekirpichov at gmail.com  Wed Aug 10 16:59:36 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Wed, 10 Aug 2011 08:59:36 -0700
Subject: [rabbitmq-discuss] RabbitMQ doesn't start after having crashed with
 "too many processes", "Last message in was {'$gen_cast', emit_stats}"
Message-ID: <CANVKUrWxTEzcuMXig+RHg8o_jr=OH4wziQTrPebO9=RN-NwZ-w@mail.gmail.com>

Hi,

I had a case where several thousand consumers from several hundred
machines tried to connect to a single instance of rabbitmq (with 1
connection per machine), causing it to die of "too many processes".

The curious thing is that subsequently rabbitmq ***was not able to
even start, until the process limit was increased.***

Is this expected behavior?

I'm attaching the rabbitmq log, which contains both the brave death
and futile startup attempts.

-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit at rack2unit001.log
Type: application/octet-stream
Size: 517673 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110810/e3241318/attachment.obj>

From matthew at rabbitmq.com  Wed Aug 10 17:27:18 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 10 Aug 2011 17:27:18 +0100
Subject: [rabbitmq-discuss] A few questions about custom
 rabbit_msg_store_index implementations
In-Reply-To: <CAE3HoVSpxNvrHVDY39OB0NAxat0-c=1kt+Lt2x+k1wCx1dURiw@mail.gmail.com>
References: <CAE3HoVSpxNvrHVDY39OB0NAxat0-c=1kt+Lt2x+k1wCx1dURiw@mail.gmail.com>
Message-ID: <20110810162717.GC4449@rabbitmq.com>

Hi Michael,

On Wed, Aug 03, 2011 at 06:43:41PM +0400, Michael Klishin wrote:
> I am looking at implementing my own rabbit_msg_store_index that would use
> Redis (probably with JSON serialization
> of Erlang data types, I need basic queue inspection capabilities and don't
> care much about performance degradation compared to
> raw ETS).
> 
> My first question is, could someone from the rabbitmq team briefly explain
> when each of the functions is used? insert and delete
> are pretty self-explanatory but some others are not. This is what I am
> referring to:
> 
> behaviour_info(callbacks) ->
>     [{new,            1},
>      {recover,        1},
>      {lookup,         2},
>      {insert,         2},
>      {update,         2},
>      {update_fields,  3},
>      {delete,         2},
>      {delete_by_file, 2},
>      {terminate,      1}];

I'm afraid this isn't what you're looking for. A brief explanation of
the architecture is as follows:

Each queue is a a process which has its API in amqqueue, and its
implementation in amqqueue_process. amqqueue_process does quite
high-level things though and isn't concerned with the storage of
messages in any way. Thus every queue is parameterised with an
implementation of backing_queue. There is currently one implementation
of backing_queue which is variable_queue (though there used to be
another called invariable_queue which used the old persister). The
purpose of the backing_queue interface is to abstract out all concerns
about storage of messages, memory pressure etc etc.

variable_queue itself depends on queue_index and msg_store. queue_index
is there so that when queues need to, they can store to disk ordering
information and queue-msg-specific data (i.e. in _this_ queue, msg B
follows msg A, and in _this_ queue, msg A has been delivered). Note that
because the same msg can end up in multiple different queues (and that
msg will have the same identity in every queue), it's important to
identify which bits of information are specific to a msg in a particular
queue. The storage of that information on disk is the purpose of
queue_index.

msg_store is a node-global process that is concerned with the storage of
msgs themselves on disk. It is, if you like, a very very specialised
form of key-value store where updates are not allowed, clients of the
store must behave in a particular way, and entries are refernce counted.
The msg_store knows nothing about queues and cares not about any
ordering issues. The msg_store has to have a couple of indexes which
allows it to keep track of where msgs are. Thus the msg_store_index is
simply there to provide the mapping from msg id to
{file,offset,length,ref_count}. The reason it's abstracted is because in
its normal form (i.e. an ets table), each entry costs RAM, and there is
one entry per message. If you actually need to have queues of such
length that they are bounded by disk space only, then you install
rabbitmq-toke, which replaces this ets mapping with a tokyo-cabinet
mapping which is a bit slower, but the mapping has fixed memory
footprint and is itself disk based. Thus you eliminate what is the last
major per-message RAM cost.

Regardless of the entries in this mapping, they tell you nothing about
which queues the msgs belong to, nor which order they occur in the
queues. This mapping tells you _where_ msgs can be found. It doesn't
give you the msgs themselves. It also can't be safely used on its own:
there are other mappings which tell you information about the state of
the files, and in some cases (eg a disk GC going on), files may be
locked as msgs are moved around and compacted. Thus at various points,
the contents of the msg_store_index mapping are wrong and can't be used.

I suspect what you want to do is to implement backing_queue such that it
stores msgs in something like redis. It shouldn't be too hard to do that
for the basic cases, especially if performance isn't a concern.

I trust you've read
http://www.rabbitmq.com/blog/2011/01/20/rabbitmq-backing-stores-databases-and-disks/

Hope that helps,

Matthew

From steve at rabbitmq.com  Wed Aug 10 17:59:00 2011
From: steve at rabbitmq.com (Steve Powell)
Date: Wed, 10 Aug 2011 17:59:00 +0100
Subject: [rabbitmq-discuss] RabbitMQ and Stomp topic behavior
In-Reply-To: <CAMOXM296Yq5gKQsbNbkRmF_=1oprjwDzHqMUYLD5fFhr+b-P_Q@mail.gmail.com>
References: <CAMOXM28j7MMaPtrCyFLsdS1p4-RbbBgp8zH27dvcvmSEXV1RKA@mail.gmail.com>
	<CAMOXM2-vt7fVArCVN_p_1Lmn8e+ubR+d3S2KFu9M=9Jy8FZRxA@mail.gmail.com>
	<4E3FFB77.5060903@rabbitmq.com>
	<CAMOXM28hGfczSAUH5ELmhYzaZ0QfQe3T_1D-Ju5Hmaf-Zmef3w@mail.gmail.com>
	<4E3FFF5B.5060105@rabbitmq.com> <4E400405.8000001@rabbitmq.com>
	<CAMOXM29=Svs6JM+m+t45cKoQUimy=2KL75=heW9zJFt_0RXPHw@mail.gmail.com>
	<4E40EAFF.1010804@rabbitmq.com>
	<CAMOXM2_2XbwMr5ajyVHvhwkoEuK1hWWHE9jLz+Wf7VhOuF17ZQ@mail.gmail.com>
	<4E40F2C5.2000603@rabbitmq.com>
	<CAMOXM296Yq5gKQsbNbkRmF_=1oprjwDzHqMUYLD5fFhr+b-P_Q@mail.gmail.com>
Message-ID: <F33050DA-8EFB-42D4-BD6A-6C3DAF28A2D8@rabbitmq.com>

Massimo,
I'm attempting to reproduce your sbt results on a Linux VM. Please can you send me your sbt configuration, and any other setup files you have in your sbt project?

Thank you.
Steve Powell  (a hippy bunny)
----------some definitions from the SPD----------
Rigatoni n. A prime-ministerial grin.
Nigella n. The next bottle-size up from a Nebuchadnezzar.
Homily adv. Rather like a frenchman.

On 9 Aug 2011, at 09:47, Massimo Paladin wrote:
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-August/014404.html
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110810/2a93ca8d/attachment.htm>

From majek04 at gmail.com  Wed Aug 10 18:58:38 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 10 Aug 2011 18:58:38 +0100
Subject: [rabbitmq-discuss] RabbitMQ doesn't start after having crashed
 with "too many processes", "Last message in was {'$gen_cast', emit_stats}"
In-Reply-To: <CANVKUrWxTEzcuMXig+RHg8o_jr=OH4wziQTrPebO9=RN-NwZ-w@mail.gmail.com>
References: <CANVKUrWxTEzcuMXig+RHg8o_jr=OH4wziQTrPebO9=RN-NwZ-w@mail.gmail.com>
Message-ID: <CABzX+qyxj3rkxfpiGrDorUymT=uVjE4V5DucAdLy+WRh7dQytw@mail.gmail.com>

On Wed, Aug 10, 2011 at 16:59, Eugene Kirpichov <ekirpichov at gmail.com> wrote:
> I had a case where several thousand consumers from several hundred
> machines tried to connect to a single instance of rabbitmq (with 1
> connection per machine), causing it to die of "too many processes".
>
> The curious thing is that subsequently rabbitmq ***was not able to
> even start, until the process limit was increased.***
>
> Is this expected behavior?

In some cases - yes. For example if you have more durable queues
than available processes.

> I'm attaching the rabbitmq log, which contains both the brave death
> and futile startup attempts.

I can see the death indeed, I can't see restarts.

Cheers,
  Marek

From michael.s.klishin at gmail.com  Wed Aug 10 19:26:03 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 10 Aug 2011 22:26:03 +0400
Subject: [rabbitmq-discuss] A few questions about custom
 rabbit_msg_store_index implementations
In-Reply-To: <20110810162717.GC4449@rabbitmq.com>
References: <CAE3HoVSpxNvrHVDY39OB0NAxat0-c=1kt+Lt2x+k1wCx1dURiw@mail.gmail.com>
	<20110810162717.GC4449@rabbitmq.com>
Message-ID: <CAE3HoVRgG6a-HMBX7Otk924zJikdK07yfVHyLzWfU56OdBv25g@mail.gmail.com>

2011/8/10 Matthew Sackman <matthew at rabbitmq.com>

> I suspect what you want to do is to implement backing_queue such that it
> stores msgs in something like redis. It shouldn't be too hard to do that
> for the basic cases, especially if performance isn't a concern.
>

Matthew,

Thanks, that was more or less what I figured after reading the source. I
have one more question now:
how do you think I should go about vhosts? I often use vhosts to separate
environment (staging vs production, for example)
and thinking about using separate Redis databases for vhosts. Is this the
right way to go about it or do queues have some
kind of uniqueue identifiers Rabbit will use anyway?
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110810/15bb490e/attachment.htm>

From matthew at rabbitmq.com  Wed Aug 10 19:48:52 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 10 Aug 2011 19:48:52 +0100
Subject: [rabbitmq-discuss] A few questions about custom
 rabbit_msg_store_index implementations
In-Reply-To: <CAE3HoVRgG6a-HMBX7Otk924zJikdK07yfVHyLzWfU56OdBv25g@mail.gmail.com>
References: <CAE3HoVSpxNvrHVDY39OB0NAxat0-c=1kt+Lt2x+k1wCx1dURiw@mail.gmail.com>
	<20110810162717.GC4449@rabbitmq.com>
	<CAE3HoVRgG6a-HMBX7Otk924zJikdK07yfVHyLzWfU56OdBv25g@mail.gmail.com>
Message-ID: <20110810184851.GA27458@rabbitmq.com>

Hi Michael,

On Wed, Aug 10, 2011 at 10:26:03PM +0400, Michael Klishin wrote:
> how do you think I should go about vhosts? I often use vhosts to separate
> environment (staging vs production, for example)
> and thinking about using separate Redis databases for vhosts. Is this the
> right way to go about it or do queues have some
> kind of uniqueue identifiers Rabbit will use anyway?

The standard resource record that rabbit uses internally includes the
vhost, the type of the resource (queue, exchange, binding etc) and the
vhost-local name of the resource. You'll need something similar.

Matthew

From Massimo.Paladin at cern.ch  Wed Aug 10 22:10:22 2011
From: Massimo.Paladin at cern.ch (Massimo Paladin)
Date: Wed, 10 Aug 2011 23:10:22 +0200
Subject: [rabbitmq-discuss] RabbitMQ and Stomp topic behavior
In-Reply-To: <F33050DA-8EFB-42D4-BD6A-6C3DAF28A2D8@rabbitmq.com>
References: <CAMOXM28j7MMaPtrCyFLsdS1p4-RbbBgp8zH27dvcvmSEXV1RKA@mail.gmail.com>
	<CAMOXM2-vt7fVArCVN_p_1Lmn8e+ubR+d3S2KFu9M=9Jy8FZRxA@mail.gmail.com>
	<4E3FFB77.5060903@rabbitmq.com>
	<CAMOXM28hGfczSAUH5ELmhYzaZ0QfQe3T_1D-Ju5Hmaf-Zmef3w@mail.gmail.com>
	<4E3FFF5B.5060105@rabbitmq.com> <4E400405.8000001@rabbitmq.com>
	<CAMOXM29=Svs6JM+m+t45cKoQUimy=2KL75=heW9zJFt_0RXPHw@mail.gmail.com>
	<4E40EAFF.1010804@rabbitmq.com>
	<CAMOXM2_2XbwMr5ajyVHvhwkoEuK1hWWHE9jLz+Wf7VhOuF17ZQ@mail.gmail.com>
	<4E40F2C5.2000603@rabbitmq.com>
	<CAMOXM296Yq5gKQsbNbkRmF_=1oprjwDzHqMUYLD5fFhr+b-P_Q@mail.gmail.com>
	<F33050DA-8EFB-42D4-BD6A-6C3DAF28A2D8@rabbitmq.com>
Message-ID: <CAMOXM2_zpCceQReE86an94S55ai9Bi5mSus6XSmwsEK56gN2rQ@mail.gmail.com>

Hi Steve,

I do not have any special sbt configuration.
I just setup stomp-benchmark as it is described in the web page.
Then I run the scenario file I attached to the first email of the discussion
with the command line specified.

Do you need more?

Regards,
---
Massimo Paladin

email: massimo.paladin at gmail.com
website: http://www.mpaladin.com
flickr's page: http://flickr.com/photos/massimop


On Wed, Aug 10, 2011 at 6:59 PM, Steve Powell <steve at rabbitmq.com> wrote:

> Massimo,
> I'm attempting to reproduce your sbt results on a Linux VM. Please can you
> send me your sbt configuration, and any other setup files you have in your
> sbt project?
>
> Thank you.
>  Steve Powell  (*a hippy bunny*)
> *----------some definitions from the SPD----------*
> *Rigatoni* *n.* A prime-ministerial grin.
> *Nigella* *n.* The next bottle-size up from a Nebuchadnezzar.
> *Homily* *adv.* Rather like a frenchman.
>
> On 9 Aug 2011, at 09:47, Massimo Paladin wrote:
>
>
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-August/014404.html
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110810/45ec7e40/attachment.htm>

From fangbot at gmail.com  Thu Aug 11 00:55:31 2011
From: fangbot at gmail.com (fangbot)
Date: Wed, 10 Aug 2011 16:55:31 -0700 (PDT)
Subject: [rabbitmq-discuss] Consumer Callback
In-Reply-To: <1C266D3D-0BD7-4422-ABA5-5DC944491D8A@rabbitmq.com>
References: <32103305.post@talk.nabble.com>
	<9E349AF4-25D2-4871-8E6E-ECF2528A25A9@rabbitmq.com>
	<32143565.post@talk.nabble.com>
	<1C266D3D-0BD7-4422-ABA5-5DC944491D8A@rabbitmq.com>
Message-ID: <32238474.post@talk.nabble.com>


Hi Steve,
Thanks for the tips. I'm moving on to testing the performance of persistent
vs transient messages. To do this, I am sending batches (50,000) of 100 kb
messages over a P2P exchange from one producer to one consumer. However, in
both tests, the consumer is bound to a durable queue with auto-ack turned
on. I am then sending one batch using MessageProperties.PERSISTENT_BASIC and
one batch with a null argument for the properties. However, I am seeing
similar send/receive rates for both of these batches.

I have a feeling this is because I am using a durable queue with auto-ack =
true for both persistent and transient messages. The reason for this is
because, in the future, I would like to send both persistent AND transient
messages to the same consumer. Do you have any ideas on what I might be
doing wrong?

Thanks,
-Fang
-- 
View this message in context: http://old.nabble.com/Consumer-Callback-tp32103305p32238474.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From stammailbox at gmail.com  Thu Aug 11 07:00:37 2011
From: stammailbox at gmail.com (mysurf mail)
Date: Thu, 11 Aug 2011 07:00:37 +0100
Subject: [rabbitmq-discuss] What is rabbitmq heartbeat?
Message-ID: <CAJ2-VrnGuqh1=2NxKM+EY_JKT+gFP0tq2ZtsTQ975ZXMahCi1A@mail.gmail.com>

Hi,
As I have mentioned before - the rabbit client that is acts as a json rpc
server receives all the client request
but after a while it stops respondnig until the process restarts (java
client restart) .
I heard about heartbeat and wanted to know if setting it would help.
(Cant find a documentation in the site about it).
Can someone explain the heartbeat?
Thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110811/f6905eaf/attachment.htm>

From abhijit.sinha at kiprosh.com  Thu Aug 11 07:34:17 2011
From: abhijit.sinha at kiprosh.com (Abhijit)
Date: Thu, 11 Aug 2011 12:04:17 +0530
Subject: [rabbitmq-discuss] facing issues with the SSL implementations
 with RabbitMQ + Windows + .Net
In-Reply-To: <20110810144546.GI2869@dakota.eng.vmware.com>
References: <20110810102710.GD2869@dakota.eng.vmware.com>
	<4E425DC2.1050602@kiprosh.com>
	<20110810104000.GE2869@dakota.eng.vmware.com>
	<4E42617A.3090601@kiprosh.com>
	<20110810115056.GF2869@dakota.eng.vmware.com>
	<4E4272EA.9040308@kiprosh.com>
	<20110810121824.GG2869@dakota.eng.vmware.com>
	<4E428DAE.4000703@kiprosh.com>
	<20110810140832.GH2869@dakota.eng.vmware.com>
	<4E42952B.5040207@kiprosh.com>
	<20110810144546.GI2869@dakota.eng.vmware.com>
Message-ID: <4E4377E9.3060207@kiprosh.com>

OK Sir,

Am attaching the certificate files let me know if any errors.

Thanks and Regards,
Abhijit

On 8/10/2011 8:15 PM, Alexandru Scvor?ov wrote:
>> can you tell me did you create your certificates on windows?
>> or on linux machine?
>>      
> I generated the certificates on Windows Server 2008.
>
>    
>> openssl req -x509 -config openssl.cnf -newkey rsa:2048 -days 365 \
>>       -out cacert.pem -outform PEM -subj /CN=MyTestCA/ -nodes
>>
>> i executed above as
>> openssl req -x509 -config openssl.cnf -newkey rsa:2048 -days 365 -out cacert.pem -outform PEM -subj /CN=MyTestCA/ -nodes
>>      
> I did the same thing.
>
> Could you send the certificates you're using? (same files I sent
> earlier)  I'll see if I can find anything wrong with them.
>
> Alex
>
> On Wed, Aug 10, 2011 at 07:56:51PM +0530, Abhijit wrote:
>    
>> OK Sir
>>
>> can you tell me did you create your certificates on windows?
>> or on linux machine?
>>
>> openssl req -x509 -config openssl.cnf -newkey rsa:2048 -days 365 \
>>       -out cacert.pem -outform PEM -subj /CN=MyTestCA/ -nodes
>>
>> i executed above as
>> openssl req -x509 -config openssl.cnf -newkey rsa:2048 -days 365 -out cacert.pem -outform PEM -subj /CN=MyTestCA/ -nodes
>>
>> because as you told me that i need to do it similarly as in the website i skipped the '\' since it wasn't a valid element in openssl.
>>
>> does that caused the error?
>>
>> Thanks and Regards,
>> Abhijit
>>
>>
>>
>> On 8/10/2011 7:38 PM, Alexandru Scvor?ov wrote:
>>      
>>>> but with no luck, do i need something more.
>>>>
>>>>          
>>> Not that I can think of, no.
>>>
>>> If you're using OpenSSL 1.0.0, could you try with OpenSSL 0.9.8?
>>>
>>> Cheers,
>>> Alex
>>>
>>> On Wed, Aug 10, 2011 at 07:24:54PM +0530, Abhijit wrote:
>>>
>>>        
>>>> Hi sir,
>>>>
>>>> i went through all the steps again to make certificates in this link:
>>>>
>>>>          
>>>>> http://www.rabbitmq.com/ssl.html#keys-and-certs
>>>>>
>>>>>            
>>>> but with no luck, do i need something more.
>>>>
>>>> Thanking you,
>>>>
>>>> Regards,
>>>> Abhijit
>>>>
>>>>
>>>> On 8/10/2011 5:48 PM, Alexandru Scvor?ov wrote:
>>>>
>>>>          
>>>>>> The code worked now. the certificate you provided did work
>>>>>>
>>>>>>
>>>>>>              
>>>>> Great to hear that.
>>>>>
>>>>>
>>>>>
>>>>>            
>>>>>>     wondering why
>>>>>> my certificates are not working??
>>>>>>
>>>>>>
>>>>>>              
>>>>> I suspect you got some step in the certificate generation wrong (I
>>>>> generated the certificates following the instructions on the website).
>>>>> It's ridiculously easy to get something wrong.
>>>>>
>>>>> I'd delete all the certificates, and CA you generated and try again.
>>>>> The website instructions are right.  You might want to try without
>>>>> changing anything (the CA's name, for instance) just to see that it
>>>>> works.
>>>>>
>>>>> You could also try a different version of OpenSSL, but I'd be quite
>>>>> surprised if that were the problem.
>>>>>
>>>>> Let us how it goes.
>>>>>
>>>>> Cheers,
>>>>> Alex
>>>>>
>>>>>
>>>>> On Wed, Aug 10, 2011 at 05:30:42PM +0530, Abhijit wrote:
>>>>>
>>>>>
>>>>>            
>>>>>> Hi sir,
>>>>>>
>>>>>> The code worked now. the certificate you provided did work wondering why
>>>>>> my certificates are not working??
>>>>>>
>>>>>> Thanks and Regards,
>>>>>> Abhijit
>>>>>>
>>>>>>
>>>>>>
>>>>>> On 8/10/2011 5:20 PM, Alexandru Scvor?ov wrote:
>>>>>>
>>>>>>
>>>>>>              
>>>>>>> :(  That seems perfectly fine.
>>>>>>>
>>>>>>> Other ways to get an "unknown ca" error:
>>>>>>>       - forget to add the CA certificate to the Trust store;
>>>>>>>       - have the client use a certificate signed by a different authority
>>>>>>>         than the one given to the server.
>>>>>>>
>>>>>>> I'm out of ideas.  I'm attaching:
>>>>>>>       - cacert.pem and cacert.cer;
>>>>>>>       - keycert.p12 (password is "test");
>>>>>>>       - server's cert.pem, key.pem.
>>>>>>>
>>>>>>> You'll also need to set RemoteCertificateNameMismatch before starting the connection:
>>>>>>>       cf.Ssl.AcceptablePolicyErrors =
>>>>>>>         SslPolicyErrors.RemoteCertificateNameMismatch;
>>>>>>>
>>>>>>> Could you please try with these and see if it works (or if you get a
>>>>>>> different error)?
>>>>>>>
>>>>>>> Cheers,
>>>>>>> Alex
>>>>>>>
>>>>>>> On Wed, Aug 10, 2011 at 04:16:18PM +0530, Abhijit wrote:
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>                
>>>>>>>> Ok sir thanks,
>>>>>>>>
>>>>>>>> this is the post for the former command s_client:
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>                  
>>>>>>>>> C:\>openssl s_client -connect localhost:5671 -CAfile testca/cacert.pem
>>>>>>>>> -cert cli
>>>>>>>>> ent/cert.pem -key client/key.pem -showcerts
>>>>>>>>> Loading 'screen' into random state - done
>>>>>>>>> CONNECTED(00000160)
>>>>>>>>> depth=1 CN = Kiprosh7
>>>>>>>>> verify return:1
>>>>>>>>> depth=0 CN = Kiprosh7, O = server
>>>>>>>>> verify return:1
>>>>>>>>> ---
>>>>>>>>> Certificate chain
>>>>>>>>>      0 s:/CN=Kiprosh7/O=server
>>>>>>>>>        i:/CN=Kiprosh7
>>>>>>>>> -----BEGIN CERTIFICATE-----
>>>>>>>>> MIIC4TCCAcmgAwIBAgIBATANBgkqhkiG9w0BAQUFADATMREwDwYDVQQDEwhLaXBy
>>>>>>>>> b3NoNzAeFw0xMTA4MTAwODA1NTBaFw0xMjA4MDkwODA1NTBaMCQxETAPBgNVBAMM
>>>>>>>>> CEtpcHJvc2g3MQ8wDQYDVQQKDAZzZXJ2ZXIwggEiMA0GCSqGSIb3DQEBAQUAA4IB
>>>>>>>>> DwAwggEKAoIBAQDTDgQ3/vSBPvy0PAZYwk4H2qlFckaA75YfCYZ+HhIb+JUSrZ4r
>>>>>>>>> NcBEhvrH+7p1yft9IC4pgrgEbjmfQVTi8LGwtMRZmwpbmjqEfOALpra5x7Plb+7y
>>>>>>>>> CTT/iDc8uUwHLn2brXxNRn58IrEeD1X+rBxLNyek0pQu/hH31+REI5Sn1JZfi7gc
>>>>>>>>> 3PJEuaRzVJY4sE0neNWT+K+aD0n382qnziLEGOusXWNpggpoHVFKZR3Yojxj6Bfk
>>>>>>>>> 9lUvfUtIqz2zQ2dF0q6A0QVVlIenKzUK+rjHxQAUSb8P9CmCuRXUih3f61ahquQP
>>>>>>>>> CgSrkNnUV44D/wHfnxNm9QjxlQEGyr0DsTcFAgMBAAGjLzAtMAkGA1UdEwQCMAAw
>>>>>>>>> CwYDVR0PBAQDAgUgMBMGA1UdJQQMMAoGCCsGAQUFBwMBMA0GCSqGSIb3DQEBBQUA
>>>>>>>>> A4IBAQDE+cXjx6uNL/Kf/HmE7FeQ238iN7Gfb+I1QHmbRaR0qbTqcFzp7NCJ62uq
>>>>>>>>> nJ6Anj0+h1IFNMlQrCISSS0fnSj+mXMKDodZzV+cXFjdtoEXyqdDO0zphDMTRd8H
>>>>>>>>> oI79XSm5IK6vcPR+g2UTkhgrX1xfgeqZ8hmw0L0mMMGHXclwwaAF9HRNomFt32gr
>>>>>>>>> 1sVhFkhH/5epmgcl+8yI1E7UaQc91bYkUEuQFNu7irgc+/tvcXa4O4+dIfhnzrog
>>>>>>>>> 8piYUk4dxGME8LknQ213Gow9cgEKzcYadJ4DIr6gChkvAnYpHHHafWj/Ksvxyii6
>>>>>>>>> 8FxuTfgsrOYwkqEcSXeCGUS25nU9
>>>>>>>>> -----END CERTIFICATE-----
>>>>>>>>>      1 s:/CN=Kiprosh7
>>>>>>>>>        i:/CN=Kiprosh7
>>>>>>>>> -----BEGIN CERTIFICATE-----
>>>>>>>>> MIICxjCCAa6gAwIBAgIJANsNRAs/ueOoMA0GCSqGSIb3DQEBBQUAMBMxETAPBgNV
>>>>>>>>> BAMTCEtpcHJvc2g3MB4XDTExMDgxMDA4MDEzMloXDTEyMDgwOTA4MDEzMlowEzER
>>>>>>>>> MA8GA1UEAxMIS2lwcm9zaDcwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIB
>>>>>>>>> AQDorxS4o/H/w7f+VYWkQk3gS7g7gWFd3S4eCVV35a3GEcyP2OS4pUhhZXyB0lN7
>>>>>>>>> xmUHqeixx7aNRnrc130SQ4kke1fuxtdLjKxu+oeASMLCSkF356m8X5FhuTnPkf2W
>>>>>>>>> x64i6nk9SOO+jdQo/kMChy0H7psKS5I2M0nb5WLxN/JOACNnxJOhFy8cGw7l32q6
>>>>>>>>> rEfqLkdnZJR09fiuf0hEbb/UodOt2tXXGN0Pp3X2x4cXnD6E2Va9QSBYIvPAnWEn
>>>>>>>>> FN2Te+Qwg+AxwHIkCjH9bfQ7fOeuGHAoanSnlqS5rW/T5sKKlkBl95WeJoTFjrCt
>>>>>>>>> CVDLilsnLrfmZkg3ICQtPbgNAgMBAAGjHTAbMAwGA1UdEwQFMAMBAf8wCwYDVR0P
>>>>>>>>> BAQDAgEGMA0GCSqGSIb3DQEBBQUAA4IBAQBGtbJQyQ1pWVo+7snqxCOn/KVN++Jo
>>>>>>>>> 8YEB4/MGKgHyoTWRAa3IXOSPtpunW/6yDziwcLZeO09MATeKCCAJf64LXZr7aM6J
>>>>>>>>> ZX6hFFNUyqa5w9AaZ4sAe70QwDYPS6dPqcyTab/DVVRGhJAKhUc2lX+UfcBhHYaz
>>>>>>>>> egKDKyIybHMmcQQm//SO0jo3Ak0565ZAMCdaaO/9RNJpJSxJf+HSVUg4sPLe/sAK
>>>>>>>>> QlXcdt8XlKsEKBzUHzfRvpbU/8gn1HO5G+CTvEW2kO6nssuKX41g5hMfRqu248TT
>>>>>>>>> jbGWMkYFMPDY1m2QWPqzLvaETGOWHwqpVWXuMhu7/T5sduDf2n084ok7
>>>>>>>>> -----END CERTIFICATE-----
>>>>>>>>> ---
>>>>>>>>> Server certificate
>>>>>>>>> subject=/CN=Kiprosh7/O=server
>>>>>>>>> issuer=/CN=Kiprosh7
>>>>>>>>> ---
>>>>>>>>> Acceptable client certificate CA names
>>>>>>>>> /CN=Kiprosh7
>>>>>>>>> ---
>>>>>>>>> SSL handshake has read 1663 bytes and written 2276 bytes
>>>>>>>>> ---
>>>>>>>>> New, TLSv1/SSLv3, Cipher is AES256-SHA
>>>>>>>>> Server public key is 2048 bit
>>>>>>>>> Secure Renegotiation IS supported
>>>>>>>>> Compression: NONE
>>>>>>>>> Expansion: NONE
>>>>>>>>> SSL-Session:
>>>>>>>>>         Protocol  : TLSv1
>>>>>>>>>         Cipher    : AES256-SHA
>>>>>>>>>         Session-ID:
>>>>>>>>> 8703D018C270CC932648333F61FE3C986CB336B7C8074ACF3560E415934E26F2
>>>>>>>>>
>>>>>>>>>         Session-ID-ctx:
>>>>>>>>>         Master-Key:
>>>>>>>>> F5B8C5666355EE6C78910EBB649A65740104537ACEBB28E4A23DF51EA5DE9E6A
>>>>>>>>> FE3AC2C95B1929985DAFC09CDC6BDEAE
>>>>>>>>>         Key-Arg   : None
>>>>>>>>>         PSK identity: None
>>>>>>>>>         PSK identity hint: None
>>>>>>>>>         Start Time: 1312972974
>>>>>>>>>         Timeout   : 300 (sec)
>>>>>>>>>         Verify return code: 0 (ok)
>>>>>>>>> ---
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>                    
>>>>>>>> Thanks and Regards,
>>>>>>>> Abhijit
>>>>>>>>
>>>>>>>>
>>>>>>>> On 8/10/2011 4:10 PM, Alexandru Scvor?ov wrote:
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>                  
>>>>>>>>>>> AMQP server protocol negotiation failure: server version
>>>>>>>>>>> unknown-unknown, client version 0-9
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>                        
>>>>>>>>> That means the client connected successfully but closed the connection
>>>>>>>>> later because it wasn't talking to an AMQP server.
>>>>>>>>>
>>>>>>>>> That means that the client and certificates are fine, so the problem is
>>>>>>>>> configuring the server.
>>>>>>>>>
>>>>>>>>> When you try the other command (the openssl s_client) on the server,
>>>>>>>>> what output do you get?  Could you please post it?
>>>>>>>>>
>>>>>>>>> Alex
>>>>>>>>>
>>>>>>>>> On Wed, Aug 10, 2011 at 04:00:26PM +0530, Abhijit wrote:
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>                    
>>>>>>>>>> yes sir
>>>>>>>>>> no problem i thought so after looking at client cmd lines i did put
>>>>>>>>>> slash instead of dot, and now am getting this errors:
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>                      
>>>>>>>>>>> AMQP server protocol negotiation failure: server version
>>>>>>>>>>> unknown-unknown, client version 0-9
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>                        
>>>>>>>>>> Can you tell me what are next steps?
>>>>>>>>>>
>>>>>>>>>> Thanks and Regards,
>>>>>>>>>> Abhijit
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>> On 8/10/2011 3:57 PM, Alexandru Scvor?ov wrote:
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>                      
>>>>>>>>>>>> Am still getting the same error am using the same config file.
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>                          
>>>>>>>>>>> Ok, but are you sure it's actually the file used by the server? (we had
>>>>>>>>>>> some problems earlier about which file the server was using when started
>>>>>>>>>>> from the command prompt or as a service)
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>                        
>>>>>>>>>>>>> openssl s_server -accept 5671 -CAfile testca/cacert.pem -cert
>>>>>>>>>>>>> server/cert.pem -key server.key.pem -state
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>                            
>>>>>>>>>>> My mistake.  That should be:
>>>>>>>>>>>         openssl s_server -accept 5671 -CAfile testca/cacert.pem -cert
>>>>>>>>>>>         server/cert.pem -key server/key.pem -state
>>>>>>>>>>>
>>>>>>>>>>> (dot instead of slash in server.key.pem)
>>>>>>>>>>>
>>>>>>>>>>> BTW, if they're disposable, could you send the certificates and keys?
>>>>>>>>>>> We've had problems before with the certificates generated by OpenSSL,
>>>>>>>>>>> which were usually solved by using a different version.  Maybe this is
>>>>>>>>>>> happening here.
>>>>>>>>>>>
>>>>>>>>>>> Cheers,
>>>>>>>>>>> Alex
>>>>>>>>>>>
>>>>>>>>>>> On Wed, Aug 10, 2011 at 03:46:39PM +0530, Abhijit wrote:
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>                        
>>>>>>>>>>>> hi sir,
>>>>>>>>>>>>
>>>>>>>>>>>> Am still getting the same error am using the same config file.
>>>>>>>>>>>>
>>>>>>>>>>>> But i was not able to run this command you sent me:
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>                          
>>>>>>>>>>>>> openssl s_server -accept 5671 -CAfile testca/cacert.pem -cert
>>>>>>>>>>>>> server/cert.pem -key server.key.pem -state
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>                            
>>>>>>>>>>>> was getting an error: unable to load server certificate private key file.
>>>>>>>>>>>>
>>>>>>>>>>>> Thanks and Regards,
>>>>>>>>>>>> Abhijit
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>                          
>>>>>>>>>>
>>>>>>>>>>                      
>>>>>>>>
>>>>>>>>                  
>>>>>>
>>>>>>              
>>>>
>>>>          
>>      

-------------- next part --------------
A non-text attachment was scrubbed...
Name: cacert.cer
Type: application/octet-stream
Size: 714 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110811/e95c85a3/attachment.obj>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: cacert.pem
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110811/e95c85a3/attachment.txt>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: cert.pem
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110811/e95c85a3/attachment.asc>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: keycert.p12
Type: application/octet-stream
Size: 2349 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110811/e95c85a3/attachment-0001.obj>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: key.pem
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110811/e95c85a3/attachment-0001.asc>

From abhijit.sinha at kiprosh.com  Thu Aug 11 08:24:00 2011
From: abhijit.sinha at kiprosh.com (Abhijit)
Date: Thu, 11 Aug 2011 12:54:00 +0530
Subject: [rabbitmq-discuss] facing issues with the SSL implementations
 with RabbitMQ + Windows + .Net
In-Reply-To: <20110810144546.GI2869@dakota.eng.vmware.com>
References: <20110810102710.GD2869@dakota.eng.vmware.com>
	<4E425DC2.1050602@kiprosh.com>
	<20110810104000.GE2869@dakota.eng.vmware.com>
	<4E42617A.3090601@kiprosh.com>
	<20110810115056.GF2869@dakota.eng.vmware.com>
	<4E4272EA.9040308@kiprosh.com>
	<20110810121824.GG2869@dakota.eng.vmware.com>
	<4E428DAE.4000703@kiprosh.com>
	<20110810140832.GH2869@dakota.eng.vmware.com>
	<4E42952B.5040207@kiprosh.com>
	<20110810144546.GI2869@dakota.eng.vmware.com>
Message-ID: <4E438390.6000006@kiprosh.com>

Hi Sir,

Am sending you the new set of certificates i made today morning which 
were still giving same errors. Can you please inspect them and let me 
know what are the errors.

Thanks and Regards,
Abhijit

On 8/10/2011 8:15 PM, Alexandru Scvor?ov wrote:
>> can you tell me did you create your certificates on windows?
>> or on linux machine?
>>      
> I generated the certificates on Windows Server 2008.
>
>    
>> openssl req -x509 -config openssl.cnf -newkey rsa:2048 -days 365 \
>>       -out cacert.pem -outform PEM -subj /CN=MyTestCA/ -nodes
>>
>> i executed above as
>> openssl req -x509 -config openssl.cnf -newkey rsa:2048 -days 365 -out cacert.pem -outform PEM -subj /CN=MyTestCA/ -nodes
>>      
> I did the same thing.
>
> Could you send the certificates you're using? (same files I sent
> earlier)  I'll see if I can find anything wrong with them.
>
> Alex
>
> On Wed, Aug 10, 2011 at 07:56:51PM +0530, Abhijit wrote:
>    
>> OK Sir
>>
>> can you tell me did you create your certificates on windows?
>> or on linux machine?
>>
>> openssl req -x509 -config openssl.cnf -newkey rsa:2048 -days 365 \
>>       -out cacert.pem -outform PEM -subj /CN=MyTestCA/ -nodes
>>
>> i executed above as
>> openssl req -x509 -config openssl.cnf -newkey rsa:2048 -days 365 -out cacert.pem -outform PEM -subj /CN=MyTestCA/ -nodes
>>
>> because as you told me that i need to do it similarly as in the website i skipped the '\' since it wasn't a valid element in openssl.
>>
>> does that caused the error?
>>
>> Thanks and Regards,
>> Abhijit
>>
>>
>>
>> On 8/10/2011 7:38 PM, Alexandru Scvor?ov wrote:
>>      
>>>> but with no luck, do i need something more.
>>>>
>>>>          
>>> Not that I can think of, no.
>>>
>>> If you're using OpenSSL 1.0.0, could you try with OpenSSL 0.9.8?
>>>
>>> Cheers,
>>> Alex
>>>
>>> On Wed, Aug 10, 2011 at 07:24:54PM +0530, Abhijit wrote:
>>>
>>>        
>>>> Hi sir,
>>>>
>>>> i went through all the steps again to make certificates in this link:
>>>>
>>>>          
>>>>> http://www.rabbitmq.com/ssl.html#keys-and-certs
>>>>>
>>>>>            
>>>> but with no luck, do i need something more.
>>>>
>>>> Thanking you,
>>>>
>>>> Regards,
>>>> Abhijit
>>>>
>>>>
>>>> On 8/10/2011 5:48 PM, Alexandru Scvor?ov wrote:
>>>>
>>>>          
>>>>>> The code worked now. the certificate you provided did work
>>>>>>
>>>>>>
>>>>>>              
>>>>> Great to hear that.
>>>>>
>>>>>
>>>>>
>>>>>            
>>>>>>     wondering why
>>>>>> my certificates are not working??
>>>>>>
>>>>>>
>>>>>>              
>>>>> I suspect you got some step in the certificate generation wrong (I
>>>>> generated the certificates following the instructions on the website).
>>>>> It's ridiculously easy to get something wrong.
>>>>>
>>>>> I'd delete all the certificates, and CA you generated and try again.
>>>>> The website instructions are right.  You might want to try without
>>>>> changing anything (the CA's name, for instance) just to see that it
>>>>> works.
>>>>>
>>>>> You could also try a different version of OpenSSL, but I'd be quite
>>>>> surprised if that were the problem.
>>>>>
>>>>> Let us how it goes.
>>>>>
>>>>> Cheers,
>>>>> Alex
>>>>>
>>>>>
>>>>> On Wed, Aug 10, 2011 at 05:30:42PM +0530, Abhijit wrote:
>>>>>
>>>>>
>>>>>            
>>>>>> Hi sir,
>>>>>>
>>>>>> The code worked now. the certificate you provided did work wondering why
>>>>>> my certificates are not working??
>>>>>>
>>>>>> Thanks and Regards,
>>>>>> Abhijit
>>>>>>
>>>>>>
>>>>>>
>>>>>> On 8/10/2011 5:20 PM, Alexandru Scvor?ov wrote:
>>>>>>
>>>>>>
>>>>>>              
>>>>>>> :(  That seems perfectly fine.
>>>>>>>
>>>>>>> Other ways to get an "unknown ca" error:
>>>>>>>       - forget to add the CA certificate to the Trust store;
>>>>>>>       - have the client use a certificate signed by a different authority
>>>>>>>         than the one given to the server.
>>>>>>>
>>>>>>> I'm out of ideas.  I'm attaching:
>>>>>>>       - cacert.pem and cacert.cer;
>>>>>>>       - keycert.p12 (password is "test");
>>>>>>>       - server's cert.pem, key.pem.
>>>>>>>
>>>>>>> You'll also need to set RemoteCertificateNameMismatch before starting the connection:
>>>>>>>       cf.Ssl.AcceptablePolicyErrors =
>>>>>>>         SslPolicyErrors.RemoteCertificateNameMismatch;
>>>>>>>
>>>>>>> Could you please try with these and see if it works (or if you get a
>>>>>>> different error)?
>>>>>>>
>>>>>>> Cheers,
>>>>>>> Alex
>>>>>>>
>>>>>>> On Wed, Aug 10, 2011 at 04:16:18PM +0530, Abhijit wrote:
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>                
>>>>>>>> Ok sir thanks,
>>>>>>>>
>>>>>>>> this is the post for the former command s_client:
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>                  
>>>>>>>>> C:\>openssl s_client -connect localhost:5671 -CAfile testca/cacert.pem
>>>>>>>>> -cert cli
>>>>>>>>> ent/cert.pem -key client/key.pem -showcerts
>>>>>>>>> Loading 'screen' into random state - done
>>>>>>>>> CONNECTED(00000160)
>>>>>>>>> depth=1 CN = Kiprosh7
>>>>>>>>> verify return:1
>>>>>>>>> depth=0 CN = Kiprosh7, O = server
>>>>>>>>> verify return:1
>>>>>>>>> ---
>>>>>>>>> Certificate chain
>>>>>>>>>      0 s:/CN=Kiprosh7/O=server
>>>>>>>>>        i:/CN=Kiprosh7
>>>>>>>>> -----BEGIN CERTIFICATE-----
>>>>>>>>> MIIC4TCCAcmgAwIBAgIBATANBgkqhkiG9w0BAQUFADATMREwDwYDVQQDEwhLaXBy
>>>>>>>>> b3NoNzAeFw0xMTA4MTAwODA1NTBaFw0xMjA4MDkwODA1NTBaMCQxETAPBgNVBAMM
>>>>>>>>> CEtpcHJvc2g3MQ8wDQYDVQQKDAZzZXJ2ZXIwggEiMA0GCSqGSIb3DQEBAQUAA4IB
>>>>>>>>> DwAwggEKAoIBAQDTDgQ3/vSBPvy0PAZYwk4H2qlFckaA75YfCYZ+HhIb+JUSrZ4r
>>>>>>>>> NcBEhvrH+7p1yft9IC4pgrgEbjmfQVTi8LGwtMRZmwpbmjqEfOALpra5x7Plb+7y
>>>>>>>>> CTT/iDc8uUwHLn2brXxNRn58IrEeD1X+rBxLNyek0pQu/hH31+REI5Sn1JZfi7gc
>>>>>>>>> 3PJEuaRzVJY4sE0neNWT+K+aD0n382qnziLEGOusXWNpggpoHVFKZR3Yojxj6Bfk
>>>>>>>>> 9lUvfUtIqz2zQ2dF0q6A0QVVlIenKzUK+rjHxQAUSb8P9CmCuRXUih3f61ahquQP
>>>>>>>>> CgSrkNnUV44D/wHfnxNm9QjxlQEGyr0DsTcFAgMBAAGjLzAtMAkGA1UdEwQCMAAw
>>>>>>>>> CwYDVR0PBAQDAgUgMBMGA1UdJQQMMAoGCCsGAQUFBwMBMA0GCSqGSIb3DQEBBQUA
>>>>>>>>> A4IBAQDE+cXjx6uNL/Kf/HmE7FeQ238iN7Gfb+I1QHmbRaR0qbTqcFzp7NCJ62uq
>>>>>>>>> nJ6Anj0+h1IFNMlQrCISSS0fnSj+mXMKDodZzV+cXFjdtoEXyqdDO0zphDMTRd8H
>>>>>>>>> oI79XSm5IK6vcPR+g2UTkhgrX1xfgeqZ8hmw0L0mMMGHXclwwaAF9HRNomFt32gr
>>>>>>>>> 1sVhFkhH/5epmgcl+8yI1E7UaQc91bYkUEuQFNu7irgc+/tvcXa4O4+dIfhnzrog
>>>>>>>>> 8piYUk4dxGME8LknQ213Gow9cgEKzcYadJ4DIr6gChkvAnYpHHHafWj/Ksvxyii6
>>>>>>>>> 8FxuTfgsrOYwkqEcSXeCGUS25nU9
>>>>>>>>> -----END CERTIFICATE-----
>>>>>>>>>      1 s:/CN=Kiprosh7
>>>>>>>>>        i:/CN=Kiprosh7
>>>>>>>>> -----BEGIN CERTIFICATE-----
>>>>>>>>> MIICxjCCAa6gAwIBAgIJANsNRAs/ueOoMA0GCSqGSIb3DQEBBQUAMBMxETAPBgNV
>>>>>>>>> BAMTCEtpcHJvc2g3MB4XDTExMDgxMDA4MDEzMloXDTEyMDgwOTA4MDEzMlowEzER
>>>>>>>>> MA8GA1UEAxMIS2lwcm9zaDcwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIB
>>>>>>>>> AQDorxS4o/H/w7f+VYWkQk3gS7g7gWFd3S4eCVV35a3GEcyP2OS4pUhhZXyB0lN7
>>>>>>>>> xmUHqeixx7aNRnrc130SQ4kke1fuxtdLjKxu+oeASMLCSkF356m8X5FhuTnPkf2W
>>>>>>>>> x64i6nk9SOO+jdQo/kMChy0H7psKS5I2M0nb5WLxN/JOACNnxJOhFy8cGw7l32q6
>>>>>>>>> rEfqLkdnZJR09fiuf0hEbb/UodOt2tXXGN0Pp3X2x4cXnD6E2Va9QSBYIvPAnWEn
>>>>>>>>> FN2Te+Qwg+AxwHIkCjH9bfQ7fOeuGHAoanSnlqS5rW/T5sKKlkBl95WeJoTFjrCt
>>>>>>>>> CVDLilsnLrfmZkg3ICQtPbgNAgMBAAGjHTAbMAwGA1UdEwQFMAMBAf8wCwYDVR0P
>>>>>>>>> BAQDAgEGMA0GCSqGSIb3DQEBBQUAA4IBAQBGtbJQyQ1pWVo+7snqxCOn/KVN++Jo
>>>>>>>>> 8YEB4/MGKgHyoTWRAa3IXOSPtpunW/6yDziwcLZeO09MATeKCCAJf64LXZr7aM6J
>>>>>>>>> ZX6hFFNUyqa5w9AaZ4sAe70QwDYPS6dPqcyTab/DVVRGhJAKhUc2lX+UfcBhHYaz
>>>>>>>>> egKDKyIybHMmcQQm//SO0jo3Ak0565ZAMCdaaO/9RNJpJSxJf+HSVUg4sPLe/sAK
>>>>>>>>> QlXcdt8XlKsEKBzUHzfRvpbU/8gn1HO5G+CTvEW2kO6nssuKX41g5hMfRqu248TT
>>>>>>>>> jbGWMkYFMPDY1m2QWPqzLvaETGOWHwqpVWXuMhu7/T5sduDf2n084ok7
>>>>>>>>> -----END CERTIFICATE-----
>>>>>>>>> ---
>>>>>>>>> Server certificate
>>>>>>>>> subject=/CN=Kiprosh7/O=server
>>>>>>>>> issuer=/CN=Kiprosh7
>>>>>>>>> ---
>>>>>>>>> Acceptable client certificate CA names
>>>>>>>>> /CN=Kiprosh7
>>>>>>>>> ---
>>>>>>>>> SSL handshake has read 1663 bytes and written 2276 bytes
>>>>>>>>> ---
>>>>>>>>> New, TLSv1/SSLv3, Cipher is AES256-SHA
>>>>>>>>> Server public key is 2048 bit
>>>>>>>>> Secure Renegotiation IS supported
>>>>>>>>> Compression: NONE
>>>>>>>>> Expansion: NONE
>>>>>>>>> SSL-Session:
>>>>>>>>>         Protocol  : TLSv1
>>>>>>>>>         Cipher    : AES256-SHA
>>>>>>>>>         Session-ID:
>>>>>>>>> 8703D018C270CC932648333F61FE3C986CB336B7C8074ACF3560E415934E26F2
>>>>>>>>>
>>>>>>>>>         Session-ID-ctx:
>>>>>>>>>         Master-Key:
>>>>>>>>> F5B8C5666355EE6C78910EBB649A65740104537ACEBB28E4A23DF51EA5DE9E6A
>>>>>>>>> FE3AC2C95B1929985DAFC09CDC6BDEAE
>>>>>>>>>         Key-Arg   : None
>>>>>>>>>         PSK identity: None
>>>>>>>>>         PSK identity hint: None
>>>>>>>>>         Start Time: 1312972974
>>>>>>>>>         Timeout   : 300 (sec)
>>>>>>>>>         Verify return code: 0 (ok)
>>>>>>>>> ---
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>                    
>>>>>>>> Thanks and Regards,
>>>>>>>> Abhijit
>>>>>>>>
>>>>>>>>
>>>>>>>> On 8/10/2011 4:10 PM, Alexandru Scvor?ov wrote:
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>                  
>>>>>>>>>>> AMQP server protocol negotiation failure: server version
>>>>>>>>>>> unknown-unknown, client version 0-9
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>                        
>>>>>>>>> That means the client connected successfully but closed the connection
>>>>>>>>> later because it wasn't talking to an AMQP server.
>>>>>>>>>
>>>>>>>>> That means that the client and certificates are fine, so the problem is
>>>>>>>>> configuring the server.
>>>>>>>>>
>>>>>>>>> When you try the other command (the openssl s_client) on the server,
>>>>>>>>> what output do you get?  Could you please post it?
>>>>>>>>>
>>>>>>>>> Alex
>>>>>>>>>
>>>>>>>>> On Wed, Aug 10, 2011 at 04:00:26PM +0530, Abhijit wrote:
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>                    
>>>>>>>>>> yes sir
>>>>>>>>>> no problem i thought so after looking at client cmd lines i did put
>>>>>>>>>> slash instead of dot, and now am getting this errors:
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>                      
>>>>>>>>>>> AMQP server protocol negotiation failure: server version
>>>>>>>>>>> unknown-unknown, client version 0-9
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>                        
>>>>>>>>>> Can you tell me what are next steps?
>>>>>>>>>>
>>>>>>>>>> Thanks and Regards,
>>>>>>>>>> Abhijit
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>> On 8/10/2011 3:57 PM, Alexandru Scvor?ov wrote:
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>                      
>>>>>>>>>>>> Am still getting the same error am using the same config file.
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>                          
>>>>>>>>>>> Ok, but are you sure it's actually the file used by the server? (we had
>>>>>>>>>>> some problems earlier about which file the server was using when started
>>>>>>>>>>> from the command prompt or as a service)
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>                        
>>>>>>>>>>>>> openssl s_server -accept 5671 -CAfile testca/cacert.pem -cert
>>>>>>>>>>>>> server/cert.pem -key server.key.pem -state
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>                            
>>>>>>>>>>> My mistake.  That should be:
>>>>>>>>>>>         openssl s_server -accept 5671 -CAfile testca/cacert.pem -cert
>>>>>>>>>>>         server/cert.pem -key server/key.pem -state
>>>>>>>>>>>
>>>>>>>>>>> (dot instead of slash in server.key.pem)
>>>>>>>>>>>
>>>>>>>>>>> BTW, if they're disposable, could you send the certificates and keys?
>>>>>>>>>>> We've had problems before with the certificates generated by OpenSSL,
>>>>>>>>>>> which were usually solved by using a different version.  Maybe this is
>>>>>>>>>>> happening here.
>>>>>>>>>>>
>>>>>>>>>>> Cheers,
>>>>>>>>>>> Alex
>>>>>>>>>>>
>>>>>>>>>>> On Wed, Aug 10, 2011 at 03:46:39PM +0530, Abhijit wrote:
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>                        
>>>>>>>>>>>> hi sir,
>>>>>>>>>>>>
>>>>>>>>>>>> Am still getting the same error am using the same config file.
>>>>>>>>>>>>
>>>>>>>>>>>> But i was not able to run this command you sent me:
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>                          
>>>>>>>>>>>>> openssl s_server -accept 5671 -CAfile testca/cacert.pem -cert
>>>>>>>>>>>>> server/cert.pem -key server.key.pem -state
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>                            
>>>>>>>>>>>> was getting an error: unable to load server certificate private key file.
>>>>>>>>>>>>
>>>>>>>>>>>> Thanks and Regards,
>>>>>>>>>>>> Abhijit
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>                          
>>>>>>>>>>
>>>>>>>>>>                      
>>>>>>>>
>>>>>>>>                  
>>>>>>
>>>>>>              
>>>>
>>>>          
>>      

-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: key.pem
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110811/39130f2e/attachment.txt>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: keycert.p12
Type: application/octet-stream
Size: 2341 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110811/39130f2e/attachment.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: cacert.cer
Type: application/octet-stream
Size: 714 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110811/39130f2e/attachment-0001.obj>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: cacert.pem
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110811/39130f2e/attachment.asc>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: cert.pem
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110811/39130f2e/attachment-0001.txt>

From abhijit.sinha at kiprosh.com  Thu Aug 11 08:29:21 2011
From: abhijit.sinha at kiprosh.com (Abhijit)
Date: Thu, 11 Aug 2011 12:59:21 +0530
Subject: [rabbitmq-discuss] facing issues with the SSL implementations
 with RabbitMQ + Windows + .Net
In-Reply-To: <20110810144546.GI2869@dakota.eng.vmware.com>
References: <20110810102710.GD2869@dakota.eng.vmware.com>
	<4E425DC2.1050602@kiprosh.com>
	<20110810104000.GE2869@dakota.eng.vmware.com>
	<4E42617A.3090601@kiprosh.com>
	<20110810115056.GF2869@dakota.eng.vmware.com>
	<4E4272EA.9040308@kiprosh.com>
	<20110810121824.GG2869@dakota.eng.vmware.com>
	<4E428DAE.4000703@kiprosh.com>
	<20110810140832.GH2869@dakota.eng.vmware.com>
	<4E42952B.5040207@kiprosh.com>
	<20110810144546.GI2869@dakota.eng.vmware.com>
Message-ID: <4E4384D1.8050806@kiprosh.com>

hi sir,

do i need to change anything in the openssl.cnf file?

Thanks and Regards,
Abhijit

On 8/10/2011 8:15 PM, Alexandru Scvor?ov wrote:
>> can you tell me did you create your certificates on windows?
>> or on linux machine?
>>      
> I generated the certificates on Windows Server 2008.
>
>    
>> openssl req -x509 -config openssl.cnf -newkey rsa:2048 -days 365 \
>>       -out cacert.pem -outform PEM -subj /CN=MyTestCA/ -nodes
>>
>> i executed above as
>> openssl req -x509 -config openssl.cnf -newkey rsa:2048 -days 365 -out cacert.pem -outform PEM -subj /CN=MyTestCA/ -nodes
>>      
> I did the same thing.
>
> Could you send the certificates you're using? (same files I sent
> earlier)  I'll see if I can find anything wrong with them.
>
> Alex
>
> On Wed, Aug 10, 2011 at 07:56:51PM +0530, Abhijit wrote:
>    
>> OK Sir
>>
>> can you tell me did you create your certificates on windows?
>> or on linux machine?
>>
>> openssl req -x509 -config openssl.cnf -newkey rsa:2048 -days 365 \
>>       -out cacert.pem -outform PEM -subj /CN=MyTestCA/ -nodes
>>
>> i executed above as
>> openssl req -x509 -config openssl.cnf -newkey rsa:2048 -days 365 -out cacert.pem -outform PEM -subj /CN=MyTestCA/ -nodes
>>
>> because as you told me that i need to do it similarly as in the website i skipped the '\' since it wasn't a valid element in openssl.
>>
>> does that caused the error?
>>
>> Thanks and Regards,
>> Abhijit
>>
>>
>>
>> On 8/10/2011 7:38 PM, Alexandru Scvor?ov wrote:
>>      
>>>> but with no luck, do i need something more.
>>>>
>>>>          
>>> Not that I can think of, no.
>>>
>>> If you're using OpenSSL 1.0.0, could you try with OpenSSL 0.9.8?
>>>
>>> Cheers,
>>> Alex
>>>
>>> On Wed, Aug 10, 2011 at 07:24:54PM +0530, Abhijit wrote:
>>>
>>>        
>>>> Hi sir,
>>>>
>>>> i went through all the steps again to make certificates in this link:
>>>>
>>>>          
>>>>> http://www.rabbitmq.com/ssl.html#keys-and-certs
>>>>>
>>>>>            
>>>> but with no luck, do i need something more.
>>>>
>>>> Thanking you,
>>>>
>>>> Regards,
>>>> Abhijit
>>>>
>>>>
>>>> On 8/10/2011 5:48 PM, Alexandru Scvor?ov wrote:
>>>>
>>>>          
>>>>>> The code worked now. the certificate you provided did work
>>>>>>
>>>>>>
>>>>>>              
>>>>> Great to hear that.
>>>>>
>>>>>
>>>>>
>>>>>            
>>>>>>     wondering why
>>>>>> my certificates are not working??
>>>>>>
>>>>>>
>>>>>>              
>>>>> I suspect you got some step in the certificate generation wrong (I
>>>>> generated the certificates following the instructions on the website).
>>>>> It's ridiculously easy to get something wrong.
>>>>>
>>>>> I'd delete all the certificates, and CA you generated and try again.
>>>>> The website instructions are right.  You might want to try without
>>>>> changing anything (the CA's name, for instance) just to see that it
>>>>> works.
>>>>>
>>>>> You could also try a different version of OpenSSL, but I'd be quite
>>>>> surprised if that were the problem.
>>>>>
>>>>> Let us how it goes.
>>>>>
>>>>> Cheers,
>>>>> Alex
>>>>>
>>>>>
>>>>> On Wed, Aug 10, 2011 at 05:30:42PM +0530, Abhijit wrote:
>>>>>
>>>>>
>>>>>            
>>>>>> Hi sir,
>>>>>>
>>>>>> The code worked now. the certificate you provided did work wondering why
>>>>>> my certificates are not working??
>>>>>>
>>>>>> Thanks and Regards,
>>>>>> Abhijit
>>>>>>
>>>>>>
>>>>>>
>>>>>> On 8/10/2011 5:20 PM, Alexandru Scvor?ov wrote:
>>>>>>
>>>>>>
>>>>>>              
>>>>>>> :(  That seems perfectly fine.
>>>>>>>
>>>>>>> Other ways to get an "unknown ca" error:
>>>>>>>       - forget to add the CA certificate to the Trust store;
>>>>>>>       - have the client use a certificate signed by a different authority
>>>>>>>         than the one given to the server.
>>>>>>>
>>>>>>> I'm out of ideas.  I'm attaching:
>>>>>>>       - cacert.pem and cacert.cer;
>>>>>>>       - keycert.p12 (password is "test");
>>>>>>>       - server's cert.pem, key.pem.
>>>>>>>
>>>>>>> You'll also need to set RemoteCertificateNameMismatch before starting the connection:
>>>>>>>       cf.Ssl.AcceptablePolicyErrors =
>>>>>>>         SslPolicyErrors.RemoteCertificateNameMismatch;
>>>>>>>
>>>>>>> Could you please try with these and see if it works (or if you get a
>>>>>>> different error)?
>>>>>>>
>>>>>>> Cheers,
>>>>>>> Alex
>>>>>>>
>>>>>>> On Wed, Aug 10, 2011 at 04:16:18PM +0530, Abhijit wrote:
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>                
>>>>>>>> Ok sir thanks,
>>>>>>>>
>>>>>>>> this is the post for the former command s_client:
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>                  
>>>>>>>>> C:\>openssl s_client -connect localhost:5671 -CAfile testca/cacert.pem
>>>>>>>>> -cert cli
>>>>>>>>> ent/cert.pem -key client/key.pem -showcerts
>>>>>>>>> Loading 'screen' into random state - done
>>>>>>>>> CONNECTED(00000160)
>>>>>>>>> depth=1 CN = Kiprosh7
>>>>>>>>> verify return:1
>>>>>>>>> depth=0 CN = Kiprosh7, O = server
>>>>>>>>> verify return:1
>>>>>>>>> ---
>>>>>>>>> Certificate chain
>>>>>>>>>      0 s:/CN=Kiprosh7/O=server
>>>>>>>>>        i:/CN=Kiprosh7
>>>>>>>>> -----BEGIN CERTIFICATE-----
>>>>>>>>> MIIC4TCCAcmgAwIBAgIBATANBgkqhkiG9w0BAQUFADATMREwDwYDVQQDEwhLaXBy
>>>>>>>>> b3NoNzAeFw0xMTA4MTAwODA1NTBaFw0xMjA4MDkwODA1NTBaMCQxETAPBgNVBAMM
>>>>>>>>> CEtpcHJvc2g3MQ8wDQYDVQQKDAZzZXJ2ZXIwggEiMA0GCSqGSIb3DQEBAQUAA4IB
>>>>>>>>> DwAwggEKAoIBAQDTDgQ3/vSBPvy0PAZYwk4H2qlFckaA75YfCYZ+HhIb+JUSrZ4r
>>>>>>>>> NcBEhvrH+7p1yft9IC4pgrgEbjmfQVTi8LGwtMRZmwpbmjqEfOALpra5x7Plb+7y
>>>>>>>>> CTT/iDc8uUwHLn2brXxNRn58IrEeD1X+rBxLNyek0pQu/hH31+REI5Sn1JZfi7gc
>>>>>>>>> 3PJEuaRzVJY4sE0neNWT+K+aD0n382qnziLEGOusXWNpggpoHVFKZR3Yojxj6Bfk
>>>>>>>>> 9lUvfUtIqz2zQ2dF0q6A0QVVlIenKzUK+rjHxQAUSb8P9CmCuRXUih3f61ahquQP
>>>>>>>>> CgSrkNnUV44D/wHfnxNm9QjxlQEGyr0DsTcFAgMBAAGjLzAtMAkGA1UdEwQCMAAw
>>>>>>>>> CwYDVR0PBAQDAgUgMBMGA1UdJQQMMAoGCCsGAQUFBwMBMA0GCSqGSIb3DQEBBQUA
>>>>>>>>> A4IBAQDE+cXjx6uNL/Kf/HmE7FeQ238iN7Gfb+I1QHmbRaR0qbTqcFzp7NCJ62uq
>>>>>>>>> nJ6Anj0+h1IFNMlQrCISSS0fnSj+mXMKDodZzV+cXFjdtoEXyqdDO0zphDMTRd8H
>>>>>>>>> oI79XSm5IK6vcPR+g2UTkhgrX1xfgeqZ8hmw0L0mMMGHXclwwaAF9HRNomFt32gr
>>>>>>>>> 1sVhFkhH/5epmgcl+8yI1E7UaQc91bYkUEuQFNu7irgc+/tvcXa4O4+dIfhnzrog
>>>>>>>>> 8piYUk4dxGME8LknQ213Gow9cgEKzcYadJ4DIr6gChkvAnYpHHHafWj/Ksvxyii6
>>>>>>>>> 8FxuTfgsrOYwkqEcSXeCGUS25nU9
>>>>>>>>> -----END CERTIFICATE-----
>>>>>>>>>      1 s:/CN=Kiprosh7
>>>>>>>>>        i:/CN=Kiprosh7
>>>>>>>>> -----BEGIN CERTIFICATE-----
>>>>>>>>> MIICxjCCAa6gAwIBAgIJANsNRAs/ueOoMA0GCSqGSIb3DQEBBQUAMBMxETAPBgNV
>>>>>>>>> BAMTCEtpcHJvc2g3MB4XDTExMDgxMDA4MDEzMloXDTEyMDgwOTA4MDEzMlowEzER
>>>>>>>>> MA8GA1UEAxMIS2lwcm9zaDcwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIB
>>>>>>>>> AQDorxS4o/H/w7f+VYWkQk3gS7g7gWFd3S4eCVV35a3GEcyP2OS4pUhhZXyB0lN7
>>>>>>>>> xmUHqeixx7aNRnrc130SQ4kke1fuxtdLjKxu+oeASMLCSkF356m8X5FhuTnPkf2W
>>>>>>>>> x64i6nk9SOO+jdQo/kMChy0H7psKS5I2M0nb5WLxN/JOACNnxJOhFy8cGw7l32q6
>>>>>>>>> rEfqLkdnZJR09fiuf0hEbb/UodOt2tXXGN0Pp3X2x4cXnD6E2Va9QSBYIvPAnWEn
>>>>>>>>> FN2Te+Qwg+AxwHIkCjH9bfQ7fOeuGHAoanSnlqS5rW/T5sKKlkBl95WeJoTFjrCt
>>>>>>>>> CVDLilsnLrfmZkg3ICQtPbgNAgMBAAGjHTAbMAwGA1UdEwQFMAMBAf8wCwYDVR0P
>>>>>>>>> BAQDAgEGMA0GCSqGSIb3DQEBBQUAA4IBAQBGtbJQyQ1pWVo+7snqxCOn/KVN++Jo
>>>>>>>>> 8YEB4/MGKgHyoTWRAa3IXOSPtpunW/6yDziwcLZeO09MATeKCCAJf64LXZr7aM6J
>>>>>>>>> ZX6hFFNUyqa5w9AaZ4sAe70QwDYPS6dPqcyTab/DVVRGhJAKhUc2lX+UfcBhHYaz
>>>>>>>>> egKDKyIybHMmcQQm//SO0jo3Ak0565ZAMCdaaO/9RNJpJSxJf+HSVUg4sPLe/sAK
>>>>>>>>> QlXcdt8XlKsEKBzUHzfRvpbU/8gn1HO5G+CTvEW2kO6nssuKX41g5hMfRqu248TT
>>>>>>>>> jbGWMkYFMPDY1m2QWPqzLvaETGOWHwqpVWXuMhu7/T5sduDf2n084ok7
>>>>>>>>> -----END CERTIFICATE-----
>>>>>>>>> ---
>>>>>>>>> Server certificate
>>>>>>>>> subject=/CN=Kiprosh7/O=server
>>>>>>>>> issuer=/CN=Kiprosh7
>>>>>>>>> ---
>>>>>>>>> Acceptable client certificate CA names
>>>>>>>>> /CN=Kiprosh7
>>>>>>>>> ---
>>>>>>>>> SSL handshake has read 1663 bytes and written 2276 bytes
>>>>>>>>> ---
>>>>>>>>> New, TLSv1/SSLv3, Cipher is AES256-SHA
>>>>>>>>> Server public key is 2048 bit
>>>>>>>>> Secure Renegotiation IS supported
>>>>>>>>> Compression: NONE
>>>>>>>>> Expansion: NONE
>>>>>>>>> SSL-Session:
>>>>>>>>>         Protocol  : TLSv1
>>>>>>>>>         Cipher    : AES256-SHA
>>>>>>>>>         Session-ID:
>>>>>>>>> 8703D018C270CC932648333F61FE3C986CB336B7C8074ACF3560E415934E26F2
>>>>>>>>>
>>>>>>>>>         Session-ID-ctx:
>>>>>>>>>         Master-Key:
>>>>>>>>> F5B8C5666355EE6C78910EBB649A65740104537ACEBB28E4A23DF51EA5DE9E6A
>>>>>>>>> FE3AC2C95B1929985DAFC09CDC6BDEAE
>>>>>>>>>         Key-Arg   : None
>>>>>>>>>         PSK identity: None
>>>>>>>>>         PSK identity hint: None
>>>>>>>>>         Start Time: 1312972974
>>>>>>>>>         Timeout   : 300 (sec)
>>>>>>>>>         Verify return code: 0 (ok)
>>>>>>>>> ---
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>                    
>>>>>>>> Thanks and Regards,
>>>>>>>> Abhijit
>>>>>>>>
>>>>>>>>
>>>>>>>> On 8/10/2011 4:10 PM, Alexandru Scvor?ov wrote:
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>                  
>>>>>>>>>>> AMQP server protocol negotiation failure: server version
>>>>>>>>>>> unknown-unknown, client version 0-9
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>                        
>>>>>>>>> That means the client connected successfully but closed the connection
>>>>>>>>> later because it wasn't talking to an AMQP server.
>>>>>>>>>
>>>>>>>>> That means that the client and certificates are fine, so the problem is
>>>>>>>>> configuring the server.
>>>>>>>>>
>>>>>>>>> When you try the other command (the openssl s_client) on the server,
>>>>>>>>> what output do you get?  Could you please post it?
>>>>>>>>>
>>>>>>>>> Alex
>>>>>>>>>
>>>>>>>>> On Wed, Aug 10, 2011 at 04:00:26PM +0530, Abhijit wrote:
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>                    
>>>>>>>>>> yes sir
>>>>>>>>>> no problem i thought so after looking at client cmd lines i did put
>>>>>>>>>> slash instead of dot, and now am getting this errors:
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>                      
>>>>>>>>>>> AMQP server protocol negotiation failure: server version
>>>>>>>>>>> unknown-unknown, client version 0-9
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>                        
>>>>>>>>>> Can you tell me what are next steps?
>>>>>>>>>>
>>>>>>>>>> Thanks and Regards,
>>>>>>>>>> Abhijit
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>> On 8/10/2011 3:57 PM, Alexandru Scvor?ov wrote:
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>                      
>>>>>>>>>>>> Am still getting the same error am using the same config file.
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>                          
>>>>>>>>>>> Ok, but are you sure it's actually the file used by the server? (we had
>>>>>>>>>>> some problems earlier about which file the server was using when started
>>>>>>>>>>> from the command prompt or as a service)
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>                        
>>>>>>>>>>>>> openssl s_server -accept 5671 -CAfile testca/cacert.pem -cert
>>>>>>>>>>>>> server/cert.pem -key server.key.pem -state
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>                            
>>>>>>>>>>> My mistake.  That should be:
>>>>>>>>>>>         openssl s_server -accept 5671 -CAfile testca/cacert.pem -cert
>>>>>>>>>>>         server/cert.pem -key server/key.pem -state
>>>>>>>>>>>
>>>>>>>>>>> (dot instead of slash in server.key.pem)
>>>>>>>>>>>
>>>>>>>>>>> BTW, if they're disposable, could you send the certificates and keys?
>>>>>>>>>>> We've had problems before with the certificates generated by OpenSSL,
>>>>>>>>>>> which were usually solved by using a different version.  Maybe this is
>>>>>>>>>>> happening here.
>>>>>>>>>>>
>>>>>>>>>>> Cheers,
>>>>>>>>>>> Alex
>>>>>>>>>>>
>>>>>>>>>>> On Wed, Aug 10, 2011 at 03:46:39PM +0530, Abhijit wrote:
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>                        
>>>>>>>>>>>> hi sir,
>>>>>>>>>>>>
>>>>>>>>>>>> Am still getting the same error am using the same config file.
>>>>>>>>>>>>
>>>>>>>>>>>> But i was not able to run this command you sent me:
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>                          
>>>>>>>>>>>>> openssl s_server -accept 5671 -CAfile testca/cacert.pem -cert
>>>>>>>>>>>>> server/cert.pem -key server.key.pem -state
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>                            
>>>>>>>>>>>> was getting an error: unable to load server certificate private key file.
>>>>>>>>>>>>
>>>>>>>>>>>> Thanks and Regards,
>>>>>>>>>>>> Abhijit
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>                          
>>>>>>>>>>
>>>>>>>>>>                      
>>>>>>>>
>>>>>>>>                  
>>>>>>
>>>>>>              
>>>>
>>>>          
>>      


From alexandru at rabbitmq.com  Thu Aug 11 08:48:05 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Thu, 11 Aug 2011 08:48:05 +0100
Subject: [rabbitmq-discuss] What is rabbitmq heartbeat?
In-Reply-To: <CAJ2-VrnGuqh1=2NxKM+EY_JKT+gFP0tq2ZtsTQ975ZXMahCi1A@mail.gmail.com>
References: <CAJ2-VrnGuqh1=2NxKM+EY_JKT+gFP0tq2ZtsTQ975ZXMahCi1A@mail.gmail.com>
Message-ID: <20110811074805.GA3139@dakota.eng.vmware.com>

> Can someone explain the heartbeat?

If heartbeats are enabled on a connection, the server periodically sends
heartbeat frames to the client and waits for its response.  The heartbeat
frames are effectively empty messages.  If either side misses a certain
number of heartbeats, the connection is closed.  This is usually used to
a) check that the other side is still online and hasn't crashed without
closing the connection or the socket and b) to bypass certain routing
devices that timeout a connection due to inactivity.

> As I have mentioned before - the rabbit client that is acts as a json rpc
> server receives all the client request
> but after a while it stops respondnig until the process restarts (java
> client restart) .

That doesn't sound like a problem usually solved by heartbeats, but
enabling them may tell you fairly quickly when the client stops
responding.

Hope this helps.

Cheers,
Alex

On Thu, Aug 11, 2011 at 07:00:37AM +0100, mysurf mail wrote:
> Hi,
> As I have mentioned before - the rabbit client that is acts as a json rpc
> server receives all the client request
> but after a while it stops respondnig until the process restarts (java
> client restart) .
> I heard about heartbeat and wanted to know if setting it would help.
> (Cant find a documentation in the site about it).
> Can someone explain the heartbeat?
> Thanks.

> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From simon at rabbitmq.com  Thu Aug 11 10:23:50 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 11 Aug 2011 10:23:50 +0100
Subject: [rabbitmq-discuss] After force-closing STOMP connection in
 management interface client still can send messages
In-Reply-To: <j1ropp$p17$1@dough.gmane.org>
References: <j1ropp$p17$1@dough.gmane.org>
Message-ID: <4E439FA6.50600@rabbitmq.com>

On 09/08/11 17:55, Michael Justin wrote:
> Problem:
> After force-closing STOMP connection in management interface clients
> still can send messages

Thanks for the report. I'll look into it.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From abhijit.sinha at kiprosh.com  Thu Aug 11 12:13:02 2011
From: abhijit.sinha at kiprosh.com (Abhijit)
Date: Thu, 11 Aug 2011 16:43:02 +0530
Subject: [rabbitmq-discuss] facing issues with the SSL implementations
 with RabbitMQ + Windows + .Net
In-Reply-To: <20110810144546.GI2869@dakota.eng.vmware.com>
References: <20110810102710.GD2869@dakota.eng.vmware.com>
	<4E425DC2.1050602@kiprosh.com>
	<20110810104000.GE2869@dakota.eng.vmware.com>
	<4E42617A.3090601@kiprosh.com>
	<20110810115056.GF2869@dakota.eng.vmware.com>
	<4E4272EA.9040308@kiprosh.com>
	<20110810121824.GG2869@dakota.eng.vmware.com>
	<4E428DAE.4000703@kiprosh.com>
	<20110810140832.GH2869@dakota.eng.vmware.com>
	<4E42952B.5040207@kiprosh.com>
	<20110810144546.GI2869@dakota.eng.vmware.com>
Message-ID: <4E43B93E.2040408@kiprosh.com>

hi sir,

Am attaching a doc file containing the steps am taking to make those 
certificates for ssl support in rabbitMQ. Can you please review that 
whether am doing right??

Thanks and Regards,
Abhijit

On 8/10/2011 8:15 PM, Alexandru Scvor?ov wrote:
>> can you tell me did you create your certificates on windows?
>> or on linux machine?
>>      
> I generated the certificates on Windows Server 2008.
>
>    
>> openssl req -x509 -config openssl.cnf -newkey rsa:2048 -days 365 \
>>       -out cacert.pem -outform PEM -subj /CN=MyTestCA/ -nodes
>>
>> i executed above as
>> openssl req -x509 -config openssl.cnf -newkey rsa:2048 -days 365 -out cacert.pem -outform PEM -subj /CN=MyTestCA/ -nodes
>>      
> I did the same thing.
>
> Could you send the certificates you're using? (same files I sent
> earlier)  I'll see if I can find anything wrong with them.
>
> Alex
>
> On Wed, Aug 10, 2011 at 07:56:51PM +0530, Abhijit wrote:
>    
>> OK Sir
>>
>> can you tell me did you create your certificates on windows?
>> or on linux machine?
>>
>> openssl req -x509 -config openssl.cnf -newkey rsa:2048 -days 365 \
>>       -out cacert.pem -outform PEM -subj /CN=MyTestCA/ -nodes
>>
>> i executed above as
>> openssl req -x509 -config openssl.cnf -newkey rsa:2048 -days 365 -out cacert.pem -outform PEM -subj /CN=MyTestCA/ -nodes
>>
>> because as you told me that i need to do it similarly as in the website i skipped the '\' since it wasn't a valid element in openssl.
>>
>> does that caused the error?
>>
>> Thanks and Regards,
>> Abhijit
>>
>>
>>
>> On 8/10/2011 7:38 PM, Alexandru Scvor?ov wrote:
>>      
>>>> but with no luck, do i need something more.
>>>>
>>>>          
>>> Not that I can think of, no.
>>>
>>> If you're using OpenSSL 1.0.0, could you try with OpenSSL 0.9.8?
>>>
>>> Cheers,
>>> Alex
>>>
>>> On Wed, Aug 10, 2011 at 07:24:54PM +0530, Abhijit wrote:
>>>
>>>        
>>>> Hi sir,
>>>>
>>>> i went through all the steps again to make certificates in this link:
>>>>
>>>>          
>>>>> http://www.rabbitmq.com/ssl.html#keys-and-certs
>>>>>
>>>>>            
>>>> but with no luck, do i need something more.
>>>>
>>>> Thanking you,
>>>>
>>>> Regards,
>>>> Abhijit
>>>>
>>>>
>>>> On 8/10/2011 5:48 PM, Alexandru Scvor?ov wrote:
>>>>
>>>>          
>>>>>> The code worked now. the certificate you provided did work
>>>>>>
>>>>>>
>>>>>>              
>>>>> Great to hear that.
>>>>>
>>>>>
>>>>>
>>>>>            
>>>>>>     wondering why
>>>>>> my certificates are not working??
>>>>>>
>>>>>>
>>>>>>              
>>>>> I suspect you got some step in the certificate generation wrong (I
>>>>> generated the certificates following the instructions on the website).
>>>>> It's ridiculously easy to get something wrong.
>>>>>
>>>>> I'd delete all the certificates, and CA you generated and try again.
>>>>> The website instructions are right.  You might want to try without
>>>>> changing anything (the CA's name, for instance) just to see that it
>>>>> works.
>>>>>
>>>>> You could also try a different version of OpenSSL, but I'd be quite
>>>>> surprised if that were the problem.
>>>>>
>>>>> Let us how it goes.
>>>>>
>>>>> Cheers,
>>>>> Alex
>>>>>
>>>>>
>>>>> On Wed, Aug 10, 2011 at 05:30:42PM +0530, Abhijit wrote:
>>>>>
>>>>>
>>>>>            
>>>>>> Hi sir,
>>>>>>
>>>>>> The code worked now. the certificate you provided did work wondering why
>>>>>> my certificates are not working??
>>>>>>
>>>>>> Thanks and Regards,
>>>>>> Abhijit
>>>>>>
>>>>>>
>>>>>>
>>>>>> On 8/10/2011 5:20 PM, Alexandru Scvor?ov wrote:
>>>>>>
>>>>>>
>>>>>>              
>>>>>>> :(  That seems perfectly fine.
>>>>>>>
>>>>>>> Other ways to get an "unknown ca" error:
>>>>>>>       - forget to add the CA certificate to the Trust store;
>>>>>>>       - have the client use a certificate signed by a different authority
>>>>>>>         than the one given to the server.
>>>>>>>
>>>>>>> I'm out of ideas.  I'm attaching:
>>>>>>>       - cacert.pem and cacert.cer;
>>>>>>>       - keycert.p12 (password is "test");
>>>>>>>       - server's cert.pem, key.pem.
>>>>>>>
>>>>>>> You'll also need to set RemoteCertificateNameMismatch before starting the connection:
>>>>>>>       cf.Ssl.AcceptablePolicyErrors =
>>>>>>>         SslPolicyErrors.RemoteCertificateNameMismatch;
>>>>>>>
>>>>>>> Could you please try with these and see if it works (or if you get a
>>>>>>> different error)?
>>>>>>>
>>>>>>> Cheers,
>>>>>>> Alex
>>>>>>>
>>>>>>> On Wed, Aug 10, 2011 at 04:16:18PM +0530, Abhijit wrote:
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>                
>>>>>>>> Ok sir thanks,
>>>>>>>>
>>>>>>>> this is the post for the former command s_client:
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>                  
>>>>>>>>> C:\>openssl s_client -connect localhost:5671 -CAfile testca/cacert.pem
>>>>>>>>> -cert cli
>>>>>>>>> ent/cert.pem -key client/key.pem -showcerts
>>>>>>>>> Loading 'screen' into random state - done
>>>>>>>>> CONNECTED(00000160)
>>>>>>>>> depth=1 CN = Kiprosh7
>>>>>>>>> verify return:1
>>>>>>>>> depth=0 CN = Kiprosh7, O = server
>>>>>>>>> verify return:1
>>>>>>>>> ---
>>>>>>>>> Certificate chain
>>>>>>>>>      0 s:/CN=Kiprosh7/O=server
>>>>>>>>>        i:/CN=Kiprosh7
>>>>>>>>> -----BEGIN CERTIFICATE-----
>>>>>>>>> MIIC4TCCAcmgAwIBAgIBATANBgkqhkiG9w0BAQUFADATMREwDwYDVQQDEwhLaXBy
>>>>>>>>> b3NoNzAeFw0xMTA4MTAwODA1NTBaFw0xMjA4MDkwODA1NTBaMCQxETAPBgNVBAMM
>>>>>>>>> CEtpcHJvc2g3MQ8wDQYDVQQKDAZzZXJ2ZXIwggEiMA0GCSqGSIb3DQEBAQUAA4IB
>>>>>>>>> DwAwggEKAoIBAQDTDgQ3/vSBPvy0PAZYwk4H2qlFckaA75YfCYZ+HhIb+JUSrZ4r
>>>>>>>>> NcBEhvrH+7p1yft9IC4pgrgEbjmfQVTi8LGwtMRZmwpbmjqEfOALpra5x7Plb+7y
>>>>>>>>> CTT/iDc8uUwHLn2brXxNRn58IrEeD1X+rBxLNyek0pQu/hH31+REI5Sn1JZfi7gc
>>>>>>>>> 3PJEuaRzVJY4sE0neNWT+K+aD0n382qnziLEGOusXWNpggpoHVFKZR3Yojxj6Bfk
>>>>>>>>> 9lUvfUtIqz2zQ2dF0q6A0QVVlIenKzUK+rjHxQAUSb8P9CmCuRXUih3f61ahquQP
>>>>>>>>> CgSrkNnUV44D/wHfnxNm9QjxlQEGyr0DsTcFAgMBAAGjLzAtMAkGA1UdEwQCMAAw
>>>>>>>>> CwYDVR0PBAQDAgUgMBMGA1UdJQQMMAoGCCsGAQUFBwMBMA0GCSqGSIb3DQEBBQUA
>>>>>>>>> A4IBAQDE+cXjx6uNL/Kf/HmE7FeQ238iN7Gfb+I1QHmbRaR0qbTqcFzp7NCJ62uq
>>>>>>>>> nJ6Anj0+h1IFNMlQrCISSS0fnSj+mXMKDodZzV+cXFjdtoEXyqdDO0zphDMTRd8H
>>>>>>>>> oI79XSm5IK6vcPR+g2UTkhgrX1xfgeqZ8hmw0L0mMMGHXclwwaAF9HRNomFt32gr
>>>>>>>>> 1sVhFkhH/5epmgcl+8yI1E7UaQc91bYkUEuQFNu7irgc+/tvcXa4O4+dIfhnzrog
>>>>>>>>> 8piYUk4dxGME8LknQ213Gow9cgEKzcYadJ4DIr6gChkvAnYpHHHafWj/Ksvxyii6
>>>>>>>>> 8FxuTfgsrOYwkqEcSXeCGUS25nU9
>>>>>>>>> -----END CERTIFICATE-----
>>>>>>>>>      1 s:/CN=Kiprosh7
>>>>>>>>>        i:/CN=Kiprosh7
>>>>>>>>> -----BEGIN CERTIFICATE-----
>>>>>>>>> MIICxjCCAa6gAwIBAgIJANsNRAs/ueOoMA0GCSqGSIb3DQEBBQUAMBMxETAPBgNV
>>>>>>>>> BAMTCEtpcHJvc2g3MB4XDTExMDgxMDA4MDEzMloXDTEyMDgwOTA4MDEzMlowEzER
>>>>>>>>> MA8GA1UEAxMIS2lwcm9zaDcwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIB
>>>>>>>>> AQDorxS4o/H/w7f+VYWkQk3gS7g7gWFd3S4eCVV35a3GEcyP2OS4pUhhZXyB0lN7
>>>>>>>>> xmUHqeixx7aNRnrc130SQ4kke1fuxtdLjKxu+oeASMLCSkF356m8X5FhuTnPkf2W
>>>>>>>>> x64i6nk9SOO+jdQo/kMChy0H7psKS5I2M0nb5WLxN/JOACNnxJOhFy8cGw7l32q6
>>>>>>>>> rEfqLkdnZJR09fiuf0hEbb/UodOt2tXXGN0Pp3X2x4cXnD6E2Va9QSBYIvPAnWEn
>>>>>>>>> FN2Te+Qwg+AxwHIkCjH9bfQ7fOeuGHAoanSnlqS5rW/T5sKKlkBl95WeJoTFjrCt
>>>>>>>>> CVDLilsnLrfmZkg3ICQtPbgNAgMBAAGjHTAbMAwGA1UdEwQFMAMBAf8wCwYDVR0P
>>>>>>>>> BAQDAgEGMA0GCSqGSIb3DQEBBQUAA4IBAQBGtbJQyQ1pWVo+7snqxCOn/KVN++Jo
>>>>>>>>> 8YEB4/MGKgHyoTWRAa3IXOSPtpunW/6yDziwcLZeO09MATeKCCAJf64LXZr7aM6J
>>>>>>>>> ZX6hFFNUyqa5w9AaZ4sAe70QwDYPS6dPqcyTab/DVVRGhJAKhUc2lX+UfcBhHYaz
>>>>>>>>> egKDKyIybHMmcQQm//SO0jo3Ak0565ZAMCdaaO/9RNJpJSxJf+HSVUg4sPLe/sAK
>>>>>>>>> QlXcdt8XlKsEKBzUHzfRvpbU/8gn1HO5G+CTvEW2kO6nssuKX41g5hMfRqu248TT
>>>>>>>>> jbGWMkYFMPDY1m2QWPqzLvaETGOWHwqpVWXuMhu7/T5sduDf2n084ok7
>>>>>>>>> -----END CERTIFICATE-----
>>>>>>>>> ---
>>>>>>>>> Server certificate
>>>>>>>>> subject=/CN=Kiprosh7/O=server
>>>>>>>>> issuer=/CN=Kiprosh7
>>>>>>>>> ---
>>>>>>>>> Acceptable client certificate CA names
>>>>>>>>> /CN=Kiprosh7
>>>>>>>>> ---
>>>>>>>>> SSL handshake has read 1663 bytes and written 2276 bytes
>>>>>>>>> ---
>>>>>>>>> New, TLSv1/SSLv3, Cipher is AES256-SHA
>>>>>>>>> Server public key is 2048 bit
>>>>>>>>> Secure Renegotiation IS supported
>>>>>>>>> Compression: NONE
>>>>>>>>> Expansion: NONE
>>>>>>>>> SSL-Session:
>>>>>>>>>         Protocol  : TLSv1
>>>>>>>>>         Cipher    : AES256-SHA
>>>>>>>>>         Session-ID:
>>>>>>>>> 8703D018C270CC932648333F61FE3C986CB336B7C8074ACF3560E415934E26F2
>>>>>>>>>
>>>>>>>>>         Session-ID-ctx:
>>>>>>>>>         Master-Key:
>>>>>>>>> F5B8C5666355EE6C78910EBB649A65740104537ACEBB28E4A23DF51EA5DE9E6A
>>>>>>>>> FE3AC2C95B1929985DAFC09CDC6BDEAE
>>>>>>>>>         Key-Arg   : None
>>>>>>>>>         PSK identity: None
>>>>>>>>>         PSK identity hint: None
>>>>>>>>>         Start Time: 1312972974
>>>>>>>>>         Timeout   : 300 (sec)
>>>>>>>>>         Verify return code: 0 (ok)
>>>>>>>>> ---
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>                    
>>>>>>>> Thanks and Regards,
>>>>>>>> Abhijit
>>>>>>>>
>>>>>>>>
>>>>>>>> On 8/10/2011 4:10 PM, Alexandru Scvor?ov wrote:
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>                  
>>>>>>>>>>> AMQP server protocol negotiation failure: server version
>>>>>>>>>>> unknown-unknown, client version 0-9
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>                        
>>>>>>>>> That means the client connected successfully but closed the connection
>>>>>>>>> later because it wasn't talking to an AMQP server.
>>>>>>>>>
>>>>>>>>> That means that the client and certificates are fine, so the problem is
>>>>>>>>> configuring the server.
>>>>>>>>>
>>>>>>>>> When you try the other command (the openssl s_client) on the server,
>>>>>>>>> what output do you get?  Could you please post it?
>>>>>>>>>
>>>>>>>>> Alex
>>>>>>>>>
>>>>>>>>> On Wed, Aug 10, 2011 at 04:00:26PM +0530, Abhijit wrote:
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>                    
>>>>>>>>>> yes sir
>>>>>>>>>> no problem i thought so after looking at client cmd lines i did put
>>>>>>>>>> slash instead of dot, and now am getting this errors:
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>                      
>>>>>>>>>>> AMQP server protocol negotiation failure: server version
>>>>>>>>>>> unknown-unknown, client version 0-9
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>                        
>>>>>>>>>> Can you tell me what are next steps?
>>>>>>>>>>
>>>>>>>>>> Thanks and Regards,
>>>>>>>>>> Abhijit
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>> On 8/10/2011 3:57 PM, Alexandru Scvor?ov wrote:
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>                      
>>>>>>>>>>>> Am still getting the same error am using the same config file.
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>                          
>>>>>>>>>>> Ok, but are you sure it's actually the file used by the server? (we had
>>>>>>>>>>> some problems earlier about which file the server was using when started
>>>>>>>>>>> from the command prompt or as a service)
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>                        
>>>>>>>>>>>>> openssl s_server -accept 5671 -CAfile testca/cacert.pem -cert
>>>>>>>>>>>>> server/cert.pem -key server.key.pem -state
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>                            
>>>>>>>>>>> My mistake.  That should be:
>>>>>>>>>>>         openssl s_server -accept 5671 -CAfile testca/cacert.pem -cert
>>>>>>>>>>>         server/cert.pem -key server/key.pem -state
>>>>>>>>>>>
>>>>>>>>>>> (dot instead of slash in server.key.pem)
>>>>>>>>>>>
>>>>>>>>>>> BTW, if they're disposable, could you send the certificates and keys?
>>>>>>>>>>> We've had problems before with the certificates generated by OpenSSL,
>>>>>>>>>>> which were usually solved by using a different version.  Maybe this is
>>>>>>>>>>> happening here.
>>>>>>>>>>>
>>>>>>>>>>> Cheers,
>>>>>>>>>>> Alex
>>>>>>>>>>>
>>>>>>>>>>> On Wed, Aug 10, 2011 at 03:46:39PM +0530, Abhijit wrote:
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>                        
>>>>>>>>>>>> hi sir,
>>>>>>>>>>>>
>>>>>>>>>>>> Am still getting the same error am using the same config file.
>>>>>>>>>>>>
>>>>>>>>>>>> But i was not able to run this command you sent me:
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>                          
>>>>>>>>>>>>> openssl s_server -accept 5671 -CAfile testca/cacert.pem -cert
>>>>>>>>>>>>> server/cert.pem -key server.key.pem -state
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>                            
>>>>>>>>>>>> was getting an error: unable to load server certificate private key file.
>>>>>>>>>>>>
>>>>>>>>>>>> Thanks and Regards,
>>>>>>>>>>>> Abhijit
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>                          
>>>>>>>>>>
>>>>>>>>>>                      
>>>>>>>>
>>>>>>>>                  
>>>>>>
>>>>>>              
>>>>
>>>>          
>>      

-------------- next part --------------
A non-text attachment was scrubbed...
Name: SSL support in RabbitMQ.doc
Type: application/msword
Size: 38912 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110811/e937f108/attachment.doc>

From alexandru at rabbitmq.com  Thu Aug 11 13:06:44 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Thu, 11 Aug 2011 13:06:44 +0100
Subject: [rabbitmq-discuss] facing issues with the SSL implementations
 with RabbitMQ + Windows + .Net
In-Reply-To: <4E438390.6000006@kiprosh.com>
References: <20110810104000.GE2869@dakota.eng.vmware.com>
	<4E42617A.3090601@kiprosh.com>
	<20110810115056.GF2869@dakota.eng.vmware.com>
	<4E4272EA.9040308@kiprosh.com>
	<20110810121824.GG2869@dakota.eng.vmware.com>
	<4E428DAE.4000703@kiprosh.com>
	<20110810140832.GH2869@dakota.eng.vmware.com>
	<4E42952B.5040207@kiprosh.com>
	<20110810144546.GI2869@dakota.eng.vmware.com>
	<4E438390.6000006@kiprosh.com>
Message-ID: <20110811120644.GD3139@dakota.eng.vmware.com>

Hello,

I don't see anything wrong with how you're generating certificate, but I
do see a problem with your certificates:
  the keycert.p12 contains the SERVER certificates, rather than the
  client certificates.

Using your certificates, I get "The message received was unexpected or
badly formatted" on the .NET side and {ssl_upgrade_error,esslaccept} on
the server side.  This is what's expected when you use the server
certificates for the client.  Is that also what you get?

If so, could you please make sure, when generating CLIENT, certificates,
you do

# cd ../client
# openssl pkcs12 -export -out keycert.p12 -in cert.pem -inkey key.pem
# passout pass:password

and not

# cd ../server
# openssl pkcs12 -export -out keycert.p12 -in cert.pem -inkey key.pem
# passout pass:password

or something similar.

Cheers,
Alex


On Thu, Aug 11, 2011 at 12:54:00PM +0530, Abhijit wrote:
> Hi Sir,
> 
> Am sending you the new set of certificates i made today morning which 
> were still giving same errors. Can you please inspect them and let me 
> know what are the errors.
> 
> Thanks and Regards,
> Abhijit
> 
> On 8/10/2011 8:15 PM, Alexandru Scvor?ov wrote:
> >> can you tell me did you create your certificates on windows?
> >> or on linux machine?
> >>      
> > I generated the certificates on Windows Server 2008.
> >
> >    
> >> openssl req -x509 -config openssl.cnf -newkey rsa:2048 -days 365 \
> >>       -out cacert.pem -outform PEM -subj /CN=MyTestCA/ -nodes
> >>
> >> i executed above as
> >> openssl req -x509 -config openssl.cnf -newkey rsa:2048 -days 365 -out cacert.pem -outform PEM -subj /CN=MyTestCA/ -nodes
> >>      
> > I did the same thing.
> >
> > Could you send the certificates you're using? (same files I sent
> > earlier)  I'll see if I can find anything wrong with them.
> >
> > Alex
> >
> > On Wed, Aug 10, 2011 at 07:56:51PM +0530, Abhijit wrote:
> >    
> >> OK Sir
> >>
> >> can you tell me did you create your certificates on windows?
> >> or on linux machine?
> >>
> >> openssl req -x509 -config openssl.cnf -newkey rsa:2048 -days 365 \
> >>       -out cacert.pem -outform PEM -subj /CN=MyTestCA/ -nodes
> >>
> >> i executed above as
> >> openssl req -x509 -config openssl.cnf -newkey rsa:2048 -days 365 -out cacert.pem -outform PEM -subj /CN=MyTestCA/ -nodes
> >>
> >> because as you told me that i need to do it similarly as in the website i skipped the '\' since it wasn't a valid element in openssl.
> >>
> >> does that caused the error?
> >>
> >> Thanks and Regards,
> >> Abhijit
> >>
> >>
> >>
> >> On 8/10/2011 7:38 PM, Alexandru Scvor?ov wrote:
> >>      
> >>>> but with no luck, do i need something more.
> >>>>
> >>>>          
> >>> Not that I can think of, no.
> >>>
> >>> If you're using OpenSSL 1.0.0, could you try with OpenSSL 0.9.8?
> >>>
> >>> Cheers,
> >>> Alex
> >>>
> >>> On Wed, Aug 10, 2011 at 07:24:54PM +0530, Abhijit wrote:
> >>>
> >>>        
> >>>> Hi sir,
> >>>>
> >>>> i went through all the steps again to make certificates in this link:
> >>>>
> >>>>          
> >>>>> http://www.rabbitmq.com/ssl.html#keys-and-certs
> >>>>>
> >>>>>            
> >>>> but with no luck, do i need something more.
> >>>>
> >>>> Thanking you,
> >>>>
> >>>> Regards,
> >>>> Abhijit
> >>>>
> >>>>
> >>>> On 8/10/2011 5:48 PM, Alexandru Scvor?ov wrote:
> >>>>
> >>>>          
> >>>>>> The code worked now. the certificate you provided did work
> >>>>>>
> >>>>>>
> >>>>>>              
> >>>>> Great to hear that.
> >>>>>
> >>>>>
> >>>>>
> >>>>>            
> >>>>>>     wondering why
> >>>>>> my certificates are not working??
> >>>>>>
> >>>>>>
> >>>>>>              
> >>>>> I suspect you got some step in the certificate generation wrong (I
> >>>>> generated the certificates following the instructions on the website).
> >>>>> It's ridiculously easy to get something wrong.
> >>>>>
> >>>>> I'd delete all the certificates, and CA you generated and try again.
> >>>>> The website instructions are right.  You might want to try without
> >>>>> changing anything (the CA's name, for instance) just to see that it
> >>>>> works.
> >>>>>
> >>>>> You could also try a different version of OpenSSL, but I'd be quite
> >>>>> surprised if that were the problem.
> >>>>>
> >>>>> Let us how it goes.
> >>>>>
> >>>>> Cheers,
> >>>>> Alex
> >>>>>
> >>>>>
> >>>>> On Wed, Aug 10, 2011 at 05:30:42PM +0530, Abhijit wrote:
> >>>>>
> >>>>>
> >>>>>            
> >>>>>> Hi sir,
> >>>>>>
> >>>>>> The code worked now. the certificate you provided did work wondering why
> >>>>>> my certificates are not working??
> >>>>>>
> >>>>>> Thanks and Regards,
> >>>>>> Abhijit
> >>>>>>
> >>>>>>
> >>>>>>
> >>>>>> On 8/10/2011 5:20 PM, Alexandru Scvor?ov wrote:
> >>>>>>
> >>>>>>
> >>>>>>              
> >>>>>>> :(  That seems perfectly fine.
> >>>>>>>
> >>>>>>> Other ways to get an "unknown ca" error:
> >>>>>>>       - forget to add the CA certificate to the Trust store;
> >>>>>>>       - have the client use a certificate signed by a different authority
> >>>>>>>         than the one given to the server.
> >>>>>>>
> >>>>>>> I'm out of ideas.  I'm attaching:
> >>>>>>>       - cacert.pem and cacert.cer;
> >>>>>>>       - keycert.p12 (password is "test");
> >>>>>>>       - server's cert.pem, key.pem.
> >>>>>>>
> >>>>>>> You'll also need to set RemoteCertificateNameMismatch before starting the connection:
> >>>>>>>       cf.Ssl.AcceptablePolicyErrors =
> >>>>>>>         SslPolicyErrors.RemoteCertificateNameMismatch;
> >>>>>>>
> >>>>>>> Could you please try with these and see if it works (or if you get a
> >>>>>>> different error)?
> >>>>>>>
> >>>>>>> Cheers,
> >>>>>>> Alex
> >>>>>>>
> >>>>>>> On Wed, Aug 10, 2011 at 04:16:18PM +0530, Abhijit wrote:
> >>>>>>>
> >>>>>>>
> >>>>>>>
> >>>>>>>                
> >>>>>>>> Ok sir thanks,
> >>>>>>>>
> >>>>>>>> this is the post for the former command s_client:
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>                  
> >>>>>>>>> C:\>openssl s_client -connect localhost:5671 -CAfile testca/cacert.pem
> >>>>>>>>> -cert cli
> >>>>>>>>> ent/cert.pem -key client/key.pem -showcerts
> >>>>>>>>> Loading 'screen' into random state - done
> >>>>>>>>> CONNECTED(00000160)
> >>>>>>>>> depth=1 CN = Kiprosh7
> >>>>>>>>> verify return:1
> >>>>>>>>> depth=0 CN = Kiprosh7, O = server
> >>>>>>>>> verify return:1
> >>>>>>>>> ---
> >>>>>>>>> Certificate chain
> >>>>>>>>>      0 s:/CN=Kiprosh7/O=server
> >>>>>>>>>        i:/CN=Kiprosh7
> >>>>>>>>> -----BEGIN CERTIFICATE-----
> >>>>>>>>> MIIC4TCCAcmgAwIBAgIBATANBgkqhkiG9w0BAQUFADATMREwDwYDVQQDEwhLaXBy
> >>>>>>>>> b3NoNzAeFw0xMTA4MTAwODA1NTBaFw0xMjA4MDkwODA1NTBaMCQxETAPBgNVBAMM
> >>>>>>>>> CEtpcHJvc2g3MQ8wDQYDVQQKDAZzZXJ2ZXIwggEiMA0GCSqGSIb3DQEBAQUAA4IB
> >>>>>>>>> DwAwggEKAoIBAQDTDgQ3/vSBPvy0PAZYwk4H2qlFckaA75YfCYZ+HhIb+JUSrZ4r
> >>>>>>>>> NcBEhvrH+7p1yft9IC4pgrgEbjmfQVTi8LGwtMRZmwpbmjqEfOALpra5x7Plb+7y
> >>>>>>>>> CTT/iDc8uUwHLn2brXxNRn58IrEeD1X+rBxLNyek0pQu/hH31+REI5Sn1JZfi7gc
> >>>>>>>>> 3PJEuaRzVJY4sE0neNWT+K+aD0n382qnziLEGOusXWNpggpoHVFKZR3Yojxj6Bfk
> >>>>>>>>> 9lUvfUtIqz2zQ2dF0q6A0QVVlIenKzUK+rjHxQAUSb8P9CmCuRXUih3f61ahquQP
> >>>>>>>>> CgSrkNnUV44D/wHfnxNm9QjxlQEGyr0DsTcFAgMBAAGjLzAtMAkGA1UdEwQCMAAw
> >>>>>>>>> CwYDVR0PBAQDAgUgMBMGA1UdJQQMMAoGCCsGAQUFBwMBMA0GCSqGSIb3DQEBBQUA
> >>>>>>>>> A4IBAQDE+cXjx6uNL/Kf/HmE7FeQ238iN7Gfb+I1QHmbRaR0qbTqcFzp7NCJ62uq
> >>>>>>>>> nJ6Anj0+h1IFNMlQrCISSS0fnSj+mXMKDodZzV+cXFjdtoEXyqdDO0zphDMTRd8H
> >>>>>>>>> oI79XSm5IK6vcPR+g2UTkhgrX1xfgeqZ8hmw0L0mMMGHXclwwaAF9HRNomFt32gr
> >>>>>>>>> 1sVhFkhH/5epmgcl+8yI1E7UaQc91bYkUEuQFNu7irgc+/tvcXa4O4+dIfhnzrog
> >>>>>>>>> 8piYUk4dxGME8LknQ213Gow9cgEKzcYadJ4DIr6gChkvAnYpHHHafWj/Ksvxyii6
> >>>>>>>>> 8FxuTfgsrOYwkqEcSXeCGUS25nU9
> >>>>>>>>> -----END CERTIFICATE-----
> >>>>>>>>>      1 s:/CN=Kiprosh7
> >>>>>>>>>        i:/CN=Kiprosh7
> >>>>>>>>> -----BEGIN CERTIFICATE-----
> >>>>>>>>> MIICxjCCAa6gAwIBAgIJANsNRAs/ueOoMA0GCSqGSIb3DQEBBQUAMBMxETAPBgNV
> >>>>>>>>> BAMTCEtpcHJvc2g3MB4XDTExMDgxMDA4MDEzMloXDTEyMDgwOTA4MDEzMlowEzER
> >>>>>>>>> MA8GA1UEAxMIS2lwcm9zaDcwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIB
> >>>>>>>>> AQDorxS4o/H/w7f+VYWkQk3gS7g7gWFd3S4eCVV35a3GEcyP2OS4pUhhZXyB0lN7
> >>>>>>>>> xmUHqeixx7aNRnrc130SQ4kke1fuxtdLjKxu+oeASMLCSkF356m8X5FhuTnPkf2W
> >>>>>>>>> x64i6nk9SOO+jdQo/kMChy0H7psKS5I2M0nb5WLxN/JOACNnxJOhFy8cGw7l32q6
> >>>>>>>>> rEfqLkdnZJR09fiuf0hEbb/UodOt2tXXGN0Pp3X2x4cXnD6E2Va9QSBYIvPAnWEn
> >>>>>>>>> FN2Te+Qwg+AxwHIkCjH9bfQ7fOeuGHAoanSnlqS5rW/T5sKKlkBl95WeJoTFjrCt
> >>>>>>>>> CVDLilsnLrfmZkg3ICQtPbgNAgMBAAGjHTAbMAwGA1UdEwQFMAMBAf8wCwYDVR0P
> >>>>>>>>> BAQDAgEGMA0GCSqGSIb3DQEBBQUAA4IBAQBGtbJQyQ1pWVo+7snqxCOn/KVN++Jo
> >>>>>>>>> 8YEB4/MGKgHyoTWRAa3IXOSPtpunW/6yDziwcLZeO09MATeKCCAJf64LXZr7aM6J
> >>>>>>>>> ZX6hFFNUyqa5w9AaZ4sAe70QwDYPS6dPqcyTab/DVVRGhJAKhUc2lX+UfcBhHYaz
> >>>>>>>>> egKDKyIybHMmcQQm//SO0jo3Ak0565ZAMCdaaO/9RNJpJSxJf+HSVUg4sPLe/sAK
> >>>>>>>>> QlXcdt8XlKsEKBzUHzfRvpbU/8gn1HO5G+CTvEW2kO6nssuKX41g5hMfRqu248TT
> >>>>>>>>> jbGWMkYFMPDY1m2QWPqzLvaETGOWHwqpVWXuMhu7/T5sduDf2n084ok7
> >>>>>>>>> -----END CERTIFICATE-----
> >>>>>>>>> ---
> >>>>>>>>> Server certificate
> >>>>>>>>> subject=/CN=Kiprosh7/O=server
> >>>>>>>>> issuer=/CN=Kiprosh7
> >>>>>>>>> ---
> >>>>>>>>> Acceptable client certificate CA names
> >>>>>>>>> /CN=Kiprosh7
> >>>>>>>>> ---
> >>>>>>>>> SSL handshake has read 1663 bytes and written 2276 bytes
> >>>>>>>>> ---
> >>>>>>>>> New, TLSv1/SSLv3, Cipher is AES256-SHA
> >>>>>>>>> Server public key is 2048 bit
> >>>>>>>>> Secure Renegotiation IS supported
> >>>>>>>>> Compression: NONE
> >>>>>>>>> Expansion: NONE
> >>>>>>>>> SSL-Session:
> >>>>>>>>>         Protocol  : TLSv1
> >>>>>>>>>         Cipher    : AES256-SHA
> >>>>>>>>>         Session-ID:
> >>>>>>>>> 8703D018C270CC932648333F61FE3C986CB336B7C8074ACF3560E415934E26F2
> >>>>>>>>>
> >>>>>>>>>         Session-ID-ctx:
> >>>>>>>>>         Master-Key:
> >>>>>>>>> F5B8C5666355EE6C78910EBB649A65740104537ACEBB28E4A23DF51EA5DE9E6A
> >>>>>>>>> FE3AC2C95B1929985DAFC09CDC6BDEAE
> >>>>>>>>>         Key-Arg   : None
> >>>>>>>>>         PSK identity: None
> >>>>>>>>>         PSK identity hint: None
> >>>>>>>>>         Start Time: 1312972974
> >>>>>>>>>         Timeout   : 300 (sec)
> >>>>>>>>>         Verify return code: 0 (ok)
> >>>>>>>>> ---
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>                    
> >>>>>>>> Thanks and Regards,
> >>>>>>>> Abhijit
> >>>>>>>>
> >>>>>>>>
> >>>>>>>> On 8/10/2011 4:10 PM, Alexandru Scvor?ov wrote:
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>                  
> >>>>>>>>>>> AMQP server protocol negotiation failure: server version
> >>>>>>>>>>> unknown-unknown, client version 0-9
> >>>>>>>>>>>
> >>>>>>>>>>>
> >>>>>>>>>>>
> >>>>>>>>>>>
> >>>>>>>>>>>                        
> >>>>>>>>> That means the client connected successfully but closed the connection
> >>>>>>>>> later because it wasn't talking to an AMQP server.
> >>>>>>>>>
> >>>>>>>>> That means that the client and certificates are fine, so the problem is
> >>>>>>>>> configuring the server.
> >>>>>>>>>
> >>>>>>>>> When you try the other command (the openssl s_client) on the server,
> >>>>>>>>> what output do you get?  Could you please post it?
> >>>>>>>>>
> >>>>>>>>> Alex
> >>>>>>>>>
> >>>>>>>>> On Wed, Aug 10, 2011 at 04:00:26PM +0530, Abhijit wrote:
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>                    
> >>>>>>>>>> yes sir
> >>>>>>>>>> no problem i thought so after looking at client cmd lines i did put
> >>>>>>>>>> slash instead of dot, and now am getting this errors:
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>                      
> >>>>>>>>>>> AMQP server protocol negotiation failure: server version
> >>>>>>>>>>> unknown-unknown, client version 0-9
> >>>>>>>>>>>
> >>>>>>>>>>>
> >>>>>>>>>>>
> >>>>>>>>>>>
> >>>>>>>>>>>                        
> >>>>>>>>>> Can you tell me what are next steps?
> >>>>>>>>>>
> >>>>>>>>>> Thanks and Regards,
> >>>>>>>>>> Abhijit
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>> On 8/10/2011 3:57 PM, Alexandru Scvor?ov wrote:
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>
> >>>>>>>>>>                      
> >>>>>>>>>>>> Am still getting the same error am using the same config file.
> >>>>>>>>>>>>
> >>>>>>>>>>>>
> >>>>>>>>>>>>
> >>>>>>>>>>>>
> >>>>>>>>>>>>
> >>>>>>>>>>>>                          
> >>>>>>>>>>> Ok, but are you sure it's actually the file used by the server? (we had
> >>>>>>>>>>> some problems earlier about which file the server was using when started
> >>>>>>>>>>> from the command prompt or as a service)
> >>>>>>>>>>>
> >>>>>>>>>>>
> >>>>>>>>>>>
> >>>>>>>>>>>
> >>>>>>>>>>>
> >>>>>>>>>>>
> >>>>>>>>>>>                        
> >>>>>>>>>>>>> openssl s_server -accept 5671 -CAfile testca/cacert.pem -cert
> >>>>>>>>>>>>> server/cert.pem -key server.key.pem -state
> >>>>>>>>>>>>>
> >>>>>>>>>>>>>
> >>>>>>>>>>>>>
> >>>>>>>>>>>>>
> >>>>>>>>>>>>>
> >>>>>>>>>>>>>                            
> >>>>>>>>>>> My mistake.  That should be:
> >>>>>>>>>>>         openssl s_server -accept 5671 -CAfile testca/cacert.pem -cert
> >>>>>>>>>>>         server/cert.pem -key server/key.pem -state
> >>>>>>>>>>>
> >>>>>>>>>>> (dot instead of slash in server.key.pem)
> >>>>>>>>>>>
> >>>>>>>>>>> BTW, if they're disposable, could you send the certificates and keys?
> >>>>>>>>>>> We've had problems before with the certificates generated by OpenSSL,
> >>>>>>>>>>> which were usually solved by using a different version.  Maybe this is
> >>>>>>>>>>> happening here.
> >>>>>>>>>>>
> >>>>>>>>>>> Cheers,
> >>>>>>>>>>> Alex
> >>>>>>>>>>>
> >>>>>>>>>>> On Wed, Aug 10, 2011 at 03:46:39PM +0530, Abhijit wrote:
> >>>>>>>>>>>
> >>>>>>>>>>>
> >>>>>>>>>>>
> >>>>>>>>>>>
> >>>>>>>>>>>
> >>>>>>>>>>>                        
> >>>>>>>>>>>> hi sir,
> >>>>>>>>>>>>
> >>>>>>>>>>>> Am still getting the same error am using the same config file.
> >>>>>>>>>>>>
> >>>>>>>>>>>> But i was not able to run this command you sent me:
> >>>>>>>>>>>>
> >>>>>>>>>>>>
> >>>>>>>>>>>>
> >>>>>>>>>>>>
> >>>>>>>>>>>>
> >>>>>>>>>>>>
> >>>>>>>>>>>>                          
> >>>>>>>>>>>>> openssl s_server -accept 5671 -CAfile testca/cacert.pem -cert
> >>>>>>>>>>>>> server/cert.pem -key server.key.pem -state
> >>>>>>>>>>>>>
> >>>>>>>>>>>>>
> >>>>>>>>>>>>>
> >>>>>>>>>>>>>
> >>>>>>>>>>>>>
> >>>>>>>>>>>>>                            
> >>>>>>>>>>>> was getting an error: unable to load server certificate private key file.
> >>>>>>>>>>>>
> >>>>>>>>>>>> Thanks and Regards,
> >>>>>>>>>>>> Abhijit
> >>>>>>>>>>>>
> >>>>>>>>>>>>
> >>>>>>>>>>>>
> >>>>>>>>>>>>
> >>>>>>>>>>>>
> >>>>>>>>>>>>
> >>>>>>>>>>>>
> >>>>>>>>>>>>                          
> >>>>>>>>>>
> >>>>>>>>>>                      
> >>>>>>>>
> >>>>>>>>                  
> >>>>>>
> >>>>>>              
> >>>>
> >>>>          
> >>      
> 

> -----BEGIN RSA PRIVATE KEY-----
> MIIEpAIBAAKCAQEAxt0TpBEhXsGZpQ5Uo5G/BJIgEAvHJti7g/zcsIZXYLv7dwj2
> pgvFcDBDC2UDRxFu8ZRBu2oPqhr/kXA/2KoW1g9Y5fG9LYFVNjKvw7Vr61d9zbNp
> 8kIF5zyGBxhZGL7AXpltIGaf7VRy/pwz8hhe0Nq4h12jQi7tfJusiUt9wz3a0f3H
> 98KtXkEmhydKgFrHkunBEOeSGzajOPnubRSyIpi9CCvS79by8UXZk5FVVQee+Rcu
> B0L8HjO+cFkcuFAH3si3wWymouaEDpWY1n0x2QZA0//FypsY1uBFr84cF6sUHIMI
> jdUgD7Bo2phqTcvlsttRuHiSr5C2+GRQo2EelQIDAQABAoIBAC+RGe2Ym17K+DFe
> 6Cfn6MTzHvA3oP9NwCymAzPGLohY7qFeZ4D4N9XJ9X94Pfx10w+94qsth2ms44yq
> SNtOc//n09/Mnu+PjA5WuWwarSGx38mgLKth13+kHnr7+/PLTMBT+qJRadee55K3
> UkWKRsO2TYUzhKWEDBJOOkrs37wfVx4mDs2X3UxjGSUgdvxw/xAfRZ+cn6Svf42t
> L1+4a7DOinAIlUh/NdRF2XVkf7skjCJu7vOO6i5ky++xxo5LK36kjb/PMDMEOA8d
> d36nGStSON8ltvZO90Y/WvF09hw3cI/qZ2wugdxYaAIkVbN5Aw6UHGTikPn8qcn+
> DF3I29ECgYEA92L1hUOY5ziU9clDhHbpLrlIyNREYrsFO0yMqE2t4OaAnURszjUD
> 1tqP7nNoq8qRxkfjtqxTsACjEj9WfqP0lQWEb8Emt9jg6Z2Uf6MGTXh+ijeMGPMR
> LidpCwP39F6bv7DEm3h+EwJVK0Rhb+mKgvhReM4nr28X892v26gP9jcCgYEAzcmd
> o2Mejnzv+G4J/E4p4XiFX/zYgCieCKnqi73xgdj2j31o1hJZYBkh/9hnBvVS6RrX
> 3G8ngwfUTxk0bAqH1sNRRiqFjpkWmjDl0PO7e+LsokX80Y2P1dPfdwQnje8Od8Vi
> M33j6zvURyXJ5EAWbWIKKHZR1k8TxtmD8u1Aq5MCgYEAttDDnbLBmQWgVy5fndF+
> KtAz8G2lB80rZZIBVBLrjwroOtApFA3rg2hK+y0ASgvNxFi19/XLdoJSABccZUPm
> aAYGw8taQHyeYSXZaqVf7/o+kQfRmVJu/MuU/dX18/nCYVtRP49Ao+2SYQIMe3Z7
> rKOzGXJHs4aGjeninpHJEesCgYBzwcKzwrDQlATkqPli/JDgbMwRt4gNZ0umMfZm
> jv0H/oSLKI9NQ9sUjG6snQ0vQ9ZUm63rKHeAZGoP6Gytjarlqs7P+mFQWlr1dyX/
> SOsggAB+M4JIWiobrOfZ6fNaCqwHwXdA4cLQcsIxF1ee1lIHS4vNQOk99RN52qc3
> gi/LkwKBgQCxwgAeINI2r1EFDC+k+hJ7Od4TkrZk7TvsgvwpnxQHkJpkYqAFjT4Z
> DXswdo+4gN70oN2fkrXGypIo/r+G20AI8VlBy91eIV1YI5GFGOs2q5by0+7UHV8h
> RVQeKHXsz5/hpSeF4wdJox1kqgySeluCA/mMt9i+jAyPz1xwK8U+aw==
> -----END RSA PRIVATE KEY-----



> -----BEGIN CERTIFICATE-----
> MIICxjCCAa6gAwIBAgIJALgBaefnAA8iMA0GCSqGSIb3DQEBBQUAMBMxETAPBgNV
> BAMTCE15VGVzdENBMB4XDTExMDgxMTA3MTEyMFoXDTEyMDgxMDA3MTEyMFowEzER
> MA8GA1UEAxMITXlUZXN0Q0EwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIB
> AQDjrWFlQ6QBss2DVe6xiCmzyYbSm1zAu9gVwDWvrvkK3cSQ2Y9iA+IKQUXhmmq2
> EJHwLpapjG/6ZucWrIWEX+53vkSpGdia9hTsbxxOFueP8SaYM96/K3/cEV/JtSIO
> ylEwVTlwuuNvAfrnG8srgDtFuXYoFRKWMoLsd68kNAyTCJWWoYqe71V5poY+c2Zv
> rLofRwWcz7wRnEcvw5bj3eIl9jURMmGTHtSQMVEskokvuAm2xfNBXrgsdw04SDH6
> m8x5rXgvEu8wHUNCPx/4a8qcYGFLnTov5d8O0Bs3GLfhR7sYeTZt4L2BrTLuPUZ9
> cXCAQ+PmJUgYgytmjIbwDDAXAgMBAAGjHTAbMAwGA1UdEwQFMAMBAf8wCwYDVR0P
> BAQDAgEGMA0GCSqGSIb3DQEBBQUAA4IBAQBJL8UchryKVyoKtpkkVJd7O2PJO6Yh
> 21kq75Y+gvJ5iCxF9fVqOpNYerFFt+KR1uxAuHglse7DBJDmfplpvQ/FlmJonztP
> qeXfFKSiN4CRIHzCvrZOxX/CHTtnzjJ5ArmrTk71f9gkmeKhoZ1mhgHIqFMPjxhT
> u+5vK6S0TjcqyEeYnt6o794rz/sVLWOaDrGWxe2mZBq7wGajQq6xauyXWUovPWg8
> 1QNBDcpJb6BNrupK2AFONYI6BPpdMnl6m+PqwYXD3oZakMnNLoQLSYE8wD3ZQkTO
> V2upmgchnKN+qpfHHUGmilikc6FIUhcfSRGvTx63r1CvOFYPwGvJVoOL
> -----END CERTIFICATE-----

> -----BEGIN CERTIFICATE-----
> MIIC4DCCAcigAwIBAgIBATANBgkqhkiG9w0BAQUFADATMREwDwYDVQQDEwhNeVRl
> c3RDQTAeFw0xMTA4MTEwNzEzNTBaFw0xMjA4MTAwNzEzNTBaMCMxEDAOBgNVBAMT
> B2FiaGlqaXQxDzANBgNVBAoTBnNlcnZlcjCCASIwDQYJKoZIhvcNAQEBBQADggEP
> ADCCAQoCggEBAMbdE6QRIV7BmaUOVKORvwSSIBALxybYu4P83LCGV2C7+3cI9qYL
> xXAwQwtlA0cRbvGUQbtqD6oa/5FwP9iqFtYPWOXxvS2BVTYyr8O1a+tXfc2zafJC
> Bec8hgcYWRi+wF6ZbSBmn+1Ucv6cM/IYXtDauIddo0Iu7XybrIlLfcM92tH9x/fC
> rV5BJocnSoBax5LpwRDnkhs2ozj57m0UsiKYvQgr0u/W8vFF2ZORVVUHnvkXLgdC
> /B4zvnBZHLhQB97It8FspqLmhA6VmNZ9MdkGQNP/xcqbGNbgRa/OHBerFByDCI3V
> IA+waNqYak3L5bLbUbh4kq+QtvhkUKNhHpUCAwEAAaMvMC0wCQYDVR0TBAIwADAL
> BgNVHQ8EBAMCBSAwEwYDVR0lBAwwCgYIKwYBBQUHAwEwDQYJKoZIhvcNAQEFBQAD
> ggEBALl7ostKoOKqa8ytOX8qsf7kxvW7Mw66NdRS7sBlM+jVaZHjCwxIAGe/QaGL
> c5P+aQx7lCFBSXPDD6sWsI59R8MSQTS0TJ8Ek4dB6Y8R6wRLtVCLGXLIeaNqP8BX
> lGb2Za42VV5O0iaDcyh+DGhZ77lJKOMZS/y6UzyqR8Q5oSNM/J8BvMr6eDHae31P
> Of2lRJAT2O3DdRqZjpVSrsNFLKM7GAeOctjVoPhNJuUTSCmW6lEtkC1ixDseoZIe
> o2Pz4kzSf66pgxM0IGKl5OeqGMht7SonhDS8Fda2fRITvgf+ZunD4Yw8ueoZnxQO
> rum0HrvwARjNTMA3lzrmagZntxk=
> -----END CERTIFICATE-----


From abhijit.sinha at kiprosh.com  Thu Aug 11 13:18:53 2011
From: abhijit.sinha at kiprosh.com (Abhijit)
Date: Thu, 11 Aug 2011 17:48:53 +0530
Subject: [rabbitmq-discuss] facing issues with the SSL implementations
 with RabbitMQ + Windows + .Net
In-Reply-To: <20110811120644.GD3139@dakota.eng.vmware.com>
References: <20110810104000.GE2869@dakota.eng.vmware.com>
	<4E42617A.3090601@kiprosh.com>
	<20110810115056.GF2869@dakota.eng.vmware.com>
	<4E4272EA.9040308@kiprosh.com>
	<20110810121824.GG2869@dakota.eng.vmware.com>
	<4E428DAE.4000703@kiprosh.com>
	<20110810140832.GH2869@dakota.eng.vmware.com>
	<4E42952B.5040207@kiprosh.com>
	<20110810144546.GI2869@dakota.eng.vmware.com>
	<4E438390.6000006@kiprosh.com>
	<20110811120644.GD3139@dakota.eng.vmware.com>
Message-ID: <4E43C8AD.5020507@kiprosh.com>

Thanks a lot sir for helping me out thoroughly.

its working perfectly i was using the server certificate at the client 
end until now.

Thanks and Regards,
Abhijit

On 8/11/2011 5:36 PM, Alexandru Scvor?ov wrote:
> Hello,
>
> I don't see anything wrong with how you're generating certificate, but I
> do see a problem with your certificates:
>    the keycert.p12 contains the SERVER certificates, rather than the
>    client certificates.
>
> Using your certificates, I get "The message received was unexpected or
> badly formatted" on the .NET side and {ssl_upgrade_error,esslaccept} on
> the server side.  This is what's expected when you use the server
> certificates for the client.  Is that also what you get?
>
> If so, could you please make sure, when generating CLIENT, certificates,
> you do
>
> # cd ../client
> # openssl pkcs12 -export -out keycert.p12 -in cert.pem -inkey key.pem
> # passout pass:password
>
> and not
>
> # cd ../server
> # openssl pkcs12 -export -out keycert.p12 -in cert.pem -inkey key.pem
> # passout pass:password
>
> or something similar.
>
> Cheers,
> Alex
>
>
> On Thu, Aug 11, 2011 at 12:54:00PM +0530, Abhijit wrote:
>    
>> Hi Sir,
>>
>> Am sending you the new set of certificates i made today morning which
>> were still giving same errors. Can you please inspect them and let me
>> know what are the errors.
>>
>> Thanks and Regards,
>> Abhijit
>>
>> On 8/10/2011 8:15 PM, Alexandru Scvor?ov wrote:
>>      
>>>> can you tell me did you create your certificates on windows?
>>>> or on linux machine?
>>>>
>>>>          
>>> I generated the certificates on Windows Server 2008.
>>>
>>>
>>>        
>>>> openssl req -x509 -config openssl.cnf -newkey rsa:2048 -days 365 \
>>>>        -out cacert.pem -outform PEM -subj /CN=MyTestCA/ -nodes
>>>>
>>>> i executed above as
>>>> openssl req -x509 -config openssl.cnf -newkey rsa:2048 -days 365 -out cacert.pem -outform PEM -subj /CN=MyTestCA/ -nodes
>>>>
>>>>          
>>> I did the same thing.
>>>
>>> Could you send the certificates you're using? (same files I sent
>>> earlier)  I'll see if I can find anything wrong with them.
>>>
>>> Alex
>>>
>>> On Wed, Aug 10, 2011 at 07:56:51PM +0530, Abhijit wrote:
>>>
>>>        
>>>> OK Sir
>>>>
>>>> can you tell me did you create your certificates on windows?
>>>> or on linux machine?
>>>>
>>>> openssl req -x509 -config openssl.cnf -newkey rsa:2048 -days 365 \
>>>>        -out cacert.pem -outform PEM -subj /CN=MyTestCA/ -nodes
>>>>
>>>> i executed above as
>>>> openssl req -x509 -config openssl.cnf -newkey rsa:2048 -days 365 -out cacert.pem -outform PEM -subj /CN=MyTestCA/ -nodes
>>>>
>>>> because as you told me that i need to do it similarly as in the website i skipped the '\' since it wasn't a valid element in openssl.
>>>>
>>>> does that caused the error?
>>>>
>>>> Thanks and Regards,
>>>> Abhijit
>>>>
>>>>
>>>>
>>>> On 8/10/2011 7:38 PM, Alexandru Scvor?ov wrote:
>>>>
>>>>          
>>>>>> but with no luck, do i need something more.
>>>>>>
>>>>>>
>>>>>>              
>>>>> Not that I can think of, no.
>>>>>
>>>>> If you're using OpenSSL 1.0.0, could you try with OpenSSL 0.9.8?
>>>>>
>>>>> Cheers,
>>>>> Alex
>>>>>
>>>>> On Wed, Aug 10, 2011 at 07:24:54PM +0530, Abhijit wrote:
>>>>>
>>>>>
>>>>>            
>>>>>> Hi sir,
>>>>>>
>>>>>> i went through all the steps again to make certificates in this link:
>>>>>>
>>>>>>
>>>>>>              
>>>>>>> http://www.rabbitmq.com/ssl.html#keys-and-certs
>>>>>>>
>>>>>>>
>>>>>>>                
>>>>>> but with no luck, do i need something more.
>>>>>>
>>>>>> Thanking you,
>>>>>>
>>>>>> Regards,
>>>>>> Abhijit
>>>>>>
>>>>>>
>>>>>> On 8/10/2011 5:48 PM, Alexandru Scvor?ov wrote:
>>>>>>
>>>>>>
>>>>>>              
>>>>>>>> The code worked now. the certificate you provided did work
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>                  
>>>>>>> Great to hear that.
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>                
>>>>>>>>      wondering why
>>>>>>>> my certificates are not working??
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>                  
>>>>>>> I suspect you got some step in the certificate generation wrong (I
>>>>>>> generated the certificates following the instructions on the website).
>>>>>>> It's ridiculously easy to get something wrong.
>>>>>>>
>>>>>>> I'd delete all the certificates, and CA you generated and try again.
>>>>>>> The website instructions are right.  You might want to try without
>>>>>>> changing anything (the CA's name, for instance) just to see that it
>>>>>>> works.
>>>>>>>
>>>>>>> You could also try a different version of OpenSSL, but I'd be quite
>>>>>>> surprised if that were the problem.
>>>>>>>
>>>>>>> Let us how it goes.
>>>>>>>
>>>>>>> Cheers,
>>>>>>> Alex
>>>>>>>
>>>>>>>
>>>>>>> On Wed, Aug 10, 2011 at 05:30:42PM +0530, Abhijit wrote:
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>                
>>>>>>>> Hi sir,
>>>>>>>>
>>>>>>>> The code worked now. the certificate you provided did work wondering why
>>>>>>>> my certificates are not working??
>>>>>>>>
>>>>>>>> Thanks and Regards,
>>>>>>>> Abhijit
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>> On 8/10/2011 5:20 PM, Alexandru Scvor?ov wrote:
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>                  
>>>>>>>>> :(  That seems perfectly fine.
>>>>>>>>>
>>>>>>>>> Other ways to get an "unknown ca" error:
>>>>>>>>>        - forget to add the CA certificate to the Trust store;
>>>>>>>>>        - have the client use a certificate signed by a different authority
>>>>>>>>>          than the one given to the server.
>>>>>>>>>
>>>>>>>>> I'm out of ideas.  I'm attaching:
>>>>>>>>>        - cacert.pem and cacert.cer;
>>>>>>>>>        - keycert.p12 (password is "test");
>>>>>>>>>        - server's cert.pem, key.pem.
>>>>>>>>>
>>>>>>>>> You'll also need to set RemoteCertificateNameMismatch before starting the connection:
>>>>>>>>>        cf.Ssl.AcceptablePolicyErrors =
>>>>>>>>>          SslPolicyErrors.RemoteCertificateNameMismatch;
>>>>>>>>>
>>>>>>>>> Could you please try with these and see if it works (or if you get a
>>>>>>>>> different error)?
>>>>>>>>>
>>>>>>>>> Cheers,
>>>>>>>>> Alex
>>>>>>>>>
>>>>>>>>> On Wed, Aug 10, 2011 at 04:16:18PM +0530, Abhijit wrote:
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>                    
>>>>>>>>>> Ok sir thanks,
>>>>>>>>>>
>>>>>>>>>> this is the post for the former command s_client:
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>                      
>>>>>>>>>>> C:\>openssl s_client -connect localhost:5671 -CAfile testca/cacert.pem
>>>>>>>>>>> -cert cli
>>>>>>>>>>> ent/cert.pem -key client/key.pem -showcerts
>>>>>>>>>>> Loading 'screen' into random state - done
>>>>>>>>>>> CONNECTED(00000160)
>>>>>>>>>>> depth=1 CN = Kiprosh7
>>>>>>>>>>> verify return:1
>>>>>>>>>>> depth=0 CN = Kiprosh7, O = server
>>>>>>>>>>> verify return:1
>>>>>>>>>>> ---
>>>>>>>>>>> Certificate chain
>>>>>>>>>>>       0 s:/CN=Kiprosh7/O=server
>>>>>>>>>>>         i:/CN=Kiprosh7
>>>>>>>>>>> -----BEGIN CERTIFICATE-----
>>>>>>>>>>> MIIC4TCCAcmgAwIBAgIBATANBgkqhkiG9w0BAQUFADATMREwDwYDVQQDEwhLaXBy
>>>>>>>>>>> b3NoNzAeFw0xMTA4MTAwODA1NTBaFw0xMjA4MDkwODA1NTBaMCQxETAPBgNVBAMM
>>>>>>>>>>> CEtpcHJvc2g3MQ8wDQYDVQQKDAZzZXJ2ZXIwggEiMA0GCSqGSIb3DQEBAQUAA4IB
>>>>>>>>>>> DwAwggEKAoIBAQDTDgQ3/vSBPvy0PAZYwk4H2qlFckaA75YfCYZ+HhIb+JUSrZ4r
>>>>>>>>>>> NcBEhvrH+7p1yft9IC4pgrgEbjmfQVTi8LGwtMRZmwpbmjqEfOALpra5x7Plb+7y
>>>>>>>>>>> CTT/iDc8uUwHLn2brXxNRn58IrEeD1X+rBxLNyek0pQu/hH31+REI5Sn1JZfi7gc
>>>>>>>>>>> 3PJEuaRzVJY4sE0neNWT+K+aD0n382qnziLEGOusXWNpggpoHVFKZR3Yojxj6Bfk
>>>>>>>>>>> 9lUvfUtIqz2zQ2dF0q6A0QVVlIenKzUK+rjHxQAUSb8P9CmCuRXUih3f61ahquQP
>>>>>>>>>>> CgSrkNnUV44D/wHfnxNm9QjxlQEGyr0DsTcFAgMBAAGjLzAtMAkGA1UdEwQCMAAw
>>>>>>>>>>> CwYDVR0PBAQDAgUgMBMGA1UdJQQMMAoGCCsGAQUFBwMBMA0GCSqGSIb3DQEBBQUA
>>>>>>>>>>> A4IBAQDE+cXjx6uNL/Kf/HmE7FeQ238iN7Gfb+I1QHmbRaR0qbTqcFzp7NCJ62uq
>>>>>>>>>>> nJ6Anj0+h1IFNMlQrCISSS0fnSj+mXMKDodZzV+cXFjdtoEXyqdDO0zphDMTRd8H
>>>>>>>>>>> oI79XSm5IK6vcPR+g2UTkhgrX1xfgeqZ8hmw0L0mMMGHXclwwaAF9HRNomFt32gr
>>>>>>>>>>> 1sVhFkhH/5epmgcl+8yI1E7UaQc91bYkUEuQFNu7irgc+/tvcXa4O4+dIfhnzrog
>>>>>>>>>>> 8piYUk4dxGME8LknQ213Gow9cgEKzcYadJ4DIr6gChkvAnYpHHHafWj/Ksvxyii6
>>>>>>>>>>> 8FxuTfgsrOYwkqEcSXeCGUS25nU9
>>>>>>>>>>> -----END CERTIFICATE-----
>>>>>>>>>>>       1 s:/CN=Kiprosh7
>>>>>>>>>>>         i:/CN=Kiprosh7
>>>>>>>>>>> -----BEGIN CERTIFICATE-----
>>>>>>>>>>> MIICxjCCAa6gAwIBAgIJANsNRAs/ueOoMA0GCSqGSIb3DQEBBQUAMBMxETAPBgNV
>>>>>>>>>>> BAMTCEtpcHJvc2g3MB4XDTExMDgxMDA4MDEzMloXDTEyMDgwOTA4MDEzMlowEzER
>>>>>>>>>>> MA8GA1UEAxMIS2lwcm9zaDcwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIB
>>>>>>>>>>> AQDorxS4o/H/w7f+VYWkQk3gS7g7gWFd3S4eCVV35a3GEcyP2OS4pUhhZXyB0lN7
>>>>>>>>>>> xmUHqeixx7aNRnrc130SQ4kke1fuxtdLjKxu+oeASMLCSkF356m8X5FhuTnPkf2W
>>>>>>>>>>> x64i6nk9SOO+jdQo/kMChy0H7psKS5I2M0nb5WLxN/JOACNnxJOhFy8cGw7l32q6
>>>>>>>>>>> rEfqLkdnZJR09fiuf0hEbb/UodOt2tXXGN0Pp3X2x4cXnD6E2Va9QSBYIvPAnWEn
>>>>>>>>>>> FN2Te+Qwg+AxwHIkCjH9bfQ7fOeuGHAoanSnlqS5rW/T5sKKlkBl95WeJoTFjrCt
>>>>>>>>>>> CVDLilsnLrfmZkg3ICQtPbgNAgMBAAGjHTAbMAwGA1UdEwQFMAMBAf8wCwYDVR0P
>>>>>>>>>>> BAQDAgEGMA0GCSqGSIb3DQEBBQUAA4IBAQBGtbJQyQ1pWVo+7snqxCOn/KVN++Jo
>>>>>>>>>>> 8YEB4/MGKgHyoTWRAa3IXOSPtpunW/6yDziwcLZeO09MATeKCCAJf64LXZr7aM6J
>>>>>>>>>>> ZX6hFFNUyqa5w9AaZ4sAe70QwDYPS6dPqcyTab/DVVRGhJAKhUc2lX+UfcBhHYaz
>>>>>>>>>>> egKDKyIybHMmcQQm//SO0jo3Ak0565ZAMCdaaO/9RNJpJSxJf+HSVUg4sPLe/sAK
>>>>>>>>>>> QlXcdt8XlKsEKBzUHzfRvpbU/8gn1HO5G+CTvEW2kO6nssuKX41g5hMfRqu248TT
>>>>>>>>>>> jbGWMkYFMPDY1m2QWPqzLvaETGOWHwqpVWXuMhu7/T5sduDf2n084ok7
>>>>>>>>>>> -----END CERTIFICATE-----
>>>>>>>>>>> ---
>>>>>>>>>>> Server certificate
>>>>>>>>>>> subject=/CN=Kiprosh7/O=server
>>>>>>>>>>> issuer=/CN=Kiprosh7
>>>>>>>>>>> ---
>>>>>>>>>>> Acceptable client certificate CA names
>>>>>>>>>>> /CN=Kiprosh7
>>>>>>>>>>> ---
>>>>>>>>>>> SSL handshake has read 1663 bytes and written 2276 bytes
>>>>>>>>>>> ---
>>>>>>>>>>> New, TLSv1/SSLv3, Cipher is AES256-SHA
>>>>>>>>>>> Server public key is 2048 bit
>>>>>>>>>>> Secure Renegotiation IS supported
>>>>>>>>>>> Compression: NONE
>>>>>>>>>>> Expansion: NONE
>>>>>>>>>>> SSL-Session:
>>>>>>>>>>>          Protocol  : TLSv1
>>>>>>>>>>>          Cipher    : AES256-SHA
>>>>>>>>>>>          Session-ID:
>>>>>>>>>>> 8703D018C270CC932648333F61FE3C986CB336B7C8074ACF3560E415934E26F2
>>>>>>>>>>>
>>>>>>>>>>>          Session-ID-ctx:
>>>>>>>>>>>          Master-Key:
>>>>>>>>>>> F5B8C5666355EE6C78910EBB649A65740104537ACEBB28E4A23DF51EA5DE9E6A
>>>>>>>>>>> FE3AC2C95B1929985DAFC09CDC6BDEAE
>>>>>>>>>>>          Key-Arg   : None
>>>>>>>>>>>          PSK identity: None
>>>>>>>>>>>          PSK identity hint: None
>>>>>>>>>>>          Start Time: 1312972974
>>>>>>>>>>>          Timeout   : 300 (sec)
>>>>>>>>>>>          Verify return code: 0 (ok)
>>>>>>>>>>> ---
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>                        
>>>>>>>>>> Thanks and Regards,
>>>>>>>>>> Abhijit
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>> On 8/10/2011 4:10 PM, Alexandru Scvor?ov wrote:
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>                      
>>>>>>>>>>>>> AMQP server protocol negotiation failure: server version
>>>>>>>>>>>>> unknown-unknown, client version 0-9
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>                            
>>>>>>>>>>> That means the client connected successfully but closed the connection
>>>>>>>>>>> later because it wasn't talking to an AMQP server.
>>>>>>>>>>>
>>>>>>>>>>> That means that the client and certificates are fine, so the problem is
>>>>>>>>>>> configuring the server.
>>>>>>>>>>>
>>>>>>>>>>> When you try the other command (the openssl s_client) on the server,
>>>>>>>>>>> what output do you get?  Could you please post it?
>>>>>>>>>>>
>>>>>>>>>>> Alex
>>>>>>>>>>>
>>>>>>>>>>> On Wed, Aug 10, 2011 at 04:00:26PM +0530, Abhijit wrote:
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>                        
>>>>>>>>>>>> yes sir
>>>>>>>>>>>> no problem i thought so after looking at client cmd lines i did put
>>>>>>>>>>>> slash instead of dot, and now am getting this errors:
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>                          
>>>>>>>>>>>>> AMQP server protocol negotiation failure: server version
>>>>>>>>>>>>> unknown-unknown, client version 0-9
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>                            
>>>>>>>>>>>> Can you tell me what are next steps?
>>>>>>>>>>>>
>>>>>>>>>>>> Thanks and Regards,
>>>>>>>>>>>> Abhijit
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>> On 8/10/2011 3:57 PM, Alexandru Scvor?ov wrote:
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>
>>>>>>>>>>>>                          
>>>>>>>>>>>>>> Am still getting the same error am using the same config file.
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>                              
>>>>>>>>>>>>> Ok, but are you sure it's actually the file used by the server? (we had
>>>>>>>>>>>>> some problems earlier about which file the server was using when started
>>>>>>>>>>>>> from the command prompt or as a service)
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>                            
>>>>>>>>>>>>>>> openssl s_server -accept 5671 -CAfile testca/cacert.pem -cert
>>>>>>>>>>>>>>> server/cert.pem -key server.key.pem -state
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>                                
>>>>>>>>>>>>> My mistake.  That should be:
>>>>>>>>>>>>>          openssl s_server -accept 5671 -CAfile testca/cacert.pem -cert
>>>>>>>>>>>>>          server/cert.pem -key server/key.pem -state
>>>>>>>>>>>>>
>>>>>>>>>>>>> (dot instead of slash in server.key.pem)
>>>>>>>>>>>>>
>>>>>>>>>>>>> BTW, if they're disposable, could you send the certificates and keys?
>>>>>>>>>>>>> We've had problems before with the certificates generated by OpenSSL,
>>>>>>>>>>>>> which were usually solved by using a different version.  Maybe this is
>>>>>>>>>>>>> happening here.
>>>>>>>>>>>>>
>>>>>>>>>>>>> Cheers,
>>>>>>>>>>>>> Alex
>>>>>>>>>>>>>
>>>>>>>>>>>>> On Wed, Aug 10, 2011 at 03:46:39PM +0530, Abhijit wrote:
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>
>>>>>>>>>>>>>                            
>>>>>>>>>>>>>> hi sir,
>>>>>>>>>>>>>>
>>>>>>>>>>>>>> Am still getting the same error am using the same config file.
>>>>>>>>>>>>>>
>>>>>>>>>>>>>> But i was not able to run this command you sent me:
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>                              
>>>>>>>>>>>>>>> openssl s_server -accept 5671 -CAfile testca/cacert.pem -cert
>>>>>>>>>>>>>>> server/cert.pem -key server.key.pem -state
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>
>>>>>>>>>>>>>>>                                
>>>>>>>>>>>>>> was getting an error: unable to load server certificate private key file.
>>>>>>>>>>>>>>
>>>>>>>>>>>>>> Thanks and Regards,
>>>>>>>>>>>>>> Abhijit
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>
>>>>>>>>>>>>>>                              
>>>>>>>>>>>>
>>>>>>>>>>>>                          
>>>>>>>>>>
>>>>>>>>>>                      
>>>>>>>>
>>>>>>>>                  
>>>>>>
>>>>>>              
>>>>
>>>>          
>>      
>    
>> -----BEGIN RSA PRIVATE KEY-----
>> MIIEpAIBAAKCAQEAxt0TpBEhXsGZpQ5Uo5G/BJIgEAvHJti7g/zcsIZXYLv7dwj2
>> pgvFcDBDC2UDRxFu8ZRBu2oPqhr/kXA/2KoW1g9Y5fG9LYFVNjKvw7Vr61d9zbNp
>> 8kIF5zyGBxhZGL7AXpltIGaf7VRy/pwz8hhe0Nq4h12jQi7tfJusiUt9wz3a0f3H
>> 98KtXkEmhydKgFrHkunBEOeSGzajOPnubRSyIpi9CCvS79by8UXZk5FVVQee+Rcu
>> B0L8HjO+cFkcuFAH3si3wWymouaEDpWY1n0x2QZA0//FypsY1uBFr84cF6sUHIMI
>> jdUgD7Bo2phqTcvlsttRuHiSr5C2+GRQo2EelQIDAQABAoIBAC+RGe2Ym17K+DFe
>> 6Cfn6MTzHvA3oP9NwCymAzPGLohY7qFeZ4D4N9XJ9X94Pfx10w+94qsth2ms44yq
>> SNtOc//n09/Mnu+PjA5WuWwarSGx38mgLKth13+kHnr7+/PLTMBT+qJRadee55K3
>> UkWKRsO2TYUzhKWEDBJOOkrs37wfVx4mDs2X3UxjGSUgdvxw/xAfRZ+cn6Svf42t
>> L1+4a7DOinAIlUh/NdRF2XVkf7skjCJu7vOO6i5ky++xxo5LK36kjb/PMDMEOA8d
>> d36nGStSON8ltvZO90Y/WvF09hw3cI/qZ2wugdxYaAIkVbN5Aw6UHGTikPn8qcn+
>> DF3I29ECgYEA92L1hUOY5ziU9clDhHbpLrlIyNREYrsFO0yMqE2t4OaAnURszjUD
>> 1tqP7nNoq8qRxkfjtqxTsACjEj9WfqP0lQWEb8Emt9jg6Z2Uf6MGTXh+ijeMGPMR
>> LidpCwP39F6bv7DEm3h+EwJVK0Rhb+mKgvhReM4nr28X892v26gP9jcCgYEAzcmd
>> o2Mejnzv+G4J/E4p4XiFX/zYgCieCKnqi73xgdj2j31o1hJZYBkh/9hnBvVS6RrX
>> 3G8ngwfUTxk0bAqH1sNRRiqFjpkWmjDl0PO7e+LsokX80Y2P1dPfdwQnje8Od8Vi
>> M33j6zvURyXJ5EAWbWIKKHZR1k8TxtmD8u1Aq5MCgYEAttDDnbLBmQWgVy5fndF+
>> KtAz8G2lB80rZZIBVBLrjwroOtApFA3rg2hK+y0ASgvNxFi19/XLdoJSABccZUPm
>> aAYGw8taQHyeYSXZaqVf7/o+kQfRmVJu/MuU/dX18/nCYVtRP49Ao+2SYQIMe3Z7
>> rKOzGXJHs4aGjeninpHJEesCgYBzwcKzwrDQlATkqPli/JDgbMwRt4gNZ0umMfZm
>> jv0H/oSLKI9NQ9sUjG6snQ0vQ9ZUm63rKHeAZGoP6Gytjarlqs7P+mFQWlr1dyX/
>> SOsggAB+M4JIWiobrOfZ6fNaCqwHwXdA4cLQcsIxF1ee1lIHS4vNQOk99RN52qc3
>> gi/LkwKBgQCxwgAeINI2r1EFDC+k+hJ7Od4TkrZk7TvsgvwpnxQHkJpkYqAFjT4Z
>> DXswdo+4gN70oN2fkrXGypIo/r+G20AI8VlBy91eIV1YI5GFGOs2q5by0+7UHV8h
>> RVQeKHXsz5/hpSeF4wdJox1kqgySeluCA/mMt9i+jAyPz1xwK8U+aw==
>> -----END RSA PRIVATE KEY-----
>>      
>
>
>    
>> -----BEGIN CERTIFICATE-----
>> MIICxjCCAa6gAwIBAgIJALgBaefnAA8iMA0GCSqGSIb3DQEBBQUAMBMxETAPBgNV
>> BAMTCE15VGVzdENBMB4XDTExMDgxMTA3MTEyMFoXDTEyMDgxMDA3MTEyMFowEzER
>> MA8GA1UEAxMITXlUZXN0Q0EwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIB
>> AQDjrWFlQ6QBss2DVe6xiCmzyYbSm1zAu9gVwDWvrvkK3cSQ2Y9iA+IKQUXhmmq2
>> EJHwLpapjG/6ZucWrIWEX+53vkSpGdia9hTsbxxOFueP8SaYM96/K3/cEV/JtSIO
>> ylEwVTlwuuNvAfrnG8srgDtFuXYoFRKWMoLsd68kNAyTCJWWoYqe71V5poY+c2Zv
>> rLofRwWcz7wRnEcvw5bj3eIl9jURMmGTHtSQMVEskokvuAm2xfNBXrgsdw04SDH6
>> m8x5rXgvEu8wHUNCPx/4a8qcYGFLnTov5d8O0Bs3GLfhR7sYeTZt4L2BrTLuPUZ9
>> cXCAQ+PmJUgYgytmjIbwDDAXAgMBAAGjHTAbMAwGA1UdEwQFMAMBAf8wCwYDVR0P
>> BAQDAgEGMA0GCSqGSIb3DQEBBQUAA4IBAQBJL8UchryKVyoKtpkkVJd7O2PJO6Yh
>> 21kq75Y+gvJ5iCxF9fVqOpNYerFFt+KR1uxAuHglse7DBJDmfplpvQ/FlmJonztP
>> qeXfFKSiN4CRIHzCvrZOxX/CHTtnzjJ5ArmrTk71f9gkmeKhoZ1mhgHIqFMPjxhT
>> u+5vK6S0TjcqyEeYnt6o794rz/sVLWOaDrGWxe2mZBq7wGajQq6xauyXWUovPWg8
>> 1QNBDcpJb6BNrupK2AFONYI6BPpdMnl6m+PqwYXD3oZakMnNLoQLSYE8wD3ZQkTO
>> V2upmgchnKN+qpfHHUGmilikc6FIUhcfSRGvTx63r1CvOFYPwGvJVoOL
>> -----END CERTIFICATE-----
>>      
>    
>> -----BEGIN CERTIFICATE-----
>> MIIC4DCCAcigAwIBAgIBATANBgkqhkiG9w0BAQUFADATMREwDwYDVQQDEwhNeVRl
>> c3RDQTAeFw0xMTA4MTEwNzEzNTBaFw0xMjA4MTAwNzEzNTBaMCMxEDAOBgNVBAMT
>> B2FiaGlqaXQxDzANBgNVBAoTBnNlcnZlcjCCASIwDQYJKoZIhvcNAQEBBQADggEP
>> ADCCAQoCggEBAMbdE6QRIV7BmaUOVKORvwSSIBALxybYu4P83LCGV2C7+3cI9qYL
>> xXAwQwtlA0cRbvGUQbtqD6oa/5FwP9iqFtYPWOXxvS2BVTYyr8O1a+tXfc2zafJC
>> Bec8hgcYWRi+wF6ZbSBmn+1Ucv6cM/IYXtDauIddo0Iu7XybrIlLfcM92tH9x/fC
>> rV5BJocnSoBax5LpwRDnkhs2ozj57m0UsiKYvQgr0u/W8vFF2ZORVVUHnvkXLgdC
>> /B4zvnBZHLhQB97It8FspqLmhA6VmNZ9MdkGQNP/xcqbGNbgRa/OHBerFByDCI3V
>> IA+waNqYak3L5bLbUbh4kq+QtvhkUKNhHpUCAwEAAaMvMC0wCQYDVR0TBAIwADAL
>> BgNVHQ8EBAMCBSAwEwYDVR0lBAwwCgYIKwYBBQUHAwEwDQYJKoZIhvcNAQEFBQAD
>> ggEBALl7ostKoOKqa8ytOX8qsf7kxvW7Mw66NdRS7sBlM+jVaZHjCwxIAGe/QaGL
>> c5P+aQx7lCFBSXPDD6sWsI59R8MSQTS0TJ8Ek4dB6Y8R6wRLtVCLGXLIeaNqP8BX
>> lGb2Za42VV5O0iaDcyh+DGhZ77lJKOMZS/y6UzyqR8Q5oSNM/J8BvMr6eDHae31P
>> Of2lRJAT2O3DdRqZjpVSrsNFLKM7GAeOctjVoPhNJuUTSCmW6lEtkC1ixDseoZIe
>> o2Pz4kzSf66pgxM0IGKl5OeqGMht7SonhDS8Fda2fRITvgf+ZunD4Yw8ueoZnxQO
>> rum0HrvwARjNTMA3lzrmagZntxk=
>> -----END CERTIFICATE-----
>>      
>    


From danbarua at gmail.com  Thu Aug 11 14:50:33 2011
From: danbarua at gmail.com (Dan B)
Date: Thu, 11 Aug 2011 06:50:33 -0700 (PDT)
Subject: [rabbitmq-discuss] facing issues with the SSL implementations
 with RabbitMQ + Windows + .Net
In-Reply-To: <4E4143F3.6030804@kiprosh.com>
References: <20110809104918.GB3214@dakota.eng.vmware.com>
	<4E411620.4070301@kiprosh.com>
	<20110809112038.GC3214@dakota.eng.vmware.com>
	<4E411AB4.30706@kiprosh.com>
	<20110809115033.GF3214@dakota.eng.vmware.com>
	<4E412192.5080107@kiprosh.com>
	<20110809120926.GA28785@dakota.eng.vmware.com>
	<4E412A3B.60602@kiprosh.com>
	<20110809124819.GB28785@dakota.eng.vmware.com>
	<4E412D87.2080806@kiprosh.com>
	<20110809141913.GD28785@dakota.eng.vmware.com>
	<4E4143F3.6030804@kiprosh.com>
Message-ID: <25562804.1753.1313070633628.JavaMail.geo-discussion-forums@yqaz21>

Hi Abhijit,

I've spent hours wrestling with the "The message received was unexpected or 
badly formatted" error. I was using SSL with .Net on Windows (rather than 
Mono on Linux which is where the docs come from.)

I converted all the certifications to .pem format using OpenSSL.

My config looks like this:

[ 
  {rabbit, [ 
     {ssl_listeners, [5671]}, 
     {ssl_options, [{cacertfile,"C:/CAConfig/publicCertificate.pem"}, 
                    {certfile,"C:/CAConfig/publicCertificate.pem"}, 
                    {keyfile,"C:/CAConfig/private.pem"}, 
                    {verify,verify_peer}, 
                    {fail_if_no_peer_cert,true}]} 
   ]} 
].

Hope that helps!

-Dan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110811/1aea5a31/attachment.htm>

From alexandru at rabbitmq.com  Thu Aug 11 15:15:57 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Thu, 11 Aug 2011 15:15:57 +0100
Subject: [rabbitmq-discuss] facing issues with the SSL implementations
 with RabbitMQ + Windows + .Net
In-Reply-To: <25562804.1753.1313070633628.JavaMail.geo-discussion-forums@yqaz21>
References: <4E411AB4.30706@kiprosh.com>
	<20110809115033.GF3214@dakota.eng.vmware.com>
	<4E412192.5080107@kiprosh.com>
	<20110809120926.GA28785@dakota.eng.vmware.com>
	<4E412A3B.60602@kiprosh.com>
	<20110809124819.GB28785@dakota.eng.vmware.com>
	<4E412D87.2080806@kiprosh.com>
	<20110809141913.GD28785@dakota.eng.vmware.com>
	<4E4143F3.6030804@kiprosh.com>
	<25562804.1753.1313070633628.JavaMail.geo-discussion-forums@yqaz21>
Message-ID: <20110811141557.GE3139@dakota.eng.vmware.com>

Dan,

>      {ssl_options, [{cacertfile,"C:/CAConfig/publicCertificate.pem"}, 
>                     {certfile,"C:/CAConfig/publicCertificate.pem"}, 
>                     {keyfile,"C:/CAConfig/private.pem"}, 

Did you mean to use your CA certificate and key with the server?  I
suppose you're using a self-signed certificate, right?

What are the server log entries for the connection?

Cheers,
Alex

On Thu, Aug 11, 2011 at 06:50:33AM -0700, Dan B wrote:
> Hi Abhijit,
> 
> I've spent hours wrestling with the "The message received was unexpected or 
> badly formatted" error. I was using SSL with .Net on Windows (rather than 
> Mono on Linux which is where the docs come from.)
> 
> I converted all the certifications to .pem format using OpenSSL.
> 
> My config looks like this:
> 
> [ 
>   {rabbit, [ 
>      {ssl_listeners, [5671]}, 
>      {ssl_options, [{cacertfile,"C:/CAConfig/publicCertificate.pem"}, 
>                     {certfile,"C:/CAConfig/publicCertificate.pem"}, 
>                     {keyfile,"C:/CAConfig/private.pem"}, 
>                     {verify,verify_peer}, 
>                     {fail_if_no_peer_cert,true}]} 
>    ]} 
> ].
> 
> Hope that helps!
> 
> -Dan


From trefor at tetrabyte.com  Thu Aug 11 17:10:31 2011
From: trefor at tetrabyte.com (TreforT)
Date: Thu, 11 Aug 2011 09:10:31 -0700 (PDT)
Subject: [rabbitmq-discuss] Issues starting RabbitMQ 2.5.1 on Ubuntu
 10.04
In-Reply-To: <CABzX+qzHS9+Ve49-T+=XpSfCK=2GmF-MwiH_U1Foka8=QyFU3w@mail.gmail.com>
References: <32219482.post@talk.nabble.com> <32232090.post@talk.nabble.com>
	<CABzX+qzHS9+Ve49-T+=XpSfCK=2GmF-MwiH_U1Foka8=QyFU3w@mail.gmail.com>
Message-ID: <32243347.post@talk.nabble.com>


Hi Merek,

if i run

cat /var/log/rabbitmq/startup_err:

Failed to create thread: Resource temporarily unavailable (11)

and

cat /var/log/rabbitmq/startup_log:

Activating RabbitMQ plugins ...
0 plugins activated:

If i run

sudo -u rabbitmq /usr/sbin/rabbitmq-server

it starts fine, the same if i run

/usr/sbin/rabbitmq-server

as root.

Regards,
Trefor


Marek Majkowski wrote:
> 
> On Wed, Aug 10, 2011 at 09:15, TreforT <trefor at tetrabyte.com> wrote:
> 
> 
> Well, what do logs say? /var/log/rabbitmq/startup_* and
> /var/log/rabbitmq/*/*.log
> 
> Cheers,
>    Marek
> 
> 

-- 
View this message in context: http://old.nabble.com/Issues-starting-RabbitMQ-2.5.1-on-Ubuntu-10.04-tp32219482p32243347.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From sylvain.cordier.ext at morpho.com  Thu Aug 11 17:15:45 2011
From: sylvain.cordier.ext at morpho.com (CORDIER-AKKA Sylvain (MORPHO))
Date: Thu, 11 Aug 2011 18:15:45 +0200
Subject: [rabbitmq-discuss] Configure VM memory high watermark
Message-ID: <6FC2A47F1B2CCC4C804736A81522E83018932E4F86@Y000IMRV02.rd1.rf1>

Hi all,

Following Rabbitmq discuss "unexplained broker shutdown", what are the risks to configure the vm_memory_high_watermark to a higher value in order to not start paging messages at 8% of installed RAM but at 30% or more?

Thanks in advance

Sylvain
#
" Ce courriel et les documents qui lui sont joints peuvent contenir des informations confidentielles ou ayant un caract?re priv?. S'ils ne vous sont pas destin?s, nous vous signalons qu'il est strictement interdit de les divulguer, de les reproduire ou d'en utiliser de quelque mani?re que ce soit le contenu. Si ce message vous a ?t? transmis par erreur, merci d'en informer l'exp?diteur et de supprimer imm?diatement de votre syst?me informatique ce courriel ainsi que tous les documents qui y sont attach?s."
******
" This e-mail and any attached documents may contain confidential or proprietary information. If you are not the intended recipient, you are notified that any dissemination, copying of this e-mail and any attachments thereto or use of their contents by any means whatsoever is strictly prohibited. If you have received this e-mail in error, please advise the sender immediately and delete this e-mail and all attached documents from your computer system."
#
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110811/d39ef45e/attachment.htm>

From matthew at rabbitmq.com  Thu Aug 11 17:23:22 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 11 Aug 2011 17:23:22 +0100
Subject: [rabbitmq-discuss] Configure VM memory high watermark
In-Reply-To: <6FC2A47F1B2CCC4C804736A81522E83018932E4F86@Y000IMRV02.rd1.rf1>
References: <6FC2A47F1B2CCC4C804736A81522E83018932E4F86@Y000IMRV02.rd1.rf1>
Message-ID: <20110811162322.GJ7618@rabbitmq.com>

On Thu, Aug 11, 2011 at 06:15:45PM +0200, CORDIER-AKKA Sylvain (MORPHO) wrote:
> Following Rabbitmq discuss "unexplained broker shutdown", what are the risks to configure the vm_memory_high_watermark to a higher value in order to not start paging messages at 8% of installed RAM but at 30% or more?

In extremis, it could crash due to the Erlang VM being unable to
allocate sufficient RAM for things like garbage collection. Note this is
really quite unlikely, but not impossible.

Also, Rabbit can't actually stop Erlang from using more RAM. There are
scenarios in which Rabbit will eat up vastly more than the 40% it's
notionally meant to throttle publishers at, so a good amount of buffer
space is well advised. Finally, a good amount of space for the OS to
cache disk in is also helpful.

More likely is that you run out of RAM, which means you then have no
disk cache, so performance will suffer, and then Rabbit will start being
swapped out to disk, which will utterly cripple performance. Once
performance starts to drop, as it's likely Rabbit is overloaded anyway
(otherwise it wouldn't have used up so much RAM), performance will fall
off very rapidly, and this can go from bad to worse.

Matthew

From majek04 at gmail.com  Thu Aug 11 18:04:21 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Thu, 11 Aug 2011 18:04:21 +0100
Subject: [rabbitmq-discuss] Issues starting RabbitMQ 2.5.1 on Ubuntu
	10.04
In-Reply-To: <32243347.post@talk.nabble.com>
References: <32219482.post@talk.nabble.com> <32232090.post@talk.nabble.com>
	<CABzX+qzHS9+Ve49-T+=XpSfCK=2GmF-MwiH_U1Foka8=QyFU3w@mail.gmail.com>
	<32243347.post@talk.nabble.com>
Message-ID: <CABzX+qyRG3Ws045s9YqTZm+dTvDp4BfH9F2_Lq4Amikd4bvCWw@mail.gmail.com>

On Thu, Aug 11, 2011 at 17:10, TreforT <trefor at tetrabyte.com> wrote:
> if i run
>
> cat /var/log/rabbitmq/startup_err:
>
> Failed to create thread: Resource temporarily unavailable (11)

Here is your problem. Maybe you set up some restrictions in pam / limits.conf?

I also recall some issues with threading on hand-compiled erlang/otp inside
virtalized linux (I think it was ubuntu on ec2), but I can't recall
any details.

You mentioned that from /etc/init.d/rabbitmq-server it doesn't
work while from command line it does. Can you figure
out if it's using the same version of erlang in both cases?

Please take a look at ulimit -a, and see if it's gives sane values.

What os are you using, can you repeat the problem on a vanilla installation?

Cheers,
  Marek

From oded.maimon at gmail.com  Thu Aug 11 18:28:47 2011
From: oded.maimon at gmail.com (Maimon Oded)
Date: Thu, 11 Aug 2011 20:28:47 +0300
Subject: [rabbitmq-discuss] RabbitMQ as website presence system
In-Reply-To: <CABzX+qzFPySS61T5yHd__vW4W4og7vYFRR-m_NLYA-vX2cRC2w@mail.gmail.com>
References: <CACyzuYBa=_p+nug19AJ94qPa2oiJ9vsVXCy3X66htURZK8=sXg@mail.gmail.com>
	<CABzX+qzFPySS61T5yHd__vW4W4og7vYFRR-m_NLYA-vX2cRC2w@mail.gmail.com>
Message-ID: <CACyzuYAOpECZsMTphnPE+XPHs2G9iMD7rTp0p5HPc6rmKAmCwA@mail.gmail.com>

Hi,
Well i guess i'll use XMPP server for our web presence...

On Wed, Aug 10, 2011 at 5:40 PM, Marek Majkowski <majek04 at gmail.com> wrote:

> On Wed, Aug 10, 2011 at 10:22, Maimon Oded <oded.maimon at gmail.com> wrote:
> > Do you know of anyone using RabbitMQ as a presence solution ? (like done
> > with XMPP servers).
> > if you use it for this purpose, can you describe how please?
>
> Hi,
>
> RabbitMQ (and AMQP in general) don't support anything related
> to 'presence'. From RabbitMQ point of view, user produces
> messages, user consumes messages and that's more or less it.
>
> Maintaining presence is (in my opinion) application specific,
> and in most cases you should end up implementing roster
> in your application.
>
> In ideal world you could do that by just sending a message to yourself
> when user connects and disconnects, however in practice that's
> usually not so trivial.
>
> In order to do this simple thing server-side Tony wrote a x-presence
> exchange plugin some time ago. Here it is, I dusted it off a bit:
>  https://github.com/majek/rabbitmq-x-presence
>
> Take a look, and please do tell us if it helps to solve your particular
> problem.
>
> Cheers,
>   Marek
>



-- 


Oded.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110811/7556ed81/attachment.htm>

From ekirpichov at gmail.com  Thu Aug 11 18:56:20 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Thu, 11 Aug 2011 10:56:20 -0700
Subject: [rabbitmq-discuss] Extremely unfair consumption under high publish
	load
Message-ID: <CANVKUrWPsivfHRb1zeh04vcPeGvU+suQWf3+UtOxNN8_yDTKCQ@mail.gmail.com>

Hi.

I have a scenario where I'm submitting several hundred thousand
messages to a bunch of queues and then waiting for them to be
consumed.

While I'm submitting, the consumption throughput is quite low and
unfair - some of the queues barely get consumed at all.

After I stop submitting, consumption throughput grows by an order of
magnitude (this is more or less understandable) and becomes fair (this
is what bugs me!).

What's wrong? How can I avoid this effect?

Also, is there a way to make rabbitmq to pay more attention to the
consumers rather than producers? I'd rather be publishing and
receiving 2k msg/s than publishing 3k and receiving 1k (queueing the
rest).

http://i.imgur.com/q3TxC.png shows the rates of submitting (bottom)
and consuming (top) per queue. [ shameless plug: drawn from the
application log with a one-liner of http://github.com/jkff/timeplot ]

-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/

From jasonjwwilliams at gmail.com  Thu Aug 11 21:43:04 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Thu, 11 Aug 2011 14:43:04 -0600
Subject: [rabbitmq-discuss] API aliveness test
Message-ID: <CAHZAEpdhqxLmiLYhrGj1WK6gMdGDWVorrRNf5T-2fro=mUv1cw@mail.gmail.com>

Hi,

The documentation for the API aliveness-test call
(/api/aliveness-test/<vhost>) defines the success result
({"status":"ok"}), but not the failure results. When I use
"rabbitmqctl stop_app" to simulate a failure, I get fairly ugly
traceback returned over HTTP (https://gist.github.com/1140707) that'll
crash the JSON parser. So should I just do a string match for
{"status": "ok"} (or HTTP error code match) and consider any other
return a failure, or are there JSON-friendly error outputs as well?

Thank you in advance.

-J

From james.r.carr at gmail.com  Fri Aug 12 00:22:12 2011
From: james.r.carr at gmail.com (James Carr)
Date: Thu, 11 Aug 2011 19:22:12 -0400
Subject: [rabbitmq-discuss] API aliveness test
In-Reply-To: <CAHZAEpdhqxLmiLYhrGj1WK6gMdGDWVorrRNf5T-2fro=mUv1cw@mail.gmail.com>
References: <CAHZAEpdhqxLmiLYhrGj1WK6gMdGDWVorrRNf5T-2fro=mUv1cw@mail.gmail.com>
Message-ID: <CAJreXKBQwpeBEyRh9uwSCWgUjApqy_nXOJAfjesH=hZPfWuQzQ@mail.gmail.com>

In our monitoring that we have hooked up we check for the JSON
response and just wrap it in a try catch, raising an error if an
exception is thrown or status is not "ok"

Thanks,
James


On Thu, Aug 11, 2011 at 4:43 PM, Jason J. W. Williams
<jasonjwwilliams at gmail.com> wrote:
> Hi,
>
> The documentation for the API aliveness-test call
> (/api/aliveness-test/<vhost>) defines the success result
> ({"status":"ok"}), but not the failure results. When I use
> "rabbitmqctl stop_app" to simulate a failure, I get fairly ugly
> traceback returned over HTTP (https://gist.github.com/1140707) that'll
> crash the JSON parser. So should I just do a string match for
> {"status": "ok"} (or HTTP error code match) and consider any other
> return a failure, or are there JSON-friendly error outputs as well?
>
> Thank you in advance.
>
> -J
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From ekirpichov at gmail.com  Fri Aug 12 02:23:36 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Thu, 11 Aug 2011 18:23:36 -0700
Subject: [rabbitmq-discuss] RabbitMQ crashed in ets:insert_new - looks like
	a genuine bug...
Message-ID: <CANVKUrXr4vdzmcHB3-5XDFo4SwrPrA8Deo45zJHZ5uOMnMj-YQ@mail.gmail.com>

A lot of clients (a thousand or more) were rapidly publishing 1kb
messages to a queue, and then rabbitmq crashed.

In fact I had a cluster of 4 rabbits, and 2 of them crashed as a
result. The remaining 2 continued working ok.

Here's a crash report from rabbit-sasl.log. I do not give the full log
because it's large, contains message data (which my employer might not
like) and I'm too lazy to automatically snip it.
But the log is really full of things exactly like what I show. This
exact message gets repeated many times in the same second, and then it
finally crashed.

What other information can I provide to resolve this? Could this be an
error on my, not rabbit's, part? Having a sudden rabbitmq crash is not
really what I'd like to have in production :-|

=CRASH REPORT==== 11-Aug-2011::17:56:19 ===
  crasher:
    initial call: gen:init_it/6
    pid: <0.16624.0>
    registered_name: []
    exception exit: {badarg,
                        [{ets,insert_new,
                             [303172,
                              {<<223,221,16,201,23,190,196,251,169,11,157,145,
                                 94,36,1,105>>,
                               {basic_message,
                                   {resource,<<"/">>,exchange,<<>>},

[<<"results-8808E5FBBC714C9E880F9FD30F443151.TestApp.rmq002">>],
                                   {content,60,none,
                                       <<....>>, % (snipped)
                                       rabbit_framing_amqp_0_9_1,
                                       [<<....>>]}, % (snipped too)
                                   <<223,221,16,201,23,190,196,251,169,11,157,
                                     145,94,36,1,105>>,
                                   true},
                               1}]},
                         {rabbit_msg_store,update_msg_cache,3},
                         {rabbit_msg_store,write,3},
                         {rabbit_variable_queue,
                             '-with_immutable_msg_store_state/3-fun-0-',2},
                         {rabbit_variable_queue,with_msg_store_state,3},
                         {rabbit_variable_queue,
                             with_immutable_msg_store_state,3},
                         {rabbit_variable_queue,maybe_write_msg_to_disk,3},
                         {rabbit_variable_queue,maybe_write_to_disk,4}]}
      in function  gen_server2:terminate/3
    ancestors: [rabbit_amqqueue_sup,rabbit_sup,<0.137.0>]
    messages: [{'$gen_cast',{ack,none,[46689],<0.16623.0>}},
                  {'$gen_cast',{ack,none,[46690],<0.16623.0>}}]
    links: [<0.263.0>]
    dictionary: [{fhc_age_tree,{0,nil}},
                  {{ch,<0.16623.0>},
                   {cr,1,<0.16623.0>,<0.16628.0>,#Ref<0.0.0.16807>,
                       {set,2,16,16,8,80,48,
                            {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                            {{[],[],[],[],[],[],[],[],
                              [46690],
                              [],[],[],[],
                              [46689],
                              [],[]}}},
                       false,none,0}},
                  {guid,{{7,<0.16624.0>},1}}]
    trap_exit: true
    status: running
    heap_size: 1682835
    stack_size: 24
    reductions: 1260360700
  neighbours:


-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/

From jeffdoolittle at gmail.com  Thu Aug 11 23:41:24 2011
From: jeffdoolittle at gmail.com (Jeff Doolittle)
Date: Thu, 11 Aug 2011 15:41:24 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbit-mq management plugin in windows
Message-ID: <b3285902-05dd-44a4-97fc-873daf412a3b@u6g2000prc.googlegroups.com>

I found this thread: http://groups.google.com/group/rabbitmq-discuss/browse_thread/thread/e639a3efd6a6475e

Still no luck.

Anyone know how to get this working?

Thanks,

--Jeff

From ekirpichov at gmail.com  Fri Aug 12 04:45:55 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Thu, 11 Aug 2011 20:45:55 -0700
Subject: [rabbitmq-discuss] RabbitMQ crashed in ets:insert_new - looks
	like a genuine bug...
In-Reply-To: <CANVKUrXr4vdzmcHB3-5XDFo4SwrPrA8Deo45zJHZ5uOMnMj-YQ@mail.gmail.com>
References: <CANVKUrXr4vdzmcHB3-5XDFo4SwrPrA8Deo45zJHZ5uOMnMj-YQ@mail.gmail.com>
Message-ID: <CANVKUrUZe5yN_f_2VWTYbZjGA3Xb5ADm9Yt31vApsRzx74Jxfg@mail.gmail.com>

I ran another test like this and looked a little more closely at the
logs. This time just 1 of 4 nodes crashed and some new errors
appeared.
I'm attaching a slightly snipped version of the logs (all binaries and
some too repetitive stuff snipped).

So:
* There's not only this failure in ets:insert_new, there's also ets:lookup
* There are supervisor reports in sasl.log about
reached_max_restart_intensity; they happen after a few similar
child_terminated reports about rabbit_channels and amqp_queues
* After these things, apparently msg_store_persistent crashes, and so
everything crashes.

Again, the failed rabbitmq node started successfully after a manual restart.

(Folks, is this the right place to report this kind of things? Is it
ok to attach several hundred kb files?)

On Thu, Aug 11, 2011 at 6:23 PM, Eugene Kirpichov <ekirpichov at gmail.com> wrote:
> A lot of clients (a thousand or more) were rapidly publishing 1kb
> messages to a queue, and then rabbitmq crashed.
>
> In fact I had a cluster of 4 rabbits, and 2 of them crashed as a
> result. The remaining 2 continued working ok.
>
> Here's a crash report from rabbit-sasl.log. I do not give the full log
> because it's large, contains message data (which my employer might not
> like) and I'm too lazy to automatically snip it.
> But the log is really full of things exactly like what I show. This
> exact message gets repeated many times in the same second, and then it
> finally crashed.
>
> What other information can I provide to resolve this? Could this be an
> error on my, not rabbit's, part? Having a sudden rabbitmq crash is not
> really what I'd like to have in production :-|
>
> =CRASH REPORT==== 11-Aug-2011::17:56:19 ===
> ?crasher:
> ? ?initial call: gen:init_it/6
> ? ?pid: <0.16624.0>
> ? ?registered_name: []
> ? ?exception exit: {badarg,
> ? ? ? ? ? ? ? ? ? ? ? ?[{ets,insert_new,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? [303172,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?{<<223,221,16,201,23,190,196,251,169,11,157,145,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? 94,36,1,105>>,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? {basic_message,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? {resource,<<"/">>,exchange,<<>>},
>
> [<<"results-8808E5FBBC714C9E880F9FD30F443151.TestApp.rmq002">>],
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? {content,60,none,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? <<....>>, % (snipped)
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? rabbit_framing_amqp_0_9_1,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? [<<....>>]}, % (snipped too)
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? <<223,221,16,201,23,190,196,251,169,11,157,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? 145,94,36,1,105>>,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? true},
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? 1}]},
> ? ? ? ? ? ? ? ? ? ? ? ? {rabbit_msg_store,update_msg_cache,3},
> ? ? ? ? ? ? ? ? ? ? ? ? {rabbit_msg_store,write,3},
> ? ? ? ? ? ? ? ? ? ? ? ? {rabbit_variable_queue,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? '-with_immutable_msg_store_state/3-fun-0-',2},
> ? ? ? ? ? ? ? ? ? ? ? ? {rabbit_variable_queue,with_msg_store_state,3},
> ? ? ? ? ? ? ? ? ? ? ? ? {rabbit_variable_queue,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? with_immutable_msg_store_state,3},
> ? ? ? ? ? ? ? ? ? ? ? ? {rabbit_variable_queue,maybe_write_msg_to_disk,3},
> ? ? ? ? ? ? ? ? ? ? ? ? {rabbit_variable_queue,maybe_write_to_disk,4}]}
> ? ? ?in function ?gen_server2:terminate/3
> ? ?ancestors: [rabbit_amqqueue_sup,rabbit_sup,<0.137.0>]
> ? ?messages: [{'$gen_cast',{ack,none,[46689],<0.16623.0>}},
> ? ? ? ? ? ? ? ? ?{'$gen_cast',{ack,none,[46690],<0.16623.0>}}]
> ? ?links: [<0.263.0>]
> ? ?dictionary: [{fhc_age_tree,{0,nil}},
> ? ? ? ? ? ? ? ? ?{{ch,<0.16623.0>},
> ? ? ? ? ? ? ? ? ? {cr,1,<0.16623.0>,<0.16628.0>,#Ref<0.0.0.16807>,
> ? ? ? ? ? ? ? ? ? ? ? {set,2,16,16,8,80,48,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ?{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
> ? ? ? ? ? ? ? ? ? ? ? ? ? ?{{[],[],[],[],[],[],[],[],
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?[46690],
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?[],[],[],[],
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?[46689],
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?[],[]}}},
> ? ? ? ? ? ? ? ? ? ? ? false,none,0}},
> ? ? ? ? ? ? ? ? ?{guid,{{7,<0.16624.0>},1}}]
> ? ?trap_exit: true
> ? ?status: running
> ? ?heap_size: 1682835
> ? ?stack_size: 24
> ? ?reductions: 1260360700
> ?neighbours:
>
>
> --
> Eugene Kirpichov
> Principal Engineer, Mirantis Inc. http://www.mirantis.com/
> Editor, http://fprog.ru/
>



-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit at RACK2UNIT004-sasl.anonymized.log
Type: application/octet-stream
Size: 185260 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110811/14c53dc4/attachment-0002.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit at RACK2UNIT004.anonymized.log
Type: application/octet-stream
Size: 457193 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110811/14c53dc4/attachment-0003.obj>

From ekirpichov at gmail.com  Fri Aug 12 04:49:20 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Thu, 11 Aug 2011 20:49:20 -0700
Subject: [rabbitmq-discuss] RabbitMQ crashed in ets:insert_new - looks
	like a genuine bug...
In-Reply-To: <CANVKUrUZe5yN_f_2VWTYbZjGA3Xb5ADm9Yt31vApsRzx74Jxfg@mail.gmail.com>
References: <CANVKUrXr4vdzmcHB3-5XDFo4SwrPrA8Deo45zJHZ5uOMnMj-YQ@mail.gmail.com>
	<CANVKUrUZe5yN_f_2VWTYbZjGA3Xb5ADm9Yt31vApsRzx74Jxfg@mail.gmail.com>
Message-ID: <CANVKUrWrnFdX22F-M7g6MhOA1sCg7d1vYyJgNFvWy-bS52e0AQ@mail.gmail.com>

...And also this error I found in the log of one of the nodes that didn't crash.

What does this error mean?

=ERROR REPORT==== 11-Aug-2011::19:57:27 ===
connection <0.745.0>, channel 2 - error:
{amqp_error,internal_error,
            "commit failed:
[{<7566.257.0>,{exit,{{noproc,{gen_server2,call,[msg_store_persistent,{client_terminate,<<64,136,153,249,138,79,147,63,147,97,52,189,50,189,255,66>>},infinity]}},{gen_server2,call,[<7566.257.0>,{commit,<<131,20,0,33,243,147,31,205,97,98,116,217,18,139,207,116>>,<0.19127.8>},infinity]}},[{gen_server2,call,3},{rabbit_misc,with_exit_handler,2},{delegate,safe_invoke,2},{delegate,'-safe_invoke/2-lc$^0/1-0-',2},{delegate,handle_call,3},{gen_server2,handle_msg,2},{proc_lib,wake_up,3}]}}]",
            'tx.commit'}


On Thu, Aug 11, 2011 at 8:45 PM, Eugene Kirpichov <ekirpichov at gmail.com> wrote:
> I ran another test like this and looked a little more closely at the
> logs. This time just 1 of 4 nodes crashed and some new errors
> appeared.
> I'm attaching a slightly snipped version of the logs (all binaries and
> some too repetitive stuff snipped).
>
> So:
> * There's not only this failure in ets:insert_new, there's also ets:lookup
> * There are supervisor reports in sasl.log about
> reached_max_restart_intensity; they happen after a few similar
> child_terminated reports about rabbit_channels and amqp_queues
> * After these things, apparently msg_store_persistent crashes, and so
> everything crashes.
>
> Again, the failed rabbitmq node started successfully after a manual restart.
>
> (Folks, is this the right place to report this kind of things? Is it
> ok to attach several hundred kb files?)
>
> On Thu, Aug 11, 2011 at 6:23 PM, Eugene Kirpichov <ekirpichov at gmail.com> wrote:
>> A lot of clients (a thousand or more) were rapidly publishing 1kb
>> messages to a queue, and then rabbitmq crashed.
>>
>> In fact I had a cluster of 4 rabbits, and 2 of them crashed as a
>> result. The remaining 2 continued working ok.
>>
>> Here's a crash report from rabbit-sasl.log. I do not give the full log
>> because it's large, contains message data (which my employer might not
>> like) and I'm too lazy to automatically snip it.
>> But the log is really full of things exactly like what I show. This
>> exact message gets repeated many times in the same second, and then it
>> finally crashed.
>>
>> What other information can I provide to resolve this? Could this be an
>> error on my, not rabbit's, part? Having a sudden rabbitmq crash is not
>> really what I'd like to have in production :-|
>>
>> =CRASH REPORT==== 11-Aug-2011::17:56:19 ===
>> ?crasher:
>> ? ?initial call: gen:init_it/6
>> ? ?pid: <0.16624.0>
>> ? ?registered_name: []
>> ? ?exception exit: {badarg,
>> ? ? ? ? ? ? ? ? ? ? ? ?[{ets,insert_new,
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? [303172,
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?{<<223,221,16,201,23,190,196,251,169,11,157,145,
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? 94,36,1,105>>,
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? {basic_message,
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? {resource,<<"/">>,exchange,<<>>},
>>
>> [<<"results-8808E5FBBC714C9E880F9FD30F443151.TestApp.rmq002">>],
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? {content,60,none,
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? <<....>>, % (snipped)
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? rabbit_framing_amqp_0_9_1,
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? [<<....>>]}, % (snipped too)
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? <<223,221,16,201,23,190,196,251,169,11,157,
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? 145,94,36,1,105>>,
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? true},
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? 1}]},
>> ? ? ? ? ? ? ? ? ? ? ? ? {rabbit_msg_store,update_msg_cache,3},
>> ? ? ? ? ? ? ? ? ? ? ? ? {rabbit_msg_store,write,3},
>> ? ? ? ? ? ? ? ? ? ? ? ? {rabbit_variable_queue,
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? '-with_immutable_msg_store_state/3-fun-0-',2},
>> ? ? ? ? ? ? ? ? ? ? ? ? {rabbit_variable_queue,with_msg_store_state,3},
>> ? ? ? ? ? ? ? ? ? ? ? ? {rabbit_variable_queue,
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? with_immutable_msg_store_state,3},
>> ? ? ? ? ? ? ? ? ? ? ? ? {rabbit_variable_queue,maybe_write_msg_to_disk,3},
>> ? ? ? ? ? ? ? ? ? ? ? ? {rabbit_variable_queue,maybe_write_to_disk,4}]}
>> ? ? ?in function ?gen_server2:terminate/3
>> ? ?ancestors: [rabbit_amqqueue_sup,rabbit_sup,<0.137.0>]
>> ? ?messages: [{'$gen_cast',{ack,none,[46689],<0.16623.0>}},
>> ? ? ? ? ? ? ? ? ?{'$gen_cast',{ack,none,[46690],<0.16623.0>}}]
>> ? ?links: [<0.263.0>]
>> ? ?dictionary: [{fhc_age_tree,{0,nil}},
>> ? ? ? ? ? ? ? ? ?{{ch,<0.16623.0>},
>> ? ? ? ? ? ? ? ? ? {cr,1,<0.16623.0>,<0.16628.0>,#Ref<0.0.0.16807>,
>> ? ? ? ? ? ? ? ? ? ? ? {set,2,16,16,8,80,48,
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ?{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ?{{[],[],[],[],[],[],[],[],
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?[46690],
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?[],[],[],[],
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?[46689],
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?[],[]}}},
>> ? ? ? ? ? ? ? ? ? ? ? false,none,0}},
>> ? ? ? ? ? ? ? ? ?{guid,{{7,<0.16624.0>},1}}]
>> ? ?trap_exit: true
>> ? ?status: running
>> ? ?heap_size: 1682835
>> ? ?stack_size: 24
>> ? ?reductions: 1260360700
>> ?neighbours:
>>
>>
>> --
>> Eugene Kirpichov
>> Principal Engineer, Mirantis Inc. http://www.mirantis.com/
>> Editor, http://fprog.ru/
>>
>
>
>
> --
> Eugene Kirpichov
> Principal Engineer, Mirantis Inc. http://www.mirantis.com/
> Editor, http://fprog.ru/
>



-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/

From ekirpichov at gmail.com  Fri Aug 12 05:14:52 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Thu, 11 Aug 2011 21:14:52 -0700
Subject: [rabbitmq-discuss] Extremely unfair consumption under high
	publish load
In-Reply-To: <CANVKUrWPsivfHRb1zeh04vcPeGvU+suQWf3+UtOxNN8_yDTKCQ@mail.gmail.com>
References: <CANVKUrWPsivfHRb1zeh04vcPeGvU+suQWf3+UtOxNN8_yDTKCQ@mail.gmail.com>
Message-ID: <CANVKUrUM7OAWjBd2ACZhLN0cVWzgMQQdsz4stGvuFsfYcgvppA@mail.gmail.com>

Please disregard this complaint.

It turned out that I was bombing rabbitmq with reconnects and
QueueDeclares due to a bug in my code, so no wonder it behaved
indecently.

Morale:
Do not bomb rabbitmq with reconnects and QueueDeclares! Especially
when you're on a cluster.

On Thu, Aug 11, 2011 at 10:56 AM, Eugene Kirpichov <ekirpichov at gmail.com> wrote:
> Hi.
>
> I have a scenario where I'm submitting several hundred thousand
> messages to a bunch of queues and then waiting for them to be
> consumed.
>
> While I'm submitting, the consumption throughput is quite low and
> unfair - some of the queues barely get consumed at all.
>
> After I stop submitting, consumption throughput grows by an order of
> magnitude (this is more or less understandable) and becomes fair (this
> is what bugs me!).
>
> What's wrong? How can I avoid this effect?
>
> Also, is there a way to make rabbitmq to pay more attention to the
> consumers rather than producers? I'd rather be publishing and
> receiving 2k msg/s than publishing 3k and receiving 1k (queueing the
> rest).
>
> http://i.imgur.com/q3TxC.png shows the rates of submitting (bottom)
> and consuming (top) per queue. [ shameless plug: drawn from the
> application log with a one-liner of http://github.com/jkff/timeplot ]
>
> --
> Eugene Kirpichov
> Principal Engineer, Mirantis Inc. http://www.mirantis.com/
> Editor, http://fprog.ru/
>



-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/

From ekirpichov at gmail.com  Fri Aug 12 05:47:40 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Thu, 11 Aug 2011 21:47:40 -0700
Subject: [rabbitmq-discuss] RabbitMQ performance tips,
	collected with sweat and blood
Message-ID: <CANVKUrXDQv1e-C3mkXeuY8y96yGecrSwzXOGgerGP7R_610m5w@mail.gmail.com>

Hi,

I decided that I've asked too many hard or confusing questions lately,
and decided to contribute instead :)

So here's what I learnt about making rabbitmq fast, or at least
avoiding making it slow:
* Turn on prefetch. Large is good, small is better than nothing. You
can try a trick "reject a prefetched message if we didn't actually
need it for a few seconds/minutes". Consider prefetch individually for
each queue; e.g. it may be that you cannot turn it on for tasks, but
can for results.
* Turn on autoAck
* Do not use transactions
* In a cluster, always communicate with a queue only through the
broker that first declared it
* Avoid frequently doing these things, esp. on a cluster: establishing
a connection, BasicConsume, QueueDeclare etc. If you do them often
(dozens/hundreds of times per second), you're completely screwed. And
conversely, if you're completely screwed, the first place to look is
whether you're doing these things too frequently, and if you're not,
look again.
* Avoid overloading rabbitmq with published messages in a queue and
making it swap like crazy. For that, use ConfirmSelect (publisher
confirmations), track (in your app) the number of unconfirmed messages
and block further submission if there are too many (more than a few
dozen megabytes). The effect is really dramatic.
* Use a 64-bit machine and raise the vm high watermark
* Increase erlang process limit
* Increase file descriptor limit
* Split one queue into many, as a queue can only utilize 1 core -
across a cluster or not (either will give some benefit); publish in
roundrobin (between those sub-queues that aren't overloaded acc. to
publisher confirmations); consume all simultaneously.

More tips welcome.

-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/

From matthew at rabbitmq.com  Fri Aug 12 09:06:48 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 12 Aug 2011 09:06:48 +0100
Subject: [rabbitmq-discuss] RabbitMQ crashed in ets:insert_new - looks
 like a genuine bug...
In-Reply-To: <CANVKUrXr4vdzmcHB3-5XDFo4SwrPrA8Deo45zJHZ5uOMnMj-YQ@mail.gmail.com>
References: <CANVKUrXr4vdzmcHB3-5XDFo4SwrPrA8Deo45zJHZ5uOMnMj-YQ@mail.gmail.com>
Message-ID: <20110812080647.GA14591@wellquite.org>

Hi Eugene,

Which version of Rabbit is this and which version of Erlang, and on what
platform?


>     exception exit: {badarg,
>                         [{ets,insert_new,
>                              [303172,

What that means is that there's been an attempt to insert into a non
existant table. This normally suggests the msg_store has exited for
other reasons and there are still queues trying to write to the
msg_store's tables. This could indicate other bugs, but this itself is
unlikely to be the root cause.

Matthew

From matthew at rabbitmq.com  Fri Aug 12 09:13:10 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 12 Aug 2011 09:13:10 +0100
Subject: [rabbitmq-discuss] RabbitMQ performance tips,
 collected with sweat and blood
In-Reply-To: <CANVKUrXDQv1e-C3mkXeuY8y96yGecrSwzXOGgerGP7R_610m5w@mail.gmail.com>
References: <CANVKUrXDQv1e-C3mkXeuY8y96yGecrSwzXOGgerGP7R_610m5w@mail.gmail.com>
Message-ID: <20110812081310.GB14591@wellquite.org>

On Thu, Aug 11, 2011 at 09:47:40PM -0700, Eugene Kirpichov wrote:
> * Turn on prefetch. Large is good, small is better than nothing. You
> can try a trick "reject a prefetched message if we didn't actually
> need it for a few seconds/minutes". Consider prefetch individually for
> each queue; e.g. it may be that you cannot turn it on for tasks, but
> can for results.

I don't know what you mean by prefetch. If you mean basic.qos then
you're a little mistaken - basic.qos is a per channel thing, and not per
consumer. Thus setting basic.qos affects every queue from which you're
consuming within the same channel. Using basic.qos with non-zero values
is known to have a fairly large negative impact on performance.

> * Turn on autoAck

autoAck and basic.qos are mutually exclusive.

> * In a cluster, always communicate with a queue only through the
> broker that first declared it

Why do you say that?

> * Avoid frequently doing these things, esp. on a cluster: establishing
> a connection, BasicConsume, QueueDeclare etc. If you do them often
> (dozens/hundreds of times per second), you're completely screwed. And
> conversely, if you're completely screwed, the first place to look is
> whether you're doing these things too frequently, and if you're not,
> look again.

Connection establishment certainly can be a little expensive but you
should be able to do a few hundred a second fairly easily. Things that
hit queues when those queues are already busy can take some time
depending on the loading present on the queue. This is something we're
aware of and are trying to figure out how to solve.

> * Increase erlang process limit

We do that by default, but certainly for large installations raising
that further may be necessary.

> * Split one queue into many, as a queue can only utilize 1 core -
> across a cluster or not (either will give some benefit); publish in
> roundrobin (between those sub-queues that aren't overloaded acc. to
> publisher confirmations); consume all simultaneously.

Yeah, the problem with that is that your message stream may require some
sort of ordering guarantees and by publishing round-robin, you're going
to lose that. For some use cases though, this can be an effective
approach.

Matthew

From trefor at tetrabyte.com  Fri Aug 12 09:36:43 2011
From: trefor at tetrabyte.com (TreforT)
Date: Fri, 12 Aug 2011 01:36:43 -0700 (PDT)
Subject: [rabbitmq-discuss] Issues starting RabbitMQ 2.5.1 on Ubuntu
 10.04
In-Reply-To: <CABzX+qyRG3Ws045s9YqTZm+dTvDp4BfH9F2_Lq4Amikd4bvCWw@mail.gmail.com>
References: <32219482.post@talk.nabble.com> <32232090.post@talk.nabble.com>
	<CABzX+qzHS9+Ve49-T+=XpSfCK=2GmF-MwiH_U1Foka8=QyFU3w@mail.gmail.com>
	<32243347.post@talk.nabble.com>
	<CABzX+qyRG3Ws045s9YqTZm+dTvDp4BfH9F2_Lq4Amikd4bvCWw@mail.gmail.com>
Message-ID: <32248034.post@talk.nabble.com>


Hi Marek,


I can not find any folder called "pam" but I have found "/etc/pam.d" but
limits.conf inside it.


I did find "/etc/security/limits.conf" which looks as though everything is
'hashed' out.


I am running Ubuntu on a 1and1 Virtual Server (which has given me trouble
trying to change the name of the machine, which has eventually been done via
a script when i first start the machine up).


How would i test to see if rabbitmq was using the same version on Erlang?


when I run "ulimit -a" i get:


core file size          (blocks, -c) 0
data seg size           (kbytes, -d) unlimited
scheduling priority             (-e) 20
file size               (blocks, -f) unlimited
pending signals                 (-i) 16382
max locked memory       (kbytes, -l) 64
max memory size         (kbytes, -m) unlimited
open files                      (-n) 1024
pipe size            (512 bytes, -p) 8
POSIX message queues     (bytes, -q) 819200
real-time priority              (-r) 0
stack size              (kbytes, -s) 8192
cpu time               (seconds, -t) unlimited
max user processes              (-u) unlimited
virtual memory          (kbytes, -v) unlimited
file locks                      (-x) unlimited


I have got a 'vanilla' install of Ubuntu in the office (which I plan on
clustering with the one im having issue with) and have no problems with
RabbitMQ on that machine.


Thanks,

Trefor


Marek Majkowski wrote:
> 
> 
> Here is your problem. Maybe you set up some restrictions in pam /
> limits.conf?
> 
> I also recall some issues with threading on hand-compiled erlang/otp
> inside
> virtalized linux (I think it was ubuntu on ec2), but I can't recall
> any details.
> 
> You mentioned that from /etc/init.d/rabbitmq-server it doesn't
> work while from command line it does. Can you figure
> out if it's using the same version of erlang in both cases?
> 
> Please take a look at ulimit -a, and see if it's gives sane values.
> 
> What os are you using, can you repeat the problem on a vanilla
> installation?
> 
> Cheers,
>   Marek
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://old.nabble.com/Issues-starting-RabbitMQ-2.5.1-on-Ubuntu-10.04-tp32219482p32248034.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110812/98687ca8/attachment.htm>

From videlalvaro at gmail.com  Fri Aug 12 10:19:14 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 12 Aug 2011 11:19:14 +0200
Subject: [rabbitmq-discuss] RabbitMQ conference in Dublin - Ireland
Message-ID: <19B54345-C541-468C-B437-3A61709A44A5@gmail.com>

Hi guys,

Next month there will be a "free as in beer" conference about "Messaging Patterns with RabbitMQ" in Dublin, Ireland and you are welcomed to come. More details here:

http://rabbitmq.eventbrite.com/

The Python and Ruby groups are behind the organization, something that talks a bit about RabbitMQ interoperability ;-)

Cheers,

Alvaro

From simon at rabbitmq.com  Fri Aug 12 10:48:38 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 12 Aug 2011 10:48:38 +0100
Subject: [rabbitmq-discuss] API aliveness test
In-Reply-To: <CAHZAEpdhqxLmiLYhrGj1WK6gMdGDWVorrRNf5T-2fro=mUv1cw@mail.gmail.com>
References: <CAHZAEpdhqxLmiLYhrGj1WK6gMdGDWVorrRNf5T-2fro=mUv1cw@mail.gmail.com>
Message-ID: <4E44F6F6.1080002@rabbitmq.com>

On 11/08/11 21:43, Jason J. W. Williams wrote:
> Hi,
>
> The documentation for the API aliveness-test call
> (/api/aliveness-test/<vhost>) defines the success result
> ({"status":"ok"}), but not the failure results. When I use
> "rabbitmqctl stop_app" to simulate a failure, I get fairly ugly
> traceback returned over HTTP (https://gist.github.com/1140707) that'll
> crash the JSON parser. So should I just do a string match for
> {"status": "ok"} (or HTTP error code match) and consider any other
> return a failure, or are there JSON-friendly error outputs as well?

No, no JSON-friendly error outputs. The reason being that you always 
have to allow for the possibility that *something* might go wrong that 
would prevent it from outputting properly formatted JSON. Or replying at 
all.

So for monitoring with this, I would just do the string match, and also 
have a timeout for whether it replies at all.

Actually, you could ignore the body and just check the HTTP status code, 
it won't return 200 OK unless things are good.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From andrea.rosa at hp.com  Fri Aug 12 10:51:56 2011
From: andrea.rosa at hp.com (Rosa, Andrea)
Date: Fri, 12 Aug 2011 10:51:56 +0100
Subject: [rabbitmq-discuss] Messages ready and not delivered
Message-ID: <8097A4E725D78E41A8B862ACE60E963945EF82E188@GVW1355EXB.americas.hpqcorp.net>

Hi

We are facing we a strange issue in an publisher/subscriber scenario, we have some queues with messages ready but not "consumed" by consumer.
The consumer seems to be up and running, the exchange and the queue are correctly linked.
Our queues and exchanges are not durable.
There are no warnings or errors in log file, how we can deeply debug that problem?
Someone else has a similar problem?

Regards
--
Andrea
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110812/08cc17ad/attachment.htm>

From simon at rabbitmq.com  Fri Aug 12 10:57:25 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 12 Aug 2011 10:57:25 +0100
Subject: [rabbitmq-discuss] rabbit-mq management plugin in windows
In-Reply-To: <b3285902-05dd-44a4-97fc-873daf412a3b@u6g2000prc.googlegroups.com>
References: <b3285902-05dd-44a4-97fc-873daf412a3b@u6g2000prc.googlegroups.com>
Message-ID: <4E44F905.8020208@rabbitmq.com>

On 11/08/11 23:41, Jeff Doolittle wrote:
> I found this thread: http://groups.google.com/group/rabbitmq-discuss/browse_thread/thread/e639a3efd6a6475e

So, just to be clear, I am going to assume:

* You are running RabbitMQ on Windows, as a service (Which version? Did 
you use the installer or install manually?)

* You have downloaded the .ez files which correspond to that version and 
put them in C:\Program Files\RabbitMQ\rabbitmq_server-<version>\plugins 
(or "plugins" inside the rabbitmq-server directory if you installed 
manually)

* You have run "rabbitmq-service.bat install"

* You have restarted the RabbitMQ service

> Still no luck.

And this means that you're getting "connection refused" from port 55672.

> Anyone know how to get this working?

Can you show us the contents of the log files and the output of 
"rabbitmq-service.bat install"?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From matthew at rabbitmq.com  Fri Aug 12 11:26:51 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 12 Aug 2011 11:26:51 +0100
Subject: [rabbitmq-discuss] RabbitMQ crashed in ets:insert_new - looks
 like a genuine bug...
In-Reply-To: <20110812080647.GA14591@wellquite.org>
References: <CANVKUrXr4vdzmcHB3-5XDFo4SwrPrA8Deo45zJHZ5uOMnMj-YQ@mail.gmail.com>
	<20110812080647.GA14591@wellquite.org>
Message-ID: <20110812102651.GB24946@rabbitmq.com>

Hi,

On Fri, Aug 12, 2011 at 09:06:48AM +0100, Matthew Sackman wrote:
> Which version of Rabbit is this and which version of Erlang, and on what
> platform?

Well I've figured out it's some form of Windows given the c:\ paths...

> >     exception exit: {badarg,
> >                         [{ets,insert_new,
> >                              [303172,
> 
> What that means is that there's been an attempt to insert into a non
> existant table. This normally suggests the msg_store has exited for
> other reasons and there are still queues trying to write to the
> msg_store's tables. This could indicate other bugs, but this itself is
> unlikely to be the root cause.

Indeed, and having tracked through your logs, I've found what caused the
msg_store to exit (when the msg_store exits, its tables, which are
publically used, die with it, which then cause all the queues to die
when they next try to use said tables):

=ERROR REPORT==== 11-Aug-2011::19:57:26 ===
** Generic server msg_store_persistent terminating
** Last message in was {'$gen_cast',
                           {sync,
                               [<<....>>],
                               #Fun<rabbit_variable_queue.11.110161290>}}
** When Server state == {msstate,
                            "c:/...../RabbitMQ/db/rabbit at RACK2UNIT004-mnesia/msg_store_persistent",
                            rabbit_msg_store_ets_index,
                            {state,348229,
                                "c:/...../RabbitMQ/db/rabbit at RACK2UNIT004-mnesia/msg_store_persistent"},
                            503,#Ref<0.0.2.67161>,
                            {dict,0,16,16,8,80,48,
                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                            [...SNIPS...]
** Reason for termination ==
** {{badmatch,not_found},
    [{rabbit_msg_store,'-handle_cast/2-fun-2-',4},
     {lists,any,2},
     {rabbit_msg_store,handle_cast,2},
     {gen_server2,handle_msg,2},
     {proc_lib,wake_up,3}]}

There is only one use of lists:any in the msg_store, and thus it's
fairly easy to work out what's happened: somehow, there's been an
attempt made to sync on disk a msg that turns out not to exist. This is,
unsurprisingly, an unexpected situation, hence the dramatic crash.

Could you provide details of:

1. What version of Windows, Erlang and Rabbit, you are using;
2. What are your clients doing when this occurs - it sounds like you're
doing stress tests: what exactly are these clients doing - if we can
reproduce this ourselves, it makes it _vastly_ easier to track it down
and fix it.
3. The above error entry was in your sasl log. If you could find the
corresponding entry in there in the non-anonymized log and send it to us
offlist, it may well have additional information that we would find
useful - if that's possible.

Best wishes,

Matthew

From emile at rabbitmq.com  Fri Aug 12 13:43:55 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 12 Aug 2011 13:43:55 +0100
Subject: [rabbitmq-discuss] Messages ready and not delivered
In-Reply-To: <8097A4E725D78E41A8B862ACE60E963945EF82E188@GVW1355EXB.americas.hpqcorp.net>
References: <8097A4E725D78E41A8B862ACE60E963945EF82E188@GVW1355EXB.americas.hpqcorp.net>
Message-ID: <4E45200B.4070907@rabbitmq.com>

Hi Andrea,

On 12/08/11 10:51, Rosa, Andrea wrote:
> We are facing we a strange issue in an publisher/subscriber scenario, we
> have some queues with messages ready but not ?consumed? by consumer.

Can you describe how to you are consuming the messages - are you using
synchronous (basic.get) or asynchronous (basic.consume) delivery?

Are you sure the queue contains messages? What does "rabbitmqctl
list_queues name messages_ready messages_unacknowledged consumers" return?


-Emile

From matthew at rabbitmq.com  Fri Aug 12 15:11:56 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 12 Aug 2011 15:11:56 +0100
Subject: [rabbitmq-discuss] RabbitMQ crashed in ets:insert_new - looks
 like a genuine bug...
In-Reply-To: <20110812102651.GB24946@rabbitmq.com>
References: <CANVKUrXr4vdzmcHB3-5XDFo4SwrPrA8Deo45zJHZ5uOMnMj-YQ@mail.gmail.com>
	<20110812080647.GA14591@wellquite.org>
	<20110812102651.GB24946@rabbitmq.com>
Message-ID: <20110812141156.GC24946@rabbitmq.com>

On Fri, Aug 12, 2011 at 11:26:51AM +0100, Matthew Sackman wrote:
> There is only one use of lists:any in the msg_store, and thus it's
> fairly easy to work out what's happened: somehow, there's been an
> attempt made to sync on disk a msg that turns out not to exist. This is,
> unsurprisingly, an unexpected situation, hence the dramatic crash.

I've now been able to reproduce it. For me, the following test causes
this:

%%%%%%%%%%%
-module(test).
-include_lib("amqp_client/include/amqp_client.hrl").

crash_tx() ->
    {ok, ConnDel} = amqp_connection:start(#amqp_params_network{}),
    {ok, ChanDel} = amqp_connection:open_channel(ConnDel),
    {ok, Conn} = amqp_connection:start(#amqp_params_network{}),
    TxChanCount = 200,
    TxChans = [begin
                   {ok, ChanPubTx} = amqp_connection:open_channel(Conn),
                   amqp_channel:call(ChanPubTx, #'tx.select'{}),
                   ChanPubTx
               end || _ <- lists:seq(1, TxChanCount)],
    amqp_channel:call(
      ChanDel, #'queue.declare' { queue = <<"q">>, durable = true }),
    Method = #'basic.publish'{ routing_key = <<"q">> },
    Content = #amqp_msg { props = #'P_basic'{ delivery_mode = 2 },
                          payload = <<0:8>> },
    Rounds = lists:seq(1, 5),
    PerRound = lists:seq(1, 1000),
    Parent = self(),
    PubPidTxs = [spawn(
                   fun () ->
                           [begin
                                io:format("~p: ~p~n", [self(), R]),
                                amqp_channel:call(ChanPubTx, #'tx.commit'{}),
                                [ok = amqp_channel:cast(ChanPubTx, Method, Content)
                                 || _ <- PerRound]
                            end || R <- Rounds],
                           Parent ! publish_done,
                           amqp_channel:call(ChanPubTx, #'tx.commit'{})
                   end) || ChanPubTx <- TxChans],
    receive
        publish_done ->
            io:format("Deleting queue...~n"),
            amqp_channel:call(ChanDel, #'queue.delete'{ queue = <<"q">> }),
            amqp_channel:close(ChanDel),
            [exit(PubPidTx, kill) || PubPidTx <- PubPidTxs],
            [amqp_channel:close(ChanPubTx) || ChanPubTx <- TxChans]
    end,
    amqp_connection:close(ConnDel),
    [receive publish_done -> ok end || _ <- tl(TxChans)],
    amqp_connection:close(Conn).
%%%%%%%%%%%%

It's a nasty little bug. Basically, we have all sorts of optimisations
in place to make sure that when a queue is deleted, even if it has lots
of outstanding work to do, the queue can be deleted quickly. This
basically amounts to promoting the delete up the list of things to do,
the idea being that it can overtake writes and removes and such that
obviously are now not worth doing considering that the queue is going to
be deleted.

It turns out that if in the list of things to do, you have a write, and
then a sync of that write, the write itself can be ignored owing to the
promoted deletion. But the sync doesn't get ignored, and so tries to
sync the msg to disk, but the msg isn't known about on disk because it's
been ignored, hence the not_found, hence the crash.

The good news is that all of that code has changed quite a lot since
2.5.1 and so I don't think this bug can happen if you run from default
(and consequently will be fixed in the next release). I think. I'll
continue checking through the code on default to be sure of this.

Well found!

Matthew

From ekirpichov at gmail.com  Fri Aug 12 16:20:15 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Fri, 12 Aug 2011 08:20:15 -0700
Subject: [rabbitmq-discuss] RabbitMQ performance tips,
 collected with sweat and blood
In-Reply-To: <20110812081310.GB14591@wellquite.org>
References: <CANVKUrXDQv1e-C3mkXeuY8y96yGecrSwzXOGgerGP7R_610m5w@mail.gmail.com>
	<20110812081310.GB14591@wellquite.org>
Message-ID: <CANVKUrUxsWfJNxNgOabAniiD8rmJYAEhj6Az5r1xcx+AjhqftQ@mail.gmail.com>

Hi,

On Fri, Aug 12, 2011 at 1:13 AM, Matthew Sackman <matthew at rabbitmq.com> wrote:
> On Thu, Aug 11, 2011 at 09:47:40PM -0700, Eugene Kirpichov wrote:
>> * Turn on prefetch. Large is good, small is better than nothing. You
>> can try a trick "reject a prefetched message if we didn't actually
>> need it for a few seconds/minutes". Consider prefetch individually for
>> each queue; e.g. it may be that you cannot turn it on for tasks, but
>> can for results.
>
> I don't know what you mean by prefetch. If you mean basic.qos then
> you're a little mistaken - basic.qos is a per channel thing, and not per
> consumer. Thus setting basic.qos affects every queue from which you're
> consuming within the same channel. Using basic.qos with non-zero values
> is known to have a fairly large negative impact on performance.
>
Yes, I meant channel indeed.
I'm surprised to hear about the negative effect; in my experiments the
positive effect was very large - basically it raised a local stress
test throughput from several thousand to several hundred thousand
messages per second; can you please clarify?

>> * Turn on autoAck
>
> autoAck and basic.qos are mutually exclusive.
That's good to know, too; thanks.

>
>> * In a cluster, always communicate with a queue only through the
>> broker that first declared it
>
> Why do you say that?
Because a queue physically exists on a single node, and accessing it
through a connection to another node causes indirect access and
traffic between the nodes; this is much slower.

>
>> * Avoid frequently doing these things, esp. on a cluster: establishing
>> a connection, BasicConsume, QueueDeclare etc. If you do them often
>> (dozens/hundreds of times per second), you're completely screwed. And
>> conversely, if you're completely screwed, the first place to look is
>> whether you're doing these things too frequently, and if you're not,
>> look again.
>
> Connection establishment certainly can be a little expensive but you
> should be able to do a few hundred a second fairly easily. Things that
> hit queues when those queues are already busy can take some time
> depending on the loading present on the queue. This is something we're
> aware of and are trying to figure out how to solve.
Yeah, I may be mistaken about connection establishment, so then the
blame is on QueueDeclare - an application of mine accidentally too
many reconnects and declares after each reconnect, and this led to all
sorts of horrible and unexplainable things.

>
>> * Increase erlang process limit
>
> We do that by default, but certainly for large installations raising
> that further may be necessary.
I started encountering this on Windows, RabbitMQ 2.5.1 when going up
from 4k consumers to 5k :)

>
>> * Split one queue into many, as a queue can only utilize 1 core -
>> across a cluster or not (either will give some benefit); publish in
>> roundrobin (between those sub-queues that aren't overloaded acc. to
>> publisher confirmations); consume all simultaneously.
>
> Yeah, the problem with that is that your message stream may require some
> sort of ordering guarantees and by publishing round-robin, you're going
> to lose that. For some use cases though, this can be an effective
> approach.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/

From ekirpichov at gmail.com  Fri Aug 12 16:38:18 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Fri, 12 Aug 2011 08:38:18 -0700
Subject: [rabbitmq-discuss] RabbitMQ crashed in ets:insert_new - looks
 like a genuine bug...
In-Reply-To: <20110812141156.GC24946@rabbitmq.com>
References: <CANVKUrXr4vdzmcHB3-5XDFo4SwrPrA8Deo45zJHZ5uOMnMj-YQ@mail.gmail.com>
	<20110812080647.GA14591@wellquite.org>
	<20110812102651.GB24946@rabbitmq.com>
	<20110812141156.GC24946@rabbitmq.com>
Message-ID: <CANVKUrWUzFZr=-H=zBBjypJKBzuOys0SEkAMdQSCXKfkGfEBRg@mail.gmail.com>

Hi Matthew,

Thanks a lot for taking the time for investigation.

Do you refer to reproducing the INTERNAL_ERROR bug in tx.commit (which
only happened once and didn't cause a node crash), or to the bug that
was causing the node crash (and happened on a different node of the
cluster)?

I'm using RabbitMQ 2.5.1, Erlang R14B02, on Windows indeed.

By the way, I ran the stress test with even more stress on the cluster
several times afterwards and wasn't able to cause it to crash again,
though before that 2 of 2 tests crashed. So I was "lucky" in a sense.

On Fri, Aug 12, 2011 at 7:11 AM, Matthew Sackman <matthew at rabbitmq.com> wrote:
> On Fri, Aug 12, 2011 at 11:26:51AM +0100, Matthew Sackman wrote:
>> There is only one use of lists:any in the msg_store, and thus it's
>> fairly easy to work out what's happened: somehow, there's been an
>> attempt made to sync on disk a msg that turns out not to exist. This is,
>> unsurprisingly, an unexpected situation, hence the dramatic crash.
>
> I've now been able to reproduce it. For me, the following test causes
> this:
>
> %%%%%%%%%%%
> -module(test).
> -include_lib("amqp_client/include/amqp_client.hrl").
>
> crash_tx() ->
> ? ?{ok, ConnDel} = amqp_connection:start(#amqp_params_network{}),
> ? ?{ok, ChanDel} = amqp_connection:open_channel(ConnDel),
> ? ?{ok, Conn} = amqp_connection:start(#amqp_params_network{}),
> ? ?TxChanCount = 200,
> ? ?TxChans = [begin
> ? ? ? ? ? ? ? ? ? {ok, ChanPubTx} = amqp_connection:open_channel(Conn),
> ? ? ? ? ? ? ? ? ? amqp_channel:call(ChanPubTx, #'tx.select'{}),
> ? ? ? ? ? ? ? ? ? ChanPubTx
> ? ? ? ? ? ? ? end || _ <- lists:seq(1, TxChanCount)],
> ? ?amqp_channel:call(
> ? ? ?ChanDel, #'queue.declare' { queue = <<"q">>, durable = true }),
> ? ?Method = #'basic.publish'{ routing_key = <<"q">> },
> ? ?Content = #amqp_msg { props = #'P_basic'{ delivery_mode = 2 },
> ? ? ? ? ? ? ? ? ? ? ? ? ?payload = <<0:8>> },
> ? ?Rounds = lists:seq(1, 5),
> ? ?PerRound = lists:seq(1, 1000),
> ? ?Parent = self(),
> ? ?PubPidTxs = [spawn(
> ? ? ? ? ? ? ? ? ? fun () ->
> ? ? ? ? ? ? ? ? ? ? ? ? ? [begin
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?io:format("~p: ~p~n", [self(), R]),
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?amqp_channel:call(ChanPubTx, #'tx.commit'{}),
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?[ok = amqp_channel:cast(ChanPubTx, Method, Content)
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? || _ <- PerRound]
> ? ? ? ? ? ? ? ? ? ? ? ? ? ?end || R <- Rounds],
> ? ? ? ? ? ? ? ? ? ? ? ? ? Parent ! publish_done,
> ? ? ? ? ? ? ? ? ? ? ? ? ? amqp_channel:call(ChanPubTx, #'tx.commit'{})
> ? ? ? ? ? ? ? ? ? end) || ChanPubTx <- TxChans],
> ? ?receive
> ? ? ? ?publish_done ->
> ? ? ? ? ? ?io:format("Deleting queue...~n"),
> ? ? ? ? ? ?amqp_channel:call(ChanDel, #'queue.delete'{ queue = <<"q">> }),
> ? ? ? ? ? ?amqp_channel:close(ChanDel),
> ? ? ? ? ? ?[exit(PubPidTx, kill) || PubPidTx <- PubPidTxs],
> ? ? ? ? ? ?[amqp_channel:close(ChanPubTx) || ChanPubTx <- TxChans]
> ? ?end,
> ? ?amqp_connection:close(ConnDel),
> ? ?[receive publish_done -> ok end || _ <- tl(TxChans)],
> ? ?amqp_connection:close(Conn).
> %%%%%%%%%%%%
>
> It's a nasty little bug. Basically, we have all sorts of optimisations
> in place to make sure that when a queue is deleted, even if it has lots
> of outstanding work to do, the queue can be deleted quickly. This
> basically amounts to promoting the delete up the list of things to do,
> the idea being that it can overtake writes and removes and such that
> obviously are now not worth doing considering that the queue is going to
> be deleted.
>
> It turns out that if in the list of things to do, you have a write, and
> then a sync of that write, the write itself can be ignored owing to the
> promoted deletion. But the sync doesn't get ignored, and so tries to
> sync the msg to disk, but the msg isn't known about on disk because it's
> been ignored, hence the not_found, hence the crash.
>
> The good news is that all of that code has changed quite a lot since
> 2.5.1 and so I don't think this bug can happen if you run from default
> (and consequently will be fixed in the next release). I think. I'll
> continue checking through the code on default to be sure of this.
>
> Well found!
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/

From matthew at rabbitmq.com  Fri Aug 12 16:47:26 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 12 Aug 2011 16:47:26 +0100
Subject: [rabbitmq-discuss] RabbitMQ crashed in ets:insert_new - looks
 like a genuine bug...
In-Reply-To: <CANVKUrWUzFZr=-H=zBBjypJKBzuOys0SEkAMdQSCXKfkGfEBRg@mail.gmail.com>
References: <CANVKUrXr4vdzmcHB3-5XDFo4SwrPrA8Deo45zJHZ5uOMnMj-YQ@mail.gmail.com>
	<20110812080647.GA14591@wellquite.org>
	<20110812102651.GB24946@rabbitmq.com>
	<20110812141156.GC24946@rabbitmq.com>
	<CANVKUrWUzFZr=-H=zBBjypJKBzuOys0SEkAMdQSCXKfkGfEBRg@mail.gmail.com>
Message-ID: <20110812154726.GD24946@rabbitmq.com>

Hi Eugene,

On Fri, Aug 12, 2011 at 08:38:18AM -0700, Eugene Kirpichov wrote:
> Thanks a lot for taking the time for investigation.

No problem. I rather enjoy trying to track down such bugs.

> Do you refer to reproducing the INTERNAL_ERROR bug in tx.commit (which
> only happened once and didn't cause a node crash), or to the bug that
> was causing the node crash (and happened on a different node of the
> cluster)?

Well, a msg_store on a node crashed when one of the queues that was
using it was deleted. The crash of said msg_store subsequently took out
all other queues that were using that msg_store. The loss of those
queues would have caused all in-flight tx.commits to abort with an
INTERNAL_ERROR.

So I strongly suspect they're all one and the same thing.

> By the way, I ran the stress test with even more stress on the cluster
> several times afterwards and wasn't able to cause it to crash again,
> though before that 2 of 2 tests crashed. So I was "lucky" in a sense.

All the best bugs have this property :D

Matthew

From ekirpichov at gmail.com  Fri Aug 12 16:49:34 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Fri, 12 Aug 2011 08:49:34 -0700
Subject: [rabbitmq-discuss] RabbitMQ crashed in ets:insert_new - looks
 like a genuine bug...
In-Reply-To: <20110812154726.GD24946@rabbitmq.com>
References: <CANVKUrXr4vdzmcHB3-5XDFo4SwrPrA8Deo45zJHZ5uOMnMj-YQ@mail.gmail.com>
	<20110812080647.GA14591@wellquite.org>
	<20110812102651.GB24946@rabbitmq.com>
	<20110812141156.GC24946@rabbitmq.com>
	<CANVKUrWUzFZr=-H=zBBjypJKBzuOys0SEkAMdQSCXKfkGfEBRg@mail.gmail.com>
	<20110812154726.GD24946@rabbitmq.com>
Message-ID: <CANVKUrUAxod=AFenwJxYx5g5ho50HyF5Gd-6Q_5Xk1ahUWuDQQ@mail.gmail.com>

Hi,

On Fri, Aug 12, 2011 at 8:47 AM, Matthew Sackman <matthew at rabbitmq.com> wrote:
> Hi Eugene,
>
> On Fri, Aug 12, 2011 at 08:38:18AM -0700, Eugene Kirpichov wrote:
>> Thanks a lot for taking the time for investigation.
>
> No problem. I rather enjoy trying to track down such bugs.
>
>> Do you refer to reproducing the INTERNAL_ERROR bug in tx.commit (which
>> only happened once and didn't cause a node crash), or to the bug that
>> was causing the node crash (and happened on a different node of the
>> cluster)?
>
> Well, a msg_store on a node crashed when one of the queues that was
> using it was deleted. The crash of said msg_store subsequently took out
> all other queues that were using that msg_store. The loss of those
> queues would have caused all in-flight tx.commits to abort with an
> INTERNAL_ERROR.
>
> So I strongly suspect they're all one and the same thing.
The issue is that these errors happened on *different* nodes. Do you
think they still should be part of the same story?

>
>> By the way, I ran the stress test with even more stress on the cluster
>> several times afterwards and wasn't able to cause it to crash again,
>> though before that 2 of 2 tests crashed. So I was "lucky" in a sense.
>
> All the best bugs have this property :D
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/

From matthew at rabbitmq.com  Fri Aug 12 16:55:43 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 12 Aug 2011 16:55:43 +0100
Subject: [rabbitmq-discuss] RabbitMQ crashed in ets:insert_new - looks
 like a genuine bug...
In-Reply-To: <CANVKUrUAxod=AFenwJxYx5g5ho50HyF5Gd-6Q_5Xk1ahUWuDQQ@mail.gmail.com>
References: <CANVKUrXr4vdzmcHB3-5XDFo4SwrPrA8Deo45zJHZ5uOMnMj-YQ@mail.gmail.com>
	<20110812080647.GA14591@wellquite.org>
	<20110812102651.GB24946@rabbitmq.com>
	<20110812141156.GC24946@rabbitmq.com>
	<CANVKUrWUzFZr=-H=zBBjypJKBzuOys0SEkAMdQSCXKfkGfEBRg@mail.gmail.com>
	<20110812154726.GD24946@rabbitmq.com>
	<CANVKUrUAxod=AFenwJxYx5g5ho50HyF5Gd-6Q_5Xk1ahUWuDQQ@mail.gmail.com>
Message-ID: <20110812155543.GE24946@rabbitmq.com>

On Fri, Aug 12, 2011 at 08:49:34AM -0700, Eugene Kirpichov wrote:
> The issue is that these errors happened on *different* nodes. Do you
> think they still should be part of the same story?

Yup. If a channel on node A is trying to commit to a queue on node B,
and that queue fails, then certainly the channel on node A can report
internal errors.

Matthew

From ekirpichov at gmail.com  Fri Aug 12 17:02:38 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Fri, 12 Aug 2011 09:02:38 -0700
Subject: [rabbitmq-discuss] RabbitMQ crashed in ets:insert_new - looks
 like a genuine bug...
In-Reply-To: <20110812155543.GE24946@rabbitmq.com>
References: <CANVKUrXr4vdzmcHB3-5XDFo4SwrPrA8Deo45zJHZ5uOMnMj-YQ@mail.gmail.com>
	<20110812080647.GA14591@wellquite.org>
	<20110812102651.GB24946@rabbitmq.com>
	<20110812141156.GC24946@rabbitmq.com>
	<CANVKUrWUzFZr=-H=zBBjypJKBzuOys0SEkAMdQSCXKfkGfEBRg@mail.gmail.com>
	<20110812154726.GD24946@rabbitmq.com>
	<CANVKUrUAxod=AFenwJxYx5g5ho50HyF5Gd-6Q_5Xk1ahUWuDQQ@mail.gmail.com>
	<20110812155543.GE24946@rabbitmq.com>
Message-ID: <CANVKUrVjSOE8iNCW523dbRmmFmq-KOFBmW2HRCjTK3H4kvdgyw@mail.gmail.com>

I am not sure that was the case, I think the queue to which node A was
committing was also on node A.

However, the fact that the messages on different nodes happened within
an interval of 2s (which could well be explained by out-of-sync
clocks) hints that perhaps I'm mistaken (maybe this queue was declared
by someone connected to B and ended up on node B, even though I
intended it to be on A) or that there's something else going on.

On Fri, Aug 12, 2011 at 8:55 AM, Matthew Sackman <matthew at rabbitmq.com> wrote:
> On Fri, Aug 12, 2011 at 08:49:34AM -0700, Eugene Kirpichov wrote:
>> The issue is that these errors happened on *different* nodes. Do you
>> think they still should be part of the same story?
>
> Yup. If a channel on node A is trying to commit to a queue on node B,
> and that queue fails, then certainly the channel on node A can report
> internal errors.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/

From andrea.rosa at hp.com  Fri Aug 12 17:04:50 2011
From: andrea.rosa at hp.com (Rosa, Andrea)
Date: Fri, 12 Aug 2011 17:04:50 +0100
Subject: [rabbitmq-discuss] Messages ready and not delivered
In-Reply-To: <4E45200B.4070907@rabbitmq.com>
References: <8097A4E725D78E41A8B862ACE60E963945EF82E188@GVW1355EXB.americas.hpqcorp.net>
	<4E45200B.4070907@rabbitmq.com>
Message-ID: <8097A4E725D78E41A8B862ACE60E963945EF82E292@GVW1355EXB.americas.hpqcorp.net>

> Hi Andrea,
> 
> On 12/08/11 10:51, Rosa, Andrea wrote:
> > We are facing we a strange issue in an publisher/subscriber scenario,
> we
> > have some queues with messages ready but not "consumed" by consumer.
> 
> Can you describe how to you are consuming the messages - are you using
> synchronous (basic.get) or asynchronous (basic.consume) delivery?

We have asynchronous delivery.

> 
> Are you sure the queue contains messages? What does "rabbitmqctl
> list_queues name messages_ready messages_unacknowledged consumers"
> return?
The unack messages is equal to 0 but there are some ready messages in the queues 

> 
> 
> -Emile
--
Andrea

From emile at rabbitmq.com  Fri Aug 12 17:18:38 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 12 Aug 2011 17:18:38 +0100
Subject: [rabbitmq-discuss] Messages ready and not delivered
In-Reply-To: <8097A4E725D78E41A8B862ACE60E963945EF82E292@GVW1355EXB.americas.hpqcorp.net>
References: <8097A4E725D78E41A8B862ACE60E963945EF82E188@GVW1355EXB.americas.hpqcorp.net>
	<4E45200B.4070907@rabbitmq.com>
	<8097A4E725D78E41A8B862ACE60E963945EF82E292@GVW1355EXB.americas.hpqcorp.net>
Message-ID: <4E45525E.5020904@rabbitmq.com>

Hi Andrea,

On 12/08/11 17:04, Rosa, Andrea wrote:

>> Are you sure the queue contains messages? What does "rabbitmqctl
>> list_queues name messages_ready messages_unacknowledged consumers"
>> return?
> The unack messages is equal to 0 but there are some ready messages in the queues 

And the last "consumers" column? How many consumers does the broker
think are subscribed? If the client receives messages asynchronously
then the number should be 1 or greater.

Something else to check is whether the consumer has asserted channel
flow. That will prevent the broker from delivering messages on the
channel. You can confirm this with
"rabbitmqctl list_channels client_flow_blocked"


-Emile

From majek04 at gmail.com  Fri Aug 12 17:38:12 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 12 Aug 2011 17:38:12 +0100
Subject: [rabbitmq-discuss] Issues starting RabbitMQ 2.5.1 on Ubuntu
	10.04
In-Reply-To: <32248034.post@talk.nabble.com>
References: <32219482.post@talk.nabble.com> <32232090.post@talk.nabble.com>
	<CABzX+qzHS9+Ve49-T+=XpSfCK=2GmF-MwiH_U1Foka8=QyFU3w@mail.gmail.com>
	<32243347.post@talk.nabble.com>
	<CABzX+qyRG3Ws045s9YqTZm+dTvDp4BfH9F2_Lq4Amikd4bvCWw@mail.gmail.com>
	<32248034.post@talk.nabble.com>
Message-ID: <CABzX+qyZSczjss8w7KishJ=fjfpAgj_MRvzxhC77OxR-cqhToA@mail.gmail.com>

On Fri, Aug 12, 2011 at 09:36, TreforT <trefor at tetrabyte.com> wrote:
> I can not find any folder called "pam" but I have found "/etc/pam.d" but
> limits.conf inside it.
>
> I did find "/etc/security/limits.conf" which looks as though everything is
> 'hashed' out.

Good.

> I am running Ubuntu on a 1and1 Virtual Server (which has given me trouble
> trying to change the name of the machine, which has eventually been done via
> a script when i first start the machine up).
>
> How would i test to see if rabbitmq was using the same version on Erlang?

well, you may just run 'erl' and see what it says.

> when I run "ulimit -a" i get:
>
> core file size          (blocks, -c) 0
> data seg size           (kbytes, -d) unlimited
> scheduling priority             (-e) 20
> file size               (blocks, -f) unlimited
> pending signals                 (-i) 16382
> max locked memory       (kbytes, -l) 64
> max memory size         (kbytes, -m) unlimited
> open files                      (-n) 1024
> pipe size            (512 bytes, -p) 8
> POSIX message queues     (bytes, -q) 819200
> real-time priority              (-r) 0
> stack size              (kbytes, -s) 8192
> cpu time               (seconds, -t) unlimited
> max user processes              (-u) unlimited
> virtual memory          (kbytes, -v) unlimited
> file locks                      (-x) unlimited

Looks normal.

> I have got a 'vanilla' install of Ubuntu in the office (which I plan on
> clustering with the one im having issue with) and have no problems with
> RabbitMQ on that machine.

Good. That means your particular 1und1 instance is somewhat different.
I'm not able to help much more. It may be something with erlang
(maybe a broken compliation?), it may be something with limits.

I'm afraid you have to figure out the anomaly yourself, in theory it
could be just anything. It doesn't look like a rabbit problem, more
likely an operating system or erlang issue.

Cheers,
  Marek

From jasonjwwilliams at gmail.com  Fri Aug 12 18:15:03 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Fri, 12 Aug 2011 11:15:03 -0600
Subject: [rabbitmq-discuss] API aliveness test
In-Reply-To: <4E44F6F6.1080002@rabbitmq.com>
References: <CAHZAEpdhqxLmiLYhrGj1WK6gMdGDWVorrRNf5T-2fro=mUv1cw@mail.gmail.com>
	<4E44F6F6.1080002@rabbitmq.com>
Message-ID: <CAHZAEpcRj=ROPWEX0Fg7+=OXWOvTEQBkTdZdKq2KAwqyo0=fXA@mail.gmail.com>

Hey Simon,

> Actually, you could ignore the body and just check the HTTP status code, it
> won't return 200 OK unless things are good.

That's good to know. It's what we ended up doing on the hope you'd say
that. :) Thank you for the help.

-J

From andrea.rosa at hp.com  Fri Aug 12 18:45:48 2011
From: andrea.rosa at hp.com (Rosa, Andrea)
Date: Fri, 12 Aug 2011 18:45:48 +0100
Subject: [rabbitmq-discuss] Messages ready and not delivered
In-Reply-To: <4E45525E.5020904@rabbitmq.com>
References: <8097A4E725D78E41A8B862ACE60E963945EF82E188@GVW1355EXB.americas.hpqcorp.net>
	<4E45200B.4070907@rabbitmq.com>
	<8097A4E725D78E41A8B862ACE60E963945EF82E292@GVW1355EXB.americas.hpqcorp.net>
	<4E45525E.5020904@rabbitmq.com>
Message-ID: <8097A4E725D78E41A8B862ACE60E963945EF82E29C@GVW1355EXB.americas.hpqcorp.net>

> Hi Andrea,
> 
> On 12/08/11 17:04, Rosa, Andrea wrote:
> 
> >> Are you sure the queue contains messages? What does "rabbitmqctl
> >> list_queues name messages_ready messages_unacknowledged consumers"
> >> return?
> > The unack messages is equal to 0 but there are some ready messages in
> the queues
> 
> And the last "consumers" column? How many consumers does the broker
> think are subscribed? If the client receives messages asynchronously
> then the number should be 1 or greater.

Ok I verified that the consumers number is equal to 0 so I guess that the problem is not
rabbitmq but with our consumers that for some reasons lose the connection
and don't manage properly the reconnection with the server.

> 
> Something else to check is whether the consumer has asserted channel
> flow. That will prevent the broker from delivering messages on the
> channel. You can confirm this with
> "rabbitmqctl list_channels client_flow_blocked"
For that the value is False
> 
> 
> -Emile
Thanks for your help
--
andrea

From james.r.carr at gmail.com  Fri Aug 12 19:02:17 2011
From: james.r.carr at gmail.com (James Carr)
Date: Fri, 12 Aug 2011 13:02:17 -0500
Subject: [rabbitmq-discuss] Load Balanced Consumers?
Message-ID: <CAJreXKCosAv6jYfJ57YZ4pjLNWnioaHB6Y08n83V_DEzuak4UA@mail.gmail.com>

Hi All,

In all the material I've read on clustering and load balancing the
setup I always see is publishers publishing through a load balancer
while consumers consume all the nodes on the cluster.

Is it possible to place the consumers behind a load balancer? I'm just
asking, we plan on trying it on Monday with our cluster at work. The
setup we're thinking of is one balancer for publishers, two for
consumers (which consumers will consume on both) and divide the
cluster into segments that the consumer balancers forward to.

Is this an ideal solution? The only problem comes when the nodes that
both connect to go down at the same time but I am putting money on
that not happening. We'll see. :)

Thanks,
James

From aaron at agoragames.com  Fri Aug 12 19:27:25 2011
From: aaron at agoragames.com (Aaron Westendorf)
Date: Fri, 12 Aug 2011 14:27:25 -0400
Subject: [rabbitmq-discuss] major failure when clearing large queue backlog
Message-ID: <CAHiEoM7fqpZvnmmMegRVDob7rNMmP74o=gKEWU77Zg0xP=GJvQ@mail.gmail.com>

We've put two new rabbit 2.5 hosts into production at the same time as we
performed some other major upgrades to our software on 9 August. As
designed, our messages queued up in rabbit, and we slowly consumed them.
When the queues were empty, rabbit blew up and took out both hosts in the
cluster.

Hosts:
2 x 12 core AMD Opteron 6172
8GB ram

The situation here is that we had lots of requests, 1-2k/sec, coming in on
one host, routed to the queues on the second, to which there was connected a
pool of consumers. For a variety of reasons, that pool of consumers was
smaller than we wanted and we had trouble increasing the count. The first
incident occurred after the backlog reported by rabbit reached over 700k;
the second peak below 300k. Message size ranged from 2-20k.

In both cases, both rabbit hosts started spooling to disk as free memory
dropped. We do not use qos, and so our consumers also had significant memory
allocated to frames on their input queues. Eventually, we were able to spawn
enough consumers to slowly drain the queues. At the rate messages were
arriving, this took awhile, but everything stayed within spec.

Shortly after the queues drained, rabbit became completely unresponsive. Our
`watch` process to list_queues and check on the state stopped running. We
observed heavy swap churn via kswapd[0-9]+. It appeared that rabbit was
trying to load in all of the data that it had paged to disk.  I've attached
graphs that show when this event occurred, but they're the weekly rollups so
it's hidden in the noise. The "max" column is the best record of the limits
that were hit, especially the "committed" value which is significantly
higher than the 8GB of RAM available.

-Aaron


-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110812/5cff119f/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: load-week.png
Type: image/png
Size: 16202 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110812/5cff119f/attachment.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: memory-week.png
Type: image/png
Size: 29857 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110812/5cff119f/attachment-0001.png>

From danbarua at gmail.com  Sun Aug 14 22:26:35 2011
From: danbarua at gmail.com (Dan B)
Date: Sun, 14 Aug 2011 14:26:35 -0700 (PDT)
Subject: [rabbitmq-discuss] facing issues with the SSL implementations
 with RabbitMQ + Windows + .Net
In-Reply-To: <20110811141557.GE3139@dakota.eng.vmware.com>
References: <4E411AB4.30706@kiprosh.com>
	<20110809115033.GF3214@dakota.eng.vmware.com>
	<4E412192.5080107@kiprosh.com>
	<20110809120926.GA28785@dakota.eng.vmware.com>
	<4E412A3B.60602@kiprosh.com>
	<20110809124819.GB28785@dakota.eng.vmware.com>
	<4E412D87.2080806@kiprosh.com>
	<20110809141913.GD28785@dakota.eng.vmware.com>
	<4E4143F3.6030804@kiprosh.com>
	<25562804.1753.1313070633628.JavaMail.geo-discussion-forums@yqaz21>
	<20110811141557.GE3139@dakota.eng.vmware.com>
Message-ID: <8189264.2105.1313357195664.JavaMail.geo-discussion-forums@yqaz21>

Hi,

I was planning on using the server as a CA for client certificates.

The cacertfile isn't so essential - the thing that got me bashing my head 
against the wall for so long was the specific format of the certificate 
files.

-Dan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110814/67d4e832/attachment.htm>

From james.r.carr at gmail.com  Sun Aug 14 23:40:56 2011
From: james.r.carr at gmail.com (James Carr)
Date: Sun, 14 Aug 2011 17:40:56 -0500
Subject: [rabbitmq-discuss] Load Balanced Consumers?
In-Reply-To: <CAJreXKCosAv6jYfJ57YZ4pjLNWnioaHB6Y08n83V_DEzuak4UA@mail.gmail.com>
References: <CAJreXKCosAv6jYfJ57YZ4pjLNWnioaHB6Y08n83V_DEzuak4UA@mail.gmail.com>
Message-ID: <CAJreXKCZ3s+2cUw8MZ7fTgX-HcnOv0-M=vEowHixa6knS0+v-w@mail.gmail.com>

I actually observed some odd behavior on this setup Friday. I began
publishing through the load balancer (which load balanced to node1 and
node2) while I fired up a consumer that was connected to the same
queue on node1 and node2. I got messages from both nodes in the
consumer and decided to take one node off the cluster to see what
happened. It appears that when I brought one node down the other node
was also taken down and didn't return until I brought the other node
back up. I also couldn't stop nodes using rabbitmqctl stop_app as it
never completed and I resorted to a hard stop (killing the rabbitmq
process).

I'm going to experiment more tomorrow, but so far it seems that I
cannot have a cluster running reliably when messages are being
published. I'll provide more details as I get them (I'm betting I did
something moronic configuring the cluster, boo).

Thanks,
James


On Fri, Aug 12, 2011 at 1:02 PM, James Carr <james.r.carr at gmail.com> wrote:
> Hi All,
>
> In all the material I've read on clustering and load balancing the
> setup I always see is publishers publishing through a load balancer
> while consumers consume all the nodes on the cluster.
>
> Is it possible to place the consumers behind a load balancer? I'm just
> asking, we plan on trying it on Monday with our cluster at work. The
> setup we're thinking of is one balancer for publishers, two for
> consumers (which consumers will consume on both) and divide the
> cluster into segments that the consumer balancers forward to.
>
> Is this an ideal solution? The only problem comes when the nodes that
> both connect to go down at the same time but I am putting money on
> that not happening. We'll see. :)
>
> Thanks,
> James
>

From ludy at wawame.cn  Mon Aug 15 09:57:14 2011
From: ludy at wawame.cn (ludy)
Date: Mon, 15 Aug 2011 16:57:14 +0800
Subject: [rabbitmq-discuss] problem for a cluster
In-Reply-To: <074308A4-5D42-4F01-8E85-B2853465E4DB@gmail.com>
References: <1312517095.2479.12.camel@ludy-linux>
	<074308A4-5D42-4F01-8E85-B2853465E4DB@gmail.com>
Message-ID: <1313398634.3426.7.camel@ludy-linux>

all clients connect to node rabbit,i want that the socket descriptors of
the node rabbit  is full,then clients can redirect to node hare???How to
do this???
On ?, 2011-08-05 at 11:24 +0400, Eugene Kirpichov wrote:
> Maybe because your clients request a connection to rabbit, not hare? Rabbitmq doesn't do connection redirection, you have to loadbalance manually.
> 
> 
> 
> 05.08.2011, ? 8:04, ludy <ludy at wawame.cn> ???????(?):
> 
> > i created a cluster of two nodes,one is named rabbit,another is named
> > hare.if count of connections from clients is greater than socket
> > descriptors of a node ,then the socket descriptors of node rabbit is
> > full,is 829/829,my question is that why the socket descriptors of
> > another node hare is still 1/829 ,why not increased ?????
> > 
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



From richard.hudson at paragon.co.nz  Mon Aug 15 00:26:32 2011
From: richard.hudson at paragon.co.nz (Richard Hudson)
Date: Mon, 15 Aug 2011 11:26:32 +1200
Subject: [rabbitmq-discuss] Problems starting RabbitMQ as a windows service.
Message-ID: <CA+Vi8LC4S4_xGkoYR54vEy5DztrznhscU4y1uYyp-sJLCS2_3g@mail.gmail.com>

Hi,

We've recently moved over to using RabbitMQ from MSMQ and have generally had
success in running RabbitMQ as a windows service on a number of different
OSes (XP, Windows2003, Windows 7).

However, we've come across a strange problem when starting up a rabbitMQ
service on Windows 2003 SP2 on a VM, using RabbitMQ 2.51 and Erlang 5.8.4.
Not sure if the VM aspect is relevant.

Using the rabbitmq-service.bat to install the service, the service (running
under the local system account) starts and stops pretty much straight away.
Here's the output from rabbitMQ.debug
-- rabbit boot start
starting file handle cache server
...done
starting worker pool
...done
starting database
...done
starting codec correctness check
...done
-- external infrastructure ready
starting statistics event manager
...done
starting logging server
...done
starting plugin registry
...done
starting auth mechanism amqplain
...done
starting auth mechanism cr-demo
...done
starting auth mechanism plain
...done
starting exchange type direct
...done
starting exchange type fanout
...done
starting exchange type headers
...done
starting exchange type topic
...done
-- kernel ready
starting node monitor
...done
starting cluster delegate
...done
starting guid generator
...done
starting alarm handler
...done
starting memory monitor
...done
-- core initialized
starting empty DB check
...done
starting exchange, queue and binding recovery
...done
-- message delivery logic ready
starting error log relay
...done
starting networking
...BOOT ERROR: FAILED
Reason: {badmatch,
            {error,
                {shutdown,
                    {child,undefined,'rabbit_tcp_listener_sup_0.0.0.0:5672',
                        {tcp_listener_sup,start_link,
                            [{0,0,0,0},
                             5672,
                             [inet,binary,
                              {packet,raw},
                              {reuseaddr,true},
                              {backlog,128},
                              {nodelay,true},
                              {exit_on_close,false}],

{rabbit_networking,tcp_listener_started,[amqp]},

{rabbit_networking,tcp_listener_stopped,[amqp]},
                             {rabbit_networking,start_client,[]},
                             "TCP Listener"]},
                        transient,infinity,supervisor,
                        [tcp_listener_sup]}}}}
Stacktrace: [{rabbit_networking,start_listener0,4},
             {rabbit_networking,'-start_listener/4-lc$^0/1-0-',4},
             {rabbit_networking,start_listener,4},
             {rabbit_networking,'-boot_tcp/0-lc$^0/1-0-',1},
             {rabbit_networking,boot_tcp,0},
             {rabbit_networking,boot,0},
             {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
             {rabbit,run_boot_step,1}]
in message_loop
win32sysinfo:Erlang has closed.Eshell V5.8.4  (abort with ^G)
(rabbit at UKFAST-QOB4QITU)1> {"Kernel pid
terminated",application_controller,"{application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}}"}

The port is definitely not in use. Nor is there a firewall enabled.

Having looked though the archives we've tried passing in sname and name
arguments to erl.exe with no luck.

The interesting thing is that we can get RabbitMQ to run as an application
on this box, using the standard rabbitmq-server.bat.

After a bit of messing around we also found that if we set
HKEY_LOCAL_MACHINE\SOFTWARE\Ericsson\Erlang\ErlSrv\1.1\RabbitMQ\Machine
to point to D:\Program Files\erl5.8.4\bin\erl.exe rather than D:\Program
Files\erl5.8.4\erts-5.8.4\bin\erl.exe then the service also runs. Queues get
created and we can successfully publish/subscribe to queues .

Does anyone have any thoughts on why the standard service install would fail
but the application and modified install seem to work fine.

How safe is it to use erl.exe from erl5.8.4\bin\erl.exe rather than
erl5.8.4\erts-5.8.4\bin\erl.exe?
i.e is this an acceptable workaround.

Thanks in advance for any help.

Regards

Richard
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110815/90cb0e8c/attachment.htm>

From trefor at tetrabyte.com  Mon Aug 15 10:03:15 2011
From: trefor at tetrabyte.com (TreforT)
Date: Mon, 15 Aug 2011 02:03:15 -0700 (PDT)
Subject: [rabbitmq-discuss] Issues starting RabbitMQ 2.5.1 on Ubuntu
 10.04
In-Reply-To: <CABzX+qyZSczjss8w7KishJ=fjfpAgj_MRvzxhC77OxR-cqhToA@mail.gmail.com>
References: <32219482.post@talk.nabble.com> <32232090.post@talk.nabble.com>
	<CABzX+qzHS9+Ve49-T+=XpSfCK=2GmF-MwiH_U1Foka8=QyFU3w@mail.gmail.com>
	<32243347.post@talk.nabble.com>
	<CABzX+qyRG3Ws045s9YqTZm+dTvDp4BfH9F2_Lq4Amikd4bvCWw@mail.gmail.com>
	<32248034.post@talk.nabble.com>
	<CABzX+qyZSczjss8w7KishJ=fjfpAgj_MRvzxhC77OxR-cqhToA@mail.gmail.com>
Message-ID: <32263012.post@talk.nabble.com>


Hi Marek,

I have run 'erl' and I get:

Erlang R14B03 (erts-5.8.4) [source] [64-bit] [smp:8:8] [rq:8]
[async-threads:0] [kernel-poll:false]

Eshell V5.8.4  (abort with ^G)
1>

I had a feeling is was going to be OS related, but I just didn't know where
to look to see what I would need to do to change the relevant thing so that
I could get it working.

Thanks for all your help. 

If anyone else has any ideas as to where I could look, please let me know

Regards,
Trefor

Marek Majkowski wrote:
> 
> On Fri, Aug 12, 2011 at 09:36, TreforT <trefor at tetrabyte.com> wrote:
> 
> Good. That means your particular 1und1 instance is somewhat different.
> I'm not able to help much more. It may be something with erlang
> (maybe a broken compliation?), it may be something with limits.
> 
> I'm afraid you have to figure out the anomaly yourself, in theory it
> could be just anything. It doesn't look like a rabbit problem, more
> likely an operating system or erlang issue.
> 
> Cheers,
>   Marek
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://old.nabble.com/Issues-starting-RabbitMQ-2.5.1-on-Ubuntu-10.04-tp32219482p32263012.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From david_syer at hotmail.com  Mon Aug 15 10:18:30 2011
From: david_syer at hotmail.com (Dave Syer)
Date: Mon, 15 Aug 2011 02:18:30 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ and Spring
In-Reply-To: <27D6B27DB616654BBEF4DDB8B31EAF916B590E952B@vs-msx01.IT-NG.local>
References: <27D6B27DB616654BBEF4DDB8B31EAF916B590E9526@vs-msx01.IT-NG.local>
	<468ecd19-1a84-4b35-934c-b16a1c36c30e@e35g2000yqc.googlegroups.com>
	<27D6B27DB616654BBEF4DDB8B31EAF916B590E9527@vs-msx01.IT-NG.local>
	<88bbe583-fa6e-4474-9e91-5316463ce721@o26g2000vbi.googlegroups.com>
	<27D6B27DB616654BBEF4DDB8B31EAF916B590E9528@vs-msx01.IT-NG.local>
	<4E3BB377.2040204@rabbitmq.com>
	<27D6B27DB616654BBEF4DDB8B31EAF916B590E952B@vs-msx01.IT-NG.local>
Message-ID: <32263108.post@talk.nabble.com>




Arno Puschmann wrote:
> 
> But i can't explain why i get always null as a response.
> 
> template.setExchange("exchange"); //direct and durable
> template.setQueue("someQueue");
> template.setRoutingKey("someQueue");
> Message response = template.sendAndReceive("exchange", "anotherQueue" ,
> message); 
> 

I think you need to get down to basics with what the RabbitTemplate is doing
behind the scenes here.  Your expectations do not seem to match the
implementation.

In this code snippet, you first set the default exchange for sending
messages, and then use an explicit value in your call to sendAndReceive(),
so the first line is redundant.

In the third line you set the default routing key, and then don't use it, so
that line is redundant.

The second line does nothing because that sets the default queue for
receive() calls, which is not used by sendAndReceive().

So you have sent a message to an exchange called "exchange" with routing key
"anotherQueue".  The message will have a reply-to header added by the
template which your consumer should respect.  If the consumer replies to the
correct address (it will be a temporary exclusive queue) then you will
receive the reply in your response variable.

I know the javadocs for RabbitTemplate are pretty thin.  You can read the
source code to work out all of the above, but please feel free to raise a
JIRA ticket to get the docs improved as well.  Thank you.
-- 
View this message in context: http://old.nabble.com/RabbitMQ-and-Spring-tp32137903p32263108.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From simon at rabbitmq.com  Mon Aug 15 11:37:45 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 15 Aug 2011 11:37:45 +0100
Subject: [rabbitmq-discuss] Beginners issue - How to run JSON RPC Chat
 Example
In-Reply-To: <8327141.1213.1312541290571.JavaMail.geo-discussion-forums@yqbp37>
References: <8327141.1213.1312541290571.JavaMail.geo-discussion-forums@yqbp37>
Message-ID: <4E48F6F9.8060300@rabbitmq.com>

Hi Juliette.

On 05/08/11 11:48, Juliette wrote:
> I am trying to run JSON RPC chat example (from the source code) with my
> RabbitMQ server installed on the same machine.
> But the channel opening don't work (a JSONError is thrown by the
> receiveReply function (in jsonrpc.js)).
>
> I have set in rabbitmq.js :
> - factoryServiceUrl: "http://localhost:55670/rpc/rabbitmq"
> - rpcServiceUrlBase: "http://localhost:55670/rpc/"
>
> What must I do to get this working ?
> Have I set the right parameters ?
> Which port must you listen to normally ?

That looks reasonable. If you're seeing a JSONError in receiveReply then 
the server is sending back some non-json response. If you don't mind 
sticking

     alert("receive " + ajaxRequest.responseText);

in there that would give a clue (hmm, maybe this should be logged...)

The most likely way in which the server could be sending a non-JSON 
response is if you haven't installed all the prerequisites into 
RabbitMQ. http://localhost:55670/ should show a generic list page like this:

RabbitMQ Web Server
Contexts available:
* rpc
* rabbitmq_lib

If you don't see that then check everything's installed.

Cheers, Simon
-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Mon Aug 15 13:46:53 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 15 Aug 2011 13:46:53 +0100
Subject: [rabbitmq-discuss] Problems starting RabbitMQ as a windows
	service.
In-Reply-To: <CA+Vi8LC4S4_xGkoYR54vEy5DztrznhscU4y1uYyp-sJLCS2_3g@mail.gmail.com>
References: <CA+Vi8LC4S4_xGkoYR54vEy5DztrznhscU4y1uYyp-sJLCS2_3g@mail.gmail.com>
Message-ID: <4E49153D.2050204@rabbitmq.com>

Hi Richard,

On 15/08/11 00:26, Richard Hudson wrote:

> Having looked though the archives we've tried passing in sname and name
> arguments to erl.exe with no luck.

So do you get the same error when you run this command:
 erl -sname foo
Does it still fail if you use the erl.exe from the erts-5.8.4\bin directory?

> Does anyone have any thoughts on why the standard service install would
> fail but the application and modified install seem to work fine.

The security context is different. Confirm that the system account
running the service has network permissions.

I've also seen this happen in the presence of an SSL configuration. Do
you have a rabbit config file?

> How safe is it to use erl.exe from erl5.8.4\bin\erl.exe rather than
> erl5.8.4\erts-5.8.4\bin\erl.exe? i.e is this an acceptable workaround.

This is an interesting clue about the problem. It would be safer to
understand the underlying cause than to rely on this workaround in a
production environment.


Do you get the error with previous versions of rabbit? Rabbit v2.2.0
would be a useful candidate if the problem is related to  IPv6.


-Emile

From matthias at rabbitmq.com  Mon Aug 15 13:54:48 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 15 Aug 2011 13:54:48 +0100
Subject: [rabbitmq-discuss] Issues starting RabbitMQ 2.5.1 on Ubuntu
	10.04
In-Reply-To: <32263012.post@talk.nabble.com>
References: <32219482.post@talk.nabble.com>
	<32232090.post@talk.nabble.com>	<CABzX+qzHS9+Ve49-T+=XpSfCK=2GmF-MwiH_U1Foka8=QyFU3w@mail.gmail.com>	<32243347.post@talk.nabble.com>	<CABzX+qyRG3Ws045s9YqTZm+dTvDp4BfH9F2_Lq4Amikd4bvCWw@mail.gmail.com>	<32248034.post@talk.nabble.com>	<CABzX+qyZSczjss8w7KishJ=fjfpAgj_MRvzxhC77OxR-cqhToA@mail.gmail.com>
	<32263012.post@talk.nabble.com>
Message-ID: <4E491718.4060401@rabbitmq.com>

Trefor,

On 15/08/11 10:03, TreforT wrote:
> I have run 'erl' and I get:
>
> Erlang R14B03 (erts-5.8.4) [source] [64-bit] [smp:8:8] [rq:8]
> [async-threads:0] [kernel-poll:false]
>
> Eshell V5.8.4  (abort with ^G)
> 1>

You said you managed to get rabbit to start when running as 'root' and 
that you couldn't get it to work when starting the service (which starts 
rabbit as the 'rabbitmq' user). So please repeat the above as the 'root' 
and 'rabbitmq' user.

If that doesn't throw up any clues then the only way for us to debug 
this further is to get remote access to the machine.


Regards,

Matthias.

From matthew at rabbitmq.com  Mon Aug 15 14:04:33 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 15 Aug 2011 14:04:33 +0100
Subject: [rabbitmq-discuss] RabbitMQ performance tips,
 collected with sweat and blood
In-Reply-To: <CANVKUrUxsWfJNxNgOabAniiD8rmJYAEhj6Az5r1xcx+AjhqftQ@mail.gmail.com>
References: <CANVKUrXDQv1e-C3mkXeuY8y96yGecrSwzXOGgerGP7R_610m5w@mail.gmail.com>
	<20110812081310.GB14591@wellquite.org>
	<CANVKUrUxsWfJNxNgOabAniiD8rmJYAEhj6Az5r1xcx+AjhqftQ@mail.gmail.com>
Message-ID: <20110815130432.GD16780@rabbitmq.com>

Hi Eugene,

On Fri, Aug 12, 2011 at 08:20:15AM -0700, Eugene Kirpichov wrote:
> I'm surprised to hear about the negative effect; in my experiments the
> positive effect was very large - basically it raised a local stress
> test throughput from several thousand to several hundred thousand
> messages per second; can you please clarify?

With one or a low number of consumers from the same queue, especially if
those consumers are doing very little work and are able to acknowledge
msgs very quickly, if you turn on basic.qos then you'll see that the
loading of the consumers should be far more equal, but overall
throughput will drop. This is because of the additional checks necessary
that a queue has to make before trying to send a message to a queue
(essentially, if the prefetch limit was per consumer, rather than per
channel, life would be a lot simpler, at least from the broker's pov).

If you don't use basic.qos and the consumers are still very fast and
very simple then whilst you might get very unbalanced distribution of
messages to consumers, the overall throughput can be quite a lot higher.
Testing with consumers on the same machine as the broker should
demonstrate this.

But if your consumers are doing quite a lot of processing of each
message and are not able to keep up with the rate of messages that the
broker is sending them then it's quite possible for the broker to flood
one or a few consumers with all the messages and those consumers then
slowly work through their backlog whilst other consumers are left idle:
thus overall throughput can drop. Not only this but the memory
consumption of such consumers may well go through the roof (depending on
the client library being used) as they buffer up all the messages.

So by using basic.qos, you help to ensure that all consumers are kept
equally busy, and you can limit the amount of buffering they each do.
But nevertheless, because the broker has to do more work to achieve this
balancing, the broker spends more CPU per message per consumer, and thus
the broker can be seen to be somewhat slower. Indeed I've measured drops
from over 17kHz to 3kHz by using a single consumer and putting basic.qos
at 1. With basic.qos at some larger values (> 1000), the effect is less
pronounced, but it's still a performance drop for really simple and fast
consumers.

Matthew

From matthew at rabbitmq.com  Mon Aug 15 14:21:14 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 15 Aug 2011 14:21:14 +0100
Subject: [rabbitmq-discuss] major failure when clearing large queue
 backlog
In-Reply-To: <CAHiEoM7fqpZvnmmMegRVDob7rNMmP74o=gKEWU77Zg0xP=GJvQ@mail.gmail.com>
References: <CAHiEoM7fqpZvnmmMegRVDob7rNMmP74o=gKEWU77Zg0xP=GJvQ@mail.gmail.com>
Message-ID: <20110815132113.GF16780@rabbitmq.com>

Hi Aaron,

On Fri, Aug 12, 2011 at 02:27:25PM -0400, Aaron Westendorf wrote:
> We've put two new rabbit 2.5 hosts into production at the same time as we
> performed some other major upgrades to our software on 9 August. As
> designed, our messages queued up in rabbit, and we slowly consumed them.
> When the queues were empty, rabbit blew up and took out both hosts in the
> cluster.

Not quite as designed. Do you have the logs available for these machines
from as they blew up that you can send us (maybe off list)?

> Shortly after the queues drained, rabbit became completely unresponsive. Our
> `watch` process to list_queues and check on the state stopped running. We
> observed heavy swap churn via kswapd[0-9]+. It appeared that rabbit was
> trying to load in all of the data that it had paged to disk.  I've attached
> graphs that show when this event occurred, but they're the weekly rollups so
> it's hidden in the noise. The "max" column is the best record of the limits
> that were hit, especially the "committed" value which is significantly
> higher than the 8GB of RAM available.

To me, this sounds like Rabbit was about to crash. Sadly, Erlang is very
very poor at string handling. When processes in Erlang crash, they have
their last known state, stacktrace, and "last message in" dumped to the
log. This is fantastic from a debugging pov, but Erlang is so awful at
converting all this data to a string to put into the log, that I
regularly see Erlang eat GBs of RAM, eventually running out and then
swapping to death when converting a few MB of state to a string. This
seems to match what happened to you.

However, Rabbit certainly shouldn't have crashed, and we've had very few
crash reports with 2.5.1. It's possible that the logs contain at least
part of the reason for the crash, and if so, they'd help a lot. But
other than that there's very little for us to go on to try and help out.

If you have the logs available and if they contain errors then they'd be
of great help. Has Rabbit been behaving itself since or did you
downgrade back to your previously known-good version?

Best wishes,

Matthew

From ekirpichov at gmail.com  Mon Aug 15 15:23:41 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Mon, 15 Aug 2011 07:23:41 -0700
Subject: [rabbitmq-discuss] RabbitMQ performance tips,
 collected with sweat and blood
In-Reply-To: <20110815130432.GD16780@rabbitmq.com>
References: <CANVKUrXDQv1e-C3mkXeuY8y96yGecrSwzXOGgerGP7R_610m5w@mail.gmail.com>
	<20110812081310.GB14591@wellquite.org>
	<CANVKUrUxsWfJNxNgOabAniiD8rmJYAEhj6Az5r1xcx+AjhqftQ@mail.gmail.com>
	<20110815130432.GD16780@rabbitmq.com>
Message-ID: <CANVKUrXtR1rLbeyOVYSpz_P2r7+xfU2+aLhrRNXf9xopDVJg_g@mail.gmail.com>

Hi Matthew,

First, I clearly made a typo when saying "hundred thousand" - it was
tens of thousands (~3000 -> 30000).

Second, I fully agree with what you said. Special measures need to be
taken to avoid causing some consumers to starve.
I tried doing this on application level by setting a value of qos > 1,
but having a buffer that would reject a message that the application
didn't request within a few seconds. On my local tests that worked and
gave large benefit without the problem of starvation; on large-scale
tests it didn't work well - but it was clearly due to an
implementation error of mine somewhere that I didn't have time to
debug.

On Mon, Aug 15, 2011 at 6:04 AM, Matthew Sackman <matthew at rabbitmq.com> wrote:
> Hi Eugene,
>
> On Fri, Aug 12, 2011 at 08:20:15AM -0700, Eugene Kirpichov wrote:
>> I'm surprised to hear about the negative effect; in my experiments the
>> positive effect was very large - basically it raised a local stress
>> test throughput from several thousand to several hundred thousand
>> messages per second; can you please clarify?
>
> With one or a low number of consumers from the same queue, especially if
> those consumers are doing very little work and are able to acknowledge
> msgs very quickly, if you turn on basic.qos then you'll see that the
> loading of the consumers should be far more equal, but overall
> throughput will drop. This is because of the additional checks necessary
> that a queue has to make before trying to send a message to a queue
> (essentially, if the prefetch limit was per consumer, rather than per
> channel, life would be a lot simpler, at least from the broker's pov).
>
> If you don't use basic.qos and the consumers are still very fast and
> very simple then whilst you might get very unbalanced distribution of
> messages to consumers, the overall throughput can be quite a lot higher.
> Testing with consumers on the same machine as the broker should
> demonstrate this.
>
> But if your consumers are doing quite a lot of processing of each
> message and are not able to keep up with the rate of messages that the
> broker is sending them then it's quite possible for the broker to flood
> one or a few consumers with all the messages and those consumers then
> slowly work through their backlog whilst other consumers are left idle:
> thus overall throughput can drop. Not only this but the memory
> consumption of such consumers may well go through the roof (depending on
> the client library being used) as they buffer up all the messages.
>
> So by using basic.qos, you help to ensure that all consumers are kept
> equally busy, and you can limit the amount of buffering they each do.
> But nevertheless, because the broker has to do more work to achieve this
> balancing, the broker spends more CPU per message per consumer, and thus
> the broker can be seen to be somewhat slower. Indeed I've measured drops
> from over 17kHz to 3kHz by using a single consumer and putting basic.qos
> at 1. With basic.qos at some larger values (> 1000), the effect is less
> pronounced, but it's still a performance drop for really simple and fast
> consumers.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/

From trefor at tetrabyte.com  Mon Aug 15 15:42:37 2011
From: trefor at tetrabyte.com (TreforT)
Date: Mon, 15 Aug 2011 07:42:37 -0700 (PDT)
Subject: [rabbitmq-discuss] Issues starting RabbitMQ 2.5.1 on Ubuntu
 10.04
In-Reply-To: <4E491718.4060401@rabbitmq.com>
References: <32219482.post@talk.nabble.com> <32232090.post@talk.nabble.com>
	<CABzX+qzHS9+Ve49-T+=XpSfCK=2GmF-MwiH_U1Foka8=QyFU3w@mail.gmail.com>
	<32243347.post@talk.nabble.com>
	<CABzX+qyRG3Ws045s9YqTZm+dTvDp4BfH9F2_Lq4Amikd4bvCWw@mail.gmail.com>
	<32248034.post@talk.nabble.com>
	<CABzX+qyZSczjss8w7KishJ=fjfpAgj_MRvzxhC77OxR-cqhToA@mail.gmail.com>
	<32263012.post@talk.nabble.com> <4E491718.4060401@rabbitmq.com>
Message-ID: <32264945.post@talk.nabble.com>


Hi Matthias,

the output i posted previously was run as root.

when I run 'erl' as rabbitmq i get this:

sudo -u rabbitmq erl
Erlang R14B03 (erts-5.8.4) [source] [64-bit] [smp:8:8] [rq:8]
[async-threads:0] [kernel-poll:false]

Eshell V5.8.4  (abort with ^G)
1>

Looking at the above im guessing they are both the same.

I sure I can arrange some remote access if it is required.

Regards,
Trefor


Matthias Radestock-3 wrote:
> 
> Trefor,
> 
> On 15/08/11 10:03, TreforT wrote:
>> I have run 'erl' and I get:
>>
>> Erlang R14B03 (erts-5.8.4) [source] [64-bit] [smp:8:8] [rq:8]
>> [async-threads:0] [kernel-poll:false]
>>
>> Eshell V5.8.4  (abort with ^G)
>> 1>
> 
> You said you managed to get rabbit to start when running as 'root' and 
> that you couldn't get it to work when starting the service (which starts 
> rabbit as the 'rabbitmq' user). So please repeat the above as the 'root' 
> and 'rabbitmq' user.
> 
> If that doesn't throw up any clues then the only way for us to debug 
> this further is to get remote access to the machine.
> 
> 
> Regards,
> 
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://old.nabble.com/Issues-starting-RabbitMQ-2.5.1-on-Ubuntu-10.04-tp32219482p32264945.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From majek04 at gmail.com  Mon Aug 15 16:32:56 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Mon, 15 Aug 2011 16:32:56 +0100
Subject: [rabbitmq-discuss] RabbitMQ performance tips,
 collected with sweat and blood
In-Reply-To: <CANVKUrXDQv1e-C3mkXeuY8y96yGecrSwzXOGgerGP7R_610m5w@mail.gmail.com>
References: <CANVKUrXDQv1e-C3mkXeuY8y96yGecrSwzXOGgerGP7R_610m5w@mail.gmail.com>
Message-ID: <CABzX+qxoDFvLBo3yur_BWt=Cg=1oyQOVZctteJFLXSM-VGjMEw@mail.gmail.com>

On Fri, Aug 12, 2011 at 05:47, Eugene Kirpichov <ekirpichov at gmail.com> wrote:
> I decided that I've asked too many hard or confusing questions lately,
> and decided to contribute instead :)
>
> So here's what I learnt about making rabbitmq fast, or at least
> avoiding making it slow:
> * Turn on prefetch. Large is good, small is better than nothing. You
> can try a trick "reject a prefetched message if we didn't actually
> need it for a few seconds/minutes". Consider prefetch individually for
> each queue; e.g. it may be that you cannot turn it on for tasks, but
> can for results.
> * Turn on autoAck
> * Do not use transactions
> * In a cluster, always communicate with a queue only through the
> broker that first declared it
> * Avoid frequently doing these things, esp. on a cluster: establishing
> a connection, BasicConsume, QueueDeclare etc. If you do them often
> (dozens/hundreds of times per second), you're completely screwed. And
> conversely, if you're completely screwed, the first place to look is
> whether you're doing these things too frequently, and if you're not,
> look again.
> * Avoid overloading rabbitmq with published messages in a queue and
> making it swap like crazy. For that, use ConfirmSelect (publisher
> confirmations), track (in your app) the number of unconfirmed messages
> and block further submission if there are too many (more than a few
> dozen megabytes). The effect is really dramatic.
> * Use a 64-bit machine and raise the vm high watermark
> * Increase erlang process limit
> * Increase file descriptor limit
> * Split one queue into many, as a queue can only utilize 1 core -
> across a cluster or not (either will give some benefit); publish in
> roundrobin (between those sub-queues that aren't overloaded acc. to
> publisher confirmations); consume all simultaneously.
>
> More tips welcome.

SSD disk can speed things up drastically, especially if you're using persistent
messages and/or transactions.

Marek

From ekirpichov at gmail.com  Mon Aug 15 16:33:46 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Mon, 15 Aug 2011 08:33:46 -0700
Subject: [rabbitmq-discuss] RabbitMQ performance tips,
 collected with sweat and blood
In-Reply-To: <CABzX+qxoDFvLBo3yur_BWt=Cg=1oyQOVZctteJFLXSM-VGjMEw@mail.gmail.com>
References: <CANVKUrXDQv1e-C3mkXeuY8y96yGecrSwzXOGgerGP7R_610m5w@mail.gmail.com>
	<CABzX+qxoDFvLBo3yur_BWt=Cg=1oyQOVZctteJFLXSM-VGjMEw@mail.gmail.com>
Message-ID: <CANVKUrVKXqbJiUTZpadMTdp2j8aCK+1qYzQYWSfX3-e+ur4-NQ@mail.gmail.com>

On Mon, Aug 15, 2011 at 8:32 AM, Marek Majkowski <majek04 at gmail.com> wrote:
> On Fri, Aug 12, 2011 at 05:47, Eugene Kirpichov <ekirpichov at gmail.com> wrote:
>> I decided that I've asked too many hard or confusing questions lately,
>> and decided to contribute instead :)
>>
>> So here's what I learnt about making rabbitmq fast, or at least
>> avoiding making it slow:
>> * Turn on prefetch. Large is good, small is better than nothing. You
>> can try a trick "reject a prefetched message if we didn't actually
>> need it for a few seconds/minutes". Consider prefetch individually for
>> each queue; e.g. it may be that you cannot turn it on for tasks, but
>> can for results.
>> * Turn on autoAck
>> * Do not use transactions
>> * In a cluster, always communicate with a queue only through the
>> broker that first declared it
>> * Avoid frequently doing these things, esp. on a cluster: establishing
>> a connection, BasicConsume, QueueDeclare etc. If you do them often
>> (dozens/hundreds of times per second), you're completely screwed. And
>> conversely, if you're completely screwed, the first place to look is
>> whether you're doing these things too frequently, and if you're not,
>> look again.
>> * Avoid overloading rabbitmq with published messages in a queue and
>> making it swap like crazy. For that, use ConfirmSelect (publisher
>> confirmations), track (in your app) the number of unconfirmed messages
>> and block further submission if there are too many (more than a few
>> dozen megabytes). The effect is really dramatic.
>> * Use a 64-bit machine and raise the vm high watermark
>> * Increase erlang process limit
>> * Increase file descriptor limit
>> * Split one queue into many, as a queue can only utilize 1 core -
>> across a cluster or not (either will give some benefit); publish in
>> roundrobin (between those sub-queues that aren't overloaded acc. to
>> publisher confirmations); consume all simultaneously.
>>
>> More tips welcome.
>
> SSD disk can speed things up drastically, especially if you're using persistent
> messages and/or transactions.
Thanks, this is interesting. why so? I thought the i/o pattern of a
queueing system should be pretty sequential?

>
> Marek
>



-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/

From pc88mxer at gmail.com  Mon Aug 15 16:41:24 2011
From: pc88mxer at gmail.com (E R)
Date: Mon, 15 Aug 2011 10:41:24 -0500
Subject: [rabbitmq-discuss] is there a maximum routing key length?
Message-ID: <CA+QY9ttP2UFhju4NT3B+_-sjD4z8Rmqn=vrS2ZhTbPn8X4Gw_Q@mail.gmail.com>

I've tried searching for an answer to this to no avail.

Someone has told me that librabbitmq-c encodes the routing key length
in a single byte, so it appear that the maximum key length is 255 (or
256?)

Is this a limitation of the protocol being used? rabbitmq? the amqp spec?

Thanks,

ER

From majek04 at gmail.com  Mon Aug 15 16:48:55 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Mon, 15 Aug 2011 16:48:55 +0100
Subject: [rabbitmq-discuss] is there a maximum routing key length?
In-Reply-To: <CA+QY9ttP2UFhju4NT3B+_-sjD4z8Rmqn=vrS2ZhTbPn8X4Gw_Q@mail.gmail.com>
References: <CA+QY9ttP2UFhju4NT3B+_-sjD4z8Rmqn=vrS2ZhTbPn8X4Gw_Q@mail.gmail.com>
Message-ID: <CABzX+qwp3ooiCjU_XwpfC=-WPAZMKd9zTGLCgtRshupS5Wnh6g@mail.gmail.com>

On Mon, Aug 15, 2011 at 16:41, E R <pc88mxer at gmail.com> wrote:
> I've tried searching for an answer to this to no avail.
>
> Someone has told me that librabbitmq-c encodes the routing key length
> in a single byte, so it appear that the maximum key length is 255 (or
> 256?)
>
> Is this a limitation of the protocol being used? rabbitmq? the amqp spec?

AMQP 0-9-1 defines this field as a short string. Short string keeps
length in a single byte, so the max length is 255 characters.

Marek

From matthew at rabbitmq.com  Mon Aug 15 16:51:58 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 15 Aug 2011 16:51:58 +0100
Subject: [rabbitmq-discuss] RabbitMQ performance tips,
 collected with sweat and blood
In-Reply-To: <CANVKUrVKXqbJiUTZpadMTdp2j8aCK+1qYzQYWSfX3-e+ur4-NQ@mail.gmail.com>
References: <CANVKUrXDQv1e-C3mkXeuY8y96yGecrSwzXOGgerGP7R_610m5w@mail.gmail.com>
	<CABzX+qxoDFvLBo3yur_BWt=Cg=1oyQOVZctteJFLXSM-VGjMEw@mail.gmail.com>
	<CANVKUrVKXqbJiUTZpadMTdp2j8aCK+1qYzQYWSfX3-e+ur4-NQ@mail.gmail.com>
Message-ID: <20110815155157.GI16780@rabbitmq.com>

On Mon, Aug 15, 2011 at 08:33:46AM -0700, Eugene Kirpichov wrote:
> Thanks, this is interesting. why so? I thought the i/o pattern of a
> queueing system should be pretty sequential?

It is, largely. SSDs really help Rabbit when you're doing a lot of syncs
- if you're using transactions or confirms then the fact that an SSD can
do an fsync many many times faster than spinning disks is a major
advantage.

Matthew

From ekirpichov at gmail.com  Mon Aug 15 16:53:22 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Mon, 15 Aug 2011 08:53:22 -0700
Subject: [rabbitmq-discuss] RabbitMQ performance tips,
 collected with sweat and blood
In-Reply-To: <20110815155157.GI16780@rabbitmq.com>
References: <CANVKUrXDQv1e-C3mkXeuY8y96yGecrSwzXOGgerGP7R_610m5w@mail.gmail.com>
	<CABzX+qxoDFvLBo3yur_BWt=Cg=1oyQOVZctteJFLXSM-VGjMEw@mail.gmail.com>
	<CANVKUrVKXqbJiUTZpadMTdp2j8aCK+1qYzQYWSfX3-e+ur4-NQ@mail.gmail.com>
	<20110815155157.GI16780@rabbitmq.com>
Message-ID: <CANVKUrV1cbj0E3MkrtiEDroRk8OGKZ5feaTB5xeZ=g3-ZvriUQ@mail.gmail.com>

On Mon, Aug 15, 2011 at 8:51 AM, Matthew Sackman <matthew at rabbitmq.com> wrote:
> On Mon, Aug 15, 2011 at 08:33:46AM -0700, Eugene Kirpichov wrote:
>> Thanks, this is interesting. why so? I thought the i/o pattern of a
>> queueing system should be pretty sequential?
>
> It is, largely. SSDs really help Rabbit when you're doing a lot of syncs
> - if you're using transactions or confirms then the fact that an SSD can
> do an fsync many many times faster than spinning disks is a major
> advantage.
Oh! I'm using confirms. Why do they require many fsyncs? I thought
confirms only *inform* me of fsyncs that would happen anyway?

>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/

From matthew at rabbitmq.com  Mon Aug 15 17:01:47 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 15 Aug 2011 17:01:47 +0100
Subject: [rabbitmq-discuss] RabbitMQ performance tips,
 collected with sweat and blood
In-Reply-To: <CANVKUrV1cbj0E3MkrtiEDroRk8OGKZ5feaTB5xeZ=g3-ZvriUQ@mail.gmail.com>
References: <CANVKUrXDQv1e-C3mkXeuY8y96yGecrSwzXOGgerGP7R_610m5w@mail.gmail.com>
	<CABzX+qxoDFvLBo3yur_BWt=Cg=1oyQOVZctteJFLXSM-VGjMEw@mail.gmail.com>
	<CANVKUrVKXqbJiUTZpadMTdp2j8aCK+1qYzQYWSfX3-e+ur4-NQ@mail.gmail.com>
	<20110815155157.GI16780@rabbitmq.com>
	<CANVKUrV1cbj0E3MkrtiEDroRk8OGKZ5feaTB5xeZ=g3-ZvriUQ@mail.gmail.com>
Message-ID: <20110815160147.GJ16780@rabbitmq.com>

On Mon, Aug 15, 2011 at 08:53:22AM -0700, Eugene Kirpichov wrote:
> On Mon, Aug 15, 2011 at 8:51 AM, Matthew Sackman <matthew at rabbitmq.com> wrote:
> > On Mon, Aug 15, 2011 at 08:33:46AM -0700, Eugene Kirpichov wrote:
> >> Thanks, this is interesting. why so? I thought the i/o pattern of a
> >> queueing system should be pretty sequential?
> >
> > It is, largely. SSDs really help Rabbit when you're doing a lot of syncs
> > - if you're using transactions or confirms then the fact that an SSD can
> > do an fsync many many times faster than spinning disks is a major
> > advantage.
> Oh! I'm using confirms. Why do they require many fsyncs? I thought
> confirms only *inform* me of fsyncs that would happen anyway?

Yes, but Rabbit will happily sit there for hours without issuing an
fsync if it feels like it. When it knows confirms are in use, it'll
schedule fsyncs either when it's idle, or on a timer, whichever is
sooner. Otherwise publishing clients could never receive a confirm that
a msg is safely on disk.

Matthew

From steve at rabbitmq.com  Mon Aug 15 17:37:52 2011
From: steve at rabbitmq.com (Steve Powell)
Date: Mon, 15 Aug 2011 17:37:52 +0100
Subject: [rabbitmq-discuss] RabbitMQ and Stomp topic behavior
In-Reply-To: <CAMOXM2_zpCceQReE86an94S55ai9Bi5mSus6XSmwsEK56gN2rQ@mail.gmail.com>
References: <CAMOXM28j7MMaPtrCyFLsdS1p4-RbbBgp8zH27dvcvmSEXV1RKA@mail.gmail.com>
	<CAMOXM2-vt7fVArCVN_p_1Lmn8e+ubR+d3S2KFu9M=9Jy8FZRxA@mail.gmail.com>
	<4E3FFB77.5060903@rabbitmq.com>
	<CAMOXM28hGfczSAUH5ELmhYzaZ0QfQe3T_1D-Ju5Hmaf-Zmef3w@mail.gmail.com>
	<4E3FFF5B.5060105@rabbitmq.com> <4E400405.8000001@rabbitmq.com>
	<CAMOXM29=Svs6JM+m+t45cKoQUimy=2KL75=heW9zJFt_0RXPHw@mail.gmail.com>
	<4E40EAFF.1010804@rabbitmq.com>
	<CAMOXM2_2XbwMr5ajyVHvhwkoEuK1hWWHE9jLz+Wf7VhOuF17ZQ@mail.gmail.com>
	<4E40F2C5.2000603@rabbitmq.com>
	<CAMOXM296Yq5gKQsbNbkRmF_=1oprjwDzHqMUYLD5fFhr+b-P_Q@mail.gmail.com>
	<F33050DA-8EFB-42D4-BD6A-6C3DAF28A2D8@rabbitmq.com>
	<CAMOXM2_zpCceQReE86an94S55ai9Bi5mSus6XSmwsEK56gN2rQ@mail.gmail.com>
Message-ID: <E3F75AFD-887F-488A-BC14-73F30AC2E018@rabbitmq.com>

Massimo,

I've had no luck(!) trying to get the stomp-benchmark to run. (Tried several machines/downloads) but it appears to be stuck for me.  I'll attempt to get the scenario to run on my Mac (desktop), where I appear to have an (older) running sbt/stomp-benchmark, and get back to you, but I have far less control over the memory requirements unless I'm in a virtual machine.

I'll get back to you soon.
Steve Powell  (a happy bunny)
----------some definitions from the SPD----------
Rigatoni n. A prime-ministerial grin.
Nigella n. The next bottle-size up from a Nebuchadnezzar.
Homily adv. Rather like a frenchman.

On 10 Aug 2011, at 22:10, Massimo Paladin wrote:

> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-August/014485.html

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110815/a9427933/attachment.htm>

From aaron at agoragames.com  Mon Aug 15 18:29:23 2011
From: aaron at agoragames.com (Aaron Westendorf)
Date: Mon, 15 Aug 2011 13:29:23 -0400
Subject: [rabbitmq-discuss] major failure when clearing large queue
	backlog
In-Reply-To: <20110815132113.GF16780@rabbitmq.com>
References: <CAHiEoM7fqpZvnmmMegRVDob7rNMmP74o=gKEWU77Zg0xP=GJvQ@mail.gmail.com>
	<20110815132113.GF16780@rabbitmq.com>
Message-ID: <CAHiEoM6wKfw8q_tDYjumG6HCOdr8G=7yqg8E4yZF50uaE4hmaw@mail.gmail.com>

I have seen those log files of which you speak. They are ..... large, to say
the least.

I just checked in to app and SASL and there's nothing from that time frame.
On the host which had the queue in question, the best I have is 78k SASL
messages over the course of the day that look like the one I pasted below.

=SUPERVISOR REPORT==== 9-Aug-2011::12:19:16 ===
     Supervisor: {<0.7200.4>,rabbit_channel_sup_sup}
     Context:    shutdown_error
     Reason:     shutdown
     Offender:   [{pid,<0.15122.24>},
                  {name,channel_sup},
                  {mfa,{rabbit_channel_sup,start_link,[]}},
                  {restart_type,temporary},
                  {shutdown,infinity},
                  {child_type,supervisor}]


I can email you logs, but they're really not exciting. It's all just noise
as messages were published and consumers had yet to initialize and declare
exchanges, queues and bindings.

I assume you have tests for spooling to disk when rabbit is low on memory.
Has this been tested in a cluster situation such as I described?

I checked our configurations, and I wonder if this is what caused the
problem:
[{rabbit, [{vm_memory_high_watermark, 0}, {cluster_nodes,
['artemis','hermes']}]}].


-Aaron





On Mon, Aug 15, 2011 at 9:21 AM, Matthew Sackman <matthew at rabbitmq.com>wrote:

> Hi Aaron,
>
> On Fri, Aug 12, 2011 at 02:27:25PM -0400, Aaron Westendorf wrote:
> > We've put two new rabbit 2.5 hosts into production at the same time as we
> > performed some other major upgrades to our software on 9 August. As
> > designed, our messages queued up in rabbit, and we slowly consumed them.
> > When the queues were empty, rabbit blew up and took out both hosts in the
> > cluster.
>
> Not quite as designed. Do you have the logs available for these machines
> from as they blew up that you can send us (maybe off list)?
>
> > Shortly after the queues drained, rabbit became completely unresponsive.
> Our
> > `watch` process to list_queues and check on the state stopped running. We
> > observed heavy swap churn via kswapd[0-9]+. It appeared that rabbit was
> > trying to load in all of the data that it had paged to disk.  I've
> attached
> > graphs that show when this event occurred, but they're the weekly rollups
> so
> > it's hidden in the noise. The "max" column is the best record of the
> limits
> > that were hit, especially the "committed" value which is significantly
> > higher than the 8GB of RAM available.
>
> To me, this sounds like Rabbit was about to crash. Sadly, Erlang is very
> very poor at string handling. When processes in Erlang crash, they have
> their last known state, stacktrace, and "last message in" dumped to the
> log. This is fantastic from a debugging pov, but Erlang is so awful at
> converting all this data to a string to put into the log, that I
> regularly see Erlang eat GBs of RAM, eventually running out and then
> swapping to death when converting a few MB of state to a string. This
> seems to match what happened to you.
>
> However, Rabbit certainly shouldn't have crashed, and we've had very few
> crash reports with 2.5.1. It's possible that the logs contain at least
> part of the reason for the crash, and if so, they'd help a lot. But
> other than that there's very little for us to go on to try and help out.
>
> If you have the logs available and if they contain errors then they'd be
> of great help. Has Rabbit been behaving itself since or did you
> downgrade back to your previously known-good version?
>
> Best wishes,
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110815/54947f12/attachment.htm>

From jasonjwwilliams at gmail.com  Tue Aug 16 01:59:08 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Mon, 15 Aug 2011 18:59:08 -0600
Subject: [rabbitmq-discuss] aliveness-test API call timeout length
Message-ID: <CAHZAEpectRxR_M0fU9skHZz5eL=JZ-Zanhat5fUHG4JXmnVcEg@mail.gmail.com>

Hi Guys,

How long will the aliveness-test API call wait for the test message it
publishes to arrive before it times out and returns an error?

-J

From ludy at wawame.cn  Tue Aug 16 03:19:00 2011
From: ludy at wawame.cn (ludy)
Date: Tue, 16 Aug 2011 10:19:00 +0800
Subject: [rabbitmq-discuss] push server for android
Message-ID: <1313461140.8695.25.camel@ludy-linux>

i want to do a push server for android. e.g i have a cluster of two
nodes,one named rabbit and another named hare. if too many clients
connected to rabbit connect the cluster,the socket descriptors of node
rabbit is full.
my questions are:
1.when node rabbit is full,how to redirect/connect to another node??
2.erlang can support 60000+ tcps,if need loadbalance,can loadbalance
support 60000+ tcps???  
3.are there some other ways to implement push server for android??


From mpietrek at hotmail.com  Tue Aug 16 00:36:11 2011
From: mpietrek at hotmail.com (Matt Pietrek)
Date: Mon, 15 Aug 2011 16:36:11 -0700 (PDT)
Subject: [rabbitmq-discuss] NotImplementedError: <class 'pika.spec.CancelOk'>
Message-ID: <9df82cc7-3afb-4f17-ae35-7effd2fd9e20@y4g2000vbx.googlegroups.com>

I'm getting the following error from code that used to work without
error until I did an "apt-get upgrade" today.

This is an Ubuntu 11.04 system running Python 2.7 and Pika 0.95. Any
clues what's happening?

Traceback (most recent call last):
  File "/usr/lib/python2.7/threading.py", line 552, in
__bootstrap_inner
    self.run()
  File "ConfigMgr.py", line 101, in run
    self.channel.start_consuming()
  File "/usr/local/lib/python2.7/dist-packages/pika/adapters/
blocking_connection.py", line 293, in start_consuming
    self.transport.connection.process_data_events()
  File "/usr/local/lib/python2.7/dist-packages/pika/adapters/
blocking_connection.py", line 94, in process_data_events
    self._handle_read()
  File "/usr/local/lib/python2.7/dist-packages/pika/adapters/
base_connection.py", line 162, in _handle_read
    self._on_data_available(data)
  File "/usr/local/lib/python2.7/dist-packages/pika/connection.py",
line 599, in _on_data_available
    self._channels[frame.channel_number].transport.deliver(frame)
  File "/usr/local/lib/python2.7/dist-packages/pika/channel.py", line
64, in deliver
    self.frame_dispatcher.process(frame)
  File "/usr/local/lib/python2.7/dist-packages/pika/frame.py", line
202, in process
    self._handler(frame)
  File "/usr/local/lib/python2.7/dist-packages/pika/frame.py", line
220, in _handle_method_frame
    raise NotImplementedError(frame.method.__class__)
NotImplementedError: <class 'pika.spec.CancelOk'>

Here's what my code looks like:

class ListenForLongRunningEventCompletion(threading.Thread):
    def run(self):
        self.connection =
pika.BlockingConnection(pika.ConnectionParameters(host=MQ_BINDING))
        self.channel = self.connection.channel()

        self.channel.queue_declare(queue=RESPONSE_QUEUE_NAME)
        self.channel.basic_consume(ResponseCallback,
                              queue=RESPONSE_QUEUE_NAME,
                              no_ack=True)
        self.channel.start_consuming()

    def shutdown(self):
        self.channel.stop_consuming()

def ResponseCallback(ch, method, properties, body):
    print "Long Running Task response({0})".format(body)

#==============================================================================
#
# Main program
#
#==============================================================================

if __name__ == '__main__':
    listener = ListenForLongRunningEventCompletion()
    listener.start()

    # Main app logic - not important here

    # Shut down the connections we've opened up
    listener.shutdown()

From sylvain.cordier.ext at morpho.com  Tue Aug 16 09:27:20 2011
From: sylvain.cordier.ext at morpho.com (CORDIER-AKKA Sylvain (MORPHO))
Date: Tue, 16 Aug 2011 10:27:20 +0200
Subject: [rabbitmq-discuss] Configure VM memory high watermark
In-Reply-To: <20110811162322.GJ7618@rabbitmq.com>
References: <6FC2A47F1B2CCC4C804736A81522E83018932E4F86@Y000IMRV02.rd1.rf1>
	<20110811162322.GJ7618@rabbitmq.com>
Message-ID: <6FC2A47F1B2CCC4C804736A81522E83018932E5382@Y000IMRV02.rd1.rf1>

Thank you for this explanation, but I search again a solution about the memory : 
Our RabbitMQ host has got 64GB installed RAM and RabbitMQ server process uses in normal use about 5GB of RAM.
The normal use point is just above the 8% of installed RAM (8% of 64GB is 5.12GB) and a small variation of the use point makes the RabbitMQ starts paging messages and causes a final system slowdown.

If the vm_memory_high_watermark is not the good solution, what are the available solutions?
Increase the amount of installed RAM to 96GB for the system starts paging at 7.68GB? 
Isn't there another way to delay RabbitMQ to start swapping?

Best regards

Sylvain

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Matthew Sackman
Sent: Thursday, August 11, 2011 6:23 PM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Configure VM memory high watermark

On Thu, Aug 11, 2011 at 06:15:45PM +0200, CORDIER-AKKA Sylvain (MORPHO) wrote:
> Following Rabbitmq discuss "unexplained broker shutdown", what are the risks to configure the vm_memory_high_watermark to a higher value in order to not start paging messages at 8% of installed RAM but at 30% or more?

In extremis, it could crash due to the Erlang VM being unable to
allocate sufficient RAM for things like garbage collection. Note this is
really quite unlikely, but not impossible.

Also, Rabbit can't actually stop Erlang from using more RAM. There are
scenarios in which Rabbit will eat up vastly more than the 40% it's
notionally meant to throttle publishers at, so a good amount of buffer
space is well advised. Finally, a good amount of space for the OS to
cache disk in is also helpful.

More likely is that you run out of RAM, which means you then have no
disk cache, so performance will suffer, and then Rabbit will start being
swapped out to disk, which will utterly cripple performance. Once
performance starts to drop, as it's likely Rabbit is overloaded anyway
(otherwise it wouldn't have used up so much RAM), performance will fall
off very rapidly, and this can go from bad to worse.

Matthew
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
#
" Ce courriel et les documents qui lui sont joints peuvent contenir des informations confidentielles ou ayant un caract?re priv?. S'ils ne vous sont pas destin?s, nous vous signalons qu'il est strictement interdit de les divulguer, de les reproduire ou d'en utiliser de quelque mani?re que ce soit le contenu. Si ce message vous a ?t? transmis par erreur, merci d'en informer l'exp?diteur et de supprimer imm?diatement de votre syst?me informatique ce courriel ainsi que tous les documents qui y sont attach?s."
******
" This e-mail and any attached documents may contain confidential or proprietary information. If you are not the intended recipient, you are notified that any dissemination, copying of this e-mail and any attachments thereto or use of their contents by any means whatsoever is strictly prohibited. If you have received this e-mail in error, please advise the sender immediately and delete this e-mail and all attached documents from your computer system."
#

From steve at rabbitmq.com  Tue Aug 16 11:04:00 2011
From: steve at rabbitmq.com (Steve Powell)
Date: Tue, 16 Aug 2011 11:04:00 +0100
Subject: [rabbitmq-discuss] RabbitMQ and Stomp topic behavior
In-Reply-To: <E3F75AFD-887F-488A-BC14-73F30AC2E018@rabbitmq.com>
References: <CAMOXM28j7MMaPtrCyFLsdS1p4-RbbBgp8zH27dvcvmSEXV1RKA@mail.gmail.com>
	<CAMOXM2-vt7fVArCVN_p_1Lmn8e+ubR+d3S2KFu9M=9Jy8FZRxA@mail.gmail.com>
	<4E3FFB77.5060903@rabbitmq.com>
	<CAMOXM28hGfczSAUH5ELmhYzaZ0QfQe3T_1D-Ju5Hmaf-Zmef3w@mail.gmail.com>
	<4E3FFF5B.5060105@rabbitmq.com> <4E400405.8000001@rabbitmq.com>
	<CAMOXM29=Svs6JM+m+t45cKoQUimy=2KL75=heW9zJFt_0RXPHw@mail.gmail.com>
	<4E40EAFF.1010804@rabbitmq.com>
	<CAMOXM2_2XbwMr5ajyVHvhwkoEuK1hWWHE9jLz+Wf7VhOuF17ZQ@mail.gmail.com>
	<4E40F2C5.2000603@rabbitmq.com>
	<CAMOXM296Yq5gKQsbNbkRmF_=1oprjwDzHqMUYLD5fFhr+b-P_Q@mail.gmail.com>
	<F33050DA-8EFB-42D4-BD6A-6C3DAF28A2D8@rabbitmq.com>
	<CAMOXM2_zpCceQReE86an94S55ai9Bi5mSus6XSmwsEK56gN2rQ@mail.gmail.com>
	<E3F75AFD-887F-488A-BC14-73F30AC2E018@rabbitmq.com>
Message-ID: <35FF4D48-7F7A-42CE-8C08-BE814058ACA9@rabbitmq.com>

Massimo,
I got a response from stomp-benchmark on github; apparently the sbt moved to xsbt github is not compatible with the benchmark, so I managed to get a 0.7.7 version which apparently works.  now running your scenario with your configuration, against rabbitmq 2.5.1.

Minor changes, --host localhost --port 61223 are compatible with your scenario, I believe.

Currently monitoring memory during run (at 1Gb in a 2Gb mem machine); will get back to you here.

Steve Powell
steve at rabbitmq.com
[wrk: +44-2380-111-528] [mob: +44-7815-838-558]

On 15 Aug 2011, at 17:37, Steve Powell wrote:
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-August/014555.html

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110816/2ab42853/attachment.htm>

From matthew at rabbitmq.com  Tue Aug 16 11:35:30 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 16 Aug 2011 11:35:30 +0100
Subject: [rabbitmq-discuss] major failure when clearing large queue
 backlog
In-Reply-To: <CAHiEoM6wKfw8q_tDYjumG6HCOdr8G=7yqg8E4yZF50uaE4hmaw@mail.gmail.com>
References: <CAHiEoM7fqpZvnmmMegRVDob7rNMmP74o=gKEWU77Zg0xP=GJvQ@mail.gmail.com>
	<20110815132113.GF16780@rabbitmq.com>
	<CAHiEoM6wKfw8q_tDYjumG6HCOdr8G=7yqg8E4yZF50uaE4hmaw@mail.gmail.com>
Message-ID: <20110816103530.GA5810@rabbitmq.com>

On Mon, Aug 15, 2011 at 01:29:23PM -0400, Aaron Westendorf wrote:
> I can email you logs, but they're really not exciting. It's all just noise
> as messages were published and consumers had yet to initialize and declare
> exchanges, queues and bindings.

Hmm, that's a pity.

> I assume you have tests for spooling to disk when rabbit is low on memory.
> Has this been tested in a cluster situation such as I described?

Part of our test suite certainly does simulate low memory conditions.

> I checked our configurations, and I wonder if this is what caused the
> problem:
> [{rabbit, [{vm_memory_high_watermark, 0}, {cluster_nodes,
> ['artemis','hermes']}]}].

Erm, setting that to 0 disables the memory monitor, which then forces
Rabbit to default to thinking that there's probably about 1GB RAM
installed. This is very certainly not what you want. I'd set that back
to the default of 0.4 and see how you get on with that.

Matthew

From majek04 at gmail.com  Tue Aug 16 12:10:05 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Tue, 16 Aug 2011 12:10:05 +0100
Subject: [rabbitmq-discuss] push server for android
In-Reply-To: <1313461140.8695.25.camel@ludy-linux>
References: <1313461140.8695.25.camel@ludy-linux>
Message-ID: <CABzX+qwShxX2eggn8RXJqo=JwaTgOY5hfmYbR4+LNcuSrFgnPA@mail.gmail.com>

Ludy,

On Tue, Aug 16, 2011 at 03:19, ludy <ludy at wawame.cn> wrote:
> i want to do a push server for android. e.g i have a cluster of two
> nodes,one named rabbit and another named hare. if too many clients
> connected to rabbit connect the cluster,the socket descriptors of node
> rabbit is full.

Interesting approach. I understand that you want to forward all the
connection to one broker and only when it's full, forward new
connections to another one.

I suspect it should be possible be by using haproxy in tcp mode.
(but beware, that will be a single point of failure)

> my questions are:
> 1.when node rabbit is full,how to redirect/connect to another node??

Take look at rabbitmq management plugin. It presents
file descriptors counts (available and used).

On Linux you have about 1000 file descriptors by default, on
mac 250, on windows I think it's unlimited.

> 2.erlang can support 60000+ tcps,if need loadbalance,can loadbalance
> support 60000+ tcps???

Well, you in order to get such high numbers you would have
to tune file descriptors limit and erlang process count.
Also, make sure the machine has enough memory.

Generally, it would be safer if you used some kind
of load balancing. DNS load balancing  might be the simplest option.

> 3.are there some other ways to implement push server for android??

I don't know!


Cheers,
  Marek

From majek04 at gmail.com  Tue Aug 16 12:29:36 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Tue, 16 Aug 2011 12:29:36 +0100
Subject: [rabbitmq-discuss] NotImplementedError: <class
	'pika.spec.CancelOk'>
In-Reply-To: <9df82cc7-3afb-4f17-ae35-7effd2fd9e20@y4g2000vbx.googlegroups.com>
References: <9df82cc7-3afb-4f17-ae35-7effd2fd9e20@y4g2000vbx.googlegroups.com>
Message-ID: <CABzX+qzNA4Do=7XuqBjAOFf4pnsnX8VRee+hSfqG6GHQWRYeLg@mail.gmail.com>

On Tue, Aug 16, 2011 at 00:36, Matt Pietrek <mpietrek at hotmail.com> wrote:
> I'm getting the following error from code that used to work without
> error until I did an "apt-get upgrade" today.
>
> This is an Ubuntu 11.04 system running Python 2.7 and Pika 0.95. Any
> clues what's happening?

Nope. Maybe it's just a python installation issue?

Can you try removing pika and installing it again? Or maybe
installing a fresh local copy (for example using venv)?

Cheers,
  Marek

> Traceback (most recent call last):
> ?File "/usr/lib/python2.7/threading.py", line 552, in
> __bootstrap_inner
> ? ?self.run()
> ?File "ConfigMgr.py", line 101, in run
> ? ?self.channel.start_consuming()
> ?File "/usr/local/lib/python2.7/dist-packages/pika/adapters/
> blocking_connection.py", line 293, in start_consuming
> ? ?self.transport.connection.process_data_events()
> ?File "/usr/local/lib/python2.7/dist-packages/pika/adapters/
> blocking_connection.py", line 94, in process_data_events
> ? ?self._handle_read()
> ?File "/usr/local/lib/python2.7/dist-packages/pika/adapters/
> base_connection.py", line 162, in _handle_read
> ? ?self._on_data_available(data)
> ?File "/usr/local/lib/python2.7/dist-packages/pika/connection.py",
> line 599, in _on_data_available
> ? ?self._channels[frame.channel_number].transport.deliver(frame)
> ?File "/usr/local/lib/python2.7/dist-packages/pika/channel.py", line
> 64, in deliver
> ? ?self.frame_dispatcher.process(frame)
> ?File "/usr/local/lib/python2.7/dist-packages/pika/frame.py", line
> 202, in process
> ? ?self._handler(frame)
> ?File "/usr/local/lib/python2.7/dist-packages/pika/frame.py", line
> 220, in _handle_method_frame
> ? ?raise NotImplementedError(frame.method.__class__)
> NotImplementedError: <class 'pika.spec.CancelOk'>
>
> Here's what my code looks like:
>
> class ListenForLongRunningEventCompletion(threading.Thread):
> ? ?def run(self):
> ? ? ? ?self.connection =
> pika.BlockingConnection(pika.ConnectionParameters(host=MQ_BINDING))
> ? ? ? ?self.channel = self.connection.channel()
>
> ? ? ? ?self.channel.queue_declare(queue=RESPONSE_QUEUE_NAME)
> ? ? ? ?self.channel.basic_consume(ResponseCallback,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?queue=RESPONSE_QUEUE_NAME,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?no_ack=True)
> ? ? ? ?self.channel.start_consuming()
>
> ? ?def shutdown(self):
> ? ? ? ?self.channel.stop_consuming()
>
> def ResponseCallback(ch, method, properties, body):
> ? ?print "Long Running Task response({0})".format(body)
>
> #==============================================================================
> #
> # Main program
> #
> #==============================================================================
>
> if __name__ == '__main__':
> ? ?listener = ListenForLongRunningEventCompletion()
> ? ?listener.start()
>
> ? ?# Main app logic - not important here
>
> ? ?# Shut down the connections we've opened up
> ? ?listener.shutdown()
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From aaron at agoragames.com  Tue Aug 16 13:45:27 2011
From: aaron at agoragames.com (Aaron Westendorf)
Date: Tue, 16 Aug 2011 08:45:27 -0400
Subject: [rabbitmq-discuss] major failure when clearing large queue
	backlog
In-Reply-To: <20110816103530.GA5810@rabbitmq.com>
References: <CAHiEoM7fqpZvnmmMegRVDob7rNMmP74o=gKEWU77Zg0xP=GJvQ@mail.gmail.com>
	<20110815132113.GF16780@rabbitmq.com>
	<CAHiEoM6wKfw8q_tDYjumG6HCOdr8G=7yqg8E4yZF50uaE4hmaw@mail.gmail.com>
	<20110816103530.GA5810@rabbitmq.com>
Message-ID: <CAHiEoM7uazjw=LT_cRU6s62-cdAeRyVO7Rajqy81t8LSYWoa8A@mail.gmail.com>

Since restarting rabbit is a major disruption to service, changing
that value will probably wait until next week at the earliest. Seeing
as I have some time, I'd like to make sure we set it to a value that
we're happy with.

The documentation says only that disabling memsup will prevent
throttling of producers. There's also discussion about the Erlang
garbage collector, which I can see being responsible for the situation
I originally described.

http://www.rabbitmq.com/extensions.html#memsup

We've been running this configuration for a long time now, and I
vaguely recall that when the spool-to-disk feature was added, it was
dependent on this setting. However, I've seen it write to disk even
with this setting off so I may be mistaken. Regardless, we don't have
support in our applications for flow control (yet?) so I've been wary
to enable vm_memory_high_watermark. I plan to add a concept of flow
control strategies to haigha so that common use cases can be
abstracted without per-app implementations.

I've seen rabbit use much more than 1GB so I don't think it's defaulted to that.


-Aaron



On Tue, Aug 16, 2011 at 6:35 AM, Matthew Sackman <matthew at rabbitmq.com> wrote:
> On Mon, Aug 15, 2011 at 01:29:23PM -0400, Aaron Westendorf wrote:
>> I can email you logs, but they're really not exciting. It's all just noise
>> as messages were published and consumers had yet to initialize and declare
>> exchanges, queues and bindings.
>
> Hmm, that's a pity.
>
>> I assume you have tests for spooling to disk when rabbit is low on memory.
>> Has this been tested in a cluster situation such as I described?
>
> Part of our test suite certainly does simulate low memory conditions.
>
>> I checked our configurations, and I wonder if this is what caused the
>> problem:
>> [{rabbit, [{vm_memory_high_watermark, 0}, {cluster_nodes,
>> ['artemis','hermes']}]}].
>
> Erm, setting that to 0 disables the memory monitor, which then forces
> Rabbit to default to thinking that there's probably about 1GB RAM
> installed. This is very certainly not what you want. I'd set that back
> to the default of 0.4 and see how you get on with that.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From matthew at rabbitmq.com  Tue Aug 16 13:56:16 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 16 Aug 2011 13:56:16 +0100
Subject: [rabbitmq-discuss] major failure when clearing large queue
 backlog
In-Reply-To: <CAHiEoM7uazjw=LT_cRU6s62-cdAeRyVO7Rajqy81t8LSYWoa8A@mail.gmail.com>
References: <CAHiEoM7fqpZvnmmMegRVDob7rNMmP74o=gKEWU77Zg0xP=GJvQ@mail.gmail.com>
	<20110815132113.GF16780@rabbitmq.com>
	<CAHiEoM6wKfw8q_tDYjumG6HCOdr8G=7yqg8E4yZF50uaE4hmaw@mail.gmail.com>
	<20110816103530.GA5810@rabbitmq.com>
	<CAHiEoM7uazjw=LT_cRU6s62-cdAeRyVO7Rajqy81t8LSYWoa8A@mail.gmail.com>
Message-ID: <20110816125616.GC5810@rabbitmq.com>

On Tue, Aug 16, 2011 at 08:45:27AM -0400, Aaron Westendorf wrote:
> We've been running this configuration for a long time now, and I
> vaguely recall that when the spool-to-disk feature was added, it was
> dependent on this setting. However, I've seen it write to disk even
> with this setting off so I may be mistaken.

Yes, because whilst setting it to 0 stops the broker from throttling
producers when memory gets tight, the queues are forced to assume that
there is 1GB of memory available and they do continue to watch memory
use and write to disk as they see fit. Thus if you have more than 1GB
RAM in your machines, Rabbit will be writing to disk earlier that it
should.

> Regardless, we don't have
> support in our applications for flow control (yet?) so I've been wary
> to enable vm_memory_high_watermark. I plan to add a concept of flow
> control strategies to haigha so that common use cases can be
> abstracted without per-app implementations.

Ok understood. The way Rabbit does it these days is that it just stops
reading from the sockets of publishers. Thus the TCP buffers will fill
up, and the publishers will just find that writing to their socket
blocks. We don't use channel.flow any more. Thus you may find that you
need do nothing, or, you may have a situation where you really don't
want to have publishers blocked.

> I've seen rabbit use much more than 1GB so I don't think it's defaulted to that.

Well we can't control fully how much RAM gets used. That's why we hedge
our bets and have the default at 0.4 of the installed RAM. This allows
space for transient spikes such as GC and so forth. The point of the 1GB
default is that this controls when Rabbit starts to send msgs to disk to
try and free up RAM. But ultimately, it won't stop Rabbit/Erlang from
using more than 1GB RAM if that's necessary.

Matthew

From aaron at agoragames.com  Tue Aug 16 14:35:53 2011
From: aaron at agoragames.com (Aaron Westendorf)
Date: Tue, 16 Aug 2011 09:35:53 -0400
Subject: [rabbitmq-discuss] major failure when clearing large queue
	backlog
In-Reply-To: <20110816125616.GC5810@rabbitmq.com>
References: <CAHiEoM7fqpZvnmmMegRVDob7rNMmP74o=gKEWU77Zg0xP=GJvQ@mail.gmail.com>
	<20110815132113.GF16780@rabbitmq.com>
	<CAHiEoM6wKfw8q_tDYjumG6HCOdr8G=7yqg8E4yZF50uaE4hmaw@mail.gmail.com>
	<20110816103530.GA5810@rabbitmq.com>
	<CAHiEoM7uazjw=LT_cRU6s62-cdAeRyVO7Rajqy81t8LSYWoa8A@mail.gmail.com>
	<20110816125616.GC5810@rabbitmq.com>
Message-ID: <CAHiEoM7P1P-As_USOyOqMPTs6mOJd2GrSs5AHXaX4F4EuEbtWw@mail.gmail.com>

This all sounds good. We're still going to go slow on such a big
change, but we'll mull this over and probably turn it back on soon.

cheers


On Tue, Aug 16, 2011 at 8:56 AM, Matthew Sackman <matthew at rabbitmq.com> wrote:
> On Tue, Aug 16, 2011 at 08:45:27AM -0400, Aaron Westendorf wrote:
>> We've been running this configuration for a long time now, and I
>> vaguely recall that when the spool-to-disk feature was added, it was
>> dependent on this setting. However, I've seen it write to disk even
>> with this setting off so I may be mistaken.
>
> Yes, because whilst setting it to 0 stops the broker from throttling
> producers when memory gets tight, the queues are forced to assume that
> there is 1GB of memory available and they do continue to watch memory
> use and write to disk as they see fit. Thus if you have more than 1GB
> RAM in your machines, Rabbit will be writing to disk earlier that it
> should.
>
>> Regardless, we don't have
>> support in our applications for flow control (yet?) so I've been wary
>> to enable vm_memory_high_watermark. I plan to add a concept of flow
>> control strategies to haigha so that common use cases can be
>> abstracted without per-app implementations.
>
> Ok understood. The way Rabbit does it these days is that it just stops
> reading from the sockets of publishers. Thus the TCP buffers will fill
> up, and the publishers will just find that writing to their socket
> blocks. We don't use channel.flow any more. Thus you may find that you
> need do nothing, or, you may have a situation where you really don't
> want to have publishers blocked.
>
>> I've seen rabbit use much more than 1GB so I don't think it's defaulted to that.
>
> Well we can't control fully how much RAM gets used. That's why we hedge
> our bets and have the default at 0.4 of the installed RAM. This allows
> space for transient spikes such as GC and so forth. The point of the 1GB
> default is that this controls when Rabbit starts to send msgs to disk to
> try and free up RAM. But ultimately, it won't stop Rabbit/Erlang from
> using more than 1GB RAM if that's necessary.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From matthew at rabbitmq.com  Tue Aug 16 14:50:57 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 16 Aug 2011 14:50:57 +0100
Subject: [rabbitmq-discuss] major failure when clearing large queue
 backlog
In-Reply-To: <CAHiEoM7P1P-As_USOyOqMPTs6mOJd2GrSs5AHXaX4F4EuEbtWw@mail.gmail.com>
References: <CAHiEoM7fqpZvnmmMegRVDob7rNMmP74o=gKEWU77Zg0xP=GJvQ@mail.gmail.com>
	<20110815132113.GF16780@rabbitmq.com>
	<CAHiEoM6wKfw8q_tDYjumG6HCOdr8G=7yqg8E4yZF50uaE4hmaw@mail.gmail.com>
	<20110816103530.GA5810@rabbitmq.com>
	<CAHiEoM7uazjw=LT_cRU6s62-cdAeRyVO7Rajqy81t8LSYWoa8A@mail.gmail.com>
	<20110816125616.GC5810@rabbitmq.com>
	<CAHiEoM7P1P-As_USOyOqMPTs6mOJd2GrSs5AHXaX4F4EuEbtWw@mail.gmail.com>
Message-ID: <20110816135057.GD5810@rabbitmq.com>

On Tue, Aug 16, 2011 at 09:35:53AM -0400, Aaron Westendorf wrote:
> This all sounds good. We're still going to go slow on such a big
> change, but we'll mull this over and probably turn it back on soon.

Sure - obviously, if it works for you then that's the goal. It's just
that the settings you have are not really something we'd recommend and
could be causing the problem you've recently seen. But yes, making step
by step changes and seeing what works is wise!

Best wishes,

Matthew

From mikeb at rabbitmq.com  Tue Aug 16 15:36:18 2011
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Tue, 16 Aug 2011 15:36:18 +0100
Subject: [rabbitmq-discuss] Load Balanced Consumers?
In-Reply-To: <CAJreXKCosAv6jYfJ57YZ4pjLNWnioaHB6Y08n83V_DEzuak4UA@mail.gmail.com>
References: <CAJreXKCosAv6jYfJ57YZ4pjLNWnioaHB6Y08n83V_DEzuak4UA@mail.gmail.com>
Message-ID: <4E4A8062.9070104@rabbitmq.com>

> In all the material I've read on clustering and load balancing the
> setup I always see is publishers publishing through a load balancer
> while consumers consume all the nodes on the cluster.

> Is it possible to place the consumers behind a load balancer? I'm
> just asking, we plan on trying it on Monday with our cluster at work.
> The setup we're thinking of is one balancer for publishers, two for
> consumers (which consumers will consume on both) and divide the
> cluster into segments that the consumer balancers forward to.

Load-balancing for publishers is for handling high throughput,
the theory being that more connections can be opened and more messages
processed.  Routing is done by channel processes, so that will to some 
extent[1] scale along with the number of connections.

The overall scaling behaviour is probably[2] mostly dependent on the
routing topology; i.e., to how many queues each message is routed. If
messages are being fanned out to many queues, that will of course
mitigate the benefit of handling many publishers and incoming messages 
at once.

You're right that no-one has really gone into load-balancing consumers 
(or at least, has not reported doing so here). Possibly this is because 
how queues and consumers are deployed is more tied in with application 
logic (e.g., routing) than publishing is -- i.e., it's different for 
everyone, and no one scheme works across the board. Publishing isn't 
stateful but consuming is.

 From a throughput point of view, taking a single use case -- let's say 
publishing to a single queue and consuming from it -- I guess the idea 
would be to consume on more than one connection, on the basis that the 
queue would load-balance across those connections and each connection 
would be on a different node. I'm not sure how much this would improve 
performance, since the queue (located on one node) still has to deliver 
messages across nodes. See [2] though.

It sounds from your brief description you are more interested in 
failover -- e.g., if a node fails, another node will continue to deliver 
messages. Since queues are located at a particular node, this won't work 
in that mode, presently[3]; unless you are, somewhere, prepared to 
duplicate messages (e.g., with a fanout exchange and a queue bound to it 
from each segment) and deduplicate at the clients (and even then, it 
doesn't quite work, as the round-robin at each queue wouldn't be the 
same). But perhaps I have misunderstood what you're trying to achieve.

[1] To some extent because it does involve database reads and other
overheads.

[2] Nothing beats actually measuring.

[3] Replicated queues are coming soon.

> Is this an ideal solution? The only problem comes when the nodes
> that both connect to go down at the same time but I am putting money
> on that not happening. We'll see. :)
>
> Thanks, James _______________________________________________
> rabbitmq-discuss mailing list rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From steve at rabbitmq.com  Tue Aug 16 16:09:15 2011
From: steve at rabbitmq.com (Steve Powell)
Date: Tue, 16 Aug 2011 16:09:15 +0100
Subject: [rabbitmq-discuss] RabbitMQ and Stomp topic behavior
In-Reply-To: <35FF4D48-7F7A-42CE-8C08-BE814058ACA9@rabbitmq.com>
References: <CAMOXM28j7MMaPtrCyFLsdS1p4-RbbBgp8zH27dvcvmSEXV1RKA@mail.gmail.com>
	<CAMOXM2-vt7fVArCVN_p_1Lmn8e+ubR+d3S2KFu9M=9Jy8FZRxA@mail.gmail.com>
	<4E3FFB77.5060903@rabbitmq.com>
	<CAMOXM28hGfczSAUH5ELmhYzaZ0QfQe3T_1D-Ju5Hmaf-Zmef3w@mail.gmail.com>
	<4E3FFF5B.5060105@rabbitmq.com> <4E400405.8000001@rabbitmq.com>
	<CAMOXM29=Svs6JM+m+t45cKoQUimy=2KL75=heW9zJFt_0RXPHw@mail.gmail.com>
	<4E40EAFF.1010804@rabbitmq.com>
	<CAMOXM2_2XbwMr5ajyVHvhwkoEuK1hWWHE9jLz+Wf7VhOuF17ZQ@mail.gmail.com>
	<4E40F2C5.2000603@rabbitmq.com>
	<CAMOXM296Yq5gKQsbNbkRmF_=1oprjwDzHqMUYLD5fFhr+b-P_Q@mail.gmail.com>
	<F33050DA-8EFB-42D4-BD6A-6C3DAF28A2D8@rabbitmq.com>
	<CAMOXM2_zpCceQReE86an94S55ai9Bi5mSus6XSmwsEK56gN2rQ@mail.gmail.com>
	<E3F75AFD-887F-488A-BC14-73F30AC2E018@rabbitmq.com>
	<35FF4D48-7F7A-42CE-8C08-BE814058ACA9@rabbitmq.com>
Message-ID: <0696B38D-D170-4D4A-B878-CB6C809E8782@rabbitmq.com>

Massimo,
I've run the scenario on my 2-core 2Gb Ubuntu 32-bit VM (final changes, I removed vhost (default <<"/">>) from the config file).

The benchmark runs for about two lines of dots and then the rabbitmq_server gets a segmentation fault! and terminates.  The benchmark doesn't notice and ploughs on regardless.  Disappointingly I found no log information to explain the failure.

I added {vm_memory_high_watermark, 0.1} to the configuration, and switched the log file output to a local directory, and the benchmark and running broker (and benchmark) seem to continue fairly stably for ever!!  (I'm assuming the benchmark has no termination coded, it didn't seem to stop by itself, so I interrupt it after about half an hour.)

I notice several things:
rabbitmq_server process runs at full CPU (200% in my virtual machine) most of the time, with occasional lapses to 0 (zero), when the benchmark and the server appear to pause for breath.
the virtual memory requirements for rabbitmq_server seem to be below 0.5Gb, most of the time, but occasionally creep up to 0.7 or 0.8Gb, and then drop to about 0.2Gb.  By comparison, the java stomp-benchmark process runs at 723Mb all the time.
the memory (as opposed to virtual memory) requirements for rabbit_server appear to run between 0.54 to 0.75 of the virtual requirements.
I suspect that, when set to 0.4 (the default vm_memory_high_watermark ratio) the vMem occasionally creeps above the maximum allowed on this machine, which is about 1.6/1.7Gb, and that's when we get the segmentation fault.  This is worth investigation.  Also the CPU glitches look interesting; this may be throttling, or some sort of Erlang process garbage collection of which I am ignorant.

So where are the benchmark results put?  I see nothing produced (save a truncated rabbitmq_topic file) when I interrupt it.  Is this another problem with my sbt/workbench setup?

Steve Powell  (a happy bunny)
----------some definitions from the SPD----------
Rigatoni n. A prime-ministerial grin.
Nigella n. The next bottle-size up from a Nebuchadnezzar.
Homily adv. Rather like a frenchman.

On 16 Aug 2011, at 11:04, Steve Powell wrote:

> Massimo,
> I got a response from stomp-benchmark on github; apparently the sbt moved to xsbt github is not compatible with the benchmark, so I managed to get a 0.7.7 version which apparently works.  now running your scenario with your configuration, against rabbitmq 2.5.1.
> 
> Minor changes, --host localhost --port 61223 are compatible with your scenario, I believe.
> 
> Currently monitoring memory during run (at 1Gb in a 2Gb mem machine); will get back to you here.
> 
> Steve Powell
> steve at rabbitmq.com
> [wrk: +44-2380-111-528] [mob: +44-7815-838-558]
> 
> On 15 Aug 2011, at 17:37, Steve Powell wrote:
>> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-August/014555.html
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110816/6ca65fbf/attachment.htm>

From james.r.carr at gmail.com  Tue Aug 16 17:15:45 2011
From: james.r.carr at gmail.com (James Carr)
Date: Tue, 16 Aug 2011 11:15:45 -0500
Subject: [rabbitmq-discuss] Load Balanced Consumers?
In-Reply-To: <4E4A8062.9070104@rabbitmq.com>
References: <CAJreXKCosAv6jYfJ57YZ4pjLNWnioaHB6Y08n83V_DEzuak4UA@mail.gmail.com>
	<4E4A8062.9070104@rabbitmq.com>
Message-ID: <CAJreXKDn1ATsxotponp3LmmRoQM5+JB8DR9RuUk43tKURveXyA@mail.gmail.com>

We Completed some experiments and here was our findings.

We set up a 3 node broker (rabbitmq running on three separate boxes)
and clustered them together. The publisher publishes to a load
balancer (crescendo) while the consumer defined a queue on one node
and subscriber to all three nodes. The behavior we saw is the consumer
got unique messages from all three nodes. for example it might get
messages 1,2, and 4 from node one, 3,7 from node 2, and 5, 6 from node
3. The publisher messages reached the broker as fast as they were
published (1,000/s on average) and performed well. Likewise the
consumer also performed well and got messages as fast as they came in.
We also tried just connected a consumer to one broker and got similar
results.

Putting the consumer behind a load balancer however resulted in slow
as snot consuming. For now we've decided against that approach.

You're right, my aim is to be able to take any node on the cluster
down for maintanence without impacting application performance or
message delivery. All of our apps are using spring-amqp which
auto-reconnects if their connects get reset.

So far it seems like having the consumer connect to each of the boxes
is the best approach, albeit slightly heavy. I'd definitely like to
know some of the approaches others have taken to achieve HA. :)


Thanks,
James


On Tue, Aug 16, 2011 at 9:36 AM, Michael Bridgen <mikeb at rabbitmq.com> wrote:
>> In all the material I've read on clustering and load balancing the
>> setup I always see is publishers publishing through a load balancer
>> while consumers consume all the nodes on the cluster.
>
>> Is it possible to place the consumers behind a load balancer? I'm
>> just asking, we plan on trying it on Monday with our cluster at work.
>> The setup we're thinking of is one balancer for publishers, two forWell, We
>> consumers (which consumers will consume on both) and divide the
>> cluster into segments that the consumer balancers forward to.
>
> Load-balancing for publishers is for handling high throughput,
> the theory being that more connections can be opened and more messages
> processed. ?Routing is done by channel processes, so that will to some
> extent[1] scale along with the number of connections.
>
> The overall scaling behaviour is probably[2] mostly dependent on the
> routing topology; i.e., to how many queues each message is routed. If
> messages are being fanned out to many queues, that will of course
> mitigate the benefit of handling many publishers and incoming messages at
> once.
>
> You're right that no-one has really gone into load-balancing consumers (or
> at least, has not reported doing so here). Possibly this is because how
> queues and consumers are deployed is more tied in with application logic
> (e.g., routing) than publishing is -- i.e., it's different for everyone, and
> no one scheme works across the board. Publishing isn't stateful but
> consuming is.
>
> From a throughput point of view, taking a single use case -- let's say
> publishing to a single queue and consuming from it -- I guess the idea would
> be to consume on more than one connection, on the basis that the queue would
> load-balance across those connections and each connection would be on a
> different node. I'm not sure how much this would improve performance, since
> the queue (located on one node) still has to deliver messages across nodes.
> See [2] though.
>
> It sounds from your brief description you are more interested in failover --
> e.g., if a node fails, another node will continue to deliver messages. Since
> queues are located at a particular node, this won't work in that mode,
> presently[3]; unless you are, somewhere, prepared to duplicate messages
> (e.g., with a fanout exchange and a queue bound to it from each segment) and
> deduplicate at the clients (and even then, it doesn't quite work, as the
> round-robin at each queue wouldn't be the same). But perhaps I have
> misunderstood what you're trying to achieve.
>
> [1] To some extent because it does involve database reads and other
> overheads.
>
> [2] Nothing beats actually measuring.
>
> [3] Replicated queues are coming soon.
>
>> Is this an ideal solution? The only problem comes when the nodes
>> that both connect to go down at the same time but I am putting money
>> on that not happening. We'll see. :)
>>
>> Thanks, James _______________________________________________
>> rabbitmq-discuss mailing list rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From steve at rabbitmq.com  Tue Aug 16 17:14:22 2011
From: steve at rabbitmq.com (Steve Powell)
Date: Tue, 16 Aug 2011 17:14:22 +0100
Subject: [rabbitmq-discuss] Consumer Callback
In-Reply-To: <32238474.post@talk.nabble.com>
References: <32103305.post@talk.nabble.com>
	<9E349AF4-25D2-4871-8E6E-ECF2528A25A9@rabbitmq.com>
	<32143565.post@talk.nabble.com>
	<1C266D3D-0BD7-4422-ABA5-5DC944491D8A@rabbitmq.com>
	<32238474.post@talk.nabble.com>
Message-ID: <E62CF240-8CCF-45A0-917F-A94A2ECC95C5@rabbitmq.com>

Dear Fang,

The overhead of persistent messages is not going to be that great (some background I/O will be going on) as a persistent message doesn't AFAIK translate into a serial write, let alone a force (fsync).  So similar send/receive rates is not too surprising.

Setting autoAck=true should mean that delivered messages can be discarded sooner, but I'm  not sure what you think is wrong with your scenarios.
I assume that you declare the queue autoAck=true in both the producer *and* consumer code (just checking).

Can you be a little more specific about what you think you *ought* to be seeing, and what you *do* see?

Steve Powell  (a happy bunny)
----------some definitions from the SPD----------
Rigatoni n. A prime-ministerial grin.
Nigella n. The next bottle-size up from a Nebuchadnezzar.
Homily adv. Rather like a frenchman.

On 11 Aug 2011, at 00:55, fangbot wrote:
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-August/014486.html

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110816/38c42ec5/attachment.htm>

From mpietrek at hotmail.com  Tue Aug 16 17:18:14 2011
From: mpietrek at hotmail.com (Matt Pietrek)
Date: Tue, 16 Aug 2011 09:18:14 -0700
Subject: [rabbitmq-discuss] NotImplementedError: <class
 'pika.spec.CancelOk'>
In-Reply-To: <CABzX+qzNA4Do=7XuqBjAOFf4pnsnX8VRee+hSfqG6GHQWRYeLg@mail.gmail.com>
Message-ID: <BLU0-SMTP14978B01F378C85A35DB285D6290@phx.gbl>

Alas, no luck with a Pika reinstall. I did a "pip uninstall" of what was
there, verified the files were removed, then "pip install".

All other aspects of my Pika-based code seem to work. I'm sending and
receiving 1000's of messages before shutting down. It's only at shutdown
where the problem occurs.

Does my shutdown sequence look OK? That is, calling
channel.stop_consuming() from a different thread than I called
.start_consuming on?



On 8/16/11 4:29 AM, "Marek Majkowski" <majek04 at gmail.com> wrote:

>On Tue, Aug 16, 2011 at 00:36, Matt Pietrek <mpietrek at hotmail.com> wrote:
>> I'm getting the following error from code that used to work without
>> error until I did an "apt-get upgrade" today.
>>
>> This is an Ubuntu 11.04 system running Python 2.7 and Pika 0.95. Any
>> clues what's happening?
>
>Nope. Maybe it's just a python installation issue?
>
>Can you try removing pika and installing it again? Or maybe
>installing a fresh local copy (for example using venv)?
>
>Cheers,
>  Marek
>
>> Traceback (most recent call last):
>>  File "/usr/lib/python2.7/threading.py", line 552, in
>> __bootstrap_inner
>>    self.run()
>>  File "ConfigMgr.py", line 101, in run
>>    self.channel.start_consuming()
>>  File "/usr/local/lib/python2.7/dist-packages/pika/adapters/
>> blocking_connection.py", line 293, in start_consuming
>>    self.transport.connection.process_data_events()
>>  File "/usr/local/lib/python2.7/dist-packages/pika/adapters/
>> blocking_connection.py", line 94, in process_data_events
>>    self._handle_read()
>>  File "/usr/local/lib/python2.7/dist-packages/pika/adapters/
>> base_connection.py", line 162, in _handle_read
>>    self._on_data_available(data)
>>  File "/usr/local/lib/python2.7/dist-packages/pika/connection.py",
>> line 599, in _on_data_available
>>    self._channels[frame.channel_number].transport.deliver(frame)
>>  File "/usr/local/lib/python2.7/dist-packages/pika/channel.py", line
>> 64, in deliver
>>    self.frame_dispatcher.process(frame)
>>  File "/usr/local/lib/python2.7/dist-packages/pika/frame.py", line
>> 202, in process
>>    self._handler(frame)
>>  File "/usr/local/lib/python2.7/dist-packages/pika/frame.py", line
>> 220, in _handle_method_frame
>>    raise NotImplementedError(frame.method.__class__)
>> NotImplementedError: <class 'pika.spec.CancelOk'>
>>
>> Here's what my code looks like:
>>
>> class ListenForLongRunningEventCompletion(threading.Thread):
>>    def run(self):
>>        self.connection =
>> pika.BlockingConnection(pika.ConnectionParameters(host=MQ_BINDING))
>>        self.channel = self.connection.channel()
>>
>>        self.channel.queue_declare(queue=RESPONSE_QUEUE_NAME)
>>        self.channel.basic_consume(ResponseCallback,
>>                              queue=RESPONSE_QUEUE_NAME,
>>                              no_ack=True)
>>        self.channel.start_consuming()
>>
>>    def shutdown(self):
>>        self.channel.stop_consuming()
>>
>> def ResponseCallback(ch, method, properties, body):
>>    print "Long Running Task response({0})".format(body)
>>
>> 
>>#========================================================================
>>======
>> #
>> # Main program
>> #
>> 
>>#========================================================================
>>======
>>
>> if __name__ == '__main__':
>>    listener = ListenForLongRunningEventCompletion()
>>    listener.start()
>>
>>    # Main app logic - not important here
>>
>>    # Shut down the connections we've opened up
>>    listener.shutdown()
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>



From gmr at myyearbook.com  Tue Aug 16 17:32:44 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Tue, 16 Aug 2011 12:32:44 -0400
Subject: [rabbitmq-discuss] NotImplementedError: <class
 'pika.spec.CancelOk'>
In-Reply-To: <BLU0-SMTP14978B01F378C85A35DB285D6290@phx.gbl>
References: <BLU0-SMTP14978B01F378C85A35DB285D6290@phx.gbl>
Message-ID: <39C8DD04C7C04F10879AF2EF8BF8E901@myyearbook.com>

 It looks like to me that you have a non-standard pika install, perhaps the new debian package? 

I say that because I see:

> > > /usr/local/lib/python2.7/dist-packages/pika/connection.py
And I'd expect something like:

/usr/lib/python2.7/site-packages/pika/connection.py

Can you use slocate or find to see if you have more than one version of pika installed?

What happens when you run the following in python2.7 interactively?

import pika
pika.__version__




On Tuesday, August 16, 2011 at 12:18 PM, Matt Pietrek wrote:

> Alas, no luck with a Pika reinstall. I did a "pip uninstall" of what was
> there, verified the files were removed, then "pip install".
> 
> All other aspects of my Pika-based code seem to work. I'm sending and
> receiving 1000's of messages before shutting down. It's only at shutdown
> where the problem occurs.
> 
> Does my shutdown sequence look OK? That is, calling
> channel.stop_consuming() from a different thread than I called
> .start_consuming on?
> 
> 
> 
> On 8/16/11 4:29 AM, "Marek Majkowski" <majek04 at gmail.com (mailto:majek04 at gmail.com)> wrote:
> 
> > On Tue, Aug 16, 2011 at 00:36, Matt Pietrek <mpietrek at hotmail.com (mailto:mpietrek at hotmail.com)> wrote:
> > > I'm getting the following error from code that used to work without
> > > error until I did an "apt-get upgrade" today.
> > > 
> > > This is an Ubuntu 11.04 system running Python 2.7 and Pika 0.95. Any
> > > clues what's happening?
> > 
> > Nope. Maybe it's just a python installation issue?
> > 
> > Can you try removing pika and installing it again? Or maybe
> > installing a fresh local copy (for example using venv)?
> > 
> > Cheers,
> >  Marek
> > 
> > > Traceback (most recent call last):
> > >  File "/usr/lib/python2.7/threading.py", line 552, in
> > > __bootstrap_inner
> > >  self.run()
> > >  File "ConfigMgr.py", line 101, in run
> > >  self.channel.start_consuming()
> > >  File "/usr/local/lib/python2.7/dist-packages/pika/adapters/
> > > blocking_connection.py", line 293, in start_consuming
> > >  self.transport.connection.process_data_events()
> > >  File "/usr/local/lib/python2.7/dist-packages/pika/adapters/
> > > blocking_connection.py", line 94, in process_data_events
> > >  self._handle_read()
> > >  File "/usr/local/lib/python2.7/dist-packages/pika/adapters/
> > > base_connection.py", line 162, in _handle_read
> > >  self._on_data_available(data)
> > >  File "/usr/local/lib/python2.7/dist-packages/pika/connection.py",
> > > line 599, in _on_data_available
> > >  self._channels[frame.channel_number].transport.deliver(frame)
> > >  File "/usr/local/lib/python2.7/dist-packages/pika/channel.py", line
> > > 64, in deliver
> > >  self.frame_dispatcher.process(frame)
> > >  File "/usr/local/lib/python2.7/dist-packages/pika/frame.py", line
> > > 202, in process
> > >  self._handler(frame)
> > >  File "/usr/local/lib/python2.7/dist-packages/pika/frame.py", line
> > > 220, in _handle_method_frame
> > >  raise NotImplementedError(frame.method.__class__)
> > > NotImplementedError: <class 'pika.spec.CancelOk'>
> > > 
> > > Here's what my code looks like:
> > > 
> > > class ListenForLongRunningEventCompletion(threading.Thread):
> > >  def run(self):
> > >  self.connection =
> > > pika.BlockingConnection(pika.ConnectionParameters(host=MQ_BINDING))
> > >  self.channel = self.connection.channel()
> > > 
> > >  self.channel.queue_declare(queue=RESPONSE_QUEUE_NAME)
> > >  self.channel.basic_consume(ResponseCallback,
> > >  queue=RESPONSE_QUEUE_NAME,
> > >  no_ack=True)
> > >  self.channel.start_consuming()
> > > 
> > >  def shutdown(self):
> > >  self.channel.stop_consuming()
> > > 
> > > def ResponseCallback(ch, method, properties, body):
> > >  print "Long Running Task response({0})".format(body)
> > > 
> > > 
> > > #========================================================================
> > > ======
> > > #
> > > # Main program
> > > #
> > > 
> > > #========================================================================
> > > ======
> > > 
> > > if __name__ == '__main__':
> > >  listener = ListenForLongRunningEventCompletion()
> > >  listener.start()
> > > 
> > >  # Main app logic - not important here
> > > 
> > >  # Shut down the connections we've opened up
> > >  listener.shutdown()
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> > > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110816/5b29ee6e/attachment.htm>

From mpietrek at hotmail.com  Tue Aug 16 17:51:50 2011
From: mpietrek at hotmail.com (Matt Pietrek)
Date: Tue, 16 Aug 2011 09:51:50 -0700
Subject: [rabbitmq-discuss] NotImplementedError: <class
 'pika.spec.CancelOk'>
In-Reply-To: <39C8DD04C7C04F10879AF2EF8BF8E901@myyearbook.com>
Message-ID: <BLU0-SMTP2688BC4CF69521FBC5ACCEBD6290@phx.gbl>

Thanks for the quick reply Gavin.

I've got no idea how my install would be non-standard. It's an Ubuntu 11.04
box, recently updated via "sudo apt-get upgrade". FWIW, my Python 2.7
install is based in /usr/local/lib/python2.7, so the /local/ in the path
isn't surprising (to me at least...)

Per the instructions on the RabbitMq site, I did: "sudo pip install
pika==0.9.5". I didn't notice any errors:

----------------
mpietrek at rabbitmq:/usr/local/lib/python2.7$sudo pip install pika==0.9.5
Downloading/unpacking pika==0.9.5
  Downloading pika-0.9.5.tar.gz
  Running setup.py egg_info for package pika
    
Installing collected packages: pika
  Running setup.py install for pika
    
Successfully installed pika
Cleaning up...
----------------

The output from Interactive Python that you requested:

Python 2.7.1+ (r271:86832, Apr 11 2011, 18:13:53)
[GCC 4.5.2] on linux2
Type "help", "copyright", "credits" or "license" for more information.
>>> import pika
>>> pika.__version__
'0.9.5'

Also, FWIW, the contents of
/usr/local/lib/python2.7/dist-packages/pika-0.9.5.egg-info/PKG_INFO are:

Metadata-Version: 1.0
Name: pika
Version: 0.9.5
Summary: Pika Python AMQP Client Library
Home-page: http://pika.github.com/
Author: Gavin M. Roy
Author-email: gmr at myyearbook.com
License: MPL v1.1 and GPL v2.0 or newer
Description: Pika is a pure-Python implementation of the AMQP 0-9-1 protocol
that
        tries to stay fairly independent of the underlying network support
        library. Pika was developed primarily for use with RabbitMQ, but
        should also work with other AMQP 0-9-1 brokers.
        
Platform: UNKNOWN
Classifier: Development Status :: 4 - Beta
Classifier: Intended Audience :: Developers
Classifier: License :: OSI Approved :: GNU General Public License (GPL)
Classifier: License :: OSI Approved :: Mozilla Public License 1.1 (MPL 1.1)
Classifier: Operating System :: OS Independent
Classifier: Topic :: Communications
Classifier: Topic :: Internet
Classifier: Topic :: Software Development :: Libraries

Thanks much for your help,

Matt

From:  "Gavin M. Roy" <gmr at myyearbook.com>
Date:  Tue, 16 Aug 2011 12:32:44 -0400
To:  Matt Pietrek <mpietrek at hotmail.com>
Cc:  Marek Majkowski <majek04 at gmail.com>,
<rabbitmq-discuss at lists.rabbitmq.com>
Subject:  Re: [rabbitmq-discuss] NotImplementedError: <class
'pika.spec.CancelOk'>

 
 It looks like to me that you have a non-standard pika install, perhaps the
new debian package?

I say that because I see:

>>> /usr/local/lib/python2.7/dist-packages/pika/connection.py
And I'd expect something like:

/usr/lib/python2.7/site-packages/pika/connection.py

Can you use slocate or find to see if you have more than one version of pika
installed?

What happens when you run the following in python2.7 interactively?

import pika
pika.__version__
 
 
  

On Tuesday, August 16, 2011 at 12:18 PM, Matt Pietrek wrote:
 
>  
> Alas, no luck with a Pika reinstall. I did a "pip uninstall" of what was
> there, verified the files were removed, then "pip install".
> 
> All other aspects of my Pika-based code seem to work. I'm sending and
> receiving 1000's of messages before shutting down. It's only at shutdown
> where the problem occurs.
> 
> Does my shutdown sequence look OK? That is, calling
> channel.stop_consuming() from a different thread than I called
> .start_consuming on?
> 
> 
> 
> On 8/16/11 4:29 AM, "Marek Majkowski" <majek04 at gmail.com> wrote:
> 
>> On Tue, Aug 16, 2011 at 00:36, Matt Pietrek <mpietrek at hotmail.com> wrote:
>>> I'm getting the following error from code that used to work without
>>> error until I did an "apt-get upgrade" today.
>>> 
>>> This is an Ubuntu 11.04 system running Python 2.7 and Pika 0.95. Any
>>> clues what's happening?
>> 
>> Nope. Maybe it's just a python installation issue?
>> 
>> Can you try removing pika and installing it again? Or maybe
>> installing a fresh local copy (for example using venv)?
>> 
>> Cheers,
>>  Marek
>> 
>>> Traceback (most recent call last):
>>>  File "/usr/lib/python2.7/threading.py", line 552, in
>>> __bootstrap_inner
>>>    self.run()
>>>  File "ConfigMgr.py", line 101, in run
>>>    self.channel.start_consuming()
>>>  File "/usr/local/lib/python2.7/dist-packages/pika/adapters/
>>> blocking_connection.py", line 293, in start_consuming
>>>    self.transport.connection.process_data_events()
>>>  File "/usr/local/lib/python2.7/dist-packages/pika/adapters/
>>> blocking_connection.py", line 94, in process_data_events
>>>    self._handle_read()
>>>  File "/usr/local/lib/python2.7/dist-packages/pika/adapters/
>>> base_connection.py", line 162, in _handle_read
>>>    self._on_data_available(data)
>>>  File "/usr/local/lib/python2.7/dist-packages/pika/connection.py",
>>> line 599, in _on_data_available
>>>    self._channels[frame.channel_number].transport.deliver(frame)
>>>  File "/usr/local/lib/python2.7/dist-packages/pika/channel.py", line
>>> 64, in deliver
>>>    self.frame_dispatcher.process(frame)
>>>  File "/usr/local/lib/python2.7/dist-packages/pika/frame.py", line
>>> 202, in process
>>>    self._handler(frame)
>>>  File "/usr/local/lib/python2.7/dist-packages/pika/frame.py", line
>>> 220, in _handle_method_frame
>>>    raise NotImplementedError(frame.method.__class__)
>>> NotImplementedError: <class 'pika.spec.CancelOk'>
>>> 
>>> Here's what my code looks like:
>>> 
>>> class ListenForLongRunningEventCompletion(threading.Thread):
>>>    def run(self):
>>>        self.connection =
>>> pika.BlockingConnection(pika.ConnectionParameters(host=MQ_BINDING))
>>>        self.channel = self.connection.channel()
>>> 
>>>        self.channel.queue_declare(queue=RESPONSE_QUEUE_NAME)
>>>        self.channel.basic_consume(ResponseCallback,
>>>                              queue=RESPONSE_QUEUE_NAME,
>>>                              no_ack=True)
>>>        self.channel.start_consuming()
>>> 
>>>    def shutdown(self):
>>>        self.channel.stop_consuming()
>>> 
>>> def ResponseCallback(ch, method, properties, body):
>>>    print "Long Running Task response({0})".format(body)
>>> 
>>> 
>>> #========================================================================
>>> ======
>>> #
>>> # Main program
>>> #
>>> 
>>> #========================================================================
>>> ======
>>> 
>>> if __name__ == '__main__':
>>>    listener = ListenForLongRunningEventCompletion()
>>>    listener.start()
>>> 
>>>    # Main app logic - not important here
>>> 
>>>    # Shut down the connections we've opened up
>>>    listener.shutdown()
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>      
  
 
 


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110816/aff6b60d/attachment.htm>

From simon at rabbitmq.com  Tue Aug 16 17:56:09 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 16 Aug 2011 17:56:09 +0100
Subject: [rabbitmq-discuss] aliveness-test API call timeout length
In-Reply-To: <CAHZAEpectRxR_M0fU9skHZz5eL=JZ-Zanhat5fUHG4JXmnVcEg@mail.gmail.com>
References: <CAHZAEpectRxR_M0fU9skHZz5eL=JZ-Zanhat5fUHG4JXmnVcEg@mail.gmail.com>
Message-ID: <4E4AA129.3090906@rabbitmq.com>

On 16/08/11 01:59, Jason J. W. Williams wrote:
> How long will the aliveness-test API call wait for the test message it
> publishes to arrive before it times out and returns an error?

Forever. You need to implement a timeout anyway (in case the 
aliveness-test itself hangs in some way), so the idea is not to multiply 
entities beyond necessity...

Cheers, Simon
-- 
Simon MacMullen
RabbitMQ, VMware

From fangbot at gmail.com  Tue Aug 16 19:41:52 2011
From: fangbot at gmail.com (fangbot)
Date: Tue, 16 Aug 2011 11:41:52 -0700 (PDT)
Subject: [rabbitmq-discuss] Consumer Callback
In-Reply-To: <E62CF240-8CCF-45A0-917F-A94A2ECC95C5@rabbitmq.com>
References: <32103305.post@talk.nabble.com>
	<9E349AF4-25D2-4871-8E6E-ECF2528A25A9@rabbitmq.com>
	<32143565.post@talk.nabble.com>
	<1C266D3D-0BD7-4422-ABA5-5DC944491D8A@rabbitmq.com>
	<32238474.post@talk.nabble.com>
	<E62CF240-8CCF-45A0-917F-A94A2ECC95C5@rabbitmq.com>
Message-ID: <32274171.post@talk.nabble.com>


Hi Steve,
With 50,000 messages per batch and 100 bytes per message, I am seeing a
throughput of about 6.3k messages/second, both with and without persistence.
I expected to see a much lower throughput when messages are sent with
MessageProperties.minimal_persistent, since they must each be written to the
database. However, it appears that this is not the case. When do persistent
messages get written to the database?
-- 
View this message in context: http://old.nabble.com/Consumer-Callback-tp32103305p32274171.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From matthias at rabbitmq.com  Tue Aug 16 20:48:59 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 16 Aug 2011 20:48:59 +0100
Subject: [rabbitmq-discuss] Consumer Callback
In-Reply-To: <32274171.post@talk.nabble.com>
References: <32103305.post@talk.nabble.com>	<9E349AF4-25D2-4871-8E6E-ECF2528A25A9@rabbitmq.com>	<32143565.post@talk.nabble.com>	<1C266D3D-0BD7-4422-ABA5-5DC944491D8A@rabbitmq.com>	<32238474.post@talk.nabble.com>	<E62CF240-8CCF-45A0-917F-A94A2ECC95C5@rabbitmq.com>
	<32274171.post@talk.nabble.com>
Message-ID: <4E4AC9AB.1070408@rabbitmq.com>

On 16/08/11 19:41, fangbot wrote:
> With 50,000 messages per batch and 100 bytes per message, I am seeing a
> throughput of about 6.3k messages/second, both with and without persistence.
> I expected to see a much lower throughput when messages are sent with
> MessageProperties.minimal_persistent, since they must each be written to the
> database. However, it appears that this is not the case. When do persistent
> messages get written to the database?

You are consuming in auto-ack mode. That means the queue can generally 
send messages to a consumer as soon as it receives them *and the 
promptly forget about them*. So as long as the consumers can keep up 
your messages never make it anywhere near the disk.

Matthias.

From pkelly at gmail.com  Tue Aug 16 20:58:29 2011
From: pkelly at gmail.com (Pete Kelly)
Date: Tue, 16 Aug 2011 20:58:29 +0100
Subject: [rabbitmq-discuss] Scenario ideas
Message-ID: <CAEWH9M9P-_HjkqyuFQs6eZXPrtpAZOyTCPKSgM0RV7O_+3SaAQ@mail.gmail.com>

Hi

I have been playing with rabbitmq and am thinking through some common
scenarios I think I will need to deal with, I was wondering if anyone would
be able to take the time to read my thoughts and validate them or throw a
few more options in/give me some article links?

I have a topic exchange and need to attach some consumers to process
messages.

If I attach a consumer with no queue name, a unique one time queue will be
created and I can bind the exchange to this queue using a routing key like
'animal.mammals.#'.

This is great until

- the consumer crashes, meaning the exchange will drop all messages (or they
get rejected depending on the publish settings I use)
or
- I need another consumer to process animals.mammals.#, which I can't do as
I am using a one time queue and adding another will mean each message is
delivered to 2 queues.

Are the above assumptions correct?


So my second option is to use a named queue. I attach a consumer with a
queue name and bind the exchange to this queue using a routing key like
'animal.mammals.#'.

Now if I need another consumer I simply bring another one up and attach it
to the same queue name, and they get the messages in round robin which is
great.

What's not so great is if I then decide to attach a consumer to this queue
name (maybe by accident) and bind the exchange to a routing key
'animal.mammals.rabbit'

Then the queue gets 2 copies of each message. Is there any way to avoid this
other than careful management of bindings? Maybe a way of telling the
exchange to only deliver the message once to a given queue?

My worry is developers who will create bindings willy nilly without
realising the consequences of what is happening.


Any help would be appreciated, I am just trying to piece what's happening
together in my mind at the moment so I can understand what's happening in
the background.

Thanks

Pete
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110816/7914d3b7/attachment.htm>

From oleksandr.petrov at gmail.com  Wed Aug 17 09:13:07 2011
From: oleksandr.petrov at gmail.com (Alex P)
Date: Wed, 17 Aug 2011 01:13:07 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ-c @ ARM Targets
Message-ID: <20547897.765.1313568787115.JavaMail.geo-discussion-forums@yqad28>

Hi,

We're building a system that uses RabbitMQ for messaging, and one of the 
targets is an embedded PC with ARM7 processor. 

Have anyone tried to compile RabbitMQ for ARM targets? If you have any 
hint/suggestion/advise (e.q. tools used for cross compilation, so far 
friendly ARM worked quite well, other ones were less friendly, toolchains 
etc), I'd gladly listen to them. 

I don't think we have a big problem with memory consumption, it's relatively 
fine. Processor is a bit of a limitation, but it shouldn't affect RabbitMQ, 
or at least seems so. 

Thank you!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110817/3aeaff76/attachment.htm>

From mikeb at rabbitmq.com  Wed Aug 17 10:39:36 2011
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Wed, 17 Aug 2011 10:39:36 +0100
Subject: [rabbitmq-discuss] Scenario ideas
In-Reply-To: <CAEWH9M9P-_HjkqyuFQs6eZXPrtpAZOyTCPKSgM0RV7O_+3SaAQ@mail.gmail.com>
References: <CAEWH9M9P-_HjkqyuFQs6eZXPrtpAZOyTCPKSgM0RV7O_+3SaAQ@mail.gmail.com>
Message-ID: <4E4B8C58.9050401@rabbitmq.com>

Hi Pete,

> I have been playing with rabbitmq and am thinking through some common
> scenarios I think I will need to deal with, I was wondering if anyone
> would be able to take the time to read my thoughts and validate them or
> throw a few more options in/give me some article links?
>
> I have a topic exchange and need to attach some consumers to process
> messages.
>
> If I attach a consumer with no queue name, a unique one time queue will
> be created and I can bind the exchange to this queue using a routing key
> like 'animal.mammals.#'.

Not quite; you have to create the queue with an empty name, then consume 
from it using the name you get back in queue.declare_ok (and then bind 
it to the exchange).

> This is great until
>
> - the consumer crashes, meaning the exchange will drop all messages (or
> they get rejected depending on the publish settings I use)
> or

Yes, that can happen. Though if the queue isn't exclusive or auto_delete 
(and thereby destroyed when the connection drops or consumer goes away), 
it will happily collect messages until the consumer returns. Of course, 
you'd have to have recorded its name somewhere, or generated the name 
yourself in a way you can repeat.

> - I need another consumer to process animals.mammals.#, which I can't do
> as I am using a one time queue and adding another will mean each message
> is delivered to 2 queues.

What is the problem with delivering to two queues? If you are using a 
topic exchange, creating an anonymous, exclusive queue for each consumer 
is usually appropriate.

> Are the above assumptions correct?
>
>
> So my second option is to use a named queue. I attach a consumer with a
> queue name and bind the exchange to this queue using a routing key like
> 'animal.mammals.#'.
>
> Now if I need another consumer I simply bring another one up and attach
> it to the same queue name, and they get the messages in round robin
> which is great.

It is certainly an established pattern to use a durable, named queue for 
sharing out messages.  Queues do double duty in AMQP -- firstly as "work 
queues" of this kind, secondly as buffers for transmission.

Take care with the order in which you do things, or at least be aware 
that unless you set a prefetch value, the first consumer will get all 
the messages in the queue at that time.

> What's not so great is if I then decide to attach a consumer to this
> queue name (maybe by accident) and bind the exchange to a routing key
> 'animal.mammals.rabbit'
>
> Then the queue gets 2 copies of each message. Is there any way to avoid
> this other than careful management of bindings? Maybe a way of telling
> the exchange to only deliver the message once to a given queue?

No, it won't get two copies.  The routing will only ever deliver any 
given message once to a queue.

The combination of wildcard routing and round-robin is unusual. Would 
you go into more detail about what you are trying to achieve?


--Michael

From pkelly at gmail.com  Wed Aug 17 11:13:34 2011
From: pkelly at gmail.com (Pete Kelly)
Date: Wed, 17 Aug 2011 11:13:34 +0100
Subject: [rabbitmq-discuss] Scenario ideas
In-Reply-To: <4E4B8C58.9050401@rabbitmq.com>
References: <CAEWH9M9P-_HjkqyuFQs6eZXPrtpAZOyTCPKSgM0RV7O_+3SaAQ@mail.gmail.com>
	<4E4B8C58.9050401@rabbitmq.com>
Message-ID: <CAEWH9M_BfTbd0fQTsy4tG3Qtkjj+NWdHU6OKfy0_KR6QENhqHg@mail.gmail.com>

On 17 August 2011 10:39, Michael Bridgen <mikeb at rabbitmq.com> wrote:

> Hi Pete,
>
>
>  I have been playing with rabbitmq and am thinking through some common
>> scenarios I think I will need to deal with, I was wondering if anyone
>> would be able to take the time to read my thoughts and validate them or
>> throw a few more options in/give me some article links?
>>
>> I have a topic exchange and need to attach some consumers to process
>> messages.
>>
>> If I attach a consumer with no queue name, a unique one time queue will
>> be created and I can bind the exchange to this queue using a routing key
>> like 'animal.mammals.#'.
>>
>
> Not quite; you have to create the queue with an empty name, then consume
> from it using the name you get back in queue.declare_ok (and then bind it to
> the exchange).
>
>
>  This is great until
>>
>> - the consumer crashes, meaning the exchange will drop all messages (or
>> they get rejected depending on the publish settings I use)
>> or
>>
>
> Yes, that can happen. Though if the queue isn't exclusive or auto_delete
> (and thereby destroyed when the connection drops or consumer goes away), it
> will happily collect messages until the consumer returns. Of course, you'd
> have to have recorded its name somewhere, or generated the name yourself in
> a way you can repeat.
>
>
>  - I need another consumer to process animals.mammals.#, which I can't do
>> as I am using a one time queue and adding another will mean each message
>> is delivered to 2 queues.
>>
>
> What is the problem with delivering to two queues? If you are using a topic
> exchange, creating an anonymous, exclusive queue for each consumer is
> usually appropriate.
>
>
>  Are the above assumptions correct?
>>
>>
>> So my second option is to use a named queue. I attach a consumer with a
>> queue name and bind the exchange to this queue using a routing key like
>> 'animal.mammals.#'.
>>
>> Now if I need another consumer I simply bring another one up and attach
>> it to the same queue name, and they get the messages in round robin
>> which is great.
>>
>
> It is certainly an established pattern to use a durable, named queue for
> sharing out messages.  Queues do double duty in AMQP -- firstly as "work
> queues" of this kind, secondly as buffers for transmission.
>

That's good to know, after experimenting this is the thinking I have come
round to as it allows the consumers to die if they need to and the queues
will still be written to, using a named queue also enables more than one
consumer to attach to a queue and receive the messages in round robin, which
is a nice quick way to add process capacity if it's ever required.


>
> Take care with the order in which you do things, or at least be aware that
> unless you set a prefetch value, the first consumer will get all the
> messages in the queue at that time.


I noticed that with my experiments, prefetch is now set.


>
>
>  What's not so great is if I then decide to attach a consumer to this
>> queue name (maybe by accident) and bind the exchange to a routing key
>> 'animal.mammals.rabbit'
>>
>> Then the queue gets 2 copies of each message. Is there any way to avoid
>> this other than careful management of bindings? Maybe a way of telling
>> the exchange to only deliver the message once to a given queue?
>>
>
> No, it won't get two copies.  The routing will only ever deliver any given
> message once to a queue.
>
> The combination of wildcard routing and round-robin is unusual. Would you
> go into more detail about what you are trying to achieve?
>

I think I could have confused the issue here somewhat - because of how the
tutorials are laid out I mistakenly thought that the consumer could consume
on a given routing key, rather than the routing key just being a binding
between an exchange and a queue. So I was thinking I was consuming on a
routing key, whereas in reality that's not the case.

The tutorials (and further experimentation) It's been a useful exercise in
finding out just how flexible rabbitmq is, and with that flexibility comes
the potential to really break the queues and bindings (especially if the
application is allowed to blindly create queues and bindings).

I am going to go with an approach that means bindings and queues must be
manually created, and only give the application code permission to write to
the exchanges, and read from the queues.



>
>
> --Michael
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110817/82a0b78c/attachment.htm>

From alfonso.pantoja at gmail.com  Wed Aug 17 11:57:30 2011
From: alfonso.pantoja at gmail.com (Alfonso Pantoja)
Date: Wed, 17 Aug 2011 03:57:30 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ 2.2.0 message delivery issue: internal
	crash
Message-ID: <5e41b730-540e-4b16-ae83-aa5dec8758ff@t29g2000vby.googlegroups.com>

Hi,

We are experiencing an issue with version 2.2.0 which causes to
RabbitMQ to not deliver messages to a consumer.
The consumer is connected to RabbitMQ and performs a create queue/
exchange/binding when it is started but sometimes when there are
messages in the queue they are not being delivered by Rabbit.
Restarting the consumer (it is a windows service) does not solve the
problem and the consumer remains connected but without any message
although the queue contains 3000 messages.

I've found this in rabbitmq sals log file every time I restart the
service:


=CRASH REPORT==== 17-Aug-2011::11:19:04 ===
  crasher:
    initial call: rabbit_writer:mainloop/2
    pid: <0.5938.552>
    registered_name: []
    exception error: bad argument
      in function  rabbit_binary_generator:encode_property/2
      in call from rabbit_binary_generator:encode_properties/6
      in call from rabbit_binary_generator:ensure_content_encoded/2
      in call from rabbit_binary_generator:build_simple_content_frames/
4
      in call from rabbit_writer:assemble_frames/5
      in call from rabbit_writer:internal_send_command_async/3
      in call from rabbit_writer:handle_message/2
      in call from rabbit_writer:mainloop1/2
    ancestors: [<0.5937.552>,<0.5912.552>,<0.5910.552>,
                  rabbit_tcp_client_sup,rabbit_sup,<0.165.0>]
    messages: [{send_command_and_notify,<0.463.0>,<0.5939.552>,
                      {'basic.deliver',
                          <<"amq.ctag-Ci6dSa3Tdm2obfV5CXFVxg==">>,
2,false,
                          <<"users">>,<<"domain.com.machinename.
0.status">>},
                      {content,60,
                          {'P_basic',<<"text/
plain">>,undefined,undefined,2,
                              undefined,undefined,undefined,undefined,
                              undefined,
1920007482.523,undefined,undefined,
                              undefined,undefined},
                          none,none,
                          [<<"<presence><jid>username1 at domain.com</
jid><status>offline</status></presence>">>]}},
                  {send_command_and_notify,<0.463.0>,<0.5939.552>,
                      {'basic.deliver',
                          <<"amq.ctag-Ci6dSa3Tdm2obfV5CXFVxg==">>,
3,false,
                          <<"users">>,<<"domain.com.machinename.
0.status">>},
                      {content,60,
                          {'P_basic',<<"text/
plain">>,undefined,undefined,2,
                              undefined,undefined,undefined,undefined,
                              undefined,
1920009454.965,undefined,undefined,
                              undefined,undefined},
                          none,none,
                          [<<"<presence><jid>username2 at domain.com</
jid><status>online</status></presence>">>]}},
                  {send_command_and_notify,<0.463.0>,<0.5939.552>,
                      {'basic.deliver',
                          <<"amq.ctag-Ci6dSa3Tdm2obfV5CXFVxg==">>,
4,false,
                          <<"users">>,<<"domain.com.machinename.
0.status">>},


.
.
.


[log reduced for clarity]

.
.
.


    links: [<0.5937.552>]
    dictionary: []
    trap_exit: false
    status: running
    heap_size: 987
    stack_size: 24
    reductions: 194
  neighbours:

=SUPERVISOR REPORT==== 17-Aug-2011::11:19:04 ===
     Supervisor: {<0.5937.552>,rabbit_channel_sup}
     Context:    child_terminated
     Reason:     badarg
     Offender:   [{pid,<0.5938.552>},
                  {name,writer},
                  {mfa,{rabbit_writer,start_link,
                                      [#Port<0.8712>,1,131072,
                                       rabbit_framing_amqp_0_9_1,
                                       <0.5913.552>]}},
                  {restart_type,intrinsic},
                  {shutdown,4294967295},
                  {child_type,worker}]


=SUPERVISOR REPORT==== 17-Aug-2011::11:19:04 ===
     Supervisor: {<0.5937.552>,rabbit_channel_sup}
     Context:    shutdown
     Reason:     reached_max_restart_intensity
     Offender:   [{pid,<0.5938.552>},
                  {name,writer},
                  {mfa,{rabbit_writer,start_link,
                                      [#Port<0.8712>,1,131072,
                                       rabbit_framing_amqp_0_9_1,
                                       <0.5913.552>]}},
                  {restart_type,intrinsic},
                  {shutdown,4294967295},
                  {child_type,worker}]



Note: "<presence><jid>username1 at domain.com</jid><status>offline</
status></presence>" is a message on the queue and
"domain.com.machinename.0.status" is the routing key.





From videlalvaro at gmail.com  Wed Aug 17 12:02:57 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 17 Aug 2011 13:02:57 +0200
Subject: [rabbitmq-discuss] RabbitMQ conference in Dublin Take II
Message-ID: <F4BE335C-4994-4BBF-85AC-EF4E584CEDBC@gmail.com>

Hi,

Just wanted to let you know that Jakub @botanicus from the Ruby AMQP library will also be speaking at the RabbitMQ conference in Dublin on September 5th. 

More details here http://rabbitmq.eventbrite.com/

Regards,

Alvaro

From matthew at rabbitmq.com  Wed Aug 17 12:06:05 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 17 Aug 2011 12:06:05 +0100
Subject: [rabbitmq-discuss] RabbitMQ 2.2.0 message delivery issue:
 internal crash
In-Reply-To: <5e41b730-540e-4b16-ae83-aa5dec8758ff@t29g2000vby.googlegroups.com>
References: <5e41b730-540e-4b16-ae83-aa5dec8758ff@t29g2000vby.googlegroups.com>
Message-ID: <20110817110605.GD1444@rabbitmq.com>

Hi,

On Wed, Aug 17, 2011 at 03:57:30AM -0700, Alfonso Pantoja wrote:
> We are experiencing an issue with version 2.2.0 which causes to
> RabbitMQ to not deliver messages to a consumer.
> The consumer is connected to RabbitMQ and performs a create queue/
> exchange/binding when it is started but sometimes when there are
> messages in the queue they are not being delivered by Rabbit.
> Restarting the consumer (it is a windows service) does not solve the
> problem and the consumer remains connected but without any message
> although the queue contains 3000 messages.

I vaguely remember this bug. It has been fixed. The solution would be to
upgrade to the latest version of RabbitMQ (2.5.1).

Matthew

From matthew at rabbitmq.com  Wed Aug 17 12:19:30 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 17 Aug 2011 12:19:30 +0100
Subject: [rabbitmq-discuss] RabbitMQ 2.2.0 message delivery issue:
 internal crash
In-Reply-To: <20110817110605.GD1444@rabbitmq.com>
References: <5e41b730-540e-4b16-ae83-aa5dec8758ff@t29g2000vby.googlegroups.com>
	<20110817110605.GD1444@rabbitmq.com>
Message-ID: <20110817111929.GE1444@rabbitmq.com>

On Wed, Aug 17, 2011 at 12:06:05PM +0100, Matthew Sackman wrote:
> Hi,
> 
> On Wed, Aug 17, 2011 at 03:57:30AM -0700, Alfonso Pantoja wrote:
> > We are experiencing an issue with version 2.2.0 which causes to
> > RabbitMQ to not deliver messages to a consumer.
> > The consumer is connected to RabbitMQ and performs a create queue/
> > exchange/binding when it is started but sometimes when there are
> > messages in the queue they are not being delivered by Rabbit.
> > Restarting the consumer (it is a windows service) does not solve the
> > problem and the consumer remains connected but without any message
> > although the queue contains 3000 messages.
> 
> I vaguely remember this bug. It has been fixed. The solution would be to
> upgrade to the latest version of RabbitMQ (2.5.1).

If it's the bug I'm thinking of then this was caused by a bug in the
erlang client which is widely used by various plugins, and was not
encoding messages in the correct way. So if you are using a STOMP or
XMPP or some other plugin (i.e. you're getting messages into Rabbit
without explicitly using an AMQP client) then I think the bug I'm
thinking of is the culprit.

If this is the case then you'll need to upgrade both the broker and its
plugins because they must both be matched in terms of versions.

Unfortunately, because the messages were corrupted by the erlang client
and the corruption only manifests itself when the messages are sent out,
they're likely stored on disk in a corrupted form and just upgrading
Rabbit will not solve the problem. If this is the case, then I'm afraid
there's really nothing for it but to wipe out the msgs on disk and start
from a clean slate - sorry. There is a slim chance that if you're using
some plugin such as STOMP it might be able to ignore this issue but it
depends very much on the details of the plugin.

A colleague has just recalled that there was a similar bug at one point
with the STOMP plugin itself which you might be tripping over.

Without further details of how you're using Rabbit and with what
protocols, it's difficult to suggest your best path forward. However,
that aside, 2.2.0 is fairly ancient and many bugs have been fixed (and
hopefully fewer created) since then.

Matthew

From lars.ellebo at schneider-electric.com  Wed Aug 17 12:24:33 2011
From: lars.ellebo at schneider-electric.com (lars.ellebo at schneider-electric.com)
Date: Wed, 17 Aug 2011 13:24:33 +0200
Subject: [rabbitmq-discuss] Auto-disconnecting a deleted user
Message-ID: <OF67B4E006.7121C121-ONC12578EF.003DF736-C12578EF.003EADDD@Schneider-Electric.com>

Hi

I've noticed that if I as RabbitMQ Admin deletes a User who is currently 
connected to the RabbitMQ,
this user does not get disconnected but remains connected.

Do any of you know whether there is a way to ensure that deleted users 
gets disconnected immediately if they are connected at deletion time?

/Lars
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110817/a8475ccf/attachment.htm>

From dotnetby at gmail.com  Wed Aug 17 12:21:59 2011
From: dotnetby at gmail.com (Andrei Varanovich)
Date: Wed, 17 Aug 2011 04:21:59 -0700 (PDT)
Subject: [rabbitmq-discuss] Connect to rabbitmq outside the host
Message-ID: <0d391690-f49c-48fa-9563-4bc776d1482b@w11g2000vbp.googlegroups.com>

Hello,

I set up rabbitmq on amazon EC2 instance.

env hostname: gives me: ip-10-202-255-xxx
rabbitmq node : rabbit at ip-10-202-255-xxx

However I want to connect to rabbitmq outside amazon host by using
public DNS. (say ec2-123.compute-1.amazonaws.com)

Are there any guies for configuring such a scenario?

Thanks,
Andrei

From matthias at rabbitmq.com  Wed Aug 17 12:34:06 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 17 Aug 2011 12:34:06 +0100
Subject: [rabbitmq-discuss] Auto-disconnecting a deleted user
In-Reply-To: <OF67B4E006.7121C121-ONC12578EF.003DF736-C12578EF.003EADDD@Schneider-Electric.com>
References: <OF67B4E006.7121C121-ONC12578EF.003DF736-C12578EF.003EADDD@Schneider-Electric.com>
Message-ID: <4E4BA72E.20608@rabbitmq.com>

Lars,

On 17/08/11 12:24, lars.ellebo at schneider-electric.com wrote:
> I've noticed that if I as RabbitMQ Admin deletes a User who is currently
> connected to the RabbitMQ,
> this user does not get disconnected but remains connected.
>
> Do any of you know whether there is a way to ensure that deleted users
> gets disconnected immediately if they are connected at deletion time?

After removing the user, simply use rabbitmqctl / the management API / 
the management UI to list the connections, filter them by the removed 
user, and then use 'rabbitmqctl close_connection <connection_pid>' (or 
the equivalent management API/UI action) to close these connections.

Matthias.

From simon at rabbitmq.com  Wed Aug 17 12:38:34 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 17 Aug 2011 12:38:34 +0100
Subject: [rabbitmq-discuss] Auto-disconnecting a deleted user
In-Reply-To: <4E4BA72E.20608@rabbitmq.com>
References: <OF67B4E006.7121C121-ONC12578EF.003DF736-C12578EF.003EADDD@Schneider-Electric.com>
	<4E4BA72E.20608@rabbitmq.com>
Message-ID: <4E4BA83A.20805@rabbitmq.com>

On 17/08/11 12:34, Matthias Radestock wrote:
> After removing the user, simply use rabbitmqctl / the management API /
> the management UI to list the connections, filter them by the removed
> user, and then use 'rabbitmqctl close_connection <connection_pid>' (or
> the equivalent management API/UI action) to close these connections.

rabbitmqctl example for user "test":

rabbitmqctl list_connections user pid | grep -P '^test\t' | cut -f 2 | 
while read pid ; do rabbitmqctl close_connection $pid "You no longer 
exist, go away." ; done

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From kiall at managedit.ie  Wed Aug 17 12:49:52 2011
From: kiall at managedit.ie (Kiall Mac Innes)
Date: Wed, 17 Aug 2011 12:49:52 +0100
Subject: [rabbitmq-discuss] Connect to rabbitmq outside the host
In-Reply-To: <0d391690-f49c-48fa-9563-4bc776d1482b@w11g2000vbp.googlegroups.com>
References: <0d391690-f49c-48fa-9563-4bc776d1482b@w11g2000vbp.googlegroups.com>
Message-ID: <CAGSj+QtW_2VnqASU2OhH3toLg7U-8XmgfDFvCkONrYiLscm6aw@mail.gmail.com>

Have you told the EC2 firewall to allow connections to the rabbitmq ports
like you needed to gain SSH access?

Thanks,
Kiall
On Aug 17, 2011 12:32 p.m., "Andrei Varanovich" <dotnetby at gmail.com> wrote:
> Hello,
>
> I set up rabbitmq on amazon EC2 instance.
>
> env hostname: gives me: ip-10-202-255-xxx
> rabbitmq node : rabbit at ip-10-202-255-xxx
>
> However I want to connect to rabbitmq outside amazon host by using
> public DNS. (say ec2-123.compute-1.amazonaws.com)
>
> Are there any guies for configuring such a scenario?
>
> Thanks,
> Andrei
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110817/7e55aaca/attachment.htm>

From dotnetby at gmail.com  Wed Aug 17 12:58:54 2011
From: dotnetby at gmail.com (Andrei Varanovich)
Date: Wed, 17 Aug 2011 13:58:54 +0200
Subject: [rabbitmq-discuss] Connect to rabbitmq outside the host
In-Reply-To: <CAGSj+QtW_2VnqASU2OhH3toLg7U-8XmgfDFvCkONrYiLscm6aw@mail.gmail.com>
References: <0d391690-f49c-48fa-9563-4bc776d1482b@w11g2000vbp.googlegroups.com>
	<CAGSj+QtW_2VnqASU2OhH3toLg7U-8XmgfDFvCkONrYiLscm6aw@mail.gmail.com>
Message-ID: <CANWvfmAqKgXQT-+pXqEXEYekMFbO0vfggTP=Z8SYQBtF84vCLQ@mail.gmail.com>

Hi Kial,

the following ports are opened in regard to rabbitmq:
4369
5672
5673

I guess the issue is that rabbitmq does not resolve public host names,
because internally I see that the node name is: 'rabbit at ip-10-202-255-xxx'.
So the question is how to map internal node to be resolved outside the
network by DNS?

--Andrei

2011/8/17 Kiall Mac Innes <kiall at managedit.ie>

> Have you told the EC2 firewall to allow connections to the rabbitmq ports
> like you needed to gain SSH access?
>
> Thanks,
> Kiall
> On Aug 17, 2011 12:32 p.m., "Andrei Varanovich" <dotnetby at gmail.com>
> wrote:
> > Hello,
> >
> > I set up rabbitmq on amazon EC2 instance.
> >
> > env hostname: gives me: ip-10-202-255-xxx
> > rabbitmq node : rabbit at ip-10-202-255-xxx
> >
> > However I want to connect to rabbitmq outside amazon host by using
> > public DNS. (say ec2-123.compute-1.amazonaws.com)
> >
> > Are there any guies for configuring such a scenario?
> >
> > Thanks,
> > Andrei
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110817/61c282e4/attachment.htm>

From alfonso.pantoja at gmail.com  Wed Aug 17 13:51:46 2011
From: alfonso.pantoja at gmail.com (Alfonso Pantoja)
Date: Wed, 17 Aug 2011 05:51:46 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ 2.2.0 message delivery issue:
	internal crash
In-Reply-To: <20110817110605.GD1444@rabbitmq.com>
References: <5e41b730-540e-4b16-ae83-aa5dec8758ff@t29g2000vby.googlegroups.com>
	<20110817110605.GD1444@rabbitmq.com>
Message-ID: <f496c770-d863-4254-9395-801023112af7@j1g2000yqn.googlegroups.com>

Matthew,

since an update from 2.2.0 to 2.5.1 is complicated at this moment due
to the change could make some things stop working
(we use a custom mod_rabbitmq in ejabberd) and .NET consumers using
rabbitmq.client.dll library version 2.4.0)
do you know if there is a workaround to solve this issue?

After restarting rabbitMQ the server still does not deliver messages
to the consumer...


On 17 ago, 13:06, Matthew Sackman <matt... at rabbitmq.com> wrote:
> Hi,
>
> On Wed, Aug 17, 2011 at 03:57:30AM -0700, Alfonso Pantoja wrote:
> > We are experiencing an issue with version 2.2.0 which causes to
> > RabbitMQ to not deliver messages to a consumer.
> > The consumer is connected to RabbitMQ and performs a create queue/
> > exchange/binding when it is started but sometimes when there are
> > messages in the queue they are not being delivered by Rabbit.
> > Restarting the consumer (it is a windows service) does not solve the
> > problem and the consumer remains connected but without any message
> > although the queue contains 3000 messages.
>
> I vaguely remember this bug. It has been fixed. The solution would be to
> upgrade to the latest version of RabbitMQ (2.5.1).
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From trefor at tetrabyte.com  Wed Aug 17 14:08:16 2011
From: trefor at tetrabyte.com (TreforT)
Date: Wed, 17 Aug 2011 06:08:16 -0700 (PDT)
Subject: [rabbitmq-discuss] Issues starting RabbitMQ 2.5.1 on Ubuntu
 10.04
In-Reply-To: <32264945.post@talk.nabble.com>
References: <32219482.post@talk.nabble.com> <32232090.post@talk.nabble.com>
	<CABzX+qzHS9+Ve49-T+=XpSfCK=2GmF-MwiH_U1Foka8=QyFU3w@mail.gmail.com>
	<32243347.post@talk.nabble.com>
	<CABzX+qyRG3Ws045s9YqTZm+dTvDp4BfH9F2_Lq4Amikd4bvCWw@mail.gmail.com>
	<32248034.post@talk.nabble.com>
	<CABzX+qyZSczjss8w7KishJ=fjfpAgj_MRvzxhC77OxR-cqhToA@mail.gmail.com>
	<32263012.post@talk.nabble.com> <4E491718.4060401@rabbitmq.com>
	<32264945.post@talk.nabble.com>
Message-ID: <32279519.post@talk.nabble.com>


 So after having Marek kindly have a look at my 1and1 Virtual Private Server
(not to be confused the 1and1's Dynamic Cloud Servers), we came to the
conclusion that RabbitMQ can not run on these systems due to the
non-standard nature of the setup.

So if anyone is thinking of using a 1and1 server to host anything RabbitMQ
related don't use a Virtual Private Server.

I am unaware of any issues on the Dynamic Cloud Servers and was able to
install and run RabbitMQ fine.

thank you all for your help, especially to Marek for all his hard work.

Kind Regards,
Trefor

-- 
View this message in context: http://old.nabble.com/Issues-starting-RabbitMQ-2.5.1-on-Ubuntu-10.04-tp32219482p32279519.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From michael.s.klishin at gmail.com  Wed Aug 17 14:24:10 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 17 Aug 2011 17:24:10 +0400
Subject: [rabbitmq-discuss] Scenario ideas
In-Reply-To: <CAEWH9M_BfTbd0fQTsy4tG3Qtkjj+NWdHU6OKfy0_KR6QENhqHg@mail.gmail.com>
References: <CAEWH9M9P-_HjkqyuFQs6eZXPrtpAZOyTCPKSgM0RV7O_+3SaAQ@mail.gmail.com>
	<4E4B8C58.9050401@rabbitmq.com>
	<CAEWH9M_BfTbd0fQTsy4tG3Qtkjj+NWdHU6OKfy0_KR6QENhqHg@mail.gmail.com>
Message-ID: <CAE3HoVTeaTZn8j5K0_Xm0wjTmdSb1uM6K=fa1gek6F92et238g@mail.gmail.com>

2011/8/17 Pete Kelly <pkelly at gmail.com>

> I think I could have confused the issue here somewhat - because of how the
> tutorials are laid out I mistakenly thought that the consumer could consume
> on a given routing key, rather than the routing key just being a binding
> between an exchange and a queue. So I was thinking I was consuming on a
> routing key, whereas in reality that's not the case.


Pete,

maybe http://bit.ly/amqp-model-explained will help you understand how AMQP
concepts are related to each other. It is just 2-3 pages and won't take long
time to read.

-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110817/d2c7664a/attachment.htm>

From oleksandr.petrov at gmail.com  Wed Aug 17 16:01:15 2011
From: oleksandr.petrov at gmail.com (Alex P)
Date: Wed, 17 Aug 2011 08:01:15 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ-c @ ARM Targets
In-Reply-To: <20547897.765.1313568787115.JavaMail.geo-discussion-forums@yqad28>
References: <20547897.765.1313568787115.JavaMail.geo-discussion-forums@yqad28>
Message-ID: <8051645.1367.1313593275456.JavaMail.geo-discussion-forums@yqlo5>

In case anyone's interested, rabbitmq-c compiled for ARM target quite fine, 
together with examples, it was a matter of configuring using

./configure --host=arm-linux

So far works smoothly, examples do work. 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110817/e15decec/attachment.htm>

From alexis at rabbitmq.com  Wed Aug 17 16:11:27 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Wed, 17 Aug 2011 16:11:27 +0100
Subject: [rabbitmq-discuss] RabbitMQ-c @ ARM Targets
In-Reply-To: <8051645.1367.1313593275456.JavaMail.geo-discussion-forums@yqlo5>
References: <20547897.765.1313568787115.JavaMail.geo-discussion-forums@yqad28>
	<8051645.1367.1313593275456.JavaMail.geo-discussion-forums@yqlo5>
Message-ID: <CACOPnvcbjfNhhWpXaxk=T=yy_oTYoEN4uREGGWFGLFigOdLNcA@mail.gmail.com>

Very cool!

On Wed, Aug 17, 2011 at 4:01 PM, Alex P <oleksandr.petrov at gmail.com> wrote:
> In case anyone's interested, rabbitmq-c compiled for ARM target quite fine,
> together with examples, it was a matter of configuring using
> ./configure --host=arm-linux
>
> So far works smoothly, examples do work.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From p3c at p3-consulting.net  Wed Aug 17 16:16:51 2011
From: p3c at p3-consulting.net (Pascal P)
Date: Wed, 17 Aug 2011 15:16:51 +0000 (UTC)
Subject: [rabbitmq-discuss] RabbitMQ-c @ ARM Targets
References: <20547897.765.1313568787115.JavaMail.geo-discussion-forums@yqad28>
Message-ID: <loom.20110817T171107-993@post.gmane.org>

> Have anyone tried to compile RabbitMQ for ARM targets? 

Don't know for the RabbitMQ code itself but the libamqp C code has problem 
with data alignment in memory: 
the functions generated by the DECLARE_CODEC_BASE_TYPE macro 
generates memory access exception.

However the 2 comments in the source code:
/* assuming a machine that supports unaligned accesses (for now) */
/* assuming little endian (for now) */
are quite explicit about the possible causes of the problem?



From david at rabbitmq.com  Wed Aug 17 16:24:03 2011
From: david at rabbitmq.com (David Wragg)
Date: Wed, 17 Aug 2011 16:24:03 +0100
Subject: [rabbitmq-discuss] RabbitMQ-c @ ARM Targets
In-Reply-To: <8051645.1367.1313593275456.JavaMail.geo-discussion-forums@yqlo5>
	(Alex P.'s message of "Wed, 17 Aug 2011 08:01:15 -0700 (PDT)")
References: <20547897.765.1313568787115.JavaMail.geo-discussion-forums@yqad28>
	<8051645.1367.1313593275456.JavaMail.geo-discussion-forums@yqlo5>
Message-ID: <yrv4cd3g4xdrg.fsf@dwragg.eng.vmware.com>

Hi Alex,

Alex P <oleksandr.petrov at gmail.com> writes:
> In case anyone's interested, rabbitmq-c compiled for ARM target quite
> fine, together with examples, it was a matter of configuring using
>
> ./configure --host=arm-linux
>
> So far works smoothly, examples do work.

I do test on arm-linux occasionally.

But while checking this today, I noticed that the code is relying on the
kernel to fix up unaligned accesses.  An embedded ARM platform might not
do that, and this is bad from a performance standpoint anyway.

And although it would rarely affect ARM, the code assumed a
little-endian platform.

I've committed a fix for both these things.  It's currently on a branch
(<http://hg.rabbitmq.com/rabbitmq-c/rev/8cfbdf1daf45> or
<https://github.com/rabbitmq/rabbitmq-c/tree/bug24349>.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
VMware, Inc.

From simone.busoli at gmail.com  Wed Aug 17 19:12:01 2011
From: simone.busoli at gmail.com (Simone Busoli)
Date: Wed, 17 Aug 2011 20:12:01 +0200
Subject: [rabbitmq-discuss] Italian RabbitMQ meeting proposal
Message-ID: <CAOn7oW9M7CegKCjadjwFUiN=NABbYeDWtr+0bAn65p8UzpKRFw@mail.gmail.com>

Hi, we would like to organize a one-day meeting in Italy about RabbitMQ. There
is no agenda yet, although it would ideally entail real-life experiences and
usage patterns, as well as anything speakers would like to talk about.
Everyone is welcome to attend or speak, and in order to get a sense of how
many people would be attending we've setup a brief survey that I invite you
to take a few seconds to fill at this url:
http://svy.mk/rabbitmq_italian_meeting_survey

Thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110817/533663be/attachment.htm>

From videlalvaro at gmail.com  Wed Aug 17 19:18:11 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 17 Aug 2011 20:18:11 +0200
Subject: [rabbitmq-discuss] Italian RabbitMQ meeting proposal
In-Reply-To: <CAOn7oW9M7CegKCjadjwFUiN=NABbYeDWtr+0bAn65p8UzpKRFw@mail.gmail.com>
References: <CAOn7oW9M7CegKCjadjwFUiN=NABbYeDWtr+0bAn65p8UzpKRFw@mail.gmail.com>
Message-ID: <CAMcAHLVumMNHmsdQRDDzWJ9wiQj8gx3=YV5HhmTOupgbQnVbWA@mail.gmail.com>

Hi Simone,

I think this is a great idea. Count me in since I'm Switzerland it shouldn't
be a problem to reach there.

Cheers,

Alvaro

On Wed, Aug 17, 2011 at 8:12 PM, Simone Busoli <simone.busoli at gmail.com>wrote:

> Hi, we would like to organize a one-day meeting in Italy about RabbitMQ. There
> is no agenda yet, although it would ideally entail real-life experiences and
> usage patterns, as well as anything speakers would like to talk about.
> Everyone is welcome to attend or speak, and in order to get a sense of how
> many people would be attending we've setup a brief survey that I invite you
> to take a few seconds to fill at this url:
> http://svy.mk/rabbitmq_italian_meeting_survey
>
> Thanks
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110817/b72b2b2a/attachment.htm>

From simone.busoli at gmail.com  Wed Aug 17 19:21:47 2011
From: simone.busoli at gmail.com (Simone Busoli)
Date: Wed, 17 Aug 2011 20:21:47 +0200
Subject: [rabbitmq-discuss] Italian RabbitMQ meeting proposal
In-Reply-To: <CAMcAHLVumMNHmsdQRDDzWJ9wiQj8gx3=YV5HhmTOupgbQnVbWA@mail.gmail.com>
References: <CAOn7oW9M7CegKCjadjwFUiN=NABbYeDWtr+0bAn65p8UzpKRFw@mail.gmail.com>
	<CAMcAHLVumMNHmsdQRDDzWJ9wiQj8gx3=YV5HhmTOupgbQnVbWA@mail.gmail.com>
Message-ID: <CAOn7oW9yt9uLwir93GrPzEYy0bQGpP70TX-VcJ2uCdY2zzitWA@mail.gmail.com>

Great to have you on board Alvaro!

On Wed, Aug 17, 2011 at 20:18, Alvaro Videla <videlalvaro at gmail.com> wrote:

> Hi Simone,
>
> I think this is a great idea. Count me in since I'm Switzerland it
> shouldn't be a problem to reach there.
>
> Cheers,
>
> Alvaro
>
> On Wed, Aug 17, 2011 at 8:12 PM, Simone Busoli <simone.busoli at gmail.com>wrote:
>
>>  Hi, we would like to organize a one-day meeting in Italy about RabbitMQ.
>> There is no agenda yet, although it would ideally entail real-life
>> experiences and usage patterns, as well as anything speakers would like to
>> talk about.
>> Everyone is welcome to attend or speak, and in order to get a sense of how
>> many people would be attending we've setup a brief survey that I invite you
>> to take a few seconds to fill at this url:
>> http://svy.mk/rabbitmq_italian_meeting_survey
>>
>> Thanks
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110817/5a999b96/attachment.htm>

From pkelly at gmail.com  Wed Aug 17 19:40:08 2011
From: pkelly at gmail.com (Pete Kelly)
Date: Wed, 17 Aug 2011 19:40:08 +0100
Subject: [rabbitmq-discuss] Scenario ideas
In-Reply-To: <CAE3HoVTeaTZn8j5K0_Xm0wjTmdSb1uM6K=fa1gek6F92et238g@mail.gmail.com>
References: <CAEWH9M9P-_HjkqyuFQs6eZXPrtpAZOyTCPKSgM0RV7O_+3SaAQ@mail.gmail.com>
	<4E4B8C58.9050401@rabbitmq.com>
	<CAEWH9M_BfTbd0fQTsy4tG3Qtkjj+NWdHU6OKfy0_KR6QENhqHg@mail.gmail.com>
	<CAE3HoVTeaTZn8j5K0_Xm0wjTmdSb1uM6K=fa1gek6F92et238g@mail.gmail.com>
Message-ID: <CAEWH9M8NfSkm4XNZSHhYY5ymM_q8GpoQhBYde2uGyEzyOo7aEQ@mail.gmail.com>

On 17 August 2011 14:24, Michael Klishin <michael.s.klishin at gmail.com>wrote:

> 2011/8/17 Pete Kelly <pkelly at gmail.com>
>
>> I think I could have confused the issue here somewhat - because of how the
>> tutorials are laid out I mistakenly thought that the consumer could consume
>> on a given routing key, rather than the routing key just being a binding
>> between an exchange and a queue. So I was thinking I was consuming on a
>> routing key, whereas in reality that's not the case.
>
>
> Pete,
>
> maybe http://bit.ly/amqp-model-explained will help you understand how AMQP
> concepts are related to each other. It is just 2-3 pages and won't take long
> time to read.
>

Thanks for that, just what I was after.


>
> --
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110817/85e0a654/attachment.htm>

From Raymond.Rizzuto at sig.com  Wed Aug 17 18:15:36 2011
From: Raymond.Rizzuto at sig.com (rjrizzuto)
Date: Wed, 17 Aug 2011 10:15:36 -0700 (PDT)
Subject: [rabbitmq-discuss] WCF and queue creation
In-Reply-To: <4C1665A8.8020806@rabbitmq.com>
References: <28842204.post@talk.nabble.com> <4C124AA6.4080105@rabbitmq.com>
	<1753EE61AD475A47A4DEBDD983A7BBCF0B344F91@GBR1-LDN01.uk.mizuho-sc.com>
	<4C1665A8.8020806@rabbitmq.com>
Message-ID: <32281523.post@talk.nabble.com>


We're also considering moving from MSMQ via WCF to RabbitMQ via WCF.  If I
follow this discussion correctly, we also need durable queues.  I.e. we want
to be able to stop and restart either the producer or consumer without
losing data or the queue going away.  Would we need to apply the same patch
to line 171 in RabbitMQInputChannel, or is that now included in the current
version?


Emile Joubert-2 wrote:
> 
> 
> Hi Jonathan,
> 
> 
> On 11/06/10 16:18, Jonathan Graham wrote:
>> Hi Emile,
> 
> 
>> I have two WCF services (let's call them A and B) in an existing
>> application.  I want to send asynchronous, one-way messages from service
>> A to service B.  The operation being invoked on service B can take some
>> time to complete, and service A's call to B is due to an end user
>> initiated operation on A. I don't want to make end users wait for B to
>> complete, hence the asynchronous requirement.  Service B is also a
>> little fragile and is not always available, so I want any messages sent
>> to it to be stored in a durable queue until B is able to process the
>> messages.
> 
> I agree that a one-way (fire & forget) channel is appropriate for your 
> use case. Queue durability alone will not be sufficient to accomplish 
> your goal though, because the service host will need to reconnect to the 
> same queue. If you are comfortable with recompiling the ServiceModel 
> project in order to experiment with a possible approach, try replacing 
> line 171 in RabbitMQInputChannel with:
> 
> string queue = m_model.QueueDeclare(LocalAddress.Uri.AbsolutePath, true);
> 
> This will cause the service queue to have a fixed name and be durable. 
> The queue will then accumulate requests in the event of service B 
> temporarily disconnecting.
> 
> Caveats apply: This code has not been through our formal QA process. It 
> is meant for experimentation only and may break other things.
> 
>> [...] Unfortunately because Rabbit's WCF
>> binding doesn't let us use durable queues, we haven't yet been able to
>> make use of it.
> 
> This is a feature that could be added if there was sufficient demand, 
> but you are the first to suggest it.
> 
>> It looks like the following options are available:
>>
>> 1. Change the way the WCF binding works so that existing queues can be
>> used and/or that queues declared by the binding can be made durable. (As
>> an aside, if I can find the time, I wouldn't mind contributing this
>> change, but I don't have a whole lot of free time at present.)
> 
> I'm hoping that the line of code above gives you a useful place to 
> start. I'd be interested to know if it works for you.
> 
>> 2. No longer implement service B as a WCF service and instead use the
>> RabbitMQ .NET client API to consume messages from RabbitMQ.
> 
> If you are not bound to the strictures of WCF then this can work very 
> simply. There are many examples in the RabbitMQ.Client.Examples that 
> illustrate how to send messages from a message producer to a consumer. 
> You will need to do some of the work that RabbitMQ ServiceModel does for 
> you, such as declaring and binding a queue and structuring the message 
> in the way that the consumer can understand it.
> 
> Regards
> 
> Emile
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://old.nabble.com/WCF-and-queue-creation-tp28842204p32281523.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From oleksandr.petrov at gmail.com  Wed Aug 17 21:25:22 2011
From: oleksandr.petrov at gmail.com (Alex P)
Date: Wed, 17 Aug 2011 13:25:22 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ-c @ ARM Targets
In-Reply-To: <yrv4cd3g4xdrg.fsf@dwragg.eng.vmware.com>
References: <20547897.765.1313568787115.JavaMail.geo-discussion-forums@yqad28>
	<8051645.1367.1313593275456.JavaMail.geo-discussion-forums@yqlo5>
	<yrv4cd3g4xdrg.fsf@dwragg.eng.vmware.com>
Message-ID: <32461430.1923.1313612723031.JavaMail.geo-discussion-forums@yqic12>

Maybe there's something in strace output:

https://gist.github.com/1152511



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110817/9ad3c65d/attachment.htm>

From oleksandr.petrov at gmail.com  Wed Aug 17 22:59:43 2011
From: oleksandr.petrov at gmail.com (Alex P)
Date: Wed, 17 Aug 2011 14:59:43 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ-c @ ARM Targets
In-Reply-To: <yrv4cd3g4xdrg.fsf@dwragg.eng.vmware.com>
References: <20547897.765.1313568787115.JavaMail.geo-discussion-forums@yqad28>
	<8051645.1367.1313593275456.JavaMail.geo-discussion-forums@yqlo5>
	<yrv4cd3g4xdrg.fsf@dwragg.eng.vmware.com>
Message-ID: <32081247.2146.1313618383236.JavaMail.geo-discussion-forums@yqah42>

Some more debug information:

Just tried to run on both x86 and ARM. There's a difference in execution 
flow, even though they connect to the same server from the same subnet.


Similar flow for both:
- goes into while(amqp_data_in_buffer(state))
- receives result from server
- goes to the tick of while(1) loop
- enters while(amqp_data_in_buffer(state)) for the second time

ARM:
- tries to receive result from server again, but recv returns 0, which 
indicates that peer has performed a shutdown

x86:
- (decoded_frame->frame_type != 0) condition is met, so it returns 0 from 
function and moves on to sending log in credentials

If I understand correctly, that comment is relevant to that condition: 
decoded frame type == 0: Returning frame_type of zero indicates either 
insufficient input, or a complete, ignored frame was read.


Also, what I noticed, on ARM machine, inside of amqp_handle_input if 
(state->inbound_offset < state->target_size) is true...

But I'm not sure where to dig further.
Could it be a bug in rabbitmq-c? Or it's more likely something regarding 
cross-compiled lib itself or processor spec ?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110817/a185b538/attachment.htm>

From alfonso.pantoja at gmail.com  Thu Aug 18 08:37:55 2011
From: alfonso.pantoja at gmail.com (Alfonso Pantoja)
Date: Thu, 18 Aug 2011 00:37:55 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ 2.2.0 message delivery issue:
	internal crash
In-Reply-To: <f496c770-d863-4254-9395-801023112af7@j1g2000yqn.googlegroups.com>
References: <5e41b730-540e-4b16-ae83-aa5dec8758ff@t29g2000vby.googlegroups.com>
	<20110817110605.GD1444@rabbitmq.com>
	<f496c770-d863-4254-9395-801023112af7@j1g2000yqn.googlegroups.com>
Message-ID: <036e2ae2-c068-4a6e-b668-8776df328114@18g2000yqu.googlegroups.com>

More info: the issue was "solved" by purging the messages in the
queue.
So I think there is something in them that Rabbit does not like. It is
strange because the messages are sent always the same way so the issue
happens randomly.
The messages are sent using the timestamp (in milliseconds) and
content-type AMQP fields.

We also check that when the issue arises that queue was totally
useless. We removed the bindings and reconnected again the consumer
(which creates the bindings when connected) and saw that rabbit didn't
report any error BUT the bindings were not created (so the create
binding command was accepted but never performed -no exceptions-)




From matthias at rabbitmq.com  Thu Aug 18 09:00:34 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 18 Aug 2011 09:00:34 +0100
Subject: [rabbitmq-discuss] RabbitMQ 2.2.0 message delivery
 issue:	internal crash
In-Reply-To: <036e2ae2-c068-4a6e-b668-8776df328114@18g2000yqu.googlegroups.com>
References: <5e41b730-540e-4b16-ae83-aa5dec8758ff@t29g2000vby.googlegroups.com>	<20110817110605.GD1444@rabbitmq.com>	<f496c770-d863-4254-9395-801023112af7@j1g2000yqn.googlegroups.com>
	<036e2ae2-c068-4a6e-b668-8776df328114@18g2000yqu.googlegroups.com>
Message-ID: <4E4CC6A2.5030600@rabbitmq.com>

Alfonso,

On 18/08/11 08:37, Alfonso Pantoja wrote:
> More info: the issue was "solved" by purging the messages in the
> queue.
> So I think there is something in them that Rabbit does not like.

Yes, that's what Matthew said in his reply.

> It is strange because the messages are sent always the same way so
> the issue happens randomly.

Assuming all messages are sent from mod_ejabberd, I suspect there is 
some variation in the code path there that leads to different data 
ending up in the messages.

> The messages are sent using the timestamp (in milliseconds) and
> content-type AMQP fields.

The source of the problem is almost certainly in mod_rabbitmq or your 
modifications to it.


Matthias.

From david at rabbitmq.com  Thu Aug 18 09:45:59 2011
From: david at rabbitmq.com (David Wragg)
Date: Thu, 18 Aug 2011 09:45:59 +0100
Subject: [rabbitmq-discuss] RabbitMQ-c @ ARM Targets
In-Reply-To: <32081247.2146.1313618383236.JavaMail.geo-discussion-forums@yqah42>
	(Alex P.'s message of "Wed, 17 Aug 2011 14:59:43 -0700 (PDT)")
References: <20547897.765.1313568787115.JavaMail.geo-discussion-forums@yqad28>
	<8051645.1367.1313593275456.JavaMail.geo-discussion-forums@yqlo5>
	<yrv4cd3g4xdrg.fsf@dwragg.eng.vmware.com>
	<32081247.2146.1313618383236.JavaMail.geo-discussion-forums@yqah42>
Message-ID: <yrv4cmxf785vc.fsf@dwragg.eng.vmware.com>

Hi Alex,

Alex P <oleksandr.petrov at gmail.com> writes:
> Just tried to run on both x86 and ARM. There's a difference in execution 
> flow, even though they connect to the same server from the same
> subnet.
> [...]
> But I'm not sure where to dig further.
> Could it be a bug in rabbitmq-c? Or it's more likely something regarding 
> cross-compiled lib itself or processor spec ?

Are you building from the branch mentioned in my other email?  If not,
please do so, and see if you can still reproduce the problem.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
VMware, Inc.

From oleksandr.petrov at gmail.com  Thu Aug 18 10:29:43 2011
From: oleksandr.petrov at gmail.com (Alex P)
Date: Thu, 18 Aug 2011 02:29:43 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ-c @ ARM Targets
In-Reply-To: <yrv4cd3g4xdrg.fsf@dwragg.eng.vmware.com>
References: <20547897.765.1313568787115.JavaMail.geo-discussion-forums@yqad28>
	<8051645.1367.1313593275456.JavaMail.geo-discussion-forums@yqlo5>
	<yrv4cd3g4xdrg.fsf@dwragg.eng.vmware.com>
Message-ID: <308500.2860.1313659783949.JavaMail.geo-discussion-forums@yqlo5>

Hi David,

I've been so sure that I've already switched to that branch that I never 
bothered to check that. Tried everything, but it turned out to be not 
necessary.

Thank you for help, seems that it was exactly the deal. 
Sorry for spamming google group before proper prior check
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110818/7bba66da/attachment.htm>

From michael.s.klishin at gmail.com  Thu Aug 18 10:53:30 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 18 Aug 2011 13:53:30 +0400
Subject: [rabbitmq-discuss] RabbitMQ-c @ ARM Targets
In-Reply-To: <308500.2860.1313659783949.JavaMail.geo-discussion-forums@yqlo5>
References: <20547897.765.1313568787115.JavaMail.geo-discussion-forums@yqad28>
	<8051645.1367.1313593275456.JavaMail.geo-discussion-forums@yqlo5>
	<yrv4cd3g4xdrg.fsf@dwragg.eng.vmware.com>
	<308500.2860.1313659783949.JavaMail.geo-discussion-forums@yqlo5>
Message-ID: <CAE3HoVSTVUiPmd5oEcdcd_nn_YPRO9z=_G7w0YfZEUJbxt0t3A@mail.gmail.com>

2011/8/18 Alex P <oleksandr.petrov at gmail.com>

> Thank you for help, seems that it was exactly the deal.


Maybe that branch should be merged into master/default then ;)
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110818/02a8665a/attachment.htm>

From alexandru at rabbitmq.com  Thu Aug 18 11:01:11 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Thu, 18 Aug 2011 11:01:11 +0100
Subject: [rabbitmq-discuss] RabbitMQ-c @ ARM Targets
In-Reply-To: <CAE3HoVSTVUiPmd5oEcdcd_nn_YPRO9z=_G7w0YfZEUJbxt0t3A@mail.gmail.com>
References: <20547897.765.1313568787115.JavaMail.geo-discussion-forums@yqad28>
	<8051645.1367.1313593275456.JavaMail.geo-discussion-forums@yqlo5>
	<yrv4cd3g4xdrg.fsf@dwragg.eng.vmware.com>
	<308500.2860.1313659783949.JavaMail.geo-discussion-forums@yqlo5>
	<CAE3HoVSTVUiPmd5oEcdcd_nn_YPRO9z=_G7w0YfZEUJbxt0t3A@mail.gmail.com>
Message-ID: <20110818100111.GB3055@dakota.eng.vmware.com>

> Maybe that branch should be merged into master/default then ;)

It's going through QA at the moment.  It will probably be in default
soon.

Cheers,
Alex

On Thu, Aug 18, 2011 at 01:53:30PM +0400, Michael Klishin wrote:
> 2011/8/18 Alex P <oleksandr.petrov at gmail.com>
> 
> > Thank you for help, seems that it was exactly the deal.
> 
> 
> Maybe that branch should be merged into master/default then ;)
> -- 
> MK
> 
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin

> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From emile at rabbitmq.com  Thu Aug 18 11:18:43 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 18 Aug 2011 11:18:43 +0100
Subject: [rabbitmq-discuss] WCF and queue creation
In-Reply-To: <32281523.post@talk.nabble.com>
References: <28842204.post@talk.nabble.com>
	<4C124AA6.4080105@rabbitmq.com>	<1753EE61AD475A47A4DEBDD983A7BBCF0B344F91@GBR1-LDN01.uk.mizuho-sc.com>	<4C1665A8.8020806@rabbitmq.com>
	<32281523.post@talk.nabble.com>
Message-ID: <4E4CE703.3030701@rabbitmq.com>

Hi,

This feature was not added at the time, but since there appears to be
demand for it I will file a bug. If you wish to try the same workaround
that was discussed before then you will need to edit line 153 in
RabbitMQInputChannel:

http://hg.rabbitmq.com/rabbitmq-dotnet-client/file/130a3f3dfa51/projects/wcf/RabbitMQ.ServiceModel/src/serviceModel/RabbitMQInputChannel.cs#l153


Emile


On 17/08/11 18:15, rjrizzuto wrote:
> 
> We're also considering moving from MSMQ via WCF to RabbitMQ via WCF.  If I
> follow this discussion correctly, we also need durable queues.  I.e. we want
> to be able to stop and restart either the producer or consumer without
> losing data or the queue going away.  Would we need to apply the same patch
> to line 171 in RabbitMQInputChannel, or is that now included in the current
> version?
> 
> 
> Emile Joubert-2 wrote:
>>
>>
>> Hi Jonathan,
>>
>>
>> On 11/06/10 16:18, Jonathan Graham wrote:
>>> Hi Emile,
>>
>>
>>> I have two WCF services (let's call them A and B) in an existing
>>> application.  I want to send asynchronous, one-way messages from service
>>> A to service B.  The operation being invoked on service B can take some
>>> time to complete, and service A's call to B is due to an end user
>>> initiated operation on A. I don't want to make end users wait for B to
>>> complete, hence the asynchronous requirement.  Service B is also a
>>> little fragile and is not always available, so I want any messages sent
>>> to it to be stored in a durable queue until B is able to process the
>>> messages.
>>
>> I agree that a one-way (fire & forget) channel is appropriate for your 
>> use case. Queue durability alone will not be sufficient to accomplish 
>> your goal though, because the service host will need to reconnect to the 
>> same queue. If you are comfortable with recompiling the ServiceModel 
>> project in order to experiment with a possible approach, try replacing 
>> line 171 in RabbitMQInputChannel with:
>>
>> string queue = m_model.QueueDeclare(LocalAddress.Uri.AbsolutePath, true);
>>
>> This will cause the service queue to have a fixed name and be durable. 
>> The queue will then accumulate requests in the event of service B 
>> temporarily disconnecting.
>>
>> Caveats apply: This code has not been through our formal QA process. It 
>> is meant for experimentation only and may break other things.
>>
>>> [...] Unfortunately because Rabbit's WCF
>>> binding doesn't let us use durable queues, we haven't yet been able to
>>> make use of it.
>>
>> This is a feature that could be added if there was sufficient demand, 
>> but you are the first to suggest it.
>>
>>> It looks like the following options are available:
>>>
>>> 1. Change the way the WCF binding works so that existing queues can be
>>> used and/or that queues declared by the binding can be made durable. (As
>>> an aside, if I can find the time, I wouldn't mind contributing this
>>> change, but I don't have a whole lot of free time at present.)
>>
>> I'm hoping that the line of code above gives you a useful place to 
>> start. I'd be interested to know if it works for you.
>>
>>> 2. No longer implement service B as a WCF service and instead use the
>>> RabbitMQ .NET client API to consume messages from RabbitMQ.
>>
>> If you are not bound to the strictures of WCF then this can work very 
>> simply. There are many examples in the RabbitMQ.Client.Examples that 
>> illustrate how to send messages from a message producer to a consumer. 
>> You will need to do some of the work that RabbitMQ ServiceModel does for 
>> you, such as declaring and binding a queue and structuring the message 
>> in the way that the consumer can understand it.
>>
>> Regards
>>
>> Emile
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
> 


-- 
Emile Joubert

RabbitMQ
SpringSource, a division of VMware
VMware

From alfonso.pantoja at gmail.com  Thu Aug 18 14:50:52 2011
From: alfonso.pantoja at gmail.com (Alfonso Pantoja)
Date: Thu, 18 Aug 2011 06:50:52 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ 2.2.0 message delivery issue:
	internal crash
In-Reply-To: <4E4CC6A2.5030600@rabbitmq.com>
References: <5e41b730-540e-4b16-ae83-aa5dec8758ff@t29g2000vby.googlegroups.com>
	<20110817110605.GD1444@rabbitmq.com>
	<f496c770-d863-4254-9395-801023112af7@j1g2000yqn.googlegroups.com>
	<036e2ae2-c068-4a6e-b668-8776df328114@18g2000yqu.googlegroups.com>
	<4E4CC6A2.5030600@rabbitmq.com>
Message-ID: <0122a43f-548d-4ae1-a0de-72a449e71cce@b8g2000vbg.googlegroups.com>

Matthias & Matthew thank for your responses.

We are not using any plugin and send  the messages inside mod_rabbitmq
(we customized it a bit)
catching presence and chat messages in order to forward them to a
RabbitMQ queue.
The protocol we use for consume messages is AMQP (v.0_9).

Since the problem was not solved by restarting the broker I thought it
could exist a message corruption (we are using persistent messages)
as you suggested because the problem disappeared when we purged the
queue.
Because this issue does not happen very ofter I'm wondering if you
could suggest what to the check (messages properties use, etc.) or the
possible causes that lead to message corruption (after reading your
responses I  understand that we should review our modifications in
mod_rabbitmq but it would be nice to have a tip to track down that
bug)

Regarding the broker upgrade I would like to know what is the
procedure for upgrading it without losing the messages (all our
messages are persistent).


Thank you in advance.


Regards,

Alfonso

On 18 ago, 10:00, Matthias Radestock <matth... at rabbitmq.com> wrote:
> Alfonso,
>
> On 18/08/11 08:37, Alfonso Pantoja wrote:
>
> > More info: the issue was "solved" by purging the messages in the
> > queue.
> > So I think there is something in them that Rabbit does not like.
>
> Yes, that's what Matthew said in his reply.
>
> > It is strange because the messages are sent always the same way so
> > the issue happens randomly.
>
> Assuming all messages are sent from mod_ejabberd, I suspect there is
> some variation in the code path there that leads to different data
> ending up in the messages.
>
> > The messages are sent using the timestamp (in milliseconds) and
> > content-type AMQP fields.
>
> The source of the problem is almost certainly in mod_rabbitmq or your
> modifications to it.
>
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthias at rabbitmq.com  Thu Aug 18 17:41:52 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 18 Aug 2011 17:41:52 +0100
Subject: [rabbitmq-discuss] RabbitMQ 2.2.0 message delivery
 issue:	internal crash
In-Reply-To: <0122a43f-548d-4ae1-a0de-72a449e71cce@b8g2000vbg.googlegroups.com>
References: <5e41b730-540e-4b16-ae83-aa5dec8758ff@t29g2000vby.googlegroups.com>	<20110817110605.GD1444@rabbitmq.com>	<f496c770-d863-4254-9395-801023112af7@j1g2000yqn.googlegroups.com>	<036e2ae2-c068-4a6e-b668-8776df328114@18g2000yqu.googlegroups.com>	<4E4CC6A2.5030600@rabbitmq.com>
	<0122a43f-548d-4ae1-a0de-72a449e71cce@b8g2000vbg.googlegroups.com>
Message-ID: <4E4D40D0.7080401@rabbitmq.com>

Alfonso,

On 18/08/11 14:50, Alfonso Pantoja wrote:
> Because this issue does not happen very ofter I'm wondering if you
> could suggest what to the check (messages properties use, etc.) or the
> possible causes that lead to message corruption (after reading your
> responses I  understand that we should review our modifications in
> mod_rabbitmq but it would be nice to have a tip to track down that
> bug)

In the original rabbitmq-xmpp code base, the only place for things to go 
wrong is at 
https://github.com/rabbitmq/rabbitmq-xmpp/blob/master/src/mod_rabbitmq.erl#L250. 
That code is bullet proof (famous last words), but I suspect you have 
either modified it or have similar code elsewhere.

The thing to watch out for in particular is what values you place in the 
properties. Their type must correspond to what is expected for the given 
key in the Basic content properties (see 
http://www.rabbitmq.com/amqp-0-9-1-reference.html#class.basic). shortstr 
and longstr must be Erlang binaries. octet, shortint, longint, 
longlongint and timestamp must be Erlang integers. And 'table' must be a 
list of {KeyBinary, TypeAtom, Value}.

> Regarding the broker upgrade I would like to know what is the
> procedure for upgrading it without losing the messages (all our
> messages are persistent).

Simply install the new broker. Persistent messages in durable queues 
will be retained.


Matthias.

From ekirpichov at gmail.com  Thu Aug 18 17:48:48 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Thu, 18 Aug 2011 09:48:48 -0700
Subject: [rabbitmq-discuss] RabbitMQ 2.2.0 message delivery issue:
 internal crash
In-Reply-To: <4E4D40D0.7080401@rabbitmq.com>
References: <5e41b730-540e-4b16-ae83-aa5dec8758ff@t29g2000vby.googlegroups.com>
	<20110817110605.GD1444@rabbitmq.com>
	<f496c770-d863-4254-9395-801023112af7@j1g2000yqn.googlegroups.com>
	<036e2ae2-c068-4a6e-b668-8776df328114@18g2000yqu.googlegroups.com>
	<4E4CC6A2.5030600@rabbitmq.com>
	<0122a43f-548d-4ae1-a0de-72a449e71cce@b8g2000vbg.googlegroups.com>
	<4E4D40D0.7080401@rabbitmq.com>
Message-ID: <CANVKUrW17_rX9guGd7CAteatTT1160NsQSpDUPEg6tOuovZS4g@mail.gmail.com>

On Thu, Aug 18, 2011 at 9:41 AM, Matthias Radestock
<matthias at rabbitmq.com> wrote:
> Alfonso,
>
> On 18/08/11 14:50, Alfonso Pantoja wrote:
>>
>> Because this issue does not happen very ofter I'm wondering if you
>> could suggest what to the check (messages properties use, etc.) or the
>> possible causes that lead to message corruption (after reading your
>> responses I ?understand that we should review our modifications in
>> mod_rabbitmq but it would be nice to have a tip to track down that
>> bug)
>
> In the original rabbitmq-xmpp code base, the only place for things to go
> wrong is at
> https://github.com/rabbitmq/rabbitmq-xmpp/blob/master/src/mod_rabbitmq.erl#L250.
> That code is bullet proof (famous last words), but I suspect you have either
> modified it or have similar code elsewhere.
>
> The thing to watch out for in particular is what values you place in the
> properties. Their type must correspond to what is expected for the given key
> in the Basic content properties (see
> http://www.rabbitmq.com/amqp-0-9-1-reference.html#class.basic). shortstr and
> longstr must be Erlang binaries. octet, shortint, longint, longlongint and
> timestamp must be Erlang integers. And 'table' must be a list of {KeyBinary,
> TypeAtom, Value}.
>
>> Regarding the broker upgrade I would like to know what is the
>> procedure for upgrading it without losing the messages (all our
>> messages are persistent).
>
> Simply install the new broker. Persistent messages in durable queues will be
> retained.

Does this apply to messages from uncommitted transactions or messages
that weren't part of a transaction at all, and haven't been fsync'd
yet?
>
>
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/

From matthias at rabbitmq.com  Thu Aug 18 17:56:10 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 18 Aug 2011 17:56:10 +0100
Subject: [rabbitmq-discuss] RabbitMQ 2.2.0 message delivery issue:
 internal crash
In-Reply-To: <CANVKUrW17_rX9guGd7CAteatTT1160NsQSpDUPEg6tOuovZS4g@mail.gmail.com>
References: <5e41b730-540e-4b16-ae83-aa5dec8758ff@t29g2000vby.googlegroups.com>	<20110817110605.GD1444@rabbitmq.com>	<f496c770-d863-4254-9395-801023112af7@j1g2000yqn.googlegroups.com>	<036e2ae2-c068-4a6e-b668-8776df328114@18g2000yqu.googlegroups.com>	<4E4CC6A2.5030600@rabbitmq.com>	<0122a43f-548d-4ae1-a0de-72a449e71cce@b8g2000vbg.googlegroups.com>	<4E4D40D0.7080401@rabbitmq.com>
	<CANVKUrW17_rX9guGd7CAteatTT1160NsQSpDUPEg6tOuovZS4g@mail.gmail.com>
Message-ID: <4E4D442A.3060502@rabbitmq.com>

On 18/08/11 17:48, Eugene Kirpichov wrote:
> Does this apply to messages from uncommitted transactions or messages
> that weren't part of a transaction at all, and haven't been fsync'd
> yet?

Restarting the broker will abort any uncommitted transactions. As for 
other messages, unless the client asked for confirmation (and received 
it) how would it even know the messages made it to the broker, let alone 
were flushed to disk? So all messages for which the client has received 
confirmation will be retained, unless of course they have since been 
sent to a consumer and acknowledged. For other messages all bets are off.

Matthias.

From gmr at myyearbook.com  Thu Aug 18 18:19:29 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Thu, 18 Aug 2011 13:19:29 -0400
Subject: [rabbitmq-discuss] Cluster Issue in Management UI
Message-ID: <16BCA97BD9C94D7499B18129F85A0EAF@myyearbook.com>

 I've got a production cluster running with an approximately 120 day uptime. When I jumped in the Management UI today I noticed that it is out of sync on different nodes. 

For example, node 1 doesn't see queues on node 3, however node 2 does. Node 1 does see node 3's connections and channels, however. It does not seem to impact the production use of the cluster beyond the Management UI, though I've not tried to use node 3's queues from node1. I imagine that'd fail as well.

Is there a way in erl using rmsh to get node1 to resync queues? Any data I can provide to help track back why this has happened?

Thanks,

Gavin 



From simon at rabbitmq.com  Thu Aug 18 18:31:46 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 18 Aug 2011 18:31:46 +0100
Subject: [rabbitmq-discuss] Cluster Issue in Management UI
In-Reply-To: <16BCA97BD9C94D7499B18129F85A0EAF@myyearbook.com>
References: <16BCA97BD9C94D7499B18129F85A0EAF@myyearbook.com>
Message-ID: <4E4D4C82.9040901@rabbitmq.com>

On 18/08/11 18:19, Gavin M. Roy wrote:
> For example, node 1 doesn't see queues on node 3, however node 2
> does. Node 1 does see node 3's connections and channels, however. It
> does not seem to impact the production use of the cluster beyond the
> Management UI, though I've not tried to use node 3's queues from
> node1. I imagine that'd fail as well.

Weird.

Some of the things you see in mgmt come from Mnesia, and some from the 
management statistics database.

What you're seeing makes it sound like all the nodes in the cluster are 
sharing the same stats DB (as they should), but somehow Mnesia has 
become partitioned with node 1 being separate from node 2 and node 3. 
Needless to say, this should not happen.

To verify this, when you say "node 1 doesn't see queues on node 3", does 
this also apply to exchanges, users and vhosts? What does rabbitmqctl 
status (pre 2.5) / cluster_status (2.5) say on each node?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From gmr at myyearbook.com  Thu Aug 18 19:03:13 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Thu, 18 Aug 2011 14:03:13 -0400
Subject: [rabbitmq-discuss] Cluster Issue in Management UI
In-Reply-To: <4E4D4C82.9040901@rabbitmq.com>
References: <16BCA97BD9C94D7499B18129F85A0EAF@myyearbook.com>
	<4E4D4C82.9040901@rabbitmq.com>
Message-ID: <D4B05724181E4F1C850818CC9745801C@myyearbook.com>



On Thursday, August 18, 2011 at 1:31 PM, Simon MacMullen wrote:

> On 18/08/11 18:19, Gavin M. Roy wrote:
> To verify this, when you say "node 1 doesn't see queues on node 3", does 
> this also apply to exchanges, users and vhosts?
All but queues are declared on node 1
>  What does rabbitmqctl 
> status (pre 2.5) / cluster_status (2.5) say on each node?
https://gmr.privatepaste.com/cd80f19264 

Thanks,

Gavin

From matthias at rabbitmq.com  Thu Aug 18 21:36:16 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 18 Aug 2011 21:36:16 +0100
Subject: [rabbitmq-discuss] Cluster Issue in Management UI
In-Reply-To: <D4B05724181E4F1C850818CC9745801C@myyearbook.com>
References: <16BCA97BD9C94D7499B18129F85A0EAF@myyearbook.com>	<4E4D4C82.9040901@rabbitmq.com>
	<D4B05724181E4F1C850818CC9745801C@myyearbook.com>
Message-ID: <4E4D77C0.5000401@rabbitmq.com>

Gavin,

On 18/08/11 19:03, Gavin M. Roy wrote:
> On Thursday, August 18, 2011 at 1:31 PM, Simon MacMullen wrote:
>>   What does rabbitmqctl
>> status (pre 2.5) / cluster_status (2.5) say on each node?
> https://gmr.privatepaste.com/cd80f19264

Looks like node #2 and node #3 have lost contact with node #5. Is there 
anything interesting in the logs of these nodes?

Matthias.

From utebachmeier at gmail.com  Thu Aug 18 20:38:47 2011
From: utebachmeier at gmail.com (Sabrina Friedman)
Date: Thu, 18 Aug 2011 22:38:47 +0300
Subject: [rabbitmq-discuss]  Message payload encodingfrom Sabrina
Message-ID: <CAJmcYhaiE9TvxDLBmStU_9bsVz-cfEdL7pBRDLTay4L+88k-1w@mail.gmail.com>

On 29/07/11 19:00, Helena Edelson wrote:
> UTF-8 or base64

I'm curious - those are the two options supported by the management
plugin - are you sending messages through that?

If so, the idea is that UTF-8 is more convenient if your message payload
is a string, but if your message needs to contain arbitrary binary
content then we need to encode it somehow (as the message will end up as
a string in a JSON document).

If you're using AMQP then this doesn't apply, the message contents can
be any binary, and using base64 encoding would be an odd choice!

It you are sending messages via the management API, be aware that it's
designed for testing / diagnostics / experimentation - performance is
not great, and there's no way to get greater reliability than consuming
with noack.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware


Sabrina Friedman
Billige Fl?ge Marketing GmbH
Emanuelstr. 3,
10317 Berlin
Deutschland
Telefon: +49 (33) 5310967
Email: utebachmeier at gmail.com
Site: http://flug.airego.de - Billige Fl?ge vergleichen

From fangbot at gmail.com  Fri Aug 19 00:51:49 2011
From: fangbot at gmail.com (fangbot)
Date: Thu, 18 Aug 2011 16:51:49 -0700 (PDT)
Subject: [rabbitmq-discuss] Consumer Callback
In-Reply-To: <4E4AC9AB.1070408@rabbitmq.com>
References: <32103305.post@talk.nabble.com>
	<9E349AF4-25D2-4871-8E6E-ECF2528A25A9@rabbitmq.com>
	<32143565.post@talk.nabble.com>
	<1C266D3D-0BD7-4422-ABA5-5DC944491D8A@rabbitmq.com>
	<32238474.post@talk.nabble.com>
	<E62CF240-8CCF-45A0-917F-A94A2ECC95C5@rabbitmq.com>
	<32274171.post@talk.nabble.com> <4E4AC9AB.1070408@rabbitmq.com>
Message-ID: <32291680.post@talk.nabble.com>


Thanks Matthias,

This makes sense. My goal now is to be able to send both persistent AND
non-persistent messages to a single consumer. In this case, I want to turn
auto-acknowledge off so I can acknowledge the messages after I process them,
in my code. However, I do not wish to send those acknowledgements if the
message I receive is a non-persistent message. 

My questions are:

1. Does this implementation make sense? In other words, what if I just
acknowledged ALL messages, including non-persistent messages? Will
acknowledging non-persistent messages have a noticeable performance impact
on the throughput speeds?
2. With auto-ack turned on, will a persistent message get ack'ed upon
arrival to a queue, or when a QueueingConsumer calls nextDelivery()? In
other words, if I have a consumer binded to a queue, and a persistent
message gets sent to that queue but the QueueingConsumer does not call
nextDelivery(), and I shut down the server, will the message get persisted
to mnesia?

Thanks
-- 
View this message in context: http://old.nabble.com/Consumer-Callback-tp32103305p32291680.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From matthias at rabbitmq.com  Fri Aug 19 04:22:33 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 19 Aug 2011 04:22:33 +0100
Subject: [rabbitmq-discuss] Consumer Callback
In-Reply-To: <32291680.post@talk.nabble.com>
References: <32103305.post@talk.nabble.com>	<9E349AF4-25D2-4871-8E6E-ECF2528A25A9@rabbitmq.com>	<32143565.post@talk.nabble.com>	<1C266D3D-0BD7-4422-ABA5-5DC944491D8A@rabbitmq.com>	<32238474.post@talk.nabble.com>	<E62CF240-8CCF-45A0-917F-A94A2ECC95C5@rabbitmq.com>	<32274171.post@talk.nabble.com>
	<4E4AC9AB.1070408@rabbitmq.com> <32291680.post@talk.nabble.com>
Message-ID: <4E4DD6F9.3040306@rabbitmq.com>

On 19/08/11 00:51, fangbot wrote:
> This makes sense. My goal now is to be able to send both persistent AND
> non-persistent messages to a single consumer. In this case, I want to turn
> auto-acknowledge off so I can acknowledge the messages after I process them,
> in my code. However, I do not wish to send those acknowledgements if the
> message I receive is a non-persistent message.

It's fine to send a mixture of persistent and non-persistent messages to 
a queue, and subsequently consume them. What you cannot do though is 
choose which messages need acknowledgement - that's solely determined by 
the consumer, i.e. whether it is consuming in ack or no-ack mode.

> 1. what if I just acknowledged ALL messages, including non-persistent
> messages? Will acknowledging non-persistent messages have a
> noticeable performance impact on the throughput speeds?

There is certainly a performance penalty for using acks. It's not 
massive though.

> 2. With auto-ack turned on, will a persistent message get ack'ed upon
> arrival to a queue, or when a QueueingConsumer calls nextDelivery()? In
> other words, if I have a consumer binded to a queue, and a persistent
> message gets sent to that queue but the QueueingConsumer does not call
> nextDelivery(), and I shut down the server, will the message get persisted
> to mnesia?

The auto-ack'ing happens when the message is sent to the consumer, since 
only at that point the queue knows what kind of consumer - ack'ing or 
not - the message is being sent to.

Note though that QueuingConsumer is a client-side construct. It queues 
the messages in the client that it was sent from the server. 
nextDelivery() does not interact with the server; it simply dequeues the 
next message from the client-side queue, or waits for more messages to 
arrive. If consuming in auto-ack mode, all such locally queued messages, 
and all messages "in flight" will be lost when the 
client/connection/server dies or is restarted since, as far as the 
server is concerned, they were auto-ack'ed when they were sent to the 
client and hence are no longer held in the (server) queue.

A clean shutdown of the broker will ensure all persistent messages held 
in queues are stored on disk, including those that have been sent to 
clients and are awaiting acknowledgement (i.e. were sent to consumers in 
'ack' mode).

[minor point of correctness: messages are not stored in mnesia but a 
custom high-performance message store (which does keep its data in files 
in the mnesia directory hierarchy, even though it has nothing to do with 
mnesia)]

Regards,

Matthias.

From dominic at rightscale.com  Fri Aug 19 00:48:23 2011
From: dominic at rightscale.com (Dominic Metzger)
Date: Thu, 18 Aug 2011 16:48:23 -0700
Subject: [rabbitmq-discuss] missing header frame
Message-ID: <CAH00K+PiJ5O_F8FhwPQoQ3pHahBu4iyMDr7GO4CgnvMvbRMN8g@mail.gmail.com>

Hi everybody

Is there a valid case when I wouldn't receive a header frame? Does it have
something to do with the redelivery of the message? I am seeing this on
RabbitMQ version (v1.7.2).

Example:

["receive",
 #<AMQP::Frame::Method:0x11d58b24
  @channel=1,
  @payload=
   #<AMQP::Protocol::Basic::Deliver:0x11d58660
    @consumer_tag="example.com-events--588378867313",
    @debug=1,
    @delivery_tag=7700,
    @exchange="events",
    @redelivered=true,
    @routing_key="">>]

["receive",
 #<AMQP::Frame::Body:0x11aa54f4
  @channel=1,
  @payload=
   "{\"timestamp\":1313535484445309}">]


thanks & best regards

dominic
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110818/57aed489/attachment.htm>

From michael.s.klishin at gmail.com  Fri Aug 19 05:39:18 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 19 Aug 2011 08:39:18 +0400
Subject: [rabbitmq-discuss] missing header frame
In-Reply-To: <CAH00K+PiJ5O_F8FhwPQoQ3pHahBu4iyMDr7GO4CgnvMvbRMN8g@mail.gmail.com>
References: <CAH00K+PiJ5O_F8FhwPQoQ3pHahBu4iyMDr7GO4CgnvMvbRMN8g@mail.gmail.com>
Message-ID: <CAE3HoVR7iqthSvUi49b-GS=y5+m_JyuKDdLKrL8DTZ1oRL_eVQ@mail.gmail.com>

2011/8/19 Dominic Metzger <dominic at rightscale.com>

> Is there a valid case when I wouldn't receive a header frame? Does it have
> something to do with the redelivery of the message? I am seeing this on
> RabbitMQ version (v1.7.2).
>
> Example:
>
> ["receive",
>  #<AMQP::Frame::Method:0x11d58b24
>   @channel=1,
>   @payload=
>    #<AMQP::Protocol::Basic::Deliver:0x11d58660
>     @consumer_tag="example.com-events--588378867313",
>     @debug=1,
>     @delivery_tag=7700,
>     @exchange="events",
>     @redelivered=true,
>     @routing_key="">>]
>
> ["receive",
>  #<AMQP::Frame::Body:0x11aa54f4
>   @channel=1,
>   @payload=
>    "{\"timestamp\":1313535484445309}">]
>
>
> thanks & best regards
>

I haven't read AMQP 0.8 spec (which is what amqp gem before 0.8.0.RCs
implements) in a while but I cannot think of a case when the header may be
missing. My only suggestion is to not rely on "logging" of various clients
because they use different frame class names, framing strategies and so on.
Use Wireshark, it will tell you what is really going up and down the wire.
And, maybe upgrade to RabbitMQ 2.5.1 that still supports AMQP 0.8 as well as
AMQP 0.9.1.

-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110819/d052f9d6/attachment.htm>

From andrea.rosa at hp.com  Fri Aug 19 11:27:28 2011
From: andrea.rosa at hp.com (Rosa, Andrea)
Date: Fri, 19 Aug 2011 11:27:28 +0100
Subject: [rabbitmq-discuss] Consumer without a valid connection
Message-ID: <8097A4E725D78E41A8B862ACE60E963945EF8F7780@GVW1355EXB.americas.hpqcorp.net>

Hi

In my application we are using publisher and subscriber (consumer) pattern but we have an odd problem with some consumers.
In the normal scenario we have publishers sending messages on a topic exchange which is bound to a queue and a consumer.
For some reason, that we can't understand, we have got a queue with two consumers and one of this consumer is using a channel of a connection that is not present in the list of connections.
When the publisher send a message to that queue the message is grabbed from the queue after 15 minutes!
My questions are:

-        How is it possible that the consumer is using a channel on a connection that no more  exists?

-        Why there is this delay in grabbing messages? My expectation is that the consumer listening to the correct connection can fetch the message immediately

-        The "wrong" consumer can block the access to the queue?
Our queue are declared as:
Durable = false
Exclusive = false
autoDelete = false

Kind regards
--
Andrea
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110819/5c5bac66/attachment.htm>

From emile at rabbitmq.com  Fri Aug 19 12:14:13 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 19 Aug 2011 12:14:13 +0100
Subject: [rabbitmq-discuss] Consumer without a valid connection
In-Reply-To: <8097A4E725D78E41A8B862ACE60E963945EF8F7780@GVW1355EXB.americas.hpqcorp.net>
References: <8097A4E725D78E41A8B862ACE60E963945EF8F7780@GVW1355EXB.americas.hpqcorp.net>
Message-ID: <4E4E4585.2010309@rabbitmq.com>


Hi Andrea,

On 19/08/11 11:27, Rosa, Andrea wrote:

> For some reason, that we can?t understand, we have got a queue with two
> consumers and one of this consumer is using a channel of a connection
> that is not present in the list of connections.

That should not be possible. If you check the connection pid of each
channel with "rabbitmqctl list_channels connection" each of them should
appear in the output of "rabbitmqctl list_connections pid". Is that not
the case?

The output of "rabbitmqctl report" will also contain this information.

> When the publisher send a message to that queue the message is grabbed
> from the queue after 15 minutes!

There are a few ways to diagnose who is responsible for that delay. You
could make all connections via the AMQP Tracer:
http://www.rabbitmq.com/javadoc/com/rabbitmq/tools/Tracer.html

You could observe the AMQP exchanges on the network between the broker
and peers using a protocol analyser, such as Wireshark.

Also consider debugging with the Firehose, which lets you observe
messages entering and leaving the broker. Avoid the network when
consuming the firehose messages. For details see
http://www.rabbitmq.com/firehose.html

> My questions are:
> 
> -        How is it possible that the consumer is using a channel on a
> connection that no more  exists?
> 
> -        Why there is this delay in grabbing messages? My expectation is
> that the consumer listening to the correct connection can fetch the
> message immediately
> 
> -        The ?wrong? consumer can block the access to the queue?

Is the network between the broker and peers reliable? Consider turning
on AMQP heartbeats if the broker and peers do not about connections.


Emile


From matthias at rabbitmq.com  Fri Aug 19 12:47:20 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 19 Aug 2011 12:47:20 +0100
Subject: [rabbitmq-discuss] Connect to rabbitmq outside the host
In-Reply-To: <CANWvfmAqKgXQT-+pXqEXEYekMFbO0vfggTP=Z8SYQBtF84vCLQ@mail.gmail.com>
References: <0d391690-f49c-48fa-9563-4bc776d1482b@w11g2000vbp.googlegroups.com>	<CAGSj+QtW_2VnqASU2OhH3toLg7U-8XmgfDFvCkONrYiLscm6aw@mail.gmail.com>
	<CANWvfmAqKgXQT-+pXqEXEYekMFbO0vfggTP=Z8SYQBtF84vCLQ@mail.gmail.com>
Message-ID: <4E4E4D48.8070601@rabbitmq.com>

Andrei,

On 17/08/11 12:58, Andrei Varanovich wrote:
> the following ports are opened in regard to rabbitmq:
> 4369
> 5672
> 5673
>
> I guess the issue is that rabbitmq does not resolve public host names,
> because internally I see that the node name is:
> 'rabbit at ip-10-202-255-xxx'. So the question is how to map internal node
> to be resolved outside the network by DNS?

What are you actually trying to do? Establish AMQP connections from 
clients outside amazon to your broker inside amazon? The internal host 
name is irrelevant for that.

Matthias.

From videlalvaro at gmail.com  Fri Aug 19 12:53:25 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 19 Aug 2011 13:53:25 +0200
Subject: [rabbitmq-discuss] Connect to rabbitmq outside the host
In-Reply-To: <4E4E4D48.8070601@rabbitmq.com>
References: <0d391690-f49c-48fa-9563-4bc776d1482b@w11g2000vbp.googlegroups.com>
	<CAGSj+QtW_2VnqASU2OhH3toLg7U-8XmgfDFvCkONrYiLscm6aw@mail.gmail.com>
	<CANWvfmAqKgXQT-+pXqEXEYekMFbO0vfggTP=Z8SYQBtF84vCLQ@mail.gmail.com>
	<4E4E4D48.8070601@rabbitmq.com>
Message-ID: <CAMcAHLUM+YNnf7WFooskG_t9hma7HCzmCuUxxNzQOBJ7qwew+g@mail.gmail.com>

You only need to "resolve" those host names if you were clustering those
servers. So to one be able to see each other then that would probably
matter.

To open an AMQP connection just do an ifconfig and get your external IP.
Then connect to that using the enabled Port.

Try something like: telnet your-ip the-port and see what happens

On Fri, Aug 19, 2011 at 1:47 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Andrei,
>
>
> On 17/08/11 12:58, Andrei Varanovich wrote:
>
>> the following ports are opened in regard to rabbitmq:
>> 4369
>> 5672
>> 5673
>>
>> I guess the issue is that rabbitmq does not resolve public host names,
>> because internally I see that the node name is:
>> 'rabbit at ip-10-202-255-xxx'. So the question is how to map internal node
>> to be resolved outside the network by DNS?
>>
>
> What are you actually trying to do? Establish AMQP connections from clients
> outside amazon to your broker inside amazon? The internal host name is
> irrelevant for that.
>
> Matthias.
>
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110819/effdef33/attachment.htm>

From ludy at wawame.cn  Fri Aug 19 13:55:11 2011
From: ludy at wawame.cn (=?gb2312?B?wr3UxsH6?=)
Date: Fri, 19 Aug 2011 20:55:11 +0800
Subject: [rabbitmq-discuss] a shared queue problem
Message-ID: <3D75C83F3309AD49B85235E67900808304E32A@mail.wawame.cn>


on java api guide page ,you can find that If several clients want to share a queue with a well-known name, this code would be appropriate:

channel.exchangeDeclare(exchangeName, "direct", true);
channel.queueDeclare(queueName, true, false, false, null);
channel.queueBind(queueName, exchangeName, routingKey);

when i do that one routingKey is aa,another is bb,start aa first,then start bb,when i send message by routing bb,the first routingKey aa client receives the message,but the message i want to send to routingKey bb client.

start aa routingKey client--->start bb routingKey client--->send routingKey bb message--->routingKey aa receive the message--->send routingKey bb message--->routingKey bb receive the message--...
why message is not arrive the correct client by routingKey???
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110819/adf1b7f1/attachment.htm>

From matthew at rabbitmq.com  Fri Aug 19 15:08:57 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 19 Aug 2011 15:08:57 +0100
Subject: [rabbitmq-discuss] Configure VM memory high watermark
In-Reply-To: <6FC2A47F1B2CCC4C804736A81522E83018932E5382@Y000IMRV02.rd1.rf1>
References: <6FC2A47F1B2CCC4C804736A81522E83018932E4F86@Y000IMRV02.rd1.rf1>
	<20110811162322.GJ7618@rabbitmq.com>
	<6FC2A47F1B2CCC4C804736A81522E83018932E5382@Y000IMRV02.rd1.rf1>
Message-ID: <20110819140857.GB5436@wellquite.org>

Hi Sylvain,

On Tue, Aug 16, 2011 at 10:27:20AM +0200, CORDIER-AKKA Sylvain (MORPHO) wrote:
> Our RabbitMQ host has got 64GB installed RAM and RabbitMQ server
> process uses in normal use about 5GB of RAM.  The normal use point is
> just above the 8% of installed RAM (8% of 64GB is 5.12GB) and a small
> variation of the use point makes the RabbitMQ starts paging messages
> and causes a final system slowdown.
> 
> If the vm_memory_high_watermark is not the good solution, what are the
> available solutions?
> Increase the amount of installed RAM to 96GB for the system starts
> paging at 7.68GB?
> Isn't there another way to delay RabbitMQ to start swapping?

Well. The thing that Rabbit is trying to ensure is that should RAM
continue to be eaten up, by the time it gets to around 26GB used,
everything should be safely on disk and that the transition to putting
things onto disk is a smooth one. Obviously, unless you have insanely
fast disks, writing out 26GB of messages to disk takes some time, which
is why Rabbit starts writing out quite early on.

The use of 0.4 as the default highwater mark is based on the fear that
GC by the Erlang VM could cause a tempory spike of near double the
amount of RAM in the machine. As the amount of RAM you have installed
gets greater and greater, I'd have thought the odds of there being such
a spike reduces. Thus maybe in such machines, a much higher highwater
mark would be reasonable.

If you have the time, what I'd suggest is that you try with the
watermark much higher (say, 0.8) and then stress test it and see if you
can get Rabbit/Erlang to fail (most likely it'll be a a "cannot allocate
X bytes" malloc-style failure). Reduce the watermark and repeat until
you have confidence that for your use case, there will be no fatal
spikes and you still have utilisation of RAM that you're happy with.

Matthew

From vbernard42 at gmail.com  Fri Aug 19 15:28:19 2011
From: vbernard42 at gmail.com (Valentin Bernard)
Date: Fri, 19 Aug 2011 07:28:19 -0700 (PDT)
Subject: [rabbitmq-discuss] a shared queue problem
In-Reply-To: <3D75C83F3309AD49B85235E67900808304E32A@mail.wawame.cn>
References: <3D75C83F3309AD49B85235E67900808304E32A@mail.wawame.cn>
Message-ID: <e575aa91-6569-46ce-9487-b348676ed1fe@bl1g2000vbb.googlegroups.com>

Hi,

The routing key determines the way your exchange will route your
messages to your queues. What you are doing is binding one queue to
one exchange with two routing keys, "aa" and "bb" -- that is, the
message will be routed to your queue if you send a message with the
routing key "aa" or "bb".

Then, you have two clients consuming your queue. In that case, the
messages will be delivered in a round-robin fashion: your first client
will get the first message, then your second client will get the
second message, and so on.

What you probably want to do is creating two queues, each with one
routing key, and make your clients consume only one of these queues.

Regards,

Valentin.

On Aug 19, 2:55 pm, ??? <l... at wawame.cn> wrote:
> on java api guide page ,you can find that If several clients want to share a queue with a well-known name, this code would be appropriate:
>
> channel.exchangeDeclare(exchangeName, "direct", true);
> channel.queueDeclare(queueName, true, false, false, null);
> channel.queueBind(queueName, exchangeName, routingKey);
>
> when i do that one routingKey is aa,another is bb,start aa first,then start bb,when i send message by routing bb,the first routingKey aa client receives the message,but the message i want to send to routingKey bb client.
>
> start aa routingKey client--->start bb routingKey client--->send routingKey bb message--->routingKey aa receive the message--->send routingKey bb message--->routingKey bb receive the message--...
> why message is not arrive the correct client by routingKey???
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From jeff at ocjtech.us  Fri Aug 19 18:50:59 2011
From: jeff at ocjtech.us (Jeffrey Ollie)
Date: Fri, 19 Aug 2011 12:50:59 -0500
Subject: [rabbitmq-discuss] Spec file for txAMQP?
Message-ID: <CAD-DQxRMTP+S1s7TFP3-2r8LoA1rmG2di9TeoxLqKHOOPxrhpg@mail.gmail.com>

Is there a recommended XML spec file to use with txAMQP and RabbitMQ?
The spec files that I have found so far either don't work with
RabbitMQ or don't contain definitions for some of the newer
functionality.

-- 
Jeff Ollie

From dotnetby at gmail.com  Fri Aug 19 20:01:32 2011
From: dotnetby at gmail.com (Andrei Varanovich)
Date: Fri, 19 Aug 2011 21:01:32 +0200
Subject: [rabbitmq-discuss] Connect to rabbitmq outside the host
In-Reply-To: <CAMcAHLUM+YNnf7WFooskG_t9hma7HCzmCuUxxNzQOBJ7qwew+g@mail.gmail.com>
References: <0d391690-f49c-48fa-9563-4bc776d1482b@w11g2000vbp.googlegroups.com>
	<CAGSj+QtW_2VnqASU2OhH3toLg7U-8XmgfDFvCkONrYiLscm6aw@mail.gmail.com>
	<CANWvfmAqKgXQT-+pXqEXEYekMFbO0vfggTP=Z8SYQBtF84vCLQ@mail.gmail.com>
	<4E4E4D48.8070601@rabbitmq.com>
	<CAMcAHLUM+YNnf7WFooskG_t9hma7HCzmCuUxxNzQOBJ7qwew+g@mail.gmail.com>
Message-ID: <CANWvfmCAh8p2gCzX+FUs5+c+Pa0qf7GTpPO4a_NVjZbz=GhgdQ@mail.gmail.com>

Alvaro, Matthias,

Thanks for your replies!

Yes you understood me correctly, I want to connect to the broker (which is
inside amazon) from the client outside.
I also realized myself that using an external IP I can connect, and this is
what you are also pointing out; however is that still possible to use FQDN,
and not IP address in the "external" connections? At the moment only IP
address works for me.

Thanks,
Andrei

2011/8/19 Alvaro Videla <videlalvaro at gmail.com>

> You only need to "resolve" those host names if you were clustering those
> servers. So to one be able to see each other then that would probably
> matter.
>
> To open an AMQP connection just do an ifconfig and get your external IP.
> Then connect to that using the enabled Port.
>
> Try something like: telnet your-ip the-port and see what happens
>
> On Fri, Aug 19, 2011 at 1:47 PM, Matthias Radestock <matthias at rabbitmq.com
> > wrote:
>
>> Andrei,
>>
>>
>> On 17/08/11 12:58, Andrei Varanovich wrote:
>>
>>> the following ports are opened in regard to rabbitmq:
>>> 4369
>>> 5672
>>> 5673
>>>
>>> I guess the issue is that rabbitmq does not resolve public host names,
>>> because internally I see that the node name is:
>>> 'rabbit at ip-10-202-255-xxx'. So the question is how to map internal node
>>> to be resolved outside the network by DNS?
>>>
>>
>> What are you actually trying to do? Establish AMQP connections from
>> clients outside amazon to your broker inside amazon? The internal host name
>> is irrelevant for that.
>>
>> Matthias.
>>
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110819/951ccac6/attachment.htm>

From gmr at myyearbook.com  Fri Aug 19 21:20:05 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Fri, 19 Aug 2011 16:20:05 -0400
Subject: [rabbitmq-discuss] Mochiweb MAX_RECV_BODY and JSON_RPC plugin
Message-ID: <3ACD8673BEFF41AFB95B660FFA683968@myyearbook.com>

 Ran into an unintended snag with JSON Channel RPC with regard to a mochiweb limitation. 

Mochiweb has a hardcoded constant for the maximum body size for a request at 1MB:

https://github.com/mochi/mochiweb/blob/master/src/mochiweb_request.erl#L47

This is a problem when you're trying to POST messages that are larger than 1MB.

The fix is relatively easy, but I wanted to find out if there was any patching of mochiweb prior to making the mochiweb.ez file or is the file just provided for convenience and providing a tagged supported version. That is, if I recompile it with the # I want, can I just go from the vanilla mochiweb repo?

Thanks,

Gavin 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110819/c7362ea2/attachment.htm>

From alexis at rabbitmq.com  Sat Aug 20 19:59:11 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Sat, 20 Aug 2011 19:59:11 +0100
Subject: [rabbitmq-discuss] Spec file for txAMQP?
In-Reply-To: <CAD-DQxRMTP+S1s7TFP3-2r8LoA1rmG2di9TeoxLqKHOOPxrhpg@mail.gmail.com>
References: <CAD-DQxRMTP+S1s7TFP3-2r8LoA1rmG2di9TeoxLqKHOOPxrhpg@mail.gmail.com>
Message-ID: <CACOPnveGb-o=wfrUow8iMX4snhTMmod=9ozFojgdvVKh3MNPKg@mail.gmail.com>

Jeff,

Which ones have you tried to use?

alexis


On Fri, Aug 19, 2011 at 6:50 PM, Jeffrey Ollie <jeff at ocjtech.us> wrote:
> Is there a recommended XML spec file to use with txAMQP and RabbitMQ?
> The spec files that I have found so far either don't work with
> RabbitMQ or don't contain definitions for some of the newer
> functionality.
>
> --
> Jeff Ollie
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From jonathan.hursey at adrevolution.com  Sun Aug 21 12:43:22 2011
From: jonathan.hursey at adrevolution.com (Jonathan Hursey)
Date: Sun, 21 Aug 2011 06:43:22 -0500
Subject: [rabbitmq-discuss] rabbitmq
Message-ID: <CAEw+mRdF+o3eE3dcxKJ6T=6F7JsNQ9FkhRgN4O-4xbMEieNVOA@mail.gmail.com>

New to rabbitmq, so far I'm loving it. ANy pointers you can give me ?
Thanks!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110821/79847840/attachment.htm>

From michael.s.klishin at gmail.com  Sun Aug 21 12:57:35 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sun, 21 Aug 2011 15:57:35 +0400
Subject: [rabbitmq-discuss] rabbitmq
In-Reply-To: <CAEw+mRdF+o3eE3dcxKJ6T=6F7JsNQ9FkhRgN4O-4xbMEieNVOA@mail.gmail.com>
References: <CAEw+mRdF+o3eE3dcxKJ6T=6F7JsNQ9FkhRgN4O-4xbMEieNVOA@mail.gmail.com>
Message-ID: <CAE3HoVRxi=x7iJVRbCekrs7EKQBwxz8mMJD=CeEFRD2-WWow4g@mail.gmail.com>

2011/8/21 Jonathan Hursey <jonathan.hursey at adrevolution.com>

> New to rabbitmq, so far I'm loving it. ANy pointers you can give me ?
> Thanks!


Jonathan,

If you are new to RabbitMQ and looking to learn more, reading
http://bit.ly/amqp-model-explained may help you understand what AMQP and/or
RabbitMQ can and cannot do for you a bit better.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110821/4466a095/attachment.htm>

From dsinclair at chariotsolutions.com  Sun Aug 21 15:04:04 2011
From: dsinclair at chariotsolutions.com (David Sinclair)
Date: Sun, 21 Aug 2011 10:04:04 -0400
Subject: [rabbitmq-discuss] rabbitmq
In-Reply-To: <CAEw+mRdF+o3eE3dcxKJ6T=6F7JsNQ9FkhRgN4O-4xbMEieNVOA@mail.gmail.com>
References: <CAEw+mRdF+o3eE3dcxKJ6T=6F7JsNQ9FkhRgN4O-4xbMEieNVOA@mail.gmail.com>
Message-ID: <CAGtiFWVDn4Oq2PBiJVK7RtLy1vQm1jEmrs2BRkrxm1JM7=7fdA@mail.gmail.com>

Need to be a little more particular than that. Are you trying to do
something that isn't working? Trying to design a messaging application?

On Sun, Aug 21, 2011 at 7:43 AM, Jonathan Hursey <
jonathan.hursey at adrevolution.com> wrote:

> New to rabbitmq, so far I'm loving it. ANy pointers you can give me ?
> Thanks!
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110821/02e0df3a/attachment.htm>

From jonathan.hursey at adrevolution.com  Sun Aug 21 15:07:24 2011
From: jonathan.hursey at adrevolution.com (Jonathan Hursey)
Date: Sun, 21 Aug 2011 09:07:24 -0500
Subject: [rabbitmq-discuss] rabbitmq
In-Reply-To: <CAGtiFWVDn4Oq2PBiJVK7RtLy1vQm1jEmrs2BRkrxm1JM7=7fdA@mail.gmail.com>
References: <CAEw+mRdF+o3eE3dcxKJ6T=6F7JsNQ9FkhRgN4O-4xbMEieNVOA@mail.gmail.com>
	<CAGtiFWVDn4Oq2PBiJVK7RtLy1vQm1jEmrs2BRkrxm1JM7=7fdA@mail.gmail.com>
Message-ID: <CAEw+mRcR9sFBpaLtnaHZ0J3ubpY-8C_kDkYYdJ8CNdH4Nf1xjw@mail.gmail.com>

I would love to build a messaging application. I'm just trying to get some
insight as to what  I can and can't do.  What experience do you have with
messaging apps?

On Sun, Aug 21, 2011 at 9:04 AM, David Sinclair <
dsinclair at chariotsolutions.com> wrote:

> Need to be a little more particular than that. Are you trying to do
> something that isn't working? Trying to design a messaging application?
>
> On Sun, Aug 21, 2011 at 7:43 AM, Jonathan Hursey <
> jonathan.hursey at adrevolution.com> wrote:
>
>> New to rabbitmq, so far I'm loving it. ANy pointers you can give me ?
>> Thanks!
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110821/69ab30b1/attachment.htm>

From jonathan.hursey at adrevolution.com  Sun Aug 21 15:08:14 2011
From: jonathan.hursey at adrevolution.com (Jonathan Hursey)
Date: Sun, 21 Aug 2011 09:08:14 -0500
Subject: [rabbitmq-discuss] rabbitmq
In-Reply-To: <CAE3HoVRxi=x7iJVRbCekrs7EKQBwxz8mMJD=CeEFRD2-WWow4g@mail.gmail.com>
References: <CAEw+mRdF+o3eE3dcxKJ6T=6F7JsNQ9FkhRgN4O-4xbMEieNVOA@mail.gmail.com>
	<CAE3HoVRxi=x7iJVRbCekrs7EKQBwxz8mMJD=CeEFRD2-WWow4g@mail.gmail.com>
Message-ID: <CAEw+mRekH-1S-D_y_SdrZYR=VEmpDxz4BmNdcmNDnuNWbVpVEA@mail.gmail.com>

Michael, this link is awesome and thanks sooo much for sending it!

On Sun, Aug 21, 2011 at 6:57 AM, Michael Klishin <
michael.s.klishin at gmail.com> wrote:

> 2011/8/21 Jonathan Hursey <jonathan.hursey at adrevolution.com>
>
>> New to rabbitmq, so far I'm loving it. ANy pointers you can give me ?
>> Thanks!
>
>
> Jonathan,
>
> If you are new to RabbitMQ and looking to learn more, reading
> http://bit.ly/amqp-model-explained may help you understand what AMQP
> and/or RabbitMQ can and cannot do for you a bit better.
> --
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/mdichaelklishin <http://twitter.com/michaelklishin>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110821/33c4426c/attachment.htm>

From sidchilling at gmail.com  Mon Aug 22 08:14:24 2011
From: sidchilling at gmail.com (SiddharthSaha)
Date: Mon, 22 Aug 2011 00:14:24 -0700 (PDT)
Subject: [rabbitmq-discuss] Temporary queue being made when task fails
Message-ID: <7b0d4475-c65a-4525-9052-8e17e7539df6@e20g2000prn.googlegroups.com>

I am using Celery with RabbitMQ. Lately, I have noticed that a large
number of temporary queues are getting made.

So, I experimented and found that when a task fails (that is a tasks
raises an Exception), then a temporary queue with a random name (like
c76861943b0a4f3aaa6a99a6db06952c) is formed and the queue remains.

Some properties of the temporary queue as found in rabbitmqadmin are
as follows -

auto_delete : True consumers : 0 durable : False messages : 1
messages_ready : 1

And one such temporary queue is made everytime a task fails (that is,
raises an Exception). How to avoid this situation? Because in my
production environment a large number of such queues get formed.

I do not want this temporary queue to be made. When a task fails, I
want that the task is tried one more time and even though it fails,
the temporary queue should not be made.

How can I do that?

From simon at rabbitmq.com  Mon Aug 22 10:03:42 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 22 Aug 2011 10:03:42 +0100
Subject: [rabbitmq-discuss] Mochiweb MAX_RECV_BODY and JSON_RPC plugin
In-Reply-To: <3ACD8673BEFF41AFB95B660FFA683968@myyearbook.com>
References: <3ACD8673BEFF41AFB95B660FFA683968@myyearbook.com>
Message-ID: <4E521B6E.8060103@rabbitmq.com>

On 19/08/11 21:20, Gavin M. Roy wrote:
> Ran into an unintended snag with JSON Channel RPC with regard to a
> mochiweb limitation.
>
> Mochiweb has a hardcoded constant for the maximum body size for a
> request at 1MB:
>
> https://github.com/mochi/mochiweb/blob/master/src/mochiweb_request.erl#L47
>
> This is a problem when you're trying to POST messages that are larger
> than 1MB.
>
> The fix is relatively easy, but I wanted to find out if there was any
> patching of mochiweb prior to making the mochiweb.ez file or is the file
> just provided for convenience and providing a tagged supported version.
> That is, if I recompile it with the # I want, can I just go from the
> vanilla mochiweb repo?

We patch mochiweb a bit, to make it build on older versions of Erlang, 
and to remove its dependency on the "crypto" application. I guess you 
could live without these, but more importantly we also use a specific 
version (basically what was the latest version at the point I started 
writing rabbitmq-management) and haven't tested with newer versions.

If I were you I would add your patch to our set and build with our 
wrapper. To do this, check out rabbitmq-public-umbrella, then check out 
the mochiweb-wrapper repository within it:

http://hg.rabbitmq.com/mochiweb-wrapper/

(or run "make checkout" which will check out everything including 
mochiweb-wrapper)

Then within mochiweb-wrapper add your patch, and add it to 
WRAPPER_PATCHES in package.mk, then "make dist".

Alternatively you could build it yourself but I would try to use the 
same version as we do - 9a53dbd7b2c52eb5b9d4 in the mochiweb git repo.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From lionel.cons at cern.ch  Mon Aug 22 10:07:28 2011
From: lionel.cons at cern.ch (Lionel Cons)
Date: Mon, 22 Aug 2011 11:07:28 +0200
Subject: [rabbitmq-discuss] STOMP & expiration
Message-ID: <20110822110436.7786.abe10f7e5afbbb3a79ce619739541149@cern.ch>

It seems that RabbitMQ does not handle the "expires" STOMP header.

Although this is not in the STOMP spec, it's commonly used in
JMS-compliant brokers to handle expiration.

Is there any plan to support message expiration via STOMP?

Cheers,

Lionel

From lionel.cons at cern.ch  Mon Aug 22 10:08:47 2011
From: lionel.cons at cern.ch (Lionel Cons)
Date: Mon, 22 Aug 2011 11:08:47 +0200
Subject: [rabbitmq-discuss] STOMP & selector
Message-ID: <20110822110731.a997.abe10f7e5afbbb3a79ce619739541149@cern.ch>

It seems that RabbitMQ does not handle the "selector" STOMP header
when subscribing.

Although this is not in the STOMP spec, it's commonly used in
JMS-compliant brokers to handle message selectors.

Is there any plan to support message selectors via STOMP?

Cheers,

Lionel

From matthias at rabbitmq.com  Mon Aug 22 10:13:02 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 22 Aug 2011 10:13:02 +0100
Subject: [rabbitmq-discuss] STOMP & expiration
In-Reply-To: <20110822110436.7786.abe10f7e5afbbb3a79ce619739541149@cern.ch>
References: <20110822110436.7786.abe10f7e5afbbb3a79ce619739541149@cern.ch>
Message-ID: <4E521D9E.7000503@rabbitmq.com>

Lionel,

On 22/08/11 10:07, Lionel Cons wrote:
> It seems that RabbitMQ does not handle the "expires" STOMP header.
>
> Although this is not in the STOMP spec, it's commonly used in
> JMS-compliant brokers to handle expiration.
>
> Is there any plan to support message expiration via STOMP?

Is that header set on a per-message basis? If so then Rabbit won't 
support that any time soon.

With AMQP we support a per-queue setting that controls message expiry. 
See http://www.rabbitmq.com/extensions.html#queue-ttl.


Regards,

Matthias.

From lionel.cons at cern.ch  Mon Aug 22 10:15:39 2011
From: lionel.cons at cern.ch (Lionel Cons)
Date: Mon, 22 Aug 2011 11:15:39 +0200
Subject: [rabbitmq-discuss] STOMP & message-id
Message-ID: <20110822111019.d4af.abe10f7e5afbbb3a79ce619739541149@cern.ch>

I've tried to send a message that contained a message-id to RabbitMQ's
STOMP interface and it got rejected with an error: Invalid message-id.

This (i.e. client supplied message-id) can happen when you shovel
messages from one broker to another.

IMHO, there are two ways for the broker to handle this:

1) ignore this header and always set a "unique" message-id, like in
   the case this header is not set

2) use this header as provided by the client

If the expected behavior is 2), RabbitMQ should IMHO be liberal in
what it accepts as message-id so that messages coming from other
brokers can be shoveled easily. If there are restrictions, they should
be clearly documented.

Cheers,

Lionel

From matthias at rabbitmq.com  Mon Aug 22 10:17:24 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 22 Aug 2011 10:17:24 +0100
Subject: [rabbitmq-discuss] STOMP & selector
In-Reply-To: <20110822110731.a997.abe10f7e5afbbb3a79ce619739541149@cern.ch>
References: <20110822110731.a997.abe10f7e5afbbb3a79ce619739541149@cern.ch>
Message-ID: <4E521EA4.8010009@rabbitmq.com>

Lionel,

On 22/08/11 10:08, Lionel Cons wrote:
> It seems that RabbitMQ does not handle the "selector" STOMP header
> when subscribing.
>
> Although this is not in the STOMP spec, it's commonly used in
> JMS-compliant brokers to handle message selectors.
>
> Is there any plan to support message selectors via STOMP?

Not in the short/medium term.

Regards,

Matthias.

From almumontiel at gmail.com  Mon Aug 22 10:28:32 2011
From: almumontiel at gmail.com (Almudena)
Date: Mon, 22 Aug 2011 02:28:32 -0700 (PDT)
Subject: [rabbitmq-discuss] sinatra web server
Message-ID: <aa00c3a1-b00e-4f88-ac01-3953fcf9a911@h9g2000vbr.googlegroups.com>


I am new to rabbitMQ and I quite not understand completely the whole
thing. I am trying to use the messaging technology to implement the
"load balancing" of my webserver, and with this I mean to distribute
the calls made to my website into several clients.
I would like to get answers quickly from my server, and no matter if
it is the very last information, but the most approximate calculated
by the clients (the application is a monitor system for my
infrastructure, and it should collect info from many machines).

I have read about https://github.com/auser/alice, but I am not sure
how to connect it with my interface.

I am using Sinatra to implement the server, and I would like to
connect my REST interface to rabbitMQ.

Do you think this is a use case that could be implemented?

I'd appreciate any help.

Cheers

From lionel.cons at cern.ch  Mon Aug 22 10:29:26 2011
From: lionel.cons at cern.ch (Lionel Cons)
Date: Mon, 22 Aug 2011 11:29:26 +0200
Subject: [rabbitmq-discuss] STOMP & ack
Message-ID: <20110822111913.c2e1.abe10f7e5afbbb3a79ce619739541149@cern.ch>

I'm trying to use client-side acknowledgment in STOMP and it seems
that RabbitMQ does not follow the STOMP 1.1 spec.

Here is what I tried:
 - p: send two messages to a queue
 - c: subscribe with ack:client to the queue but acks only the 2nd message

Unless I messed up my test, c only receives the first message and not
the second one.

The STOMP 1.1 spec [1] states that ack:client should be treated as
cumulative so the broker should send both messages, even if the first
one has not been ack'ed. Otherwise, there is no way the client can use
cumulative acks, ack'ing several messages with one ACK frame.

Is this indeed a bug?

Cheers,

Lionel

[1] http://stomp.github.com/stomp-specification-1.1.html#SUBSCRIBE_ack_Header

From lionel.cons at cern.ch  Mon Aug 22 10:36:23 2011
From: lionel.cons at cern.ch (Lionel Cons)
Date: Mon, 22 Aug 2011 11:36:23 +0200
Subject: [rabbitmq-discuss] STOMP & expiration
In-Reply-To: <4E521D9E.7000503@rabbitmq.com>
References: <20110822110436.7786.abe10f7e5afbbb3a79ce619739541149@cern.ch>
	<4E521D9E.7000503@rabbitmq.com>
Message-ID: <20050.8983.545590.100052@mail.cern.ch>

Matthias Radestock writes:
 > Is that header set on a per-message basis? If so then Rabbit won't 
 > support that any time soon.

The JMS specification describes message TTL and expiration
(JMSExpiration header). They are indeed per-message.

 > With AMQP we support a per-queue setting that controls message expiry. 
 > See http://www.rabbitmq.com/extensions.html#queue-ttl.

Will this work using STOMP only?

Cheers,

Lionel

From matthias at rabbitmq.com  Mon Aug 22 10:41:23 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 22 Aug 2011 10:41:23 +0100
Subject: [rabbitmq-discuss] STOMP & expiration
In-Reply-To: <20050.8983.545590.100052@mail.cern.ch>
References: <20110822110436.7786.abe10f7e5afbbb3a79ce619739541149@cern.ch>	<4E521D9E.7000503@rabbitmq.com>
	<20050.8983.545590.100052@mail.cern.ch>
Message-ID: <4E522443.5030909@rabbitmq.com>

Lionel,

On 22/08/11 10:36, Lionel Cons wrote:
>   >  With AMQP we support a per-queue setting that controls message expiry.
>   >  See http://www.rabbitmq.com/extensions.html#queue-ttl.
>
> Will this work using STOMP only?

Not at the moment. We could add a custom header for the TTL, but it's 
not clear where in STOMP we would convey this information.

Matthias.

From matthias at rabbitmq.com  Mon Aug 22 10:43:35 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 22 Aug 2011 10:43:35 +0100
Subject: [rabbitmq-discuss] STOMP & message-id
In-Reply-To: <20110822111019.d4af.abe10f7e5afbbb3a79ce619739541149@cern.ch>
References: <20110822111019.d4af.abe10f7e5afbbb3a79ce619739541149@cern.ch>
Message-ID: <4E5224C7.6030700@rabbitmq.com>

Lionel,

On 22/08/11 10:15, Lionel Cons wrote:
> I've tried to send a message that contained a message-id to RabbitMQ's
> STOMP interface and it got rejected with an error: Invalid message-id.

Are you sure you got this error during sending? Looking at the code, 
that error should only be generated in the (N)ACK path.

> This (i.e. client supplied message-id) can happen when you shovel
> messages from one broker to another.
>
> IMHO, there are two ways for the broker to handle this:
>
> 1) ignore this header and always set a "unique" message-id, like in
>     the case this header is not set
>
> 2) use this header as provided by the client
>
> If the expected behavior is 2), RabbitMQ should IMHO be liberal in
> what it accepts as message-id so that messages coming from other
> brokers can be shoveled easily. If there are restrictions, they should
> be clearly documented.

The STOMP specification defines the usage of message-id headers for 
MESSAGE frames and N(ACK) frames. It says nothing about how message-ids 
in SEND frames should be treated, or, rather, it says nothing about how 
in general SEND headers should be treated that clash with 
protocol-defined headers in MESSAGE frames.

 From a quick glance at the code I cannot tell what rabbit actually does 
with sender-supplied message-ids. I suspect it either stomps on the 
existing id on delivery or the message ends up with two ids.

One thing is certain though, Rabbit cannot simply pass through the 
message-id. That is because Rabbit encodes information in the message-id 
that it subsequently needs for processing (N)ACKS.


Regards,

Matthias.

From matthias at rabbitmq.com  Mon Aug 22 10:50:36 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 22 Aug 2011 10:50:36 +0100
Subject: [rabbitmq-discuss] STOMP & ack
In-Reply-To: <20110822111913.c2e1.abe10f7e5afbbb3a79ce619739541149@cern.ch>
References: <20110822111913.c2e1.abe10f7e5afbbb3a79ce619739541149@cern.ch>
Message-ID: <4E52266C.2050100@rabbitmq.com>

Lionel,

On 22/08/11 10:29, Lionel Cons wrote:
> I'm trying to use client-side acknowledgment in STOMP and it seems
> that RabbitMQ does not follow the STOMP 1.1 spec.
>
> Here is what I tried:
>   - p: send two messages to a queue
>   - c: subscribe with ack:client to the queue but acks only the 2nd message
>
> Unless I messed up my test, c only receives the first message and not
> the second one.
>
> The STOMP 1.1 spec [1] states that ack:client should be treated as
> cumulative so the broker should send both messages, even if the first
> one has not been ack'ed. Otherwise, there is no way the client can use
> cumulative acks, ack'ing several messages with one ACK frame.
>
> Is this indeed a bug?

This should work as expected - Rabbit supports all three ack modes 
defined by the spec.

Have you perhaps set a prefetch-count=1 header in the subscription?


Regards,

Matthias.

From cstoyles at gmail.com  Mon Aug 22 01:08:39 2011
From: cstoyles at gmail.com (ChrisStoyles)
Date: Sun, 21 Aug 2011 17:08:39 -0700 (PDT)
Subject: [rabbitmq-discuss] Unable to start RabbitMQ server after crash
 because of vm_memory_high_watermark alarm.
Message-ID: <a5bd0a65-42f3-4112-b9d8-6f54d1a9e61b@v9g2000pri.googlegroups.com>

Hi All,

I need some advice on moving /var/lib/rabbitmq to a new server with
more RAM. What has happened is that on our 8GB RAM server we've had a
surge in activity and one of our queues has grown much faster than it
can be consumed by our "workers".

This has resulted in RabbitMQ crashing, with an erl_crash.dump file
appearing.

At present when I attempt to start the server up again, it tries to
roll the persister.LOG file and recover what was in the queue at the
time of the crash. However even with rabbitmq.config set up as below,
the vm_memory_high_watermark alarm is triggered and erl_crash.dump is
created all over again.

[
  {rabbit, [{vm_memory_high_watermark, 0.9}]}
].

I've got another server with 24GB of RAM, so I set it's HOSTNAME to
the same as the 8GB server and installed the same version of RabbitMQ.
I then copied over the contents of /var/lib/rabbitmq and attempted to
start RabbitMQ. I no longer hit the vm_memory_high_watermark however
Erlang seems to close/shutdown while attempting to recover
persister.LOG.

Is there a step I am missing?

Thank You.
Chris.

From lionel.cons at cern.ch  Mon Aug 22 10:56:23 2011
From: lionel.cons at cern.ch (Lionel Cons)
Date: Mon, 22 Aug 2011 11:56:23 +0200
Subject: [rabbitmq-discuss] STOMP & message-id
In-Reply-To: <4E5224C7.6030700@rabbitmq.com>
References: <20110822111019.d4af.abe10f7e5afbbb3a79ce619739541149@cern.ch>
	<4E5224C7.6030700@rabbitmq.com>
Message-ID: <20050.10183.761167.789449@mail.cern.ch>

Matthias Radestock writes:
 > Are you sure you got this error during sending? Looking at the code, 
 > that error should only be generated in the (N)ACK path.

You are right, the error was during ACK'ing.

Here is precisely what I've done:
 - send message with message-id:dummy -> OK
 - subscribe to the corresponding queue with ack:client
 - receive the message, it does contain message-id:dummy -> OK
 - ACK the received message with message-id:dummy, as requested by the
   STOMP spec -> ERROR Invalid message-id

In other words, I cannot ACK this message...

 > One thing is certain though, Rabbit cannot simply pass through the 
 > message-id. That is because Rabbit encodes information in the message-id 
 > that it subsequently needs for processing (N)ACKS.

So in this case I think that RabbitMQ should overwrite any message-id
it receives so that the messages that it later sends can be acknowledged.
Don't you think so?

Cheers,

Lionel

From matthias at rabbitmq.com  Mon Aug 22 11:00:10 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 22 Aug 2011 11:00:10 +0100
Subject: [rabbitmq-discuss] STOMP & message-id
In-Reply-To: <20050.10183.761167.789449@mail.cern.ch>
References: <20110822111019.d4af.abe10f7e5afbbb3a79ce619739541149@cern.ch>	<4E5224C7.6030700@rabbitmq.com>
	<20050.10183.761167.789449@mail.cern.ch>
Message-ID: <4E5228AA.9030009@rabbitmq.com>

Lionel,

On 22/08/11 10:56, Lionel Cons wrote:
> So in this case I think that RabbitMQ should overwrite any message-id
> it receives so that the messages that it later sends can be acknowledged.
> Don't you think so?

Yes. I think you'll find that currently there are *two* message-ids in 
the MESSAGE frame - the original and Rabbit's. I will file a bug to get 
that fixed.

Matthias.

From lionel.cons at cern.ch  Mon Aug 22 11:28:01 2011
From: lionel.cons at cern.ch (Lionel Cons)
Date: Mon, 22 Aug 2011 12:28:01 +0200
Subject: [rabbitmq-discuss] STOMP & message-id
In-Reply-To: <4E5228AA.9030009@rabbitmq.com>
References: <20110822111019.d4af.abe10f7e5afbbb3a79ce619739541149@cern.ch>
	<4E5224C7.6030700@rabbitmq.com>
	<20050.10183.761167.789449@mail.cern.ch>
	<4E5228AA.9030009@rabbitmq.com>
Message-ID: <20050.12081.459699.853261@mail.cern.ch>

Matthias Radestock writes:
 > Yes. I think you'll find that currently there are *two* message-ids in 
 > the MESSAGE frame - the original and Rabbit's. I will file a bug to get 
 > that fixed.

You are right, the message contains both message-id. According to the
STOMP 1.1 spec, only the first one (the user supplied one) should be
taken into account. Hence the buggy behavior.

Thanks for filing the bug.

Cheers,

Lionel

From michael.s.klishin at gmail.com  Mon Aug 22 11:28:49 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 22 Aug 2011 14:28:49 +0400
Subject: [rabbitmq-discuss] sinatra web server
In-Reply-To: <aa00c3a1-b00e-4f88-ac01-3953fcf9a911@h9g2000vbr.googlegroups.com>
References: <aa00c3a1-b00e-4f88-ac01-3953fcf9a911@h9g2000vbr.googlegroups.com>
Message-ID: <CAE3HoVTzZ3v18k6PHZ45cifAbPk2dfi53ggOkjuyE1p7tqjJTw@mail.gmail.com>

2011/8/22 Almudena <almumontiel at gmail.com>

> I am new to rabbitMQ and I quite not understand completely the whole
> thing.
>

Then I recommend starting with http://bit.ly/amqp-model-explained and the
rest of http://bit.ly/amqp-gem-docs.


> I am trying to use the messaging technology to implement the
> "load balancing" of my webserver, and with this I mean to distribute
> the calls made to my website into several clients.
> I would like to get answers quickly from my server, and no matter if
> it is the very last information, but the most approximate calculated
> by the clients (the application is a monitor system for my
> infrastructure, and it should collect info from many machines).
>
>
You can publish commands to your applications that do computation work and
cache it in Redis (if you need persistence) or Memcached (if you don't mind
losing results when power is switched off), then use Dalli (a Ruby Memcached
client that I cannot recommend enough) to fetch the result. The Command
pattern is explained at

http://rubydoc.info/github/ruby-amqp/amqp/master/file/docs/PatternsAndUseCases.textile#Command_pattern


> I have read about https://github.com/auser/alice, but I am not sure
> how to connect it with my interface.
>

Alice is deprecated. You should take a look at RabbitMQ management plugin
instead (but it is implemented in Erlang
so if you want to use Ruby with Sinatra, there is probably not a lot to
see).


>
> I am using Sinatra to implement the server, and I would like to
> connect my REST interface to rabbitMQ.
>
> Do you think this is a use case that could be implemented?
>

What you are trying to do is a common thing but I am not sure I fully
understand if you need mostly 1-way communication or 2-way. Implementation
details all come down to whether your Sinatra app expects to receive
any responses from other apps over AMQP. Can you elaborate on this? Thank
you.

-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110822/0e8492f4/attachment.htm>

From majek04 at gmail.com  Mon Aug 22 12:13:41 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Mon, 22 Aug 2011 12:13:41 +0100
Subject: [rabbitmq-discuss] sinatra web server
In-Reply-To: <aa00c3a1-b00e-4f88-ac01-3953fcf9a911@h9g2000vbr.googlegroups.com>
References: <aa00c3a1-b00e-4f88-ac01-3953fcf9a911@h9g2000vbr.googlegroups.com>
Message-ID: <CABzX+qzehuCy2=qDpqOraTEv8Gc-kdOLv-bG-qRSSci4-f-ytQ@mail.gmail.com>

On Mon, Aug 22, 2011 at 10:28, Almudena <almumontiel at gmail.com> wrote:
> I am new to rabbitMQ and I quite not understand completely the whole
> thing. I am trying to use the messaging technology to implement the
> "load balancing" of my webserver, and with this I mean to distribute
> the calls made to my website into several clients.
> I would like to get answers quickly from my server, and no matter if
> it is the very last information, but the most approximate calculated
> by the clients (the application is a monitor system for my
> infrastructure, and it should collect info from many machines).

I'm afraid there isn't a short answer. If you want to develop
something using Rabbit, you should spend some time and
learn underlying concepts and abstractions.

If you want to read about the basics, follow the links
shared by Michael:
http://rubydoc.info/github/ruby-amqp/amqp/master/file/docs/AMQP091ModelExplained.textile

If you want to jump straight into the code, take look
at RabbitMQ tutorials:
http://www.rabbitmq.com/getstarted.html

Cheers,
  Marek

From lionel.cons at cern.ch  Mon Aug 22 12:27:24 2011
From: lionel.cons at cern.ch (Lionel Cons)
Date: Mon, 22 Aug 2011 13:27:24 +0200
Subject: [rabbitmq-discuss] STOMP & ack
In-Reply-To: <4E52266C.2050100@rabbitmq.com>
References: <20110822111913.c2e1.abe10f7e5afbbb3a79ce619739541149@cern.ch>
	<4E52266C.2050100@rabbitmq.com>
Message-ID: <20050.15644.75946.455803@mail.cern.ch>

Matthias Radestock writes:
 > This should work as expected - Rabbit supports all three ack modes 
 > defined by the spec.

Good but...

 > Have you perhaps set a prefetch-count=1 header in the subscription?

No.

I tried once more using netcat (to avoid any STOMP library problem)
and I confirm I get only the first of the two messages in the queue.

I can send you the test file I used if you need it.

Cheers,

Lionel

From matthias at rabbitmq.com  Mon Aug 22 12:36:26 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 22 Aug 2011 12:36:26 +0100
Subject: [rabbitmq-discuss] STOMP & ack
In-Reply-To: <20050.15644.75946.455803@mail.cern.ch>
References: <20110822111913.c2e1.abe10f7e5afbbb3a79ce619739541149@cern.ch>	<4E52266C.2050100@rabbitmq.com>
	<20050.15644.75946.455803@mail.cern.ch>
Message-ID: <4E523F3A.9080807@rabbitmq.com>

Lionel,

On 22/08/11 12:27, Lionel Cons wrote:
> I tried once more using netcat (to avoid any STOMP library problem)
> and I confirm I get only the first of the two messages in the queue.
>
> I can send you the test file I used if you need it.

That would be great, thanks. What Rabbit version are you running?

We do have tests in our test suite for this. See 
http://hg.rabbitmq.com/rabbitmq-stomp/file/default/test/src/ack.py#l8. 
So I suspect there is something peculiar about the way you are consuming.

Matthias.

From matthias at rabbitmq.com  Mon Aug 22 12:39:34 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 22 Aug 2011 12:39:34 +0100
Subject: [rabbitmq-discuss] STOMP & ack
In-Reply-To: <4E523F3A.9080807@rabbitmq.com>
References: <20110822111913.c2e1.abe10f7e5afbbb3a79ce619739541149@cern.ch>	<4E52266C.2050100@rabbitmq.com>	<20050.15644.75946.455803@mail.cern.ch>
	<4E523F3A.9080807@rabbitmq.com>
Message-ID: <4E523FF6.4000005@rabbitmq.com>

On 22/08/11 12:36, Matthias Radestock wrote:
> On 22/08/11 12:27, Lionel Cons wrote:
>> I tried once more using netcat (to avoid any STOMP library problem)
>> and I confirm I get only the first of the two messages in the queue.
>>
>> I can send you the test file I used if you need it.
>
> That would be great, thanks. What Rabbit version are you running?
>
> We do have tests in our test suite for this. See
> http://hg.rabbitmq.com/rabbitmq-stomp/file/default/test/src/ack.py#l8.
> So I suspect there is something peculiar about the way you are consuming.

Ah, found it. The default prefetch for 'queue' destinations is 1.

So this has nothing to do with the ack mode.


Matthias.

From lionel.cons at cern.ch  Mon Aug 22 12:47:27 2011
From: lionel.cons at cern.ch (Lionel Cons)
Date: Mon, 22 Aug 2011 13:47:27 +0200
Subject: [rabbitmq-discuss] STOMP & ack
In-Reply-To: <4E523F3A.9080807@rabbitmq.com>
References: <20110822111913.c2e1.abe10f7e5afbbb3a79ce619739541149@cern.ch>
	<4E52266C.2050100@rabbitmq.com>
	<20050.15644.75946.455803@mail.cern.ch>
	<4E523F3A.9080807@rabbitmq.com>
Message-ID: <20050.16847.905841.804262@mail.cern.ch>

Matthias Radestock writes:
 > > I can send you the test file I used if you need it.
 > 
 > That would be great, thanks. What Rabbit version are you running?

I'm using 2.5.1.

I attach the test file I used (careful, it contains NULLs). Here is
how I used it:

$ (cat test ; cat) | nc mybroker 6163
CONNECTED
session:session-eUW269BDTMpWKKQuao0kfA==
heart-beat:0,0
version:1.1

MESSAGE
content-type:text/plain
destination:/queue/test
message-id:Q_/queue/test@@session-eUW269BDTMpWKKQuao0kfA==@@1
content-length:2

1

(this stops/hangs here)

As you see, only the first message gets delivered.

Cheers,

Lionel

-------------- next part --------------
A non-text attachment was scrubbed...
Name: test
Type: application/octet-stream
Size: 193 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110822/1d54c853/attachment.obj>

From lionel.cons at cern.ch  Mon Aug 22 12:54:23 2011
From: lionel.cons at cern.ch (Lionel Cons)
Date: Mon, 22 Aug 2011 13:54:23 +0200
Subject: [rabbitmq-discuss] STOMP & ack
In-Reply-To: <4E523FF6.4000005@rabbitmq.com>
References: <20110822111913.c2e1.abe10f7e5afbbb3a79ce619739541149@cern.ch>
	<4E52266C.2050100@rabbitmq.com>
	<20050.15644.75946.455803@mail.cern.ch>
	<4E523F3A.9080807@rabbitmq.com> <4E523FF6.4000005@rabbitmq.com>
Message-ID: <20050.17263.552868.476995@mail.cern.ch>

Matthias Radestock writes:
 > Ah, found it. The default prefetch for 'queue' destinations is 1.

I would have expected a default of "no prefetch limit"...

Is this the intended behaviour? Is this documented (I could not find it)?

Cheers,

Lionel

From tonygarnockjones+rabbitmq at gmail.com  Mon Aug 22 12:58:27 2011
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Mon, 22 Aug 2011 07:58:27 -0400
Subject: [rabbitmq-discuss] STOMP & message-id
In-Reply-To: <20050.12081.459699.853261@mail.cern.ch>
References: <20110822111019.d4af.abe10f7e5afbbb3a79ce619739541149@cern.ch>
	<4E5224C7.6030700@rabbitmq.com>
	<20050.10183.761167.789449@mail.cern.ch>
	<4E5228AA.9030009@rabbitmq.com>
	<20050.12081.459699.853261@mail.cern.ch>
Message-ID: <CAM8fPiTj-YOXWX9AKO003rkWtBWVRFNbECmyUUi__Kq7uHCSOQ@mail.gmail.com>

On 22 August 2011 06:28, Lionel Cons <lionel.cons at cern.ch> wrote:

> Matthias Radestock writes:
>  > Yes. I think you'll find that currently there are *two* message-ids in
>  > the MESSAGE frame - the original and Rabbit's. I will file a bug to get
>  > that fixed.
>

Isn't the user-supplied message-id sent in the MESSAGE as "amqp-message-id"?
In which case there really is only one "message-id" header in the MESSAGE?


> According to the
> STOMP 1.1 spec, only the first one (the user supplied one) should be
> taken into account. Hence the buggy behavior.
>

STOMP mentions "message-id" for MESSAGE and ACK and NACK only. It doesn't
say anything about SEND. For compatibility with the spec, the client code
should take the "message-id" from the MESSAGE and use that in any related
ACK or NACK. Don't use the "message-id" from the SEND, in other words, since
that's a RabbitMQ (and presumably also ActiveMQ etc) extension.

I'm not sure this is a bug. It's certainly something that'd be difficult to
change, because of the way STOMP 1.1 is defined and the way RabbitMQ wants
to use the message ID field. In particular, there's no real way to let
people use their own user-supplied message-id values in an ACK or NACK
frame.

Cheers,
  Tony
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110822/d58ee123/attachment.htm>

From matthias at rabbitmq.com  Mon Aug 22 13:09:01 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 22 Aug 2011 13:09:01 +0100
Subject: [rabbitmq-discuss] STOMP & message-id
In-Reply-To: <CAM8fPiTj-YOXWX9AKO003rkWtBWVRFNbECmyUUi__Kq7uHCSOQ@mail.gmail.com>
References: <20110822111019.d4af.abe10f7e5afbbb3a79ce619739541149@cern.ch>	<4E5224C7.6030700@rabbitmq.com>	<20050.10183.761167.789449@mail.cern.ch>	<4E5228AA.9030009@rabbitmq.com>	<20050.12081.459699.853261@mail.cern.ch>
	<CAM8fPiTj-YOXWX9AKO003rkWtBWVRFNbECmyUUi__Kq7uHCSOQ@mail.gmail.com>
Message-ID: <4E5246DD.7060207@rabbitmq.com>

On 22/08/11 12:58, Tony Garnock-Jones wrote:
> Isn't the user-supplied message-id sent in the MESSAGE as
> "amqp-message-id"?

amqp-message-id is the header one can supply in SEND in order to set the 
message_id field of AMQP's 'basic' content. Similarly, in MESSAGE, if 
the AMQP 'basic' content contains a message_id it is turned into an 
amqp-message-id header.

Matthias.

From rob.harrop at gmail.com  Mon Aug 22 13:31:53 2011
From: rob.harrop at gmail.com (Rob Harrop)
Date: Mon, 22 Aug 2011 13:31:53 +0100
Subject: [rabbitmq-discuss] STOMP & ack
In-Reply-To: <20050.17263.552868.476995@mail.cern.ch>
References: <20110822111913.c2e1.abe10f7e5afbbb3a79ce619739541149@cern.ch>
	<4E52266C.2050100@rabbitmq.com>
	<20050.15644.75946.455803@mail.cern.ch>
	<4E523F3A.9080807@rabbitmq.com> <4E523FF6.4000005@rabbitmq.com>
	<20050.17263.552868.476995@mail.cern.ch>
Message-ID: <4118ED59-DC38-4DAB-8088-00493762FAE8@rabbitmq.com>

The reason for this is to give /queue destinations roughly round-robin semantics across all subscribers on the queue.

You can tweak the prefetch-count for a subscriber by setting the prefetch-count header to some other int value.

The docs are missing this point, I'm working on doc updates today so I'll add this point in there.

Regards,

Rob
On 22 Aug 2011, at 12:54, Lionel Cons wrote:

> Matthias Radestock writes:
>> Ah, found it. The default prefetch for 'queue' destinations is 1.
> 
> I would have expected a default of "no prefetch limit"...
> 
> Is this the intended behaviour? Is this documented (I could not find it)?
> 
> Cheers,
> 
> Lionel
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From rob.harrop at gmail.com  Mon Aug 22 13:46:38 2011
From: rob.harrop at gmail.com (Rob Harrop)
Date: Mon, 22 Aug 2011 13:46:38 +0100
Subject: [rabbitmq-discuss] STOMP & ack
In-Reply-To: <4118ED59-DC38-4DAB-8088-00493762FAE8@rabbitmq.com>
References: <20110822111913.c2e1.abe10f7e5afbbb3a79ce619739541149@cern.ch>
	<4E52266C.2050100@rabbitmq.com>
	<20050.15644.75946.455803@mail.cern.ch>
	<4E523F3A.9080807@rabbitmq.com> <4E523FF6.4000005@rabbitmq.com>
	<20050.17263.552868.476995@mail.cern.ch>
	<4118ED59-DC38-4DAB-8088-00493762FAE8@rabbitmq.com>
Message-ID: <D773FD2C-F52C-4D19-B018-B04870DE74E3@rabbitmq.com>

After further discussion with Matthias, we've decided it makes no sense to have this default for /queue destinations so I'm opening a bug to set the default for /queue to unlimited.

Rob

On 22 Aug 2011, at 13:31, Rob Harrop wrote:

> The reason for this is to give /queue destinations roughly round-robin semantics across all subscribers on the queue.
> 
> You can tweak the prefetch-count for a subscriber by setting the prefetch-count header to some other int value.
> 
> The docs are missing this point, I'm working on doc updates today so I'll add this point in there.
> 
> Regards,
> 
> Rob
> On 22 Aug 2011, at 12:54, Lionel Cons wrote:
> 
>> Matthias Radestock writes:
>>> Ah, found it. The default prefetch for 'queue' destinations is 1.
>> 
>> I would have expected a default of "no prefetch limit"...
>> 
>> Is this the intended behaviour? Is this documented (I could not find it)?
>> 
>> Cheers,
>> 
>> Lionel
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From tonygarnockjones+rabbitmq at gmail.com  Mon Aug 22 13:46:53 2011
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Mon, 22 Aug 2011 08:46:53 -0400
Subject: [rabbitmq-discuss] STOMP & message-id
In-Reply-To: <4E5246DD.7060207@rabbitmq.com>
References: <20110822111019.d4af.abe10f7e5afbbb3a79ce619739541149@cern.ch>
	<4E5224C7.6030700@rabbitmq.com>
	<20050.10183.761167.789449@mail.cern.ch>
	<4E5228AA.9030009@rabbitmq.com>
	<20050.12081.459699.853261@mail.cern.ch>
	<CAM8fPiTj-YOXWX9AKO003rkWtBWVRFNbECmyUUi__Kq7uHCSOQ@mail.gmail.com>
	<4E5246DD.7060207@rabbitmq.com>
Message-ID: <CAM8fPiQi7fJ2UJy+=fFvpv1CyHpnFw07E=xAmSiUhNcshSwbgg@mail.gmail.com>

On 22 August 2011 08:09, Matthias Radestock <matthias at rabbitmq.com> wrote:

> amqp-message-id is the header one can supply in SEND in order to set the
> message_id field of AMQP's 'basic' content. Similarly, in MESSAGE, if the
> AMQP 'basic' content contains a message_id it is turned into an
> amqp-message-id header.
>

OK, that's good; it doesn't explain Lionel's report that SENDing with
"message-id" set led to a correspondingly-set "message-id" on the resulting
MESSAGE, though. Looking at the code, I'm guessing that Lionel either sent
an "amqp-message-id" header on the SEND, or that I've overlooked or
misinterpreted something!

Tony
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110822/611b2ace/attachment.htm>

From matthias at rabbitmq.com  Mon Aug 22 13:48:23 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 22 Aug 2011 13:48:23 +0100
Subject: [rabbitmq-discuss] STOMP & message-id
In-Reply-To: <CAM8fPiQi7fJ2UJy+=fFvpv1CyHpnFw07E=xAmSiUhNcshSwbgg@mail.gmail.com>
References: <20110822111019.d4af.abe10f7e5afbbb3a79ce619739541149@cern.ch>	<4E5224C7.6030700@rabbitmq.com>	<20050.10183.761167.789449@mail.cern.ch>	<4E5228AA.9030009@rabbitmq.com>	<20050.12081.459699.853261@mail.cern.ch>	<CAM8fPiTj-YOXWX9AKO003rkWtBWVRFNbECmyUUi__Kq7uHCSOQ@mail.gmail.com>	<4E5246DD.7060207@rabbitmq.com>
	<CAM8fPiQi7fJ2UJy+=fFvpv1CyHpnFw07E=xAmSiUhNcshSwbgg@mail.gmail.com>
Message-ID: <4E525017.3060208@rabbitmq.com>

On 22/08/11 13:46, Tony Garnock-Jones wrote:
> On 22 August 2011 08:09, Matthias Radestock <matthias at rabbitmq.com
> <mailto:matthias at rabbitmq.com>> wrote:
>
>     amqp-message-id is the header one can supply in SEND in order to set
>     the message_id field of AMQP's 'basic' content. Similarly, in
>     MESSAGE, if the AMQP 'basic' content contains a message_id it is
>     turned into an amqp-message-id header.
>
>
> OK, that's good; it doesn't explain Lionel's report that SENDing with
> "message-id" set led to a correspondingly-set "message-id" on the
> resulting MESSAGE, though. Looking at the code, I'm guessing that Lionel
> either sent an "amqp-message-id" header on the SEND, or that I've
> overlooked or misinterpreted something!

message-id, just like all user-defined headers, are simply passed 
through. The exception are the headers we map to AMQP's 'basic' fields.

Matthias.

From matthias at rabbitmq.com  Mon Aug 22 13:49:37 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 22 Aug 2011 13:49:37 +0100
Subject: [rabbitmq-discuss] STOMP & message-id
In-Reply-To: <4E525017.3060208@rabbitmq.com>
References: <20110822111019.d4af.abe10f7e5afbbb3a79ce619739541149@cern.ch>	<4E5224C7.6030700@rabbitmq.com>	<20050.10183.761167.789449@mail.cern.ch>	<4E5228AA.9030009@rabbitmq.com>	<20050.12081.459699.853261@mail.cern.ch>	<CAM8fPiTj-YOXWX9AKO003rkWtBWVRFNbECmyUUi__Kq7uHCSOQ@mail.gmail.com>	<4E5246DD.7060207@rabbitmq.com>
	<CAM8fPiQi7fJ2UJy+=fFvpv1CyHpnFw07E=xAmSiUhNcshSwbgg@mail.gmail.com>
	<4E525017.3060208@rabbitmq.com>
Message-ID: <4E525061.9020300@rabbitmq.com>

On 22/08/11 13:48, Matthias Radestock wrote:
> message-id, just like all user-defined headers, are simply passed
> through. The exception are the headers we map to AMQP's 'basic' fields.

(and even those are passed through, but they are handled specially 
internally)

From lionel.cons at cern.ch  Mon Aug 22 13:54:01 2011
From: lionel.cons at cern.ch (Lionel Cons)
Date: Mon, 22 Aug 2011 14:54:01 +0200
Subject: [rabbitmq-discuss] STOMP & message-id
In-Reply-To: <CAM8fPiTj-YOXWX9AKO003rkWtBWVRFNbECmyUUi__Kq7uHCSOQ@mail.gmail.com>
References: <20110822111019.d4af.abe10f7e5afbbb3a79ce619739541149@cern.ch>
	<4E5224C7.6030700@rabbitmq.com>
	<20050.10183.761167.789449@mail.cern.ch>
	<4E5228AA.9030009@rabbitmq.com>
	<20050.12081.459699.853261@mail.cern.ch>
	<CAM8fPiTj-YOXWX9AKO003rkWtBWVRFNbECmyUUi__Kq7uHCSOQ@mail.gmail.com>
Message-ID: <20050.20841.832144.23484@mail.cern.ch>

Tony Garnock-Jones writes:
 > STOMP mentions "message-id" for MESSAGE and ACK and NACK only. It doesn't
 > say anything about SEND.

It's true that the spec is silent about the meaning of "message-id" in SEND.

However, this is not a rhetorical question: a simple STOMP shovel will
read MESSAGE frames in and (re)write them as SEND frames.

The spec does include:

 | An application MAY add any arbitrary user defined headers to the SEND
 | frame. User defined headers are typically used to allow consumers to
 | filter messages based on the application defined headers using a
 | selector on a SUBSCRIBE frame. The user defined headers MUST be passed
 | through in the MESSAGE frame.

Is a user supplied "message-id" considered as "user defined headers"
so to be passed through? This is not clear...

 > I'm not sure this is a bug. It's certainly something that'd be difficult to
 > change, because of the way STOMP 1.1 is defined and the way RabbitMQ wants
 > to use the message ID field. In particular, there's no real way to let
 > people use their own user-supplied message-id values in an ACK or NACK
 > frame.

IMHO, if RabbitMQ indeed relies on the message-id field, it should
overwrite it and document this behaviour. This way, a user supplied
"message-id" won't create anymore a message that cannot be ack'ed.

Cheers,

Lionel

From tonygarnockjones+rabbitmq at gmail.com  Mon Aug 22 13:55:09 2011
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Mon, 22 Aug 2011 08:55:09 -0400
Subject: [rabbitmq-discuss] STOMP & message-id
In-Reply-To: <4E525017.3060208@rabbitmq.com>
References: <20110822111019.d4af.abe10f7e5afbbb3a79ce619739541149@cern.ch>
	<4E5224C7.6030700@rabbitmq.com>
	<20050.10183.761167.789449@mail.cern.ch>
	<4E5228AA.9030009@rabbitmq.com>
	<20050.12081.459699.853261@mail.cern.ch>
	<CAM8fPiTj-YOXWX9AKO003rkWtBWVRFNbECmyUUi__Kq7uHCSOQ@mail.gmail.com>
	<4E5246DD.7060207@rabbitmq.com>
	<CAM8fPiQi7fJ2UJy+=fFvpv1CyHpnFw07E=xAmSiUhNcshSwbgg@mail.gmail.com>
	<4E525017.3060208@rabbitmq.com>
Message-ID: <CAM8fPiTSnObvNHxQZq3q-N0UQV+rF7XpZ-eFoZquDipAY926DQ@mail.gmail.com>

On 22 August 2011 08:48, Matthias Radestock <matthias at rabbitmq.com> wrote:

> message-id, just like all user-defined headers, are simply passed through.
> The exception are the headers we map to AMQP's 'basic' fields.
>

Aha! Got it. Yes, that makes sense (given STOMP's blurring of envelope and
message headers). So the bug is that user (= message) headers matching the
name of STOMP-defined (= envelope) headers should be somehow stripped or
renamed. ISTR that the STOMP adapter used to prefix user headers with "X-"
for just such a reason.

Tony
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110822/6bd301f1/attachment.htm>

From tonygarnockjones+rabbitmq at gmail.com  Mon Aug 22 13:57:03 2011
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Mon, 22 Aug 2011 08:57:03 -0400
Subject: [rabbitmq-discuss] STOMP & message-id
In-Reply-To: <20050.20841.832144.23484@mail.cern.ch>
References: <20110822111019.d4af.abe10f7e5afbbb3a79ce619739541149@cern.ch>
	<4E5224C7.6030700@rabbitmq.com>
	<20050.10183.761167.789449@mail.cern.ch>
	<4E5228AA.9030009@rabbitmq.com>
	<20050.12081.459699.853261@mail.cern.ch>
	<CAM8fPiTj-YOXWX9AKO003rkWtBWVRFNbECmyUUi__Kq7uHCSOQ@mail.gmail.com>
	<20050.20841.832144.23484@mail.cern.ch>
Message-ID: <CAM8fPiTFxwecEZDywOrWkf9asRCqhEqkDiY1k85Q_nqo1s+M7w@mail.gmail.com>

On 22 August 2011 08:54, Lionel Cons <lionel.cons at cern.ch> wrote:

> However, this is not a rhetorical question: a simple STOMP shovel will
> read MESSAGE frames in and (re)write them as SEND frames.
>

Interesting. That's a use case that should be considered carefully by all
future designers of messaging protocols, as it's more subtle than it looks
at first glance (as we're seeing now).

>
> IMHO, if RabbitMQ indeed relies on the message-id field, it should
> overwrite it and document this behaviour. This way, a user supplied
> "message-id" won't create anymore a message that cannot be ack'ed.
>

Agreed. Overwritten, or renamed.

Tony
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110822/7479f965/attachment.htm>

From lionel.cons at cern.ch  Mon Aug 22 13:57:18 2011
From: lionel.cons at cern.ch (Lionel Cons)
Date: Mon, 22 Aug 2011 14:57:18 +0200
Subject: [rabbitmq-discuss] STOMP & message-id
In-Reply-To: <CAM8fPiQi7fJ2UJy+=fFvpv1CyHpnFw07E=xAmSiUhNcshSwbgg@mail.gmail.com>
References: <20110822111019.d4af.abe10f7e5afbbb3a79ce619739541149@cern.ch>
	<4E5224C7.6030700@rabbitmq.com>
	<20050.10183.761167.789449@mail.cern.ch>
	<4E5228AA.9030009@rabbitmq.com>
	<20050.12081.459699.853261@mail.cern.ch>
	<CAM8fPiTj-YOXWX9AKO003rkWtBWVRFNbECmyUUi__Kq7uHCSOQ@mail.gmail.com>
	<4E5246DD.7060207@rabbitmq.com>
	<CAM8fPiQi7fJ2UJy+=fFvpv1CyHpnFw07E=xAmSiUhNcshSwbgg@mail.gmail.com>
Message-ID: <20050.21038.673374.807321@mail.cern.ch>

Tony Garnock-Jones writes:
 > OK, that's good; it doesn't explain Lionel's report that SENDing with
 > "message-id" set led to a correspondingly-set "message-id" on the resulting
 > MESSAGE, though.

FWIW, my user-supplied message-id got prepended. The received MESSAGE
frame contained two message-id headers.

Cheers,

Lionel

From ask at rabbitmq.com  Mon Aug 22 14:08:03 2011
From: ask at rabbitmq.com (Ask Solem)
Date: Mon, 22 Aug 2011 14:08:03 +0100
Subject: [rabbitmq-discuss] Temporary queue being made when task fails
In-Reply-To: <7b0d4475-c65a-4525-9052-8e17e7539df6@e20g2000prn.googlegroups.com>
References: <7b0d4475-c65a-4525-9052-8e17e7539df6@e20g2000prn.googlegroups.com>
Message-ID: <2B872529-2B39-4074-BE50-3C3E5F126025@rabbitmq.com>


On 22 Aug 2011, at 08:14, SiddharthSaha wrote:

> I am using Celery with RabbitMQ. Lately, I have noticed that a large
> number of temporary queues are getting made.
> 
> So, I experimented and found that when a task fails (that is a tasks
> raises an Exception), then a temporary queue with a random name (like
> c76861943b0a4f3aaa6a99a6db06952c) is formed and the queue remains.
> 
> Some properties of the temporary queue as found in rabbitmqadmin are
> as follows -
> 
> auto_delete : True consumers : 0 durable : False messages : 1
> messages_ready : 1
> 
> And one such temporary queue is made everytime a task fails (that is,
> raises an Exception). How to avoid this situation? Because in my
> production environment a large number of such queues get formed.
> 
> I do not want this temporary queue to be made. When a task fails, I
> want that the task is tried one more time and even though it fails,
> the temporary queue should not be made.
> 
> How can I do that?

Please see

  http://docs.celeryproject.org/en/latest/userguide/tasks.html#task-states

If you want to disable states completely, set

  CELERY_RESULT_BACKEND = "disabled"

If you want to automatically expire uncollected states, set
http://docs.celeryproject.org/en/latest/configuration.html#celery-amqp-task-result-expires

Results are disabled by default in 2.3,
see changelog: http://docs.celeryproject.org/en/latest/changelog.html#important-notes


> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From andrea.rosa at hp.com  Mon Aug 22 14:35:06 2011
From: andrea.rosa at hp.com (Rosa, Andrea)
Date: Mon, 22 Aug 2011 13:35:06 +0000
Subject: [rabbitmq-discuss] Consumer without a valid connection
In-Reply-To: <4E4E4585.2010309@rabbitmq.com>
References: <8097A4E725D78E41A8B862ACE60E963945EF8F7780@GVW1355EXB.americas.hpqcorp.net>
	<4E4E4585.2010309@rabbitmq.com>
Message-ID: <5F389C517756284F80239F55BCA5DDDD77CD@G9W0721.americas.hpqcorp.net>

> Sent: 19 August 2011 12:14
> To: Rosa, Andrea
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] Consumer without a valid connection
> 
> 
> Hi Andrea,


Hi Emile

> 
> On 19/08/11 11:27, Rosa, Andrea wrote:
> 
> > For some reason, that we can't understand, we have got a queue with
> two
> > consumers and one of this consumer is using a channel of a connection
> > that is not present in the list of connections.
> 
> That should not be possible. If you check the connection pid of each
> channel with "rabbitmqctl list_channels connection" each of them should
> appear in the output of "rabbitmqctl list_connections pid". Is that not
> the case?
> 
Sorry for my late reply. I verified and you are right it's not correct what I wrote.
The situation is that I have a queue with two consumer on two different connections. 
It seems that one of this consumer is a "zombie", to fix the situation I closed all connection and restarted my application 
After that there is just one consumer listening on the queue.
Is it possible that rabbitmq DB become inconsistency/corrupted (for some reason) and that creates this situation?
In this case to clean up the db I can delete the mnesia folder and restart the server?
Is it possible to have more details in the rabbitmq log files?

Thanks for your support
--
andrea


> The output of "rabbitmqctl report" will also contain this information.
> 
> > When the publisher send a message to that queue the message is
> grabbed
> > from the queue after 15 minutes!
> 
> There are a few ways to diagnose who is responsible for that delay. You
> could make all connections via the AMQP Tracer:
> http://www.rabbitmq.com/javadoc/com/rabbitmq/tools/Tracer.html
> 
> You could observe the AMQP exchanges on the network between the broker
> and peers using a protocol analyser, such as Wireshark.
> 
> Also consider debugging with the Firehose, which lets you observe
> messages entering and leaving the broker. Avoid the network when
> consuming the firehose messages. For details see
> http://www.rabbitmq.com/firehose.html
> 
> > My questions are:
> >
> > -        How is it possible that the consumer is using a channel on a
> > connection that no more  exists?
> >
> > -        Why there is this delay in grabbing messages? My expectation
> is
> > that the consumer listening to the correct connection can fetch the
> > message immediately
> >
> > -        The "wrong" consumer can block the access to the queue?
> 
> Is the network between the broker and peers reliable? Consider turning
> on AMQP heartbeats if the broker and peers do not about connections.
> 
> 
> Emile


From sidchilling at gmail.com  Mon Aug 22 14:37:33 2011
From: sidchilling at gmail.com (Siddharth Saha)
Date: Mon, 22 Aug 2011 19:07:33 +0530
Subject: [rabbitmq-discuss] Temporary queue being made when task fails
In-Reply-To: <2B872529-2B39-4074-BE50-3C3E5F126025@rabbitmq.com>
References: <7b0d4475-c65a-4525-9052-8e17e7539df6@e20g2000prn.googlegroups.com>
	<2B872529-2B39-4074-BE50-3C3E5F126025@rabbitmq.com>
Message-ID: <CAJ5t=U5EUM6nyRn9PpPN9Vc_o0JDtmYp+s5jgN5yyesqr-GGbw@mail.gmail.com>


From sidchilling at gmail.com  Mon Aug 22 15:16:59 2011
From: sidchilling at gmail.com (Siddharth Saha)
Date: Mon, 22 Aug 2011 19:46:59 +0530
Subject: [rabbitmq-discuss] Temporary queue being made when task fails
In-Reply-To: <CAJ5t=U6JyXQQfMCeDOi+WEugw_vDbh7cgVAyf6NV+jT1s505Dw@mail.gmail.com>
References: <7b0d4475-c65a-4525-9052-8e17e7539df6@e20g2000prn.googlegroups.com>
	<2B872529-2B39-4074-BE50-3C3E5F126025@rabbitmq.com>
	<CAJ5t=U5EUM6nyRn9PpPN9Vc_o0JDtmYp+s5jgN5yyesqr-GGbw@mail.gmail.com>
	<FD249D66-A20C-4C7D-8FF7-64B95335DCEF@rabbitmq.com>
	<CAJ5t=U6JyXQQfMCeDOi+WEugw_vDbh7cgVAyf6NV+jT1s505Dw@mail.gmail.com>
Message-ID: <CAJ5t=U4Pn69TypO-uVfH_RpT71BovmVuE=xZbPoQOPotiue+cQ@mail.gmail.com>

OK I got the solution.

CELERY_IGNORE_RESULT = True should do the trick for Celery 2.2. The problem
with my configuration was that I was using
CELERY_STORE_ERRORS_EVEN_IF_IGNORED = True which was negating the ignore
result part.

Now, the extra queues are not being formed anymore.

Thanks. Just wanted to ask - is there any side-effects of this change of
configuration which I should check?

On Mon, Aug 22, 2011 at 7:15 PM, Siddharth Saha <sidchilling at gmail.com>wrote:

> Yes, I am using Celery2.2 and upgrading it is not the solution I'm looking
> for now. May be in the near future :)
>
> But, I am already using CELERY_IGNORE_RESULT = True but that also it now
> solving the problem. I've been using this configuration already.
>
>
> On Mon, Aug 22, 2011 at 7:11 PM, Ask Solem <ask at rabbitmq.com> wrote:
>
>>
>> On 22 Aug 2011, at 14:37, Siddharth Saha wrote:
>>
>> > From the doc, it seems the default option of CELERY_RESULT_BACKEND is
>> disabled. And if you write -
>> >
>> >  CELERY_RESULT_BACKEND = "disabled"
>> >
>> > in the celeryconfig.py file, then celery does not start with the error -
>> > ValueError: Unknown result backend: 'disabled'.  Did you spell it
>> correctly?  (Couldn't import 'disabled': Empty module name)
>> >
>> > From the doc, I do not find the disabled option for
>> CELERY_RESULT_BACKEND. The available options are -
>> >
>> >       ? database
>> >       ? cache
>> >       ? mongodb
>> >       ? redis
>> >       ? tyrant
>> >       ? amqp
>> > And in my case, I am not setting this option at all, so it must be
>> disabled by default. Is there anything else which I might be missing?
>> >
>>
>> Please upgrade to 2.3, or set CELERY_IGNORE_RESULT=True.
>>
>>
>
>
> --
> -Siddharth Saha
>
>
>


-- 
-Siddharth Saha
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110822/5d129681/attachment.htm>

From msteele at beringmedia.com  Mon Aug 22 15:42:41 2011
From: msteele at beringmedia.com (Mark Steele)
Date: Mon, 22 Aug 2011 10:42:41 -0400
Subject: [rabbitmq-discuss] Temporary queue being made when task fails
In-Reply-To: <7b0d4475-c65a-4525-9052-8e17e7539df6@e20g2000prn.googlegroups.com>
References: <7b0d4475-c65a-4525-9052-8e17e7539df6@e20g2000prn.googlegroups.com>
Message-ID: <CAH24rBP1MvwsDmmwy2mRphHKO5qLUMOdtE28_gdcvX-gCS-fJw@mail.gmail.com>

Incidentally, I have also seen this behavior (where autodelete queues
don't get deleted). I'm assuming it's a bug.

Mark Steele
Bering Media Inc.

On Mon, Aug 22, 2011 at 3:14 AM, SiddharthSaha <sidchilling at gmail.com> wrote:
> I am using Celery with RabbitMQ. Lately, I have noticed that a large
> number of temporary queues are getting made.
>
> So, I experimented and found that when a task fails (that is a tasks
> raises an Exception), then a temporary queue with a random name (like
> c76861943b0a4f3aaa6a99a6db06952c) is formed and the queue remains.
>
> Some properties of the temporary queue as found in rabbitmqadmin are
> as follows -
>
> auto_delete : True consumers : 0 durable : False messages : 1
> messages_ready : 1
>
> And one such temporary queue is made everytime a task fails (that is,
> raises an Exception). How to avoid this situation? Because in my
> production environment a large number of such queues get formed.
>
> I do not want this temporary queue to be made. When a task fails, I
> want that the task is tried one more time and even though it fails,
> the temporary queue should not be made.
>
> How can I do that?
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From matthias at rabbitmq.com  Mon Aug 22 16:36:42 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 22 Aug 2011 16:36:42 +0100
Subject: [rabbitmq-discuss] Temporary queue being made when task fails
In-Reply-To: <CAH24rBP1MvwsDmmwy2mRphHKO5qLUMOdtE28_gdcvX-gCS-fJw@mail.gmail.com>
References: <7b0d4475-c65a-4525-9052-8e17e7539df6@e20g2000prn.googlegroups.com>
	<CAH24rBP1MvwsDmmwy2mRphHKO5qLUMOdtE28_gdcvX-gCS-fJw@mail.gmail.com>
Message-ID: <4E52778A.8040002@rabbitmq.com>

Mark,

On 22/08/11 15:42, Mark Steele wrote:
> Incidentally, I have also seen this behavior (where autodelete queues
> don't get deleted). I'm assuming it's a bug.

Have you seen this in the context of celery or in general?

I am not aware of any problems with auto-delete queues in Rabbit.


Matthias.

From majek04 at gmail.com  Mon Aug 22 16:47:19 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Mon, 22 Aug 2011 16:47:19 +0100
Subject: [rabbitmq-discuss] Connect to rabbitmq outside the host
In-Reply-To: <CANWvfmCAh8p2gCzX+FUs5+c+Pa0qf7GTpPO4a_NVjZbz=GhgdQ@mail.gmail.com>
References: <0d391690-f49c-48fa-9563-4bc776d1482b@w11g2000vbp.googlegroups.com>
	<CAGSj+QtW_2VnqASU2OhH3toLg7U-8XmgfDFvCkONrYiLscm6aw@mail.gmail.com>
	<CANWvfmAqKgXQT-+pXqEXEYekMFbO0vfggTP=Z8SYQBtF84vCLQ@mail.gmail.com>
	<4E4E4D48.8070601@rabbitmq.com>
	<CAMcAHLUM+YNnf7WFooskG_t9hma7HCzmCuUxxNzQOBJ7qwew+g@mail.gmail.com>
	<CANWvfmCAh8p2gCzX+FUs5+c+Pa0qf7GTpPO4a_NVjZbz=GhgdQ@mail.gmail.com>
Message-ID: <CABzX+qwrfzAKrOfcx1kUA7W9HwO6eXwQq=Jvgm77Dpv51v-D5w@mail.gmail.com>

On Fri, Aug 19, 2011 at 20:01, Andrei Varanovich <dotnetby at gmail.com> wrote:
> Alvaro, Matthias,
> Thanks for your replies!
> Yes you?understood?me correctly, I want to connect to the broker (which is
> inside amazon) from the client outside.

I assume you have a consumer or producer using an AMQP protocol, which
is using tcp port 5672.

> I also realized myself that using an external IP I can connect, and this is
> what you are also pointing out;?however?is that still possible to use FQDN,
> and not IP address in the "external" connections? At the moment only IP
> address works for me.

That looks like a dns issue on your side. What happens if on the client
side you do:
 telnet <ip> 5672
and
 telnet <dns> 5672


Cheers,
 Marek

From ask at rabbitmq.com  Mon Aug 22 16:52:57 2011
From: ask at rabbitmq.com (Ask Solem)
Date: Mon, 22 Aug 2011 16:52:57 +0100
Subject: [rabbitmq-discuss] Temporary queue being made when task fails
In-Reply-To: <4E52778A.8040002@rabbitmq.com>
References: <7b0d4475-c65a-4525-9052-8e17e7539df6@e20g2000prn.googlegroups.com>
	<CAH24rBP1MvwsDmmwy2mRphHKO5qLUMOdtE28_gdcvX-gCS-fJw@mail.gmail.com>
	<4E52778A.8040002@rabbitmq.com>
Message-ID: <05EC938E-FB1E-45BB-B612-DABECC0B6395@rabbitmq.com>


On 22 Aug 2011, at 16:36, Matthias Radestock wrote:

> Mark,
> 
> On 22/08/11 15:42, Mark Steele wrote:
>> Incidentally, I have also seen this behavior (where autodelete queues
>> don't get deleted). I'm assuming it's a bug.
> 
> Have you seen this in the context of celery or in general?
> 
> I am not aware of any problems with auto-delete queues in Rabbit.
> 


Note that auto_delete queues are not deleted until the last consumer
stops consuming from it, and an auto_delete queue is *not*
deleted if there have never been any consumers consuming from it.

This is what the x-expires argument to queue_declare was meant to solve:
http://www.rabbitmq.com/extensions.html#queue-leases

x-expires is supported by Celery, but not disabled by default as it
was first introduced in RabbitMQ 2.1.0 (which considering that it is
quite some time ago now, it can probably be enabled by default soon).

From majek04 at gmail.com  Mon Aug 22 16:57:34 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Mon, 22 Aug 2011 16:57:34 +0100
Subject: [rabbitmq-discuss] NotImplementedError: <class
	'pika.spec.CancelOk'>
In-Reply-To: <BLU0-SMTP2688BC4CF69521FBC5ACCEBD6290@phx.gbl>
References: <39C8DD04C7C04F10879AF2EF8BF8E901@myyearbook.com>
	<BLU0-SMTP2688BC4CF69521FBC5ACCEBD6290@phx.gbl>
Message-ID: <CABzX+qxHZYRbu9yqsQHVRnT0Cp7jBKy5UEKUNqKWTaMYw1zvyg@mail.gmail.com>

Matt,

Were you able to get it working?

Cheers,
  Marek

On Tue, Aug 16, 2011 at 17:51, Matt Pietrek <mpietrek at hotmail.com> wrote:
> Thanks for the quick reply Gavin.
> I've got no idea how my install would be non-standard. It's an Ubuntu 11.04
> box, recently updated via "sudo apt-get upgrade". FWIW, my Python 2.7
> install is based in /usr/local/lib/python2.7, so the /local/ in the path
> isn't surprising (to me at least...)
> Per the instructions on the RabbitMq site, I did: "sudo pip install
> pika==0.9.5".?I didn't notice any errors:
> ----------------
> mpietrek at rabbitmq:/usr/local/lib/python2.7$sudo pip install pika==0.9.5
> Downloading/unpacking pika==0.9.5
> ? Downloading pika-0.9.5.tar.gz
> ? Running setup.py egg_info for package pika
>
> Installing collected packages: pika
> ? Running setup.py install for pika
>
> Successfully installed pika
> Cleaning up...
> ----------------
> The output from Interactive Python that you requested:
> Python 2.7.1+ (r271:86832, Apr 11 2011, 18:13:53)
> [GCC 4.5.2] on linux2
> Type "help", "copyright", "credits" or "license" for more information.
>>>> import pika
>>>> pika.__version__
> '0.9.5'
> Also, FWIW, the contents of
> ?/usr/local/lib/python2.7/dist-packages/pika-0.9.5.egg-info/PKG_INFO?are:
> Metadata-Version: 1.0
> Name: pika
> Version: 0.9.5
> Summary: Pika Python AMQP Client Library
> Home-page: http://pika.github.com/
> Author: Gavin M. Roy
> Author-email: gmr at myyearbook.com
> License: MPL v1.1 and GPL v2.0 or newer
> Description: Pika is a pure-Python implementation of the AMQP 0-9-1 protocol
> that
> ? ? ? ? tries to stay fairly independent of the underlying network support
> ? ? ? ? library. Pika was developed primarily for use with RabbitMQ, but
> ? ? ? ? should also work with other AMQP 0-9-1 brokers.
>
> Platform: UNKNOWN
> Classifier: Development Status :: 4 - Beta
> Classifier: Intended Audience :: Developers
> Classifier: License :: OSI Approved :: GNU General Public License (GPL)
> Classifier: License :: OSI Approved :: Mozilla Public License 1.1 (MPL 1.1)
> Classifier: Operating System :: OS Independent
> Classifier: Topic :: Communications
> Classifier: Topic :: Internet
> Classifier: Topic :: Software Development :: Libraries
> Thanks much for your help,
> Matt
> From: "Gavin M. Roy" <gmr at myyearbook.com>
> Date: Tue, 16 Aug 2011 12:32:44 -0400
> To: Matt Pietrek <mpietrek at hotmail.com>
> Cc: Marek Majkowski <majek04 at gmail.com>,
> <rabbitmq-discuss at lists.rabbitmq.com>
> Subject: Re: [rabbitmq-discuss] NotImplementedError: <class
> 'pika.spec.CancelOk'>
>
> It looks like to me that you have a non-standard pika install, perhaps the
> new debian package?
> I say that because I see:
>
> /usr/local/lib/python2.7/dist-packages/pika/connection.py
>
> And I'd expect something like:
> /usr/lib/python2.7/site-packages/pika/connection.py
> Can you use slocate or find to see if you have more than one version of pika
> installed?
> What happens when you run the following in python2.7 interactively?
> import pika
> pika.__version__
>
>
> On Tuesday, August 16, 2011 at 12:18 PM, Matt Pietrek wrote:
>
> Alas, no luck with a Pika reinstall. I did a "pip uninstall" of what was
> there, verified the files were removed, then "pip install".
>
> All other aspects of my Pika-based code seem to work. I'm sending and
> receiving 1000's of messages before shutting down. It's only at shutdown
> where the problem occurs.
>
> Does my shutdown sequence look OK? That is, calling
> channel.stop_consuming() from a different thread than I called
> .start_consuming on?
>
>
>
> On 8/16/11 4:29 AM, "Marek Majkowski" <majek04 at gmail.com> wrote:
>
> On Tue, Aug 16, 2011 at 00:36, Matt Pietrek <mpietrek at hotmail.com> wrote:
>
> I'm getting the following error from code that used to work without
> error until I did an "apt-get upgrade" today.
>
> This is an Ubuntu 11.04 system running Python 2.7 and Pika 0.95. Any
> clues what's happening?
>
> Nope. Maybe it's just a python installation issue?
>
> Can you try removing pika and installing it again? Or maybe
> installing a fresh local copy (for example using venv)?
>
> Cheers,
> Marek
>
> Traceback (most recent call last):
> File "/usr/lib/python2.7/threading.py", line 552, in
> __bootstrap_inner
> self.run()
> File "ConfigMgr.py", line 101, in run
> self.channel.start_consuming()
> File "/usr/local/lib/python2.7/dist-packages/pika/adapters/
> blocking_connection.py", line 293, in start_consuming
> self.transport.connection.process_data_events()
> File "/usr/local/lib/python2.7/dist-packages/pika/adapters/
> blocking_connection.py", line 94, in process_data_events
> self._handle_read()
> File "/usr/local/lib/python2.7/dist-packages/pika/adapters/
> base_connection.py", line 162, in _handle_read
> self._on_data_available(data)
> File "/usr/local/lib/python2.7/dist-packages/pika/connection.py",
> line 599, in _on_data_available
> self._channels[frame.channel_number].transport.deliver(frame)
> File "/usr/local/lib/python2.7/dist-packages/pika/channel.py", line
> 64, in deliver
> self.frame_dispatcher.process(frame)
> File "/usr/local/lib/python2.7/dist-packages/pika/frame.py", line
> 202, in process
> self._handler(frame)
> File "/usr/local/lib/python2.7/dist-packages/pika/frame.py", line
> 220, in _handle_method_frame
> raise NotImplementedError(frame.method.__class__)
> NotImplementedError: <class 'pika.spec.CancelOk'>
>
> Here's what my code looks like:
>
> class ListenForLongRunningEventCompletion(threading.Thread):
> def run(self):
> self.connection =
> pika.BlockingConnection(pika.ConnectionParameters(host=MQ_BINDING))
> self.channel = self.connection.channel()
>
> self.channel.queue_declare(queue=RESPONSE_QUEUE_NAME)
> self.channel.basic_consume(ResponseCallback,
> queue=RESPONSE_QUEUE_NAME,
> no_ack=True)
> self.channel.start_consuming()
>
> def shutdown(self):
> self.channel.stop_consuming()
>
> def ResponseCallback(ch, method, properties, body):
> print "Long Running Task response({0})".format(body)
>
>
> #========================================================================
> ======
> #
> # Main program
> #
>
> #========================================================================
> ======
>
> if __name__ == '__main__':
> listener = ListenForLongRunningEventCompletion()
> listener.start()
>
> # Main app logic - not important here
>
> # Shut down the connections we've opened up
> listener.shutdown()
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From jeff at ocjtech.us  Mon Aug 22 17:32:18 2011
From: jeff at ocjtech.us (Jeffrey Ollie)
Date: Mon, 22 Aug 2011 11:32:18 -0500
Subject: [rabbitmq-discuss] Spec file for txAMQP?
In-Reply-To: <CACOPnveGb-o=wfrUow8iMX4snhTMmod=9ozFojgdvVKh3MNPKg@mail.gmail.com>
References: <CAD-DQxRMTP+S1s7TFP3-2r8LoA1rmG2di9TeoxLqKHOOPxrhpg@mail.gmail.com>
	<CACOPnveGb-o=wfrUow8iMX4snhTMmod=9ozFojgdvVKh3MNPKg@mail.gmail.com>
Message-ID: <CAD-DQxRHQ70s1tfU8zsyDKEJ9wP=5ofSOazWcPgaASF0b0fD-w@mail.gmail.com>

On Sat, Aug 20, 2011 at 1:59 PM, Alexis Richardson <alexis at rabbitmq.com> wrote:
>
> Which ones have you tried to use?

The only one that I have gotten to work reliably is:

http://bazaar.launchpad.net/~txamqpteam/txamqp/trunk/view/head:/src/specs/rabbitmq/amqp0-8.stripped.rabbitmq.xml

All of the others that I have tried, including those from the Fedora
amqp package (which just packages up specs downloaded from amqp.org I
believe) fail in one way another.

> On Fri, Aug 19, 2011 at 6:50 PM, Jeffrey Ollie <jeff at ocjtech.us> wrote:
>> Is there a recommended XML spec file to use with txAMQP and RabbitMQ?
>> The spec files that I have found so far either don't work with
>> RabbitMQ or don't contain definitions for some of the newer
>> functionality.

-- 
Jeff Ollie

From rparra at homeaway.com  Mon Aug 22 18:31:43 2011
From: rparra at homeaway.com (Rene Parra)
Date: Mon, 22 Aug 2011 12:31:43 -0500
Subject: [rabbitmq-discuss] Management Plugin stops gathering stats ?
Message-ID: <CA77FCAF.E905%rparra@homeaway.com>

Hi everyone...

I?ve been performing a load/soak test on RabbitMQ before we promote our
configuration into production, and have run into a little bit of a snag.

The Management Plugin seems to gather statistics on the test just fine, but
after about ~6min to about ~12min into the soak test, the management plugin
seems to  STOP collecting stats on my queues!!  Thereafter, the throughput
seemingly (but falsely) goes to zero. The test is actually proceeding just
fine and queues are happily receiving, delivering, and receiving acks for
their messages.

Restarting the disk node seems to clear the management plugin to resume
collecting statistics.

My question is: Is there some upper threshold in the management plugin that
I need to set to continue gathering statistics throughout my test ?  This
feels like a classic ?invisible threshold being hit somewhere? problem.

Here?s a snapshot of the management UI screen working as expected:

http://i.imgur.com/8eXNM.png

Here?s a ScreenCast of the management UI working and then ?FAILS?:

http://goo.gl/jrvAP

(please fast forward to these time points in the screencast)

* @2m 16s:  The system runs normally and then I demo the queues stats
collection working perfectly.
* @2m 56s:  Connection View shows normal operating behavior.
* @3m 34s:  The ?weird behavior? begins... it seems that TPS drops off to 30
TPS then 0 TPS!! 
* @4m 22s:  Connection View showing throughput has ?stopped?.

External metric gathering confirms the test still ?runs? and messages are
being delivered successfully.

Has anyone else experienced this weirdness with the mgmt plugin?

Any help would be greatly appreciated.
-rparra
 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110822/63160ff1/attachment.htm>

From msteele at beringmedia.com  Mon Aug 22 18:47:13 2011
From: msteele at beringmedia.com (Mark Steele)
Date: Mon, 22 Aug 2011 13:47:13 -0400
Subject: [rabbitmq-discuss] Temporary queue being made when task fails
In-Reply-To: <4E52778A.8040002@rabbitmq.com>
References: <7b0d4475-c65a-4525-9052-8e17e7539df6@e20g2000prn.googlegroups.com>
	<CAH24rBP1MvwsDmmwy2mRphHKO5qLUMOdtE28_gdcvX-gCS-fJw@mail.gmail.com>
	<4E52778A.8040002@rabbitmq.com>
Message-ID: <CAH24rBMc24umzdmez0h_yOGZ5+xRRxaTo8QyEt1msxEOqDNZtA@mail.gmail.com>

This was not in the context of celery. One of our applications creates
an auto_delete non-durable private queue and binds it to an exchange.
Every once in a while (let's call it once every quarter or so) we've
observed that if communication is broken (network issue, cable
unplugged, etc...) the client disconnects (and restarts), however the
queue remains there forever until manually deleted, accumulating
messages. To finally get it to be deleted, we have to do a
`rabbitmqctl close_connection` with the pid.

If I remember correctly, the server is aware that there is no clients
connected to the queue, however it doesn't delete it for some reason.
Next time it happens, I'll post more details. I suspect it's somehow
related to an unclean connection teardown and/or ssl.

Cheers,

Mark

On Mon, Aug 22, 2011 at 11:36 AM, Matthias Radestock
<matthias at rabbitmq.com> wrote:
> Mark,
>
> On 22/08/11 15:42, Mark Steele wrote:
>>
>> Incidentally, I have also seen this behavior (where autodelete queues
>> don't get deleted). I'm assuming it's a bug.
>
> Have you seen this in the context of celery or in general?
>
> I am not aware of any problems with auto-delete queues in Rabbit.
>
>
> Matthias.
>

From rishdev at gmail.com  Mon Aug 22 19:01:30 2011
From: rishdev at gmail.com (Rishi Dev)
Date: Mon, 22 Aug 2011 12:01:30 -0600
Subject: [rabbitmq-discuss] Message CorrelationId
Message-ID: <CANjYesgm922byfCqo+tW-u0ydu1XSECu8sckXcbJpT4pOzO_-Q@mail.gmail.com>

Hi,

We have a messaging requirement in which the component (let us say
Component1) which publishes a message into (let us say) Queue1, waits for
it's response to come in Queue2.
It filters through messages of Queue2 using it's CorrelationId that it sent
as part of the message in Queue1.
The other component (let us say Component2) which processes messages from
Queue1 and puts the response back in Queue2 ensures to put CorrelationId in
the message object.

The above scenario currently works fine using ActiveMQ. Now that we are
planning to move from ActiveMQ to RabbitMQ, we need to ensure that our
messaging requirements are achieved with Rabbit.

I briefly looked at "*MessageProperties.BASIC.setCorrelationId(corrId);*"
It makes me feel good that I can set a CorrelationId on message when pushing
it to the Queue, but I am not able to figure out how I can filter messages
using this CorrelationId while consuming messages from the Queue.

Thanks for any help I can get on this.

Rishi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110822/f18e66bf/attachment.htm>

From michael.s.klishin at gmail.com  Mon Aug 22 19:13:10 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 22 Aug 2011 22:13:10 +0400
Subject: [rabbitmq-discuss] Message CorrelationId
In-Reply-To: <CANjYesgm922byfCqo+tW-u0ydu1XSECu8sckXcbJpT4pOzO_-Q@mail.gmail.com>
References: <CANjYesgm922byfCqo+tW-u0ydu1XSECu8sckXcbJpT4pOzO_-Q@mail.gmail.com>
Message-ID: <CAE3HoVQeGgBuppT=3fE_HQqDHiu+EaCKxB-vO1DPxsVY+ZY5rw@mail.gmail.com>

2011/8/22 Rishi Dev <rishdev at gmail.com>

> I briefly looked at "*MessageProperties.BASIC.setCorrelationId(corrId);*"
> It makes me feel good that I can set a CorrelationId on message when
> pushing it to the Queue, but I am not able to figure out how I can filter
> messages using this CorrelationId while consuming messages from the Queue.
>
> Thanks for any help I can get on this.
>

Rishi,

This pattern (known as Request/Reply) is described in RabbitMQ tutorials at
http://www.rabbitmq.com/getstarted.html
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110822/7419a3c1/attachment.htm>

From majek04 at gmail.com  Mon Aug 22 19:53:46 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Mon, 22 Aug 2011 19:53:46 +0100
Subject: [rabbitmq-discuss] Spec file for txAMQP?
In-Reply-To: <CAD-DQxRHQ70s1tfU8zsyDKEJ9wP=5ofSOazWcPgaASF0b0fD-w@mail.gmail.com>
References: <CAD-DQxRMTP+S1s7TFP3-2r8LoA1rmG2di9TeoxLqKHOOPxrhpg@mail.gmail.com>
	<CACOPnveGb-o=wfrUow8iMX4snhTMmod=9ozFojgdvVKh3MNPKg@mail.gmail.com>
	<CAD-DQxRHQ70s1tfU8zsyDKEJ9wP=5ofSOazWcPgaASF0b0fD-w@mail.gmail.com>
Message-ID: <CABzX+qygYPpSisA+PWOewAYSaZeW_KCXj9YdJ28B05sW_aBurA@mail.gmail.com>

On Mon, Aug 22, 2011 at 17:32, Jeffrey Ollie <jeff at ocjtech.us> wrote:
> On Sat, Aug 20, 2011 at 1:59 PM, Alexis Richardson <alexis at rabbitmq.com> wrote:
>>
>> Which ones have you tried to use?
>
> The only one that I have gotten to work reliably is:
>
> http://bazaar.launchpad.net/~txamqpteam/txamqp/trunk/view/head:/src/specs/rabbitmq/amqp0-8.stripped.rabbitmq.xml
>
> All of the others that I have tried, including those from the Fedora
> amqp package (which just packages up specs downloaded from amqp.org I
> believe) fail in one way another.

Well, we do distribute some xml with dotnet client AFAIR,
but I would doubt if it's going to work.

I do know that Gavin tried to get Pika working in twisted,
though I don't know what "new" RabbitMQ features are supported.

Marek

>> On Fri, Aug 19, 2011 at 6:50 PM, Jeffrey Ollie <jeff at ocjtech.us> wrote:
>>> Is there a recommended XML spec file to use with txAMQP and RabbitMQ?
>>> The spec files that I have found so far either don't work with
>>> RabbitMQ or don't contain definitions for some of the newer
>>> functionality.
>
> --
> Jeff Ollie
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From jasonjwwilliams at gmail.com  Mon Aug 22 20:13:20 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Mon, 22 Aug 2011 13:13:20 -0600
Subject: [rabbitmq-discuss] Spec file for txAMQP?
In-Reply-To: <CAD-DQxRMTP+S1s7TFP3-2r8LoA1rmG2di9TeoxLqKHOOPxrhpg@mail.gmail.com>
References: <CAD-DQxRMTP+S1s7TFP3-2r8LoA1rmG2di9TeoxLqKHOOPxrhpg@mail.gmail.com>
Message-ID: <CAHZAEpejhRQ_NGALZTKAh68STxUT+7h39c83att-K00WY9rwtQ@mail.gmail.com>

We've always used the attached spec file with txAMQP. It would be nice
to get a 0-9-1 spec file working with it.

-J

On Fri, Aug 19, 2011 at 11:50 AM, Jeffrey Ollie <jeff at ocjtech.us> wrote:
> Is there a recommended XML spec file to use with txAMQP and RabbitMQ?
> The spec files that I have found so far either don't work with
> RabbitMQ or don't contain definitions for some of the newer
> functionality.
>
> --
> Jeff Ollie
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: amqp0-8.stripped.rabbitmq.xml
Type: text/xml
Size: 32057 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110822/a2689c6f/attachment.bin>

From RParra at homeaway.com  Mon Aug 22 20:27:52 2011
From: RParra at homeaway.com (Rene Parra)
Date: Mon, 22 Aug 2011 14:27:52 -0500
Subject: [rabbitmq-discuss] Management Plugin stops gathering stats ?
In-Reply-To: <CA77FCAF.E905%rparra@homeaway.com>
Message-ID: <CA7817E8.E91C%rparra@homeaway.com>

A follow on is:

Would the mgmt-plugin reporting a false stat of ?~0 TPS? result in rabbit
**not throttling** when it exceeds the high watermark for memory?

http://i.imgur.com/TMk3O.png

I?m afraid that if I ?dial up? my load test any further it could cause
rabbit to start swapping when instead it should be garbage collecting to
reclaim some memory.

Reminder: The load test is quite ?light?... 10 concurrent producers, each at
about 10 TPS a second (100 ms sleep time for each task); 10 queues, each
with 10 consumers on their own threads.  => 100 TPS sustained load.  The
payload is a BigDecimal wrapped with a simple <value></value> tag for XML.

-rparra

On 8/22/11 12:31 PM, "Rene Parra" <rparra at homeaway.com> wrote:

> Hi everyone...
> 
> I?ve been performing a load/soak test on RabbitMQ before we promote our
> configuration into production, and have run into a little bit of a snag.
> 
> The Management Plugin seems to gather statistics on the test just fine, but
> after about ~6min to about ~12min into the soak test, the management plugin
> seems to  STOP collecting stats on my queues!!  Thereafter, the throughput
> seemingly (but falsely) goes to zero. The test is actually proceeding just
> fine and queues are happily receiving, delivering, and receiving acks for
> their messages.
> 
> Restarting the disk node seems to clear the management plugin to resume
> collecting statistics.
> 
> My question is: Is there some upper threshold in the management plugin that I
> need to set to continue gathering statistics throughout my test ?  This feels
> like a classic ?invisible threshold being hit somewhere? problem.
> 
> Here?s a snapshot of the management UI screen working as expected:
> 
> http://i.imgur.com/8eXNM.png
> 
> Here?s a ScreenCast of the management UI working and then ?FAILS?:
> 
> http://goo.gl/jrvAP
> 
> (please fast forward to these time points in the screencast)
> 
> * @2m 16s:  The system runs normally and then I demo the queues stats
> collection working perfectly.
> * @2m 56s:  Connection View shows normal operating behavior.
> * @3m 34s:  The ?weird behavior? begins... it seems that TPS drops off to 30
> TPS then 0 TPS!! 
> * @4m 22s:  Connection View showing throughput has ?stopped?.
> 
> External metric gathering confirms the test still ?runs? and messages are
> being delivered successfully.
> 
> Has anyone else experienced this weirdness with the mgmt plugin?
> 
> Any help would be greatly appreciated.
> -rparra
>  
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110822/255dd29e/attachment.htm>

From interglossa at gmail.com  Mon Aug 22 22:12:47 2011
From: interglossa at gmail.com (interglossa)
Date: Mon, 22 Aug 2011 14:12:47 -0700 (PDT)
Subject: [rabbitmq-discuss] problem starting rabbitmq
Message-ID: <73d3f602-0635-4f5e-b1a4-b5d6235156b3@v7g2000vbk.googlegroups.com>

I have downloaded rabbitmq--server-generic-unix-2.5.1.tar (generic
linux tar) and am trying to run it on RHL 2.6.18-238.12.1.el5.  I have
built erlang 5.8.4 (R14B03) and when I run the server I get the
message

Activating RabbitMQ plugins ...
ERROR: generation of boot script file /export/xxx/
rabbitmq_server-2.5.1/mnesia/rabbit at hostname-plugins-expand/
rabbit.script failed:
{'EXIT',{{badmatch,{erl_prim_loader,error}},
         [{xref_utils,find_beam,1},
          {xref_base,'-make_libs/5-fun-0-',2},
          {lists,foldl,3},
          {xref_base,make_libs,5},
          {xref_base,do_set_up,1},
          {xref_base,do_set_up,2},
          {xref_base,q,3},
          {xref,handle_call,3}]}}

Does this look as though I am using the wrong version of erlang for
this rabbitmq release?

From almumontiel at gmail.com  Tue Aug 23 09:29:04 2011
From: almumontiel at gmail.com (Almudena)
Date: Tue, 23 Aug 2011 01:29:04 -0700 (PDT)
Subject: [rabbitmq-discuss] sinatra web server
In-Reply-To: <CABzX+qzehuCy2=qDpqOraTEv8Gc-kdOLv-bG-qRSSci4-f-ytQ@mail.gmail.com>
References: <aa00c3a1-b00e-4f88-ac01-3953fcf9a911@h9g2000vbr.googlegroups.com>
	<CABzX+qzehuCy2=qDpqOraTEv8Gc-kdOLv-bG-qRSSci4-f-ytQ@mail.gmail.com>
Message-ID: <3a9782bd-1dd3-4e72-9d99-9991d6d053b5@g9g2000yqb.googlegroups.com>

Hi
thanks a lot for being so helpful.
I went through the documentation and I understood mostly what I would
like is the "Event" pattern.
The scenario is the next: theres a tool (http://collectd.org/) that
collects monitoring info (in rrdtool) for each node and could be
displayed on a browser (this is done via a Sinatra app). I would like
to implement the "aggregation" of such info, so that I gather the info
in an asynchronous way. The communication would be 1:N.
For this, would I need a rabbitmq agent on each node?

I would appreciate any suggestion on how to go forward.

Cheers

On Aug 22, 1:13?pm, Marek Majkowski <maje... at gmail.com> wrote:
> On Mon, Aug 22, 2011 at 10:28, Almudena <almumont... at gmail.com> wrote:
> > I am new to rabbitMQ and I quite not understand completely the whole
> > thing. I am trying to use the messaging technology to implement the
> > "load balancing" of my webserver, and with this I mean to distribute
> > the calls made to my website into several clients.
> > I would like to get answers quickly from my server, and no matter if
> > it is the very last information, but the most approximate calculated
> > by the clients (the application is a monitor system for my
> > infrastructure, and it should collect info from many machines).
>
> I'm afraid there isn't a short answer. If you want to develop
> something using Rabbit, you should spend some time and
> learn underlying concepts and abstractions.
>
> If you want to read about the basics, follow the links
> shared by Michael:http://rubydoc.info/github/ruby-amqp/amqp/master/file/docs/AMQP091Mod...
>
> If you want to jump straight into the code, take look
> at RabbitMQ tutorials:http://www.rabbitmq.com/getstarted.html
>
> Cheers,
> ? Marek
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From michael.s.klishin at gmail.com  Tue Aug 23 09:38:04 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 23 Aug 2011 12:38:04 +0400
Subject: [rabbitmq-discuss] sinatra web server
In-Reply-To: <3a9782bd-1dd3-4e72-9d99-9991d6d053b5@g9g2000yqb.googlegroups.com>
References: <aa00c3a1-b00e-4f88-ac01-3953fcf9a911@h9g2000vbr.googlegroups.com>
	<CABzX+qzehuCy2=qDpqOraTEv8Gc-kdOLv-bG-qRSSci4-f-ytQ@mail.gmail.com>
	<3a9782bd-1dd3-4e72-9d99-9991d6d053b5@g9g2000yqb.googlegroups.com>
Message-ID: <CAE3HoVQHJCxBvywe+2TKvEOkq544SMrUoOSbYQV7A+vQ-9jdkQ@mail.gmail.com>

2011/8/23 Almudena <almumontiel at gmail.com>

> The scenario is the next: theres a tool (http://collectd.org/) that
> collects monitoring info (in rrdtool) for each node and could be
> displayed on a browser (this is done via a Sinatra app). I would like
> to implement the "aggregation" of such info, so that I gather the info
> in an asynchronous way. The communication would be 1:N.
>

How will this data aggregated? You want to display/filter data that is
already collected, correct? Do you care if your UI is real-time? What is the
bottom line of browser versions you need to support?


> For this, would I need a rabbitmq agent on each node?
>
>
No, you need RabbitMQ running on just 1 node (or a few, if you need a high
availability setup).

-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110823/f671981f/attachment.htm>

From almumontiel at gmail.com  Tue Aug 23 09:55:04 2011
From: almumontiel at gmail.com (LooL)
Date: Tue, 23 Aug 2011 01:55:04 -0700 (PDT)
Subject: [rabbitmq-discuss] sinatra web server
In-Reply-To: <CAE3HoVQHJCxBvywe+2TKvEOkq544SMrUoOSbYQV7A+vQ-9jdkQ@mail.gmail.com>
References: <aa00c3a1-b00e-4f88-ac01-3953fcf9a911@h9g2000vbr.googlegroups.com>
	<CABzX+qzehuCy2=qDpqOraTEv8Gc-kdOLv-bG-qRSSci4-f-ytQ@mail.gmail.com>
	<3a9782bd-1dd3-4e72-9d99-9991d6d053b5@g9g2000yqb.googlegroups.com>
	<CAE3HoVQHJCxBvywe+2TKvEOkq544SMrUoOSbYQV7A+vQ-9jdkQ@mail.gmail.com>
Message-ID: <574cb584-5e99-4714-b762-0d066d063b6b@fv14g2000vbb.googlegroups.com>

The collection is done by hostname, so the aggregation will be just
gathering.
Yes, I want to display data that is already collected.
The UI does not need to be real-time. Could have a small delay.
I would consider only modern browsers.


Thanks a lot.

On Aug 23, 10:38?am, Michael Klishin <michael.s.klis... at gmail.com>
wrote:
> 2011/8/23 Almudena <almumont... at gmail.com>
>
> > The scenario is the next: theres a tool (http://collectd.org/) that
> > collects monitoring info (in rrdtool) for each node and could be
> > displayed on a browser (this is done via a Sinatra app). I would like
> > to implement the "aggregation" of such info, so that I gather the info
> > in an asynchronous way. The communication would be 1:N.
>
> How will this data aggregated? You want to display/filter data that is
> already collected, correct? Do you care if your UI is real-time? What is the
> bottom line of browser versions you need to support?
>
> > For this, would I need a rabbitmq agent on each node?
>
> No, you need RabbitMQ running on just 1 node (or a few, if you need a high
> availability setup).
>
> --
> MK
>
> http://github.com/michaelklishinhttp://twitter.com/michaelklishin
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From michael.s.klishin at gmail.com  Tue Aug 23 10:08:47 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 23 Aug 2011 13:08:47 +0400
Subject: [rabbitmq-discuss] sinatra web server
In-Reply-To: <574cb584-5e99-4714-b762-0d066d063b6b@fv14g2000vbb.googlegroups.com>
References: <aa00c3a1-b00e-4f88-ac01-3953fcf9a911@h9g2000vbr.googlegroups.com>
	<CABzX+qzehuCy2=qDpqOraTEv8Gc-kdOLv-bG-qRSSci4-f-ytQ@mail.gmail.com>
	<3a9782bd-1dd3-4e72-9d99-9991d6d053b5@g9g2000yqb.googlegroups.com>
	<CAE3HoVQHJCxBvywe+2TKvEOkq544SMrUoOSbYQV7A+vQ-9jdkQ@mail.gmail.com>
	<574cb584-5e99-4714-b762-0d066d063b6b@fv14g2000vbb.googlegroups.com>
Message-ID: <CAE3HoVQJCBaatR8QH3rYz6YQNtp9H6mq+9ZA56t2YUi7JeMo-A@mail.gmail.com>

2011/8/23 LooL <almumontiel at gmail.com>

> Yes, I want to display data that is already collected.
> The UI does not need to be real-time. Could have a small delay.
> I would consider only modern browsers.
>

For gathering of already collected data and displaying to Web browsers
without real-time features like websockets you probably can use plenty of
solutions. What kind of API does collectd offer? Is it HTTP, a database or
something else?

Sounds like you can just use a shared data store integration in this case,
no real need for messaging.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110823/fab7b43e/attachment.htm>

From simon at rabbitmq.com  Tue Aug 23 10:11:53 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 23 Aug 2011 10:11:53 +0100
Subject: [rabbitmq-discuss] Management Plugin stops gathering stats ?
In-Reply-To: <CA77FCAF.E905%rparra@homeaway.com>
References: <CA77FCAF.E905%rparra@homeaway.com>
Message-ID: <4E536ED9.8030006@rabbitmq.com>

On 22/08/11 18:31, Rene Parra wrote:
> Hi everyone...

Hi Rene!

> My question is: Is there some upper threshold in the management plugin
> that I need to set to continue gathering statistics throughout my test ?
> This feels like a classic ?invisible threshold being hit somewhere? problem.

No, this should just work. The mgmt plugin should never stop gathering 
statistics. Weird.

 > Would the mgmt-plugin reporting a false stat of ?~0 TPS? result in
 > rabbit ***_not throttling_*** when it exceeds the high watermark for 
memory?

It shouldn't - mgmt is not involved with throttling, it's just reporting 
what Rabbit is doing. However, the fact that the memory alarm has not 
gone off at this point is also weird, and when two weird things happen 
at once we have to wonder if they're related. They both look related to 
gen_event too. Hmm.

Do you still have the logs from this run? Could you send them / upload 
them somewhere?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Tue Aug 23 10:21:28 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 23 Aug 2011 10:21:28 +0100
Subject: [rabbitmq-discuss] problem starting rabbitmq
In-Reply-To: <73d3f602-0635-4f5e-b1a4-b5d6235156b3@v7g2000vbk.googlegroups.com>
References: <73d3f602-0635-4f5e-b1a4-b5d6235156b3@v7g2000vbk.googlegroups.com>
Message-ID: <4E537118.2030908@rabbitmq.com>

On 22/08/11 22:12, interglossa wrote:
> I have downloaded rabbitmq--server-generic-unix-2.5.1.tar (generic
> linux tar) and am trying to run it on RHL 2.6.18-238.12.1.el5.  I have
> built erlang 5.8.4 (R14B03) and when I run the server I get the
> message
>
> Activating RabbitMQ plugins ...
> ERROR: generation of boot script file /export/xxx/
> rabbitmq_server-2.5.1/mnesia/rabbit at hostname-plugins-expand/
> rabbit.script failed:
> {'EXIT',{{badmatch,{erl_prim_loader,error}},
>           [{xref_utils,find_beam,1},
>            {xref_base,'-make_libs/5-fun-0-',2},
>            {lists,foldl,3},
>            {xref_base,make_libs,5},
>            {xref_base,do_set_up,1},
>            {xref_base,do_set_up,2},
>            {xref_base,q,3},
>            {xref,handle_call,3}]}}
>
> Does this look as though I am using the wrong version of erlang for
> this rabbitmq release?

No, 2.5.1 and R14B03 definitely work together.

We've seen a couple of reports of this error before. It's always 
associated with people building Erlang from source, and it very much 
looks like Erlang is failing to find bits of itself.

If I were you I'd get our Rabbit RPM and the Erlang RPM from Peter's 
repo, as documented at http://www.rabbitmq.com/server.html.

If you don't want to do that then I'd try rebuilding Erlang again, and 
look for strange warnings.

Cheers, Simon
-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Tue Aug 23 10:29:33 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 23 Aug 2011 10:29:33 +0100
Subject: [rabbitmq-discuss] problem starting rabbitmq
In-Reply-To: <4E537118.2030908@rabbitmq.com>
References: <73d3f602-0635-4f5e-b1a4-b5d6235156b3@v7g2000vbk.googlegroups.com>
	<4E537118.2030908@rabbitmq.com>
Message-ID: <4E5372FD.1070006@rabbitmq.com>

Hi,

Op 23/08/11 10:21, het Simon MacMullen geskryf:

> We've seen a couple of reports of this error before. It's always
> associated with people building Erlang from source, and it very much
> looks like Erlang is failing to find bits of itself.

Indeed. This error can come about when failing to "make install" after
building Erlang, so it's worth checking that step succeeded.


-Emile

From dmaher at milestonelab.com  Tue Aug 23 11:02:26 2011
From: dmaher at milestonelab.com (Daniel Maher)
Date: Tue, 23 Aug 2011 12:02:26 +0200
Subject: [rabbitmq-discuss] rabbitmq plugin for collectd
Message-ID: <4E537AB2.2090008@milestonelab.com>

Hello all,

Just in case anybody is interested, I wrote a plugin for Collectd that 
will collect some useful statistics from and about RabbitMQ.

https://github.com/phrawzty/rabbitmq-collectd-plugin

Have a good day.

-- 
Daniel Maher
? makin' plans now to live on Mars 'cuz I got Earth on lock. ?

From emile at rabbitmq.com  Tue Aug 23 11:17:25 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 23 Aug 2011 11:17:25 +0100
Subject: [rabbitmq-discuss] Consumer without a valid connection
In-Reply-To: <5F389C517756284F80239F55BCA5DDDD77CD@G9W0721.americas.hpqcorp.net>
References: <8097A4E725D78E41A8B862ACE60E963945EF8F7780@GVW1355EXB.americas.hpqcorp.net>
	<4E4E4585.2010309@rabbitmq.com>
	<5F389C517756284F80239F55BCA5DDDD77CD@G9W0721.americas.hpqcorp.net>
Message-ID: <4E537E35.3060905@rabbitmq.com>

Hi Andrea,

>>> For some reason, that we can't understand, we have got a queue
>>> with two
>>> consumers and one of this consumer is using a channel of a
>>> connection that is not present in the list of connections.
>> 
>> That should not be possible. If you check the connection pid of
>> each channel with "rabbitmqctl list_channels connection" each of
>> them should appear in the output of "rabbitmqctl list_connections
>> pid". Is that not the case?
>> 
> Sorry for my late reply. I verified and you are right it's not
> correct what I wrote. The situation is that I have a queue with two
> consumer on two different connections. It seems that one of this
> consumer is a "zombie", to fix the situation I closed all connection

I assume you mean the client thinks it is connected, but the server
thinks the client is not connected.

> and restarted my application After that there is just one consumer
> listening on the queue. Is it possible that rabbitmq DB become
> inconsistency/corrupted (for some reason) and that creates this

Your description does not suggest DB corruption.

> situation? In this case to clean up the db I can delete the mnesia
> folder and restart the server? Is it possible to have more details in
> the rabbitmq log files?

Restarting the broker will terminate connections, so that will probably
work. If the client and server disagree about the connection status then
a broker logfile won't be much help.

Your description is more consistent with an unreliable network, or a
faulty firewall setup. I would look there first.

Does AMQP heartbeats solve the problem?
Does a comparison of netstat output on the clients and the broker yield
any inconsistencies?
Did any of the other means of obtaining diagnostic information
previously mentioned produce useful information?



-Emile


From majek04 at gmail.com  Tue Aug 23 11:19:01 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Tue, 23 Aug 2011 11:19:01 +0100
Subject: [rabbitmq-discuss] Spec file for txAMQP?
In-Reply-To: <CAHZAEpejhRQ_NGALZTKAh68STxUT+7h39c83att-K00WY9rwtQ@mail.gmail.com>
References: <CAD-DQxRMTP+S1s7TFP3-2r8LoA1rmG2di9TeoxLqKHOOPxrhpg@mail.gmail.com>
	<CAHZAEpejhRQ_NGALZTKAh68STxUT+7h39c83att-K00WY9rwtQ@mail.gmail.com>
Message-ID: <CABzX+qyL2BvRqtmFukz3Azr7Ldf2he6Fn4dDZsqpVtigw1kq5w@mail.gmail.com>

On Mon, Aug 22, 2011 at 20:13, Jason J. W. Williams
<jasonjwwilliams at gmail.com> wrote:
> We've always used the attached spec file with txAMQP. It would be nice
> to get a 0-9-1 spec file working with it.

I've just tried txamqp with 0-9-1 spec, but I didn't have much luck.
Even standard
0-9-1 spec distributed with txqmp doesn't seem to work.

In order to get to authentification you need txamqp code from trunk
and this patch applied: https://bugs.launchpad.net/txamqp/+bug/741147/comments/7

But even then it doesn't go beyond:
    yield conn.authenticate(username, password)

So, I guess txamqp users are tied to 0-8 spec for now.

If someone wants to work on 0-9-1+rabbit extensions spec, this
xml files may be a starting point:
   http://www.rabbitmq.com/resources/specs/amqp0-9-1.xml
   http://www.rabbitmq.com/amqp-0-9-1-reference.html

Cheers,
    Marek

>
> On Fri, Aug 19, 2011 at 11:50 AM, Jeffrey Ollie <jeff at ocjtech.us> wrote:
>> Is there a recommended XML spec file to use with txAMQP and RabbitMQ?
>> The spec files that I have found so far either don't work with
>> RabbitMQ or don't contain definitions for some of the newer
>> functionality.
>>
>> --
>> Jeff Ollie
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From matthew at rabbitmq.com  Tue Aug 23 12:16:39 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 23 Aug 2011 12:16:39 +0100
Subject: [rabbitmq-discuss] Unable to start RabbitMQ server after crash
 because of vm_memory_high_watermark alarm.
In-Reply-To: <a5bd0a65-42f3-4112-b9d8-6f54d1a9e61b@v9g2000pri.googlegroups.com>
References: <a5bd0a65-42f3-4112-b9d8-6f54d1a9e61b@v9g2000pri.googlegroups.com>
Message-ID: <20110823111639.GD23211@rabbitmq.com>

Hi Chris,

On Sun, Aug 21, 2011 at 05:08:39PM -0700, ChrisStoyles wrote:
> I need some advice on moving /var/lib/rabbitmq to a new server with
> more RAM. What has happened is that on our 8GB RAM server we've had a
> surge in activity and one of our queues has grown much faster than it
> can be consumed by our "workers".
> 
> This has resulted in RabbitMQ crashing, with an erl_crash.dump file
> appearing.
> 
> At present when I attempt to start the server up again, it tries to
> roll the persister.LOG file and recover what was in the queue at the
> time of the crash. However even with rabbitmq.config set up as below,
> the vm_memory_high_watermark alarm is triggered and erl_crash.dump is
> created all over again.

Erm, persister.LOG suggests a RabbitMQ pre 2.0.0. Is that true? We would
very strongly recommend you upgrade asap.

> [
>   {rabbit, [{vm_memory_high_watermark, 0.9}]}
> ].

Yeah, that's not going to make any difference to pre 2.0 Rabbits. Pre
2.0, all msgs are always held in RAM.

> I've got another server with 24GB of RAM, so I set it's HOSTNAME to
> the same as the 8GB server and installed the same version of RabbitMQ.
> I then copied over the contents of /var/lib/rabbitmq and attempted to
> start RabbitMQ. I no longer hit the vm_memory_high_watermark however
> Erlang seems to close/shutdown while attempting to recover
> persister.LOG.

That's odd - if the hostname and the nodename of Rabbit is the same, it
should start up I think. Is there anything in the logs?

Matthew

From interglossa at gmail.com  Tue Aug 23 16:07:10 2011
From: interglossa at gmail.com (interglossa)
Date: Tue, 23 Aug 2011 08:07:10 -0700 (PDT)
Subject: [rabbitmq-discuss] problem starting rabbitmq
In-Reply-To: <4E5372FD.1070006@rabbitmq.com>
References: <73d3f602-0635-4f5e-b1a4-b5d6235156b3@v7g2000vbk.googlegroups.com>
	<4E537118.2030908@rabbitmq.com> <4E5372FD.1070006@rabbitmq.com>
Message-ID: <fc11dbbf-95d0-40ea-a263-ccc457b41272@g31g2000yqh.googlegroups.com>

This was exactly the problem and now it is working.  Thank you.

On Aug 23, 5:29?am, Emile Joubert <em... at rabbitmq.com> wrote:
> Hi,
>
> Op 23/08/11 10:21, het Simon MacMullen geskryf:
>
> > We've seen a couple of reports of this error before. It's always
> > associated with people building Erlang from source, and it very much
> > looks like Erlang is failing to find bits of itself.
>
> Indeed. This error can come about when failing to "make install" after
> building Erlang, so it's worth checking that step succeeded.
>
> -Emile
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From rparra at homeaway.com  Tue Aug 23 18:43:20 2011
From: rparra at homeaway.com (Rene Parra)
Date: Tue, 23 Aug 2011 12:43:20 -0500
Subject: [rabbitmq-discuss] Management Plugin stops gathering stats ?
In-Reply-To: <4E536ED9.8030006@rabbitmq.com>
Message-ID: <CA7950E8.E982%rparra@homeaway.com>

Thanks Simon, I've sent you the logs directly.

I've replicated the problem in our stage environment which has the same
setup.

FYI... we are troubleshooting by removing variables until we can get the
desired behavior.

Any ideas/thoughts would be greatly appreciated.

--ren?

On 8/23/11 4:11 AM, "Simon MacMullen" <simon at rabbitmq.com> wrote:

> On 22/08/11 18:31, Rene Parra wrote:
>> Hi everyone...
> 
> Hi Rene!
> 
>> My question is: Is there some upper threshold in the management plugin
>> that I need to set to continue gathering statistics throughout my test ?
>> This feels like a classic ?invisible threshold being hit somewhere? problem.
> 
> No, this should just work. The mgmt plugin should never stop gathering
> statistics. Weird.
> 
>> Would the mgmt-plugin reporting a false stat of ?~0 TPS? result in
>> rabbit ***_not throttling_*** when it exceeds the high watermark for
> memory?
> 
> It shouldn't - mgmt is not involved with throttling, it's just reporting
> what Rabbit is doing. However, the fact that the memory alarm has not
> gone off at this point is also weird, and when two weird things happen
> at once we have to wonder if they're related. They both look related to
> gen_event too. Hmm.
> 
> Do you still have the logs from this run? Could you send them / upload
> them somewhere?
> 
> Cheers, Simon


From aaron at agoragames.com  Tue Aug 23 20:54:07 2011
From: aaron at agoragames.com (Aaron Westendorf)
Date: Tue, 23 Aug 2011 15:54:07 -0400
Subject: [rabbitmq-discuss] Management Plugin stops gathering stats ?
In-Reply-To: <CA77FCAF.E905%rparra@homeaway.com>
References: <CA77FCAF.E905%rparra@homeaway.com>
Message-ID: <CAHiEoM5FNKFBGTPiL1MU-B0qQdwwnqFJ7j3KMYe0y1E9H-aOUg@mail.gmail.com>

When we load tested on 2.4 we found that the collector plugin grew in
memory until rabbit was OOMkilled. Even though it was on a separate
cluster node, the problem was repeatable and so we dropped it use.

Are you seeing this on the reporting nodes, or collector node?

-Aaron


On Mon, Aug 22, 2011 at 1:31 PM, Rene Parra <rparra at homeaway.com> wrote:
> Hi everyone...
>
> I?ve been performing a load/soak test on RabbitMQ before we promote our
> configuration into production, and have run into a little bit of a snag.
>
> The Management Plugin seems to gather statistics on the test just fine, but
> after about ~6min to about ~12min into the soak test, the management plugin
> seems to ?STOP collecting stats on my queues!! ?Thereafter, the throughput
> seemingly (but falsely) goes to zero. The test is actually proceeding just
> fine and queues are happily receiving, delivering, and receiving acks for
> their messages.
>
> Restarting the disk node seems to clear the management plugin to resume
> collecting statistics.
>
> My question is: Is there some upper threshold in the management plugin that
> I need to set to continue gathering statistics throughout my test ? ?This
> feels like a classic ?invisible threshold being hit somewhere? problem.
>
> Here?s a snapshot of the management UI screen working as expected:
>
> http://i.imgur.com/8eXNM.png
>
> Here?s a ScreenCast of the management UI working and then ?FAILS?:
>
> http://goo.gl/jrvAP
>
> (please fast forward to these time points in the screencast)
>
> @2m 16s: ?The system runs normally and then I demo the queues stats
> collection working perfectly.
> @2m 56s: ?Connection View shows normal operating behavior.
> @3m 34s: ?The ?weird behavior? begins... it seems that TPS drops off to 30
> TPS then 0 TPS!!
> @4m 22s: ?Connection View showing throughput has ?stopped?.
>
> External metric gathering confirms the test still ?runs? and messages are
> being delivered successfully.
>
> Has anyone else experienced this weirdness with the mgmt plugin?
>
> Any help would be greatly appreciated.
> -rparra
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From rparra at homeaway.com  Tue Aug 23 20:59:20 2011
From: rparra at homeaway.com (Rene Parra)
Date: Tue, 23 Aug 2011 14:59:20 -0500
Subject: [rabbitmq-discuss] Management Plugin stops gathering stats ?
In-Reply-To: <CAHiEoM5FNKFBGTPiL1MU-B0qQdwwnqFJ7j3KMYe0y1E9H-aOUg@mail.gmail.com>
Message-ID: <CA7970C8.E9B4%rparra@homeaway.com>

To remove variables, we have dropped off the ram nodes, and have reduced the
cluster to only one disk node.

So, presumably, we are seeing this on the collector node.

(The jing video shows the stats database is deployed to: diskrabbit01-test |
the collector node [lower left hand side of the video])

I am making one more tweak in my test and after tomorrow, if that doesn't
work or no one has any other ideas, we will upgrade to 2.5.1.

--rparra

On 8/23/11 2:54 PM, "Aaron Westendorf" <aaron at agoragames.com> wrote:

> When we load tested on 2.4 we found that the collector plugin grew in
> memory until rabbit was OOMkilled. Even though it was on a separate
> cluster node, the problem was repeatable and so we dropped it use.
> 
> Are you seeing this on the reporting nodes, or collector node?
> 
> -Aaron
> 
> 
> On Mon, Aug 22, 2011 at 1:31 PM, Rene Parra <rparra at homeaway.com> wrote:
>> Hi everyone...
>> 
>> I?ve been performing a load/soak test on RabbitMQ before we promote our
>> configuration into production, and have run into a little bit of a snag.
>> 
>> The Management Plugin seems to gather statistics on the test just fine, but
>> after about ~6min to about ~12min into the soak test, the management plugin
>> seems to ?STOP collecting stats on my queues!! ?Thereafter, the throughput
>> seemingly (but falsely) goes to zero. The test is actually proceeding just
>> fine and queues are happily receiving, delivering, and receiving acks for
>> their messages.
>> 
>> Restarting the disk node seems to clear the management plugin to resume
>> collecting statistics.
>> 
>> My question is: Is there some upper threshold in the management plugin that
>> I need to set to continue gathering statistics throughout my test ? ?This
>> feels like a classic ?invisible threshold being hit somewhere? problem.
>> 
>> Here?s a snapshot of the management UI screen working as expected:
>> 
>> http://i.imgur.com/8eXNM.png
>> 
>> Here?s a ScreenCast of the management UI working and then ?FAILS?:
>> 
>> http://goo.gl/jrvAP
>> 
>> (please fast forward to these time points in the screencast)
>> 
>> @2m 16s: ?The system runs normally and then I demo the queues stats
>> collection working perfectly.
>> @2m 56s: ?Connection View shows normal operating behavior.
>> @3m 34s: ?The ?weird behavior? begins... it seems that TPS drops off to 30
>> TPS then 0 TPS!!
>> @4m 22s: ?Connection View showing throughput has ?stopped?.
>> 
>> External metric gathering confirms the test still ?runs? and messages are
>> being delivered successfully.
>> 
>> Has anyone else experienced this weirdness with the mgmt plugin?
>> 
>> Any help would be greatly appreciated.
>> -rparra
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> 
> 
> 


From matthias at rabbitmq.com  Tue Aug 23 21:35:41 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 23 Aug 2011 21:35:41 +0100
Subject: [rabbitmq-discuss] Management Plugin stops gathering stats ?
In-Reply-To: <CA7970C8.E9B4%rparra@homeaway.com>
References: <CA7970C8.E9B4%rparra@homeaway.com>
Message-ID: <4E540F1D.2080001@rabbitmq.com>

Rene,

On 23/08/11 20:59, Rene Parra wrote:
>>> Here?s a ScreenCast of the management UI working and then ?FAILS?:
>>>
>>> http://goo.gl/jrvAP
>>>
>>> (please fast forward to these time points in the screencast)
>>>
>>> @2m 16s:  The system runs normally and then I demo the queues stats
>>> collection working perfectly.

Er, no, something is wrong here. We see Delivers and Acks, but no queued 
messages and no publishes. So where are the delivered messages coming 
from? ...

>>> @2m 56s:  Connection View shows normal operating behavior.

This shows a 25kb/s inbound rate on one of the connections. Presumably 
these are the publishes, but for some reason they don't show up in the 
stats.

I definitely recommend upgrading to 2.5.1. If the problem still occurs 
there it will be easier for us to track down.


Regards,

Matthias.

From rparra at homeaway.com  Tue Aug 23 22:38:38 2011
From: rparra at homeaway.com (Rene Parra)
Date: Tue, 23 Aug 2011 16:38:38 -0500
Subject: [rabbitmq-discuss] Management Plugin stops gathering stats ?
In-Reply-To: <4E540F1D.2080001@rabbitmq.com>
Message-ID: <CA79880E.E9C0%rparra@homeaway.com>

Matthias,

I had been wondering why I don't see a "publish rate" on *anything*.

I don't see it on exchanges or anywhere... but yet I get messages
successfully delivered.

I agree, at first I thought that was weird, but later dismissed this as
"normal operating behavior". I guess I was wrong.

I will continue my trouble-shooting journey and will report back.

FWIW, I am using Spring Integration, and Spring Rabbit.  Since the AMQP
Integration endpoints are not out of "Spring sandbox" yet, I have my own
ServiceActivator endpoint that talks to RabbitTemplate by doing a
convertAndSend to the configured topic exchange. Similarly I register my own
SimpleMessageListenerContainer bean with my listener.

Stay tuned for updates...

-ren?


On 8/23/11 3:35 PM, "Matthias Radestock" <matthias at rabbitmq.com> wrote:

> Rene,
> 
> On 23/08/11 20:59, Rene Parra wrote:
>>>> Here?s a ScreenCast of the management UI working and then ?FAILS?:
>>>> 
>>>> http://goo.gl/jrvAP
>>>> 
>>>> (please fast forward to these time points in the screencast)
>>>> 
>>>> @2m 16s:  The system runs normally and then I demo the queues stats
>>>> collection working perfectly.
> 
> Er, no, something is wrong here. We see Delivers and Acks, but no queued
> messages and no publishes. So where are the delivered messages coming
> from? ...
> 
>>>> @2m 56s:  Connection View shows normal operating behavior.
> 
> This shows a 25kb/s inbound rate on one of the connections. Presumably
> these are the publishes, but for some reason they don't show up in the
> stats.
> 
> I definitely recommend upgrading to 2.5.1. If the problem still occurs
> there it will be easier for us to track down.
> 
> 
> Regards,
> 
> Matthias.


From cstoyles at gmail.com  Tue Aug 23 22:51:47 2011
From: cstoyles at gmail.com (ChrisStoyles)
Date: Tue, 23 Aug 2011 14:51:47 -0700 (PDT)
Subject: [rabbitmq-discuss] Unable to start RabbitMQ server after crash
 because of vm_memory_high_watermark alarm.
In-Reply-To: <20110823111639.GD23211@rabbitmq.com>
References: <a5bd0a65-42f3-4112-b9d8-6f54d1a9e61b@v9g2000pri.googlegroups.com>
	<20110823111639.GD23211@rabbitmq.com>
Message-ID: <4557ecc6-c111-459d-aa47-3c10b20b0524@y39g2000prd.googlegroups.com>

Hi Matthew,

Yes we were running 1.7.2 :) we are planning to upgrade just as soon
as things settle down after this event.

Thanks for posting, I actually didn't get an email alert from Google
Groups that a new message had been posted hence the delay in getting
back to you.

It turns out our problem was to do with a bug in Erlang which was
noted and patched here:
http://erlang.2086793.n4.nabble.com/Patch-for-18-exabyte-memory-allocation-failure-td3342133.html

We downloaded the latest stable release of Erlang and compiled from
source. After this RabbitMQ came up without any problems whatsoever,
turns out this was an Erlang bug not RabbitMQ (because Ubuntu 10.04LTS
packages a very old version of both RabbitMQ and Erlang).

Thanks for your help.

Chris.

On Aug 23, 7:16?pm, Matthew Sackman <matt... at rabbitmq.com> wrote:
> Hi Chris,
>
> On Sun, Aug 21, 2011 at 05:08:39PM -0700, ChrisStoyles wrote:
> > I need some advice on moving /var/lib/rabbitmq to a new server with
> > more RAM. What has happened is that on our 8GB RAM server we've had a
> > surge in activity and one of our queues has grown much faster than it
> > can be consumed by our "workers".
>
> > This has resulted in RabbitMQ crashing, with an erl_crash.dump file
> > appearing.
>
> > At present when I attempt to start the server up again, it tries to
> > roll the persister.LOG file and recover what was in the queue at the
> > time of the crash. However even with rabbitmq.config set up as below,
> > the vm_memory_high_watermark alarm is triggered and erl_crash.dump is
> > created all over again.
>
> Erm, persister.LOG suggests a RabbitMQ pre 2.0.0. Is that true? We would
> very strongly recommend you upgrade asap.
>
> > [
> > ? {rabbit, [{vm_memory_high_watermark, 0.9}]}
> > ].
>
> Yeah, that's not going to make any difference to pre 2.0 Rabbits. Pre
> 2.0, all msgs are always held in RAM.
>
> > I've got another server with 24GB of RAM, so I set it's HOSTNAME to
> > the same as the 8GB server and installed the same version of RabbitMQ.
> > I then copied over the contents of /var/lib/rabbitmq and attempted to
> > start RabbitMQ. I no longer hit the vm_memory_high_watermark however
> > Erlang seems to close/shutdown while attempting to recover
> > persister.LOG.
>
> That's odd - if the hostname and the nodename of Rabbit is the same, it
> should start up I think. Is there anything in the logs?
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From doug at gorley.ca  Wed Aug 24 02:49:51 2011
From: doug at gorley.ca (Doug Gorley)
Date: Tue, 23 Aug 2011 18:49:51 -0700 (PDT)
Subject: [rabbitmq-discuss] Problem extending code from tutorial #6
Message-ID: <3519.173.180.139.38.1314150614.squirrel@mail.wedohosting.com>

I'm hoping someone can help he with my RabbitMQ problem; I've got some
code based on the tutorial #6 code, and it's not doing what I'm expecting.
I tried to create a shell where I can send strings to the server and
receive the MD5 digest, but I only ever seem to get the first reply.

Here's the source:

##########################################################################
# server.py

import pika
import hashlib

connection = pika.BlockingConnection(
    pika.ConnectionParameters(host='localhost'))

channel = connection.channel()
channel.queue_declare(queue='my_request')

def on_request(ch, method, props, body):

    response = hashlib.md5(body).hexdigest()

    print("Received '%r', sending '%r'" % (body, response))

    ch.basic_publish(exchange='',
                     routing_key=props.reply_to,
                     properties=pika.BasicProperties(correlation_id = \
                                                     props.correlation_id),
                     body=response)

    ch.basic_ack(delivery_tag = method.delivery_tag)

channel.basic_qos(prefetch_count=1)
channel.basic_consume(on_request, queue='my_request')

print " [x] Awaiting requests"
channel.start_consuming()
##########################################################################

##########################################################################
# client.py

import pika
import uuid

class RabbitClient(object):

    def __init__(self):
        self.connection = pika.BlockingConnection(
            pika.ConnectionParameters(host='localhost'))

        self.channel = self.connection.channel()

        result = self.channel.queue_declare(exclusive=True)
        self.callback_queue = result.method.queue

        self.channel.basic_consume(self.on_response, no_ack=True,
                                   queue=self.callback_queue)

    def on_response(self, ch, method, props, body):
        print(" [.] Received correlation ID %r" % (props.correlation_id,))
        if self.corr_id == props.correlation_id:
            self.response = body
            self.channel.stop_consuming()
        else:
            print(" [~] Correlation IDs do not match")

    def call(self, n):
        self.corr_id = str(uuid.uuid4())
        self.channel.basic_publish(exchange='',
                                   routing_key='my_request',
                                   properties=pika.BasicProperties(
                                         reply_to=self.callback_queue,
                                         correlation_id=self.corr_id,
                                         ),
                                   body=n)
        self.channel.start_consuming()
        return self.response

auth = RabbitClient()

while True:
    send = raw_input('> ')
    if send == 'quit': break
    print(" [x] sending '%s'" % (send))
    response = auth.call(send)
    print(" [^] sent with correlation ID %s" % (auth.corr_id,))
    print(" [.] Got %r" % (response,))
##########################################################################

Here's the output from the server:

##########################################################################
 [x] Awaiting requests
Received ''Hello World'', sending ''b10a8db164e0754105b7a99be72e3fe5''
Received ''Hello Rabbit'', sending ''5bec01f45b43f6202e84242fcb71b04f''
##########################################################################

And here's the output from the server:
##########################################################################
> Hello World
 [x] sending 'Hello World'
 [.] Received correlation ID '1805f131-1fbc-40a3-86fb-2a113b5f9b9a'
 [^] sent with correlation ID 1805f131-1fbc-40a3-86fb-2a113b5f9b9a
 [.] Got 'b10a8db164e0754105b7a99be72e3fe5'
> Hello Rabbit
 [x] sending 'Hello Rabbit'
 [^] sent with correlation ID fdb089ff-44ea-4b81-885b-be7e0178d5a1
 [.] Got 'b10a8db164e0754105b7a99be72e3fe5'
> quit
##########################################################################

So, my question is, what am I doing wrong that I didn't get the '5bec'
response to the second message?

Thanks for your help,
-- 
Doug Gorley | doug at gorley.ca




From majek04 at gmail.com  Wed Aug 24 09:32:46 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 24 Aug 2011 09:32:46 +0100
Subject: [rabbitmq-discuss] Problem extending code from tutorial #6
In-Reply-To: <3519.173.180.139.38.1314150614.squirrel@mail.wedohosting.com>
References: <3519.173.180.139.38.1314150614.squirrel@mail.wedohosting.com>
Message-ID: <CABzX+qzK7hvGrvo8ydv925PZD3i2GKxPxgCYiLwEKFSGQAuZQQ@mail.gmail.com>

Doug,

Thanks for the report. It does look like a problem caused
by a bug in Pika or my misunderstanding how start/stop_consuming
work.

I'll try to come up with a workaround.

Cheers,
   Marek


On Wed, Aug 24, 2011 at 02:49, Doug Gorley <doug at gorley.ca> wrote:
> I'm hoping someone can help he with my RabbitMQ problem; I've got some
> code based on the tutorial #6 code, and it's not doing what I'm expecting.
> I tried to create a shell where I can send strings to the server and
> receive the MD5 digest, but I only ever seem to get the first reply.
>
> Here's the source:
>
> ##########################################################################
> # server.py
>
> import pika
> import hashlib
>
> connection = pika.BlockingConnection(
> ? ?pika.ConnectionParameters(host='localhost'))
>
> channel = connection.channel()
> channel.queue_declare(queue='my_request')
>
> def on_request(ch, method, props, body):
>
> ? ?response = hashlib.md5(body).hexdigest()
>
> ? ?print("Received '%r', sending '%r'" % (body, response))
>
> ? ?ch.basic_publish(exchange='',
> ? ? ? ? ? ? ? ? ? ? routing_key=props.reply_to,
> ? ? ? ? ? ? ? ? ? ? properties=pika.BasicProperties(correlation_id = \
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? props.correlation_id),
> ? ? ? ? ? ? ? ? ? ? body=response)
>
> ? ?ch.basic_ack(delivery_tag = method.delivery_tag)
>
> channel.basic_qos(prefetch_count=1)
> channel.basic_consume(on_request, queue='my_request')
>
> print " [x] Awaiting requests"
> channel.start_consuming()
> ##########################################################################
>
> ##########################################################################
> # client.py
>
> import pika
> import uuid
>
> class RabbitClient(object):
>
> ? ?def __init__(self):
> ? ? ? ?self.connection = pika.BlockingConnection(
> ? ? ? ? ? ?pika.ConnectionParameters(host='localhost'))
>
> ? ? ? ?self.channel = self.connection.channel()
>
> ? ? ? ?result = self.channel.queue_declare(exclusive=True)
> ? ? ? ?self.callback_queue = result.method.queue
>
> ? ? ? ?self.channel.basic_consume(self.on_response, no_ack=True,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? queue=self.callback_queue)
>
> ? ?def on_response(self, ch, method, props, body):
> ? ? ? ?print(" [.] Received correlation ID %r" % (props.correlation_id,))
> ? ? ? ?if self.corr_id == props.correlation_id:
> ? ? ? ? ? ?self.response = body
> ? ? ? ? ? ?self.channel.stop_consuming()
> ? ? ? ?else:
> ? ? ? ? ? ?print(" [~] Correlation IDs do not match")
>
> ? ?def call(self, n):
> ? ? ? ?self.corr_id = str(uuid.uuid4())
> ? ? ? ?self.channel.basic_publish(exchange='',
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? routing_key='my_request',
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? properties=pika.BasicProperties(
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? reply_to=self.callback_queue,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? correlation_id=self.corr_id,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ),
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? body=n)
> ? ? ? ?self.channel.start_consuming()
> ? ? ? ?return self.response
>
> auth = RabbitClient()
>
> while True:
> ? ?send = raw_input('> ')
> ? ?if send == 'quit': break
> ? ?print(" [x] sending '%s'" % (send))
> ? ?response = auth.call(send)
> ? ?print(" [^] sent with correlation ID %s" % (auth.corr_id,))
> ? ?print(" [.] Got %r" % (response,))
> ##########################################################################
>
> Here's the output from the server:
>
> ##########################################################################
> ?[x] Awaiting requests
> Received ''Hello World'', sending ''b10a8db164e0754105b7a99be72e3fe5''
> Received ''Hello Rabbit'', sending ''5bec01f45b43f6202e84242fcb71b04f''
> ##########################################################################
>
> And here's the output from the server:
> ##########################################################################
>> Hello World
> ?[x] sending 'Hello World'
> ?[.] Received correlation ID '1805f131-1fbc-40a3-86fb-2a113b5f9b9a'
> ?[^] sent with correlation ID 1805f131-1fbc-40a3-86fb-2a113b5f9b9a
> ?[.] Got 'b10a8db164e0754105b7a99be72e3fe5'
>> Hello Rabbit
> ?[x] sending 'Hello Rabbit'
> ?[^] sent with correlation ID fdb089ff-44ea-4b81-885b-be7e0178d5a1
> ?[.] Got 'b10a8db164e0754105b7a99be72e3fe5'
>> quit
> ##########################################################################
>
> So, my question is, what am I doing wrong that I didn't get the '5bec'
> response to the second message?
>
> Thanks for your help,
> --
> Doug Gorley | doug at gorley.ca
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From majek04 at gmail.com  Wed Aug 24 11:52:35 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 24 Aug 2011 11:52:35 +0100
Subject: [rabbitmq-discuss] Problem extending code from tutorial #6
In-Reply-To: <CABzX+qzK7hvGrvo8ydv925PZD3i2GKxPxgCYiLwEKFSGQAuZQQ@mail.gmail.com>
References: <3519.173.180.139.38.1314150614.squirrel@mail.wedohosting.com>
	<CABzX+qzK7hvGrvo8ydv925PZD3i2GKxPxgCYiLwEKFSGQAuZQQ@mail.gmail.com>
Message-ID: <CABzX+qwBFDNQ7DVErMhzL+1M9LgZrVzfmTFTW1QAUi_t0oZr6g@mail.gmail.com>

On Wed, Aug 24, 2011 at 09:32, Marek Majkowski <majek04 at gmail.com> wrote:
> Thanks for the report. It does look like a problem caused
> by a bug in Pika or my misunderstanding how start/stop_consuming
> work.

Yup. I did misuse "stop_consuming". Apparently, it calls
basic.cancel, which was completely not inteded:
https://github.com/pika/pika/blob/v0.9.5/pika/adapters/blocking_connection.py#L287

The fix is here:
https://github.com/rabbitmq/rabbitmq-tutorials/commit/c1b178d9deec664cdf12770c24319c7d12d67efd

Thanks again for the report!

Cheers,
  Marek

> On Wed, Aug 24, 2011 at 02:49, Doug Gorley <doug at gorley.ca> wrote:
>> I'm hoping someone can help he with my RabbitMQ problem; I've got some
>> code based on the tutorial #6 code, and it's not doing what I'm expecting.
>> I tried to create a shell where I can send strings to the server and
>> receive the MD5 digest, but I only ever seem to get the first reply.
>>
>> Here's the source:
>>
>> ##########################################################################
>> # server.py
>>
>> import pika
>> import hashlib
>>
>> connection = pika.BlockingConnection(
>> ? ?pika.ConnectionParameters(host='localhost'))
>>
>> channel = connection.channel()
>> channel.queue_declare(queue='my_request')
>>
>> def on_request(ch, method, props, body):
>>
>> ? ?response = hashlib.md5(body).hexdigest()
>>
>> ? ?print("Received '%r', sending '%r'" % (body, response))
>>
>> ? ?ch.basic_publish(exchange='',
>> ? ? ? ? ? ? ? ? ? ? routing_key=props.reply_to,
>> ? ? ? ? ? ? ? ? ? ? properties=pika.BasicProperties(correlation_id = \
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? props.correlation_id),
>> ? ? ? ? ? ? ? ? ? ? body=response)
>>
>> ? ?ch.basic_ack(delivery_tag = method.delivery_tag)
>>
>> channel.basic_qos(prefetch_count=1)
>> channel.basic_consume(on_request, queue='my_request')
>>
>> print " [x] Awaiting requests"
>> channel.start_consuming()
>> ##########################################################################
>>
>> ##########################################################################
>> # client.py
>>
>> import pika
>> import uuid
>>
>> class RabbitClient(object):
>>
>> ? ?def __init__(self):
>> ? ? ? ?self.connection = pika.BlockingConnection(
>> ? ? ? ? ? ?pika.ConnectionParameters(host='localhost'))
>>
>> ? ? ? ?self.channel = self.connection.channel()
>>
>> ? ? ? ?result = self.channel.queue_declare(exclusive=True)
>> ? ? ? ?self.callback_queue = result.method.queue
>>
>> ? ? ? ?self.channel.basic_consume(self.on_response, no_ack=True,
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? queue=self.callback_queue)
>>
>> ? ?def on_response(self, ch, method, props, body):
>> ? ? ? ?print(" [.] Received correlation ID %r" % (props.correlation_id,))
>> ? ? ? ?if self.corr_id == props.correlation_id:
>> ? ? ? ? ? ?self.response = body
>> ? ? ? ? ? ?self.channel.stop_consuming()
>> ? ? ? ?else:
>> ? ? ? ? ? ?print(" [~] Correlation IDs do not match")
>>
>> ? ?def call(self, n):
>> ? ? ? ?self.corr_id = str(uuid.uuid4())
>> ? ? ? ?self.channel.basic_publish(exchange='',
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? routing_key='my_request',
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? properties=pika.BasicProperties(
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? reply_to=self.callback_queue,
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? correlation_id=self.corr_id,
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ),
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? body=n)
>> ? ? ? ?self.channel.start_consuming()
>> ? ? ? ?return self.response
>>
>> auth = RabbitClient()
>>
>> while True:
>> ? ?send = raw_input('> ')
>> ? ?if send == 'quit': break
>> ? ?print(" [x] sending '%s'" % (send))
>> ? ?response = auth.call(send)
>> ? ?print(" [^] sent with correlation ID %s" % (auth.corr_id,))
>> ? ?print(" [.] Got %r" % (response,))
>> ##########################################################################
>>
>> Here's the output from the server:
>>
>> ##########################################################################
>> ?[x] Awaiting requests
>> Received ''Hello World'', sending ''b10a8db164e0754105b7a99be72e3fe5''
>> Received ''Hello Rabbit'', sending ''5bec01f45b43f6202e84242fcb71b04f''
>> ##########################################################################
>>
>> And here's the output from the server:
>> ##########################################################################
>>> Hello World
>> ?[x] sending 'Hello World'
>> ?[.] Received correlation ID '1805f131-1fbc-40a3-86fb-2a113b5f9b9a'
>> ?[^] sent with correlation ID 1805f131-1fbc-40a3-86fb-2a113b5f9b9a
>> ?[.] Got 'b10a8db164e0754105b7a99be72e3fe5'
>>> Hello Rabbit
>> ?[x] sending 'Hello Rabbit'
>> ?[^] sent with correlation ID fdb089ff-44ea-4b81-885b-be7e0178d5a1
>> ?[.] Got 'b10a8db164e0754105b7a99be72e3fe5'
>>> quit
>> ##########################################################################
>>
>> So, my question is, what am I doing wrong that I didn't get the '5bec'
>> response to the second message?
>>
>> Thanks for your help,
>> --
>> Doug Gorley | doug at gorley.ca
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>

From jim at rabbitmq.com  Wed Aug 24 13:30:07 2011
From: jim at rabbitmq.com (Jim Apperly)
Date: Wed, 24 Aug 2011 13:30:07 +0100
Subject: [rabbitmq-discuss] rabbitmq plugin for collectd
In-Reply-To: <4E537AB2.2090008@milestonelab.com>
References: <4E537AB2.2090008@milestonelab.com>
Message-ID: <CAMdQUi8XJY+CDNxFtkru0id_k_PTSRqGRUOCfFb8xnZnknMqtg@mail.gmail.com>

Daniel,

Thank you. I've added a link on our developer tools
page<http://www.rabbitmq.com/devtools.html#miscellaneous>
.

Have you thought about asking the collectd folks to list it on their plugins
page <http://collectd.org/wiki/index.php/Table_of_Plugins>?

Jim

On 23 August 2011 11:02, Daniel Maher <dmaher at milestonelab.com> wrote:

> Hello all,
>
> Just in case anybody is interested, I wrote a plugin for Collectd that will
> collect some useful statistics from and about RabbitMQ.
>
> https://github.com/phrawzty/**rabbitmq-collectd-plugin<https://github.com/phrawzty/rabbitmq-collectd-plugin>
>
> Have a good day.
>
> --
> Daniel Maher
> ? makin' plans now to live on Mars 'cuz I got Earth on lock. ?
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110824/1a59b25a/attachment.htm>

From doug at gorley.ca  Wed Aug 24 14:32:17 2011
From: doug at gorley.ca (Doug Gorley)
Date: Wed, 24 Aug 2011 06:32:17 -0700 (PDT)
Subject: [rabbitmq-discuss] Problem extending code from tutorial #6
In-Reply-To: <CABzX+qwBFDNQ7DVErMhzL+1M9LgZrVzfmTFTW1QAUi_t0oZr6g@mail.gmail.com>
References: <3519.173.180.139.38.1314150614.squirrel@mail.wedohosting.com>
	<CABzX+qzK7hvGrvo8ydv925PZD3i2GKxPxgCYiLwEKFSGQAuZQQ@mail.gmail.com>
	<CABzX+qwBFDNQ7DVErMhzL+1M9LgZrVzfmTFTW1QAUi_t0oZr6g@mail.gmail.com>
Message-ID: <8980.173.180.139.38.1314192760.squirrel@mail.wedohosting.com>

Made the change as per your update and it works great.  Thanks Marek!
-- 
Doug Gorley | doug at gorley.ca

On Wed, August 24, 2011 3:52 am, Marek Majkowski wrote:
> On Wed, Aug 24, 2011 at 09:32, Marek Majkowski <majek04 at gmail.com> wrote:
>> Thanks for the report. It does look like a problem caused
>> by a bug in Pika or my misunderstanding how start/stop_consuming
>> work.
>
> Yup. I did misuse "stop_consuming". Apparently, it calls
> basic.cancel, which was completely not inteded:
> https://github.com/pika/pika/blob/v0.9.5/pika/adapters/blocking_connection.py#L287
>
> The fix is here:
> https://github.com/rabbitmq/rabbitmq-tutorials/commit/c1b178d9deec664cdf12770c24319c7d12d67efd
>
> Thanks again for the report!
>
> Cheers,
>   Marek
>
>> On Wed, Aug 24, 2011 at 02:49, Doug Gorley <doug at gorley.ca> wrote:
>>> I'm hoping someone can help he with my RabbitMQ problem; I've got some
>>> code based on the tutorial #6 code, and it's not doing what I'm
>>> expecting.
>>> I tried to create a shell where I can send strings to the server and
>>> receive the MD5 digest, but I only ever seem to get the first reply.
>>>
>>> Here's the source:
>>>
>>> ##########################################################################
>>> # server.py
>>>
>>> import pika
>>> import hashlib
>>>
>>> connection = pika.BlockingConnection(
>>> ?? ??pika.ConnectionParameters(host='localhost'))
>>>
>>> channel = connection.channel()
>>> channel.queue_declare(queue='my_request')
>>>
>>> def on_request(ch, method, props, body):
>>>
>>> ?? ??response = hashlib.md5(body).hexdigest()
>>>
>>> ?? ??print("Received '%r', sending '%r'" % (body, response))
>>>
>>> ?? ??ch.basic_publish(exchange='',
>>> ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? routing_key=props.reply_to,
>>> ?? ?? ?? ?? ?? ?? ?? ?? ?? ??
>>> properties=pika.BasicProperties(correlation_id = \
>>> ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ??
>>> ?? ?? props.correlation_id),
>>> ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? body=response)
>>>
>>> ?? ??ch.basic_ack(delivery_tag = method.delivery_tag)
>>>
>>> channel.basic_qos(prefetch_count=1)
>>> channel.basic_consume(on_request, queue='my_request')
>>>
>>> print " [x] Awaiting requests"
>>> channel.start_consuming()
>>> ##########################################################################
>>>
>>> ##########################################################################
>>> # client.py
>>>
>>> import pika
>>> import uuid
>>>
>>> class RabbitClient(object):
>>>
>>> ?? ??def __init__(self):
>>> ?? ?? ?? ??self.connection = pika.BlockingConnection(
>>> ?? ?? ?? ?? ?? ??pika.ConnectionParameters(host='localhost'))
>>>
>>> ?? ?? ?? ??self.channel = self.connection.channel()
>>>
>>> ?? ?? ?? ??result = self.channel.queue_declare(exclusive=True)
>>> ?? ?? ?? ??self.callback_queue = result.method.queue
>>>
>>> ?? ?? ?? ??self.channel.basic_consume(self.on_response, no_ack=True,
>>> ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ??
>>> queue=self.callback_queue)
>>>
>>> ?? ??def on_response(self, ch, method, props, body):
>>> ?? ?? ?? ??print(" [.] Received correlation ID %r" %
>>> (props.correlation_id,))
>>> ?? ?? ?? ??if self.corr_id == props.correlation_id:
>>> ?? ?? ?? ?? ?? ??self.response = body
>>> ?? ?? ?? ?? ?? ??self.channel.stop_consuming()
>>> ?? ?? ?? ??else:
>>> ?? ?? ?? ?? ?? ??print(" [~] Correlation IDs do not match")
>>>
>>> ?? ??def call(self, n):
>>> ?? ?? ?? ??self.corr_id = str(uuid.uuid4())
>>> ?? ?? ?? ??self.channel.basic_publish(exchange='',
>>> ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ??
>>> routing_key='my_request',
>>> ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ??
>>> properties=pika.BasicProperties(
>>> ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ??
>>> reply_to=self.callback_queue,
>>> ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ??
>>> correlation_id=self.corr_id,
>>> ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ),
>>> ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? body=n)
>>> ?? ?? ?? ??self.channel.start_consuming()
>>> ?? ?? ?? ??return self.response
>>>
>>> auth = RabbitClient()
>>>
>>> while True:
>>> ?? ??send = raw_input('> ')
>>> ?? ??if send == 'quit': break
>>> ?? ??print(" [x] sending '%s'" % (send))
>>> ?? ??response = auth.call(send)
>>> ?? ??print(" [^] sent with correlation ID %s" % (auth.corr_id,))
>>> ?? ??print(" [.] Got %r" % (response,))
>>> ##########################################################################
>>>
>>> Here's the output from the server:
>>>
>>> ##########################################################################
>>> ??[x] Awaiting requests
>>> Received ''Hello World'', sending ''b10a8db164e0754105b7a99be72e3fe5''
>>> Received ''Hello Rabbit'', sending ''5bec01f45b43f6202e84242fcb71b04f''
>>> ##########################################################################
>>>
>>> And here's the output from the server:
>>> ##########################################################################
>>>> Hello World
>>> ??[x] sending 'Hello World'
>>> ??[.] Received correlation ID '1805f131-1fbc-40a3-86fb-2a113b5f9b9a'
>>> ??[^] sent with correlation ID 1805f131-1fbc-40a3-86fb-2a113b5f9b9a
>>> ??[.] Got 'b10a8db164e0754105b7a99be72e3fe5'
>>>> Hello Rabbit
>>> ??[x] sending 'Hello Rabbit'
>>> ??[^] sent with correlation ID fdb089ff-44ea-4b81-885b-be7e0178d5a1
>>> ??[.] Got 'b10a8db164e0754105b7a99be72e3fe5'
>>>> quit
>>> ##########################################################################
>>>
>>> So, my question is, what am I doing wrong that I didn't get the '5bec'
>>> response to the second message?
>>>
>>> Thanks for your help,
>>> --
>>> Doug Gorley | doug at gorley.ca
>>>
>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>
>



From james.r.carr at gmail.com  Wed Aug 24 16:53:10 2011
From: james.r.carr at gmail.com (James Carr)
Date: Wed, 24 Aug 2011 10:53:10 -0500
Subject: [rabbitmq-discuss] Collecting message metrics?
In-Reply-To: <CAJreXKAoiveu-YFT9Eeu_=VRbvt5CsvOWYxGN+wvf_u1f7Yqrw@mail.gmail.com>
References: <CAJreXKAoiveu-YFT9Eeu_=VRbvt5CsvOWYxGN+wvf_u1f7Yqrw@mail.gmail.com>
Message-ID: <CAJreXKBohv=VyLaNTQ0asX2_gZCvsYLyrPz_M1nuWSuHd5B67A@mail.gmail.com>

Hi all,

I'm wondering if there are some "total metrics" that can be captured by
rabbitm or the mgmt plugin. For example, I want to be able to report that
our brokers received x number of messages, routed x number or messages  for
the month.

Thanks,
James
On Aug 23, 2011 5:12 AM, "Simon MacMullen" <simon at rabbitmq.com> wrote:
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110824/79c89789/attachment.htm>

From Waseem_Hawaldar at mindtree.com  Thu Aug 25 08:48:56 2011
From: Waseem_Hawaldar at mindtree.com (Waseem Hawaldar)
Date: Thu, 25 Aug 2011 07:48:56 +0000
Subject: [rabbitmq-discuss] Enabling SSL Support in RabbitMQ
Message-ID: <192E282CAB256F41A2161A9E1BAA7C5EA7641C@MTW02MBX01.mindtree.com>

Hi Emile,
                As per your suggestion in my previous mail, I am referring this link: http://www.rabbitmq.com/ssl.html

I have installed rabbitmq_server-2.2.0 and otp_win32_R14B03.exe into my windows 7 machine. Now when I try to enable SSL support by executing following command :
D:\Softwares\RabbitMQforSSL\rabbitmq_server-2.2.0\sbin>-rabbit ssl_listeners

I am observing the following error message:
'-rabbit' is not recognized as an internal or external command,
operable program or batch file.

Please let me know, what's going wrong over here.

Any help will be appreciated.


Thanks and Regards,
Waseem


________________________________

http://www.mindtree.com/email/disclaimer.html
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110825/117619cc/attachment.htm>

From emile at rabbitmq.com  Thu Aug 25 09:49:59 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 25 Aug 2011 09:49:59 +0100
Subject: [rabbitmq-discuss] Enabling SSL Support in RabbitMQ
In-Reply-To: <192E282CAB256F41A2161A9E1BAA7C5EA7641C@MTW02MBX01.mindtree.com>
References: <192E282CAB256F41A2161A9E1BAA7C5EA7641C@MTW02MBX01.mindtree.com>
Message-ID: <4E560CB7.5090106@rabbitmq.com>

Waseem,

On 25/08/11 08:48, Waseem Hawaldar wrote:
> -rabbit ssl_listeners

These are arguments, not a command. That's why you get an error when
trying to execute them. The simplest way to set up SSL is to make use of
a configuration file instead. The format of the file and details on how
to create certificates are explained on
http://www.rabbitmq.com/ssl.html .


Regards

Emile

From masterjakul at gmail.com  Thu Aug 25 12:16:08 2011
From: masterjakul at gmail.com (Craig Blaszczyk)
Date: Thu, 25 Aug 2011 04:16:08 -0700 (PDT)
Subject: [rabbitmq-discuss] Cannot start 'guid generator' (rabbitmq)
Message-ID: <8803778.672.1314270968321.JavaMail.geo-discussion-forums@yqkr5>

Hey guys,

I'm having problems running RabbitMQ. It used to run fine on my machine 
(Centos 5.5), but now it won't start.

I have tried uninstalling and reinstalling (through yum), but the error 
remains the same.

I have no rabbitmq.conf anywhere.

--------- /var/log/rabbitmq/erl_crash.dump ------------
=erl_crash_dump:0.1
Thu Aug 25 12:14:12 2011
Slogan: Kernel pid terminated (application_controller) 
({application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}})
System version: Erlang (BEAM) emulator version 5.6.5 [source] [64-bit] 
[async-threads:30] [hipe] [kernel-poll:true]
Compiled: Mon Jun  7 08:44:21 2010
Atoms: 14581

[[.... plus a lot more]]

--------- /var/log/rabbitmq/startup_log -----------

Starting all nodes...
Starting node rabbit at localhost...
Activating RabbitMQ plugins ...
*WARNING* Undefined function ssl:ssl_accept/3
0 plugins activated:


+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
|   v2.2.0  +---+   |
|                   |
+-------------------+
AMQP 0-9-1 / 0-9 / 0-8
Copyright (C) 2007-2010 LShift Ltd., Cohesive Financial Technologies LLC., 
and Rabbit Technologies Ltd.
Licensed under the MPL.  See http://www.rabbitmq.com/

node           : rabbit at localhost
app descriptor : 
/usr/lib/rabbitmq/lib/rabbitmq_server-2.2.0/sbin/../ebin/rabbit.app
home dir       : /var/lib/rabbitmq
cookie hash    : o7C7JoCv42mSnmHjO7yECA==
log            : /var/log/rabbitmq/rabbit at localhost.log
sasl log       : /var/log/rabbitmq/rabbit at localhost-sasl.log
database dir   : /var/lib/rabbitmq/mnesia/rabbit at localhost
erlang version : 5.6.5

starting file handle cache server                                     
...done
starting worker pool                                                 
 ...done
starting database                                                     
...done
starting codec correctness check                                     
 ...done
-- external infrastructure ready
starting statistics event manager                                     
...done
starting logging server                                               
...done
starting exchange type registry                                       
...done
starting exchange type direct                                         
...done
starting exchange type fanout                                         
...done
starting exchange type headers                                       
 ...done
starting exchange type topic                                         
 ...done
-- kernel ready
starting node monitor                                                 
...done
starting cluster delegate                                             
...done
starting guid generator                                               
...BOOT ERROR: FAILED
Reason: {badmatch,
            {error,
                {shutdown,
                    {child,undefined,rabbit_guid_sup,
                        {rabbit_restartable_sup,start_link,
                            [rabbit_guid_sup,{rabbit_guid,start_link,[]}]},
                        transient,infinity,supervisor,
                        [rabbit_restartable_sup]}}}}
Stacktrace: [{rabbit_sup,start_restartable_child,2},
             {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
             {rabbit,run_boot_step,1},
             {rabbit,'-start/2-lc$^0/1-0-',1},
             {rabbit,start,2},
             {application_master,start_it_old,4}]
{"Kernel pid 
terminated",application_controller,"{application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}}"}

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110825/61769fdc/attachment.htm>

From czarek at thebestisp.co.uk  Thu Aug 25 13:09:47 2011
From: czarek at thebestisp.co.uk (Cezary Siwek)
Date: Thu, 25 Aug 2011 13:09:47 +0100
Subject: [rabbitmq-discuss] queue gets removed from a node
Message-ID: <4E563B8B.6000704@thebestisp.co.uk>

Hi list,

I'm facing an issue with my rabittmq cluster where a queue disappears 
from a node.
I have 2 nodes in a cluster working in "disk mode".
Node1 - only consumes messages from the queue.
Node2 - only publishes messages to the queue.

The consumer script on Node1 creates a durable queue and waits for 
messages.
Everything works fine until some no-activity time. I can't say how long 
it needs to be but usually after more than 24h the queue disappears from 
Node2 and the consumer stops receiving messages. The list_queues command 
shows the queue exists on Node1 but not on Node2.
I've done a packet trace when it happened and I can see some packets are 
being exchanged between nodes. Also cluster_status commands shows that 
both nodes are up and running in the cluster.
When I try to declare_queue on the Node2 i get 'NOT_FOUND - no queue 
'msgs' in vhost '/vhost1'.
All I need to do to have the Node2 running is to run stop_app and start_app.

Both nodes are sitting behind firewalls (in separate networks) but both 
firewalls have been granted to pass all the traffic between these two boxes.
It happens on my dev platfrom. On production I don't think I will ever 
have such long quiet periods but I need to find out what is causing this.

Do you have any idea what is the problem?

Regards,
Cezary







From matthew at rabbitmq.com  Thu Aug 25 13:17:50 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 25 Aug 2011 13:17:50 +0100
Subject: [rabbitmq-discuss] Cannot start 'guid generator' (rabbitmq)
In-Reply-To: <8803778.672.1314270968321.JavaMail.geo-discussion-forums@yqkr5>
References: <8803778.672.1314270968321.JavaMail.geo-discussion-forums@yqkr5>
Message-ID: <20110825121750.GB30551@rabbitmq.com>

Hi Craig,

That's rather an odd thing to go wrong, and the error msg isn't
extremely helpful. Are there any further relevant entries in the log
files at /var/log/rabbitmq/rabbit at localhost-sasl.log or
/var/log/rabbitmq/rabbit at localhost.log?


Matthew

From masterjakul at gmail.com  Thu Aug 25 13:40:41 2011
From: masterjakul at gmail.com (Craig Blaszczyk)
Date: Thu, 25 Aug 2011 05:40:41 -0700 (PDT)
Subject: [rabbitmq-discuss] Cannot start 'guid generator' (rabbitmq)
In-Reply-To: <20110825121750.GB30551@rabbitmq.com>
References: <8803778.672.1314270968321.JavaMail.geo-discussion-forums@yqkr5>
	<20110825121750.GB30551@rabbitmq.com>
Message-ID: <27737081.1109.1314276041533.JavaMail.geo-discussion-forums@yqej16>

Thanks for the quick reply!

There's nothing in the logs that look useful to me.

Here are they are:

----------------- /var/log/rabbitmqrabbit\localhost-sasl.log 
-----------------------
=SUPERVISOR REPORT==== 25-Aug-2011::12:18:42 ===
     Supervisor: {local,rabbit_guid_sup}
     Context:    start_error
     Reason:     {'EXIT',{{case_clause,{ok,[]}},
                          [{rabbit_guid,update_disk_serial,0},
                           {rabbit_guid,start_link,0},
                           {supervisor,do_start_child,2},
                           {supervisor,start_children,3},
                           {supervisor,init_children,2},
                           {gen_server,init_it,6},
                           {proc_lib,init_p_do_apply,3}]}}
     Offender:   [{pid,undefined},
                  {name,rabbit_guid},
                  {mfa,{rabbit_guid,start_link,[]}},
                  {restart_type,transient},
                  {shutdown,4294967295},
                  {child_type,worker}]


=CRASH REPORT==== 25-Aug-2011::12:18:43 ===
  crasher:
    pid: <0.110.0>
    registered_name: []
    exception exit: {bad_return,{{rabbit,start,[normal,[]]},
                                 {'EXIT',{rabbit,failure_during_boot}}}}
      in function  application_master:init/4
    initial call: application_master:init/4
    ancestors: [<0.109.0>]
    messages: [{'EXIT',<0.111.0>,normal}]
    links: [<0.109.0>,<0.6.0>]
    dictionary: []
    trap_exit: true
    status: running
    heap_size: 1597
    stack_size: 23
    reductions: 355
  neighbours:


----------------- /var/log/rabbitmqrabbit\localhost.log 
-----------------------

=INFO REPORT==== 25-Aug-2011::12:18:42 ===
Limiting to approx 924 file handles (829 sockets)

=ERROR REPORT==== 25-Aug-2011::12:18:42 ===
FAILED
Reason: {badmatch,
            {error,
                {shutdown,
                    {child,undefined,rabbit_guid_sup,
                        {rabbit_restartable_sup,start_link,
                            [rabbit_guid_sup,{rabbit_guid,start_link,[]}]},
                        transient,infinity,supervisor,
                        [rabbit_restartable_sup]}}}}
Stacktrace: [{rabbit_sup,start_restartable_child,2},
             {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
             {rabbit,run_boot_step,1},
             {rabbit,'-start/2-lc$^0/1-0-',1},
             {rabbit,start,2},
             {application_master,start_it_old,4}]

=INFO REPORT==== 25-Aug-2011::12:18:43 ===
    application: rabbit
    exited: {bad_return,{{rabbit,start,[normal,[]]},
                         {'EXIT',{rabbit,failure_during_boot}}}}
    type: permanent


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110825/fd2df2f2/attachment.htm>

From matthew at rabbitmq.com  Thu Aug 25 13:49:42 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 25 Aug 2011 13:49:42 +0100
Subject: [rabbitmq-discuss] Cannot start 'guid generator' (rabbitmq)
In-Reply-To: <27737081.1109.1314276041533.JavaMail.geo-discussion-forums@yqej16>
References: <8803778.672.1314270968321.JavaMail.geo-discussion-forums@yqkr5>
	<20110825121750.GB30551@rabbitmq.com>
	<27737081.1109.1314276041533.JavaMail.geo-discussion-forums@yqej16>
Message-ID: <20110825124941.GC30551@rabbitmq.com>

On Thu, Aug 25, 2011 at 05:40:41AM -0700, Craig Blaszczyk wrote:
> There's nothing in the logs that look useful to me.

Ahh, but they look useful to me!

> 
> Here are they are:
> 
> ----------------- /var/log/rabbitmqrabbit\localhost-sasl.log 
> -----------------------
> =SUPERVISOR REPORT==== 25-Aug-2011::12:18:42 ===
>      Supervisor: {local,rabbit_guid_sup}
>      Context:    start_error
>      Reason:     {'EXIT',{{case_clause,{ok,[]}},
>                           [{rabbit_guid,update_disk_serial,0},

Your /var/lib/rabbitmq/mnesia/rabbit at localhost/rabbit_serial file is
empty. It shouldn't be, and it's an odd thing for it to be empty. Safest
bet is just to delete that file and then Rabbit should start up again
just fine. There's a small increased chance of GUID collision if you
have existing msgs stored in Rabbit, but the chance is sufficiently
small that I'd not worry too much...

Matthew

From masterjakul at gmail.com  Thu Aug 25 14:57:57 2011
From: masterjakul at gmail.com (Craig Blaszczyk)
Date: Thu, 25 Aug 2011 06:57:57 -0700 (PDT)
Subject: [rabbitmq-discuss] Cannot start 'guid generator' (rabbitmq)
In-Reply-To: <20110825124941.GC30551@rabbitmq.com>
References: <8803778.672.1314270968321.JavaMail.geo-discussion-forums@yqkr5>
	<20110825121750.GB30551@rabbitmq.com>
	<27737081.1109.1314276041533.JavaMail.geo-discussion-forums@yqej16>
	<20110825124941.GC30551@rabbitmq.com>
Message-ID: <24877139.1323.1314280677794.JavaMail.geo-discussion-forums@yqcd38>

That worked! Thanks Matthew.

Do you have any idea why this might have happened? Or what I could do to 
stop it happening again?

[craig at localhost ~]$ sudo service rabbitmq-server start
Starting rabbitmq-server: SUCCESS
rabbitmq-server.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110825/81aae832/attachment.htm>

From matthew at rabbitmq.com  Thu Aug 25 15:10:22 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 25 Aug 2011 15:10:22 +0100
Subject: [rabbitmq-discuss] Cannot start 'guid generator' (rabbitmq)
In-Reply-To: <24877139.1323.1314280677794.JavaMail.geo-discussion-forums@yqcd38>
References: <8803778.672.1314270968321.JavaMail.geo-discussion-forums@yqkr5>
	<20110825121750.GB30551@rabbitmq.com>
	<27737081.1109.1314276041533.JavaMail.geo-discussion-forums@yqej16>
	<20110825124941.GC30551@rabbitmq.com>
	<24877139.1323.1314280677794.JavaMail.geo-discussion-forums@yqcd38>
Message-ID: <20110825141022.GD30551@rabbitmq.com>

On Thu, Aug 25, 2011 at 06:57:57AM -0700, Craig Blaszczyk wrote:
> Do you have any idea why this might have happened? Or what I could do to 
> stop it happening again?

None whatsoever. It's an issue we've never seen before and the only
thing I can think is either FS corruption or you ran out of space on a
hard disc when it was writing that file in the first place or some other
weird and rare event occured to render that file empty/corrupted. Very
odd indeed.

Matthew

From mikeb at rabbitmq.com  Thu Aug 25 15:13:48 2011
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Thu, 25 Aug 2011 15:13:48 +0100
Subject: [rabbitmq-discuss] PubSub Huddle,
 a free one-day conference on messaging, 23 Sept London UK
Message-ID: <4E56589C.6050605@rabbitmq.com>

Dear everyone,

Announcing PubSub Huddle http://www.pubsubhuddle.com/, a free one-day 
conference on messaging, with speakers from RabbitMQ, ZeroMQ and MQTT.

The 'Huddle will be held in London at Skills Matter in Clerkenwell, 
London UK, on Friday 23rd September.  You can register at
http://skillsmatter.com/event/nosql/pubsub/js-2574

The speakers are listed at http://www.pubsubhuddle.com/node/2. Among 
them is our very own Marek Majkowski, who will (so the plan goes) be 
talking about WebSockets and RabbitMQ with perhaps a bit of CloudFoundry 
thrown in for good measure.

Also speaking will be Martin S?strik, a founder of the ZeroMQ project, 
and Andy Piper, who is involved with the MQTT project at IBM.

The schedule is roughly as follows:

Morning: talks from the aforementioned plus a special guest
Afternoon: lightning talks / unconferencing / hacking
Evening: beer!

On the afternoon slot -- folk from RabbitMQ, ZeroMQ and MQTT will be on 
hand, so bring along your messaging-oriented projects or ideas and we'll 
help you develop them.

Lastly, the splendid people at Skills Matter will be videoing the talks, 
so even if you can't be there, you'll be able to watch them later.


Michael

RabbitMQ/ VMware

From masterjakul at gmail.com  Thu Aug 25 16:22:42 2011
From: masterjakul at gmail.com (Craig Blaszczyk)
Date: Thu, 25 Aug 2011 08:22:42 -0700 (PDT)
Subject: [rabbitmq-discuss] Cannot start 'guid generator' (rabbitmq)
In-Reply-To: <20110825141022.GD30551@rabbitmq.com>
References: <8803778.672.1314270968321.JavaMail.geo-discussion-forums@yqkr5>
	<20110825121750.GB30551@rabbitmq.com>
	<27737081.1109.1314276041533.JavaMail.geo-discussion-forums@yqej16>
	<20110825124941.GC30551@rabbitmq.com>
	<24877139.1323.1314280677794.JavaMail.geo-discussion-forums@yqcd38>
	<20110825141022.GD30551@rabbitmq.com>
Message-ID: <7012808.1485.1314285762311.JavaMail.geo-discussion-forums@yqgc10>

I think the finger pointing should start at filesystem corruption. I often 
have to run fsck on this virtual machine, as it often doesn't shutdown 
cleanly.

Thanks again for your quick response &  help

--Craig
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110825/b12180a4/attachment.htm>

From cbehrens at codestud.com  Thu Aug 25 17:56:29 2011
From: cbehrens at codestud.com (Chris Behrens)
Date: Thu, 25 Aug 2011 09:56:29 -0700
Subject: [rabbitmq-discuss] possible rabbitmq bug
Message-ID: <B1503074-F775-4F48-B069-10D927ED5539@codestud.com>

Hi,

I've been working with various python modules (carrot, kombu.. all using the python amqplib underneath) and I have spotted what I think may be a bug with rabbit.  I'd love to hear if anyone else is run into this or if I'm just plain wrong.

I've been creating code that will re-use rabbit connections (they're pooled) to avoid the unnecessary cost of closing and reopening connections all of the time.  I create a channel on which I declare an exchange/queue with auto_delete=True.  If I do absolutely nothing more with this channel, and then close the channel, rabbit continues to have an empty queue sitting around _until_ the connection is closed.  It seems that closing the channel should nuke the queue, but it doesn't.   (This is not a very good use case I realize, but it can happen if I have some error handling in between declaring the queue and consuming it which ends up closing the channel before consuming.)

More of a problem is that this is also the behavior if I consume with methods that result in a basic_get amqp command (NOT a basic_consume command).  Ie, if I create a channel, declare a queue auto_delete=True, use _only_ basic_get() to consume the queue and then close the channel when the queue is empty, the queue is also NOT nuked in this scenario.  This causes a huge problem when re-using connections that have declared random queue names.  Every time a connection is pulled from the pool and used, I have a random queue name lying around...  _until_ the connection is closed.   Shouldn't closing the channel end up removing the empty queue, as there's no more consumer for it?

NOTE:  This problem goes away once you call basic_consume(), instead.  Once you've called basic_cancel(), you can basic_cancel() it, and the queue goes away.  Alternatively, instead of calling basic_cancel(), I can just close the channel, and the queue will go away.  So, the workaround to my problem is to always use basic_consume() instead of basic_get() (which is more efficient, anyway).... BUT I still have this rare corner case described first above.  Ie, if I declare an auto_delete queue on a channel, and immediately close the channel... the queue is left around when it should be removed.

The complete workaround is to close the connection to rabbit, but then that means I can't use a pool of connections and recycle them anymore, obviously.  I lose the efficiency gained by not having to close/reopen connections all of the time.

Comments?

Thanks,

- Chris



From rparra at homeaway.com  Thu Aug 25 18:12:11 2011
From: rparra at homeaway.com (Rene Parra)
Date: Thu, 25 Aug 2011 12:12:11 -0500
Subject: [rabbitmq-discuss] Management Plugin stops gathering stats ?
In-Reply-To: <4E540F1D.2080001@rabbitmq.com>
Message-ID: <CA7BEC9B.EAA7%rparra@homeaway.com>

Matthias, et.al, 

It took me a while to answer this, sorry for the delay.

We have since upgraded to 2.5.1 and erlang R14B03.

The publish rates seem to only work if I use the CachingConnectionFactory in
Spring vs the SingleConnectionFactory. Makes sense, because when I use
SingleConnectionFactory, my publisher is creating and closing a connection
on every single publish.... therefore rabbit only can create statistics for
a connection that no longer exists (wouldn't make sense unless you are doing
historic stats, which I'd be surprised if you do).

FWIW,

The stats bug, and the memory bug seem to be better in 2.5.1/R14B03. We are
progressing with our soak / load tests at a very light load (100 TPS).

I was able to exhibit the stats bug, and hence memory bug however in
2.5.1/R14B03 under high load.

The video is here:

TimePoints:
* @ 0m00s:  - Memory Pressure WORKING, Throttling ACTIVE
* @ 0m37s:  - BANG! Statistics stop collecting
* @ 0m56s:  - Showing how Memory Level now exceeded.

Good news is all the messages were indeed delivered.
Bad news even after the test completed, I had to restart RabbitMQ to recover
the memory back down to a normal state and get the stats/memory
level/publish throttling working again.

We are going to continue with our tests @ 100TPS (since that is all we need
for our initial application) but would appreciate any other insight that we
can provide for you on this issue.

Thank you for your help!
--rparra

Note: The above screencast was done after we upgraded to 2.5.1 but BEFORE we
upgraded to erlang R14B03.  We have not run the heavy load against R14B03
yet.

On 8/23/11 3:35 PM, "Matthias Radestock" <matthias at rabbitmq.com> wrote:

> Rene,
> 
> On 23/08/11 20:59, Rene Parra wrote:
>>>> Here?s a ScreenCast of the management UI working and then ?FAILS?:
>>>> 
>>>> http://goo.gl/jrvAP
>>>> 
>>>> (please fast forward to these time points in the screencast)
>>>> 
>>>> @2m 16s:  The system runs normally and then I demo the queues stats
>>>> collection working perfectly.
> 
> Er, no, something is wrong here. We see Delivers and Acks, but no queued
> messages and no publishes. So where are the delivered messages coming
> from? ...
> 
>>>> @2m 56s:  Connection View shows normal operating behavior.
> 
> This shows a 25kb/s inbound rate on one of the connections. Presumably
> these are the publishes, but for some reason they don't show up in the
> stats.
> 
> I definitely recommend upgrading to 2.5.1. If the problem still occurs
> there it will be easier for us to track down.
> 
> 
> Regards,
> 
> Matthias.


From rparra at homeaway.com  Thu Aug 25 18:13:10 2011
From: rparra at homeaway.com (Rene Parra)
Date: Thu, 25 Aug 2011 12:13:10 -0500
Subject: [rabbitmq-discuss] Management Plugin stops gathering stats ?
In-Reply-To: <CA7BEC9B.EAA7%rparra@homeaway.com>
Message-ID: <CA7BECD6.EAA9%rparra@homeaway.com>

Helps if I provide the link for the video:

http://screencast.com/t/BtWXVsvijqa5

TimePoints:
* @ 0m00s:  - Memory Pressure WORKING, Throttling ACTIVE
* @ 0m37s:  - BANG! Statistics stop collecting
* @ 0m56s:  - Showing how Memory Level now exceeded.


On 8/25/11 12:12 PM, "Rene Parra" <rparra at homeaway.com> wrote:

> Matthias, et.al, 
> 
> It took me a while to answer this, sorry for the delay.
> 
> We have since upgraded to 2.5.1 and erlang R14B03.
> 
> The publish rates seem to only work if I use the CachingConnectionFactory in
> Spring vs the SingleConnectionFactory. Makes sense, because when I use
> SingleConnectionFactory, my publisher is creating and closing a connection on
> every single publish.... therefore rabbit only can create statistics for a
> connection that no longer exists (wouldn't make sense unless you are doing
> historic stats, which I'd be surprised if you do).
> 
> FWIW,
> 
> The stats bug, and the memory bug seem to be better in 2.5.1/R14B03. We are
> progressing with our soak / load tests at a very light load (100 TPS).
> 
> I was able to exhibit the stats bug, and hence memory bug however in
> 2.5.1/R14B03 under high load.
> 
> The video is here:
> 
> TimePoints:
> * @ 0m00s:  - Memory Pressure WORKING, Throttling ACTIVE
> * @ 0m37s:  - BANG! Statistics stop collecting
> * @ 0m56s:  - Showing how Memory Level now exceeded.
> 
> Good news is all the messages were indeed delivered.
> Bad news even after the test completed, I had to restart RabbitMQ to recover
> the memory back down to a normal state and get the stats/memory level/publish
> throttling working again.
> 
> We are going to continue with our tests @ 100TPS (since that is all we need
> for our initial application) but would appreciate any other insight that we
> can provide for you on this issue.
> 
> Thank you for your help!
> --rparra
> 
> Note: The above screencast was done after we upgraded to 2.5.1 but BEFORE we
> upgraded to erlang R14B03.  We have not run the heavy load against R14B03 yet.
> 
> On 8/23/11 3:35 PM, "Matthias Radestock" <matthias at rabbitmq.com> wrote:
> 
>> Rene,
>> 
>> On 23/08/11 20:59, Rene Parra wrote:
>>>>> Here?s a ScreenCast of the management UI working and then ?FAILS?:
>>>>> 
>>>>> http://goo.gl/jrvAP
>>>>> 
>>>>> (please fast forward to these time points in the screencast)
>>>>> 
>>>>> @2m 16s:  The system runs normally and then I demo the queues stats
>>>>> collection working perfectly.
>> 
>> Er, no, something is wrong here. We see Delivers and Acks, but no queued
>> messages and no publishes. So where are the delivered messages coming
>> from? ...
>> 
>>>>> @2m 56s:  Connection View shows normal operating behavior.
>> 
>> This shows a 25kb/s inbound rate on one of the connections. Presumably
>> these are the publishes, but for some reason they don't show up in the
>> stats.
>> 
>> I definitely recommend upgrading to 2.5.1. If the problem still occurs
>> there it will be easier for us to track down.
>> 
>> 
>> Regards,
>> 
>> Matthias.


From simon at rabbitmq.com  Thu Aug 25 18:27:13 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 25 Aug 2011 18:27:13 +0100
Subject: [rabbitmq-discuss] Management Plugin stops gathering stats ?
In-Reply-To: <CA7BEC9B.EAA7%rparra@homeaway.com>
References: <CA7BEC9B.EAA7%rparra@homeaway.com>
Message-ID: <4E5685F1.2060900@rabbitmq.com>

On 25/08/11 18:12, Rene Parra wrote:
> The publish rates seem to only work if I use the CachingConnectionFactory in
> Spring vs the SingleConnectionFactory. Makes sense, because when I use
> SingleConnectionFactory, my publisher is creating and closing a connection
> on every single publish.... therefore rabbit only can create statistics for
> a connection that no longer exists (wouldn't make sense unless you are doing
> historic stats, which I'd be surprised if you do).

Ah, that makes sense. Yes, we want to do historical stats at some point, 
but we don't now.

> FWIW,
>
> The stats bug, and the memory bug seem to be better in 2.5.1/R14B03. We are
> progressing with our soak / load tests at a very light load (100 TPS).
>
> I was able to exhibit the stats bug, and hence memory bug however in
> 2.5.1/R14B03 under high load.
>
> The video is here:
>
> TimePoints:
> * @ 0m00s:  - Memory Pressure WORKING, Throttling ACTIVE
> * @ 0m37s:  - BANG! Statistics stop collecting
> * @ 0m56s:  - Showing how Memory Level now exceeded.
>
> Good news is all the messages were indeed delivered.
> Bad news even after the test completed, I had to restart RabbitMQ to recover
> the memory back down to a normal state and get the stats/memory
> level/publish throttling working again.

Thanks. Looking at the logs for the previous run I now see that the 
process within mgmt that actually keeps track of memory use crashed at 
around this point, so it's possible that mgmt is no longer reporting the 
memory use accurately. So that's a bug.

Anyway, I think I now have enough information to make a better go of 
replicating this, which I'll do tomorrow. Thanks for the information.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From vbernard42 at gmail.com  Fri Aug 26 08:48:06 2011
From: vbernard42 at gmail.com (Valentin Bernard)
Date: Fri, 26 Aug 2011 00:48:06 -0700 (PDT)
Subject: [rabbitmq-discuss] possible rabbitmq bug
In-Reply-To: <B1503074-F775-4F48-B069-10D927ED5539@codestud.com>
References: <B1503074-F775-4F48-B069-10D927ED5539@codestud.com>
Message-ID: <64f713aa-aa24-4b26-b9f3-7d71e9ac5eb6@h6g2000yqe.googlegroups.com>

Hi,

I have also run into this, but Ask Solem recently shed light on that
behavior on the mailing list:
"Note that auto_delete queues are not deleted until the last consumer
 stops consuming from it, and an auto_delete queue is *not*
 deleted if there have never been any consumers consuming from it."

Yet, that does not explain why your queue is still deleted when you're
closing the connection... or I'm missing something too?

Regards,

Valentin.

On Aug 25, 6:56?pm, Chris Behrens <cbehr... at codestud.com> wrote:
> Hi,
>
> I've been working with various python modules (carrot, kombu.. all using the python amqplib underneath) and I have spotted what I think may be a bug with rabbit. ?I'd love to hear if anyone else is run into this or if I'm just plain wrong.
>
> I've been creating code that will re-use rabbit connections (they're pooled) to avoid the unnecessary cost of closing and reopening connections all of the time. ?I create a channel on which I declare an exchange/queue with auto_delete=True. ?If I do absolutely nothing more with this channel, and then close the channel, rabbit continues to have an empty queue sitting around _until_ the connection is closed. ?It seems that closing the channel should nuke the queue, but it doesn't. ? (This is not a very good use case I realize, but it can happen if I have some error handling in between declaring the queue and consuming it which ends up closing the channel before consuming.)
>
> More of a problem is that this is also the behavior if I consume with methods that result in a basic_get amqp command (NOT a basic_consume command). ?Ie, if I create a channel, declare a queue auto_delete=True, use _only_ basic_get() to consume the queue and then close the channel when the queue is empty, the queue is also NOT nuked in this scenario. ?This causes a huge problem when re-using connections that have declared random queue names. ?Every time a connection is pulled from the pool and used, I have a random queue name lying around... ?_until_ the connection is closed. ? Shouldn't closing the channel end up removing the empty queue, as there's no more consumer for it?
>
> NOTE: ?This problem goes away once you call basic_consume(), instead. ?Once you've called basic_cancel(), you can basic_cancel() it, and the queue goes away. ?Alternatively, instead of calling basic_cancel(), I can just close the channel, and the queue will go away. ?So, the workaround to my problem is to always use basic_consume() instead of basic_get() (which is more efficient, anyway).... BUT I still have this rare corner case described first above. ?Ie, if I declare an auto_delete queue on a channel, and immediately close the channel... the queue is left around when it should be removed.
>
> The complete workaround is to close the connection to rabbit, but then that means I can't use a pool of connections and recycle them anymore, obviously. ?I lose the efficiency gained by not having to close/reopen connections all of the time.
>
> Comments?
>
> Thanks,
>
> - Chris
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From cbehrens at codestud.com  Fri Aug 26 09:08:05 2011
From: cbehrens at codestud.com (Chris Behrens)
Date: Fri, 26 Aug 2011 01:08:05 -0700
Subject: [rabbitmq-discuss] possible rabbitmq bug
In-Reply-To: <64f713aa-aa24-4b26-b9f3-7d71e9ac5eb6@h6g2000yqe.googlegroups.com>
References: <B1503074-F775-4F48-B069-10D927ED5539@codestud.com>
	<64f713aa-aa24-4b26-b9f3-7d71e9ac5eb6@h6g2000yqe.googlegroups.com>
Message-ID: <B96FCD1E-0A21-48E6-8F6C-8FB9E348E9B7@codestud.com>

Hi,

The queue _is_ deleted for auto_delete=True when the connection is closed in all cases.  However, it is _not_ deleted when the channel is closed... *unless* I've called basic_consume().  It seems that even if I've called basic_get() or not consumed at all... closing the channel that declared a auto_delete=True queue should behave the same as closing the connection.  I should also note the queue was declared exclusive=True, which means that once I've closed the channel that declared the queue, there's no possible way for anyone else to consume it anyway.  Right?  Closing the channel should delete this queue, should it not?

Thanks,

- Chris

On Aug 26, 2011, at 12:48 AM, Valentin Bernard wrote:

> Hi,
> 
> I have also run into this, but Ask Solem recently shed light on that
> behavior on the mailing list:
> "Note that auto_delete queues are not deleted until the last consumer
> stops consuming from it, and an auto_delete queue is *not*
> deleted if there have never been any consumers consuming from it."
> 
> Yet, that does not explain why your queue is still deleted when you're
> closing the connection... or I'm missing something too?
> 
> Regards,
> 
> Valentin.
> 
> On Aug 25, 6:56 pm, Chris Behrens <cbehr... at codestud.com> wrote:
>> Hi,
>> 
>> I've been working with various python modules (carrot, kombu.. all using the python amqplib underneath) and I have spotted what I think may be a bug with rabbit.  I'd love to hear if anyone else is run into this or if I'm just plain wrong.
>> 
>> I've been creating code that will re-use rabbit connections (they're pooled) to avoid the unnecessary cost of closing and reopening connections all of the time.  I create a channel on which I declare an exchange/queue with auto_delete=True.  If I do absolutely nothing more with this channel, and then close the channel, rabbit continues to have an empty queue sitting around _until_ the connection is closed.  It seems that closing the channel should nuke the queue, but it doesn't.   (This is not a very good use case I realize, but it can happen if I have some error handling in between declaring the queue and consuming it which ends up closing the channel before consuming.)
>> 
>> More of a problem is that this is also the behavior if I consume with methods that result in a basic_get amqp command (NOT a basic_consume command).  Ie, if I create a channel, declare a queue auto_delete=True, use _only_ basic_get() to consume the queue and then close the channel when the queue is empty, the queue is also NOT nuked in this scenario.  This causes a huge problem when re-using connections that have declared random queue names.  Every time a connection is pulled from the pool and used, I have a random queue name lying around...  _until_ the connection is closed.   Shouldn't closing the channel end up removing the empty queue, as there's no more consumer for it?
>> 
>> NOTE:  This problem goes away once you call basic_consume(), instead.  Once you've called basic_cancel(), you can basic_cancel() it, and the queue goes away.  Alternatively, instead of calling basic_cancel(), I can just close the channel, and the queue will go away.  So, the workaround to my problem is to always use basic_consume() instead of basic_get() (which is more efficient, anyway).... BUT I still have this rare corner case described first above.  Ie, if I declare an auto_delete queue on a channel, and immediately close the channel... the queue is left around when it should be removed.
>> 
>> The complete workaround is to close the connection to rabbit, but then that means I can't use a pool of connections and recycle them anymore, obviously.  I lose the efficiency gained by not having to close/reopen connections all of the time.
>> 
>> Comments?
>> 
>> Thanks,
>> 
>> - Chris
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From simon at rabbitmq.com  Fri Aug 26 10:25:37 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 26 Aug 2011 10:25:37 +0100
Subject: [rabbitmq-discuss] possible rabbitmq bug
In-Reply-To: <B96FCD1E-0A21-48E6-8F6C-8FB9E348E9B7@codestud.com>
References: <B1503074-F775-4F48-B069-10D927ED5539@codestud.com>	<64f713aa-aa24-4b26-b9f3-7d71e9ac5eb6@h6g2000yqe.googlegroups.com>
	<B96FCD1E-0A21-48E6-8F6C-8FB9E348E9B7@codestud.com>
Message-ID: <4E576691.7060304@rabbitmq.com>

On 26/08/11 09:08, Chris Behrens wrote:
> I should also note the queue was declared
> exclusive=True, which means that once I've closed the channel that
> declared the queue, there's no possible way for anyone else to
> consume it anyway.  Right?  Closing the channel should delete this
> queue, should it not?

Unfortunately the "exclusive" flag in AMQP 0-9-1 makes the queue 
exclusive to the *connection*, not the channel. This feels kinda weird 
since almost everything else is scoped to channels, but it's in the spec 
and therefore what we implement.

auto_delete is *solely* about deleting when the last consumer goes.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From cbehrens at codestud.com  Fri Aug 26 10:32:37 2011
From: cbehrens at codestud.com (Chris Behrens)
Date: Fri, 26 Aug 2011 02:32:37 -0700
Subject: [rabbitmq-discuss] possible rabbitmq bug
In-Reply-To: <4E576691.7060304@rabbitmq.com>
References: <B1503074-F775-4F48-B069-10D927ED5539@codestud.com>	<64f713aa-aa24-4b26-b9f3-7d71e9ac5eb6@h6g2000yqe.googlegroups.com>
	<B96FCD1E-0A21-48E6-8F6C-8FB9E348E9B7@codestud.com>
	<4E576691.7060304@rabbitmq.com>
Message-ID: <A1492EFB-8EC0-4C90-8CA1-A81EFD31493D@codestud.com>

Ok, thanks for the clarification.  I'll blame the spec now. :)

- Chris


On Aug 26, 2011, at 2:25 AM, Simon MacMullen wrote:

> On 26/08/11 09:08, Chris Behrens wrote:
>> I should also note the queue was declared
>> exclusive=True, which means that once I've closed the channel that
>> declared the queue, there's no possible way for anyone else to
>> consume it anyway.  Right?  Closing the channel should delete this
>> queue, should it not?
> 
> Unfortunately the "exclusive" flag in AMQP 0-9-1 makes the queue exclusive to the *connection*, not the channel. This feels kinda weird since almost everything else is scoped to channels, but it's in the spec and therefore what we implement.
> 
> auto_delete is *solely* about deleting when the last consumer goes.
> 
> Cheers, Simon
> 
> -- 
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From mchiang at plaxo.com  Sat Aug 27 09:08:45 2011
From: mchiang at plaxo.com (Michael Chiang)
Date: Sat, 27 Aug 2011 08:08:45 +0000
Subject: [rabbitmq-discuss] Problem auto-deleting large number of queues?
Message-ID: <307D53C5-2C47-4B07-8561-8A6608C18A24@plaxo.com>

Hello,
I just started playing around with rabbitmq and ran into some issue with auto-deleting large number of queues.  

I setup a rabbitMQ server (2.5.1) on a box with 4 cores, 8GB, and running Linux.  I also create 10 java consumers on a separate box, each one with one connection/channel to a rabbit MQ server.  Each consumer creates 20k queues (none-durable, auto-delete, exclusive), for a total of 200k queues on the server.  With 200k queues on the server, the memory footprint is about 2.8GB, and the server is very stable.  I can send/receive messages without any issues.  If I shutdown each consumer gracefully (ie, by calling channel.close() and then connection.close()), the rabbitMQ server takes about 300 seconds to auto-delete all the queues without much issues.

The problem comes if I don't shutdown the consumers gracefully.  If I kill all 10 consumers simultaneously without doing channel.close/connection.close, the RabbitMQ server suddenly have trouble auto-deleting those queues.  The memory effectively double to 5.6GB, and one of the cpu core is constantly staying at 100% (with 3 other cores doing nothing).  Meanwhile, the server become very unresponsive.  It takes hours before the server calms down.  When the server finally calms down, all queues are deleted and everything goes back to normal.  Does anyone knows what's going on?  Why does rabbitmq have trouble auto-deleting here?  Is there some config setting that I can tweak to fix this issue?

Thanks,
Michael  

From matthias at rabbitmq.com  Sat Aug 27 15:29:59 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 27 Aug 2011 15:29:59 +0100
Subject: [rabbitmq-discuss] Problem auto-deleting large number of queues?
In-Reply-To: <307D53C5-2C47-4B07-8561-8A6608C18A24@plaxo.com>
References: <307D53C5-2C47-4B07-8561-8A6608C18A24@plaxo.com>
Message-ID: <4E58FF67.4030400@rabbitmq.com>

Michael,

On 27/08/11 09:08, Michael Chiang wrote:
> Hello, I just started playing around with rabbitmq and ran into some
> issue with auto-deleting large number of queues.
> [...]
> If I shutdown each consumer gracefully (ie, by calling
> channel.close() and then connection.close()), the rabbitMQ server
> takes about 300 seconds to auto-delete all the queues without much
> issues.
>
> The problem comes if I don't shutdown the consumers gracefully.  If I
> kill all 10 consumers simultaneously without doing
> channel.close/connection.close, the RabbitMQ server suddenly have
> trouble auto-deleting those queues.

In the graceful closure case, do you terminate the consumers 
simultaneously or in parallel?

Is there a difference between using one connection with 200k queues vs 
10 connections with 20k queues each?

I have some idea of what might be going on, but it would help if you 
condensed your test into a single program - perhaps using multiple 
threads - and sent it to us. Thanks.

Matthias.

From matthias at rabbitmq.com  Sat Aug 27 16:17:46 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 27 Aug 2011 16:17:46 +0100
Subject: [rabbitmq-discuss] Problem auto-deleting large number of queues?
In-Reply-To: <4E58FF67.4030400@rabbitmq.com>
References: <307D53C5-2C47-4B07-8561-8A6608C18A24@plaxo.com>
	<4E58FF67.4030400@rabbitmq.com>
Message-ID: <4E590A9A.7010105@rabbitmq.com>

Michael,

forgot to ask...

Connections with thousands of exclusive queues are rather unusual. What 
are you trying to accomplish?

Matthias.

From iainemsley at gmail.com  Sat Aug 27 20:12:42 2011
From: iainemsley at gmail.com (Iain Emsley)
Date: Sat, 27 Aug 2011 20:12:42 +0100
Subject: [rabbitmq-discuss] Persistent PHP consumer over SSL
Message-ID: <CAHrXUcXWS6195DUazoKPehVCMqyQuVB+Jq5WvAYfvy-UF7bZFA@mail.gmail.com>

Evening,

I've been using and adapting the php-amqplib producer/consumer to link
systems together. The main change was replacing fsockopen with a
stream_socket_client() using the STREAM_CLIENT_CONNECT |
STREAM_CLIENT_PERSISTENT flag.

 Whilst the consumer is fine over non-SSL and running on the command line as
per the Readme, it appears to crash on SSL after about an hour or so. The
server reports that it is running as does the server, but no messages are
being passed to the linked system, rather are queueing up on the server.

Is there a way of closing a listener via a PID or only by connection on the
server using rabbitmqctl list_connections?  If messages are being queued, is
there a way of kicking the queue to see if a connection is accepting or
failing and sending any error back? The log suggests a timeout but I'd like
to try and figure out where and get the timing exact.

Alternatively, does any body know of a PHP library which I can rebuild the
persistent SSL connections quickly for the consumer?

Thanks in advance for any help and advice received.

Yours,

Iain
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110827/f131ca13/attachment.htm>

From mchiang at plaxo.com  Sun Aug 28 09:14:10 2011
From: mchiang at plaxo.com (Michael Chiang)
Date: Sun, 28 Aug 2011 08:14:10 +0000
Subject: [rabbitmq-discuss] Problem auto-deleting large number of queues?
In-Reply-To: <4E58FF67.4030400@rabbitmq.com>
References: <307D53C5-2C47-4B07-8561-8A6608C18A24@plaxo.com>
	<4E58FF67.4030400@rabbitmq.com>
Message-ID: <352EE030-3FC7-45C7-92D1-C30EDB5EB937@plaxo.com>

Hi Matthias,

> In the graceful closure case, do you terminate the consumers simultaneously or in parallel?

The consumers are terminated in parallel but not simultaneously (ie, there might be a few sec of difference between each terminations).

> Is there a difference between using one connection with 200k queues vs 10 connections with 20k queues each?

You might be on to something :).  I just ran my test client with one connection with 200k queue.  In this case, even with graceful shutdown, I am running into the auto-deleting issues.

> I have some idea of what might be going on, but it would help if you condensed your test into a single program - perhaps using multiple threads - and sent it to us. Thanks.

Sure, I can change my test code on Monday to make it multi-threaded.
Thanks,
Michael



On Aug 27, 2011, at 7:30 AM, Matthias Radestock wrote:

> Michael,
> 
> On 27/08/11 09:08, Michael Chiang wrote:
>> Hello, I just started playing around with rabbitmq and ran into some
>> issue with auto-deleting large number of queues.
>> [...]
>> If I shutdown each consumer gracefully (ie, by calling
>> channel.close() and then connection.close()), the rabbitMQ server
>> takes about 300 seconds to auto-delete all the queues without much
>> issues.
>> 
>> The problem comes if I don't shutdown the consumers gracefully.  If I
>> kill all 10 consumers simultaneously without doing
>> channel.close/connection.close, the RabbitMQ server suddenly have
>> trouble auto-deleting those queues.
> 
> In the graceful closure case, do you terminate the consumers simultaneously or in parallel?
> 
> Is there a difference between using one connection with 200k queues vs 10 connections with 20k queues each?
> 
> I have some idea of what might be going on, but it would help if you condensed your test into a single program - perhaps using multiple threads - and sent it to us. Thanks.
> 
> Matthias.


From matthias at rabbitmq.com  Sun Aug 28 10:56:34 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 28 Aug 2011 10:56:34 +0100
Subject: [rabbitmq-discuss] Problem auto-deleting large number of queues?
In-Reply-To: <12E00006-45F2-44B2-9791-1B40CF90CA51@plaxo.com>
References: <307D53C5-2C47-4B07-8561-8A6608C18A24@plaxo.com>
	<4E58FF67.4030400@rabbitmq.com> <4E590A9A.7010105@rabbitmq.com>
	<12E00006-45F2-44B2-9791-1B40CF90CA51@plaxo.com>
Message-ID: <4E5A10D2.3090706@rabbitmq.com>

(adding the list back on cc)

On 28/08/11 09:37, Michael Chiang wrote:
> We have some front end servers serving a bunch of clients through tcp
> connections.  Each server can serve around 10k clients.  A client can
> be online and connected to a server  for hours, and then go offline
> for hours as well.  The clients might move around servers between
> each session.  Also, we might want to be able to persist messages
> when client goes offline for certain messages.  I am exploring
> options to route messages to a client.  One idea is to have a
> connection between our server and a rabbitmq server, and have one
> queue for each client (with client id as a routing key), and hence
> this particular test.

So the 10 connections in your test simulate the connections from the f/e 
server, and the 20k queues per connections is the number of clients 
connected to that server? If so, surely having the queues exclusively 
owned would prevent clients from moving between f/e servers. You may 
want to look at the "queue leases" feature 
(http://www.rabbitmq.com/extensions.html#queue-leases).

Regards,

Matthias.

From matthias at rabbitmq.com  Sun Aug 28 11:04:06 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 28 Aug 2011 11:04:06 +0100
Subject: [rabbitmq-discuss] Problem auto-deleting large number of queues?
In-Reply-To: <352EE030-3FC7-45C7-92D1-C30EDB5EB937@plaxo.com>
References: <307D53C5-2C47-4B07-8561-8A6608C18A24@plaxo.com>
	<4E58FF67.4030400@rabbitmq.com>
	<352EE030-3FC7-45C7-92D1-C30EDB5EB937@plaxo.com>
Message-ID: <4E5A1296.6000705@rabbitmq.com>

Michael,

On 28/08/11 09:14, Michael Chiang wrote:
> The consumers are terminated in parallel but not simultaneously (ie,
> there might be a few sec of difference between each terminations).

That could make all the difference.

>> Is there a difference between using one connection with 200k queues
>> vs 10 connections with 20k queues each?
>
> You might be on to something :).  I just ran my test client with one
> connection with 200k queue.  In this case, even with graceful
> shutdown, I am running into the auto-deleting issues.

I think you'll find that the termination time increases quadratically 
with the number of queues. Needless to say we'll need to fix that.

Matthias.

From iconara at gmail.com  Sun Aug 28 11:23:14 2011
From: iconara at gmail.com (Theo)
Date: Sun, 28 Aug 2011 03:23:14 -0700 (PDT)
Subject: [rabbitmq-discuss] Nodes loosing contact with the cluster,
	using 2.5.1
Message-ID: <375b1333-5a59-452e-82d1-fd671b9a18d7@d18g2000yqm.googlegroups.com>

Hi,

We've used RabbitMQ 2.3.x and 2.4.x in production for a while and
haven't had too much trouble. Last week we set up a new cluster with
2.5.1 that will be used for the next version of our system. However,
we've had a lot of issues where it looks like one or more nodes are
down, but in fact they've just lost contact with the cluster.
Connecting to them works fine, but they don't know about the rest of
the cluster. Restarting the nodes makes them join the cluster again.

How can we avoid this?

yours,
Theo

From michael.s.klishin at gmail.com  Sun Aug 28 19:07:07 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sun, 28 Aug 2011 22:07:07 +0400
Subject: [rabbitmq-discuss] [announcement] amqp gem 0.8.0.rc15 is released,
 very likely to be the last RC before 0.8.0 final
Message-ID: <CAE3HoVQYyDiyOdc+YuuQ=A5Caij5ZWOjMq8BKoX_x7wTrSrEZg@mail.gmail.com>

amqp gem 0.8.0.RC15 is released to rubygems.org. All 0.8.0.RCs users are
highly encouraged to upgrade
because this is likely to be the last RC before 0.8.0.

== Backwards compatibility with RC14

0.8.0.RC15 is fully backwards compatible with RC14.



== Bug fixes

RC15 includes one bug fix:

* TCP connection is now properly upgraded to TLS (if needed) when clients
reconnects to the broker after network failures.



== Other features & API usability improvements

One improvement:

* AMQP::Session#on_skipped_heartbeats event handler can be defined to handle
situations when client detects skipped
  broker heartbeats. Please note that only applications that need really
timely reaction to network
  failures will ever use this. For other cases,
AMQP::Session#on_tcp_connection_failure event handler is good enough.



== Documentation improvements

As usual, we keep improving my favorite amqp gem feature: documentation (
http://bit.ly/amqp-gem-docs).

* Vendor-specific extensions guide now covers per-queue TTL, Publisher
Confirmations and Alternate Exchanges.
* Bindings guide now explains how message routing is done and takes a closer
look at cases when messages may be returned back to the publisher.
* Numerous small improvements to all other guides & code examples.
* AMQP 0.9.1 Model Explained guide license now covers images & stylesheets.


== The Road to 0.8.0

RC15 is (hopefully) the last RC before 0.8.0. If no major issues are
reported, 0.8.0 will be released in one week, on
September 4th, 2011.

Note that Ruby 1.8.7-p249 (this particular patch level) compatibility
refactoring turns out to be a significant
undertaking and I decided it is not worth the effort. We would rather spend
our time improving documentation and adding new features
than refactoring half of the library to work around one bug in one
particular Ruby 1.8.7 release.

So, try this RC out and have a good end of the week.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110828/7eb8b265/attachment.htm>

From videlalvaro at gmail.com  Mon Aug 29 00:08:21 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Mon, 29 Aug 2011 01:08:21 +0200
Subject: [rabbitmq-discuss] Measuring RabbitMQ performance
Message-ID: <0C13F4DB-F3C7-462E-8663-9AE783ACF3F3@gmail.com>

Hi,

I've been reading blog posts like the following one from the RabbitMQ website: 

http://www.rabbitmq.com/blog/2010/09/14/very-fast-and-scalable-topic-routing-part-1/

Which was the program/library used to measure the performance there?

What did you use to create those graphs?

Thanks,

Alvaro

From mchiang at plaxo.com  Mon Aug 29 06:32:25 2011
From: mchiang at plaxo.com (Michael Chiang)
Date: Mon, 29 Aug 2011 05:32:25 +0000
Subject: [rabbitmq-discuss] Problem auto-deleting large number of queues?
In-Reply-To: <4E5A10D2.3090706@rabbitmq.com>
References: <307D53C5-2C47-4B07-8561-8A6608C18A24@plaxo.com>
	<4E58FF67.4030400@rabbitmq.com> <4E590A9A.7010105@rabbitmq.com>
	<12E00006-45F2-44B2-9791-1B40CF90CA51@plaxo.com>
	<4E5A10D2.3090706@rabbitmq.com>
Message-ID: <2E0D4166-4529-4D9E-A825-2F179FD70FA5@plaxo.com>

Ahhh ... you are right, I don't need queues to be exclusive (They were made default without me giving too much thought to it).  And better yet, without making queues exclusive, the auto-deleting issues since to be going away.  Thanks for the help!

Michael

On Aug 28, 2011, at 2:56 AM, Matthias Radestock wrote:

> (adding the list back on cc)
> 
> On 28/08/11 09:37, Michael Chiang wrote:
>> We have some front end servers serving a bunch of clients through tcp
>> connections.  Each server can serve around 10k clients.  A client can
>> be online and connected to a server  for hours, and then go offline
>> for hours as well.  The clients might move around servers between
>> each session.  Also, we might want to be able to persist messages
>> when client goes offline for certain messages.  I am exploring
>> options to route messages to a client.  One idea is to have a
>> connection between our server and a rabbitmq server, and have one
>> queue for each client (with client id as a routing key), and hence
>> this particular test.
> 
> So the 10 connections in your test simulate the connections from the f/e server, and the 20k queues per connections is the number of clients connected to that server? If so, surely having the queues exclusively owned would prevent clients from moving between f/e servers. You may want to look at the "queue leases" feature (http://www.rabbitmq.com/extensions.html#queue-leases).
> 
> Regards,
> 
> Matthias.


From mattilinn at gmail.com  Mon Aug 29 07:57:11 2011
From: mattilinn at gmail.com (Matti Linnanvuori)
Date: Sun, 28 Aug 2011 23:57:11 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ crashes
Message-ID: <4ac15a19-9ba7-41b2-bb0a-5f72296da7af@a12g2000yqi.googlegroups.com>

RabbitMQ no longer responds to queries and /etc/init.d/rabbitmq-server
stop hung. RabbitMQ version is 2.5.1. SUSE Linux Enterprise Server 11
SP1.

uname -a
Linux iac-pgis 2.6.32.36-0.5-default #1 SMP 2011-04-14 10:12:31 +0200
x86_64 x86_64 x86_64 GNU/Linux

/etc/init.d/rabbitmq-server status

Status of node 'rabbit at iac-pgis' ...
[{pid,2770},
 {running_applications,[{os_mon,"CPO  CXC 138 46","2.2.6"},
                        {sasl,"SASL  CXC 138 11","2.1.9.4"},
                        {mnesia,"MNESIA  CXC 138 12","4.4.19"},
                        {stdlib,"ERTS  CXC 138 10","1.17.4"},
                        {kernel,"ERTS  CXC 138 10","2.14.4"}]},
 {os,{unix,linux}},
 {erlang_version,"Erlang R14B03 (erts-5.8.4) [source] [64-bit] [rq:1]
[async-threads:30] [hipe] [kernel-poll:true]\n"},
 {memory,[{total,96861600},
          {processes,10802024},
          {processes_used,10792904},
          {system,86059576},
          {atom,1113929},
          {atom_used,1104932},
          {binary,734480},
          {code,11023444},
          {ets,71867888}]}]
...done.

rabbit at iac-pgis-sasl.log is the following:
=CRASH REPORT==== 29-Aug-2011::14:27:43 ===
  crasher:
    initial call: gen:init_it/6
    pid: <0.118.0>
    registered_name: []
    exception exit: {{badmatch,eof},
                     [{rabbit_queue_index,load_segment,2},
                      {rabbit_queue_index,segment_entries_foldr,3},
                      {rabbit_queue_index,
                          '-queue_index_walker_reader/2-lc$^0/1-0-',
4},
                      {rabbit_queue_index,queue_index_walker_reader,
2},
                      {worker_pool_worker,handle_cast,2},
                      {gen_server2,handle_msg,2},
                      {proc_lib,init_p_do_apply,3}]}
      in function  gen_server2:terminate/3
    ancestors: [worker_pool_sup,rabbit_sup,<0.106.0>]
    messages: []
    links: [#Port<0.2307>,<0.115.0>,#Port<0.2274>]
    dictionary: [{{#Ref<0.0.0.35370>,fhc_handle},
                   {handle,{file_descriptor,prim_file,{#Port<0.2307>,
18}},
                           0,0,false,0,0,[],true,
                           "/var/lib/rabbitmq/mnesia/rabbit at iac-pgis/
queues/66AS0RWVNJTRSJ1ZWY9DKL71X/139.idx",
                           [{read_ahead,491520},binary,raw,read],
                           [],false,true,
                           {1314,624463,414214}}},
                  {{"/var/lib/rabbitmq/mnesia/rabbit at iac-pgis/queues/
66AS0RWVNJTRSJ1ZWY9DKL71X/journal.jif",
                    fhc_file},
                   {file,1,true}},
                  {worker_pool_worker,true},
                  {{"/var/lib/rabbitmq/mnesia/rabbit at iac-pgis/queues/
66AS0RWVNJTRSJ1ZWY9DKL71X/139.idx",
                    fhc_file},
                   {file,1,false}},
                  {fhc_age_tree,{2,
                                 {{1314,624458,952622},
                                  #Ref<0.0.0.7784>,nil,
                                  {{1314,624463,414214},
                                   #Ref<0.0.0.35370>,nil,nil}}}},
                  {{#Ref<0.0.0.7784>,fhc_handle},
                   {handle,{file_descriptor,prim_file,{#Port<0.2274>,
17}},
                           0,0,false,0,infinity,[],true,
                           "/var/lib/rabbitmq/mnesia/rabbit at iac-pgis/
queues/66AS0RWVNJTRSJ1ZWY9DKL71X/journal.jif",
                           [write,binary,raw,read],
                           [{write_buffer,infinity}],
                           true,true,
                           {1314,624458,952622}}}]
    trap_exit: false
    status: running
    heap_size: 514229
    stack_size: 24
    reductions: 18980671
  neighbours:

=SUPERVISOR REPORT==== 29-Aug-2011::14:27:43 ===
     Supervisor: {local,worker_pool_sup}
     Context:    child_terminated
     Reason:     {{badmatch,eof},
                  [{rabbit_queue_index,load_segment,2},
                   {rabbit_queue_index,segment_entries_foldr,3},
                   {rabbit_queue_index,
                       '-queue_index_walker_reader/2-lc$^0/1-0-',4},
                   {rabbit_queue_index,queue_index_walker_reader,2},
                   {worker_pool_worker,handle_cast,2},
                   {gen_server2,handle_msg,2},
                   {proc_lib,init_p_do_apply,3}]}
     Offender:   [{pid,<0.118.0>},
                  {name,1},
                  {mfargs,{worker_pool_worker,start_link,[1]}},
                  {restart_type,transient},
                  {shutdown,4294967295},
                  {child_type,worker}]

rabbit at iac-pgis.log is the following:

=INFO REPORT==== 29-Aug-2011::14:27:37 ===
Limiting to approx 924 file handles (829 sockets)

=INFO REPORT==== 29-Aug-2011::14:27:37 ===
Memory limit set to 210MB.

=INFO REPORT==== 29-Aug-2011::14:27:37 ===
msg_store_transient: using rabbit_msg_store_ets_index to provide index

=INFO REPORT==== 29-Aug-2011::14:27:37 ===
msg_store_persistent: using rabbit_msg_store_ets_index to provide
index

=WARNING REPORT==== 29-Aug-2011::14:27:37 ===
msg_store_persistent: rebuilding indices from scratch

=ERROR REPORT==== 29-Aug-2011::14:27:43 ===
** Generic server <0.118.0> terminating
** Last message in was {'$gen_cast',
                           {submit_async,
                               #Fun<rabbit_queue_index.24.55115249>}}
** When Server state == 1
** Reason for termination ==
** {{badmatch,eof},
    [{rabbit_queue_index,load_segment,2},
     {rabbit_queue_index,segment_entries_foldr,3},
     {rabbit_queue_index,'-queue_index_walker_reader/2-lc$^0/1-0-',4},
     {rabbit_queue_index,queue_index_walker_reader,2},
     {worker_pool_worker,handle_cast,2},
     {gen_server2,handle_msg,2},
     {proc_lib,init_p_do_apply,3}]}


From matthew at rabbitmq.com  Mon Aug 29 11:43:45 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 29 Aug 2011 11:43:45 +0100
Subject: [rabbitmq-discuss] RabbitMQ crashes
In-Reply-To: <4ac15a19-9ba7-41b2-bb0a-5f72296da7af@a12g2000yqi.googlegroups.com>
References: <4ac15a19-9ba7-41b2-bb0a-5f72296da7af@a12g2000yqi.googlegroups.com>
Message-ID: <20110829104344.GA2979@rabbitmq.com>

Hi Matti,

Well I'm not sure why it's not stopping - I'd have expected it to crash
in a large ball of fire at this point.

On Sun, Aug 28, 2011 at 11:57:11PM -0700, Matti Linnanvuori wrote:
>     exception exit: {{badmatch,eof},
>                      [{rabbit_queue_index,load_segment,2},
>                       {rabbit_queue_index,segment_entries_foldr,3},
>                       {rabbit_queue_index,
>                           '-queue_index_walker_reader/2-lc$^0/1-0-',
> 4},
>                       {rabbit_queue_index,queue_index_walker_reader,
> 2},
>                       {worker_pool_worker,handle_cast,2},

It's actually got seriously upset on start up. It looks like some file
corruption occurred last time it was running or on shut down - it may be
as simple as it ran out of disk space, but equally it may point at other
issues. As a result, on start up, it's trying to read off disk the
various contents of queues, and it's unexpectedly reaching the end of a
file before. Now it's probably a bug that Rabbit doesn't continue
regardless in this situation and certainly the "up but not working"
state that you've reached is not a design goal. Really, at this point,
I'd suggest you kill off rabbit, wipe out its database directory (which
will wipe out all msgs and queues on disk) and then start from a clean
slate. That will lose you all msgs on disk, but at this point, I'm not
sure how much could be recovered anyway.

Can you think of any point at which you may have run out of disk space,
or there's been faulty hardware or file system corruption?

Matthew

From dominic at rightscale.com  Mon Aug 29 16:09:00 2011
From: dominic at rightscale.com (Dominic Metzger)
Date: Mon, 29 Aug 2011 08:09:00 -0700
Subject: [rabbitmq-discuss] missing header frame
In-Reply-To: <CAE3HoVR7iqthSvUi49b-GS=y5+m_JyuKDdLKrL8DTZ1oRL_eVQ@mail.gmail.com>
References: <CAH00K+PiJ5O_F8FhwPQoQ3pHahBu4iyMDr7GO4CgnvMvbRMN8g@mail.gmail.com>
	<CAE3HoVR7iqthSvUi49b-GS=y5+m_JyuKDdLKrL8DTZ1oRL_eVQ@mail.gmail.com>
Message-ID: <CAH00K+Pm_tajQbB9DwMo=ZsSxmyUY3br3621hnq+UGdEymPgyg@mail.gmail.com>

Thank you for your response... I upgraded to a newer RabbitMQ and haven't
seen these issues since.

thanks

dominic

On Thu, Aug 18, 2011 at 9:39 PM, Michael Klishin <
michael.s.klishin at gmail.com> wrote:

> 2011/8/19 Dominic Metzger <dominic at rightscale.com>
>
>> Is there a valid case when I wouldn't receive a header frame? Does it have
>> something to do with the redelivery of the message? I am seeing this on
>> RabbitMQ version (v1.7.2).
>>
>> Example:
>>
>> ["receive",
>>  #<AMQP::Frame::Method:0x11d58b24
>>   @channel=1,
>>   @payload=
>>    #<AMQP::Protocol::Basic::Deliver:0x11d58660
>>     @consumer_tag="example.com-events--588378867313",
>>     @debug=1,
>>     @delivery_tag=7700,
>>     @exchange="events",
>>     @redelivered=true,
>>     @routing_key="">>]
>>
>> ["receive",
>>  #<AMQP::Frame::Body:0x11aa54f4
>>   @channel=1,
>>   @payload=
>>    "{\"timestamp\":1313535484445309}">]
>>
>>
>> thanks & best regards
>>
>
> I haven't read AMQP 0.8 spec (which is what amqp gem before 0.8.0.RCs
> implements) in a while but I cannot think of a case when the header may be
> missing. My only suggestion is to not rely on "logging" of various clients
> because they use different frame class names, framing strategies and so on.
> Use Wireshark, it will tell you what is really going up and down the wire.
> And, maybe upgrade to RabbitMQ 2.5.1 that still supports AMQP 0.8 as well as
> AMQP 0.9.1.
>
> --
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110829/7d0a11a8/attachment.htm>

From john.jeffers at gmail.com  Mon Aug 29 21:31:50 2011
From: john.jeffers at gmail.com (John Jeffers)
Date: Mon, 29 Aug 2011 13:31:50 -0700 (PDT)
Subject: [rabbitmq-discuss] HA - queues do not move?
Message-ID: <2d54b36f-b377-45b7-80a0-dc1c8ca0a6ee@b20g2000vbz.googlegroups.com>

(I'm new to Rabbit, so please forgive me if this is a dumb question)

I followed the instructions at http://www.rabbitmq.com/pacemaker.html
to build a two-node HA environment.  My nodes are RabbitMQ 2.5.1 on
CentOS 6 64-bit, and I'm using a network share for shared storage
instead of DRBD.

The nodes failover just fine, and most things seem to be working as
expected, however, I've noticed that when I take Node 1 down and it
fails over to Node 2, the queues and messages on Node 1 do not move to
Node 2.  Is this expected behavior?  I expected that the point of the
shared storage would be so that messages would not be lost in the
event of a failover, but maybe my expectations are incorrect?

Thanks for any info you can offer.

From iconara at gmail.com  Tue Aug 30 05:58:06 2011
From: iconara at gmail.com (Theo)
Date: Mon, 29 Aug 2011 21:58:06 -0700 (PDT)
Subject: [rabbitmq-discuss] Nodes loosing contact with the cluster,
	using 2.5.1
In-Reply-To: <375b1333-5a59-452e-82d1-fd671b9a18d7@d18g2000yqm.googlegroups.com>
References: <375b1333-5a59-452e-82d1-fd671b9a18d7@d18g2000yqm.googlegroups.com>
Message-ID: <858867e0-f49c-4a6c-b4e1-e42d86d3603a@s20g2000yql.googlegroups.com>

We downgraded to 2.4.1 and haven't had any issues. With 2.5.1 the
cluster split would happen several times per day, but since
downgrading it hasn't happend once.

T#

On Aug 28, 12:23?pm, Theo <icon... at gmail.com> wrote:
> Hi,
>
> We've used RabbitMQ 2.3.x and 2.4.x in production for a while and
> haven't had too much trouble. Last week we set up a new cluster with
> 2.5.1 that will be used for the next version of our system. However,
> we've had a lot of issues where it looks like one or more nodes are
> down, but in fact they've just lost contact with the cluster.
> Connecting to them works fine, but they don't know about the rest of
> the cluster. Restarting the nodes makes them join the cluster again.
>
> How can we avoid this?
>
> yours,
> Theo
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthias at rabbitmq.com  Tue Aug 30 10:40:16 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 30 Aug 2011 10:40:16 +0100
Subject: [rabbitmq-discuss] Collecting message metrics?
In-Reply-To: <CAJreXKBohv=VyLaNTQ0asX2_gZCvsYLyrPz_M1nuWSuHd5B67A@mail.gmail.com>
References: <CAJreXKAoiveu-YFT9Eeu_=VRbvt5CsvOWYxGN+wvf_u1f7Yqrw@mail.gmail.com>
	<CAJreXKBohv=VyLaNTQ0asX2_gZCvsYLyrPz_M1nuWSuHd5B67A@mail.gmail.com>
Message-ID: <4E5CB000.60208@rabbitmq.com>

James,

On 24/08/11 16:53, James Carr wrote:
> I'm wondering if there are some "total metrics" that can be captured by
> rabbitm or the mgmt plugin.

Not at the moment, but this is on our todo list.

The API actually reports totals, but these are just aggregates of 
lower-level stats, so, for example, when a connection is closed its 
contribution to the total number of published messages reported in 
/api/overview is discarded.


Regards,

Matthias.

From matthew at rabbitmq.com  Tue Aug 30 12:37:47 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 30 Aug 2011 12:37:47 +0100
Subject: [rabbitmq-discuss] Nodes loosing contact with the cluster,
 using 2.5.1
In-Reply-To: <858867e0-f49c-4a6c-b4e1-e42d86d3603a@s20g2000yql.googlegroups.com>
References: <375b1333-5a59-452e-82d1-fd671b9a18d7@d18g2000yqm.googlegroups.com>
	<858867e0-f49c-4a6c-b4e1-e42d86d3603a@s20g2000yql.googlegroups.com>
Message-ID: <20110830113746.GA14864@rabbitmq.com>

On Mon, Aug 29, 2011 at 09:58:06PM -0700, Theo wrote:
> We downgraded to 2.4.1 and haven't had any issues. With 2.5.1 the
> cluster split would happen several times per day, but since
> downgrading it hasn't happend once.

This is odd. Do you happen to have the broker logs from when you were
running on 2.5.1 and these splits happen (from all members of the
cluster). Maybe send them to us off list if they're big. I'm curious to
see what the entries are. We can think of some changes we made, but we
certainly weren't expecting them to make clusters more fragile.

Matthew

From matthew at rabbitmq.com  Tue Aug 30 12:50:32 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 30 Aug 2011 12:50:32 +0100
Subject: [rabbitmq-discuss] queue gets removed from a node
In-Reply-To: <4E563B8B.6000704@thebestisp.co.uk>
References: <4E563B8B.6000704@thebestisp.co.uk>
Message-ID: <20110830115031.GB14864@rabbitmq.com>

Hi Cezary,

On Thu, Aug 25, 2011 at 01:09:47PM +0100, Cezary Siwek wrote:
> I'm facing an issue with my rabittmq cluster where a queue
> disappears from a node.
> I have 2 nodes in a cluster working in "disk mode".
> Node1 - only consumes messages from the queue.
> Node2 - only publishes messages to the queue.
> 
> The consumer script on Node1 creates a durable queue and waits for
> messages.
> Everything works fine until some no-activity time. I can't say how
> long it needs to be but usually after more than 24h the queue
> disappears from Node2 and the consumer stops receiving messages. The
> list_queues command shows the queue exists on Node1 but not on
> Node2.
> I've done a packet trace when it happened and I can see some packets
> are being exchanged between nodes. Also cluster_status commands
> shows that both nodes are up and running in the cluster.
> When I try to declare_queue on the Node2 i get 'NOT_FOUND - no queue
> 'msgs' in vhost '/vhost1'.
> All I need to do to have the Node2 running is to run stop_app and start_app.
> 
> Both nodes are sitting behind firewalls (in separate networks) but
> both firewalls have been granted to pass all the traffic between
> these two boxes.
> It happens on my dev platfrom. On production I don't think I will
> ever have such long quiet periods but I need to find out what is
> causing this.

Hmm, this is odd. It suggests that the two nodes have lost contact with
each other which is why Node2 is responding with the NOT_FOUND when you
try to redeclare the queue. However, if at this point the cluster_status
on both nodes is suggesting everything is clustered and happy, then this
is very odd indeed. Could you check that you can achieve these sets of
circumstances?

Also, do you have the logs for both nodes during the no-activity time?
I'm curious whether there are entries in there that suggest the cluster
has split apart. If they're large, then maybe send them to us off-list.

Matthew

From jonathan.hursey at adrevolution.com  Tue Aug 30 15:42:39 2011
From: jonathan.hursey at adrevolution.com (Jonathan Hursey)
Date: Tue, 30 Aug 2011 09:42:39 -0500
Subject: [rabbitmq-discuss] queue gets removed from a node
In-Reply-To: <20110830115031.GB14864@rabbitmq.com>
References: <4E563B8B.6000704@thebestisp.co.uk>
	<20110830115031.GB14864@rabbitmq.com>
Message-ID: <CAEw+mRfDB9kV8qWsu4t8nDWXJXU_7NEtHAh1s-Ntg=zsY4BZyQ@mail.gmail.com>

Is the queue set to be durable?

On Tue, Aug 30, 2011 at 6:50 AM, Matthew Sackman <matthew at rabbitmq.com>wrote:

> Hi Cezary,
>
> On Thu, Aug 25, 2011 at 01:09:47PM +0100, Cezary Siwek wrote:
> > I'm facing an issue with my rabittmq cluster where a queue
> > disappears from a node.
> > I have 2 nodes in a cluster working in "disk mode".
> > Node1 - only consumes messages from the queue.
> > Node2 - only publishes messages to the queue.
> >
> > The consumer script on Node1 creates a durable queue and waits for
> > messages.
> > Everything works fine until some no-activity time. I can't say how
> > long it needs to be but usually after more than 24h the queue
> > disappears from Node2 and the consumer stops receiving messages. The
> > list_queues command shows the queue exists on Node1 but not on
> > Node2.
> > I've done a packet trace when it happened and I can see some packets
> > are being exchanged between nodes. Also cluster_status commands
> > shows that both nodes are up and running in the cluster.
> > When I try to declare_queue on the Node2 i get 'NOT_FOUND - no queue
> > 'msgs' in vhost '/vhost1'.
> > All I need to do to have the Node2 running is to run stop_app and
> start_app.
> >
> > Both nodes are sitting behind firewalls (in separate networks) but
> > both firewalls have been granted to pass all the traffic between
> > these two boxes.
> > It happens on my dev platfrom. On production I don't think I will
> > ever have such long quiet periods but I need to find out what is
> > causing this.
>
> Hmm, this is odd. It suggests that the two nodes have lost contact with
> each other which is why Node2 is responding with the NOT_FOUND when you
> try to redeclare the queue. However, if at this point the cluster_status
> on both nodes is suggesting everything is clustered and happy, then this
> is very odd indeed. Could you check that you can achieve these sets of
> circumstances?
>
> Also, do you have the logs for both nodes during the no-activity time?
> I'm curious whether there are entries in there that suggest the cluster
> has split apart. If they're large, then maybe send them to us off-list.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110830/d094ed79/attachment.htm>

From matthew at rabbitmq.com  Tue Aug 30 15:44:37 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 30 Aug 2011 15:44:37 +0100
Subject: [rabbitmq-discuss] queue gets removed from a node
In-Reply-To: <CAEw+mRfDB9kV8qWsu4t8nDWXJXU_7NEtHAh1s-Ntg=zsY4BZyQ@mail.gmail.com>
References: <4E563B8B.6000704@thebestisp.co.uk>
	<20110830115031.GB14864@rabbitmq.com>
	<CAEw+mRfDB9kV8qWsu4t8nDWXJXU_7NEtHAh1s-Ntg=zsY4BZyQ@mail.gmail.com>
Message-ID: <20110830144437.GI14864@rabbitmq.com>

On Tue, Aug 30, 2011 at 09:42:39AM -0500, Jonathan Hursey wrote:
> Is the queue set to be durable?

Yes - that's in the original email...

> > On Thu, Aug 25, 2011 at 01:09:47PM +0100, Cezary Siwek wrote:
> > > The consumer script on Node1 creates a durable queue and waits for
> > > messages.

Matthew

From czarek at thebestisp.co.uk  Tue Aug 30 16:06:03 2011
From: czarek at thebestisp.co.uk (Cezary Siwek)
Date: Tue, 30 Aug 2011 16:06:03 +0100
Subject: [rabbitmq-discuss] queue gets removed from a node
In-Reply-To: <20110830115031.GB14864@rabbitmq.com>
References: <4E563B8B.6000704@thebestisp.co.uk>
	<20110830115031.GB14864@rabbitmq.com>
Message-ID: <4E5CFC5B.2010801@thebestisp.co.uk>



On 30/08/2011 12:50, Matthew Sackman wrote:
> Hi Cezary,
>
> On Thu, Aug 25, 2011 at 01:09:47PM +0100, Cezary Siwek wrote:
>> I'm facing an issue with my rabittmq cluster where a queue
>> disappears from a node.
>> I have 2 nodes in a cluster working in "disk mode".
>> Node1 - only consumes messages from the queue.
>> Node2 - only publishes messages to the queue.
>>
>> The consumer script on Node1 creates a durable queue and waits for
>> messages.
>> Everything works fine until some no-activity time. I can't say how
>> long it needs to be but usually after more than 24h the queue
>> disappears from Node2 and the consumer stops receiving messages. The
>> list_queues command shows the queue exists on Node1 but not on
>> Node2.
>> I've done a packet trace when it happened and I can see some packets
>> are being exchanged between nodes. Also cluster_status commands
>> shows that both nodes are up and running in the cluster.
>> When I try to declare_queue on the Node2 i get 'NOT_FOUND - no queue
>> 'msgs' in vhost '/vhost1'.
>> All I need to do to have the Node2 running is to run stop_app and start_app.
>>
>> Both nodes are sitting behind firewalls (in separate networks) but
>> both firewalls have been granted to pass all the traffic between
>> these two boxes.
>> It happens on my dev platfrom. On production I don't think I will
>> ever have such long quiet periods but I need to find out what is
>> causing this.
> Hmm, this is odd. It suggests that the two nodes have lost contact with
> each other which is why Node2 is responding with the NOT_FOUND when you
> try to redeclare the queue. However, if at this point the cluster_status
> on both nodes is suggesting everything is clustered and happy, then this
> is very odd indeed. Could you check that you can achieve these sets of
> circumstances?
>
> Also, do you have the logs for both nodes during the no-activity time?
> I'm curious whether there are entries in there that suggest the cluster
> has split apart. If they're large, then maybe send them to us off-list.
>
>



Hi Matthew,

Thanks for your response.

Yes, you are right. This happens when the nodes become unavailable.
I have reproduced the issue by breaking up the link between two nodes. 
The queue on node2 gets deleted when the node1 becomes unavailable. I 
was wrong saying the cluster_status commands shows that cluster is up 
and running. In fact, two nodes stay detached until stop_app/start_app 
executed.

I know that rabbitmq cluster is not designed to work on unreliable links 
but is it a correct behavior when a queue gets deleted from the node? At 
least the node should allow producer to re-create the queue and keep all 
the messages until connection between nodes is back up.
Is there any way to re-establish connection between two nodes when the 
link goes up?


Regards,







From Max.Haventon at westbahr.com  Tue Aug 30 16:39:41 2011
From: Max.Haventon at westbahr.com (Max Haventon)
Date: Tue, 30 Aug 2011 17:39:41 +0200
Subject: [rabbitmq-discuss] Troubleshooting Shovel 2.5.1 on Windows
Message-ID: <9BF154F8980FA146862120CBA8BDDE3E91EBEC6D66@burre.westbahr.local>

According to the Shovel readme:

"From the broker Erlang prompt, call rabbit_shovel_status:status(). This will return a list, with one row for each configured shovel."

However, using the Erlang prompt (C:\Program Files (x86)\erl5.8.4\bin\werl.exe in my case) I get:

1> rabbit_shovel_status:status().
** exception error: undefined function rabbit_shovel_status:status/0

Anyone with Erlang/Windows/RabbitMQ-experience that recognizes this issue?

From rparra at homeaway.com  Tue Aug 30 17:07:36 2011
From: rparra at homeaway.com (Rene Parra)
Date: Tue, 30 Aug 2011 11:07:36 -0500
Subject: [rabbitmq-discuss] Cluster Disk Node vs Ram Node explanation
Message-ID: <CA8274F8.EBE9%rparra@homeaway.com>

I know this has probably been discussed at length in this list and
elsewhere.

Reference:
http://groups.google.com/group/rabbitmq-discuss/msg/baa8f8b30ba423e0

I just want to clarify:

GIVEN:
* A load balanced cluster consisting of disk node A, ram node B, and ram
node C

WHEN:
* A client is routed to ram node B via the load balancer,
* AND the client declares a durable queue on its connection to ram node B,
* AND the client declares bindings to a topic exchange being serviced by a
producer connected on ram node C;

WHERE are the messages stored?
WHAT happens to the producer on ram node C when ram node B fails? (Does it
block? Do messages continue to be delivered? Are messages to the client
lost?)

POSSIBLE ANSWERS:

A) Messages are stored on disk node A but served up through ram node B.
If ram node B goes down, messages are preserved and when the client
reconnects on any node, the messages can be retrieved.  Since the messages
are stored on disk node A, the producer connected on ram node C continues to
publish messages to its topic exchange without blocking.

B) They are stored on disk for ram node B. If ram node B goes down, the
queue is unavailable for delivery, the producer on ram node C blocks on
publishing of messages until ram node B comes back up again. (I?m assuming
metadata of the network is shared by the cluster therefore ram node C,
?knows? it has bindings to a durable queue on node B, which is unresponsive,
so it blocks).

C) They are not stored on disk for ram node B (unless under memory
pressure).  Any messages in memory are lost. C does not block on publishing
of messages, but continues to publish messages to topic exchange. Bindings
are non-existent until ram node B comes back up again, or the client
reconnects/redeclares durable queue on another node for servicing.

D) Something else?

My inclination is to say A) is the right answer above.

However, I just finished a soak test where my durable queue on ram node B
lost messages over the weekend due to a network hiccup that crashed ram node
B. When it came back up again messages were lost.  As such, we are
recommending our production configuration to be unclustered, disk node only
until we better understand the benefits and use cases associated with
clustering with RabbitMQ 2.5.1

A simple tutorial or explanation of ?To Disk Node or To Ram Node... that is
the question? would be great and useful for those of us implementing,
learning and teaching rabbit to our organizations.

Regards,
--rparra


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110830/44f59213/attachment.htm>

From Max.Haventon at westbahr.com  Tue Aug 30 23:04:23 2011
From: Max.Haventon at westbahr.com (Max Haventon)
Date: Wed, 31 Aug 2011 00:04:23 +0200
Subject: [rabbitmq-discuss] Troubleshooting Shovel 2.5.1 on Windows
Message-ID: <9BF154F8980FA146862120CBA8BDDE3E91EBEC6D79@burre.westbahr.local>

I found an answer in one of the IRC log archives:

http://dev.rabbitmq.com/irclog/index.php?date=2011-05-27 (at time 15:33)

However, I did not manage to connect the Erlang prompt to the remote node (?) using erl.exe as described. What did work was:

c:\Program Files (x86)\erl5.8.4\erts-5.8.4\bin>werl -sname anything -remsh rabbit at hostname (note that the hostname must be *exactly* as it's listed by rabbitmqctl status, case matters. localhost did not work in my case)

Using the werl prompt, commands like rabbit:status(). And rabbit_shovel_status:status() work as intended.

Hope this helps someone else with this problem.


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110831/0105f4db/attachment.htm>

From otto.bergstrom at byburt.com  Wed Aug 31 09:20:14 2011
From: otto.bergstrom at byburt.com (=?ISO-8859-1?Q?Otto_Bergstr=F6m?=)
Date: Wed, 31 Aug 2011 01:20:14 -0700 (PDT)
Subject: [rabbitmq-discuss] Nodes loosing contact with the cluster,
	using 2.5.1
In-Reply-To: <20110830113746.GA14864@rabbitmq.com>
References: <375b1333-5a59-452e-82d1-fd671b9a18d7@d18g2000yqm.googlegroups.com>
	<858867e0-f49c-4a6c-b4e1-e42d86d3603a@s20g2000yql.googlegroups.com>
	<20110830113746.GA14864@rabbitmq.com>
Message-ID: <1111e06e-4a82-4926-9f5e-4fdfdd8a4e4d@bl1g2000vbb.googlegroups.com>

Below is the logs from one of the incidents when we lost one node in
the cluster. The cluster consists of four nodes (richmqcoll01-04)
where we lost richmqcoll01 in this case.  For some reason richmqcoll03
did not log in the relevant timeframe bur was working fine at the
time:

richmqcoll01:
accepted TCP connection on [::]:5672 from 10.226.186.111:53352

=INFO REPORT==== 28-Aug-2011::13:49:54 ===
starting TCP connection <0.31813.0> from 10.226.186.111:53352

=INFO REPORT==== 28-Aug-2011::14:56:23 ===
closing TCP connection <0.31813.0> from 10.226.186.111:53352

=INFO REPORT==== 28-Aug-2011::15:01:38 ===
accepted TCP connection on [::]:5672 from 10.226.186.111:44208

=INFO REPORT==== 28-Aug-2011::15:01:38 ===
starting TCP connection <0.25013.2> from 10.226.186.111:44208

=INFO REPORT==== 28-Aug-2011::15:07:24 ===
closing TCP connection <0.31378.0> from 10.50.45.170:44118

=INFO REPORT==== 28-Aug-2011::15:54:56 ===
Limiting to approx 924 file handles (829 sockets)

=INFO REPORT==== 28-Aug-2011::15:54:56 ===
Memory limit set to 6144MB.

=INFO REPORT==== 28-Aug-2011::15:54:56 ===
Management plugin upgraded statistics to fine.

=INFO REPORT==== 28-Aug-2011::15:54:56 ===
Statistics database started.

richmqcoll02:

=INFO REPORT==== 28-Aug-2011::15:07:24 ===
closing TCP connection <0.4958.0> from 10.50.45.170:38267

=ERROR REPORT==== 28-Aug-2011::15:22:48 ===
** Node rabbit at richmqcoll01 not responding **
** Removing (timedout) connection **

=INFO REPORT==== 28-Aug-2011::15:22:48 ===
node rabbit at richmqcoll01 lost 'rabbit'

=INFO REPORT==== 28-Aug-2011::15:22:56 ===
node rabbit at richmqcoll01 down

=INFO REPORT==== 28-Aug-2011::15:24:41 ===
closing TCP connection <0.24556.0> from 10.228.198.47:48365

=INFO REPORT==== 28-Aug-2011::15:26:17 ===
accepted TCP connection on [::]:5672 from 10.228.198.47:52734

=INFO REPORT==== 28-Aug-2011::15:26:17 ===
starting TCP connection <0.31303.0> from 10.228.198.47:52734

=INFO REPORT==== 28-Aug-2011::15:37:53 ===
closing TCP connection <0.31303.0> from 10.228.198.47:52734

=INFO REPORT==== 28-Aug-2011::15:40:27 ===
accepted TCP connection on [::]:5672 from 10.228.198.47:50746

=INFO REPORT==== 28-Aug-2011::15:40:27 ===
starting TCP connection <0.1085.1> from 10.228.198.47:50746

=INFO REPORT==== 28-Aug-2011::15:45:09 ===
closing TCP connection <0.1085.1> from 10.228.198.47:50746




richmqcoll04:

=INFO REPORT==== 28-Aug-2011::15:01:48 ===
starting TCP connection <0.26077.0> from 10.229.19.111:46298

=INFO REPORT==== 28-Aug-2011::15:07:24 ===
closing TCP connection <0.3174.0> from 10.50.45.170:53300

=ERROR REPORT==== 28-Aug-2011::15:22:53 ===
** Node rabbit at richmqcoll01 not responding **
** Removing (timedout) connection **

=INFO REPORT==== 28-Aug-2011::15:22:53 ===
node rabbit at richmqcoll01 lost 'rabbit'

=INFO REPORT==== 28-Aug-2011::15:23:00 ===
node rabbit at richmqcoll01 down

=INFO REPORT==== 28-Aug-2011::15:25:56 ===
closing TCP connection <0.26077.0> from 10.229.19.111:46298

=INFO REPORT==== 28-Aug-2011::15:26:24 ===
accepted TCP connection on [::]:5672 from 10.229.19.111:36640

=INFO REPORT==== 28-Aug-2011::15:26:24 ===
starting TCP connection <0.32399.0> from 10.229.19.111:36640

=INFO REPORT==== 28-Aug-2011::15:39:07 ===
closing TCP connection <0.32399.0> from 10.229.19.111:36640

=INFO REPORT==== 28-Aug-2011::15:40:35 ===
accepted TCP connection on [::]:5672 from 10.229.19.111:36442

=INFO REPORT==== 28-Aug-2011::15:40:35 ===
starting TCP connection <0.1863.1> from 10.229.19.111:36442

=INFO REPORT==== 28-Aug-2011::15:45:24 ===
closing TCP connection <0.1863.1> from 10.229.19.111:36442

=INFO REPORT==== 28-Aug-2011::15:55:12 ===
node rabbit at richmqcoll01 up

=INFO REPORT==== 28-Aug-2011::15:56:11 ===
accepted TCP connection on [::]:5672 from 10.229.19.111:59147

Otto

On Aug 30, 1:37?pm, Matthew Sackman <matt... at rabbitmq.com> wrote:
> On Mon, Aug 29, 2011 at 09:58:06PM -0700, Theo wrote:
> > We downgraded to 2.4.1 and haven't had any issues. With 2.5.1 the
> > cluster split would happen several times per day, but since
> > downgrading it hasn't happend once.
>
> This is odd. Do you happen to have the broker logs from when you were
> running on 2.5.1 and these splits happen (from all members of the
> cluster). Maybe send them to us off list if they're big. I'm curious to
> see what the entries are. We can think of some changes we made, but we
> certainly weren't expecting them to make clusters more fragile.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From iain.hull at workday.com  Wed Aug 31 10:46:02 2011
From: iain.hull at workday.com (Iain Hull)
Date: Wed, 31 Aug 2011 04:46:02 -0500
Subject: [rabbitmq-discuss] Java client Channel.Close blocking indefinitely
Message-ID: <925DDDE9D69E7143B3252E2D4680A367039E44CB@34093-C5-EVS1.exchange.rackspace.com>

Hi,

I hope you can help.  I am investigating the feasibility of deploying
RabbitMQ in our application.  Our chosen RabbitMQ deployment requires
lots of queues.  To maintain fairness across our application every
tenant requires their own set of queues, this is to ensure that one busy
tenant does not starve the others.  As a result am trying to find the
maximum number of queues RabbitMQ can support to ensure that we can
scale the number of tenants and logical queues.

During one of my tests a call to Channel.Close blocked and never
returned.  I have included the stack trace below.  Each iteration of my
test creates three tasks per queue which send 100 messages, send and
receive 100 messages and just receive 100 messages.  It was one of these
tasks that blocked up.  The code for my test is on
http://pastebin.com/LZTcpnzd.  (CountingCompletionService is a simple
decorator on a CompletionService, but the extra code is not currently
used).

Basically I would like to know am I doing anything wrong in my test, or
is this a bug in the client?  For example is it safe to call
Channel.close in a finally block after an exception was thrown?

I am not sure if this is relevant but I noticed some information in the
logs indicating that the memory high_watermark was hit around the time
the test stopped.

Regards,
Iain.




2011-08-31 08:38:20
Full thread dump Java HotSpot(TM) 64-Bit Server VM (19.1-b02 mixed
mode):

"pool-1-thread-1" prio=6 tid=0x0000000008304000 nid=0x15d4 in
Object.wait() [0x000000000925f000]
   java.lang.Thread.State: WAITING (on object monitor)
	at java.lang.Object.wait(Native Method)
	at java.lang.Object.wait(Object.java:485)
	at com.rabbitmq.utility.BlockingCell.get(BlockingCell.java:50)
	- locked <0x00000007d5d09968> (a
com.rabbitmq.utility.BlockingValueOrException)
	at com.rabbitmq.utility.BlockingCell.get(BlockingCell.java:65)
	- locked <0x00000007d5d09968> (a
com.rabbitmq.utility.BlockingValueOrException)
	at
com.rabbitmq.utility.BlockingCell.uninterruptibleGet(BlockingCell.java:1
11)
	- locked <0x00000007d5d09968> (a
com.rabbitmq.utility.BlockingValueOrException)
	at
com.rabbitmq.utility.BlockingValueOrException.uninterruptibleGetValue(Bl
ockingValueOrException.java:37)
	at
com.rabbitmq.client.impl.AMQChannel$BlockingRpcContinuation.getReply(AMQ
Channel.java:334)
	at com.rabbitmq.client.impl.ChannelN.close(ChannelN.java:466)
	at com.rabbitmq.client.impl.ChannelN.close(ChannelN.java:410)
	at com.rabbitmq.client.impl.ChannelN.close(ChannelN.java:403)
	at
com.workday.messaging.test.BreakRabbitBreakTest$AbstractMessageRunner.ca
ll(BreakRabbitBreakTest.java:141)
	at
com.workday.messaging.test.BreakRabbitBreakTest$AbstractMessageRunner.ca
ll(BreakRabbitBreakTest.java:1)
	at
java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)
	at java.util.concurrent.FutureTask.run(FutureTask.java:138)
	at
java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:441)
	at
java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)
	at java.util.concurrent.FutureTask.run(FutureTask.java:138)
	at
java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecuto
r.java:886)
	at
java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.ja
va:908)
	at java.lang.Thread.run(Thread.java:662)

   Locked ownable synchronizers:
	- <0x0000000781004160> (a
java.util.concurrent.locks.ReentrantLock$NonfairSync)

"AMQP Connection 127.0.0.1:5672" prio=6 tid=0x0000000008223800
nid=0x11d4 runnable [0x000000000906f000]
   java.lang.Thread.State: RUNNABLE
	at java.net.SocketInputStream.socketRead0(Native Method)
	at java.net.SocketInputStream.read(SocketInputStream.java:129)
	at
java.io.BufferedInputStream.fill(BufferedInputStream.java:218)
	at
java.io.BufferedInputStream.read(BufferedInputStream.java:237)
	- locked <0x0000000781004ad8> (a java.io.BufferedInputStream)
	at
java.io.DataInputStream.readUnsignedByte(DataInputStream.java:271)
	at com.rabbitmq.client.impl.Frame.readFrom(Frame.java:104)
	at
com.rabbitmq.client.impl.SocketFrameHandler.readFrame(SocketFrameHandler
.java:140)
	- locked <0x0000000781004ab8> (a java.io.DataInputStream)
	at
com.rabbitmq.client.impl.AMQConnection.readFrame(AMQConnection.java:397)
	at
com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:4
25)

   Locked ownable synchronizers:
	- None

"ReaderThread" prio=6 tid=0x0000000008164000 nid=0x39c runnable
[0x000000000876f000]
   java.lang.Thread.State: RUNNABLE
	at java.net.SocketInputStream.socketRead0(Native Method)
	at java.net.SocketInputStream.read(SocketInputStream.java:129)
	at sun.nio.cs.StreamDecoder.readBytes(StreamDecoder.java:264)
	at sun.nio.cs.StreamDecoder.implRead(StreamDecoder.java:306)
	at sun.nio.cs.StreamDecoder.read(StreamDecoder.java:158)
	- locked <0x0000000781008130> (a java.io.InputStreamReader)
	at java.io.InputStreamReader.read(InputStreamReader.java:167)
	at java.io.BufferedReader.fill(BufferedReader.java:136)
	at java.io.BufferedReader.readLine(BufferedReader.java:299)
	- locked <0x0000000781008130> (a java.io.InputStreamReader)
	at java.io.BufferedReader.readLine(BufferedReader.java:362)
	at
org.eclipse.jdt.internal.junit.runner.RemoteTestRunner$ReaderThread.run(
RemoteTestRunner.java:140)

   Locked ownable synchronizers:
	- None

"Low Memory Detector" daemon prio=6 tid=0x0000000006d76000 nid=0x1a64
runnable [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE

   Locked ownable synchronizers:
	- None

"CompilerThread1" daemon prio=10 tid=0x0000000006d65800 nid=0x1398
waiting on condition [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE

   Locked ownable synchronizers:
	- None

"CompilerThread0" daemon prio=10 tid=0x0000000006d50000 nid=0x1e28
waiting on condition [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE

   Locked ownable synchronizers:
	- None

"Attach Listener" daemon prio=10 tid=0x0000000006d4f800 nid=0x1ec8
waiting on condition [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE

   Locked ownable synchronizers:
	- None

"Signal Dispatcher" daemon prio=10 tid=0x0000000006d4e800 nid=0x1a90
runnable [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE

   Locked ownable synchronizers:
	- None

"Finalizer" daemon prio=8 tid=0x0000000006cfe000 nid=0x1d5c in
Object.wait() [0x0000000007a3f000]
   java.lang.Thread.State: WAITING (on object monitor)
	at java.lang.Object.wait(Native Method)
	at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:118)
	- locked <0x0000000781014090> (a
java.lang.ref.ReferenceQueue$Lock)
	at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:134)
	at
java.lang.ref.Finalizer$FinalizerThread.run(Finalizer.java:159)

   Locked ownable synchronizers:
	- None

"Reference Handler" daemon prio=10 tid=0x0000000006cf8000 nid=0x13d8 in
Object.wait() [0x000000000793f000]
   java.lang.Thread.State: WAITING (on object monitor)
	at java.lang.Object.wait(Native Method)
	at java.lang.Object.wait(Object.java:485)
	at
java.lang.ref.Reference$ReferenceHandler.run(Reference.java:116)
	- locked <0x0000000781002108> (a java.lang.ref.Reference$Lock)

   Locked ownable synchronizers:
	- None

"main" prio=6 tid=0x0000000000b0d000 nid=0x1f74 waiting on condition
[0x0000000002b8e000]
   java.lang.Thread.State: WAITING (parking)
	at sun.misc.Unsafe.park(Native Method)
	- parking to wait for  <0x000000078100c350> (a
java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject)
	at
java.util.concurrent.locks.LockSupport.park(LockSupport.java:158)
	at
java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.aw
ait(AbstractQueuedSynchronizer.java:1987)
	at
java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:3
99)
	at
java.util.concurrent.ExecutorCompletionService.take(ExecutorCompletionSe
rvice.java:164)
	at
com.workday.messaging.test.CountingCompletionService.take(CountingComple
tionService.java:34)
	at
com.workday.messaging.test.BreakRabbitBreakTest.performTestMaxQueues(Bre
akRabbitBreakTest.java:88)
	at
com.workday.messaging.test.BreakRabbitBreakTest.testMaxQueues(BreakRabbi
tBreakTest.java:63)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at
sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.jav
a:39)
	at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessor
Impl.java:25)
	at java.lang.reflect.Method.invoke(Method.java:597)
	at
org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMet
hod.java:44)
	at
org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallab
le.java:15)
	at
org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMetho
d.java:41)
	at
org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod
.java:20)
	at
org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.jav
a:28)
	at
org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner
.java:76)
	at
org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner
.java:50)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:193)
	at
org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:52)
	at
org.junit.runners.ParentRunner.runChildren(ParentRunner.java:191)
	at
org.junit.runners.ParentRunner.access$000(ParentRunner.java:42)
	at
org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:184)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:236)
	at
org.eclipse.jdt.internal.junit4.runner.JUnit4TestReference.run(JUnit4Tes
tReference.java:49)
	at
org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.ja
va:38)
	at
org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTe
stRunner.java:467)
	at
org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTe
stRunner.java:683)
	at
org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRun
ner.java:390)
	at
org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRu
nner.java:197)

   Locked ownable synchronizers:
	- None

"VM Thread" prio=10 tid=0x0000000006cee800 nid=0xa50 runnable 

"GC task thread#0 (ParallelGC)" prio=6 tid=0x00000000001c7800 nid=0x1840
runnable 

"GC task thread#1 (ParallelGC)" prio=6 tid=0x00000000001ca800 nid=0x17e0
runnable 

"GC task thread#2 (ParallelGC)" prio=6 tid=0x00000000001cc000 nid=0x1a68
runnable 

"GC task thread#3 (ParallelGC)" prio=6 tid=0x00000000001ce000 nid=0x1b7c
runnable 

"GC task thread#4 (ParallelGC)" prio=6 tid=0x00000000001d1800 nid=0x1e0c
runnable 

"GC task thread#5 (ParallelGC)" prio=6 tid=0x00000000001d3000 nid=0x14c4
runnable 

"GC task thread#6 (ParallelGC)" prio=6 tid=0x00000000001d4000 nid=0xa28
runnable 

"GC task thread#7 (ParallelGC)" prio=6 tid=0x00000000001d5800 nid=0x1838
runnable 

"VM Periodic Task Thread" prio=10 tid=0x0000000006d80000 nid=0x1ae4
waiting on condition 

JNI global references: 951


From matthew at rabbitmq.com  Wed Aug 31 10:50:02 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 31 Aug 2011 10:50:02 +0100
Subject: [rabbitmq-discuss] Nodes loosing contact with the cluster,
 using 2.5.1
In-Reply-To: <1111e06e-4a82-4926-9f5e-4fdfdd8a4e4d@bl1g2000vbb.googlegroups.com>
References: <375b1333-5a59-452e-82d1-fd671b9a18d7@d18g2000yqm.googlegroups.com>
	<858867e0-f49c-4a6c-b4e1-e42d86d3603a@s20g2000yql.googlegroups.com>
	<20110830113746.GA14864@rabbitmq.com>
	<1111e06e-4a82-4926-9f5e-4fdfdd8a4e4d@bl1g2000vbb.googlegroups.com>
Message-ID: <20110831095001.GA8687@rabbitmq.com>

Hi Otto,

On Wed, Aug 31, 2011 at 01:20:14AM -0700, Otto Bergstr?m wrote:
> richmqcoll01:
> 
> richmqcoll02:
> 
> =ERROR REPORT==== 28-Aug-2011::15:22:48 ===
> ** Node rabbit at richmqcoll01 not responding **
> ** Removing (timedout) connection **
> 
> =INFO REPORT==== 28-Aug-2011::15:22:48 ===
> node rabbit at richmqcoll01 lost 'rabbit'
> 
> =INFO REPORT==== 28-Aug-2011::15:22:56 ===
> node rabbit at richmqcoll01 down
> 
> richmqcoll04:
> 
> =ERROR REPORT==== 28-Aug-2011::15:22:53 ===
> ** Node rabbit at richmqcoll01 not responding **
> ** Removing (timedout) connection **
> 
> =INFO REPORT==== 28-Aug-2011::15:22:53 ===
> node rabbit at richmqcoll01 lost 'rabbit'
> 
> =INFO REPORT==== 28-Aug-2011::15:23:00 ===
> node rabbit at richmqcoll01 down


Wow, that's very very interesting - that 02 and 04 thought they lost 01
but 01 didn't think it had lost 02 or 04. What's even more odd is your
report that this happens with 2.5.1 and not 2.4.X.

Having had a dig around, I've come across this -
http://erlang.org/pipermail/erlang-questions/2010-September/053336.html
- which I certainly wasn't aware of, and might potentially be causing
this. It's quite alarming, that one.

One thing you might wish to experiment with is increasing the
net_ticktime - this is the amount of time each node will wait since
hearing from another node before declaring that node dead. By default
for me it seems to be at 60 seconds, which I would have thought should
be more than sufficient, but I'm curious as to whether increasing it
would solve the problem for you.

If you find your rabbitmq-server shell script which should be in
/usr/sbin/rabbitmq-server, and make the following change *on all your
nodes*, before restarting them:

The first non-comment line should look like:

SERVER_ERL_ARGS="+K true +A30 +P 1048576 \
-kernel inet_default_connect_options [{nodelay,true}]"

Change that to:

SERVER_ERL_ARGS="+K true +A30 +P 1048576 \
-kernel inet_default_connect_options [{nodelay,true}] \
-kernel net_ticktime 120"

(Quotes and trailing \ are important).

Let me know how you get on - this isn't something we've seen and I'm
very curious as to what could be causing it.

Best wishes,

Matthew

From iain.hull at workday.com  Wed Aug 31 11:06:08 2011
From: iain.hull at workday.com (Iain Hull)
Date: Wed, 31 Aug 2011 05:06:08 -0500
Subject: [rabbitmq-discuss] Java client Channel.Close blocking
	indefinitely
In-Reply-To: <925DDDE9D69E7143B3252E2D4680A367039E44CB@34093-C5-EVS1.exchange.rackspace.com>
References: <925DDDE9D69E7143B3252E2D4680A367039E44CB@34093-C5-EVS1.exchange.rackspace.com>
Message-ID: <925DDDE9D69E7143B3252E2D4680A367039E44DC@34093-C5-EVS1.exchange.rackspace.com>

Sorry I forgot to mention that I am using rabbitmq-client-2.5.1.jar and
rabbitmq_server-2.5.1.

Iain.

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com
[mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Iain
Hull
Sent: 31 August 2011 10:46
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: [rabbitmq-discuss] Java client Channel.Close blocking
indefinitely

Hi,

I hope you can help.  I am investigating the feasibility of deploying
RabbitMQ in our application.  Our chosen RabbitMQ deployment requires
lots of queues.  To maintain fairness across our application every
tenant requires their own set of queues, this is to ensure that one busy
tenant does not starve the others.  As a result am trying to find the
maximum number of queues RabbitMQ can support to ensure that we can
scale the number of tenants and logical queues.

During one of my tests a call to Channel.Close blocked and never
returned.  I have included the stack trace below.  Each iteration of my
test creates three tasks per queue which send 100 messages, send and
receive 100 messages and just receive 100 messages.  It was one of these
tasks that blocked up.  The code for my test is on
http://pastebin.com/LZTcpnzd.  (CountingCompletionService is a simple
decorator on a CompletionService, but the extra code is not currently
used).

Basically I would like to know am I doing anything wrong in my test, or
is this a bug in the client?  For example is it safe to call
Channel.close in a finally block after an exception was thrown?

I am not sure if this is relevant but I noticed some information in the
logs indicating that the memory high_watermark was hit around the time
the test stopped.

Regards,
Iain.




2011-08-31 08:38:20
Full thread dump Java HotSpot(TM) 64-Bit Server VM (19.1-b02 mixed
mode):

"pool-1-thread-1" prio=6 tid=0x0000000008304000 nid=0x15d4 in
Object.wait() [0x000000000925f000]
   java.lang.Thread.State: WAITING (on object monitor)
	at java.lang.Object.wait(Native Method)
	at java.lang.Object.wait(Object.java:485)
	at com.rabbitmq.utility.BlockingCell.get(BlockingCell.java:50)
	- locked <0x00000007d5d09968> (a
com.rabbitmq.utility.BlockingValueOrException)
	at com.rabbitmq.utility.BlockingCell.get(BlockingCell.java:65)
	- locked <0x00000007d5d09968> (a
com.rabbitmq.utility.BlockingValueOrException)
	at
com.rabbitmq.utility.BlockingCell.uninterruptibleGet(BlockingCell.java:1
11)
	- locked <0x00000007d5d09968> (a
com.rabbitmq.utility.BlockingValueOrException)
	at
com.rabbitmq.utility.BlockingValueOrException.uninterruptibleGetValue(Bl
ockingValueOrException.java:37)
	at
com.rabbitmq.client.impl.AMQChannel$BlockingRpcContinuation.getReply(AMQ
Channel.java:334)
	at com.rabbitmq.client.impl.ChannelN.close(ChannelN.java:466)
	at com.rabbitmq.client.impl.ChannelN.close(ChannelN.java:410)
	at com.rabbitmq.client.impl.ChannelN.close(ChannelN.java:403)
	at
com.workday.messaging.test.BreakRabbitBreakTest$AbstractMessageRunner.ca
ll(BreakRabbitBreakTest.java:141)
	at
com.workday.messaging.test.BreakRabbitBreakTest$AbstractMessageRunner.ca
ll(BreakRabbitBreakTest.java:1)
	at
java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)
	at java.util.concurrent.FutureTask.run(FutureTask.java:138)
	at
java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:441)
	at
java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)
	at java.util.concurrent.FutureTask.run(FutureTask.java:138)
	at
java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecuto
r.java:886)
	at
java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.ja
va:908)
	at java.lang.Thread.run(Thread.java:662)

   Locked ownable synchronizers:
	- <0x0000000781004160> (a
java.util.concurrent.locks.ReentrantLock$NonfairSync)

"AMQP Connection 127.0.0.1:5672" prio=6 tid=0x0000000008223800
nid=0x11d4 runnable [0x000000000906f000]
   java.lang.Thread.State: RUNNABLE
	at java.net.SocketInputStream.socketRead0(Native Method)
	at java.net.SocketInputStream.read(SocketInputStream.java:129)
	at
java.io.BufferedInputStream.fill(BufferedInputStream.java:218)
	at
java.io.BufferedInputStream.read(BufferedInputStream.java:237)
	- locked <0x0000000781004ad8> (a java.io.BufferedInputStream)
	at
java.io.DataInputStream.readUnsignedByte(DataInputStream.java:271)
	at com.rabbitmq.client.impl.Frame.readFrom(Frame.java:104)
	at
com.rabbitmq.client.impl.SocketFrameHandler.readFrame(SocketFrameHandler
.java:140)
	- locked <0x0000000781004ab8> (a java.io.DataInputStream)
	at
com.rabbitmq.client.impl.AMQConnection.readFrame(AMQConnection.java:397)
	at
com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:4
25)

   Locked ownable synchronizers:
	- None

"ReaderThread" prio=6 tid=0x0000000008164000 nid=0x39c runnable
[0x000000000876f000]
   java.lang.Thread.State: RUNNABLE
	at java.net.SocketInputStream.socketRead0(Native Method)
	at java.net.SocketInputStream.read(SocketInputStream.java:129)
	at sun.nio.cs.StreamDecoder.readBytes(StreamDecoder.java:264)
	at sun.nio.cs.StreamDecoder.implRead(StreamDecoder.java:306)
	at sun.nio.cs.StreamDecoder.read(StreamDecoder.java:158)
	- locked <0x0000000781008130> (a java.io.InputStreamReader)
	at java.io.InputStreamReader.read(InputStreamReader.java:167)
	at java.io.BufferedReader.fill(BufferedReader.java:136)
	at java.io.BufferedReader.readLine(BufferedReader.java:299)
	- locked <0x0000000781008130> (a java.io.InputStreamReader)
	at java.io.BufferedReader.readLine(BufferedReader.java:362)
	at
org.eclipse.jdt.internal.junit.runner.RemoteTestRunner$ReaderThread.run(
RemoteTestRunner.java:140)

   Locked ownable synchronizers:
	- None

"Low Memory Detector" daemon prio=6 tid=0x0000000006d76000 nid=0x1a64
runnable [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE

   Locked ownable synchronizers:
	- None

"CompilerThread1" daemon prio=10 tid=0x0000000006d65800 nid=0x1398
waiting on condition [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE

   Locked ownable synchronizers:
	- None

"CompilerThread0" daemon prio=10 tid=0x0000000006d50000 nid=0x1e28
waiting on condition [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE

   Locked ownable synchronizers:
	- None

"Attach Listener" daemon prio=10 tid=0x0000000006d4f800 nid=0x1ec8
waiting on condition [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE

   Locked ownable synchronizers:
	- None

"Signal Dispatcher" daemon prio=10 tid=0x0000000006d4e800 nid=0x1a90
runnable [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE

   Locked ownable synchronizers:
	- None

"Finalizer" daemon prio=8 tid=0x0000000006cfe000 nid=0x1d5c in
Object.wait() [0x0000000007a3f000]
   java.lang.Thread.State: WAITING (on object monitor)
	at java.lang.Object.wait(Native Method)
	at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:118)
	- locked <0x0000000781014090> (a
java.lang.ref.ReferenceQueue$Lock)
	at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:134)
	at
java.lang.ref.Finalizer$FinalizerThread.run(Finalizer.java:159)

   Locked ownable synchronizers:
	- None

"Reference Handler" daemon prio=10 tid=0x0000000006cf8000 nid=0x13d8 in
Object.wait() [0x000000000793f000]
   java.lang.Thread.State: WAITING (on object monitor)
	at java.lang.Object.wait(Native Method)
	at java.lang.Object.wait(Object.java:485)
	at
java.lang.ref.Reference$ReferenceHandler.run(Reference.java:116)
	- locked <0x0000000781002108> (a java.lang.ref.Reference$Lock)

   Locked ownable synchronizers:
	- None

"main" prio=6 tid=0x0000000000b0d000 nid=0x1f74 waiting on condition
[0x0000000002b8e000]
   java.lang.Thread.State: WAITING (parking)
	at sun.misc.Unsafe.park(Native Method)
	- parking to wait for  <0x000000078100c350> (a
java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject)
	at
java.util.concurrent.locks.LockSupport.park(LockSupport.java:158)
	at
java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.aw
ait(AbstractQueuedSynchronizer.java:1987)
	at
java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:3
99)
	at
java.util.concurrent.ExecutorCompletionService.take(ExecutorCompletionSe
rvice.java:164)
	at
com.workday.messaging.test.CountingCompletionService.take(CountingComple
tionService.java:34)
	at
com.workday.messaging.test.BreakRabbitBreakTest.performTestMaxQueues(Bre
akRabbitBreakTest.java:88)
	at
com.workday.messaging.test.BreakRabbitBreakTest.testMaxQueues(BreakRabbi
tBreakTest.java:63)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at
sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.jav
a:39)
	at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessor
Impl.java:25)
	at java.lang.reflect.Method.invoke(Method.java:597)
	at
org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMet
hod.java:44)
	at
org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallab
le.java:15)
	at
org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMetho
d.java:41)
	at
org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod
.java:20)
	at
org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.jav
a:28)
	at
org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner
.java:76)
	at
org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner
.java:50)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:193)
	at
org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:52)
	at
org.junit.runners.ParentRunner.runChildren(ParentRunner.java:191)
	at
org.junit.runners.ParentRunner.access$000(ParentRunner.java:42)
	at
org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:184)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:236)
	at
org.eclipse.jdt.internal.junit4.runner.JUnit4TestReference.run(JUnit4Tes
tReference.java:49)
	at
org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.ja
va:38)
	at
org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTe
stRunner.java:467)
	at
org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTe
stRunner.java:683)
	at
org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRun
ner.java:390)
	at
org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRu
nner.java:197)

   Locked ownable synchronizers:
	- None

"VM Thread" prio=10 tid=0x0000000006cee800 nid=0xa50 runnable 

"GC task thread#0 (ParallelGC)" prio=6 tid=0x00000000001c7800 nid=0x1840
runnable 

"GC task thread#1 (ParallelGC)" prio=6 tid=0x00000000001ca800 nid=0x17e0
runnable 

"GC task thread#2 (ParallelGC)" prio=6 tid=0x00000000001cc000 nid=0x1a68
runnable 

"GC task thread#3 (ParallelGC)" prio=6 tid=0x00000000001ce000 nid=0x1b7c
runnable 

"GC task thread#4 (ParallelGC)" prio=6 tid=0x00000000001d1800 nid=0x1e0c
runnable 

"GC task thread#5 (ParallelGC)" prio=6 tid=0x00000000001d3000 nid=0x14c4
runnable 

"GC task thread#6 (ParallelGC)" prio=6 tid=0x00000000001d4000 nid=0xa28
runnable 

"GC task thread#7 (ParallelGC)" prio=6 tid=0x00000000001d5800 nid=0x1838
runnable 

"VM Periodic Task Thread" prio=10 tid=0x0000000006d80000 nid=0x1ae4
waiting on condition 

JNI global references: 951

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From max at haventon.se  Wed Aug 31 12:20:23 2011
From: max at haventon.se (max at haventon.se)
Date: Wed, 31 Aug 2011 11:20:23 +0000
Subject: [rabbitmq-discuss] Shovel plugin: queue.declare appears to do
	nothing
Message-ID: <DF08B645FD232746AA7806A1B7F3CC0F03B3CCE3@SN2PRD0102MB141.prod.exchangelabs.com>

Hi,

When I use the following configuration file:

[
    {mnesia, [{dump_log_write_threshold, 100}]},
    {rabbit, [{vm_memory_high_watermark, 0.4}]},
    {rabbitmq_shovel, [
        {shovels, [ 
                {app_to_italy_shovel, [
                    {sources, [
                        {brokers, ["amqp://"]},
                        {declarations, [
                            {'queue.declare', [{queue, <<"italy_out">>, durable}]},
                            {'exchange.declare', [
                                {exchange, <<"out">>},
                                {type, <<"topic">>},
                                durable
                            ]},
                            {'queue.bind', [
                                {exchange, <<"out">>},
                                {queue, <<"italy_out">>},
                                {routing_key, <<"italy.#">>}
                            ]}
                        ]}
                    ]},
                    {destinations, [
                        {broker, "amqp://guest:guest at italy.company.com"}
                    ]},
                    {queue, <<"italy_out">>},
                    {publish_fields, [{exchange, <<"in">>}]}
                ]}        
                
        ]}
    ]}
].

I get the following result when running rabbit_shovel_status:status().

(rabbit at MYCOMP)1> rabbit_shovel_status:status().
[{irims_to_italy_shovel,
     {terminated,
         {{shutdown,
              {server_initiated_close,404,
                  <<"NOT_FOUND - no queue 'italy_out' in vhost '/'">>}},
          {gen_server,call,
              [<0.584.0>,
               {call,
                   {'queue.bind',0,<<"italy_out">>,<<"out">>,<<"italy.#">>,
                       false,[]},
                   none},
               infinity]}}},
     {{2011,8,31},{12,27,38}}}]

The result is exactly the same if I remove the queue.declare from declarations, which to  indicates that the queue.declare statement doesn't do anything. Worth mentioning is that it works well with the Most-Recently-Declared-Queue approach (remove "italy_out"):

(rabbit at GOT044)2> rabbit_shovel_status:status().
[{irims_to_italy_shovel,
     {running,
         {source,
             {amqp_params_direct,<<"guest">>,<<"/">>,rabbit at GOT044,none,
                 []}},
         {destination,
             {amqp_params_network,<<"guest">>,<<"guest">>,<<"/">>,
                 "got032",5672,0,0,0,none,
                 [#Fun<amqp_auth_mechanisms.plain.3>,
                  #Fun<amqp_auth_mechanisms.amqplain.3>],
                 []}}},
     {{2011,8,31},{13,15,3}}}]

However, I'd like to be able to name my queues in advance.

Using RabbitMQ 2.5.1 on Windows 7, Erlang OTP R14B03 (erl5.8.4).

Grateful for any input.
Max



From matthew at rabbitmq.com  Wed Aug 31 12:34:15 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 31 Aug 2011 12:34:15 +0100
Subject: [rabbitmq-discuss] Shovel plugin: queue.declare appears to do
 nothing
In-Reply-To: <DF08B645FD232746AA7806A1B7F3CC0F03B3CCE3@SN2PRD0102MB141.prod.exchangelabs.com>
References: <DF08B645FD232746AA7806A1B7F3CC0F03B3CCE3@SN2PRD0102MB141.prod.exchangelabs.com>
Message-ID: <20110831113415.GE8687@rabbitmq.com>

On Wed, Aug 31, 2011 at 11:20:23AM +0000, max at haventon.se wrote:
> When I use the following configuration file:
> 
> [
>     {mnesia, [{dump_log_write_threshold, 100}]},
>     {rabbit, [{vm_memory_high_watermark, 0.4}]},
>     {rabbitmq_shovel, [
>         {shovels, [ 
>                 {app_to_italy_shovel, [
>                     {sources, [
>                         {brokers, ["amqp://"]},
>                         {declarations, [
>                             {'queue.declare', [{queue, <<"italy_out">>, durable}]},

You want 
 
                              {'queue.declare', [{queue, <<"italy_out">>}, durable]},

instead. That'll work.

Was there nothing in the server logs to indicate the queue.declare was
going wrong?

Matthew

From lionel.cons at cern.ch  Wed Aug 31 13:05:26 2011
From: lionel.cons at cern.ch (Lionel Cons)
Date: Wed, 31 Aug 2011 14:05:26 +0200
Subject: [rabbitmq-discuss] STOMP & wildcard subscriptions
Message-ID: <20110831140103.2d52.abe10f7e5afbbb3a79ce619739541149@cern.ch>

The RabbitMQ STOMP page says nothing about wildcard subscriptions.

In my tests, wildcard subscriptions against a topic seems to be
working: messages sent to /topic/foo.a or /topic/foo.b are received by
a consumer subscribing to /topic/foo.*.

However, they don't seem to be working with queues, with the same test.

Is this a bug or a feature?

Cheers,

Lionel

From czarek at thebestisp.co.uk  Wed Aug 31 13:19:12 2011
From: czarek at thebestisp.co.uk (Cezary Siwek)
Date: Wed, 31 Aug 2011 13:19:12 +0100
Subject: [rabbitmq-discuss] shovel plugin installation problem
Message-ID: <4E5E26C0.7030104@thebestisp.co.uk>

Hello list

I'm trying install the shovel plugin. Rabbit 2.5.1 installed from rpm 
package and is running fine on centos machine.
I have downloaded amqp_client-2.5.1.ez and rabbitmq_shovel-2.5.1.ez  to 
/usr/lib/rabbitmq/lib/rabbitmq_server-2.5.1/plugins

looks like both plugins are running:
(rabbit at node1)2>  rabbit:status().
[{pid,32668},
  {running_applications,[{rabbitmq_shovel,"Data Shovel for RabbitMQ",
                                          "2.5.1"},
                         {amqp_client,"RabbitMQ AMQP Client","2.5.1"},
                         {rabbit,"RabbitMQ","2.5.1"},
                         {os_mon,"CPO  CXC 138 46","2.2.5"},
                         {sasl,"SASL  CXC 138 11","2.1.9.3"},
                         {mnesia,"MNESIA  CXC 138 12","4.4.17"},
                         {stdlib,"ERTS  CXC 138 10","1.17.3"},
                         {kernel,"ERTS  CXC 138 10","2.14.3"}]},
  {os,{unix,linux}},
  {erlang_version,"Erlang R14B02 (erts-5.8.3) [source] [64-bit] 
[smp:2:2] [rq:2] [async-threads:30] [kernel-poll:true]\n"},
  {memory,[{total,24796104},
           {processes,9976400},
           {processes_used,9965192},
           {system,14819704},
           {atom,1118785},
           {atom_used,1112290},
           {binary,7720},
           {code,11154640},
           {ets,769080}]}]


however, rabbit_shovel_status does not return anything:
(rabbit at ndb-in-blr-1-01a)1>  rabbit_shovel_status:status().
[]



here is my rabbitmq.config:
[
     {mnesia, [{dump_log_write_threshold, 100}
              ]},
     {rabbit, [{vm_memory_high_watermark, 0.4}
              ]},
     {rabbit_shovel,
        [{shovels,
          [{sample_shovel,
            [{sources, [{broker, "amqp://user1:pass at node1:5675/vhost1"},
                             {declarations,
                                ['queue.declare',
                                 {'queue.bind',
                                     [{exchange, <<"router">>},
                                      {queue, <<"msgs">>}]}
                                ]}]},
             {destinations, [{broker, 
"amqp://user2:pass2 at node2:5675/vhost2"},
                             {declarations,
                                 [{'exchange.declare',
                                        [{exchange, <<"router">>},
                                         {type, <<"direct">>},
                                         durable]}
                                ]}]},
             {queue, <<"msgs">>},
             {prefetch_count, 10},
             {auto_ack, false},
             {tx_size, 0},
             {publish_properties, [{delivery_mode, 2}]},
             {publish_fields, [{exchange, <<"router">>}]},
             {reconnect_delay, 5}
            ]}
           ]
         }]
      }
].


From conorglynn at gmail.com  Wed Aug 31 13:19:42 2011
From: conorglynn at gmail.com (Conor Glynn)
Date: Wed, 31 Aug 2011 13:19:42 +0100
Subject: [rabbitmq-discuss] Generic server rabbit_mgmt_db terminating
Message-ID: <CANDStergjWejZ-q7N3NBk+7qw7+6_9PFVtkTZGvMOGjtRbC3HA@mail.gmail.com>

Im getting the following error related to the management plugin, its
causing a nagios alert to fire, so I need to do something about it.
These are the versions Im running:
CentOS release 5.6  - 2.6.18-238.el5 (x86_64)
rabbitmq-management-plugins-2.2.0-2.noarch
rabbitmq-server-2.2.0-1.el5.noarch
erlang-kernel-R14B-02.1.el5.x86_64

It seems to have started happening every few hours over the past 30
hours or so, as far as I can see nothing has changed on the server in
question and rabbitmq is operating ok. Any help or guidance would be
appreciated,

=ERROR REPORT==== 30-Aug-2011::20:46:01 ===
** Generic server rabbit_mgmt_db terminating
** Last message in was {get_overview,all}
** When Server state == {state,[{channel_exchange_stats,2599211068},
                                {channel_queue_exchange_stats,2599215165},
                                {channel_queue_stats,2599206971},
                                {channel_stats,2599202874},
                                {connection_stats,2599198777},
                                {queue_stats,2599194675}]}
** Reason for termination ==
** {{badmatch,[]},
    [{rabbit_mgmt_db,augment_queue_pid,2},
     {rabbit_mgmt_db,augment,4},
     {rabbit_mgmt_db,'-augment/3-lc$^0/1-0-',3},
     {rabbit_mgmt_db,'-augment/3-lc$^0/1-0-',3},
     {rabbit_mgmt_db,augment,3},
     {rabbit_mgmt_db,'-handle_call/3-lc$^4/1-4-',4},
     {rabbit_mgmt_db,'-handle_call/3-lc$^4/1-4-',4},
     {rabbit_mgmt_db,'-handle_call/3-fun-2-',4}]}

=ERROR REPORT==== 30-Aug-2011::20:46:01 === webmachine error:
path="/api/overview"
{error,{exit,{{{badmatch,[]},
               [{rabbit_mgmt_db,augment_queue_pid,2},
                {rabbit_mgmt_db,augment,4},
                {rabbit_mgmt_db,'-augment/3-lc$^0/1-0-',3},
                {rabbit_mgmt_db,'-augment/3-lc$^0/1-0-',3},
                {rabbit_mgmt_db,augment,3},
                {rabbit_mgmt_db,'-handle_call/3-lc$^4/1-4-',4},
                {rabbit_mgmt_db,'-handle_call/3-lc$^4/1-4-',4},
                {rabbit_mgmt_db,'-handle_call/3-fun-2-',4}]},
              {gen_server,call,
                          [{global,rabbit_mgmt_db},
                           {get_overview,all},
                           infinity]}},
             [{gen_server,call,3},
              {rabbit_mgmt_db,safe_call,2},
              {rabbit_mgmt_wm_overview,to_json,2},
              {webmachine_resource,resource_call,3},
              {webmachine_resource,do,3},
              {webmachine_decision_core,resource_call,1},
              {webmachine_decision_core,decision,1},
              {webmachine_decision_core,handle_request,2}]}}

thanks, conor

From matthew at rabbitmq.com  Wed Aug 31 13:22:54 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 31 Aug 2011 13:22:54 +0100
Subject: [rabbitmq-discuss] shovel plugin installation problem
In-Reply-To: <4E5E26C0.7030104@thebestisp.co.uk>
References: <4E5E26C0.7030104@thebestisp.co.uk>
Message-ID: <20110831122254.GG8687@rabbitmq.com>

On Wed, Aug 31, 2011 at 01:19:12PM +0100, Cezary Siwek wrote:
> here is my rabbitmq.config:
> [
>     {mnesia, [{dump_log_write_threshold, 100}
>              ]},
>     {rabbit, [{vm_memory_high_watermark, 0.4}
>              ]},
>     {rabbit_shovel,

That should be 

      {rabbitmq_shovel,

instead. That'll work. In general, since 2.5.0 (IIRC), plugins changed
their application name from rabbit_* to rabbitmq_*. Consequently,
configurations needed to be updated.

Matthew

From matthew at rabbitmq.com  Wed Aug 31 13:24:51 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 31 Aug 2011 13:24:51 +0100
Subject: [rabbitmq-discuss] Generic server rabbit_mgmt_db terminating
In-Reply-To: <CANDStergjWejZ-q7N3NBk+7qw7+6_9PFVtkTZGvMOGjtRbC3HA@mail.gmail.com>
References: <CANDStergjWejZ-q7N3NBk+7qw7+6_9PFVtkTZGvMOGjtRbC3HA@mail.gmail.com>
Message-ID: <20110831122451.GH8687@rabbitmq.com>

Hi Conor,

On Wed, Aug 31, 2011 at 01:19:42PM +0100, Conor Glynn wrote:
> Im getting the following error related to the management plugin, its
> causing a nagios alert to fire, so I need to do something about it.
> These are the versions Im running:
> CentOS release 5.6  - 2.6.18-238.el5 (x86_64)
> rabbitmq-management-plugins-2.2.0-2.noarch
> rabbitmq-server-2.2.0-1.el5.noarch
> erlang-kernel-R14B-02.1.el5.x86_64
> 
> It seems to have started happening every few hours over the past 30
> hours or so, as far as I can see nothing has changed on the server in
> question and rabbitmq is operating ok. Any help or guidance would be
> appreciated,

Hmm, not sure, and the mgmt guru is currently on holiday. All I can say
for sure (without digging a lot further), is that an awful lot of
improvements and bug fixes have been made to the mgmt plugin since
2.2.0, and if it is an easy route for you to upgrade to the latest, you
might find that the quickest path.

Matthew

From conorglynn at gmail.com  Wed Aug 31 13:27:51 2011
From: conorglynn at gmail.com (Conor Glynn)
Date: Wed, 31 Aug 2011 13:27:51 +0100
Subject: [rabbitmq-discuss] Generic server rabbit_mgmt_db terminating
In-Reply-To: <20110831122451.GH8687@rabbitmq.com>
References: <CANDStergjWejZ-q7N3NBk+7qw7+6_9PFVtkTZGvMOGjtRbC3HA@mail.gmail.com>
	<20110831122451.GH8687@rabbitmq.com>
Message-ID: <CANDSter23Ji0wB-QYhPkkEE6_-aVUjK782JyA4hoEw-SCcfoSw@mail.gmail.com>

Thanks Matthew,
I will give the upgrade a go and let you know.
conor

On Wed, Aug 31, 2011 at 1:24 PM, Matthew Sackman <matthew at rabbitmq.com> wrote:
> Hi Conor,
>
> On Wed, Aug 31, 2011 at 01:19:42PM +0100, Conor Glynn wrote:
>> Im getting the following error related to the management plugin, its
>> causing a nagios alert to fire, so I need to do something about it.
>> These are the versions Im running:
>> CentOS release 5.6 ?- 2.6.18-238.el5 (x86_64)
>> rabbitmq-management-plugins-2.2.0-2.noarch
>> rabbitmq-server-2.2.0-1.el5.noarch
>> erlang-kernel-R14B-02.1.el5.x86_64
>>
>> It seems to have started happening every few hours over the past 30
>> hours or so, as far as I can see nothing has changed on the server in
>> question and rabbitmq is operating ok. Any help or guidance would be
>> appreciated,
>
> Hmm, not sure, and the mgmt guru is currently on holiday. All I can say
> for sure (without digging a lot further), is that an awful lot of
> improvements and bug fixes have been made to the mgmt plugin since
> 2.2.0, and if it is an easy route for you to upgrade to the latest, you
> might find that the quickest path.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From mattilinn at gmail.com  Wed Aug 31 14:04:47 2011
From: mattilinn at gmail.com (Matti Linnanvuori)
Date: Wed, 31 Aug 2011 16:04:47 +0300
Subject: [rabbitmq-discuss] RabbitMQ crashes
Message-ID: <CAGVO6w7M5Lcm_cD9LPk3o8Nfp-nu8JtmEbh5u7_XRZhkuP=JTA@mail.gmail.com>

Matthew Sackman:
> Can you think of any point at which you may have run out of disk space,
> or there's been faulty hardware or file system corruption?

I have run out of disk space but I am not sure if it was during that crash.

From matthew at rabbitmq.com  Wed Aug 31 14:10:09 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 31 Aug 2011 14:10:09 +0100
Subject: [rabbitmq-discuss] RabbitMQ crashes
In-Reply-To: <CAGVO6w7M5Lcm_cD9LPk3o8Nfp-nu8JtmEbh5u7_XRZhkuP=JTA@mail.gmail.com>
References: <CAGVO6w7M5Lcm_cD9LPk3o8Nfp-nu8JtmEbh5u7_XRZhkuP=JTA@mail.gmail.com>
Message-ID: <20110831131009.GI8687@rabbitmq.com>

On Wed, Aug 31, 2011 at 04:04:47PM +0300, Matti Linnanvuori wrote:
> Matthew Sackman:
> > Can you think of any point at which you may have run out of disk space,
> > or there's been faulty hardware or file system corruption?
> 
> I have run out of disk space but I am not sure if it was during that crash.

Interesting. That could well explain it. However, we should certainly be
more robust about handling that situation and not end up with Rabbit in
the state that it's in. I'll file a bug to get that fixed. Many thanks
for the report.

Matthew

Interesting. That could well explain it. However, we should certainly be
more robust about handling that situation and not end up with Rabbit in
the state that it's in. I'll file a bug to get that fixed. Many thanks
for the report.

Matthew

Interesting. That could well explain it. However, we should certainly be
more robust about handling that situation and not end up with Rabbit in
the state that it's in. I'll file a bug to get that fixed. Many thanks
for the report.

Matthew

Interesting. That could well explain it. However, we should certainly be
more robust about handling that situation and not end up with Rabbit in
the state that it's in. I'll file a bug to get that fixed. Many thanks
for the report.

Matthew

Interesting. That could well explain it. However, we should certainly be
more robust about handling that situation and not end up with Rabbit in
the state that it's in. I'll file a bug to get that fixed. Many thanks
for the report.

Matthew

Interesting. That could well explain it. However, we should certainly be
more robust about handling that situation and not end up with Rabbit in
the state that it's in. I'll file a bug to get that fixed. Many thanks
for the report.

Matthew

Interesting. That could well explain it. However, we should certainly be
more robust about handling that situation and not end up with Rabbit in
the state that it's in. I'll file a bug to get that fixed. Many thanks
for the report.

Matthew

Interesting. That could well explain it. However, we should certainly be
more robust about handling that situation and not end up with Rabbit in
the state that it's in. I'll file a bug to get that fixed. Many thanks
for the report.

Matthew

Interesting. That could well explain it. However, we should certainly be
more robust about handling that situation and not end up with Rabbit in
the state that it's in. I'll file a bug to get that fixed. Many thanks
for the report.

Matthew

From max at haventon.se  Wed Aug 31 14:10:27 2011
From: max at haventon.se (max at haventon.se)
Date: Wed, 31 Aug 2011 13:10:27 +0000
Subject: [rabbitmq-discuss] Shovel plugin: queue.declare appears to do
	nothing
Message-ID: <DF08B645FD232746AA7806A1B7F3CC0F03B3CD0A@SN2PRD0102MB141.prod.exchangelabs.com>

Thanks Matthew, that did the trick.

I realized that I've looked for logs in the wrong directory, now I know better.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110831/6baaccc0/attachment.htm>

From matthew at rabbitmq.com  Wed Aug 31 14:11:54 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 31 Aug 2011 14:11:54 +0100
Subject: [rabbitmq-discuss] RabbitMQ crashes
In-Reply-To: <20110831131009.GI8687@rabbitmq.com>
References: <CAGVO6w7M5Lcm_cD9LPk3o8Nfp-nu8JtmEbh5u7_XRZhkuP=JTA@mail.gmail.com>
	<20110831131009.GI8687@rabbitmq.com>
Message-ID: <20110831131154.GJ8687@rabbitmq.com>

On Wed, Aug 31, 2011 at 02:10:09PM +0100, Matthew Sackman wrote:
> Interesting. That could well explain it. However, we should certainly be
> more robust about handling that situation and not end up with Rabbit in
> the state that it's in. I'll file a bug to get that fixed. Many thanks
> for the report.

Err, needless to say, I didn't intentionally copy and paste that several
times. Sorry for the noise.

Matthew

From tim at rabbitmq.com  Wed Aug 31 14:23:17 2011
From: tim at rabbitmq.com (Tim Fox)
Date: Wed, 31 Aug 2011 14:23:17 +0100
Subject: [rabbitmq-discuss] RabbitMQ 2.6.0 is released
Message-ID: <4E5E35C5.1050204@rabbitmq.com>

The RabbitMQ team is pleased to announce the release of RabbitMQ 2.6.0.

The highlight of this release is the introduction of active-active HA, 
with queues getting replicated across nodes in a cluster. There are many 
other improvements, particularly to the management and stomp plug-ins, 
as well as a number of bug fixes. See the attached release notes for 
more details.

Binary and source distributions of the new release can be found in the 
usual place at http://www.rabbitmq.com/download.html

We recommend that all users of earlier versions of RabbitMQ upgrade to 
this latest release.

As always, we welcome any questions, bug reports, and other feedback on 
this release, as well as general suggestions for features and 
enhancements in future releases. Mail us via the RabbitMQ discussion 
list at rabbitmq-discuss at lists.rabbitmq.com, or directly at 
info at rabbitmq.com.

Regards,

The RabbitMQ Team

From tim at rabbitmq.com  Wed Aug 31 14:28:28 2011
From: tim at rabbitmq.com (Tim Fox)
Date: Wed, 31 Aug 2011 14:28:28 +0100
Subject: [rabbitmq-discuss] RabbitMQ 2.6.0 release notes
Message-ID: <4E5E36FC.3090709@rabbitmq.com>

Are attached
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: README-2.6.0.txt
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110831/36015373/attachment.txt>

From majek04 at gmail.com  Wed Aug 31 15:36:18 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 31 Aug 2011 15:36:18 +0100
Subject: [rabbitmq-discuss] HA - queues do not move?
In-Reply-To: <2d54b36f-b377-45b7-80a0-dc1c8ca0a6ee@b20g2000vbz.googlegroups.com>
References: <2d54b36f-b377-45b7-80a0-dc1c8ca0a6ee@b20g2000vbz.googlegroups.com>
Message-ID: <CABzX+qwXN8wVwqgFZEzCJdBKo9RjS=Au=BtsSBo5VnvvFc=v7Q@mail.gmail.com>

On Mon, Aug 29, 2011 at 21:31, John Jeffers <john.jeffers at gmail.com> wrote:
> (I'm new to Rabbit, so please forgive me if this is a dumb question)
>
> I followed the instructions at http://www.rabbitmq.com/pacemaker.html
> to build a two-node HA environment. ?My nodes are RabbitMQ 2.5.1 on
> CentOS 6 64-bit, and I'm using a network share for shared storage
> instead of DRBD.
>
> The nodes failover just fine, and most things seem to be working as
> expected, however, I've noticed that when I take Node 1 down and it
> fails over to Node 2, the queues and messages on Node 1 do not move to
> Node 2. ?Is this expected behavior? ?I expected that the point of the
> shared storage would be so that messages would not be lost in the
> event of a failover, but maybe my expectations are incorrect?

Have you set 'persistenece' flag on the queues and 'durability' flag
on messages?

Chees,
  Marek

From iain.hull at workday.com  Wed Aug 31 15:38:26 2011
From: iain.hull at workday.com (Iain Hull)
Date: Wed, 31 Aug 2011 09:38:26 -0500
Subject: [rabbitmq-discuss] Java client Channel.Close blocking
	indefinitely
In-Reply-To: <925DDDE9D69E7143B3252E2D4680A367039E44DC@34093-C5-EVS1.exchange.rackspace.com>
References: <925DDDE9D69E7143B3252E2D4680A367039E44CB@34093-C5-EVS1.exchange.rackspace.com>
	<925DDDE9D69E7143B3252E2D4680A367039E44DC@34093-C5-EVS1.exchange.rackspace.com>
Message-ID: <925DDDE9D69E7143B3252E2D4680A367039E4760@34093-C5-EVS1.exchange.rackspace.com>

Hi,

I have been going through the Java Client code to see if I could spot
any problems.  I noticed that the ChannelN.close() it calls
BlockingRpcContinuation.getReply with a -1, which causes it to block
until the server sends a response to the channel.  This suggests that
the close response either got lost or was routed to the wrong channel.  

Do you have any suggestions how I can test either of these cases out?
Enable extra logging etc.
Is there any reason that this call blocks indefinitely? Could it use a
timeout make this code more robust?

In the mean time I am going to try my test with the just released 2.6.0

Regards,
Iain.

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com
[mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Iain
Hull
Sent: 31 August 2011 11:06
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Java client Channel.Close
blockingindefinitely

Sorry I forgot to mention that I am using rabbitmq-client-2.5.1.jar and
rabbitmq_server-2.5.1.

Iain.

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com
[mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Iain
Hull
Sent: 31 August 2011 10:46
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: [rabbitmq-discuss] Java client Channel.Close blocking
indefinitely

Hi,

I hope you can help.  I am investigating the feasibility of deploying
RabbitMQ in our application.  Our chosen RabbitMQ deployment requires
lots of queues.  To maintain fairness across our application every
tenant requires their own set of queues, this is to ensure that one busy
tenant does not starve the others.  As a result am trying to find the
maximum number of queues RabbitMQ can support to ensure that we can
scale the number of tenants and logical queues.

During one of my tests a call to Channel.Close blocked and never
returned.  I have included the stack trace below.  Each iteration of my
test creates three tasks per queue which send 100 messages, send and
receive 100 messages and just receive 100 messages.  It was one of these
tasks that blocked up.  The code for my test is on
http://pastebin.com/LZTcpnzd.  (CountingCompletionService is a simple
decorator on a CompletionService, but the extra code is not currently
used).

Basically I would like to know am I doing anything wrong in my test, or
is this a bug in the client?  For example is it safe to call
Channel.close in a finally block after an exception was thrown?

I am not sure if this is relevant but I noticed some information in the
logs indicating that the memory high_watermark was hit around the time
the test stopped.

Regards,
Iain.




2011-08-31 08:38:20
Full thread dump Java HotSpot(TM) 64-Bit Server VM (19.1-b02 mixed
mode):

"pool-1-thread-1" prio=6 tid=0x0000000008304000 nid=0x15d4 in
Object.wait() [0x000000000925f000]
   java.lang.Thread.State: WAITING (on object monitor)
	at java.lang.Object.wait(Native Method)
	at java.lang.Object.wait(Object.java:485)
	at com.rabbitmq.utility.BlockingCell.get(BlockingCell.java:50)
	- locked <0x00000007d5d09968> (a
com.rabbitmq.utility.BlockingValueOrException)
	at com.rabbitmq.utility.BlockingCell.get(BlockingCell.java:65)
	- locked <0x00000007d5d09968> (a
com.rabbitmq.utility.BlockingValueOrException)
	at
com.rabbitmq.utility.BlockingCell.uninterruptibleGet(BlockingCell.java:1
11)
	- locked <0x00000007d5d09968> (a
com.rabbitmq.utility.BlockingValueOrException)
	at
com.rabbitmq.utility.BlockingValueOrException.uninterruptibleGetValue(Bl
ockingValueOrException.java:37)
	at
com.rabbitmq.client.impl.AMQChannel$BlockingRpcContinuation.getReply(AMQ
Channel.java:334)
	at com.rabbitmq.client.impl.ChannelN.close(ChannelN.java:466)
	at com.rabbitmq.client.impl.ChannelN.close(ChannelN.java:410)
	at com.rabbitmq.client.impl.ChannelN.close(ChannelN.java:403)
	at
com.workday.messaging.test.BreakRabbitBreakTest$AbstractMessageRunner.ca
ll(BreakRabbitBreakTest.java:141)
	at
com.workday.messaging.test.BreakRabbitBreakTest$AbstractMessageRunner.ca
ll(BreakRabbitBreakTest.java:1)
	at
java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)
	at java.util.concurrent.FutureTask.run(FutureTask.java:138)
	at
java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:441)
	at
java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)
	at java.util.concurrent.FutureTask.run(FutureTask.java:138)
	at
java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecuto
r.java:886)
	at
java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.ja
va:908)
	at java.lang.Thread.run(Thread.java:662)

   Locked ownable synchronizers:
	- <0x0000000781004160> (a
java.util.concurrent.locks.ReentrantLock$NonfairSync)

"AMQP Connection 127.0.0.1:5672" prio=6 tid=0x0000000008223800
nid=0x11d4 runnable [0x000000000906f000]
   java.lang.Thread.State: RUNNABLE
	at java.net.SocketInputStream.socketRead0(Native Method)
	at java.net.SocketInputStream.read(SocketInputStream.java:129)
	at
java.io.BufferedInputStream.fill(BufferedInputStream.java:218)
	at
java.io.BufferedInputStream.read(BufferedInputStream.java:237)
	- locked <0x0000000781004ad8> (a java.io.BufferedInputStream)
	at
java.io.DataInputStream.readUnsignedByte(DataInputStream.java:271)
	at com.rabbitmq.client.impl.Frame.readFrom(Frame.java:104)
	at
com.rabbitmq.client.impl.SocketFrameHandler.readFrame(SocketFrameHandler
.java:140)
	- locked <0x0000000781004ab8> (a java.io.DataInputStream)
	at
com.rabbitmq.client.impl.AMQConnection.readFrame(AMQConnection.java:397)
	at
com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:4
25)

   Locked ownable synchronizers:
	- None

"ReaderThread" prio=6 tid=0x0000000008164000 nid=0x39c runnable
[0x000000000876f000]
   java.lang.Thread.State: RUNNABLE
	at java.net.SocketInputStream.socketRead0(Native Method)
	at java.net.SocketInputStream.read(SocketInputStream.java:129)
	at sun.nio.cs.StreamDecoder.readBytes(StreamDecoder.java:264)
	at sun.nio.cs.StreamDecoder.implRead(StreamDecoder.java:306)
	at sun.nio.cs.StreamDecoder.read(StreamDecoder.java:158)
	- locked <0x0000000781008130> (a java.io.InputStreamReader)
	at java.io.InputStreamReader.read(InputStreamReader.java:167)
	at java.io.BufferedReader.fill(BufferedReader.java:136)
	at java.io.BufferedReader.readLine(BufferedReader.java:299)
	- locked <0x0000000781008130> (a java.io.InputStreamReader)
	at java.io.BufferedReader.readLine(BufferedReader.java:362)
	at
org.eclipse.jdt.internal.junit.runner.RemoteTestRunner$ReaderThread.run(
RemoteTestRunner.java:140)

   Locked ownable synchronizers:
	- None

"Low Memory Detector" daemon prio=6 tid=0x0000000006d76000 nid=0x1a64
runnable [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE

   Locked ownable synchronizers:
	- None

"CompilerThread1" daemon prio=10 tid=0x0000000006d65800 nid=0x1398
waiting on condition [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE

   Locked ownable synchronizers:
	- None

"CompilerThread0" daemon prio=10 tid=0x0000000006d50000 nid=0x1e28
waiting on condition [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE

   Locked ownable synchronizers:
	- None

"Attach Listener" daemon prio=10 tid=0x0000000006d4f800 nid=0x1ec8
waiting on condition [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE

   Locked ownable synchronizers:
	- None

"Signal Dispatcher" daemon prio=10 tid=0x0000000006d4e800 nid=0x1a90
runnable [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE

   Locked ownable synchronizers:
	- None

"Finalizer" daemon prio=8 tid=0x0000000006cfe000 nid=0x1d5c in
Object.wait() [0x0000000007a3f000]
   java.lang.Thread.State: WAITING (on object monitor)
	at java.lang.Object.wait(Native Method)
	at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:118)
	- locked <0x0000000781014090> (a
java.lang.ref.ReferenceQueue$Lock)
	at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:134)
	at
java.lang.ref.Finalizer$FinalizerThread.run(Finalizer.java:159)

   Locked ownable synchronizers:
	- None

"Reference Handler" daemon prio=10 tid=0x0000000006cf8000 nid=0x13d8 in
Object.wait() [0x000000000793f000]
   java.lang.Thread.State: WAITING (on object monitor)
	at java.lang.Object.wait(Native Method)
	at java.lang.Object.wait(Object.java:485)
	at
java.lang.ref.Reference$ReferenceHandler.run(Reference.java:116)
	- locked <0x0000000781002108> (a java.lang.ref.Reference$Lock)

   Locked ownable synchronizers:
	- None

"main" prio=6 tid=0x0000000000b0d000 nid=0x1f74 waiting on condition
[0x0000000002b8e000]
   java.lang.Thread.State: WAITING (parking)
	at sun.misc.Unsafe.park(Native Method)
	- parking to wait for  <0x000000078100c350> (a
java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject)
	at
java.util.concurrent.locks.LockSupport.park(LockSupport.java:158)
	at
java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.aw
ait(AbstractQueuedSynchronizer.java:1987)
	at
java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:3
99)
	at
java.util.concurrent.ExecutorCompletionService.take(ExecutorCompletionSe
rvice.java:164)
	at
com.workday.messaging.test.CountingCompletionService.take(CountingComple
tionService.java:34)
	at
com.workday.messaging.test.BreakRabbitBreakTest.performTestMaxQueues(Bre
akRabbitBreakTest.java:88)
	at
com.workday.messaging.test.BreakRabbitBreakTest.testMaxQueues(BreakRabbi
tBreakTest.java:63)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at
sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.jav
a:39)
	at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessor
Impl.java:25)
	at java.lang.reflect.Method.invoke(Method.java:597)
	at
org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMet
hod.java:44)
	at
org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallab
le.java:15)
	at
org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMetho
d.java:41)
	at
org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod
.java:20)
	at
org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.jav
a:28)
	at
org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner
.java:76)
	at
org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner
.java:50)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:193)
	at
org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:52)
	at
org.junit.runners.ParentRunner.runChildren(ParentRunner.java:191)
	at
org.junit.runners.ParentRunner.access$000(ParentRunner.java:42)
	at
org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:184)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:236)
	at
org.eclipse.jdt.internal.junit4.runner.JUnit4TestReference.run(JUnit4Tes
tReference.java:49)
	at
org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.ja
va:38)
	at
org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTe
stRunner.java:467)
	at
org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTe
stRunner.java:683)
	at
org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRun
ner.java:390)
	at
org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRu
nner.java:197)

   Locked ownable synchronizers:
	- None

"VM Thread" prio=10 tid=0x0000000006cee800 nid=0xa50 runnable 

"GC task thread#0 (ParallelGC)" prio=6 tid=0x00000000001c7800 nid=0x1840
runnable 

"GC task thread#1 (ParallelGC)" prio=6 tid=0x00000000001ca800 nid=0x17e0
runnable 

"GC task thread#2 (ParallelGC)" prio=6 tid=0x00000000001cc000 nid=0x1a68
runnable 

"GC task thread#3 (ParallelGC)" prio=6 tid=0x00000000001ce000 nid=0x1b7c
runnable 

"GC task thread#4 (ParallelGC)" prio=6 tid=0x00000000001d1800 nid=0x1e0c
runnable 

"GC task thread#5 (ParallelGC)" prio=6 tid=0x00000000001d3000 nid=0x14c4
runnable 

"GC task thread#6 (ParallelGC)" prio=6 tid=0x00000000001d4000 nid=0xa28
runnable 

"GC task thread#7 (ParallelGC)" prio=6 tid=0x00000000001d5800 nid=0x1838
runnable 

"VM Periodic Task Thread" prio=10 tid=0x0000000006d80000 nid=0x1ae4
waiting on condition 

JNI global references: 951

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From majek04 at gmail.com  Wed Aug 31 15:39:53 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 31 Aug 2011 15:39:53 +0100
Subject: [rabbitmq-discuss] Persistent PHP consumer over SSL
In-Reply-To: <CAHrXUcXWS6195DUazoKPehVCMqyQuVB+Jq5WvAYfvy-UF7bZFA@mail.gmail.com>
References: <CAHrXUcXWS6195DUazoKPehVCMqyQuVB+Jq5WvAYfvy-UF7bZFA@mail.gmail.com>
Message-ID: <CABzX+qysyOp_XnQF-f5=JgDkHR6bj3JM9HJM9ZKW-u9YivgH3Q@mail.gmail.com>

On Sat, Aug 27, 2011 at 20:12, Iain Emsley <iainemsley at gmail.com> wrote:
> I've been using and adapting the php-amqplib producer/consumer to link
> systems together. The main change was replacing fsockopen with a
> stream_socket_client() using the STREAM_CLIENT_CONNECT |
> STREAM_CLIENT_PERSISTENT flag.
>
> ?Whilst the consumer is fine over non-SSL and running on the command line as
> per the Readme, it appears to crash on SSL after about an hour or so. The
> server reports that it is running as does the server, but no messages are
> being passed to the linked system, rather are queueing up on the server.
>
> Is there a way of closing a listener via a PID or only by connection on the
> server using rabbitmqctl list_connections?? If messages are being queued, is
> there a way of kicking the queue to see if a connection is accepting or
> failing and sending any error back? The log suggests a timeout but I'd like
> to try and figure out where and get the timing exact.

Only using 'rabbitmqctl close_connection'.

Please do take a look at rabbitmq-management plugin, it may help you
to figure out what's the status of the connection.

> Alternatively, does any body know of a PHP library which I can rebuild the
> persistent SSL connections quickly for the consumer?

I'm afraid I can't help with that.

Cheers,
  Marek

From czarek at thebestisp.co.uk  Wed Aug 31 16:08:38 2011
From: czarek at thebestisp.co.uk (Cezary Siwek)
Date: Wed, 31 Aug 2011 16:08:38 +0100
Subject: [rabbitmq-discuss] shovel plugin installation problem
In-Reply-To: <20110831122254.GG8687@rabbitmq.com>
References: <4E5E26C0.7030104@thebestisp.co.uk>
	<20110831122254.GG8687@rabbitmq.com>
Message-ID: <4E5E4E76.7040209@thebestisp.co.uk>



On 31/08/2011 13:22, Matthew Sackman wrote:
> On Wed, Aug 31, 2011 at 01:19:12PM +0100, Cezary Siwek wrote:
>> here is my rabbitmq.config:
>> [
>>      {mnesia, [{dump_log_write_threshold, 100}
>>               ]},
>>      {rabbit, [{vm_memory_high_watermark, 0.4}
>>               ]},
>>      {rabbit_shovel,
> That should be
>
>        {rabbitmq_shovel,
>
> instead. That'll work. In general, since 2.5.0 (IIRC), plugins changed
> their application name from rabbit_* to rabbitmq_*. Consequently,
> configurations needed to be updated.

Hi Matthew,

Thanks for that.  It's works now.
My config was based on the "working example" from:
https://github.com/rabbitinaction/sourcecode/blob/master/configs/rabbitmq/rabbitmq.config.shovel

Regards,
Cezary


From justin.adam.miller at gmail.com  Wed Aug 31 16:33:52 2011
From: justin.adam.miller at gmail.com (justin.adam.miller at gmail.com)
Date: Wed, 31 Aug 2011 08:33:52 -0700 (PDT)
Subject: [rabbitmq-discuss] Java client Channel.Close blocking
	indefinitely
In-Reply-To: <925DDDE9D69E7143B3252E2D4680A367039E4760@34093-C5-EVS1.exchange.rackspace.com>
References: <925DDDE9D69E7143B3252E2D4680A367039E44CB@34093-C5-EVS1.exchange.rackspace.com>
	<925DDDE9D69E7143B3252E2D4680A367039E44DC@34093-C5-EVS1.exchange.rackspace.com>
	<925DDDE9D69E7143B3252E2D4680A367039E4760@34093-C5-EVS1.exchange.rackspace.com>
Message-ID: <8cbcd83a-0c18-4afd-81fa-a1d9ce74fd28@q12g2000yqd.googlegroups.com>

I'm having this exact problem, with no resolution. Googling hasn't
produced any hits either.

On Aug 31, 10:38?am, "Iain Hull" <iain.h... at workday.com> wrote:
> Hi,
>
> I have been going through the Java Client code to see if I could spot
> any problems. ?I noticed that the ChannelN.close() it calls
> BlockingRpcContinuation.getReply with a -1, which causes it to block
> until the server sends a response to the channel. ?This suggests that
> thecloseresponse either got lost or was routed to the wrong channel. ?
>
> Do you have any suggestions how I can test either of these cases out?
> Enable extra logging etc.
> Is there any reason that this callblocksindefinitely? Could it use a
> timeout make this code more robust?
>
> In the mean time I am going to try my test with the just released 2.6.0
>
> Regards,
> Iain.
>
>
>
>
>
>
>
> -----Original Message-----
> From: rabbitmq-discuss-boun... at lists.rabbitmq.com
>
> [mailto:rabbitmq-discuss-boun... at lists.rabbitmq.com] On Behalf Of Iain
> Hull
> Sent: 31 August 2011 11:06
> To: rabbitmq-disc... at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] Java client Channel.Close
> blockingindefinitely
>
> Sorry I forgot to mention that I am using rabbitmq-client-2.5.1.jar and
> rabbitmq_server-2.5.1.
>
> Iain.
>
> -----Original Message-----
> From: rabbitmq-discuss-boun... at lists.rabbitmq.com
> [mailto:rabbitmq-discuss-boun... at lists.rabbitmq.com] On Behalf Of Iain
> Hull
> Sent: 31 August 2011 10:46
> To: rabbitmq-disc... at lists.rabbitmq.com
> Subject: [rabbitmq-discuss] Java client Channel.Closeblocking
> indefinitely
>
> Hi,
>
> I hope you can help. ?I am investigating the feasibility of deploying
> RabbitMQ in our application. ?Our chosen RabbitMQ deployment requires
> lots of queues. ?To maintain fairness across our application every
> tenant requires their own set of queues, this is to ensure that one busy
> tenant does not starve the others. ?As a result am trying to find the
> maximum number of queues RabbitMQ can support to ensure that we can
> scale the number of tenants and logical queues.
>
> During one of my tests a call to Channel.Closeblocked and never
> returned. ?I have included the stack trace below. ?Each iteration of my
> test creates three tasks per queue which send 100 messages, send and
> receive 100 messages and just receive 100 messages. ?It was one of these
> tasks that blocked up. ?The code for my test is onhttp://pastebin.com/LZTcpnzd. ?(CountingCompletionService is a simple
> decorator on a CompletionService, but the extra code is not currently
> used).
>
> Basically I would like to know am I doing anything wrong in my test, or
> is this a bug in the client? ?For example is it safe to call
> Channel.closein a finally block after an exception was thrown?
>
> I am not sure if this is relevant but I noticed some information in the
> logs indicating that the memory high_watermark was hit around the time
> the test stopped.
>
> Regards,
> Iain.
>
> 2011-08-31 08:38:20
> Full thread dump Java HotSpot(TM) 64-Bit Server VM (19.1-b02 mixed
> mode):
>
> "pool-1-thread-1" prio=6 tid=0x0000000008304000 nid=0x15d4 in
> Object.wait() [0x000000000925f000]
> ? ?java.lang.Thread.State: WAITING (on object monitor)
> ? ? ? ? at java.lang.Object.wait(Native Method)
> ? ? ? ? at java.lang.Object.wait(Object.java:485)
> ? ? ? ? at com.rabbitmq.utility.BlockingCell.get(BlockingCell.java:50)
> ? ? ? ? - locked <0x00000007d5d09968> (a
> com.rabbitmq.utility.BlockingValueOrException)
> ? ? ? ? at com.rabbitmq.utility.BlockingCell.get(BlockingCell.java:65)
> ? ? ? ? - locked <0x00000007d5d09968> (a
> com.rabbitmq.utility.BlockingValueOrException)
> ? ? ? ? at
> com.rabbitmq.utility.BlockingCell.uninterruptibleGet(BlockingCell.java:1
> 11)
> ? ? ? ? - locked <0x00000007d5d09968> (a
> com.rabbitmq.utility.BlockingValueOrException)
> ? ? ? ? at
> com.rabbitmq.utility.BlockingValueOrException.uninterruptibleGetValue(Bl
> ockingValueOrException.java:37)
> ? ? ? ? at
> com.rabbitmq.client.impl.AMQChannel$BlockingRpcContinuation.getReply(AMQ
> Channel.java:334)
> ? ? ? ? at com.rabbitmq.client.impl.ChannelN.close(ChannelN.java:466)
> ? ? ? ? at com.rabbitmq.client.impl.ChannelN.close(ChannelN.java:410)
> ? ? ? ? at com.rabbitmq.client.impl.ChannelN.close(ChannelN.java:403)
> ? ? ? ? at
> com.workday.messaging.test.BreakRabbitBreakTest$AbstractMessageRunner.ca
> ll(BreakRabbitBreakTest.java:141)
> ? ? ? ? at
> com.workday.messaging.test.BreakRabbitBreakTest$AbstractMessageRunner.ca
> ll(BreakRabbitBreakTest.java:1)
> ? ? ? ? at
> java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)
> ? ? ? ? at java.util.concurrent.FutureTask.run(FutureTask.java:138)
> ? ? ? ? at
> java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:441)
> ? ? ? ? at
> java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)
> ? ? ? ? at java.util.concurrent.FutureTask.run(FutureTask.java:138)
> ? ? ? ? at
> java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecuto
> r.java:886)
> ? ? ? ? at
> java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.ja
> va:908)
> ? ? ? ? at java.lang.Thread.run(Thread.java:662)
>
> ? ?Locked ownable synchronizers:
> ? ? ? ? - <0x0000000781004160> (a
> java.util.concurrent.locks.ReentrantLock$NonfairSync)
>
> "AMQPConnection127.0.0.1:5672" prio=6 tid=0x0000000008223800
> nid=0x11d4 runnable [0x000000000906f000]
> ? ?java.lang.Thread.State: RUNNABLE
> ? ? ? ? at java.net.SocketInputStream.socketRead0(Native Method)
> ? ? ? ? at java.net.SocketInputStream.read(SocketInputStream.java:129)
> ? ? ? ? at
> java.io.BufferedInputStream.fill(BufferedInputStream.java:218)
> ? ? ? ? at
> java.io.BufferedInputStream.read(BufferedInputStream.java:237)
> ? ? ? ? - locked <0x0000000781004ad8> (a java.io.BufferedInputStream)
> ? ? ? ? at
> java.io.DataInputStream.readUnsignedByte(DataInputStream.java:271)
> ? ? ? ? at com.rabbitmq.client.impl.Frame.readFrom(Frame.java:104)
> ? ? ? ? at
> com.rabbitmq.client.impl.SocketFrameHandler.readFrame(SocketFrameHandler
> .java:140)
> ? ? ? ? - locked <0x0000000781004ab8> (a java.io.DataInputStream)
> ? ? ? ? at
> com.rabbitmq.client.impl.AMQConnection.readFrame(AMQConnection.java:397)
> ? ? ? ? at
> com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:4
> 25)
>
> ? ?Locked ownable synchronizers:
> ? ? ? ? - None
>
> "ReaderThread" prio=6 tid=0x0000000008164000 nid=0x39c runnable
> [0x000000000876f000]
> ? ?java.lang.Thread.State: RUNNABLE
> ? ? ? ? at java.net.SocketInputStream.socketRead0(Native Method)
> ? ? ? ? at java.net.SocketInputStream.read(SocketInputStream.java:129)
> ? ? ? ? at sun.nio.cs.StreamDecoder.readBytes(StreamDecoder.java:264)
> ? ? ? ? at sun.nio.cs.StreamDecoder.implRead(StreamDecoder.java:306)
> ? ? ? ? at sun.nio.cs.StreamDecoder.read(StreamDecoder.java:158)
> ? ? ? ? - locked <0x0000000781008130> (a java.io.InputStreamReader)
> ? ? ? ? at java.io.InputStreamReader.read(InputStreamReader.java:167)
> ? ? ? ? at java.io.BufferedReader.fill(BufferedReader.java:136)
> ? ? ? ? at java.io.BufferedReader.readLine(BufferedReader.java:299)
> ? ? ? ? - locked <0x0000000781008130> (a java.io.InputStreamReader)
> ? ? ? ? at java.io.BufferedReader.readLine(BufferedReader.java:362)
> ? ? ? ? at
> org.eclipse.jdt.internal.junit.runner.RemoteTestRunner$ReaderThread.run(
> RemoteTestRunner.java:140)
>
> ? ?Locked ownable synchronizers:
> ? ? ? ? - None
>
> "Low Memory Detector" daemon prio=6 tid=0x0000000006d76000 nid=0x1a64
> runnable [0x0000000000000000]
> ? ?java.lang.Thread.State: RUNNABLE
>
> ? ?Locked ownable synchronizers:
> ? ? ? ? - None
>
> "CompilerThread1" daemon prio=10 tid=0x0000000006d65800 nid=0x1398
> waiting on condition [0x0000000000000000]
> ? ?java.lang.Thread.State: RUNNABLE
>
> ? ?Locked ownable synchronizers:
> ? ? ? ? - None
>
> "CompilerThread0" daemon prio=10 tid=0x0000000006d50000 nid=0x1e28
> waiting on condition [0x0000000000000000]
> ? ?java.lang.Thread.State: RUNNABLE
>
> ? ?Locked ownable synchronizers:
> ? ? ? ? - None
>
> "Attach Listener" daemon prio=10 tid=0x0000000006d4f800 nid=0x1ec8
> waiting on condition [0x0000000000000000]
> ? ?java.lang.Thread.State: RUNNABLE
>
> ? ?Locked ownable synchronizers:
> ? ? ? ? - None
>
> "Signal Dispatcher" daemon prio=10 tid=0x0000000006d4e800 nid=0x1a90
> runnable [0x0000000000000000]
> ? ?java.lang.Thread.State: RUNNABLE
>
> ? ?Locked ownable synchronizers:
> ? ? ? ? - None
>
> "Finalizer" daemon prio=8 tid=0x0000000006cfe000 nid=0x1d5c in
> Object.wait() [0x0000000007a3f000]
> ? ?java.lang.Thread.State: WAITING (on object monitor)
> ? ? ? ? at java.lang.Object.wait(Native Method)
> ? ? ? ? at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:118)
> ? ? ? ? - locked <0x0000000781014090> (a
> java.lang.ref.ReferenceQueue$Lock)
> ? ? ? ? at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:134)
> ? ? ? ? at
> java.lang.ref.Finalizer$FinalizerThread.run(Finalizer.java:159)
>
> ? ?Locked ownable synchronizers:
> ? ? ? ? - None
>
> "Reference Handler" daemon prio=10 tid=0x0000000006cf8000 nid=0x13d8 in
> Object.wait() [0x000000000793f000]
> ? ?java.lang.Thread.State: WAITING (on object monitor)
> ? ? ? ? at java.lang.Object.wait(Native Method)
> ? ? ? ? at java.lang.Object.wait(Object.java:485)
> ? ? ? ? at
> java.lang.ref.Reference$ReferenceHandler.run(Reference.java:116)
> ? ? ? ? - locked <0x0000000781002108> (a java.lang.ref.Reference$Lock)
>
> ? ?Locked ownable synchronizers:
> ? ? ? ? - None
>
> "main" prio=6 tid=0x0000000000b0d000 nid=0x1f74 waiting on condition
> [0x0000000002b8e000]
> ? ?java.lang.Thread.State: WAITING (parking)
> ? ? ? ? at sun.misc.Unsafe.park(Native Method)
> ? ? ? ? - parking to wait for ?<0x000000078100c350> (a
> java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject)
> ? ? ? ? at
> java.util.concurrent.locks.LockSupport.park(LockSupport.java:158)
> ? ? ? ? at
> java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.aw
> ait(AbstractQueuedSynchronizer.java:1987)
> ? ? ? ? at
> java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:3
> 99)
> ? ? ? ? at
> java.util.concurrent.ExecutorCompletionService.take(ExecutorCompletionSe
> rvice.java:164)
> ? ? ? ? at
> com.workday.messaging.test.CountingCompletionService.take(CountingComple
> tionService.java:34)
> ? ? ? ? at
> com.workday.messaging.test.BreakRabbitBreakTest.performTestMaxQueues(Bre
> akRabbitBreakTest.java:88)
> ? ? ? ? at
> com.workday.messaging.test.BreakRabbitBreakTest.testMaxQueues(BreakRabbi
> tBreakTest.java:63)
> ? ? ? ? at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
> ? ? ? ? at
> sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.jav
> a:39)
> ? ? ? ? at
> sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessor
> Impl.java:25)
> ? ? ? ? at java.lang.reflect.Method.invoke(Method.java:597)
> ? ? ? ? at
> org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMet
> hod.java:44)
> ? ? ? ? at
> org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallab
> le.java:15)
> ? ? ? ? at
> org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMetho
> d.java:41)
> ? ? ? ? at
>
> ...
>
> read more ?

From matthias at rabbitmq.com  Wed Aug 31 16:42:30 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 31 Aug 2011 16:42:30 +0100
Subject: [rabbitmq-discuss] Java client Channel.Close blocking
	indefinitely
In-Reply-To: <925DDDE9D69E7143B3252E2D4680A367039E44CB@34093-C5-EVS1.exchange.rackspace.com>
References: <925DDDE9D69E7143B3252E2D4680A367039E44CB@34093-C5-EVS1.exchange.rackspace.com>
Message-ID: <4E5E5666.1030204@rabbitmq.com>

Iain,

On 31/08/11 10:46, Iain Hull wrote:
> During one of my tests a call to Channel.Close blocked and never
> returned.
> [...]
> I am not sure if this is relevant but I noticed some information in the
> logs indicating that the memory high_watermark was hit around the time
> the test stopped.

When the high watermark is hit all connections on which a publish is 
received get blocked. So no data will make it through from these 
connections, and that includes Channel.Close.

The server should eventually recover from this, by paging messages to 
disk or delivering them to consumers. Did that happen in your case, i.e. 
did the logs show the alarm getting cleared?

Regards,

Matthias.

From rmurthi at gilt.com  Wed Aug 31 17:41:42 2011
From: rmurthi at gilt.com (Raymond Murthi)
Date: Wed, 31 Aug 2011 12:41:42 -0400
Subject: [rabbitmq-discuss] Unable to install RabbitMQ 2.6.0 using MacPorts
Message-ID: <03154477-FE38-49D0-8546-DE18C51FA09E@gilt.com>

Hi, 

I got this error when trying to install the latest RabbitMQ version through MacPorts. I have added RabbitMQ repo in my sources.conf and did a port sync before running port install.  

Error: Unable to open port: tar: +CONTENTS: Not found in archive
tar: Error exit delayed from previous errors.
To report a bug, see <http://guide.macports.org/#project.tickets>

I saw it listed when running port search though. The output is below.

sudo port search rabbitmq-server
rabbitmq-server @2.5.1 (net)
    The RabbitMQ AMQP Server

rabbitmq-server @2.6.0 (net)
    The RabbitMQ AMQP Server

That aside, great job in adding the new active/active HA feature. I look forward to trying it. 



Thanks, 
-Ray


From matthias at rabbitmq.com  Wed Aug 31 17:55:55 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 31 Aug 2011 17:55:55 +0100
Subject: [rabbitmq-discuss] Unable to install RabbitMQ 2.6.0 using
	MacPorts
In-Reply-To: <03154477-FE38-49D0-8546-DE18C51FA09E@gilt.com>
References: <03154477-FE38-49D0-8546-DE18C51FA09E@gilt.com>
Message-ID: <4E5E679B.8040001@rabbitmq.com>

Ray,

On 31/08/11 17:41, Raymond Murthi wrote:
>I got this error when trying to install the latest RabbitMQ version
> through MacPorts. I have added RabbitMQ repo in my sources.conf and did
> a port sync before running port install.
>
> Error: Unable to open port: tar: +CONTENTS: Not found in archive
> tar: Error exit delayed from previous errors.

Is there anything noteworthy in the output when running the port 
commands with debug (-d) turned on?

Regards,

Matthias.

From rmurthi at gilt.com  Wed Aug 31 17:59:55 2011
From: rmurthi at gilt.com (Raymond Murthi)
Date: Wed, 31 Aug 2011 12:59:55 -0400
Subject: [rabbitmq-discuss] Unable to install RabbitMQ 2.6.0 using
 MacPorts
In-Reply-To: <4E5E679B.8040001@rabbitmq.com>
References: <03154477-FE38-49D0-8546-DE18C51FA09E@gilt.com>
	<4E5E679B.8040001@rabbitmq.com>
Message-ID: <85FCAD13-6B51-4C80-9894-C8E6A15931F3@gilt.com>

Hi Matthias, 

Sure. This is the debug messages: 

tar: Error exit delayed from previous errors.
    while executing
"exec /usr/bin/tar -zqxOf {rabbitmq-server.tgz} +CONTENTS"
    ("eval" body line 1)
    invoked from within
"eval exec $cmdline"
    (procedure "macports::fetch_port" line 24)
    invoked from within
"macports::fetch_port $url 0"
    (procedure "macports::getportdir" line 24)
    invoked from within
"macports::getportdir $porturl $portdir"
    (procedure "mportopen" line 27)
    invoked from within
"mportopen $porturl [array get options] [array get requested_variations]"



Thanks, 
-Ray

On Aug 31, 2011, at 12:55 PM, Matthias Radestock wrote:

> Ray,
> 
> On 31/08/11 17:41, Raymond Murthi wrote:
>> I got this error when trying to install the latest RabbitMQ version
>> through MacPorts. I have added RabbitMQ repo in my sources.conf and did
>> a port sync before running port install.
>> 
>> Error: Unable to open port: tar: +CONTENTS: Not found in archive
>> tar: Error exit delayed from previous errors.
> 
> Is there anything noteworthy in the output when running the port 
> commands with debug (-d) turned on?
> 
> Regards,
> 
> Matthias.


From matthias at rabbitmq.com  Wed Aug 31 18:09:55 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 31 Aug 2011 18:09:55 +0100
Subject: [rabbitmq-discuss] Unable to install RabbitMQ 2.6.0 using
	MacPorts
In-Reply-To: <85FCAD13-6B51-4C80-9894-C8E6A15931F3@gilt.com>
References: <03154477-FE38-49D0-8546-DE18C51FA09E@gilt.com>	<4E5E679B.8040001@rabbitmq.com>
	<85FCAD13-6B51-4C80-9894-C8E6A15931F3@gilt.com>
Message-ID: <4E5E6AE3.8090700@rabbitmq.com>

Raymond,

On 31/08/11 17:59, Raymond Murthi wrote:
> Hi Matthias,
>
> Sure. This is the debug messages:
>
> tar: Error exit delayed from previous errors.
>      while executing
> "exec /usr/bin/tar -zqxOf {rabbitmq-server.tgz} +CONTENTS"
>      ("eval" body line 1)

and

>>> Error: Unable to open port: tar: +CONTENTS: Not found in archive
>>> tar: Error exit delayed from previous errors.

Some quick googling suggests that this is a macports problem. Or it 
could be that something has changed in how macports packages are 
supposed to get constructed.

If you find out what the issue is, please let us know.


Matthias.


From bmurphy1976 at gmail.com  Wed Aug 31 18:19:53 2011
From: bmurphy1976 at gmail.com (Bryan Murphy)
Date: Wed, 31 Aug 2011 12:19:53 -0500
Subject: [rabbitmq-discuss] RabbitMQ 2.6.0 is released
In-Reply-To: <CAP+1M2dCRd6m5iZwtWuK6jMaJTbo9CZruZjYd1R9A4CR4FeDLQ@mail.gmail.com>
References: <4E5E35C5.1050204@rabbitmq.com>
	<CAP+1M2dCRd6m5iZwtWuK6jMaJTbo9CZruZjYd1R9A4CR4FeDLQ@mail.gmail.com>
Message-ID: <CAP+1M2ehpiLthhdPJQFv4yTPirdO7dii4qkOozaZxhEGW1qYZw@mail.gmail.com>

On Wed, Aug 31, 2011 at 12:19 PM, Bryan Murphy <bmurphy1976 at gmail.com> wrote:
> On Wed, Aug 31, 2011 at 8:23 AM, Tim Fox <tim at rabbitmq.com> wrote:
>> The RabbitMQ team is pleased to announce the release of RabbitMQ 2.6.0.
>>
>> The highlight of this release is the introduction of active-active HA, with
>> queues getting replicated across nodes in a cluster. There are many other
>> improvements, particularly to the management and stomp plug-ins, as well as
>> a number of bug fixes. See the attached release notes for more details.
>
> Great work guys! ?This is FANTASTIC news. ?We've been waiting a long
> time for active-active HA and can't wait to get it deployed.
>
> I can't find the release notes however.
>
> Thanks,
> Bryan

Nevermind me, I see they were sent in a separate email.

Bryan

From bmurphy1976 at gmail.com  Wed Aug 31 18:19:01 2011
From: bmurphy1976 at gmail.com (Bryan Murphy)
Date: Wed, 31 Aug 2011 12:19:01 -0500
Subject: [rabbitmq-discuss] RabbitMQ 2.6.0 is released
In-Reply-To: <4E5E35C5.1050204@rabbitmq.com>
References: <4E5E35C5.1050204@rabbitmq.com>
Message-ID: <CAP+1M2dCRd6m5iZwtWuK6jMaJTbo9CZruZjYd1R9A4CR4FeDLQ@mail.gmail.com>

On Wed, Aug 31, 2011 at 8:23 AM, Tim Fox <tim at rabbitmq.com> wrote:
> The RabbitMQ team is pleased to announce the release of RabbitMQ 2.6.0.
>
> The highlight of this release is the introduction of active-active HA, with
> queues getting replicated across nodes in a cluster. There are many other
> improvements, particularly to the management and stomp plug-ins, as well as
> a number of bug fixes. See the attached release notes for more details.

Great work guys!  This is FANTASTIC news.  We've been waiting a long
time for active-active HA and can't wait to get it deployed.

I can't find the release notes however.

Thanks,
Bryan

From majek04 at gmail.com  Wed Aug 31 18:29:18 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 31 Aug 2011 18:29:18 +0100
Subject: [rabbitmq-discuss] Unable to install RabbitMQ 2.6.0 using
	MacPorts
In-Reply-To: <85FCAD13-6B51-4C80-9894-C8E6A15931F3@gilt.com>
References: <03154477-FE38-49D0-8546-DE18C51FA09E@gilt.com>
	<4E5E679B.8040001@rabbitmq.com>
	<85FCAD13-6B51-4C80-9894-C8E6A15931F3@gilt.com>
Message-ID: <CABzX+qzhwBuqCXz5jjMjSsnwMLY4Y9Q1d3_0jBLr_-cvChn5GQ@mail.gmail.com>

Raymond,

Do try running:
port selfupdate
port upgrade outdated
port install rabbitmq-server

if that doesn't help, you may need to clear caches (if, for example
download was broken):
port clean --all rabbitmq-server

Hope that helps
 Marek

On Wed, Aug 31, 2011 at 17:59, Raymond Murthi <rmurthi at gilt.com> wrote:
> Hi Matthias,
>
> Sure. This is the debug messages:
>
> tar: Error exit delayed from previous errors.
> ? ?while executing
> "exec /usr/bin/tar -zqxOf {rabbitmq-server.tgz} +CONTENTS"
> ? ?("eval" body line 1)
> ? ?invoked from within
> "eval exec $cmdline"
> ? ?(procedure "macports::fetch_port" line 24)
> ? ?invoked from within
> "macports::fetch_port $url 0"
> ? ?(procedure "macports::getportdir" line 24)
> ? ?invoked from within
> "macports::getportdir $porturl $portdir"
> ? ?(procedure "mportopen" line 27)
> ? ?invoked from within
> "mportopen $porturl [array get options] [array get requested_variations]"
>
>
>
> Thanks,
> -Ray
>
> On Aug 31, 2011, at 12:55 PM, Matthias Radestock wrote:
>
>> Ray,
>>
>> On 31/08/11 17:41, Raymond Murthi wrote:
>>> I got this error when trying to install the latest RabbitMQ version
>>> through MacPorts. I have added RabbitMQ repo in my sources.conf and did
>>> a port sync before running port install.
>>>
>>> Error: Unable to open port: tar: +CONTENTS: Not found in archive
>>> tar: Error exit delayed from previous errors.
>>
>> Is there anything noteworthy in the output when running the port
>> commands with debug (-d) turned on?
>>
>> Regards,
>>
>> Matthias.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From bmurphy1976 at gmail.com  Wed Aug 31 18:19:01 2011
From: bmurphy1976 at gmail.com (Bryan Murphy)
Date: Wed, 31 Aug 2011 12:19:01 -0500
Subject: [rabbitmq-discuss] RabbitMQ 2.6.0 is released
In-Reply-To: <4E5E35C5.1050204@rabbitmq.com>
References: <4E5E35C5.1050204@rabbitmq.com>
Message-ID: <CAP+1M2dCRd6m5iZwtWuK6jMaJTbo9CZruZjYd1R9A4CR4FeDLQ@mail.gmail.com>

On Wed, Aug 31, 2011 at 8:23 AM, Tim Fox <tim at rabbitmq.com> wrote:
> The RabbitMQ team is pleased to announce the release of RabbitMQ 2.6.0.
>
> The highlight of this release is the introduction of active-active HA, with
> queues getting replicated across nodes in a cluster. There are many other
> improvements, particularly to the management and stomp plug-ins, as well as
> a number of bug fixes. See the attached release notes for more details.

Great work guys!  This is FANTASTIC news.  We've been waiting a long
time for active-active HA and can't wait to get it deployed.

I can't find the release notes however.

Thanks,
Bryan

From rmurthi at gilt.com  Wed Aug 31 18:50:04 2011
From: rmurthi at gilt.com (Raymond Murthi)
Date: Wed, 31 Aug 2011 13:50:04 -0400
Subject: [rabbitmq-discuss] Unable to install RabbitMQ 2.6.0 using
 MacPorts
In-Reply-To: <CABzX+qzhwBuqCXz5jjMjSsnwMLY4Y9Q1d3_0jBLr_-cvChn5GQ@mail.gmail.com>
References: <03154477-FE38-49D0-8546-DE18C51FA09E@gilt.com>
	<4E5E679B.8040001@rabbitmq.com>
	<85FCAD13-6B51-4C80-9894-C8E6A15931F3@gilt.com>
	<CABzX+qzhwBuqCXz5jjMjSsnwMLY4Y9Q1d3_0jBLr_-cvChn5GQ@mail.gmail.com>
Message-ID: <50BBC9A8-323C-40CD-825B-E2CCC995DD77@gilt.com>

Hi Marek, 

Unfortunately not. Cleaning my caches does not help either. I also did the selfupdate and upgrade earlier but to no avail.

I'll dig further if this is a known issue and will let you know if there's a solution / work around. 


Thanks,
-Ray 

On Aug 31, 2011, at 1:29 PM, Marek Majkowski wrote:

> Raymond,
> 
> Do try running:
> port selfupdate
> port upgrade outdated
> port install rabbitmq-server
> 
> if that doesn't help, you may need to clear caches (if, for example
> download was broken):
> port clean --all rabbitmq-server
> 
> Hope that helps
> Marek
> 
> On Wed, Aug 31, 2011 at 17:59, Raymond Murthi <rmurthi at gilt.com> wrote:
>> Hi Matthias,
>> 
>> Sure. This is the debug messages:
>> 
>> tar: Error exit delayed from previous errors.
>>    while executing
>> "exec /usr/bin/tar -zqxOf {rabbitmq-server.tgz} +CONTENTS"
>>    ("eval" body line 1)
>>    invoked from within
>> "eval exec $cmdline"
>>    (procedure "macports::fetch_port" line 24)
>>    invoked from within
>> "macports::fetch_port $url 0"
>>    (procedure "macports::getportdir" line 24)
>>    invoked from within
>> "macports::getportdir $porturl $portdir"
>>    (procedure "mportopen" line 27)
>>    invoked from within
>> "mportopen $porturl [array get options] [array get requested_variations]"
>> 
>> 
>> 
>> Thanks,
>> -Ray
>> 
>> On Aug 31, 2011, at 12:55 PM, Matthias Radestock wrote:
>> 
>>> Ray,
>>> 
>>> On 31/08/11 17:41, Raymond Murthi wrote:
>>>> I got this error when trying to install the latest RabbitMQ version
>>>> through MacPorts. I have added RabbitMQ repo in my sources.conf and did
>>>> a port sync before running port install.
>>>> 
>>>> Error: Unable to open port: tar: +CONTENTS: Not found in archive
>>>> tar: Error exit delayed from previous errors.
>>> 
>>> Is there anything noteworthy in the output when running the port
>>> commands with debug (-d) turned on?
>>> 
>>> Regards,
>>> 
>>> Matthias.
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 


From jasonjwwilliams at gmail.com  Wed Aug 31 21:29:50 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Wed, 31 Aug 2011 14:29:50 -0600
Subject: [rabbitmq-discuss] RabbitMQ 2.6.0 is released
In-Reply-To: <4E5E35C5.1050204@rabbitmq.com>
References: <4E5E35C5.1050204@rabbitmq.com>
Message-ID: <CAHZAEpd+4d1zzJSi2v+POq9m1EVKRmFgiZh7+zyzoXbmA6BY5A@mail.gmail.com>

Congratulations guys! This is a big step forward. Just wish the
replication mode choices allowed you to spec a replication factor
(e.g. 2, 3, 4 copies), rather than requiring node names if you don't
want it replicated to all nodes. What is the recommended way for a
client to introspect the current node names in the cluster?

-J

On Wed, Aug 31, 2011 at 7:23 AM, Tim Fox <tim at rabbitmq.com> wrote:
> The RabbitMQ team is pleased to announce the release of RabbitMQ 2.6.0.
>
> The highlight of this release is the introduction of active-active HA, with
> queues getting replicated across nodes in a cluster. There are many other
> improvements, particularly to the management and stomp plug-ins, as well as
> a number of bug fixes. See the attached release notes for more details.
>
> Binary and source distributions of the new release can be found in the usual
> place at http://www.rabbitmq.com/download.html
>
> We recommend that all users of earlier versions of RabbitMQ upgrade to this
> latest release.
>
> As always, we welcome any questions, bug reports, and other feedback on this
> release, as well as general suggestions for features and enhancements in
> future releases. Mail us via the RabbitMQ discussion list at
> rabbitmq-discuss at lists.rabbitmq.com, or directly at info at rabbitmq.com.
>
> Regards,
>
> The RabbitMQ Team
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From videlalvaro at gmail.com  Wed Aug 31 21:57:14 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 31 Aug 2011 22:57:14 +0200
Subject: [rabbitmq-discuss] RabbitMQ 2.6.0 is released
In-Reply-To: <CAHZAEpd+4d1zzJSi2v+POq9m1EVKRmFgiZh7+zyzoXbmA6BY5A@mail.gmail.com>
References: <4E5E35C5.1050204@rabbitmq.com>
	<CAHZAEpd+4d1zzJSi2v+POq9m1EVKRmFgiZh7+zyzoXbmA6BY5A@mail.gmail.com>
Message-ID: <E5D9E69C-D816-4069-A97D-9C97F23A20FF@gmail.com>

Jason,

You can put the contents of this gist: https://gist.github.com/1184689 on a file called 'nodes.erl'  and make it executable

Then if you have 'node at host' in your system you can simply call:

./nodes.erl 'node at host'

And it will print out the nodes in the Erlang cluster. The script assumes that you are using "short names"

Regards,

Alvaro

On Aug 31, 2011, at 10:29 PM, Jason J. W. Williams wrote:

> Congratulations guys! This is a big step forward. Just wish the
> replication mode choices allowed you to spec a replication factor
> (e.g. 2, 3, 4 copies), rather than requiring node names if you don't
> want it replicated to all nodes. What is the recommended way for a
> client to introspect the current node names in the cluster?
> 
> -J
> 
> On Wed, Aug 31, 2011 at 7:23 AM, Tim Fox <tim at rabbitmq.com> wrote:
>> The RabbitMQ team is pleased to announce the release of RabbitMQ 2.6.0.
>> 
>> The highlight of this release is the introduction of active-active HA, with
>> queues getting replicated across nodes in a cluster. There are many other
>> improvements, particularly to the management and stomp plug-ins, as well as
>> a number of bug fixes. See the attached release notes for more details.
>> 
>> Binary and source distributions of the new release can be found in the usual
>> place at http://www.rabbitmq.com/download.html
>> 
>> We recommend that all users of earlier versions of RabbitMQ upgrade to this
>> latest release.
>> 
>> As always, we welcome any questions, bug reports, and other feedback on this
>> release, as well as general suggestions for features and enhancements in
>> future releases. Mail us via the RabbitMQ discussion list at
>> rabbitmq-discuss at lists.rabbitmq.com, or directly at info at rabbitmq.com.
>> 
>> Regards,
>> 
>> The RabbitMQ Team
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

Sent form my Nokia 1100




From matthias at rabbitmq.com  Wed Aug 31 22:21:13 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 31 Aug 2011 22:21:13 +0100
Subject: [rabbitmq-discuss] RabbitMQ 2.6.0 is released
In-Reply-To: <CAHZAEpd+4d1zzJSi2v+POq9m1EVKRmFgiZh7+zyzoXbmA6BY5A@mail.gmail.com>
References: <4E5E35C5.1050204@rabbitmq.com>
	<CAHZAEpd+4d1zzJSi2v+POq9m1EVKRmFgiZh7+zyzoXbmA6BY5A@mail.gmail.com>
Message-ID: <4E5EA5C9.3020708@rabbitmq.com>

Jason,

On 31/08/11 21:29, Jason J. W. Williams wrote:
> Congratulations guys! This is a big step forward. Just wish the
> replication mode choices allowed you to spec a replication factor
> (e.g. 2, 3, 4 copies), rather than requiring node names if you don't
> want it replicated to all nodes.

Different types of replication policies are on the todo list. We 
agonised about this for quite some time during development, and in the 
end decided to ship with just the two policies - 'all' is as simple as 
it gets and 'nodes' gives you ultimate flexibility.

We seek input from the community and what policies they'd like to see, 
and how exactly they should work. E.g. in the above "replication factor" 
policy, how are the nodes a queue gets replicated to chosen? what 
happens when there are fewer nodes than the policy dictates? etc. etc.

Regards,

Matthias.

From jasonjwwilliams at gmail.com  Wed Aug 31 22:34:16 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Wed, 31 Aug 2011 15:34:16 -0600
Subject: [rabbitmq-discuss] RabbitMQ 2.6.0 is released
In-Reply-To: <4E5EA5C9.3020708@rabbitmq.com>
References: <4E5E35C5.1050204@rabbitmq.com>
	<CAHZAEpd+4d1zzJSi2v+POq9m1EVKRmFgiZh7+zyzoXbmA6BY5A@mail.gmail.com>
	<4E5EA5C9.3020708@rabbitmq.com>
Message-ID: <CAHZAEpenfBp19M_-sGMPiR5XhH5fSJvDDtuNUnNpO2ounx9JAQ@mail.gmail.com>

Hi Matthias,

> Different types of replication policies are on the todo list. We agonised
> about this for quite some time during development, and in the end decided to
> ship with just the two policies - 'all' is as simple as it gets and 'nodes'
> gives you ultimate flexibility
>
> We seek input from the community and what policies they'd like to see, and
> how exactly they should work. E.g. in the above "replication factor" policy,
> how are the nodes a queue gets replicated to chosen? what happens when there
> are fewer nodes than the policy dictates? etc. etc.

Personally what I'd like to see is the ability to create "cluster
groups" to which nodes could be assigned when they are joined to a
cluster. These groups would then be the basis of "rack-aware" or
"datacenter-aware" decisions. It would make a lot more sense in our
environment to tell queue.declare, set the replication-factor to 4
(example) and spread the copies across the nodes in rack1_group and
rack2_group (letting RabbitMQ figure out the best way to do that given
current loading and node-presence). Or in a more basic mode, spread
the spec'd # of copies across as many cluster groups as possible.
Nodes and their names can be fairly transient, but administrative
groupings would remain more static regardless of the nodes added or
joined to them.

-J

From matthew at rabbitmq.com  Wed Aug 31 22:48:25 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 31 Aug 2011 22:48:25 +0100
Subject: [rabbitmq-discuss] RabbitMQ 2.6.0 is released
In-Reply-To: <CAHZAEpenfBp19M_-sGMPiR5XhH5fSJvDDtuNUnNpO2ounx9JAQ@mail.gmail.com>
References: <4E5E35C5.1050204@rabbitmq.com>
	<CAHZAEpd+4d1zzJSi2v+POq9m1EVKRmFgiZh7+zyzoXbmA6BY5A@mail.gmail.com>
	<4E5EA5C9.3020708@rabbitmq.com>
	<CAHZAEpenfBp19M_-sGMPiR5XhH5fSJvDDtuNUnNpO2ounx9JAQ@mail.gmail.com>
Message-ID: <20110831214824.GA30087@wellquite.org>

Hi Jason,

Thanks for your input.

On Wed, Aug 31, 2011 at 03:34:16PM -0600, Jason J. W. Williams wrote:
> Personally what I'd like to see is the ability to create "cluster
> groups" to which nodes could be assigned when they are joined to a
> cluster. These groups would then be the basis of "rack-aware" or
> "datacenter-aware" decisions. It would make a lot more sense in our
> environment to tell queue.declare, set the replication-factor to 4
> (example) and spread the copies across the nodes in rack1_group and
> rack2_group (letting RabbitMQ figure out the best way to do that given
> current loading and node-presence).

The problem there is where do you stop? You're programming into your
group definition the fact that you know that these nodes are in
different racks, behind different switches, on different machines,
possibly on different UPSs. One problem is that Rabbit knows none of
this. If you were doing this in a cloud, or on EC2, you have no such
knowledged. The last thing you want to end with is all your queue
replicated between nodes that turn out to be different guests on the
same physical machine! Where do you think Rabbit should draw the line in
terms of load balancing - what should it try to monitor and what is
considered unreasonable? Even monitoring CPU usage is rabbit looking
around at its host, but should it go further and try to detect
hypervisors? From TTLs on network packets try to detect whether other
nodes are under the same switch etc?

It all gets very very messy rather quickly. One of the things we've not
really looked into is what do other bits of software that can cluster
like Rabbit do in these scenarios? What's actually useful? What do
admins expect to have to control themselves, and what do they trust the
software to be able to figure out?

Matthew

From videlalvaro at gmail.com  Wed Aug 31 23:14:07 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Thu, 1 Sep 2011 00:14:07 +0200
Subject: [rabbitmq-discuss] When are messages persisted to disk?
Message-ID: <89E8DDB5-D93B-4F7A-9F56-A551BCBF1761@gmail.com>

Hi,

When does RabbitMQ persist messages to disk? 

I would assume that if the message is published with: delivery-mode = 2  then it will be persisted ALWAYS. Is that the case?

What happens with messages with delivery-mode  = 1? Are they kept in memory? Are they saved to disk to the TRANSIENT_MSG_STORE?

Is it correct to say that transient queues get their messages saved to the TRANSIENT_MSG_STORE which is wiped out if RabbitMQ restarts?

Are there situations where the message is directly delivered to the consumer without being persisted to disk?

Regards,

Alvaro



From matthew at rabbitmq.com  Wed Aug 31 23:31:27 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 31 Aug 2011 23:31:27 +0100
Subject: [rabbitmq-discuss] When are messages persisted to disk?
In-Reply-To: <89E8DDB5-D93B-4F7A-9F56-A551BCBF1761@gmail.com>
References: <89E8DDB5-D93B-4F7A-9F56-A551BCBF1761@gmail.com>
Message-ID: <20110831223127.GB30087@wellquite.org>

On Thu, Sep 01, 2011 at 12:14:07AM +0200, Alvaro Videla wrote:
> I would assume that if the message is published with: delivery-mode = 2  then it will be persisted ALWAYS. Is that the case?

No. delivery-mode=2 _AND_ msg arrives in durable queue. This is the only
case in which msgs _MUST_ be written to disk.

When memory is plentiful, even msgs with delivery-mode=2 and in durable
queues will be held in RAM _in addition_ to being on disk.

When memory is tight, these RAM copies will be forgotten. When memory is
tight, other messages that are currently _only_ in RAM may be written to
disk, and yes, they'll go to the transient msg store.

> Is it correct to say that transient queues get their messages saved to
> the TRANSIENT_MSG_STORE which is wiped out if RabbitMQ restarts?

Yes, but equally delivery-mode=1 msgs in durable queues go to the
transient msg store.

> Are there situations where the message is directly delivered to the consumer without being persisted to disk?

Yes. Or at least once a certain bug makes it through QA, then it will
be. If a msg that should be written to disk arrives in a queue and that
queue is able to send the msg out to a consumer and that consumer acks
the msg (or the consumer is consuming/getting with noAck=true) then
there's a possibility that the msg will never get written to disk. It's
a race. If we find out soon enough that the msg has been sent to a
consumer that's taken responsibility for the msg then we'll avoid
writing it. That doesn't quite happen in 2.6.0, but it hopefully will by
the next release.

Matthew

From jasonjwwilliams at gmail.com  Wed Aug 31 23:45:05 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Wed, 31 Aug 2011 16:45:05 -0600
Subject: [rabbitmq-discuss] RabbitMQ 2.6.0 is released
In-Reply-To: <20110831214824.GA30087@wellquite.org>
References: <4E5E35C5.1050204@rabbitmq.com>
	<CAHZAEpd+4d1zzJSi2v+POq9m1EVKRmFgiZh7+zyzoXbmA6BY5A@mail.gmail.com>
	<4E5EA5C9.3020708@rabbitmq.com>
	<CAHZAEpenfBp19M_-sGMPiR5XhH5fSJvDDtuNUnNpO2ounx9JAQ@mail.gmail.com>
	<20110831214824.GA30087@wellquite.org>
Message-ID: <CAHZAEpeNWAXruHuKykOq2gh5HYn=r-ruGXm1dAtXcoAUY3QP5A@mail.gmail.com>

Hi Matthew,

> The problem there is where do you stop? You're programming into your
> group definition the fact that you know that these nodes are in
> different racks, behind different switches, on different machines,
> possibly on different UPSs. One problem is that Rabbit knows none of
> this. If you were doing this in a cloud, or on EC2, you have no such
> knowledged. The last thing you want to end with is all your queue
> replicated between nodes that turn out to be different guests on the
> same physical machine! Where do you think Rabbit should draw the line in
> terms of load balancing - what should it try to monitor and what is
> considered unreasonable? Even monitoring CPU usage is rabbit looking
> around at its host, but should it go further and try to detect
> hypervisors? From TTLs on network packets try to detect whether other
> nodes are under the same switch etc?

In my opinion you stop at leaving it to the user define the
availability "separation" groups/areas. If they're defined incorrectly
because the user doesn't understand their environment, that's not
Rabbit's fault and that responsibility is pretty standard. This is how
it works with Cassandra for example. For folks running physical
servers like ourselves, we have knowledge of which servers are in
different racks and different data centers. We're about to stand up a
new cluster split between data centers in Manhattan and Staten Island
with < 1ms latency between them. With EC2 your unit of availability
separation is the availability zone, and it's up to you to make sure
your nodes are split between them. In the case of an availability
group for Rabbit, I assume EC2 users would define their Rabbit
"availability groups" to map to the availability zones they purchase.

Does that explain what I'm trying to say?

-J

