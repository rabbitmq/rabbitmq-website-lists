From silver.buyer at yahoo.com  Sun Apr  1 01:13:47 2012
From: silver.buyer at yahoo.com (Joseph Goldberg)
Date: Sat, 31 Mar 2012 17:13:47 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ project
Message-ID: <1333239227.66619.YahooMailNeo@web121604.mail.ne1.yahoo.com>

Need someone to help with metals exchange?platform?development using RabbitMQ and hopefully erlang, can anyone help?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120331/cc6b527f/attachment.htm>

From silver.buyer at yahoo.com  Sun Apr  1 01:24:49 2012
From: silver.buyer at yahoo.com (silverbuyer)
Date: Sat, 31 Mar 2012 17:24:49 -0700 (PDT)
Subject: [rabbitmq-discuss] Experimenting with release candidates:
 RabbitMQ 2.7.9
In-Reply-To: <CAHZsVQbmH82Tpg8Xx2DO1C=qxXa7CWZjNvb57PsqYdfPouor-A@mail.gmail.com>
References: <4F58F27B.5030209@rabbitmq.com>
	<CAHZsVQbmH82Tpg8Xx2DO1C=qxXa7CWZjNvb57PsqYdfPouor-A@mail.gmail.com>
Message-ID: <33544960.post@talk.nabble.com>


Brendan can you help with my metals trading platform project using rabbitMQ?
you can skype me, my userid is silverbuyer, thanks!

Brendan Hay-2 wrote:
> 
> Totally game.
> 
> Thanks!
> 
> On Thu, Mar 8, 2012 at 6:55 PM, Simon MacMullen <simon at rabbitmq.com>
> wrote:
> 
>> Hi all.
>>
>> We'll be making a 2.8.0 release of RabbitMQ soon (hopefully early next
>> week), but I'd like to experiment with making preview or RC releases. So
>> here's one.
>>
>> The version is marked as 2.7.9 just because there are all sorts of
>> restrictions on how we can number things (e.g. IIRC 2.8.0rc1 or whatever
>> I
>> think would stop the Windows installer from working). But think of it as
>> a
>> release candidate.
>>
>> The intent is that this will be really quite close to the final release -
>> this isn't so much a beta as a search for last minute showstoppers. If
>> there aren't any such showstoppers then this may be identical to the
>> 2.8.0
>> release. But I wouldn't put it into production myself. You might be
>> braver
>> ;-)
>>
>> You can download artefacts at:
>>
>> http://www.rabbitmq.com/**releases/rabbitmq-server/v2.7.**9/<http://www.rabbitmq.com/releases/rabbitmq-server/v2.7.9/>
>> http://www.rabbitmq.com/**releases/rabbitmq-java-client/**v2.7.9/<http://www.rabbitmq.com/releases/rabbitmq-java-client/v2.7.9/>
>> http://www.rabbitmq.com/**releases/rabbitmq-dotnet-**client/v2.7.9/<http://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v2.7.9/>
>> http://www.rabbitmq.com/**releases/rabbitmq-erlang-**client/v2.7.9/<http://www.rabbitmq.com/releases/rabbitmq-erlang-client/v2.7.9/>
>>
>> I've attached release notes in the usual format.
>>
>> Please, have a play with this and let us know if anything goes wrong for
>> you...
>>
>> Cheers, Simon
>>
>> --
>> Simon MacMullen
>> RabbitMQ, VMware
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://old.nabble.com/Experimenting-with-release-candidates%3A-RabbitMQ-2.7.9-tp33466713p33544960.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From brendan at soundcloud.com  Sun Apr  1 09:10:16 2012
From: brendan at soundcloud.com (Brendan Hay)
Date: Sun, 1 Apr 2012 10:10:16 +0200
Subject: [rabbitmq-discuss] Experimenting with release candidates:
 RabbitMQ 2.7.9
In-Reply-To: <33544960.post@talk.nabble.com>
References: <4F58F27B.5030209@rabbitmq.com>
	<CAHZsVQbmH82Tpg8Xx2DO1C=qxXa7CWZjNvb57PsqYdfPouor-A@mail.gmail.com>
	<33544960.post@talk.nabble.com>
Message-ID: <CAHZsVQaUcgszhDWN99nGsZobjn0vH5nXiBWuvDmhh=WL1-hLTA@mail.gmail.com>

If you have a specific RabbitMQ related question, you should ask it on this
list.

But considering your email address is associated with a rather high volume
of spam on most recruiting related websites, I think you should probably
stick to those avenues if you are looking for talent for your project.


On Sun, Apr 1, 2012 at 2:24 AM, silverbuyer <silver.buyer at yahoo.com> wrote:

>
> Brendan can you help with my metals trading platform project using
> rabbitMQ?
> you can skype me, my userid is silverbuyer, thanks!
>
> Brendan Hay-2 wrote:
> >
> > Totally game.
> >
> > Thanks!
> >
> > On Thu, Mar 8, 2012 at 6:55 PM, Simon MacMullen <simon at rabbitmq.com>
> > wrote:
> >
> >> Hi all.
> >>
> >> We'll be making a 2.8.0 release of RabbitMQ soon (hopefully early next
> >> week), but I'd like to experiment with making preview or RC releases. So
> >> here's one.
> >>
> >> The version is marked as 2.7.9 just because there are all sorts of
> >> restrictions on how we can number things (e.g. IIRC 2.8.0rc1 or whatever
> >> I
> >> think would stop the Windows installer from working). But think of it as
> >> a
> >> release candidate.
> >>
> >> The intent is that this will be really quite close to the final release
> -
> >> this isn't so much a beta as a search for last minute showstoppers. If
> >> there aren't any such showstoppers then this may be identical to the
> >> 2.8.0
> >> release. But I wouldn't put it into production myself. You might be
> >> braver
> >> ;-)
> >>
> >> You can download artefacts at:
> >>
> >> http://www.rabbitmq.com/**releases/rabbitmq-server/v2.7.**9/<
> http://www.rabbitmq.com/releases/rabbitmq-server/v2.7.9/>
> >> http://www.rabbitmq.com/**releases/rabbitmq-java-client/**v2.7.9/<
> http://www.rabbitmq.com/releases/rabbitmq-java-client/v2.7.9/>
> >> http://www.rabbitmq.com/**releases/rabbitmq-dotnet-**client/v2.7.9/<
> http://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v2.7.9/>
> >> http://www.rabbitmq.com/**releases/rabbitmq-erlang-**client/v2.7.9/<
> http://www.rabbitmq.com/releases/rabbitmq-erlang-client/v2.7.9/>
> >>
> >> I've attached release notes in the usual format.
> >>
> >> Please, have a play with this and let us know if anything goes wrong for
> >> you...
> >>
> >> Cheers, Simon
> >>
> >> --
> >> Simon MacMullen
> >> RabbitMQ, VMware
> >>
> >> _______________________________________________
> >> rabbitmq-discuss mailing list
> >> rabbitmq-discuss at lists.rabbitmq.com
> >> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >>
> >>
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
>
> --
> View this message in context:
> http://old.nabble.com/Experimenting-with-release-candidates%3A-RabbitMQ-2.7.9-tp33466713p33544960.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120401/b744b09b/attachment.htm>

From codevally at gmail.com  Mon Apr  2 02:14:01 2012
From: codevally at gmail.com (Codevally)
Date: Sun, 1 Apr 2012 18:14:01 -0700 (PDT)
Subject: [rabbitmq-discuss] Upgrade 2.7.1 RabbitMQ cluster to 2.8.1 version
Message-ID: <32143157.102.1333329241115.JavaMail.geo-discussion-forums@pbcr5>

Hi All

I need to upgrade our current production 2.7.1 RabbitMQ cluster to it's new 
2.8.1 version. 

In our production cluster, we have 2 disc node and erlang R15B installed. 
According to the RabbitMQ cluster guilde:

"All nodes in a cluster must be running the same versions of Erlang and 
RabbitMQ, although they may have different plugins installed. Therefore it 
is necessary to stop all nodes in the cluster, then start all nodes when 
performing an upgrade."

In our case we cannot shutdown our existing cluster, because it is heavily 
used to send messages across regions. 

Could someone please let me know how to upgrade 2.7.1 cluster without 
shutdown the entire cluster.

Many Thanks.
/Roshan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120401/578026b5/attachment.htm>

From brendan at soundcloud.com  Mon Apr  2 05:35:11 2012
From: brendan at soundcloud.com (Brendan Hay)
Date: Sun, 1 Apr 2012 21:35:11 -0700 (PDT)
Subject: [rabbitmq-discuss] Upgrade 2.7.1 RabbitMQ cluster to 2.8.1
	version
In-Reply-To: <32143157.102.1333329241115.JavaMail.geo-discussion-forums@pbcr5>
References: <32143157.102.1333329241115.JavaMail.geo-discussion-forums@pbcr5>
Message-ID: <5d9f08ec-40f4-4789-af03-df2d8656fd03@k14g2000vbe.googlegroups.com>

Hi Roshan,

I would suggest you provision a _new_ physical cluster running 2.8.1
side by side with your old cluster, and then incrementally move
producers/consumers over.

Are you using some sort of load-balancer in front of your cluster,
such as HAProxy or LVS?
What sort of service discovery do the clients use to find Rabbit?
(Chef, ZooKeeper, hard-coded configs, etc.)

Regards,
Brendan

On Apr 2, 3:14?am, Codevally <codeva... at gmail.com> wrote:
> Hi All
>
> I need to upgrade our current production 2.7.1 RabbitMQ cluster to it's new
> 2.8.1 version.
>
> In our production cluster, we have 2 disc node and erlang R15B installed.
> According to the RabbitMQ cluster guilde:
>
> "All nodes in a cluster must be running the same versions of Erlang and
> RabbitMQ, although they may have different plugins installed. Therefore it
> is necessary to stop all nodes in the cluster, then start all nodes when
> performing an upgrade."
>
> In our case we cannot shutdown our existing cluster, because it is heavily
> used to send messages across regions.
>
> Could someone please let me know how to upgrade 2.7.1 cluster without
> shutdown the entire cluster.
>
> Many Thanks.
> /Roshan
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From codevally at gmail.com  Mon Apr  2 08:01:14 2012
From: codevally at gmail.com (Codevally)
Date: Mon, 2 Apr 2012 00:01:14 -0700 (PDT)
Subject: [rabbitmq-discuss] Upgrade 2.7.1 RabbitMQ cluster to 2.8.1
 version
In-Reply-To: <5d9f08ec-40f4-4789-af03-df2d8656fd03@k14g2000vbe.googlegroups.com>
References: <32143157.102.1333329241115.JavaMail.geo-discussion-forums@pbcr5>
	<5d9f08ec-40f4-4789-af03-df2d8656fd03@k14g2000vbe.googlegroups.com>
Message-ID: <25862303.165.1333350074529.JavaMail.geo-discussion-forums@pbcvw3>

Hi Brendan

Thanks for the reply.

Currently we don't have any load-balancer installed and all the operations 
are hardcoded. 

On Monday, April 2, 2012 2:35:11 PM UTC+10, Brendan Hay wrote:
>
> Hi Roshan,
>
> I would suggest you provision a _new_ physical cluster running 2.8.1
> side by side with your old cluster, and then incrementally move
> producers/consumers over.
>
> Are you using some sort of load-balancer in front of your cluster,
> such as HAProxy or LVS?
> What sort of service discovery do the clients use to find Rabbit?
> (Chef, ZooKeeper, hard-coded configs, etc.)
>
> Regards,
> Brendan
>
> On Apr 2, 3:14 am, Codevally <codeva... at gmail.com> wrote:
> > Hi All
> >
> > I need to upgrade our current production 2.7.1 RabbitMQ cluster to it's 
> new
> > 2.8.1 version.
> >
> > In our production cluster, we have 2 disc node and erlang R15B installed.
> > According to the RabbitMQ cluster guilde:
> >
> > "All nodes in a cluster must be running the same versions of Erlang and
> > RabbitMQ, although they may have different plugins installed. Therefore 
> it
> > is necessary to stop all nodes in the cluster, then start all nodes when
> > performing an upgrade."
> >
> > In our case we cannot shutdown our existing cluster, because it is 
> heavily
> > used to send messages across regions.
> >
> > Could someone please let me know how to upgrade 2.7.1 cluster without
> > shutdown the entire cluster.
> >
> > Many Thanks.
> > /Roshan
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.comhttps://
> lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120402/0a7efe8b/attachment.htm>

From krati.x.gupta at accenture.com  Mon Apr  2 08:27:15 2012
From: krati.x.gupta at accenture.com (krati.x.gupta at accenture.com)
Date: Mon, 2 Apr 2012 07:27:15 +0000
Subject: [rabbitmq-discuss] the external application post a message to the
 topic being monitored by the JMS listener
Message-ID: <064477C2975075449EA466C9FF39DAAE086667@048-CH1MPN1-211.048d.mgd.msft.net>

Doe anybody know how to connect post messages from rabbitmq to weblogic server inwhich topic is configured?



Thanks And Regards,
Krati Gupta | Accenture
________________________________
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [rabbitmq-discuss-bounces at lists.rabbitmq.com] on behalf of Codevally [codevally at gmail.com]
Sent: Monday, April 02, 2012 12:31 PM
To: rabbitmq-discuss at googlegroups.com
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Upgrade 2.7.1 RabbitMQ cluster to 2.8.1 version

Hi Brendan

Thanks for the reply.

Currently we don't have any load-balancer installed and all the operations are hardcoded.

On Monday, April 2, 2012 2:35:11 PM UTC+10, Brendan Hay wrote:
Hi Roshan,

I would suggest you provision a _new_ physical cluster running 2.8.1
side by side with your old cluster, and then incrementally move
producers/consumers over.

Are you using some sort of load-balancer in front of your cluster,
such as HAProxy or LVS?
What sort of service discovery do the clients use to find Rabbit?
(Chef, ZooKeeper, hard-coded configs, etc.)

Regards,
Brendan

On Apr 2, 3:14 am, Codevally <codeva... at gmail.com> wrote:
> Hi All
>
> I need to upgrade our current production 2.7.1 RabbitMQ cluster to it's new
> 2.8.1 version.
>
> In our production cluster, we have 2 disc node and erlang R15B installed.
> According to the RabbitMQ cluster guilde:
>
> "All nodes in a cluster must be running the same versions of Erlang and
> RabbitMQ, although they may have different plugins installed. Therefore it
> is necessary to stop all nodes in the cluster, then start all nodes when
> performing an upgrade."
>
> In our case we cannot shutdown our existing cluster, because it is heavily
> used to send messages across regions.
>
> Could someone please let me know how to upgrade 2.7.1 cluster without
> shutdown the entire cluster.
>
> Many Thanks.
> /Roshan
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss<http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

________________________________
Subject to local law, communications with Accenture and its affiliates including telephone calls and emails (including content), may be monitored by our systems for the purposes of security and the assessment of internal compliance with Accenture policy.
______________________________________________________________________________________

www.accenture.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120402/2f629c2d/attachment.htm>

From stavr.chris at gmail.com  Mon Apr  2 09:04:11 2012
From: stavr.chris at gmail.com (Christos Stavrakakis)
Date: Mon, 02 Apr 2012 11:04:11 +0300
Subject: [rabbitmq-discuss] rabbitmq-server start not responding
Message-ID: <4F795D7B.7070408@gmail.com>

Hi,

I am running two RabbitMQ 2.8.0-1 servers in cluster mode. After killing 
the one server (kill -9),
I try to start it again with '/etc/init.d/rabbitmq-server start'. 
Although the server seems to be working (I can see
it from the management plugin and I can send and receive messages) this 
command never returns.
I looked at the rabbitmq-server script and I see that the program hangs 
on the rabbitmqctl wait $PID_FILE command.

Is this some kind of bug ?

Chris





From denis.melique at morpho.com  Mon Apr  2 09:34:36 2012
From: denis.melique at morpho.com (MELIQUE Denis (MORPHO))
Date: Mon, 2 Apr 2012 10:34:36 +0200
Subject: [rabbitmq-discuss] Testing Shovel on a WAN
In-Reply-To: <4F75CD8A.2020207@rabbitmq.com>
References: <C3481B5CE3E61E438EEF6143B51DC17F66A0C1C356@Y000IIIV01.rd1.rf1>
	<4F7334D7.6030709@rabbitmq.com>
	<C3481B5CE3E61E438EEF6143B51DC17F66A0C7D19B@Y000IIIV01.rd1.rf1>
	<4F75CD8A.2020207@rabbitmq.com>
Message-ID: <C3481B5CE3E61E438EEF6143B51DC17F66A0C7D502@Y000IIIV01.rd1.rf1>

Thank you Simon.

I also did some testing with federation and compared with Shovel, but not in a clustered configuration.
I have tested only Shovel with clusters. I am going to test federation as well.
For the moment, I preferred using Shovel because federation seems to be less mature.
(not yet included in VMWare support, and many support activity on this forum).
This might be change with the version 2.8.1.
Reading RabbitMQ web site, I now have the feeling that federation is going to be the 
recommended solution, for my kind of application (multi-site through a WAN)
Am I right ?

Thank's 

Denis

-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: Friday, March 30, 2012 5:13 PM
To: MELIQUE Denis (MORPHO)
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Testing Shovel on a WAN

On 30/03/12 15:50, MELIQUE Denis (MORPHO) wrote:
> - set a two node cluster on local end
> - Have the Shovel plug-In configured on both nodes
>    Each node has its one Shovel setting, with similar parameters except "sources [broker..]" and "destinations [broker...]",
>    That are specific to the node.

Ah, right.

So the shovel does not handle clusters specially at all; if you 
configure the shovel on two cluster nodes you will get two shovels 
running in parallel. Each message will go through one shovel or the 
other, but the order will get mixed up.

Federation is different; in a cluster each federation link will only 
exist once. I wonder if the shovel should be more like federation in 
this regard...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware
#
" Ce courriel et les documents qui lui sont joints peuvent contenir des informations confidentielles ou ayant un caract?re priv?. S'ils ne vous sont pas destin?s, nous vous signalons qu'il est strictement interdit de les divulguer, de les reproduire ou d'en utiliser de quelque mani?re que ce soit le contenu. Si ce message vous a ?t? transmis par erreur, merci d'en informer l'exp?diteur et de supprimer imm?diatement de votre syst?me informatique ce courriel ainsi que tous les documents qui y sont attach?s."
******
" This e-mail and any attached documents may contain confidential or proprietary information. If you are not the intended recipient, you are notified that any dissemination, copying of this e-mail and any attachments thereto or use of their contents by any means whatsoever is strictly prohibited. If you have received this e-mail in error, please advise the sender immediately and delete this e-mail and all attached documents from your computer system."
#

From raoulus at gmail.com  Mon Apr  2 09:37:59 2012
From: raoulus at gmail.com (Raoul Buzziol)
Date: Mon, 2 Apr 2012 10:37:59 +0200
Subject: [rabbitmq-discuss] messages one at a time
Message-ID: <CAGWHYsZc7en15F+11Vq5u29k=hVv=V8k2x8Ja84iWFYt476CAg@mail.gmail.com>

Hi,

I'm looking for a way to consume messages from a queue by multiple consumer
one at a time. The queue should deliver a new message only after an ack.

The way I found to handle it is to let the consumer be exclusive. But In
this case only one consumer can be access to the queue.
My clients comes and goes, should they try to consume all interested queues
and skip those whom rejects access? And then poll accessibility of
available queues?
Are there better solutions, is this the way or am I wrong?

Thanx, Raoul

(.net client on RabbitMQ 2.8.1)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120402/f74c0c68/attachment.htm>

From simone.busoli at gmail.com  Mon Apr  2 09:42:24 2012
From: simone.busoli at gmail.com (Simone Busoli)
Date: Mon, 2 Apr 2012 10:42:24 +0200
Subject: [rabbitmq-discuss] messages one at a time
In-Reply-To: <CAGWHYsZc7en15F+11Vq5u29k=hVv=V8k2x8Ja84iWFYt476CAg@mail.gmail.com>
References: <CAGWHYsZc7en15F+11Vq5u29k=hVv=V8k2x8Ja84iWFYt476CAg@mail.gmail.com>
Message-ID: <CAOn7oW9C20wJqLpykb2o9NxQFyLW6Ce-bBqbKpyMVv1M9d5OEg@mail.gmail.com>

Hi Raoul,

if you set prefetch-count to 1 on the consumer channel then each consumer
on the queue will get one message at a time. Exploiting the default broker
behavior by which multiple consumers on a queue are delivered messages in a
round-robin fashion, the end result should be what you described.

On Mon, Apr 2, 2012 at 10:37, Raoul Buzziol <raoulus at gmail.com> wrote:

> Hi,
>
> I'm looking for a way to consume messages from a queue by multiple
> consumer one at a time. The queue should deliver a new message only after
> an ack.
>
> The way I found to handle it is to let the consumer be exclusive. But In
> this case only one consumer can be access to the queue.
> My clients comes and goes, should they try to consume all interested
> queues and skip those whom rejects access? And then poll accessibility of
> available queues?
> Are there better solutions, is this the way or am I wrong?
>
> Thanx, Raoul
>
> (.net client on RabbitMQ 2.8.1)
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120402/1a57b918/attachment.htm>

From stavr.chris at gmail.com  Mon Apr  2 09:54:22 2012
From: stavr.chris at gmail.com (Christos Stavrakakis)
Date: Mon, 02 Apr 2012 11:54:22 +0300
Subject: [rabbitmq-discuss] messages one at a time
In-Reply-To: <CAOn7oW9C20wJqLpykb2o9NxQFyLW6Ce-bBqbKpyMVv1M9d5OEg@mail.gmail.com>
References: <CAGWHYsZc7en15F+11Vq5u29k=hVv=V8k2x8Ja84iWFYt476CAg@mail.gmail.com>
	<CAOn7oW9C20wJqLpykb2o9NxQFyLW6Ce-bBqbKpyMVv1M9d5OEg@mail.gmail.com>
Message-ID: <4F79693E.3080601@gmail.com>

On 04/02/2012 11:42 AM, Simone Busoli wrote:
> Hi Raoul,
>
> if you set prefetch-count to 1 on the consumer channel then each 
> consumer on the queue will get one message at a time. Exploiting the 
> default broker behavior by which multiple consumers on a queue are 
> delivered messages in a round-robin fashion, the end result should be 
> what you described.
>

In my understanding, what Raoul wants, is to deliver a message to one 
consumer, only if all other consumers do not hold an unacked message. I 
think that with prefetch-count 1 what is
guaranteed is that each consumer will not get a second message, before 
sending an ACK for the previous. However, a different consumer can get a 
message while
some other consumers hold an unacked message. Am I correct ?

Chris

> On Mon, Apr 2, 2012 at 10:37, Raoul Buzziol <raoulus at gmail.com 
> <mailto:raoulus at gmail.com>> wrote:
>
>     Hi,
>
>     I'm looking for a way to consume messages from a queue by multiple
>     consumer one at a time. The queue should deliver a new message
>     only after an ack.
>
>     The way I found to handle it is to let the consumer be exclusive.
>     But In this case only one consumer can be access to the queue.
>     My clients comes and goes, should they try to consume all
>     interested queues and skip those whom rejects access? And then
>     poll accessibility of available queues?
>     Are there better solutions, is this the way or am I wrong?
>
>     Thanx, Raoul
>
>     (.net client on RabbitMQ 2.8.1)
>
>     _______________________________________________
>     rabbitmq-discuss mailing list
>     rabbitmq-discuss at lists.rabbitmq.com
>     <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>     https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>    

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120402/ac5138a7/attachment.htm>

From videlalvaro at gmail.com  Mon Apr  2 09:59:30 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Mon, 2 Apr 2012 10:59:30 +0200
Subject: [rabbitmq-discuss] messages one at a time
In-Reply-To: <4F79693E.3080601@gmail.com>
References: <CAGWHYsZc7en15F+11Vq5u29k=hVv=V8k2x8Ja84iWFYt476CAg@mail.gmail.com>
	<CAOn7oW9C20wJqLpykb2o9NxQFyLW6Ce-bBqbKpyMVv1M9d5OEg@mail.gmail.com>
	<4F79693E.3080601@gmail.com>
Message-ID: <CAMcAHLXjA+gUVGsyEcSbWgC8E-4i7mW-Jry7o_0WrYdCY5nnMA@mail.gmail.com>

Hi,

Maybe what you could do is to have a pool of workers and then just one
consumer, so the consumer will dispatch work to "one message at the time"
to each of the workers.

Not sure what's the advantage of doing this.

-Alvaro

On Mon, Apr 2, 2012 at 10:54 AM, Christos Stavrakakis <stavr.chris at gmail.com
> wrote:

> **
> On 04/02/2012 11:42 AM, Simone Busoli wrote:
>
> Hi Raoul,
>
>  if you set prefetch-count to 1 on the consumer channel then each
> consumer on the queue will get one message at a time. Exploiting the
> default broker behavior by which multiple consumers on a queue are
> delivered messages in a round-robin fashion, the end result should be what
> you described.
>
>
> In my understanding, what Raoul wants, is to deliver a message to one
> consumer, only if all other consumers do not hold an unacked message. I
> think that with prefetch-count 1 what is
> guaranteed is that each consumer will not get a second message, before
> sending an ACK for the previous. However, a different consumer can get a
> message while
> some other consumers hold an unacked message. Am I correct ?
>
> Chris
>
>
>  On Mon, Apr 2, 2012 at 10:37, Raoul Buzziol <raoulus at gmail.com> wrote:
>
>> Hi,
>>
>> I'm looking for a way to consume messages from a queue by multiple
>> consumer one at a time. The queue should deliver a new message only after
>> an ack.
>>
>> The way I found to handle it is to let the consumer be exclusive. But In
>> this case only one consumer can be access to the queue.
>> My clients comes and goes, should they try to consume all interested
>> queues and skip those whom rejects access? And then poll accessibility of
>> available queues?
>> Are there better solutions, is this the way or am I wrong?
>>
>> Thanx, Raoul
>>
>> (.net client on RabbitMQ 2.8.1)
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing listrabbitmq-discuss at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120402/e9b031ac/attachment.htm>

From emile at rabbitmq.com  Mon Apr  2 10:41:30 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 02 Apr 2012 10:41:30 +0100
Subject: [rabbitmq-discuss] have problem to follow client deployment
 steps in erlang client doc
In-Reply-To: <CACSB5m546Gw2+S6fKihggzCY6shwJgxYRdbG+zAijA=ntbtn5A@mail.gmail.com>
References: <CACSB5m546Gw2+S6fKihggzCY6shwJgxYRdbG+zAijA=ntbtn5A@mail.gmail.com>
Message-ID: <4F79744A.5000801@rabbitmq.com>

Hi,

On 31/03/12 10:31, zhi sun wrote:
> I am newbie to rabbitmq erlang client.
> 
> when I follow the client deployment steps described as below, I found
> the steps are aged, and didn't work.
> http://www.rabbitmq.com/erlang-client-user-guide.html

I'm sorry that errors in the documentation caused difficulties. Can you
let us know what is wrong so that we can put it right?

You might also want to look at the building guide:
http://www.rabbitmq.com/build-erlang-client.html

> I finally is able to compile the amqp_example.erl successfully (and
> output is amqp_example.beam), but get the following error:
> 
> 1> amqp_example:test().
> ** exception error: undefined function amqp_example:test/0

Your amqp_example module is not in the code loading path. The simplest
solution is to add the folder containing the amqp_example.beam file by
supplying the appropriate interpreter argument (e.g. "-pa"). Also see
the "code" module which is part of the Erlang distribution.


-Emile


From emile at rabbitmq.com  Mon Apr  2 10:57:32 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 02 Apr 2012 10:57:32 +0100
Subject: [rabbitmq-discuss] messages one at a time
In-Reply-To: <CAGWHYsZc7en15F+11Vq5u29k=hVv=V8k2x8Ja84iWFYt476CAg@mail.gmail.com>
References: <CAGWHYsZc7en15F+11Vq5u29k=hVv=V8k2x8Ja84iWFYt476CAg@mail.gmail.com>
Message-ID: <4F79780C.4060206@rabbitmq.com>

Hi Raoul,

On 02/04/12 09:37, Raoul Buzziol wrote:
> I'm looking for a way to consume messages from a queue by multiple
> consumer one at a time. The queue should deliver a new message only
> after an ack.

I'd be interested to understand your motivation for wanting multiple
consumers consuming from a queue, but only allow one consumer to hold an
unacknowledged message at a time. You will get equivalent performance to
having only one consumer.


-Emile





From emile at rabbitmq.com  Mon Apr  2 11:22:29 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 02 Apr 2012 11:22:29 +0100
Subject: [rabbitmq-discuss] Firehose Tracer
In-Reply-To: <CAHZsVQbEwmpw_8es6dOjOF=JkiysmdOUV=nUFWyH5b_GQtc4CQ@mail.gmail.com>
References: <CAHZsVQbEwmpw_8es6dOjOF=JkiysmdOUV=nUFWyH5b_GQtc4CQ@mail.gmail.com>
Message-ID: <4F797DE5.9020409@rabbitmq.com>


Hi Brendan,

On 31/03/12 13:27, Brendan Hay wrote:
> I'm currently investigating the feasibility of storing/journaling a
> stream of events that is delivered via rabbit. The firehose tracer would
> be ideal for this, but it has a big fat disclaimer about performance
> implications.

The firehose tracer sounds like the right solution and you should try
that first and determine whether the performance penalty is acceptable.

Another option that you can consider is to connect all peers via a
protocol analyser or to record all network traffic on the AMQP port.
This solution assumes all clients connect over the network (which is not
true for the Erlang direct client) and that they all use AMQP (and not
STOMP, for example).

See http://www.rabbitmq.com/javadoc/com/rabbitmq/tools/Tracer.html

-Emile




From agilefreak1 at gmail.com  Mon Apr  2 10:27:57 2012
From: agilefreak1 at gmail.com (agilefreak1)
Date: Mon, 2 Apr 2012 02:27:57 -0700 (PDT)
Subject: [rabbitmq-discuss] dead letter queue example
Message-ID: <e9413180-0596-4379-86ef-1475da34d102@s27g2000yqd.googlegroups.com>

Hi guys,

As you guys know, RabbitMQ recently added a support for Dead Letter
Exchanges (http://www.rabbitmq.com/extensions.html#dead-letter-
exchanges) in version 2.8.1.

I would like to implement dead letter queue in our application. I am
wondering has anyone already implemented dead letter and would love to
share some basic code and best practice with me. I am using C# but I
welcome code in any language.

Thanks,

Naz Ali


From agilefreak1 at gmail.com  Mon Apr  2 11:06:43 2012
From: agilefreak1 at gmail.com (agilefreak1)
Date: Mon, 2 Apr 2012 03:06:43 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ Dead Letter Queue Example
Message-ID: <13972244.23.1333361203160.JavaMail.geo-discussion-forums@ynlp6>

Hi guys,

As you guys know, RabbitMQ recently added a support for Dead Letter
Exchanges (http://www.rabbitmq.com/extensions.html#dead-letter-
exchanges) in version 2.8.1.

I would like to implement dead letter queue in our application. I am
wondering has anyone already implemented dead letter and would love to
share some basic code and best practice with me. I am using C# but I
welcome code in any language.

Thanks,

Naz Ali 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120402/ef05183b/attachment.htm>

From steve at rabbitmq.com  Mon Apr  2 11:29:31 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Mon, 2 Apr 2012 11:29:31 +0100
Subject: [rabbitmq-discuss] [bug] umbrella common.mk
In-Reply-To: <jl74o6$o37$1@dough.gmane.org>
References: <jl74o6$o37$1@dough.gmane.org>
Message-ID: <F24B04A2-BE8B-4135-81CB-FC21C08BB5AB@rabbitmq.com>

Works for me.
Of course, we may not be using the same set-up; but I can't tell can I?
Are you following the instructions on http://www.rabbitmq.com/build-server.html ?

Our bugzilla is not completely open (yet) so unless you have the right privileges you cannot raise a bug.

If you *could* raise one, we would expect:

-  your platform details (OS/version/patches)
-  your installation details (RabbitMQ version/Erlang version)
-  your directory structure (sounds like yours is non-standard)
-  your command sequence (that failed)
-  what you expected (I know, this is obvious in this case)
-  what actually happened, including as much of the log/console
   output as is humanly possible.

Since you cannot, then putting those details here (minus dumps -- 
please don't put dumps on the mailing list) would be a great help.

Thank you.

Steve Powell  (a distant bunny)
----------some more definitions from the SPD----------
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.
literacy (n.) A textually transmitted disease usually contracted in childhood.

On 31 Mar 2012, at 15:35, Matwey V. Kornilov wrote:

> 
> Hi,
> 
> When I try to build RabbitMQ from sources (rabbitmq-server-2.8.1.tar.gz) 
> placed in directory which name contains a colon, common.mk fails with:
> 
> common.mk:87: *** target pattern contains no `%'.  Stop.
> 
> 
> It seems that variable names at lines 87:89 should be escaped in some way.
> 
> 
> p.s. I've not found a way how to report a bug. bugzilla.rabbitmq.com works 
> strangely for me. There aren't any products to fill a new report.
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From emile at rabbitmq.com  Mon Apr  2 11:37:53 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 02 Apr 2012 11:37:53 +0100
Subject: [rabbitmq-discuss] [bug] umbrella common.mk
In-Reply-To: <jl74o6$o37$1@dough.gmane.org>
References: <jl74o6$o37$1@dough.gmane.org>
Message-ID: <4F798181.8040400@rabbitmq.com>

Hi Matwey,

On 31/03/12 15:35, Matwey V. Kornilov wrote:
> When I try to build RabbitMQ from sources (rabbitmq-server-2.8.1.tar.gz) 
> placed in directory which name contains a colon, common.mk fails with:

This problem won't arise on Unix filesystems, because colon acts as a
pathseparator. Unfortunately the RabbitMQ build system will not work on
Windows, even when using CygWin. The obstacles are not only filesystem
conventions but differences in how escript behaves on Windows.

> p.s. I've not found a way how to report a bug. bugzilla.rabbitmq.com works 
> strangely for me. There aren't any products to fill a new report.

Bug reports are gladly received on this mailing list.


-Emile




From brendan at soundcloud.com  Mon Apr  2 12:01:01 2012
From: brendan at soundcloud.com (Brendan Hay)
Date: Mon, 2 Apr 2012 13:01:01 +0200
Subject: [rabbitmq-discuss] Firehose Tracer
In-Reply-To: <4F797DE5.9020409@rabbitmq.com>
References: <CAHZsVQbEwmpw_8es6dOjOF=JkiysmdOUV=nUFWyH5b_GQtc4CQ@mail.gmail.com>
	<4F797DE5.9020409@rabbitmq.com>
Message-ID: <CAHZsVQY=31sGn=1hDLEUCmfTYW9OehkzxPO8kCUWv95743L4pQ@mail.gmail.com>

Thanks, Emile. I'll perform some tests/analysis.

On Mon, Apr 2, 2012 at 12:22 PM, Emile Joubert <emile at rabbitmq.com> wrote:

>
> Hi Brendan,
>
> On 31/03/12 13:27, Brendan Hay wrote:
> > I'm currently investigating the feasibility of storing/journaling a
> > stream of events that is delivered via rabbit. The firehose tracer would
> > be ideal for this, but it has a big fat disclaimer about performance
> > implications.
>
> The firehose tracer sounds like the right solution and you should try
> that first and determine whether the performance penalty is acceptable.
>
> Another option that you can consider is to connect all peers via a
> protocol analyser or to record all network traffic on the AMQP port.
> This solution assumes all clients connect over the network (which is not
> true for the Erlang direct client) and that they all use AMQP (and not
> STOMP, for example).
>
> See http://www.rabbitmq.com/javadoc/com/rabbitmq/tools/Tracer.html
>
> -Emile
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120402/89e77f49/attachment.htm>

From matwey.kornilov at gmail.com  Mon Apr  2 12:07:43 2012
From: matwey.kornilov at gmail.com (Matwey V.  Kornilov)
Date: Mon, 02 Apr 2012 15:07:43 +0400
Subject: [rabbitmq-discuss] [bug] umbrella common.mk
References: <jl74o6$o37$1@dough.gmane.org>
	<F24B04A2-BE8B-4135-81CB-FC21C08BB5AB@rabbitmq.com>
Message-ID: <jlc19v$g9d$1@dough.gmane.org>


Hi Steve, Emile,

* Platform details/Installation details:

My OS: openSUSE 12.1, GNU Make 3.82, Erlang/OTP R15B,
x86 cpu, reiserfs 3.6 filesystem.
I am trying to compile RabbitMQ 2.8.1 from source package.

* Directory details/Command sequence/What happens:

matwey@?:~/temp/my:test:dir> pwd
/home/matwey/temp/my:test:dir
matwey@?:~/temp/my:test:dir> wget http://www.rabbitmq.com/releases/rabbitmq-server/v2.8.1/rabbitmq-server-2.8.1.tar.gz
<<I've skipped wget output>>
2012-04-02 14:53:16 (475 KB/s) - `rabbitmq-server-2.8.1.tar.gz' saved [2644402/2644402]

matwey@?:~/temp/my:test:dir> tar -zxf rabbitmq-server-2.8.1.tar.gz 
matwey@?:~/temp/my:test:dir> cd rabbitmq-server-2.8.1/
matwey@?:~/temp/my:test:dir/rabbitmq-server-2.8.1> make
python codegen.py body codegen/amqp-rabbitmq-0.9.1.json src/rabbit_framing_amqp_0_9_1.erl
python codegen.py body codegen/amqp-rabbitmq-0.8.json src/rabbit_framing_amqp_0_8.erl
<<I've skipped erlang compiling>>
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin src/rabbit_channel.erl
[ -d "plugins-src/rabbitmq-server" ] || ln -s "/home/matwey/temp/my:test:dir/rabbitmq-server-2.8.1" "plugins-src/rabbitmq-server"
mkdir -p plugins
PLUGINS_SRC_DIR="" make -C "plugins-src" plugins-dist PLUGINS_DIST_DIR="/home/matwey/temp/my:test:dir/rabbitmq-server-2.8.1/plugins" VERSION=0.0.0
make[1]: Entering directory `/home/matwey/temp/my:test:dir/rabbitmq-server-2.8.1/plugins-src'
make -f all-packages.mk all-releasable VERSION=0.0.0
make[2]: Entering directory `/home/matwey/temp/my:test:dir/rabbitmq-server-2.8.1/plugins-src'
common.mk:87: *** target pattern contains no `%'.  Stop.
make[2]: Leaving directory `/home/matwey/temp/my:test:dir/rabbitmq-server-2.8.1/plugins-src'
make[1]: *** [release] Error 2
make[1]: Leaving directory `/home/matwey/temp/my:test:dir/rabbitmq-server-2.8.1/plugins-src'
make: *** [plugins] Error 2

* What I expected:

matwey@?:~/temp/dir_wo_columns> pwd
/home/matwey/temp/dir_wo_columns
matwey@?:~/temp/dir_wo_columns> wget http://www.rabbitmq.com/releases/rabbitmq-server/v2.8.1/rabbitmq-server-2.8.1.tar.gz
<<I've skipped wget output>>
2012-04-02 14:58:30 (425 KB/s) - `rabbitmq-server-2.8.1.tar.gz' saved [2644402/2644402]

matwey@?:~/temp/dir_wo_columns> tar -zxf rabbitmq-server-2.8.1.tar.gz 
matwey@?:~/temp/dir_wo_columns> cd rabbitmq-server-2.8.1/
matwey@?:~/temp/dir_wo_columns/rabbitmq-server-2.8.1> make
python codegen.py body codegen/amqp-rabbitmq-0.9.1.json src/rabbit_framing_amqp_0_9_1.erl
python codegen.py body codegen/amqp-rabbitmq-0.8.json src/rabbit_framing_amqp_0_8.erl
<<I've skipped erlang compiling>>
erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin src/rabbit_channel.erl
[ -d "plugins-src/rabbitmq-server" ] || ln -s "/home/matwey/temp/dir_wo_columns/rabbitmq-server-2.8.1" "plugins-src/rabbitmq-server"
mkdir -p plugins
PLUGINS_SRC_DIR="" make -C "plugins-src" plugins-dist PLUGINS_DIST_DIR="/home/matwey/temp/dir_wo_columns/rabbitmq-server-2.8.1/plugins" VERSION=0.0.0
make[1]: Entering directory `/home/matwey/temp/dir_wo_columns/rabbitmq-server-2.8.1/plugins-src'
make -f all-packages.mk all-releasable VERSION=0.0.0
make[2]: Entering directory `/home/matwey/temp/dir_wo_columns/rabbitmq-server-2.8.1/plugins-src'
[elided] generate deps
[elided] fix test deps
<<I've skipped plugins building>>
cp rabbitmq-auth-mechanism-ssl/dist/*.ez /home/matwey/temp/dir_wo_columns/rabbitmq-server-2.8.1/plugins
make[2]: Leaving directory `/home/matwey/temp/dir_wo_columns/rabbitmq-server-2.8.1/plugins-src'
make[1]: Leaving directory `/home/matwey/temp/dir_wo_columns/rabbitmq-server-2.8.1/plugins-src'
echo "Put your EZs here and use rabbitmq-plugins to enable them." > plugins/README
rm -f plugins/rabbit_common*.ez



From emile at rabbitmq.com  Mon Apr  2 12:42:00 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 02 Apr 2012 12:42:00 +0100
Subject: [rabbitmq-discuss] messages one at a time
In-Reply-To: <CAGWHYsZ-T_CzkU4sTu7-rOU2Uj-iMmZG60GQQw60KnTgUuHdsA@mail.gmail.com>
References: <CAGWHYsZc7en15F+11Vq5u29k=hVv=V8k2x8Ja84iWFYt476CAg@mail.gmail.com>
	<4F79780C.4060206@rabbitmq.com>
	<CAGWHYsZ-T_CzkU4sTu7-rOU2Uj-iMmZG60GQQw60KnTgUuHdsA@mail.gmail.com>
Message-ID: <4F799088.9070700@rabbitmq.com>

Hi Raoul,

On 02/04/12 11:34, Raoul Buzziol wrote:
> 2012/4/2 Emile Joubert <emile at rabbitmq.com <mailto:emile at rabbitmq.com>>
>     Hi Raoul,
> 
>     On 02/04/12 09:37, Raoul Buzziol wrote:
>     > I'm looking for a way to consume messages from a queue by multiple
>     > consumer one at a time. The queue should deliver a new message only
>     > after an ack.
> 
>     I'd be interested to understand your motivation for wanting multiple
>     consumers consuming from a queue, but only allow one consumer to hold an
>     unacknowledged message at a time. You will get equivalent performance to
>     having only one consumer.
> 
> 
> You're right, I will get equivalent performance.
> My requirement is that a kind of message cannot be precessed in
> parallel. With multiple consumer I can have a sort of failover, when one
> consumer goes away (or down) an other is already there.

You could publish messages with the immediate flag turned on. That will
alert the publisher if a destination queue lacks consumers and you can
use that information to start a new consumer. This is a possibly better
alternative to constantly polling queues to ensure that they all have
consumers.

-Emile


From allen.fowler at yahoo.com  Mon Apr  2 13:07:27 2012
From: allen.fowler at yahoo.com (Allen Fowler)
Date: Mon, 2 Apr 2012 05:07:27 -0700 (PDT)
Subject: [rabbitmq-discuss] |Spam|
Message-ID: <1333368447.28683.YahooMailMobile@web114017.mail.gq1.yahoo.com>

<a href="http://ectopicpregnancysymptomsite.com/wp-content/plugins/extended-comment-options/02gfns.html"> http://ectopicpregnancysymptomsite.com/wp-content/plugins/extended-comment-options/02gfns.html</a>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120402/4dd8f107/attachment.htm>

From simon at rabbitmq.com  Mon Apr  2 13:18:39 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 02 Apr 2012 13:18:39 +0100
Subject: [rabbitmq-discuss] Firehose Tracer
In-Reply-To: <CAHZsVQbEwmpw_8es6dOjOF=JkiysmdOUV=nUFWyH5b_GQtc4CQ@mail.gmail.com>
References: <CAHZsVQbEwmpw_8es6dOjOF=JkiysmdOUV=nUFWyH5b_GQtc4CQ@mail.gmail.com>
Message-ID: <4F79991F.2000507@rabbitmq.com>

On 31/03/12 13:27, Brendan Hay wrote:
> The firehose tracer would be ideal for this, but it has a big fat
> disclaimer about performance implications.

I should probably change that - the performance implications are not bad 
per se, it's just that you may end up publishing firehose messages for 
every publish / deliver (i.e. pretty much as you would expect).

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From brendan at soundcloud.com  Mon Apr  2 13:29:27 2012
From: brendan at soundcloud.com (Brendan Hay)
Date: Mon, 2 Apr 2012 14:29:27 +0200
Subject: [rabbitmq-discuss] Firehose Tracer
In-Reply-To: <4F79991F.2000507@rabbitmq.com>
References: <CAHZsVQbEwmpw_8es6dOjOF=JkiysmdOUV=nUFWyH5b_GQtc4CQ@mail.gmail.com>
	<4F79991F.2000507@rabbitmq.com>
Message-ID: <CAHZsVQaZ3MFVt_4XM-zKf5g1V5md6w2T+JWh9VYBdaKx4s04Jg@mail.gmail.com>

Good news, thanks. The next question would be is it possible to selectively
trace publish OR deliver, rather than both simultaneously?

On Mon, Apr 2, 2012 at 2:18 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 31/03/12 13:27, Brendan Hay wrote:
>
>> The firehose tracer would be ideal for this, but it has a big fat
>> disclaimer about performance implications.
>>
>
> I should probably change that - the performance implications are not bad
> per se, it's just that you may end up publishing firehose messages for
> every publish / deliver (i.e. pretty much as you would expect).
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120402/a32e21ac/attachment.htm>

From agilefreak1 at gmail.com  Mon Apr  2 13:42:02 2012
From: agilefreak1 at gmail.com (agilefreak1)
Date: Mon, 2 Apr 2012 05:42:02 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ Dead Letter Queue Example
In-Reply-To: <CAJreXKBZPb9Kh6DaCEPt75gDB1nYjLCqs2w4VJS17vLHEo9HZA@mail.gmail.com>
References: <13972244.23.1333361203160.JavaMail.geo-discussion-forums@ynlp6>
	<CAJreXKBZPb9Kh6DaCEPt75gDB1nYjLCqs2w4VJS17vLHEo9HZA@mail.gmail.com>
Message-ID: <10634281.11.1333370522690.JavaMail.geo-discussion-forums@vbga3>

Thank you James.

On Monday, April 2, 2012 1:14:09 PM UTC+1, James Carr wrote:
>
> Last week I posted an example of using x-message-ttl and
> dead-letter-exchange to queue messages to be delivered at a scheduled
> time: 
> http://blog.james-carr.org/2012/03/30/rabbitmq-sending-a-message-to-be-consumed-later/
>
> I'll be posting some further examples of using x-dead-letter-exchange
> later this week as it is a feature I've been waiting for. :)
>
> Thanks,
> James
>
>
> On Mon, Apr 2, 2012 at 5:06 AM, agilefreak1 <agilefreak1 at gmail.com> wrote:
> > Hi guys,
> >
> > As you guys know, RabbitMQ recently added a support for Dead Letter
> > Exchanges (http://www.rabbitmq.com/extensions.html#dead-letter-
> > exchanges) in version 2.8.1.
> >
> > I would like to implement dead letter queue in our application. I am
> > wondering has anyone already implemented dead letter and would love to
> > share some basic code and best practice with me. I am using C# but I
> > welcome code in any language.
> >
> > Thanks,
> >
> > Naz Ali
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120402/9819e7d6/attachment.htm>

From matthias at rabbitmq.com  Mon Apr  2 13:45:47 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 02 Apr 2012 13:45:47 +0100
Subject: [rabbitmq-discuss] question about rabbitmq TPS
In-Reply-To: <4d3eb23c.27a.13664b6ae4a.Coremail.chen-hongqin@163.com>
References: <3a89ddf9.1ca8b.1364eb77cb7.Coremail.chen-hongqin@163.com>	<CACOPnvf2BD2XbrRUCVkFiPBxuMGxPuKBN_9CiTK66EEhx14F9w@mail.gmail.com>	<748753f3.119e8.1365e930368.Coremail.chen-hongqin@163.com>	<CACOPnvcBs80g92nSY+dZ8Qq_Sp6Bs-74tpWkuD2yZDzU6iPU0w@mail.gmail.com>	<24d2e2c7.e065.1365eefa832.Coremail.chen-hongqin@163.com>	<CACOPnvdgmifbpzFKVFXOwGMxtNMd5t4RLF3rUW328iWYLwP6eA@mail.gmail.com>	<79f5636d.ec79.1365f77e4e3.Coremail.chen-hongqin@163.com>	<CACOPnvemYH6zcRuYeFTqDRuF9OMMCMDL93TStVPPN8Drbhh8+w@mail.gmail.com>
	<4d3eb23c.27a.13664b6ae4a.Coremail.chen-hongqin@163.com>
Message-ID: <4F799F7B.8080602@rabbitmq.com>

On 30/03/12 18:45, ?????? wrote:
> I have no ideas, but it happens when the number of queues is large(for
> example, 300 queues)

As well as the per-connection TCP buffers Simon mentioned in his answer 
(http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-March/019212.html), 
there are also per-queue buffers. This allows rabbit to cope with spikes 
in inbound message traffic. If an app just throws messages at rabbit as 
fast as it can, then the effect of these buffers is that you'll see a 
high rate for a brief initial period, while these buffers fill up, and 
then flow control throttles the rate down to what is sustainable.

Matthias.

From simon at rabbitmq.com  Mon Apr  2 14:29:13 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 02 Apr 2012 14:29:13 +0100
Subject: [rabbitmq-discuss] Firehose Tracer
In-Reply-To: <CAHZsVQaZ3MFVt_4XM-zKf5g1V5md6w2T+JWh9VYBdaKx4s04Jg@mail.gmail.com>
References: <CAHZsVQbEwmpw_8es6dOjOF=JkiysmdOUV=nUFWyH5b_GQtc4CQ@mail.gmail.com>	<4F79991F.2000507@rabbitmq.com>
	<CAHZsVQaZ3MFVt_4XM-zKf5g1V5md6w2T+JWh9VYBdaKx4s04Jg@mail.gmail.com>
Message-ID: <4F79A9A9.900@rabbitmq.com>

On 02/04/12 13:29, Brendan Hay wrote:
> Good news, thanks. The next question would be is it possible to
> selectively trace publish OR deliver, rather than both simultaneously?

Not at the moment (except through binding with the appropriate routing 
key). I would hope the cost of publishing delivery messages would not be 
too big an issue.

Let us know how you get on...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From steve at rabbitmq.com  Mon Apr  2 14:44:18 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Mon, 2 Apr 2012 14:44:18 +0100
Subject: [rabbitmq-discuss] [bug] umbrella common.mk
In-Reply-To: <jlc19v$g9d$1@dough.gmane.org>
References: <jl74o6$o37$1@dough.gmane.org>
	<F24B04A2-BE8B-4135-81CB-FC21C08BB5AB@rabbitmq.com>
	<jlc19v$g9d$1@dough.gmane.org>
Message-ID: <177DC886-3D76-4152-A97C-B0B3195BDD30@rabbitmq.com>

Matwey,

Thanks for raising this. I have managed to reproduce your problem (on
MacOS) -- almost.

My builds fail with lots of lines like this:

do-package.mk:507: warning: overriding commands for target `mochiweb-wrapper/dist/.done'
do-package.mk:507: warning: ignoring old commands for target `mochiweb-wrapper/dist/.done'

followed by:

rabbitmq-stomp/package.mk:31: *** target pattern contains no `%'.  Stop.
make[1]: *** [clean] Error 2
rm -f include/rabbit_framing.hrl src/rabbit_framing_amqp_*.erl codegen.pyc
rm -f docs/*.[0-9].gz docs/*.man.xml docs/*.erl     src/rabbit_ctl_usage.erl     src/rabbit_plugins_usage.erl
rm -f rabbit.plt
rm -f deps.mk

but then I have only one colon in my containing directory
(I used rabbitmq:build).

The problem is that rabbitmq's make uses full file paths as targets; and
colons are significant in dependency lines (target:sources). Hence the
rather cryptic error message from make. It also explains the overriding
noise I get: the colons interfere with target lines (they become wrong
ones) and the make dependency tree is tangled/confused. I'm not sure why
you don't get them, too (but maybe it depends exactly what your dir
containing colons is called).

To make the make referentially transparent wrt directory names is
probably more work than we will undertake; but the workaround is very
easy.

I'm sorry the advice is the doctor's one: if it hurts doing that -- then
don't do it.

If you feel strongly about this, then I'll raise a bug; but it is
unlikely to be fixed IMO.

Yours,
Steve Powell  (a droopy bunny)
----------some more definitions from the SPD----------
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.
literacy (n.) A textually transmitted disease usually contracted in childhood.

On 2 Apr 2012, at 12:07, Matwey V. Kornilov wrote:

> 
> Hi Steve, Emile,
> 
> * Platform details/Installation details:
> 
> My OS: openSUSE 12.1, GNU Make 3.82, Erlang/OTP R15B,
> x86 cpu, reiserfs 3.6 filesystem.
> I am trying to compile RabbitMQ 2.8.1 from source package.
> 
> * Directory details/Command sequence/What happens:
> 
> matwey@?:~/temp/my:test:dir> pwd
> /home/matwey/temp/my:test:dir
> matwey@?:~/temp/my:test:dir> wget http://www.rabbitmq.com/releases/rabbitmq-server/v2.8.1/rabbitmq-server-2.8.1.tar.gz
> <<I've skipped wget output>>
> 2012-04-02 14:53:16 (475 KB/s) - `rabbitmq-server-2.8.1.tar.gz' saved [2644402/2644402]
> 
> matwey@?:~/temp/my:test:dir> tar -zxf rabbitmq-server-2.8.1.tar.gz 
> matwey@?:~/temp/my:test:dir> cd rabbitmq-server-2.8.1/
> matwey@?:~/temp/my:test:dir/rabbitmq-server-2.8.1> make
> python codegen.py body codegen/amqp-rabbitmq-0.9.1.json src/rabbit_framing_amqp_0_9_1.erl
> python codegen.py body codegen/amqp-rabbitmq-0.8.json src/rabbit_framing_amqp_0_8.erl
> <<I've skipped erlang compiling>>
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin src/rabbit_channel.erl
> [ -d "plugins-src/rabbitmq-server" ] || ln -s "/home/matwey/temp/my:test:dir/rabbitmq-server-2.8.1" "plugins-src/rabbitmq-server"
> mkdir -p plugins
> PLUGINS_SRC_DIR="" make -C "plugins-src" plugins-dist PLUGINS_DIST_DIR="/home/matwey/temp/my:test:dir/rabbitmq-server-2.8.1/plugins" VERSION=0.0.0
> make[1]: Entering directory `/home/matwey/temp/my:test:dir/rabbitmq-server-2.8.1/plugins-src'
> make -f all-packages.mk all-releasable VERSION=0.0.0
> make[2]: Entering directory `/home/matwey/temp/my:test:dir/rabbitmq-server-2.8.1/plugins-src'
> common.mk:87: *** target pattern contains no `%'.  Stop.
> make[2]: Leaving directory `/home/matwey/temp/my:test:dir/rabbitmq-server-2.8.1/plugins-src'
> make[1]: *** [release] Error 2
> make[1]: Leaving directory `/home/matwey/temp/my:test:dir/rabbitmq-server-2.8.1/plugins-src'
> make: *** [plugins] Error 2
> 
> * What I expected:
> 
> matwey@?:~/temp/dir_wo_columns> pwd
> /home/matwey/temp/dir_wo_columns
> matwey@?:~/temp/dir_wo_columns> wget http://www.rabbitmq.com/releases/rabbitmq-server/v2.8.1/rabbitmq-server-2.8.1.tar.gz
> <<I've skipped wget output>>
> 2012-04-02 14:58:30 (425 KB/s) - `rabbitmq-server-2.8.1.tar.gz' saved [2644402/2644402]
> 
> matwey@?:~/temp/dir_wo_columns> tar -zxf rabbitmq-server-2.8.1.tar.gz 
> matwey@?:~/temp/dir_wo_columns> cd rabbitmq-server-2.8.1/
> matwey@?:~/temp/dir_wo_columns/rabbitmq-server-2.8.1> make
> python codegen.py body codegen/amqp-rabbitmq-0.9.1.json src/rabbit_framing_amqp_0_9_1.erl
> python codegen.py body codegen/amqp-rabbitmq-0.8.json src/rabbit_framing_amqp_0_8.erl
> <<I've skipped erlang compiling>>
> erlc -I include -o ebin -Wall -v +debug_info -Duse_specs  -pa ebin src/rabbit_channel.erl
> [ -d "plugins-src/rabbitmq-server" ] || ln -s "/home/matwey/temp/dir_wo_columns/rabbitmq-server-2.8.1" "plugins-src/rabbitmq-server"
> mkdir -p plugins
> PLUGINS_SRC_DIR="" make -C "plugins-src" plugins-dist PLUGINS_DIST_DIR="/home/matwey/temp/dir_wo_columns/rabbitmq-server-2.8.1/plugins" VERSION=0.0.0
> make[1]: Entering directory `/home/matwey/temp/dir_wo_columns/rabbitmq-server-2.8.1/plugins-src'
> make -f all-packages.mk all-releasable VERSION=0.0.0
> make[2]: Entering directory `/home/matwey/temp/dir_wo_columns/rabbitmq-server-2.8.1/plugins-src'
> [elided] generate deps
> [elided] fix test deps
> <<I've skipped plugins building>>
> cp rabbitmq-auth-mechanism-ssl/dist/*.ez /home/matwey/temp/dir_wo_columns/rabbitmq-server-2.8.1/plugins
> make[2]: Leaving directory `/home/matwey/temp/dir_wo_columns/rabbitmq-server-2.8.1/plugins-src'
> make[1]: Leaving directory `/home/matwey/temp/dir_wo_columns/rabbitmq-server-2.8.1/plugins-src'
> echo "Put your EZs here and use rabbitmq-plugins to enable them." > plugins/README
> rm -f plugins/rabbit_common*.ez
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From simon at rabbitmq.com  Mon Apr  2 15:03:33 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 02 Apr 2012 15:03:33 +0100
Subject: [rabbitmq-discuss] rabbitmq-server start not responding
In-Reply-To: <4F795D7B.7070408@gmail.com>
References: <4F795D7B.7070408@gmail.com>
Message-ID: <4F79B1B5.9090106@rabbitmq.com>

On 02/04/12 09:04, Christos Stavrakakis wrote:
> I am running two RabbitMQ 2.8.0-1 servers in cluster mode. After killing
> the one server (kill -9),
> I try to start it again with '/etc/init.d/rabbitmq-server start'.
> Although the server seems to be working (I can see
> it from the management plugin and I can send and receive messages) this
> command never returns.
> I looked at the rabbitmq-server script and I see that the program hangs
> on the rabbitmqctl wait $PID_FILE command.

Well, possibly. That *should* work.

"rabbitmqctl wait $PID_FILE" is supposed to wait around until the server 
has started (so that by the time "/etc/init.d/rabbitmq-server start" 
returns you have a working rabbit). It will wait indefinitely for

* The PID file to be written.
* The PID in question to be an Erlang VM on which the rabbit application 
has been started.

So did the first one happen? Does the PID file exist, and does it 
contain the PId of the Erlang VM?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Mon Apr  2 15:09:21 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 02 Apr 2012 15:09:21 +0100
Subject: [rabbitmq-discuss] Testing Shovel on a WAN
In-Reply-To: <C3481B5CE3E61E438EEF6143B51DC17F66A0C7D502@Y000IIIV01.rd1.rf1>
References: <C3481B5CE3E61E438EEF6143B51DC17F66A0C1C356@Y000IIIV01.rd1.rf1>
	<4F7334D7.6030709@rabbitmq.com>
	<C3481B5CE3E61E438EEF6143B51DC17F66A0C7D19B@Y000IIIV01.rd1.rf1>
	<4F75CD8A.2020207@rabbitmq.com>
	<C3481B5CE3E61E438EEF6143B51DC17F66A0C7D502@Y000IIIV01.rd1.rf1>
Message-ID: <4F79B311.1050702@rabbitmq.com>

On 02/04/12 09:34, MELIQUE Denis (MORPHO) wrote:
> Reading RabbitMQ web site, I now have the feeling that federation is going to be the
> recommended solution, for my kind of application (multi-site through a WAN)
> Am I right ?

That depends. Federation is going to evolve more, and for pub-sub 
messaging it should certainly be easier. Shovel is likely to stay 
roughly where it is; a fairly low level tool that just moves messages 
from place to place. Both solve the multi-site / WAN problem, in 
different ways. Which is more appropriate for your needs depends on what 
your needs are...

Cheers, simon

-- 
Simon MacMullen
RabbitMQ, VMware

From rcrespopanizo at gmail.com  Mon Apr  2 15:26:44 2012
From: rcrespopanizo at gmail.com (Rabbit001)
Date: Mon, 2 Apr 2012 07:26:44 -0700 (PDT)
Subject: [rabbitmq-discuss] Client connection to ssl rabbitMQ is very slow
Message-ID: <33544994.post@talk.nabble.com>


Hi everybody,

  I've follow the ssl configuration instructions in rabbitmq page
'www.rabbitmq.com/ssl.html' to configure ssl access to rabbitmq server. I've
started rabbitmq server correctly and I've executed the example1 (sample
code for ssl java client) and the result is good, but the method
factory.newConnection() finish over 5sg. In the other hand, without ssl  the
method factory.newConnection() finish in <200 ms.

  How do i increasse the performance in the first scenario (ssl
configuration)? any idea?

Tks,
-- 
View this message in context: http://old.nabble.com/Client-connection-to-ssl-rabbitMQ-is-very-slow-tp33544994p33544994.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From stavr.chris at gmail.com  Mon Apr  2 15:34:20 2012
From: stavr.chris at gmail.com (Christos Stavrakakis)
Date: Mon, 02 Apr 2012 17:34:20 +0300
Subject: [rabbitmq-discuss] rabbitmq-server start not responding
In-Reply-To: <4F79B1B5.9090106@rabbitmq.com>
References: <4F795D7B.7070408@gmail.com> <4F79B1B5.9090106@rabbitmq.com>
Message-ID: <4F79B8EC.4000401@gmail.com>

On 04/02/2012 05:03 PM, Simon MacMullen wrote:
> On 02/04/12 09:04, Christos Stavrakakis wrote:
>> I am running two RabbitMQ 2.8.0-1 servers in cluster mode. After killing
>> the one server (kill -9),
>> I try to start it again with '/etc/init.d/rabbitmq-server start'.
>> Although the server seems to be working (I can see
>> it from the management plugin and I can send and receive messages) this
>> command never returns.
>> I looked at the rabbitmq-server script and I see that the program hangs
>> on the rabbitmqctl wait $PID_FILE command.
>
> Well, possibly. That *should* work.
>
> "rabbitmqctl wait $PID_FILE" is supposed to wait around until the 
> server has started (so that by the time "/etc/init.d/rabbitmq-server 
> start" returns you have a working rabbit). It will wait indefinitely for
>
> * The PID file to be written.
> * The PID in question to be an Erlang VM on which the rabbit 
> application has been started.
>
> So did the first one happen? Does the PID file exist, and does it 
> contain the PId of the Erlang VM?
>
> Cheers, Simon
>

Ok that makes sense! I finally found that my system had not a rabbitmq 
group and user, which is required. My mistake.

Thanks,
Chris


From steve at rabbitmq.com  Mon Apr  2 16:13:10 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Mon, 2 Apr 2012 16:13:10 +0100
Subject: [rabbitmq-discuss] RabbitMQ Java Client - Defect 24723 - Memory
	leak
In-Reply-To: <B4E959105FBF514F9500B9A20310D5BD027ED7A5E0@PPC-EMAIL.purchasingpwr.com>
References: <B4E959105FBF514F9500B9A20310D5BD027ED7A5E0@PPC-EMAIL.purchasingpwr.com>
Message-ID: <7E254AC0-7D01-4286-9A16-C41370DDF5E5@rabbitmq.com>

Hi Scott,

The original problem was due to the failure of the Java client to free
up the resources associated with the Consumer callbacks on a channel.

This was fixed by putting in a clean-up call (in
handleShutdownSignal()); but it is just possible that this is not being
called in some circumstances.

Can you tell us more about how the channels are being closed? How many
channels are created for the messages you are sending in the
sustainability tests?

In the bug you cite, the reported used the following mechanism to
analyse the memory usage:

Get process id <pid> and do the following:

 jmap -dump:format=b,file=yo.bin <pid>
 jhat jhat -J-mx768m -stack false yo.bin

Once jhat brings up http server, go here:

 http://localhost:7000/showInstanceCounts/

The original problem was the WorkPool object holding on to all the
channels after they were closed. This looks extremely similar, but the
bug was fixed in 2.7.1, so you may have found a bug in the fix.

Steve Powell  (a silly bunny)
----------some more definitions from the SPD----------
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.
literacy (n.) A textually transmitted disease usually contracted in childhood.

On 28 Mar 2012, at 20:21, Scott Garten wrote:

> Hi all,
>  
> This morning started out with an OutOfMemory exception after I kicked off a sustainability test before I left the office for the day; digging into it we found a number of classes failing to free up. They appear to correlate to the number of messages that we sent to rabbitmq. A web search revealed a defect # 24723 was identified and reported fixed.
>  
> We were using 2.7.1 of the Java client, but since have also tried 2.8.0 and 2.8.1 of the client ? hoping that one of these later releases contained a fix. Unfortunately, we are still seeing the same memory leak behavior.
>  
> Here is a jmap dump of the classes that we witness not freeing (even after an explicit GC).
>  
>   19:          1979         189984  com.rabbitmq.client.impl.ChannelN
>   28:          1980          79200  com.rabbitmq.client.impl.CommandAssembler
>   29:          1979          79160  com.rabbitmq.client.ShutdownSignalException
>   30:          1979          79160  com.rabbitmq.client.impl.ConsumerDispatcher
>   35:          1979          63328  com.rabbitmq.client.impl.AMQImpl$Channel$Close
>   48:          1980          31680  com.rabbitmq.client.impl.AMQCommand
>  
> Appears to be similar to that which was previously reported on the mailing list.
>  
> Not certain where to turn at this point. Can anyone confirm that they see the fix freeing up the objects?
>  
> Thanks, Scott.
> 
> 
> ====================
> The information contained in this transmission is confidential. It is intended solely for the use of the individual(s) or organization(s) to whom it is addressed. Any disclosure, copying or further distribution is not permitted unless such privilege is explicitly granted in writing by Purchasing Power LLC. Furthermore, Purchasing Power LLC.. is not responsible for the proper and complete transmission of the substance of this communication, nor for any delay in its receipt. 
> ----------------------------------------------------- 
> All outgoing emails are scanned for viruses by Barracuda Spam Firewall   ??  _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From steve at rabbitmq.com  Mon Apr  2 16:15:02 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Mon, 2 Apr 2012 16:15:02 +0100
Subject: [rabbitmq-discuss] Generation of AMQP.java failed Error
In-Reply-To: <AC78983C72177B4D9D1C14F7F4AEBA21431F787DDA@aplesstripe.dom1.jhuapl.edu>
References: <AC78983C72177B4D9D1C14F7F4AEBA21431AFAB1A0@aplesstripe.dom1.jhuapl.edu>
	<4F743644.7000908@rabbitmq.com>,
	<CDE5BF8D-2A99-4CAB-9546-463AEE7ADE75@rabbitmq.com>
	<AC78983C72177B4D9D1C14F7F4AEBA21431F787DDA@aplesstripe.dom1.jhuapl.edu>
Message-ID: <1328E76D-52F7-4B0E-84C0-03234FE635D2@rabbitmq.com>

yr welcome.

Steve Powell  (a happy bunny)

On 2 Apr 2012, at 15:47, Wojcik, Robert C. wrote:

> Ok, thanks, I will switch to my Python 2.6 path.
> 
> - v/r
>    Bob W.
> ________________________________________
> ...more stuff...

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120402/ff8e9437/attachment.htm>

From sgarten at purchasingpower.com  Mon Apr  2 16:20:42 2012
From: sgarten at purchasingpower.com (Scott Garten)
Date: Mon, 2 Apr 2012 11:20:42 -0400
Subject: [rabbitmq-discuss] RabbitMQ Java Client - Defect 24723 - Memory
 leak
In-Reply-To: <7E254AC0-7D01-4286-9A16-C41370DDF5E5@rabbitmq.com>
References: <B4E959105FBF514F9500B9A20310D5BD027ED7A5E0@PPC-EMAIL.purchasingpwr.com>
	<7E254AC0-7D01-4286-9A16-C41370DDF5E5@rabbitmq.com>
Message-ID: <B4E959105FBF514F9500B9A20310D5BD027ED7ABD2@PPC-EMAIL.purchasingpwr.com>

Thanks for replying Steve. We played around with it a bunch, we checked our versions and found that the client and server version were out of sync. We updated everything (Java client [was 2.7.1] and the RabbitMQ server version [was 2.7.9]) to the latest (2.8.1) and reran the tests and found that the issue was resolved. Magic!

-----Original Message-----
From: Steve Powell [mailto:steve at rabbitmq.com] 
Sent: Monday, April 02, 2012 11:13 AM
To: Scott Garten
Cc: RabbitMQ List
Subject: Re: [rabbitmq-discuss] RabbitMQ Java Client - Defect 24723 - Memory leak

Hi Scott,

The original problem was due to the failure of the Java client to free up the resources associated with the Consumer callbacks on a channel.

This was fixed by putting in a clean-up call (in handleShutdownSignal()); but it is just possible that this is not being called in some circumstances.

Can you tell us more about how the channels are being closed? How many channels are created for the messages you are sending in the sustainability tests?

In the bug you cite, the reported used the following mechanism to analyse the memory usage:

Get process id <pid> and do the following:

 jmap -dump:format=b,file=yo.bin <pid>
 jhat jhat -J-mx768m -stack false yo.bin

Once jhat brings up http server, go here:

 http://localhost:7000/showInstanceCounts/

The original problem was the WorkPool object holding on to all the channels after they were closed. This looks extremely similar, but the bug was fixed in 2.7.1, so you may have found a bug in the fix.

Steve Powell  (a silly bunny)
----------some more definitions from the SPD---------- chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.
literacy (n.) A textually transmitted disease usually contracted in childhood.

On 28 Mar 2012, at 20:21, Scott Garten wrote:

> Hi all,
>  
> This morning started out with an OutOfMemory exception after I kicked off a sustainability test before I left the office for the day; digging into it we found a number of classes failing to free up. They appear to correlate to the number of messages that we sent to rabbitmq. A web search revealed a defect # 24723 was identified and reported fixed.
>  
> We were using 2.7.1 of the Java client, but since have also tried 2.8.0 and 2.8.1 of the client - hoping that one of these later releases contained a fix. Unfortunately, we are still seeing the same memory leak behavior.
>  
> Here is a jmap dump of the classes that we witness not freeing (even after an explicit GC).
>  
>   19:          1979         189984  com.rabbitmq.client.impl.ChannelN
>   28:          1980          79200  com.rabbitmq.client.impl.CommandAssembler
>   29:          1979          79160  com.rabbitmq.client.ShutdownSignalException
>   30:          1979          79160  com.rabbitmq.client.impl.ConsumerDispatcher
>   35:          1979          63328  com.rabbitmq.client.impl.AMQImpl$Channel$Close
>   48:          1980          31680  com.rabbitmq.client.impl.AMQCommand
>  
> Appears to be similar to that which was previously reported on the mailing list.
>  
> Not certain where to turn at this point. Can anyone confirm that they see the fix freeing up the objects?
>  
> Thanks, Scott.
> 
> 
> ====================
> The information contained in this transmission is confidential. It is intended solely for the use of the individual(s) or organization(s) to whom it is addressed. Any disclosure, copying or further distribution is not permitted unless such privilege is explicitly granted in writing by Purchasing Power LLC. Furthermore, Purchasing Power LLC.. is not responsible for the proper and complete transmission of the substance of this communication, nor for any delay in its receipt. 
> ----------------------------------------------------- 
> All outgoing emails are scanned for viruses by Barracuda Spam Firewall     _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


The information contained in this transmission is confidential. It is intended solely for the use of the individual(s) or organization(s) to whom it is addressed. Any disclosure, copying or further distribution is not permitted unless such privilege is explicitly granted in writing by Purchasing Power LLC. Furthermore, Purchasing Power LLC.. is not responsible for the proper and complete transmission of the substance of this communication, nor for any delay in its receipt. 

All outgoing emails are scanned for viruses by Barracuda Spam Firewall.

From kitty8thelogic at gmail.com  Mon Apr  2 16:37:46 2012
From: kitty8thelogic at gmail.com (Krati Gupta)
Date: Mon, 2 Apr 2012 08:37:46 -0700 (PDT)
Subject: [rabbitmq-discuss] How to send messages from rabbitmq to topic of
	weblogic
Message-ID: <daeda155-9d62-47da-8946-859e799bf3b7@a8g2000pbe.googlegroups.com>

please tell me how to send messages from rabbitmq to topic of weblogic

From matwey.kornilov at gmail.com  Mon Apr  2 16:50:10 2012
From: matwey.kornilov at gmail.com (Matwey V.  Kornilov)
Date: Mon, 02 Apr 2012 19:50:10 +0400
Subject: [rabbitmq-discuss] [bug] umbrella common.mk
References: <jl74o6$o37$1@dough.gmane.org>
	<F24B04A2-BE8B-4135-81CB-FC21C08BB5AB@rabbitmq.com>
	<jlc19v$g9d$1@dough.gmane.org>
	<177DC886-3D76-4152-A97C-B0B3195BDD30@rabbitmq.com>
Message-ID: <jlchrc$sve$1@dough.gmane.org>


Frankly speaking, I was playing with building RPM for rabbitmq at opensuse 
build service. Maybe you know, when I checkout the package, it creates 
directory like 'home:matwey:branches:network:messaging:amqp/rabbitmq-server' 
where sources tarballs and specs are placed.

So, I unpacked the sources tar.gz archive and tried to build it by hands in 
order to understand how to improve spec-file for newer version. Then I got 
this bug.

It took me about an hour to understand the roots of problem, because, as you 
said, the message was 'cryptic'.

If fixing that is too complicated, it is ok. But please, add at least human-
understandable message to avoid futher problems.



Steve Powell wrote:

> I'm sorry the advice is the doctor's one: if it hurts doing that -- then
> don't do it.
> 
> If you feel strongly about this, then I'll raise a bug; but it is
> unlikely to be fixed IMO.



From steve at rabbitmq.com  Mon Apr  2 16:53:04 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Mon, 2 Apr 2012 16:53:04 +0100
Subject: [rabbitmq-discuss] RabbitMQ Java Client - Defect 24723 - Memory
	leak
In-Reply-To: <B4E959105FBF514F9500B9A20310D5BD027ED7ABD2@PPC-EMAIL.purchasingpwr.com>
References: <B4E959105FBF514F9500B9A20310D5BD027ED7A5E0@PPC-EMAIL.purchasingpwr.com>
	<7E254AC0-7D01-4286-9A16-C41370DDF5E5@rabbitmq.com>
	<B4E959105FBF514F9500B9A20310D5BD027ED7ABD2@PPC-EMAIL.purchasingpwr.com>
Message-ID: <1A35D013-8A20-4DBF-BB85-9D757A6A347F@rabbitmq.com>

That's a relief.  Sorry it took so long to get back to you.

Steve Powell  (a happy bunny)
----------some more definitions from the SPD----------
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.
literacy (n.) A textually transmitted disease usually contracted in childhood.

On 2 Apr 2012, at 16:20, Scott Garten wrote:

> Thanks for replying Steve. We played around with it a bunch, we checked our versions and found that the client and server version were out of sync. We updated everything (Java client [was 2.7.1] and the RabbitMQ server version [was 2.7.9]) to the latest (2.8.1) and reran the tests and found that the issue was resolved. Magic!
> 
> -----Original Message-----
> From: Steve Powell [mailto:steve at rabbitmq.com]
> (elided)

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120402/862af0eb/attachment.htm>

From steve at rabbitmq.com  Mon Apr  2 17:01:05 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Mon, 2 Apr 2012 17:01:05 +0100
Subject: [rabbitmq-discuss] [bug] umbrella common.mk
In-Reply-To: <jlchrc$sve$1@dough.gmane.org>
References: <jl74o6$o37$1@dough.gmane.org>
	<F24B04A2-BE8B-4135-81CB-FC21C08BB5AB@rabbitmq.com>
	<jlc19v$g9d$1@dough.gmane.org>
	<177DC886-3D76-4152-A97C-B0B3195BDD30@rabbitmq.com>
	<jlchrc$sve$1@dough.gmane.org>
Message-ID: <BCCF251E-B34D-4CFC-99FF-5A3DA689283F@rabbitmq.com>

I agree that the message could be better, but it isn't rabbitmq that is
generating the message, but make.

If you find a way to use make avoiding the possibility of this problem,
we would be very interested.

Thank you for your suggestion.

Steve Powell  (a happy bunny)
----------some more definitions from the SPD----------
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.
literacy (n.) A textually transmitted disease usually contracted in childhood.

On 2 Apr 2012, at 16:50, Matwey V. Kornilov wrote:

> 
> Frankly speaking, I was playing with building RPM for rabbitmq at opensuse 
> build service. Maybe you know, when I checkout the package, it creates 
> directory like 'home:matwey:branches:network:messaging:amqp/rabbitmq-server' 
> where sources tarballs and specs are placed.
> 
> So, I unpacked the sources tar.gz archive and tried to build it by hands in 
> order to understand how to improve spec-file for newer version. Then I got 
> this bug.
> 
> It took me about an hour to understand the roots of problem, because, as you 
> said, the message was 'cryptic'.
> 
> If fixing that is too complicated, it is ok. But please, add at least human-
> understandable message to avoid futher problems.
> 
> 
> 
> Steve Powell wrote:
> 
>> I'm sorry the advice is the doctor's one: if it hurts doing that -- then
>> don't do it.
>> 
>> If you feel strongly about this, then I'll raise a bug; but it is
>> unlikely to be fixed IMO.
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120402/569e8e46/attachment.htm>

From brendan at soundcloud.com  Mon Apr  2 17:13:49 2012
From: brendan at soundcloud.com (Brendan Hay)
Date: Mon, 2 Apr 2012 18:13:49 +0200
Subject: [rabbitmq-discuss] Status of RabbitMQ-C
Message-ID: <CAHZsVQb8PTxjmvdB+_JCL2p8_f_cWbjLsitsSNOfZCs4D+Sfsw@mail.gmail.com>

Yo,

Is the rabbitmq-c library still considered experimental, if so, for what
reasons? (lack of functionality, lack of love, etc.)

Thanks,
Brendan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120402/a8375737/attachment.htm>

From alan.antonuk at gmail.com  Mon Apr  2 17:48:07 2012
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Mon, 2 Apr 2012 12:48:07 -0400
Subject: [rabbitmq-discuss] Status of RabbitMQ-C
In-Reply-To: <CAHZsVQb8PTxjmvdB+_JCL2p8_f_cWbjLsitsSNOfZCs4D+Sfsw@mail.gmail.com>
References: <CAHZsVQb8PTxjmvdB+_JCL2p8_f_cWbjLsitsSNOfZCs4D+Sfsw@mail.gmail.com>
Message-ID: <CAAt2poKcaBb-r2knMfkNru7iAM6f7v8k2-kf8-OaO_+sHFK+Sg@mail.gmail.com>

Hi - current maintainer of the rabbitmq-c library here;

I don't know the entire history behind the rabbitmq-c library, however as I
understand the label 'experimental' has a lot to do with the fact the
library was not given the same amount of attention as the other official
Java, .NET and Erlang clients, and thus was not promised the same amount of
support the other clients were given.

I would give the library the label "beta" currently.

The library does support the current feature set of the latest RabbitMQ
broker (v2.8.1)
The library has been used in limited amount of production scenarios (that I
know about) and been shown to be stable in the cases I know about
The API definitely needs some love, especially in the area of consuming
messaging and dealing with asynchronous events
Currently the library lacks good documentation and packaging

-Alan

On Mon, Apr 2, 2012 at 12:13 PM, Brendan Hay <brendan at soundcloud.com> wrote:

> Yo,
>
> Is the rabbitmq-c library still considered experimental, if so, for what
> reasons? (lack of functionality, lack of love, etc.)
>
> Thanks,
> Brendan
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120402/20ed9b0b/attachment.htm>

From brendan at soundcloud.com  Mon Apr  2 17:51:01 2012
From: brendan at soundcloud.com (Brendan Hay)
Date: Mon, 2 Apr 2012 18:51:01 +0200
Subject: [rabbitmq-discuss] Status of RabbitMQ-C
In-Reply-To: <CAAt2poKcaBb-r2knMfkNru7iAM6f7v8k2-kf8-OaO_+sHFK+Sg@mail.gmail.com>
References: <CAHZsVQb8PTxjmvdB+_JCL2p8_f_cWbjLsitsSNOfZCs4D+Sfsw@mail.gmail.com>
	<CAAt2poKcaBb-r2knMfkNru7iAM6f7v8k2-kf8-OaO_+sHFK+Sg@mail.gmail.com>
Message-ID: <CAHZsVQZZABQwZkskW8=4iiMR1STjy9Mum2c6PfvAQH7R0vpW7A@mail.gmail.com>

Thanks for clarifying, Alan.

On Mon, Apr 2, 2012 at 6:48 PM, Alan Antonuk <alan.antonuk at gmail.com> wrote:

> Hi - current maintainer of the rabbitmq-c library here;
>
> I don't know the entire history behind the rabbitmq-c library, however as
> I understand the label 'experimental' has a lot to do with the fact the
> library was not given the same amount of attention as the other official
> Java, .NET and Erlang clients, and thus was not promised the same amount of
> support the other clients were given.
>
> I would give the library the label "beta" currently.
>
> The library does support the current feature set of the latest RabbitMQ
> broker (v2.8.1)
> The library has been used in limited amount of production scenarios (that
> I know about) and been shown to be stable in the cases I know about
> The API definitely needs some love, especially in the area of consuming
> messaging and dealing with asynchronous events
> Currently the library lacks good documentation and packaging
>
> -Alan
>
> On Mon, Apr 2, 2012 at 12:13 PM, Brendan Hay <brendan at soundcloud.com>wrote:
>
>> Yo,
>>
>> Is the rabbitmq-c library still considered experimental, if so, for what
>> reasons? (lack of functionality, lack of love, etc.)
>>
>> Thanks,
>> Brendan
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120402/efe83e58/attachment.htm>

From krati.x.gupta at accenture.com  Mon Apr  2 18:10:28 2012
From: krati.x.gupta at accenture.com (krati.x.gupta at accenture.com)
Date: Mon, 2 Apr 2012 17:10:28 +0000
Subject: [rabbitmq-discuss] How to send messages from rabbitmq to topic
 of	weblogic
In-Reply-To: <daeda155-9d62-47da-8946-859e799bf3b7@a8g2000pbe.googlegroups.com>
References: <daeda155-9d62-47da-8946-859e799bf3b7@a8g2000pbe.googlegroups.com>
Message-ID: <064477C2975075449EA466C9FF39DAAE086AE6@048-CH1MPN1-211.048d.mgd.msft.net>

Can anybody reply please? this is urgent

Thanks And Regards,
Krati Gupta | Accenture
________________________________________
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [rabbitmq-discuss-bounces at lists.rabbitmq.com] on behalf of Krati Gupta [kitty8thelogic at gmail.com]
Sent: Monday, April 02, 2012 9:07 PM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: [rabbitmq-discuss] How to send messages from rabbitmq to topic of      weblogic

please tell me how to send messages from rabbitmq to topic of weblogic
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

________________________________
Subject to local law, communications with Accenture and its affiliates including telephone calls and emails (including content), may be monitored by our systems for the purposes of security and the assessment of internal compliance with Accenture policy.
______________________________________________________________________________________

www.accenture.com


From james.r.carr at gmail.com  Mon Apr  2 20:21:48 2012
From: james.r.carr at gmail.com (James Carr)
Date: Mon, 2 Apr 2012 14:21:48 -0500
Subject: [rabbitmq-discuss] How to send messages from rabbitmq to topic
	of weblogic
In-Reply-To: <064477C2975075449EA466C9FF39DAAE086AE6@048-CH1MPN1-211.048d.mgd.msft.net>
References: <daeda155-9d62-47da-8946-859e799bf3b7@a8g2000pbe.googlegroups.com>
	<064477C2975075449EA466C9FF39DAAE086AE6@048-CH1MPN1-211.048d.mgd.msft.net>
Message-ID: <CAJreXKBK+tA9rbY59=CeTu=N3iV4VPTQBLTmF8OQYFqBPzP0Pw@mail.gmail.com>

I had a little difficulty understanding your question but I am
guessing that you are asking how to take a message in a rabbitmq queue
and publish it to a weblogic topic?

If that is the case, there is no out of the box way to do it, you will
have to bridge it yourself. Create a consumer to the rabbitmq queue
and publish it to the JMS topic on weblogic.

Thanks,
James

On Mon, Apr 2, 2012 at 12:10 PM,  <krati.x.gupta at accenture.com> wrote:
> Can anybody reply please? this is urgent
>
> Thanks And Regards,
> Krati Gupta | Accenture
> ________________________________________
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com [rabbitmq-discuss-bounces at lists.rabbitmq.com] on behalf of Krati Gupta [kitty8thelogic at gmail.com]
> Sent: Monday, April 02, 2012 9:07 PM
> To: rabbitmq-discuss at lists.rabbitmq.com
> Subject: [rabbitmq-discuss] How to send messages from rabbitmq to topic of ? ? ?weblogic
>
> please tell me how to send messages from rabbitmq to topic of weblogic
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> ________________________________
> Subject to local law, communications with Accenture and its affiliates including telephone calls and emails (including content), may be monitored by our systems for the purposes of security and the assessment of internal compliance with Accenture policy.
> ______________________________________________________________________________________
>
> www.accenture.com
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From alexis at rabbitmq.com  Mon Apr  2 20:29:54 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Mon, 2 Apr 2012 20:29:54 +0100
Subject: [rabbitmq-discuss] How to send messages from rabbitmq to topic
	of weblogic
In-Reply-To: <CAJreXKBK+tA9rbY59=CeTu=N3iV4VPTQBLTmF8OQYFqBPzP0Pw@mail.gmail.com>
References: <daeda155-9d62-47da-8946-859e799bf3b7@a8g2000pbe.googlegroups.com>
	<064477C2975075449EA466C9FF39DAAE086AE6@048-CH1MPN1-211.048d.mgd.msft.net>
	<CAJreXKBK+tA9rbY59=CeTu=N3iV4VPTQBLTmF8OQYFqBPzP0Pw@mail.gmail.com>
Message-ID: <CACOPnvdta4BxoZ=b-jWWY4wv56GknQr_T3oRhDfm0dCuYpVp5g@mail.gmail.com>

Krati,

Or, use Spring Integration to create such a bridge.

alexis


On Mon, Apr 2, 2012 at 8:21 PM, James Carr <james.r.carr at gmail.com> wrote:
> I had a little difficulty understanding your question but I am
> guessing that you are asking how to take a message in a rabbitmq queue
> and publish it to a weblogic topic?
>
> If that is the case, there is no out of the box way to do it, you will
> have to bridge it yourself. Create a consumer to the rabbitmq queue
> and publish it to the JMS topic on weblogic.
>
> Thanks,
> James
>
> On Mon, Apr 2, 2012 at 12:10 PM, ?<krati.x.gupta at accenture.com> wrote:
>> Can anybody reply please? this is urgent
>>
>> Thanks And Regards,
>> Krati Gupta | Accenture
>> ________________________________________
>> From: rabbitmq-discuss-bounces at lists.rabbitmq.com [rabbitmq-discuss-bounces at lists.rabbitmq.com] on behalf of Krati Gupta [kitty8thelogic at gmail.com]
>> Sent: Monday, April 02, 2012 9:07 PM
>> To: rabbitmq-discuss at lists.rabbitmq.com
>> Subject: [rabbitmq-discuss] How to send messages from rabbitmq to topic of ? ? ?weblogic
>>
>> please tell me how to send messages from rabbitmq to topic of weblogic
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>> ________________________________
>> Subject to local law, communications with Accenture and its affiliates including telephone calls and emails (including content), may be monitored by our systems for the purposes of security and the assessment of internal compliance with Accenture policy.
>> ______________________________________________________________________________________
>>
>> www.accenture.com
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From sheaton at ancestry.com  Mon Apr  2 22:33:31 2012
From: sheaton at ancestry.com (Sean Heaton)
Date: Mon, 2 Apr 2012 21:33:31 +0000
Subject: [rabbitmq-discuss] Shovel plugin behavior with durable queues...
Message-ID: <7C0766D0D31C774F9BEAFBB6C6592EE8B42E5793@PREXMB01.myfamily.int>

Hello,

I am new to the list and RabbitMQ in general, so I hope this is not a stupid question, but I have seen some behavior that is strange to me when using the RabbitMQ shovel plugin.  I am using RabbitMQ v 2.7.1 running on Centos 6.0.  I have three machines in my setup.  Machines A and B are both clustered together.  Machine C is not part of the cluster.  It has the shovel plugin installed.  The plugin is set up to shovel messages from a durable queue on Machine C to a durable queue on Machine A.  In case it helps, my /etc/rabbitmq/rabbitmq.conf file looks like this:

[{rabbitmq_shovel,
  [{shovels,
    [{myShovel,
      [{sources,      [{broker,"amqp://MachineC"}]},
       {destinations, [{broker, "amqp://MachineA"}]},
       {queue, <<"myQueue">>},
       {ack_mode, on_confirm},
       {publish_properties, [{delivery_mode, 2}]},
       {reconnect_delay, 5}
      ]
    }]
 }]
}].

With this configuration, everything seems to work fine.  When I send messages to the queue on Machine C, they are shoveled automatically out to A.

So here is the weird behavior I mentioned earlier...  If I shut down the RabbitMQ service on Machine A, messages stack up in the durable queue on Machine C.  This is expected since Machine A is down.  However, if I then restart the RabbitMQ service on Machine C, all of the messages waiting in the durable queue get nuked.

Has anyone else seen this behavior?  Do I have a setting wrong or is there something else I can change so that this doesn't happen?

Thanks in advance for your help!

Regards,
Sean

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120402/7ae6a368/attachment.htm>

From iceblaze at gmail.com  Tue Apr  3 00:01:32 2012
From: iceblaze at gmail.com (iceblaze)
Date: Mon, 2 Apr 2012 16:01:32 -0700
Subject: [rabbitmq-discuss] Help with persistence using RabbitMQ?
Message-ID: <CA+-WFvwBN0j0bQw3dM7F_oQtkmmqk0bNNSzaNaeyzBWKMQ1j0g@mail.gmail.com>

Hello,

I seem to be having problems with persistence using RabbitMQ, and I was
wondering if someone would help point out what I'm missing?

For example, http://pastebin.com/PRRHx5hF

I run the "send" function 20 times to fill the queue with 20 messages, then
I run rabbitmqadmin list queues, and after /etc/init.d/rabbitmq-server
restart. Finally. I run rabbitmqadmin list queues again and as you can see
the queue and exchange persist, but the messages are lost.

I can provide any other information if necessary.

Thanks!!

-James

-- 
"Of course, the actual government of any computer is run by that fascist
dictator known as the operating system. But a wise dictator knows when to
let the people think they're capitalists--and when to let them think
they're communists." - Programming Perl third edition
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120402/3e80b6f1/attachment.htm>

From joseph.a.marlin at gmail.com  Mon Apr  2 21:15:22 2012
From: joseph.a.marlin at gmail.com (Joseph Marlin)
Date: Mon, 2 Apr 2012 13:15:22 -0700 (PDT)
Subject: [rabbitmq-discuss] Crash - Total persistent queue content loss -
 2.5.1
Message-ID: <19892986.804.1333397722983.JavaMail.geo-discussion-forums@vbw10>

I know I'm working on a version that's pretty old by now. I looked at the 
log contents and was completely mystified. I'd like to understand what went 
wrong here.  

The Story: RabbitMQ crashes and when I bring it back up, all queue contents 
from all my persistent queues are no longer there.

-If it was my fault, what can I do to fix it?
-If it is Rabbit's fault, has the issue been fixed?

Attached are the 'rabbitmqctl report' and the appropriate log from 
/var/log/rabbitmq/

Thanks so much!
Joseph Marlin




--------------------------------
Highlights (in case it is easy enough to diagnose without even needing to 
download anything:
--------------------------------
****Report****:
Status of node 'rabbit at tile-render' ...
[{pid,29076},
 {running_applications,
     [{rabbitmq_management,"RabbitMQ Management Console","2.5.1"},
      {webmachine,"webmachine","1.7.0-rmq2.5.1-hg0c4b60a"},
      {rabbitmq_management_agent,"RabbitMQ Management Agent","2.5.1"},
      {amqp_client,"RabbitMQ AMQP Client","2.5.1"},
      {rabbit,"RabbitMQ","2.5.1"},
      {os_mon,"CPO  CXC 138 46","2.2.4"},
      {sasl,"SASL  CXC 138 11","2.1.8"},
      {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.5.1"},
      {mochiweb,"MochiMedia Web Server","1.3-rmq2.5.1-git9a53dbd"},
      {inets,"INETS  CXC 138 49","5.2"},
      {mnesia,"MNESIA  CXC 138 12","4.4.12"},
      {stdlib,"ERTS  CXC 138 10","1.16.4"},
      {kernel,"ERTS  CXC 138 10","2.13.4"}]},
 {os,{unix,linux}},
 {erlang_version,
     "Erlang R13B03 (erts-5.7.4) [source] [64-bit] [smp:8:8] [rq:8] 
[async-threads:30] [hipe] [kernel-poll:true]\n"},
 {memory,
     [{total,31325888},
      {processes,11455384},
      {processes_used,11434488},
      {system,19870504},
      {atom,1269865},
      {atom_used,1263088},
      {binary,76048},
      {code,14856883},
      {ets,1091928}]}]

****Log****:

** Reason for termination == 
** {{case_clause,undefined},
    [{file_handle_cache,'-partition_handles/1-fun-0-',2},
     {file_handle_cache,get_or_reopen,1},
     {file_handle_cache,with_handles,2},
     {rabbit_msg_store,internal_sync,1},
     {rabbit_msg_store,terminate,2},
     {gen_server2,terminate,3},
     {proc_lib,wake_up,3}]}
** In 'terminate' callback with reason ==
** {{badmatch,{error,enospc}},
    [{rabbit_msg_store,maybe_roll_to_new_file,2},
     {file_handle_cache,open,3},
     {rabbit_msg_store,handle_cast,2},
     {gen_server2,handle_msg,2},
     {proc_lib,wake_up,3}]}

--truncated--

** Reason for termination == 
** {badarg,[{ets,delete,
                 [245834,
                  
{<<52,76,19,5,248,12,21,12,214,129,172,73,116,247,183,106>>,
                   14797}]},
            {rabbit_msg_store,'-close_all_handles/1-fun-0-',5},
            {dict,fold_bucket,3},
            {dict,fold_seg,4},
            {dict,fold_segs,4},
            {rabbit_msg_store,close_all_handles,1},
            {rabbit_msg_store,client_delete_and_terminate,1},
            {rabbit_variable_queue,delete_and_terminate,2}]}
** In 'terminate' callback with reason ==
** {badarg,[{ets,lookup,
                 [249931,
                  
<<167,42,100,148,97,183,72,206,176,227,110,240,207,15,2,93>>]},
            {rabbit_msg_store,read,2},
            {rabbit_variable_queue,with_msg_store_state,3},
            {rabbit_variable_queue,read_msg,2},
            {rabbit_variable_queue,'-fetch/2-fun-0-',3},
            {rabbit_amqqueue_process,fetch,2},
            {rabbit_amqqueue_process,deliver_from_queue_deliver,3},
            {rabbit_amqqueue_process,deliver_msgs_to_consumers,3}]}
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120402/0cac3daf/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit at tile-render.log.2.gz
Type: application/octet-stream
Size: 1002643 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120402/0cac3daf/attachment-0001.obj>
-------------- next part --------------
Status of node 'rabbit at tile-render' ...
[{pid,29076},
 {running_applications,
     [{rabbitmq_management,"RabbitMQ Management Console","2.5.1"},
      {webmachine,"webmachine","1.7.0-rmq2.5.1-hg0c4b60a"},
      {rabbitmq_management_agent,"RabbitMQ Management Agent","2.5.1"},
      {amqp_client,"RabbitMQ AMQP Client","2.5.1"},
      {rabbit,"RabbitMQ","2.5.1"},
      {os_mon,"CPO  CXC 138 46","2.2.4"},
      {sasl,"SASL  CXC 138 11","2.1.8"},
      {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.5.1"},
      {mochiweb,"MochiMedia Web Server","1.3-rmq2.5.1-git9a53dbd"},
      {inets,"INETS  CXC 138 49","5.2"},
      {mnesia,"MNESIA  CXC 138 12","4.4.12"},
      {stdlib,"ERTS  CXC 138 10","1.16.4"},
      {kernel,"ERTS  CXC 138 10","2.13.4"}]},
 {os,{unix,linux}},
 {erlang_version,
     "Erlang R13B03 (erts-5.7.4) [source] [64-bit] [smp:8:8] [rq:8] [async-threads:30] [hipe] [kernel-poll:true]\n"},
 {memory,
     [{total,31325888},
      {processes,11455384},
      {processes_used,11434488},
      {system,19870504},
      {atom,1269865},
      {atom_used,1263088},
      {binary,76048},
      {code,14856883},
      {ets,1091928}]}]

Cluster status of node 'rabbit at tile-render' ...
[{nodes,[{disc,['rabbit at tile-render']}]},
 {running_nodes,['rabbit at tile-render']}]

Application environment of node 'rabbit at tile-render' ...
[{auth_backends,[rabbit_auth_backend_internal]},
 {auth_mechanisms,['PLAIN','AMQPLAIN']},
 {backing_queue_module,rabbit_variable_queue},
 {cluster_nodes,[]},
 {collect_statistics,fine},
 {default_permissions,[<<".*">>,<<".*">>,<<".*">>]},
 {default_user,<<"guest">>},
 {default_user_is_admin,true},
 {default_vhost,<<"/">>},
 {delegate_count,16},
 {frame_max,131072},
 {included_applications,[]},
 {msg_store_file_size_limit,16777216},
 {msg_store_index_module,rabbit_msg_store_ets_index},
 {persister_hibernate_after,10000},
 {persister_max_wrap_entries,500},
 {queue_index_max_journal_entries,262144},
 {server_properties,[]},
 {ssl_listeners,[]},
 {ssl_options,[]},
 {tcp_listen_options,[binary,
                      {packet,raw},
                      {reuseaddr,true},
                      {backlog,128},
                      {nodelay,true},
                      {exit_on_close,false}]},
 {tcp_listeners,[5672]},
 {trace_vhosts,[]},
 {vm_memory_high_watermark,0.4}]

Connections:

Channels:

Queues on /:
pid	name	durable	auto_delete	arguments	owner_pid	exclusive_consumer_pid	exclusive_consumer_tag	messages_ready	messages_unacknowledged	messages	consumers	memory	backing_queue_status
<'rabbit at tile-render'.1.236.0>	TDS_FROM_DEVICE_QUEUE	true	false	[]				0	0	0	0	34624[{q1,0}, {q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,0}, {q4,0}, {len,0}, {pending_acks,0}, {outstanding_txns,0}, {target_ram_count,infinity}, {ram_msg_count,0}, {ram_ack_count,0}, {ram_index_count,0}, {next_seq_id,0}, {persistent_count,0}, {avg_ingress_rate,0.0}, {avg_egress_rate,0.0}, {avg_ack_ingress_rate,0.0}, {avg_ack_egress_rate,0.0}]
<'rabbit at tile-render'.1.237.0>	TILES_TO_SAVE	true	false	[]				0	0	0	0	34624	[{q1,0}, {q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,0}, {q4,0}, {len,0}, {pending_acks,0}, {outstanding_txns,0}, {target_ram_count,infinity}, {ram_msg_count,0}, {ram_ack_count,0}, {ram_index_count,0}, {next_seq_id,0}, {persistent_count,0}, {avg_ingress_rate,0.0}, {avg_egress_rate,0.0}, {avg_ack_ingress_rate,0.0}, {avg_ack_egress_rate,0.0}]
<'rabbit at tile-render'.1.238.0>	TILES_TO_CREATE	true	false	[]				0	0	0	0	34624	[{q1,0}, {q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,0}, {q4,0}, {len,0}, {pending_acks,0}, {outstanding_txns,0}, {target_ram_count,infinity}, {ram_msg_count,0}, {ram_ack_count,0}, {ram_index_count,0}, {next_seq_id,0}, {persistent_count,0}, {avg_ingress_rate,0.0}, {avg_egress_rate,0.0}, {avg_ack_ingress_rate,0.0}, {avg_ack_egress_rate,0.0}]

Exchanges on /:
name	type	durable	auto_delete	internal	arguments
amq.direct	direct	true	false	false	[]
amq.topic	topic	true	false	false	[]
amq.rabbitmq.trace	topic	true	false	false	[]
amq.rabbitmq.log	topic	true	false	false	[]
amq.fanout	fanout	true	false	false	[]
submgr.fromDevice	direct	true	false	false	[]
amq.headers	headers	true	false	false	[]
	direct	true	false	false	[]
amq.match	headers	true	false	false	[]

Bindings on /:
source_name	source_kind	destination_name	destination_kind	routing_key	arguments
	exchange	TDS_FROM_DEVICE_QUEUE	queue	TDS_FROM_DEVICE_QUEUE	[]
	exchange	TILES_TO_CREATE	queue	TILES_TO_CREATE	[]
	exchange	TILES_TO_SAVE	queue	TILES_TO_SAVE	[]

Consumers on /:

Permissions on /:
user	configure	write	read
guest	.*	.*	.*

End of server status report
...done.

From emile at rabbitmq.com  Tue Apr  3 10:15:38 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 03 Apr 2012 10:15:38 +0100
Subject: [rabbitmq-discuss] Crash - Total persistent queue content loss
 - 2.5.1
In-Reply-To: <19892986.804.1333397722983.JavaMail.geo-discussion-forums@vbw10>
References: <19892986.804.1333397722983.JavaMail.geo-discussion-forums@vbw10>
Message-ID: <4F7ABFBA.3010705@rabbitmq.com>

Hi Joseph,

On 02/04/12 21:15, Joseph Marlin wrote:
> I know I'm working on a version that's pretty old by now. I looked at
> the log contents and was completely mystified. I'd like to understand
> what went wrong here.  
> 
> The Story: RabbitMQ crashes and when I bring it back up, all queue
> contents from all my persistent queues are no longer there.
> 
> -If it was my fault, what can I do to fix it?
> -If it is Rabbit's fault, has the issue been fixed?
> 
> Attached are the 'rabbitmqctl report' and the appropriate log from
> /var/log/rabbitmq/

The log contains {error,enospc}. This means the disk ran out of space.
The only way to prevent this condition is to monitor the disk free space
and stop publishers or provision more space before space runs out.

If you restart the broker while out of disk space then recovery of
messages will fail. The broker makes a backup of the data directory
first, but this would have failed.

The next version of RabbitMQ (after v2.8.1) will deal with this
condition more gracefully by throttling producers when disk space runs
low as well as when RAM runs low.


-Emile


From emile at rabbitmq.com  Tue Apr  3 10:45:45 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 03 Apr 2012 10:45:45 +0100
Subject: [rabbitmq-discuss] new ssl troubleshooting guide
Message-ID: <4F7AC6C9.7080407@rabbitmq.com>


Hi all,

The Rabbit website now has a new SSL troubleshooting guide to assist
those setting up AMQP-over-SSL:
http://www.rabbitmq.com/troubleshooting-ssl.html

The aim is to provide guidance on how to test and troubleshoot
individual components. This guide should be read together with and
relies on the SSL guide:
http://www.rabbitmq.com/ssl.html


-Emile




From majek04 at gmail.com  Tue Apr  3 13:30:51 2012
From: majek04 at gmail.com (Marek Majkowski)
Date: Tue, 3 Apr 2012 13:30:51 +0100
Subject: [rabbitmq-discuss] Help with persistence using RabbitMQ?
In-Reply-To: <CA+-WFvwBN0j0bQw3dM7F_oQtkmmqk0bNNSzaNaeyzBWKMQ1j0g@mail.gmail.com>
References: <CA+-WFvwBN0j0bQw3dM7F_oQtkmmqk0bNNSzaNaeyzBWKMQ1j0g@mail.gmail.com>
Message-ID: <CABzX+qwJ1-t8VVeXzVWQo4ky4s47pdF6fdMGYMyAea136JQcfw@mail.gmail.com>

On Tue, Apr 3, 2012 at 00:01, iceblaze <iceblaze at gmail.com> wrote:
> I seem to be having problems with persistence using RabbitMQ, and I was
> wondering if someone would help point out what I'm missing?
>
> For example, http://pastebin.com/PRRHx5hF
>
> I run the "send" function 20 times to fill the queue with 20 messages, then
> I run rabbitmqadmin list queues, and after /etc/init.d/rabbitmq-server
> restart. Finally. I run rabbitmqadmin list queues again and as you can see
> the queue and exchange persist, but the messages are lost.
>
> I can provide any other information if necessary.

I can't spot any obvious issue. I'm not a perl expert - could
you supply me with a runnable script that sends messages?
(and clear instructions how to run it)

Cheers,
  Marek

From matti.linnanvuori at portalify.com  Tue Apr  3 14:25:44 2012
From: matti.linnanvuori at portalify.com (Matti Linnanvuori)
Date: Tue, 3 Apr 2012 16:25:44 +0300
Subject: [rabbitmq-discuss] librabbitmq faults
Message-ID: <BAD9CCAC-6116-4CE6-AE09-088CD6386592@portalify.com>

Hi!

I have encountered two possible faults in librabbitmq (rabbitmq-c-fb6fca832fd2). I am trying to use that latest version customized with Perl Net::RabbitMQ on SLES 11 SP 1.

One is that amqp_simple_wait_frame and recv do not respond to messages being published to an exchange after rabbitmqctl stop_app, reset and start_app. That problem appears also with Net::RabbitMQ versions 0.2.2 and 0.2.0.

Another is that amqp_basic_get fails with error Operation not permitted after rabbitmqctl stop_app, reset and start_app.  That problem appears also with Net::RabbitMQ versions 0.2.2 and 0.2.0, but there is a segmentation fault.

I got the following state in gdb with recv:

0x00007f38e70b7935 in recv () from /lib64/libpthread.so.0
(gdb) bt
#0  0x00007f38e70b7935 in recv () from /lib64/libpthread.so.0
#1  0x00007f38e5cfba4d in recv (__flags=<value optimized out>, 
    __n=<value optimized out>, __buf=<value optimized out>, 
    __fd=<value optimized out>) at /usr/include/bits/socket2.h:45
#2  wait_frame_inner (__flags=<value optimized out>, 
    __n=<value optimized out>, __buf=<value optimized out>, 
    __fd=<value optimized out>) at amqp_socket.c:182
#3  0x00007f38e5ce78b9 in internal_recv (RETVAL=0xbf4f68, conn=0xbe1440, 
    piggyback=0) at RabbitMQ.xs:77
#4  0x00007f38e5ce8566 in XS_Net__RabbitMQ_recv (
    my_perl=<value optimized out>, cv=<value optimized out>) at RabbitMQ.xs:424
#5  0x000000000047e115 in Perl_pp_entersub ()
#6  0x0000000000455ad3 in Perl_runops_debug ()
#7  0x000000000047a1af in perl_run ()
#8  0x000000000042172c in main ()
(gdb) continue
Continuing.
^C
Program received signal SIGINT, Interrupt.
0x00007f38e70b7935 in recv () from /lib64/libpthread.so.0
(gdb) bt
#0  0x00007f38e70b7935 in recv () from /lib64/libpthread.so.0
#1  0x00007f38e5cfba4d in recv (__flags=<value optimized out>, 
    __n=<value optimized out>, __buf=<value optimized out>, 
    __fd=<value optimized out>) at /usr/include/bits/socket2.h:45
#2  wait_frame_inner (__flags=<value optimized out>, 
    __n=<value optimized out>, __buf=<value optimized out>, 
    __fd=<value optimized out>) at amqp_socket.c:182
#3  0x00007f38e5ce78b9 in internal_recv (RETVAL=0xbf4f68, conn=0xbe1440, 
    piggyback=0) at RabbitMQ.xs:77
#4  0x00007f38e5ce8566 in XS_Net__RabbitMQ_recv (
    my_perl=<value optimized out>, cv=<value optimized out>) at RabbitMQ.xs:424
#5  0x000000000047e115 in Perl_pp_entersub ()
#6  0x0000000000455ad3 in Perl_runops_debug ()
#7  0x000000000047a1af in perl_run ()
#8  0x000000000042172c in main ()
(gdb) up
#1  0x00007f38e5cfba4d in recv (__flags=<value optimized out>, 
    __n=<value optimized out>, __buf=<value optimized out>, 
    __fd=<value optimized out>) at /usr/include/bits/socket2.h:45
45	  return __recv_alias (__fd, __buf, __n, __flags);
(gdb) up
#2  wait_frame_inner (__flags=<value optimized out>, 
    __n=<value optimized out>, __buf=<value optimized out>, 
    __fd=<value optimized out>) at amqp_socket.c:182
182	    res = recv(state->sockfd, state->sock_inbound_buffer.bytes,
(gdb) up
#3  0x00007f38e5ce78b9 in internal_recv (RETVAL=0xbf4f68, conn=0xbe1440, 
    piggyback=0) at RabbitMQ.xs:77
77	      result = amqp_simple_wait_frame(conn, &frame);
(gdb) print conn
$1 = (amqp_connection_state_t) 0xbe1440
(gdb) print *conn
$2 = {frame_pool = {pagesize = 131072, pages = {num_blocks = 5, 
      blocklist = 0xc5d4f0}, large_blocks = {num_blocks = 0, blocklist = 0x0}, 
    next_page = 0, alloc_block = 0x0, alloc_used = 0}, decoding_pool = {
    pagesize = 131072, pages = {num_blocks = 1, blocklist = 0xbf22e0}, 
    large_blocks = {num_blocks = 0, blocklist = 0x0}, next_page = 0, 
    alloc_block = 0x0, alloc_used = 0}, state = CONNECTION_STATE_IDLE, 
  channel_max = 0, frame_max = 131072, heartbeat = 0, inbound_buffer = {
    len = 131072, bytes = 0x0}, inbound_offset = 0, target_size = 7, 
  outbound_buffer = {len = 131072, bytes = 0xc67f90}, sockfd = 3, 
  sock_inbound_buffer = {len = 131072, bytes = 0x7f38e7b57010}, 
  sock_inbound_offset = 79, sock_inbound_limit = 79, first_queued_frame = 0x0, 
  last_queued_frame = 0x0, most_recent_api_result = {
    reply_type = AMQP_RESPONSE_NORMAL, reply = {id = 3932181, 
      decoded = 0x7f38e7af1038}, library_error = 0}}


regards, Matti Linnanvuori

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120403/46065f09/attachment.htm>

From allen.fowler at yahoo.com  Tue Apr  3 14:36:23 2012
From: allen.fowler at yahoo.com (Allen Fowler)
Date: Tue, 3 Apr 2012 06:36:23 -0700 (PDT)
Subject: [rabbitmq-discuss] |Spam|
Message-ID: <1333460183.33301.YahooMailMobile@web114009.mail.gq1.yahoo.com>

<a href="http://floridaguns.com/forums/store/jrklre.html"> http://floridaguns.com/forums/store/jrklre.html</a>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120403/7ac1429f/attachment.htm>

From steve at rabbitmq.com  Tue Apr  3 14:43:34 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Tue, 3 Apr 2012 14:43:34 +0100
Subject: [rabbitmq-discuss] Shovel plugin behavior with durable queues...
In-Reply-To: <7C0766D0D31C774F9BEAFBB6C6592EE8B42E5793@PREXMB01.myfamily.int>
References: <7C0766D0D31C774F9BEAFBB6C6592EE8B42E5793@PREXMB01.myfamily.int>
Message-ID: <EB3843B5-F6D3-46BC-A338-8047676B74DE@rabbitmq.com>

Hi Sean,

Did you mean to say you restarted Machine C or Machine A?

In any case, the messages in a durable queue will only survive a server
stop/start if the messages are persistent.

If you restarted Machine A, then the shovel ought to reconnect (from C
to A) and the messages in the queue should then be sent. Since the queue
on Machine A is durable it ought to still exist when you restart it.

Hope this gives some clue. If you still have problems, please come back.

Steve Powell  (a happy bunny)
----------some more definitions from the SPD----------
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.
literacy (n.) A textually transmitted disease usually contracted in childhood.

On 2 Apr 2012, at 22:33, Sean Heaton wrote:

> Hello,
>  
> I am new to the list and RabbitMQ in general, so I hope this is not a stupid question, but I have seen some behavior that is strange to me when using the RabbitMQ shovel plugin.  I am using RabbitMQ v 2.7.1 running on Centos 6.0.  I have three machines in my setup.  Machines A and B are both clustered together.  Machine C is not part of the cluster.  It has the shovel plugin installed.  The plugin is set up to shovel messages from a durable queue on Machine C to a durable queue on Machine A.  In case it helps, my /etc/rabbitmq/rabbitmq.conf file looks like this:
>  
> [{rabbitmq_shovel,
>   [{shovels,
>     [{myShovel,
>       [{sources,      [{broker,"amqp://MachineC"}]},
>        {destinations, [{broker, "amqp://MachineA"}]},
>        {queue, <<"myQueue">>},
>        {ack_mode, on_confirm},
>        {publish_properties, [{delivery_mode, 2}]},
>        {reconnect_delay, 5}
>       ]
>     }]
>  }]
> }].
>  
> With this configuration, everything seems to work fine.  When I send messages to the queue on Machine C, they are shoveled automatically out to A.
>  
> So here is the weird behavior I mentioned earlier?  If I shut down the RabbitMQ service on Machine A, messages stack up in the durable queue on Machine C.  This is expected since Machine A is down.  However, if I then restart the RabbitMQ service on Machine C, all of the messages waiting in the durable queue get nuked.
>  
> Has anyone else seen this behavior?  Do I have a setting wrong or is there something else I can change so that this doesn?t happen?
>  
> Thanks in advance for your help!
>  
> Regards,
> Sean
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120403/40c8c435/attachment.htm>

From simon at rabbitmq.com  Tue Apr  3 15:44:00 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 03 Apr 2012 15:44:00 +0100
Subject: [rabbitmq-discuss] |Spam|
In-Reply-To: <1333460183.33301.YahooMailMobile@web114009.mail.gq1.yahoo.com>
References: <1333460183.33301.YahooMailMobile@web114009.mail.gq1.yahoo.com>
Message-ID: <4F7B0CB0.8000906@rabbitmq.com>

On 03/04/12 14:36, Allen Fowler wrote:
>

Allen, I have removed you from the list, please check your machine for 
viruses.

Everyone else, sorry for the noise.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From alan.antonuk at gmail.com  Tue Apr  3 15:52:46 2012
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Tue, 3 Apr 2012 10:52:46 -0400
Subject: [rabbitmq-discuss] librabbitmq faults
In-Reply-To: <BAD9CCAC-6116-4CE6-AE09-088CD6386592@portalify.com>
References: <BAD9CCAC-6116-4CE6-AE09-088CD6386592@portalify.com>
Message-ID: <CAAt2poJxUX19CoZC6DJq7gtSzs+VTfzmhKzDTWG+Wd04zXYwcw@mail.gmail.com>

I'm not familiar with the Net::RabbitMQ perl module or how it leverages the
rabbitmq-c library, so grain of salt here:

Without looking at your code, I'm guessing that you don't to re-connect to
the broker after the broker is cycled.

When the broker is stopped and brought back up all connections are
disconnected.  Trying to use a connection will result in an error claiming
the socket is closed.  On the client side, you need to detect that your
connection to the broker has failed, and take appropriate actions to
reconnect to the broker before trying to get or consume a message.

I am curious about the segfault you are seeing.  Do you have
a succinct example that can reproduce this segfault?

-Alan

On Tue, Apr 3, 2012 at 9:25 AM, Matti Linnanvuori <
matti.linnanvuori at portalify.com> wrote:

> Hi!
>
> I have encountered two possible faults in librabbitmq
> (rabbitmq-c-fb6fca832fd2). I am trying to use that latest version
> customized with Perl Net::RabbitMQ on SLES 11 SP 1.
>
> One is that amqp_simple_wait_frame and recv do not respond to messages
> being published to an exchange after rabbitmqctl stop_app, reset and
> start_app. That problem appears also with Net::RabbitMQ versions 0.2.2 and
> 0.2.0.
>
> Another is that amqp_basic_get fails with error Operation not
> permitted after rabbitmqctl stop_app, reset and start_app.  That problem
> appears also with Net::RabbitMQ versions 0.2.2 and 0.2.0, but there is a
> segmentation fault.
>
> I got the following state in gdb with recv:
>
> 0x00007f38e70b7935 in recv () from /lib64/libpthread.so.0
> (gdb) bt
> #0  0x00007f38e70b7935 in recv () from /lib64/libpthread.so.0
> #1  0x00007f38e5cfba4d in recv (__flags=<value optimized out>,
>     __n=<value optimized out>, __buf=<value optimized out>,
>     __fd=<value optimized out>) at /usr/include/bits/socket2.h:45
> #2  wait_frame_inner (__flags=<value optimized out>,
>     __n=<value optimized out>, __buf=<value optimized out>,
>     __fd=<value optimized out>) at amqp_socket.c:182
> #3  0x00007f38e5ce78b9 in internal_recv (RETVAL=0xbf4f68, conn=0xbe1440,
>     piggyback=0) at RabbitMQ.xs:77
> #4  0x00007f38e5ce8566 in XS_Net__RabbitMQ_recv (
>     my_perl=<value optimized out>, cv=<value optimized out>) at
> RabbitMQ.xs:424
> #5  0x000000000047e115 in Perl_pp_entersub ()
> #6  0x0000000000455ad3 in Perl_runops_debug ()
> #7  0x000000000047a1af in perl_run ()
> #8  0x000000000042172c in main ()
> (gdb) continue
> Continuing.
> ^C
> Program received signal SIGINT, Interrupt.
> 0x00007f38e70b7935 in recv () from /lib64/libpthread.so.0
> (gdb) bt
> #0  0x00007f38e70b7935 in recv () from /lib64/libpthread.so.0
> #1  0x00007f38e5cfba4d in recv (__flags=<value optimized out>,
>     __n=<value optimized out>, __buf=<value optimized out>,
>     __fd=<value optimized out>) at /usr/include/bits/socket2.h:45
> #2  wait_frame_inner (__flags=<value optimized out>,
>     __n=<value optimized out>, __buf=<value optimized out>,
>     __fd=<value optimized out>) at amqp_socket.c:182
> #3  0x00007f38e5ce78b9 in internal_recv (RETVAL=0xbf4f68, conn=0xbe1440,
>     piggyback=0) at RabbitMQ.xs:77
> #4  0x00007f38e5ce8566 in XS_Net__RabbitMQ_recv (
>     my_perl=<value optimized out>, cv=<value optimized out>) at
> RabbitMQ.xs:424
> #5  0x000000000047e115 in Perl_pp_entersub ()
> #6  0x0000000000455ad3 in Perl_runops_debug ()
> #7  0x000000000047a1af in perl_run ()
> #8  0x000000000042172c in main ()
> (gdb) up
> #1  0x00007f38e5cfba4d in recv (__flags=<value optimized out>,
>     __n=<value optimized out>, __buf=<value optimized out>,
>     __fd=<value optimized out>) at /usr/include/bits/socket2.h:45
> 45  return __recv_alias (__fd, __buf, __n, __flags);
> (gdb) up
> #2  wait_frame_inner (__flags=<value optimized out>,
>     __n=<value optimized out>, __buf=<value optimized out>,
>     __fd=<value optimized out>) at amqp_socket.c:182
> 182    res = recv(state->sockfd, state->sock_inbound_buffer.bytes,
> (gdb) up
> #3  0x00007f38e5ce78b9 in internal_recv (RETVAL=0xbf4f68, conn=0xbe1440,
>     piggyback=0) at RabbitMQ.xs:77
> 77      result = amqp_simple_wait_frame(conn, &frame);
> (gdb) print conn
> $1 = (amqp_connection_state_t) 0xbe1440
> (gdb) print *conn
> $2 = {frame_pool = {pagesize = 131072, pages = {num_blocks = 5,
>       blocklist = 0xc5d4f0}, large_blocks = {num_blocks = 0, blocklist =
> 0x0},
>     next_page = 0, alloc_block = 0x0, alloc_used = 0}, decoding_pool = {
>     pagesize = 131072, pages = {num_blocks = 1, blocklist = 0xbf22e0},
>     large_blocks = {num_blocks = 0, blocklist = 0x0}, next_page = 0,
>     alloc_block = 0x0, alloc_used = 0}, state = CONNECTION_STATE_IDLE,
>   channel_max = 0, frame_max = 131072, heartbeat = 0, inbound_buffer = {
>     len = 131072, bytes = 0x0}, inbound_offset = 0, target_size = 7,
>   outbound_buffer = {len = 131072, bytes = 0xc67f90}, sockfd = 3,
>   sock_inbound_buffer = {len = 131072, bytes = 0x7f38e7b57010},
>   sock_inbound_offset = 79, sock_inbound_limit = 79, first_queued_frame =
> 0x0,
>   last_queued_frame = 0x0, most_recent_api_result = {
>     reply_type = AMQP_RESPONSE_NORMAL, reply = {id = 3932181,
>       decoded = 0x7f38e7af1038}, library_error = 0}}
>
>
> regards, Matti Linnanvuori
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120403/48f7736c/attachment.htm>

From pgrimard at gmail.com  Tue Apr  3 16:19:32 2012
From: pgrimard at gmail.com (Patrick Grimard)
Date: Tue, 3 Apr 2012 11:19:32 -0400
Subject: [rabbitmq-discuss] Running RabbitMQ as a daemon on Suse
Message-ID: <CALi8Ga_h3Q3FC6cKW1QwgRi6BL-dO_ZXfBx5sHiZ7v5X+C2JUQ@mail.gmail.com>

I downloaded the Generic UNIX tarball of RabbitMQ.  I have no problems
starting and stopping the server manually, even ran the Java tutorials
without a problem.  What I'm wondering is how I can setup the server to
launch automatically in detached mode upon booting the server.  I'm no
expert on linux, but have a working knowledge.  I determined simply copying
the rabbitmq-server shell script to /etc/init.d wouldn't work because the
system will attempt to pass the "start" command to the script, which isn't
needed.  Has anybody successfully setup RabbitMQ as a service on Suse?

Thanks.

-- 
*Patrick Grimard*
Follow me on Twitter: http://www.twitter.com/patrickgrimard
LinkedIn: http://www.linkedin.com/in/patrickgrimard
Blog: http://jpgmr.wordpress.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120403/078f1605/attachment.htm>

From simon at rabbitmq.com  Tue Apr  3 16:24:55 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 03 Apr 2012 16:24:55 +0100
Subject: [rabbitmq-discuss] Running RabbitMQ as a daemon on Suse
In-Reply-To: <CALi8Ga_h3Q3FC6cKW1QwgRi6BL-dO_ZXfBx5sHiZ7v5X+C2JUQ@mail.gmail.com>
References: <CALi8Ga_h3Q3FC6cKW1QwgRi6BL-dO_ZXfBx5sHiZ7v5X+C2JUQ@mail.gmail.com>
Message-ID: <4F7B1647.3070305@rabbitmq.com>

On 03/04/12 16:19, Patrick Grimard wrote:
> Has anybody successfully setup RabbitMQ as a service on Suse?

Most daemons need an init script to wrap them. You can see the init 
script we ship with our RPMs / debs here:

http://hg.rabbitmq.com/rabbitmq-server/file/rabbitmq_v2_8_1/packaging/common/rabbitmq-server.init

- with some tweaking that might make a valid starting point.

Note that we do have a SUSE RPM available:

http://www.rabbitmq.com/install-rpm.html

which comes with that init script already working, so that might be 
simpler. But I am not a SUSE expert...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From grussell at vmware.com  Tue Apr  3 16:25:45 2012
From: grussell at vmware.com (Gary Russell)
Date: Tue, 3 Apr 2012 08:25:45 -0700
Subject: [rabbitmq-discuss] DLQ Problems
Message-ID: <4F7B1679.60003@vmware.com>

Hi,

I am testing DLQs with 2.8.1.

I have a simple durable queue, with the x-dead-letter-exhange set to a 
simple direct exchange.

When I receive a message, I send a basic.reject (with requeue false); my 
understanding is that this should go the d-l-exhange and use the  same 
routing key there.

I have routing key 'si.test.binding' bound to 'si.test.queue' on my 
primary exchange (si.test.exchange); and 'si.test.binding' bound to 
'si.dlq' on the si.dlq.exchange.

Before sending a message, I see si.test.queue with the D and DLX flags 
in the admin console. However, when I reject the message, my original 
queue disappears, and the message does not show up on the DLQ.

I figure I must be missing something simple, but the fact my original 
queue is deleted concerns me.

This is in the log...

=INFO REPORT==== 3-Apr-2012::11:01:25 ===
accepting AMQP connection <0.26275.1> (127.0.1.1:38710 -> 127.0.1.1:5672)

=ERROR REPORT==== 3-Apr-2012::11:01:31 ===
** Generic server <0.26290.1> terminating
** Last message in was {'$gen_cast',
                         {dead_letter,
                          {{basic_message,
                            
{resource,<<"/">>,exchange,<<"si.test.exchange">>},
                            [<<"si.test.binding">>],
                            {content,60,none,
<<248,0,10,116,101,120,116,47,112,108,97,105,110,5,
                               85,84,70,45,56,0,0,0,0,2,0>>,
                             rabbit_framing_amqp_0_9_1,
                             [<<"xxx">>]},
<<45,248,235,97,167,255,225,89,178,123,85,134,123,
                              221,200,209>>,
                            true},
                           0},
                          rejected}}
** When Server state == {q,
                          {amqqueue,
                           {resource,<<"/">>,queue,<<"si.test.queue">>},
                           true,false,none,
                           [{<<"x-dead-letter-exchange">>,longstr,
<<"si.dlq.exchange">>}],
<0.26290.1>,[],undefined},
                          none,true,rabbit_variable_queue,
                          {vqstate,
                           {0,{[],[]}},
                           {0,{[],[]}},
                           {delta,undefined,0,undefined},
                           {0,{[],[]}},
                           {0,{[],[]}},
                           1,
                           {1,
                            {0,
                             {msg_status,0,
<<45,248,235,97,167,255,225,89,178,123,85,134,123,
                                221,200,209>>,
                              undefined,true,true,true,true,
                              {message_properties,undefined,false}},
                             nil,nil}},
                           undefined,
                           {0,nil},
                           {qistate,
                            
"/var/lib/rabbitmq/mnesia/rabbit at arwen3/queues/89R1RVA4SJVF9J34SJFJ3SI0K",
                            {{dict,0,16,16,8,80,48,
                              
{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                              
{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []}}},
                             [{segment,0,
                               
"/var/lib/rabbitmq/mnesia/rabbit at arwen3/queues/89R1RVA4SJVF9J34SJFJ3SI0K/0.idx",
                               {array,16384,0,undefined,
                                
{{{{{{{<<45,248,235,97,167,255,225,89,178,123,
                                         85,134,123,221,200,209>>,
                                       {message_properties,undefined,false},
                                       true},
                                      del,no_ack},
                                     
undefined,undefined,undefined,undefined,
                                     
undefined,undefined,undefined,undefined,
                                     undefined},
                                    10,10,10,10,10,10,10,10,10,10},
                                   100,100,100,100,100,100,100,100,100,100},
                                  
1000,1000,1000,1000,1000,1000,1000,1000,1000,
                                  1000},
                                 10000,10000,10000,10000,10000,10000,10000,
                                 10000,10000,10000}},
                               1}]},
                            #Ref<0.0.0.108169>,2,262144,
                            #Fun<rabbit_variable_queue.2.91259159>,
                            {0,nil}},
                           {{client_msstate,msg_store_persistent,
<<54,34,9,193,160,112,127,104,114,220,250,198,197,
                               219,10,49>>,
                             {dict,0,16,16,8,80,48,
                              
{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                              
{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []}}},
                             {state,229447,
                              
"/var/lib/rabbitmq/mnesia/rabbit at arwen3/msg_store_persistent"},
                             rabbit_msg_store_ets_index,
                             
"/var/lib/rabbitmq/mnesia/rabbit at arwen3/msg_store_persistent",
<0.210.0>,233544,225350,237641,241738},
                            {client_msstate,msg_store_transient,
<<236,159,45,16,62,51,168,190,137,52,88,73,76,239,
                               82,120>>,
                             {dict,0,16,16,8,80,48,
                              
{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                              
{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []}}},
                             {state,208962,
                              
"/var/lib/rabbitmq/mnesia/rabbit at arwen3/msg_store_transient"},
                             rabbit_msg_store_ets_index,
                             
"/var/lib/rabbitmq/mnesia/rabbit at arwen3/msg_store_transient",
<0.205.0>,213059,204858,217156,221253}},
                           
true,0,#Fun<rabbit_amqqueue_process.5.77899751>,0,1,
                           infinity,1,0,0,1,1,
                           {rates,
                            {{1333,465285,369999},0},
                            {{1333,465285,369999},0},
                            0.0,0.0,
                            {1333,465286,453226}},
                           {0,nil},
                           {0,nil},
                           {0,nil},
                           {0,nil},
                           0,1,
                           {rates,
                            {{1333,465285,369999},0},
                            {{1333,465285,369999},0},
                            0.0,0.0,
                            {1333,465286,453226}}},
                          {[{<0.26279.1>,
                             
{consumer,<<"amq.ctag-Q3QQmteYvhLYCrhOvf6xLB">>,
                              true}}],
                           []},
                          undefined,undefined,#Ref<0.0.0.108171>,undefined,
                          {state,fine,5000,#Ref<0.0.0.108172>},
                          {0,nil},
                          undefined,undefined,1,
                          {0,nil},
                          {0,nil},
                          undefined,
                          {dict,0,16,16,8,80,48,
                           
{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                           
{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                          {resource,<<"/">>,exchange,<<"si.dlq.exchange">>},
                          undefined}
** Reason for termination ==
** {{badrecord,'P_basic'},
     [{rabbit_basic,replace_headers,2},
      {rabbit_amqqueue_process,make_dead_letter_msg,4},
      {rabbit_amqqueue_process,dead_letter_msg_existing_dlx,4},
      {gen_server2,handle_msg,2},
      {proc_lib,wake_up,3}]}

=ERROR REPORT==== 3-Apr-2012::11:01:32 ===
connection <0.26275.1>, channel 2 - error:
{amqp_error,not_found,"no queue 'si.test.queue' in vhost 
'/'",'queue.declare'}

Thanks

From simon at rabbitmq.com  Tue Apr  3 16:32:41 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 03 Apr 2012 16:32:41 +0100
Subject: [rabbitmq-discuss] Running RabbitMQ as a daemon on Suse
In-Reply-To: <CALi8Ga_WMsLu6Ri_qh9GOM-1-2v_4rLpEoaC+b1RpPLGrsiChg@mail.gmail.com>
References: <CALi8Ga_h3Q3FC6cKW1QwgRi6BL-dO_ZXfBx5sHiZ7v5X+C2JUQ@mail.gmail.com>	<4F7B1647.3070305@rabbitmq.com>
	<CALi8Ga_WMsLu6Ri_qh9GOM-1-2v_4rLpEoaC+b1RpPLGrsiChg@mail.gmail.com>
Message-ID: <4F7B1819.1090400@rabbitmq.com>

On 03/04/12 16:29, Patrick Grimard wrote:
> Thanks Simon.
>
> I attempted the RPM installation, but it failed.  My server has Erlang
> R15B.  When I attempt the RabbitMQ RPM installation, it says "Failed
> dependencies: erlang >= R12B-3 is needed by
> rabbitmq-server-2.8.1-1.suse.noarch".  So I'm not sure why that's failing.

Did you install Erlang from RPM? If not then RPM will not know that it's 
installed...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From francesco at rabbitmq.com  Tue Apr  3 16:37:50 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Tue, 03 Apr 2012 16:37:50 +0100
Subject: [rabbitmq-discuss] DLQ Problems
In-Reply-To: <4F7B1679.60003@vmware.com>
References: <4F7B1679.60003@vmware.com>
Message-ID: <4F7B194E.2070800@rabbitmq.com>

Hi Gary.

> I figure I must be missing something simple, but the fact my original
> queue is deleted concerns me.

The queue should definitely not disappear. This behavior is due to a bug 
in the DLX implementation, that arises when dead-lettering messages 
stored on disk. We fixed it already, and it will resolved in the next 
release (possibly soon).

Francesco.

From iceblaze at gmail.com  Tue Apr  3 17:22:16 2012
From: iceblaze at gmail.com (iceblaze)
Date: Tue, 3 Apr 2012 09:22:16 -0700
Subject: [rabbitmq-discuss] Help with persistence using RabbitMQ?
In-Reply-To: <CABzX+qwJ1-t8VVeXzVWQo4ky4s47pdF6fdMGYMyAea136JQcfw@mail.gmail.com>
References: <CA+-WFvwBN0j0bQw3dM7F_oQtkmmqk0bNNSzaNaeyzBWKMQ1j0g@mail.gmail.com>
	<CABzX+qwJ1-t8VVeXzVWQo4ky4s47pdF6fdMGYMyAea136JQcfw@mail.gmail.com>
Message-ID: <CA+-WFvwO490up48dR=4CC31HJwqwoZat5+C-SS1w4xForV=eog@mail.gmail.com>

Hello Marek,

Thanks for attempting to assist me here. I have made a light version of the
module and a sender script as you requested. You can find the files here:

http://iceblaze.com/rabbit.zip

Simply unzip the files into the same directory and run the "sender.pl"
script. Note that you will need to install Net::RabbitMQ from CPAN. You can
also modify the login credentials for rabbit (right now its just using
guest/guest) in $self of Rabbit.pm's new() function:

        my $self =
        {
                _rabbit => Net::RabbitMQ->new(),
                _rabbit_user => "guest",
                _rabbit_pass => "guest",
                _rabbit_host => "localhost",
                _rabbit_port => 5672,
                _queue => $queue,
                _channel => $channel,
                _no_ack => $no_ack,
                _queue_declared => '',
        };

-James


On Tue, Apr 3, 2012 at 5:30 AM, Marek Majkowski <majek04 at gmail.com> wrote:

> On Tue, Apr 3, 2012 at 00:01, iceblaze <iceblaze at gmail.com> wrote:
> > I seem to be having problems with persistence using RabbitMQ, and I was
> > wondering if someone would help point out what I'm missing?
> >
> > For example, http://pastebin.com/PRRHx5hF
> >
> > I run the "send" function 20 times to fill the queue with 20 messages,
> then
> > I run rabbitmqadmin list queues, and after /etc/init.d/rabbitmq-server
> > restart. Finally. I run rabbitmqadmin list queues again and as you can
> see
> > the queue and exchange persist, but the messages are lost.
> >
> > I can provide any other information if necessary.
>
> I can't spot any obvious issue. I'm not a perl expert - could
> you supply me with a runnable script that sends messages?
> (and clear instructions how to run it)
>
> Cheers,
>  Marek
>



-- 
"Of course, the actual government of any computer is run by that fascist
dictator known as the operating system. But a wise dictator knows when to
let the people think they're capitalists--and when to let them think
they're communists." - Programming Perl third edition
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120403/42a5da85/attachment.htm>

From sheaton at ancestry.com  Tue Apr  3 17:46:45 2012
From: sheaton at ancestry.com (Sean Heaton)
Date: Tue, 3 Apr 2012 16:46:45 +0000
Subject: [rabbitmq-discuss] Shovel plugin behavior with durable queues...
In-Reply-To: <EB3843B5-F6D3-46BC-A338-8047676B74DE@rabbitmq.com>
References: <7C0766D0D31C774F9BEAFBB6C6592EE8B42E5793@PREXMB01.myfamily.int>
	<EB3843B5-F6D3-46BC-A338-8047676B74DE@rabbitmq.com>
Message-ID: <7C0766D0D31C774F9BEAFBB6C6592EE8B42EA183@PREXMB01.myfamily.int>

Steve,

Thank you very much for helping me out.  I actually stop Machine A.  That prevents messages from being shoveled from Machine C  to A.  While A is still stopped, I restart the RabbitMQ service Machine C.

When I do this, I figured since the messages are in a durable queue on Machine C, they would still be in the durable queue on C waiting to be shoveled to A.  This isn't the case though-they are simply gone.  They don't make it to A (since A is stopped), but they aren't on C anymore either.  I was thinking I probably have something configured wrong or that there is a setting I can tweak to make them persist on C.

Thank you again for your help on this...

Regards,
Sean


From: Steve Powell [mailto:steve at rabbitmq.com]
Sent: Tuesday, April 03, 2012 7:44 AM
To: Sean Heaton
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Shovel plugin behavior with durable queues...

Hi Sean,

Did you mean to say you restarted Machine C or Machine A?

In any case, the messages in a durable queue will only survive a server
stop/start if the messages are persistent.

If you restarted Machine A, then the shovel ought to reconnect (from C
to A) and the messages in the queue should then be sent. Since the queue
on Machine A is durable it ought to still exist when you restart it.

Hope this gives some clue. If you still have problems, please come back.

Steve Powell  (a happy bunny)
----------some more definitions from the SPD----------
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.
literacy (n.) A textually transmitted disease usually contracted in childhood.

On 2 Apr 2012, at 22:33, Sean Heaton wrote:


Hello,

I am new to the list and RabbitMQ in general, so I hope this is not a stupid question, but I have seen some behavior that is strange to me when using the RabbitMQ shovel plugin.  I am using RabbitMQ v 2.7.1 running on Centos 6.0.  I have three machines in my setup.  Machines A and B are both clustered together.  Machine C is not part of the cluster.  It has the shovel plugin installed.  The plugin is set up to shovel messages from a durable queue on Machine C to a durable queue on Machine A.  In case it helps, my /etc/rabbitmq/rabbitmq.conf file looks like this:

[{rabbitmq_shovel,
  [{shovels,
    [{myShovel,
      [{sources,      [{broker,"amqp://MachineC"}]},
       {destinations, [{broker, "amqp://MachineA"}]},
       {queue, <<"myQueue">>},
       {ack_mode, on_confirm},
       {publish_properties, [{delivery_mode, 2}]},
       {reconnect_delay, 5}
      ]
    }]
 }]
}].

With this configuration, everything seems to work fine.  When I send messages to the queue on Machine C, they are shoveled automatically out to A.

So here is the weird behavior I mentioned earlier...  If I shut down the RabbitMQ service on Machine A, messages stack up in the durable queue on Machine C.  This is expected since Machine A is down.  However, if I then restart the RabbitMQ service on Machine C, all of the messages waiting in the durable queue get nuked.

Has anyone else seen this behavior?  Do I have a setting wrong or is there something else I can change so that this doesn't happen?

Thanks in advance for your help!

Regards,
Sean

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120403/a514a544/attachment.htm>

From joseph.a.marlin at gmail.com  Tue Apr  3 19:53:32 2012
From: joseph.a.marlin at gmail.com (Joseph Marlin)
Date: Tue, 3 Apr 2012 14:53:32 -0400
Subject: [rabbitmq-discuss] Crash - Total persistent queue content loss
	- 2.5.1
In-Reply-To: <4F7ABFBA.3010705@rabbitmq.com>
References: <19892986.804.1333397722983.JavaMail.geo-discussion-forums@vbw10>
	<4F7ABFBA.3010705@rabbitmq.com>
Message-ID: <CALLUFi_F10-fgxLDtt5fRspvdgMnXFRT5Ytj9rMOCzm6yAstEA@mail.gmail.com>

Thanks so much!

On Tue, Apr 3, 2012 at 5:15 AM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi Joseph,
>
> On 02/04/12 21:15, Joseph Marlin wrote:
> > I know I'm working on a version that's pretty old by now. I looked at
> > the log contents and was completely mystified. I'd like to understand
> > what went wrong here.
> >
> > The Story: RabbitMQ crashes and when I bring it back up, all queue
> > contents from all my persistent queues are no longer there.
> >
> > -If it was my fault, what can I do to fix it?
> > -If it is Rabbit's fault, has the issue been fixed?
> >
> > Attached are the 'rabbitmqctl report' and the appropriate log from
> > /var/log/rabbitmq/
>
> The log contains {error,enospc}. This means the disk ran out of space.
> The only way to prevent this condition is to monitor the disk free space
> and stop publishers or provision more space before space runs out.
>
> If you restart the broker while out of disk space then recovery of
> messages will fail. The broker makes a backup of the data directory
> first, but this would have failed.
>
> The next version of RabbitMQ (after v2.8.1) will deal with this
> condition more gracefully by throttling producers when disk space runs
> low as well as when RAM runs low.
>
>
> -Emile
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120403/7b4ac134/attachment.htm>

From fearsome.lucidity at gmail.com  Wed Apr  4 00:16:58 2012
From: fearsome.lucidity at gmail.com (Elias Levy)
Date: Tue, 3 Apr 2012 16:16:58 -0700
Subject: [rabbitmq-discuss] RabbitMQ appears to send 0-9-1 formated message
	to 0-8 client
Message-ID: <CAFDmHdOVR6-uNinJR5Gm2gQTTQRvuUdLtPGa-OXkHxLgG2F3Rw@mail.gmail.com>

Good day,

We are running in a problem while deploying a new cluster.  The one node
(dev) cluster is running RabbitMQ 2.71.  We got some Perl Net::AMQP clients
that connect to the cluster and subscribes to a queue.  The clients are
existing with an error, usually after consuming a handful of messages.  The
error is "No way to unpack field 'redelivered' type 't'".

It seems the client is dying while unpacking the redelivered field in a
message delivery command.  The Net::AMQP client only supports the 0-8
protocol.  I've verified that RabbitMQ believes the client is connected
using AMQP 0-8.  My guess is that RabbitMQ is sending the client a 0-9-1
formated message, instead of a 0-8 message.  The "redelivered" field does
not appear to be defined in 0-8, and its type in 0-9-1 is boolean or "t",
which is also not defined in 0-8.  Thus, Net::AMQP is throwing an error
when it finds a field of an unknown type.

The client's owner claims the client has worked successfully against the
same messages we are feeding it on a 2.5.1 cluster.  So we are wondering if
something changed between 2.5.1 and 2.7.1 that may cause this behavior.

We've also tested queues as both HA and non-HA and observe the same problem
(we figured it may be related to the new HA code since we we had configured
them as HA queues).

We are going to start downgrading the cluster one version at a time towards
2.5.1 to determine whether some version does not exhibit the problem.

RabbitMQ folks, any suggestions?

Elias Levy
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120403/c148debb/attachment.htm>

From matthias at rabbitmq.com  Wed Apr  4 07:44:31 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 04 Apr 2012 07:44:31 +0100
Subject: [rabbitmq-discuss] Upgrade 2.7.1 RabbitMQ cluster to 2.8.1
	version
In-Reply-To: <25862303.165.1333350074529.JavaMail.geo-discussion-forums@pbcvw3>
References: <32143157.102.1333329241115.JavaMail.geo-discussion-forums@pbcr5>	<5d9f08ec-40f4-4789-af03-df2d8656fd03@k14g2000vbe.googlegroups.com>
	<25862303.165.1333350074529.JavaMail.geo-discussion-forums@pbcvw3>
Message-ID: <4F7BEDCF.6070708@rabbitmq.com>

Roshan,

On 02/04/12 08:01, Codevally wrote:
> Currently we don't have any load-balancer installed and all the
> operations are hardcoded.

In that case, as Brendan said ...

> On Monday, April 2, 2012 2:35:11 PM UTC+10, Brendan Hay wrote:
>     I would suggest you provision a _new_ physical cluster running 2.8.1
>     side by side with your old cluster, and then incrementally move
>     producers/consumers over.

...though if your apps have the broker addresses hard-coded then you'll 
have to employ some DNS or even IP trickery to make the switch to the 
new cluster.

Longer term you may want to look at connecting a set of brokers via 
federation of shovel; you'd then be able to upgrade the individual 
brokers independently. Though whether employing federation/shovel is 
feasible very much depends on your app.

Matthias.

From matti.linnanvuori at portalify.com  Wed Apr  4 08:12:32 2012
From: matti.linnanvuori at portalify.com (Matti Linnanvuori)
Date: Wed, 4 Apr 2012 10:12:32 +0300
Subject: [rabbitmq-discuss] librabbitmq faults
In-Reply-To: <CAAt2poJxUX19CoZC6DJq7gtSzs+VTfzmhKzDTWG+Wd04zXYwcw@mail.gmail.com>
References: <BAD9CCAC-6116-4CE6-AE09-088CD6386592@portalify.com>
	<CAAt2poJxUX19CoZC6DJq7gtSzs+VTfzmhKzDTWG+Wd04zXYwcw@mail.gmail.com>
Message-ID: <3B34C005-3EE0-486D-943E-0EE2D62D1C9E@portalify.com>

Hi!

I wonder how it is possible to have recv hang if RabbitMQ server has disconnected. Maybe RabbitMQ server has a bug that it does not disconnect a socket.

I am afraid I don't have a succinct example that can reproduce this segfault. It occurred with Net::RabbitMQ versions 0.2.0 and 0.2.2, but not with rabbitmq-c-fb6fca832fd2.

I reported the segmentation fault in CPAN:
https://rt.cpan.org/Public/Bug/Display.html?id=76205

I got the segmentation fault in subroutine get. I think it is because memory allocation failed.
I have Net::RabbitMQ version 0.2.2. I got a similar bug in Net::RabbitMQ version 0.2.0, too:https://rt.cpan.org/Public/Bug/Display.html?id=76156
This is perl, v5.10.0 built for x86_64-linux-thread-multi
Linux pmc-inst-test 2.6.32.12-0.7-default #1 SMP 2010-05-20 11:14:20 +0200 x86_64 x86_64 x86_64 GNU/Linux

Program received signal SIGSEGV, Segmentation fault.
0x00007ffff724fa41 in memcpy () from /lib64/libc.so.6
(gdb) bt
#0 0x00007ffff724fa41 in memcpy () from /lib64/libc.so.6
#1 0x00007ffff6db2c0d in amqp_handle_input (state=0x7bc8a0, 
received_data=..., decoded_frame=0x7fffffffe2c0)
at /usr/include/bits/string3.h:52
#2 0x00007ffff6dbbeec in wait_frame_inner (state=0x7bc8a0, 
decoded_frame=0x7fffffffe2c0) at amqp_socket.c:167
#3 0x00007ffff6dbc489 in amqp_simple_rpc (state=0x7bc8a0, channel=3, 
request_id=, expected_reply_ids=0x7fffffffe3a0, 
decoded_request_method=) at amqp_socket.c:283
#4 0x00007ffff6db156c in amqp_basic_get (state=0x7bc8a0, channel=7, 
queue=..., no_ack=1) at amqp_api.c:258
#5 0x00007ffff6da7432 in XS_Net__RabbitMQ_get (my_perl=, 
cv=) at RabbitMQ.xs:618
#6 0x000000000047e115 in Perl_pp_entersub ()
#7 0x0000000000455ad3 in Perl_runops_debug ()
#8 0x000000000047a005 in perl_run ()
#9 0x000000000042172c in main ()
(gdb)

#!/usr/bin/perl -w

=pod

=head1 sds2sds_sf_fault.t

 Test 1: publish a Dispatch JSON message with ack_level and valid_until
 - from SDS to SDS in exchange.pmc.router-in.
 Try to receive a message from exchange.pmc.router-in in 8 seconds.
 Test 1 expected result: a message is received from exchange.pmc.router-in in 8 seconds.
 Test 2: decode the message as JSON.
 Test 2 expected result: the message is decoded as JSON.
 Test 3: check that the sender field is the same as in the sent message.
 Test 3 expected result: the sender field is the same as in the sent message.
 Test 4: check the body of the received message and the sent one.
 Test 4 expected result: the body fields are the same.
 Test 5: check the timestamp field.
 Test 5 expected result: the timestamp field is the same as in the published message.
 Test 6: try to receive a message from exchange.pmc.sf-in in 8 seconds.
 Test 6 expected result: a message is received from exchange.pmc.sf-in in 8 seconds.
 Test 7: decode the message as JSON.
 Test 7 expected result: the message is decoded as JSON.
 Test 8: check that the sender field is "exchange.pmc.router-in".
 Test 8 expected result: the sender field is "exchange.pmc.router-in".
 Test 9: check the body of the received message and the sent one.
 Test 9 expected result: the body fields are the same.
 Test 10: check that the timestamp in an integer.
 Test 10 expected result: the timestamp in an integer.
 Test 11: check that the timestamp is greater than or equal to that of before publishing.
 Test 11 expected result: the timestamp is greater than or equal to that of before publishing.
 Test 12: check that the timestamp is less than or equal to that of now.
 Test 12 expected result: the timestamp is less than or equal to that of now.
 Test 13: try to receive a message from exchange.pmc.router-in in 8 seconds.
 Test 13 expected result: a message is received from exchange.pmc.router-in in 8 seconds.
 Test 14: decode the message as JSON.
 Test 14 expected result: the message is decoded as JSON.
 Test 15: check that the sender field is "exchange.pmc.sf-in".
 Test 15 expected result: the sender field is "exchange.pmc.sf-in".
 Test 16: check the body of the received message and the sent one.
 Test 16 expected result: the body fields are the same.
 Test 17: check that the timestamp in an integer.
 Test 17 expected result: the timestamp in an integer.
 Test 18: check that the timestamp is greater than or equal to that of before publishing.
 Test 18 expected result: the timestamp is greater than or equal to that of before publishing.
 Test 19: check that the timestamp is less than or equal to that of now.
 Test 19 expected result: the timestamp is less than or equal to that of now.
 Test 20: try to receive a message from exchange.pmc.router-in in 8 seconds.
 Test 20 expected result: a message is received from exchange.pmc.router-in in 8 seconds.
 Test 21: decode the message as JSON.
 Test 21 expected result: the message is decoded as JSON.
 Test 22: check that the sender field is "exchange.pmc.sf-in".
 Test 22 expected result: the sender field is "exchange.pmc.sf-in".
 Test 23: check that the timestamp in an integer.
 Test 23 expected result: the timestamp in an integer.
 Test 24: check that the timestamp is greater than or equal to that of before publishing.
 Test 24 expected result: the timestamp is greater than or equal to that of before publishing.
 Test 25: check that the timestamp is less than or equal to that of now.
 Test 25 expected result: the timestamp is less than or equal to that of now.
 Test 26: check that the id fields of the received and the published messages are the same.
 Test 26 expected result: the id fields of the received and the published messages are the same.
 Test 27: check that the ack_type field has value "processed".
 Test 27 expected result: the ack_type field has value "processed".
 Test 28: check that the from field of the received message is the same as
 the to field of the published message.
 Test 28 expected result: the from field of the received message is the same as
 the to field of the published message.
 Test 29: check that the type field has value "ack".
 Test 29 expected result: the type field has value "ack".
 Test 30: check that the version field has value 1.
 Test 30 expected result: the version field has value 1.
 Test 31: try to receive a message from exchange.pmc.cassidian-in in 8 seconds.
 Test 31 expected result: a message is received from exchange.pmc.cassidian-in in 8 seconds.
 Test 32: decode the message as JSON.
 Test 32 expected result: the message is decoded as JSON.
 Test 33: check that the sender field is "exchange.pmc.router-in".
 Test 33 expected result: the sender field is "exchange.pmc.router-in".
 Test 34: check the body of the received message and the sent one.
 Test 34 expected result: the body fields are the same.
 Test 35: check that the timestamp in an integer.
 Test 35 expected result: the timestamp in an integer.
 Test 36: check that the timestamp is greater than or equal to that of before publishing.
 Test 36 expected result: the timestamp is greater than or equal to that of before publishing.
 Test 37: check that the timestamp is less than or equal to that of now.
 Test 37 expected result: the timestamp is less than or equal to that of now.
 Test 38: try to receive a message from exchange.pmc.cassidian-in in 8 seconds.
 Test 38 expected result: a message is received from exchange.pmc.cassidian-in in 8 seconds.
 Test 39: decode the message as JSON.
 Test 39 expected result: the message is decoded as JSON.
 Test 40: check that the sender field is "exchange.pmc.router-in".
 Test 40 expected result: the sender field is "exchange.pmc.router-in".
 Test 41: check that the timestamp in an integer.
 Test 41 expected result: the timestamp in an integer.
 Test 42: check that the timestamp is greater than or equal to that of before publishing.
 Test 42 expected result: the timestamp is greater than or equal to that of before publishing.
 Test 43: check that the timestamp is less than or equal to that of now.
 Test 43 expected result: the timestamp is less than or equal to that of now.
 Test 44: check that the id fields of the received and the published messages are the same.
 Test 44 expected result: the id fields of the received and the published messages are the same.
 Test 45: check that the ack_type field has value "processed".
 Test 45 expected result: the ack_type field has value "processed".
 Test 46: check that the from field of the received message is the same as
 the to field of the published message.
 Test 46 expected result: the from field of the received message is the same as
 the to field of the published message.
 Test 47: check that the type field has value "ack".
 Test 47 expected result: the type field has value "ack".
 Test 48: check that the version field has value 1.
 Test 48 expected result: the version field has value 1.
 Test 49: publish an Ack sent message from the SSI in exchange.pmc.router-in.
 try to receive a message from exchange.pmc.router-in in 8 seconds.
 Test 49 expected result: a message is received from exchange.pmc.router-in in 8 seconds.
 Test 50: decode the message as JSON.
 Test 50 expected result: the message is decoded as JSON.
 Test 51: check that the timestamp of the received message is the same as that of published one.
 Test 51 expected result:
 the timestamp of the received message is the same as that of published one.
 Test 52: check the sender field of the received message.
 Test 52 expected result:
 the sender field of the received message has value "exchange.pmc.cassidian-in".
 Test 53: check the body fields of the received and the published messages.
 Test 53 expected result:
 the body fields of the received and the published messages are the same.
 Test 54: try to receive a message from exchange.pmc.sf-in in 8 seconds.
 Test 54 expected result: a message is received from exchange.pmc.sf-in in 8 seconds.
 Test 55: decode the message as JSON.
 Test 55 expected result: the message is decoded as JSON.
 Test 56: check the sender field of the received message.
 Test 56 expected result:
 the sender field of the received message has value "exchange.pmc.router-in".
 Test 57: check the body fields of the received and the published messages.
 Test 57 expected result:
 the body fields of the received and the published messages are the same.
 Test 58: check that the timestamp in an integer.
 Test 58 expected result: the timestamp in an integer.
 Test 59: check that the timestamp is greater than or equal to that of before publishing.
 Test 59 expected result: the timestamp is greater than or equal to that of before publishing.
 Test 60: check that the timestamp is less than or equal to that of now.
 Test 60 expected result: the timestamp is less than or equal to that of now.
 Test 61: try to receive a message from exchange.pmc.router-in in 8 seconds.
 Test 61 expected result: a message is received from exchange.pmc.router-in in 8 seconds.
 Test 62: decode the message as JSON.
 Test 62 expected result: the message is decoded as JSON.
 Test 63: check the sender field of the received message.
 Test 63 expected result:
 the sender field of the received message has value "exchange.pmc.sf-in".
 Test 64: check the body fields of the received and the published messages.
 Test 64 expected result:
 the body fields of the received and the published messages are the same.
 Test 65: check that the timestamp in an integer.
 Test 65 expected result: the timestamp in an integer.
 Test 66: check that the timestamp is greater than or equal to that of before publishing.
 Test 66 expected result: the timestamp is greater than or equal to that of before publishing.
 Test 67: check that the timestamp is less than or equal to that of now.
 Test 67 expected result: the timestamp is less than or equal to that of now.
 Test 68: try to receive a message from exchange.pmc.cassidian-in in 8 seconds.
 Test 68 expected result: a message is received from exchange.pmc.cassidian-in in 8 seconds.
 Test 69: decode the message as JSON.
 Test 69 expected result: the message is decoded as JSON.
 Test 70: check the sender field of the received message.
 Test 70 expected result:
 the sender field of the received message has value "exchange.pmc.router-in".
 Test 71: check the body fields of the received and the published messages.
 Test 71 expected result:
 the body fields of the received and the published messages are the same.
 Test 72: check that the timestamp in an integer.
 Test 72 expected result: the timestamp in an integer.
 Test 73: check that the timestamp is greater than or equal to that of before publishing.
 Test 73 expected result: the timestamp is greater than or equal to that of before publishing.
 Test 74: check that the timestamp is less than or equal to that of now.
 Test 74 expected result: the timestamp is less than or equal to that of now.

=cut

use strict;

use Net::RabbitMQ;
use Test::More tests => 74;
use JSON;
use Time::HiRes qw(gettimeofday);

use constant ROUTER_EXCHANGE    => 'exchange.pmc.router-in';
use constant ROUTER_CHANNEL     => 1;
use constant ROUTER_QUEUE       => 'queue.test.router-in';
use constant SF_EXCHANGE        => 'exchange.pmc.sf-in';
use constant SF_CHANNEL         => 2;
use constant SF_QUEUE           => 'queue.test.sf-in';
use constant CASSIDIAN_EXCHANGE => 'exchange.pmc.cassidian-in';
use constant CASSIDIAN_CHANNEL  => 3;
use constant CASSIDIAN_QUEUE    => 'queue.test.cassidian-in';

sub timestamp {
    return int( gettimeofday() * 1000 );
}

system(
'service pmc-smpp stop >&2; service pmc-cassidian stop >&2; service pmc-email stop >&2; service pmc-sf stop >&2; service pmc-routing stop >&2'
);

sleep 1;    # Wait for the message-sending to stop.

system(
    'rabbitmqctl stop_app; rabbitmqctl reset; rabbitmqctl start_app; mongo <<END
use database
db.dropDatabase();
END'
);

system('service pmc-sf start >&2; service pmc-routing start >&2');

sleep 8;    # Wait for Store & Forward and Routing to start.

my $json_text = '{
"timestamp" : 1330327514213,
"sender" : "' . CASSIDIAN_EXCHANGE . '",
"body" : {
"type" : "dispatch",
"version" : 1,
"id" : "8f970b1b-f8a3-4c78-aa24-3b8e2205648788",
"from" : {
"type" : "ssi",
"address" : "16777215"
},
"to" : {
"type" : "ssi",
"address" : "0"
},
"body" : "This is a test message.",
"ack_level" : "sent",
"valid_until" : 9223372036854775807,
"auxiliary" : {
"timestamp" : 1325376000000,
"sdstl" : {
"protocol_id" : 130,
"message_reference" : 42,
"short_report_allowed" : true,
"protocol_data" : {
"encoding" : 0,
"timestamp" : {
"month" : 1,
"day" : 1,
"hour" : 0,
"minute" : 0
}
}
}
}
}
}';

my $mq_router = Net::RabbitMQ->new();
$mq_router->connect( "localhost", { user => "guest", password => "guest" } );
$mq_router->channel_open(ROUTER_CHANNEL);
$mq_router->queue_declare(
    ROUTER_CHANNEL,
    ROUTER_QUEUE,
    {
        passive     => 0,
        durable     => 1,
        exclusive   => 0,
        auto_delete => 0
    }
);
$mq_router->queue_bind( ROUTER_CHANNEL, ROUTER_QUEUE, ROUTER_EXCHANGE, '' );
$mq_router->purge( ROUTER_CHANNEL, ROUTER_QUEUE );
$mq_router->consume( ROUTER_CHANNEL, ROUTER_QUEUE );

my $mq_sf = Net::RabbitMQ->new();
$mq_sf->connect( "localhost", { user => "guest", password => "guest" } );
$mq_sf->channel_open(SF_CHANNEL);
$mq_sf->exchange_declare(
    SF_CHANNEL,
    SF_EXCHANGE,
    {
        exchange_type => 'direct',
        passive       => 0,
        durable       => 1,
        auto_delete   => 0
    }
);
$mq_sf->queue_declare(
    SF_CHANNEL,
    SF_QUEUE,
    {
        passive     => 0,
        durable     => 1,
        exclusive   => 0,
        auto_delete => 0
    }
);
$mq_sf->queue_bind( SF_CHANNEL, SF_QUEUE, SF_EXCHANGE, '' );
$mq_sf->purge( SF_CHANNEL, SF_QUEUE );
$mq_sf->consume( SF_CHANNEL, SF_QUEUE );

my $mq_cassidian = Net::RabbitMQ->new();
$mq_cassidian->connect( "localhost", { user => "guest", password => "guest" } );
$mq_cassidian->channel_open(CASSIDIAN_CHANNEL);
$mq_cassidian->exchange_declare(
    CASSIDIAN_CHANNEL,
    CASSIDIAN_EXCHANGE,
    {
        exchange_type => 'direct',
        passive       => 0,
        durable       => 1,
        auto_delete   => 0
    }
);
$mq_cassidian->queue_declare(
    CASSIDIAN_CHANNEL,
    CASSIDIAN_QUEUE,
    {
        passive     => 0,
        durable     => 1,
        exclusive   => 0,
        auto_delete => 0
    }
);
$mq_cassidian->queue_bind( CASSIDIAN_CHANNEL, CASSIDIAN_QUEUE,
    CASSIDIAN_EXCHANGE, '' );
$mq_cassidian->purge( CASSIDIAN_CHANNEL, CASSIDIAN_QUEUE );
$mq_cassidian->consume( CASSIDIAN_CHANNEL, CASSIDIAN_QUEUE );

my $before = timestamp();

$mq_router->publish(
    ROUTER_CHANNEL,
    '',
    $json_text,
    {

        # Options
        exchange => ROUTER_EXCHANGE
    },
    {

        # Props
        content_encoding => "UTF-8",
        content_type     => "application/json"
    }
);

my $sent = decode_json($json_text);
my $message;
eval {
    local $SIG{ALRM} = sub { die "Timeout\n" };
    alarm 8;
    $message = $mq_router->recv();
    alarm 0;
};
is( $@, '', 'A message was received from queue' );
my $json;
eval { $json = decode_json( $message->{'body'} ); };
is( $@, '', 'A JSON message received' );
is( $json->{'sender'}, $sent->{'sender'}, 'sender ' . $sent->{'sender'} );
is_deeply( $json->{'body'}, $sent->{'body'}, 'body the same' );
is( $json->{'timestamp'}, $sent->{'timestamp'},
    "timestamp " . $sent->{'timestamp'} );

undef $message;
eval {
    local $SIG{ALRM} = sub { die "Timeout\n" };
    alarm 8;
    $message = $mq_sf->recv();
    alarm 0;
};
is( $@, '', 'A message was received' );
undef $json;
eval { $json = decode_json( $message->{'body'} ); };
is( $@, '', 'A JSON message received' );
is( $json->{'sender'}, ROUTER_EXCHANGE, 'sender ' . ROUTER_EXCHANGE );
is_deeply( $json->{'body'}, $sent->{'body'}, 'body the same' );
like( $json->{'timestamp'}, qr/^\d+$/, "timestamp an integer" );
ok( $json->{'timestamp'} >= $before,
    'timestamp greater than or equal to that of before publishing' )
  or diag("$json->{'timestamp'} < $before");
my $now = timestamp();
ok( $json->{'timestamp'} <= $now,
    'timestamp less than or equal to that of now' )
  or diag("$json->{'timestamp'} > $now");

undef $message;
eval {
    local $SIG{ALRM} = sub { die "Timeout\n" };
    alarm 8;
    $message = $mq_router->recv();
    alarm 0;
};
is( $@, '', 'A message was received' );
undef $json;
eval { $json = decode_json( $message->{'body'} ); };
is( $@,                '',          'A JSON message received' );
is( $json->{'sender'}, SF_EXCHANGE, 'sender ' . SF_EXCHANGE );
is_deeply( $json->{'body'}, $sent->{'body'}, 'body the same' );
like( $json->{'timestamp'}, qr/^\d+$/, "timestamp an integer" );
ok( $json->{'timestamp'} >= $before,
    'timestamp greater than or equal to that of before publishing' )
  or diag("$json->{'timestamp'} < $before");
$now = timestamp();
ok( $json->{'timestamp'} <= $now,
    'timestamp less than or equal to that of now' )
  or diag("$json->{'timestamp'} > $now");

undef $message;
eval {
    local $SIG{ALRM} = sub { die "Timeout\n" };
    alarm 8;
    $message = $mq_router->recv();
    alarm 0;
};
is( $@, '', 'A message was received' );
undef $json;
eval { $json = decode_json( $message->{'body'} ); };
is( $@,                '',          'A JSON message received' );
is( $json->{'sender'}, SF_EXCHANGE, 'sender ' . SF_EXCHANGE );
like( $json->{'timestamp'}, qr/^\d+$/, "timestamp an integer" );
ok( $json->{'timestamp'} >= $before,
    'timestamp greater than or equal to that of before publishing' )
  or diag("$json->{'timestamp'} < $before");
$now = timestamp();
ok( $json->{'timestamp'} <= $now,
    'timestamp less than or equal to that of now' )
  or diag("$json->{'timestamp'} > $now");
is( $json->{'body'}->{'id'}, $sent->{'body'}->{'id'}, 'id the same' );
is( $json->{'body'}->{'ack_type'}, 'processed', 'ack_type processed' );
is_deeply(
    $json->{'body'}->{'from'},
    $sent->{'body'}->{'to'},
    'from is the same as to of sent'
);
is( $json->{'body'}->{'type'},    'ack', 'type is ack' );
is( $json->{'body'}->{'version'}, 1,     'version is 1' );

my $end = time() + 8;
undef $message;
do {
    eval {
        $message = $mq_cassidian->get( CASSIDIAN_CHANNEL, CASSIDIAN_QUEUE );
    };
    if ($@) {
        diag($@);
    }
} until ( defined $message or time() > $end or $@ );
ok( defined $message, 'A message was received' );
undef $json;
eval { $json = decode_json( $message->{'body'} ); };
is( $@, '', 'A JSON message received' );
is( $json->{'sender'}, ROUTER_EXCHANGE, 'sender ' . ROUTER_EXCHANGE );
is_deeply( $json->{'body'}, $sent->{'body'}, 'body the same' );
like( $json->{'timestamp'}, qr/^\d+$/, "timestamp an integer" );
ok( $json->{'timestamp'} >= $before,
    'timestamp greater than or equal to that of before publishing' )
  or diag("$json->{'timestamp'} < $before");
$now = timestamp();
ok( $json->{'timestamp'} <= $now,
    'timestamp less than or equal to that of now' )
  or diag("$json->{'timestamp'} > $now");

$end = time() + 8;
note("Trying to receive an Ack from Cassidian exchange");
undef $message;
do {
    eval {
        $message = $mq_cassidian->get( CASSIDIAN_CHANNEL, CASSIDIAN_QUEUE );
    };
    if ($@) {
        diag($@);
    }
} until ( defined $message or time() > $end or $@ );
ok( defined $message, 'A message was received' );
undef $json;
eval { $json = decode_json( $message->{'body'} ); };
is( $@, '', 'A JSON message received' );
is( $json->{'sender'}, ROUTER_EXCHANGE, 'sender ' . ROUTER_EXCHANGE );
like( $json->{'timestamp'}, qr/^\d+$/, "timestamp an integer" );
ok( $json->{'timestamp'} >= $before,
    'timestamp greater than or equal to that of before publishing' )
  or diag("$json->{'timestamp'} < $before");
$now = timestamp();
ok( $json->{'timestamp'} <= $now,
    'timestamp less than or equal to that of now' )
  or diag("$json->{'timestamp'} > $now");
is( $json->{'body'}->{'id'}, $sent->{'body'}->{'id'}, 'id the same' );
is( $json->{'body'}->{'ack_type'}, 'processed', 'ack_type processed' );
is_deeply(
    $json->{'body'}->{'from'},
    $sent->{'body'}->{'to'},
    'from is the same as to of sent'
);
is( $json->{'body'}->{'type'},    'ack', 'type is ack' );
is( $json->{'body'}->{'version'}, 1,     'version is 1' );

my $ack = '{
"timestamp" : 1328020064358,
"sender" : "' . CASSIDIAN_EXCHANGE . '",
"body" : {
"type" : "ack",
"version" : 1,
"id" : "8f970b1b-f8a3-4c78-aa24-3b8e2205648788",
"from" : {
"type" : "ssi",
"address" : "0"
},
"ack_type" : "sent",
"auxiliary" : {
"timestamp" : 1325376000000,
"original_message" : ' . encode_json( $sent->{'body'} ) . ',
"sdstl" : {
"protocol_id" : 130,
"message_reference" : 42,
"short_report_allowed" : true,
"protocol_data" : {
"encoding" : 0,
"timestamp" : {
"month" : 1,
"day" : 1,
"hour" : 0,
"minute" : 0
}
}
}
}
}
}';
$sent   = decode_json($ack);
$before = timestamp();

$mq_router->publish(
    ROUTER_CHANNEL,
    '', $ack,
    {

        # Options
        exchange => ROUTER_EXCHANGE
    },
    {

        # Props
        content_encoding => "UTF-8",
        content_type     => "application/json"
    }
);

undef $message;
eval {
    local $SIG{ALRM} = sub { die "Timeout\n" };
    alarm 8;
    $message = $mq_router->recv();
    alarm 0;
};
is( $@, '', 'A message was received' );
undef $json;
eval { $json = decode_json( $message->{'body'} ); };
is( $@, '', 'A JSON message received' );
is( $json->{'timestamp'}, $sent->{'timestamp'},
    'timestamp ' . $sent->{'timestamp'} )
  or diag( $message->{'body'} );
is( $json->{'sender'}, CASSIDIAN_EXCHANGE, 'sender ' . CASSIDIAN_EXCHANGE )
  or diag( $message->{'body'} );
is_deeply( $json->{'body'}, $sent->{'body'}, 'body the same' )
  or diag( $message->{'body'} );

undef $message;
eval {
    local $SIG{ALRM} = sub { die "Timeout\n" };
    alarm 8;
    $message = $mq_sf->recv();
    alarm 0;
};
is( $@, '', 'A message was received' );
undef $json;
eval { $json = decode_json( $message->{'body'} ); };
is( $@, '', 'A JSON message received' );
is( $json->{'sender'}, ROUTER_EXCHANGE, 'sender ' . ROUTER_EXCHANGE );
is_deeply( $json->{'body'}, $sent->{'body'}, 'body the same' );
like( $json->{'timestamp'}, qr/^\d+$/, "timestamp an integer" );
ok( $json->{'timestamp'} >= $before,
    'timestamp greater than or equal to that of before publishing' )
  or diag("$json->{'timestamp'} < $before");
$now = timestamp();
ok( $json->{'timestamp'} <= $now,
    'timestamp less than or equal to that of now' )
  or diag("$json->{'timestamp'} > $now");

undef $message;
eval {
    local $SIG{ALRM} = sub { die "Timeout\n" };
    alarm 8;
    $message = $mq_router->recv();
    alarm 0;
};
is( $@, '', 'A message was received' );
undef $json;
eval { $json = decode_json( $message->{'body'} ); };
is( $@,                '',          'A JSON message received' );
is( $json->{'sender'}, SF_EXCHANGE, 'sender ' . SF_EXCHANGE );
is_deeply( $json->{'body'}, $sent->{'body'}, 'body the same' );
like( $json->{'timestamp'}, qr/^\d+$/, "timestamp an integer" );
ok( $json->{'timestamp'} >= $before,
    'timestamp greater than or equal to that of before publishing' )
  or diag("$json->{'timestamp'} < $before");
$now = timestamp();
ok( $json->{'timestamp'} <= $now,
    'timestamp less than or equal to that of now' )
  or diag("$json->{'timestamp'} > $now");

undef $message;
eval {
    local $SIG{ALRM} = sub { die "Timeout\n" };
    alarm 8;
    $message = $mq_cassidian->recv();
    alarm 0;
};
is( $@, '', 'A message was received' );
undef $json;
eval { $json = decode_json( $message->{'body'} ); };
is( $@, '', 'A JSON message received' );
is( $json->{'sender'}, ROUTER_EXCHANGE, 'sender ' . ROUTER_EXCHANGE );
is_deeply( $json->{'body'}, $sent->{'body'}, 'body the same' );
like( $json->{'timestamp'}, qr/^\d+$/, "timestamp an integer" );
ok( $json->{'timestamp'} >= $before,
    'timestamp greater than or equal to that of before publishing' )
  or diag("$json->{'timestamp'} < $before");
$now = timestamp();
ok( $json->{'timestamp'} <= $now,
    'timestamp less than or equal to that of now' )
  or diag("$json->{'timestamp'} > $now");

END {
    $mq_sf->queue_unbind( SF_CHANNEL, SF_QUEUE, SF_EXCHANGE, '' );
    $mq_router->queue_unbind( ROUTER_CHANNEL, ROUTER_QUEUE, ROUTER_EXCHANGE,
        '' );
    $mq_cassidian->queue_unbind( CASSIDIAN_CHANNEL, CASSIDIAN_QUEUE,
        CASSIDIAN_EXCHANGE, '' );
    system(
'service pmc-smpp start >&2; service pmc-cassidian start >&2; service pmc-email start >&2'
    );
}

regards, Matti Linnanvuori

From emamdouh at cloud9ers.com  Tue Apr  3 15:04:10 2012
From: emamdouh at cloud9ers.com (Eslam Mamdouh)
Date: Tue, 3 Apr 2012 07:04:10 -0700 (PDT)
Subject: [rabbitmq-discuss] upgrade from rabbitmq 2.7.1 to rabbitmq 2.8.1
Message-ID: <15122599.64.1333461850507.JavaMail.geo-discussion-forums@yniy15>

Hi All,
i have two production servers in rabbitmq cluster "disk nodes"

rabbitmqctl cluster_status
> Cluster status of node rabbit at ga1 ...
> [{nodes,[{disc,[rabbit at ga2,rabbit at ga1]}]},
>  {running_nodes,[rabbit at ga2,rabbit at ga1]}]
> ...done.
>
>
with rabbitmq-server version 2.7.1-1 and i'd like to upgrade them to 
rabbitmq-server version 2.8.1-1

i tried to upgrade first node from 2.7.1-1 ot 2.8.1-1 but it didn't join 
rabbitmq cluster due to difference in rabbitmq-server versions

any recommendations regarding this issue ?

Thanks in adnavce 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120403/eb82fd9a/attachment.htm>

From emile at rabbitmq.com  Wed Apr  4 10:53:18 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 04 Apr 2012 10:53:18 +0100
Subject: [rabbitmq-discuss] upgrade from rabbitmq 2.7.1 to rabbitmq 2.8.1
In-Reply-To: <15122599.64.1333461850507.JavaMail.geo-discussion-forums@yniy15>
References: <15122599.64.1333461850507.JavaMail.geo-discussion-forums@yniy15>
Message-ID: <4F7C1A0E.5050308@rabbitmq.com>

Hi Eslam,

On 03/04/12 15:04, Eslam Mamdouh wrote:
> i tried to upgrade first node from 2.7.1-1 ot 2.8.1-1 but it didn't join
> rabbitmq cluster due to difference in rabbitmq-server versions

You have to shut down all nodes first. See
http://www.rabbitmq.com/clustering.html#upgrading

In particular:

"...it is necessary to stop all nodes in the cluster, then start all
nodes when performing an upgrade."

-Emile


From simon at rabbitmq.com  Wed Apr  4 10:57:48 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 04 Apr 2012 10:57:48 +0100
Subject: [rabbitmq-discuss] RabbitMQ appears to send 0-9-1 formated
 message to 0-8 client
In-Reply-To: <CAFDmHdOVR6-uNinJR5Gm2gQTTQRvuUdLtPGa-OXkHxLgG2F3Rw@mail.gmail.com>
References: <CAFDmHdOVR6-uNinJR5Gm2gQTTQRvuUdLtPGa-OXkHxLgG2F3Rw@mail.gmail.com>
Message-ID: <4F7C1B1C.3000905@rabbitmq.com>

On 04/04/12 00:16, Elias Levy wrote:
> It seems the client is dying while unpacking the redelivered field in a
> message delivery command.  The Net::AMQP client only supports the 0-8
> protocol.  I've verified that RabbitMQ believes the client is connected
> using AMQP 0-8.  My guess is that RabbitMQ is sending the client a 0-9-1
> formated message, instead of a 0-8 message.  The "redelivered" field
> does not appear to be defined in 0-8, and its type in 0-9-1 is boolean
> or "t", which is also not defined in 0-8.  Thus, Net::AMQP is throwing
> an error when it finds a field of an unknown type.

Hmm.

This is interesting, but I have a hard time believing it I'm afraid.

1) basic.deliver has a "redelivered" field in both AMQP 0-8 and 0-9-1 
(see line 2957 of the 0-8 XML).
2) In both versions of the standard, redelivered is of type "bit".
3) I don't recall any of the AMQP codec code changing since 2.5.1.
4) This is really basic stuff, any client that couldn't unpack 
basic.deliver would be so broken as to be useless.

So I wonder what might really be happening?

I note that Net::AMQP throws that exception in a function called 
unpack_field_table(). But the method fields aren't in a table.

We do however create a table in the message headers that has a key 
"redelivered". In federation. You haven't recently started using 
federation by any chance?

And we make that field boolean, because that's what it is. But from the 
AMQP 0-8 spec:

4.2.5.5  Field Tables

Field tables are long strings that contain packed name ?value pairs. 
Each name ?value pair is a structure that provides a field name, a field 
type, and a field value.  A field can hold a tiny text string, a long 
string, a long signed integer, a decimal, a date and/or time, or another 
field table.

Damn it.

So I guess we need to do some field type mapping when talking to 0-8 
clients. I had hoped the 0-8 clients would have gone away by now...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From emamdouh at cloud9ers.com  Wed Apr  4 11:22:32 2012
From: emamdouh at cloud9ers.com (Eslam Mamdouh)
Date: Wed, 4 Apr 2012 12:22:32 +0200
Subject: [rabbitmq-discuss] upgrade from rabbitmq 2.7.1 to rabbitmq 2.8.1
In-Reply-To: <4F7C1A0E.5050308@rabbitmq.com>
References: <15122599.64.1333461850507.JavaMail.geo-discussion-forums@yniy15>
	<4F7C1A0E.5050308@rabbitmq.com>
Message-ID: <CAHAaT5tE0x6VCq-5cz0ehKudjnLsEhggn-kw_f+a13A+-2=zZQ@mail.gmail.com>

may i ask if there is a way so as not to shutdown all nodes ,
plus i'd like to know if persistent rabbitmq files will be compatible with
new version or not "/var/lib/rabbitmq"

On Wed, Apr 4, 2012 at 11:53 AM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi Eslam,
>
> On 03/04/12 15:04, Eslam Mamdouh wrote:
> > i tried to upgrade first node from 2.7.1-1 ot 2.8.1-1 but it didn't join
> > rabbitmq cluster due to difference in rabbitmq-server versions
>
> You have to shut down all nodes first. See
> http://www.rabbitmq.com/clustering.html#upgrading
>
> In particular:
>
> "...it is necessary to stop all nodes in the cluster, then start all
> nodes when performing an upgrade."
>
> -Emile
>
>


-- 
Best Regards,
Eslam Mamdouh El Husseiny
*Systems Administrator**
Cloud Niners Ltd.

*
*Cellular: (+2) 011 198 40 40
Mansoura: (+2) 050 234 70 81
Cairo:    (+2) 022 *268 34 60
Fax:      (+2) 022 268 34 63
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120404/3cd61d1b/attachment.htm>

From emile at rabbitmq.com  Wed Apr  4 11:43:42 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 04 Apr 2012 11:43:42 +0100
Subject: [rabbitmq-discuss] Client connection to ssl rabbitMQ is very
 slow
In-Reply-To: <33544994.post@talk.nabble.com>
References: <33544994.post@talk.nabble.com>
Message-ID: <4F7C25DE.40703@rabbitmq.com>

Hi,

On 02/04/12 15:26, Rabbit001 wrote:
>   I've follow the ssl configuration instructions in rabbitmq page
> 'www.rabbitmq.com/ssl.html' to configure ssl access to rabbitmq server. I've
> started rabbitmq server correctly and I've executed the example1 (sample
> code for ssl java client) and the result is good, but the method
> factory.newConnection() finish over 5sg. In the other hand, without ssl  the
> method factory.newConnection() finish in <200 ms.
> 
>   How do i increasse the performance in the first scenario (ssl
> configuration)? any idea?

If your broker CPU has hardware support for certain ciphers and OpenSSL
can make use of it then try to restrict the SSL connection to those
ciphers, or to prioritise them. The "ciphers" SSL configuration option
in the broker is one way of achieving that. For configuration details
see http://www.erlang.org/doc/man/ssl.html

You might also gain some useful insight by using an SSL traffic analyser
such as "ssldump". If long gaps appear in the timeline then the output
may help you to determine what is responsible for the delay.

Do other SSL clients also take long to connect? Try using the "openssl
s_client" option as described here:
http://www.rabbitmq.com/troubleshooting-ssl.html
and check whether such connections also take long.

Does the Java client take long to connect when the SSL layer is provided
by a different SSL service? You can try this by connecting to the broker
via stunnel, socat or similar.

The last two questions may help you to focus on whether the problem lies
on the client or server side.


-Emile



From emile at rabbitmq.com  Wed Apr  4 11:51:28 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 04 Apr 2012 11:51:28 +0100
Subject: [rabbitmq-discuss] upgrade from rabbitmq 2.7.1 to rabbitmq 2.8.1
In-Reply-To: <CAHAaT5tE0x6VCq-5cz0ehKudjnLsEhggn-kw_f+a13A+-2=zZQ@mail.gmail.com>
References: <15122599.64.1333461850507.JavaMail.geo-discussion-forums@yniy15>
	<4F7C1A0E.5050308@rabbitmq.com>
	<CAHAaT5tE0x6VCq-5cz0ehKudjnLsEhggn-kw_f+a13A+-2=zZQ@mail.gmail.com>
Message-ID: <4F7C27B0.4070805@rabbitmq.com>

Hi Eslam,

On 04/04/12 11:22, Eslam Mamdouh wrote:
> may i ask if there is a way so as not to shutdown all nodes ,

A concurrent thread on this mailing list with subject "Upgrade 2.7.1
RabbitMQ cluster to 2.8.1 version" answers that question.

> plus i'd like to know if persistent rabbitmq files will be compatible
> with new version or not "/var/lib/rabbitmq"

Yes, but only if the old version was v2.1.1 or newer.


-Emile



From majek04 at gmail.com  Wed Apr  4 11:57:38 2012
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 4 Apr 2012 11:57:38 +0100
Subject: [rabbitmq-discuss] Help with persistence using RabbitMQ?
In-Reply-To: <CA+-WFvwO490up48dR=4CC31HJwqwoZat5+C-SS1w4xForV=eog@mail.gmail.com>
References: <CA+-WFvwBN0j0bQw3dM7F_oQtkmmqk0bNNSzaNaeyzBWKMQ1j0g@mail.gmail.com>
	<CABzX+qwJ1-t8VVeXzVWQo4ky4s47pdF6fdMGYMyAea136JQcfw@mail.gmail.com>
	<CA+-WFvwO490up48dR=4CC31HJwqwoZat5+C-SS1w4xForV=eog@mail.gmail.com>
Message-ID: <CABzX+qxzihJ4Cu7gdWRvhjBW+ATcW1V4LDN6Tyx_rHCBE5kC0A@mail.gmail.com>

On Tue, Apr 3, 2012 at 17:22, iceblaze <iceblaze at gmail.com> wrote:
> Thanks for attempting to assist me here. I have made a light version of the
> module and a sender script as you requested. You can find the files here:
>
> http://iceblaze.com/rabbit.zip
>
> Simply unzip the files into the same directory and run the "sender.pl"
> script. Note that you will need to install Net::RabbitMQ from CPAN. You can
> also modify the login credentials for rabbit (right now its just using
> guest/guest) in $self of Rabbit.pm's new() function:
>
> ??????? my $self =
> ??????? {
> ??????????????? _rabbit => Net::RabbitMQ->new(),
> ??????????????? _rabbit_user => "guest",
> ??????????????? _rabbit_pass => "guest",
> ??????????????? _rabbit_host => "localhost",
> ??????????????? _rabbit_port => 5672,
> ??????????????? _queue => $queue,
> ??????????????? _channel => $channel,
> ??????????????? _no_ack => $no_ack,
> ??????????????? _queue_declared => '',
> ??????? };

Oh, installing Net::RabbitMQ from CPAN wasn't easy at all!
But in the end after few attempts "cpan; notest install Net::RabbitMQ"
did the trick.

So, the problem is that in your code the "delivery_mode => 2"
doesn't work.

(btw, I debugged your issue by using the management plugin and
getting a message from the queue using it - it clearly shows
that "delivery_mode" is not set)

Reading the docs:
http://search.cpan.org/~jesus/Net--RabbitMQ-0.2.2/RabbitMQ.pm

    publish($channel, $routing_key, $body, $options, $props)
    [...]
    $props is an optional hash (the AMQP 'props') respecting the
following keys: { content_type => $string, content_encoding =>
$string, correlation_id => $string, reply_to => $string, expiration =>
$string, message_id => $string, type => $string, user_id => $string,
app_id => $string, delivery_mode => $integer, priority => $integer,
timestamp => $integer, }

So, "delivery_mode" is a feature of "props", not "options".
Appropriate code should therefore look like:

    $self->{_rabbit}->publish($self->{_channel}, $self->{_queue},
$data, {mandatory => 1, immediate => 0 }, {delivery_mode => 2});


Additionally, if you want to shield against broker falling down,
and have a reliable message delivery you should be using
transactions or publish confirms.

By default sending messages in rabbit is asynchronous. You don't know
when the message reached the broker and even if it did so.
Rabbit recognizes this and it doesn't immediately flush messages
to disk. Actually it will be quire reluctant to save them on disk
(this has been tweaked in RabbitMQ 2.8.0).

If you wish to make sure that Rabbit indeed handled messages
reliably, you must use transactions or publisher confirms to
get a confirmation of delivery from the broker.
Once the confirmation is received you can be sure the messages
are safe.

On the other hand if you are only going to be closing rabbit
gracefully (via the init scripts), setting the "delivery_mode"
properly should be enough to persist your messages.

Marek

From matthew at rabbitmq.com  Wed Apr  4 12:58:26 2012
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 4 Apr 2012 12:58:26 +0100
Subject: [rabbitmq-discuss] Mirrored queue failover
In-Reply-To: <23815485.1333010167174.JavaMail.ka.fukui@ms.scsk.jp>
References: <23815485.1333010167174.JavaMail.ka.fukui@ms.scsk.jp>
Message-ID: <20120404115826.GB17969@rabbitmq.com>

Hi,

On Thu, Mar 29, 2012 at 05:36:07PM +0900, Katsushi Fukui wrote:
> I'm a RabbitMQ newbie and am trying to use mirrored queue in the
> cluster (3 disc nodes on the 3 servers). I use RabbitMQ 2.8.1, Erlang
> R15B, CentOS 6.2. I wanted to see the behavior of the failover in the
> case of any issue, so I tested some scenarios and I have a little
> confusion with the case below:
> 
> a) 3 nodes (rabbit1, rabbit2, rabbit3) are running, and I created que1
> on the rabbit1 with an argument "x-ha-policy":"all". So now que1 have
> a master node "rabbit1 and slave nodes "rabbit2" and "rabbit3", I
> confirmed it with the command "rabbitctl list_queues name durable pid
> slave_pids synchronised_slave_pids".
> 
> b) I stopped one of the slave node "rabbit2" with "rabbitctl stop".
> Now que1 has only one slave node "rabbit3".
> 
> c) Next, I started the node "rabbit2" using "rabbit-server -detached"
> and checked the cluster status with "rabbitctl cluster_status". It
> seems good 3 nodes has 3 disc nodes and running. But when I checked
> the queue status, que1 has just one slave "rabbit3". I restarted
> rabbit2 again, but rabbit2 doesn't become a slave of que1, also I can
> find a log like this:
> =ERROR REPORT==== 29-Mar-2012::15:12:40 ===
> Discarding message {'$gen_call',{<0.1876.0>,#Ref<0.0.0.8584>},info}
> from <0.1876.0> to <0.426.0> in an old incarnation (2) of this node
> (3)
> 
> In my understanding, when a new node is added in the cluster, that
> node will become a slave of the mirrored queues in that cluster. Is
> this correct?

Your understanding is correct. I am not sure why this problem has
occurred. The Error Report above is harmless, and is really just
documenting Erlang sorting itself out. What is the result of

rabbitmqctl list_queues name pid slave_pids

?

Also, if that suggests there are not 2 slaves, then could you check
through and send us (probably off-list) the logs of both rabbit2 as it
restarts, and for the same time period from rabbit1 and 3?

Matthew

From matti.linnanvuori at portalify.com  Wed Apr  4 13:16:45 2012
From: matti.linnanvuori at portalify.com (Matti Linnanvuori)
Date: Wed, 4 Apr 2012 15:16:45 +0300
Subject: [rabbitmq-discuss] librabbitmq faults
In-Reply-To: <CAAt2poJxUX19CoZC6DJq7gtSzs+VTfzmhKzDTWG+Wd04zXYwcw@mail.gmail.com>
References: <BAD9CCAC-6116-4CE6-AE09-088CD6386592@portalify.com>
	<CAAt2poJxUX19CoZC6DJq7gtSzs+VTfzmhKzDTWG+Wd04zXYwcw@mail.gmail.com>
Message-ID: <8FAD4E8C-15D1-44E8-8C39-29126DC0E686@portalify.com>

Hi!

I investigated the problem with the RabbitMQ client being stuck in recv system call.

I saw that netstat -ap shows that TCP connection to RabbitMQ server is established.
tcp        0      0 localhost:37915         localhost:amqp          ESTABLISHED 5841/perl           

However, messages keep piling in the queue that the Perl process is supposed to receive from:

rabbitmqctl list_queues
Listing queues ...
...
queue.pmc.router-in	71

The problem occurs only some time after RabbitMQ application is stopped, reset and started. 

This seems to me to be an error in RabbitMQ server. I am using RabbitMQ server version 2.7.1. Version 2.8.1 behaves the same.

I copy below the script that produces the error.

#!/usr/bin/perl -w

=pod

=head1 sds2sds_sf_fail.t

 Test 1: restart Routing and stop application, reset and start application in RabbitMQ server.
 Publish a Dispatch JSON message with ack_level and valid_until from SDS to SDS
 in exchange.pmc.router-in.
 Try to receive a message from exchange.pmc.router-in in 8 seconds.
 Test 1 expected result: a message is received from exchange.pmc.router-in in 8 seconds.
 Test 2: decode the message as JSON.
 Test 2 expected result: the message is decoded as JSON.
 Test 3: check that the sender field is the same as in the sent message.
 Test 3 expected result: the sender field is the same as in the sent message.
 Test 4: check the body of the received message and the sent one.
 Test 4 expected result: the body fields are the same.
 Test 5: check the timestamp field.
 Test 5 expected result: the timestamp field is the same as in the published message.
 Test 6: try to receive a message from exchange.pmc.sf-in in 8 seconds.
 Test 6 expected result: a message is received from exchange.pmc.sf-in in 8 seconds.
 Test 7: decode the message as JSON.
 Test 7 expected result: the message is decoded as JSON.
 Test 8: check that the sender field is "exchange.pmc.router-in".
 Test 8 expected result: the sender field is "exchange.pmc.router-in".
 Test 9: check the body of the received message and the sent one.
 Test 9 expected result: the body fields are the same.
 Test 10: check that the timestamp in an integer.
 Test 10 expected result: the timestamp in an integer.
 Test 11: check that the timestamp is greater than or equal to that of before publishing.
 Test 11 expected result: the timestamp is greater than or equal to that of before publishing.
 Test 12: check that the timestamp is less than or equal to that of now.
 Test 12 expected result: the timestamp is less than or equal to that of now.
 Test 13: try to receive a message from exchange.pmc.router-in in 8 seconds.
 Test 13 expected result: a message is received from exchange.pmc.router-in in 8 seconds.
 Test 14: decode the message as JSON.
 Test 14 expected result: the message is decoded as JSON.
 Test 15: check that the sender field is "exchange.pmc.sf-in".
 Test 15 expected result: the sender field is "exchange.pmc.sf-in".
 Test 16: check the body of the received message and the sent one.
 Test 16 expected result: the body fields are the same.
 Test 17: check that the timestamp in an integer.
 Test 17 expected result: the timestamp in an integer.
 Test 18: check that the timestamp is greater than or equal to that of before publishing.
 Test 18 expected result: the timestamp is greater than or equal to that of before publishing.
 Test 19: check that the timestamp is less than or equal to that of now.
 Test 19 expected result: the timestamp is less than or equal to that of now.
 Test 20: try to receive a message from exchange.pmc.router-in in 8 seconds.
 Test 20 expected result: a message is received from exchange.pmc.router-in in 8 seconds.
 Test 21: decode the message as JSON.
 Test 21 expected result: the message is decoded as JSON.
 Test 22: check that the sender field is "exchange.pmc.sf-in".
 Test 22 expected result: the sender field is "exchange.pmc.sf-in".
 Test 23: check that the timestamp in an integer.
 Test 23 expected result: the timestamp in an integer.
 Test 24: check that the timestamp is greater than or equal to that of before publishing.
 Test 24 expected result: the timestamp is greater than or equal to that of before publishing.
 Test 25: check that the timestamp is less than or equal to that of now.
 Test 25 expected result: the timestamp is less than or equal to that of now.
 Test 26: check that the id fields of the received and the published messages are the same.
 Test 26 expected result: the id fields of the received and the published messages are the same.
 Test 27: check that the ack_type field has value "processed".
 Test 27 expected result: the ack_type field has value "processed".
 Test 28: check that the from field of the received message is the same as
 the to field of the published message.
 Test 28 expected result: the from field of the received message is the same as
 the to field of the published message.
 Test 29: check that the type field has value "ack".
 Test 29 expected result: the type field has value "ack".
 Test 30: check that the version field has value 1.
 Test 30 expected result: the version field has value 1.
 Test 31: try to receive a message from exchange.pmc.cassidian-in in 8 seconds.
 Test 31 expected result: a message is received from exchange.pmc.cassidian-in in 8 seconds.
 Test 32: decode the message as JSON.
 Test 32 expected result: the message is decoded as JSON.
 Test 33: check that the sender field is "exchange.pmc.router-in".
 Test 33 expected result: the sender field is "exchange.pmc.router-in".
 Test 34: check the body of the received message and the sent one.
 Test 34 expected result: the body fields are the same.
 Test 35: check that the timestamp in an integer.
 Test 35 expected result: the timestamp in an integer.
 Test 36: check that the timestamp is greater than or equal to that of before publishing.
 Test 36 expected result: the timestamp is greater than or equal to that of before publishing.
 Test 37: check that the timestamp is less than or equal to that of now.
 Test 37 expected result: the timestamp is less than or equal to that of now.
 Test 38: try to receive a message from exchange.pmc.cassidian-in in 8 seconds.
 Test 38 expected result: a message is received from exchange.pmc.cassidian-in in 8 seconds.
 Test 39: decode the message as JSON.
 Test 39 expected result: the message is decoded as JSON.
 Test 40: check that the sender field is "exchange.pmc.router-in".
 Test 40 expected result: the sender field is "exchange.pmc.router-in".
 Test 41: check that the timestamp in an integer.
 Test 41 expected result: the timestamp in an integer.
 Test 42: check that the timestamp is greater than or equal to that of before publishing.
 Test 42 expected result: the timestamp is greater than or equal to that of before publishing.
 Test 43: check that the timestamp is less than or equal to that of now.
 Test 43 expected result: the timestamp is less than or equal to that of now.
 Test 44: check that the id fields of the received and the published messages are the same.
 Test 44 expected result: the id fields of the received and the published messages are the same.
 Test 45: check that the ack_type field has value "processed".
 Test 45 expected result: the ack_type field has value "processed".
 Test 46: check that the from field of the received message is the same as
 the to field of the published message.
 Test 46 expected result: the from field of the received message is the same as
 the to field of the published message.
 Test 47: check that the type field has value "ack".
 Test 47 expected result: the type field has value "ack".
 Test 48: check that the version field has value 1.
 Test 48 expected result: the version field has value 1.
 Test 49: publish an Ack sent message from the SSI in exchange.pmc.router-in.
 try to receive a message from exchange.pmc.router-in in 8 seconds.
 Test 49 expected result: a message is received from exchange.pmc.router-in in 8 seconds.
 Test 50: decode the message as JSON.
 Test 50 expected result: the message is decoded as JSON.
 Test 51: check that the timestamp of the received message is the same as that of published one.
 Test 51 expected result:
 the timestamp of the received message is the same as that of published one.
 Test 52: check the sender field of the received message.
 Test 52 expected result:
 the sender field of the received message has value "exchange.pmc.cassidian-in".
 Test 53: check the body fields of the received and the published messages.
 Test 53 expected result:
 the body fields of the received and the published messages are the same.
 Test 54: try to receive a message from exchange.pmc.sf-in in 8 seconds.
 Test 54 expected result: a message is received from exchange.pmc.sf-in in 8 seconds.
 Test 55: decode the message as JSON.
 Test 55 expected result: the message is decoded as JSON.
 Test 56: check the sender field of the received message.
 Test 56 expected result:
 the sender field of the received message has value "exchange.pmc.router-in".
 Test 57: check the body fields of the received and the published messages.
 Test 57 expected result:
 the body fields of the received and the published messages are the same.
 Test 58: check that the timestamp in an integer.
 Test 58 expected result: the timestamp in an integer.
 Test 59: check that the timestamp is greater than or equal to that of before publishing.
 Test 59 expected result: the timestamp is greater than or equal to that of before publishing.
 Test 60: check that the timestamp is less than or equal to that of now.
 Test 60 expected result: the timestamp is less than or equal to that of now.
 Test 61: try to receive a message from exchange.pmc.router-in in 8 seconds.
 Test 61 expected result: a message is received from exchange.pmc.router-in in 8 seconds.
 Test 62: decode the message as JSON.
 Test 62 expected result: the message is decoded as JSON.
 Test 63: check the sender field of the received message.
 Test 63 expected result:
 the sender field of the received message has value "exchange.pmc.sf-in".
 Test 64: check the body fields of the received and the published messages.
 Test 64 expected result:
 the body fields of the received and the published messages are the same.
 Test 65: check that the timestamp in an integer.
 Test 65 expected result: the timestamp in an integer.
 Test 66: check that the timestamp is greater than or equal to that of before publishing.
 Test 66 expected result: the timestamp is greater than or equal to that of before publishing.
 Test 67: check that the timestamp is less than or equal to that of now.
 Test 67 expected result: the timestamp is less than or equal to that of now.
 Test 68: try to receive a message from exchange.pmc.cassidian-in in 8 seconds.
 Test 68 expected result: a message is received from exchange.pmc.cassidian-in in 8 seconds.
 Test 69: decode the message as JSON.
 Test 69 expected result: the message is decoded as JSON.
 Test 70: check the sender field of the received message.
 Test 70 expected result:
 the sender field of the received message has value "exchange.pmc.router-in".
 Test 71: check the body fields of the received and the published messages.
 Test 71 expected result:
 the body fields of the received and the published messages are the same.
 Test 72: check that the timestamp in an integer.
 Test 72 expected result: the timestamp in an integer.
 Test 73: check that the timestamp is greater than or equal to that of before publishing.
 Test 73 expected result: the timestamp is greater than or equal to that of before publishing.
 Test 74: check that the timestamp is less than or equal to that of now.
 Test 74 expected result: the timestamp is less than or equal to that of now.

=cut

use strict;

use Net::RabbitMQ;
use Test::More tests => 74;
use JSON;
use Time::HiRes qw(gettimeofday);

use constant ROUTER_EXCHANGE    => 'exchange.pmc.router-in';
use constant ROUTER_CHANNEL     => 1;
use constant ROUTER_QUEUE       => 'queue.test.router-in';
use constant SF_EXCHANGE        => 'exchange.pmc.sf-in';
use constant SF_CHANNEL         => 2;
use constant SF_QUEUE           => 'queue.test.sf-in';
use constant CASSIDIAN_EXCHANGE => 'exchange.pmc.cassidian-in';
use constant CASSIDIAN_CHANNEL  => 3;
use constant CASSIDIAN_QUEUE    => 'queue.test.cassidian-in';

sub timestamp {
    return int( gettimeofday() * 1000 );
}

system(
'service pmc-smpp stop >&2; service pmc-cassidian stop >&2; service pmc-email stop >&2; service pmc-sf stop >&2; service pmc-routing stop >&2'
);

sleep 1;    # Wait for the message-sending to stop.

system(
    'rabbitmqctl stop_app; rabbitmqctl reset; rabbitmqctl start_app; mongo <<END
use database
db.dropDatabase();
END'
);

system('service pmc-sf start >&2; service pmc-routing start >&2');

sleep 8;    # Wait for Store & Forward and Routing to start.

my $json_text = '{
"timestamp" : 1330327514213,
"sender" : "' . CASSIDIAN_EXCHANGE . '",
"body" : {
"type" : "dispatch",
"version" : 1,
"id" : "8f970b1b-f8a3-4c78-aa24-3b8e2205648788",
"from" : {
"type" : "ssi",
"address" : "16777215"
},
"to" : {
"type" : "ssi",
"address" : "0"
},
"body" : "This is a test message.",
"ack_level" : "sent",
"valid_until" : 9223372036854775807,
"auxiliary" : {
"timestamp" : 1325376000000,
"sdstl" : {
"protocol_id" : 130,
"message_reference" : 42,
"short_report_allowed" : true,
"protocol_data" : {
"encoding" : 0,
"timestamp" : {
"month" : 1,
"day" : 1,
"hour" : 0,
"minute" : 0
}
}
}
}
}
}';

my $mq_router = Net::RabbitMQ->new();
$mq_router->connect( "localhost", { user => "guest", password => "guest" } );
$mq_router->channel_open(ROUTER_CHANNEL);
$mq_router->queue_declare(
    ROUTER_CHANNEL,
    ROUTER_QUEUE,
    {
        passive     => 0,
        durable     => 1,
        exclusive   => 0,
        auto_delete => 0
    }
);
$mq_router->queue_bind( ROUTER_CHANNEL, ROUTER_QUEUE, ROUTER_EXCHANGE, '' );
$mq_router->purge( ROUTER_CHANNEL, ROUTER_QUEUE );
$mq_router->consume( ROUTER_CHANNEL, ROUTER_QUEUE );

my $mq_sf = Net::RabbitMQ->new();
$mq_sf->connect( "localhost", { user => "guest", password => "guest" } );
$mq_sf->channel_open(SF_CHANNEL);
$mq_sf->exchange_declare(
    SF_CHANNEL,
    SF_EXCHANGE,
    {
        exchange_type => 'direct',
        passive       => 0,
        durable       => 1,
        auto_delete   => 0
    }
);
$mq_sf->queue_declare(
    SF_CHANNEL,
    SF_QUEUE,
    {
        passive     => 0,
        durable     => 1,
        exclusive   => 0,
        auto_delete => 0
    }
);
$mq_sf->queue_bind( SF_CHANNEL, SF_QUEUE, SF_EXCHANGE, '' );
$mq_sf->purge( SF_CHANNEL, SF_QUEUE );
$mq_sf->consume( SF_CHANNEL, SF_QUEUE );

my $mq_cassidian = Net::RabbitMQ->new();
$mq_cassidian->connect( "localhost", { user => "guest", password => "guest" } );
$mq_cassidian->channel_open(CASSIDIAN_CHANNEL);
$mq_cassidian->exchange_declare(
    CASSIDIAN_CHANNEL,
    CASSIDIAN_EXCHANGE,
    {
        exchange_type => 'direct',
        passive       => 0,
        durable       => 1,
        auto_delete   => 0
    }
);
$mq_cassidian->queue_declare(
    CASSIDIAN_CHANNEL,
    CASSIDIAN_QUEUE,
    {
        passive     => 0,
        durable     => 1,
        exclusive   => 0,
        auto_delete => 0
    }
);
$mq_cassidian->queue_bind( CASSIDIAN_CHANNEL, CASSIDIAN_QUEUE,
    CASSIDIAN_EXCHANGE, '' );
$mq_cassidian->purge( CASSIDIAN_CHANNEL, CASSIDIAN_QUEUE );
$mq_cassidian->consume( CASSIDIAN_CHANNEL, CASSIDIAN_QUEUE );

my $before = timestamp();

$mq_router->publish(
    ROUTER_CHANNEL,
    '',
    $json_text,
    {

        # Options
        exchange => ROUTER_EXCHANGE
    },
    {

        # Props
        content_encoding => "UTF-8",
        content_type     => "application/json"
    }
);

my $sent = decode_json($json_text);
my $message;
eval {
    local $SIG{ALRM} = sub { die "Timeout\n" };
    alarm 8;
    $message = $mq_router->recv();
    alarm 0;
};
is( $@, '', 'A message was received from queue' );
my $json;
eval { $json = decode_json( $message->{'body'} ); };
is( $@, '', 'A JSON message received' );
is( $json->{'sender'}, $sent->{'sender'}, 'sender ' . $sent->{'sender'} );
is_deeply( $json->{'body'}, $sent->{'body'}, 'body the same' );
is( $json->{'timestamp'}, $sent->{'timestamp'},
    "timestamp " . $sent->{'timestamp'} );

undef $message;
eval {
    local $SIG{ALRM} = sub { die "Timeout\n" };
    alarm 8;
    $message = $mq_sf->recv();
    alarm 0;
};
is( $@, '', 'A message was received' );
undef $json;
eval { $json = decode_json( $message->{'body'} ); };
is( $@, '', 'A JSON message received' );
is( $json->{'sender'}, ROUTER_EXCHANGE, 'sender ' . ROUTER_EXCHANGE );
is_deeply( $json->{'body'}, $sent->{'body'}, 'body the same' );
like( $json->{'timestamp'}, qr/^\d+$/, "timestamp an integer" );
ok( $json->{'timestamp'} >= $before,
    'timestamp greater than or equal to that of before publishing' )
  or diag("$json->{'timestamp'} < $before");
my $now = timestamp();
ok( $json->{'timestamp'} <= $now,
    'timestamp less than or equal to that of now' )
  or diag("$json->{'timestamp'} > $now");

undef $message;
eval {
    local $SIG{ALRM} = sub { die "Timeout\n" };
    alarm 8;
    $message = $mq_router->recv();
    alarm 0;
};
is( $@, '', 'A message was received' );
undef $json;
eval { $json = decode_json( $message->{'body'} ); };
is( $@,                '',          'A JSON message received' );
is( $json->{'sender'}, SF_EXCHANGE, 'sender ' . SF_EXCHANGE );
is_deeply( $json->{'body'}, $sent->{'body'}, 'body the same' );
like( $json->{'timestamp'}, qr/^\d+$/, "timestamp an integer" );
ok( $json->{'timestamp'} >= $before,
    'timestamp greater than or equal to that of before publishing' )
  or diag("$json->{'timestamp'} < $before");
$now = timestamp();
ok( $json->{'timestamp'} <= $now,
    'timestamp less than or equal to that of now' )
  or diag("$json->{'timestamp'} > $now");

undef $message;
eval {
    local $SIG{ALRM} = sub { die "Timeout\n" };
    alarm 8;
    $message = $mq_router->recv();
    alarm 0;
};
is( $@, '', 'A message was received' );
undef $json;
eval { $json = decode_json( $message->{'body'} ); };
is( $@,                '',          'A JSON message received' );
is( $json->{'sender'}, SF_EXCHANGE, 'sender ' . SF_EXCHANGE );
like( $json->{'timestamp'}, qr/^\d+$/, "timestamp an integer" );
ok( $json->{'timestamp'} >= $before,
    'timestamp greater than or equal to that of before publishing' )
  or diag("$json->{'timestamp'} < $before");
$now = timestamp();
ok( $json->{'timestamp'} <= $now,
    'timestamp less than or equal to that of now' )
  or diag("$json->{'timestamp'} > $now");
is( $json->{'body'}->{'id'}, $sent->{'body'}->{'id'}, 'id the same' );
is( $json->{'body'}->{'ack_type'}, 'processed', 'ack_type processed' );
is_deeply(
    $json->{'body'}->{'from'},
    $sent->{'body'}->{'to'},
    'from is the same as to of sent'
);
is( $json->{'body'}->{'type'},    'ack', 'type is ack' );
is( $json->{'body'}->{'version'}, 1,     'version is 1' );

undef $message;
eval {
    local $SIG{ALRM} = sub { die "Timeout\n" };
    alarm 8;
    $message = $mq_cassidian->recv();
    alarm 0;
};
is( $@, '', 'A message was received' );
undef $json;
eval { $json = decode_json( $message->{'body'} ); };
is( $@, '', 'A JSON message received' );
is( $json->{'sender'}, ROUTER_EXCHANGE, 'sender ' . ROUTER_EXCHANGE );
is_deeply( $json->{'body'}, $sent->{'body'}, 'body the same' );
like( $json->{'timestamp'}, qr/^\d+$/, "timestamp an integer" );
ok( $json->{'timestamp'} >= $before,
    'timestamp greater than or equal to that of before publishing' )
  or diag("$json->{'timestamp'} < $before");
$now = timestamp();
ok( $json->{'timestamp'} <= $now,
    'timestamp less than or equal to that of now' )
  or diag("$json->{'timestamp'} > $now");

note("Trying to receive an Ack from Cassidian exchange");
undef $message;
eval {
    local $SIG{ALRM} = sub { die "Timeout\n" };
    alarm 8;
    $message = $mq_cassidian->recv();
    alarm 0;
};
is( $@, '', 'A message was received' );
undef $json;
eval { $json = decode_json( $message->{'body'} ); };
is( $@, '', 'A JSON message received' );
is( $json->{'sender'}, ROUTER_EXCHANGE, 'sender ' . ROUTER_EXCHANGE );
like( $json->{'timestamp'}, qr/^\d+$/, "timestamp an integer" );
ok( $json->{'timestamp'} >= $before,
    'timestamp greater than or equal to that of before publishing' )
  or diag("$json->{'timestamp'} < $before");
$now = timestamp();
ok( $json->{'timestamp'} <= $now,
    'timestamp less than or equal to that of now' )
  or diag("$json->{'timestamp'} > $now");
is( $json->{'body'}->{'id'}, $sent->{'body'}->{'id'}, 'id the same' );
is( $json->{'body'}->{'ack_type'}, 'processed', 'ack_type processed' );
is_deeply(
    $json->{'body'}->{'from'},
    $sent->{'body'}->{'to'},
    'from is the same as to of sent'
);
is( $json->{'body'}->{'type'},    'ack', 'type is ack' );
is( $json->{'body'}->{'version'}, 1,     'version is 1' );

my $ack = '{
"timestamp" : 1328020064358,
"sender" : "' . CASSIDIAN_EXCHANGE . '",
"body" : {
"type" : "ack",
"version" : 1,
"id" : "8f970b1b-f8a3-4c78-aa24-3b8e2205648788",
"from" : {
"type" : "ssi",
"address" : "0"
},
"ack_type" : "sent",
"auxiliary" : {
"timestamp" : 1325376000000,
"original_message" : ' . encode_json( $sent->{'body'} ) . ',
"sdstl" : {
"protocol_id" : 130,
"message_reference" : 42,
"short_report_allowed" : true,
"protocol_data" : {
"encoding" : 0,
"timestamp" : {
"month" : 1,
"day" : 1,
"hour" : 0,
"minute" : 0
}
}
}
}
}
}';
$sent   = decode_json($ack);
$before = timestamp();

$mq_router->publish(
    ROUTER_CHANNEL,
    '', $ack,
    {

        # Options
        exchange => ROUTER_EXCHANGE
    },
    {

        # Props
        content_encoding => "UTF-8",
        content_type     => "application/json"
    }
);

undef $message;
eval {
    local $SIG{ALRM} = sub { die "Timeout\n" };
    alarm 8;
    $message = $mq_router->recv();
    alarm 0;
};
is( $@, '', 'A message was received' );
undef $json;
eval { $json = decode_json( $message->{'body'} ); };
is( $@, '', 'A JSON message received' );
is( $json->{'timestamp'}, $sent->{'timestamp'},
    'timestamp ' . $sent->{'timestamp'} )
  or diag( $message->{'body'} );
is( $json->{'sender'}, CASSIDIAN_EXCHANGE, 'sender ' . CASSIDIAN_EXCHANGE )
  or diag( $message->{'body'} );
is_deeply( $json->{'body'}, $sent->{'body'}, 'body the same' )
  or diag( $message->{'body'} );

undef $message;
eval {
    local $SIG{ALRM} = sub { die "Timeout\n" };
    alarm 8;
    $message = $mq_sf->recv();
    alarm 0;
};
is( $@, '', 'A message was received' );
undef $json;
eval { $json = decode_json( $message->{'body'} ); };
is( $@, '', 'A JSON message received' );
is( $json->{'sender'}, ROUTER_EXCHANGE, 'sender ' . ROUTER_EXCHANGE );
is_deeply( $json->{'body'}, $sent->{'body'}, 'body the same' );
like( $json->{'timestamp'}, qr/^\d+$/, "timestamp an integer" );
ok( $json->{'timestamp'} >= $before,
    'timestamp greater than or equal to that of before publishing' )
  or diag("$json->{'timestamp'} < $before");
$now = timestamp();
ok( $json->{'timestamp'} <= $now,
    'timestamp less than or equal to that of now' )
  or diag("$json->{'timestamp'} > $now");

undef $message;
eval {
    local $SIG{ALRM} = sub { die "Timeout\n" };
    alarm 8;
    $message = $mq_router->recv();
    alarm 0;
};
is( $@, '', 'A message was received' );
undef $json;
eval { $json = decode_json( $message->{'body'} ); };
is( $@,                '',          'A JSON message received' );
is( $json->{'sender'}, SF_EXCHANGE, 'sender ' . SF_EXCHANGE );
is_deeply( $json->{'body'}, $sent->{'body'}, 'body the same' );
like( $json->{'timestamp'}, qr/^\d+$/, "timestamp an integer" );
ok( $json->{'timestamp'} >= $before,
    'timestamp greater than or equal to that of before publishing' )
  or diag("$json->{'timestamp'} < $before");
$now = timestamp();
ok( $json->{'timestamp'} <= $now,
    'timestamp less than or equal to that of now' )
  or diag("$json->{'timestamp'} > $now");

undef $message;
eval {
    local $SIG{ALRM} = sub { die "Timeout\n" };
    alarm 8;
    $message = $mq_cassidian->recv();
    alarm 0;
};
is( $@, '', 'A message was received' );
undef $json;
eval { $json = decode_json( $message->{'body'} ); };
is( $@, '', 'A JSON message received' );
is( $json->{'sender'}, ROUTER_EXCHANGE, 'sender ' . ROUTER_EXCHANGE );
is_deeply( $json->{'body'}, $sent->{'body'}, 'body the same' );
like( $json->{'timestamp'}, qr/^\d+$/, "timestamp an integer" );
ok( $json->{'timestamp'} >= $before,
    'timestamp greater than or equal to that of before publishing' )
  or diag("$json->{'timestamp'} < $before");
$now = timestamp();
ok( $json->{'timestamp'} <= $now,
    'timestamp less than or equal to that of now' )
  or diag("$json->{'timestamp'} > $now");

END {
    $mq_sf->queue_unbind( SF_CHANNEL, SF_QUEUE, SF_EXCHANGE, '' );
    $mq_router->queue_unbind( ROUTER_CHANNEL, ROUTER_QUEUE, ROUTER_EXCHANGE,
        '' );
    $mq_cassidian->queue_unbind( CASSIDIAN_CHANNEL, CASSIDIAN_QUEUE,
        CASSIDIAN_EXCHANGE, '' );
    system(
'service pmc-smpp start >&2; service pmc-cassidian start >&2; service pmc-email start >&2'
    );
}

regards, Matti Linnanvuori


From matthew at rabbitmq.com  Wed Apr  4 13:29:55 2012
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 4 Apr 2012 13:29:55 +0100
Subject: [rabbitmq-discuss] [Q] Shovel Example - Dynamic Upstream to
 Central Broker
In-Reply-To: <4F70D44D.8030900@aol.com>
References: <4F70D44D.8030900@aol.com>
Message-ID: <20120404122955.GC17969@rabbitmq.com>

Hi,

On Mon, Mar 26, 2012 at 04:40:45PM -0400, DawgTool wrote:
> Looking for an example of Dynamic Upstream brokers connecting to a
> Central Broker.
> The exchange on the Central Broker is type topic with several
> queues, and is very important that the Upstreams' routing key is
> preserved.
> 
> The Central server can not be bounced, so config changes can only be
> done on the Upstream servers.

So you have the shovel installed on the upstream brokers and use them to
push to the central server. Provided the upstreams know their own
routing keys, I would have thought that would be fine - you can set the
routing key to use in the shovel config.

Matthew

From matthew at rabbitmq.com  Wed Apr  4 13:34:10 2012
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 4 Apr 2012 13:34:10 +0100
Subject: [rabbitmq-discuss] dead letter queue example
In-Reply-To: <e9413180-0596-4379-86ef-1475da34d102@s27g2000yqd.googlegroups.com>
References: <e9413180-0596-4379-86ef-1475da34d102@s27g2000yqd.googlegroups.com>
Message-ID: <20120404123410.GD17969@rabbitmq.com>

Hi,

On Mon, Apr 02, 2012 at 02:27:57AM -0700, agilefreak1 wrote:
> I would like to implement dead letter queue in our application. I am
> wondering has anyone already implemented dead letter and would love to
> share some basic code and best practice with me. I am using C# but I
> welcome code in any language.

Erm, you just need to a) configure the DLE of the queues in question, b)
create that exchange, c) bind a queue to it, d) consume from that queue.
http://www.rabbitmq.com/extensions.html#dead-letter-exchanges

There's really not much to it - in terms of using the feature.

Matthew

From steve at rabbitmq.com  Wed Apr  4 14:25:05 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Wed, 4 Apr 2012 14:25:05 +0100
Subject: [rabbitmq-discuss] Shovel plugin behavior with durable queues...
In-Reply-To: <7C0766D0D31C774F9BEAFBB6C6592EE8B42EA183@PREXMB01.myfamily.int>
References: <7C0766D0D31C774F9BEAFBB6C6592EE8B42E5793@PREXMB01.myfamily.int>
	<EB3843B5-F6D3-46BC-A338-8047676B74DE@rabbitmq.com>
	<7C0766D0D31C774F9BEAFBB6C6592EE8B42EA183@PREXMB01.myfamily.int>
Message-ID: <290F96D8-DA4D-4E17-9441-EFA0A3AFC57A@rabbitmq.com>

Sean,

Please check that the messages are 'persistent' messages (published with
BasicProperties containing delivery_mode=2). If not they won't survive a
restart; only persistent messages in durable queues survive a restart.

I note that you have set persistent in the shovel configuration, but
this only overrides the properties of the original message. If they
weren't persistent originally and shovel doesn't re-publish them, they
will be lost on restart.

Steve Powell  (a happy bunny)
----------some more definitions from the SPD----------
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.
literacy (n.) A textually transmitted disease usually contracted in childhood.

On 3 Apr 2012, at 17:46, Sean Heaton wrote:

> Steve,
>  
> Thank you very much for helping me out.  I actually stop Machine A.  That prevents messages from being shoveled from Machine C  to A.  While A is still stopped, I restart the RabbitMQ service Machine C. 
>  
> When I do this, I figured since the messages are in a durable queue on Machine C, they would still be in the durable queue on C waiting to be shoveled to A.  This isn?t the case though?they are simply gone.  They don?t make it to A (since A is stopped), but they aren?t on C anymore either.  I was thinking I probably have something configured wrong or that there is a setting I can tweak to make them persist on C.
>  
> Thank you again for your help on this?
>  
> Regards,
> Sean
>  
>  
> From: Steve Powell [mailto:steve at rabbitmq.com] 
> Sent: Tuesday, April 03, 2012 7:44 AM
> To: Sean Heaton
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] Shovel plugin behavior with durable queues...
>  
> Hi Sean,
>  
> Did you mean to say you restarted Machine C or Machine A?
>  
> In any case, the messages in a durable queue will only survive a server
> stop/start if the messages are persistent.
>  
> If you restarted Machine A, then the shovel ought to reconnect (from C
> to A) and the messages in the queue should then be sent. Since the queue
> on Machine A is durable it ought to still exist when you restart it.
>  
> Hope this gives some clue. If you still have problems, please come back.
>  
> Steve Powell  (a happy bunny)
> ----------some more definitions from the SPD----------
> chinchilla (n.) Cooling device for the lower jaw.
> socialcast (n.) Someone to whom everyone is speaking but nobody likes.
> literacy (n.) A textually transmitted disease usually contracted in childhood.
>  
> On 2 Apr 2012, at 22:33, Sean Heaton wrote:
> 
> 
> Hello,
>  
> I am new to the list and RabbitMQ in general, so I hope this is not a stupid question, but I have seen some behavior that is strange to me when using the RabbitMQ shovel plugin.  I am using RabbitMQ v 2.7.1 running on Centos 6.0.  I have three machines in my setup.  Machines A and B are both clustered together.  Machine C is not part of the cluster.  It has the shovel plugin installed.  The plugin is set up to shovel messages from a durable queue on Machine C to a durable queue on Machine A.  In case it helps, my /etc/rabbitmq/rabbitmq.conf file looks like this:
>  
> [{rabbitmq_shovel,
>   [{shovels,
>     [{myShovel,
>       [{sources,      [{broker,"amqp://MachineC"}]},
>        {destinations, [{broker, "amqp://MachineA"}]},
>        {queue, <<"myQueue">>},
>        {ack_mode, on_confirm},
>        {publish_properties, [{delivery_mode, 2}]},
>        {reconnect_delay, 5}
>       ]
>     }]
>  }]
> }].
>  
> With this configuration, everything seems to work fine.  When I send messages to the queue on Machine C, they are shoveled automatically out to A.
>  
> So here is the weird behavior I mentioned earlier?  If I shut down the RabbitMQ service on Machine A, messages stack up in the durable queue on Machine C.  This is expected since Machine A is down.  However, if I then restart the RabbitMQ service on Machine C, all of the messages waiting in the durable queue get nuked.
>  
> Has anyone else seen this behavior?  Do I have a setting wrong or is there something else I can change so that this doesn?t happen?
>  
> Thanks in advance for your help!
>  
> Regards,
> Sean
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>  
> 
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120404/96acf201/attachment.htm>

From fearsome.lucidity at gmail.com  Wed Apr  4 17:12:55 2012
From: fearsome.lucidity at gmail.com (Elias Levy)
Date: Wed, 4 Apr 2012 09:12:55 -0700
Subject: [rabbitmq-discuss] RabbitMQ appears to send 0-9-1 formated
 message to 0-8 client
In-Reply-To: <4F7C1B1C.3000905@rabbitmq.com>
References: <CAFDmHdOVR6-uNinJR5Gm2gQTTQRvuUdLtPGa-OXkHxLgG2F3Rw@mail.gmail.com>
	<4F7C1B1C.3000905@rabbitmq.com>
Message-ID: <CAFDmHdM2wm84tZebFA1+NZ7eDYB6RkvB5NeVGDvkm2hCfLKa4w@mail.gmail.com>

On Wed, Apr 4, 2012 at 2:57 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> This is interesting, but I have a hard time believing it I'm afraid.
>
> 1) basic.deliver has a "redelivered" field in both AMQP 0-8 and 0-9-1 (see
> line 2957 of the 0-8 XML).
> 2) In both versions of the standard, redelivered is of type "bit".
>

Thank for pointing this out. I searched the 0-8 PDF and found no mention to
it, but I see it in the XML now.  That will show me for not searching all
of the documentation.

3) I don't recall any of the AMQP codec code changing since 2.5.1.
> 4) This is really basic stuff, any client that couldn't unpack
> basic.deliver would be so broken as to be useless.
>
> So I wonder what might really be happening?
>
> I note that Net::AMQP throws that exception in a function called
> unpack_field_table(). But the method fields aren't in a table.
>
> We do however create a table in the message headers that has a key
> "redelivered". In federation. You haven't recently started using federation
> by any chance?
>

Bingo.  We added a federated exchange for forward some messages from our
prod env to the dev env for testing.


> And we make that field boolean, because that's what it is. But from the
> AMQP 0-8 spec:
>
> 4.2.5.5  Field Tables
>
> Field tables are long strings that contain packed name ?alue pairs. Each
> name ?alue pair is a structure that provides a field name, a field type,
> and a field value.  A field can hold a tiny text string, a long string, a
> long signed integer, a decimal, a date and/or time, or another field table.
>
> Damn it.
>

Yes,  that's the section I was reading in the 0-8 PDFs.

So I guess we need to do some field type mapping when talking to 0-8
> clients. I had hoped the 0-8 clients would have gone away by now...
>

You and me both.

Elias
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120404/623761ce/attachment.htm>

From sheaton at ancestry.com  Wed Apr  4 17:54:35 2012
From: sheaton at ancestry.com (Sean Heaton)
Date: Wed, 4 Apr 2012 16:54:35 +0000
Subject: [rabbitmq-discuss] Shovel plugin behavior with durable queues...
In-Reply-To: <290F96D8-DA4D-4E17-9441-EFA0A3AFC57A@rabbitmq.com>
References: <7C0766D0D31C774F9BEAFBB6C6592EE8B42E5793@PREXMB01.myfamily.int>
	<EB3843B5-F6D3-46BC-A338-8047676B74DE@rabbitmq.com>
	<7C0766D0D31C774F9BEAFBB6C6592EE8B42EA183@PREXMB01.myfamily.int>
	<290F96D8-DA4D-4E17-9441-EFA0A3AFC57A@rabbitmq.com>
Message-ID: <7C0766D0D31C774F9BEAFBB6C6592EE8B42F4669@PREXMB01.myfamily.int>

Steve,

Ah!  That was it!  Thank you very much for that and sorry for my ignorance.  When I had all the machines up and the messages made it to Machine A, if I restarted it, all of the messages were still in place, so I assumed that the messages were persistant.  As you indicated, this was not the case.  Once I added the delivery_mode setting you suggested to my publish call, I was able to restart Machine C and the messages were still present.  Apply palm to forehead and problem solved.

Thank you again for your help with this.

Regards,
Sean

From: Steve Powell [mailto:steve at rabbitmq.com]
Sent: Wednesday, April 04, 2012 7:25 AM
To: Sean Heaton
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Shovel plugin behavior with durable queues...

Sean,

Please check that the messages are 'persistent' messages (published with
BasicProperties containing delivery_mode=2). If not they won't survive a
restart; only persistent messages in durable queues survive a restart.

I note that you have set persistent in the shovel configuration, but
this only overrides the properties of the original message. If they
weren't persistent originally and shovel doesn't re-publish them, they
will be lost on restart.

Steve Powell  (a happy bunny)
----------some more definitions from the SPD----------
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.
literacy (n.) A textually transmitted disease usually contracted in childhood.

On 3 Apr 2012, at 17:46, Sean Heaton wrote:


Steve,

Thank you very much for helping me out.  I actually stop Machine A.  That prevents messages from being shoveled from Machine C  to A.  While A is still stopped, I restart the RabbitMQ service Machine C.

When I do this, I figured since the messages are in a durable queue on Machine C, they would still be in the durable queue on C waiting to be shoveled to A.  This isn't the case though-they are simply gone.  They don't make it to A (since A is stopped), but they aren't on C anymore either.  I was thinking I probably have something configured wrong or that there is a setting I can tweak to make them persist on C.

Thank you again for your help on this...

Regards,
Sean


From: Steve Powell [mailto:steve at rabbitmq.com]
Sent: Tuesday, April 03, 2012 7:44 AM
To: Sean Heaton
Cc: rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
Subject: Re: [rabbitmq-discuss] Shovel plugin behavior with durable queues...

Hi Sean,

Did you mean to say you restarted Machine C or Machine A?

In any case, the messages in a durable queue will only survive a server
stop/start if the messages are persistent.

If you restarted Machine A, then the shovel ought to reconnect (from C
to A) and the messages in the queue should then be sent. Since the queue
on Machine A is durable it ought to still exist when you restart it.

Hope this gives some clue. If you still have problems, please come back.

Steve Powell  (a happy bunny)
----------some more definitions from the SPD----------
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.
literacy (n.) A textually transmitted disease usually contracted in childhood.

On 2 Apr 2012, at 22:33, Sean Heaton wrote:



Hello,

I am new to the list and RabbitMQ in general, so I hope this is not a stupid question, but I have seen some behavior that is strange to me when using the RabbitMQ shovel plugin.  I am using RabbitMQ v 2.7.1 running on Centos 6.0.  I have three machines in my setup.  Machines A and B are both clustered together.  Machine C is not part of the cluster.  It has the shovel plugin installed.  The plugin is set up to shovel messages from a durable queue on Machine C to a durable queue on Machine A.  In case it helps, my /etc/rabbitmq/rabbitmq.conf file looks like this:

[{rabbitmq_shovel,
  [{shovels,
    [{myShovel,
      [{sources,      [{broker,"amqp://MachineC"}]},
       {destinations, [{broker, "amqp://MachineA"}]},
       {queue, <<"myQueue">>},
       {ack_mode, on_confirm},
       {publish_properties, [{delivery_mode, 2}]},
       {reconnect_delay, 5}
      ]
    }]
 }]
}].

With this configuration, everything seems to work fine.  When I send messages to the queue on Machine C, they are shoveled automatically out to A.

So here is the weird behavior I mentioned earlier...  If I shut down the RabbitMQ service on Machine A, messages stack up in the durable queue on Machine C.  This is expected since Machine A is down.  However, if I then restart the RabbitMQ service on Machine C, all of the messages waiting in the durable queue get nuked.

Has anyone else seen this behavior?  Do I have a setting wrong or is there something else I can change so that this doesn't happen?

Thanks in advance for your help!

Regards,
Sean

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120404/2406f30e/attachment.htm>

From emamdouh at cloud9ers.com  Wed Apr  4 18:02:55 2012
From: emamdouh at cloud9ers.com (Eslam El Husseiny)
Date: Wed, 4 Apr 2012 10:02:55 -0700 (PDT)
Subject: [rabbitmq-discuss] Upgrade 2.7.1 RabbitMQ cluster to 2.8.1
 version
In-Reply-To: <5d9f08ec-40f4-4789-af03-df2d8656fd03@k14g2000vbe.googlegroups.com>
References: <32143157.102.1333329241115.JavaMail.geo-discussion-forums@pbcr5>
	<5d9f08ec-40f4-4789-af03-df2d8656fd03@k14g2000vbe.googlegroups.com>
Message-ID: <18863890.3713.1333558975674.JavaMail.geo-discussion-forums@vbbdy9>

sorry but i didn't understand the procedure of adding new physical cluster 
running 2.8.1
do you mean using rabbitmqctl command to new physical machine to cluster , 
OR ?

Thanks in advance 

On Monday, April 2, 2012 6:35:11 AM UTC+2, Brendan Hay wrote:
>
> Hi Roshan,
>
> I would suggest you provision a _new_ physical cluster running 2.8.1
> side by side with your old cluster, and then incrementally move
> producers/consumers over.
>
> Are you using some sort of load-balancer in front of your cluster,
> such as HAProxy or LVS?
> What sort of service discovery do the clients use to find Rabbit?
> (Chef, ZooKeeper, hard-coded configs, etc.)
>
> Regards,
> Brendan
>
> On Apr 2, 3:14 am, Codevally <codeva... at gmail.com> wrote:
> > Hi All
> >
> > I need to upgrade our current production 2.7.1 RabbitMQ cluster to it's 
> new
> > 2.8.1 version.
> >
> > In our production cluster, we have 2 disc node and erlang R15B installed.
> > According to the RabbitMQ cluster guilde:
> >
> > "All nodes in a cluster must be running the same versions of Erlang and
> > RabbitMQ, although they may have different plugins installed. Therefore 
> it
> > is necessary to stop all nodes in the cluster, then start all nodes when
> > performing an upgrade."
> >
> > In our case we cannot shutdown our existing cluster, because it is 
> heavily
> > used to send messages across regions.
> >
> > Could someone please let me know how to upgrade 2.7.1 cluster without
> > shutdown the entire cluster.
> >
> > Many Thanks.
> > /Roshan
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.comhttps://
> lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120404/59553b79/attachment.htm>

From emamdouh at cloud9ers.com  Wed Apr  4 18:02:55 2012
From: emamdouh at cloud9ers.com (Eslam El Husseiny)
Date: Wed, 4 Apr 2012 10:02:55 -0700 (PDT)
Subject: [rabbitmq-discuss] Upgrade 2.7.1 RabbitMQ cluster to 2.8.1
 version
In-Reply-To: <5d9f08ec-40f4-4789-af03-df2d8656fd03@k14g2000vbe.googlegroups.com>
References: <32143157.102.1333329241115.JavaMail.geo-discussion-forums@pbcr5>
	<5d9f08ec-40f4-4789-af03-df2d8656fd03@k14g2000vbe.googlegroups.com>
Message-ID: <18863890.3713.1333558975674.JavaMail.geo-discussion-forums@vbbdy9>

sorry but i didn't understand the procedure of adding new physical cluster 
running 2.8.1
do you mean using rabbitmqctl command to new physical machine to cluster , 
OR ?

Thanks in advance 

On Monday, April 2, 2012 6:35:11 AM UTC+2, Brendan Hay wrote:
>
> Hi Roshan,
>
> I would suggest you provision a _new_ physical cluster running 2.8.1
> side by side with your old cluster, and then incrementally move
> producers/consumers over.
>
> Are you using some sort of load-balancer in front of your cluster,
> such as HAProxy or LVS?
> What sort of service discovery do the clients use to find Rabbit?
> (Chef, ZooKeeper, hard-coded configs, etc.)
>
> Regards,
> Brendan
>
> On Apr 2, 3:14 am, Codevally <codeva... at gmail.com> wrote:
> > Hi All
> >
> > I need to upgrade our current production 2.7.1 RabbitMQ cluster to it's 
> new
> > 2.8.1 version.
> >
> > In our production cluster, we have 2 disc node and erlang R15B installed.
> > According to the RabbitMQ cluster guilde:
> >
> > "All nodes in a cluster must be running the same versions of Erlang and
> > RabbitMQ, although they may have different plugins installed. Therefore 
> it
> > is necessary to stop all nodes in the cluster, then start all nodes when
> > performing an upgrade."
> >
> > In our case we cannot shutdown our existing cluster, because it is 
> heavily
> > used to send messages across regions.
> >
> > Could someone please let me know how to upgrade 2.7.1 cluster without
> > shutdown the entire cluster.
> >
> > Many Thanks.
> > /Roshan
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.comhttps://
> lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120404/59553b79/attachment-0001.htm>

From hcoyote at ghostar.org  Thu Apr  5 00:37:44 2012
From: hcoyote at ghostar.org (Travis)
Date: Wed, 4 Apr 2012 18:37:44 -0500
Subject: [rabbitmq-discuss] Cluster fails when current primary node
	shuts down.
In-Reply-To: <4F670E1C.4000104@rabbitmq.com>
References: <CAChq9g33wZVMFUvba04S+ZbPKNDharX+4LAgc_wt3t+aQFUO3Q@mail.gmail.com>
	<4F670E1C.4000104@rabbitmq.com>
Message-ID: <CAChq9g2WvvDcH-74MtpBAHhGTN5evAzP-X1DKxsSTJEOWG+AGg@mail.gmail.com>

On Mon, Mar 19, 2012 at 5:44 AM, Simon MacMullen <simon at rabbitmq.com> wrote:
> On 15/03/12 19:57, Travis wrote:
>>
>> When this completed on machineA, instead of the cluster failing over,
>> the rabbitmq on machineB died. ?What we then noticed was that when we
>> tried to start up machineB's rabbitmq-server, it would fail the
>> startup process. ?machineB would only ever start up if machineA's
>> rabbitmq-server was started first.
>>
>> note: ?this is ONLY happening on our production cluster; I can't seem
>> to reproduce it in our QA environment. ?I suspect something is whacked
>> in cluster config in production.
>
>
> OK, that's alarming.
>

Ok, so I've gotten another chance to test this on our production
server.  What appears to be happening is that, when we initiate the
stop on machineA, rabbitmq *looks* like it fails the mirrored queues
over to machineB, but as soon as this completes, the management plugin
dies on machineB.  We can confirm that the queues are alive because
our applications consuming from the queue continue chugging along
happily, processing messages that have been published.

rabbitmqctl cluster_status also shows that the instance on machineB is alive.

Oddly, if I've failed from machineA to machineB, done a
stop_app/start_app to get the management plugin working on machineB,
brought up machineA again, and then initiated the failover back to
machineA, the failover completes without issue (eg, the management
plugin has no failures).

So ...

1)  As I understand it, the node in the management interface
associated with the stats service is the node considered the master.
How can I tell which node has the stats service running if the
management plugin is not running?
2) How do I restart the management plugin and associated parts without
doing a full stop_app/start_app?
3) What other things would be needed to debug this further?  I can
reliably cause this issue to occur failing from machineA to machineB.

note:  On the off chance that there was some cruft in the on-disk
config in mnesia for machineB, I proactively pulled machineB out of
the cluster, reset it, and added it back in as the second disc node.
This appears to have not made any appreciable change in behavior.

Travis
-- 
Travis Campbell
travis at ghostar.org

From iceblaze at gmail.com  Thu Apr  5 05:12:17 2012
From: iceblaze at gmail.com (iceblaze)
Date: Wed, 4 Apr 2012 21:12:17 -0700
Subject: [rabbitmq-discuss] Help with persistence using RabbitMQ?
In-Reply-To: <CABzX+qxzihJ4Cu7gdWRvhjBW+ATcW1V4LDN6Tyx_rHCBE5kC0A@mail.gmail.com>
References: <CA+-WFvwBN0j0bQw3dM7F_oQtkmmqk0bNNSzaNaeyzBWKMQ1j0g@mail.gmail.com>
	<CABzX+qwJ1-t8VVeXzVWQo4ky4s47pdF6fdMGYMyAea136JQcfw@mail.gmail.com>
	<CA+-WFvwO490up48dR=4CC31HJwqwoZat5+C-SS1w4xForV=eog@mail.gmail.com>
	<CABzX+qxzihJ4Cu7gdWRvhjBW+ATcW1V4LDN6Tyx_rHCBE5kC0A@mail.gmail.com>
Message-ID: <CA+-WFvwxR9zegRLbPvVvXHnupH35vK9+TjkGvNkeC_GaKCvNOA@mail.gmail.com>

Hello Marek,

Thanks for finding that annoying bug! Excellent!

In regards to publisher confirms, am I understanding correctly that to
implement this with Net::Rabbitmq, I simply need to set no_ack => 0
(enabling acks), and then check for a defined delivery_tag, and if it is
defined, then return ack, as so:

        if ($consume_vars->{no_ack} == 0 && defined($msg->{delivery_tag}))
        {
                #send the ack that the message was received successfully
and return
                eval{
                        $self->{_rabbit}->ack($self->{_channel},
$msg->{delivery_tag}, 0);
                }; if ($@) { error_handler($self, "ack - $@"); }
        }

Otherwise it wont return an ack and I assume stay in the queue. I haven't
figured out how I would go about testing this other than perhaps timing the
shut down of a consumer while it is consuming the message.

Thanks much for the tips!

-James

On Wed, Apr 4, 2012 at 3:57 AM, Marek Majkowski <majek04 at gmail.com> wrote:

> On Tue, Apr 3, 2012 at 17:22, iceblaze <iceblaze at gmail.com> wrote:
> > Thanks for attempting to assist me here. I have made a light version of
> the
> > module and a sender script as you requested. You can find the files here:
> >
> > http://iceblaze.com/rabbit.zip
> >
> > Simply unzip the files into the same directory and run the "sender.pl"
> > script. Note that you will need to install Net::RabbitMQ from CPAN. You
> can
> > also modify the login credentials for rabbit (right now its just using
> > guest/guest) in $self of Rabbit.pm's new() function:
> >
> >         my $self =
> >         {
> >                 _rabbit => Net::RabbitMQ->new(),
> >                 _rabbit_user => "guest",
> >                 _rabbit_pass => "guest",
> >                 _rabbit_host => "localhost",
> >                 _rabbit_port => 5672,
> >                 _queue => $queue,
> >                 _channel => $channel,
> >                 _no_ack => $no_ack,
> >                 _queue_declared => '',
> >         };
>
> Oh, installing Net::RabbitMQ from CPAN wasn't easy at all!
> But in the end after few attempts "cpan; notest install Net::RabbitMQ"
> did the trick.
>
> So, the problem is that in your code the "delivery_mode => 2"
> doesn't work.
>
> (btw, I debugged your issue by using the management plugin and
> getting a message from the queue using it - it clearly shows
> that "delivery_mode" is not set)
>
> Reading the docs:
> http://search.cpan.org/~jesus/Net--RabbitMQ-0.2.2/RabbitMQ.pm
>
>    publish($channel, $routing_key, $body, $options, $props)
>    [...]
>    $props is an optional hash (the AMQP 'props') respecting the
> following keys: { content_type => $string, content_encoding =>
> $string, correlation_id => $string, reply_to => $string, expiration =>
> $string, message_id => $string, type => $string, user_id => $string,
> app_id => $string, delivery_mode => $integer, priority => $integer,
> timestamp => $integer, }
>
> So, "delivery_mode" is a feature of "props", not "options".
> Appropriate code should therefore look like:
>
>    $self->{_rabbit}->publish($self->{_channel}, $self->{_queue},
> $data, {mandatory => 1, immediate => 0 }, {delivery_mode => 2});
>
>
> Additionally, if you want to shield against broker falling down,
> and have a reliable message delivery you should be using
> transactions or publish confirms.
>
> By default sending messages in rabbit is asynchronous. You don't know
> when the message reached the broker and even if it did so.
> Rabbit recognizes this and it doesn't immediately flush messages
> to disk. Actually it will be quire reluctant to save them on disk
> (this has been tweaked in RabbitMQ 2.8.0).
>
> If you wish to make sure that Rabbit indeed handled messages
> reliably, you must use transactions or publisher confirms to
> get a confirmation of delivery from the broker.
> Once the confirmation is received you can be sure the messages
> are safe.
>
> On the other hand if you are only going to be closing rabbit
> gracefully (via the init scripts), setting the "delivery_mode"
> properly should be enough to persist your messages.
>
> Marek
>



-- 
"Of course, the actual government of any computer is run by that fascist
dictator known as the operating system. But a wise dictator knows when to
let the people think they're capitalists--and when to let them think
they're communists." - Programming Perl third edition
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120404/db397838/attachment.htm>

From pcdinh at gmail.com  Thu Apr  5 06:28:01 2012
From: pcdinh at gmail.com (Pham Cong Dinh)
Date: Wed, 4 Apr 2012 22:28:01 -0700 (PDT)
Subject: [rabbitmq-discuss] No message is delivered to consumer workers when
	a message is requeued
Message-ID: <ec3eb346-a028-4081-a14b-5e24a5c8de08@jx17g2000pbb.googlegroups.com>

Hi all,

I got a strange issue with RabbitMQ when I launched 4 workers to
listen on a single queue to process incoming message.

However, there is a bug with worker that caused an invalid message can
not be processed successfully. In that case, that message will be
redelivered back to the original queue using

channel.basic_reject(delivery_tag, requeue=True) # Python code (Kombu
framework)
# Just reject the message. Not closing the channel or releasing
connection after that

As you may guess, none of 4 workers could process the message because
the bug. After that no worker received incoming message any more. The
output of strace shows that worker still polled RabbitMQ for new
message but they received no message. I also listed all the message
available in the queue using rabbitmqctl and found that there were 4
unacknowledged messages and a lot of incoming messages in the queue
too.

Have anyone here experienced the same issue?

My configuration:

consumer_options = {
    'exchange_name': 'feed',
    'exchange_type': 'direct',
    'queue_name': 'feed',
    'routing_key': 'importer',
    'durable': True,
    'delivery_mode': 2,
    'no_ack': False,
    'auto_ack': False,
    'prefetch_count': 1
}

I use the same consumer_tag for all workers. Did it cause any problem?

Thanks


Dinh

From carl.hoerberg at gmail.com  Thu Apr  5 08:10:15 2012
From: carl.hoerberg at gmail.com (=?ISO-8859-1?Q?Carl_H=F6rberg?=)
Date: Thu, 5 Apr 2012 09:10:15 +0200
Subject: [rabbitmq-discuss] Client connection to ssl rabbitMQ is very
	slow
In-Reply-To: <4F7C25DE.40703@rabbitmq.com>
References: <33544994.post@talk.nabble.com> <4F7C25DE.40703@rabbitmq.com>
Message-ID: <CAFPidkNoJoK5PqLoaxqntvEs+E3X3uYrabVU+rkJYsqxyL9ymA@mail.gmail.com>

the DHE key exchange algorithm  is very computational intensive, so
make sure you disable it (http://matt.io/entry/ur)

this config allows only the AES 128 chiper with RSA (and not DHE) as
key exchange and SHA as hash algoritm (md5 is somewhat weaker but
faster):

{ssl_options, [{cacertfile,"/etc/rabbitmq/ca.pem"},
                    {certfile,"/etc/rabbitmq/cert.pem"},
                    {ciphers,[{rsa,aes_128_cbc,sha}]}]}

for all options, see http://www.erlang.org/doc/man/ssl.html, as Emile said.

On Wed, Apr 4, 2012 at 12:43, Emile Joubert <emile at rabbitmq.com> wrote:
> Hi,
>
> On 02/04/12 15:26, Rabbit001 wrote:
>> ? I've follow the ssl configuration instructions in rabbitmq page
>> 'www.rabbitmq.com/ssl.html' to configure ssl access to rabbitmq server. I've
>> started rabbitmq server correctly and I've executed the example1 (sample
>> code for ssl java client) and the result is good, but the method
>> factory.newConnection() finish over 5sg. In the other hand, without ssl ?the
>> method factory.newConnection() finish in <200 ms.
>>
>> ? How do i increasse the performance in the first scenario (ssl
>> configuration)? any idea?
>
> If your broker CPU has hardware support for certain ciphers and OpenSSL
> can make use of it then try to restrict the SSL connection to those
> ciphers, or to prioritise them. The "ciphers" SSL configuration option
> in the broker is one way of achieving that. For configuration details
> see http://www.erlang.org/doc/man/ssl.html
>
> You might also gain some useful insight by using an SSL traffic analyser
> such as "ssldump". If long gaps appear in the timeline then the output
> may help you to determine what is responsible for the delay.
>
> Do other SSL clients also take long to connect? Try using the "openssl
> s_client" option as described here:
> http://www.rabbitmq.com/troubleshooting-ssl.html
> and check whether such connections also take long.
>
> Does the Java client take long to connect when the SSL layer is provided
> by a different SSL service? You can try this by connecting to the broker
> via stunnel, socat or similar.
>
> The last two questions may help you to focus on whether the problem lies
> on the client or server side.
>
>
> -Emile
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From rui.favas at barclays.com  Wed Apr  4 20:10:27 2012
From: rui.favas at barclays.com (rui.favas at barclays.com)
Date: Wed, 4 Apr 2012 20:10:27 +0100
Subject: [rabbitmq-discuss] Increase Socket descriptors
Message-ID: <1308E5CFD51CA14DA7B024A689B8B168024F5366AD@LDNPCMMGMB01.INTRANET.BARCAPINT.COM>

Using RabbitMQ 2.8.1 - how do I increase the Socket descriptors from 829


_______________________________________________
Barclays is one of the world's leading banks, and we believe that by continuing to integrate the organisation we can better deliver the full power of Barclays to customers, clients and the communities in which we work. 
As a visible sign of that integration we are moving to a single Barclays brand for the majority of our divisions, including those formerly known as Barclays Capital, Barclays Wealth and Barclays Corporate.

_______________________________________________

This e-mail may contain information that is confidential, privileged or otherwise protected from 
disclosure. If you are not an intended recipient of this e-mail, do not duplicate or redistribute 
it by any means. Please delete it and any attachments and notify the sender that you have received 
it in error. Unless specifically indicated, this e-mail is not an offer to buy or sell or a 
solicitation to buy or sell any securities, investment products or other financial product or 
service, an official confirmation of any transaction, or an official statement of Barclays. Any 
views or opinions presented are solely those of the author and do not necessarily represent those 
of Barclays. This e-mail is subject to terms available at the following link: www.barcap.com/emaildisclaimer. 
By messaging with Barclays you consent to the foregoing.  Barclays offers premier investment banking 
products and services to its clients through Barclays Bank PLC, a company registered in England 
(number 1026167) with its registered office at 1 Churchill Place, London, E14 5HP.  This email may 
relate to or be sent from other members of the Barclays Group.

_______________________________________________
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120404/a0e64af1/attachment.htm>

From simon at rabbitmq.com  Thu Apr  5 10:21:17 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 05 Apr 2012 10:21:17 +0100
Subject: [rabbitmq-discuss] Increase Socket descriptors
In-Reply-To: <1308E5CFD51CA14DA7B024A689B8B168024F5366AD@LDNPCMMGMB01.INTRANET.BARCAPINT.COM>
References: <1308E5CFD51CA14DA7B024A689B8B168024F5366AD@LDNPCMMGMB01.INTRANET.BARCAPINT.COM>
Message-ID: <4F7D640D.4040808@rabbitmq.com>

On 04/04/12 20:10, rui.favas at barclays.com wrote:
> Using RabbitMQ 2.8.1 - how do I increase the Socket descriptors from 829

It's an OS-imposed limit, so it depends on your OS. On Linux you would 
typically edit /etc/security/limits.conf - see "man limits.conf".

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From rui.favas at barclays.com  Thu Apr  5 10:26:49 2012
From: rui.favas at barclays.com (rui.favas at barclays.com)
Date: Thu, 5 Apr 2012 10:26:49 +0100
Subject: [rabbitmq-discuss] Increase Socket descriptors
In-Reply-To: <4F7D640D.4040808@rabbitmq.com>
References: <1308E5CFD51CA14DA7B024A689B8B168024F5366AD@LDNPCMMGMB01.INTRANET.BARCAPINT.COM>
	<4F7D640D.4040808@rabbitmq.com>
Message-ID: <1308E5CFD51CA14DA7B024A689B8B168024F5366B1@LDNPCMMGMB01.INTRANET.BARCAPINT.COM>

I'm running on windows... Looks like changing the Erlang settings below solves the problem:-

SET ERL_MAX_PORTS=40240
SET ERL_MAX_ETS_TABLES=90240

Do you know what the recommended numbers should be?

-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: Thursday, April 05, 2012 10:21 AM
To: Favas, Rui: Barclays Capital (LDN)
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Increase Socket descriptors

On 04/04/12 20:10, rui.favas at barclays.com wrote:
> Using RabbitMQ 2.8.1 - how do I increase the Socket descriptors from 829

It's an OS-imposed limit, so it depends on your OS. On Linux you would 
typically edit /etc/security/limits.conf - see "man limits.conf".

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware
_______________________________________________
Barclays is one of the world's leading banks, and we believe that by continuing to integrate the organisation we can better deliver the full power of Barclays to customers, clients and the communities in which we work. 
As a visible sign of that integration we are moving to a single Barclays brand for the majority of our divisions, including those formerly known as Barclays Capital, Barclays Wealth and Barclays Corporate.

_______________________________________________

This e-mail may contain information that is confidential, privileged or otherwise protected from 
disclosure. If you are not an intended recipient of this e-mail, do not duplicate or redistribute 
it by any means. Please delete it and any attachments and notify the sender that you have received 
it in error. Unless specifically indicated, this e-mail is not an offer to buy or sell or a 
solicitation to buy or sell any securities, investment products or other financial product or 
service, an official confirmation of any transaction, or an official statement of Barclays. Any 
views or opinions presented are solely those of the author and do not necessarily represent those 
of Barclays. This e-mail is subject to terms available at the following link: www.barcap.com/emaildisclaimer. 
By messaging with Barclays you consent to the foregoing.  Barclays offers premier investment banking 
products and services to its clients through Barclays Bank PLC, a company registered in England 
(number 1026167) with its registered office at 1 Churchill Place, London, E14 5HP.  This email may 
relate to or be sent from other members of the Barclays Group.

_______________________________________________

From simon at rabbitmq.com  Thu Apr  5 10:34:34 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 05 Apr 2012 10:34:34 +0100
Subject: [rabbitmq-discuss] Increase Socket descriptors
In-Reply-To: <1308E5CFD51CA14DA7B024A689B8B168024F5366B1@LDNPCMMGMB01.INTRANET.BARCAPINT.COM>
References: <1308E5CFD51CA14DA7B024A689B8B168024F5366AD@LDNPCMMGMB01.INTRANET.BARCAPINT.COM>
	<4F7D640D.4040808@rabbitmq.com>
	<1308E5CFD51CA14DA7B024A689B8B168024F5366B1@LDNPCMMGMB01.INTRANET.BARCAPINT.COM>
Message-ID: <4F7D672A.5040905@rabbitmq.com>

On 05/04/12 10:26, rui.favas at barclays.com wrote:
> I'm running on windows... Looks like changing the Erlang settings below solves the problem:-
>
> SET ERL_MAX_PORTS=40240
> SET ERL_MAX_ETS_TABLES=90240

You shouldn't need to change ERL_MAX_ETS_TABLES. We really do not use 
one ETS table per connection.

> Do you know what the recommended numbers should be?

It's really up to you - this is limited in the first place to limit the 
behaviour of an out-of-control program.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From agilefreak1 at gmail.com  Thu Apr  5 11:19:42 2012
From: agilefreak1 at gmail.com (agilefreak1)
Date: Thu, 5 Apr 2012 03:19:42 -0700 (PDT)
Subject: [rabbitmq-discuss] Custom error message for basic reject
Message-ID: <28468197.14.1333621182209.JavaMail.geo-discussion-forums@vbuc18>

Hi Guys,

I would like to store rejection reason when we reject message. Currently I 
am using following line of code to reject messages.


Consumer.Model.BasicReject(basicDeliverEventArgs.DeliveryTag, false);
>
>
Is there any way to store rejection reason please? 

Naz Ali
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120405/21d57604/attachment.htm>

From matthew at rabbitmq.com  Thu Apr  5 12:26:33 2012
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 5 Apr 2012 12:26:33 +0100
Subject: [rabbitmq-discuss] Mirrored queue failover
In-Reply-To: <4F7D5C28.8000202@ms.scsk.jp>
References: <4F7D5C28.8000202@ms.scsk.jp>
Message-ID: <20120405112633.GA17466@rabbitmq.com>

Hi Kats,

(Just popping this back on the mailing list in case others are seeing
the same problem)

On Thu, Apr 05, 2012 at 05:47:36PM +0900, Katsushi Fukui wrote:
> But today I re-built new 3-nodes cluster and got the same situation now (unfortunately). Attached logs.
> 
> The result of list_queues are odd. Now rabbit3 has an error, and list_queues on that node shows different results.
> rabbit1:
> # ./rabbitmqctl list_queues name durable pid slave_pids synnchronised_slave_pids
> Listing queues ...
> que1	true	<rabbit at rabbit1.1.578.0>	[<rabbit at rabbit2.2.856.0>]	[<rabbit at rabbit2.2.856.0>]
> ...done.
> 
> rabbit2:
> # ./rabbitmqctl list_queues name durable pid slave_pids synnchronised_slave_pids
> Listing queues ...
> que1	true	<rabbit at rabbit1.1.578.0>	[<rabbit at rabbit2.2.856.0>]	[<rabbit at rabbit2.2.856.0>]
> ...done.
> 
> rabbit3:
> # ./rabbitmqctl list_queues name durable pid slave_pids
> Listing queues ...
> que1	true	<rabbit at rabbit1.1.578.0>	[<rabbit at rabbit3.3.705.0>, <rabbit at rabbit2.2.856.0>]
> ...done.
> 
> Please check the logs rabbit1-3-script.log.
> 
> If I stop rabbit1 now, the que1 loose all slaves like this:
> Listing queues ...
> que1    <rabbit at rabbit2.2.856.0>        []
> ...done.

I think this is a mis-reporting issue actually - the errors in the logs
are indicating more that the querying the slaves for their status is the
problem, not that the slaves don't exist. That doesn't mean the slave on
3 *does* exist, but the error doesn't indicate it doesn't, if you see
what I mean.

Could you repeat the test, and when you get to the same situation (i.e.
a slave seems to have vanished), stop both of the other nodes and then
check the logs of the "phantom" node.

So in your above example, you stopped rabbit1, which should promote
rabbit2 to master (and there should be log entries indicating that).
Then, even though it looks like there's no slave on rabbit3, try
stopping rabbit2 too, and see if the queue then still exists on rabbit3
- eg a rabbitmqctl -n rabbit at rabbit3 list_queues, and also again check
the logs of rabbit3 to see if there are messages about the promotion of
a slave to master.

Matthew

From chuangmin.wu at gmail.com  Thu Apr  5 15:05:32 2012
From: chuangmin.wu at gmail.com (chmin wu)
Date: Thu, 5 Apr 2012 07:05:32 -0700 (PDT)
Subject: [rabbitmq-discuss] Maximize throughput with RabbitMQ
Message-ID: <6809611.3031.1333634732520.JavaMail.geo-discussion-forums@pbcuu8>

In our project, we want to use the RabbitMQ in "Task Queues" pattern
to pass data.
On the producer side, we build a few TCP server(in node.js) to recv
high concurrent data and send it to MQ without doing anything.
On the consumer side, we use JAVA client to get the task data from
MQ, handle it and then ack.
So the question is:
To get the maximum message passing throughput/performance( For example, 400,000 
msg/second) , How many queues is best?  Does that more queue means better 
throughput/performance? And is there anything else should I notice?
Any known best practices guide for using RabbitMQ in such scenario?
 
Any comments are highly appreciated!!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120405/6fbd3868/attachment.htm>

From steve at rabbitmq.com  Thu Apr  5 16:05:01 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Thu, 5 Apr 2012 16:05:01 +0100
Subject: [rabbitmq-discuss] No message is delivered to consumer workers
	when a message is requeued
In-Reply-To: <ec3eb346-a028-4081-a14b-5e24a5c8de08@jx17g2000pbb.googlegroups.com>
References: <ec3eb346-a028-4081-a14b-5e24a5c8de08@jx17g2000pbb.googlegroups.com>
Message-ID: <34831942-8564-46A4-ADAA-FE42DC2452BA@rabbitmq.com>

Hi Dinh,

I was confused by your wording:
> I launched 4 workers to
> listen on a single queue
and:
> The
> output of strace shows that worker still polled RabbitMQ for new
> message

and:
> I use the same consumer_tag for all workers.


'Polling' implies you are using 'basic_get' which has explicit control
of acknowledgements. 'Consumers' implies you are using 'basic_consume'
(which is more sensible) and acknowledgements are set on registration.
I'd be interested in knowing what your Consumers do.

I assume that each worker registers a consumer. What
channels/connections/processes do they share? If you use the same
consumer_tag for each consumer, this will only cause problems if they
use the same channel.

I also assume that the consumers are set to explicitly acknowledge the
messages they receive.

If a message is not acknowledged (nor rejected), then pre-fetch count=1
will mean that after everyone of your consumers gets one message that
they haven't acknowledged they won't get any more.

So, what you are reporting sounds like the rejection (a negative
acknowledgement) isn't being recognised.

OR...

Your consumers are being confused -- it is possible your messages are
being rejected and requeued (requeue=True) and immediately being
delivered back to the consumer (or one of the consumers). How do the
consumers react to a redelivered message?

Steve Powell  (an easter bunny)
----------some more definitions from the SPD----------
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.
literacy (n.) A textually transmitted disease usually contracted in childhood.

On 5 Apr 2012, at 06:28, Pham Cong Dinh wrote:

> Hi all,
> 
> I got a strange issue with RabbitMQ when I launched 4 workers to
> listen on a single queue to process incoming message.
> 
> However, there is a bug with worker that caused an invalid message can
> not be processed successfully. In that case, that message will be
> redelivered back to the original queue using
> 
> channel.basic_reject(delivery_tag, requeue=True) # Python code (Kombu
> framework)
> # Just reject the message. Not closing the channel or releasing
> connection after that
> 
> As you may guess, none of 4 workers could process the message because
> the bug. After that no worker received incoming message any more. The
> output of strace shows that worker still polled RabbitMQ for new
> message but they received no message. I also listed all the message
> available in the queue using rabbitmqctl and found that there were 4
> unacknowledged messages and a lot of incoming messages in the queue
> too.
> 
> Have anyone here experienced the same issue?
> 
> My configuration:
> 
> consumer_options = {
>    'exchange_name': 'feed',
>    'exchange_type': 'direct',
>    'queue_name': 'feed',
>    'routing_key': 'importer',
>    'durable': True,
>    'delivery_mode': 2,
>    'no_ack': False,
>    'auto_ack': False,
>    'prefetch_count': 1
> }
> 
> I use the same consumer_tag for all workers. Did it cause any problem?
> 
> Thanks
> 
> 
> Dinh
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From majek04 at gmail.com  Thu Apr  5 17:09:38 2012
From: majek04 at gmail.com (Marek Majkowski)
Date: Thu, 5 Apr 2012 17:09:38 +0100
Subject: [rabbitmq-discuss] Help with persistence using RabbitMQ?
In-Reply-To: <CA+-WFvwxR9zegRLbPvVvXHnupH35vK9+TjkGvNkeC_GaKCvNOA@mail.gmail.com>
References: <CA+-WFvwBN0j0bQw3dM7F_oQtkmmqk0bNNSzaNaeyzBWKMQ1j0g@mail.gmail.com>
	<CABzX+qwJ1-t8VVeXzVWQo4ky4s47pdF6fdMGYMyAea136JQcfw@mail.gmail.com>
	<CA+-WFvwO490up48dR=4CC31HJwqwoZat5+C-SS1w4xForV=eog@mail.gmail.com>
	<CABzX+qxzihJ4Cu7gdWRvhjBW+ATcW1V4LDN6Tyx_rHCBE5kC0A@mail.gmail.com>
	<CA+-WFvwxR9zegRLbPvVvXHnupH35vK9+TjkGvNkeC_GaKCvNOA@mail.gmail.com>
Message-ID: <CABzX+qzBnwqOtJ90ECw_ss0N8Q8aVxQwZ1bo32Ah-fSrG9rf5g@mail.gmail.com>

On Thu, Apr 5, 2012 at 05:12, iceblaze <iceblaze at gmail.com> wrote:
> Thanks for finding that annoying bug! Excellent!
>
> In regards to publisher confirms, am I understanding correctly that to
> implement this with Net::Rabbitmq, I simply need to set no_ack => 0
> (enabling acks), and then check for a defined delivery_tag, and if it is
> defined, then return ack, as so:

Not really. Publisher acks is a kind of "reverse" ack, a thing that
server sends once it accepts a publish. It is a rabbitmq extension,
and needs some support from the client, not sure if the perl
client supports it.

Some info:
http://www.rabbitmq.com/extensions.html#publishing

Marek

From simon at rabbitmq.com  Thu Apr  5 17:59:33 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 05 Apr 2012 17:59:33 +0100
Subject: [rabbitmq-discuss] Custom error message for basic reject
In-Reply-To: <28468197.14.1333621182209.JavaMail.geo-discussion-forums@vbuc18>
References: <28468197.14.1333621182209.JavaMail.geo-discussion-forums@vbuc18>
Message-ID: <4F7DCF75.5030203@rabbitmq.com>

On 05/04/12 11:19, agilefreak1 wrote:
> Is there any way to store rejection reason please?

Not with basic.reject I'm afraid.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Apr  5 18:02:54 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 05 Apr 2012 18:02:54 +0100
Subject: [rabbitmq-discuss] Maximize throughput with RabbitMQ
In-Reply-To: <6809611.3031.1333634732520.JavaMail.geo-discussion-forums@pbcuu8>
References: <6809611.3031.1333634732520.JavaMail.geo-discussion-forums@pbcuu8>
Message-ID: <4F7DD03E.1080205@rabbitmq.com>

On 05/04/12 15:05, chmin wu wrote:
> To get the maximum message passing throughput/performance( For example,
> 400,000 msg/second) , How many queues is best?  Does that more queue
> means better throughput/performance? And is there anything else should I
> notice?

Each queue can only use one core on your machine, so having multiple 
queues will definitely help.

Also, using more than one queue from the start will make it easier to 
scale horizontally.

> Any known best practices guide for using RabbitMQ in such scenario?

400,000 msg/s is quite a lot. Turn off all the features you can (acks, 
confirms, complicated routing, persistence) and parallelise as much as 
possible.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From agilefreak1 at gmail.com  Thu Apr  5 18:22:56 2012
From: agilefreak1 at gmail.com (Nazakat Ali)
Date: Thu, 5 Apr 2012 18:22:56 +0100
Subject: [rabbitmq-discuss] Custom error message for basic reject
In-Reply-To: <4F7DCF75.5030203@rabbitmq.com>
References: <28468197.14.1333621182209.JavaMail.geo-discussion-forums@vbuc18>
	<4F7DCF75.5030203@rabbitmq.com>
Message-ID: <B4ECFAF2-4776-4E8B-9AD3-3D0863251DC4@gmail.com>

If not possible with basic reject, is it possible to refuse/not acknowledge a message with reason?

Thank you

Sent from my iPhone

On 5 Apr 2012, at 17:59, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 05/04/12 11:19, agilefreak1 wrote:
>> Is there any way to store rejection reason please?
> 
> Not with basic.reject I'm afraid.
> 
> Cheers, Simon
> 
> -- 
> Simon MacMullen
> RabbitMQ, VMware

From matthias at rabbitmq.com  Thu Apr  5 18:34:09 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 05 Apr 2012 18:34:09 +0100
Subject: [rabbitmq-discuss] Upgrade 2.7.1 RabbitMQ cluster to 2.8.1
	version
In-Reply-To: <18863890.3713.1333558975674.JavaMail.geo-discussion-forums@vbbdy9>
References: <32143157.102.1333329241115.JavaMail.geo-discussion-forums@pbcr5>	<5d9f08ec-40f4-4789-af03-df2d8656fd03@k14g2000vbe.googlegroups.com>
	<18863890.3713.1333558975674.JavaMail.geo-discussion-forums@vbbdy9>
Message-ID: <4F7DD791.5010007@rabbitmq.com>

Eslam,

On 04/04/12 18:02, Eslam El Husseiny wrote:
> sorry but i didn't understand the procedure of adding new physical
> cluster running 2.8.1
> do you mean using rabbitmqctl command to new physical machine to cluster
> , OR ?

Brendan wrote:

>     I would suggest you provision a _new_ physical cluster running 2.8.1
>     side by side with your old cluster, and then incrementally move
>     producers/consumers over.

So the suggestion here is to set up an entirely *new*, *separate* 
cluster, having nothing whatsoever to do with the existing cluster.


Matthias.

From j.14159 at gmail.com  Thu Apr  5 19:02:49 2012
From: j.14159 at gmail.com (Jeremy Pierre)
Date: Thu, 5 Apr 2012 11:02:49 -0700 (PDT)
Subject: [rabbitmq-discuss] Running into some issues with high queue
	counts(again)
Message-ID: <17574542.4.1333648969791.JavaMail.geo-discussion-forums@pbnv7>

Hi all,

I seem to be hitting some limits with RabbitMQ queue volumes again, here's 
the rough breakdown of the situation for the purposes of my current testing:

One RabbitMQ node, 8 cores, 32GB RAM - Rabbit version 2.8.1-1, Erlang R13B 
on Ubuntu 10.04
2 nodes connecting and trying to create 150k queues each on a topic exchange
10 routing keys

The 2 nodes that connect run code written for Akka 2.0 with the development 
AMQP module, Scala 2.9.1, OpenJDK-6

Creating ~200k queues goes fine, only takes ~5min.  Past this, I get a lot 
of timing out on channel/queue creation(timeout value bumped up to 60 
seconds).

The use case is essentially some realtime-ish event based stuff for web 
clients(will be done using Play! 2.0).  Under the current plan, any given 
user will create at least 2 queues:  one for general events that occur 
during their session and one for each category of data they're 
receiving(e.g. a chat session, updates from various data sources/streams). 
 The 300k queues I'm attempting to create is a much smaller count than we'd 
eventually be running in production.

So the question is, am I approaching this the wrong way?  Should I be 
treating RabbitMQ as a more general message bus and performing more complex 
routing on the non-RabbitMQ web server/application nodes?  Any and all 
feedback would be most welcome.

Regards,

Jeremy
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120405/697cf55d/attachment.htm>

From alan.antonuk at gmail.com  Thu Apr  5 19:18:46 2012
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Thu, 5 Apr 2012 14:18:46 -0400
Subject: [rabbitmq-discuss] librabbitmq faults
In-Reply-To: <3B34C005-3EE0-486D-943E-0EE2D62D1C9E@portalify.com>
References: <BAD9CCAC-6116-4CE6-AE09-088CD6386592@portalify.com>
	<CAAt2poJxUX19CoZC6DJq7gtSzs+VTfzmhKzDTWG+Wd04zXYwcw@mail.gmail.com>
	<3B34C005-3EE0-486D-943E-0EE2D62D1C9E@portalify.com>
Message-ID: <CAAt2poJM7M-VivLy=_SyOODoevwm5Lt_7OzCEcCgJnEfwOdrSQ@mail.gmail.com>

What do you mean by it doesn't segfault with rabbitmq-c-fb6fca832fd2 ?  Did
you build Net::RabbitMQ with that version of rabbitmq-c and it ran the
script below without crashing?

-Alan

On Wed, Apr 4, 2012 at 3:12 AM, Matti Linnanvuori <
matti.linnanvuori at portalify.com> wrote:

> Hi!
>
> I wonder how it is possible to have recv hang if RabbitMQ server has
> disconnected. Maybe RabbitMQ server has a bug that it does not disconnect a
> socket.
>
> I am afraid I don't have a succinct example that can reproduce this
> segfault. It occurred with Net::RabbitMQ versions 0.2.0 and 0.2.2, but not
> with rabbitmq-c-fb6fca832fd2.
>
> I reported the segmentation fault in CPAN:
> https://rt.cpan.org/Public/Bug/Display.html?id=76205
>
> I got the segmentation fault in subroutine get. I think it is because
> memory allocation failed.
> I have Net::RabbitMQ version 0.2.2. I got a similar bug in Net::RabbitMQ
> version 0.2.0, too:https://rt.cpan.org/Public/Bug/Display.html?id=76156
> This is perl, v5.10.0 built for x86_64-linux-thread-multi
> Linux pmc-inst-test 2.6.32.12-0.7-default #1 SMP 2010-05-20 11:14:20 +0200
> x86_64 x86_64 x86_64 GNU/Linux
>
> Program received signal SIGSEGV, Segmentation fault.
> 0x00007ffff724fa41 in memcpy () from /lib64/libc.so.6
> (gdb) bt
> #0 0x00007ffff724fa41 in memcpy () from /lib64/libc.so.6
> #1 0x00007ffff6db2c0d in amqp_handle_input (state=0x7bc8a0,
> received_data=..., decoded_frame=0x7fffffffe2c0)
> at /usr/include/bits/string3.h:52
> #2 0x00007ffff6dbbeec in wait_frame_inner (state=0x7bc8a0,
> decoded_frame=0x7fffffffe2c0) at amqp_socket.c:167
> #3 0x00007ffff6dbc489 in amqp_simple_rpc (state=0x7bc8a0, channel=3,
> request_id=, expected_reply_ids=0x7fffffffe3a0,
> decoded_request_method=) at amqp_socket.c:283
> #4 0x00007ffff6db156c in amqp_basic_get (state=0x7bc8a0, channel=7,
> queue=..., no_ack=1) at amqp_api.c:258
> #5 0x00007ffff6da7432 in XS_Net__RabbitMQ_get (my_perl=,
> cv=) at RabbitMQ.xs:618
> #6 0x000000000047e115 in Perl_pp_entersub ()
> #7 0x0000000000455ad3 in Perl_runops_debug ()
> #8 0x000000000047a005 in perl_run ()
> #9 0x000000000042172c in main ()
> (gdb)
>
> #!/usr/bin/perl -w
>
> =pod
>
> =head1 sds2sds_sf_fault.t
>
>  Test 1: publish a Dispatch JSON message with ack_level and valid_until
>  - from SDS to SDS in exchange.pmc.router-in.
>  Try to receive a message from exchange.pmc.router-in in 8 seconds.
>  Test 1 expected result: a message is received from exchange.pmc.router-in
> in 8 seconds.
>  Test 2: decode the message as JSON.
>  Test 2 expected result: the message is decoded as JSON.
>  Test 3: check that the sender field is the same as in the sent message.
>  Test 3 expected result: the sender field is the same as in the sent
> message.
>  Test 4: check the body of the received message and the sent one.
>  Test 4 expected result: the body fields are the same.
>  Test 5: check the timestamp field.
>  Test 5 expected result: the timestamp field is the same as in the
> published message.
>  Test 6: try to receive a message from exchange.pmc.sf-in in 8 seconds.
>  Test 6 expected result: a message is received from exchange.pmc.sf-in in
> 8 seconds.
>  Test 7: decode the message as JSON.
>  Test 7 expected result: the message is decoded as JSON.
>  Test 8: check that the sender field is "exchange.pmc.router-in".
>  Test 8 expected result: the sender field is "exchange.pmc.router-in".
>  Test 9: check the body of the received message and the sent one.
>  Test 9 expected result: the body fields are the same.
>  Test 10: check that the timestamp in an integer.
>  Test 10 expected result: the timestamp in an integer.
>  Test 11: check that the timestamp is greater than or equal to that of
> before publishing.
>  Test 11 expected result: the timestamp is greater than or equal to that
> of before publishing.
>  Test 12: check that the timestamp is less than or equal to that of now.
>  Test 12 expected result: the timestamp is less than or equal to that of
> now.
>  Test 13: try to receive a message from exchange.pmc.router-in in 8
> seconds.
>  Test 13 expected result: a message is received from
> exchange.pmc.router-in in 8 seconds.
>  Test 14: decode the message as JSON.
>  Test 14 expected result: the message is decoded as JSON.
>  Test 15: check that the sender field is "exchange.pmc.sf-in".
>  Test 15 expected result: the sender field is "exchange.pmc.sf-in".
>  Test 16: check the body of the received message and the sent one.
>  Test 16 expected result: the body fields are the same.
>  Test 17: check that the timestamp in an integer.
>  Test 17 expected result: the timestamp in an integer.
>  Test 18: check that the timestamp is greater than or equal to that of
> before publishing.
>  Test 18 expected result: the timestamp is greater than or equal to that
> of before publishing.
>  Test 19: check that the timestamp is less than or equal to that of now.
>  Test 19 expected result: the timestamp is less than or equal to that of
> now.
>  Test 20: try to receive a message from exchange.pmc.router-in in 8
> seconds.
>  Test 20 expected result: a message is received from
> exchange.pmc.router-in in 8 seconds.
>  Test 21: decode the message as JSON.
>  Test 21 expected result: the message is decoded as JSON.
>  Test 22: check that the sender field is "exchange.pmc.sf-in".
>  Test 22 expected result: the sender field is "exchange.pmc.sf-in".
>  Test 23: check that the timestamp in an integer.
>  Test 23 expected result: the timestamp in an integer.
>  Test 24: check that the timestamp is greater than or equal to that of
> before publishing.
>  Test 24 expected result: the timestamp is greater than or equal to that
> of before publishing.
>  Test 25: check that the timestamp is less than or equal to that of now.
>  Test 25 expected result: the timestamp is less than or equal to that of
> now.
>  Test 26: check that the id fields of the received and the published
> messages are the same.
>  Test 26 expected result: the id fields of the received and the published
> messages are the same.
>  Test 27: check that the ack_type field has value "processed".
>  Test 27 expected result: the ack_type field has value "processed".
>  Test 28: check that the from field of the received message is the same as
>  the to field of the published message.
>  Test 28 expected result: the from field of the received message is the
> same as
>  the to field of the published message.
>  Test 29: check that the type field has value "ack".
>  Test 29 expected result: the type field has value "ack".
>  Test 30: check that the version field has value 1.
>  Test 30 expected result: the version field has value 1.
>  Test 31: try to receive a message from exchange.pmc.cassidian-in in 8
> seconds.
>  Test 31 expected result: a message is received from
> exchange.pmc.cassidian-in in 8 seconds.
>  Test 32: decode the message as JSON.
>  Test 32 expected result: the message is decoded as JSON.
>  Test 33: check that the sender field is "exchange.pmc.router-in".
>  Test 33 expected result: the sender field is "exchange.pmc.router-in".
>  Test 34: check the body of the received message and the sent one.
>  Test 34 expected result: the body fields are the same.
>  Test 35: check that the timestamp in an integer.
>  Test 35 expected result: the timestamp in an integer.
>  Test 36: check that the timestamp is greater than or equal to that of
> before publishing.
>  Test 36 expected result: the timestamp is greater than or equal to that
> of before publishing.
>  Test 37: check that the timestamp is less than or equal to that of now.
>  Test 37 expected result: the timestamp is less than or equal to that of
> now.
>  Test 38: try to receive a message from exchange.pmc.cassidian-in in 8
> seconds.
>  Test 38 expected result: a message is received from
> exchange.pmc.cassidian-in in 8 seconds.
>  Test 39: decode the message as JSON.
>  Test 39 expected result: the message is decoded as JSON.
>  Test 40: check that the sender field is "exchange.pmc.router-in".
>  Test 40 expected result: the sender field is "exchange.pmc.router-in".
>  Test 41: check that the timestamp in an integer.
>  Test 41 expected result: the timestamp in an integer.
>  Test 42: check that the timestamp is greater than or equal to that of
> before publishing.
>  Test 42 expected result: the timestamp is greater than or equal to that
> of before publishing.
>  Test 43: check that the timestamp is less than or equal to that of now.
>  Test 43 expected result: the timestamp is less than or equal to that of
> now.
>  Test 44: check that the id fields of the received and the published
> messages are the same.
>  Test 44 expected result: the id fields of the received and the published
> messages are the same.
>  Test 45: check that the ack_type field has value "processed".
>  Test 45 expected result: the ack_type field has value "processed".
>  Test 46: check that the from field of the received message is the same as
>  the to field of the published message.
>  Test 46 expected result: the from field of the received message is the
> same as
>  the to field of the published message.
>  Test 47: check that the type field has value "ack".
>  Test 47 expected result: the type field has value "ack".
>  Test 48: check that the version field has value 1.
>  Test 48 expected result: the version field has value 1.
>  Test 49: publish an Ack sent message from the SSI in
> exchange.pmc.router-in.
>  try to receive a message from exchange.pmc.router-in in 8 seconds.
>  Test 49 expected result: a message is received from
> exchange.pmc.router-in in 8 seconds.
>  Test 50: decode the message as JSON.
>  Test 50 expected result: the message is decoded as JSON.
>  Test 51: check that the timestamp of the received message is the same as
> that of published one.
>  Test 51 expected result:
>  the timestamp of the received message is the same as that of published
> one.
>  Test 52: check the sender field of the received message.
>  Test 52 expected result:
>  the sender field of the received message has value
> "exchange.pmc.cassidian-in".
>  Test 53: check the body fields of the received and the published messages.
>  Test 53 expected result:
>  the body fields of the received and the published messages are the same.
>  Test 54: try to receive a message from exchange.pmc.sf-in in 8 seconds.
>  Test 54 expected result: a message is received from exchange.pmc.sf-in in
> 8 seconds.
>  Test 55: decode the message as JSON.
>  Test 55 expected result: the message is decoded as JSON.
>  Test 56: check the sender field of the received message.
>  Test 56 expected result:
>  the sender field of the received message has value
> "exchange.pmc.router-in".
>  Test 57: check the body fields of the received and the published messages.
>  Test 57 expected result:
>  the body fields of the received and the published messages are the same.
>  Test 58: check that the timestamp in an integer.
>  Test 58 expected result: the timestamp in an integer.
>  Test 59: check that the timestamp is greater than or equal to that of
> before publishing.
>  Test 59 expected result: the timestamp is greater than or equal to that
> of before publishing.
>  Test 60: check that the timestamp is less than or equal to that of now.
>  Test 60 expected result: the timestamp is less than or equal to that of
> now.
>  Test 61: try to receive a message from exchange.pmc.router-in in 8
> seconds.
>  Test 61 expected result: a message is received from
> exchange.pmc.router-in in 8 seconds.
>  Test 62: decode the message as JSON.
>  Test 62 expected result: the message is decoded as JSON.
>  Test 63: check the sender field of the received message.
>  Test 63 expected result:
>  the sender field of the received message has value "exchange.pmc.sf-in".
>  Test 64: check the body fields of the received and the published messages.
>  Test 64 expected result:
>  the body fields of the received and the published messages are the same.
>  Test 65: check that the timestamp in an integer.
>  Test 65 expected result: the timestamp in an integer.
>  Test 66: check that the timestamp is greater than or equal to that of
> before publishing.
>  Test 66 expected result: the timestamp is greater than or equal to that
> of before publishing.
>  Test 67: check that the timestamp is less than or equal to that of now.
>  Test 67 expected result: the timestamp is less than or equal to that of
> now.
>  Test 68: try to receive a message from exchange.pmc.cassidian-in in 8
> seconds.
>  Test 68 expected result: a message is received from
> exchange.pmc.cassidian-in in 8 seconds.
>  Test 69: decode the message as JSON.
>  Test 69 expected result: the message is decoded as JSON.
>  Test 70: check the sender field of the received message.
>  Test 70 expected result:
>  the sender field of the received message has value
> "exchange.pmc.router-in".
>  Test 71: check the body fields of the received and the published messages.
>  Test 71 expected result:
>  the body fields of the received and the published messages are the same.
>  Test 72: check that the timestamp in an integer.
>  Test 72 expected result: the timestamp in an integer.
>  Test 73: check that the timestamp is greater than or equal to that of
> before publishing.
>  Test 73 expected result: the timestamp is greater than or equal to that
> of before publishing.
>  Test 74: check that the timestamp is less than or equal to that of now.
>  Test 74 expected result: the timestamp is less than or equal to that of
> now.
>
> =cut
>
> use strict;
>
> use Net::RabbitMQ;
> use Test::More tests => 74;
> use JSON;
> use Time::HiRes qw(gettimeofday);
>
> use constant ROUTER_EXCHANGE    => 'exchange.pmc.router-in';
> use constant ROUTER_CHANNEL     => 1;
> use constant ROUTER_QUEUE       => 'queue.test.router-in';
> use constant SF_EXCHANGE        => 'exchange.pmc.sf-in';
> use constant SF_CHANNEL         => 2;
> use constant SF_QUEUE           => 'queue.test.sf-in';
> use constant CASSIDIAN_EXCHANGE => 'exchange.pmc.cassidian-in';
> use constant CASSIDIAN_CHANNEL  => 3;
> use constant CASSIDIAN_QUEUE    => 'queue.test.cassidian-in';
>
> sub timestamp {
>    return int( gettimeofday() * 1000 );
> }
>
> system(
> 'service pmc-smpp stop >&2; service pmc-cassidian stop >&2; service
> pmc-email stop >&2; service pmc-sf stop >&2; service pmc-routing stop >&2'
> );
>
> sleep 1;    # Wait for the message-sending to stop.
>
> system(
>    'rabbitmqctl stop_app; rabbitmqctl reset; rabbitmqctl start_app; mongo
> <<END
> use database
> db.dropDatabase();
> END'
> );
>
> system('service pmc-sf start >&2; service pmc-routing start >&2');
>
> sleep 8;    # Wait for Store & Forward and Routing to start.
>
> my $json_text = '{
> "timestamp" : 1330327514213,
> "sender" : "' . CASSIDIAN_EXCHANGE . '",
> "body" : {
> "type" : "dispatch",
> "version" : 1,
> "id" : "8f970b1b-f8a3-4c78-aa24-3b8e2205648788",
> "from" : {
> "type" : "ssi",
> "address" : "16777215"
> },
> "to" : {
> "type" : "ssi",
> "address" : "0"
> },
> "body" : "This is a test message.",
> "ack_level" : "sent",
> "valid_until" : 9223372036854775807,
> "auxiliary" : {
> "timestamp" : 1325376000000,
> "sdstl" : {
> "protocol_id" : 130,
> "message_reference" : 42,
> "short_report_allowed" : true,
> "protocol_data" : {
> "encoding" : 0,
> "timestamp" : {
> "month" : 1,
> "day" : 1,
> "hour" : 0,
> "minute" : 0
> }
> }
> }
> }
> }
> }';
>
> my $mq_router = Net::RabbitMQ->new();
> $mq_router->connect( "localhost", { user => "guest", password => "guest" }
> );
> $mq_router->channel_open(ROUTER_CHANNEL);
> $mq_router->queue_declare(
>    ROUTER_CHANNEL,
>    ROUTER_QUEUE,
>    {
>        passive     => 0,
>        durable     => 1,
>        exclusive   => 0,
>        auto_delete => 0
>    }
> );
> $mq_router->queue_bind( ROUTER_CHANNEL, ROUTER_QUEUE, ROUTER_EXCHANGE, ''
> );
> $mq_router->purge( ROUTER_CHANNEL, ROUTER_QUEUE );
> $mq_router->consume( ROUTER_CHANNEL, ROUTER_QUEUE );
>
> my $mq_sf = Net::RabbitMQ->new();
> $mq_sf->connect( "localhost", { user => "guest", password => "guest" } );
> $mq_sf->channel_open(SF_CHANNEL);
> $mq_sf->exchange_declare(
>    SF_CHANNEL,
>    SF_EXCHANGE,
>    {
>        exchange_type => 'direct',
>        passive       => 0,
>        durable       => 1,
>        auto_delete   => 0
>    }
> );
> $mq_sf->queue_declare(
>    SF_CHANNEL,
>    SF_QUEUE,
>    {
>        passive     => 0,
>        durable     => 1,
>        exclusive   => 0,
>        auto_delete => 0
>    }
> );
> $mq_sf->queue_bind( SF_CHANNEL, SF_QUEUE, SF_EXCHANGE, '' );
> $mq_sf->purge( SF_CHANNEL, SF_QUEUE );
> $mq_sf->consume( SF_CHANNEL, SF_QUEUE );
>
> my $mq_cassidian = Net::RabbitMQ->new();
> $mq_cassidian->connect( "localhost", { user => "guest", password =>
> "guest" } );
> $mq_cassidian->channel_open(CASSIDIAN_CHANNEL);
> $mq_cassidian->exchange_declare(
>    CASSIDIAN_CHANNEL,
>    CASSIDIAN_EXCHANGE,
>    {
>        exchange_type => 'direct',
>        passive       => 0,
>        durable       => 1,
>        auto_delete   => 0
>    }
> );
> $mq_cassidian->queue_declare(
>    CASSIDIAN_CHANNEL,
>    CASSIDIAN_QUEUE,
>    {
>        passive     => 0,
>        durable     => 1,
>        exclusive   => 0,
>        auto_delete => 0
>    }
> );
> $mq_cassidian->queue_bind( CASSIDIAN_CHANNEL, CASSIDIAN_QUEUE,
>    CASSIDIAN_EXCHANGE, '' );
> $mq_cassidian->purge( CASSIDIAN_CHANNEL, CASSIDIAN_QUEUE );
> $mq_cassidian->consume( CASSIDIAN_CHANNEL, CASSIDIAN_QUEUE );
>
> my $before = timestamp();
>
> $mq_router->publish(
>    ROUTER_CHANNEL,
>    '',
>    $json_text,
>    {
>
>        # Options
>        exchange => ROUTER_EXCHANGE
>    },
>    {
>
>        # Props
>        content_encoding => "UTF-8",
>        content_type     => "application/json"
>    }
> );
>
> my $sent = decode_json($json_text);
> my $message;
> eval {
>    local $SIG{ALRM} = sub { die "Timeout\n" };
>    alarm 8;
>    $message = $mq_router->recv();
>    alarm 0;
> };
> is( $@, '', 'A message was received from queue' );
> my $json;
> eval { $json = decode_json( $message->{'body'} ); };
> is( $@, '', 'A JSON message received' );
> is( $json->{'sender'}, $sent->{'sender'}, 'sender ' . $sent->{'sender'} );
> is_deeply( $json->{'body'}, $sent->{'body'}, 'body the same' );
> is( $json->{'timestamp'}, $sent->{'timestamp'},
>    "timestamp " . $sent->{'timestamp'} );
>
> undef $message;
> eval {
>    local $SIG{ALRM} = sub { die "Timeout\n" };
>    alarm 8;
>    $message = $mq_sf->recv();
>    alarm 0;
> };
> is( $@, '', 'A message was received' );
> undef $json;
> eval { $json = decode_json( $message->{'body'} ); };
> is( $@, '', 'A JSON message received' );
> is( $json->{'sender'}, ROUTER_EXCHANGE, 'sender ' . ROUTER_EXCHANGE );
> is_deeply( $json->{'body'}, $sent->{'body'}, 'body the same' );
> like( $json->{'timestamp'}, qr/^\d+$/, "timestamp an integer" );
> ok( $json->{'timestamp'} >= $before,
>    'timestamp greater than or equal to that of before publishing' )
>  or diag("$json->{'timestamp'} < $before");
> my $now = timestamp();
> ok( $json->{'timestamp'} <= $now,
>    'timestamp less than or equal to that of now' )
>  or diag("$json->{'timestamp'} > $now");
>
> undef $message;
> eval {
>    local $SIG{ALRM} = sub { die "Timeout\n" };
>    alarm 8;
>    $message = $mq_router->recv();
>    alarm 0;
> };
> is( $@, '', 'A message was received' );
> undef $json;
> eval { $json = decode_json( $message->{'body'} ); };
> is( $@,                '',          'A JSON message received' );
> is( $json->{'sender'}, SF_EXCHANGE, 'sender ' . SF_EXCHANGE );
> is_deeply( $json->{'body'}, $sent->{'body'}, 'body the same' );
> like( $json->{'timestamp'}, qr/^\d+$/, "timestamp an integer" );
> ok( $json->{'timestamp'} >= $before,
>    'timestamp greater than or equal to that of before publishing' )
>  or diag("$json->{'timestamp'} < $before");
> $now = timestamp();
> ok( $json->{'timestamp'} <= $now,
>    'timestamp less than or equal to that of now' )
>  or diag("$json->{'timestamp'} > $now");
>
> undef $message;
> eval {
>    local $SIG{ALRM} = sub { die "Timeout\n" };
>    alarm 8;
>    $message = $mq_router->recv();
>    alarm 0;
> };
> is( $@, '', 'A message was received' );
> undef $json;
> eval { $json = decode_json( $message->{'body'} ); };
> is( $@,                '',          'A JSON message received' );
> is( $json->{'sender'}, SF_EXCHANGE, 'sender ' . SF_EXCHANGE );
> like( $json->{'timestamp'}, qr/^\d+$/, "timestamp an integer" );
> ok( $json->{'timestamp'} >= $before,
>    'timestamp greater than or equal to that of before publishing' )
>  or diag("$json->{'timestamp'} < $before");
> $now = timestamp();
> ok( $json->{'timestamp'} <= $now,
>    'timestamp less than or equal to that of now' )
>  or diag("$json->{'timestamp'} > $now");
> is( $json->{'body'}->{'id'}, $sent->{'body'}->{'id'}, 'id the same' );
> is( $json->{'body'}->{'ack_type'}, 'processed', 'ack_type processed' );
> is_deeply(
>    $json->{'body'}->{'from'},
>    $sent->{'body'}->{'to'},
>    'from is the same as to of sent'
> );
> is( $json->{'body'}->{'type'},    'ack', 'type is ack' );
> is( $json->{'body'}->{'version'}, 1,     'version is 1' );
>
> my $end = time() + 8;
> undef $message;
> do {
>    eval {
>        $message = $mq_cassidian->get( CASSIDIAN_CHANNEL, CASSIDIAN_QUEUE );
>    };
>    if ($@) {
>        diag($@);
>    }
> } until ( defined $message or time() > $end or $@ );
> ok( defined $message, 'A message was received' );
> undef $json;
> eval { $json = decode_json( $message->{'body'} ); };
> is( $@, '', 'A JSON message received' );
> is( $json->{'sender'}, ROUTER_EXCHANGE, 'sender ' . ROUTER_EXCHANGE );
> is_deeply( $json->{'body'}, $sent->{'body'}, 'body the same' );
> like( $json->{'timestamp'}, qr/^\d+$/, "timestamp an integer" );
> ok( $json->{'timestamp'} >= $before,
>    'timestamp greater than or equal to that of before publishing' )
>  or diag("$json->{'timestamp'} < $before");
> $now = timestamp();
> ok( $json->{'timestamp'} <= $now,
>    'timestamp less than or equal to that of now' )
>  or diag("$json->{'timestamp'} > $now");
>
> $end = time() + 8;
> note("Trying to receive an Ack from Cassidian exchange");
> undef $message;
> do {
>    eval {
>        $message = $mq_cassidian->get( CASSIDIAN_CHANNEL, CASSIDIAN_QUEUE );
>    };
>    if ($@) {
>        diag($@);
>    }
> } until ( defined $message or time() > $end or $@ );
> ok( defined $message, 'A message was received' );
> undef $json;
> eval { $json = decode_json( $message->{'body'} ); };
> is( $@, '', 'A JSON message received' );
> is( $json->{'sender'}, ROUTER_EXCHANGE, 'sender ' . ROUTER_EXCHANGE );
> like( $json->{'timestamp'}, qr/^\d+$/, "timestamp an integer" );
> ok( $json->{'timestamp'} >= $before,
>    'timestamp greater than or equal to that of before publishing' )
>  or diag("$json->{'timestamp'} < $before");
> $now = timestamp();
> ok( $json->{'timestamp'} <= $now,
>    'timestamp less than or equal to that of now' )
>  or diag("$json->{'timestamp'} > $now");
> is( $json->{'body'}->{'id'}, $sent->{'body'}->{'id'}, 'id the same' );
> is( $json->{'body'}->{'ack_type'}, 'processed', 'ack_type processed' );
> is_deeply(
>    $json->{'body'}->{'from'},
>    $sent->{'body'}->{'to'},
>    'from is the same as to of sent'
> );
> is( $json->{'body'}->{'type'},    'ack', 'type is ack' );
> is( $json->{'body'}->{'version'}, 1,     'version is 1' );
>
> my $ack = '{
> "timestamp" : 1328020064358,
> "sender" : "' . CASSIDIAN_EXCHANGE . '",
> "body" : {
> "type" : "ack",
> "version" : 1,
> "id" : "8f970b1b-f8a3-4c78-aa24-3b8e2205648788",
> "from" : {
> "type" : "ssi",
> "address" : "0"
> },
> "ack_type" : "sent",
> "auxiliary" : {
> "timestamp" : 1325376000000,
> "original_message" : ' . encode_json( $sent->{'body'} ) . ',
> "sdstl" : {
> "protocol_id" : 130,
> "message_reference" : 42,
> "short_report_allowed" : true,
> "protocol_data" : {
> "encoding" : 0,
> "timestamp" : {
> "month" : 1,
> "day" : 1,
> "hour" : 0,
> "minute" : 0
> }
> }
> }
> }
> }
> }';
> $sent   = decode_json($ack);
> $before = timestamp();
>
> $mq_router->publish(
>    ROUTER_CHANNEL,
>    '', $ack,
>    {
>
>        # Options
>        exchange => ROUTER_EXCHANGE
>    },
>    {
>
>        # Props
>        content_encoding => "UTF-8",
>        content_type     => "application/json"
>    }
> );
>
> undef $message;
> eval {
>    local $SIG{ALRM} = sub { die "Timeout\n" };
>    alarm 8;
>    $message = $mq_router->recv();
>    alarm 0;
> };
> is( $@, '', 'A message was received' );
> undef $json;
> eval { $json = decode_json( $message->{'body'} ); };
> is( $@, '', 'A JSON message received' );
> is( $json->{'timestamp'}, $sent->{'timestamp'},
>    'timestamp ' . $sent->{'timestamp'} )
>  or diag( $message->{'body'} );
> is( $json->{'sender'}, CASSIDIAN_EXCHANGE, 'sender ' . CASSIDIAN_EXCHANGE )
>  or diag( $message->{'body'} );
> is_deeply( $json->{'body'}, $sent->{'body'}, 'body the same' )
>  or diag( $message->{'body'} );
>
> undef $message;
> eval {
>    local $SIG{ALRM} = sub { die "Timeout\n" };
>    alarm 8;
>    $message = $mq_sf->recv();
>    alarm 0;
> };
> is( $@, '', 'A message was received' );
> undef $json;
> eval { $json = decode_json( $message->{'body'} ); };
> is( $@, '', 'A JSON message received' );
> is( $json->{'sender'}, ROUTER_EXCHANGE, 'sender ' . ROUTER_EXCHANGE );
> is_deeply( $json->{'body'}, $sent->{'body'}, 'body the same' );
> like( $json->{'timestamp'}, qr/^\d+$/, "timestamp an integer" );
> ok( $json->{'timestamp'} >= $before,
>    'timestamp greater than or equal to that of before publishing' )
>  or diag("$json->{'timestamp'} < $before");
> $now = timestamp();
> ok( $json->{'timestamp'} <= $now,
>    'timestamp less than or equal to that of now' )
>  or diag("$json->{'timestamp'} > $now");
>
> undef $message;
> eval {
>    local $SIG{ALRM} = sub { die "Timeout\n" };
>    alarm 8;
>    $message = $mq_router->recv();
>    alarm 0;
> };
> is( $@, '', 'A message was received' );
> undef $json;
> eval { $json = decode_json( $message->{'body'} ); };
> is( $@,                '',          'A JSON message received' );
> is( $json->{'sender'}, SF_EXCHANGE, 'sender ' . SF_EXCHANGE );
> is_deeply( $json->{'body'}, $sent->{'body'}, 'body the same' );
> like( $json->{'timestamp'}, qr/^\d+$/, "timestamp an integer" );
> ok( $json->{'timestamp'} >= $before,
>    'timestamp greater than or equal to that of before publishing' )
>  or diag("$json->{'timestamp'} < $before");
> $now = timestamp();
> ok( $json->{'timestamp'} <= $now,
>    'timestamp less than or equal to that of now' )
>  or diag("$json->{'timestamp'} > $now");
>
> undef $message;
> eval {
>    local $SIG{ALRM} = sub { die "Timeout\n" };
>    alarm 8;
>    $message = $mq_cassidian->recv();
>    alarm 0;
> };
> is( $@, '', 'A message was received' );
> undef $json;
> eval { $json = decode_json( $message->{'body'} ); };
> is( $@, '', 'A JSON message received' );
> is( $json->{'sender'}, ROUTER_EXCHANGE, 'sender ' . ROUTER_EXCHANGE );
> is_deeply( $json->{'body'}, $sent->{'body'}, 'body the same' );
> like( $json->{'timestamp'}, qr/^\d+$/, "timestamp an integer" );
> ok( $json->{'timestamp'} >= $before,
>    'timestamp greater than or equal to that of before publishing' )
>  or diag("$json->{'timestamp'} < $before");
> $now = timestamp();
> ok( $json->{'timestamp'} <= $now,
>    'timestamp less than or equal to that of now' )
>  or diag("$json->{'timestamp'} > $now");
>
> END {
>    $mq_sf->queue_unbind( SF_CHANNEL, SF_QUEUE, SF_EXCHANGE, '' );
>    $mq_router->queue_unbind( ROUTER_CHANNEL, ROUTER_QUEUE, ROUTER_EXCHANGE,
>        '' );
>    $mq_cassidian->queue_unbind( CASSIDIAN_CHANNEL, CASSIDIAN_QUEUE,
>        CASSIDIAN_EXCHANGE, '' );
>    system(
> 'service pmc-smpp start >&2; service pmc-cassidian start >&2; service
> pmc-email start >&2'
>    );
> }
>
> regards, Matti Linnanvuori
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120405/f29dee6d/attachment.htm>

From rotteveel2000 at yahoo.com  Thu Apr  5 19:46:09 2012
From: rotteveel2000 at yahoo.com (Ruben Rotteveel)
Date: Thu, 5 Apr 2012 11:46:09 -0700 (PDT)
Subject: [rabbitmq-discuss] requeue problem with rabbitmq version 2.8.1
Message-ID: <1333651569.56808.YahooMailNeo@web125806.mail.ne1.yahoo.com>

We've been running into an issue where the calling BasicReject with requeue set to true, puts the message back in front of the line (as a stack) instead of the back of the line (as a queue).? This feature worked in 2.6.1.? Is there some other setting that needs to be adjusted to get this to work the way it should? 
?
Any help is greatly appreciated.
?
thanks,
Ruben.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120405/0312fb25/attachment.htm>

From emamdouh at cloud9ers.com  Thu Apr  5 20:19:10 2012
From: emamdouh at cloud9ers.com (Eslam Mamdouh)
Date: Thu, 5 Apr 2012 21:19:10 +0200
Subject: [rabbitmq-discuss] Upgrade 2.7.1 RabbitMQ cluster to 2.8.1
	version
In-Reply-To: <4F7DD791.5010007@rabbitmq.com>
References: <32143157.102.1333329241115.JavaMail.geo-discussion-forums@pbcr5>
	<5d9f08ec-40f4-4789-af03-df2d8656fd03@k14g2000vbe.googlegroups.com>
	<18863890.3713.1333558975674.JavaMail.geo-discussion-forums@vbbdy9>
	<4F7DD791.5010007@rabbitmq.com>
Message-ID: <CAHAaT5vtg5__RppRDMdiG8AtEStN=_zQogpaJb9bw6G38WEw2w@mail.gmail.com>

mmh, i see but what about old cluster data that exists in /var/lib/rabbitmq
, should i have a copy of them in the new cluster with version 2.8.1-1
Thanks in advance

On Thu, Apr 5, 2012 at 7:34 PM, Matthias Radestock <matthias at rabbitmq.com>wrote:

> Eslam,
>
> On 04/04/12 18:02, Eslam El Husseiny wrote:
>
>> sorry but i didn't understand the procedure of adding new physical
>> cluster running 2.8.1
>> do you mean using rabbitmqctl command to new physical machine to cluster
>> , OR ?
>>
>
> Brendan wrote:
>
>     I would suggest you provision a _new_ physical cluster running 2.8.1
>>    side by side with your old cluster, and then incrementally move
>>    producers/consumers over.
>>
>
> So the suggestion here is to set up an entirely *new*, *separate* cluster,
> having nothing whatsoever to do with the existing cluster.
>
>
> Matthias.
>



-- 
Best Regards,
Eslam Mamdouh El Husseiny
*Systems Administrator**
Cloud Niners Ltd.

*
*Cellular: (+2) 011 198 40 40
Mansoura: (+2) 050 234 70 81
Cairo:    (+2) 022 *268 34 60
Fax:      (+2) 022 268 34 63
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120405/9db77b03/attachment.htm>

From matthias at rabbitmq.com  Thu Apr  5 20:24:43 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 05 Apr 2012 20:24:43 +0100
Subject: [rabbitmq-discuss] Upgrade 2.7.1 RabbitMQ cluster to 2.8.1
	version
In-Reply-To: <CAHAaT5vtg5__RppRDMdiG8AtEStN=_zQogpaJb9bw6G38WEw2w@mail.gmail.com>
References: <32143157.102.1333329241115.JavaMail.geo-discussion-forums@pbcr5>	<5d9f08ec-40f4-4789-af03-df2d8656fd03@k14g2000vbe.googlegroups.com>	<18863890.3713.1333558975674.JavaMail.geo-discussion-forums@vbbdy9>	<4F7DD791.5010007@rabbitmq.com>
	<CAHAaT5vtg5__RppRDMdiG8AtEStN=_zQogpaJb9bw6G38WEw2w@mail.gmail.com>
Message-ID: <4F7DF17B.5000102@rabbitmq.com>

Eslam,

On 05/04/12 20:19, Eslam Mamdouh wrote:
> mmh, i see but what about old cluster data that exists in
> /var/lib/rabbitmq , should i have a copy of them in the new cluster with
> version 2.8.1-1

Yes, you could set up the new cluster with a copy of the old cluster's 
data as a starting point. Though you do of course need to consider what 
to do about any changes made to such data between the time the copy is 
taken and the switch to the new cluster takes place.

Matthias.

From ka.fukui at ms.scsk.jp  Fri Apr  6 03:56:25 2012
From: ka.fukui at ms.scsk.jp (Katsushi Fukui)
Date: Fri, 06 Apr 2012 11:56:25 +0900
Subject: [rabbitmq-discuss] Mirrored queue failover
In-Reply-To: <20120405112633.GA17466@rabbitmq.com>
References: <4F7D5C28.8000202@ms.scsk.jp> <20120405112633.GA17466@rabbitmq.com>
Message-ID: <4F7E5B59.4060005@ms.scsk.jp>

Hi Matthew,

 > So in your above example, you stopped rabbit1, which should promote
 > rabbit2 to master (and there should be log entries indicating that).
 > Then, even though it looks like there's no slave on rabbit3, try

OK, I have already stopped rabbit1 yesterday. The current queue status is:

# ./rabbitmqctl list_queues -n rabbit at rabbit3 name pid slave_pids
Listing queues ...
que1    <rabbit at rabbit2.2.856.0>        []
...done.
# ./rabbitmqctl list_queues -n rabbit at rabbit2 name pid slave_pids
Listing queues ...
que1    <rabbit at rabbit2.2.856.0>        []
...done.

 > stopping rabbit2 too, and see if the queue then still exists on rabbit3
 > - eg a rabbitmqctl -n rabbit at rabbit3 list_queues, and also again check
 > the logs of rabbit3 to see if there are messages about the promotion of
 > a slave to master.

And now, I stopped rabbit2 and checked the cluster and queue status.

# ./rabbitmqctl cluster_status
Cluster status of node rabbit at rabbit3 ...
[{nodes,[{disc,[rabbit at rabbit3,rabbit at rabbit2,rabbit at rabbit1]}]},
  {running_nodes,[rabbit at rabbit3]}]
...done.
# ./rabbitmqctl list_queues -n rabbit at rabbit3 name pid slave_pids
Listing queues ...
...done.

Mmm..., there is no queue. The logs of rabbit3 just said:

=INFO REPORT==== 5-Apr-2012::17:06:56 ===
rabbit on node rabbit at rabbit1 down

=INFO REPORT==== 6-Apr-2012::11:26:25 ===
rabbit on node rabbit at rabbit2 down


Thanks,
Kats



(2012/04/05 20:26), Matthew Sackman wrote:
> Hi Kats,
>
> (Just popping this back on the mailing list in case others are seeing
> the same problem)
>
> On Thu, Apr 05, 2012 at 05:47:36PM +0900, Katsushi Fukui wrote:
>> But today I re-built new 3-nodes cluster and got the same situation now (unfortunately). Attached logs.
>>
>> The result of list_queues are odd. Now rabbit3 has an error, and list_queues on that node shows different results.
>> rabbit1:
>> # ./rabbitmqctl list_queues name durable pid slave_pids synnchronised_slave_pids
>> Listing queues ...
>> que1	true	<rabbit at rabbit1.1.578.0>	[<rabbit at rabbit2.2.856.0>]	[<rabbit at rabbit2.2.856.0>]
>> ...done.
>>
>> rabbit2:
>> # ./rabbitmqctl list_queues name durable pid slave_pids synnchronised_slave_pids
>> Listing queues ...
>> que1	true	<rabbit at rabbit1.1.578.0>	[<rabbit at rabbit2.2.856.0>]	[<rabbit at rabbit2.2.856.0>]
>> ...done.
>>
>> rabbit3:
>> # ./rabbitmqctl list_queues name durable pid slave_pids
>> Listing queues ...
>> que1	true	<rabbit at rabbit1.1.578.0>	[<rabbit at rabbit3.3.705.0>,<rabbit at rabbit2.2.856.0>]
>> ...done.
>>
>> Please check the logs rabbit1-3-script.log.
>>
>> If I stop rabbit1 now, the que1 loose all slaves like this:
>> Listing queues ...
>> que1<rabbit at rabbit2.2.856.0>         []
>> ...done.
>
> I think this is a mis-reporting issue actually - the errors in the logs
> are indicating more that the querying the slaves for their status is the
> problem, not that the slaves don't exist. That doesn't mean the slave on
> 3 *does* exist, but the error doesn't indicate it doesn't, if you see
> what I mean.
>
> Could you repeat the test, and when you get to the same situation (i.e.
> a slave seems to have vanished), stop both of the other nodes and then
> check the logs of the "phantom" node.
>
> So in your above example, you stopped rabbit1, which should promote
> rabbit2 to master (and there should be log entries indicating that).
> Then, even though it looks like there's no slave on rabbit3, try
> stopping rabbit2 too, and see if the queue then still exists on rabbit3
> - eg a rabbitmqctl -n rabbit at rabbit3 list_queues, and also again check
> the logs of rabbit3 to see if there are messages about the promotion of
> a slave to master.
>
> Matthew
>


From brendan at soundcloud.com  Fri Apr  6 06:20:12 2012
From: brendan at soundcloud.com (Brendan Hay)
Date: Fri, 6 Apr 2012 07:20:12 +0200
Subject: [rabbitmq-discuss] Upgrade 2.7.1 RabbitMQ cluster to 2.8.1
	version
In-Reply-To: <4F7DF17B.5000102@rabbitmq.com>
References: <32143157.102.1333329241115.JavaMail.geo-discussion-forums@pbcr5>
	<5d9f08ec-40f4-4789-af03-df2d8656fd03@k14g2000vbe.googlegroups.com>
	<18863890.3713.1333558975674.JavaMail.geo-discussion-forums@vbbdy9>
	<4F7DD791.5010007@rabbitmq.com>
	<CAHAaT5vtg5__RppRDMdiG8AtEStN=_zQogpaJb9bw6G38WEw2w@mail.gmail.com>
	<4F7DF17B.5000102@rabbitmq.com>
Message-ID: <CAHZsVQYmcfLWUYOLdWc80ZtgPOXWLjvmp-deUeM5O=fJVz9oOw@mail.gmail.com>

Eslam, what sort of state do you need to transfer from the old cluster to
the new cluster?

For messages, you will need to use shovel or a simple client to consume
messages from your old cluster and publish them to your new cluster.

If it's bindings and so on, ideally these are codified in your client code
anyway and will be established when the clients connect to the new cluster.
If this isn't the case, you can use the 'import/export definitions'
functionality from the management interface overview, with possible hand
tweaks to the exported json to ensure queue distribution/node locality
before importing to the new cluster.

Be aware that if you go the route of copying the /var/lib/rabbitmq
directory as you suggested, the source and destination hostnames of the
machines you're copying from/to need to be identical due to mnesia
requirements,

- Brendan


On Thu, Apr 5, 2012 at 9:24 PM, Matthias Radestock <matthias at rabbitmq.com>wrote:

> Eslam,
>
>
> On 05/04/12 20:19, Eslam Mamdouh wrote:
>
>> mmh, i see but what about old cluster data that exists in
>> /var/lib/rabbitmq , should i have a copy of them in the new cluster with
>> version 2.8.1-1
>>
>
> Yes, you could set up the new cluster with a copy of the old cluster's
> data as a starting point. Though you do of course need to consider what to
> do about any changes made to such data between the time the copy is taken
> and the switch to the new cluster takes place.
>
>
> Matthias.
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120406/435901ff/attachment.htm>

From mpietrek at skytap.com  Fri Apr  6 17:51:04 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Fri, 6 Apr 2012 09:51:04 -0700
Subject: [rabbitmq-discuss] Cleaning up after a rabbitmq-server install
Message-ID: <CACLE7ixJa=VmrREd=KzuoNmGKtnprc4dL_rn7ecvoNFUeH_KpQ@mail.gmail.com>

In our environment (Ubuntu 10.04, RabbitMQ 2.81),? we use automation
to install rabbitmq-server on our target nodes.

Now, for a run-of-the-mill installation of some service ("apt-get
install <program-name>" ), I wouldn't expect anything to be left
running after the install completes. That is, installing a program
shouldn't just automatically leave the program running after
installing it, as well as other running bits and pieces.

However, when installing RabbitMQ server on say 10 nodes, we end up
with various instances of the following programs left behind on the
nodes, all running in the rabbitmq user account:

/usr/lib/erlang/erts-5.7.4/bin/epmd -daemon
inet_gethost 4
/usr/lib/erlang/erts-5.7.4/bin/beam -W w -K true -A30 -P 1048576 --
-root /usr/lib/erlang -progname erl -- -home /var/lib/rabbitmq --
-noshell -noinput -sname rabbit at lb2-cm... <rest of line omitted>


From batyu2000 at freemail.hu  Fri Apr  6 23:19:19 2012
From: batyu2000 at freemail.hu (=?UTF-8?Q?Horv=C3=A1th_P=C3=A9ter?=)
Date: Sat, 7 Apr 2012 00:19:19 +0200 (CEST)
Subject: [rabbitmq-discuss] Datas from PHP to Java
Message-ID: <freemail.20120407001919.63484.1@xmldata07.freemail.hu>

Hi, I&#39;m working on a web site using PHP+MySQL, but realised that I need the massive multithreading capabilities of Java for doing heavy mathematical computations.Question: Is it possible, to pass datas from a PHP+MySQL database to a Java Threadpool? If so, how (just in general)? (Before you ask, I don&#39;t want to re-build my hole work, I&#39;ve done so far, in JSP/JSF...)Thx 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120407/82947027/attachment.htm>

From videlalvaro at gmail.com  Fri Apr  6 23:29:25 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Sat, 7 Apr 2012 00:29:25 +0200
Subject: [rabbitmq-discuss] Datas from PHP to Java
In-Reply-To: <freemail.20120407001919.63484.1@xmldata07.freemail.hu>
References: <freemail.20120407001919.63484.1@xmldata07.freemail.hu>
Message-ID: <E049118F-C7EE-4A46-87A9-942DC81D6A17@gmail.com>

Hi,

Create your publisher in PHP using for example php-amqplib and then create a consumer in Java and from there use it in your Java app.

Cheers,

Alvaro

On Apr 7, 2012, at 12:19 AM, Horv?th P?ter wrote:

> Hi,
>  
> I'm working on a web site using PHP+MySQL, but realised that I need the massive multithreading capabilities of Java for doing heavy mathematical computations.
> Question: Is it possible, to pass datas from a PHP+MySQL database to a Java Threadpool? If so, how (just in general)? (Before you ask, I don't want to re-build my hole work, I've done so far, in JSP/JSF...)
> Thx
>  
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

Sent form my Nokia 1100




From matwey.kornilov at gmail.com  Mon Apr  9 10:24:20 2012
From: matwey.kornilov at gmail.com (Matwey V.  Kornilov)
Date: Mon, 09 Apr 2012 13:24:20 +0400
Subject: [rabbitmq-discuss] private exchange name generation
Message-ID: <jlu9s5$n3c$1@dough.gmane.org>


Hi,

I am going to use some exchange-to-exchange bindings. And I need private 
exchange with name auto-generated. Can RabbitMQ handle this for me? or 
should I generate exchange name by myself.




From matthew at rabbitmq.com  Mon Apr  9 14:02:18 2012
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 9 Apr 2012 14:02:18 +0100
Subject: [rabbitmq-discuss] Cleaning up after a rabbitmq-server install
In-Reply-To: <CACLE7ixJa=VmrREd=KzuoNmGKtnprc4dL_rn7ecvoNFUeH_KpQ@mail.gmail.com>
References: <CACLE7ixJa=VmrREd=KzuoNmGKtnprc4dL_rn7ecvoNFUeH_KpQ@mail.gmail.com>
Message-ID: <20120409130217.GA15896@wellquite.org>

Hi Matt,

On Fri, Apr 06, 2012 at 09:51:04AM -0700, Matt Pietrek wrote:
> Now, for a run-of-the-mill installation of some service ("apt-get
> install <program-name>" ), I wouldn't expect anything to be left
> running after the install completes. That is, installing a program
> shouldn't just automatically leave the program running after
> installing it, as well as other running bits and pieces.

Hmm. My recollection is that installing things like apache, nginx,
postgresql etc etc (i.e. system daemons) does exactly that and leaves
them running. Please correct me if I'm wrong there, but I don't think we
do anything abnormal.

> However, I don't see a way to tell the rabbitmq-server install to just
> drop the bits, and not leave anything running.

Oh, there's probably some bizarre dpkg incantation that can do that -
probably just "don't run the postinstall" or something, but that might
leave the package in a badly configured state. Again, do other system
daemons provide this sort of option? If so, how? We'll be more than
happy to cope whatever is the standard way of achieving this for Debian.

> The issue is: We don't want these leftover processes running as the
> rabbitmq user hanging around after puppet completes. I've experimented
> with adding "epmd -kill" to the Puppet scripts, and it successfully
> kills epmd on about 30% of the nodes, but it fails (exit code != 0) on
> the other 70%.

Hmm, that suggests that we should probably have the user configurable
via debconf, and then you can probably pre-seed the answers there. What
do you reckon?

Matthew

From matthew at rabbitmq.com  Mon Apr  9 14:04:41 2012
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 9 Apr 2012 14:04:41 +0100
Subject: [rabbitmq-discuss] private exchange name generation
In-Reply-To: <jlu9s5$n3c$1@dough.gmane.org>
References: <jlu9s5$n3c$1@dough.gmane.org>
Message-ID: <20120409130441.GB15896@wellquite.org>

On Mon, Apr 09, 2012 at 01:24:20PM +0400, Matwey V.  Kornilov wrote:
> I am going to use some exchange-to-exchange bindings. And I need private 
> exchange with name auto-generated. Can RabbitMQ handle this for me? or 
> should I generate exchange name by myself.

Sadly, whilst the "empty queue name" does result in creation of a new
queue with a random name (or refers to the most recently declared
queue), the "empty exchange name" refers to the "default exchange". Yay
for consistency.

You'll need to do a guid generation step in the client I'm afraid to
name the exchange.

Matthew

From matwey.kornilov at gmail.com  Mon Apr  9 16:59:25 2012
From: matwey.kornilov at gmail.com (Matwey V.  Kornilov)
Date: Mon, 09 Apr 2012 19:59:25 +0400
Subject: [rabbitmq-discuss] private exchange name generation
References: <jlu9s5$n3c$1@dough.gmane.org>
	<20120409130441.GB15896@wellquite.org>
Message-ID: <jlv10u$l4d$1@dough.gmane.org>


It is hard to avoid collisions. If I create private exchange and its names 
and arguments coincide with such of other one, then there is no way to 
detect the collision. If type or args are different then I can detect it and 
try to regenerate the name.

But the first case is critical one and can lead to hard-detectable issues. 
Just imagine, that my broker has one exchange, but my applications interpret 
it as two different private exchanges.



Matthew Sackman wrote:

> On Mon, Apr 09, 2012 at 01:24:20PM +0400, Matwey V.  Kornilov wrote:
>> I am going to use some exchange-to-exchange bindings. And I need private
>> exchange with name auto-generated. Can RabbitMQ handle this for me? or
>> should I generate exchange name by myself.
> 
> Sadly, whilst the "empty queue name" does result in creation of a new
> queue with a random name (or refers to the most recently declared
> queue), the "empty exchange name" refers to the "default exchange". Yay
> for consistency.
> 
> You'll need to do a guid generation step in the client I'm afraid to
> name the exchange.
> 
> Matthew



From tonygarnockjones+rabbitmq at gmail.com  Mon Apr  9 17:24:30 2012
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Mon, 9 Apr 2012 12:24:30 -0400
Subject: [rabbitmq-discuss] private exchange name generation
In-Reply-To: <jlv10u$l4d$1@dough.gmane.org>
References: <jlu9s5$n3c$1@dough.gmane.org>
	<20120409130441.GB15896@wellquite.org>
	<jlv10u$l4d$1@dough.gmane.org>
Message-ID: <CAM8fPiS2SWj5nQ7JnM-ejatjy1RkVPbEba-JiPFwJrmRmZSSSw@mail.gmail.com>

On 9 April 2012 11:59, Matwey V. Kornilov <matwey.kornilov at gmail.com> wrote:

> It is hard to avoid collisions. If I create private exchange and its names
> and arguments coincide with such of other one, then there is no way to
> detect the collision. If type or args are different then I can detect it
> and
> try to regenerate the name.
>

If you need crypto-strong names, then just trust in the size of your
keyspace. 160 bits is enough for anybody, right? :-)

If, on the other hand, you don't, but you can't tolerate even a level of
collision probability best described as "impossible", perhaps you could use
a Snowflake-like system:
http://engineering.twitter.com/2010/06/announcing-snowflake.html (Naturally
the implementation they're using is far too heavy for your needs, but the
core idea is sound.)

(As a third option, you might be able to cook up some scheme where you
create and bind to the exchange, and then send a "ping" message to it. If
you ever receive a ping from someone else, inform them they are colliding
with you.)

Cheers,
  Tony
-- 
Tony Garnock-Jones
tonygarnockjones at gmail.com
http://homepages.kcbbs.gen.nz/tonyg/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120409/a9b0fde1/attachment.htm>

From matthew at rabbitmq.com  Mon Apr  9 17:28:24 2012
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 9 Apr 2012 17:28:24 +0100
Subject: [rabbitmq-discuss] private exchange name generation
In-Reply-To: <jlv10u$l4d$1@dough.gmane.org>
References: <jlu9s5$n3c$1@dough.gmane.org>
	<20120409130441.GB15896@wellquite.org>
	<jlv10u$l4d$1@dough.gmane.org>
Message-ID: <20120409162823.GC15896@wellquite.org>

On Mon, Apr 09, 2012 at 07:59:25PM +0400, Matwey V.  Kornilov wrote:
> It is hard to avoid collisions. If I create private exchange and its names 
> and arguments coincide with such of other one, then there is no way to 
> detect the collision. If type or args are different then I can detect it and 
> try to regenerate the name.

Yeah, you can't actually solve that one robustly. The closest you can
get is to do a passive declare immediately before and hope it errors,
but that's a race condition anyway. Alas, tx does not capture resource
creation.

It's pretty yucky, but you could use a queue by the same name with
"exclusive" to act as a lock. Thus:

1. MyGuid = make_me_a_guid()
2. queue.declare (name = MyGuid, exclusive = true)
3. (if it hasn't errored) exchange.declare (name = MyGuid)

The reason that should work is because you can't redeclare an exclusive
queue unless you're the owner of it (i.e. you created it in the first
place). Thus on collision, you'll fail at step 2, even though step 3
would pass. Yes, it's yucky and a waste of resources, but it's the best
I can think of. Don't delete the queue until after you've deleted the
exchange.

Matthew

From matwey.kornilov at gmail.com  Mon Apr  9 17:30:54 2012
From: matwey.kornilov at gmail.com (Matwey V.  Kornilov)
Date: Mon, 09 Apr 2012 20:30:54 +0400
Subject: [rabbitmq-discuss] private exchange name generation
References: <jlu9s5$n3c$1@dough.gmane.org>
	<20120409130441.GB15896@wellquite.org>
	<jlv10u$l4d$1@dough.gmane.org>
	<CAM8fPiS2SWj5nQ7JnM-ejatjy1RkVPbEba-JiPFwJrmRmZSSSw@mail.gmail.com>
Message-ID: <jlv2rv$46v$1@dough.gmane.org>


When amp.gen-xxxx names are generated inside rabbitmq, are there any 
collision-checks?


Tony Garnock-Jones wrote:

> On 9 April 2012 11:59, Matwey V. Kornilov
> <matwey.kornilov at gmail.com> wrote:
> 
>> It is hard to avoid collisions. If I create private exchange and its
>> names and arguments coincide with such of other one, then there is no way
>> to detect the collision. If type or args are different then I can detect
>> it and
>> try to regenerate the name.
>>
> 
> If you need crypto-strong names, then just trust in the size of your
> keyspace. 160 bits is enough for anybody, right? :-)




From matthew at rabbitmq.com  Mon Apr  9 17:33:20 2012
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 9 Apr 2012 17:33:20 +0100
Subject: [rabbitmq-discuss] private exchange name generation
In-Reply-To: <jlv2rv$46v$1@dough.gmane.org>
References: <jlu9s5$n3c$1@dough.gmane.org>
	<20120409130441.GB15896@wellquite.org>
	<jlv10u$l4d$1@dough.gmane.org>
	<CAM8fPiS2SWj5nQ7JnM-ejatjy1RkVPbEba-JiPFwJrmRmZSSSw@mail.gmail.com>
	<jlv2rv$46v$1@dough.gmane.org>
Message-ID: <20120409163319.GD15896@wellquite.org>

On Mon, Apr 09, 2012 at 08:30:54PM +0400, Matwey V.  Kornilov wrote:
> When amp.gen-xxxx names are generated inside rabbitmq, are there any 
> collision-checks?

Nope.

Matthew

From matwey.kornilov at gmail.com  Mon Apr  9 20:08:12 2012
From: matwey.kornilov at gmail.com (Matwey V.  Kornilov)
Date: Mon, 09 Apr 2012 23:08:12 +0400
Subject: [rabbitmq-discuss] pub/sub and disconnections handling
References: <jl4j09$4u4$1@dough.gmane.org>
	<CAM8fPiQ224jDaQAsdVtptk2SRYzB-Bmie20kx4jew8Q1dKF+kQ@mail.gmail.com>
Message-ID: <jlvc2t$7qn$1@dough.gmane.org>


That is great, but it seems that presence-exchange uses 
rabbit_router:deliver/2 which is absent in rabbitmq 2.8.1.


I am getting following:

=WARNING REPORT==== 9-Apr-2012::23:03:40 ===
Non-AMQP exit reason '{undef,
                       [{rabbit_router,deliver,
                         [[],
                          {delivery,false,false,<0.12160.0>,
                           {basic_message,
                            {resource,<<"/">>,exchange,


Tony Garnock-Jones wrote:

> Hi Matwey,
> 
> That's right. Publishers can sometimes learn about subscribers being
> missing (see the "immediate" and "mandatory" flags to Basic.Publish), but
> subscribers can in general not learn whether any matching publisher exists
> at any given time.
> 
> One workaround might be to use something like my experimental
> presence-exchange:
> 
>    - https://github.com/tonyg/presence-exchange
>    -
>    https://groups.google.com/forum/#!msg/rabbitmq-
discuss/8BNgJ794840/VuNx-QiquKQJ




From matwey.kornilov at gmail.com  Mon Apr  9 20:28:50 2012
From: matwey.kornilov at gmail.com (Matwey V.  Kornilov)
Date: Mon, 09 Apr 2012 23:28:50 +0400
Subject: [rabbitmq-discuss] pub/sub and disconnections handling
References: <jl4j09$4u4$1@dough.gmane.org>
	<CAM8fPiQ224jDaQAsdVtptk2SRYzB-Bmie20kx4jew8Q1dKF+kQ@mail.gmail.com>
	<jlvc2t$7qn$1@dough.gmane.org>
Message-ID: <jlvd9j$l8t$1@dough.gmane.org>


I think this is because of it:

http://hg.rabbitmq.com/rabbitmq-server/rev/c0f389e4dd94


rabbit_amqqueue instead of rabbit_router works for me.



From sam at eventful.com  Tue Apr 10 00:48:29 2012
From: sam at eventful.com (Sam Choukri)
Date: Mon, 9 Apr 2012 16:48:29 -0700
Subject: [rabbitmq-discuss] Viewing more than 500 queues in RabbitMQ
	Management?
Message-ID: <38FDEAB6-51E7-488B-94C5-267F96E3C092@eventful.com>

We have more than 500 queues in one of our rabbitmq vhosts. However, the RabbitMQ Web Management plugin only shows a max of 500 queues with no ability to view the remaining queues. Is it possible to configure the plugin to show more queues (or all queues)?

I'm running RabbitMQ version 2.8.1.

Thanks,

-Sam Choukri



From matti.linnanvuori at portalify.com  Tue Apr 10 06:22:59 2012
From: matti.linnanvuori at portalify.com (Matti Linnanvuori)
Date: Tue, 10 Apr 2012 08:22:59 +0300
Subject: [rabbitmq-discuss] librabbitmq faults
In-Reply-To: <CAAt2poJM7M-VivLy=_SyOODoevwm5Lt_7OzCEcCgJnEfwOdrSQ@mail.gmail.com>
References: <BAD9CCAC-6116-4CE6-AE09-088CD6386592@portalify.com>
	<CAAt2poJxUX19CoZC6DJq7gtSzs+VTfzmhKzDTWG+Wd04zXYwcw@mail.gmail.com>
	<3B34C005-3EE0-486D-943E-0EE2D62D1C9E@portalify.com>
	<CAAt2poJM7M-VivLy=_SyOODoevwm5Lt_7OzCEcCgJnEfwOdrSQ@mail.gmail.com>
Message-ID: <9AC3D510-4466-4BF9-A787-ABD183DA4F7A@portalify.com>

Hi!

Yes, I did build Net::RabbitMQ with that version of rabbitmq-c and it ran the script below without crashing.

On Apr 5, 2012, at 9:18 PM, Alan Antonuk wrote:

> What do you mean by it doesn't segfault with rabbitmq-c-fb6fca832fd2 ?  Did you build Net::RabbitMQ with that version of rabbitmq-c and it ran the script below without crashing?
> 
> -Alan
> 
> On Wed, Apr 4, 2012 at 3:12 AM, Matti Linnanvuori <matti.linnanvuori at portalify.com> wrote:
> Hi!
> 
> I wonder how it is possible to have recv hang if RabbitMQ server has disconnected. Maybe RabbitMQ server has a bug that it does not disconnect a socket.
> 
> I am afraid I don't have a succinct example that can reproduce this segfault. It occurred with Net::RabbitMQ versions 0.2.0 and 0.2.2, but not with rabbitmq-c-fb6fca832fd2.
> 
> I reported the segmentation fault in CPAN:
> https://rt.cpan.org/Public/Bug/Display.html?id=76205
> 
> I got the segmentation fault in subroutine get. I think it is because memory allocation failed.
> I have Net::RabbitMQ version 0.2.2. I got a similar bug in Net::RabbitMQ version 0.2.0, too:https://rt.cpan.org/Public/Bug/Display.html?id=76156
> This is perl, v5.10.0 built for x86_64-linux-thread-multi
> Linux pmc-inst-test 2.6.32.12-0.7-default #1 SMP 2010-05-20 11:14:20 +0200 x86_64 x86_64 x86_64 GNU/Linux
> 
> Program received signal SIGSEGV, Segmentation fault.
> 0x00007ffff724fa41 in memcpy () from /lib64/libc.so.6
> (gdb) bt
> #0 0x00007ffff724fa41 in memcpy () from /lib64/libc.so.6
> #1 0x00007ffff6db2c0d in amqp_handle_input (state=0x7bc8a0,
> received_data=..., decoded_frame=0x7fffffffe2c0)
> at /usr/include/bits/string3.h:52
> #2 0x00007ffff6dbbeec in wait_frame_inner (state=0x7bc8a0,
> decoded_frame=0x7fffffffe2c0) at amqp_socket.c:167
> #3 0x00007ffff6dbc489 in amqp_simple_rpc (state=0x7bc8a0, channel=3,
> request_id=, expected_reply_ids=0x7fffffffe3a0,
> decoded_request_method=) at amqp_socket.c:283
> #4 0x00007ffff6db156c in amqp_basic_get (state=0x7bc8a0, channel=7,
> queue=..., no_ack=1) at amqp_api.c:258
> #5 0x00007ffff6da7432 in XS_Net__RabbitMQ_get (my_perl=,
> cv=) at RabbitMQ.xs:618
> #6 0x000000000047e115 in Perl_pp_entersub ()
> #7 0x0000000000455ad3 in Perl_runops_debug ()
> #8 0x000000000047a005 in perl_run ()
> #9 0x000000000042172c in main ()
> (gdb)
> 
> #!/usr/bin/perl -w
> 
> =pod
> 
> =head1 sds2sds_sf_fault.t
> 
>  Test 1: publish a Dispatch JSON message with ack_level and valid_until
>  - from SDS to SDS in exchange.pmc.router-in.
>  Try to receive a message from exchange.pmc.router-in in 8 seconds.
>  Test 1 expected result: a message is received from exchange.pmc.router-in in 8 seconds.
>  Test 2: decode the message as JSON.
>  Test 2 expected result: the message is decoded as JSON.
>  Test 3: check that the sender field is the same as in the sent message.
>  Test 3 expected result: the sender field is the same as in the sent message.
>  Test 4: check the body of the received message and the sent one.
>  Test 4 expected result: the body fields are the same.
>  Test 5: check the timestamp field.
>  Test 5 expected result: the timestamp field is the same as in the published message.
>  Test 6: try to receive a message from exchange.pmc.sf-in in 8 seconds.
>  Test 6 expected result: a message is received from exchange.pmc.sf-in in 8 seconds.
>  Test 7: decode the message as JSON.
>  Test 7 expected result: the message is decoded as JSON.
>  Test 8: check that the sender field is "exchange.pmc.router-in".
>  Test 8 expected result: the sender field is "exchange.pmc.router-in".
>  Test 9: check the body of the received message and the sent one.
>  Test 9 expected result: the body fields are the same.
>  Test 10: check that the timestamp in an integer.
>  Test 10 expected result: the timestamp in an integer.
>  Test 11: check that the timestamp is greater than or equal to that of before publishing.
>  Test 11 expected result: the timestamp is greater than or equal to that of before publishing.
>  Test 12: check that the timestamp is less than or equal to that of now.
>  Test 12 expected result: the timestamp is less than or equal to that of now.
>  Test 13: try to receive a message from exchange.pmc.router-in in 8 seconds.
>  Test 13 expected result: a message is received from exchange.pmc.router-in in 8 seconds.
>  Test 14: decode the message as JSON.
>  Test 14 expected result: the message is decoded as JSON.
>  Test 15: check that the sender field is "exchange.pmc.sf-in".
>  Test 15 expected result: the sender field is "exchange.pmc.sf-in".
>  Test 16: check the body of the received message and the sent one.
>  Test 16 expected result: the body fields are the same.
>  Test 17: check that the timestamp in an integer.
>  Test 17 expected result: the timestamp in an integer.
>  Test 18: check that the timestamp is greater than or equal to that of before publishing.
>  Test 18 expected result: the timestamp is greater than or equal to that of before publishing.
>  Test 19: check that the timestamp is less than or equal to that of now.
>  Test 19 expected result: the timestamp is less than or equal to that of now.
>  Test 20: try to receive a message from exchange.pmc.router-in in 8 seconds.
>  Test 20 expected result: a message is received from exchange.pmc.router-in in 8 seconds.
>  Test 21: decode the message as JSON.
>  Test 21 expected result: the message is decoded as JSON.
>  Test 22: check that the sender field is "exchange.pmc.sf-in".
>  Test 22 expected result: the sender field is "exchange.pmc.sf-in".
>  Test 23: check that the timestamp in an integer.
>  Test 23 expected result: the timestamp in an integer.
>  Test 24: check that the timestamp is greater than or equal to that of before publishing.
>  Test 24 expected result: the timestamp is greater than or equal to that of before publishing.
>  Test 25: check that the timestamp is less than or equal to that of now.
>  Test 25 expected result: the timestamp is less than or equal to that of now.
>  Test 26: check that the id fields of the received and the published messages are the same.
>  Test 26 expected result: the id fields of the received and the published messages are the same.
>  Test 27: check that the ack_type field has value "processed".
>  Test 27 expected result: the ack_type field has value "processed".
>  Test 28: check that the from field of the received message is the same as
>  the to field of the published message.
>  Test 28 expected result: the from field of the received message is the same as
>  the to field of the published message.
>  Test 29: check that the type field has value "ack".
>  Test 29 expected result: the type field has value "ack".
>  Test 30: check that the version field has value 1.
>  Test 30 expected result: the version field has value 1.
>  Test 31: try to receive a message from exchange.pmc.cassidian-in in 8 seconds.
>  Test 31 expected result: a message is received from exchange.pmc.cassidian-in in 8 seconds.
>  Test 32: decode the message as JSON.
>  Test 32 expected result: the message is decoded as JSON.
>  Test 33: check that the sender field is "exchange.pmc.router-in".
>  Test 33 expected result: the sender field is "exchange.pmc.router-in".
>  Test 34: check the body of the received message and the sent one.
>  Test 34 expected result: the body fields are the same.
>  Test 35: check that the timestamp in an integer.
>  Test 35 expected result: the timestamp in an integer.
>  Test 36: check that the timestamp is greater than or equal to that of before publishing.
>  Test 36 expected result: the timestamp is greater than or equal to that of before publishing.
>  Test 37: check that the timestamp is less than or equal to that of now.
>  Test 37 expected result: the timestamp is less than or equal to that of now.
>  Test 38: try to receive a message from exchange.pmc.cassidian-in in 8 seconds.
>  Test 38 expected result: a message is received from exchange.pmc.cassidian-in in 8 seconds.
>  Test 39: decode the message as JSON.
>  Test 39 expected result: the message is decoded as JSON.
>  Test 40: check that the sender field is "exchange.pmc.router-in".
>  Test 40 expected result: the sender field is "exchange.pmc.router-in".
>  Test 41: check that the timestamp in an integer.
>  Test 41 expected result: the timestamp in an integer.
>  Test 42: check that the timestamp is greater than or equal to that of before publishing.
>  Test 42 expected result: the timestamp is greater than or equal to that of before publishing.
>  Test 43: check that the timestamp is less than or equal to that of now.
>  Test 43 expected result: the timestamp is less than or equal to that of now.
>  Test 44: check that the id fields of the received and the published messages are the same.
>  Test 44 expected result: the id fields of the received and the published messages are the same.
>  Test 45: check that the ack_type field has value "processed".
>  Test 45 expected result: the ack_type field has value "processed".
>  Test 46: check that the from field of the received message is the same as
>  the to field of the published message.
>  Test 46 expected result: the from field of the received message is the same as
>  the to field of the published message.
>  Test 47: check that the type field has value "ack".
>  Test 47 expected result: the type field has value "ack".
>  Test 48: check that the version field has value 1.
>  Test 48 expected result: the version field has value 1.
>  Test 49: publish an Ack sent message from the SSI in exchange.pmc.router-in.
>  try to receive a message from exchange.pmc.router-in in 8 seconds.
>  Test 49 expected result: a message is received from exchange.pmc.router-in in 8 seconds.
>  Test 50: decode the message as JSON.
>  Test 50 expected result: the message is decoded as JSON.
>  Test 51: check that the timestamp of the received message is the same as that of published one.
>  Test 51 expected result:
>  the timestamp of the received message is the same as that of published one.
>  Test 52: check the sender field of the received message.
>  Test 52 expected result:
>  the sender field of the received message has value "exchange.pmc.cassidian-in".
>  Test 53: check the body fields of the received and the published messages.
>  Test 53 expected result:
>  the body fields of the received and the published messages are the same.
>  Test 54: try to receive a message from exchange.pmc.sf-in in 8 seconds.
>  Test 54 expected result: a message is received from exchange.pmc.sf-in in 8 seconds.
>  Test 55: decode the message as JSON.
>  Test 55 expected result: the message is decoded as JSON.
>  Test 56: check the sender field of the received message.
>  Test 56 expected result:
>  the sender field of the received message has value "exchange.pmc.router-in".
>  Test 57: check the body fields of the received and the published messages.
>  Test 57 expected result:
>  the body fields of the received and the published messages are the same.
>  Test 58: check that the timestamp in an integer.
>  Test 58 expected result: the timestamp in an integer.
>  Test 59: check that the timestamp is greater than or equal to that of before publishing.
>  Test 59 expected result: the timestamp is greater than or equal to that of before publishing.
>  Test 60: check that the timestamp is less than or equal to that of now.
>  Test 60 expected result: the timestamp is less than or equal to that of now.
>  Test 61: try to receive a message from exchange.pmc.router-in in 8 seconds.
>  Test 61 expected result: a message is received from exchange.pmc.router-in in 8 seconds.
>  Test 62: decode the message as JSON.
>  Test 62 expected result: the message is decoded as JSON.
>  Test 63: check the sender field of the received message.
>  Test 63 expected result:
>  the sender field of the received message has value "exchange.pmc.sf-in".
>  Test 64: check the body fields of the received and the published messages.
>  Test 64 expected result:
>  the body fields of the received and the published messages are the same.
>  Test 65: check that the timestamp in an integer.
>  Test 65 expected result: the timestamp in an integer.
>  Test 66: check that the timestamp is greater than or equal to that of before publishing.
>  Test 66 expected result: the timestamp is greater than or equal to that of before publishing.
>  Test 67: check that the timestamp is less than or equal to that of now.
>  Test 67 expected result: the timestamp is less than or equal to that of now.
>  Test 68: try to receive a message from exchange.pmc.cassidian-in in 8 seconds.
>  Test 68 expected result: a message is received from exchange.pmc.cassidian-in in 8 seconds.
>  Test 69: decode the message as JSON.
>  Test 69 expected result: the message is decoded as JSON.
>  Test 70: check the sender field of the received message.
>  Test 70 expected result:
>  the sender field of the received message has value "exchange.pmc.router-in".
>  Test 71: check the body fields of the received and the published messages.
>  Test 71 expected result:
>  the body fields of the received and the published messages are the same.
>  Test 72: check that the timestamp in an integer.
>  Test 72 expected result: the timestamp in an integer.
>  Test 73: check that the timestamp is greater than or equal to that of before publishing.
>  Test 73 expected result: the timestamp is greater than or equal to that of before publishing.
>  Test 74: check that the timestamp is less than or equal to that of now.
>  Test 74 expected result: the timestamp is less than or equal to that of now.
> 
> =cut
> 
> use strict;
> 
> use Net::RabbitMQ;
> use Test::More tests => 74;
> use JSON;
> use Time::HiRes qw(gettimeofday);
> 
> use constant ROUTER_EXCHANGE    => 'exchange.pmc.router-in';
> use constant ROUTER_CHANNEL     => 1;
> use constant ROUTER_QUEUE       => 'queue.test.router-in';
> use constant SF_EXCHANGE        => 'exchange.pmc.sf-in';
> use constant SF_CHANNEL         => 2;
> use constant SF_QUEUE           => 'queue.test.sf-in';
> use constant CASSIDIAN_EXCHANGE => 'exchange.pmc.cassidian-in';
> use constant CASSIDIAN_CHANNEL  => 3;
> use constant CASSIDIAN_QUEUE    => 'queue.test.cassidian-in';
> 
> sub timestamp {
>    return int( gettimeofday() * 1000 );
> }
> 
> system(
> 'service pmc-smpp stop >&2; service pmc-cassidian stop >&2; service pmc-email stop >&2; service pmc-sf stop >&2; service pmc-routing stop >&2'
> );
> 
> sleep 1;    # Wait for the message-sending to stop.
> 
> system(
>    'rabbitmqctl stop_app; rabbitmqctl reset; rabbitmqctl start_app; mongo <<END
> use database
> db.dropDatabase();
> END'
> );
> 
> system('service pmc-sf start >&2; service pmc-routing start >&2');
> 
> sleep 8;    # Wait for Store & Forward and Routing to start.
> 
> my $json_text = '{
> "timestamp" : 1330327514213,
> "sender" : "' . CASSIDIAN_EXCHANGE . '",
> "body" : {
> "type" : "dispatch",
> "version" : 1,
> "id" : "8f970b1b-f8a3-4c78-aa24-3b8e2205648788",
> "from" : {
> "type" : "ssi",
> "address" : "16777215"
> },
> "to" : {
> "type" : "ssi",
> "address" : "0"
> },
> "body" : "This is a test message.",
> "ack_level" : "sent",
> "valid_until" : 9223372036854775807,
> "auxiliary" : {
> "timestamp" : 1325376000000,
> "sdstl" : {
> "protocol_id" : 130,
> "message_reference" : 42,
> "short_report_allowed" : true,
> "protocol_data" : {
> "encoding" : 0,
> "timestamp" : {
> "month" : 1,
> "day" : 1,
> "hour" : 0,
> "minute" : 0
> }
> }
> }
> }
> }
> }';
> 
> my $mq_router = Net::RabbitMQ->new();
> $mq_router->connect( "localhost", { user => "guest", password => "guest" } );
> $mq_router->channel_open(ROUTER_CHANNEL);
> $mq_router->queue_declare(
>    ROUTER_CHANNEL,
>    ROUTER_QUEUE,
>    {
>        passive     => 0,
>        durable     => 1,
>        exclusive   => 0,
>        auto_delete => 0
>    }
> );
> $mq_router->queue_bind( ROUTER_CHANNEL, ROUTER_QUEUE, ROUTER_EXCHANGE, '' );
> $mq_router->purge( ROUTER_CHANNEL, ROUTER_QUEUE );
> $mq_router->consume( ROUTER_CHANNEL, ROUTER_QUEUE );
> 
> my $mq_sf = Net::RabbitMQ->new();
> $mq_sf->connect( "localhost", { user => "guest", password => "guest" } );
> $mq_sf->channel_open(SF_CHANNEL);
> $mq_sf->exchange_declare(
>    SF_CHANNEL,
>    SF_EXCHANGE,
>    {
>        exchange_type => 'direct',
>        passive       => 0,
>        durable       => 1,
>        auto_delete   => 0
>    }
> );
> $mq_sf->queue_declare(
>    SF_CHANNEL,
>    SF_QUEUE,
>    {
>        passive     => 0,
>        durable     => 1,
>        exclusive   => 0,
>        auto_delete => 0
>    }
> );
> $mq_sf->queue_bind( SF_CHANNEL, SF_QUEUE, SF_EXCHANGE, '' );
> $mq_sf->purge( SF_CHANNEL, SF_QUEUE );
> $mq_sf->consume( SF_CHANNEL, SF_QUEUE );
> 
> my $mq_cassidian = Net::RabbitMQ->new();
> $mq_cassidian->connect( "localhost", { user => "guest", password => "guest" } );
> $mq_cassidian->channel_open(CASSIDIAN_CHANNEL);
> $mq_cassidian->exchange_declare(
>    CASSIDIAN_CHANNEL,
>    CASSIDIAN_EXCHANGE,
>    {
>        exchange_type => 'direct',
>        passive       => 0,
>        durable       => 1,
>        auto_delete   => 0
>    }
> );
> $mq_cassidian->queue_declare(
>    CASSIDIAN_CHANNEL,
>    CASSIDIAN_QUEUE,
>    {
>        passive     => 0,
>        durable     => 1,
>        exclusive   => 0,
>        auto_delete => 0
>    }
> );
> $mq_cassidian->queue_bind( CASSIDIAN_CHANNEL, CASSIDIAN_QUEUE,
>    CASSIDIAN_EXCHANGE, '' );
> $mq_cassidian->purge( CASSIDIAN_CHANNEL, CASSIDIAN_QUEUE );
> $mq_cassidian->consume( CASSIDIAN_CHANNEL, CASSIDIAN_QUEUE );
> 
> my $before = timestamp();
> 
> $mq_router->publish(
>    ROUTER_CHANNEL,
>    '',
>    $json_text,
>    {
> 
>        # Options
>        exchange => ROUTER_EXCHANGE
>    },
>    {
> 
>        # Props
>        content_encoding => "UTF-8",
>        content_type     => "application/json"
>    }
> );
> 
> my $sent = decode_json($json_text);
> my $message;
> eval {
>    local $SIG{ALRM} = sub { die "Timeout\n" };
>    alarm 8;
>    $message = $mq_router->recv();
>    alarm 0;
> };
> is( $@, '', 'A message was received from queue' );
> my $json;
> eval { $json = decode_json( $message->{'body'} ); };
> is( $@, '', 'A JSON message received' );
> is( $json->{'sender'}, $sent->{'sender'}, 'sender ' . $sent->{'sender'} );
> is_deeply( $json->{'body'}, $sent->{'body'}, 'body the same' );
> is( $json->{'timestamp'}, $sent->{'timestamp'},
>    "timestamp " . $sent->{'timestamp'} );
> 
> undef $message;
> eval {
>    local $SIG{ALRM} = sub { die "Timeout\n" };
>    alarm 8;
>    $message = $mq_sf->recv();
>    alarm 0;
> };
> is( $@, '', 'A message was received' );
> undef $json;
> eval { $json = decode_json( $message->{'body'} ); };
> is( $@, '', 'A JSON message received' );
> is( $json->{'sender'}, ROUTER_EXCHANGE, 'sender ' . ROUTER_EXCHANGE );
> is_deeply( $json->{'body'}, $sent->{'body'}, 'body the same' );
> like( $json->{'timestamp'}, qr/^\d+$/, "timestamp an integer" );
> ok( $json->{'timestamp'} >= $before,
>    'timestamp greater than or equal to that of before publishing' )
>  or diag("$json->{'timestamp'} < $before");
> my $now = timestamp();
> ok( $json->{'timestamp'} <= $now,
>    'timestamp less than or equal to that of now' )
>  or diag("$json->{'timestamp'} > $now");
> 
> undef $message;
> eval {
>    local $SIG{ALRM} = sub { die "Timeout\n" };
>    alarm 8;
>    $message = $mq_router->recv();
>    alarm 0;
> };
> is( $@, '', 'A message was received' );
> undef $json;
> eval { $json = decode_json( $message->{'body'} ); };
> is( $@,                '',          'A JSON message received' );
> is( $json->{'sender'}, SF_EXCHANGE, 'sender ' . SF_EXCHANGE );
> is_deeply( $json->{'body'}, $sent->{'body'}, 'body the same' );
> like( $json->{'timestamp'}, qr/^\d+$/, "timestamp an integer" );
> ok( $json->{'timestamp'} >= $before,
>    'timestamp greater than or equal to that of before publishing' )
>  or diag("$json->{'timestamp'} < $before");
> $now = timestamp();
> ok( $json->{'timestamp'} <= $now,
>    'timestamp less than or equal to that of now' )
>  or diag("$json->{'timestamp'} > $now");
> 
> undef $message;
> eval {
>    local $SIG{ALRM} = sub { die "Timeout\n" };
>    alarm 8;
>    $message = $mq_router->recv();
>    alarm 0;
> };
> is( $@, '', 'A message was received' );
> undef $json;
> eval { $json = decode_json( $message->{'body'} ); };
> is( $@,                '',          'A JSON message received' );
> is( $json->{'sender'}, SF_EXCHANGE, 'sender ' . SF_EXCHANGE );
> like( $json->{'timestamp'}, qr/^\d+$/, "timestamp an integer" );
> ok( $json->{'timestamp'} >= $before,
>    'timestamp greater than or equal to that of before publishing' )
>  or diag("$json->{'timestamp'} < $before");
> $now = timestamp();
> ok( $json->{'timestamp'} <= $now,
>    'timestamp less than or equal to that of now' )
>  or diag("$json->{'timestamp'} > $now");
> is( $json->{'body'}->{'id'}, $sent->{'body'}->{'id'}, 'id the same' );
> is( $json->{'body'}->{'ack_type'}, 'processed', 'ack_type processed' );
> is_deeply(
>    $json->{'body'}->{'from'},
>    $sent->{'body'}->{'to'},
>    'from is the same as to of sent'
> );
> is( $json->{'body'}->{'type'},    'ack', 'type is ack' );
> is( $json->{'body'}->{'version'}, 1,     'version is 1' );
> 
> my $end = time() + 8;
> undef $message;
> do {
>    eval {
>        $message = $mq_cassidian->get( CASSIDIAN_CHANNEL, CASSIDIAN_QUEUE );
>    };
>    if ($@) {
>        diag($@);
>    }
> } until ( defined $message or time() > $end or $@ );
> ok( defined $message, 'A message was received' );
> undef $json;
> eval { $json = decode_json( $message->{'body'} ); };
> is( $@, '', 'A JSON message received' );
> is( $json->{'sender'}, ROUTER_EXCHANGE, 'sender ' . ROUTER_EXCHANGE );
> is_deeply( $json->{'body'}, $sent->{'body'}, 'body the same' );
> like( $json->{'timestamp'}, qr/^\d+$/, "timestamp an integer" );
> ok( $json->{'timestamp'} >= $before,
>    'timestamp greater than or equal to that of before publishing' )
>  or diag("$json->{'timestamp'} < $before");
> $now = timestamp();
> ok( $json->{'timestamp'} <= $now,
>    'timestamp less than or equal to that of now' )
>  or diag("$json->{'timestamp'} > $now");
> 
> $end = time() + 8;
> note("Trying to receive an Ack from Cassidian exchange");
> undef $message;
> do {
>    eval {
>        $message = $mq_cassidian->get( CASSIDIAN_CHANNEL, CASSIDIAN_QUEUE );
>    };
>    if ($@) {
>        diag($@);
>    }
> } until ( defined $message or time() > $end or $@ );
> ok( defined $message, 'A message was received' );
> undef $json;
> eval { $json = decode_json( $message->{'body'} ); };
> is( $@, '', 'A JSON message received' );
> is( $json->{'sender'}, ROUTER_EXCHANGE, 'sender ' . ROUTER_EXCHANGE );
> like( $json->{'timestamp'}, qr/^\d+$/, "timestamp an integer" );
> ok( $json->{'timestamp'} >= $before,
>    'timestamp greater than or equal to that of before publishing' )
>  or diag("$json->{'timestamp'} < $before");
> $now = timestamp();
> ok( $json->{'timestamp'} <= $now,
>    'timestamp less than or equal to that of now' )
>  or diag("$json->{'timestamp'} > $now");
> is( $json->{'body'}->{'id'}, $sent->{'body'}->{'id'}, 'id the same' );
> is( $json->{'body'}->{'ack_type'}, 'processed', 'ack_type processed' );
> is_deeply(
>    $json->{'body'}->{'from'},
>    $sent->{'body'}->{'to'},
>    'from is the same as to of sent'
> );
> is( $json->{'body'}->{'type'},    'ack', 'type is ack' );
> is( $json->{'body'}->{'version'}, 1,     'version is 1' );
> 
> my $ack = '{
> "timestamp" : 1328020064358,
> "sender" : "' . CASSIDIAN_EXCHANGE . '",
> "body" : {
> "type" : "ack",
> "version" : 1,
> "id" : "8f970b1b-f8a3-4c78-aa24-3b8e2205648788",
> "from" : {
> "type" : "ssi",
> "address" : "0"
> },
> "ack_type" : "sent",
> "auxiliary" : {
> "timestamp" : 1325376000000,
> "original_message" : ' . encode_json( $sent->{'body'} ) . ',
> "sdstl" : {
> "protocol_id" : 130,
> "message_reference" : 42,
> "short_report_allowed" : true,
> "protocol_data" : {
> "encoding" : 0,
> "timestamp" : {
> "month" : 1,
> "day" : 1,
> "hour" : 0,
> "minute" : 0
> }
> }
> }
> }
> }
> }';
> $sent   = decode_json($ack);
> $before = timestamp();
> 
> $mq_router->publish(
>    ROUTER_CHANNEL,
>    '', $ack,
>    {
> 
>        # Options
>        exchange => ROUTER_EXCHANGE
>    },
>    {
> 
>        # Props
>        content_encoding => "UTF-8",
>        content_type     => "application/json"
>    }
> );
> 
> undef $message;
> eval {
>    local $SIG{ALRM} = sub { die "Timeout\n" };
>    alarm 8;
>    $message = $mq_router->recv();
>    alarm 0;
> };
> is( $@, '', 'A message was received' );
> undef $json;
> eval { $json = decode_json( $message->{'body'} ); };
> is( $@, '', 'A JSON message received' );
> is( $json->{'timestamp'}, $sent->{'timestamp'},
>    'timestamp ' . $sent->{'timestamp'} )
>  or diag( $message->{'body'} );
> is( $json->{'sender'}, CASSIDIAN_EXCHANGE, 'sender ' . CASSIDIAN_EXCHANGE )
>  or diag( $message->{'body'} );
> is_deeply( $json->{'body'}, $sent->{'body'}, 'body the same' )
>  or diag( $message->{'body'} );
> 
> undef $message;
> eval {
>    local $SIG{ALRM} = sub { die "Timeout\n" };
>    alarm 8;
>    $message = $mq_sf->recv();
>    alarm 0;
> };
> is( $@, '', 'A message was received' );
> undef $json;
> eval { $json = decode_json( $message->{'body'} ); };
> is( $@, '', 'A JSON message received' );
> is( $json->{'sender'}, ROUTER_EXCHANGE, 'sender ' . ROUTER_EXCHANGE );
> is_deeply( $json->{'body'}, $sent->{'body'}, 'body the same' );
> like( $json->{'timestamp'}, qr/^\d+$/, "timestamp an integer" );
> ok( $json->{'timestamp'} >= $before,
>    'timestamp greater than or equal to that of before publishing' )
>  or diag("$json->{'timestamp'} < $before");
> $now = timestamp();
> ok( $json->{'timestamp'} <= $now,
>    'timestamp less than or equal to that of now' )
>  or diag("$json->{'timestamp'} > $now");
> 
> undef $message;
> eval {
>    local $SIG{ALRM} = sub { die "Timeout\n" };
>    alarm 8;
>    $message = $mq_router->recv();
>    alarm 0;
> };
> is( $@, '', 'A message was received' );
> undef $json;
> eval { $json = decode_json( $message->{'body'} ); };
> is( $@,                '',          'A JSON message received' );
> is( $json->{'sender'}, SF_EXCHANGE, 'sender ' . SF_EXCHANGE );
> is_deeply( $json->{'body'}, $sent->{'body'}, 'body the same' );
> like( $json->{'timestamp'}, qr/^\d+$/, "timestamp an integer" );
> ok( $json->{'timestamp'} >= $before,
>    'timestamp greater than or equal to that of before publishing' )
>  or diag("$json->{'timestamp'} < $before");
> $now = timestamp();
> ok( $json->{'timestamp'} <= $now,
>    'timestamp less than or equal to that of now' )
>  or diag("$json->{'timestamp'} > $now");
> 
> undef $message;
> eval {
>    local $SIG{ALRM} = sub { die "Timeout\n" };
>    alarm 8;
>    $message = $mq_cassidian->recv();
>    alarm 0;
> };
> is( $@, '', 'A message was received' );
> undef $json;
> eval { $json = decode_json( $message->{'body'} ); };
> is( $@, '', 'A JSON message received' );
> is( $json->{'sender'}, ROUTER_EXCHANGE, 'sender ' . ROUTER_EXCHANGE );
> is_deeply( $json->{'body'}, $sent->{'body'}, 'body the same' );
> like( $json->{'timestamp'}, qr/^\d+$/, "timestamp an integer" );
> ok( $json->{'timestamp'} >= $before,
>    'timestamp greater than or equal to that of before publishing' )
>  or diag("$json->{'timestamp'} < $before");
> $now = timestamp();
> ok( $json->{'timestamp'} <= $now,
>    'timestamp less than or equal to that of now' )
>  or diag("$json->{'timestamp'} > $now");
> 
> END {
>    $mq_sf->queue_unbind( SF_CHANNEL, SF_QUEUE, SF_EXCHANGE, '' );
>    $mq_router->queue_unbind( ROUTER_CHANNEL, ROUTER_QUEUE, ROUTER_EXCHANGE,
>        '' );
>    $mq_cassidian->queue_unbind( CASSIDIAN_CHANNEL, CASSIDIAN_QUEUE,
>        CASSIDIAN_EXCHANGE, '' );
>    system(
> 'service pmc-smpp start >&2; service pmc-cassidian start >&2; service pmc-email start >&2'
>    );
> }
> 
> regards, Matti Linnanvuori
> 

regards, Matti Linnanvuori

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120410/57c51819/attachment.htm>

From gmlexx at gmail.com  Tue Apr 10 07:37:31 2012
From: gmlexx at gmail.com (Alexey)
Date: Mon, 9 Apr 2012 23:37:31 -0700 (PDT)
Subject: [rabbitmq-discuss] Heartbeat missing with heartbeat
Message-ID: <d3ad64c3-c3ed-4ca4-90af-572a419c3701@l7g2000vbw.googlegroups.com>

We are using the last .NET client and server version 2.8.1
After enable heartbeat we got a strange behaviour: consumer often
disconnected with the following message:
Reason: AMQP close-reason, initiated by Library, code=0, text="End of
stream", classId=0, methodId=0, cause=System.IO.EndOfStreamException:
Heartbeat missing with heartbeat == 5 seconds

Also after enable heartbeat we got the following message
Consumer 13b04f46cd014283903d9d93ee7a4029 is being shutdowned.
Reason: AMQP close-reason, initiated by Peer, code=406,
text="PRECONDITION_FAILED - unknown delivery tag 1", classId=60,
methodId=80, cause=

We are using rabbitmq cluster and some tasks is never removed from
queue, but processed with consumers again and again.

Would appreciate for any help
Alexey

From emile at rabbitmq.com  Tue Apr 10 10:35:57 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 10 Apr 2012 10:35:57 +0100
Subject: [rabbitmq-discuss] Custom error message for basic reject
In-Reply-To: <B4ECFAF2-4776-4E8B-9AD3-3D0863251DC4@gmail.com>
References: <28468197.14.1333621182209.JavaMail.geo-discussion-forums@vbuc18>
	<4F7DCF75.5030203@rabbitmq.com>
	<B4ECFAF2-4776-4E8B-9AD3-3D0863251DC4@gmail.com>
Message-ID: <4F83FEFD.9050100@rabbitmq.com>

Hi,

On 05/04/12 18:22, Nazakat Ali wrote:
> If not possible with basic reject, is it possible to refuse/not acknowledge a message with reason?

Unfortunately not. None of the relevant methods allow you to provide a
reason, or modify the message in any way:

http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.nack
http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.reject
http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.recover

The closest approximation to your requirement would be to acknowledge
the message and to republish with a header that describes the reason.


-Emile


From emile at rabbitmq.com  Tue Apr 10 11:03:57 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 10 Apr 2012 11:03:57 +0100
Subject: [rabbitmq-discuss] Heartbeat missing with heartbeat
In-Reply-To: <d3ad64c3-c3ed-4ca4-90af-572a419c3701@l7g2000vbw.googlegroups.com>
References: <d3ad64c3-c3ed-4ca4-90af-572a419c3701@l7g2000vbw.googlegroups.com>
Message-ID: <4F84058D.8070408@rabbitmq.com>

Hi Alexey,

On 10/04/12 07:37, Alexey wrote:
> Reason: AMQP close-reason, initiated by Library, code=0, text="End of
> stream", classId=0, methodId=0, cause=System.IO.EndOfStreamException:
> Heartbeat missing with heartbeat == 5 seconds

This is the expected behaviour in a situation where the network is
unreliable. If this is a regular occurrence then consider improving the
network reliability or designing the client to cope by reconnecting.

If this error occurs when the broker runs on Windows then you should
consider increasing the heartbeat parameter. It is possible that the
broker is unable to schedule the heartbeat thread with sufficient
precision when the broker is under load.

> Also after enable heartbeat we got the following message
> Consumer 13b04f46cd014283903d9d93ee7a4029 is being shutdowned.
> Reason: AMQP close-reason, initiated by Peer, code=406,
> text="PRECONDITION_FAILED - unknown delivery tag 1", classId=60,
> methodId=80, cause=

That means you attempted to acknowledge a message with an invalid
delivery tag. Delivery tags are valid only within the channel from which
the message was received. Unacknowledged messages that were received on
a channel that closed must be retrieved again to obtain a new delivery tag.


-Emile



From rcrespopanizo at gmail.com  Mon Apr  9 08:23:00 2012
From: rcrespopanizo at gmail.com (Rabbit001)
Date: Mon, 9 Apr 2012 00:23:00 -0700 (PDT)
Subject: [rabbitmq-discuss] Client connection to ssl rabbitMQ is very
 slow
In-Reply-To: <CAFPidkNoJoK5PqLoaxqntvEs+E3X3uYrabVU+rkJYsqxyL9ymA@mail.gmail.com>
References: <33544994.post@talk.nabble.com> <4F7C25DE.40703@rabbitmq.com>
	<CAFPidkNoJoK5PqLoaxqntvEs+E3X3uYrabVU+rkJYsqxyL9ymA@mail.gmail.com>
Message-ID: <33654326.post@talk.nabble.com>


Hi Carl,

I follow your instructions and I've modified rabbitmq.config and put
{ciphers,[{rsa,aes_128_cbc,sha}]}. The server starts correctly but my client
display this error,

trigger seeding of SecureRandom
done seeding SecureRandom
Allow unsafe renegotiation: false
Allow legacy hello messages: true
Is initial handshake: true
Is secure renegotiation: false
main, setSoTimeout(10000) called
%% No cached client session
*** ClientHello, TLSv1
RandomCookie:  GMT: 1317113069 bytes = { 232, 24, 48, 31, 62, 172, 47, 240,
38, 205, 140, 162, 102, 226, 22, 0, 240, 6, 93, 111, 113, 187, 44, 85, 132,
255, 0, 48 }
Session ID:  {}
Cipher Suites: [SSL_RSA_WITH_RC4_128_MD5, SSL_RSA_WITH_RC4_128_SHA,
TLS_RSA_WITH_AES_128_CBC_SHA, TLS_DHE_RSA_WITH_AES_128_CBC_SHA,
TLS_DHE_DSS_WITH_AES_128_CBC_SHA, SSL_RSA_WITH_3DES_EDE_CBC_SHA,
SSL_DHE_RSA_WITH_3DES_EDE_CBC_SHA, SSL_DHE_DSS_WITH_3DES_EDE_CBC_SHA,
SSL_RSA_WITH_DES_CBC_SHA, SSL_DHE_RSA_WITH_DES_CBC_SHA,
SSL_DHE_DSS_WITH_DES_CBC_SHA, SSL_RSA_EXPORT_WITH_RC4_40_MD5,
SSL_RSA_EXPORT_WITH_DES40_CBC_SHA, SSL_DHE_RSA_EXPORT_WITH_DES40_CBC_SHA,
SSL_DHE_DSS_EXPORT_WITH_DES40_CBC_SHA, TLS_EMPTY_RENEGOTIATION_INFO_SCSV]
Compression Methods:  { 0 }
***
main, WRITE: TLSv1 Handshake, length = 75
main, WRITE: SSLv2 client hello message, length = 101
main, waiting for close_notify or alert: state 1
main, Exception while waiting for close java.net.SocketException: Connection
reset
main, handling exception: java.net.SocketException: Connection reset
main, SEND TLSv1 ALERT:  fatal, description = unexpected_message
main, WRITE: TLSv1 Alert, length = 2
main, Exception sending alert: java.net.SocketException: Connection reset by
peer: socket write error
main, called closeSocket()
main, called close()
main, called closeInternal(true)
Exception in thread "main" java.net.SocketException: Connection reset
	at java.net.SocketInputStream.read(Unknown Source)
	at com.sun.net.ssl.internal.ssl.InputRecord.readFully(Unknown Source)
	at com.sun.net.ssl.internal.ssl.InputRecord.read(Unknown Source)
	at com.sun.net.ssl.internal.ssl.SSLSocketImpl.readRecord(Unknown Source)
	at com.sun.net.ssl.internal.ssl.SSLSocketImpl.waitForClose(Unknown Source)
	at com.sun.net.ssl.internal.ssl.HandshakeOutStream.flush(Unknown Source)
	at com.sun.net.ssl.internal.ssl.Handshaker.kickstart(Unknown Source)
	at com.sun.net.ssl.internal.ssl.SSLSocketImpl.kickstartHandshake(Unknown
Source)
	at
com.sun.net.ssl.internal.ssl.SSLSocketImpl.performInitialHandshake(Unknown
Source)
	at com.sun.net.ssl.internal.ssl.SSLSocketImpl.writeRecord(Unknown Source)
	at com.sun.net.ssl.internal.ssl.AppOutputStream.write(Unknown Source)
	at java.io.BufferedOutputStream.flushBuffer(Unknown Source)
	at java.io.BufferedOutputStream.flush(Unknown Source)
	at java.io.DataOutputStream.flush(Unknown Source)
	at
com.rabbitmq.client.impl.SocketFrameHandler.sendHeader(SocketFrameHandler.java:121)
	at
com.rabbitmq.client.impl.SocketFrameHandler.sendHeader(SocketFrameHandler.java:126)
	at com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:287)
	at
com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:516)
	at
com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:533)
	at mediapost.tests.RabbitMQSSLSample.main(RabbitMQSSLSample.java:24)

Any idea?

Best Regards,


Carl H?rberg wrote:
> 
> the DHE key exchange algorithm  is very computational intensive, so
> make sure you disable it (http://matt.io/entry/ur)
> 
> this config allows only the AES 128 chiper with RSA (and not DHE) as
> key exchange and SHA as hash algoritm (md5 is somewhat weaker but
> faster):
> 
> {ssl_options, [{cacertfile,"/etc/rabbitmq/ca.pem"},
>                     {certfile,"/etc/rabbitmq/cert.pem"},
>                     {ciphers,[{rsa,aes_128_cbc,sha}]}]}
> 
> for all options, see http://www.erlang.org/doc/man/ssl.html, as Emile
> said.
> 
> On Wed, Apr 4, 2012 at 12:43, Emile Joubert <emile at rabbitmq.com> wrote:
>> Hi,
>>
>> On 02/04/12 15:26, Rabbit001 wrote:
>>> ? I've follow the ssl configuration instructions in rabbitmq page
>>> 'www.rabbitmq.com/ssl.html' to configure ssl access to rabbitmq server.
>>> I've
>>> started rabbitmq server correctly and I've executed the example1 (sample
>>> code for ssl java client) and the result is good, but the method
>>> factory.newConnection() finish over 5sg. In the other hand, without ssl
>>> ?the
>>> method factory.newConnection() finish in <200 ms.
>>>
>>> ? How do i increasse the performance in the first scenario (ssl
>>> configuration)? any idea?
>>
>> If your broker CPU has hardware support for certain ciphers and OpenSSL
>> can make use of it then try to restrict the SSL connection to those
>> ciphers, or to prioritise them. The "ciphers" SSL configuration option
>> in the broker is one way of achieving that. For configuration details
>> see http://www.erlang.org/doc/man/ssl.html
>>
>> You might also gain some useful insight by using an SSL traffic analyser
>> such as "ssldump". If long gaps appear in the timeline then the output
>> may help you to determine what is responsible for the delay.
>>
>> Do other SSL clients also take long to connect? Try using the "openssl
>> s_client" option as described here:
>> http://www.rabbitmq.com/troubleshooting-ssl.html
>> and check whether such connections also take long.
>>
>> Does the Java client take long to connect when the SSL layer is provided
>> by a different SSL service? You can try this by connecting to the broker
>> via stunnel, socat or similar.
>>
>> The last two questions may help you to focus on whether the problem lies
>> on the client or server side.
>>
>>
>> -Emile
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://old.nabble.com/Client-connection-to-ssl-rabbitMQ-is-very-slow-tp33544994p33654326.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From francois.beausoleil at gmail.com  Mon Apr  9 14:17:59 2012
From: francois.beausoleil at gmail.com (=?ISO-8859-1?Q?Fran=E7ois_Beausoleil?=)
Date: Mon, 9 Apr 2012 06:17:59 -0700 (PDT)
Subject: [rabbitmq-discuss] How to plan for RAM?
Message-ID: <fc5397f1-1f38-4cee-8075-0ff96f3685ca@j15g2000vbt.googlegroups.com>

Hi all!

I'm trying to determine how much RAM I need for my 2 node cluster. I
use VMs at Rackspace.

I currently have 2x 4 GiB RAM nodes, but I consistently hit my VM high
memory watermark. I have one topic exchange, with about 8 queues. The
routing keys are all left-anchored: my queues all use routing keys of
the form "a.#" or even "#". During normal operation, I generate
between 5 and 20 messages per second, and at peak, more than 2000. I
have 2 queues which use a routing key of the form "#", and I spread
the load so I have one queue on each node. The other queues have much
more restrictive routing keys, but I tried to spread the load as well.
The messages are compressed XML representations of Java and Scala
objects. Most messages are under 2 KiB, with some reaching as high as
2 MiB. Consumers can keep up with producers, and the queues are empty
90%+ of the time.

Any tips on how I can plan for my RAM?

Thanks!
Fran?ois

From nithyanirmal at gmail.com  Mon Apr  9 19:24:34 2012
From: nithyanirmal at gmail.com (Nithya Vijayakumar)
Date: Mon, 9 Apr 2012 11:24:34 -0700
Subject: [rabbitmq-discuss] replication related questions in cluster
Message-ID: <CAJinw2pi-ywr=TgiOMPOiahZjf83hE5xyF821xTQtQLzE5=Gow@mail.gmail.com>

Hello all,

We are using RabbitMQ cluster (currently just 2 nodes, plan to goto 3)
for a critical application. Had the following questions and couldn't
find info on docs/forums from before. Hope folks in this forum can
help.


1. When we do a publish to a rabbitmq node, when does the publish
method return? Soon after that node got the data? or after replication
happened? Is it possible to do synchronous publish with replication?
We are trying to see if we can avoid the scenario that a node might go
down soon after publish and before the data got replicated.
Transactions seem costly and the async behavior of publisher confirms
is not suiting us well.

2. When a node restarts, it cleans up the queues and joins the
previously running node (logical master) and starts listening from
then on. Even if the second node has the exact same copy of the data
that was persisted as the current master, it still gets deleted.
Wondering if there is an option to preserve current data in mnesia
during restarts or possibly synchronize the current set of data from
the logical master. The issue we are seeing is that if node 1 and node
2 get into some manual restart operations (node1 restarts and then
node 2 restarts), both nodes loose data. We would really like to avoid
this.

Thanks,
Nithya

From emile at rabbitmq.com  Tue Apr 10 11:17:51 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 10 Apr 2012 11:17:51 +0100
Subject: [rabbitmq-discuss] requeue problem with rabbitmq version 2.8.1
In-Reply-To: <1333651569.56808.YahooMailNeo@web125806.mail.ne1.yahoo.com>
References: <1333651569.56808.YahooMailNeo@web125806.mail.ne1.yahoo.com>
Message-ID: <4F8408CF.2070804@rabbitmq.com>


Hi Ruben,

On 05/04/12 19:46, Ruben Rotteveel wrote:
> We've been running into an issue where the calling BasicReject with
> requeue set to true, puts the message back in front of the line (as a
> stack) instead of the back of the line (as a queue).  This feature
> worked in 2.6.1.  Is there some other setting that needs to be adjusted
> to get this to work the way it should?

The order of messages after requeue is left unspecified by AMQP. You
will find a description of ordering guarantees made by RabbitMQ here:
http://www.rabbitmq.com/semantics.html#ordering

The requeue behaviour changed in v2.7.0. There is no way to obtain the
previous behaviour on recent brokers. The closest approximation to the
previous requeue behaviour is to acknowledge and republish a fresh copy
of the message, which will then be enqueued as a new message.

-Emile



From simon at rabbitmq.com  Tue Apr 10 11:16:50 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 10 Apr 2012 11:16:50 +0100
Subject: [rabbitmq-discuss] Viewing more than 500 queues in RabbitMQ
	Management?
In-Reply-To: <38FDEAB6-51E7-488B-94C5-267F96E3C092@eventful.com>
References: <38FDEAB6-51E7-488B-94C5-267F96E3C092@eventful.com>
Message-ID: <4F840892.5090402@rabbitmq.com>

On 10/04/2012 12:48AM, Sam Choukri wrote:
> We have more than 500 queues in one of our rabbitmq vhosts. However,
> the RabbitMQ Web Management plugin only shows a max of 500 queues
> with no ability to view the remaining queues. Is it possible to
> configure the plugin to show more queues (or all queues)?

I'm afraid not at the moment. The limit is only enforced in the web UI 
Javascript though, so you could use rabbitmqadmin / something else that 
talks to the HTTP API as a workaround.

Cheers, Simon

From simon at rabbitmq.com  Tue Apr 10 11:20:42 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 10 Apr 2012 11:20:42 +0100
Subject: [rabbitmq-discuss] Running into some issues with high queue
	counts(again)
In-Reply-To: <17574542.4.1333648969791.JavaMail.geo-discussion-forums@pbnv7>
References: <17574542.4.1333648969791.JavaMail.geo-discussion-forums@pbnv7>
Message-ID: <4F84097A.9030004@rabbitmq.com>

On 05/04/2012 7:02PM, Jeremy Pierre wrote:
> The 300k queues I'm attempting to create is a much smaller count than
> we'd eventually be running in production.

For Rabbit, 300k queues definitely counts as quite a lot. Not an 
unreasonable number in itself, but if you plan on having many times that 
in production then I would start to worry about your design.

> So the question is, am I approaching this the wrong way?  Should I be
> treating RabbitMQ as a more general message bus and performing more
> complex routing on the non-RabbitMQ web server/application nodes?

Probably.

Cheers, Simon

From simon at rabbitmq.com  Tue Apr 10 11:32:46 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 10 Apr 2012 11:32:46 +0100
Subject: [rabbitmq-discuss] How to plan for RAM?
In-Reply-To: <fc5397f1-1f38-4cee-8075-0ff96f3685ca@j15g2000vbt.googlegroups.com>
References: <fc5397f1-1f38-4cee-8075-0ff96f3685ca@j15g2000vbt.googlegroups.com>
Message-ID: <4F840C4E.5010204@rabbitmq.com>

On 09/04/2012 2:17PM, Fran?ois Beausoleil wrote:
> I'm trying to determine how much RAM I need for my 2 node cluster. I
> use VMs at Rackspace.
>
> I currently have 2x 4 GiB RAM nodes, but I consistently hit my VM high
> memory watermark.

Is this with 2.8.x or earlier? Versions before 2.8.0 can use large 
amounts of memory when messages are published faster than they can be 
routed. That doesn't sound like your situation, but it would be good to 
eliminate it.

> I have one topic exchange, with about 8 queues. The
> routing keys are all left-anchored: my queues all use routing keys of
> the form "a.#" or even "#". During normal operation, I generate
> between 5 and 20 messages per second, and at peak, more than 2000. I
> have 2 queues which use a routing key of the form "#", and I spread
> the load so I have one queue on each node. The other queues have much
> more restrictive routing keys, but I tried to spread the load as well.
> The messages are compressed XML representations of Java and Scala
> objects. Most messages are under 2 KiB, with some reaching as high as
> 2 MiB. Consumers can keep up with producers, and the queues are empty
> 90%+ of the time.
>
> Any tips on how I can plan for my RAM?

It doesn't sound like you should be using too much RAM in this scenario.

If you are using 2.8.x and seeing a large amount of RAM used, posting 
the results of "rabbitmqctl report" would help us figure out where it is 
going.

Cheers, Simon

From emile at rabbitmq.com  Tue Apr 10 11:35:32 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 10 Apr 2012 11:35:32 +0100
Subject: [rabbitmq-discuss] Client connection to ssl rabbitMQ is very
 slow
In-Reply-To: <33654326.post@talk.nabble.com>
References: <33544994.post@talk.nabble.com> <4F7C25DE.40703@rabbitmq.com>
	<CAFPidkNoJoK5PqLoaxqntvEs+E3X3uYrabVU+rkJYsqxyL9ymA@mail.gmail.com>
	<33654326.post@talk.nabble.com>
Message-ID: <4F840CF4.5050002@rabbitmq.com>

Hi,

On 09/04/12 08:23, Rabbit001 wrote:
> I follow your instructions and I've modified rabbitmq.config and put
> {ciphers,[{rsa,aes_128_cbc,sha}]}. The server starts correctly but my client
> display this error,

The broker will stand a better chance of being able to negotiate a
cipher with the client if it offers more than one. Select some more from
the supported broker ciphers (reported by ssl:cipher_suites/0), avoiding
slow ones (like triple DES) and including at least one that is
compatible with your client.


-Emile


From simon at rabbitmq.com  Tue Apr 10 11:40:53 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 10 Apr 2012 11:40:53 +0100
Subject: [rabbitmq-discuss] replication related questions in cluster
In-Reply-To: <CAJinw2pi-ywr=TgiOMPOiahZjf83hE5xyF821xTQtQLzE5=Gow@mail.gmail.com>
References: <CAJinw2pi-ywr=TgiOMPOiahZjf83hE5xyF821xTQtQLzE5=Gow@mail.gmail.com>
Message-ID: <4F840E35.70201@rabbitmq.com>

On 09/04/2012 7:24PM, Nithya Vijayakumar wrote:
> 1. When we do a publish to a rabbitmq node, when does the publish
> method return? Soon after that node got the data? or after replication
> happened? Is it possible to do synchronous publish with replication?
> We are trying to see if we can avoid the scenario that a node might go
> down soon after publish and before the data got replicated.
> Transactions seem costly and the async behavior of publisher confirms
> is not suiting us well.

Publish will return as soon as the message has gone out on the wire from 
the client's perspective. There's no guarantee the server has even seen 
it. This is to keep it asynchronous.

If you want a synchronous publish, wrap it in a transaction, or use the 
waitForConfirms methods in our clients. In recent RabbitMQ versions 
transactions are implemented in terms of confirms, so they are only more 
costly than confirms in that they force synchrony over the network.

> 2. When a node restarts, it cleans up the queues and joins the
> previously running node (logical master) and starts listening from
> then on. Even if the second node has the exact same copy of the data
> that was persisted as the current master, it still gets deleted.
> Wondering if there is an option to preserve current data in mnesia
> during restarts

The trouble is that it's hard for the restarted slave to know what's 
happened while it was down.

> or possibly synchronize the current set of data from
> the logical master.

Not at the moment. We hope to introduce this in a future version.

Cheers, Simon

From carl.hoerberg at gmail.com  Tue Apr 10 11:59:53 2012
From: carl.hoerberg at gmail.com (=?ISO-8859-1?Q?Carl_H=F6rberg?=)
Date: Tue, 10 Apr 2012 12:59:53 +0200
Subject: [rabbitmq-discuss] Client connection to ssl rabbitMQ is very
	slow
In-Reply-To: <4F840CF4.5050002@rabbitmq.com>
References: <33544994.post@talk.nabble.com> <4F7C25DE.40703@rabbitmq.com>
	<CAFPidkNoJoK5PqLoaxqntvEs+E3X3uYrabVU+rkJYsqxyL9ymA@mail.gmail.com>
	<33654326.post@talk.nabble.com> <4F840CF4.5050002@rabbitmq.com>
Message-ID: <CAFPidkNfqQGF-KzGausip0hM2hMne1SkzjzGzwULrA6q3Gto5A@mail.gmail.com>

hum.. the client seems to support rsa aes 128 sha, but try to add some
more like:

{ciphers,[{rsa,aes_128_cbc,sha},{rsa,rc4_128,md5},{rsa,rc4_128,sha}]}


On Tue, Apr 10, 2012 at 12:35, Emile Joubert <emile at rabbitmq.com> wrote:
> Hi,
>
> On 09/04/12 08:23, Rabbit001 wrote:
>> I follow your instructions and I've modified rabbitmq.config and put
>> {ciphers,[{rsa,aes_128_cbc,sha}]}. The server starts correctly but my client
>> display this error,
>
> The broker will stand a better chance of being able to negotiate a
> cipher with the client if it offers more than one. Select some more from
> the supported broker ciphers (reported by ssl:cipher_suites/0), avoiding
> slow ones (like triple DES) and including at least one that is
> compatible with your client.
>
>
> -Emile
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simon at rabbitmq.com  Tue Apr 10 12:21:05 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 10 Apr 2012 12:21:05 +0100
Subject: [rabbitmq-discuss] Cluster fails when current primary node
 shuts down.
In-Reply-To: <CAChq9g2WvvDcH-74MtpBAHhGTN5evAzP-X1DKxsSTJEOWG+AGg@mail.gmail.com>
References: <CAChq9g33wZVMFUvba04S+ZbPKNDharX+4LAgc_wt3t+aQFUO3Q@mail.gmail.com>
	<4F670E1C.4000104@rabbitmq.com>
	<CAChq9g2WvvDcH-74MtpBAHhGTN5evAzP-X1DKxsSTJEOWG+AGg@mail.gmail.com>
Message-ID: <4F8417A1.70608@rabbitmq.com>

On 05/04/2012 12:37AM, Travis wrote:
> Ok, so I've gotten another chance to test this on our production
> server.  What appears to be happening is that, when we initiate the
> stop on machineA, rabbitmq*looks*  like it fails the mirrored queues
> over to machineB, but as soon as this completes, the management plugin
> dies on machineB.  We can confirm that the queues are alive because
> our applications consuming from the queue continue chugging along
> happily, processing messages that have been published.

Oh, that's odd, and definitely should not be happening.

> rabbitmqctl cluster_status also shows that the instance on machineB is alive.
>
> Oddly, if I've failed from machineA to machineB, done a
> stop_app/start_app to get the management plugin working on machineB,
> brought up machineA again, and then initiated the failover back to
> machineA, the failover completes without issue (eg, the management
> plugin has no failures).
>
> So ...
>
> 1)  As I understand it, the node in the management interface
> associated with the stats service is the node considered the master.
> How can I tell which node has the stats service running if the
> management plugin is not running?

The stats service is part of the management plugin, so if mgmt is not 
running it isn't either. There's no inherent "master" node in a RabbitMQ 
cluster; the node with stats is just the node with stats (and this 
doesn't have to mean anything with respect to where mirrored queues have 
their masters).

> 2) How do I restart the management plugin and associated parts without
> doing a full stop_app/start_app?

You should be able to do:

rabbitmqctl eval 'application:stop(rabbitmq_management).'
rabbitmqctl eval 'application:start(rabbitmq_management).'

to just restart the management plugin.

> 3) What other things would be needed to debug this further?  I can
> reliably cause this issue to occur failing from machineA to machineB.

Logs (including the "sasl" log) from when the failure occurs. If you can 
reliably reproduce this that's great, I would like to get to the bottom 
of this.

Cheers, Simon

From simon at rabbitmq.com  Tue Apr 10 13:59:01 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 10 Apr 2012 13:59:01 +0100
Subject: [rabbitmq-discuss] RabbitMQ and Erlang --enable-native-libs
In-Reply-To: <4F69B7B6.7010309@rabbitmq.com>
References: <CAFDmHdM1skF=+k=NXG_SWcwR-iid0vFD3-7d=vVRZPvE5eoGRg@mail.gmail.com>
	<4F69B7B6.7010309@rabbitmq.com>
Message-ID: <4F842E95.9010601@rabbitmq.com>

On 21/03/2012 11:12AM, Matthias Radestock wrote:
> I am unable to reproduce this.

Aha, I got it. You need to enable HiPE compilation as well.

Some *very* rough and ready testing suggests that --enable-native-libs 
delivers no measurable performance gain with HiPE off, so I guess it is 
even less likely to be useful with HiPE on. So for the time being the 
recommendation is "don't do that".

But I'll poke around this, and see if we can at least get a more 
sensible error message appearing.

Cheers, Simon

From gabriel.adgeg at it-sudparis.eu  Tue Apr 10 14:13:45 2012
From: gabriel.adgeg at it-sudparis.eu (Adgeg Gabriel)
Date: Tue, 10 Apr 2012 15:13:45 +0200
Subject: [rabbitmq-discuss] ZebroGaMQ: Communication Middleware for Mobile
	Gaming based on RabbitMQ
Message-ID: <4F843209.6080509@it-sudparis.eu>

Our team has created a communication middleware for mobile gaming called
ZebroGaMQ(*), within the TOTEM research project for Mobile Mixed Reality
Games(**).
ZebroGaMQ is based on RabbitMQ. It provides an easy and reliable way
to publish and consume messages in the context of mobile multiplayer games.
A prototypical game involves:

    * A Python server (using pika library)
    * Android applications (using rabbitmq client for Java)
    * JavaScript applications (using Node.js and its amqp library)
    * Java J2SE applications (using rabbitmq client for Java)

Here are the features of ZebroGaMQ:

    * Clients of ZebroGaMQ don't have to handle the low-level details of
      message reception. They just need to define a behaviour on the
      consumption of these messages.
    * Disconnection management of Android devices is allowed. Simply
      focus on publishing your messages, the middleware handles for you
      the loss of network connection inherent to mobile networks.
    * Game instances management is provided. You can create several
      instances of a game, and let players use those instances in parallel.

ZebroGaMQ is available on GitHub: https://github.com/simatic/ZebroGaMQ

We will soon publish a demonstrator game called aMazing that uses ZebroGaMQ.

We welcome any questions and feedbacks.

Regards,

(*)  https://github.com/simatic/ZebroGaMQ
(**) http://www.totem-games.org
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120410/0916c7e9/attachment.htm>

From alan.antonuk at gmail.com  Tue Apr 10 14:51:56 2012
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Tue, 10 Apr 2012 09:51:56 -0400
Subject: [rabbitmq-discuss] librabbitmq faults
In-Reply-To: <9AC3D510-4466-4BF9-A787-ABD183DA4F7A@portalify.com>
References: <BAD9CCAC-6116-4CE6-AE09-088CD6386592@portalify.com>
	<CAAt2poJxUX19CoZC6DJq7gtSzs+VTfzmhKzDTWG+Wd04zXYwcw@mail.gmail.com>
	<3B34C005-3EE0-486D-943E-0EE2D62D1C9E@portalify.com>
	<CAAt2poJM7M-VivLy=_SyOODoevwm5Lt_7OzCEcCgJnEfwOdrSQ@mail.gmail.com>
	<9AC3D510-4466-4BF9-A787-ABD183DA4F7A@portalify.com>
Message-ID: <CAAt2poLJk3cDGJGyCVzn5qi+O-8Ro6XRTChnq_icJmnKGaTU1w@mail.gmail.com>

Looking at the Net::RabbitMQ code - it looks like the rabbitmq-c code it
wraps is pretty old.  You've done what I would recommend which would be to
upgrade to the latest version of the rabbitmq-c code that the Net::RabbitMQ
module wraps.

-Alan

On Tue, Apr 10, 2012 at 1:22 AM, Matti Linnanvuori <
matti.linnanvuori at portalify.com> wrote:

> Hi!
>
> Yes, I did build Net::RabbitMQ with that version of rabbitmq-c and it ran
> the script below without crashing.
>
> On Apr 5, 2012, at 9:18 PM, Alan Antonuk wrote:
>
> What do you mean by it doesn't segfault with rabbitmq-c-fb6fca832fd2 ?
>  Did you build Net::RabbitMQ with that version of rabbitmq-c and it ran the
> script below without crashing?
>
> -Alan
>
> On Wed, Apr 4, 2012 at 3:12 AM, Matti Linnanvuori <
> matti.linnanvuori at portalify.com> wrote:
>
>> Hi!
>>
>> I wonder how it is possible to have recv hang if RabbitMQ server has
>> disconnected. Maybe RabbitMQ server has a bug that it does not disconnect a
>> socket.
>>
>> I am afraid I don't have a succinct example that can reproduce this
>> segfault. It occurred with Net::RabbitMQ versions 0.2.0 and 0.2.2, but not
>> with rabbitmq-c-fb6fca832fd2.
>>
>> I reported the segmentation fault in CPAN:
>> https://rt.cpan.org/Public/Bug/Display.html?id=76205
>>
>> I got the segmentation fault in subroutine get. I think it is because
>> memory allocation failed.
>> I have Net::RabbitMQ version 0.2.2. I got a similar bug in Net::RabbitMQ
>> version 0.2.0, too:https://rt.cpan.org/Public/Bug/Display.html?id=76156
>> This is perl, v5.10.0 built for x86_64-linux-thread-multi
>> Linux pmc-inst-test 2.6.32.12-0.7-default #1 SMP 2010-05-20 11:14:20
>> +0200 x86_64 x86_64 x86_64 GNU/Linux
>>
>> Program received signal SIGSEGV, Segmentation fault.
>> 0x00007ffff724fa41 in memcpy () from /lib64/libc.so.6
>> (gdb) bt
>> #0 0x00007ffff724fa41 in memcpy () from /lib64/libc.so.6
>> #1 0x00007ffff6db2c0d in amqp_handle_input (state=0x7bc8a0,
>> received_data=..., decoded_frame=0x7fffffffe2c0)
>> at /usr/include/bits/string3.h:52
>> #2 0x00007ffff6dbbeec in wait_frame_inner (state=0x7bc8a0,
>> decoded_frame=0x7fffffffe2c0) at amqp_socket.c:167
>> #3 0x00007ffff6dbc489 in amqp_simple_rpc (state=0x7bc8a0, channel=3,
>> request_id=, expected_reply_ids=0x7fffffffe3a0,
>> decoded_request_method=) at amqp_socket.c:283
>> #4 0x00007ffff6db156c in amqp_basic_get (state=0x7bc8a0, channel=7,
>> queue=..., no_ack=1) at amqp_api.c:258
>> #5 0x00007ffff6da7432 in XS_Net__RabbitMQ_get (my_perl=,
>> cv=) at RabbitMQ.xs:618
>> #6 0x000000000047e115 in Perl_pp_entersub ()
>> #7 0x0000000000455ad3 in Perl_runops_debug ()
>> #8 0x000000000047a005 in perl_run ()
>> #9 0x000000000042172c in main ()
>> (gdb)
>>
>> #!/usr/bin/perl -w
>>
>> =pod
>>
>> =head1 sds2sds_sf_fault.t
>>
>>  Test 1: publish a Dispatch JSON message with ack_level and valid_until
>>  - from SDS to SDS in exchange.pmc.router-in.
>>  Try to receive a message from exchange.pmc.router-in in 8 seconds.
>>  Test 1 expected result: a message is received from
>> exchange.pmc.router-in in 8 seconds.
>>  Test 2: decode the message as JSON.
>>  Test 2 expected result: the message is decoded as JSON.
>>  Test 3: check that the sender field is the same as in the sent message.
>>  Test 3 expected result: the sender field is the same as in the sent
>> message.
>>  Test 4: check the body of the received message and the sent one.
>>  Test 4 expected result: the body fields are the same.
>>  Test 5: check the timestamp field.
>>  Test 5 expected result: the timestamp field is the same as in the
>> published message.
>>  Test 6: try to receive a message from exchange.pmc.sf-in in 8 seconds.
>>  Test 6 expected result: a message is received from exchange.pmc.sf-in in
>> 8 seconds.
>>  Test 7: decode the message as JSON.
>>  Test 7 expected result: the message is decoded as JSON.
>>  Test 8: check that the sender field is "exchange.pmc.router-in".
>>  Test 8 expected result: the sender field is "exchange.pmc.router-in".
>>  Test 9: check the body of the received message and the sent one.
>>  Test 9 expected result: the body fields are the same.
>>  Test 10: check that the timestamp in an integer.
>>  Test 10 expected result: the timestamp in an integer.
>>  Test 11: check that the timestamp is greater than or equal to that of
>> before publishing.
>>  Test 11 expected result: the timestamp is greater than or equal to that
>> of before publishing.
>>  Test 12: check that the timestamp is less than or equal to that of now.
>>  Test 12 expected result: the timestamp is less than or equal to that of
>> now.
>>  Test 13: try to receive a message from exchange.pmc.router-in in 8
>> seconds.
>>  Test 13 expected result: a message is received from
>> exchange.pmc.router-in in 8 seconds.
>>  Test 14: decode the message as JSON.
>>  Test 14 expected result: the message is decoded as JSON.
>>  Test 15: check that the sender field is "exchange.pmc.sf-in".
>>  Test 15 expected result: the sender field is "exchange.pmc.sf-in".
>>  Test 16: check the body of the received message and the sent one.
>>  Test 16 expected result: the body fields are the same.
>>  Test 17: check that the timestamp in an integer.
>>  Test 17 expected result: the timestamp in an integer.
>>  Test 18: check that the timestamp is greater than or equal to that of
>> before publishing.
>>  Test 18 expected result: the timestamp is greater than or equal to that
>> of before publishing.
>>  Test 19: check that the timestamp is less than or equal to that of now.
>>  Test 19 expected result: the timestamp is less than or equal to that of
>> now.
>>  Test 20: try to receive a message from exchange.pmc.router-in in 8
>> seconds.
>>  Test 20 expected result: a message is received from
>> exchange.pmc.router-in in 8 seconds.
>>  Test 21: decode the message as JSON.
>>  Test 21 expected result: the message is decoded as JSON.
>>  Test 22: check that the sender field is "exchange.pmc.sf-in".
>>  Test 22 expected result: the sender field is "exchange.pmc.sf-in".
>>  Test 23: check that the timestamp in an integer.
>>  Test 23 expected result: the timestamp in an integer.
>>  Test 24: check that the timestamp is greater than or equal to that of
>> before publishing.
>>  Test 24 expected result: the timestamp is greater than or equal to that
>> of before publishing.
>>  Test 25: check that the timestamp is less than or equal to that of now.
>>  Test 25 expected result: the timestamp is less than or equal to that of
>> now.
>>  Test 26: check that the id fields of the received and the published
>> messages are the same.
>>  Test 26 expected result: the id fields of the received and the published
>> messages are the same.
>>  Test 27: check that the ack_type field has value "processed".
>>  Test 27 expected result: the ack_type field has value "processed".
>>  Test 28: check that the from field of the received message is the same as
>>  the to field of the published message.
>>  Test 28 expected result: the from field of the received message is the
>> same as
>>  the to field of the published message.
>>  Test 29: check that the type field has value "ack".
>>  Test 29 expected result: the type field has value "ack".
>>  Test 30: check that the version field has value 1.
>>  Test 30 expected result: the version field has value 1.
>>  Test 31: try to receive a message from exchange.pmc.cassidian-in in 8
>> seconds.
>>  Test 31 expected result: a message is received from
>> exchange.pmc.cassidian-in in 8 seconds.
>>  Test 32: decode the message as JSON.
>>  Test 32 expected result: the message is decoded as JSON.
>>  Test 33: check that the sender field is "exchange.pmc.router-in".
>>  Test 33 expected result: the sender field is "exchange.pmc.router-in".
>>  Test 34: check the body of the received message and the sent one.
>>  Test 34 expected result: the body fields are the same.
>>  Test 35: check that the timestamp in an integer.
>>  Test 35 expected result: the timestamp in an integer.
>>  Test 36: check that the timestamp is greater than or equal to that of
>> before publishing.
>>  Test 36 expected result: the timestamp is greater than or equal to that
>> of before publishing.
>>  Test 37: check that the timestamp is less than or equal to that of now.
>>  Test 37 expected result: the timestamp is less than or equal to that of
>> now.
>>  Test 38: try to receive a message from exchange.pmc.cassidian-in in 8
>> seconds.
>>  Test 38 expected result: a message is received from
>> exchange.pmc.cassidian-in in 8 seconds.
>>  Test 39: decode the message as JSON.
>>  Test 39 expected result: the message is decoded as JSON.
>>  Test 40: check that the sender field is "exchange.pmc.router-in".
>>  Test 40 expected result: the sender field is "exchange.pmc.router-in".
>>  Test 41: check that the timestamp in an integer.
>>  Test 41 expected result: the timestamp in an integer.
>>  Test 42: check that the timestamp is greater than or equal to that of
>> before publishing.
>>  Test 42 expected result: the timestamp is greater than or equal to that
>> of before publishing.
>>  Test 43: check that the timestamp is less than or equal to that of now.
>>  Test 43 expected result: the timestamp is less than or equal to that of
>> now.
>>  Test 44: check that the id fields of the received and the published
>> messages are the same.
>>  Test 44 expected result: the id fields of the received and the published
>> messages are the same.
>>  Test 45: check that the ack_type field has value "processed".
>>  Test 45 expected result: the ack_type field has value "processed".
>>  Test 46: check that the from field of the received message is the same as
>>  the to field of the published message.
>>  Test 46 expected result: the from field of the received message is the
>> same as
>>  the to field of the published message.
>>  Test 47: check that the type field has value "ack".
>>  Test 47 expected result: the type field has value "ack".
>>  Test 48: check that the version field has value 1.
>>  Test 48 expected result: the version field has value 1.
>>  Test 49: publish an Ack sent message from the SSI in
>> exchange.pmc.router-in.
>>  try to receive a message from exchange.pmc.router-in in 8 seconds.
>>  Test 49 expected result: a message is received from
>> exchange.pmc.router-in in 8 seconds.
>>  Test 50: decode the message as JSON.
>>  Test 50 expected result: the message is decoded as JSON.
>>  Test 51: check that the timestamp of the received message is the same as
>> that of published one.
>>  Test 51 expected result:
>>  the timestamp of the received message is the same as that of published
>> one.
>>  Test 52: check the sender field of the received message.
>>  Test 52 expected result:
>>  the sender field of the received message has value
>> "exchange.pmc.cassidian-in".
>>  Test 53: check the body fields of the received and the published
>> messages.
>>  Test 53 expected result:
>>  the body fields of the received and the published messages are the same.
>>  Test 54: try to receive a message from exchange.pmc.sf-in in 8 seconds.
>>  Test 54 expected result: a message is received from exchange.pmc.sf-in
>> in 8 seconds.
>>  Test 55: decode the message as JSON.
>>  Test 55 expected result: the message is decoded as JSON.
>>  Test 56: check the sender field of the received message.
>>  Test 56 expected result:
>>  the sender field of the received message has value
>> "exchange.pmc.router-in".
>>  Test 57: check the body fields of the received and the published
>> messages.
>>  Test 57 expected result:
>>  the body fields of the received and the published messages are the same.
>>  Test 58: check that the timestamp in an integer.
>>  Test 58 expected result: the timestamp in an integer.
>>  Test 59: check that the timestamp is greater than or equal to that of
>> before publishing.
>>  Test 59 expected result: the timestamp is greater than or equal to that
>> of before publishing.
>>  Test 60: check that the timestamp is less than or equal to that of now.
>>  Test 60 expected result: the timestamp is less than or equal to that of
>> now.
>>  Test 61: try to receive a message from exchange.pmc.router-in in 8
>> seconds.
>>  Test 61 expected result: a message is received from
>> exchange.pmc.router-in in 8 seconds.
>>  Test 62: decode the message as JSON.
>>  Test 62 expected result: the message is decoded as JSON.
>>  Test 63: check the sender field of the received message.
>>  Test 63 expected result:
>>  the sender field of the received message has value "exchange.pmc.sf-in".
>>  Test 64: check the body fields of the received and the published
>> messages.
>>  Test 64 expected result:
>>  the body fields of the received and the published messages are the same.
>>  Test 65: check that the timestamp in an integer.
>>  Test 65 expected result: the timestamp in an integer.
>>  Test 66: check that the timestamp is greater than or equal to that of
>> before publishing.
>>  Test 66 expected result: the timestamp is greater than or equal to that
>> of before publishing.
>>  Test 67: check that the timestamp is less than or equal to that of now.
>>  Test 67 expected result: the timestamp is less than or equal to that of
>> now.
>>  Test 68: try to receive a message from exchange.pmc.cassidian-in in 8
>> seconds.
>>  Test 68 expected result: a message is received from
>> exchange.pmc.cassidian-in in 8 seconds.
>>  Test 69: decode the message as JSON.
>>  Test 69 expected result: the message is decoded as JSON.
>>  Test 70: check the sender field of the received message.
>>  Test 70 expected result:
>>  the sender field of the received message has value
>> "exchange.pmc.router-in".
>>  Test 71: check the body fields of the received and the published
>> messages.
>>  Test 71 expected result:
>>  the body fields of the received and the published messages are the same.
>>  Test 72: check that the timestamp in an integer.
>>  Test 72 expected result: the timestamp in an integer.
>>  Test 73: check that the timestamp is greater than or equal to that of
>> before publishing.
>>  Test 73 expected result: the timestamp is greater than or equal to that
>> of before publishing.
>>  Test 74: check that the timestamp is less than or equal to that of now.
>>  Test 74 expected result: the timestamp is less than or equal to that of
>> now.
>>
>> =cut
>>
>> use strict;
>>
>> use Net::RabbitMQ;
>> use Test::More tests => 74;
>> use JSON;
>> use Time::HiRes qw(gettimeofday);
>>
>> use constant ROUTER_EXCHANGE    => 'exchange.pmc.router-in';
>> use constant ROUTER_CHANNEL     => 1;
>> use constant ROUTER_QUEUE       => 'queue.test.router-in';
>> use constant SF_EXCHANGE        => 'exchange.pmc.sf-in';
>> use constant SF_CHANNEL         => 2;
>> use constant SF_QUEUE           => 'queue.test.sf-in';
>> use constant CASSIDIAN_EXCHANGE => 'exchange.pmc.cassidian-in';
>> use constant CASSIDIAN_CHANNEL  => 3;
>> use constant CASSIDIAN_QUEUE    => 'queue.test.cassidian-in';
>>
>> sub timestamp {
>>    return int( gettimeofday() * 1000 );
>> }
>>
>> system(
>> 'service pmc-smpp stop >&2; service pmc-cassidian stop >&2; service
>> pmc-email stop >&2; service pmc-sf stop >&2; service pmc-routing stop >&2'
>> );
>>
>> sleep 1;    # Wait for the message-sending to stop.
>>
>> system(
>>    'rabbitmqctl stop_app; rabbitmqctl reset; rabbitmqctl start_app; mongo
>> <<END
>> use database
>> db.dropDatabase();
>> END'
>> );
>>
>> system('service pmc-sf start >&2; service pmc-routing start >&2');
>>
>> sleep 8;    # Wait for Store & Forward and Routing to start.
>>
>> my $json_text = '{
>> "timestamp" : 1330327514213,
>> "sender" : "' . CASSIDIAN_EXCHANGE . '",
>> "body" : {
>> "type" : "dispatch",
>> "version" : 1,
>> "id" : "8f970b1b-f8a3-4c78-aa24-3b8e2205648788",
>> "from" : {
>> "type" : "ssi",
>> "address" : "16777215"
>> },
>> "to" : {
>> "type" : "ssi",
>> "address" : "0"
>> },
>> "body" : "This is a test message.",
>> "ack_level" : "sent",
>> "valid_until" : 9223372036854775807,
>> "auxiliary" : {
>> "timestamp" : 1325376000000,
>> "sdstl" : {
>> "protocol_id" : 130,
>> "message_reference" : 42,
>> "short_report_allowed" : true,
>> "protocol_data" : {
>> "encoding" : 0,
>> "timestamp" : {
>> "month" : 1,
>> "day" : 1,
>> "hour" : 0,
>> "minute" : 0
>> }
>> }
>> }
>> }
>> }
>> }';
>>
>> my $mq_router = Net::RabbitMQ->new();
>> $mq_router->connect( "localhost", { user => "guest", password => "guest"
>> } );
>> $mq_router->channel_open(ROUTER_CHANNEL);
>> $mq_router->queue_declare(
>>    ROUTER_CHANNEL,
>>    ROUTER_QUEUE,
>>    {
>>        passive     => 0,
>>        durable     => 1,
>>        exclusive   => 0,
>>        auto_delete => 0
>>    }
>> );
>> $mq_router->queue_bind( ROUTER_CHANNEL, ROUTER_QUEUE, ROUTER_EXCHANGE, ''
>> );
>> $mq_router->purge( ROUTER_CHANNEL, ROUTER_QUEUE );
>> $mq_router->consume( ROUTER_CHANNEL, ROUTER_QUEUE );
>>
>> my $mq_sf = Net::RabbitMQ->new();
>> $mq_sf->connect( "localhost", { user => "guest", password => "guest" } );
>> $mq_sf->channel_open(SF_CHANNEL);
>> $mq_sf->exchange_declare(
>>    SF_CHANNEL,
>>    SF_EXCHANGE,
>>    {
>>        exchange_type => 'direct',
>>        passive       => 0,
>>        durable       => 1,
>>        auto_delete   => 0
>>    }
>> );
>> $mq_sf->queue_declare(
>>    SF_CHANNEL,
>>    SF_QUEUE,
>>    {
>>        passive     => 0,
>>        durable     => 1,
>>        exclusive   => 0,
>>        auto_delete => 0
>>    }
>> );
>> $mq_sf->queue_bind( SF_CHANNEL, SF_QUEUE, SF_EXCHANGE, '' );
>> $mq_sf->purge( SF_CHANNEL, SF_QUEUE );
>> $mq_sf->consume( SF_CHANNEL, SF_QUEUE );
>>
>> my $mq_cassidian = Net::RabbitMQ->new();
>> $mq_cassidian->connect( "localhost", { user => "guest", password =>
>> "guest" } );
>> $mq_cassidian->channel_open(CASSIDIAN_CHANNEL);
>> $mq_cassidian->exchange_declare(
>>    CASSIDIAN_CHANNEL,
>>    CASSIDIAN_EXCHANGE,
>>    {
>>        exchange_type => 'direct',
>>        passive       => 0,
>>        durable       => 1,
>>        auto_delete   => 0
>>    }
>> );
>> $mq_cassidian->queue_declare(
>>    CASSIDIAN_CHANNEL,
>>    CASSIDIAN_QUEUE,
>>    {
>>        passive     => 0,
>>        durable     => 1,
>>        exclusive   => 0,
>>        auto_delete => 0
>>    }
>> );
>> $mq_cassidian->queue_bind( CASSIDIAN_CHANNEL, CASSIDIAN_QUEUE,
>>    CASSIDIAN_EXCHANGE, '' );
>> $mq_cassidian->purge( CASSIDIAN_CHANNEL, CASSIDIAN_QUEUE );
>> $mq_cassidian->consume( CASSIDIAN_CHANNEL, CASSIDIAN_QUEUE );
>>
>> my $before = timestamp();
>>
>> $mq_router->publish(
>>    ROUTER_CHANNEL,
>>    '',
>>    $json_text,
>>    {
>>
>>        # Options
>>        exchange => ROUTER_EXCHANGE
>>    },
>>    {
>>
>>        # Props
>>        content_encoding => "UTF-8",
>>        content_type     => "application/json"
>>    }
>> );
>>
>> my $sent = decode_json($json_text);
>> my $message;
>> eval {
>>    local $SIG{ALRM} = sub { die "Timeout\n" };
>>    alarm 8;
>>    $message = $mq_router->recv();
>>    alarm 0;
>> };
>> is( $@, '', 'A message was received from queue' );
>> my $json;
>> eval { $json = decode_json( $message->{'body'} ); };
>> is( $@, '', 'A JSON message received' );
>> is( $json->{'sender'}, $sent->{'sender'}, 'sender ' . $sent->{'sender'} );
>> is_deeply( $json->{'body'}, $sent->{'body'}, 'body the same' );
>> is( $json->{'timestamp'}, $sent->{'timestamp'},
>>    "timestamp " . $sent->{'timestamp'} );
>>
>> undef $message;
>> eval {
>>    local $SIG{ALRM} = sub { die "Timeout\n" };
>>    alarm 8;
>>    $message = $mq_sf->recv();
>>    alarm 0;
>> };
>> is( $@, '', 'A message was received' );
>> undef $json;
>> eval { $json = decode_json( $message->{'body'} ); };
>> is( $@, '', 'A JSON message received' );
>> is( $json->{'sender'}, ROUTER_EXCHANGE, 'sender ' . ROUTER_EXCHANGE );
>> is_deeply( $json->{'body'}, $sent->{'body'}, 'body the same' );
>> like( $json->{'timestamp'}, qr/^\d+$/, "timestamp an integer" );
>> ok( $json->{'timestamp'} >= $before,
>>    'timestamp greater than or equal to that of before publishing' )
>>  or diag("$json->{'timestamp'} < $before");
>> my $now = timestamp();
>> ok( $json->{'timestamp'} <= $now,
>>    'timestamp less than or equal to that of now' )
>>  or diag("$json->{'timestamp'} > $now");
>>
>> undef $message;
>> eval {
>>    local $SIG{ALRM} = sub { die "Timeout\n" };
>>    alarm 8;
>>    $message = $mq_router->recv();
>>    alarm 0;
>> };
>> is( $@, '', 'A message was received' );
>> undef $json;
>> eval { $json = decode_json( $message->{'body'} ); };
>> is( $@,                '',          'A JSON message received' );
>> is( $json->{'sender'}, SF_EXCHANGE, 'sender ' . SF_EXCHANGE );
>> is_deeply( $json->{'body'}, $sent->{'body'}, 'body the same' );
>> like( $json->{'timestamp'}, qr/^\d+$/, "timestamp an integer" );
>> ok( $json->{'timestamp'} >= $before,
>>    'timestamp greater than or equal to that of before publishing' )
>>  or diag("$json->{'timestamp'} < $before");
>> $now = timestamp();
>> ok( $json->{'timestamp'} <= $now,
>>    'timestamp less than or equal to that of now' )
>>  or diag("$json->{'timestamp'} > $now");
>>
>> undef $message;
>> eval {
>>    local $SIG{ALRM} = sub { die "Timeout\n" };
>>    alarm 8;
>>    $message = $mq_router->recv();
>>    alarm 0;
>> };
>> is( $@, '', 'A message was received' );
>> undef $json;
>> eval { $json = decode_json( $message->{'body'} ); };
>> is( $@,                '',          'A JSON message received' );
>> is( $json->{'sender'}, SF_EXCHANGE, 'sender ' . SF_EXCHANGE );
>> like( $json->{'timestamp'}, qr/^\d+$/, "timestamp an integer" );
>> ok( $json->{'timestamp'} >= $before,
>>    'timestamp greater than or equal to that of before publishing' )
>>  or diag("$json->{'timestamp'} < $before");
>> $now = timestamp();
>> ok( $json->{'timestamp'} <= $now,
>>    'timestamp less than or equal to that of now' )
>>  or diag("$json->{'timestamp'} > $now");
>> is( $json->{'body'}->{'id'}, $sent->{'body'}->{'id'}, 'id the same' );
>> is( $json->{'body'}->{'ack_type'}, 'processed', 'ack_type processed' );
>> is_deeply(
>>    $json->{'body'}->{'from'},
>>    $sent->{'body'}->{'to'},
>>    'from is the same as to of sent'
>> );
>> is( $json->{'body'}->{'type'},    'ack', 'type is ack' );
>> is( $json->{'body'}->{'version'}, 1,     'version is 1' );
>>
>> my $end = time() + 8;
>> undef $message;
>> do {
>>    eval {
>>        $message = $mq_cassidian->get( CASSIDIAN_CHANNEL, CASSIDIAN_QUEUE
>> );
>>    };
>>    if ($@) {
>>        diag($@);
>>    }
>> } until ( defined $message or time() > $end or $@ );
>> ok( defined $message, 'A message was received' );
>> undef $json;
>> eval { $json = decode_json( $message->{'body'} ); };
>> is( $@, '', 'A JSON message received' );
>> is( $json->{'sender'}, ROUTER_EXCHANGE, 'sender ' . ROUTER_EXCHANGE );
>> is_deeply( $json->{'body'}, $sent->{'body'}, 'body the same' );
>> like( $json->{'timestamp'}, qr/^\d+$/, "timestamp an integer" );
>> ok( $json->{'timestamp'} >= $before,
>>    'timestamp greater than or equal to that of before publishing' )
>>  or diag("$json->{'timestamp'} < $before");
>> $now = timestamp();
>> ok( $json->{'timestamp'} <= $now,
>>    'timestamp less than or equal to that of now' )
>>  or diag("$json->{'timestamp'} > $now");
>>
>> $end = time() + 8;
>> note("Trying to receive an Ack from Cassidian exchange");
>> undef $message;
>> do {
>>    eval {
>>        $message = $mq_cassidian->get( CASSIDIAN_CHANNEL, CASSIDIAN_QUEUE
>> );
>>    };
>>    if ($@) {
>>        diag($@);
>>    }
>> } until ( defined $message or time() > $end or $@ );
>> ok( defined $message, 'A message was received' );
>> undef $json;
>> eval { $json = decode_json( $message->{'body'} ); };
>> is( $@, '', 'A JSON message received' );
>> is( $json->{'sender'}, ROUTER_EXCHANGE, 'sender ' . ROUTER_EXCHANGE );
>> like( $json->{'timestamp'}, qr/^\d+$/, "timestamp an integer" );
>> ok( $json->{'timestamp'} >= $before,
>>    'timestamp greater than or equal to that of before publishing' )
>>  or diag("$json->{'timestamp'} < $before");
>> $now = timestamp();
>> ok( $json->{'timestamp'} <= $now,
>>    'timestamp less than or equal to that of now' )
>>  or diag("$json->{'timestamp'} > $now");
>> is( $json->{'body'}->{'id'}, $sent->{'body'}->{'id'}, 'id the same' );
>> is( $json->{'body'}->{'ack_type'}, 'processed', 'ack_type processed' );
>> is_deeply(
>>    $json->{'body'}->{'from'},
>>    $sent->{'body'}->{'to'},
>>    'from is the same as to of sent'
>> );
>> is( $json->{'body'}->{'type'},    'ack', 'type is ack' );
>> is( $json->{'body'}->{'version'}, 1,     'version is 1' );
>>
>> my $ack = '{
>> "timestamp" : 1328020064358,
>> "sender" : "' . CASSIDIAN_EXCHANGE . '",
>> "body" : {
>> "type" : "ack",
>> "version" : 1,
>> "id" : "8f970b1b-f8a3-4c78-aa24-3b8e2205648788",
>> "from" : {
>> "type" : "ssi",
>> "address" : "0"
>> },
>> "ack_type" : "sent",
>> "auxiliary" : {
>> "timestamp" : 1325376000000,
>> "original_message" : ' . encode_json( $sent->{'body'} ) . ',
>> "sdstl" : {
>> "protocol_id" : 130,
>> "message_reference" : 42,
>> "short_report_allowed" : true,
>> "protocol_data" : {
>> "encoding" : 0,
>> "timestamp" : {
>> "month" : 1,
>> "day" : 1,
>> "hour" : 0,
>> "minute" : 0
>> }
>> }
>> }
>> }
>> }
>> }';
>> $sent   = decode_json($ack);
>> $before = timestamp();
>>
>> $mq_router->publish(
>>    ROUTER_CHANNEL,
>>    '', $ack,
>>    {
>>
>>        # Options
>>        exchange => ROUTER_EXCHANGE
>>    },
>>    {
>>
>>        # Props
>>        content_encoding => "UTF-8",
>>        content_type     => "application/json"
>>    }
>> );
>>
>> undef $message;
>> eval {
>>    local $SIG{ALRM} = sub { die "Timeout\n" };
>>    alarm 8;
>>    $message = $mq_router->recv();
>>    alarm 0;
>> };
>> is( $@, '', 'A message was received' );
>> undef $json;
>> eval { $json = decode_json( $message->{'body'} ); };
>> is( $@, '', 'A JSON message received' );
>> is( $json->{'timestamp'}, $sent->{'timestamp'},
>>    'timestamp ' . $sent->{'timestamp'} )
>>  or diag( $message->{'body'} );
>> is( $json->{'sender'}, CASSIDIAN_EXCHANGE, 'sender ' . CASSIDIAN_EXCHANGE
>> )
>>  or diag( $message->{'body'} );
>> is_deeply( $json->{'body'}, $sent->{'body'}, 'body the same' )
>>  or diag( $message->{'body'} );
>>
>> undef $message;
>> eval {
>>    local $SIG{ALRM} = sub { die "Timeout\n" };
>>    alarm 8;
>>    $message = $mq_sf->recv();
>>    alarm 0;
>> };
>> is( $@, '', 'A message was received' );
>> undef $json;
>> eval { $json = decode_json( $message->{'body'} ); };
>> is( $@, '', 'A JSON message received' );
>> is( $json->{'sender'}, ROUTER_EXCHANGE, 'sender ' . ROUTER_EXCHANGE );
>> is_deeply( $json->{'body'}, $sent->{'body'}, 'body the same' );
>> like( $json->{'timestamp'}, qr/^\d+$/, "timestamp an integer" );
>> ok( $json->{'timestamp'} >= $before,
>>    'timestamp greater than or equal to that of before publishing' )
>>  or diag("$json->{'timestamp'} < $before");
>> $now = timestamp();
>> ok( $json->{'timestamp'} <= $now,
>>    'timestamp less than or equal to that of now' )
>>  or diag("$json->{'timestamp'} > $now");
>>
>> undef $message;
>> eval {
>>    local $SIG{ALRM} = sub { die "Timeout\n" };
>>    alarm 8;
>>    $message = $mq_router->recv();
>>    alarm 0;
>> };
>> is( $@, '', 'A message was received' );
>> undef $json;
>> eval { $json = decode_json( $message->{'body'} ); };
>> is( $@,                '',          'A JSON message received' );
>> is( $json->{'sender'}, SF_EXCHANGE, 'sender ' . SF_EXCHANGE );
>> is_deeply( $json->{'body'}, $sent->{'body'}, 'body the same' );
>> like( $json->{'timestamp'}, qr/^\d+$/, "timestamp an integer" );
>> ok( $json->{'timestamp'} >= $before,
>>    'timestamp greater than or equal to that of before publishing' )
>>  or diag("$json->{'timestamp'} < $before");
>> $now = timestamp();
>> ok( $json->{'timestamp'} <= $now,
>>    'timestamp less than or equal to that of now' )
>>  or diag("$json->{'timestamp'} > $now");
>>
>> undef $message;
>> eval {
>>    local $SIG{ALRM} = sub { die "Timeout\n" };
>>    alarm 8;
>>    $message = $mq_cassidian->recv();
>>    alarm 0;
>> };
>> is( $@, '', 'A message was received' );
>> undef $json;
>> eval { $json = decode_json( $message->{'body'} ); };
>> is( $@, '', 'A JSON message received' );
>> is( $json->{'sender'}, ROUTER_EXCHANGE, 'sender ' . ROUTER_EXCHANGE );
>> is_deeply( $json->{'body'}, $sent->{'body'}, 'body the same' );
>> like( $json->{'timestamp'}, qr/^\d+$/, "timestamp an integer" );
>> ok( $json->{'timestamp'} >= $before,
>>    'timestamp greater than or equal to that of before publishing' )
>>  or diag("$json->{'timestamp'} < $before");
>> $now = timestamp();
>> ok( $json->{'timestamp'} <= $now,
>>    'timestamp less than or equal to that of now' )
>>  or diag("$json->{'timestamp'} > $now");
>>
>> END {
>>    $mq_sf->queue_unbind( SF_CHANNEL, SF_QUEUE, SF_EXCHANGE, '' );
>>    $mq_router->queue_unbind( ROUTER_CHANNEL, ROUTER_QUEUE,
>> ROUTER_EXCHANGE,
>>        '' );
>>    $mq_cassidian->queue_unbind( CASSIDIAN_CHANNEL, CASSIDIAN_QUEUE,
>>        CASSIDIAN_EXCHANGE, '' );
>>    system(
>> 'service pmc-smpp start >&2; service pmc-cassidian start >&2; service
>> pmc-email start >&2'
>>    );
>> }
>>
>> regards, Matti Linnanvuori
>>
>
>
> regards, Matti Linnanvuori
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120410/daac0a98/attachment.htm>

From allanfeid at gmail.com  Tue Apr 10 17:07:25 2012
From: allanfeid at gmail.com (Allan Feid)
Date: Tue, 10 Apr 2012 09:07:25 -0700 (PDT)
Subject: [rabbitmq-discuss] http api for creating user permissions
Message-ID: <23464248.2694.1334074045184.JavaMail.geo-discussion-forums@ynlp3>

Hello,

I've been trying to use the API to create user permissions, but this seems 
to fail. According to the documentation /api/permissions/vhost/username 
should return the permissions for that user, but this fails with a 404. 
Using /api/permissions/vhost does show all the usernames properly, so I 
figured I'd try to run PUT against the username path, and that too fails 
with a 404. What is the proper request to add/change permissions for a 
user? I attempted to use /api/users/username/permissions, but that returns 
a method not allowed for PUT requests, as I expected.

Thanks,
Allan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120410/ce85ab44/attachment.htm>

From francois.beausoleil at gmail.com  Tue Apr 10 17:17:09 2012
From: francois.beausoleil at gmail.com (=?utf-8?Q?Fran=C3=A7ois_Beausoleil?=)
Date: Tue, 10 Apr 2012 12:17:09 -0400
Subject: [rabbitmq-discuss] How to plan for RAM?
In-Reply-To: <4F840C4E.5010204@rabbitmq.com>
References: <fc5397f1-1f38-4cee-8075-0ff96f3685ca@j15g2000vbt.googlegroups.com>
	<4F840C4E.5010204@rabbitmq.com>
Message-ID: <75F97CA91BE7444692D087BE4BA21EFB@gmail.com>


Le mardi 10 avril 2012 ? 06:32, Simon MacMullen a ?crit :  
> Is this with 2.8.x or earlier? Versions before 2.8.0 can use large
> amounts of memory when messages are published faster than they can be  
> routed. That doesn't sound like your situation, but it would be good to  
> eliminate it.

This is with 2.7.1, the latest available version in Ubuntu's repository.
  
> If you are using 2.8.x and seeing a large amount of RAM used, posting  
> the results of "rabbitmqctl report" would help us figure out where it is  
> going.

I'll see about an upgrade to 2.8.x.  

Thanks!
Fran?ois


From simon at rabbitmq.com  Tue Apr 10 17:21:26 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 10 Apr 2012 17:21:26 +0100
Subject: [rabbitmq-discuss] How to plan for RAM?
In-Reply-To: <75F97CA91BE7444692D087BE4BA21EFB@gmail.com>
References: <fc5397f1-1f38-4cee-8075-0ff96f3685ca@j15g2000vbt.googlegroups.com>
	<4F840C4E.5010204@rabbitmq.com>
	<75F97CA91BE7444692D087BE4BA21EFB@gmail.com>
Message-ID: <4F845E06.9040702@rabbitmq.com>

On 10/04/2012 5:17PM, Fran?ois Beausoleil wrote:
> This is with 2.7.1, the latest available version in Ubuntu's repository.

2.8.1 should get there eventually, but in the meantime you might find 
our apt repo useful - check:

http://www.rabbitmq.com/install-debian.html

Cheers, Simon

From simon at rabbitmq.com  Tue Apr 10 17:22:11 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 10 Apr 2012 17:22:11 +0100
Subject: [rabbitmq-discuss] http api for creating user permissions
In-Reply-To: <23464248.2694.1334074045184.JavaMail.geo-discussion-forums@ynlp3>
References: <23464248.2694.1334074045184.JavaMail.geo-discussion-forums@ynlp3>
Message-ID: <4F845E33.7020801@rabbitmq.com>

On 10/04/2012 5:07PM, Allan Feid wrote:
> I've been trying to use the API to create user permissions, but this
> seems to fail. According to the documentation
> /api/permissions/vhost/username should return the permissions for that
> user, but this fails with a 404. Using /api/permissions/vhost does show
> all the usernames properly, so I figured I'd try to run PUT against the
> username path, and that too fails with a 404. What is the proper request
> to add/change permissions for a user? I attempted to use
> /api/users/username/permissions, but that returns a method not allowed
> for PUT requests, as I expected.

Hi. Are you sure you are getting the username right? This works for me:

$ curl -i -u guest:guest -H "content-type:application/json" -XPUT \
   -d'{"configure":"foo","write":"bar","read":"baz"}' \
   http://localhost:55672/api/permissions/%2f/guest
HTTP/1.1 204 No Content
Server: MochiWeb/1.1 WebMachine/1.7 (participate in the frantic)
Date: Tue, 10 Apr 2012 16:15:58 GMT
Content-Type: application/json
Content-Length: 0

$ curl -i -u guest:guest -H "content-type:application/json" \
   http://localhost:55672/api/permissions/%2f/guest
HTTP/1.1 200 OK
Server: MochiWeb/1.1 WebMachine/1.7 (participate in the frantic)
Date: Tue, 10 Apr 2012 16:16:55 GMT
Content-Type: application/json
Content-Length: 73
Cache-Control: no-cache

{"user":"guest","vhost":"/","configure":"foo","write":"bar","read":"baz"}

Cheers, Simon

From fearsome.lucidity at gmail.com  Tue Apr 10 17:22:14 2012
From: fearsome.lucidity at gmail.com (Elias Levy)
Date: Tue, 10 Apr 2012 09:22:14 -0700
Subject: [rabbitmq-discuss] RabbitMQ and Erlang --enable-native-libs
In-Reply-To: <4F842E95.9010601@rabbitmq.com>
References: <CAFDmHdM1skF=+k=NXG_SWcwR-iid0vFD3-7d=vVRZPvE5eoGRg@mail.gmail.com>
	<4F69B7B6.7010309@rabbitmq.com> <4F842E95.9010601@rabbitmq.com>
Message-ID: <CAFDmHdPYtaMcDPtyk2Rfq41R0AFJKqRwf_gfGAxWqODA0N=+aw@mail.gmail.com>

On Tue, Apr 10, 2012 at 5:59 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> Aha, I got it. You need to enable HiPE compilation as well.
>
> Some *very* rough and ready testing suggests that --enable-native-libs
> delivers no measurable performance gain with HiPE off, so I guess it is
> even less likely to be useful with HiPE on. So for the time being the
> recommendation is "don't do that".
>
> But I'll poke around this, and see if we can at least get a more sensible
> error message appearing.
>

Simon,

Thanks.  Apologies for now following up and letting you know HiPE was on.

Elias
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120410/408c862f/attachment.htm>

From andrea.rosa at hp.com  Tue Apr 10 17:52:07 2012
From: andrea.rosa at hp.com (Rosa, Andrea (HP Cloud Services))
Date: Tue, 10 Apr 2012 16:52:07 +0000
Subject: [rabbitmq-discuss] service restart command hangs
Message-ID: <5F389C517756284F80239F55BCA5DDDD3695C272@G9W0721.americas.hpqcorp.net>

Hi

Sometimes when we have to restart the service of rabbitmq the command hangs: sudo service rabbitmq-server restart (sudo service rabbitmq-server stop as well)
There are no errors or strange entries in the log file, it seems that rabbitmq is busy and doesn't execute the command.
We have 2.7.1 rabbitmq version running on a Linux box.

Anyone experienced with that before?
PS to restart the service we had to kill the beam process
Thanks
--
Andrea Rosa

From james.r.carr at gmail.com  Tue Apr 10 18:53:00 2012
From: james.r.carr at gmail.com (James Carr)
Date: Tue, 10 Apr 2012 12:53:00 -0500
Subject: [rabbitmq-discuss] service restart command hangs
In-Reply-To: <5F389C517756284F80239F55BCA5DDDD3695C272@G9W0721.americas.hpqcorp.net>
References: <5F389C517756284F80239F55BCA5DDDD3695C272@G9W0721.americas.hpqcorp.net>
Message-ID: <CAJreXKDrAus8uLTUbgmnFK7wjeLiD-nZs=-NqN+StqWxcoQ9fg@mail.gmail.com>

I have encountered this on occasion but never take note of the cause. Two
months ago I made it a priority to completely diagnose the next time it
happens but it still hadn't happened yet. :)

Each time I simple did a hard kill of the beam process.

Thanks,
James


On Tue, Apr 10, 2012 at 11:52 AM, Rosa, Andrea (HP Cloud Services) <
andrea.rosa at hp.com> wrote:

> Hi
>
> Sometimes when we have to restart the service of rabbitmq the command
> hangs: sudo service rabbitmq-server restart (sudo service rabbitmq-server
> stop as well)
> There are no errors or strange entries in the log file, it seems that
> rabbitmq is busy and doesn't execute the command.
> We have 2.7.1 rabbitmq version running on a Linux box.
>
> Anyone experienced with that before?
> PS to restart the service we had to kill the beam process
> Thanks
> --
> Andrea Rosa
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120410/8c0e56f0/attachment.htm>

From tonygarnockjones+rabbitmq at gmail.com  Tue Apr 10 19:45:26 2012
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Tue, 10 Apr 2012 14:45:26 -0400
Subject: [rabbitmq-discuss] UDP exchange updated with STOMP format support
Message-ID: <CAM8fPiTNGACt+8h+n6Bd3WO6XPAWG-8AjVMu=scL-ZWd534EwQ@mail.gmail.com>

Hi all,

At the suggestion of Lionel Cons, I've added support for STOMP formatted
UDP packets to the UDP exchange. You can now send and receive single UDP
packets formatted as if they were STOMP frames. STOMP headers are mapped to
AMQP user headers.

The UDP exchange is available at https://github.com/tonyg/udp-exchange as
usual.

Feedback welcome!

Regards,
  Tony
-- 
Tony Garnock-Jones
tonygarnockjones at gmail.com
http://homepages.kcbbs.gen.nz/tonyg/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120410/e64b8cb3/attachment.htm>

From tonygarnockjones+rabbitmq at gmail.com  Tue Apr 10 20:07:39 2012
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Tue, 10 Apr 2012 15:07:39 -0400
Subject: [rabbitmq-discuss] pub/sub and disconnections handling
In-Reply-To: <jlvd9j$l8t$1@dough.gmane.org>
References: <jl4j09$4u4$1@dough.gmane.org>
	<CAM8fPiQ224jDaQAsdVtptk2SRYzB-Bmie20kx4jew8Q1dKF+kQ@mail.gmail.com>
	<jlvc2t$7qn$1@dough.gmane.org> <jlvd9j$l8t$1@dough.gmane.org>
Message-ID: <CAM8fPiRN0kZpPaHuTvRpn=ico4BFo2uZFKPAECCv82TCZNpQ=A@mail.gmail.com>

Thanks for the bug report! I've just pushed a change to the
presence-exchange which should fix the problem. Please let me know if there
are any further problems with it.

Regards,
  Tony

On 9 April 2012 15:28, Matwey V. Kornilov <matwey.kornilov at gmail.com> wrote:

>
> I think this is because of it:
>
> http://hg.rabbitmq.com/rabbitmq-server/rev/c0f389e4dd94
>
>
> rabbit_amqqueue instead of rabbit_router works for me.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Tony Garnock-Jones
tonygarnockjones at gmail.com
http://homepages.kcbbs.gen.nz/tonyg/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120410/f008bfff/attachment.htm>

From fearsome.lucidity at gmail.com  Tue Apr 10 22:46:47 2012
From: fearsome.lucidity at gmail.com (Elias Levy)
Date: Tue, 10 Apr 2012 14:46:47 -0700
Subject: [rabbitmq-discuss] More statistics via the management API
Message-ID: <CAFDmHdM27_sLFrEpx8RkTFbPhoyDqgTDAm5LXMWJTU1-Oa8pJA@mail.gmail.com>

It would be rather useful if the management API exposed more statistics.

At the moment one can obtain overall cluster message rates and message
queue depth via the /api/overview end point.  But there are not statistics
regarding the number of nodes, connections, channels, exchanges, queues,
and bindings.  We'd like to monitor these as well, particularly bindings,
since if they increase dramatically they can have a negative impact on
topic exchanges.

And now, /api/connections, /api/channels, and other such APIs that give you
a list of objects are not sufficient.  Many monitoring tools will happily
parse JSON, but they expect the statistic to be in the form of a number it
can consume, not a list of objects that needs to be further processed.

Thoughts?

Elias Levy
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120410/159e9661/attachment.htm>

From simon at rabbitmq.com  Wed Apr 11 09:58:32 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 11 Apr 2012 09:58:32 +0100
Subject: [rabbitmq-discuss] More statistics via the management API
In-Reply-To: <CAFDmHdM27_sLFrEpx8RkTFbPhoyDqgTDAm5LXMWJTU1-Oa8pJA@mail.gmail.com>
References: <CAFDmHdM27_sLFrEpx8RkTFbPhoyDqgTDAm5LXMWJTU1-Oa8pJA@mail.gmail.com>
Message-ID: <4F8547B8.2030007@rabbitmq.com>

On 10/04/2012 10:46PM, Elias Levy wrote:
> And now, /api/connections, /api/channels, and other such APIs that give
> you a list of objects are not sufficient.  Many monitoring tools will
> happily parse JSON, but they expect the statistic to be in the form of a
> number it can consume, not a list of objects that needs to
> be further processed.

Hmm, yes. I designed the HTTP API to be mostly orthogonal, but I can see 
how this would be useful and it would be pretty trivial to add. I'll 
file a bug.

Cheers, Simon

From allanfeid at gmail.com  Tue Apr 10 18:01:43 2012
From: allanfeid at gmail.com (Allan Feid)
Date: Tue, 10 Apr 2012 13:01:43 -0400
Subject: [rabbitmq-discuss] http api for creating user permissions
In-Reply-To: <4F845E33.7020801@rabbitmq.com>
References: <23464248.2694.1334074045184.JavaMail.geo-discussion-forums@ynlp3>
	<4F845E33.7020801@rabbitmq.com>
Message-ID: <CAN94UWeErNqbD3W3=EwFB1-vLhKuKskZz+NM49EgCG5r3N99Bg@mail.gmail.com>

Simon,

Looks like %2f was needed here. It was weird because my browser/ruby client
handled "/api/permissions///" just fine, but not one more level deep.

Thanks,
Allan

On Tue, Apr 10, 2012 at 12:22 PM, Simon MacMullen <simon at rabbitmq.com>wrote:

> On 10/04/2012 5:07PM, Allan Feid wrote:
>
>> I've been trying to use the API to create user permissions, but this
>> seems to fail. According to the documentation
>> /api/permissions/vhost/**username should return the permissions for that
>> user, but this fails with a 404. Using /api/permissions/vhost does show
>> all the usernames properly, so I figured I'd try to run PUT against the
>> username path, and that too fails with a 404. What is the proper request
>> to add/change permissions for a user? I attempted to use
>> /api/users/username/**permissions, but that returns a method not allowed
>> for PUT requests, as I expected.
>>
>
> Hi. Are you sure you are getting the username right? This works for me:
>
> $ curl -i -u guest:guest -H "content-type:application/**json" -XPUT \
>  -d'{"configure":"foo","write":**"bar","read":"baz"}' \
>  http://localhost:55672/api/**permissions/%2f/guest<http://localhost:55672/api/permissions/%2f/guest>
> HTTP/1.1 204 No Content
> Server: MochiWeb/1.1 WebMachine/1.7 (participate in the frantic)
> Date: Tue, 10 Apr 2012 16:15:58 GMT
> Content-Type: application/json
> Content-Length: 0
>
> $ curl -i -u guest:guest -H "content-type:application/**json" \
>  http://localhost:55672/api/**permissions/%2f/guest<http://localhost:55672/api/permissions/%2f/guest>
> HTTP/1.1 200 OK
> Server: MochiWeb/1.1 WebMachine/1.7 (participate in the frantic)
> Date: Tue, 10 Apr 2012 16:16:55 GMT
> Content-Type: application/json
> Content-Length: 73
> Cache-Control: no-cache
>
> {"user":"guest","vhost":"/","**configure":"foo","write":"bar"**
> ,"read":"baz"}
>
> Cheers, Simon
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120410/97d02b20/attachment.htm>

From matti.linnanvuori at portalify.com  Wed Apr 11 10:29:19 2012
From: matti.linnanvuori at portalify.com (Matti Linnanvuori)
Date: Wed, 11 Apr 2012 12:29:19 +0300
Subject: [rabbitmq-discuss] librabbitmq faults
In-Reply-To: <8FAD4E8C-15D1-44E8-8C39-29126DC0E686@portalify.com>
References: <BAD9CCAC-6116-4CE6-AE09-088CD6386592@portalify.com>
	<CAAt2poJxUX19CoZC6DJq7gtSzs+VTfzmhKzDTWG+Wd04zXYwcw@mail.gmail.com>
	<8FAD4E8C-15D1-44E8-8C39-29126DC0E686@portalify.com>
Message-ID: <F1D344CD-0AF0-400E-8AF9-EEFAAB8C5D45@portalify.com>

Hi!

I saw the following RabbitMQ server log entries when a Perl Net::RabbitMQ client got stuck in recv and did not receive messages that were sent to the queue that it is was consuming. The logging stopped and started again only later after ERROR REPORT, which seems to indicate some kind of error.

=INFO REPORT==== 11-Apr-2012::10:38:47 ===
Stopping Rabbit

=INFO REPORT==== 11-Apr-2012::10:38:47 ===
stopped TCP Listener on [::]:5672

=INFO REPORT==== 11-Apr-2012::10:38:47 ===
closing TCP connection <0.24489.0> from 127.0.0.1:36360

=INFO REPORT==== 11-Apr-2012::10:38:47 ===
closing TCP connection <0.24422.0> from 127.0.0.1:41128

=INFO REPORT==== 11-Apr-2012::10:38:47 ===
closing TCP connection <0.24586.0> from 127.0.0.1:40043

=INFO REPORT==== 11-Apr-2012::10:38:47 ===
closing TCP connection <0.24497.0> from 127.0.0.1:36366

=INFO REPORT==== 11-Apr-2012::10:38:47 ===
closing TCP connection <0.24560.0> from 127.0.0.1:36373

=INFO REPORT==== 11-Apr-2012::10:38:47 ===
closing TCP connection <0.24414.0> from 127.0.0.1:41127

=INFO REPORT==== 11-Apr-2012::10:38:47 ===
closing TCP connection <0.24430.0> from 127.0.0.1:41129

=INFO REPORT==== 11-Apr-2012::10:38:47 ===
closing TCP connection <0.24389.0> from 127.0.0.1:41118

=INFO REPORT==== 11-Apr-2012::10:38:47 ===
closing TCP connection <0.24476.0> from 127.0.0.1:36352

=INFO REPORT==== 11-Apr-2012::10:38:47 ===
    application: rabbit
    exited: stopped
    type: temporary

=INFO REPORT==== 11-Apr-2012::10:38:47 ===
    application: mnesia
    exited: stopped
    type: temporary

=INFO REPORT==== 11-Apr-2012::10:38:47 ===
    application: os_mon
    exited: stopped


=INFO REPORT==== 11-Apr-2012::10:38:47 ===
Halting Erlang VM

=INFO REPORT==== 11-Apr-2012::10:38:52 ===
Limiting to approx 924 file handles (829 sockets)

=INFO REPORT==== 11-Apr-2012::10:38:53 ===
Memory limit set to 373MB of 933MB total.

=INFO REPORT==== 11-Apr-2012::10:38:53 ===
msg_store_transient: using rabbit_msg_store_ets_index to provide index

=INFO REPORT==== 11-Apr-2012::10:38:53 ===
msg_store_persistent: using rabbit_msg_store_ets_index to provide index

=INFO REPORT==== 11-Apr-2012::10:38:53 ===
started TCP Listener on [::]:5672

=INFO REPORT==== 11-Apr-2012::10:38:53 ===
accepted TCP connection on [::]:5672 from 127.0.0.1:40065
=INFO REPORT==== 11-Apr-2012::10:38:53 ===
starting TCP connection <0.221.0> from 127.0.0.1:40065

=INFO REPORT==== 11-Apr-2012::10:38:54 ===
accepted TCP connection on [::]:5672 from 127.0.0.1:40066

=INFO REPORT==== 11-Apr-2012::10:38:54 ===
starting TCP connection <0.235.0> from 127.0.0.1:40066

=INFO REPORT==== 11-Apr-2012::10:38:54 ===
accepted TCP connection on [::]:5672 from 127.0.0.1:40067

=INFO REPORT==== 11-Apr-2012::10:38:54 ===
starting TCP connection <0.239.0> from 127.0.0.1:40067

=ERROR REPORT==== 11-Apr-2012::10:38:54 ===
connection <0.235.0>, channel 1 - error:
{amqp_error,not_found,"no exchange 'exchange.pmc.email-in' in vhost '/'",
            'basic.publish'}

=WARNING REPORT==== 11-Apr-2012::10:39:01 ===
exception on TCP connection <0.235.0> from 127.0.0.1:40066
connection_closed_abruptly

=INFO REPORT==== 11-Apr-2012::10:39:01 ===
closing TCP connection <0.235.0> from 127.0.0.1:40066

=INFO REPORT==== 11-Apr-2012::10:39:02 ===
accepted TCP connection on [::]:5672 from 127.0.0.1:40068

=INFO REPORT==== 11-Apr-2012::10:39:02 ===
starting TCP connection <0.260.0> from 127.0.0.1:40068

=ERROR REPORT==== 11-Apr-2012::10:39:02 ===
connection <0.260.0>, channel 1 - error:
{amqp_error,not_found,"no exchange 'exchange.pmc.email-in' in vhost '/'",
            'basic.publish'}

=INFO REPORT==== 11-Apr-2012::10:39:08 ===
accepted TCP connection on [::]:5672 from 127.0.0.1:40072

=INFO REPORT==== 11-Apr-2012::10:39:08 ===
starting TCP connection <0.277.0> from 127.0.0.1:40072

=WARNING REPORT==== 11-Apr-2012::10:41:58 ===
exception on TCP connection <0.260.0> from 127.0.0.1:40068
connection_closed_abruptly

=INFO REPORT==== 11-Apr-2012::10:41:58 ===
closing TCP connection <0.260.0> from 127.0.0.1:40068

=INFO REPORT==== 11-Apr-2012::10:41:58 ===
accepted TCP connection on [::]:5672 from 127.0.0.1:40074

=INFO REPORT==== 11-Apr-2012::10:41:58 ===
starting TCP connection <0.361.0> from 127.0.0.1:40074


From ka.fukui at ms.scsk.jp  Wed Apr 11 10:46:56 2012
From: ka.fukui at ms.scsk.jp (Katsushi Fukui)
Date: Wed, 11 Apr 2012 18:46:56 +0900
Subject: [rabbitmq-discuss] Mirrored queue failover
In-Reply-To: <4F7E5B59.4060005@ms.scsk.jp>
References: <4F7D5C28.8000202@ms.scsk.jp> <20120405112633.GA17466@rabbitmq.com>
	<4F7E5B59.4060005@ms.scsk.jp>
Message-ID: <4F855310.1050407@ms.scsk.jp>

Hi,

Additionally I noticed the result of list_queues in this situation is

# ./rabbitmqctl list_queues name pid slave_pids
Listing queues ...
que1    <rabbit at rabbit1.3.229.0>        [<rabbit at rabbit3.3.229.0>, <rabbit at rabbit2.1.229.0>]
...done.

But the result of list_queues with synchronised_slave_pids is different.

# ./rabbitmqctl list_queues name pid slave_pids synchronised_slave_pids
Listing queues ...
que1    <rabbit at rabbit1.3.229.0>        [<rabbit at rabbit2.1.229.0>]      [<rabbit at rabbit2.1.229.0>]
...done.

And when I execute list_queues with synchronised_slave_pids, the logs of rabbit3 shows the error every time.

=ERROR REPORT==== 11-Apr-2012::18:01:32 ===
Discarding message {'$gen_call',{<0.203.0>,#Ref<0.0.0.717>},info} from <0.203.0> to <0.229.0> in an old incarnation (3) of this node (2)

Anyway, the que1 will disappear if rabbit1 and rabbit2 are stopped.

kats



(2012/04/06 11:56), Katsushi Fukui wrote:
> Hi Matthew,
>
>  > So in your above example, you stopped rabbit1, which should promote
>  > rabbit2 to master (and there should be log entries indicating that).
>  > Then, even though it looks like there's no slave on rabbit3, try
>
> OK, I have already stopped rabbit1 yesterday. The current queue status is:
>
> # ./rabbitmqctl list_queues -n rabbit at rabbit3 name pid slave_pids
> Listing queues ...
> que1 <rabbit at rabbit2.2.856.0> []
> ...done.
> # ./rabbitmqctl list_queues -n rabbit at rabbit2 name pid slave_pids
> Listing queues ...
> que1 <rabbit at rabbit2.2.856.0> []
> ...done.
>
>  > stopping rabbit2 too, and see if the queue then still exists on rabbit3
>  > - eg a rabbitmqctl -n rabbit at rabbit3 list_queues, and also again check
>  > the logs of rabbit3 to see if there are messages about the promotion of
>  > a slave to master.
>
> And now, I stopped rabbit2 and checked the cluster and queue status.
>
> # ./rabbitmqctl cluster_status
> Cluster status of node rabbit at rabbit3 ...
> [{nodes,[{disc,[rabbit at rabbit3,rabbit at rabbit2,rabbit at rabbit1]}]},
> {running_nodes,[rabbit at rabbit3]}]
> ...done.
> # ./rabbitmqctl list_queues -n rabbit at rabbit3 name pid slave_pids
> Listing queues ...
> ...done.
>
> Mmm..., there is no queue. The logs of rabbit3 just said:
>
> =INFO REPORT==== 5-Apr-2012::17:06:56 ===
> rabbit on node rabbit at rabbit1 down
>
> =INFO REPORT==== 6-Apr-2012::11:26:25 ===
> rabbit on node rabbit at rabbit2 down
>
>
> Thanks,
> Kats
>
>
>
> (2012/04/05 20:26), Matthew Sackman wrote:
>> Hi Kats,
>>
>> (Just popping this back on the mailing list in case others are seeing
>> the same problem)
>>
>> On Thu, Apr 05, 2012 at 05:47:36PM +0900, Katsushi Fukui wrote:
>>> But today I re-built new 3-nodes cluster and got the same situation now (unfortunately). Attached logs.
>>>
>>> The result of list_queues are odd. Now rabbit3 has an error, and list_queues on that node shows different results.
>>> rabbit1:
>>> # ./rabbitmqctl list_queues name durable pid slave_pids synnchronised_slave_pids
>>> Listing queues ...
>>> que1 true <rabbit at rabbit1.1.578.0> [<rabbit at rabbit2.2.856.0>] [<rabbit at rabbit2.2.856.0>]
>>> ...done.
>>>
>>> rabbit2:
>>> # ./rabbitmqctl list_queues name durable pid slave_pids synnchronised_slave_pids
>>> Listing queues ...
>>> que1 true <rabbit at rabbit1.1.578.0> [<rabbit at rabbit2.2.856.0>] [<rabbit at rabbit2.2.856.0>]
>>> ...done.
>>>
>>> rabbit3:
>>> # ./rabbitmqctl list_queues name durable pid slave_pids
>>> Listing queues ...
>>> que1 true <rabbit at rabbit1.1.578.0> [<rabbit at rabbit3.3.705.0>,<rabbit at rabbit2.2.856.0>]
>>> ...done.
>>>
>>> Please check the logs rabbit1-3-script.log.
>>>
>>> If I stop rabbit1 now, the que1 loose all slaves like this:
>>> Listing queues ...
>>> que1<rabbit at rabbit2.2.856.0> []
>>> ...done.
>>
>> I think this is a mis-reporting issue actually - the errors in the logs
>> are indicating more that the querying the slaves for their status is the
>> problem, not that the slaves don't exist. That doesn't mean the slave on
>> 3 *does* exist, but the error doesn't indicate it doesn't, if you see
>> what I mean.
>>
>> Could you repeat the test, and when you get to the same situation (i.e.
>> a slave seems to have vanished), stop both of the other nodes and then
>> check the logs of the "phantom" node.
>>
>> So in your above example, you stopped rabbit1, which should promote
>> rabbit2 to master (and there should be log entries indicating that).
>> Then, even though it looks like there's no slave on rabbit3, try
>> stopping rabbit2 too, and see if the queue then still exists on rabbit3
>> - eg a rabbitmqctl -n rabbit at rabbit3 list_queues, and also again check
>> the logs of rabbit3 to see if there are messages about the promotion of
>> a slave to master.
>>
>> Matthew
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


From awilliam at whitemice.org  Wed Apr 11 11:17:20 2012
From: awilliam at whitemice.org (Adam Tauno Williams)
Date: Wed, 11 Apr 2012 06:17:20 -0400
Subject: [rabbitmq-discuss] Configuration Change Makes RabbitMQ Start Hang
Message-ID: <1334139440.2819.9.camel@workstation.wmmi.net>

My RabbitMQ node is working perfectly.

But I want RabbitMQ on my testing host to only listen on localhost.  I
can do that for Rabbit but the erlang kernel seems to always listen on
all interfaces

So I found that I can theoretically add -

{kernel,[{inet_dist_use_interface,{127,0,0,1}}]}

 - to my /etc/rabbitmq/rabbitmq.conf.  But once I do that starting
RabbitMQ just hangs. startup_err remains empty.

What is the correct way to control the interfaces used?
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 198 bytes
Desc: This is a digitally signed message part
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120411/3c43c4a8/attachment.pgp>

From awilliam at whitemice.org  Wed Apr 11 11:41:34 2012
From: awilliam at whitemice.org (Adam Tauno Williams)
Date: Wed, 11 Apr 2012 06:41:34 -0400
Subject: [rabbitmq-discuss] Configuration Change Makes RabbitMQ Start
 Hang
In-Reply-To: <1334139440.2819.9.camel@workstation.wmmi.net>
References: <1334139440.2819.9.camel@workstation.wmmi.net>
Message-ID: <1334140894.2819.12.camel@workstation.wmmi.net>

On Wed, 2012-04-11 at 06:17 -0400, Adam Tauno Williams wrote:
> My RabbitMQ node is working perfectly.
> But I want RabbitMQ on my testing host to only listen on localhost.  I
> can do that for Rabbit but the erlang kernel seems to always listen on
> all interfaces
> So I found that I can theoretically add 
> {kernel,[{inet_dist_use_interface,{127,0,0,1}}]}
>  - to my /etc/rabbitmq/rabbitmq.conf.  But once I do that starting
> RabbitMQ just hangs. startup_err remains empty.
> What is the correct way to control the interfaces used?

I can control both RabbitMQ's service and the management interface via -

  {rabbit,          [ {tcp_listeners, [{'127.0.0.1',5672}]}, ... ] },
  {rabbitmq_mochiweb, [ {listeners, [{mgmt, [{port, 55672},
                                             {ip, "127.0.0.1"}]}]}]}

- but for epmd I can't find how to configure to only listen on a
specific interface / address.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 198 bytes
Desc: This is a digitally signed message part
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120411/96d104da/attachment.pgp>

From awilliam at whitemice.org  Wed Apr 11 11:49:05 2012
From: awilliam at whitemice.org (Adam Tauno Williams)
Date: Wed, 11 Apr 2012 06:49:05 -0400
Subject: [rabbitmq-discuss] Identifying TCP Listeners.
Message-ID: <1334141345.2819.17.camel@workstation.wmmi.net>

How can I determine what 'service' is active on a port via RabbitMQ?
I've figured out all but TCP/49974

0 0.0.0.0:4369  epmd [Erlang Port Mapper]
0.0.0.0:49974   beam.smp [????]
127.0.0.1:55672 beam.smp [Management Interface]
127.0.0.1:5672  beam.smp [AMQ Broker Service]

The start-up log doesn't list this information.

The management plugin is active, which activates some other plugins.

Active plugins:
mochiweb
rabbitmq_management
rabbitmq_management_agent
rabbitmq_mochiweb
webmachine
amqp_client
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 198 bytes
Desc: This is a digitally signed message part
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120411/3d10ed52/attachment.pgp>

From emile at rabbitmq.com  Wed Apr 11 11:52:37 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 11 Apr 2012 11:52:37 +0100
Subject: [rabbitmq-discuss] Configuration Change Makes RabbitMQ Start
 Hang
In-Reply-To: <1334140894.2819.12.camel@workstation.wmmi.net>
References: <1334139440.2819.9.camel@workstation.wmmi.net>
	<1334140894.2819.12.camel@workstation.wmmi.net>
Message-ID: <4F856275.7030600@rabbitmq.com>

Hi Adam,

On 11/04/12 11:41, Adam Tauno Williams wrote:
> I can control both RabbitMQ's service and the management interface via -
> 
>   {rabbit,          [ {tcp_listeners, [{'127.0.0.1',5672}]}, ... ] },
>   {rabbitmq_mochiweb, [ {listeners, [{mgmt, [{port, 55672},
>                                              {ip, "127.0.0.1"}]}]}]}
> 
> - but for epmd I can't find how to configure to only listen on a
> specific interface / address.

For epmd you can use the following environment variables:

ERL_EPMD_ADDRESS
ERL_EPMD_PORT

See http://www.erlang.org/doc/man/epmd.html for details.

The information on setting up clustering through firewalls may also be
helpful:

http://www.rabbitmq.com/clustering.html#firewall


-Emile



From awilliam at whitemice.org  Wed Apr 11 11:52:01 2012
From: awilliam at whitemice.org (Adam Tauno Williams)
Date: Wed, 11 Apr 2012 06:52:01 -0400
Subject: [rabbitmq-discuss] Identifying TCP Listeners.
In-Reply-To: <1334141345.2819.17.camel@workstation.wmmi.net>
References: <1334141345.2819.17.camel@workstation.wmmi.net>
Message-ID: <1334141521.2819.18.camel@workstation.wmmi.net>

On Wed, 2012-04-11 at 06:49 -0400, Adam Tauno Williams wrote:
> How can I determine what 'service' is active on a port via RabbitMQ?
> I've figured out all but TCP/49974
> 0 0.0.0.0:4369  epmd [Erlang Port Mapper]
> 0.0.0.0:49974   beam.smp [????]

Actually, this port seems to 'float', as it is different every time I
restart Rabbit.

> 127.0.0.1:55672 beam.smp [Management Interface]
> 127.0.0.1:5672  beam.smp [AMQ Broker Service
> The start-up log doesn't list this information
> The management plugin is active, which activates some other plugins.
> Active plugins:
> mochiweb
> rabbitmq_management
> rabbitmq_management_agent
> rabbitmq_mochiweb
> webmachine
> amqp_client
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 198 bytes
Desc: This is a digitally signed message part
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120411/c590ecfd/attachment.pgp>

From emile at rabbitmq.com  Wed Apr 11 11:58:44 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 11 Apr 2012 11:58:44 +0100
Subject: [rabbitmq-discuss] Identifying TCP Listeners.
In-Reply-To: <1334141345.2819.17.camel@workstation.wmmi.net>
References: <1334141345.2819.17.camel@workstation.wmmi.net>
Message-ID: <4F8563E4.1040605@rabbitmq.com>

Hi Adam,

On 11/04/12 11:49, Adam Tauno Williams wrote:
> How can I determine what 'service' is active on a port via RabbitMQ?
> I've figured out all but TCP/49974
> 
> 0 0.0.0.0:4369  epmd [Erlang Port Mapper]
> 0.0.0.0:49974   beam.smp [????]
> 127.0.0.1:55672 beam.smp [Management Interface]
> 127.0.0.1:5672  beam.smp [AMQ Broker Service]
> 
> The start-up log doesn't list this information.

This is most likely the random port used for inter-node communication.
Run "epmd -names" to confirm. The kernel parameters
"inet_dist_listen_min" and "inet_dist_listen_max" control the range.

-Emile



From mikeb at rabbitmq.com  Wed Apr 11 11:59:23 2012
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Wed, 11 Apr 2012 11:59:23 +0100
Subject: [rabbitmq-discuss] Identifying TCP Listeners.
In-Reply-To: <1334141521.2819.18.camel@workstation.wmmi.net>
References: <1334141345.2819.17.camel@workstation.wmmi.net>
	<1334141521.2819.18.camel@workstation.wmmi.net>
Message-ID: <4F85640B.7020101@rabbitmq.com>

On 04/11/2012 11:52 AM, Adam Tauno Williams wrote:
> On Wed, 2012-04-11 at 06:49 -0400, Adam Tauno Williams wrote:
>> How can I determine what 'service' is active on a port via RabbitMQ?
>> I've figured out all but TCP/49974
>> 0 0.0.0.0:4369  epmd [Erlang Port Mapper]
>> 0.0.0.0:49974   beam.smp [????]
>
> Actually, this port seems to 'float', as it is different every time I
> restart Rabbit.

I expect it's Erlang distribution -- i.e., it's the port the node 
advertises in epmd so other nodes can communicate with it.

-Michael

From abdullahsaima at yahoo.com  Wed Apr 11 12:54:03 2012
From: abdullahsaima at yahoo.com (Saima Asif)
Date: Wed, 11 Apr 2012 12:54:03 +0100 (BST)
Subject: [rabbitmq-discuss] what are message attributes used by broker in
	RABBITMQ
Message-ID: <1334145243.23896.YahooMailNeo@web29703.mail.ird.yahoo.com>

Hi All,

"When publishing a message, producers may specify various?message attributes?(message meta-data). Some of this meta-data may be used by the broker, however, the rest of it is completely opaque to the broker and is only used by applications that receive the message.?"


I am concerned about what message attributes are used by message broker in AMQP 0-9 model in general??

Thanks in Advance,
?
Saima Asif
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120411/7e9f11da/attachment.htm>

From tonygarnockjones+rabbitmq at gmail.com  Wed Apr 11 12:57:24 2012
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Wed, 11 Apr 2012 07:57:24 -0400
Subject: [rabbitmq-discuss] Binary plugin files for presence and udp
	exchanges
Message-ID: <CAM8fPiTi5g5AmKD7u_-SYkj7NuWmhdfcnHQfAododih-yd2Q8g@mail.gmail.com>

Hi all,

Because a couple of people have been asking, I've made available a couple
of .ez files for the presence-exchange and udp-exchange. They were built
with Erlang R15B01 against today's tip-of-mercurial RabbitMQ sourcecode, so
they may not be for everyone, but perhaps better than nothing:

   -
   https://github.com/downloads/tonyg/presence-exchange/rabbit_presence_exchange-20120411.01.ez
   -
   https://github.com/downloads/tonyg/udp-exchange/rabbit_udp_exchange-20120411.01.ez

I can't promise to support these binaries, but if you do have any problems
with them please email me or this list and I'll see what I can do.
Regards,
  Tony
-- 
Tony Garnock-Jones
tonygarnockjones at gmail.com
http://homepages.kcbbs.gen.nz/tonyg/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120411/7e9a44d1/attachment.htm>

From videlalvaro at gmail.com  Wed Apr 11 13:01:39 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 11 Apr 2012 14:01:39 +0200
Subject: [rabbitmq-discuss] rabbitmq vector logo
Message-ID: <CAMcAHLVmZ_kQ+K+uVut85iy0zDvGG-SGVe3axnO7apB2Djq_tw@mail.gmail.com>

Hi,

A friend is asking for a vector version of the RabbitMQ logo.

Any pointers where this can be found?

Cheers,

Alvaro
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120411/a0322064/attachment.htm>

From matthew at rabbitmq.com  Wed Apr 11 13:19:39 2012
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 11 Apr 2012 13:19:39 +0100
Subject: [rabbitmq-discuss] rabbitmq vector logo
In-Reply-To: <CAMcAHLVmZ_kQ+K+uVut85iy0zDvGG-SGVe3axnO7apB2Djq_tw@mail.gmail.com>
References: <CAMcAHLVmZ_kQ+K+uVut85iy0zDvGG-SGVe3axnO7apB2Djq_tw@mail.gmail.com>
Message-ID: <20120411121938.GA26277@wellquite.org>

On Wed, Apr 11, 2012 at 02:01:39PM +0200, Alvaro Videla wrote:
> A friend is asking for a vector version of the RabbitMQ logo.
> 
> Any pointers where this can be found?

Not sure there's an official one available, but I always use SVGs in my
blog posts - if you grab one of the images from
http://www.rabbitmq.com/blog/2010/10/19/exchange-to-exchange-bindings/#more-40
and open it up in inkscape, you should be able to extract a vector
rabbit. Bit long-winded I know...

Matthew

From emile at rabbitmq.com  Wed Apr 11 13:24:19 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 11 Apr 2012 13:24:19 +0100
Subject: [rabbitmq-discuss] what are message attributes used by broker
 in RABBITMQ
In-Reply-To: <1334145243.23896.YahooMailNeo@web29703.mail.ird.yahoo.com>
References: <1334145243.23896.YahooMailNeo@web29703.mail.ird.yahoo.com>
Message-ID: <4F8577F3.3060604@rabbitmq.com>

Hi Saima,

On 11/04/12 12:54, Saima Asif wrote:
> "When publishing a message, producers may specify various /message
> attributes/ (message meta-data). Some of this meta-data may be used by
> the broker, however, the rest of it is completely opaque to the broker
> and is only used by applications that receive the message. "
> 
> I am concerned about what message attributes are used by message broker
> in AMQP 0-9 model in general? 

The delivery-mode property is used to indicate persistence requirements.
See the "Message durability" section in
http://www.rabbitmq.com/tutorials/tutorial-two-python.html for details.

The user-id property is validated only if it is supplied by the
publisher. See
http://www.rabbitmq.com/extensions.html#validated-user-id for details.

Sender-selected distribution makes use of CC and BCC headers in the
message at the time of publication. See
http://www.rabbitmq.com/extensions.html#sender-selected-distribution
for more details:


-Emile



From abdullahsaima at yahoo.com  Wed Apr 11 13:38:06 2012
From: abdullahsaima at yahoo.com (Saima Asif)
Date: Wed, 11 Apr 2012 13:38:06 +0100 (BST)
Subject: [rabbitmq-discuss] what are message attributes used by broker
	in RABBITMQ
In-Reply-To: <4F8577F3.3060604@rabbitmq.com>
References: <1334145243.23896.YahooMailNeo@web29703.mail.ird.yahoo.com>
	<4F8577F3.3060604@rabbitmq.com>
Message-ID: <1334147886.33780.YahooMailNeo@web29704.mail.ird.yahoo.com>

Dear Emile,

It means user id property, message?durability,?Sender-selected distribution is visible to broker, other than routing key. Is there any other data or property broker I means exchanges?consider?

Thanks for your reply.
?
Saima Asif


________________________________
 From: Emile Joubert <emile at rabbitmq.com>
To: Saima Asif <abdullahsaima at yahoo.com> 
Cc: "rabbitmq-discuss at lists.rabbitmq.com" <rabbitmq-discuss at lists.rabbitmq.com> 
Sent: Wednesday, 11 April 2012, 13:24
Subject: Re: [rabbitmq-discuss] what are message attributes used by broker in RABBITMQ
 
Hi Saima,

On 11/04/12 12:54, Saima Asif wrote:
> "When publishing a message, producers may specify various /message
> attributes/ (message meta-data). Some of this meta-data may be used by
> the broker, however, the rest of it is completely opaque to the broker
> and is only used by applications that receive the message. "
> 
> I am concerned about what message attributes are used by message broker
> in AMQP 0-9 model in general? 

The delivery-mode property is used to indicate persistence requirements.
See the "Message durability" section in
http://www.rabbitmq.com/tutorials/tutorial-two-python.html for details.

The user-id property is validated only if it is supplied by the
publisher. See
http://www.rabbitmq.com/extensions.html#validated-user-id for details.

Sender-selected distribution makes use of CC and BCC headers in the
message at the time of publication. See
http://www.rabbitmq.com/extensions.html#sender-selected-distribution
for more details:


-Emile
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120411/04900e1b/attachment.htm>

From videlalvaro at gmail.com  Wed Apr 11 13:42:11 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 11 Apr 2012 14:42:11 +0200
Subject: [rabbitmq-discuss] what are message attributes used by broker
	in RABBITMQ
In-Reply-To: <1334147886.33780.YahooMailNeo@web29704.mail.ird.yahoo.com>
References: <1334145243.23896.YahooMailNeo@web29703.mail.ird.yahoo.com>
	<4F8577F3.3060604@rabbitmq.com>
	<1334147886.33780.YahooMailNeo@web29704.mail.ird.yahoo.com>
Message-ID: <CAMcAHLVEB9_WsWp9_qvp1q397vEE8Cv0brq3Hzwyv0UZSMa5vw@mail.gmail.com>

Exchanges just route message based on the exchange type. For some exchange
types the routing key will be using to find matching queues.

-Alvaro

On Wed, Apr 11, 2012 at 2:38 PM, Saima Asif <abdullahsaima at yahoo.com> wrote:

> Dear Emile,
>
> It means user id property, message durability, Sender-selected
> distribution is visible to broker, other than routing key. Is there any
> other data or property broker I means exchanges consider?
>
> Thanks for your reply.
>
> Saima Asif
>   ------------------------------
> *From:* Emile Joubert <emile at rabbitmq.com>
> *To:* Saima Asif <abdullahsaima at yahoo.com>
> *Cc:* "rabbitmq-discuss at lists.rabbitmq.com" <
> rabbitmq-discuss at lists.rabbitmq.com>
> *Sent:* Wednesday, 11 April 2012, 13:24
> *Subject:* Re: [rabbitmq-discuss] what are message attributes used by
> broker in RABBITMQ
>
> Hi Saima,
>
> On 11/04/12 12:54, Saima Asif wrote:
> > "When publishing a message, producers may specify various /message
> > attributes/ (message meta-data). Some of this meta-data may be used by
> > the broker, however, the rest of it is completely opaque to the broker
> > and is only used by applications that receive the message. "
> >
> > I am concerned about what message attributes are used by message broker
> > in AMQP 0-9 model in general?
>
> The delivery-mode property is used to indicate persistence requirements.
> See the "Message durability" section in
> http://www.rabbitmq.com/tutorials/tutorial-two-python.html for details.
>
> The user-id property is validated only if it is supplied by the
> publisher. See
> http://www.rabbitmq.com/extensions.html#validated-user-id for details.
>
> Sender-selected distribution makes use of CC and BCC headers in the
> message at the time of publication. See
> http://www.rabbitmq.com/extensions.html#sender-selected-distribution
> for more details:
>
>
> -Emile
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120411/72f569c7/attachment.htm>

From tonygarnockjones+rabbitmq at gmail.com  Wed Apr 11 13:54:57 2012
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Wed, 11 Apr 2012 08:54:57 -0400
Subject: [rabbitmq-discuss] UDP exchange updated with syslog packet format
	support
Message-ID: <CAM8fPiRaGuHbqN82Qya3CjyiGrfiwYZ06zFkHXoA4OPCG3rjBw@mail.gmail.com>

Hi all,

Lionel Cons has contributed a syslog (RFC 3164) packet format for my
experimental UDP exchange.

   - https://github.com/tonyg/udp-exchange#readme
   -
   https://github.com/downloads/tonyg/udp-exchange/rabbit_udp_exchange-20120411.02.ez

Thanks, Lionel!
Regards,
  Tony
-- 
Tony Garnock-Jones
tonygarnockjones at gmail.com
http://homepages.kcbbs.gen.nz/tonyg/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120411/36783cb1/attachment.htm>

From emile at rabbitmq.com  Wed Apr 11 13:59:56 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 11 Apr 2012 13:59:56 +0100
Subject: [rabbitmq-discuss] what are message attributes used by broker
 in RABBITMQ
In-Reply-To: <1334147886.33780.YahooMailNeo@web29704.mail.ird.yahoo.com>
References: <1334145243.23896.YahooMailNeo@web29703.mail.ird.yahoo.com>
	<4F8577F3.3060604@rabbitmq.com>
	<1334147886.33780.YahooMailNeo@web29704.mail.ird.yahoo.com>
Message-ID: <4F85804C.70009@rabbitmq.com>

Hi Saima,

On 11/04/12 13:38, Saima Asif wrote:
> It means user id property, message durability, Sender-selected
> distribution is visible to broker, other than routing key. Is there any
> other data or property broker I means exchanges consider?

What I provided is a list are properties and headers that are not
completely ignored by the broker. I think the current version of the
broker (v2.8.1) ignores all other properties and headers when a message
is received from a publisher.

Your original question made no mention of routing. Messages are routed
based on routing key and the contents of the CC and BCC headers.

-Emile


From videlalvaro at gmail.com  Wed Apr 11 14:13:11 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 11 Apr 2012 15:13:11 +0200
Subject: [rabbitmq-discuss] RFC - new exchange type idea
Message-ID: <CAMcAHLU241feUdYNsZg0stpQmJk+22qTU+ipu5m9cJMJ6ewGfw@mail.gmail.com>

Hi,

I've been thinking on creating a new exchange type whose goal will be to
simplify the ways messages are routed to queues.

So now for example to publish a message to a queue I need to do something
like:

$ch->exchange_declare('foobar', 'direct');
$ch->queue_declare('foobar');
$ch->queue_bind('foobar', 'foobar');
$ch->basic_publish($msg, 'foobar');

I want to be able to do this:

$ch->exchange_declare('foobar', 'new-exchange-type');
$ch->basic_publish($msg, 'foobar');

So that means that by declaring a "foobar" exchange with the new type I
will bind a new queue to that exchange during exchange creation on the
broker side.

The queue will have similar durability properties as the exchange.

The exchange won't accept binding requests, so 1 exchange of that type will
only have 1 queue bound to it.

The idea is also to not perform any query while searching for a queue where
to route messages, so routing speed *should* be a bit faster than a normal
direct exchange.

The exchange should act basically as a direct exchange.

Then as a user of RabbitMQ that just want to have a queue server for
delayed jobs this is the most basic setup I think you can have.

BTW, I know you can publish messages to the anon exchange by using the
queue name as routing key, but this requires that particular knowledge of
AMQP.

What do you guys think?

-Alvaro
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120411/d715abbb/attachment.htm>

From simon at rabbitmq.com  Wed Apr 11 14:18:54 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 11 Apr 2012 14:18:54 +0100
Subject: [rabbitmq-discuss] RFC - new exchange type idea
In-Reply-To: <CAMcAHLU241feUdYNsZg0stpQmJk+22qTU+ipu5m9cJMJ6ewGfw@mail.gmail.com>
References: <CAMcAHLU241feUdYNsZg0stpQmJk+22qTU+ipu5m9cJMJ6ewGfw@mail.gmail.com>
Message-ID: <4F8584BE.7030906@rabbitmq.com>

On 11/04/12 14:13, Alvaro Videla wrote:
> BTW, I know you can publish messages to the anon exchange by using the
> queue name as routing key, but this requires that particular knowledge
> of AMQP.

Sorry, I don't get this argument - won't your hypothetical exchange also 
require knowledge of AMQP? What is the benefit?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From videlalvaro at gmail.com  Wed Apr 11 14:32:34 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 11 Apr 2012 15:32:34 +0200
Subject: [rabbitmq-discuss] RFC - new exchange type idea
In-Reply-To: <4F8584BE.7030906@rabbitmq.com>
References: <CAMcAHLU241feUdYNsZg0stpQmJk+22qTU+ipu5m9cJMJ6ewGfw@mail.gmail.com>
	<4F8584BE.7030906@rabbitmq.com>
Message-ID: <CAMcAHLWieUSMPnRd2HHYe91WoprodZ0Rfc2b9owYSa+0DDUobA@mail.gmail.com>

I think knowing that every queue is bound to the anon exchange using the
queue name as binding key is not what every user of RabbitMQ knows. It's
more something you learn after you been using RabbitMQ for a while.

In the case of the exchange I propose the only thing you need to know is
that there exists this other "type of exchange" that lets you do things
"this and that" way. So you declare that exchange and publish to it.

Actually some weeks ago there was a guy on twitter ranting that RabbitMQ is
not reliable: https://twitter.com/#!/davekincaid/status/184725072848764928 so
whether he's right or not (I replied to him, Alexis did as well) his rant
got me thinking on how to provide something easier for those kinds of users.

-A


On Wed, Apr 11, 2012 at 3:18 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 11/04/12 14:13, Alvaro Videla wrote:
>
>> BTW, I know you can publish messages to the anon exchange by using the
>> queue name as routing key, but this requires that particular knowledge
>> of AMQP.
>>
>
> Sorry, I don't get this argument - won't your hypothetical exchange also
> require knowledge of AMQP? What is the benefit?
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120411/c8b07840/attachment.htm>

From mikeb at rabbitmq.com  Wed Apr 11 14:39:01 2012
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Wed, 11 Apr 2012 14:39:01 +0100
Subject: [rabbitmq-discuss] RFC - new exchange type idea
In-Reply-To: <CAMcAHLWieUSMPnRd2HHYe91WoprodZ0Rfc2b9owYSa+0DDUobA@mail.gmail.com>
References: <CAMcAHLU241feUdYNsZg0stpQmJk+22qTU+ipu5m9cJMJ6ewGfw@mail.gmail.com>	<4F8584BE.7030906@rabbitmq.com>
	<CAMcAHLWieUSMPnRd2HHYe91WoprodZ0Rfc2b9owYSa+0DDUobA@mail.gmail.com>
Message-ID: <4F858975.9010608@rabbitmq.com>

On 04/11/2012 02:32 PM, Alvaro Videla wrote:
> I think knowing that every queue is bound to the anon exchange using the
> queue name as binding key is not what every user of RabbitMQ knows. It's
> more something you learn after you been using RabbitMQ for a while.
>
> In the case of the exchange I propose the only thing you need to know is
> that there exists this other "type of exchange" that lets you do things
> "this and that" way. So you declare that exchange and publish to it.

I don't know why you need a new kind of exchange for this -- isn't it 
more to do with how the "anonymous exchange" wart is exposed in APIs? 
For example, node-amqp has a `Connection#publish(queue, msg)`.

-Michael

> Actually some weeks ago there was a guy on twitter ranting that RabbitMQ
> is not reliable:
> https://twitter.com/#!/davekincaid/status/184725072848764928 so whether
> he's right or not (I replied to him, Alexis did as well) his rant got me
> thinking on how to provide something easier for those kinds of users.
>
> -A
>
>
> On Wed, Apr 11, 2012 at 3:18 PM, Simon MacMullen <simon at rabbitmq.com
> <mailto:simon at rabbitmq.com>> wrote:
>
>     On 11/04/12 14:13, Alvaro Videla wrote:
>
>         BTW, I know you can publish messages to the anon exchange by
>         using the
>         queue name as routing key, but this requires that particular
>         knowledge
>         of AMQP.
>
>
>     Sorry, I don't get this argument - won't your hypothetical exchange
>     also require knowledge of AMQP? What is the benefit?
>
>     Cheers, Simon
>
>     --
>     Simon MacMullen
>     RabbitMQ, VMware
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From videlalvaro at gmail.com  Wed Apr 11 14:42:29 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 11 Apr 2012 15:42:29 +0200
Subject: [rabbitmq-discuss] RFC - new exchange type idea
In-Reply-To: <4F858975.9010608@rabbitmq.com>
References: <CAMcAHLU241feUdYNsZg0stpQmJk+22qTU+ipu5m9cJMJ6ewGfw@mail.gmail.com>
	<4F8584BE.7030906@rabbitmq.com>
	<CAMcAHLWieUSMPnRd2HHYe91WoprodZ0Rfc2b9owYSa+0DDUobA@mail.gmail.com>
	<4F858975.9010608@rabbitmq.com>
Message-ID: <CAMcAHLUNxpdHoQbMtGK1H2j3ZvOh-JA_90X=JO1+0+CR9MtsAQ@mail.gmail.com>

I was thinking to implement this right away in the library as
well. Considering the comments I'll go that way.

Thanks!

Alvaro

On Wed, Apr 11, 2012 at 3:39 PM, Michael Bridgen <mikeb at rabbitmq.com> wrote:

> On 04/11/2012 02:32 PM, Alvaro Videla wrote:
>
>> I think knowing that every queue is bound to the anon exchange using the
>> queue name as binding key is not what every user of RabbitMQ knows. It's
>> more something you learn after you been using RabbitMQ for a while.
>>
>> In the case of the exchange I propose the only thing you need to know is
>> that there exists this other "type of exchange" that lets you do things
>> "this and that" way. So you declare that exchange and publish to it.
>>
>
> I don't know why you need a new kind of exchange for this -- isn't it more
> to do with how the "anonymous exchange" wart is exposed in APIs? For
> example, node-amqp has a `Connection#publish(queue, msg)`.
>
> -Michael
>
>  Actually some weeks ago there was a guy on twitter ranting that RabbitMQ
>> is not reliable:
>> https://twitter.com/#!/**davekincaid/status/**184725072848764928<https://twitter.com/#!/davekincaid/status/184725072848764928>so whether
>> he's right or not (I replied to him, Alexis did as well) his rant got me
>> thinking on how to provide something easier for those kinds of users.
>>
>> -A
>>
>>
>> On Wed, Apr 11, 2012 at 3:18 PM, Simon MacMullen <simon at rabbitmq.com
>> <mailto:simon at rabbitmq.com>> wrote:
>>
>>    On 11/04/12 14:13, Alvaro Videla wrote:
>>
>>        BTW, I know you can publish messages to the anon exchange by
>>        using the
>>        queue name as routing key, but this requires that particular
>>        knowledge
>>        of AMQP.
>>
>>
>>    Sorry, I don't get this argument - won't your hypothetical exchange
>>    also require knowledge of AMQP? What is the benefit?
>>
>>    Cheers, Simon
>>
>>    --
>>    Simon MacMullen
>>    RabbitMQ, VMware
>>
>>
>>
>>
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120411/a14f9797/attachment.htm>

From andrea.rosa at hp.com  Wed Apr 11 15:30:59 2012
From: andrea.rosa at hp.com (Rosa, Andrea (HP Cloud Services))
Date: Wed, 11 Apr 2012 14:30:59 +0000
Subject: [rabbitmq-discuss] service restart command hangs
In-Reply-To: <CAJreXKDrAus8uLTUbgmnFK7wjeLiD-nZs=-NqN+StqWxcoQ9fg@mail.gmail.com>
References: <5F389C517756284F80239F55BCA5DDDD3695C272@G9W0721.americas.hpqcorp.net>
	<CAJreXKDrAus8uLTUbgmnFK7wjeLiD-nZs=-NqN+StqWxcoQ9fg@mail.gmail.com>
Message-ID: <5F389C517756284F80239F55BCA5DDDD3695D9E0@G9W0721.americas.hpqcorp.net>

Hi James,

Ok thank you for your message. I hope you will not encounter that one again, but just in case let me know your diagnose ;)
--
Andrea

From: James Carr [mailto:james.r.carr at gmail.com]
Sent: 10 April 2012 18:53
To: Rosa, Andrea (HP Cloud Services)
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] service restart command hangs

I have encountered this on occasion but never take note of the cause. Two months ago I made it a priority to completely diagnose the next time it happens but it still hadn't happened yet. :)

Each time I simple did a hard kill of the beam process.

Thanks,
James

On Tue, Apr 10, 2012 at 11:52 AM, Rosa, Andrea (HP Cloud Services) <andrea.rosa at hp.com<mailto:andrea.rosa at hp.com>> wrote:
Hi

Sometimes when we have to restart the service of rabbitmq the command hangs: sudo service rabbitmq-server restart (sudo service rabbitmq-server stop as well)
There are no errors or strange entries in the log file, it seems that rabbitmq is busy and doesn't execute the command.
We have 2.7.1 rabbitmq version running on a Linux box.

Anyone experienced with that before?
PS to restart the service we had to kill the beam process
Thanks
--
Andrea Rosa
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120411/00703c87/attachment.htm>

From jasonjwwilliams at gmail.com  Wed Apr 11 17:36:10 2012
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Wed, 11 Apr 2012 10:36:10 -0600
Subject: [rabbitmq-discuss] RFC - new exchange type idea
In-Reply-To: <CAMcAHLU241feUdYNsZg0stpQmJk+22qTU+ipu5m9cJMJ6ewGfw@mail.gmail.com>
References: <CAMcAHLU241feUdYNsZg0stpQmJk+22qTU+ipu5m9cJMJ6ewGfw@mail.gmail.com>
Message-ID: <708689AA-8883-4017-BE81-5A6905CFF602@gmail.com>

I think this is a great idea. It makes it easier to on onboard those who initially need a simple message queue and end up using Redis. Whatever message queue tech people start with for their first quick and dirty needs they tend to stick with. So I think this is a great idea for getting folks converted to Rabbit early. 

Yes functionally anonymous queues function the same way, but conceptually they break the idea exchanges are where you publish messages since you supply the "empty" exchange. 

Whether its a new exchange type or a change to the library API for anonymous queues, I like the direction Alvaro's going for folks getting their feet wet. 

-J

Sent via iPhone

Is your email Premiere?

On Apr 11, 2012, at 7:13, Alvaro Videla <videlalvaro at gmail.com> wrote:

> Hi,
> 
> I've been thinking on creating a new exchange type whose goal will be to simplify the ways messages are routed to queues.
> 
> So now for example to publish a message to a queue I need to do something like:
> 
> $ch->exchange_declare('foobar', 'direct');
> $ch->queue_declare('foobar');
> $ch->queue_bind('foobar', 'foobar');
> $ch->basic_publish($msg, 'foobar');
> 
> I want to be able to do this:
> 
> $ch->exchange_declare('foobar', 'new-exchange-type');
> $ch->basic_publish($msg, 'foobar');
> 
> So that means that by declaring a "foobar" exchange with the new type I will bind a new queue to that exchange during exchange creation on the broker side.
> 
> The queue will have similar durability properties as the exchange.
> 
> The exchange won't accept binding requests, so 1 exchange of that type will only have 1 queue bound to it.
> 
> The idea is also to not perform any query while searching for a queue where to route messages, so routing speed *should* be a bit faster than a normal direct exchange.
> 
> The exchange should act basically as a direct exchange.
> 
> Then as a user of RabbitMQ that just want to have a queue server for delayed jobs this is the most basic setup I think you can have.
> 
> BTW, I know you can publish messages to the anon exchange by using the queue name as routing key, but this requires that particular knowledge of AMQP.
> 
> What do you guys think?
> 
> -Alvaro
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From awilliam at whitemice.org  Wed Apr 11 18:15:18 2012
From: awilliam at whitemice.org (Adam Tauno Williams)
Date: Wed, 11 Apr 2012 13:15:18 -0400
Subject: [rabbitmq-discuss] Identifying TCP Listeners.
In-Reply-To: <4F85640B.7020101@rabbitmq.com>
References: <1334141345.2819.17.camel@workstation.wmmi.net>
	<1334141521.2819.18.camel@workstation.wmmi.net>
	<4F85640B.7020101@rabbitmq.com>
Message-ID: <1334164518.2328.3.camel@p105s6207.site>

On Wed, 2012-04-11 at 11:59 +0100, Michael Bridgen wrote:
> On 04/11/2012 11:52 AM, Adam Tauno Williams wrote:
> > On Wed, 2012-04-11 at 06:49 -0400, Adam Tauno Williams wrote:
> >> How can I determine what 'service' is active on a port via RabbitMQ?
> >> I've figured out all but TCP/49974
> >> 0 0.0.0.0:4369  epmd [Erlang Port Mapper]
> >> 0.0.0.0:49974   beam.smp [????]
> >
> > Actually, this port seems to 'float', as it is different every time I
> > restart Rabbit.
> I expect it's Erlang distribution -- i.e., it's the port the node 
> advertises in epmd so other nodes can communicate with it.

Ah, that sound's reasonable.


From prystupa at sqlapi.com  Wed Apr 11 19:23:31 2012
From: prystupa at sqlapi.com (Eugene Prystupa)
Date: Wed, 11 Apr 2012 14:23:31 -0400
Subject: [rabbitmq-discuss] SSL-enabled AMQP driver for node.js
Message-ID: <CAFhSG_ZdB_WYvnc1vtz9+z58rV0WwS+4csu4vfkNPWzAYHheTQ@mail.gmail.com>

Hi,

Is there a way to connect to RabbitMQ over SSL from node.js? The only
driver I'm aware of is amqp-node (https://github.com/postwait/node-amqp)
and it seems like it does NOT support SSL binding.

Another question: are there plans to officially support JavaScript client
driver for Rabbit/AMQP?

Thanks,
Eugene
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120411/dd554517/attachment.htm>

From awilliam at whitemice.org  Wed Apr 11 18:32:44 2012
From: awilliam at whitemice.org (Adam Tauno Williams)
Date: Wed, 11 Apr 2012 13:32:44 -0400
Subject: [rabbitmq-discuss] Identifying TCP Listeners.
In-Reply-To: <1334164518.2328.3.camel@p105s6207.site>
References: <1334141345.2819.17.camel@workstation.wmmi.net>
	<1334141521.2819.18.camel@workstation.wmmi.net>
	<4F85640B.7020101@rabbitmq.com>
	<1334164518.2328.3.camel@p105s6207.site>
Message-ID: <1334165564.3639.3.camel@p105s6207.site>

On Wed, 2012-04-11 at 13:15 -0400, Adam Tauno Williams wrote:
> On Wed, 2012-04-11 at 11:59 +0100, Michael Bridgen wrote:
> > On 04/11/2012 11:52 AM, Adam Tauno Williams wrote:
> > > On Wed, 2012-04-11 at 06:49 -0400, Adam Tauno Williams wrote:
> > >> How can I determine what 'service' is active on a port via RabbitMQ?
> > >> I've figured out all but TCP/49974
> > >> 0 0.0.0.0:4369  epmd [Erlang Port Mapper]
> > >> 0.0.0.0:49974   beam.smp [????]
> > >
> > > Actually, this port seems to 'float', as it is different every time I
> > > restart Rabbit.
> > I expect it's Erlang distribution -- i.e., it's the port the node 
> > advertises in epmd so other nodes can communicate with it.
> 
> Ah, that sound's reasonable.
> 
> From netstat:
> tcp   0   0 0.0.0.0:50000  0.0.0.0:*    LISTEN      1434/beam.smp       
> tcp   0   0 0.0.0.0:4369   0.0.0.0:*    LISTEN      1296/epmd           
> tcp   0   0 0.0.0.0:55672  0.0.0.0:*    LISTEN      1434/beam.smp       
> tcp   0   0 127.0.0.1:5672 0.0.0.0:*    LISTEN      1434/beam.smp 
> 
> Are there any configuration parameters to control how that port is
> bound, selected, or published?

With - 
rabbitmq-server-2.8.1-1.suse.noarch
erlang-R15B-2.1.i586
 - I can specify -
{
  kernel, [ {inet_dist_use_interface, [ {"127.0.0.1"} ] } ]
 }
 - /etc/rabbitmq/rabbitmq.config  and the server still starts, but it
has no effect on how the epmd or beam.smp bind.




From rcrespopanizo at gmail.com  Thu Apr 12 08:33:02 2012
From: rcrespopanizo at gmail.com (Rabbit001)
Date: Thu, 12 Apr 2012 00:33:02 -0700 (PDT)
Subject: [rabbitmq-discuss] Client connection to ssl rabbitMQ is very
 slow
In-Reply-To: <CAFPidkNfqQGF-KzGausip0hM2hMne1SkzjzGzwULrA6q3Gto5A@mail.gmail.com>
References: <33544994.post@talk.nabble.com> <4F7C25DE.40703@rabbitmq.com>
	<CAFPidkNoJoK5PqLoaxqntvEs+E3X3uYrabVU+rkJYsqxyL9ymA@mail.gmail.com>
	<33654326.post@talk.nabble.com> <4F840CF4.5050002@rabbitmq.com>
	<CAFPidkNfqQGF-KzGausip0hM2hMne1SkzjzGzwULrA6q3Gto5A@mail.gmail.com>
Message-ID: <33673563.post@talk.nabble.com>


I'm confused, with your instructions my client agent display this messages in
ssl debug mode,

trigger seeding of SecureRandom
done seeding SecureRandom
Allow unsafe renegotiation: false
Allow legacy hello messages: true
Is initial handshake: true
Is secure renegotiation: false
main, setSoTimeout(10000) called
%% No cached client session
*** ClientHello, TLSv1
RandomCookie:  GMT: 1317372735 bytes = { 76, 106, 8, 15, 157, 169, 170, 81,
26, 139, 188, 38, 162, 78, 118, 72, 247, 33, 111, 100, 141, 102, 119, 16,
87, 139, 107, 190 }
Session ID:  {}
Cipher Suites: [SSL_RSA_WITH_RC4_128_MD5, SSL_RSA_WITH_RC4_128_SHA,
TLS_RSA_WITH_AES_128_CBC_SHA, TLS_DHE_RSA_WITH_AES_128_CBC_SHA,
TLS_DHE_DSS_WITH_AES_128_CBC_SHA, SSL_RSA_WITH_3DES_EDE_CBC_SHA,
SSL_DHE_RSA_WITH_3DES_EDE_CBC_SHA, SSL_DHE_DSS_WITH_3DES_EDE_CBC_SHA,
SSL_RSA_WITH_DES_CBC_SHA, SSL_DHE_RSA_WITH_DES_CBC_SHA,
SSL_DHE_DSS_WITH_DES_CBC_SHA, SSL_RSA_EXPORT_WITH_RC4_40_MD5,
SSL_RSA_EXPORT_WITH_DES40_CBC_SHA, SSL_DHE_RSA_EXPORT_WITH_DES40_CBC_SHA,
SSL_DHE_DSS_EXPORT_WITH_DES40_CBC_SHA, TLS_EMPTY_RENEGOTIATION_INFO_SCSV]
Compression Methods:  { 0 }
***
main, WRITE: TLSv1 Handshake, length = 75
main, WRITE: SSLv2 client hello message, length = 101
main, READ: TLSv1 Handshake, length = 74
*** ServerHello, TLSv1
RandomCookie:  GMT: 1317372729 bytes = { 156, 148, 232, 187, 191, 145, 24,
28, 51, 155, 203, 236, 126, 135, 166, 157, 173, 90, 220, 10, 160, 177, 84,
67, 152, 90, 78, 194 }
Session ID:  {37, 88, 220, 40, 149, 121, 218, 58, 162, 191, 87, 212, 201,
16, 131, 216, 98, 63, 205, 168, 46, 58, 53, 213, 238, 228, 205, 71, 4, 245,
227, 129}
Cipher Suite: SSL_RSA_WITH_RC4_128_MD5
Compression Method: 0
***
Warning: No renegotiation indication extension in ServerHello
%% Created:  [Session-1, SSL_RSA_WITH_RC4_128_MD5]
** SSL_RSA_WITH_RC4_128_MD5
main, READ: TLSv1 Handshake, length = 1474
*** Certificate chain
chain [0] = [
[
  Version: V3
  Subject: O=server, CN=MdpQueue
  Signature Algorithm: SHA1withRSA, OID = 1.2.840.113549.1.1.5

  Key:  Sun RSA public key, 2048 bits
  modulus:
24334987968930982943981825187475436299008497607561573573631523764564684548469811266648724448544625619306915448884829059653148026682713134819159622851610665802136344975591672757687667031687154387433867924238004953412446642508173836476637867784982543240635609951624723163538133830316073386671198648519063730784583506433654210317223494465395785490801263975472397303659595998370054145999922092449831111420053502703651377024865842207190113400021631570198643096824223092956683480679689104179006662881694541917547715526331703763768468498407847738764426243314732078926021142975650072247517108406152577606651997494500325440503
  public exponent: 65537
  Validity: [From: Mon Apr 02 09:07:49 CEST 2012,
               To: Tue Apr 02 09:07:49 CEST 2013]
  Issuer: CN=rabbitMQCa
  SerialNumber: [    01]

Certificate Extensions: 3
[1]: ObjectId: 2.5.29.37 Criticality=false
ExtendedKeyUsages [
  serverAuth
]

[2]: ObjectId: 2.5.29.15 Criticality=false
KeyUsage [
  Key_Encipherment
]

[3]: ObjectId: 2.5.29.19 Criticality=false
BasicConstraints:[
  CA:false
  PathLen: undefined
]

]
  Algorithm: [SHA1withRSA]
  Signature:
0000: 7B C4 2B 9D 9D 4C 3E AB   6E CF 6D 5B FC A3 FC 8D  ..+..L>.n.m[....
0010: 0D AB 56 4C A6 92 E4 17   17 AD BA 1C F4 3F 2D 50  ..VL.........?-P
0020: 5B F8 1D 41 9B 64 BA E0   B5 D8 DC 18 23 D4 40 F7  [..A.d......#. at .
0030: BB B7 C2 4A D7 4F 11 97   43 31 72 72 10 49 0E 0E  ...J.O..C1rr.I..
0040: AA F8 FF 99 34 F3 20 FC   40 FE A2 81 52 BE 2C 00  ....4. . at ...R.,.
0050: 33 9C FE F1 07 16 0B 33   95 5A C4 06 45 E0 3E 09  3......3.Z..E.>.
0060: E4 CB D0 5A 46 7B D0 78   0C 8B A0 C3 CA C5 E2 5E  ...ZF..x.......^
0070: 54 40 1F 1E 66 BE EE FE   08 01 E0 1E 26 D3 01 40  T at ..f.......&..@
0080: 00 DD 45 D6 8F 93 98 E6   B8 0F D2 61 AD 92 18 EC  ..E........a....
0090: 82 DC 3B 79 A6 05 52 43   3F 8D 9F E7 04 6B B4 86  ..;y..RC?....k..
00A0: 94 BB 95 F3 7D 63 81 FB   68 24 12 C7 75 BB D9 A2  .....c..h$..u...
00B0: A0 2A 97 47 73 46 72 0D   9B 03 B1 67 29 72 EA 4F  .*.GsFr....g)r.O
00C0: 6F CC 79 99 22 6D CC 59   3E EC 03 BE 29 41 89 78  o.y."m.Y>...)A.x
00D0: 6B DE F0 CD F6 F6 B6 6A   72 73 3B 3C B6 6A 44 A3  k......jrs;<.jD.
00E0: 49 C8 D3 FF 3A 70 15 E3   21 F5 72 23 4C 01 A1 03  I...:p..!.r#L...
00F0: 28 ED EE D4 DF 6A 9B 46   C8 D4 87 04 BA BC 69 EF  (....j.F......i.

]
chain [1] = [
[
  Version: V3
  Subject: CN=rabbitMQCa
  Signature Algorithm: SHA1withRSA, OID = 1.2.840.113549.1.1.5

  Key:  Sun RSA public key, 2048 bits
  modulus:
18248746087467252200944236832325278424669636151934770607412859044474223256189932855084016557855926613771028068656808036187947675937254796758195884535556914971667322865350982711031725796002558363209549109860397534076839586787095955246512345600254524286338875779345081458059658636195587370951763953299337439192950834178442581857332221418797812357302842100055837043461572333613052191364110791214387914869357781679072330997864692304194270929303923018766081122118475979404194228545380152289084703482584350985406029286974099362125142672271699924650060974298570867776059293459310888926049474632091997882856434952322556490083
  public exponent: 65537
  Validity: [From: Mon Apr 02 09:02:32 CEST 2012,
               To: Tue Apr 02 09:02:32 CEST 2013]
  Issuer: CN=rabbitMQCa
  SerialNumber: [    a653d3dc a21770c5]

Certificate Extensions: 2
[1]: ObjectId: 2.5.29.15 Criticality=false
KeyUsage [
  Key_CertSign
  Crl_Sign
]

[2]: ObjectId: 2.5.29.19 Criticality=false
BasicConstraints:[
  CA:true
  PathLen:2147483647
]

]
  Algorithm: [SHA1withRSA]
  Signature:
0000: 32 15 CE 98 8E B3 AF 10   CD C1 70 4F 93 4A 8D 89  2.........pO.J..
0010: 8C 07 4B 7A 65 25 4B 23   4F 84 43 D5 52 43 73 D1  ..Kze%K#O.C.RCs.
0020: 29 AA 90 2C 0E 1F 9C 72   7C 26 5E F5 20 6D 25 EF  )..,...r.&^. m%.
0030: 75 DF 70 C0 9F A5 21 97   6F 70 3A 43 F9 36 83 5E  u.p...!.op:C.6.^
0040: 7A F1 F0 5C BE 05 BF 22   15 A9 D0 A1 E5 4F 91 B8  z..\...".....O..
0050: A3 4F F4 86 65 62 1D 44   0E C0 DC D9 3C 0F F0 5D  .O..eb.D....<..]
0060: 18 38 36 FA 94 DB C0 34   E2 0F 93 92 6C 8F 60 50  .86....4....l.`P
0070: 22 DB 25 F9 57 2D C3 12   A7 9E D9 7D 7D AC 15 CE  ".%.W-..........
0080: FC 1D C8 78 C8 40 BA A7   A3 46 05 E2 4D CC 8D 9E  ...x. at ...F..M...
0090: 5D 15 31 BD C4 A7 52 74   E0 AF BC A2 E3 86 F7 16  ].1...Rt........
00A0: 3A D4 3A 19 90 E7 07 91   85 3E 56 F7 55 57 8B 58  :.:......>V.UW.X
00B0: F7 D4 51 C2 3F 73 6E A7   3B 71 76 09 79 D6 13 29  ..Q.?sn.;qv.y..)
00C0: C5 43 7A 2C 03 C2 02 A9   E2 90 4C 86 A9 90 19 BC  .Cz,......L.....
00D0: 29 47 8B 7F 84 88 8A 69   D1 1B C0 32 3F 1C 3C 00  )G.....i...2?.<.
00E0: 8B 43 9F 6B 43 C1 A3 A6   D3 6A 52 E7 90 16 F0 D1  .C.kC....jR.....
00F0: 7D D3 BB B0 0E 34 79 99   85 26 84 0B B9 2E 7D 39  .....4y..&.....9

]
***
main, READ: TLSv1 Handshake, length = 8
*** CertificateRequest
Cert Types: RSA
Cert Authorities:
main, READ: TLSv1 Handshake, length = 4
*** ServerHelloDone
*** Certificate chain
***
*** ClientKeyExchange, RSA PreMasterSecret, TLSv1
main, WRITE: TLSv1 Handshake, length = 269
SESSION KEYGEN:
PreMaster Secret:
0000: 03 01 A6 30 EE 15 4D BA   4B C3 28 3C AA 71 2A 19  ...0..M.K.(<.q*.
0010: 57 29 F8 72 E5 D8 1F DE   60 B1 E3 18 DB 8A 95 CF  W).r....`.......
0020: AA BE 58 97 A3 86 87 62   D4 94 C0 73 1B 50 E2 83  ..X....b...s.P..
CONNECTION KEYGEN:
Client Nonce:
0000: 4F 86 83 3F 4C 6A 08 0F   9D A9 AA 51 1A 8B BC 26  O..?Lj.....Q...&
0010: A2 4E 76 48 F7 21 6F 64   8D 66 77 10 57 8B 6B BE  .NvH.!od.fw.W.k.
Server Nonce:
0000: 4F 86 83 39 9C 94 E8 BB   BF 91 18 1C 33 9B CB EC  O..9........3...
0010: 7E 87 A6 9D AD 5A DC 0A   A0 B1 54 43 98 5A 4E C2  .....Z....TC.ZN.
Master Secret:
0000: 19 C9 FE 4C 06 78 77 F0   5E 95 31 07 25 C3 42 DA  ...L.xw.^.1.%.B.
0010: B4 FE D0 94 F7 90 FB CC   4C B7 1B 5F D7 B0 CD E9  ........L.._....
0020: DA 76 1E 78 00 A1 F7 69   A6 F1 A6 A0 72 2B E8 CE  .v.x...i....r+..
Client MAC write Secret:
0000: CD E7 47 FE 44 19 51 83   6D EE 0D AA 9E 01 2C 04  ..G.D.Q.m.....,.
Server MAC write Secret:
0000: 46 64 25 F9 F6 84 6C BD   85 E2 5C 89 EA 05 C2 AE  Fd%...l...\.....
Client write key:
0000: 4E 69 00 96 E5 D5 B1 AB   95 49 D6 CC 1C F4 13 06  Ni.......I......
Server write key:
0000: 9C 04 F6 18 1D E2 76 00   21 4E 3A 1A 06 5F DA F2  ......v.!N:.._..
... no IV used for this cipher
main, WRITE: TLSv1 Change Cipher Spec, length = 1
*** Finished
verify_data:  { 57, 44, 198, 169, 225, 7, 158, 86, 155, 62, 36, 88 }
***
main, WRITE: TLSv1 Handshake, length = 32
main, READ: TLSv1 Change Cipher Spec, length = 1
main, READ: TLSv1 Handshake, length = 32
*** Finished
verify_data:  { 162, 42, 28, 39, 215, 24, 120, 234, 180, 131, 242, 240 }
***
%% Cached client session: [Session-1, SSL_RSA_WITH_RC4_128_MD5]
main, WRITE: TLSv1 Application Data, length = 24
AMQP Connection 172.30.34.11:5671, READ: TLSv1 Application Data, length =
351
main, WRITE: TLSv1 Application Data, length = 343
AMQP Connection 172.30.34.11:5671, READ: TLSv1 Application Data, length = 36
main, setSoTimeout(0) called
main, WRITE: TLSv1 Application Data, length = 36
main, WRITE: TLSv1 Application Data, length = 32
AMQP Connection 172.30.34.11:5671, READ: TLSv1 Application Data, length = 29
main, WRITE: TLSv1 Application Data, length = 29
AMQP Connection 172.30.34.11:5671, READ: TLSv1 Application Data, length = 32
main, WRITE: TLSv1 Application Data, length = 39
main, WRITE: TLSv1 Application Data, length = 38
main, WRITE: TLSv1 Application Data, length = 36
 Tiempo: (1) 5246
 Tiempo: (2) 24
 Tiempo: (3) 4
main, WRITE: TLSv1 Application Data, length = 37
AMQP Connection 172.30.34.11:5671, READ: TLSv1 Application Data, length = 28
main, WRITE: TLSv1 Application Data, length = 37
AMQP Connection 172.30.34.11:5671, READ: TLSv1 Application Data, length = 28
AMQP Connection 172.30.34.11:5671, called close()
main, called close()
main, called closeInternal(true)
AMQP Connection 172.30.34.11:5671, called closeInternal(true)
main, SEND TLSv1 ALERT:  warning, description = close_notify
main, WRITE: TLSv1 Alert, length = 18
AMQP Connection 172.30.34.11:5671, close invoked again; state = 7
AMQP Connection 172.30.34.11:5671, after primary close; state = 7

The connection has been established over  SSL_RSA_WITH_RC4_128_MD5, but the
response time before the connection has been established was  "Tiempo: (1)
5246" (miliseconds). It's not acceptable. My client agent code is,


import com.rabbitmq.client.*;

public class RabbitMQSSLSample {
	public static void main(String[] args) throws Exception {

		System.setProperty("javax.net.debug", "ssl");
		ConnectionFactory factory = new ConnectionFactory();
		factory.setHost("172.30.34.11");
		factory.setPort(5671);
		factory.setVirtualHost("/");
		// Tells the library to setup the default Key and Trust managers for you

		factory.useSslProtocol("TLS"); // which do not do any form of remote
										// server trust verification
		long time1 = System.currentTimeMillis();

		Connection conn = factory.newConnection();
		long time2 = System.currentTimeMillis();
		Channel channel = conn.createChannel();
		long time3 = System.currentTimeMillis();
		// non-durable, exclusive, auto-delete queue
		// channel.queueDeclare("sample", false, true, true, null);
		channel.basicPublish("", "sample", null, "Hello, World".getBytes());

		/*
		 * GetResponse chResponse = channel.basicGet("sample", false);
		 * if(chResponse == null) { System.out.println("No message retrieved");
		 * } else { byte[] body = chResponse.getBody();
		 * channel.basicAck(chResponse.getEnvelope().getDeliveryTag(), false);
		 * System.out.println("Recieved: " + new String(body)); }
		 */
		System.out.println(" Tiempo: (1) "
				+ (System.currentTimeMillis() - time1));
		System.out.println(" Tiempo: (2) "
				+ (System.currentTimeMillis() - time2));
		System.out.println(" Tiempo: (3) "
				+ (System.currentTimeMillis() - time3));

		channel.close();
		conn.close();
	}
}

Thanks again for your help,

Best Regards,


Carl H?rberg wrote:
> 
> hum.. the client seems to support rsa aes 128 sha, but try to add some
> more like:
> 
> {ciphers,[{rsa,aes_128_cbc,sha},{rsa,rc4_128,md5},{rsa,rc4_128,sha}]}
> 
> 
> On Tue, Apr 10, 2012 at 12:35, Emile Joubert <emile at rabbitmq.com> wrote:
>> Hi,
>>
>> On 09/04/12 08:23, Rabbit001 wrote:
>>> I follow your instructions and I've modified rabbitmq.config and put
>>> {ciphers,[{rsa,aes_128_cbc,sha}]}. The server starts correctly but my
>>> client
>>> display this error,
>>
>> The broker will stand a better chance of being able to negotiate a
>> cipher with the client if it offers more than one. Select some more from
>> the supported broker ciphers (reported by ssl:cipher_suites/0), avoiding
>> slow ones (like triple DES) and including at least one that is
>> compatible with your client.
>>
>>
>> -Emile
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://old.nabble.com/Client-connection-to-ssl-rabbitMQ-is-very-slow-tp33544994p33673563.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From emile at rabbitmq.com  Thu Apr 12 10:21:35 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 12 Apr 2012 10:21:35 +0100
Subject: [rabbitmq-discuss] Client connection to ssl rabbitMQ is very
 slow
In-Reply-To: <33673563.post@talk.nabble.com>
References: <33544994.post@talk.nabble.com> <4F7C25DE.40703@rabbitmq.com>
	<CAFPidkNoJoK5PqLoaxqntvEs+E3X3uYrabVU+rkJYsqxyL9ymA@mail.gmail.com>
	<33654326.post@talk.nabble.com> <4F840CF4.5050002@rabbitmq.com>
	<CAFPidkNfqQGF-KzGausip0hM2hMne1SkzjzGzwULrA6q3Gto5A@mail.gmail.com>
	<33673563.post@talk.nabble.com>
Message-ID: <4F869E9F.8030601@rabbitmq.com>

Hi,

On 12/04/12 08:33, Rabbit001 wrote:
> I'm confused, with your instructions my client agent display this messages in
> ssl debug mode,

RC4 has serious weaknesses and is not recommended for new systems.

The output you sent has no timestamps, so it is not possible to
determine whether any steps were responsible for a disproportionate delay.

As previously suggested, measure and compare the SSL connection
establishment time with OpenSSL s_client and s_server, and inspect the
output of an SSL analyser (e.g. ssldump).

You may also want to trace all traffic from the client and broker to the
Internet to check whether the delay is possibly due to a DNS timeout.


-Emile



From majek04 at gmail.com  Thu Apr 12 11:04:13 2012
From: majek04 at gmail.com (Marek Majkowski)
Date: Thu, 12 Apr 2012 11:04:13 +0100
Subject: [rabbitmq-discuss] SSL-enabled AMQP driver for node.js
In-Reply-To: <CAFhSG_ZdB_WYvnc1vtz9+z58rV0WwS+4csu4vfkNPWzAYHheTQ@mail.gmail.com>
References: <CAFhSG_ZdB_WYvnc1vtz9+z58rV0WwS+4csu4vfkNPWzAYHheTQ@mail.gmail.com>
Message-ID: <CABzX+qyxKm7sgb1rdveYOoHQw5eKmdHRPa3v+vW8+RjN5VFxBQ@mail.gmail.com>

On Wed, Apr 11, 2012 at 19:23, Eugene Prystupa <prystupa at sqlapi.com> wrote:
> Is there a way to connect to RabbitMQ over SSL from node.js? The only driver
> I'm aware of is amqp-node (https://github.com/postwait/node-amqp) and it
> seems like it does NOT support SSL binding.

Not that I know of.

The code looks quite integrated with net.Stream, so adding SSL
support may not be trivial. This seems to be the core:
   https://github.com/postwait/node-amqp/blob/master/amqp.js#L847

Another alternative is to use stunnel in client mode on your client host.

> Another question: are there plans to officially support JavaScript client
> driver for Rabbit/AMQP?

Nope. node-amqp with all it's problems it's doing it's job well.

Marek

From md.nazeem at gmail.com  Thu Apr 12 05:42:20 2012
From: md.nazeem at gmail.com (cresc)
Date: Wed, 11 Apr 2012 21:42:20 -0700 (PDT)
Subject: [rabbitmq-discuss]  service oriented design
Message-ID: <33672799.post@talk.nabble.com>


I would like to understand which approach suits the best to manage the below
scenario.

Say for example there are 25 applications mostly in java and are web based
deployed across different platforms jboss, websphere & tomcat. Each
application exposes 3 -5 services and also consumes services from other
applications. Most of them are synchronous and are triggered on need basis.
Some of the use cases below,

When a patient is admitted, this sends out message to 4 -5 systems which are
interested in admission detail (sync).
Billing system send detail to another system to calculate the discount
(sync)
Get Patient detail by passing the id. (sync)
So if u try to represent the whole diagram in a picutre if will be like so
many hardcoded static lines between each and every system.

The problems 1. No common way to find the health of each systems or web
services until the user complains some thing not working.

Too many web services and end points to keep track off.

Implemented across diff standards JAX-wS, Jax-RS, due to diff application
servers and containers.

Some messages are identical with slightly different details. Thus
reusability is reduced and end up coming up with new service for each custom
requirement.

Solutions What kind of solutions better suites to address the above issues ?

Thank you for ur time.

Regards, Naz
-- 
View this message in context: http://old.nabble.com/service-oriented-design-tp33672799p33672799.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From matt.wolf74 at gmail.com  Thu Apr 12 07:30:24 2012
From: matt.wolf74 at gmail.com (Matt)
Date: Wed, 11 Apr 2012 23:30:24 -0700 (PDT)
Subject: [rabbitmq-discuss] What is the currently fastest way to stream
	messages?
Message-ID: <9029879.56.1334212224976.JavaMail.geo-discussion-forums@pbtr10>

Hello,

I am working on a project with one producer, one consumer that need to pass 
messages over the localhost (inter-process). I am targeting C# .Net4.5(4.0 
also fine). I look for a way to published raw byte[] (size of each 16 
bytes) messages, but I can chunk up the byte[] into larger sizes and send. 
The order of the sent messages must be preserved. Otherwise, I look to go 
as lightweight as possible, disabling any parsing, 
serialization/deserialization, no persistence, no guaranteed message 
delivery needed, just as fast as possible. I managed to push 45mb /sec over 
the bus but maxed out beyond that. 

What message pattern would you suggest I look more closely at, what 
parameters would I want to tune/check, is there a way to go brokerless for 
throughput optimization, can amqp message parsing be turned off (I read its 
a major bottleneck and design flaw how the amqp parser works), can I omit 
queues, will turning off ackq speed things up? Basically anything than can 
get my throughput up is highly welcomed. I understand I will not be able to 
reach ZeroMQs throughput rates because its a brokerless solution but I like 
RabbitMQ and its mature enough to run in production and this pub/sub 
pattern is only one of the many other message patterns that I use and where 
throughputs are not critical. But this byte array stream is throughput 
critical and I would appreciate any comments how to tune this. 

Thanks
Matt



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120411/4584bf17/attachment.htm>

From vagif.abilov at gmail.com  Thu Apr 12 11:09:19 2012
From: vagif.abilov at gmail.com (object)
Date: Thu, 12 Apr 2012 03:09:19 -0700 (PDT)
Subject: [rabbitmq-discuss] Unable to use different .erlang.cookie file
Message-ID: <b1f33335-679c-4640-85a3-9c564abc7ee5@h5g2000vbx.googlegroups.com>

Hello,

I am trying to set up a RabbitMQ cluster on Windows servers, and this
requires using shared Erlang cookie file. According to the
documentation, all I need to do is to ensure that the root <user>
directories on different machines contain the same .erlang.cookie
file. So what I did is found these files on both machines and
overwrote them with the same shared version.

After that all rabbitmqctl commands failed on the machine with new
file version with "unable to connect to node..." error message. I
tried to restart RabbitMQ Windows service, but still rabbitmqctl
complained. I even reinstalled RabbitMQ on that machine, but
then .erlang.cookie was reset back to the old version. Whenever I
tried to use new version of cookie file, rabbitmqctl failed. When I
restored an old version, it worked fine.

Basically I am stuck and can not proceed with cluster setup until I
resolve this issue. Any help is appreciated.

Thanks in advance

Vagif

From d.pakhovskiy at eastwind.ru  Thu Apr 12 11:11:29 2012
From: d.pakhovskiy at eastwind.ru (=?koi8-r?B?8MHIz9fTy8nKIOTNydTSyco=?=)
Date: Thu, 12 Apr 2012 10:11:29 +0000
Subject: [rabbitmq-discuss] AMQP connection close in WCF
Message-ID: <8C1988E91F870147A36A50E5881B815703C24828@exchange-node-a.eastwind.ru>

Hello!

I use Rabbit with WCF. When I create a proxy, AMQP connection is established. But when I dispose(or close or abort - behavior is the same) the proxy,
AMQP connection isn`t broken.

Here is an example:

using (var proxy = new TestRabbitServiceClient())
{
   proxy.DoSmth();
}
// the connection is still alive!

I dug into RabbitMQ.ServiceModel and discovered that connection is set to AutoClose (RabbitMQTransportBindingElement.InternalOpen()).
The RabbitMQTransportBindingElement.Close() method closes the channel so the connection should be closed too (because of AutoClose).
I put the breakpoint on RabbitMQTransportBindingElement.Close(), where the channel should be closed, and started debug.
But the method didn`t invoke when TestRabbitServiceClient.Dispose() was invoked!
Could you explain this behavior of RabbitMQ.ServiceModel? How can I force closing the connection?

Thanks!
Dmitry.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120412/175676fe/attachment.htm>

From simon at rabbitmq.com  Thu Apr 12 11:57:13 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 12 Apr 2012 11:57:13 +0100
Subject: [rabbitmq-discuss] Unable to use different .erlang.cookie file
In-Reply-To: <b1f33335-679c-4640-85a3-9c564abc7ee5@h5g2000vbx.googlegroups.com>
References: <b1f33335-679c-4640-85a3-9c564abc7ee5@h5g2000vbx.googlegroups.com>
Message-ID: <4F86B509.7030204@rabbitmq.com>

On 12/04/12 11:09, object wrote:
> After that all rabbitmqctl commands failed on the machine with new
> file version with "unable to connect to node..." error message.

rabbitmqctl will pick up the cookie from the user home directory while 
the service will pick it up from C:\windows. So you will need to 
synchronise those with each other, as well as with the other machine.

This is discussed a little bit at:

http://www.rabbitmq.com/install-windows-manual.html

although that's not the most prominent place. Hmm.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Thu Apr 12 12:09:33 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 12 Apr 2012 12:09:33 +0100
Subject: [rabbitmq-discuss] What is the currently fastest way to stream
 messages?
In-Reply-To: <9029879.56.1334212224976.JavaMail.geo-discussion-forums@pbtr10>
References: <9029879.56.1334212224976.JavaMail.geo-discussion-forums@pbtr10>
Message-ID: <4F86B7ED.6060008@rabbitmq.com>

Hi Matt,

On 12/04/12 07:30, Matt wrote:
> message patterns that I use and where throughputs are not critical. But
> this byte array stream is throughput critical and I would appreciate any
> comments how to tune this. 

Batching the payloads into larger chunks will offer better throughput.
For payloads of only 16 bytes the rest of the message represents a
relatively large overhead.

You might even want to raise the maximum frame size if the chunks exceed
128kb. (See frame_max in http://www.rabbitmq.com/configure.html)
Raising the loopback MTU may also help throughput.

You should use auto-acks instead of relying on consumers to ack messages.
Don't use persistence, transactions or publisher confirms.
Don't use immediate of mandatory publish options.
Use a direct exchange.

If you have a very small number of queues then select a server with
fewer fast CPUs rather than many slow CPUs. Tuning the number of Erlang
schedulers (+S commandline option to erl.exe) may also help.
Make sure you have plenty of RAM to prevent paging messages to disk.

It is not possible to avoid serialisation, unless you make use of the
direct Erlang client. If you must use C# then this is not an option.

-Emile



From simon at rabbitmq.com  Thu Apr 12 12:11:19 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 12 Apr 2012 12:11:19 +0100
Subject: [rabbitmq-discuss] What is the currently fastest way to stream
 messages?
In-Reply-To: <9029879.56.1334212224976.JavaMail.geo-discussion-forums@pbtr10>
References: <9029879.56.1334212224976.JavaMail.geo-discussion-forums@pbtr10>
Message-ID: <4F86B857.6000509@rabbitmq.com>

On 12/04/12 07:30, Matt wrote:
> I am working on a project with one producer, one consumer that need to
> pass messages over the localhost (inter-process). I am targeting C#
> .Net4.5(4.0 also fine). I look for a way to published raw byte[] (size
> of each 16 bytes) messages, but I can chunk up the byte[] into larger
> sizes and send.

Chunking would definitely help; there is a certain byte overhead per 
message that is much more than 16 bytes, and there will be some routing 
work per message as well.

> The order of the sent messages must be preserved.

OK. Otherwise I would suggest parallelising.

> is there a way to go brokerless for throughput optimization,

Not with AMQP.

> can amqp message parsing be turned off (I
> read its a major bottleneck and design flaw how the amqp parser works),

I'm not sure what this would mean. We don't parse AMQP message bodies, 
they're just binaries. But we parse the AMQP byte stream, we kind of 
have to.

Although it's a bottleneck I'm not sure I'd call it a flaw. As long as 
there's a protocol we will have to parse it, and IMHO AMQP is not so 
horrible for parsing (opinions may differ).

To remove parsing overhead it may be worth looking at Tony's new UDP 
exchange in raw mode, although (a) I don't know if he's been optimising 
it and (b) it's UDP.

> can I omit queues

If consumers keep up they will be mostly omitted anyway. Messages still 
have to pass through the queue process, but it doesn't enqueue / dequeue 
in this case.

You could set the immediate flag to ensure messages are never enqueued 
*but* since this is defined to send a basic.return whenever a message is 
dropped it has to do some synchronous stuff and is usually slower.

The next release will allow setting a message TTL of 0, which will 
ensure messages are never enqueued.

> will turning off ackq speed things up?

Definitely.

> Basically
> anything than can get my throughput up is highly welcomed.

Other ideas: Enable HiPE (not available on Windows though) to make 
everything faster. Route via a fanout exchange for the cheapest routing 
logic.

But batching messages will help the most I suspect.

As always, the next release will contain some more performance 
enhancements...

> I understand
> I will not be able to reach ZeroMQs throughput rates because its a
> brokerless solution but I like RabbitMQ and its mature enough to run in
> production and this pub/sub pattern is only one of the many other
> message patterns that I use and where throughputs are not critical. But
> this byte array stream is throughput critical and I would appreciate any
> comments how to tune this.

Hopefully this gives you a clue. But RabbitMQ will never get as fast as 
ZeroMQ - ZeroMQ is just so minimal.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Thu Apr 12 13:05:51 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 12 Apr 2012 13:05:51 +0100
Subject: [rabbitmq-discuss] AMQP connection close in WCF
In-Reply-To: <8C1988E91F870147A36A50E5881B815703C24828@exchange-node-a.eastwind.ru>
References: <8C1988E91F870147A36A50E5881B815703C24828@exchange-node-a.eastwind.ru>
Message-ID: <4F86C51F.4070603@rabbitmq.com>

Hi ?????????,

On 12/04/12 11:11, ????????? ??????? wrote:
> But the method didn`t invoke when TestRabbitServiceClient.Dispose() was
> invoked!
> 
> Could you explain this behavior of RabbitMQ.ServiceModel? How can I
> force closing the connection?

See StopClient() and  StopService() in
RabbitMQ.ServiceModel.Test.TwoWayTest.TwoWayTest for an example of how
to close connections. In your example you should close the connection in
the Dispose() callback of your ServiceClient.


-Emile





From eeichinger at gmail.com  Thu Apr 12 14:24:36 2012
From: eeichinger at gmail.com (Erich Eichinger)
Date: Thu, 12 Apr 2012 06:24:36 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ client behind firewall
Message-ID: <6ea28df8-19b7-4856-bd26-ff0f15b06617@z17g2000yqf.googlegroups.com>

I've seen the thread here http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-March/011805.html
and was wondering if the answer is still valid?

I too have a case where the connection must be actively opened by the
client

tx,
Erich

From dawgtool at aol.com  Thu Apr 12 15:52:02 2012
From: dawgtool at aol.com (DawgTool)
Date: Thu, 12 Apr 2012 10:52:02 -0400
Subject: [rabbitmq-discuss] Per-Connection Flow Control - RMQ 2.8.1
In-Reply-To: <4F730718.6080908@rabbitmq.com>
References: <4F6CD702.4050908@aol.com>
	<4F704404.8080504@rabbitmq.com>	<4F728392.5070602@aol.com>
	<4F72E8A4.1010609@rabbitmq.com> <4F730718.6080908@rabbitmq.com>
Message-ID: <4F86EC12.7030602@aol.com>

Hi Simon,

Just a quick update. I have collected some stats, but mostly looking at 
the rabbitmqctl list_channels. Anyway, I will get those graphed at some 
point.

I did however build the same setup (2.8.1/R15B) on a 16 core/96GB 
machine and I hit the same limits as the 4 core/16GB.

So right now it doesn't appear to be a 'horse-power' issue, possible its 
a logic/functional issue.  Let me know what you think.

Thanks


On 3/28/12 8:42 AM, Simon MacMullen wrote:
> On 28/03/12 11:32, Simon MacMullen wrote:
>> I will try to reproduce based on the above, but anything else you can
>> tell me would be a great help.
>
> Hmm, I'm struggling with this.
>
> I can certainly get into a state with a combination of x-message-ttl, 
> lots of messages expiring, and enough memory pressure to push much of 
> the queue onto disc, such that the queue performance fluctuates quite 
> a bit (as it switches between accepting new messages / paging messages 
> out to disc / paging them back in / expiring them).
>
> But I can't get a message rate that works OK in this scenario with 
> flow control disabled but blocks for long periods with it enabled. If 
> the message rate is high enough for flow control to kick in, then it's 
> also high enough for memory use to go up as messages wait to enter the 
> queue if flow control is disabled. Eventually the memory alarm goes 
> off instead.
>
> So can you provide more information about your use pattern?
>
> Having said that, if you just want to disable flow control and are 
> prepared to build from source, you could apply the following patch:
>
> diff -r f0dafaca6cd1 src/rabbit_reader.erl
> --- a/src/rabbit_reader.erl    Mon Mar 26 17:12:41 2012 +0100
> +++ b/src/rabbit_reader.erl    Wed Mar 28 13:40:03 2012 +0100
> @@ -360,7 +360,7 @@
>
>  control_throttle(State = #v1{connection_state = CS,
>                               conserve_memory  = Mem}) ->
> -    case {CS, Mem orelse credit_flow:blocked()} of
> +    case {CS, Mem} of
>          {running,   true} -> State#v1{connection_state = blocking};
>          {blocking, false} -> State#v1{connection_state = running};
>          {blocked,  false} -> ok = rabbit_heartbeat:resume_monitor(
>
> But I would like to understand more about what you're seeing.
>
> Cheers, Simon
>


From simon at rabbitmq.com  Thu Apr 12 16:09:59 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 12 Apr 2012 16:09:59 +0100
Subject: [rabbitmq-discuss] RabbitMQ client behind firewall
In-Reply-To: <6ea28df8-19b7-4856-bd26-ff0f15b06617@z17g2000yqf.googlegroups.com>
References: <6ea28df8-19b7-4856-bd26-ff0f15b06617@z17g2000yqf.googlegroups.com>
Message-ID: <4F86F047.8040900@rabbitmq.com>

On 12/04/12 14:24, Erich Eichinger wrote:
> I've seen the thread herehttp://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-March/011805.html
> and was wondering if the answer is still valid?

Basically yes.

> I too have a case where the connection must be actively opened by the
> client

Well, clients always open connections. What do you mean? Are you asking 
about sending messages over HTTP due to being unable to open port 5672?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Apr 12 16:57:34 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 12 Apr 2012 16:57:34 +0100
Subject: [rabbitmq-discuss] RabbitMQ client behind firewall
In-Reply-To: <014d01cd18c4$786983d0$693c8b70$@com>
References: <6ea28df8-19b7-4856-bd26-ff0f15b06617@z17g2000yqf.googlegroups.com>
	<4F86F047.8040900@rabbitmq.com>
	<014d01cd18c4$786983d0$693c8b70$@com>
Message-ID: <4F86FB6E.6060501@rabbitmq.com>

Hi Erich. Please keep rabbitmq-discuss on cc.

On 12/04/12 16:53, Erich Eichinger wrote:
> the protocol is actually irrelevant, but my clients sit behind a firewall
> that doesn't allow any incoming connections

That should be fine though, assuming your firewall allows outgoing 
connections. In AMQP as with most other protocols clients initiate 
connections to servers and not the other way around.

Are you actually experiencing a connectivity problem?

Cheers, Simon

> -----Original Message-----
> From: Simon MacMullen [mailto:simon at rabbitmq.com]
> Sent: 12 April 2012 16:10
> To: Erich Eichinger
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] RabbitMQ client behind firewall
>
> On 12/04/12 14:24, Erich Eichinger wrote:
>> I've seen the thread
>> herehttp://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-March/01
>> 1805.html and was wondering if the answer is still valid?
>
> Basically yes.
>
>> I too have a case where the connection must be actively opened by the
>> client
>
> Well, clients always open connections. What do you mean? Are you asking
> about sending messages over HTTP due to being unable to open port 5672?
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>


-- 
Simon MacMullen
RabbitMQ, VMware

From GabrielHP at conexiant.net  Thu Apr 12 20:52:24 2012
From: GabrielHP at conexiant.net (Gabriel Hernandez)
Date: Thu, 12 Apr 2012 19:52:24 +0000
Subject: [rabbitmq-discuss] RabbitMQ Shovel problem
Message-ID: <257758D7885DBC429372DD0F67DD97571306A8F6@CH1PRD0802MB120.namprd08.prod.outlook.com>

Hi,

I have a system where I need to not lose any message in any way while processing, so I have a local rabbitmq server where the publisher is located. The messages in these servers are then pulled from a central location where they are consumed.

Producer - >  B Node 1     ---------------- >  A Node (Shovel) --------- > Consumer

For this I have a fairly basic shovel configured in the A Node to pull from the processing servers. At first everything works fine, but after some time of the connection being idle the shovel seems to stop working. When a new message is published to the B Node at first it appears to be sent, but not acked, so in the administration plugin the queue shows: Ready messages: 0  Unacked messages: 1  Total: 1. After a while the message gets requeued and never taken by the shovel. In the A Node messages can be published to queues and exchanges and messages can be consumed, so it's not a problem with rabbitmq itself.

When I try restarting the server using rabbitmqctl it seems to stop the node, but then it hangs and any effort to start or stop hangs, I have to kill the erlang beam process.

I'm using RabbitMQ 2.8.1 with Erlang R14B04 on CentOS 6. These are the latest versions I found RPM's for.

Anyone has any idea what's happening here and what I might be able to do to fix this?




-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120412/6495c4b0/attachment.htm>

From videlalvaro at gmail.com  Fri Apr 13 09:50:18 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 13 Apr 2012 10:50:18 +0200
Subject: [rabbitmq-discuss] Generating a Rabbitmq release
Message-ID: <CAMcAHLWzupdK_5X0yV-zurg1bSt2nOYPHveEhYoMvLXzLdxU-g@mail.gmail.com>

Hi,

Is there a way to generate a RabbitMQ release by using the make files form
the umbrella? By a release I mean this:
http://www.erlang.org/doc/design_principles/release_structure.html

I see that's there's an erlang module called rabbit_prelaunch that does
generate a rabbit.rel file but it seems to be used mostly for plugins but I
don't see any Make target for the release itself.

What I want to achieve is to be able to generate a tar file with Erlang's
erts and other dependencies as explained here:
http://www.erlang.org/doc/design_principles/release_structure.html#id75658

In that way we could distribute RabbitMQ without the need to install
Erlang, which I think will ease adoption a lot.

In the mac for example I saw that Ejabberd even had a .pkg installer that
placed the server under the Applications folder. See the installers offered
here: http://www.process-one.net/en/ejabberd/downloads/

Any ideas?

Regards,

Alvaro
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120413/53c8ff5d/attachment.htm>

From eeichinger at gmail.com  Thu Apr 12 17:04:29 2012
From: eeichinger at gmail.com (Erich Eichinger)
Date: Thu, 12 Apr 2012 17:04:29 +0100
Subject: [rabbitmq-discuss] RabbitMQ client behind firewall
In-Reply-To: <4F86FB6E.6060501@rabbitmq.com>
References: <6ea28df8-19b7-4856-bd26-ff0f15b06617@z17g2000yqf.googlegroups.com>
	<4F86F047.8040900@rabbitmq.com>
	<014d01cd18c4$786983d0$693c8b70$@com>
	<4F86FB6E.6060501@rabbitmq.com>
Message-ID: <014e01cd18c5$f292e6f0$d7b8b4d0$@com>

sorry, cc added

thanks for the response, I was about the setup a test tonight. But if only
the client initiates the connection we should be fine. 

tx,
Erich

-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: 12 April 2012 16:58
To: Erich Eichinger
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] RabbitMQ client behind firewall

Hi Erich. Please keep rabbitmq-discuss on cc.

On 12/04/12 16:53, Erich Eichinger wrote:
> the protocol is actually irrelevant, but my clients sit behind a 
> firewall that doesn't allow any incoming connections

That should be fine though, assuming your firewall allows outgoing
connections. In AMQP as with most other protocols clients initiate
connections to servers and not the other way around.

Are you actually experiencing a connectivity problem?

Cheers, Simon

> -----Original Message-----
> From: Simon MacMullen [mailto:simon at rabbitmq.com]
> Sent: 12 April 2012 16:10
> To: Erich Eichinger
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] RabbitMQ client behind firewall
>
> On 12/04/12 14:24, Erich Eichinger wrote:
>> I've seen the thread
>> herehttp://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-March/0
>> 1 1805.html and was wondering if the answer is still valid?
>
> Basically yes.
>
>> I too have a case where the connection must be actively opened by the 
>> client
>
> Well, clients always open connections. What do you mean? Are you 
> asking about sending messages over HTTP due to being unable to open port
5672?
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>


--
Simon MacMullen
RabbitMQ, VMware


From brendan at soundcloud.com  Fri Apr 13 10:33:24 2012
From: brendan at soundcloud.com (Brendan Hay)
Date: Fri, 13 Apr 2012 11:33:24 +0200
Subject: [rabbitmq-discuss] Generating a Rabbitmq release
In-Reply-To: <CAMcAHLWzupdK_5X0yV-zurg1bSt2nOYPHveEhYoMvLXzLdxU-g@mail.gmail.com>
References: <CAMcAHLWzupdK_5X0yV-zurg1bSt2nOYPHveEhYoMvLXzLdxU-g@mail.gmail.com>
Message-ID: <CAHZsVQYvR1rT-Nd4zd0YTtCUhY5CxNju5Tofyb6Y53psWiXdeQ@mail.gmail.com>

Smells like it's about time to rebar-ize rabbit =)

On Fri, Apr 13, 2012 at 10:50 AM, Alvaro Videla <videlalvaro at gmail.com>wrote:

> Hi,
>
> Is there a way to generate a RabbitMQ release by using the make files form
> the umbrella? By a release I mean this:
> http://www.erlang.org/doc/design_principles/release_structure.html
>
> I see that's there's an erlang module called rabbit_prelaunch that does
> generate a rabbit.rel file but it seems to be used mostly for plugins but I
> don't see any Make target for the release itself.
>
> What I want to achieve is to be able to generate a tar file with Erlang's
> erts and other dependencies as explained here:
> http://www.erlang.org/doc/design_principles/release_structure.html#id75658
>
> In that way we could distribute RabbitMQ without the need to install
> Erlang, which I think will ease adoption a lot.
>
> In the mac for example I saw that Ejabberd even had a .pkg installer that
> placed the server under the Applications folder. See the installers offered
> here: http://www.process-one.net/en/ejabberd/downloads/
>
> Any ideas?
>
> Regards,
>
> Alvaro
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120413/b94a1e43/attachment.htm>

From videlalvaro at gmail.com  Fri Apr 13 10:38:27 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 13 Apr 2012 11:38:27 +0200
Subject: [rabbitmq-discuss] Generating a Rabbitmq release
In-Reply-To: <CAHZsVQYvR1rT-Nd4zd0YTtCUhY5CxNju5Tofyb6Y53psWiXdeQ@mail.gmail.com>
References: <CAMcAHLWzupdK_5X0yV-zurg1bSt2nOYPHveEhYoMvLXzLdxU-g@mail.gmail.com>
	<CAHZsVQYvR1rT-Nd4zd0YTtCUhY5CxNju5Tofyb6Y53psWiXdeQ@mail.gmail.com>
Message-ID: <CAMcAHLVQzk6DQLRjmbA+EfJdkbDwrGHd7QQpK_Viyoypfrb8dA@mail.gmail.com>

Hi

On Fri, Apr 13, 2012 at 11:33 AM, Brendan Hay <brendan at soundcloud.com>wrote:

> Smells like it's about time to rebar-ize rabbit =)


I think rebarizing rabbit could be a pretty big effort considering all
what's done by the umbrella make files. I wouldn't complain tho if that's
ever achieved tho

-Alvaro
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120413/9ec2debf/attachment.htm>

From simon at rabbitmq.com  Fri Apr 13 11:12:53 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 13 Apr 2012 11:12:53 +0100
Subject: [rabbitmq-discuss] RabbitMQ Shovel problem
In-Reply-To: <257758D7885DBC429372DD0F67DD97571306A8F6@CH1PRD0802MB120.namprd08.prod.outlook.com>
References: <257758D7885DBC429372DD0F67DD97571306A8F6@CH1PRD0802MB120.namprd08.prod.outlook.com>
Message-ID: <4F87FC25.4010907@rabbitmq.com>

On 12/04/12 20:52, Gabriel Hernandez wrote:
> At first everything works fine, but after some time of the connection
> being idle the shovel seems to stop working.

We often seem to get reports of networks killing idle TCP connections, 
which might be what's happening to you. Can you try enabling AMQP 
heartbeats?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Fri Apr 13 11:40:41 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 13 Apr 2012 11:40:41 +0100
Subject: [rabbitmq-discuss] Generating a Rabbitmq release
In-Reply-To: <CAMcAHLWzupdK_5X0yV-zurg1bSt2nOYPHveEhYoMvLXzLdxU-g@mail.gmail.com>
References: <CAMcAHLWzupdK_5X0yV-zurg1bSt2nOYPHveEhYoMvLXzLdxU-g@mail.gmail.com>
Message-ID: <4F8802A9.1030904@rabbitmq.com>


Hi Alvaro,

On 13/04/12 09:50, Alvaro Videla wrote:
> Is there a way to generate a RabbitMQ release by using the make files
> form the umbrella?

You will find the release files (.boot, .script and .rel) in
${RABBITMQ_MNESIA_BASE}/${RABBITMQ_NODENAME}-plugins-expand
after starting the broker.

What the RabbitMQ Makefiles do produce is an Erlang application, with a
rabbit.app file. You can start, stop and manage the rabbitmq application
in the same way as any other Erlang application.

> In that way we could distribute RabbitMQ without the need to install
> Erlang, which I think will ease adoption a lot.

The approach that ejabberd takes is to install a minimal version of
Erlang together with their binaries. That is similar to Java
applications that bundle and install a dedicated JVM. There are
advantages and drawbacks to this approach. In either case you still need
an Erlang VM, whether it is distributed with the service (like ejabberd)
or installed independently (like RabbitMQ requires).

-Emile



From videlalvaro at gmail.com  Fri Apr 13 12:11:12 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 13 Apr 2012 13:11:12 +0200
Subject: [rabbitmq-discuss] Generating a Rabbitmq release
In-Reply-To: <4F8802A9.1030904@rabbitmq.com>
References: <CAMcAHLWzupdK_5X0yV-zurg1bSt2nOYPHveEhYoMvLXzLdxU-g@mail.gmail.com>
	<4F8802A9.1030904@rabbitmq.com>
Message-ID: <CAMcAHLU-XWEL6QDAdL5nbE63_mn71iTVJD436qv2QJfSdqsWWw@mail.gmail.com>

Hi Emile,

I know you can do that. What I want to do is to distribute the Erlang VM,
as mentioned in my first email when I said: "What I want to achieve is to
be able to generate a tar file with Erlang's erts and other dependencies as
explained here
http://www.erlang.org/doc/design_principles/release_structure.html#id75658".

What I'm thinking here is about usability. Some weeks ago I taught RabbitMQ
at an University and many students were complaining about the long
compiling times Erlang has. Also "what's the right Erlang distro for
Rabbit". Or "the Erlang distro for my ubuntu is too old". And so on.

Also if you monitor the #rabbitmq hashtag on twitter from time to time you
may find users complaining about "rabbitmq is hard to install" when the
actual problem is that they can't get Erlang running in the first place.

So I think producing a self container tar ball could be very helpful. As
RabbitMQ you can even choose against which Erlang version you want to
compile your code, which I think is another advantage.

Do you see where I want to go with this approach?

Regards,

Alvaro


On Fri, Apr 13, 2012 at 12:40 PM, Emile Joubert <emile at rabbitmq.com> wrote:

>
> Hi Alvaro,
>
> On 13/04/12 09:50, Alvaro Videla wrote:
> > Is there a way to generate a RabbitMQ release by using the make files
> > form the umbrella?
>
> You will find the release files (.boot, .script and .rel) in
> ${RABBITMQ_MNESIA_BASE}/${RABBITMQ_NODENAME}-plugins-expand
> after starting the broker.
>
> What the RabbitMQ Makefiles do produce is an Erlang application, with a
> rabbit.app file. You can start, stop and manage the rabbitmq application
> in the same way as any other Erlang application.
>
> > In that way we could distribute RabbitMQ without the need to install
> > Erlang, which I think will ease adoption a lot.
>
> The approach that ejabberd takes is to install a minimal version of
> Erlang together with their binaries. That is similar to Java
> applications that bundle and install a dedicated JVM. There are
> advantages and drawbacks to this approach. In either case you still need
> an Erlang VM, whether it is distributed with the service (like ejabberd)
> or installed independently (like RabbitMQ requires).
>
> -Emile
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120413/7f4622cf/attachment.htm>

From matthew at rabbitmq.com  Fri Apr 13 12:26:12 2012
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 13 Apr 2012 12:26:12 +0100
Subject: [rabbitmq-discuss] Generating a Rabbitmq release
In-Reply-To: <CAMcAHLU-XWEL6QDAdL5nbE63_mn71iTVJD436qv2QJfSdqsWWw@mail.gmail.com>
References: <CAMcAHLWzupdK_5X0yV-zurg1bSt2nOYPHveEhYoMvLXzLdxU-g@mail.gmail.com>
	<4F8802A9.1030904@rabbitmq.com>
	<CAMcAHLU-XWEL6QDAdL5nbE63_mn71iTVJD436qv2QJfSdqsWWw@mail.gmail.com>
Message-ID: <20120413112611.GB18040@rabbitmq.com>

On Fri, Apr 13, 2012 at 01:11:12PM +0200, Alvaro Videla wrote:
> Do you see where I want to go with this approach?

Indeed. In fact, what would be better would be if we just produced a
live CD or something, including an entire operating system which people
could just pop in and boot off. Or maybe even just dedicated hardware -
just plug it into your network, power it on, and it's all there. Of
course, there'd be a fractional increase in maintenance burden -
providing security fixes and updates for an entire OS or even computer
might turn out to be more involved than just for Rabbit itself, but the
ease of use for end users would be vastly improved.

Actually, taking this to its logical conclusion, one might consider even
the existence of such hardware to be annoying - couldn't someone else
take care of even that? Starting to sound an awful lot like the sort of
thing that cloud foundary provides.

Students will waste vastly more time on facebook and twitter each day
than it takes to compile erlang. If learning how tool chains and
compilation of software works is deemed unimportant, then I would
suggest you migrate to something much closer to cloud foundary where the
administrative burden is almost entirely removed.

Matthew

From videlalvaro at gmail.com  Fri Apr 13 12:35:03 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 13 Apr 2012 13:35:03 +0200
Subject: [rabbitmq-discuss] Generating a Rabbitmq release
In-Reply-To: <20120413112611.GB18040@rabbitmq.com>
References: <CAMcAHLWzupdK_5X0yV-zurg1bSt2nOYPHveEhYoMvLXzLdxU-g@mail.gmail.com>
	<4F8802A9.1030904@rabbitmq.com>
	<CAMcAHLU-XWEL6QDAdL5nbE63_mn71iTVJD436qv2QJfSdqsWWw@mail.gmail.com>
	<20120413112611.GB18040@rabbitmq.com>
Message-ID: <CAMcAHLVpB+XfKRpLSLTUH22ExDZtoG+cQhci2VGqW7Sj3=HtTQ@mail.gmail.com>

Are you serious? I mean? if you want to disagree with me I'm OK with that.
But there's no need to come up with that kind of sarcasm.

Alvaro

On Fri, Apr 13, 2012 at 1:26 PM, Matthew Sackman <matthew at rabbitmq.com>wrote:

> On Fri, Apr 13, 2012 at 01:11:12PM +0200, Alvaro Videla wrote:
> > Do you see where I want to go with this approach?
>
> Indeed. In fact, what would be better would be if we just produced a
> live CD or something, including an entire operating system which people
> could just pop in and boot off. Or maybe even just dedicated hardware -
> just plug it into your network, power it on, and it's all there. Of
> course, there'd be a fractional increase in maintenance burden -
> providing security fixes and updates for an entire OS or even computer
> might turn out to be more involved than just for Rabbit itself, but the
> ease of use for end users would be vastly improved.
>
> Actually, taking this to its logical conclusion, one might consider even
> the existence of such hardware to be annoying - couldn't someone else
> take care of even that? Starting to sound an awful lot like the sort of
> thing that cloud foundary provides.
>
> Students will waste vastly more time on facebook and twitter each day
> than it takes to compile erlang. If learning how tool chains and
> compilation of software works is deemed unimportant, then I would
> suggest you migrate to something much closer to cloud foundary where the
> administrative burden is almost entirely removed.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120413/3769a7c2/attachment.htm>

From simon at rabbitmq.com  Fri Apr 13 12:38:48 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 13 Apr 2012 12:38:48 +0100
Subject: [rabbitmq-discuss] Generating a Rabbitmq release
In-Reply-To: <20120413112611.GB18040@rabbitmq.com>
References: <CAMcAHLWzupdK_5X0yV-zurg1bSt2nOYPHveEhYoMvLXzLdxU-g@mail.gmail.com>	<4F8802A9.1030904@rabbitmq.com>	<CAMcAHLU-XWEL6QDAdL5nbE63_mn71iTVJD436qv2QJfSdqsWWw@mail.gmail.com>
	<20120413112611.GB18040@rabbitmq.com>
Message-ID: <4F881048.4020402@rabbitmq.com>

On 13/04/12 12:26, Matthew Sackman wrote:
> Students will waste vastly more time on facebook and twitter each day
> than it takes to compile erlang. If learning how tool chains and
> compilation of software works is deemed unimportant, then I would
> suggest you migrate to something much closer to cloud foundary where the
> administrative burden is almost entirely removed.

I think this is overkill. People do have trouble getting started with 
Rabbit due to a poor Erlang situation on their distro or whatever; it 
would be nice to help these people. We like helping people, don't we?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From matthew at rabbitmq.com  Fri Apr 13 12:41:05 2012
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 13 Apr 2012 12:41:05 +0100
Subject: [rabbitmq-discuss] Generating a Rabbitmq release
In-Reply-To: <CAMcAHLVpB+XfKRpLSLTUH22ExDZtoG+cQhci2VGqW7Sj3=HtTQ@mail.gmail.com>
References: <CAMcAHLWzupdK_5X0yV-zurg1bSt2nOYPHveEhYoMvLXzLdxU-g@mail.gmail.com>
	<4F8802A9.1030904@rabbitmq.com>
	<CAMcAHLU-XWEL6QDAdL5nbE63_mn71iTVJD436qv2QJfSdqsWWw@mail.gmail.com>
	<20120413112611.GB18040@rabbitmq.com>
	<CAMcAHLVpB+XfKRpLSLTUH22ExDZtoG+cQhci2VGqW7Sj3=HtTQ@mail.gmail.com>
Message-ID: <20120413114105.GC18040@rabbitmq.com>

On Fri, Apr 13, 2012 at 01:35:03PM +0200, Alvaro Videla wrote:
> Are you serious? I mean? if you want to disagree with me I'm OK with that.
> But there's no need to come up with that kind of sarcasm.

Sorry, my apologies. Having a bad day. Didn't mean to take it out on
you.

I agree the packaging issue is a problem, and there has been a lot done
to improve this. I do genuinely think that right now, the cloud foundary
approach may be a viable alternative if getting going quickly is the
key.

Matthew

From matthew at rabbitmq.com  Fri Apr 13 12:50:36 2012
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 13 Apr 2012 12:50:36 +0100
Subject: [rabbitmq-discuss] Generating a Rabbitmq release
In-Reply-To: <20120413114105.GC18040@rabbitmq.com>
References: <CAMcAHLWzupdK_5X0yV-zurg1bSt2nOYPHveEhYoMvLXzLdxU-g@mail.gmail.com>
	<4F8802A9.1030904@rabbitmq.com>
	<CAMcAHLU-XWEL6QDAdL5nbE63_mn71iTVJD436qv2QJfSdqsWWw@mail.gmail.com>
	<20120413112611.GB18040@rabbitmq.com>
	<CAMcAHLVpB+XfKRpLSLTUH22ExDZtoG+cQhci2VGqW7Sj3=HtTQ@mail.gmail.com>
	<20120413114105.GC18040@rabbitmq.com>
Message-ID: <20120413115035.GD18040@rabbitmq.com>

On Fri, Apr 13, 2012 at 12:41:05PM +0100, Matthew Sackman wrote:
> I agree the packaging issue is a problem, and there has been a lot done
> to improve this. I do genuinely think that right now, the cloud foundary
> approach may be a viable alternative if getting going quickly is the
> key.

To be really clear, what I really object to is the reinvention of wheel
regarding packaging. There are really good solutions out there - vastly
better than what things like apt/deb offer, which should be very widely
used but are not. The ongoing mess of homebrew/macports is horrible -
and seems never to get better; the number of issues we see with rpm
based systems is also horrific. Even debian based systems are
essentially useless as unless you're root you can't install packages.
There are systems out there, eg Nix / NixOS that allow any user to
install anything and to do it in such a way that it has zero impact on
other users. They've never caught on, and I find the current mess of
packaging "solutions" hightly frustrating.

Matthew

From videlalvaro at gmail.com  Fri Apr 13 12:55:26 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 13 Apr 2012 13:55:26 +0200
Subject: [rabbitmq-discuss] Generating a Rabbitmq release
In-Reply-To: <20120413114105.GC18040@rabbitmq.com>
References: <CAMcAHLWzupdK_5X0yV-zurg1bSt2nOYPHveEhYoMvLXzLdxU-g@mail.gmail.com>
	<4F8802A9.1030904@rabbitmq.com>
	<CAMcAHLU-XWEL6QDAdL5nbE63_mn71iTVJD436qv2QJfSdqsWWw@mail.gmail.com>
	<20120413112611.GB18040@rabbitmq.com>
	<CAMcAHLVpB+XfKRpLSLTUH22ExDZtoG+cQhci2VGqW7Sj3=HtTQ@mail.gmail.com>
	<20120413114105.GC18040@rabbitmq.com>
Message-ID: <CAMcAHLXNHkWEri_4k3KXSWdojce4oJCv1R_3NFjCvVAeUfPzGw@mail.gmail.com>


From matthew at rabbitmq.com  Fri Apr 13 13:14:53 2012
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 13 Apr 2012 13:14:53 +0100
Subject: [rabbitmq-discuss] Generating a Rabbitmq release
In-Reply-To: <CAMcAHLXNHkWEri_4k3KXSWdojce4oJCv1R_3NFjCvVAeUfPzGw@mail.gmail.com>
References: <CAMcAHLWzupdK_5X0yV-zurg1bSt2nOYPHveEhYoMvLXzLdxU-g@mail.gmail.com>
	<4F8802A9.1030904@rabbitmq.com>
	<CAMcAHLU-XWEL6QDAdL5nbE63_mn71iTVJD436qv2QJfSdqsWWw@mail.gmail.com>
	<20120413112611.GB18040@rabbitmq.com>
	<CAMcAHLVpB+XfKRpLSLTUH22ExDZtoG+cQhci2VGqW7Sj3=HtTQ@mail.gmail.com>
	<20120413114105.GC18040@rabbitmq.com>
	<CAMcAHLXNHkWEri_4k3KXSWdojce4oJCv1R_3NFjCvVAeUfPzGw@mail.gmail.com>
Message-ID: <20120413121452.GE18040@rabbitmq.com>

On Fri, Apr 13, 2012 at 01:55:26PM +0200, Alvaro Videla wrote:
> In my case I've been using Erlang for a few years already so I like to
> build it from source and so on, but some people don't. Actually some people
> just want to evaluate RabbitMQ and see if it's the right solution for them.
> If I can't get RabbitMQ running because something doesn't compile or
> whatever the reason, but then I download MagickMQ and it works like a charm
> then I will just evaluate MagickMQ and discard RabbitMQ. It's sad but it's
> how it works most of the time.

Indeed, and any sane package manager should do that for you. In fact
ideally, you shouldn't be downloading anything from our website - you
should just use your platform's native package manager and it should
install as you wish something that's appropriate for your particular
platform. The fact that that doesn't work for many people is somewhat
distressing.

> I agree with you Matthew that you should learn how to compile Erlang,

Actually, I'm not saying that. If you just want to evaluate a bunch of
different message brokers, then no, I don't think you should take the
gentoo approach to everything. Even in a university course about
messaging, time is probably better spent not compiling Erlang. However,
in such a educational situation, I would say that learning your way
around toolchains is valuable. I would also hope that a course on
messaging didn't require every student to compile their own version of
Erlang and instead both Erlang and Rabbit would be provided on a
lab-wide system install.

Matthew

From videlalvaro at gmail.com  Fri Apr 13 13:27:15 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 13 Apr 2012 14:27:15 +0200
Subject: [rabbitmq-discuss] Generating a Rabbitmq release
In-Reply-To: <20120413121452.GE18040@rabbitmq.com>
References: <CAMcAHLWzupdK_5X0yV-zurg1bSt2nOYPHveEhYoMvLXzLdxU-g@mail.gmail.com>
	<4F8802A9.1030904@rabbitmq.com>
	<CAMcAHLU-XWEL6QDAdL5nbE63_mn71iTVJD436qv2QJfSdqsWWw@mail.gmail.com>
	<20120413112611.GB18040@rabbitmq.com>
	<CAMcAHLVpB+XfKRpLSLTUH22ExDZtoG+cQhci2VGqW7Sj3=HtTQ@mail.gmail.com>
	<20120413114105.GC18040@rabbitmq.com>
	<CAMcAHLXNHkWEri_4k3KXSWdojce4oJCv1R_3NFjCvVAeUfPzGw@mail.gmail.com>
	<20120413121452.GE18040@rabbitmq.com>
Message-ID: <CAMcAHLVoECzVwbMwz+S_AoPRK7e+LCM-cFcvX-KvHDiQA43yoQ@mail.gmail.com>

Hi,

On Fri, Apr 13, 2012 at 2:14 PM, Matthew Sackman <matthew at rabbitmq.com>wrote:
>
> Actually, I'm not saying that. If you just want to evaluate a bunch of
> different message brokers, then no, I don't think you should take the
> gentoo approach to everything. Even in a university course about
> messaging, time is probably better spent not compiling Erlang. However,
> in such a educational situation, I would say that learning your way
> around toolchains is valuable. I would also hope that a course on
> messaging didn't require every student to compile their own version of
> Erlang and instead both Erlang and Rabbit would be provided on a
> lab-wide system install.
>

Sadly that was not the case there. At least they could install Erlang while
I was giving some other introductions so we didn't waste time on it, but
yeah? some desks were warmer thanks to Erlang.

Alvaro
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120413/6e915805/attachment.htm>

From Paul.Smith at edftrading.com  Fri Apr 13 13:17:26 2012
From: Paul.Smith at edftrading.com (Paul Smith)
Date: Fri, 13 Apr 2012 13:17:26 +0100
Subject: [rabbitmq-discuss] SSL connection issue from .net client
Message-ID: <2A876ED89F61324C85F585C2C315FB1A2323E26D74@DCPWAEXCH01.edftrading.com>

Hi,

Any help on this problem is greatly appreciated. I am getting an error when I try to connect to a broker on an SSL connection. The error I get is:

RabbitMQ.Client.Exceptions.PossibleAuthenticationFailureException: Possibly caused by authentication failure ---> RabbitMQ.Client.Exceptions.OperationInterruptedException: The AMQP operation was interrupted: AMQP close-reason, initiated by Library, code=0, text="End of stream", classId=0, methodId=0, cause=System.IO.EndOfStreamException: Unable to read beyond the end of the stream.
   at RabbitMQ.Client.Impl.Frame.ReadFrom(NetworkBinaryReader reader)
   at RabbitMQ.Client.Impl.SocketFrameHandler_0_9.ReadFrame()
   at RabbitMQ.Client.Impl.ConnectionBase.MainLoopIteration()
   at RabbitMQ.Client.Impl.ConnectionBase.MainLoop()
   at RabbitMQ.Client.Impl.SimpleBlockingRpcContinuation.GetReply()
   at RabbitMQ.Client.Impl.ModelBase.ConnectionStartOk(IDictionary clientProperties, String mechanism, Byte[] response, String locale)
   at RabbitMQ.Client.Impl.ConnectionBase.StartAndTune()
   --- End of inner exception stack trace ---
   at RabbitMQ.Client.Impl.ConnectionBase.StartAndTune()
   at RabbitMQ.Client.Framing.Impl.v0_9_1.Connection.Open(Boolean insist)
   at RabbitMQ.Client.Impl.ConnectionBase..ctor(ConnectionFactory factory, Boolean insist, IFrameHandler frameHandler)
   at RabbitMQ.Client.Framing.Impl.v0_9_1.Connection..ctor(ConnectionFactory factory, Boolean insist, IFrameHandler frameHandler)
   at RabbitMQ.Client.Framing.Impl.v0_9_1.ProtocolBase.CreateConnection(ConnectionFactory factory, Boolean insist, IFrameHandler frameHandler)
   at RabbitMQ.Client.ConnectionFactory.FollowRedirectChain(Int32 maxRedirects, IDictionary connectionAttempts, IDictionary connectionErrors, AmqpTcpEndpoint[]& mostRecentKnownHosts, AmqpTcpEndpoint endpoint)}

Here is the background:

The AMQP broker/server is hosted on a network external to my network. I am unaware of its implementation (i.e. if its java etc)
They gave me a lot of detail of how to connect to the system from a java application. This includes a test app so that I can test the connection and the intended functionality.
This works correctly when I use the test app (which is in Java) but when I try to simply create the connection from within a .Net client it fails with the above error.

They supplied me a Java Key Store file and a pk12 certifcate and its password. As I said when I use these in Java it works fine.

For my .net implementation, I have followed the client connection example on : http://www.rabbitmq.com/ssl.html

Below is my code:

            RabbitMQ.Client.ConnectionFactory cf = new ConnectionFactory();
            cf.Ssl.ServerName = "remoteserver";
            cf.Ssl.CertPath = "C:\cert\CXAPIT10.p12";
            cf.Ssl.CertPassphrase = "password";
            cf.Ssl.AcceptablePolicyErrors = SslPolicyErrors.RemoteCertificateChainErrors |
                                            SslPolicyErrors.RemoteCertificateNameMismatch |
                                            SslPolicyErrors.RemoteCertificateNotAvailable;

            cf.VirtualHost = @"/blah/cute";
            cf.Port = 5671;
            cf.HostName = "remoteserver";
            cf.Ssl.Enabled = true;
            cf.CreateConnection(); -- error is thrown here

Can you see anything wrong with the above?

An obvious difference between the java code example they gave me and the .net app is that I don't get to use the keystore. I don't know if this is required.
Please note, I have also added an entry to my host file so the ip address that I want to go to is the same as the cn name in the cert.

Any help is greatly appreciated!

Regards,

Paul




________________________________
This e-mail may contain information that is confidential, privileged or otherwise protected from disclosure. If you are not an intended recipient of this e-mail, do not duplicate or redistribute it by any means. Please delete it and any attachments and notify the sender that you have received it in error. Unless specifically indicated, this e-mail is not an offer to buy or sell or a solicitation to buy or sell any commodities, financial risk management products, or other physical or financial product or service, an official confirmation of any transaction, or an official statement of EDF Trading Limited, EDF Trading Markets Limited, EDF Trading North America, LLC, or any of the EDF Group family of companies. Any views or opinions presented are solely those of the author and do not necessarily represent those of the foregoing entities. EDF Trading Markets Limited is authorised and regulated by the Financial Services Authority. VAT number: GB 735 5479 07. EDF Trading Markets Limited and EDF Trading North America, LLC are members of the EDF Group of companies. EDF Trading Markets Limited maintains its registered office at 80 Victoria Street, 3rd Floor, Cardinal Place, London, SW1E 5JL. A Company registered in England No. 4255974. EDF Trading North America, LLC is headquartered in the United States at 4700 W. Sam Houston Pkwy., Suite 250, Houston, TX 77041

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120413/824ae9d0/attachment.htm>

From mr.bouh at gmail.com  Fri Apr 13 16:19:30 2012
From: mr.bouh at gmail.com (Bouh Bouh)
Date: Fri, 13 Apr 2012 17:19:30 +0200
Subject: [rabbitmq-discuss] problem with very high queue TTL
Message-ID: <CAMhHffGZ1QaL0Voqg5i5AgE-HvH5JxSoFBbMiTgsQwL266SmVQ@mail.gmail.com>

Hello,

Working with rabbitmq, I found a nasty behavior relating to queue and their
TTL. If you send a persistant message to a durable queue when the queue
have a TTL over 4.294.967.295 (max 32bit int, or FF FF FF FF), then the
queue is destroyed if the message is not consumed immediately.

Here the simplest test I have made :
a user "test_user" (with a password "test_user") ;
a vhost "p" ;
a queue named "test", durable, with a TTL > 4.294.967.295 (no autodelete) ;
no arguments ;

the direct exchange "amq.direct" bind to the queue with no routing key and
no arguments ;

send a persistant message  (delivery mode = 2, no routing key, no header
nor properties, only a basic payload "bla").

Then the queue is destroyed.

Rabbitmq version 2.7.1
test made with management interface and php client.

I think this is related to the storage of the message (due to the behavior
I observed while testing with shovels).

I may not need a so large TTL, but I think you should know about this.

Here is the error log :

=ERROR REPORT==== 13-Apr-2012::16:09:13 ===
** Generic server <0.31584.0> terminating
** Last message in was {deliver,
{delivery,true,false,<0.9065.1>,
{basic_message,
{resource,<<"p">>,exchange,<<"amq.direct">>},
[<<>>],
{content,60,
{'P_basic',undefined,undefined,[],2,undefined,
undefined,undefined,undefined,undefined,undefined,
undefined,undefined,undefined,undefined},
none,none,
[<<"bla">>]},
<<"Y<C9><FF>e<B1><B6>d<A1> ZU<D6><E9><E0><E2><BE>">>,true},
1}}
** When Server state == {q,
{amqqueue,
{resource,<<"p">>,queue,<<"test">>},
true,false,none,
[{<<"x-message-ttl">>,long,4294967296}],
<0.31584.0>,[],undefined},
none,false,rabbit_variable_queue,
{vqstate,
{0,{[],[]}},
{0,{[],[]}},
{delta,undefined,0,undefined},
{0,{[],[]}},
{0,{[],[]}},
0,
{0,nil},
undefined,
{0,nil},
{qistate,
  "/var/lib/rabbitmq/mnesia/rabbit at rabbithost/queues/BKL005Z7FOY4NF6WMR7ER
BLZV",
{{dict,0,16,16,8,80,48,
{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
[]}}},
[]},
undefined,0,262144,
#Fun<rabbit_variable_queue.2.91259159>,
{0,nil}},
{{client_msstate,msg_store_persistent,
<<72,21,86,28,220,67,150,223,124,123,50,154,225,
109,132,157>>,
{dict,0,16,16,8,80,48,
{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
[]}}},
{state,1134659,
"/var/lib/rabbitmq/mnesia/rabbit at rabbithost/msg_store_persistent"},
rabbit_msg_store_ets_index,
"/var/lib/rabbitmq/mnesia/rabbit at rabbithost/msg_store_persistent",
<0.11231.0>,1138754,1130564,1142841,1146950},
{client_msstate,msg_store_transient,
<<154,31,168,204,117,254,217,155,174,95,243,199,81,
128,111,88>>,
{dict,0,16,16,8,80,48,
{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
[]}}},
{state,1114170,
"/var/lib/rabbitmq/mnesia/rabbit at rabbithost/msg_store_transient"},
rabbit_msg_store_ets_index,
"/var/lib/rabbitmq/mnesia/rabbit at rabbithost/msg_store_transient",
<0.11226.0>,1118269,1110080,1122364,1126465}},
true,0,#Fun<rabbit_amqqueue_process.5.18121064>,0,0,
infinity,0,0,0,0,0,
{rates,
{{1334,325010,274464},0},
{{1334,325010,274464},0},
0.0,0.0,
{1334,325011,275021}},
{0,nil},
{0,nil},
{0,nil},
{0,nil},
0,0,
{rates,
{{1334,325010,274464},0},
{{1334,325010,274464},0},
0.0,0.0,
{1334,325011,275021}}},
{[],[]},
undefined,undefined,undefined,undefined,
{state,fine,5000,undefined},
{0,nil},
4294967296,undefined}
** Reason for termination ==
** {badarg,[{erlang,send_after,[4294967296,<0.31584.0>,drop_expired]},
{rabbit_amqqueue_process,ensure_ttl_timer,1},
{rabbit_amqqueue_process,handle_call,3},
{gen_server2,handle_msg,2},
{proc_lib,wake_up,3}]}
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120413/29752582/attachment.htm>

From Cristian.Madularu at cassidiancommunications.com  Fri Apr 13 14:25:11 2012
From: Cristian.Madularu at cassidiancommunications.com (Cristian Madularu)
Date: Fri, 13 Apr 2012 09:25:11 -0400
Subject: [rabbitmq-discuss]  Use of RabbitMQ Client on Windows Phone 7
Message-ID: <3173206D0F5F6B418F76F5997B2AE75204D4E417@gatex01.CMLnet.peinet.peinc.com>

Hi Emile, 

Were you successful in building a RabbitMQ client that would work on a
Windows 7 device (or do you know of anyone who has done that)?

 

Thank you, 

Cristian 

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120413/063f02c3/attachment.htm>

From matthew at rabbitmq.com  Fri Apr 13 16:29:43 2012
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 13 Apr 2012 16:29:43 +0100
Subject: [rabbitmq-discuss] problem with very high queue TTL
In-Reply-To: <CAMhHffGZ1QaL0Voqg5i5AgE-HvH5JxSoFBbMiTgsQwL266SmVQ@mail.gmail.com>
References: <CAMhHffGZ1QaL0Voqg5i5AgE-HvH5JxSoFBbMiTgsQwL266SmVQ@mail.gmail.com>
Message-ID: <20120413152942.GI18040@rabbitmq.com>

Hello,

On Fri, Apr 13, 2012 at 05:19:30PM +0200, Bouh Bouh wrote:
> Working with rabbitmq, I found a nasty behavior relating to queue and their
> TTL. If you send a persistant message to a durable queue when the queue
> have a TTL over 4.294.967.295 (max 32bit int, or FF FF FF FF), then the
> queue is destroyed if the message is not consumed immediately.

> ** Reason for termination ==
> ** {badarg,[{erlang,send_after,[4294967296,<0.31584.0>,drop_expired]},
> {rabbit_amqqueue_process,ensure_ttl_timer,1},
> {rabbit_amqqueue_process,handle_call,3},
> {gen_server2,handle_msg,2},
> {proc_lib,wake_up,3}]}

TTL is expressed in milliseconds. 4294967296 ms is about 500 days. This
is rather long which is probably why no one's hit this bug, even though
it's been around for a while. Given our docs say that you can use a
long-long, which is a 64-bit int, this is clearly a bug. I'll file a bug
report.

Ironically, it's caused by the fact that erlang:send_after does *not*
obey the same type signature as timer:send_after. Joy.

Matthew

From emile at rabbitmq.com  Fri Apr 13 16:37:22 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 13 Apr 2012 16:37:22 +0100
Subject: [rabbitmq-discuss] Use of RabbitMQ Client on Windows Phone 7
In-Reply-To: <3173206D0F5F6B418F76F5997B2AE75204D4E417@gatex01.CMLnet.peinet.peinc.com>
References: <3173206D0F5F6B418F76F5997B2AE75204D4E417@gatex01.CMLnet.peinet.peinc.com>
Message-ID: <4F884832.6090503@rabbitmq.com>

Hi Cristian,

On 13/04/12 14:25, Cristian Madularu wrote:
> Were you successful in building a RabbitMQ client that would work on a
> Windows 7 device (or do you know of anyone who has done that)?

If you are referring to previous attempts at compiling the RabbitMQ .NET
client on the compact framework, then no, that didn't work:

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2010-September/008725.html

Depending on the complexity of your messaging requirements you should
also consider STOMP, which is much simpler to implement on low power
devices.

You may also be interested in Tony's UDP Exchange, which may be better
suited for devices with intermittent network access and low reliability
requirements:

https://github.com/tonyg/udp-exchange#readme



-Emile



From jasonjwwilliams at gmail.com  Fri Apr 13 16:48:04 2012
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Fri, 13 Apr 2012 09:48:04 -0600
Subject: [rabbitmq-discuss] Generating a Rabbitmq release
In-Reply-To: <20120413115035.GD18040@rabbitmq.com>
References: <CAMcAHLWzupdK_5X0yV-zurg1bSt2nOYPHveEhYoMvLXzLdxU-g@mail.gmail.com>
	<4F8802A9.1030904@rabbitmq.com>
	<CAMcAHLU-XWEL6QDAdL5nbE63_mn71iTVJD436qv2QJfSdqsWWw@mail.gmail.com>
	<20120413112611.GB18040@rabbitmq.com>
	<CAMcAHLVpB+XfKRpLSLTUH22ExDZtoG+cQhci2VGqW7Sj3=HtTQ@mail.gmail.com>
	<20120413114105.GC18040@rabbitmq.com>
	<20120413115035.GD18040@rabbitmq.com>
Message-ID: <6D3CF047-7388-439F-B375-2EA4CAA91AFA@gmail.com>

Personally I think a Mac .pkg would be incredibly beneficial to regular developers (college students' needs are a side benefit I think). Homebrew is only slightly less terrible than Macports as a packaging system and there are a ton of devs using OS X as their dev environment using neither as a result. 

So it seems to me to be a leg up in an evaluation fight against ActiveMQ, Redis, etc., for Rabbit to have a .pkg installer that drops in the whole kit and kaboodle so the user can get started evaling it's features, and a good thing overall. 

-J

Sent via iPhone

Is your email Premiere?

On Apr 13, 2012, at 5:50, Matthew Sackman <matthew at rabbitmq.com> wrote:

> On Fri, Apr 13, 2012 at 12:41:05PM +0100, Matthew Sackman wrote:
>> I agree the packaging issue is a problem, and there has been a lot done
>> to improve this. I do genuinely think that right now, the cloud foundary
>> approach may be a viable alternative if getting going quickly is the
>> key.
> 
> To be really clear, what I really object to is the reinvention of wheel
> regarding packaging. There are really good solutions out there - vastly
> better than what things like apt/deb offer, which should be very widely
> used but are not. The ongoing mess of homebrew/macports is horrible -
> and seems never to get better; the number of issues we see with rpm
> based systems is also horrific. Even debian based systems are
> essentially useless as unless you're root you can't install packages.
> There are systems out there, eg Nix / NixOS that allow any user to
> install anything and to do it in such a way that it has zero impact on
> other users. They've never caught on, and I find the current mess of
> packaging "solutions" hightly frustrating.
> 
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From gmr at myyearbook.com  Fri Apr 13 16:58:14 2012
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Fri, 13 Apr 2012 11:58:14 -0400
Subject: [rabbitmq-discuss] Generating a Rabbitmq release
In-Reply-To: <6D3CF047-7388-439F-B375-2EA4CAA91AFA@gmail.com>
References: <CAMcAHLWzupdK_5X0yV-zurg1bSt2nOYPHveEhYoMvLXzLdxU-g@mail.gmail.com>
	<4F8802A9.1030904@rabbitmq.com>
	<CAMcAHLU-XWEL6QDAdL5nbE63_mn71iTVJD436qv2QJfSdqsWWw@mail.gmail.com>
	<20120413112611.GB18040@rabbitmq.com>
	<CAMcAHLVpB+XfKRpLSLTUH22ExDZtoG+cQhci2VGqW7Sj3=HtTQ@mail.gmail.com>
	<20120413114105.GC18040@rabbitmq.com>
	<20120413115035.GD18040@rabbitmq.com>
	<6D3CF047-7388-439F-B375-2EA4CAA91AFA@gmail.com>
Message-ID: <B2EC66DF53FD4366B0B174612202F1BF@myyearbook.com>

It's also worth noting that it's been difficult to get the homebrew guys to accept updates and it is still on 2.7.1 (despite a 2.8.1 pull request). 

Gavin 


On Friday, April 13, 2012 at 11:48 AM, Jason J. W. Williams wrote:

> Personally I think a Mac .pkg would be incredibly beneficial to regular developers (college students' needs are a side benefit I think). Homebrew is only slightly less terrible than Macports as a packaging system and there are a ton of devs using OS X as their dev environment using neither as a result. 
> 
> So it seems to me to be a leg up in an evaluation fight against ActiveMQ, Redis, etc., for Rabbit to have a .pkg installer that drops in the whole kit and kaboodle so the user can get started evaling it's features, and a good thing overall. 
> 
> -J
> 
> Sent via iPhone
> 
> Is your email Premiere?
> 
> On Apr 13, 2012, at 5:50, Matthew Sackman <matthew at rabbitmq.com (mailto:matthew at rabbitmq.com)> wrote:
> 
> > On Fri, Apr 13, 2012 at 12:41:05PM +0100, Matthew Sackman wrote:
> > > I agree the packaging issue is a problem, and there has been a lot done
> > > to improve this. I do genuinely think that right now, the cloud foundary
> > > approach may be a viable alternative if getting going quickly is the
> > > key.
> > > 
> > 
> > 
> > To be really clear, what I really object to is the reinvention of wheel
> > regarding packaging. There are really good solutions out there - vastly
> > better than what things like apt/deb offer, which should be very widely
> > used but are not. The ongoing mess of homebrew/macports is horrible -
> > and seems never to get better; the number of issues we see with rpm
> > based systems is also horrific. Even debian based systems are
> > essentially useless as unless you're root you can't install packages.
> > There are systems out there, eg Nix / NixOS that allow any user to
> > install anything and to do it in such a way that it has zero impact on
> > other users. They've never caught on, and I find the current mess of
> > packaging "solutions" hightly frustrating.
> > 
> > Matthew
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120413/4a801aff/attachment.htm>

From matthew at rabbitmq.com  Fri Apr 13 16:59:24 2012
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 13 Apr 2012 16:59:24 +0100
Subject: [rabbitmq-discuss] Generating a Rabbitmq release
In-Reply-To: <6D3CF047-7388-439F-B375-2EA4CAA91AFA@gmail.com>
References: <CAMcAHLWzupdK_5X0yV-zurg1bSt2nOYPHveEhYoMvLXzLdxU-g@mail.gmail.com>
	<4F8802A9.1030904@rabbitmq.com>
	<CAMcAHLU-XWEL6QDAdL5nbE63_mn71iTVJD436qv2QJfSdqsWWw@mail.gmail.com>
	<20120413112611.GB18040@rabbitmq.com>
	<CAMcAHLVpB+XfKRpLSLTUH22ExDZtoG+cQhci2VGqW7Sj3=HtTQ@mail.gmail.com>
	<20120413114105.GC18040@rabbitmq.com>
	<20120413115035.GD18040@rabbitmq.com>
	<6D3CF047-7388-439F-B375-2EA4CAA91AFA@gmail.com>
Message-ID: <20120413155923.GK18040@rabbitmq.com>

On Fri, Apr 13, 2012 at 09:48:04AM -0600, Jason J. W. Williams wrote:
> Personally I think a Mac .pkg would be incredibly beneficial to
> regular developers (college students' needs are a side benefit I
> think). Homebrew is only slightly less terrible than Macports as a
> packaging system and there are a ton of devs using OS X as their dev
> environment using neither as a result.
> 
> So it seems to me to be a leg up in an evaluation fight against
> ActiveMQ, Redis, etc., for Rabbit to have a .pkg installer that drops
> in the whole kit and kaboodle so the user can get started evaling it's
> features, and a good thing overall.

I can definitely see how it would help, and that it would solve this
problem. However, it may introduce other problems. For example, if we
have a package with an erlang distribution in it, what happens if it's
used on a system which already has a system-wide erlang distribution? If
we produce such an .pkg, and so does ejabberd, and so does riak, and a
dev wants to use all three on the same machine, at the same time, how do
they go about doing that? What happens if each of those packages ships a
different version of Erlang? Do you try and get the different nodes to
talk to each other etc etc?

I can imagine we might end up producing such a thing. And it might very
well help a number of users, and that is a good thing. But it probably
will introduce problems which package managers were invented to solve.
Again, the lack of sane package managers on certain platforms is the
problem and everyone who tries to write software for those platforms
ends up having to deal with these issues, which diverts developer effort
from fixing bugs, or adding features. Sigh.

Matthew

From jasonjwwilliams at gmail.com  Fri Apr 13 17:08:21 2012
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Fri, 13 Apr 2012 10:08:21 -0600
Subject: [rabbitmq-discuss] Generating a Rabbitmq release
In-Reply-To: <20120413155923.GK18040@rabbitmq.com>
References: <CAMcAHLWzupdK_5X0yV-zurg1bSt2nOYPHveEhYoMvLXzLdxU-g@mail.gmail.com>
	<4F8802A9.1030904@rabbitmq.com>
	<CAMcAHLU-XWEL6QDAdL5nbE63_mn71iTVJD436qv2QJfSdqsWWw@mail.gmail.com>
	<20120413112611.GB18040@rabbitmq.com>
	<CAMcAHLVpB+XfKRpLSLTUH22ExDZtoG+cQhci2VGqW7Sj3=HtTQ@mail.gmail.com>
	<20120413114105.GC18040@rabbitmq.com>
	<20120413115035.GD18040@rabbitmq.com>
	<6D3CF047-7388-439F-B375-2EA4CAA91AFA@gmail.com>
	<20120413155923.GK18040@rabbitmq.com>
Message-ID: <304D96A5-3B6B-4D3C-9B30-BEA47E0084BB@gmail.com>

Yes, but properly done, a Rabbit .pkg should install Erlang in such a way that only Rabbit so installed can see it.  I believe this is what the ejabberd pkg does. 

Also, near as I can tell Alvaro is trying to make this a reality with his own labor, and is simply running into issues with the build process. That seems like an effort worth supporting given the benefits. 

-J

Sent via iPhone

Is your email Premiere?

On Apr 13, 2012, at 9:59, Matthew Sackman <matthew at rabbitmq.com> wrote:

> On Fri, Apr 13, 2012 at 09:48:04AM -0600, Jason J. W. Williams wrote:
>> Personally I think a Mac .pkg would be incredibly beneficial to
>> regular developers (college students' needs are a side benefit I
>> think). Homebrew is only slightly less terrible than Macports as a
>> packaging system and there are a ton of devs using OS X as their dev
>> environment using neither as a result.
>> 
>> So it seems to me to be a leg up in an evaluation fight against
>> ActiveMQ, Redis, etc., for Rabbit to have a .pkg installer that drops
>> in the whole kit and kaboodle so the user can get started evaling it's
>> features, and a good thing overall.
> 
> I can definitely see how it would help, and that it would solve this
> problem. However, it may introduce other problems. For example, if we
> have a package with an erlang distribution in it, what happens if it's
> used on a system which already has a system-wide erlang distribution? If
> we produce such an .pkg, and so does ejabberd, and so does riak, and a
> dev wants to use all three on the same machine, at the same time, how do
> they go about doing that? What happens if each of those packages ships a
> different version of Erlang? Do you try and get the different nodes to
> talk to each other etc etc?
> 
> I can imagine we might end up producing such a thing. And it might very
> well help a number of users, and that is a good thing. But it probably
> will introduce problems which package managers were invented to solve.
> Again, the lack of sane package managers on certain platforms is the
> problem and everyone who tries to write software for those platforms
> ends up having to deal with these issues, which diverts developer effort
> from fixing bugs, or adding features. Sigh.
> 
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From videlalvaro at gmail.com  Fri Apr 13 17:14:52 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 13 Apr 2012 18:14:52 +0200
Subject: [rabbitmq-discuss] Generating a Rabbitmq release
In-Reply-To: <20120413155923.GK18040@rabbitmq.com>
References: <CAMcAHLWzupdK_5X0yV-zurg1bSt2nOYPHveEhYoMvLXzLdxU-g@mail.gmail.com>
	<4F8802A9.1030904@rabbitmq.com>
	<CAMcAHLU-XWEL6QDAdL5nbE63_mn71iTVJD436qv2QJfSdqsWWw@mail.gmail.com>
	<20120413112611.GB18040@rabbitmq.com>
	<CAMcAHLVpB+XfKRpLSLTUH22ExDZtoG+cQhci2VGqW7Sj3=HtTQ@mail.gmail.com>
	<20120413114105.GC18040@rabbitmq.com>
	<20120413115035.GD18040@rabbitmq.com>
	<6D3CF047-7388-439F-B375-2EA4CAA91AFA@gmail.com>
	<20120413155923.GK18040@rabbitmq.com>
Message-ID: <1BD96E0442F949A89C2E413E3D3AF6CA@gmail.com>

Hi,

On Friday, April 13, 2012 at 5:59 PM, Matthew Sackman wrote:

> I can definitely see how it would help, and that it would solve this
> problem. However, it may introduce other problems. For example, if we
> have a package with an erlang distribution in it, what happens if it's
> used on a system which already has a system-wide erlang distribution? If
> we produce such an .pkg, and so does ejabberd, and so does riak, and a
> dev wants to use all three on the same machine, at the same time, how do
> they go about doing that? What happens if each of those packages ships a
> different version of Erlang? Do you try and get the different nodes to
> talk to each other etc etc?
> 
> 

I think the idea of such package is mostly to ease adoption. If you want to make internode communication between Riak, Ejabberd and RabbitMQ then you probably know how to get your Erlang up and running.

BTW, creating this .tar is something supported by OTP, it's not a hack. So I guess someone is using that in production already. The guys behind erlware created this tool to work with releases: https://github.com/erlware/sinan/wiki so I guess they probably use that. Also rebar supports generating releases, I guess that's what Riak does with their distros.

Also I don't think these releases conflict with each other. The only problem I can see is what happens with the epmd instance they will start. AFAIK Ejabberd kills it if no other Erlang process is running once the server exits.

Alvaro
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120413/f014cfa9/attachment.htm>

From gmr at myyearbook.com  Fri Apr 13 17:17:35 2012
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Fri, 13 Apr 2012 12:17:35 -0400
Subject: [rabbitmq-discuss] Generating a Rabbitmq release
In-Reply-To: <1BD96E0442F949A89C2E413E3D3AF6CA@gmail.com>
References: <CAMcAHLWzupdK_5X0yV-zurg1bSt2nOYPHveEhYoMvLXzLdxU-g@mail.gmail.com>
	<4F8802A9.1030904@rabbitmq.com>
	<CAMcAHLU-XWEL6QDAdL5nbE63_mn71iTVJD436qv2QJfSdqsWWw@mail.gmail.com>
	<20120413112611.GB18040@rabbitmq.com>
	<CAMcAHLVpB+XfKRpLSLTUH22ExDZtoG+cQhci2VGqW7Sj3=HtTQ@mail.gmail.com>
	<20120413114105.GC18040@rabbitmq.com>
	<20120413115035.GD18040@rabbitmq.com>
	<6D3CF047-7388-439F-B375-2EA4CAA91AFA@gmail.com>
	<20120413155923.GK18040@rabbitmq.com>
	<1BD96E0442F949A89C2E413E3D3AF6CA@gmail.com>
Message-ID: <DB88A2DD2D0B443FA3DA5C16C256AE6B@myyearbook.com>



On Friday, April 13, 2012 at 12:14 PM, Alvaro Videla wrote:

> 
> On Friday, April 13, 2012 at 5:59 PM, Matthew Sackman wrote:
> 
> 
> 
>  What happens if each of those packages ships a
> > different version of Erlang? Do you try and get the different nodes to
> > talk to each other etc etc?
> > 
> > 
> > 
> 
> I think the idea of such package is mostly to ease adoption. If you want to make internode communication between Riak, Ejabberd and RabbitMQ then you probably know how to get your Erlang up and running.
> 
> 

+1 
> 
> BTW, creating this .tar is something supported by OTP, it's not a hack. So I guess someone is using that in production already. The guys behind erlware created this tool to work with releases: https://github.com/erlware/sinan/wiki so I guess they probably use that. Also rebar supports generating releases, I guess that's what Riak does with their distros.
+1 

Cheers,

Gavin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120413/b4675254/attachment.htm>

From michael.s.klishin at gmail.com  Fri Apr 13 19:28:54 2012
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 13 Apr 2012 22:28:54 +0400
Subject: [rabbitmq-discuss] Generating a Rabbitmq release
In-Reply-To: <1BD96E0442F949A89C2E413E3D3AF6CA@gmail.com>
References: <CAMcAHLWzupdK_5X0yV-zurg1bSt2nOYPHveEhYoMvLXzLdxU-g@mail.gmail.com>
	<4F8802A9.1030904@rabbitmq.com>
	<CAMcAHLU-XWEL6QDAdL5nbE63_mn71iTVJD436qv2QJfSdqsWWw@mail.gmail.com>
	<20120413112611.GB18040@rabbitmq.com>
	<CAMcAHLVpB+XfKRpLSLTUH22ExDZtoG+cQhci2VGqW7Sj3=HtTQ@mail.gmail.com>
	<20120413114105.GC18040@rabbitmq.com>
	<20120413115035.GD18040@rabbitmq.com>
	<6D3CF047-7388-439F-B375-2EA4CAA91AFA@gmail.com>
	<20120413155923.GK18040@rabbitmq.com>
	<1BD96E0442F949A89C2E413E3D3AF6CA@gmail.com>
Message-ID: <6A342256-02C4-42EC-ADD1-EF61F00CC24F@gmail.com>

Alvaro Videla:

> I think the idea of such package is mostly to ease adoption. If you want to make internode communication between Riak, Ejabberd and RabbitMQ then you probably know how to get your Erlang up and running.

Spot on.

MK


From francois.beausoleil at gmail.com  Fri Apr 13 19:35:04 2012
From: francois.beausoleil at gmail.com (=?ISO-8859-1?Q?Fran=E7ois_Beausoleil?=)
Date: Fri, 13 Apr 2012 11:35:04 -0700 (PDT)
Subject: [rabbitmq-discuss] Connection always blocked
Message-ID: <7cdfc8c2-1acf-42b7-b504-376cdeca0abc@l18g2000vbx.googlegroups.com>

I'm replaying history in an event sourced system. I use Scala + Akka
to read serialized messages from disk, and publish to RabbitMQ, where
regular consumers will handle the messages and all that jazz. The
messages are published to a Topic exchange, with 12 queues bound to
the exchange, using left-anchored routing keys: "#", or "abc.#" and
similar. I'm using RabbitMQ 2.8.1, Akka 1.1.3, Scala 2.9.0.1, on
Rackspace's VMs, using Ubuntu 11.10.

I just researched on this mailing list and found a reference to the
flow control page: http://www.rabbitmq.com/memory.html. I went ahead
and read the document, and checked what my connection was doing:

# while sleep 5; do rabbitmqctl list_connections pid name peer_address
last_blocked_by last_blocked_age state | grep blocked ; done
<rabbit at amqp01.3.14347.20>      10.182.113.78:36734 ->
10.181.106.210:5672      10.182.113.78   flow    0.105658
blocked
<rabbit at amqp01.3.14347.20>      10.182.113.78:36734 ->
10.181.106.210:5672      10.182.113.78   flow    0.470772
blocked
<rabbit at amqp01.3.14347.20>      10.182.113.78:36734 ->
10.181.106.210:5672      10.182.113.78   flow    1.082906
blocked
<rabbit at amqp01.3.14347.20>      10.182.113.78:36734 ->
10.181.106.210:5672      10.182.113.78   flow    0.462744
blocked

As you can see, my connection is essentially always blocked.
Previously, under 2.7.1, my connection wouldn't block until I hit the
vm_memory_high_watermark. I upgraded to 2.8.1 specifically to prevent
such an issue from reoccuring, but I didn't anticipate the utter loss
of performance: under 2.7.1, I would publish 2000+ messages per
second, and I can barely achieve 900 now. I must have done something
wrong.

Can anyone help me achieve more performance?

Thanks a lot!
Fran?ois Beausoleil

From alexis.richardson at gmail.com  Fri Apr 13 19:37:07 2012
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Fri, 13 Apr 2012 19:37:07 +0100
Subject: [rabbitmq-discuss] Generating a Rabbitmq release
In-Reply-To: <6A342256-02C4-42EC-ADD1-EF61F00CC24F@gmail.com>
References: <CAMcAHLWzupdK_5X0yV-zurg1bSt2nOYPHveEhYoMvLXzLdxU-g@mail.gmail.com>
	<4F8802A9.1030904@rabbitmq.com>
	<CAMcAHLU-XWEL6QDAdL5nbE63_mn71iTVJD436qv2QJfSdqsWWw@mail.gmail.com>
	<20120413112611.GB18040@rabbitmq.com>
	<CAMcAHLVpB+XfKRpLSLTUH22ExDZtoG+cQhci2VGqW7Sj3=HtTQ@mail.gmail.com>
	<20120413114105.GC18040@rabbitmq.com>
	<20120413115035.GD18040@rabbitmq.com>
	<6D3CF047-7388-439F-B375-2EA4CAA91AFA@gmail.com>
	<20120413155923.GK18040@rabbitmq.com>
	<1BD96E0442F949A89C2E413E3D3AF6CA@gmail.com>
	<6A342256-02C4-42EC-ADD1-EF61F00CC24F@gmail.com>
Message-ID: <CACOPnvfB9J48D90BM7vPJ+7J4YSvBpiFtG1f1WtKF78gMF+QoA@mail.gmail.com>

+1
 On Apr 13, 2012 7:29 PM, "Michael Klishin" <michael.s.klishin at gmail.com>
wrote:

> Alvaro Videla:
>
> > I think the idea of such package is mostly to ease adoption. If you want
> to make internode communication between Riak, Ejabberd and RabbitMQ then
> you probably know how to get your Erlang up and running.
>
> Spot on.
>
> MK
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120413/5851a72a/attachment.htm>

From GabrielHP at conexiant.net  Fri Apr 13 20:00:21 2012
From: GabrielHP at conexiant.net (Gabriel Hernandez)
Date: Fri, 13 Apr 2012 19:00:21 +0000
Subject: [rabbitmq-discuss] RabbitMQ Shovel problem
In-Reply-To: <4F87FC25.4010907@rabbitmq.com>
References: <257758D7885DBC429372DD0F67DD97571306A8F6@CH1PRD0802MB120.namprd08.prod.outlook.com>
	<4F87FC25.4010907@rabbitmq.com>
Message-ID: <257758D7885DBC429372DD0F67DD97571306AC11@CH1PRD0802MB120.namprd08.prod.outlook.com>

Hi Simon,

Thank you, this solved the issue.

-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: Friday, April 13, 2012 4:13 AM
To: Gabriel Hernandez
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] RabbitMQ Shovel problem

On 12/04/12 20:52, Gabriel Hernandez wrote:
> At first everything works fine, but after some time of the connection 
> being idle the shovel seems to stop working.

We often seem to get reports of networks killing idle TCP connections, which might be what's happening to you. Can you try enabling AMQP heartbeats?

Cheers, Simon

--
Simon MacMullen
RabbitMQ, VMware



From octomeow at gmail.com  Fri Apr 13 20:42:56 2012
From: octomeow at gmail.com (octomeow)
Date: Fri, 13 Apr 2012 12:42:56 -0700 (PDT)
Subject: [rabbitmq-discuss] high water mark
Message-ID: <72bcfa23-0a40-42ab-af99-10b00781b745@qg3g2000pbc.googlegroups.com>

I  would like to set a high water mark

Here is my rabbitmq.config file

[
{rabbit, [{cluster_nodes, ['rabbit at xxx-1', 'rabbit at xxx-2']
        % Use this to change the default tcp port
        {rabbit, [{tcp_listeners, [5672]}]},

        % To precompile parts of RabbitMQ with the High Performance
Erlang compi
        % (If Erlang VM segfaults or if HiPE support is not compiled
into your E
    {rabbit, [{hipe_compile, [true]}]},


    {rabbit, [{frame_max, [0]}]},

        % At this fraction of RAM the server introduces a flow control
mechanism
        % but lets consumers continue unaffected
        % (To be configured based on availabily of RAM)
        {rabbit, [{vm_memory_high_watermark, 0.6}]}
  ].


but after stopping and restarting the service I'm still seeing

 {vm_memory_high_watermark,0.39999999999605385},
 {vm_memory_limit,40545928806}]


can anyone advise?

From francois.beausoleil at gmail.com  Fri Apr 13 21:23:00 2012
From: francois.beausoleil at gmail.com (=?utf-8?Q?Fran=C3=A7ois_Beausoleil?=)
Date: Fri, 13 Apr 2012 16:23:00 -0400
Subject: [rabbitmq-discuss] Publisher throttled way too early
Message-ID: <A2DEA1C2237B481A80D206950D41A0BB@gmail.com>

Hi all!  

Apologies if this is duplicated, I can't see my message on Google Groups after 2 hours.  

I upgraded to 2.8.1 after my publishers were throttled way too late: I would always end up hitting the vm_memory_high_watermark before the throttling occurred. Now, the problem is reversed: I am throttled way too early. My publisher is barely publishing 200 messages per second, with another 600 coming from the rest of the system. In total, I haven't breached 900 messages/second.

After some research, I found a thread on the rabbitmq-discuss list, which pointed me to the flow control page: http://www.rabbitmq.com/memory.html

From the flow control page, I ran the following:

# while sleep 5; do rabbitmqctl list_connections pid name peer_address last_blocked_by last_blocked_age state | grep blocked ; done
<rabbit at amqp01.3.14347.20> 10.182.113.78:36734 -> 10.181.106.210:5672 10.182.113.78 flow 0.051966 blocked
<rabbit at amqp01.3.14347.20> 10.182.113.78:36734 -> 10.181.106.210:5672 10.182.113.78 flow 0.139588 blocked
<rabbit at amqp01.3.14347.20> 10.182.113.78:36734 -> 10.181.106.210:5672 10.182.113.78 flow 1.531009 blocked
<rabbit at amqp01.3.14347.20> 10.182.113.78:36734 -> 10.181.106.210:5672 10.182.113.78 flow 0.586091 blocked
<rabbit at amqp01.3.14347.20> 10.182.113.78:36734 -> 10.181.106.210:5672 10.182.113.78 flow 1.107713 blocked
<rabbit at amqp01.3.14347.20> 10.182.113.78:36734 -> 10.181.106.210:5672 10.182.113.78 flow 0.411649 blocked



As you can see, my publisher is essentially always blocked.

What I'm trying to achieve is replay history from a set of archive files. I run an event-sourced system, and I found the need to replay my history. A 3.5 GiB file is currently planned to finish in 6h, and I have more than 300 3.5 GiB files to replay.

I'm using Akka 1.1.3, RabbitMQ 2.8.1, Scala 2.9.0.1, OpenJDK-6, Ubuntu 11.10, all on Rackspace's virtual machines.

Did I forget something somewhere? 200 messages per second seems very paltry compared to the 2000 I had on 2.7.

Thanks!
--
Fran?ois Beausoleil
http://blog.teksol.info/



From videlalvaro at gmail.com  Sat Apr 14 22:22:37 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Sat, 14 Apr 2012 23:22:37 +0200
Subject: [rabbitmq-discuss] Generating a Rabbitmq release
In-Reply-To: <CACOPnvfB9J48D90BM7vPJ+7J4YSvBpiFtG1f1WtKF78gMF+QoA@mail.gmail.com>
References: <CAMcAHLWzupdK_5X0yV-zurg1bSt2nOYPHveEhYoMvLXzLdxU-g@mail.gmail.com>
	<4F8802A9.1030904@rabbitmq.com>
	<CAMcAHLU-XWEL6QDAdL5nbE63_mn71iTVJD436qv2QJfSdqsWWw@mail.gmail.com>
	<20120413112611.GB18040@rabbitmq.com>
	<CAMcAHLVpB+XfKRpLSLTUH22ExDZtoG+cQhci2VGqW7Sj3=HtTQ@mail.gmail.com>
	<20120413114105.GC18040@rabbitmq.com>
	<20120413115035.GD18040@rabbitmq.com>
	<6D3CF047-7388-439F-B375-2EA4CAA91AFA@gmail.com>
	<20120413155923.GK18040@rabbitmq.com>
	<1BD96E0442F949A89C2E413E3D3AF6CA@gmail.com>
	<6A342256-02C4-42EC-ADD1-EF61F00CC24F@gmail.com>
	<CACOPnvfB9J48D90BM7vPJ+7J4YSvBpiFtG1f1WtKF78gMF+QoA@mail.gmail.com>
Message-ID: <53AF5F6301124C2CB11C372640A1ED10@gmail.com>

Hi,

By googling something related to Erlang releases I found out that in Feb 2012 a user wanted to do something similar to this: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-February/017895.html

In my case a short update:

I modified the Makefile from RabbitMQ to be able to generate the release from which I can pack a .tar.gz file of approximately 7MB. This server version has no plugins so far, that's on the TODO list.

I will try to share my changes later, maybe forking the Github repo from rabbitmq.

Regards,

Alvaro
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120414/4afbf453/attachment.htm>

From tonygarnockjones+rabbitmq at gmail.com  Sun Apr 15 00:07:58 2012
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Sat, 14 Apr 2012 19:07:58 -0400
Subject: [rabbitmq-discuss] Generating a Rabbitmq release
In-Reply-To: <53AF5F6301124C2CB11C372640A1ED10@gmail.com>
References: <CAMcAHLWzupdK_5X0yV-zurg1bSt2nOYPHveEhYoMvLXzLdxU-g@mail.gmail.com>
	<4F8802A9.1030904@rabbitmq.com>
	<CAMcAHLU-XWEL6QDAdL5nbE63_mn71iTVJD436qv2QJfSdqsWWw@mail.gmail.com>
	<20120413112611.GB18040@rabbitmq.com>
	<CAMcAHLVpB+XfKRpLSLTUH22ExDZtoG+cQhci2VGqW7Sj3=HtTQ@mail.gmail.com>
	<20120413114105.GC18040@rabbitmq.com>
	<20120413115035.GD18040@rabbitmq.com>
	<6D3CF047-7388-439F-B375-2EA4CAA91AFA@gmail.com>
	<20120413155923.GK18040@rabbitmq.com>
	<1BD96E0442F949A89C2E413E3D3AF6CA@gmail.com>
	<6A342256-02C4-42EC-ADD1-EF61F00CC24F@gmail.com>
	<CACOPnvfB9J48D90BM7vPJ+7J4YSvBpiFtG1f1WtKF78gMF+QoA@mail.gmail.com>
	<53AF5F6301124C2CB11C372640A1ED10@gmail.com>
Message-ID: <CAM8fPiSy5mhcpykesLSMXmARkyKniPnT7qaAWC7iTXpU+8PWPQ@mail.gmail.com>

Wow, cool! Is it reltool-based? What's the reltool.config you're using, if
so?

Regards,
  Tony


On 14 April 2012 17:22, Alvaro Videla <videlalvaro at gmail.com> wrote:

> Hi,
>
> By googling something related to Erlang releases I found out that in Feb
> 2012 a user wanted to do something similar to this:
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-February/017895.html
>
> In my case a short update:
>
> I modified the Makefile from RabbitMQ to be able to generate the release
> from which I can pack a .tar.gz file of approximately 7MB. This server
> version has no plugins so far, that's on the TODO list.
>
> I will try to share my changes later, maybe forking the Github repo from
> rabbitmq.
>
> Regards,
>
> Alvaro
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
Tony Garnock-Jones
tonygarnockjones at gmail.com
http://homepages.kcbbs.gen.nz/tonyg/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120414/22f0b3f9/attachment.htm>

From videlalvaro at gmail.com  Sun Apr 15 02:01:45 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Sun, 15 Apr 2012 03:01:45 +0200
Subject: [rabbitmq-discuss] Generating a Rabbitmq release
In-Reply-To: <CAM8fPiSy5mhcpykesLSMXmARkyKniPnT7qaAWC7iTXpU+8PWPQ@mail.gmail.com>
References: <CAMcAHLWzupdK_5X0yV-zurg1bSt2nOYPHveEhYoMvLXzLdxU-g@mail.gmail.com>
	<4F8802A9.1030904@rabbitmq.com>
	<CAMcAHLU-XWEL6QDAdL5nbE63_mn71iTVJD436qv2QJfSdqsWWw@mail.gmail.com>
	<20120413112611.GB18040@rabbitmq.com>
	<CAMcAHLVpB+XfKRpLSLTUH22ExDZtoG+cQhci2VGqW7Sj3=HtTQ@mail.gmail.com>
	<20120413114105.GC18040@rabbitmq.com>
	<20120413115035.GD18040@rabbitmq.com>
	<6D3CF047-7388-439F-B375-2EA4CAA91AFA@gmail.com>
	<20120413155923.GK18040@rabbitmq.com>
	<1BD96E0442F949A89C2E413E3D3AF6CA@gmail.com>
	<6A342256-02C4-42EC-ADD1-EF61F00CC24F@gmail.com>
	<CACOPnvfB9J48D90BM7vPJ+7J4YSvBpiFtG1f1WtKF78gMF+QoA@mail.gmail.com>
	<53AF5F6301124C2CB11C372640A1ED10@gmail.com>
	<CAM8fPiSy5mhcpykesLSMXmARkyKniPnT7qaAWC7iTXpU+8PWPQ@mail.gmail.com>
Message-ID: <8D3AD1F95B564FED92987FFF9B976B24@gmail.com>

Hi Tony, 

No, I generated a rabbit.rel file using ideas from rabbit_prelaunch.erl, from there I created the .script file and the .boot one. 

Then I did all the packaging and some .sh scripts using make/bash so I can generate the .tar.gz file

Probably tomorrow I will submit my code so I can share what I've done so far. 

Cheers,

Alvaro 

-- 
Alvaro Videla
Sent with Sparrow (http://www.sparrowmailapp.com/?sig)


On Sunday, April 15, 2012 at 1:07 AM, Tony Garnock-Jones wrote:

> Wow, cool! Is it reltool-based? What's the reltool.config you're using, if so?
> 
> Regards,
>   Tony
> 
> 
> On 14 April 2012 17:22, Alvaro Videla <videlalvaro at gmail.com (mailto:videlalvaro at gmail.com)> wrote:
> > Hi,
> > 
> > By googling something related to Erlang releases I found out that in Feb 2012 a user wanted to do something similar to this: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-February/017895.html 
> > 
> > In my case a short update:
> > 
> > I modified the Makefile from RabbitMQ to be able to generate the release from which I can pack a .tar.gz file of approximately 7MB. This server version has no plugins so far, that's on the TODO list. 
> > 
> > I will try to share my changes later, maybe forking the Github repo from rabbitmq.
> > 
> > Regards,
> > 
> > Alvaro 
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > 
> 
> 
> 
> -- 
> Tony Garnock-Jones
> tonygarnockjones at gmail.com (mailto:tonygarnockjones at gmail.com)
> http://homepages.kcbbs.gen.nz/tonyg/

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120415/03448111/attachment.htm>

From videlalvaro at gmail.com  Sun Apr 15 20:48:16 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Sun, 15 Apr 2012 21:48:16 +0200
Subject: [rabbitmq-discuss] Problems with umbrella make files
Message-ID: <EA2623065081418FA792767BF6809013@gmail.com>

Hi, 

I'm trying to run the "make plugins" target from rabbitmq-server Makefile (obtained from the umbrella repo)

If I run the target like this it fails:

make plugins PLUGINS_SRC_DIR="`pwd`/.." VERSION=2.8.1u

Since I start to get the same output again and again. See this gist: https://gist.github.com/2394475

Unless I ran before the following target from the rabbitmq-public-umbrella Makefile:

make release VERSION=2.8.1u

I understand that the "plugins" target will call that one, so I'm puzzled here.

I also tried adding the following target in the rabbitmq-server/Makefile

mydebug:                                                                                                                                                                                                    
        $(MAKE) -C "$(PLUGINS_SRC_DIR)" clean


Running it like: 

make mydebug PLUGINS_SRC_DIR=..

also fails with the same output as in the previous gist.

Any ideas on what might be wrong? Am I missing something?

Regards,

Alvaro

-- 
Alvaro Videla
Sent with Sparrow (http://www.sparrowmailapp.com/?sig)

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120415/e0588b36/attachment.htm>

From videlalvaro at gmail.com  Sun Apr 15 22:46:50 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Sun, 15 Apr 2012 23:46:50 +0200
Subject: [rabbitmq-discuss] RabbitMQ release WIP
Message-ID: <B6B4B3C883B74893AEBBE6DBED4F40C6@gmail.com>

Hi, 

I would like to share this project https://github.com/videlalvaro/rabbitmq-release where I hacked together a rabbitmq standalone release that includes Erlang's run time system.

Please read the README file from the project to see how to use it and to understand what where my goals. My ultimate goal is to be able to create a .pkg file, or even a Rabbitmq.app file for the Mac that you could just drag&drop into the /Applications folder.

You can download a release that works on Mac only here: https://raw.github.com/videlalvaro/rabbitmq-release/master/downloads/rabbitmq-server-osx-2.8.1u.tar.gz

The 'u' after the version number stands for unofficial, just in case ;)

Feedback is very welcome to see how we could improve this. 

For example, after you apply the patch to the hg repo you will find that inside the pre-release/templates there are slightly modified versions of the rabbitmq/scripts/*. Also the new module src/rabbit_release.erl  is a shameless copy with some modifications from the src/rabbit_prelaunch.erl module.

Again, this is a work in progress.

Regards,

Alvaro
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120415/0594c4e6/attachment.htm>

From netsinque at gmail.com  Sun Apr 15 10:04:01 2012
From: netsinque at gmail.com (AgileZebra)
Date: Sun, 15 Apr 2012 02:04:01 -0700 (PDT)
Subject: [rabbitmq-discuss] Routing on multiple criteria but hitting only
	one consumer
Message-ID: <90116f8d-196e-492b-9ea3-e2ba8dd5a140@j9g2000pbn.googlegroups.com>

How can we distribute work such that worker pools can subscribe to
work messages based on differing (but frequently overlapping) criteria
from each other but such that when a message is routed that matches to
multiple worker pools, only one worker will pick up the job?

Simplified example:

* We have host1 and host2.
* Host1 handles jobs of classA and classB; host2 handles jobs of
classB and classC.
* If we route a job of classA, only host1 will pick it up; if we route
a job of classB, either host1 or host2 will pick it up (based on their
current load / first available) but never both.
It would seem that we need to use a topic exchange, as our routing
criteria is complex and using wildcards gives us the type of flexible
matching we want.

However:

1) If we use the same name for the worker pool queue (say ?worker-
jobs?) we get the desired work splitting out to arbitrary matching
workers, but every worker subscribing to the named queue seems to
infect the other workers with each other?s routing criteria as they
bind it. I.e. the binding of the routing key seems to be at the
central queue name level not on a connection-to-queue basis.
2) If we use different queue names for each worker pool connection
(say ?poolA-jobs? and ?poolB-jobs?) to the same exchange then we get
the desired behavior with the different routing criteria maintained
between pools but a job coming in that can match to both poolA and
poolB gets routed to both of them (albeit only to one worker in each).

Notes:
1) I?ve spared you the details of why but suffice to say we have an
existing multi-petabyte distributed search application that needs
response times < 50ms. We already achieve this with our own custom
routing hub but we?d like to replace this with RabbitMQ as its
performance is attractive (as is retiring homemade code that overlaps
with general purpose community projects) if we can get the more
sophisticated routing we need.
2) We use Python
3) We actually have the luxury of already knowing upfront which hosts
are capable of serving which jobs, so we can do something like have
host1 subscribe to #.host1.# and host2 to #.host2.#. Then when we
route a classB message, we can give it a key of host1.host2 to
indicate which backends are acceptable for service. This simplifies
the routing rules but still doesn?t overcome the problem described.

From gautam.bakshi at gmail.com  Mon Apr 16 06:02:03 2012
From: gautam.bakshi at gmail.com (Gautam)
Date: Sun, 15 Apr 2012 22:02:03 -0700 (PDT)
Subject: [rabbitmq-discuss] Having trouble getting rabbitmq-server to read
 rabbitmq-env.conf settings to change database location.
Message-ID: <17518252.3421.1334552523915.JavaMail.geo-discussion-forums@vbuo5>



I'm having problems changing the default location for a rabbitmq instance.
I'm following the install steps from the website. Here's my install script:

#install rabbitmq
su -c 'rpm -Uvh http://download.fedoraproject.org/pub/epel/6/i386/epel-release-6-5.noarch.rpm'
yum -y install erlang
rpm --import http://www.rabbitmq.com/rabbitmq-signing-key-public.asc
yum -y install rabbitmq-server-2.8.1-1.noarch.rpm   
rabbitmq-plugins enable rabbitmq_management 

It starts fine but as I use the queue my main OS harddrive fills up. I am 
using EC2 so the main harddrive is pretty limited but I have 800G on 
another drive thats mounted so I made a folder 
there(/ephemeral0/rabbitmq/). On the website, I believe it says I need to 
create a config file(to change the location of the envirmoent variable that 
controls the location of the database) in this location
/etc/rabbitmq/rabbitmq-env.conf

I create it with the following data: BASE=/ephemeral0/rabbitmq/ and restart 
rabbitmq-server but as I use the new queue my OS drive continues to fill up 
and nothing is created on the location I actually want the data to be 
stored.

To test this further, I stopped rabbitmq(via service rabbitmq-server stop) 
and ran rabbitmq-serverand in its start up screen I noticed: config file(s) 
: (none) I wasn't sure if this was related to config file itself or the 
rabbitmq-env.conf file so I decided to add CONFIG_FILE=/etc/rabbitmq/ and 
re ran rabbitmq-server but still no luck(same message).

What can I do to change the location? I'm using the latest version of 
rabbitmq and centos 6.2.

Please help.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120415/93a91e75/attachment.htm>

From emile at rabbitmq.com  Mon Apr 16 10:35:48 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 16 Apr 2012 10:35:48 +0100
Subject: [rabbitmq-discuss] Having trouble getting rabbitmq-server to
 read rabbitmq-env.conf settings to change database location.
In-Reply-To: <17518252.3421.1334552523915.JavaMail.geo-discussion-forums@vbuo5>
References: <17518252.3421.1334552523915.JavaMail.geo-discussion-forums@vbuo5>
Message-ID: <4F8BE7F4.6030008@rabbitmq.com>

Hi Gautam,

On 16/04/12 06:02, Gautam wrote:
> I'm having problems changing the default location for a rabbitmq instance.

> What can I do to change the location? I'm using the latest version of
> rabbitmq and centos 6.2.

Define LOG_BASE in the rabbitmq-env.conf file if you want logfiles in a
different directory. Likewise, define MNESIA_BASE to have the RabbitMQ
database in a different location.

See these pages for more information:
http://www.rabbitmq.com/relocate.html
http://www.rabbitmq.com/configure.html


-Emile



From emile at rabbitmq.com  Mon Apr 16 10:58:02 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 16 Apr 2012 10:58:02 +0100
Subject: [rabbitmq-discuss] Routing on multiple criteria but hitting
 only one consumer
In-Reply-To: <90116f8d-196e-492b-9ea3-e2ba8dd5a140@j9g2000pbn.googlegroups.com>
References: <90116f8d-196e-492b-9ea3-e2ba8dd5a140@j9g2000pbn.googlegroups.com>
Message-ID: <4F8BED2A.7070008@rabbitmq.com>

Hi,

On 15/04/12 10:04, AgileZebra wrote:

> * We have host1 and host2.
> * Host1 handles jobs of classA and classB; host2 handles jobs of
> classB and classC.
> * If we route a job of classA, only host1 will pick it up; if we route
> a job of classB, either host1 or host2 will pick it up (based on their
> current load / first available) but never both.

Can you constrain the routing so that messages are only routed to one
queue, and you have one queue per class? Then host1 can subscribe to the
queues for classA and classB, and host2 can subscribe to the queues for
classB and classC.


-Emile



From emile at rabbitmq.com  Mon Apr 16 11:07:52 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 16 Apr 2012 11:07:52 +0100
Subject: [rabbitmq-discuss] high water mark
In-Reply-To: <72bcfa23-0a40-42ab-af99-10b00781b745@qg3g2000pbc.googlegroups.com>
References: <72bcfa23-0a40-42ab-af99-10b00781b745@qg3g2000pbc.googlegroups.com>
Message-ID: <4F8BEF78.7040708@rabbitmq.com>

Hi,

On 13/04/12 20:42, octomeow wrote:
> I  would like to set a high water mark
> 
> Here is my rabbitmq.config file

Here is a correctly formatted version of your rabbitmq.config file:


%< %< %< %< %< %< %< %< %< %< %<
[
  {rabbit, [{cluster_nodes, ['rabbit at xxx-1', 'rabbit at xxx-2']},
            {tcp_listeners, [5672]},
            {hipe_compile, true},
            {frame_max, [0]},
            {vm_memory_high_watermark, 0.6}]}
].
%< %< %< %< %< %< %< %< %< %< %<



-Emile



From emile at rabbitmq.com  Mon Apr 16 11:15:07 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 16 Apr 2012 11:15:07 +0100
Subject: [rabbitmq-discuss] high water mark
In-Reply-To: <4F8BEF78.7040708@rabbitmq.com>
References: <72bcfa23-0a40-42ab-af99-10b00781b745@qg3g2000pbc.googlegroups.com>
	<4F8BEF78.7040708@rabbitmq.com>
Message-ID: <4F8BF12B.8040705@rabbitmq.com>

On 16/04/12 11:07, Emile Joubert wrote:
> Here is a correctly formatted version of your rabbitmq.config file:

>             {frame_max, [0]},

I just noticed that frame_max takes a numeric argument rather than a
list. This is detailed on the configuration page:
http://www.rabbitmq.com/configure.html
So the correct version of your rabbitmq.config file is this:

%< %< %< %< %< %< %< %< %< %< %<
[
  {rabbit, [{cluster_nodes, ['rabbit at xxx-1', 'rabbit at xxx-2']},
            {tcp_listeners, [5672]},
            {hipe_compile, true},
            {frame_max, 0},
            {vm_memory_high_watermark, 0.6}]}
].
%< %< %< %< %< %< %< %< %< %< %<

From simon at rabbitmq.com  Mon Apr 16 11:36:24 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 16 Apr 2012 11:36:24 +0100
Subject: [rabbitmq-discuss] Publisher throttled way too early
In-Reply-To: <A2DEA1C2237B481A80D206950D41A0BB@gmail.com>
References: <A2DEA1C2237B481A80D206950D41A0BB@gmail.com>
Message-ID: <4F8BF628.2080805@rabbitmq.com>

On 13/04/12 21:23, Fran?ois Beausoleil wrote:
> Hi all!

Hi Fran?ois.

<snip>

> My publisher is barely publishing 200 messages per second,
> with another 600 coming from the rest of the system. In total, I
> haven't breached 900 messages/second.

<snip>

> As you can see, my publisher is essentially always blocked.

Well, the blocking is flicking on and off rapidly, so it's essentially 
rate-limited rather than blocked. But still.

2.7.1 and earlier would accept message as fast as they could be read off 
the socket, indefinitely. Hence your ballooning memory use. 2.8.1 will 
only accept messages as fast as they can be handled. It's not 
inconceivable that this code is buggy, but it's fairly simple and has 
received quite a bit of testing, so I suspect it's OK.

So therefore I think that your system can really only handle that many 
messages per second. Are they persistent, or are your queues big enough 
that non-persistent messages page out? That sort of performance sounds 
more like the sort of thing you would see when IO-bound.

> What I'm trying to achieve is replay history from a set of archive
> files. I run an event-sourced system, and I found the need to replay
> my history. A 3.5 GiB file is currently planned to finish in 6h, and
> I have more than 300 3.5 GiB files to replay.

If you need to absorb spikes in message rate then you can increase the 
size of the OS-supplied TCP buffers, but it sounds like you really need 
steady-state performance.

> I'm using Akka 1.1.3, RabbitMQ 2.8.1, Scala 2.9.0.1, OpenJDK-6,
> Ubuntu 11.10, all on Rackspace's virtual machines.
>
> Did I forget something somewhere? 200 messages per second seems very
> paltry compared to the 2000 I had on 2.7.

It depends - if 2.8.1 is putting 200/900 msg/s on disc, and 2.7.1 is 
buffering 2000 msg/s in memory, then it's not too surprising.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Mon Apr 16 11:49:04 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 16 Apr 2012 11:49:04 +0100
Subject: [rabbitmq-discuss] SSL connection issue from .net client
In-Reply-To: <2A876ED89F61324C85F585C2C315FB1A2323E26D74@DCPWAEXCH01.edftrading.com>
References: <2A876ED89F61324C85F585C2C315FB1A2323E26D74@DCPWAEXCH01.edftrading.com>
Message-ID: <4F8BF920.3010900@rabbitmq.com>

Hi Paul,

On 13/04/12 13:17, Paul Smith wrote:
> Any help on this problem is greatly appreciated. I am getting an error
> when I try to connect to a broker on an SSL connection. The error I get is:

It is possible that the broker is configured to authenticate with SSL
(See
http://hg.rabbitmq.com/rabbitmq-auth-mechanism-ssl/file/default/README)
and that the .NET client is not presenting the same information as the
Java client. Perhaps the difference  lies in the Java key store.

The problem would be easier to solve if you had access to the
configuration of the broker. You should also allow for the possibility
that the remote broker has been modified in some way.


-Emile



From simon at rabbitmq.com  Mon Apr 16 11:55:51 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 16 Apr 2012 11:55:51 +0100
Subject: [rabbitmq-discuss] Per-Connection Flow Control - RMQ 2.8.1
In-Reply-To: <4F86EC12.7030602@aol.com>
References: <4F6CD702.4050908@aol.com>
	<4F704404.8080504@rabbitmq.com>	<4F728392.5070602@aol.com>
	<4F72E8A4.1010609@rabbitmq.com> <4F730718.6080908@rabbitmq.com>
	<4F86EC12.7030602@aol.com>
Message-ID: <4F8BFAB7.1070706@rabbitmq.com>

I would have thought that in your scenario you would be more bound by 
disc performance than anything else - aren't you having messages paging 
off the disc and being expired?

Just to be clear, do you have a message rate for your use case that 
leads to *stable* memory use in 2.7.1 but which cannot be maintained by 
2.8.1? I was unable to find one with my attempts at replicating your 
scenario.

Cheers, Simon

On 12/04/12 15:52, DawgTool wrote:
> Hi Simon,
>
> Just a quick update. I have collected some stats, but mostly looking at
> the rabbitmqctl list_channels. Anyway, I will get those graphed at some
> point.
>
> I did however build the same setup (2.8.1/R15B) on a 16 core/96GB
> machine and I hit the same limits as the 4 core/16GB.
>
> So right now it doesn't appear to be a 'horse-power' issue, possible its
> a logic/functional issue. Let me know what you think.
>
> Thanks
>
>
> On 3/28/12 8:42 AM, Simon MacMullen wrote:
>> On 28/03/12 11:32, Simon MacMullen wrote:
>>> I will try to reproduce based on the above, but anything else you can
>>> tell me would be a great help.
>>
>> Hmm, I'm struggling with this.
>>
>> I can certainly get into a state with a combination of x-message-ttl,
>> lots of messages expiring, and enough memory pressure to push much of
>> the queue onto disc, such that the queue performance fluctuates quite
>> a bit (as it switches between accepting new messages / paging messages
>> out to disc / paging them back in / expiring them).
>>
>> But I can't get a message rate that works OK in this scenario with
>> flow control disabled but blocks for long periods with it enabled. If
>> the message rate is high enough for flow control to kick in, then it's
>> also high enough for memory use to go up as messages wait to enter the
>> queue if flow control is disabled. Eventually the memory alarm goes
>> off instead.
>>
>> So can you provide more information about your use pattern?
>>
>> Having said that, if you just want to disable flow control and are
>> prepared to build from source, you could apply the following patch:
>>
>> diff -r f0dafaca6cd1 src/rabbit_reader.erl
>> --- a/src/rabbit_reader.erl Mon Mar 26 17:12:41 2012 +0100
>> +++ b/src/rabbit_reader.erl Wed Mar 28 13:40:03 2012 +0100
>> @@ -360,7 +360,7 @@
>>
>> control_throttle(State = #v1{connection_state = CS,
>> conserve_memory = Mem}) ->
>> - case {CS, Mem orelse credit_flow:blocked()} of
>> + case {CS, Mem} of
>> {running, true} -> State#v1{connection_state = blocking};
>> {blocking, false} -> State#v1{connection_state = running};
>> {blocked, false} -> ok = rabbit_heartbeat:resume_monitor(
>>
>> But I would like to understand more about what you're seeing.
>>
>> Cheers, Simon
>>
>


-- 
Simon MacMullen
RabbitMQ, VMware

From abdullahsaima at yahoo.com  Mon Apr 16 12:14:48 2012
From: abdullahsaima at yahoo.com (Saima Asif)
Date: Mon, 16 Apr 2012 12:14:48 +0100 (BST)
Subject: [rabbitmq-discuss] what are message attributes used by broker
	in RABBITMQ
In-Reply-To: <4F85804C.70009@rabbitmq.com>
References: <1334145243.23896.YahooMailNeo@web29703.mail.ird.yahoo.com>
	<4F8577F3.3060604@rabbitmq.com>
	<1334147886.33780.YahooMailNeo@web29704.mail.ird.yahoo.com>
	<4F85804C.70009@rabbitmq.com>
Message-ID: <1334574888.94533.YahooMailNeo@web29704.mail.ird.yahoo.com>

Dear Emile, 
?
I just want to have an estimate that how much time a message broker consumes on a message , that could be understood by the number of entities involved in message decoding?done by?exchanges. what attributed a message?considers to perfrom?interpretation and forwarding it to related queues.??
Sorry if I coudnt make my point clear.

Saima Asif
 

________________________________
 From: Emile Joubert <emile at rabbitmq.com>
To: Saima Asif <abdullahsaima at yahoo.com> 
Cc: "rabbitmq-discuss at lists.rabbitmq.com" <rabbitmq-discuss at lists.rabbitmq.com> 
Sent: Wednesday, 11 April 2012, 13:59
Subject: Re: [rabbitmq-discuss] what are message attributes used by broker in RABBITMQ
  
Hi Saima,

On 11/04/12 13:38, Saima Asif wrote:
> It means user id property, message durability, Sender-selected
> distribution is visible to broker, other than routing key. Is there any
> other data or property broker I means exchanges consider?

What I provided is a list are properties and headers that are not
completely ignored by the broker. I think the current version of the
broker (v2.8.1) ignores all other properties and headers when a message
is received from a publisher.

Your original question made no mention of routing. Messages are routed
based on routing key and the contents of the CC and BCC headers.

-Emile
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120416/d8cbbb60/attachment.htm>

From emile at rabbitmq.com  Mon Apr 16 12:28:14 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 16 Apr 2012 12:28:14 +0100
Subject: [rabbitmq-discuss] what are message attributes used by broker
 in RABBITMQ
In-Reply-To: <1334574888.94533.YahooMailNeo@web29704.mail.ird.yahoo.com>
References: <1334145243.23896.YahooMailNeo@web29703.mail.ird.yahoo.com>
	<4F8577F3.3060604@rabbitmq.com>
	<1334147886.33780.YahooMailNeo@web29704.mail.ird.yahoo.com>
	<4F85804C.70009@rabbitmq.com>
	<1334574888.94533.YahooMailNeo@web29704.mail.ird.yahoo.com>
Message-ID: <4F8C024E.8040901@rabbitmq.com>


Hi Saima,

On 16/04/12 12:14, Saima Asif wrote:
> I just want to have an estimate that how much time a message broker
> consumes on a message , that could be understood by the number of
> entities involved in message decoding done by exchanges. what attributed
> a message considers to perfrom interpretation and forwarding it to
> related queues.  

I suggest you base your estimate on measurements of the time taken to
process messages, instead of modelling broker performance based on
properties of the message.

-Emile


From abdullahsaima at yahoo.com  Mon Apr 16 12:42:13 2012
From: abdullahsaima at yahoo.com (Saima Asif)
Date: Mon, 16 Apr 2012 12:42:13 +0100 (BST)
Subject: [rabbitmq-discuss] what are message attributes used by broker
	in RABBITMQ
In-Reply-To: <4F8C024E.8040901@rabbitmq.com>
References: <1334145243.23896.YahooMailNeo@web29703.mail.ird.yahoo.com>
	<4F8577F3.3060604@rabbitmq.com>
	<1334147886.33780.YahooMailNeo@web29704.mail.ird.yahoo.com>
	<4F85804C.70009@rabbitmq.com>
	<1334574888.94533.YahooMailNeo@web29704.mail.ird.yahoo.com>
	<4F8C024E.8040901@rabbitmq.com>
Message-ID: <1334576533.63729.YahooMailNeo@web29703.mail.ird.yahoo.com>

yes you are right, that what I want to do. But how can I do that, need your suggestions please.


Saima Asif
 

________________________________
 From: Emile Joubert <emile at rabbitmq.com>
To: Saima Asif <abdullahsaima at yahoo.com> 
Cc: "rabbitmq-discuss at lists.rabbitmq.com" <rabbitmq-discuss at lists.rabbitmq.com> 
Sent: Monday, 16 April 2012, 12:28
Subject: Re: [rabbitmq-discuss] what are message attributes used by broker in RABBITMQ
  

Hi Saima,

On 16/04/12 12:14, Saima Asif wrote:
> I just want to have an estimate that how much time a message broker
> consumes on a message , that could be understood by the number of
> entities involved in message decoding done by exchanges. what attributed
> a message considers to perfrom interpretation and forwarding it to
> related queues.? 

I suggest you base your estimate on measurements of the time taken to
process messages, instead of modelling broker performance based on
properties of the message.

-Emile
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120416/a7976a9e/attachment.htm>

From netsinque at gmail.com  Mon Apr 16 12:51:27 2012
From: netsinque at gmail.com (Graham Jones)
Date: Mon, 16 Apr 2012 21:51:27 +1000
Subject: [rabbitmq-discuss] Routing on multiple criteria but hitting
	only one consumer
In-Reply-To: <4F8BED2A.7070008@rabbitmq.com>
References: <90116f8d-196e-492b-9ea3-e2ba8dd5a140@j9g2000pbn.googlegroups.com>
	<4F8BED2A.7070008@rabbitmq.com>
Message-ID: <D2068BEA-40E2-4A67-AD27-A2A53265F466@gmail.com>

On 16/04/2012, at 7:58 PM, Emile Joubert wrote:
> Hi,
> 
> On 15/04/12 10:04, AgileZebra wrote:
> 
>> * We have host1 and host2.
>> * Host1 handles jobs of classA and classB; host2 handles jobs of
>> classB and classC.
>> * If we route a job of classA, only host1 will pick it up; if we route
>> a job of classB, either host1 or host2 will pick it up (based on their
>> current load / first available) but never both.
> 
> Can you constrain the routing so that messages are only routed to one
> queue, and you have one queue per class? Then host1 can subscribe to the
> queues for classA and classB, and host2 can subscribe to the queues for
> classB and classC.

Unfortunately not - there are tens of thousands of 'classes' and only tens of worker hosts. 
I tried to make the example fairly simple and generic but I guess I should have given you more real details. The classes are actually databases. There are databases for every hour of every day of every year, each with gigs and gigs of data, The databases are replicated in a semi-stripped, semi-random fashion to multiple nodes. They move around regularly depending on which data is hot and which is not, and in and out of SSD filesystems, or growing or shrinking their number of clones as required. We have a database that maps each task in a job to a list of locations where the database live and we want to allow the workers to take jobs as their workload dictates and naturally balance. We're already achieving this with our own broker but were really hoping to bypass it.  

From brendan at soundcloud.com  Mon Apr 16 13:30:37 2012
From: brendan at soundcloud.com (Brendan Hay)
Date: Mon, 16 Apr 2012 14:30:37 +0200
Subject: [rabbitmq-discuss] Rabbit Management API Overhead/Impact
Message-ID: <CAHZsVQZPq0Z5Gx31AjYf5df9g=z4=HDi=dcB-0ykT-b_93e+kA@mail.gmail.com>

Hi,

While using the HTTP/JSON API of the management plugin for
monitoring/statistics, I was wondering what kind of performance implication
hitting  an endpoint (ie. /channels which could return thousands of json
entries) every 5 seconds would be?

Looking through the management agent code it doesn't seem to do any sort of
sampling/caching. Thoughts/considerations?

Cheers,
Brendan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120416/809ebbd4/attachment.htm>

From emile at rabbitmq.com  Mon Apr 16 13:39:54 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 16 Apr 2012 13:39:54 +0100
Subject: [rabbitmq-discuss] Routing on multiple criteria but hitting
 only one consumer
In-Reply-To: <D2068BEA-40E2-4A67-AD27-A2A53265F466@gmail.com>
References: <90116f8d-196e-492b-9ea3-e2ba8dd5a140@j9g2000pbn.googlegroups.com>
	<4F8BED2A.7070008@rabbitmq.com>
	<D2068BEA-40E2-4A67-AD27-A2A53265F466@gmail.com>
Message-ID: <4F8C131A.9000307@rabbitmq.com>

Hi Graham,

On 16/04/12 12:51, Graham Jones wrote:
> On 16/04/2012, at 7:58 PM, Emile Joubert wrote:
>> On 15/04/12 10:04, AgileZebra wrote:
>> 
>>> * We have host1 and host2. * Host1 handles jobs of classA and
>>> classB; host2 handles jobs of classB and classC. * If we route a
>>> job of classA, only host1 will pick it up; if we route a job of
>>> classB, either host1 or host2 will pick it up (based on their 
>>> current load / first available) but never both.
>> 
>> Can you constrain the routing so that messages are only routed to
>> one queue, and you have one queue per class? Then host1 can
>> subscribe to the queues for classA and classB, and host2 can
>> subscribe to the queues for classB and classC.
> 
> Unfortunately not - there are tens of thousands of 'classes' and only
> tens of worker hosts.

Bear in mind that consumers are permitted to subscribe to multiple queues.

There is no way of restricting the delivery of multiple copies of a
message so that only a single consumer receives a single copy of the
message. If a message is routed to multiple queues then the broker will
attempt to deliver all copies independently.

You should reconsider the meaning of messages, which may be too heavily
overloaded.  Possibly introduce a message type that means "piece of work
to be performed once on a single host", and constrain the routing of
such messages appropriately.


-Emile






From simon at rabbitmq.com  Mon Apr 16 13:44:54 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 16 Apr 2012 13:44:54 +0100
Subject: [rabbitmq-discuss] Rabbit Management API Overhead/Impact
In-Reply-To: <CAHZsVQZPq0Z5Gx31AjYf5df9g=z4=HDi=dcB-0ykT-b_93e+kA@mail.gmail.com>
References: <CAHZsVQZPq0Z5Gx31AjYf5df9g=z4=HDi=dcB-0ykT-b_93e+kA@mail.gmail.com>
Message-ID: <4F8C1446.6070707@rabbitmq.com>

On 16/04/12 13:30, Brendan Hay wrote:
> Hi,

Hi!

> While using the HTTP/JSON API of the management plugin for
> monitoring/statistics, I was wondering what kind of performance
> implication hitting  an endpoint (ie. /channels which could return
> thousands of json entries) every 5 seconds would be?
>
> Looking through the management agent code it doesn't seem to do any sort
> of sampling/caching. Thoughts/considerations?

Yes it does, although not in the agent. The management plugin maintains 
a database of statistics for connections, channels etc (see 
rabbit_mgmt_db), so hitting such an API endpoint does not go and hit 
tons of other processes and should not be very expensive.

Ironically the most expensive thing in a management API call that 
returns lots of stuff is usually the JSON serialisation! mochijson2 is 
just not that fast. So to cut down on the work done by the management 
API itself it's well worth restricting the info items you ask for.

Which I now see is undocumented. Damn. Use something like

http://server:55672/api/channels?columns=name,message_stats.publish

i.e. comma-separated, dot to drill down.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Mon Apr 16 13:48:26 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 16 Apr 2012 13:48:26 +0100
Subject: [rabbitmq-discuss] Rabbit Management API Overhead/Impact
In-Reply-To: <4F8C1446.6070707@rabbitmq.com>
References: <CAHZsVQZPq0Z5Gx31AjYf5df9g=z4=HDi=dcB-0ykT-b_93e+kA@mail.gmail.com>
	<4F8C1446.6070707@rabbitmq.com>
Message-ID: <4F8C151A.4050606@rabbitmq.com>

On 16/04/12 13:44, Simon MacMullen wrote:
>> Looking through the management agent code it doesn't seem to do any sort
>> of sampling/caching. Thoughts/considerations?
>
> Yes it does, although not in the agent.

To expand on this, I should perhaps point out that the stuff that ends 
up in /api/nodes does not get cached anywhere, but it's not very 
expensive to obtain in the first place.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From brendan at soundcloud.com  Mon Apr 16 13:50:09 2012
From: brendan at soundcloud.com (Brendan Hay)
Date: Mon, 16 Apr 2012 14:50:09 +0200
Subject: [rabbitmq-discuss] Rabbit Management API Overhead/Impact
In-Reply-To: <4F8C151A.4050606@rabbitmq.com>
References: <CAHZsVQZPq0Z5Gx31AjYf5df9g=z4=HDi=dcB-0ykT-b_93e+kA@mail.gmail.com>
	<4F8C1446.6070707@rabbitmq.com> <4F8C151A.4050606@rabbitmq.com>
Message-ID: <CAHZsVQY_ec00rr=ik9c4gN378G4vDCRryX+d6xOM1td=3s+yTA@mail.gmail.com>

Nice! The property/column selection syntax is a life saver.

Muchos gracias,
Brendan

On Mon, Apr 16, 2012 at 2:48 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 16/04/12 13:44, Simon MacMullen wrote:
>
>> Looking through the management agent code it doesn't seem to do any sort
>>> of sampling/caching. Thoughts/considerations?
>>>
>>
>> Yes it does, although not in the agent.
>>
>
> To expand on this, I should perhaps point out that the stuff that ends up
> in /api/nodes does not get cached anywhere, but it's not very expensive to
> obtain in the first place.
>
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120416/4ae0d93f/attachment.htm>

From matthew at rabbitmq.com  Mon Apr 16 14:16:39 2012
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 16 Apr 2012 14:16:39 +0100
Subject: [rabbitmq-discuss] Mirrored queue failover
In-Reply-To: <4F855310.1050407@ms.scsk.jp>
References: <4F7D5C28.8000202@ms.scsk.jp> <20120405112633.GA17466@rabbitmq.com>
	<4F7E5B59.4060005@ms.scsk.jp> <4F855310.1050407@ms.scsk.jp>
Message-ID: <20120416131639.GB14212@wellquite.org>

Hi,

I'm afraid I really don't know what to suggest. It looks like somehow
Erlang is not properly noticing rabbit3 coming back up, and getting
itself very confused. I don't know why this would be.

You say you're already using 2.8.1 and R15B, so I can't really just
suggest upgrading. Perhaps one further thing to test is when rabbit3
comes back up, connect a publisher to it (specifically rabbit3 rather
than any other node) and try to publish to an exchange routing to the
problematic queue. I'd be curious to know whether those messages
actually end up in the queue or not.

For some reason, whilst rabbit3 seems to know about 1 and 2, 1 and 2 are
a long way from convinced they know about 3. Something is very unhappy
in the cluster, and I've really no idea why.

Matthew

From lionel.cons at cern.ch  Mon Apr 16 14:42:35 2012
From: lionel.cons at cern.ch (Lionel Cons)
Date: Mon, 16 Apr 2012 15:42:35 +0200
Subject: [rabbitmq-discuss] Cannot send message with STOMP
Message-ID: <20120416153346.b41c.abe10f7e5afbbb3a79ce619739541149@cern.ch>

It seems I cannot send _some_ messages using STOMP. After investigation,
this seems to come from the presence of "exotic" characters in the header.

I managed to reproduce the problem with netcat and the attached file.

When I try to use the file to send the message, I get nothing back:

$ (cat frame; sleep 1) | nc broker 6123

If I remove the two header lines starting with rnd-, it does work as
expected:

$ (cat frame.clean; sleep 1) | nc broker 6123
CONNECTED
session:session-wUaTaF5qzu7nKZ4TmuaWFM
heart-beat:0,0
server:RabbitMQ/2.8.0
version:1.0

RECEIPT
receipt-id:abc

So it seems that RabbitMQ does not like these header lines... Any idea on
what is happening?

Cheers,

Lionel

-------------- next part --------------
A non-text attachment was scrubbed...
Name: frames.gz
Type: application/octet-stream
Size: 219 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120416/ee5d6feb/attachment.obj>

From m.luchak at smartasking.com  Mon Apr 16 15:12:29 2012
From: m.luchak at smartasking.com (m.luchak at smartasking.com)
Date: Mon, 16 Apr 2012 10:12:29 -0400 (EDT)
Subject: [rabbitmq-discuss] STOMP instalation on Ubuntu
Message-ID: <1334585549.279616963@apps.rackspace.com>

Hi All,

I am having difficulty instaling STOMP on Ubuntu and was wondering if anyone could point me to a good tutorial.  I am unable to run the rabbitmq-plugins commands (commands not found) and have read conflicting reports of whether rabbitmq-plugins activate is still a valid command.

Any help greatly appreciated.  BTW, while I'm asking... ;)  I am installing STOMP to resolve the situation where a consumer is not active for a topic exchange when a producer publishes.  I understand that with STOMP the consumer will be able to receive messages when they become active.  If there is another way (using topic exchanges), or if this is not a soloution, then I would love to hear suggestions..

thanks very much,
Matthew


From tonygarnockjones+rabbitmq at gmail.com  Mon Apr 16 15:19:26 2012
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Mon, 16 Apr 2012 10:19:26 -0400
Subject: [rabbitmq-discuss] Cannot send message with STOMP
In-Reply-To: <20120416153346.b41c.abe10f7e5afbbb3a79ce619739541149@cern.ch>
References: <20120416153346.b41c.abe10f7e5afbbb3a79ce619739541149@cern.ch>
Message-ID: <CAM8fPiT4grNkru+aRW+gb9=RQkyA-N39G7rnTk35BiUGkJngNQ@mail.gmail.com>

It's probably the backslashes in the headers that you're sending. Because
STOMP's syntax forbids linefeeds and colons not only in header names but
also in header values (!!), RabbitMQ's STOMP codec uses backslash escaping
(for the values only, I note), which isn't part of the specification.

Even though you're not sending colons in header values, you're being
affected by the escaping. STOMP's syntax plus RabbitMQ's ad-hoc escaping
then are two wrongs that definitely don't make a right :-(

STOMP's syntax, terrible though it is, is set in stone, so I guess the only
hope left is some tweak to or removal of the backslash escaping mechanism
in the RabbitMQ codec. I'm at a loss as to what the right thing to do here
is. (Besides fix STOMP, obviously.)

One option would be to do no escaping, but if a header is about to be
encoded using some illegal character (i.e. LF or colon), encode it using
some totally nonstandard but also totally unambiguous format such as a
colon in the first column of the line followed by two netstrings? It'd
completely crash any parser that wasn't looking out for it, because it's
illegal syntax, but then so is including an unescaped colon or LF in the
first place, so we're already into uncharted territory.

:4:what,17:a terrible design,

A middle ground would be to forbid sending colons in header *names* but
silently pass them on in header *values* (they're harmless, and it's a
silly restriction), and if a LF were seen, to encode it as LF-colon. A
naive parser then would see a pseudo-header with an empty name; parsers
expecting this convention would understand it to be a header value
continuation from the previous line.

Any way you slice it, though: yuck.

Regards,
  Tony


On 16 April 2012 09:42, Lionel Cons <lionel.cons at cern.ch> wrote:

> It seems I cannot send _some_ messages using STOMP. After investigation,
> this seems to come from the presence of "exotic" characters in the header.
>
> I managed to reproduce the problem with netcat and the attached file.
>
> When I try to use the file to send the message, I get nothing back:
>
> $ (cat frame; sleep 1) | nc broker 6123
>
> If I remove the two header lines starting with rnd-, it does work as
> expected:
>
> $ (cat frame.clean; sleep 1) | nc broker 6123
> CONNECTED
> session:session-wUaTaF5qzu7nKZ4TmuaWFM
> heart-beat:0,0
> server:RabbitMQ/2.8.0
> version:1.0
>
> RECEIPT
> receipt-id:abc
>
> So it seems that RabbitMQ does not like these header lines... Any idea on
> what is happening?
>
> Cheers,
>
> Lionel
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
Tony Garnock-Jones
tonygarnockjones at gmail.com
http://homepages.kcbbs.gen.nz/tonyg/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120416/a12bbb26/attachment.htm>

From simon at rabbitmq.com  Mon Apr 16 15:25:17 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 16 Apr 2012 15:25:17 +0100
Subject: [rabbitmq-discuss] STOMP instalation on Ubuntu
In-Reply-To: <1334585549.279616963@apps.rackspace.com>
References: <1334585549.279616963@apps.rackspace.com>
Message-ID: <4F8C2BCD.4030309@rabbitmq.com>

On 16/04/12 15:12, m.luchak at smartasking.com wrote:
> I am unable to run the rabbitmq-plugins commands (commands not found)
> and have read conflicting reports of whether rabbitmq-plugins
> activate is still a valid command.

It was new in RabbitMQ 2.7.0 and Ubuntu I think ships with an older 
version. Prior to that plugins were not bundled with the server and thus 
did not need activating. You can get old binary plugin downloads from 
http://www.rabbitmq.com/releases/plugins/ but you're probably better off 
using the latest 2.8.1 release...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From matthias at rabbitmq.com  Mon Apr 16 15:45:37 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 16 Apr 2012 15:45:37 +0100
Subject: [rabbitmq-discuss] Identifying TCP Listeners.
In-Reply-To: <1334165564.3639.3.camel@p105s6207.site>
References: <1334141345.2819.17.camel@workstation.wmmi.net>	<1334141521.2819.18.camel@workstation.wmmi.net>	<4F85640B.7020101@rabbitmq.com>	<1334164518.2328.3.camel@p105s6207.site>
	<1334165564.3639.3.camel@p105s6207.site>
Message-ID: <4F8C3091.2060500@rabbitmq.com>

Adam,

On 11/04/12 18:32, Adam Tauno Williams wrote:
> With -
> rabbitmq-server-2.8.1-1.suse.noarch
> erlang-R15B-2.1.i586
>   - I can specify -
> {
>    kernel, [ {inet_dist_use_interface, [ {"127.0.0.1"} ] } ]
>   }
>   - /etc/rabbitmq/rabbitmq.config  and the server still starts, but it
> has no effect on how the epmd or beam.smp bind.

The above configuration is invalid. The entry should be

{kernel, [{inet_dist_use_interface, {127,0,0,1}}]}

The fact that rabbit started up fine suggests that it didn't read the 
config at all. Check the broker start up log, which should contain the line

config file(s) : /etc/rabbitmq/rabbitmq.config

if the config was read.

Furthermore, to change the interface to which EPMD binds, you need to 
set the ERL_EPMD_DIST_BIND environment variable, e.g.

export ERL_EPMD_DIST_BIND=172.0.0.1


Regards,

Matthias.

From gautam.bakshi at gmail.com  Mon Apr 16 16:09:15 2012
From: gautam.bakshi at gmail.com (Gautam Bakshi)
Date: Mon, 16 Apr 2012 11:09:15 -0400
Subject: [rabbitmq-discuss] Having trouble getting rabbitmq-server to
 read rabbitmq-env.conf settings to change database location.
In-Reply-To: <4F8BE7F4.6030008@rabbitmq.com>
References: <17518252.3421.1334552523915.JavaMail.geo-discussion-forums@vbuo5>
	<4F8BE7F4.6030008@rabbitmq.com>
Message-ID: <CAHSyJgKz-Hc2VeREn849OqY0XeAUQP6dWWyaxZBEJ+sEooR6pw@mail.gmail.com>

Thank you, that worked!  In rushing to setup I didn't the part where it
said base was not enabled for *nix systems.   It seems to work once I put
my settings in MNESIA_BASE.  Thank you very much Emile.

On Mon, Apr 16, 2012 at 5:35 AM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi Gautam,
>
> On 16/04/12 06:02, Gautam wrote:
> > I'm having problems changing the default location for a rabbitmq
> instance.
>
> > What can I do to change the location? I'm using the latest version of
> > rabbitmq and centos 6.2.
>
> Define LOG_BASE in the rabbitmq-env.conf file if you want logfiles in a
> different directory. Likewise, define MNESIA_BASE to have the RabbitMQ
> database in a different location.
>
> See these pages for more information:
> http://www.rabbitmq.com/relocate.html
> http://www.rabbitmq.com/configure.html
>
>
> -Emile
>
>
>


-- 
Regards,

Gautam Bakshi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120416/3d6ffc04/attachment.htm>

From Lionel.Cons at cern.ch  Mon Apr 16 16:18:32 2012
From: Lionel.Cons at cern.ch (Lionel Cons)
Date: Mon, 16 Apr 2012 15:18:32 +0000
Subject: [rabbitmq-discuss] Cannot send message with STOMP
In-Reply-To: <CAM8fPiT4grNkru+aRW+gb9=RQkyA-N39G7rnTk35BiUGkJngNQ@mail.gmail.com>
References: <20120416153346.b41c.abe10f7e5afbbb3a79ce619739541149@cern.ch>
	<CAM8fPiT4grNkru+aRW+gb9=RQkyA-N39G7rnTk35BiUGkJngNQ@mail.gmail.com>
Message-ID: <1D9CBD89533EE94D8295DFBFD923C23F649F007B@PLOXCHG03.cern.ch>

Tony,

Thanks for your reply.

Since RabbitMQ does not report any error back to the client and does not record anything in its logs either, it?s hard to find out what really happens. IMHO, if RabbitMQ thinks something is wrong, it should clearly say so.

Back to my test, the protocol used is STOMP 1.0 (RabbitMQ correctly reports it in its CONNECTED frame). There is no escaping defined in STOMP 1.0 so RabbitMQ should IMHO not perform any (de)escaping.

If escaping is indeed the source of the problem, could one please consider:

-          Logging errors coming from incorrect escaping

-          Not performing STOMP 1.1 (de)escaping on STOMP 1.0 connections
?

Cheers,

Lionel

From: tonygarnockjones at gmail.com [mailto:tonygarnockjones at gmail.com] On Behalf Of Tony Garnock-Jones
Sent: Monday, April 16, 2012 4:19 PM
To: Lionel Cons
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Cannot send message with STOMP

It's probably the backslashes in the headers that you're sending. Because STOMP's syntax forbids linefeeds and colons not only in header names but also in header values (!!), RabbitMQ's STOMP codec uses backslash escaping (for the values only, I note), which isn't part of the specification.

Even though you're not sending colons in header values, you're being affected by the escaping. STOMP's syntax plus RabbitMQ's ad-hoc escaping then are two wrongs that definitely don't make a right :-(

STOMP's syntax, terrible though it is, is set in stone, so I guess the only hope left is some tweak to or removal of the backslash escaping mechanism in the RabbitMQ codec. I'm at a loss as to what the right thing to do here is. (Besides fix STOMP, obviously.)

One option would be to do no escaping, but if a header is about to be encoded using some illegal character (i.e. LF or colon), encode it using some totally nonstandard but also totally unambiguous format such as a colon in the first column of the line followed by two netstrings? It'd completely crash any parser that wasn't looking out for it, because it's illegal syntax, but then so is including an unescaped colon or LF in the first place, so we're already into uncharted territory.

:4:what,17:a terrible design,

A middle ground would be to forbid sending colons in header *names* but silently pass them on in header *values* (they're harmless, and it's a silly restriction), and if a LF were seen, to encode it as LF-colon. A naive parser then would see a pseudo-header with an empty name; parsers expecting this convention would understand it to be a header value continuation from the previous line.

Any way you slice it, though: yuck.

Regards,
  Tony

On 16 April 2012 09:42, Lionel Cons <lionel.cons at cern.ch<mailto:lionel.cons at cern.ch>> wrote:
It seems I cannot send _some_ messages using STOMP. After investigation,
this seems to come from the presence of "exotic" characters in the header.

I managed to reproduce the problem with netcat and the attached file.

When I try to use the file to send the message, I get nothing back:

$ (cat frame; sleep 1) | nc broker 6123

If I remove the two header lines starting with rnd-, it does work as
expected:

$ (cat frame.clean; sleep 1) | nc broker 6123
CONNECTED
session:session-wUaTaF5qzu7nKZ4TmuaWFM
heart-beat:0,0
server:RabbitMQ/2.8.0
version:1.0

RECEIPT
receipt-id:abc

So it seems that RabbitMQ does not like these header lines... Any idea on
what is happening?

Cheers,

Lionel


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



--
Tony Garnock-Jones
tonygarnockjones at gmail.com<mailto:tonygarnockjones at gmail.com>
http://homepages.kcbbs.gen.nz/tonyg/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120416/34664c31/attachment.htm>

From matthias at rabbitmq.com  Mon Apr 16 16:18:50 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 16 Apr 2012 16:18:50 +0100
Subject: [rabbitmq-discuss] librabbitmq faults
In-Reply-To: <F1D344CD-0AF0-400E-8AF9-EEFAAB8C5D45@portalify.com>
References: <BAD9CCAC-6116-4CE6-AE09-088CD6386592@portalify.com>	<CAAt2poJxUX19CoZC6DJq7gtSzs+VTfzmhKzDTWG+Wd04zXYwcw@mail.gmail.com>	<8FAD4E8C-15D1-44E8-8C39-29126DC0E686@portalify.com>
	<F1D344CD-0AF0-400E-8AF9-EEFAAB8C5D45@portalify.com>
Message-ID: <4F8C385A.2060901@rabbitmq.com>

Matti,

On 11/04/12 10:29, Matti Linnanvuori wrote:
> I saw the following RabbitMQ server log entries when a Perl
> Net::RabbitMQ client got stuck in recv and did not receive messages
> that were sent to the queue that it is was consuming. The logging
> stopped and started again only later after ERROR REPORT, which seems
> to indicate some kind of error.
> [...]
> =ERROR REPORT==== 11-Apr-2012::10:39:02 === connection<0.260.0>,
> channel 1 - error: {amqp_error,not_found,"no exchange
> 'exchange.pmc.email-in' in vhost '/'", 'basic.publish'}

That error message is pretty clear as to what "kind of error" occurred: 
the client tried to publish a message to an exchange that doesn't exist.

In AMQP such errors will result in the channel getting closed by the 
server. I know nothing about the C client, but depending on how it 
handles this server-initiated channel closure handshake, that might be 
the reason for why you see the client getting stuck.

Regards,

Matthias.

From m.luchak at smartasking.com  Mon Apr 16 16:38:07 2012
From: m.luchak at smartasking.com (m.luchak at smartasking.com)
Date: Mon, 16 Apr 2012 11:38:07 -0400 (EDT)
Subject: [rabbitmq-discuss] STOMP instalation on Ubuntu
In-Reply-To: <4F8C2BCD.4030309@rabbitmq.com>
References: <1334585549.279616963@apps.rackspace.com>
	<4F8C2BCD.4030309@rabbitmq.com>
Message-ID: <1334590687.840122647@apps.rackspace.com>


Thank you Simon.  I am using 2.8.1 now and am able to activate STOMP.
 
On my other question; Does anyone have insight as to the "right way" to implement the following:
 
A consumer comes online and subscribes to a topic exchange after messages have been published.  This consumer must receive the prior messages.
 
I understand that using STOMP is one way to acheive this, but is it the only way?
 
thanks,
Matthew
 
-----Original Message-----
From: "Simon MacMullen" <simon at rabbitmq.com>
Sent: Monday, April 16, 2012 10:25am
To: m.luchak at smartasking.com
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] STOMP instalation on Ubuntu



On 16/04/12 15:12, m.luchak at smartasking.com wrote:
> I am unable to run the rabbitmq-plugins commands (commands not found)
> and have read conflicting reports of whether rabbitmq-plugins
> activate is still a valid command.

It was new in RabbitMQ 2.7.0 and Ubuntu I think ships with an older 
version. Prior to that plugins were not bundled with the server and thus 
did not need activating. You can get old binary plugin downloads from 
http://www.rabbitmq.com/releases/plugins/ but you're probably better off 
using the latest 2.8.1 release...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120416/f6035ea4/attachment.htm>

From tonygarnockjones+rabbitmq at gmail.com  Mon Apr 16 17:36:28 2012
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Mon, 16 Apr 2012 12:36:28 -0400
Subject: [rabbitmq-discuss] Cannot send message with STOMP
In-Reply-To: <1D9CBD89533EE94D8295DFBFD923C23F649F007B@PLOXCHG03.cern.ch>
References: <20120416153346.b41c.abe10f7e5afbbb3a79ce619739541149@cern.ch>
	<CAM8fPiT4grNkru+aRW+gb9=RQkyA-N39G7rnTk35BiUGkJngNQ@mail.gmail.com>
	<1D9CBD89533EE94D8295DFBFD923C23F649F007B@PLOXCHG03.cern.ch>
Message-ID: <CAM8fPiSG4L1QwcKQVC7rrLqSTUJ3E23BQ9UFO7=Fokwz2qfvZQ@mail.gmail.com>

On 16 April 2012 11:18, Lionel Cons <Lionel.Cons at cern.ch> wrote:

> Since RabbitMQ does not report any error back to the client and does not
> record anything in its logs either, it?s hard to find out what really
> happens. IMHO, if RabbitMQ thinks something is wrong, it should clearly say
> so.
>

Makes sense to me!


> Back to my test, the protocol used is STOMP 1.0 (RabbitMQ correctly
> reports it in its CONNECTED frame). There is no escaping defined in STOMP
> 1.0 so RabbitMQ should IMHO not perform any (de)escaping.
>

Agreed. I've just gone and checked the 1.1 spec again to see if it did
specify the escaping somewhere after all, and lo and behold, it does! Which
means I was wrong in my previous message: RabbitMQ is doing exactly the
right thing for 1.1 frames. Just not for 1.0 frames, is all, as you note.

(The STOMP spec helpfully includes a formal BNF definition... which is
incorrect. The BNF definition omits the specification of the escaping
process. Sigh.)


> ** **
>
> If escaping is indeed the source of the problem, could one please consider:
> ****
>
> **-          **Logging errors coming from incorrect escaping****
>
> -          Not performing STOMP 1.1 (de)escaping on STOMP 1.0 connections
>
Both these suggestions sound good to me. At this point, we will need to
hear from the Rabbit team (specifically, Steve, I imagine?) on how they
feel like proceeding.

Regards,
  Tony


-- 
Tony Garnock-Jones
tonygarnockjones at gmail.com
http://homepages.kcbbs.gen.nz/tonyg/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120416/d7b0b8bc/attachment.htm>

From videlalvaro at gmail.com  Mon Apr 16 20:14:39 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Mon, 16 Apr 2012 21:14:39 +0200
Subject: [rabbitmq-discuss] DEMO - RabbitMQ running as Mac Standalone App
Message-ID: <46AEA592CFE3497894B1BE157795B799@gmail.com>

Hi,

Here's a little demo video of RabbitMQ running as standalone Mac App

http://vimeo.com/40473369 

I will try to put it online soon, first I need to test it in another computer ;-)

Cheers,

Alvaro

-- 
Sent with Sparrow (http://www.sparrowmailapp.com/?sig)

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120416/ff0d24ae/attachment.htm>

From alex.lovelltroy at gmail.com  Mon Apr 16 20:18:28 2012
From: alex.lovelltroy at gmail.com (Alex Lovell-Troy)
Date: Mon, 16 Apr 2012 12:18:28 -0700
Subject: [rabbitmq-discuss] DEMO - RabbitMQ running as Mac Standalone App
In-Reply-To: <46AEA592CFE3497894B1BE157795B799@gmail.com>
References: <46AEA592CFE3497894B1BE157795B799@gmail.com>
Message-ID: <CAMACij7qotKNqH79+O=nCBkvsevHoECTHvT1TLueZs5rgSrePg@mail.gmail.com>

Very cool!  This should really help people get started with RabbitMQ.

:-)

-alex

On Mon, Apr 16, 2012 at 12:14 PM, Alvaro Videla <videlalvaro at gmail.com>wrote:

> Hi,
>
> Here's a little demo video of RabbitMQ running as standalone Mac App
>
> http://vimeo.com/40473369
>
> I will try to put it online soon, first I need to test it in another
> computer ;-)
>
> Cheers,
>
> Alvaro
>
> --
> Sent with Sparrow <http://www.sparrowmailapp.com/?sig>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120416/000a43e6/attachment.htm>

From tonygarnockjones+rabbitmq at gmail.com  Mon Apr 16 20:32:59 2012
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Mon, 16 Apr 2012 15:32:59 -0400
Subject: [rabbitmq-discuss] DEMO - RabbitMQ running as Mac Standalone App
In-Reply-To: <46AEA592CFE3497894B1BE157795B799@gmail.com>
References: <46AEA592CFE3497894B1BE157795B799@gmail.com>
Message-ID: <CAM8fPiRS0O6D5MeG=d32yEGWydYd9B9p-g4PXC3FOskOYHDp8g@mail.gmail.com>

That's great! I'm looking forward to seeing how you did it :-) (in
particular the UI part)

Regards,
  Tony

On 16 April 2012 15:14, Alvaro Videla <videlalvaro at gmail.com> wrote:

> Hi,
>
> Here's a little demo video of RabbitMQ running as standalone Mac App
>
> http://vimeo.com/40473369
>
> I will try to put it online soon, first I need to test it in another
> computer ;-)
>
> Cheers,
>
> Alvaro
>
> --
> Sent with Sparrow <http://www.sparrowmailapp.com/?sig>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
Tony Garnock-Jones
tonygarnockjones at gmail.com
http://homepages.kcbbs.gen.nz/tonyg/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120416/c5894770/attachment.htm>

From videlalvaro at gmail.com  Mon Apr 16 21:16:09 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Mon, 16 Apr 2012 22:16:09 +0200
Subject: [rabbitmq-discuss] DEMO - RabbitMQ running as Mac Standalone App
In-Reply-To: <CAM8fPiRS0O6D5MeG=d32yEGWydYd9B9p-g4PXC3FOskOYHDp8g@mail.gmail.com>
References: <46AEA592CFE3497894B1BE157795B799@gmail.com>
	<CAM8fPiRS0O6D5MeG=d32yEGWydYd9B9p-g4PXC3FOskOYHDp8g@mail.gmail.com>
Message-ID: <E9E4F8687AB14AC1A1394A370232653D@gmail.com>

Hi, 

The UI part is just an Xcode project using a WebKit webview control.

The tricky part is to know when rabbitmq is actually running, so I'm using a shell script to tell that.

Then the whole thing is just using NSTask all over the place to start/stop the broker.

FYI, just installed the app in another Mac I have and this works (still OSX Lion). I also trying sending messages over the network and it works as well.

Doing some code cleanup now before publishing.

Cheers,

Alvaro 

-- 
Sent with Sparrow (http://www.sparrowmailapp.com/?sig)


On Monday, April 16, 2012 at 9:32 PM, Tony Garnock-Jones wrote:

> That's great! I'm looking forward to seeing how you did it :-) (in particular the UI part)
> 
> Regards,
>   Tony
> 
> On 16 April 2012 15:14, Alvaro Videla <videlalvaro at gmail.com (mailto:videlalvaro at gmail.com)> wrote:
> > Hi,
> > 
> > Here's a little demo video of RabbitMQ running as standalone Mac App
> > 
> > http://vimeo.com/40473369 
> > 
> > I will try to put it online soon, first I need to test it in another computer ;-)
> > 
> > Cheers,
> > 
> > Alvaro
> > 
> > -- 
> > Sent with Sparrow (http://www.sparrowmailapp.com/?sig)
> > 
> > 
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > 
> 
> 
> 
> -- 
> Tony Garnock-Jones
> tonygarnockjones at gmail.com (mailto:tonygarnockjones at gmail.com)
> http://homepages.kcbbs.gen.nz/tonyg/

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120416/6bdb4ddf/attachment.htm>

From videlalvaro at gmail.com  Mon Apr 16 23:22:57 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Tue, 17 Apr 2012 00:22:57 +0200
Subject: [rabbitmq-discuss] DEMO - RabbitMQ running as Mac Standalone App
In-Reply-To: <E9E4F8687AB14AC1A1394A370232653D@gmail.com>
References: <46AEA592CFE3497894B1BE157795B799@gmail.com>
	<CAM8fPiRS0O6D5MeG=d32yEGWydYd9B9p-g4PXC3FOskOYHDp8g@mail.gmail.com>
	<E9E4F8687AB14AC1A1394A370232653D@gmail.com>
Message-ID: <8ABC027D44A64CFE89B2B815B4A57D59@gmail.com>

Hi,

Here's the link to the .dmg with the App. It only works only on OS X Lion tho. I might try to get it running in Snow Leopard later.

http://dl.dropbox.com/u/58659506/RabbitMQ-2.8.1u.dmg 

Cheers,

Alvaro

-- 
Sent with Sparrow (http://www.sparrowmailapp.com/?sig)


On Monday, April 16, 2012 at 10:16 PM, Alvaro Videla wrote:

> Hi, 
> 
> The UI part is just an Xcode project using a WebKit webview control.
> 
> The tricky part is to know when rabbitmq is actually running, so I'm using a shell script to tell that.
> 
> Then the whole thing is just using NSTask all over the place to start/stop the broker.
> 
> FYI, just installed the app in another Mac I have and this works (still OSX Lion). I also trying sending messages over the network and it works as well.
> 
> Doing some code cleanup now before publishing.
> 
> Cheers,
> 
> Alvaro 
> 
> -- 
> Sent with Sparrow (http://www.sparrowmailapp.com/?sig)
> 
> 
> On Monday, April 16, 2012 at 9:32 PM, Tony Garnock-Jones wrote:
> 
> > That's great! I'm looking forward to seeing how you did it :-) (in particular the UI part)
> > 
> > Regards,
> >   Tony
> > 
> > On 16 April 2012 15:14, Alvaro Videla <videlalvaro at gmail.com (mailto:videlalvaro at gmail.com)> wrote:
> > > Hi,
> > > 
> > > Here's a little demo video of RabbitMQ running as standalone Mac App
> > > 
> > > http://vimeo.com/40473369 
> > > 
> > > I will try to put it online soon, first I need to test it in another computer ;-)
> > > 
> > > Cheers,
> > > 
> > > Alvaro
> > > 
> > > -- 
> > > Sent with Sparrow (http://www.sparrowmailapp.com/?sig)
> > > 
> > > 
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> > > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > > 
> > 
> > 
> > 
> > -- 
> > Tony Garnock-Jones
> > tonygarnockjones at gmail.com (mailto:tonygarnockjones at gmail.com)
> > http://homepages.kcbbs.gen.nz/tonyg/
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120417/5b378b48/attachment.htm>

From m.luchak at smartasking.com  Mon Apr 16 23:24:03 2012
From: m.luchak at smartasking.com (m.luchak at smartasking.com)
Date: Mon, 16 Apr 2012 18:24:03 -0400 (EDT)
Subject: [rabbitmq-discuss] exchange.bind details
Message-ID: <1334615043.691928514@apps.rackspace.com>


Hi all,
 
Thanks for the help with the STOMP question. I am having difficulties understanding the exchange.bind constructor (ticket, destination, source).... Could someone please point me to resources?
 
I am trying to implement "exchange.bind"  ([http://www.rabbitmq.com/blog/2010/10/19/exchange-to-exchange-bindings/] http://www.rabbitmq.com/blog/2010/10/19/exchange-to-exchange-bindings/) to allow multiple instances of the same user presence (android, web, desktop) to receive notifications.
 
Under the exchange->Q model if all three devices are logged in concurrently there is no way for all instances to receive messages as they will all be logged in on the same Q.
 
thanks,
Matthew
 
 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120416/b891b0b1/attachment.htm>

From alexis at rabbitmq.com  Mon Apr 16 23:33:15 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Mon, 16 Apr 2012 23:33:15 +0100
Subject: [rabbitmq-discuss] exchange.bind details
In-Reply-To: <1334615043.691928514@apps.rackspace.com>
References: <1334615043.691928514@apps.rackspace.com>
Message-ID: <CACOPnvfqEL=kybxZ9r0BqukXLbcxttEbKqGgJ8nT7yAFLppo9g@mail.gmail.com>

Matthew

Have you tried using direct exchanges?
http://www.rabbitmq.com/tutorials/tutorial-three-python.html

alexis


On Mon, Apr 16, 2012 at 11:24 PM,  <m.luchak at smartasking.com> wrote:
> Hi all,
>
>
>
> Thanks for the help with the STOMP question. I am having difficulties
> understanding the exchange.bind constructor (ticket, destination,
> source).... Could someone please point me to resources?
>
>
>
> I am trying to implement "exchange.bind"
> ?(http://www.rabbitmq.com/blog/2010/10/19/exchange-to-exchange-bindings/) to
> allow multiple instances of the same user presence (android, web, desktop)
> to receive notifications.
>
>
>
> Under the exchange->Q model if all three devices are logged in concurrently
> there is no way for all instances to receive messages as they will all be
> logged in on the same Q.
>
>
>
> thanks,
>
> Matthew
>
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From m.luchak at smartasking.com  Tue Apr 17 01:40:05 2012
From: m.luchak at smartasking.com (m.luchak at smartasking.com)
Date: Mon, 16 Apr 2012 20:40:05 -0400 (EDT)
Subject: [rabbitmq-discuss] exchange.bind details
In-Reply-To: <CACOPnvfqEL=kybxZ9r0BqukXLbcxttEbKqGgJ8nT7yAFLppo9g@mail.gmail.com>
References: <1334615043.691928514@apps.rackspace.com> 
	<CACOPnvfqEL=kybxZ9r0BqukXLbcxttEbKqGgJ8nT7yAFLppo9g@mail.gmail.com>
Message-ID: <1334623205.538323350@apps.rackspace.com>


Thanks for the help Alexis but the scenario is a little more complicated... I think exchange binding is the only way to go... but I'm open for suggestions ;)
 
Users are able to log-on to the system using more than one device at the same time (mobile, web, desktop) and it is a requirement that messages are delivered to each of these devices even if they are all logged on at the same time. Sooo... I am looking at exchange binding like:
 
 
P -> Topic Exchange <------------User1Exchange 
|_________temporary Q mobile
|________temporary Q web
|_________temporary Q desktop 
 
 
Functional Requirements:
Topic exchanges 
Messages published to exchange while user offline are available when user logs-on
One "permanent address" per user (thought of queue - looks like I need exchange)
multiple instances of the same user logged-on concurrently
 


 
-----Original Message-----
From: "Alexis Richardson" <alexis at rabbitmq.com>
Sent: Monday, April 16, 2012 6:33pm
To: m.luchak at smartasking.com
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] exchange.bind details



Matthew

Have you tried using direct exchanges?
http://www.rabbitmq.com/tutorials/tutorial-three-python.html

alexis


On Mon, Apr 16, 2012 at 11:24 PM,  <m.luchak at smartasking.com> wrote:
> Hi all,
>
>
>
> Thanks for the help with the STOMP question. I am having difficulties
> understanding the exchange.bind constructor (ticket, destination,
> source).... Could someone please point me to resources?
>
>
>
> I am trying to implement "exchange.bind"
>  (http://www.rabbitmq.com/blog/2010/10/19/exchange-to-exchange-bindings/) to
> allow multiple instances of the same user presence (android, web, desktop)
> to receive notifications.
>
>
>
> Under the exchange->Q model if all three devices are logged in concurrently
> there is no way for all instances to receive messages as they will all be
> logged in on the same Q.
>
>
>
> thanks,
>
> Matthew
>
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120416/1f1b7a12/attachment.htm>

From m.luchak at smartasking.com  Tue Apr 17 01:50:16 2012
From: m.luchak at smartasking.com (m.luchak at smartasking.com)
Date: Mon, 16 Apr 2012 20:50:16 -0400 (EDT)
Subject: [rabbitmq-discuss] exchange.bind details
In-Reply-To: <1334623205.538323350@apps.rackspace.com>
References: <1334615043.691928514@apps.rackspace.com>  
	<CACOPnvfqEL=kybxZ9r0BqukXLbcxttEbKqGgJ8nT7yAFLppo9g@mail.gmail.com> 
	<1334623205.538323350@apps.rackspace.com>
Message-ID: <1334623816.803530231@apps.rackspace.com>


sorry for the re-post need to fix my poor asci art ;)
 
P -> Topic Exchange <------------User1Exchange 
........................................................|_________temporary Q mobile
........................................................|________temporary Q web
........................................................|_________temporary Q desktop
 
 
 
-----Original Message-----
From: m.luchak at smartasking.com
Sent: Monday, April 16, 2012 8:40pm
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] exchange.bind details



Thanks for the help Alexis but the scenario is a little more complicated... I think exchange binding is the only way to go... but I'm open for suggestions ;)
 
Users are able to log-on to the system using more than one device at the same time (mobile, web, desktop) and it is a requirement that messages are delivered to each of these devices even if they are all logged on at the same time. Sooo... I am looking at exchange binding like:
 
 
P -> Topic Exchange <------------User1Exchange 
|_________temporary Q mobile
|________temporary Q web
|_________temporary Q desktop 
 
 
Functional Requirements:
Topic exchanges 
Messages published to exchange while user offline are available when user logs-on
One "permanent address" per user (thought of queue - looks like I need exchange)
multiple instances of the same user logged-on concurrently
 


 
-----Original Message-----
From: "Alexis Richardson" <alexis at rabbitmq.com>
Sent: Monday, April 16, 2012 6:33pm
To: m.luchak at smartasking.com
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] exchange.bind details



Matthew

Have you tried using direct exchanges?
http://www.rabbitmq.com/tutorials/tutorial-three-python.html

alexis


On Mon, Apr 16, 2012 at 11:24 PM,  <m.luchak at smartasking.com> wrote:
> Hi all,
>
>
>
> Thanks for the help with the STOMP question. I am having difficulties
> understanding the exchange.bind constructor (ticket, destination,
> source).... Could someone please point me to resources?
>
>
>
> I am trying to implement "exchange.bind"
>  (http://www.rabbitmq.com/blog/2010/10/19/exchange-to-exchange-bindings/) to
> allow multiple instances of the same user presence (android, web, desktop)
> to receive notifications.
>
>
>
> Under the exchange->Q model if all three devices are logged in concurrently
> there is no way for all instances to receive messages as they will all be
> logged in on the same Q.
>
>
>
> thanks,
>
> Matthew
>
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120416/ebe538ff/attachment.htm>

From lionel.cons at cern.ch  Tue Apr 17 06:34:34 2012
From: lionel.cons at cern.ch (Lionel Cons)
Date: Tue, 17 Apr 2012 07:34:34 +0200
Subject: [rabbitmq-discuss] Cannot send message with STOMP
In-Reply-To: <CAM8fPiSG4L1QwcKQVC7rrLqSTUJ3E23BQ9UFO7=Fokwz2qfvZQ@mail.gmail.com>
References: <20120416153346.b41c.abe10f7e5afbbb3a79ce619739541149@cern.ch>
	<CAM8fPiT4grNkru+aRW+gb9=RQkyA-N39G7rnTk35BiUGkJngNQ@mail.gmail.com>
	<1D9CBD89533EE94D8295DFBFD923C23F649F007B@PLOXCHG03.cern.ch>
	<CAM8fPiSG4L1QwcKQVC7rrLqSTUJ3E23BQ9UFO7=Fokwz2qfvZQ@mail.gmail.com>
Message-ID: <20365.234.891858.767694@mail.cern.ch>

Tony Garnock-Jones writes:
 > (The STOMP spec helpfully includes a formal BNF definition... which is
 > incorrect. The BNF definition omits the specification of the escaping
 > process. Sigh.)

IMHO, the BNF definition is correct: it accurately defines what you
can see on the wire and this is sufficient to extract frames. It does
not however define how to interpret what you extract from the wire,
like backslash escaping and UTF-8 encoding, which are defined elsewhere
in the STOMP 1.1 specification.

Cheers,

Lionel

From alexis at rabbitmq.com  Tue Apr 17 07:37:08 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Tue, 17 Apr 2012 07:37:08 +0100
Subject: [rabbitmq-discuss] exchange.bind details
In-Reply-To: <1334623205.538323350@apps.rackspace.com>
References: <1334615043.691928514@apps.rackspace.com>
	<CACOPnvfqEL=kybxZ9r0BqukXLbcxttEbKqGgJ8nT7yAFLppo9g@mail.gmail.com>
	<1334623205.538323350@apps.rackspace.com>
Message-ID: <CACOPnvebheoRKbTRxRMVETC_jHR07_saaYNDhejstMq2YHhDQQ@mail.gmail.com>

Matthew

When do messages get dropped or deleted?  I.e. do you want a copy of
every message to get delivered to every device?

If a user reads a message on their phone, can they read it again later
on another device?

alexis



On Tue, Apr 17, 2012 at 1:40 AM,  <m.luchak at smartasking.com> wrote:
> Thanks for the help Alexis but the scenario is a little more complicated...
> I think exchange binding is the only way to go... but I'm open for
> suggestions ;)
>
>
>
> Users are able to log-on to the system using more than one device at the
> same time (mobile, web, desktop) and it is a requirement that messages are
> delivered to each of these devices even if they are all logged on at the
> same time. Sooo... I am looking at exchange binding like:
>
>
>
> P -> Topic Exchange <------------User1Exchange
>
> |_________temporary Q mobile
>
> |________temporary Q web
>
> |_________temporary Q desktop
>
>
>
>
>
> Functional Requirements:
>
> Topic exchanges
>
> Messages published to exchange while user offline are available when user
> logs-on
>
> One "permanent address" per user (thought of queue - looks like I need
> exchange)
>
> multiple instances of the same user logged-on concurrently
>
>
>
>
>
>
> -----Original Message-----
> From: "Alexis Richardson" <alexis at rabbitmq.com>
> Sent: Monday, April 16, 2012 6:33pm
> To: m.luchak at smartasking.com
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] exchange.bind details
>
> Matthew
>
> Have you tried using direct exchanges?
> http://www.rabbitmq.com/tutorials/tutorial-three-python.html
>
> alexis
>
>
> On Mon, Apr 16, 2012 at 11:24 PM, <m.luchak at smartasking.com> wrote:
>> Hi all,
>>
>>
>>
>> Thanks for the help with the STOMP question. I am having difficulties
>> understanding the exchange.bind constructor (ticket, destination,
>> source).... Could someone please point me to resources?
>>
>>
>>
>> I am trying to implement "exchange.bind"
>> ?(http://www.rabbitmq.com/blog/2010/10/19/exchange-to-exchange-bindings/)
>> to
>> allow multiple instances of the same user presence (android, web, desktop)
>> to receive notifications.
>>
>>
>>
>> Under the exchange->Q model if all three devices are logged in
>> concurrently
>> there is no way for all instances to receive messages as they will all be
>> logged in on the same Q.
>>
>>
>>
>> thanks,
>>
>> Matthew
>>
>>
>>
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From ka.fukui at ms.scsk.jp  Tue Apr 17 10:03:43 2012
From: ka.fukui at ms.scsk.jp (Katsushi Fukui)
Date: Tue, 17 Apr 2012 18:03:43 +0900
Subject: [rabbitmq-discuss] Mirrored queue failover
In-Reply-To: <20120416131639.GB14212@wellquite.org>
References: <4F7D5C28.8000202@ms.scsk.jp> <20120405112633.GA17466@rabbitmq.com>
	<4F7E5B59.4060005@ms.scsk.jp> <4F855310.1050407@ms.scsk.jp>
	<20120416131639.GB14212@wellquite.org>
Message-ID: <4F8D31EF.4050709@ms.scsk.jp>

Thank you, Matthew,

I created an exchange "ex1" that is bound to que1, and published a message using a publisher was connected to rabbit3 as you suggested.
I could send it without returning error, but the logs of rabbit3 shows this error:
=ERROR REPORT==== 17-Apr-2012::11:12:30 ===
Discarding message {'$gen_cast',{deliver,{delivery,false,false,<0.3061.0>,{basic_message,{resource,<<1 byte>>,exchange,<<3 bytes>>},[<<5 bytes>>],{content,60,{'P_basic',<<10 bytes>>,undefined,undefined,2,0,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined},<<15 bytes>>,rabbit_framing_amqp_0_9_1,[<<12 bytes>>]},<<16 bytes>>,true},undefined},flow}} from <0.3061.0> to <0.229.0> in an old incarnation (3) of this node (2)

The result of list_queues is:
# ./rabbitmqctl list_queues name messages slave_pids synchronised_slave_pids
Listing queues ...
que1    1       [<rabbit at rabbit2.1.229.0>]      [<rabbit at rabbit2.1.229.0>]
...done.

I wonder if this problem is only occurred in my environment.



(2012/04/16 22:16), Matthew Sackman wrote:
> Hi,
>
> I'm afraid I really don't know what to suggest. It looks like somehow
> Erlang is not properly noticing rabbit3 coming back up, and getting
> itself very confused. I don't know why this would be.
>
> You say you're already using 2.8.1 and R15B, so I can't really just
> suggest upgrading. Perhaps one further thing to test is when rabbit3
> comes back up, connect a publisher to it (specifically rabbit3 rather
> than any other node) and try to publish to an exchange routing to the
> problematic queue. I'd be curious to know whether those messages
> actually end up in the queue or not.
>
> For some reason, whilst rabbit3 seems to know about 1 and 2, 1 and 2 are
> a long way from convinced they know about 3. Something is very unhappy
> in the cluster, and I've really no idea why.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


From emile at rabbitmq.com  Tue Apr 17 11:07:26 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 17 Apr 2012 11:07:26 +0100
Subject: [rabbitmq-discuss] what are message attributes used by broker
 in RABBITMQ
In-Reply-To: <1334576533.63729.YahooMailNeo@web29703.mail.ird.yahoo.com>
References: <1334145243.23896.YahooMailNeo@web29703.mail.ird.yahoo.com>
	<4F8577F3.3060604@rabbitmq.com>
	<1334147886.33780.YahooMailNeo@web29704.mail.ird.yahoo.com>
	<4F85804C.70009@rabbitmq.com>
	<1334574888.94533.YahooMailNeo@web29704.mail.ird.yahoo.com>
	<4F8C024E.8040901@rabbitmq.com>
	<1334576533.63729.YahooMailNeo@web29703.mail.ird.yahoo.com>
Message-ID: <4F8D40DE.60709@rabbitmq.com>

Hi,

On 16/04/12 12:42, Saima Asif wrote:
> yes you are right, that what I want to do.

Actually I'm struggling to understand what you are trying to do. It
looks like you are trying to predict latency based on message
properties. To do this with meaningful accuracy is a highly ambitious
and non-trivial undertaking.

Can you explain in a bit more detail what you are trying to accomplish?


-Emile



From alexis at rabbitmq.com  Tue Apr 17 11:10:05 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Tue, 17 Apr 2012 11:10:05 +0100
Subject: [rabbitmq-discuss] RabbitMQ release WIP
In-Reply-To: <B6B4B3C883B74893AEBBE6DBED4F40C6@gmail.com>
References: <B6B4B3C883B74893AEBBE6DBED4F40C6@gmail.com>
Message-ID: <CACOPnvfOj1qqPK+wcx0WNSXzJiCLmvLH_xFL3Ps-6uqTV5FZdA@mail.gmail.com>

Nice work Alvaro.

It would be great to hear feedback from people on this.

alexis


On Sun, Apr 15, 2012 at 10:46 PM, Alvaro Videla <videlalvaro at gmail.com> wrote:
> Hi,
>
> I would like to share this
> project?https://github.com/videlalvaro/rabbitmq-release where I hacked
> together a rabbitmq standalone release that includes Erlang's run time
> system.
>
> Please read the README file from the project to see how to use it and to
> understand what where my goals. My ultimate goal is to be able to create a
> .pkg file, or even a Rabbitmq.app file for the Mac that you could just
> drag&drop into the /Applications folder.
>
> You can download a release that works on Mac only
> here:?https://raw.github.com/videlalvaro/rabbitmq-release/master/downloads/rabbitmq-server-osx-2.8.1u.tar.gz
>
> The 'u' after the version number stands for unofficial, just in case ;)
>
> Feedback is very welcome to see how we could improve this.
>
> For example, after you apply the patch to the hg repo you will find that
> inside the pre-release/templates there are slightly modified versions of the
> rabbitmq/scripts/*. Also the new module?src/rabbit_release.erl ?is a
> shameless copy with some modifications from the src/rabbit_prelaunch.erl
> module.
>
> Again, this is a work in progress.
>
> Regards,
>
> Alvaro
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From awilliam at whitemice.org  Tue Apr 17 11:10:40 2012
From: awilliam at whitemice.org (Adam Tauno Williams)
Date: Tue, 17 Apr 2012 06:10:40 -0400
Subject: [rabbitmq-discuss] Identifying TCP Listeners.
In-Reply-To: <4F8C3091.2060500@rabbitmq.com>
References: <1334141345.2819.17.camel@workstation.wmmi.net>
	<1334141521.2819.18.camel@workstation.wmmi.net>
	<4F85640B.7020101@rabbitmq.com>	<1334164518.2328.3.camel@p105s6207.site>
	<1334165564.3639.3.camel@p105s6207.site>
	<4F8C3091.2060500@rabbitmq.com>
Message-ID: <1334657440.30453.6.camel@workstation.wmmi.net>

On Mon, 2012-04-16 at 15:45 +0100, Matthias Radestock wrote:
> The above configuration is invalid. The entry should be
> {kernel, [{inet_dist_use_interface, {127,0,0,1}}]}

Ok

> The fact that rabbit started up fine suggests that it didn't read the 
> config at all. Check the broker start up log, which should contain the line
> config file(s) : /etc/rabbitmq/rabbitmq.config

The startup_log contains -

node           : rabbit at workstation
app
descriptor : /usr/lib/rabbitmq/lib/rabbitmq_server-2.7.0/sbin/../ebin/rabbit.app
home dir       : /var/lib/rabbitmq
config file(s) : /etc/rabbitmq/rabbitmq.config
cookie hash    : W563d5DpLXI3d5BxbptjVw==
log            : /var/log/rabbitmq/rabbit at workstation.log
sasl log       : /var/log/rabbitmq/rabbit at workstation-sasl.log
database dir   : /var/lib/rabbitmq/mnesia/rabbit at workstation
erlang version : 5.9


But adding the above the config file makes Rabbit unable to shutdown
properly (if added while the service is running) or unable to start (it
hangs).

> export ERL_EPMD_DIST_BIND=172.0.0.1

This variable doesn't effect what ports are opened.  

I added ". /etc/sysconfig/rabbitmq" to the startup file and that file
contains:

export ERL_EPMD_DIST_BIND=127.0.0.1

Something & Erlang still opens all interfaces:

tcp  0.0.0.0:4369       0.0.0.0:*   LISTEN      32571/epmd
tcp  127.0.0.1:55672    0.0.0.0:*   LISTEN      32603/beam.smp      
tcp  0.0.0.0:52445      0.0.0.0:*   LISTEN      32603/beam.smp
tcp  127.0.0.1:5672     0.0.0.0:*   LISTEN      32603/beam.smp

The config has managed to restric rabbit's service as well as the
management interface.

rabbitmq-server-2.7.0-1.suse.noarch
Linux 3.1.0-1.2-desktop

workstation:~ # cat /etc/rabbitmq/rabbitmq.config 
[
  {rabbit,        {tcp_listeners,               [{'127.0.0.1',5672}]},
                  {collect_statistics_interval, 10000} ] },
  {rabbitmq_management,  [ {http_log_dir,   "/tmp/rabbit-mgmt"} ] },
  {rabbitmq_management_agent, [ {force_fine_statistics, true} ] },
  {rabbitmq_mochiweb, [ {listeners, [{mgmt, [{port, 55672},
                                             {ip, "127.0.0.1"}]}]},
                        {default_listener, [{port, 60000} ] } ] }
].

-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 198 bytes
Desc: This is a digitally signed message part
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120417/df84e33f/attachment.pgp>

From simon at rabbitmq.com  Tue Apr 17 11:12:54 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 17 Apr 2012 11:12:54 +0100
Subject: [rabbitmq-discuss] DEMO - RabbitMQ running as Mac Standalone App
In-Reply-To: <8ABC027D44A64CFE89B2B815B4A57D59@gmail.com>
References: <46AEA592CFE3497894B1BE157795B799@gmail.com>	<CAM8fPiRS0O6D5MeG=d32yEGWydYd9B9p-g4PXC3FOskOYHDp8g@mail.gmail.com>	<E9E4F8687AB14AC1A1394A370232653D@gmail.com>
	<8ABC027D44A64CFE89B2B815B4A57D59@gmail.com>
Message-ID: <4F8D4226.8080001@rabbitmq.com>

Wow, thank you Alvaro, this is great stuff.

Although I can't try it because my Mac is at home, and still runs Snow 
Leopard (hint :-)

Does the UI part let you see the startup banner on stdout? Just thinking 
that would prove useful if the broker fails to start up.

Thank you again.

Cheers, Simon

On 16/04/12 23:22, Alvaro Videla wrote:
> Hi,
>
> Here's the link to the .dmg with the App. It only works only on OS X
> Lion tho. I might try to get it running in Snow Leopard later.
>
> http://dl.dropbox.com/u/58659506/RabbitMQ-2.8.1u.dmg
>
> Cheers,
>
> Alvaro
>
> --
> Sent with Sparrow <http://www.sparrowmailapp.com/?sig>
>
> On Monday, April 16, 2012 at 10:16 PM, Alvaro Videla wrote:
>
>> Hi,
>>
>> The UI part is just an Xcode project using a WebKit webview control.
>>
>> The tricky part is to know when rabbitmq is actually running, so I'm
>> using a shell script to tell that.
>>
>> Then the whole thing is just using NSTask all over the place to
>> start/stop the broker.
>>
>> FYI, just installed the app in another Mac I have and this works
>> (still OSX Lion). I also trying sending messages over the network and
>> it works as well.
>>
>> Doing some code cleanup now before publishing.
>>
>> Cheers,
>>
>> Alvaro
>>
>> --
>> Sent with Sparrow <http://www.sparrowmailapp.com/?sig>
>>
>> On Monday, April 16, 2012 at 9:32 PM, Tony Garnock-Jones wrote:
>>
>>> That's great! I'm looking forward to seeing how you did it :-) (in
>>> particular the UI part)
>>>
>>> Regards,
>>> Tony
>>>
>>> On 16 April 2012 15:14, Alvaro Videla <videlalvaro at gmail.com
>>> <mailto:videlalvaro at gmail.com>> wrote:
>>>> Hi,
>>>>
>>>> Here's a little demo video of RabbitMQ running as standalone Mac App
>>>>
>>>> http://vimeo.com/40473369
>>>>
>>>> I will try to put it online soon, first I need to test it in another
>>>> computer ;-)
>>>>
>>>> Cheers,
>>>>
>>>> Alvaro
>>>>
>>>> --
>>>> Sent with Sparrow <http://www.sparrowmailapp.com/?sig>
>>>>
>>>>
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>
>>>
>>>
>>>
>>> --
>>> Tony Garnock-Jones
>>> tonygarnockjones at gmail.com <mailto:tonygarnockjones at gmail.com>
>>> http://homepages.kcbbs.gen.nz/tonyg/
>>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From videlalvaro at gmail.com  Tue Apr 17 12:01:52 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Tue, 17 Apr 2012 13:01:52 +0200
Subject: [rabbitmq-discuss] missing dependency in management plugin
Message-ID: <CAMcAHLXzVam3LLbdw499163=MLtgW49nYsZ02bnnyJAHoiJcmA@mail.gmail.com>

Hi,

While building the rabbitmq release I've found out that the management
plugin doesn't declare one of it's Erlang dependencies in the .app file

The issue is minimal but prevents from exporting the plugin as part of a
standalone release.

See this diff:
https://github.com/videlalvaro/rabbitmq-release/blob/master/rabbit_management.diff

Do you think that could be merged into the default repo? BTW, I already
signed the VMWare CLA

Regards,

Alvaro
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120417/c7b52086/attachment.htm>

From tonygarnockjones+rabbitmq at gmail.com  Tue Apr 17 12:02:13 2012
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Tue, 17 Apr 2012 07:02:13 -0400
Subject: [rabbitmq-discuss] Cannot send message with STOMP
In-Reply-To: <20365.234.891858.767694@mail.cern.ch>
References: <20120416153346.b41c.abe10f7e5afbbb3a79ce619739541149@cern.ch>
	<CAM8fPiT4grNkru+aRW+gb9=RQkyA-N39G7rnTk35BiUGkJngNQ@mail.gmail.com>
	<1D9CBD89533EE94D8295DFBFD923C23F649F007B@PLOXCHG03.cern.ch>
	<CAM8fPiSG4L1QwcKQVC7rrLqSTUJ3E23BQ9UFO7=Fokwz2qfvZQ@mail.gmail.com>
	<20365.234.891858.767694@mail.cern.ch>
Message-ID: <CAM8fPiQym+sNwe_vwz_v208eKApS09WvMQ4HeCvBRmXdwZMmfA@mail.gmail.com>

On 17 April 2012 01:34, Lionel Cons <lionel.cons at cern.ch> wrote:

> IMHO, the BNF definition is correct: it accurately defines what you
> can see on the wire and this is sufficient to extract frames. It does
> not however define how to interpret what you extract from the wire,
> like backslash escaping and UTF-8 encoding, which are defined elsewhere
> in the STOMP 1.1 specification.
>

Fair enough. Perhaps "incorrect" was a bit strong, but it could definitely
have helped this casual reader avoid the dangerous misinterpretation I
ended up making by reading the BNF alone. I believe it could profitably
also describe the backslash-escaping. (After all, it would also be correct,
in some sense, for it to specify the headers block as "a sequence of bytes
not including two newlines in a row, followed by two newlines", leaving it
up the the rest of the text to describe how to extract the key-value pairs
from that structure! ;-) )

Here's the kind of thing I was expecting:

header              = header-name ":" header-value
header-name         = 1*header-text-atom
header-value        = *header-text-atom
header-text-atom    = "\n" | "\c" | "\\" | <any OCTET except LF or ":" or "\">


I should have been paying more attention during the 1.1 development process.

Regards,
  Tony
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120417/6c098a72/attachment.htm>

From matthias at rabbitmq.com  Tue Apr 17 12:14:53 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 17 Apr 2012 12:14:53 +0100
Subject: [rabbitmq-discuss] Identifying TCP Listeners.
In-Reply-To: <1334657440.30453.6.camel@workstation.wmmi.net>
References: <1334141345.2819.17.camel@workstation.wmmi.net>		<1334141521.2819.18.camel@workstation.wmmi.net>		<4F85640B.7020101@rabbitmq.com>	<1334164518.2328.3.camel@p105s6207.site>	
	<1334165564.3639.3.camel@p105s6207.site>
	<4F8C3091.2060500@rabbitmq.com>
	<1334657440.30453.6.camel@workstation.wmmi.net>
Message-ID: <4F8D50AD.5060508@rabbitmq.com>

Adam,

On 17/04/12 11:10, Adam Tauno Williams wrote:
>> export ERL_EPMD_DIST_BIND=172.0.0.1
>
> This variable doesn't effect what ports are opened.

Serves me right for believing what it says on the internet. The correct 
env var is ERL_EPMD_ADDRESS. Apologies.

> I added ". /etc/sysconfig/rabbitmq" to the startup file and that file
> contains:
>
> export ERL_EPMD_DIST_BIND=127.0.0.1
>
> Something&  Erlang still opens all interfaces:
>
> tcp  0.0.0.0:4369       0.0.0.0:*   LISTEN      32571/epmd
> tcp  127.0.0.1:55672    0.0.0.0:*   LISTEN      32603/beam.smp
> tcp  0.0.0.0:52445      0.0.0.0:*   LISTEN      32603/beam.smp
> tcp  127.0.0.1:5672     0.0.0.0:*   LISTEN      32603/beam.smp
>
> The config has managed to restric rabbit's service as well as the
> management interface.
>
> rabbitmq-server-2.7.0-1.suse.noarch
> Linux 3.1.0-1.2-desktop
>
> workstation:~ # cat /etc/rabbitmq/rabbitmq.config
> [
>    {rabbit,        {tcp_listeners,               [{'127.0.0.1',5672}]},
>                    {collect_statistics_interval, 10000} ] },
>    {rabbitmq_management,  [ {http_log_dir,   "/tmp/rabbit-mgmt"} ] },
>    {rabbitmq_management_agent, [ {force_fine_statistics, true} ] },
>    {rabbitmq_mochiweb, [ {listeners, [{mgmt, [{port, 55672},
>                                               {ip, "127.0.0.1"}]}]},
>                          {default_listener, [{port, 60000} ] } ] }
> ].

The above cannot possibly be the config file that is actually being used 
since it is syntactically invalid and causes rabbit to fail to start.

Anyway, here's what I did to affect an address change. Please follow 
these steps EXACTLY...

1) stop any running rabbit and other erlang processes. Verify this by 
checking that there are no beam.smp processes left running.

2) stop any running epmd processes with 'epmd -kill'. Verify this by 
checking that there are no epmd processes left running.

3) put the following in /etc/rabbitmq/rabbitmq.config

[{kernel, [{inet_dist_use_interface, {127,0,0,1}}]},
  {rabbit, [{tcp_listeners, [{"127.0.0.1", 5672}]}]},
  {rabbitmq_mochiweb, [{listeners, [{mgmt, [{ip, "127.0.0.1"},
                                            {port, 55672}]}]}]}].

4) put the following in /etc/rabbitmq/rabbitmq-env.conf

export ERL_EPMD_ADDRESS=127.0.0.1

5) start rabbit

6) verify that the config file has been read by inspecting the startup log

7) check what interfaces are being listened on

$ sudo netstat -lpn | grep epmd
tcp  0  0 127.0.0.1:4369   0.0.0.0:*  LISTEN  716/epmd
$ sudo netstat -lpn | grep beam
tcp  0  0 127.0.0.1:45011  0.0.0.0:*  LISTEN  702/beam.smp
tcp  0  0 127.0.0.1:55672  0.0.0.0:*  LISTEN  702/beam.smp
tcp  0  0 127.0.0.1:5672   0.0.0.0:*  LISTEN  702/beam.smp


Regards,

Matthias.

From simon at rabbitmq.com  Tue Apr 17 12:19:05 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 17 Apr 2012 12:19:05 +0100
Subject: [rabbitmq-discuss] missing dependency in management plugin
In-Reply-To: <CAMcAHLXzVam3LLbdw499163=MLtgW49nYsZ02bnnyJAHoiJcmA@mail.gmail.com>
References: <CAMcAHLXzVam3LLbdw499163=MLtgW49nYsZ02bnnyJAHoiJcmA@mail.gmail.com>
Message-ID: <4F8D51A9.90304@rabbitmq.com>

Gosh, I never even realised xmerl was an application. Thanks for the 
catch, will merge.

Cheers, Simon

On 17/04/12 12:01, Alvaro Videla wrote:
> Hi,
>
> While building the rabbitmq release I've found out that the management
> plugin doesn't declare one of it's Erlang dependencies in the .app file
>
> The issue is minimal but prevents from exporting the plugin as part of a
> standalone release.
>
> See this diff:
> https://github.com/videlalvaro/rabbitmq-release/blob/master/rabbit_management.diff
>
> Do you think that could be merged into the default repo? BTW, I already
> signed the VMWare CLA
>
> Regards,
>
> Alvaro
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From videlalvaro at gmail.com  Tue Apr 17 12:19:54 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Tue, 17 Apr 2012 13:19:54 +0200
Subject: [rabbitmq-discuss] DEMO - RabbitMQ running as Mac Standalone App
In-Reply-To: <4F8D4226.8080001@rabbitmq.com>
References: <46AEA592CFE3497894B1BE157795B799@gmail.com>
	<CAM8fPiRS0O6D5MeG=d32yEGWydYd9B9p-g4PXC3FOskOYHDp8g@mail.gmail.com>
	<E9E4F8687AB14AC1A1394A370232653D@gmail.com>
	<8ABC027D44A64CFE89B2B815B4A57D59@gmail.com>
	<4F8D4226.8080001@rabbitmq.com>
Message-ID: <CAMcAHLXkhwrAPo=w0xu7AzQU4FMu1WSJMGWm-P9018Z3YEyFxw@mail.gmail.com>

Hi Simon,

I just tried on Snow Leopard. So the standalone RabbitMQ works. (If you
start it manually from the CLI)

What doesn't work in Snow Leopard is the App itself. So I need to compile
it for SL and then try again. I need to see how to do that with XCode since
the Cocoa frameworks changed a bit from the previous version.

Regards,

Alvaro

On Tue, Apr 17, 2012 at 12:12 PM, Simon MacMullen <simon at rabbitmq.com>wrote:

> Wow, thank you Alvaro, this is great stuff.
>
> Although I can't try it because my Mac is at home, and still runs Snow
> Leopard (hint :-)
>
> Does the UI part let you see the startup banner on stdout? Just thinking
> that would prove useful if the broker fails to start up.
>
> Thank you again.
>
> Cheers, Simon
>
>
> On 16/04/12 23:22, Alvaro Videla wrote:
>
>> Hi,
>>
>> Here's the link to the .dmg with the App. It only works only on OS X
>> Lion tho. I might try to get it running in Snow Leopard later.
>>
>> http://dl.dropbox.com/u/**58659506/RabbitMQ-2.8.1u.dmg<http://dl.dropbox.com/u/58659506/RabbitMQ-2.8.1u.dmg>
>>
>> Cheers,
>>
>> Alvaro
>>
>> --
>> Sent with Sparrow <http://www.sparrowmailapp.**com/?sig<http://www.sparrowmailapp.com/?sig>
>> >
>>
>>
>> On Monday, April 16, 2012 at 10:16 PM, Alvaro Videla wrote:
>>
>>  Hi,
>>>
>>> The UI part is just an Xcode project using a WebKit webview control.
>>>
>>> The tricky part is to know when rabbitmq is actually running, so I'm
>>> using a shell script to tell that.
>>>
>>> Then the whole thing is just using NSTask all over the place to
>>> start/stop the broker.
>>>
>>> FYI, just installed the app in another Mac I have and this works
>>> (still OSX Lion). I also trying sending messages over the network and
>>> it works as well.
>>>
>>> Doing some code cleanup now before publishing.
>>>
>>> Cheers,
>>>
>>> Alvaro
>>>
>>> --
>>> Sent with Sparrow <http://www.sparrowmailapp.**com/?sig<http://www.sparrowmailapp.com/?sig>
>>> >
>>>
>>>
>>> On Monday, April 16, 2012 at 9:32 PM, Tony Garnock-Jones wrote:
>>>
>>>  That's great! I'm looking forward to seeing how you did it :-) (in
>>>> particular the UI part)
>>>>
>>>> Regards,
>>>> Tony
>>>>
>>>> On 16 April 2012 15:14, Alvaro Videla <videlalvaro at gmail.com
>>>> <mailto:videlalvaro at gmail.com>**> wrote:
>>>>
>>>>> Hi,
>>>>>
>>>>> Here's a little demo video of RabbitMQ running as standalone Mac App
>>>>>
>>>>> http://vimeo.com/40473369
>>>>>
>>>>> I will try to put it online soon, first I need to test it in another
>>>>> computer ;-)
>>>>>
>>>>> Cheers,
>>>>>
>>>>> Alvaro
>>>>>
>>>>> --
>>>>> Sent with Sparrow <http://www.sparrowmailapp.**com/?sig<http://www.sparrowmailapp.com/?sig>
>>>>> >
>>>>>
>>>>>
>>>>>
>>>>> ______________________________**_________________
>>>>> rabbitmq-discuss mailing list
>>>>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>>>>> <mailto:rabbitmq-discuss@**lists.rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>>>>> >
>>>>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**
>>>>> rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>>>>
>>>>>
>>>>
>>>>
>>>> --
>>>> Tony Garnock-Jones
>>>> tonygarnockjones at gmail.com <mailto:tonygarnockjones@**gmail.com<tonygarnockjones at gmail.com>
>>>> >
>>>> http://homepages.kcbbs.gen.nz/**tonyg/<http://homepages.kcbbs.gen.nz/tonyg/>
>>>>
>>>
>>>
>>
>>
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120417/b1d9c9fb/attachment.htm>

From m.luchak at smartasking.com  Tue Apr 17 12:31:29 2012
From: m.luchak at smartasking.com (m.luchak at smartasking.com)
Date: Tue, 17 Apr 2012 07:31:29 -0400 (EDT)
Subject: [rabbitmq-discuss] exchange.bind details
In-Reply-To: <CACOPnvebheoRKbTRxRMVETC_jHR07_saaYNDhejstMq2YHhDQQ@mail.gmail.com>
References: <1334615043.691928514@apps.rackspace.com> 
	<CACOPnvfqEL=kybxZ9r0BqukXLbcxttEbKqGgJ8nT7yAFLppo9g@mail.gmail.com> 
	<1334623205.538323350@apps.rackspace.com> 
	<CACOPnvebheoRKbTRxRMVETC_jHR07_saaYNDhejstMq2YHhDQQ@mail.gmail.com>
Message-ID: <1334662289.53033060@apps.rackspace.com>


Hi Alex,
 
The messages will be deleted according to an internal logic... not directly upon consumption.  There is no problem using a noack to keep the messages available for another connection on the Q, but, the question is "how to concurently deliver messages to all instances of the same user".
 
Imagine this scenario:
 
I am connected to a Q on my computer.  I leave the office and connect to the same Q with my phone.  My phone will never receive messages as long as my computer is connected to the Q.
 
To get around this problem I intend to use exchange.bind (in place of the named Q) but cannot find much info on it's implementation...  Can you point me to some material on exchange.bind?
 
thanks,
Matthew
 
-----Original Message-----
From: "Alexis Richardson" <alexis at rabbitmq.com>
Sent: Tuesday, April 17, 2012 2:37am
To: m.luchak at smartasking.com
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] exchange.bind details



Matthew

When do messages get dropped or deleted?  I.e. do you want a copy of
every message to get delivered to every device?

If a user reads a message on their phone, can they read it again later
on another device?

alexis



On Tue, Apr 17, 2012 at 1:40 AM,  <m.luchak at smartasking.com> wrote:
> Thanks for the help Alexis but the scenario is a little more complicated...
> I think exchange binding is the only way to go... but I'm open for
> suggestions ;)
>
>
>
> Users are able to log-on to the system using more than one device at the
> same time (mobile, web, desktop) and it is a requirement that messages are
> delivered to each of these devices even if they are all logged on at the
> same time. Sooo... I am looking at exchange binding like:
>
>
>
> P -> Topic Exchange <------------User1Exchange
>
> |_________temporary Q mobile
>
> |________temporary Q web
>
> |_________temporary Q desktop
>
>
>
>
>
> Functional Requirements:
>
> Topic exchanges
>
> Messages published to exchange while user offline are available when user
> logs-on
>
> One "permanent address" per user (thought of queue - looks like I need
> exchange)
>
> multiple instances of the same user logged-on concurrently
>
>
>
>
>
>
> -----Original Message-----
> From: "Alexis Richardson" <alexis at rabbitmq.com>
> Sent: Monday, April 16, 2012 6:33pm
> To: m.luchak at smartasking.com
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] exchange.bind details
>
> Matthew
>
> Have you tried using direct exchanges?
> http://www.rabbitmq.com/tutorials/tutorial-three-python.html
>
> alexis
>
>
> On Mon, Apr 16, 2012 at 11:24 PM, <m.luchak at smartasking.com> wrote:
>> Hi all,
>>
>>
>>
>> Thanks for the help with the STOMP question. I am having difficulties
>> understanding the exchange.bind constructor (ticket, destination,
>> source).... Could someone please point me to resources?
>>
>>
>>
>> I am trying to implement "exchange.bind"
>>  (http://www.rabbitmq.com/blog/2010/10/19/exchange-to-exchange-bindings/)
>> to
>> allow multiple instances of the same user presence (android, web, desktop)
>> to receive notifications.
>>
>>
>>
>> Under the exchange->Q model if all three devices are logged in
>> concurrently
>> there is no way for all instances to receive messages as they will all be
>> logged in on the same Q.
>>
>>
>>
>> thanks,
>>
>> Matthew
>>
>>
>>
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120417/86348274/attachment.htm>

From sahmed1020 at gmail.com  Tue Apr 17 12:35:38 2012
From: sahmed1020 at gmail.com (S Ahmed)
Date: Tue, 17 Apr 2012 07:35:38 -0400
Subject: [rabbitmq-discuss] java: how are you guys processing messages,
	any good frameworks like celery/resque?
Message-ID: <CAG2rwuMa6xH+_+350+gK8k4bFk0_YZZz0gMPn-wD50Bs+XQyLg@mail.gmail.com>

In the java world, are there any task/job queue frameworks simliar to
http://celeryproject.org/ or resque that process messages off of rabbitmq?

I can't seem to find anything, which is surprising seeing as how mature
java is.



thanks for your help!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120417/f1c4b358/attachment.htm>

From lars.ellebo at schneider-electric.com  Tue Apr 17 12:43:58 2012
From: lars.ellebo at schneider-electric.com (Lars Ellebo)
Date: Tue, 17 Apr 2012 04:43:58 -0700 (PDT)
Subject: [rabbitmq-discuss]  Maximum Simultaneous Connections
Message-ID: <33701108.post@talk.nabble.com>


Hello there

What is the maximum theoretical simultaneous connections on a Linux
RabbitMQ?

I want to be able to handle 10.000 simultaneous connections on Linux
RabbitMQ with very little traffic on each connection.

What amount of system resources are recommended to enable this on Linux
(CPU, RAM, DISK etc)?

Are there any Resource Limit Parameters I need to adjust on Linux, Erlang or
RabbitMQ in order to enable this number of simultaneous connections (like
ulimit etc)?

/Lars

-- 
View this message in context: http://old.nabble.com/Maximum-Simultaneous-Connections-tp33701108p33701108.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From alexis at rabbitmq.com  Tue Apr 17 13:11:04 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Tue, 17 Apr 2012 13:11:04 +0100
Subject: [rabbitmq-discuss] exchange.bind details
In-Reply-To: <1334662289.53033060@apps.rackspace.com>
References: <1334615043.691928514@apps.rackspace.com>
	<CACOPnvfqEL=kybxZ9r0BqukXLbcxttEbKqGgJ8nT7yAFLppo9g@mail.gmail.com>
	<1334623205.538323350@apps.rackspace.com>
	<CACOPnvebheoRKbTRxRMVETC_jHR07_saaYNDhejstMq2YHhDQQ@mail.gmail.com>
	<1334662289.53033060@apps.rackspace.com>
Message-ID: <CACOPnvdZhcO8pASCCh3nY2n=JBFbZKVixY0K5PPdOjhya2sg+w@mail.gmail.com>

Matthew

I'm still not convinced you need exchange-exchange binding.  But the
use is described here:
http://www.rabbitmq.com/blog/2010/10/19/exchange-to-exchange-bindings/

alexis


On Tue, Apr 17, 2012 at 12:31 PM,  <m.luchak at smartasking.com> wrote:
> Hi Alex,
>
>
>
> The messages will be deleted according to an internal logic... not directly
> upon consumption. ?There is no problem using a noack to keep the messages
> available for another connection on the Q, but, the question is "how to
> concurently deliver messages to all instances of the same user".
>
>
>
> Imagine this scenario:
>
>
>
> I am connected to a Q on my computer. ?I leave the office and connect to the
> same Q with my phone. ?My phone will never receive messages as long as my
> computer is connected to the Q.
>
>
>
> To get around this problem I intend to use exchange.bind (in place of the
> named Q) but cannot find much info on it's implementation... ?Can you point
> me to some material on exchange.bind?
>
>
>
> thanks,
>
> Matthew
>
>
>
> -----Original Message-----
> From: "Alexis Richardson" <alexis at rabbitmq.com>
> Sent: Tuesday, April 17, 2012 2:37am
> To: m.luchak at smartasking.com
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] exchange.bind details
>
> Matthew
>
> When do messages get dropped or deleted? I.e. do you want a copy of
> every message to get delivered to every device?
>
> If a user reads a message on their phone, can they read it again later
> on another device?
>
> alexis
>
>
>
> On Tue, Apr 17, 2012 at 1:40 AM, <m.luchak at smartasking.com> wrote:
>> Thanks for the help Alexis but the scenario is a little more
>> complicated...
>> I think exchange binding is the only way to go... but I'm open for
>> suggestions ;)
>>
>>
>>
>> Users are able to log-on to the system using more than one device at the
>> same time (mobile, web, desktop) and it is a requirement that messages are
>> delivered to each of these devices even if they are all logged on at the
>> same time. Sooo... I am looking at exchange binding like:
>>
>>
>>
>> P -> Topic Exchange <------------User1Exchange
>>
>> |_________temporary Q mobile
>>
>> |________temporary Q web
>>
>> |_________temporary Q desktop
>>
>>
>>
>>
>>
>> Functional Requirements:
>>
>> Topic exchanges
>>
>> Messages published to exchange while user offline are available when user
>> logs-on
>>
>> One "permanent address" per user (thought of queue - looks like I need
>> exchange)
>>
>> multiple instances of the same user logged-on concurrently
>>
>>
>>
>>
>>
>>
>> -----Original Message-----
>> From: "Alexis Richardson" <alexis at rabbitmq.com>
>> Sent: Monday, April 16, 2012 6:33pm
>> To: m.luchak at smartasking.com
>> Cc: rabbitmq-discuss at lists.rabbitmq.com
>> Subject: Re: [rabbitmq-discuss] exchange.bind details
>>
>> Matthew
>>
>> Have you tried using direct exchanges?
>> http://www.rabbitmq.com/tutorials/tutorial-three-python.html
>>
>> alexis
>>
>>
>> On Mon, Apr 16, 2012 at 11:24 PM, <m.luchak at smartasking.com> wrote:
>>> Hi all,
>>>
>>>
>>>
>>> Thanks for the help with the STOMP question. I am having difficulties
>>> understanding the exchange.bind constructor (ticket, destination,
>>> source).... Could someone please point me to resources?
>>>
>>>
>>>
>>> I am trying to implement "exchange.bind"
>>> ?(http://www.rabbitmq.com/blog/2010/10/19/exchange-to-exchange-bindings/)
>>> to
>>> allow multiple instances of the same user presence (android, web,
>>> desktop)
>>> to receive notifications.
>>>
>>>
>>>
>>> Under the exchange->Q model if all three devices are logged in
>>> concurrently
>>> there is no way for all instances to receive messages as they will all be
>>> logged in on the same Q.
>>>
>>>
>>>
>>> thanks,
>>>
>>> Matthew
>>>
>>>
>>>
>>>
>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From alexis at rabbitmq.com  Tue Apr 17 13:11:52 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Tue, 17 Apr 2012 13:11:52 +0100
Subject: [rabbitmq-discuss] java: how are you guys processing messages,
 any good frameworks like celery/resque?
In-Reply-To: <CAG2rwuMa6xH+_+350+gK8k4bFk0_YZZz0gMPn-wD50Bs+XQyLg@mail.gmail.com>
References: <CAG2rwuMa6xH+_+350+gK8k4bFk0_YZZz0gMPn-wD50Bs+XQyLg@mail.gmail.com>
Message-ID: <CACOPnveuqVb+zquxpB1VmUc6mw+P0yxt--HeAU+P+AW8FXr4eg@mail.gmail.com>

On Tue, Apr 17, 2012 at 12:35 PM, S Ahmed <sahmed1020 at gmail.com> wrote:
> In the java world, are there any task/job queue frameworks simliar
> to?http://celeryproject.org/ or resque that process messages off of
> rabbitmq?
>
> I can't seem to find anything, which is surprising seeing as how mature java
> is.

Would this help?

http://static.springsource.org/spring-batch/




>
>
> thanks for your help!
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From Ryan at nutcracker.co.za  Tue Apr 17 13:52:02 2012
From: Ryan at nutcracker.co.za (Ryan Gunn)
Date: Tue, 17 Apr 2012 12:52:02 +0000
Subject: [rabbitmq-discuss] RabbitMQ .NET Client - QueueBind Slow &
	Synchronous
Message-ID: <A33D44D3C6F1D54AA679F7A3B0995E2323794368@Nutdc.Nutcracker.local>

Good Day/Evening,

I'm having some problems where my application hangs when calling QueueBind on the Model. If my client loses connection and connection is restored I re-subscribe to all routing keys the user was subscribed to. When subscribing to 170 routing keys on the same exchange and queue it takes about 6 - 8 seconds and during those 6-8 seconds my application is hanging due to the QueueBind being a synchronous. I'm currently using v2.7.1 of the RabbitMQ Client.

My Questions are:

Should it take 6-8 seconds to subscribe to 170 routing keys?
Will you be able to add an asynchronous call for QueueBind to the RabbitMQ Client API? (I don't know if this is the right place to ask for such requests)

Thanks for your help.

Ryan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120417/f89cecd4/attachment.htm>

From emile at rabbitmq.com  Tue Apr 17 14:05:24 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 17 Apr 2012 14:05:24 +0100
Subject: [rabbitmq-discuss] RabbitMQ .NET Client - QueueBind Slow &
	Synchronous
In-Reply-To: <A33D44D3C6F1D54AA679F7A3B0995E2323794368@Nutdc.Nutcracker.local>
References: <A33D44D3C6F1D54AA679F7A3B0995E2323794368@Nutdc.Nutcracker.local>
Message-ID: <4F8D6A94.2040604@rabbitmq.com>

Hi Ryan,

On 17/04/12 13:52, Ryan Gunn wrote:
> Should it take 6-8 seconds to subscribe to 170 routing keys?

Network latency will be a bit factor. It is entirely possible to wait
this long on a slow network.

> Will you be able to add an asynchronous call for QueueBind to the
> RabbitMQ Client API? (I don?t know if this is the right place to ask for
> such requests)

The bind method can be invoked without waiting for the server reply if
you set the "nowait" parameter. That should speed up rebinding, at the
cost of deferred error reporting.

See the description of "no-wait":
http://www.rabbitmq.com/amqp-0-9-1-reference.html#domains


-Emile


From simon at rabbitmq.com  Tue Apr 17 16:08:26 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 17 Apr 2012 16:08:26 +0100
Subject: [rabbitmq-discuss] Maximum Simultaneous Connections
In-Reply-To: <33701108.post@talk.nabble.com>
References: <33701108.post@talk.nabble.com>
Message-ID: <4F8D876A.3060407@rabbitmq.com>

There's no hard coded maximum in RabbitMQ. Typically you will need to 
raise the ulimit or you'll run out of file descriptors. Once you've done 
that, I don't see 10k connections as a huge deal - you'll need a 
reasonable amount of RAM but it should be very doable.

Cheers, Simon

On 17/04/12 12:43, Lars Ellebo wrote:
> Hello there
>
> What is the maximum theoretical simultaneous connections on a Linux
> RabbitMQ?
>
> I want to be able to handle 10.000 simultaneous connections on Linux
> RabbitMQ with very little traffic on each connection.
>
> What amount of system resources are recommended to enable this on Linux
> (CPU, RAM, DISK etc)?
>
> Are there any Resource Limit Parameters I need to adjust on Linux, Erlang or
> RabbitMQ in order to enable this number of simultaneous connections (like
> ulimit etc)?
>
> /Lars
>


-- 
Simon MacMullen
RabbitMQ, VMware

From gonzalo.fernandez at stoneworksolutions.net  Tue Apr 17 16:05:41 2012
From: gonzalo.fernandez at stoneworksolutions.net (Gonzalo Fernandez)
Date: Tue, 17 Apr 2012 17:05:41 +0200
Subject: [rabbitmq-discuss] limits.conf not working...
Message-ID: <CAA3P-6RmU=wPM62u_AG=98crTiAjj=rzFy0T9oeeBrF+RrF0jQ@mail.gmail.com>

Hello all,

I have been doing some research over the past weeks unsuccessfully.

Let me explain, now I have an Ubuntu 2.6.32-38-server machine with rabbitmq
2.8.1 running.
As you can see below the file descriptor is just is 1024 (924 at the
moment) and the socket limit is 829.

*patilla at test: sudo /etc/init.d/rabbitmq-server status*
Status of node rabbit at SmartShaperTest ...
[{pid,29119},
 {running_applications,
     [{rabbitmq_management,"RabbitMQ Management Console","2.8.1"},
      {rabbitmq_management_agent,"RabbitMQ Management Agent","2.8.1"},
      {amqp_client,"RabbitMQ AMQP Client","2.8.1"},
      {rabbit,"RabbitMQ","2.8.1"},
      {os_mon,"CPO  CXC 138 46","2.2.4"},
      {sasl,"SASL  CXC 138 11","2.1.8"},
      {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.8.1"},
      {webmachine,"webmachine","1.7.0-rmq2.8.1-hg"},
      {mochiweb,"MochiMedia Web Server","1.3-rmq2.8.1-git"},
      {inets,"INETS  CXC 138 49","5.2"},
      {mnesia,"MNESIA  CXC 138 12","4.4.12"},
      {stdlib,"ERTS  CXC 138 10","1.16.4"},
      {kernel,"ERTS  CXC 138 10","2.13.4"}]},
 {os,{unix,linux}},
 {erlang_version,
     "Erlang R13B03 (erts-5.7.4) [source] [64-bit] [smp:4:4] [rq:4]
[async-threa      ds:30] [hipe] [kernel-poll:true]\n"},
 {memory,
     [{total,54392152},
      {processes,32356128},
      {processes_used,24209504},
      {system,22036024},
      {atom,1330113},
      {atom_used,1302718},
      {binary,223152},
      {code,15383701},
      {ets,2900344}]},
 {vm_memory_high_watermark,0.4},
 {vm_memory_limit,842620928},
 {file_descriptors,

 [{total_limit,924},{total_used,3},{sockets_limit,829},{sockets_used,1}]},
 {processes,[{limit,1048576},{used,178}]},
 {run_queue,0},
 {uptime,2352}]
...done.


Well, I also had rabbitmq running before in another machine (OLD machine
from now on), same files, same code, the only difference was rabbit's
version, 2.7.1

On the OLD machine I managed to increase these limits (file and socket) by
editting the /etc/security/limits.conf file as shown:

*rabbitmq  soft  nofile 10011*
*rabbitmq  hard  nofile 65000*

And adding the following line to *
/etc/pam.d/common-session{,-noninteractive}*
*session required pam_limits.so*
*
*
*
*
This worked fine, and on the rabbit management plugin I could see these
changes:

[image: Im?genes integradas 1]

When I tried to do the same on the NEW machine it seems like it is not
working fine.

When I execute *ulimit -n* with rabbitmq user I get the same value
as*limits.conf
*, but in the management site......

*rabbit at test: ulimit -n *
10011


[image: Im?genes integradas 2]


Any thoughts?

I can't find the error..... Could it be the version?


Thanks for your response in advance.


patilla.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120417/586a2ad6/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 14690 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120417/586a2ad6/attachment.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 15290 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120417/586a2ad6/attachment-0001.png>

From simon at rabbitmq.com  Tue Apr 17 16:13:13 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 17 Apr 2012 16:13:13 +0100
Subject: [rabbitmq-discuss] limits.conf not working...
In-Reply-To: <CAA3P-6RmU=wPM62u_AG=98crTiAjj=rzFy0T9oeeBrF+RrF0jQ@mail.gmail.com>
References: <CAA3P-6RmU=wPM62u_AG=98crTiAjj=rzFy0T9oeeBrF+RrF0jQ@mail.gmail.com>
Message-ID: <4F8D8889.1010106@rabbitmq.com>

On 17/04/12 16:05, Gonzalo Fernandez wrote:
> I can't find the error..... Could it be the version?

No. RabbitMQ only ever *reports* on the FD limits it is seeing, it 
doesn't impose any more. And this code has not changed from 2.7.1 to 2.8.1.

Things to check:

* Have you genuinely raised the limit for the rabbitmq user? (sounds 
like you have)

* Is RabbitMQ actually running as the rabbitmq user?

* Have you restarted the server? (since ulimit is only checked on "login".

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From majek04 at gmail.com  Tue Apr 17 17:17:28 2012
From: majek04 at gmail.com (Marek Majkowski)
Date: Tue, 17 Apr 2012 17:17:28 +0100
Subject: [rabbitmq-discuss] Node.js code for RabbitMQ tutorials
Message-ID: <CABzX+qx1sW_t4mjNmNdDjx4rt1VtxfwTJL8Xo0+4-ty2=PBpSQ@mail.gmail.com>

Hi,

Here is code for first three rabbitmq tutorials written in node.js:

    https://github.com/rabbitmq/rabbitmq-tutorials/tree/master/javascript-nodejs

It is using postwait/node-amqp library:
    https://github.com/postwait/node-amqp


Cheers,
    Marek

From muhammad.kamrana at gmail.com  Tue Apr 17 17:48:50 2012
From: muhammad.kamrana at gmail.com (Kamran)
Date: Tue, 17 Apr 2012 09:48:50 -0700 (PDT)
Subject: [rabbitmq-discuss] ConnectionFactory error on Android
Message-ID: <6e33c049-0d5d-4ef5-9d3f-be1292e4030f@v1g2000yqm.googlegroups.com>

Hi,
   There is an android application using rabbitmq that I run on one
computer it works but when i run it on other computer it crashes?
Though I have properly installed erlang binary and rabbitmq server on
my pc running windows. The basic java tutorials are also working. When
I check the logcat of android there it gives an error related to
connectionfactory?
Is there something specific that I should look for?

From james.r.carr at gmail.com  Tue Apr 17 20:41:59 2012
From: james.r.carr at gmail.com (James Carr)
Date: Tue, 17 Apr 2012 14:41:59 -0500
Subject: [rabbitmq-discuss] Node.js code for RabbitMQ tutorials
In-Reply-To: <CABzX+qx1sW_t4mjNmNdDjx4rt1VtxfwTJL8Xo0+4-ty2=PBpSQ@mail.gmail.com>
References: <CABzX+qx1sW_t4mjNmNdDjx4rt1VtxfwTJL8Xo0+4-ty2=PBpSQ@mail.gmail.com>
Message-ID: <CAJreXKA0zY+ZLAa_MQFDaW0hoLKC5xoFUU7xJ4PRtnsHdsvKQA@mail.gmail.com>

Very nice.

On Tue, Apr 17, 2012 at 11:17 AM, Marek Majkowski <majek04 at gmail.com> wrote:

> Hi,
>
> Here is code for first three rabbitmq tutorials written in node.js:
>
>
> https://github.com/rabbitmq/rabbitmq-tutorials/tree/master/javascript-nodejs
>
> It is using postwait/node-amqp library:
>    https://github.com/postwait/node-amqp
>
>
> Cheers,
>    Marek
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120417/d9a30c1a/attachment.htm>

From videlalvaro at gmail.com  Tue Apr 17 21:14:08 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Tue, 17 Apr 2012 22:14:08 +0200
Subject: [rabbitmq-discuss] DEMO - RabbitMQ running as Mac Standalone App
In-Reply-To: <CAMcAHLXkhwrAPo=w0xu7AzQU4FMu1WSJMGWm-P9018Z3YEyFxw@mail.gmail.com>
References: <46AEA592CFE3497894B1BE157795B799@gmail.com>
	<CAM8fPiRS0O6D5MeG=d32yEGWydYd9B9p-g4PXC3FOskOYHDp8g@mail.gmail.com>
	<E9E4F8687AB14AC1A1394A370232653D@gmail.com>
	<8ABC027D44A64CFE89B2B815B4A57D59@gmail.com>
	<4F8D4226.8080001@rabbitmq.com>
	<CAMcAHLXkhwrAPo=w0xu7AzQU4FMu1WSJMGWm-P9018Z3YEyFxw@mail.gmail.com>
Message-ID: <65BDA61C13414D779FBAA918DF455454@gmail.com>

Hi, 

I just upgraded the release with compatibility for Snow Leopard as well. Get it here: http://dl.dropbox.com/u/58659506/RabbitMQ-2.8.1u.dmg

Please let me know of any issues.

Cheers,

Alvaro  

-- 
Sent with Sparrow (http://www.sparrowmailapp.com/?sig)


On Tuesday, April 17, 2012 at 1:19 PM, Alvaro Videla wrote:

> Hi Simon,
> 
> I just tried on Snow Leopard. So the standalone RabbitMQ works. (If you start it manually from the CLI)
> 
> What doesn't work in Snow Leopard is the App itself. So I need to compile it for SL and then try again. I need to see how to do that with XCode since the Cocoa frameworks changed a bit from the previous version. 
> 
> Regards,
> 
> Alvaro
> 
> On Tue, Apr 17, 2012 at 12:12 PM, Simon MacMullen <simon at rabbitmq.com (mailto:simon at rabbitmq.com)> wrote:
> > Wow, thank you Alvaro, this is great stuff.
> > 
> > Although I can't try it because my Mac is at home, and still runs Snow Leopard (hint :-)
> > 
> > Does the UI part let you see the startup banner on stdout? Just thinking that would prove useful if the broker fails to start up.
> > 
> > Thank you again.
> > 
> > Cheers, Simon
> > 
> > 
> > On 16/04/12 23:22, Alvaro Videla wrote:
> > > Hi,
> > > 
> > > Here's the link to the .dmg with the App. It only works only on OS X
> > > Lion tho. I might try to get it running in Snow Leopard later.
> > > 
> > > http://dl.dropbox.com/u/58659506/RabbitMQ-2.8.1u.dmg
> > > 
> > > Cheers,
> > > 
> > > Alvaro
> > > 
> > > --
> > > Sent with Sparrow <http://www.sparrowmailapp.com/?sig>
> > > 
> > > 
> > > On Monday, April 16, 2012 at 10:16 PM, Alvaro Videla wrote:
> > > 
> > > > Hi,
> > > > 
> > > > The UI part is just an Xcode project using a WebKit webview control.
> > > > 
> > > > The tricky part is to know when rabbitmq is actually running, so I'm
> > > > using a shell script to tell that.
> > > > 
> > > > Then the whole thing is just using NSTask all over the place to
> > > > start/stop the broker.
> > > > 
> > > > FYI, just installed the app in another Mac I have and this works
> > > > (still OSX Lion). I also trying sending messages over the network and
> > > > it works as well.
> > > > 
> > > > Doing some code cleanup now before publishing.
> > > > 
> > > > Cheers,
> > > > 
> > > > Alvaro
> > > > 
> > > > --
> > > > Sent with Sparrow <http://www.sparrowmailapp.com/?sig>
> > > > 
> > > > 
> > > > On Monday, April 16, 2012 at 9:32 PM, Tony Garnock-Jones wrote:
> > > > 
> > > > > That's great! I'm looking forward to seeing how you did it :-) (in
> > > > > particular the UI part)
> > > > > 
> > > > > Regards,
> > > > > Tony
> > > > > 
> > > > > On 16 April 2012 15:14, Alvaro Videla <videlalvaro at gmail.com (mailto:videlalvaro at gmail.com)
> > > > > <mailto:videlalvaro at gmail.com>> wrote:
> > > > > > Hi,
> > > > > > 
> > > > > > Here's a little demo video of RabbitMQ running as standalone Mac App
> > > > > > 
> > > > > > http://vimeo.com/40473369
> > > > > > 
> > > > > > I will try to put it online soon, first I need to test it in another
> > > > > > computer ;-)
> > > > > > 
> > > > > > Cheers,
> > > > > > 
> > > > > > Alvaro
> > > > > > 
> > > > > > --
> > > > > > Sent with Sparrow <http://www.sparrowmailapp.com/?sig>
> > > > > > 
> > > > > > 
> > > > > > 
> > > > > > _______________________________________________
> > > > > > rabbitmq-discuss mailing list
> > > > > > rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> > > > > > <mailto:rabbitmq-discuss at lists.rabbitmq.com>
> > > > > > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > > > > > 
> > > > > 
> > > > > 
> > > > > 
> > > > > --
> > > > > Tony Garnock-Jones
> > > > > tonygarnockjones at gmail.com (mailto:tonygarnockjones at gmail.com) <mailto:tonygarnockjones at gmail.com>
> > > > > http://homepages.kcbbs.gen.nz/tonyg/
> > > > 
> > > 
> > > 
> > > 
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> > > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > 
> > 
> > -- 
> > Simon MacMullen
> > RabbitMQ, VMware
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120417/ee0d3d50/attachment.htm>

From james.r.carr at gmail.com  Tue Apr 17 22:32:31 2012
From: james.r.carr at gmail.com (James Carr)
Date: Tue, 17 Apr 2012 16:32:31 -0500
Subject: [rabbitmq-discuss] Pre-defining queue for federated exchanges?
Message-ID: <CAJreXKB08wM6Y+93Kregqrvk9hdGUZoiYW831D7hg-tJdeJoeQ@mail.gmail.com>

One of the things keeping me up at night lately is a worry that our
federation links will break, the broker will lose its queues someway and
we'll wind up with messages being published that just get dropped.

Is there a way we could define some kind of queue that is setup by default?
The only other thing I could think is to just define alternate-exchanges
for every exchange, slap a queue on it and set a consumer on it that simply
republishes when federated links are established.

Other ideas? The approach I came up with feels rough.


Thanks,
James
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120417/ee42be27/attachment.htm>

From pbell at syncsort.com  Tue Apr 17 23:14:44 2012
From: pbell at syncsort.com (Bell, Paul M.)
Date: Tue, 17 Apr 2012 18:14:44 -0400
Subject: [rabbitmq-discuss] Idle TCP Connections to Broker
In-Reply-To: <CABzX+qx1sW_t4mjNmNdDjx4rt1VtxfwTJL8Xo0+4-ty2=PBpSQ@mail.gmail.com>
References: <CABzX+qx1sW_t4mjNmNdDjx4rt1VtxfwTJL8Xo0+4-ty2=PBpSQ@mail.gmail.com>
Message-ID: <AF4AD4ADFB23054CB4C75F50FF8C40B73B4189D3D2@MAILCCR.us.syncsort.com>

Hi All,

I've heard a "rumor" that the broker will close TCP connections to consumers and producers if these connections are idle for some period of time.

Can someone confirm the truth of this? If it's true, is this imposed by Rabbit, or are we talking about an underlying TCP behavior?

At the same time, I heard tell of a way of connecting to the broker that allows you to specify a kind of "heartbeat" mode which keeps the connection active by periodically sending a heartbeat message to the broker. Is there such a connection option?

Thank you.

-Paul



ATTENTION: -----

The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other  confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control.

From gregrice at gmail.com  Wed Apr 18 00:20:09 2012
From: gregrice at gmail.com (Greg Rice)
Date: Tue, 17 Apr 2012 16:20:09 -0700
Subject: [rabbitmq-discuss] Durable queues not surviving broker restart
In-Reply-To: <CAFuUQDt-Y68-4MKY_9zX71S=VDrLk_avkmHOV5cH2RFq99WnfQ@mail.gmail.com>
References: <CAFuUQDt-Y68-4MKY_9zX71S=VDrLk_avkmHOV5cH2RFq99WnfQ@mail.gmail.com>
Message-ID: <CAFuUQDtpiqdrHiQoK4S16wkX85YG=pgtP8HrtSb0qmdBtaC9Fg@mail.gmail.com>

Hey guys,

After creating a durable queue with auto-delete set to "no" and
Durable set to "True" in the web interface, I run:

rabbitmqctl stop_app
rabbitmqctl start_app

The durable *exchanges* I've created are still there, but the durable
*queues* are not.

Any ideas? This also happens when I used Ruby libraries setting
durable to True and Auto-delete to false, or with Pika, or with:

rabbitmqadmin declare queue name=test auto_delete=false durable=true

Thanks,
Greg Rice

From brendan at soundcloud.com  Wed Apr 18 08:21:32 2012
From: brendan at soundcloud.com (Brendan Hay)
Date: Wed, 18 Apr 2012 09:21:32 +0200
Subject: [rabbitmq-discuss] Pre-defining queue for federated exchanges?
In-Reply-To: <CAJreXKB08wM6Y+93Kregqrvk9hdGUZoiYW831D7hg-tJdeJoeQ@mail.gmail.com>
References: <CAJreXKB08wM6Y+93Kregqrvk9hdGUZoiYW831D7hg-tJdeJoeQ@mail.gmail.com>
Message-ID: <CAHZsVQY_krswhdhyf9cMT2PGMuFb2KpT7dXsv20ZhvEu=FhNag@mail.gmail.com>

You may want to investigate whether shovel is a better fit in this
situation.

For example: run the shovel on the current upstream, predeclare the
queues/bindings in the shovel config so messages will pool, and then push
to your downstream, rather than using federation, or dedicated consumers
etc.

When the upstream restarts and auto-magically loses its queues, the shovel
plugin will redeclare the queue/bindings on boot, and whola! Your messages
will still be routed and pooled before being pushed downstream by the
shovel.

Just an idea.

- Brendan


On Tue, Apr 17, 2012 at 11:32 PM, James Carr <james.r.carr at gmail.com> wrote:

> One of the things keeping me up at night lately is a worry that our
> federation links will break, the broker will lose its queues someway and
> we'll wind up with messages being published that just get dropped.
>
> Is there a way we could define some kind of queue that is setup by
> default? The only other thing I could think is to just define
> alternate-exchanges for every exchange, slap a queue on it and set a
> consumer on it that simply republishes when federated links are
> established.
>
> Other ideas? The approach I came up with feels rough.
>
>
> Thanks,
> James
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120418/9be0075d/attachment.htm>

From matthias at rabbitmq.com  Wed Apr 18 09:14:26 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 18 Apr 2012 09:14:26 +0100
Subject: [rabbitmq-discuss] Pre-defining queue for federated exchanges?
In-Reply-To: <CAJreXKB08wM6Y+93Kregqrvk9hdGUZoiYW831D7hg-tJdeJoeQ@mail.gmail.com>
References: <CAJreXKB08wM6Y+93Kregqrvk9hdGUZoiYW831D7hg-tJdeJoeQ@mail.gmail.com>
Message-ID: <4F8E77E2.8050207@rabbitmq.com>

James,

On 17/04/12 22:32, James Carr wrote:
> One of the things keeping me up at night lately is a worry that our
> federation links will break, the broker will lose its queues someway and
> we'll wind up with messages being published that just get dropped.

Just to be clear, you are worried that the queues created by federation 
at the upstream will somehow disappear?

That would be a bug and as such is just as likely to happen as any other 
fault.

> Is there a way we could define some kind of queue that is setup by
> default? The only other thing I could think is to just define
> alternate-exchanges for every exchange, slap a queue on it and set a
> consumer on it that simply republishes when federated links are
> established.

Looks like you are re-inventing what the federation logic already 
provides, i.e. a means to buffer messages while the link is down.


Regards,

Matthias.

From brett.r.cameron at gmail.com  Wed Apr 18 09:22:12 2012
From: brett.r.cameron at gmail.com (Brett Cameron)
Date: Wed, 18 Apr 2012 20:22:12 +1200
Subject: [rabbitmq-discuss] Maximum Simultaneous Connections
In-Reply-To: <4F8D876A.3060407@rabbitmq.com>
References: <33701108.post@talk.nabble.com>
	<4F8D876A.3060407@rabbitmq.com>
Message-ID: <CALPqkiroCfZ3K1kVh5Pu4Rvgd+FqQGGWyts+zcSWdQuH3A8zSA@mail.gmail.com>

Lars,

Supporting Simon's comments - we're currently pushing ~35K connections (and
growing) and the only issue has been ensuring that enough file
descriptors/sockets are available. I'd also comment that this is arguably
more of an Erlang question than anything RabbitMQ-specific... Erlang will
quite happily make (efficient) use whatever the OS can make available.

Regards,
Brett

On Wed, Apr 18, 2012 at 3:08 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> There's no hard coded maximum in RabbitMQ. Typically you will need to
> raise the ulimit or you'll run out of file descriptors. Once you've done
> that, I don't see 10k connections as a huge deal - you'll need a reasonable
> amount of RAM but it should be very doable.
>
> Cheers, Simon
>
>
> On 17/04/12 12:43, Lars Ellebo wrote:
>
>> Hello there
>>
>> What is the maximum theoretical simultaneous connections on a Linux
>> RabbitMQ?
>>
>> I want to be able to handle 10.000 simultaneous connections on Linux
>> RabbitMQ with very little traffic on each connection.
>>
>> What amount of system resources are recommended to enable this on Linux
>> (CPU, RAM, DISK etc)?
>>
>> Are there any Resource Limit Parameters I need to adjust on Linux, Erlang
>> or
>> RabbitMQ in order to enable this number of simultaneous connections (like
>> ulimit etc)?
>>
>> /Lars
>>
>>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120418/3d9b62eb/attachment.htm>

From gonzalo.fernandez at stoneworksolutions.net  Tue Apr 17 16:23:33 2012
From: gonzalo.fernandez at stoneworksolutions.net (Gonzalo Fernandez)
Date: Tue, 17 Apr 2012 17:23:33 +0200
Subject: [rabbitmq-discuss] limits.conf not working...
In-Reply-To: <4F8D8889.1010106@rabbitmq.com>
References: <CAA3P-6RmU=wPM62u_AG=98crTiAjj=rzFy0T9oeeBrF+RrF0jQ@mail.gmail.com>
	<4F8D8889.1010106@rabbitmq.com>
Message-ID: <CAA3P-6Tfay56wQFHRRauqSVowjND75fZSJchUhLxA+HFgt32Cg@mail.gmail.com>

Things to check:

* Have you genuinely raised the limit for the rabbitmq user? (sounds like
you have)
Yes, both with the ulimit command and on the limits.conf file

* Is RabbitMQ actually running as the rabbitmq user?
Yes, here:

*patilla at test:~$ ps aux | grep rabbitmq-server*
patilla  22942  0.0  0.0   7640   948 pts/0    S+   17:19   0:00 grep
--color=auto rabbitmq-server
*rabbitmq *29109  0.0  0.0   4096   624 pts/0    S    15:56   0:00 */bin/sh
/usr/sbin/rabbitmq-server*

* Have you restarted the server? (since ulimit is only checked on "login".
I tried restarting rabbit server and rebooting the machine.
I get the value in limits.conf when I run ulimit -n but not on the
managemnet plugin site...

Any thoughts?

Thanks!

patilla.



2012/4/17 Simon MacMullen <simon at rabbitmq.com>

> On 17/04/12 16:05, Gonzalo Fernandez wrote:
>
>> I can't find the error..... Could it be the version?
>>
>
> No. RabbitMQ only ever *reports* on the FD limits it is seeing, it doesn't
> impose any more. And this code has not changed from 2.7.1 to 2.8.1.
>
> Things to check:
>
> * Have you genuinely raised the limit for the rabbitmq user? (sounds like
> you have)
>
> * Is RabbitMQ actually running as the rabbitmq user?
>
> * Have you restarted the server? (since ulimit is only checked on "login".
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120417/cf0dc893/attachment.htm>

From mark.geib.44 at gmail.com  Tue Apr 17 18:03:52 2012
From: mark.geib.44 at gmail.com (dukeFan)
Date: Tue, 17 Apr 2012 10:03:52 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq 2.4.1 failure
Message-ID: <0542e133-ddf6-4e12-b1ba-221ebf86dade@n22g2000yqb.googlegroups.com>

We recently had a rabbitmq broker fail and are unable to determine the
root cause. The broker is version 2.4.1, erlang is 14B02, running on
ubuntu 10.04 LTS.

SASL log snippet

=SUPERVISOR REPORT==== 11-Apr-2012::00:15:30 ===
     Supervisor: {<0.5419.34>,rabbit_channel_sup_sup}
     Context:    shutdown_error
     Reason:     shutdown
     Offender:   [{pid,<0.5731.34>},
                  {name,channel_sup},
                  {mfa,{rabbit_channel_sup,start_link,[]}},
                  {restart_type,temporary},
                  {shutdown,infinity},
                  {child_type,supervisor}]


=CRASH REPORT==== 11-Apr-2012::05:04:32 ===
  crasher:
    initial call: gen:init_it/7
    pid: <0.232.0>
    registered_name: msg_store_transient
    exception exit: {{badmatch,false},
                     [{rabbit_msg_store_ets_index,insert,2},
                      {rabbit_msg_store,write_message,3},
                      {rabbit_msg_store,handle_cast,2},
                      {gen_server2,handle_msg,2},
                      {proc_lib,wake_up,3}]}
      in function  gen_server2:terminate/3
    ancestors: [rabbit_sup,<0.147.0>]
    messages: [{'EXIT',<0.233.0>,normal}]
    links: [<0.148.0>]
    dictionary: [{fhc_age_tree,{0,nil}}]
    trap_exit: true
    status: running
    heap_size: 10946
    stack_size: 24
    reductions: 98380626
  neighbours:

RABBIMQ log snippet:

=INFO REPORT==== 11-Apr-2012::05:04:31 ===
closing TCP connection <0.10243.65> from 10.70.40.77:53173

=ERROR REPORT==== 11-Apr-2012::05:04:31 ===
** Generic server msg_store_transient terminating
** Last message in was {'$gen_cast',
                           {client_dying,
 
<<74,18,61,37,8,55,8,91,210,27,70,185,112,89,
                                 171,154>>}}
** When Server state == {msstate,
                         "/var/lib/rabbitmq/mnesia/rabbit at che-
csebrokerp1/msg_store_transient",
                         rabbit_msg_store_ets_index,
                         {state,417861,
                          "/var/lib/rabbitmq/mnesia/rabbit at che-
csebrokerp1/msg_store_transient"},
                         0,#Ref<0.0.0.875>,
                         {dict,0,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
[],[]},
                          {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
[],[]}}},
                         [],undefined,0,12073198,[],<0.233.0>,
421958,413764,
                         426055,
....skipping...
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
[],[]},
                          {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
[],[]}}},
                         undefined,undefined}
** Reason for termination ==
** {noproc,
       {gen_server2,call,
           [msg_store_transient,
            {client_terminate,
 
<<17,102,9,148,6,184,165,141,162,246,194,57,36,62,208,135>>},
            infinity]}}
** In 'terminate' callback with reason ==
** shutdown

=ERROR REPORT==== 11-Apr-2012::05:04:43 ===
** gen_event handler rabbit_error_logger crashed.
** Was installed in error_logger
** Last event was: {error,<0.146.0>,
                    {<0.9700.6>,
                     "** Generic server ~p terminating~n** Last
message in was ~p~n** When Server state == ~p~n** Reason for
termination == ~n** ~p~n** In 'terminate' callback with reason ==~n**
~p~n",
                     [<0.9700.6>,
                      {'EXIT',<0.241.0>,shutdown},
                      {q,
                       {amqqueue,
                        {resource,<<"/rssm">>,queue,
                         <<"cse.rssm.logManager.sqlserver">>},
...more...

After the failure we were not able to restart rabbitmq, it required a
system reboot. On the attempted restart we saw the message regarding
activating plugins, but hung and never completed. We don't have much
more information except the logs, which we are not able to fully
understand.

Thanks,
Mark.

From gregrice at gmail.com  Tue Apr 17 21:46:23 2012
From: gregrice at gmail.com (Greg Rice)
Date: Tue, 17 Apr 2012 13:46:23 -0700
Subject: [rabbitmq-discuss] Durable queues not surviving broker restart
Message-ID: <CAFuUQDt-Y68-4MKY_9zX71S=VDrLk_avkmHOV5cH2RFq99WnfQ@mail.gmail.com>

Hey guys,

After creating a durable queue with auto-delete set to "no" and
Durable set to "True" in the web interface, I run:

rabbitmqctl stop_app
rabbitmqctl start_app

The durable *exchanges* I've created are still there, but the durable
*queues* are not.

Any ideas? This also happens when I used Ruby libraries setting
durable to True and Auto-delete to false, or with Pika, or with:

rabbitmqadmin declare queue name=test auto_delete=false durable=true

Thanks,
Greg Rice

From matthew at rabbitmq.com  Wed Apr 18 10:45:35 2012
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 18 Apr 2012 10:45:35 +0100
Subject: [rabbitmq-discuss] rabbitmq 2.4.1 failure
In-Reply-To: <0542e133-ddf6-4e12-b1ba-221ebf86dade@n22g2000yqb.googlegroups.com>
References: <0542e133-ddf6-4e12-b1ba-221ebf86dade@n22g2000yqb.googlegroups.com>
Message-ID: <20120418094535.GA32242@rabbitmq.com>

On Tue, Apr 17, 2012 at 10:03:52AM -0700, dukeFan wrote:
>     registered_name: msg_store_transient
>     exception exit: {{badmatch,false},
>                      [{rabbit_msg_store_ets_index,insert,2},
>                       {rabbit_msg_store,write_message,3},

Hee hee, I remember this bug. It got fixed, eventually, after much
head-scratching. Please upgrade to the latest 2.8.1 which contains the
fix. 2.4.1 is somewhat ancient.

Matthew

From gonzalo.fernandez at stoneworksolutions.net  Wed Apr 18 10:56:36 2012
From: gonzalo.fernandez at stoneworksolutions.net (Gonzalo Fernandez)
Date: Wed, 18 Apr 2012 11:56:36 +0200
Subject: [rabbitmq-discuss] limits.conf not working...
In-Reply-To: <CAA3P-6Tfay56wQFHRRauqSVowjND75fZSJchUhLxA+HFgt32Cg@mail.gmail.com>
References: <CAA3P-6RmU=wPM62u_AG=98crTiAjj=rzFy0T9oeeBrF+RrF0jQ@mail.gmail.com>
	<4F8D8889.1010106@rabbitmq.com>
	<CAA3P-6Tfay56wQFHRRauqSVowjND75fZSJchUhLxA+HFgt32Cg@mail.gmail.com>
Message-ID: <CAA3P-6QZPzTOndCyXiWP=NWa3tRArJuiNRRqvkc_OS79mAsMjQ@mail.gmail.com>

Hello again,

I have been trying to figure out why the File Descriptor Limit is different
on the management plugin site than the ulimit -n output for the rabbitmq
user, which is the same as the value of the limits.conf file I've edited.


In another machine, same system different rabbit version (2.7.1 insteasd of
2.8.1) it worked perfectly.
Simon said that the version could not be the problem.

"No. RabbitMQ only ever *reports* on the FD limits it is seeing, it doesn't
impose any more. And this code has not changed from 2.7.1 to 2.8.1"
*
*
I can't scratch my head any longer...

Has anyone had this problem before? Any thoughts?

Thanks!


2012/4/17 Gonzalo Fernandez <gonzalo.fernandez at stoneworksolutions.net>

>
> Things to check:
>
> * Have you genuinely raised the limit for the rabbitmq user? (sounds like
> you have)
> Yes, both with the ulimit command and on the limits.conf file
>
> * Is RabbitMQ actually running as the rabbitmq user?
> Yes, here:
>
> *patilla at test:~$ ps aux | grep rabbitmq-server*
> patilla  22942  0.0  0.0   7640   948 pts/0    S+   17:19   0:00 grep
> --color=auto rabbitmq-server
> *rabbitmq *29109  0.0  0.0   4096   624 pts/0    S    15:56   0:00 */bin/sh
> /usr/sbin/rabbitmq-server*
>
> * Have you restarted the server? (since ulimit is only checked on "login".
>
> I tried restarting rabbit server and rebooting the machine.
> I get the value in limits.conf when I run ulimit -n but not on the
> managemnet plugin site...
>
> Any thoughts?
>
> Thanks!
>
> patilla.
>
>
>
> 2012/4/17 Simon MacMullen <simon at rabbitmq.com>
>
>> On 17/04/12 16:05, Gonzalo Fernandez wrote:
>>
>>> I can't find the error..... Could it be the version?
>>>
>>
>> No. RabbitMQ only ever *reports* on the FD limits it is seeing, it
>> doesn't impose any more. And this code has not changed from 2.7.1 to 2.8.1.
>>
>> Things to check:
>>
>> * Have you genuinely raised the limit for the rabbitmq user? (sounds like
>> you have)
>>
>> * Is RabbitMQ actually running as the rabbitmq user?
>>
>> * Have you restarted the server? (since ulimit is only checked on "login".
>>
>> Cheers, Simon
>>
>> --
>> Simon MacMullen
>> RabbitMQ, VMware
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120418/3f15d6a7/attachment.htm>

From emile at rabbitmq.com  Wed Apr 18 11:28:44 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 18 Apr 2012 11:28:44 +0100
Subject: [rabbitmq-discuss] Durable queues not surviving broker restart
In-Reply-To: <CAFuUQDtpiqdrHiQoK4S16wkX85YG=pgtP8HrtSb0qmdBtaC9Fg@mail.gmail.com>
References: <CAFuUQDt-Y68-4MKY_9zX71S=VDrLk_avkmHOV5cH2RFq99WnfQ@mail.gmail.com>
	<CAFuUQDtpiqdrHiQoK4S16wkX85YG=pgtP8HrtSb0qmdBtaC9Fg@mail.gmail.com>
Message-ID: <4F8E975C.5020406@rabbitmq.com>

Hi Greg,

On 18/04/12 00:20, Greg Rice wrote:
> The durable *exchanges* I've created are still there, but the durable
> *queues* are not.

I'm unable to reproduce what you are seeing. I assume the queues are not
being deleted by some background task? Is there anything of note in the
broker logfiles? Can you provide the output of "rabbitmqctl report"?


-Emile


From gmlexx at gmail.com  Wed Apr 18 12:09:33 2012
From: gmlexx at gmail.com (Alexey)
Date: Wed, 18 Apr 2012 04:09:33 -0700 (PDT)
Subject: [rabbitmq-discuss] .NET client. Bug in subscription Dispose?
Message-ID: <f292ca3c-8c3d-418d-ad13-1eed61367b3c@n5g2000vbf.googlegroups.com>

We'd created a rabbitmq client class wich has the following variables:

IModel Channel;
Subscription Subscription;

Channel and Subscription created as usual:

Channel = activeConnection.CreateModel();
Subscription = new Subscription(Channel, queueName, false);

This is our disconnect method:

public void Disconnect(){
	using(Channel)
	using(Subscription)
	{
		Subscription = null;
		Channel = null;
	}
	activeConnection = null;
}

usually it works fine, but rarely failed with the following exception

System.NullReferenceException:
   ? RabbitMQ.Client.Impl.ModelBase.BasicCancel(String consumerTag)
   ? RabbitMQ.Client.MessagePatterns.Subscription.Close()
   ?
RabbitMQ.Client.MessagePatterns.Subscription.System.IDisposable.Dispose()
   ? Diadoc.Protocols.RabbitMQ.RabbitClusterClient.Disconnect()


From alexis at rabbitmq.com  Wed Apr 18 12:16:08 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Wed, 18 Apr 2012 12:16:08 +0100
Subject: [rabbitmq-discuss] Binary plugin files for presence and udp
	exchanges
In-Reply-To: <CAM8fPiTi5g5AmKD7u_-SYkj7NuWmhdfcnHQfAododih-yd2Q8g@mail.gmail.com>
References: <CAM8fPiTi5g5AmKD7u_-SYkj7NuWmhdfcnHQfAododih-yd2Q8g@mail.gmail.com>
Message-ID: <CACOPnver9kVz6Ebd7prP5T_hb+XdVCSc-5-BsMkrM67hrQTuTA@mail.gmail.com>

Thank-you very much Tony :-)

On Wed, Apr 11, 2012 at 12:57 PM, Tony Garnock-Jones
<tonygarnockjones+rabbitmq at gmail.com> wrote:
> Hi all,
>
> Because a couple of people have been asking, I've made available a couple of
> .ez files for the presence-exchange and udp-exchange. They were built with
> Erlang R15B01 against today's tip-of-mercurial RabbitMQ sourcecode, so they
> may not be for everyone, but perhaps better than nothing:
>
> https://github.com/downloads/tonyg/presence-exchange/rabbit_presence_exchange-20120411.01.ez
> https://github.com/downloads/tonyg/udp-exchange/rabbit_udp_exchange-20120411.01.ez
>
> I can't promise to support these binaries, but if you do have any problems
> with them please email me or this list and I'll see what I can do.
>
> Regards,
> ? Tony
> --
> Tony Garnock-Jones
> tonygarnockjones at gmail.com
> http://homepages.kcbbs.gen.nz/tonyg/
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From alexis at rabbitmq.com  Wed Apr 18 12:42:53 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Wed, 18 Apr 2012 12:42:53 +0100
Subject: [rabbitmq-discuss] RFC - new exchange type idea
In-Reply-To: <708689AA-8883-4017-BE81-5A6905CFF602@gmail.com>
References: <CAMcAHLU241feUdYNsZg0stpQmJk+22qTU+ipu5m9cJMJ6ewGfw@mail.gmail.com>
	<708689AA-8883-4017-BE81-5A6905CFF602@gmail.com>
Message-ID: <CACOPnveOFxDC2OhQug5jGjFMeoKUgrUdNgGUy4zSJVdK-BVvLQ@mail.gmail.com>

I'm in favour of anything that makes it easier to get started.

I am continually surprised to hear things like "rabbit has queues but
not pubsub" as well as "rabbit is good for pubsub but not queues".
Not to forget "rabbit does not do persistence" as well as "rabbit is
best for persistence" and of course "rabbit uses mnesia for message
persistence" when it doesn't.  In addition all kinds of FUD gets slung
about.

The Redis community has been great at innovating from the bottom
upwards, to deliver simplicity.   This is immediately visible when you
look at the slew of MQ-alike layers that people have created.  These
tend to focus on the core functions of pubsub, queue, and sometimes
1-1 and/or RPC; while ignoring eg flow control, paging, and other
features.  Some layer a work queue system on top of Redis, like
Celery.  Resque is a good example of that.

Here are more examples:

http://thechangelog.com/post/6791886560/thoonk-py-persistent-and-fast-push-feeds-queues-and-jobs
("a project that takes a unified approach to feeds, jobs, and queues,
all with a Redis backend." and looks a lot like rabbit)

https://github.com/djhworld/redis-mq  ("I felt tools like the
excellent RabbitMQ were too complex for small projects like the ones I
tend to make.")

https://github.com/ServiceStack/ServiceStack/wiki/Messaging-and-redis
(WCF for hipsters)

http://restmq.com/ ("There are HTTP clients for pratically all
languages. That's all that it takes to use RestMQ within your
application. No special protocols or strategies, just dynamically
created queues.")

http://lumberjaph.net/perl/2010/04/14/presque-a-redis-tatsumaki-based-message-queue.html
("a small message queue service build on top of redis and Tatsumaki.
It?s heavily inspired by RestMQ and resque.")

http://flask.pocoo.org/snippets/73/ ("if you just want a very basic
queue functionality to get started")

https://github.com/josiahcarlson/rpqueue (priority queue)

All of these projects are motivated by ease of use and a simple API.
Let's make Rabbit easier to use.

alexis




On Wed, Apr 11, 2012 at 5:36 PM, Jason J. W. Williams
<jasonjwwilliams at gmail.com> wrote:
> I think this is a great idea. It makes it easier to on onboard those who initially need a simple message queue and end up using Redis. Whatever message queue tech people start with for their first quick and dirty needs they tend to stick with. So I think this is a great idea for getting folks converted to Rabbit early.
>
> Yes functionally anonymous queues function the same way, but conceptually they break the idea exchanges are where you publish messages since you supply the "empty" exchange.
>
> Whether its a new exchange type or a change to the library API for anonymous queues, I like the direction Alvaro's going for folks getting their feet wet.
>
> -J
>
> Sent via iPhone
>
> Is your email Premiere?
>
> On Apr 11, 2012, at 7:13, Alvaro Videla <videlalvaro at gmail.com> wrote:
>
>> Hi,
>>
>> I've been thinking on creating a new exchange type whose goal will be to simplify the ways messages are routed to queues.
>>
>> So now for example to publish a message to a queue I need to do something like:
>>
>> $ch->exchange_declare('foobar', 'direct');
>> $ch->queue_declare('foobar');
>> $ch->queue_bind('foobar', 'foobar');
>> $ch->basic_publish($msg, 'foobar');
>>
>> I want to be able to do this:
>>
>> $ch->exchange_declare('foobar', 'new-exchange-type');
>> $ch->basic_publish($msg, 'foobar');
>>
>> So that means that by declaring a "foobar" exchange with the new type I will bind a new queue to that exchange during exchange creation on the broker side.
>>
>> The queue will have similar durability properties as the exchange.
>>
>> The exchange won't accept binding requests, so 1 exchange of that type will only have 1 queue bound to it.
>>
>> The idea is also to not perform any query while searching for a queue where to route messages, so routing speed *should* be a bit faster than a normal direct exchange.
>>
>> The exchange should act basically as a direct exchange.
>>
>> Then as a user of RabbitMQ that just want to have a queue server for delayed jobs this is the most basic setup I think you can have.
>>
>> BTW, I know you can publish messages to the anon exchange by using the queue name as routing key, but this requires that particular knowledge of AMQP.
>>
>> What do you guys think?
>>
>> -Alvaro
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From emile at rabbitmq.com  Wed Apr 18 14:11:14 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 18 Apr 2012 14:11:14 +0100
Subject: [rabbitmq-discuss] .NET client. Bug in subscription Dispose?
In-Reply-To: <f292ca3c-8c3d-418d-ad13-1eed61367b3c@n5g2000vbf.googlegroups.com>
References: <f292ca3c-8c3d-418d-ad13-1eed61367b3c@n5g2000vbf.googlegroups.com>
Message-ID: <4F8EBD72.4030906@rabbitmq.com>

Hi,

On 18/04/12 12:09, Alexey wrote:
> usually it works fine, but rarely failed with the following exception

Disposing by assigning null creates a race condition between the channel
closing and the consumer unsubscribing. I suggest that you first
explicitly Close() or Dispose() the subscription and then the channel.

-Emile


From matthias at rabbitmq.com  Wed Apr 18 14:23:45 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 18 Apr 2012 14:23:45 +0100
Subject: [rabbitmq-discuss] limits.conf not working...
In-Reply-To: <CAA3P-6QZPzTOndCyXiWP=NWa3tRArJuiNRRqvkc_OS79mAsMjQ@mail.gmail.com>
References: <CAA3P-6RmU=wPM62u_AG=98crTiAjj=rzFy0T9oeeBrF+RrF0jQ@mail.gmail.com>	<4F8D8889.1010106@rabbitmq.com>	<CAA3P-6Tfay56wQFHRRauqSVowjND75fZSJchUhLxA+HFgt32Cg@mail.gmail.com>
	<CAA3P-6QZPzTOndCyXiWP=NWa3tRArJuiNRRqvkc_OS79mAsMjQ@mail.gmail.com>
Message-ID: <4F8EC061.8080009@rabbitmq.com>

On 18/04/12 10:56, Gonzalo Fernandez wrote:
> In another machine, same system different rabbit version (2.7.1 insteasd
> of 2.8.1) it worked perfectly.
> Simon said that the version could not be the problem.
>
> "No. RabbitMQ only ever *reports* on the FD limits it is seeing, it
> doesn't impose any more. And this code has not changed from 2.7.1 to 2.8.1"
> *
> *
> I can't scratch my head any longer...
>
> Has anyone had this problem before? Any thoughts?

There was a change between 2.7.1 and 2.8.0 that may have caused this. 
The startup scripts on debian-like systems now use 'start-stop-daemon' 
instead of 'su', which resolved the long outstanding problem of rabbit 
sometimes preventing the OS from shutting down. Needs investigating.

Matthias.

From francois.beausoleil at gmail.com  Wed Apr 18 15:03:23 2012
From: francois.beausoleil at gmail.com (=?utf-8?Q?Fran=C3=A7ois_Beausoleil?=)
Date: Wed, 18 Apr 2012 10:03:23 -0400
Subject: [rabbitmq-discuss] Publisher throttled way too early
In-Reply-To: <4F8BF628.2080805@rabbitmq.com>
References: <A2DEA1C2237B481A80D206950D41A0BB@gmail.com>
	<4F8BF628.2080805@rabbitmq.com>
Message-ID: <CF56E1A7CBD642528A1022574F2E7DFA@gmail.com>

Hello Simon!

Le lundi 16 avril 2012 ? 06:36, Simon MacMullen a ?crit :

>  
> So therefore I think that your system can really only handle that many  
> messages per second. Are they persistent, or are your queues big enough  
> that non-persistent messages page out? That sort of performance sounds  
> more like the sort of thing you would see when IO-bound.
>  

I'm a bit chicken, and I use durable queues and persistent messages, because I'm on a VM. With your other clarifications, and the fact I can barely sustain 300 transactions per second on a similar host on another VM using PostgreSQL, I suspect you are correct.

Since this is reloading historical data for reprocessing, I'll just skip the persistence for only those messages.
  
Thanks!
--
Fran?ois Beausoleil


From gregrice at gmail.com  Wed Apr 18 16:16:11 2012
From: gregrice at gmail.com (Greg Rice)
Date: Wed, 18 Apr 2012 08:16:11 -0700 (PDT)
Subject: [rabbitmq-discuss] Durable queues not surviving broker restart
In-Reply-To: <4F8E975C.5020406@rabbitmq.com>
References: <CAFuUQDt-Y68-4MKY_9zX71S=VDrLk_avkmHOV5cH2RFq99WnfQ@mail.gmail.com>
	<CAFuUQDtpiqdrHiQoK4S16wkX85YG=pgtP8HrtSb0qmdBtaC9Fg@mail.gmail.com>
	<4F8E975C.5020406@rabbitmq.com>
Message-ID: <33708537.post@talk.nabble.com>


Emile,

Nope, this is a super simple setup, with no tasks hanging around deleting
queues.

Here's rabbitmqctl report:

[{pid,12367},
 {running_applications,
     [{rabbitmq_management,"RabbitMQ Management Console","2.7.1"},
      {rabbitmq_management_agent,"RabbitMQ Management Agent","2.7.1"},
      {rabbit,"RabbitMQ","2.7.1"},
      {os_mon,"CPO  CXC 138 46","2.2.8"},
      {mnesia,"MNESIA  CXC 138 12","4.6"},
      {amqp_client,"RabbitMQ AMQP Client","2.7.1"},
      {sasl,"SASL  CXC 138 11","2.2"},
      {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.7.1"},
      {webmachine,"webmachine","1.7.0-rmq2.7.1-hg"},
      {mochiweb,"MochiMedia Web Server","1.3-rmq2.7.1-git"},
      {inets,"INETS  CXC 138 49","5.8"},
      {stdlib,"ERTS  CXC 138 10","1.18"},
      {kernel,"ERTS  CXC 138 10","2.15"}]},
 {os,{unix,linux}},
 {erlang_version,
     "Erlang R15B (erts-5.9) [source] [64-bit] [smp:4:4] [async-threads:30]
[hipe] [kernel-poll:true]\n"},
 {memory,
     [{total,104012472},
      {processes,12749519},
      {processes_used,12748683},
      {system,91262953},
      {atom,561761},
      {atom_used,544256},
      {binary,393528},
      {code,15189917},
      {ets,1107192}]},
 {vm_memory_high_watermark,0.39999999997623376},
 {vm_memory_limit,6732236390}]
...done.


There's nothing in the broker logs suggesting any errors. I'm going to try a
fresh install of RabbitMQ 2.8.1 on another server, but for now, this is
driving me a little bonkers.

Thanks,
Greg Rice



Emile Joubert-2 wrote:
> 
> Hi Greg,
> 
> On 18/04/12 00:20, Greg Rice wrote:
>> The durable *exchanges* I've created are still there, but the durable
>> *queues* are not.
> 
> I'm unable to reproduce what you are seeing. I assume the queues are not
> being deleted by some background task? Is there anything of note in the
> broker logfiles? Can you provide the output of "rabbitmqctl report"?
> 
> 
> -Emile
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
-- 
View this message in context: http://old.nabble.com/Durable-queues-not-surviving-broker-restart-tp33706664p33708537.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From gregrice at gmail.com  Wed Apr 18 16:17:39 2012
From: gregrice at gmail.com (Greg Rice)
Date: Wed, 18 Apr 2012 08:17:39 -0700
Subject: [rabbitmq-discuss] Durable queues not surviving broker restart
In-Reply-To: <4F8E975C.5020406@rabbitmq.com>
References: <CAFuUQDt-Y68-4MKY_9zX71S=VDrLk_avkmHOV5cH2RFq99WnfQ@mail.gmail.com>
	<CAFuUQDtpiqdrHiQoK4S16wkX85YG=pgtP8HrtSb0qmdBtaC9Fg@mail.gmail.com>
	<4F8E975C.5020406@rabbitmq.com>
Message-ID: <CAFuUQDt_QQyb=66+_1+ip4En=Fra_8BQM=O_kU-xvtKvgsh1PA@mail.gmail.com>

Emile,

Nope, this is a super simple setup, with no tasks hanging around
deleting queues.

Here's rabbitmqctl report:

[{pid,12367},
 {running_applications,
     [{rabbitmq_management,"RabbitMQ Management Console","2.7.1"},
      {rabbitmq_management_agent,"RabbitMQ Management Agent","2.7.1"},
      {rabbit,"RabbitMQ","2.7.1"},
      {os_mon,"CPO  CXC 138 46","2.2.8"},
      {mnesia,"MNESIA  CXC 138 12","4.6"},
      {amqp_client,"RabbitMQ AMQP Client","2.7.1"},
      {sasl,"SASL  CXC 138 11","2.2"},
      {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.7.1"},
      {webmachine,"webmachine","1.7.0-rmq2.7.1-hg"},
      {mochiweb,"MochiMedia Web Server","1.3-rmq2.7.1-git"},
      {inets,"INETS  CXC 138 49","5.8"},
      {stdlib,"ERTS  CXC 138 10","1.18"},
      {kernel,"ERTS  CXC 138 10","2.15"}]},
 {os,{unix,linux}},
 {erlang_version,
     "Erlang R15B (erts-5.9) [source] [64-bit] [smp:4:4]
[async-threads:30] [hipe] [kernel-poll:true]\n"},
 {memory,
     [{total,104012472},
      {processes,12749519},
      {processes_used,12748683},
      {system,91262953},
      {atom,561761},
      {atom_used,544256},
      {binary,393528},
      {code,15189917},
      {ets,1107192}]},
 {vm_memory_high_watermark,0.39999999997623376},
 {vm_memory_limit,6732236390}]
...done.


There's nothing in the broker logs suggesting any errors. I'm going to
try a fresh install of RabbitMQ 2.8.1 on another server, but for now,
this is driving me a little bonkers.

Thanks,
Greg Rice


On Wed, Apr 18, 2012 at 3:28 AM, Emile Joubert <emile at rabbitmq.com> wrote:
> Hi Greg,
>
> On 18/04/12 00:20, Greg Rice wrote:
>> The durable *exchanges* I've created are still there, but the durable
>> *queues* are not.
>
> I'm unable to reproduce what you are seeing. I assume the queues are not
> being deleted by some background task? Is there anything of note in the
> broker logfiles? Can you provide the output of "rabbitmqctl report"?
>
>
> -Emile
>

From steve at rabbitmq.com  Wed Apr 18 16:55:50 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Wed, 18 Apr 2012 16:55:50 +0100
Subject: [rabbitmq-discuss] Problems with umbrella make files
In-Reply-To: <EA2623065081418FA792767BF6809013@gmail.com>
References: <EA2623065081418FA792767BF6809013@gmail.com>
Message-ID: <D38F9882-4E77-41B7-AE23-24A0BD4D6B26@rabbitmq.com>

Hi Alvaro,

I can reproduce this behaviour. It seems like making the rabbitmq-server
includes making the plugins, which somehow tries to re-make the server
-- and I (eventually) recurse off the forking stack.

Making the release beforehand probably stops the recursion starting.

This probably started when we decided to ship all the plugins with the
server -- so we build them as part of the rabbitmq-server build now. But
I'm slightly surprised that no-one has complained about this already.

In development we build rabbitmq-server from our development umbrella
repo, which INCLUDES the public-umbrella repo, so the plugins are built
after the server is already done (I think). So we don't see this,
normally.

I'm going to see if I can find out where the recursion happens and see
why it does.

Steve Powell  (a happy bunny)
----------yet more definitions from the SPD----------
chinchilla (n.) Cooling device for the lower jaw.
socialcast (n.) Someone to whom everyone is speaking but nobody likes.
literacy (n.) A textually transmitted disease usually contracted in childhood.
ebola (n.) A Yorkshire cricketer.

On 15 Apr 2012, at 20:48, Alvaro Videla wrote:

> Hi,
> 
> I'm trying to run the "make plugins" target from rabbitmq-server Makefile (obtained from the umbrella repo)
> 
> If I run the target like this it fails:
> 
> make plugins PLUGINS_SRC_DIR="`pwd`/.." VERSION=2.8.1u
> 
> Since I start to get the same output again and again. See this gist: https://gist.github.com/2394475
> 
> Unless I ran before the following target from the rabbitmq-public-umbrella Makefile:
> 
> make release VERSION=2.8.1u
> 
> I understand that the "plugins" target will call that one, so I'm puzzled here.
> 
> I also tried adding the following target in the rabbitmq-server/Makefile
> 
> mydebug:                                                                                                                                                                                                    
>         $(MAKE) -C "$(PLUGINS_SRC_DIR)" clean
> 
> Running it like: 
> 
> make mydebug PLUGINS_SRC_DIR=..
> 
> also fails with the same output as in the previous gist.
> 
> Any ideas on what might be wrong? Am I missing something?
> 
> Regards,
> 
> Alvaro
> 
> -- 
> Alvaro Videla
> Sent with Sparrow
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From videlalvaro at gmail.com  Wed Apr 18 16:59:26 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 18 Apr 2012 17:59:26 +0200
Subject: [rabbitmq-discuss] Problems with umbrella make files
In-Reply-To: <D38F9882-4E77-41B7-AE23-24A0BD4D6B26@rabbitmq.com>
References: <EA2623065081418FA792767BF6809013@gmail.com>
	<D38F9882-4E77-41B7-AE23-24A0BD4D6B26@rabbitmq.com>
Message-ID: <D51F49FC47DE429B9540CB62B4674968@gmail.com>

Hi Steve, 

Thanks for looking into this.

Cheers,

Alvaro 

-- 
Sent with Sparrow (http://www.sparrowmailapp.com/?sig)


On Wednesday, April 18, 2012 at 5:55 PM, Steve Powell wrote:

> Hi Alvaro,
> 
> I can reproduce this behaviour. It seems like making the rabbitmq-server
> includes making the plugins, which somehow tries to re-make the server
> -- and I (eventually) recurse off the forking stack.
> 
> Making the release beforehand probably stops the recursion starting.
> 
> This probably started when we decided to ship all the plugins with the
> server -- so we build them as part of the rabbitmq-server build now. But
> I'm slightly surprised that no-one has complained about this already.
> 
> In development we build rabbitmq-server from our development umbrella
> repo, which INCLUDES the public-umbrella repo, so the plugins are built
> after the server is already done (I think). So we don't see this,
> normally.
> 
> I'm going to see if I can find out where the recursion happens and see
> why it does.
> 
> Steve Powell (a happy bunny)
> ----------yet more definitions from the SPD----------
> chinchilla (n.) Cooling device for the lower jaw.
> socialcast (n.) Someone to whom everyone is speaking but nobody likes.
> literacy (n.) A textually transmitted disease usually contracted in childhood.
> ebola (n.) A Yorkshire cricketer.
> 
> On 15 Apr 2012, at 20:48, Alvaro Videla wrote:
> 
> > Hi,
> > 
> > I'm trying to run the "make plugins" target from rabbitmq-server Makefile (obtained from the umbrella repo)
> > 
> > If I run the target like this it fails:
> > 
> > make plugins PLUGINS_SRC_DIR="`pwd`/.." VERSION=2.8.1u
> > 
> > Since I start to get the same output again and again. See this gist: https://gist.github.com/2394475
> > 
> > Unless I ran before the following target from the rabbitmq-public-umbrella Makefile:
> > 
> > make release VERSION=2.8.1u
> > 
> > I understand that the "plugins" target will call that one, so I'm puzzled here.
> > 
> > I also tried adding the following target in the rabbitmq-server/Makefile
> > 
> > mydebug: 
> > $(MAKE) -C "$(PLUGINS_SRC_DIR)" clean
> > 
> > Running it like: 
> > 
> > make mydebug PLUGINS_SRC_DIR=..
> > 
> > also fails with the same output as in the previous gist.
> > 
> > Any ideas on what might be wrong? Am I missing something?
> > 
> > Regards,
> > 
> > Alvaro
> > 
> > -- 
> > Alvaro Videla
> > Sent with Sparrow
> > 
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > 
> 
> 
> 


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120418/eb8bbb22/attachment.htm>

From jaaaelpumuki at gmail.com  Wed Apr 18 19:38:30 2012
From: jaaaelpumuki at gmail.com (=?ISO-8859-1?Q?F=E9lix?=)
Date: Wed, 18 Apr 2012 11:38:30 -0700 (PDT)
Subject: [rabbitmq-discuss] Bookmark to purge all the queues in a vhost
Message-ID: <ed393fbe-fc4c-49ac-abb9-24b9af70d4e4@n5g2000vbf.googlegroups.com>

Hi,

I've done a bookmark (very small code) that purge all queues, I think
it can be useful for someone. (It's working on chrome, but it
shouldn't be difficult to port to other browsers)

So when you are in the management site (http://www.rabbitmq.com/
management.html) you can purge all the queues with one click.

https://gist.github.com/2172067



Best, F?lix

From mark.geib.44 at gmail.com  Wed Apr 18 21:12:22 2012
From: mark.geib.44 at gmail.com (Mark Geib)
Date: Wed, 18 Apr 2012 13:12:22 -0700 (PDT)
Subject: [rabbitmq-discuss] 2.4.1 broker failure/crash
Message-ID: <26652355.2332.1334779942949.JavaMail.geo-discussion-forums@ynaz34>

We are running rabbitmq 2.4.1 in production and recently had a failure that 
we can not determine the root cause. Also we tried a restart of the broker 
and the restart hung, never returned. We rebooted the machine to restore 
the broker.

We have only the rabbitmq and sasl logs at this point, but the error 
messages don't mean much to us.

rabbitmq log snippet:

=INFO REPORT==== 11-Apr-2012::05:04:08 ===
starting TCP connection <0.28490.65> from 172.17.208.67:1522

=INFO REPORT==== 11-Apr-2012::05:04:08 ===
closing TCP connection <0.9195.65> from 10.70.20.75:62045

=INFO REPORT==== 11-Apr-2012::05:04:31 ===
closing TCP connection <0.10243.65> from 10.70.40.77:53173

=ERROR REPORT==== 11-Apr-2012::05:04:31 ===
** Generic server msg_store_transient terminating
** Last message in was {'$gen_cast',
                           {client_dying,
                               <<74,18,61,37,8,55,8,91,210,27,70,185,112,89,
                                 171,154>>}}
** When Server state == {msstate,
                        
 "/var/lib/rabbitmq/mnesia/rabbit at che-csebrokerp1/msg_store_transient",
                         rabbit_msg_store_ets_index,
                         {state,417861,
                          
"/var/lib/rabbitmq/mnesia/rabbit at che-csebrokerp1/msg_store_transient"},
                         0,#Ref<0.0.0.875>,
                         {dict,0,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                          
{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                         [],undefined,0,12073198,[],<0.233.0>,421958,413764,
                         426055,
                         {set,0,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                          
{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
...skipping...
                         {dict,0,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                          {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                            []}}}}
** Reason for termination == 
** {{badmatch,false},
    [{rabbit_msg_store_ets_index,insert,2},
     {rabbit_msg_store,write_message,3},
     {rabbit_msg_store,handle_cast,2},
     {gen_server2,handle_msg,2},
     {proc_lib,wake_up,3}]}
...skipping...
=INFO REPORT==== 11-Apr-2012::05:04:43 ===
closing TCP connection <0.5032.4496> from 172.16.216.217:60234

=INFO REPORT==== 11-Apr-2012::05:04:43 ===
closing TCP connection <0.8419.6115> from 10.65.10.72:54580

=ERROR REPORT==== 11-Apr-2012::05:04:43 ===
** Generic server <0.31907.9> terminating
** Last message in was {'EXIT',<0.241.0>,shutdown}
** When Server state == {q,
                         {amqqueue,
                          {resource,<<"/alarming">>,queue,<<"alarming.9">>},
                          false,false,none,[],<0.31907.9>},
                         none,true,rabbit_variable_queue,
                         {vqstate,
                          {[],[]},
                          {0,{[],[]}},
                          {delta,undefined,0,undefined},
...skipping...
                         {state,fine,undefined},
                         {dict,0,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                          
{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                         undefined,undefined}
** Reason for termination == 
** {noproc,
       {gen_server2,call,
           [msg_store_transient,
            {client_terminate,
                
<<17,102,9,148,6,184,165,141,162,246,194,57,36,62,208,135>>},
            infinity]}}
** In 'terminate' callback with reason ==
** shutdown

=ERROR REPORT==== 11-Apr-2012::05:04:43 ===
** gen_event handler rabbit_error_logger crashed.
** Was installed in error_logger
** Last event was: {error,<0.146.0>,
                    {<0.9700.6>,
                     "** Generic server ~p terminating~n** Last message in 
was ~p~n** When Server state == ~p~n** Reason for termination == ~n** 
~p~n** In 'terminate' callback with reason ==~n** ~p~n",
                     [<0.9700.6>,
                      {'EXIT',<0.241.0>,shutdown},
                      {q,
                       {amqqueue,
                        {resource,<<"/rssm">>,queue,
                         <<"cse.rssm.logManager.sqlserver">>},
                        false,false,none,[],<0.9700.6>},
                       none,true,rabbit_variable_queue,
                       {vqstate,
                        {[],[]},
                        {0,{[],[]}},
                        {delta,undefined,0,undefined},
                        {0,{[],[]}},
...skipping...
                      {noproc,
                       {gen_server2,call,
                        [msg_store_transient,
                         {client_terminate,
                          <<143,174,238,76,144,209,125,211,110,123,56,1,237,
                            217,136,2>>},
                         infinity]}},
                      shutdown]}}
** When handler state == {resource,<<"/">>,exchange,<<"amq.rabbitmq.log">>}
** Reason == {badarg,[{ets,lookup,[rabbit_registry,{exchange,topic}]},
                      {rabbit_registry,lookup_module,2},
                      {rabbit_exchange,type_to_module,1},
                      {rabbit_exchange,route,2},
                      {rabbit_exchange,publish,2},
                      {rabbit_basic,publish,1},
                      {rabbit_error_logger,publish1,4},
                      {rabbit_error_logger,handle_event,2}]}

=INFO REPORT==== 11-Apr-2012::05:04:43 ===
    application: rabbit
    exited: shutdown
    type: permanent


sasl log snippet:
=SUPERVISOR REPORT==== 11-Apr-2012::00:15:30 ===
     Supervisor: {<0.5419.34>,rabbit_channel_sup_sup}
     Context:    shutdown_error
     Reason:     shutdown
     Offender:   [{pid,<0.5731.34>},
                  {name,channel_sup},
                  {mfa,{rabbit_channel_sup,start_link,[]}},
                  {restart_type,temporary},
                  {shutdown,infinity},
                  {child_type,supervisor}]


=CRASH REPORT==== 11-Apr-2012::05:04:32 ===
  crasher:
    initial call: gen:init_it/7
    pid: <0.232.0>
    registered_name: msg_store_transient
    exception exit: {{badmatch,false},
                     [{rabbit_msg_store_ets_index,insert,2},
                      {rabbit_msg_store,write_message,3},
                      {rabbit_msg_store,handle_cast,2},
                      {gen_server2,handle_msg,2},
                      {proc_lib,wake_up,3}]}
      in function  gen_server2:terminate/3
    ancestors: [rabbit_sup,<0.147.0>]
    messages: [{'EXIT',<0.233.0>,normal}]
    links: [<0.148.0>]
    dictionary: [{fhc_age_tree,{0,nil}}]
    trap_exit: true
    status: running
    heap_size: 10946
    stack_size: 24
    reductions: 98380626
  neighbours:
=SUPERVISOR REPORT==== 11-Apr-2012::05:04:32 ===
     Supervisor: {local,rabbit_sup}
     Context:    child_terminated
     Reason:     {{badmatch,false},
                  [{rabbit_msg_store_ets_index,insert,2},
                   {rabbit_msg_store,write_message,3},
                   {rabbit_msg_store,handle_cast,2},
                   {gen_server2,handle_msg,2},
                   {proc_lib,wake_up,3}]}
     Offender:   [{pid,<0.232.0>},
                  {name,msg_store_transient},
                  {mfargs,
                      {rabbit_msg_store,start_link,
                          [msg_store_transient,
                          
 "/var/lib/rabbitmq/mnesia/rabbit at che-csebrokerp1",
                           undefined,
                           {#Fun<rabbit_variable_queue.0.66952436>,ok}]}},
                  {restart_type,transient},
                  {shutdown,4294967295},
                  {child_type,worker}]


=SUPERVISOR REPORT==== 11-Apr-2012::05:04:32 ===
     Supervisor: {local,rabbit_sup}
     Context:    shutdown
     Reason:     reached_max_restart_intensity
     Offender:   [{pid,<0.232.0>},
                  {name,msg_store_transient},
                  {mfargs,
                      {rabbit_msg_store,start_link,
                          [msg_store_transient,
                          
 "/var/lib/rabbitmq/mnesia/rabbit at che-csebrokerp1",
                           undefined,
                           {#Fun<rabbit_variable_queue.0.66952436>,ok}]}},
                  {restart_type,transient},
                  {shutdown,4294967295},
                  {child_type,worker}]
...skipping...
=CRASH REPORT==== 11-Apr-2012::05:04:43 ===
  crasher:
    initial call: gen:init_it/6
    pid: <0.31907.9>
    registered_name: []
    exception exit: {noproc,
                        {gen_server2,call,
                            [msg_store_transient,
                             {client_terminate,
                                
 <<213,104,174,241,176,121,164,159,98,43,221,
                                   160,120,109,6,107>>},
                             infinity]}}
      in function  gen_server2:terminate/3
    ancestors: [rabbit_amqqueue_sup,rabbit_sup,<0.147.0>]
    messages: []
    links: []
    dictionary: [{guid,{{9,<0.31907.9>},0}}]
    trap_exit: true
    status: running
    heap_size: 987
    stack_size: 24
    reductions: 443158598
  neighbours:

=SUPERVISOR REPORT==== 11-Apr-2012::05:04:43 ===
     Supervisor: {local,rabbit_amqqueue_sup}
     Context:    shutdown_error
     Reason:     {noproc,
                     {gen_server2,call,
                         [msg_store_transient,
                          {client_terminate,
                              
<<213,104,174,241,176,121,164,159,98,43,221,160,
                                120,109,6,107>>},
                          infinity]}}
     Offender:   [{pid,<0.31907.9>},
                  {name,rabbit_amqqueue},
                  {mfa,{rabbit_amqqueue_process,start_link,[]}},
                  {restart_type,temporary},
                  {shutdown,4294967295},
                  {child_type,worker}]

Any help determining the cause would be appreciated.

Mark.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120418/c471ea9b/attachment.htm>

From matthew at rabbitmq.com  Wed Apr 18 22:02:20 2012
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 18 Apr 2012 22:02:20 +0100
Subject: [rabbitmq-discuss] 2.4.1 broker failure/crash
In-Reply-To: <26652355.2332.1334779942949.JavaMail.geo-discussion-forums@ynaz34>
References: <26652355.2332.1334779942949.JavaMail.geo-discussion-forums@ynaz34>
Message-ID: <20120418210220.GB30018@wellquite.org>

Hi Mark,

Did you not see my reply from this morning?

This was a known bug that has since been fixed. 2.4.1 is rather old now,
and the easiest thing to do is upgrade to the current which is 2.8.1.

Best wishes,

Matthew

From abdullahsaima at yahoo.com  Wed Apr 18 22:05:34 2012
From: abdullahsaima at yahoo.com (Saima Asif)
Date: Wed, 18 Apr 2012 22:05:34 +0100 (BST)
Subject: [rabbitmq-discuss] what are message attributes used by broker
	in RABBITMQ
In-Reply-To: <4F8D40DE.60709@rabbitmq.com>
References: <1334145243.23896.YahooMailNeo@web29703.mail.ird.yahoo.com>
	<4F8577F3.3060604@rabbitmq.com>
	<1334147886.33780.YahooMailNeo@web29704.mail.ird.yahoo.com>
	<4F85804C.70009@rabbitmq.com>
	<1334574888.94533.YahooMailNeo@web29704.mail.ird.yahoo.com>
	<4F8C024E.8040901@rabbitmq.com>
	<1334576533.63729.YahooMailNeo@web29703.mail.ird.yahoo.com>
	<4F8D40DE.60709@rabbitmq.com>
Message-ID: <1334783134.40914.YahooMailNeo@web29701.mail.ird.yahoo.com>

Dear Emile,

Yes you are right I am trying to get a general estimate about the latency based on all message properties that a broker consider on the way of processing it. I am actually want to compare different protocols but on very simpler basis. I want to implement the basic outlines they follow. I hope you would be understanding what I need to do.
Your help in this case is highly appreciated.
?
Saima Asif


________________________________
 From: Emile Joubert <emile at rabbitmq.com>
To: Saima Asif <abdullahsaima at yahoo.com> 
Cc: "rabbitmq-discuss at lists.rabbitmq.com" <rabbitmq-discuss at lists.rabbitmq.com> 
Sent: Tuesday, 17 April 2012, 11:07
Subject: Re: [rabbitmq-discuss] what are message attributes used by broker in RABBITMQ
 
Hi,

On 16/04/12 12:42, Saima Asif wrote:
> yes you are right, that what I want to do.

Actually I'm struggling to understand what you are trying to do. It
looks like you are trying to predict latency based on message
properties. To do this with meaningful accuracy is a highly ambitious
and non-trivial undertaking.

Can you explain in a bit more detail what you are trying to accomplish?


-Emile
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120418/c6ddd933/attachment.htm>

From john at disqus.com  Wed Apr 18 22:55:25 2012
From: john at disqus.com (John Watson)
Date: Wed, 18 Apr 2012 14:55:25 -0700 (PDT)
Subject: [rabbitmq-discuss] Ubuntu/Debian limits in 2.8.x
Message-ID: <341a7c9d-de8f-41f3-9c6e-13fd814182cf@ri8g2000pbc.googlegroups.com>

With the transition to start-stop-daemon, RabbitMQ isn't started with
pam integration. Instead, the init script should source /etc/default/
rabbitmq-server so we can set ulimit there

--- /etc/init.d/rabbitmq-server.old	2012-04-18 21:54:05.852307662
+0000
+++ /etc/init.d/rabbitmq-server	2012-04-18 21:49:17.594182809 +0000
@@ -35,6 +35,8 @@
 RETVAL=0
 set -e

+[ -r /etc/default/${NAME} ] && . /etc/default/${NAME}
+
 ensure_pid_dir () {
     PID_DIR=`dirname ${PID_FILE}`
     if [ ! -d ${PID_DIR} ] ; then


From videlalvaro at gmail.com  Thu Apr 19 00:00:28 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Thu, 19 Apr 2012 01:00:28 +0200
Subject: [rabbitmq-discuss] what are message attributes used by broker
 in RABBITMQ
In-Reply-To: <1334783134.40914.YahooMailNeo@web29701.mail.ird.yahoo.com>
References: <1334145243.23896.YahooMailNeo@web29703.mail.ird.yahoo.com>
	<4F8577F3.3060604@rabbitmq.com>
	<1334147886.33780.YahooMailNeo@web29704.mail.ird.yahoo.com>
	<4F85804C.70009@rabbitmq.com>
	<1334574888.94533.YahooMailNeo@web29704.mail.ird.yahoo.com>
	<4F8C024E.8040901@rabbitmq.com>
	<1334576533.63729.YahooMailNeo@web29703.mail.ird.yahoo.com>
	<4F8D40DE.60709@rabbitmq.com>
	<1334783134.40914.YahooMailNeo@web29701.mail.ird.yahoo.com>
Message-ID: <8BEB144703554365A67EF08A08DD0CEA@gmail.com>

Hi Saima, 

I think what you are trying to do is really hard. RabbitMQ is implemented in Erlang, which means that almost everything on the broker side is an Erlang process. So to really calculate latency out of theory is really hard there since you will need to understand how the Erlang scheduler. For example the channel is a process, the queue is another process, the tcp reader is another one, and so on. So understanding latency from the "paper" is not so easy.

In the routing part, an exchange depending on the type will take into account the message routing key and try to fetch the queues that match the binding rule. Then it will deliver the message to those queues. So there you need to understand how Mnesia queries work in order to see the different performance of each exchange. We have some of this process detailed in Chapter 11 of RabbitMQ in Action.

I hope you see the point. I think is better to perform real benchmakrs, see for example the latest blogposts on the RabbitMQ Blog: http://www.rabbitmq.com/blog/2012/04/17/rabbitmq-performance-measurements-part-1/

Regards,

Alvaro 

-- 
Sent with Sparrow (http://www.sparrowmailapp.com/?sig)


On Wednesday, April 18, 2012 at 11:05 PM, Saima Asif wrote:

> Dear Emile,
> 
> Yes you are right I am trying to get a general estimate about the latency based on all message properties that a broker consider on the way of processing it. I am actually want to compare different protocols but on very simpler basis. I want to implement the basic outlines they follow. I hope you would be understanding what I need to do.
> Your help in this case is highly appreciated.
>  
> Saima Asif
> From: Emile Joubert <emile at rabbitmq.com (mailto:emile at rabbitmq.com)>
> To: Saima Asif <abdullahsaima at yahoo.com (mailto:abdullahsaima at yahoo.com)> 
> Cc: "rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)" <rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)> 
> Sent: Tuesday, 17 April 2012, 11:07
> Subject: Re: [rabbitmq-discuss] what are message attributes used by broker in RABBITMQ
> 
> Hi,
> 
> On 16/04/12 12:42, Saima Asif wrote:
> > yes you are right, that what I want to do.
> 
> Actually I'm struggling to understand what you are trying to do. It
> looks like you are trying to predict latency based on message
> properties. To do this with meaningful accuracy is a highly ambitious
> and non-trivial undertaking.
> 
> Can you explain in a bit more detail what you are trying to accomplish?
> 
> 
> -Emile
> 
> 
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120419/8abca710/attachment.htm>

From james.r.carr at gmail.com  Thu Apr 19 06:24:53 2012
From: james.r.carr at gmail.com (James Carr)
Date: Thu, 19 Apr 2012 00:24:53 -0500
Subject: [rabbitmq-discuss] Pre-defining queue for federated exchanges?
In-Reply-To: <4F8E77E2.8050207@rabbitmq.com>
References: <CAJreXKB08wM6Y+93Kregqrvk9hdGUZoiYW831D7hg-tJdeJoeQ@mail.gmail.com>
	<4F8E77E2.8050207@rabbitmq.com>
Message-ID: <CAJreXKDYD1AOVaLoxXcUwPt1CwwHHn8t0QyL5b=mzxiGD56vug@mail.gmail.com>

Hi Matthias,

Actually, the problem I'm trying to guard against isn't rabbitMQ's fault
but rather external mishaps.

Basically, a misconfigured puppet setup wiped out and re-installed rabbitMQ
on one of our upstream brokers. With the username the downsteam used to
connect gone as well as all the exchanges and queues, the publisher
connected and started publishing to an exchange that simply dropped the
messages since there were no bindings.

After thinking it over though, I've been thinking that the solution to this
situation is simply to have puppet create required users as part of the
RabbitMQ setup so the downstream can always be guaranteed to connect.

That and don't allow misconfigured puppet setups to randomly run like that.
:)

Thanks,
James


On Wed, Apr 18, 2012 at 3:14 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> James,
>
>
> On 17/04/12 22:32, James Carr wrote:
>
>> One of the things keeping me up at night lately is a worry that our
>> federation links will break, the broker will lose its queues someway and
>> we'll wind up with messages being published that just get dropped.
>>
>
> Just to be clear, you are worried that the queues created by federation at
> the upstream will somehow disappear?
>
> That would be a bug and as such is just as likely to happen as any other
> fault.
>
>
>  Is there a way we could define some kind of queue that is setup by
>> default? The only other thing I could think is to just define
>> alternate-exchanges for every exchange, slap a queue on it and set a
>> consumer on it that simply republishes when federated links are
>> established.
>>
>
> Looks like you are re-inventing what the federation logic already
> provides, i.e. a means to buffer messages while the link is down.
>
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120419/4ab34cee/attachment.htm>

From matthias at rabbitmq.com  Thu Apr 19 06:32:33 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 19 Apr 2012 06:32:33 +0100
Subject: [rabbitmq-discuss] Ubuntu/Debian limits in 2.8.x
In-Reply-To: <341a7c9d-de8f-41f3-9c6e-13fd814182cf@ri8g2000pbc.googlegroups.com>
References: <341a7c9d-de8f-41f3-9c6e-13fd814182cf@ri8g2000pbc.googlegroups.com>
Message-ID: <4F8FA371.3080707@rabbitmq.com>

John,

On 18/04/12 22:55, John Watson wrote:
> With the transition to start-stop-daemon, RabbitMQ isn't started with
> pam integration.

Right. See http://old.nabble.com/limits.conf-not-working...-td33702428.html

  Instead, the init script should source /etc/default/
> rabbitmq-server so we can set ulimit there

Is there really no way to let the limits.conf limits take effect? I 
cannot think of a reason why that ever would be the wrong thing to do. 
Having a way to override that limit is convenient, but the default 
surely should be the limit configured for the user. Seems to me that 
start-stop-daemon is introducing gratuitous complexity here.

Regards,

Matthias.

From ka.fukui at ms.scsk.jp  Thu Apr 19 06:41:59 2012
From: ka.fukui at ms.scsk.jp (Katsushi Fukui)
Date: Thu, 19 Apr 2012 14:41:59 +0900
Subject: [rabbitmq-discuss] Mirrored queue failover
In-Reply-To: <4F8D31EF.4050709@ms.scsk.jp>
References: <4F7D5C28.8000202@ms.scsk.jp> <20120405112633.GA17466@rabbitmq.com>
	<4F7E5B59.4060005@ms.scsk.jp> <4F855310.1050407@ms.scsk.jp>
	<20120416131639.GB14212@wellquite.org> <4F8D31EF.4050709@ms.scsk.jp>
Message-ID: <4F8FA5A7.3060502@ms.scsk.jp>

Hi Matthew,

I found an interesting behavior and logs when I repeatedly restarted a node of the cluster.
I rebuilt a new cluster and checked a logs of the mirrored queue again. Now the master of the mirrored queue is rabbit1, the slaves are rabbit2 and rabbit3. When rabbit3 is stopped, the logs of the rabbit1 shows:
=INFO REPORT==== 19-Apr-2012::11:18:58 ===
Mirrored-queue (queue 'que1' in vhost '/'): Master <rabbit at rabbit1.2.594.0> saw deaths of mirrors <rabbit at rabbit3.3.229.0>

=INFO REPORT==== 19-Apr-2012::11:18:59 ===
rabbit on node rabbit at rabbit3 down


This means that que1 detected death of the queue slave on rabbit3 and node is down. But if I repeat restarting the slaves over and over, sometime logs shows like this:
=INFO REPORT==== 19-Apr-2012::11:56:26 ===
Mirrored-queue (queue 'que1' in vhost '/'): Master <rabbit at rabbit1.2.594.0> saw deaths of mirrors <rabbit at rabbit3.3.229.0>

=INFO REPORT==== 19-Apr-2012::11:56:26 ===
rabbit on node rabbit at rabbit3 down

=INFO REPORT==== 19-Apr-2012::11:56:35 ===
rabbit on node rabbit at rabbit3 up

=INFO REPORT==== 19-Apr-2012::11:56:38 ===
rabbit on node rabbit at rabbit2 down

=INFO REPORT==== 19-Apr-2012::11:59:32 ===
rabbit on node rabbit at rabbit2 up


Despite stopping rabbit2, que1 doesn't report death of mirror. Now rabbit2 is up, but que1 has only one slave on rabbit3.?Next, I stopped rabbit3 and the logs shows:
=INFO REPORT==== 19-Apr-2012::12:00:04 ===
Mirrored-queue (queue 'que1' in vhost '/'): Master <rabbit at rabbit1.2.594.0> saw deaths of mirrors <rabbit at rabbit2.3.229.0> <rabbit at rabbit3.1.227.0>

=INFO REPORT==== 19-Apr-2012::12:00:04 ===
rabbit on node rabbit at rabbit3 down

Que1 detected deaths of two slaves. Finally I restarted rabbit2 and rabbit3, so que1 got two slaves.
It looks there is a case a mirrored queue can not detect the failure of the slaves.

Kats


> Thank you, Matthew,
>
> I created an exchange "ex1" that is bound to que1, and published a message using a publisher was connected to rabbit3 as you suggested.
> I could send it without returning error, but the logs of rabbit3 shows this error:
> =ERROR REPORT==== 17-Apr-2012::11:12:30 ===
> Discarding message {'$gen_cast',{deliver,{delivery,false,false,<0.3061.0>,{basic_message,{resource,<<1 byte>>,exchange,<<3 bytes>>},[<<5 bytes>>],{content,60,{'P_basic',<<10 bytes>>,undefined,undefined,2,0,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined},<<15 bytes>>,rabbit_framing_amqp_0_9_1,[<<12 bytes>>]},<<16 bytes>>,true},undefined},flow}} from <0.3061.0> to <0.229.0> in an old incarnation (3) of this node (2)
>
> The result of list_queues is:
> # ./rabbitmqctl list_queues name messages slave_pids synchronised_slave_pids
> Listing queues ...
> que1 1 [<rabbit at rabbit2.1.229.0>] [<rabbit at rabbit2.1.229.0>]
> ...done.
>
> I wonder if this problem is only occurred in my environment.
>
>
>
> (2012/04/16 22:16), Matthew Sackman wrote:
>> Hi,
>>
>> I'm afraid I really don't know what to suggest. It looks like somehow
>> Erlang is not properly noticing rabbit3 coming back up, and getting
>> itself very confused. I don't know why this would be.
>>
>> You say you're already using 2.8.1 and R15B, so I can't really just
>> suggest upgrading. Perhaps one further thing to test is when rabbit3
>> comes back up, connect a publisher to it (specifically rabbit3 rather
>> than any other node) and try to publish to an exchange routing to the
>> problematic queue. I'd be curious to know whether those messages
>> actually end up in the queue or not.
>>
>> For some reason, whilst rabbit3 seems to know about 1 and 2, 1 and 2 are
>> a long way from convinced they know about 3. Something is very unhappy
>> in the cluster, and I've really no idea why.
>>
>> Matthew
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From john at disqus.com  Thu Apr 19 08:02:32 2012
From: john at disqus.com (John Watson)
Date: Thu, 19 Apr 2012 00:02:32 -0700
Subject: [rabbitmq-discuss] Ubuntu/Debian limits in 2.8.x
In-Reply-To: <4F8FA371.3080707@rabbitmq.com>
References: <341a7c9d-de8f-41f3-9c6e-13fd814182cf@ri8g2000pbc.googlegroups.com>
	<4F8FA371.3080707@rabbitmq.com>
Message-ID: <CA+qt5VN7NnXkPq9t9a5Uy2gGxa9Q8rRPa6SVaG+pCokFi32DOw@mail.gmail.com>

Hi Matthias,

limits.conf only takes effect when pam_limits module is run; as described
by the small hurdle with Ubuntu in the linked thread.

start-stop-daemon (at least the version a part of dpkg) only uses setuid(2)
to change the uid of the process

http://dpkg.sourcearchive.com/documentation/1.15.5.6ubuntu2/start-stop-daemon_8c-source.html

(Unfortunately no line numbers, but it's the 2nd to last if clause at the
bottom of the file)

I agree, it is ambiguous and limits should be set in one place for sanity
and security.

I found there's modified version by Scot Dial <scot at scottdial.com> in
Gentoo that supports PAM, but I suspect it would take far longer to get
Debian to adopt the changes.

Best,

John

On Wed, Apr 18, 2012 at 10:32 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> John,
>
> On 18/04/12 22:55, John Watson wrote:
>
>> With the transition to start-stop-daemon, RabbitMQ isn't started with
>> pam integration.
>>
>
> Right. See http://old.nabble.com/limits.**conf-not-working...-**
> td33702428.html<http://old.nabble.com/limits.conf-not-working...-td33702428.html>
>
>  Instead, the init script should source /etc/default/
>
>> rabbitmq-server so we can set ulimit there
>>
>
> Is there really no way to let the limits.conf limits take effect? I cannot
> think of a reason why that ever would be the wrong thing to do. Having a
> way to override that limit is convenient, but the default surely should be
> the limit configured for the user. Seems to me that start-stop-daemon is
> introducing gratuitous complexity here.
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120419/767a344f/attachment.htm>

From gonzalo.fernandez at stoneworksolutions.net  Thu Apr 19 09:59:13 2012
From: gonzalo.fernandez at stoneworksolutions.net (Gonzalo Fernandez)
Date: Thu, 19 Apr 2012 10:59:13 +0200
Subject: [rabbitmq-discuss] limits.conf not working...
In-Reply-To: <4F8EC061.8080009@rabbitmq.com>
References: <CAA3P-6RmU=wPM62u_AG=98crTiAjj=rzFy0T9oeeBrF+RrF0jQ@mail.gmail.com>
	<4F8D8889.1010106@rabbitmq.com>
	<CAA3P-6Tfay56wQFHRRauqSVowjND75fZSJchUhLxA+HFgt32Cg@mail.gmail.com>
	<CAA3P-6QZPzTOndCyXiWP=NWa3tRArJuiNRRqvkc_OS79mAsMjQ@mail.gmail.com>
	<4F8EC061.8080009@rabbitmq.com>
Message-ID: <CAA3P-6SaZ6+XHthitN_9YLWy41bP1ay4PCSyCPk8NXxr=Kp3eg@mail.gmail.com>

Thanks Matt,

now I know.

Anyway, trying, based on this new information you guys gave me, I figured
out that having* /etc/security/limits.conf*
with:

*rabbitmq  soft  nofile 10000*
*rabbitmq  hard  nofile 65000*
*root  soft  nofile 10000*
*root  hard  nofile 65000*

Editing */etc/pam.d/common-session{,-noninteractive}* adding:
*session required pam_limits.so*

And editing the */etc/init.d/rabbit-server* file making root the user to
execute the script (*START_PROG="start-stop-daemon -v --chuid root --start
--exec"*) I got to see the rabbitmq limit.conf value on  the management
site, which I couldn't see before.....

I know it is rough... *I do not recommend doing this *but it is just to
check that limits.conf works.

I installed everything from zero, again. On a brand new machine. And it
works.... Now it works.... without doing anything strange.
I modify the limits.conf file and I see it on the management plugin site.
It is incredible... I still don't know what is wrong on the other machine,
but it works on this new one.

Cheers.


G.


2012/4/18 Matthias Radestock <matthias at rabbitmq.com>

> On 18/04/12 10:56, Gonzalo Fernandez wrote:
>
>> In another machine, same system different rabbit version (2.7.1 insteasd
>> of 2.8.1) it worked perfectly.
>> Simon said that the version could not be the problem.
>>
>> "No. RabbitMQ only ever *reports* on the FD limits it is seeing, it
>> doesn't impose any more. And this code has not changed from 2.7.1 to
>> 2.8.1"
>> *
>> *
>>
>> I can't scratch my head any longer...
>>
>> Has anyone had this problem before? Any thoughts?
>>
>
> There was a change between 2.7.1 and 2.8.0 that may have caused this. The
> startup scripts on debian-like systems now use 'start-stop-daemon' instead
> of 'su', which resolved the long outstanding problem of rabbit sometimes
> preventing the OS from shutting down. Needs investigating.
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120419/075b7b19/attachment.htm>

From zhouxc0 at gmail.com  Thu Apr 19 07:30:35 2012
From: zhouxc0 at gmail.com (Hard get up)
Date: Wed, 18 Apr 2012 23:30:35 -0700 (PDT)
Subject: [rabbitmq-discuss] Install RabbitMQ In CentOs6.2
Message-ID: <1e4b6246-d962-45fa-b4f9-3995065c3181@s10g2000pbc.googlegroups.com>

Hi,
     I got a error when install rabbitmq in centos6.2(64bit):
           Error description:
          {could_not_start_tcp_listener,{"192.168.65.235",5672}}
     or
         Error description:
          {could_not_start_tcp_listener,{"::: ",5672}}

 I don't konw if the centos6.2 is not a supported platforms ?
 Thank you.

From emile at rabbitmq.com  Thu Apr 19 10:38:09 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 19 Apr 2012 10:38:09 +0100
Subject: [rabbitmq-discuss] Install RabbitMQ In CentOs6.2
In-Reply-To: <1e4b6246-d962-45fa-b4f9-3995065c3181@s10g2000pbc.googlegroups.com>
References: <1e4b6246-d962-45fa-b4f9-3995065c3181@s10g2000pbc.googlegroups.com>
Message-ID: <4F8FDD01.3040101@rabbitmq.com>

Hi,

On 19/04/12 07:30, Hard get up wrote:
>      I got a error when install rabbitmq in centos6.2(64bit):
>            Error description:
>           {could_not_start_tcp_listener,{"192.168.65.235",5672}}
>      or
>          Error description:
>           {could_not_start_tcp_listener,{"::: ",5672}}
> 
>  I don't konw if the centos6.2 is not a supported platforms ?

CentOS is certainly a supported platform.

This problem appears network-related. Is this part of a longer
stacktrace? If so can you provide the complete error, including
everything the appears on the console and the broker logfile.

Can you also provide the complete /etc/rabbitmq/rabbitmq.config file?

Do you get the same error if you configure the broker to listen on
localhost / 127.0.0.1?

Can other applications bind to port 5672?
Does "netcat -l 192.168.65.235 5672" produce an error?

Is the rabbitmq account (or the account running the broker) subject to
any unusual restrictions?



-Emile




From simon at rabbitmq.com  Thu Apr 19 10:46:31 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 19 Apr 2012 10:46:31 +0100
Subject: [rabbitmq-discuss] Install RabbitMQ In CentOs6.2
In-Reply-To: <1e4b6246-d962-45fa-b4f9-3995065c3181@s10g2000pbc.googlegroups.com>
References: <1e4b6246-d962-45fa-b4f9-3995065c3181@s10g2000pbc.googlegroups.com>
Message-ID: <4F8FDEF7.7070106@rabbitmq.com>

On 19/04/12 07:30, Hard get up wrote:
>           Error description:
>            {could_not_start_tcp_listener,{"::: ",5672}}

Probably something else is binding to that port - maybe qpid?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Apr 19 10:44:17 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 19 Apr 2012 10:44:17 +0100
Subject: [rabbitmq-discuss] what are message attributes used by broker
 in RABBITMQ
In-Reply-To: <1334783134.40914.YahooMailNeo@web29701.mail.ird.yahoo.com>
References: <1334145243.23896.YahooMailNeo@web29703.mail.ird.yahoo.com>	<4F8577F3.3060604@rabbitmq.com>	<1334147886.33780.YahooMailNeo@web29704.mail.ird.yahoo.com>	<4F85804C.70009@rabbitmq.com>	<1334574888.94533.YahooMailNeo@web29704.mail.ird.yahoo.com>	<4F8C024E.8040901@rabbitmq.com>	<1334576533.63729.YahooMailNeo@web29703.mail.ird.yahoo.com>	<4F8D40DE.60709@rabbitmq.com>
	<1334783134.40914.YahooMailNeo@web29701.mail.ird.yahoo.com>
Message-ID: <4F8FDE71.9070405@rabbitmq.com>

On 18/04/12 22:05, Saima Asif wrote:
> I am trying to get a general estimate about the latency based on all
> message properties

This is very unlikely to work. Message properties don't have very much 
to do with it.

In practice *by far* the biggest impact on latency is message rate - 
when the broker is near to its maximum message rate, latency heads for 
the sky. See the last chart at:

http://www.rabbitmq.com/blog/2012/04/17/rabbitmq-performance-measurements-part-1/

I would argue that RabbitMQ, like most software, is too complex a system 
to *model* with anything other than itself. If you want to find out how 
it will perform in a given context, take measurements.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From rui.favas at barclays.com  Thu Apr 19 10:50:22 2012
From: rui.favas at barclays.com (rui.favas at barclays.com)
Date: Thu, 19 Apr 2012 10:50:22 +0100
Subject: [rabbitmq-discuss] VIP configuration
Message-ID: <1308E5CFD51CA14DA7B024A689B8B168025139A38C@LDNPCMMGMB01.INTRANET.BARCAPINT.COM>

What's the best way to configure a VIP to point to a Cluster of two RabbitMQ brokers with mirrored queues?

All clients currently connect using a VIP which monitors both brokers by monitoring the rabbitmq port. This causes the following errors on the rabbitMQ logs:-

=INFO REPORT==== 19-Apr-2012::10:31:19 ===
accepting AMQP connection <0.31581.1> (...:42047 -> ...:5672)

=WARNING REPORT==== 19-Apr-2012::10:31:19 ===
closing AMQP connection <0.31581.1> (...:42047 -> ...:5672):
connection_closed_abruptly

=INFO REPORT==== 19-Apr-2012::10:31:19 ===
accepting AMQP connection <0.31591.1> (...:35008 -> ...:5672)

=WARNING REPORT==== 19-Apr-2012::10:31:19 ===
closing AMQP connection <0.31591.1> (...:35008 -> ...:5672):
connection_closed_abruptly

=INFO REPORT==== 19-Apr-2012::10:31:22 ===
accepting AMQP connection <0.31619.1> (...:55908 -> ...:5672)

=WARNING REPORT==== 19-Apr-2012::10:31:22 ===
closing AMQP connection <0.31619.1> (...:55908 -> ...:5672):
connection_closed_abruptly

=INFO REPORT==== 19-Apr-2012::10:31:22 ===
accepting AMQP connection <0.31624.1> (...:54412 -> ...:5672)

=WARNING REPORT==== 19-Apr-2012::10:31:22 ===
closing AMQP connection <0.31624.1> (...:54412 -> ...:5672):
connection_closed_abruptly

=INFO REPORT==== 19-Apr-2012::10:31:24 ===
accepting AMQP connection <0.31638.1> (...:42234 -> ...:5672)

=WARNING REPORT==== 19-Apr-2012::10:31:24 ===
closing AMQP connection <0.31638.1> (...:42234 -> ...:5672):
connection_closed_abruptly








Rui Favas
Head of Services and Digital Media Technology
Barclays Investment Management Technology
* ID: +44 (0)20 777 30866
* Mobile: +44 (0) 7825023964
* GD: 8773 0866
* rui.favas at barclays.com<mailto:rui.favas at barclayscapital.com>
5 The North Colonnade
Canary Wharf
London
E14 4BB

For urgent issues email: BCFS<mailto:xraGSCoperationsmana at barclayscapital.com> Services Dev or visit our website: http://confluence.barcapint.com/display/ISS/BCFS+Services


_______________________________________________
Barclays is one of the world's leading banks, and we believe that by continuing to integrate the organisation we can better deliver the full power of Barclays to customers, clients and the communities in which we work. 
As a visible sign of that integration we are moving to a single Barclays brand for the majority of our divisions, including those formerly known as Barclays Capital, Barclays Wealth and Barclays Corporate.

_______________________________________________

This e-mail may contain information that is confidential, privileged or otherwise protected from 
disclosure. If you are not an intended recipient of this e-mail, do not duplicate or redistribute 
it by any means. Please delete it and any attachments and notify the sender that you have received 
it in error. Unless specifically indicated, this e-mail is not an offer to buy or sell or a 
solicitation to buy or sell any securities, investment products or other financial product or 
service, an official confirmation of any transaction, or an official statement of Barclays. Any 
views or opinions presented are solely those of the author and do not necessarily represent those 
of Barclays. This e-mail is subject to terms available at the following link: www.barcap.com/emaildisclaimer. 
By messaging with Barclays you consent to the foregoing.  Barclays offers premier investment banking 
products and services to its clients through Barclays Bank PLC, a company registered in England 
(number 1026167) with its registered office at 1 Churchill Place, London, E14 5HP.  This email may 
relate to or be sent from other members of the Barclays Group.

_______________________________________________
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120419/5a88f0ce/attachment.htm>

From emanuele.aliberti at fitb.eu  Thu Apr 19 10:51:08 2012
From: emanuele.aliberti at fitb.eu (Emanuele Aliberti)
Date: Thu, 19 Apr 2012 11:51:08 +0200
Subject: [rabbitmq-discuss] Install RabbitMQ In CentOs6.2
In-Reply-To: <4F8FDD01.3040101@rabbitmq.com>
References: <1e4b6246-d962-45fa-b4f9-3995065c3181@s10g2000pbc.googlegroups.com>
	<4F8FDD01.3040101@rabbitmq.com>
Message-ID: <4F8FE00C.9080107@fitb.it>

CentOS 6.2 should come with Apache Qpid installed.

On 19/04/2012 11:38, Emile Joubert wrote:
> Hi,
>
> On 19/04/12 07:30, Hard get up wrote:
>>       I got a error when install rabbitmq in centos6.2(64bit):
>>             Error description:
>>            {could_not_start_tcp_listener,{"192.168.65.235",5672}}
>>       or
>>           Error description:
>>            {could_not_start_tcp_listener,{"::: ",5672}}
>>
>>   I don't konw if the centos6.2 is not a supported platforms ?
> CentOS is certainly a supported platform.
>
> This problem appears network-related. Is this part of a longer
> stacktrace? If so can you provide the complete error, including
> everything the appears on the console and the broker logfile.
>
> Can you also provide the complete /etc/rabbitmq/rabbitmq.config file?
>
> Do you get the same error if you configure the broker to listen on
> localhost / 127.0.0.1?
>
> Can other applications bind to port 5672?
> Does "netcat -l 192.168.65.235 5672" produce an error?
>
> Is the rabbitmq account (or the account running the broker) subject to
> any unusual restrictions?
>
>
>
> -Emile
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
*Emanuele Aliberti*
Fill in The Blanks S.r.l.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120419/d26499c1/attachment.htm>

From simon at rabbitmq.com  Thu Apr 19 12:07:08 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 19 Apr 2012 12:07:08 +0100
Subject: [rabbitmq-discuss] limits.conf not working...
In-Reply-To: <CAA3P-6SaZ6+XHthitN_9YLWy41bP1ay4PCSyCPk8NXxr=Kp3eg@mail.gmail.com>
References: <CAA3P-6RmU=wPM62u_AG=98crTiAjj=rzFy0T9oeeBrF+RrF0jQ@mail.gmail.com>
	<4F8D8889.1010106@rabbitmq.com>
	<CAA3P-6Tfay56wQFHRRauqSVowjND75fZSJchUhLxA+HFgt32Cg@mail.gmail.com>
	<CAA3P-6QZPzTOndCyXiWP=NWa3tRArJuiNRRqvkc_OS79mAsMjQ@mail.gmail.com>
	<4F8EC061.8080009@rabbitmq.com>
	<CAA3P-6SaZ6+XHthitN_9YLWy41bP1ay4PCSyCPk8NXxr=Kp3eg@mail.gmail.com>
Message-ID: <4F8FF1DC.5040802@rabbitmq.com>

Hi Gonzalo.

So I think maybe some of these steps are not necessary. I was able to 
modify the ulimit with the 2.8.1 deb just by adding lines for *root* in 
/etc/security/limits.conf. In particular, it was not necessary to make 
RabbitMQ run as root by modifying the START_PROG= line.

So this is still not a great solution; we'll have a fix in the next 
release. But it's less ugly.

Cheers, Simon

On 19/04/12 09:59, Gonzalo Fernandez wrote:
>
> Thanks Matt,
>
> now I know.
>
> Anyway, trying, based on this new information you guys gave me, I
> figured out that having*/etc/security/limits.conf*
> with:
>
> *rabbitmq  soft  nofile 10000*
> *rabbitmq  hard  nofile 65000*
> *root  soft  nofile 10000*
> *root  hard  nofile 65000*
>
> Editing */etc/pam.d/common-session{,-noninteractive}* adding:
> *session required pam_limits.so*
>
> And editing the */etc/init.d/rabbit-server* file making root the user to
> execute the script (*START_PROG="start-stop-daemon -v --chuid root
> --start --exec"*) I got to see the rabbitmq limit.conf value on  the
> management site, which I couldn't see before.....
>
> I know it is rough... *I do not recommend doing this *but it is just to
> check that limits.conf works.
>
> I installed everything from zero, again. On a brand new machine. And it
> works.... Now it works.... without doing anything strange.
> I modify the limits.conf file and I see it on the management plugin
> site. It is incredible... I still don't know what is wrong on the other
> machine, but it works on this new one.
>
> Cheers.
>
>
> G.
>
>
> 2012/4/18 Matthias Radestock <matthias at rabbitmq.com
> <mailto:matthias at rabbitmq.com>>
>
>     On 18/04/12 10:56, Gonzalo Fernandez wrote:
>
>         In another machine, same system different rabbit version (2.7.1
>         insteasd
>         of 2.8.1) it worked perfectly.
>         Simon said that the version could not be the problem.
>
>         "No. RabbitMQ only ever *reports* on the FD limits it is seeing, it
>         doesn't impose any more. And this code has not changed from
>         2.7.1 to 2.8.1"
>         *
>         *
>
>         I can't scratch my head any longer...
>
>         Has anyone had this problem before? Any thoughts?
>
>
>     There was a change between 2.7.1 and 2.8.0 that may have caused
>     this. The startup scripts on debian-like systems now use
>     'start-stop-daemon' instead of 'su', which resolved the long
>     outstanding problem of rabbit sometimes preventing the OS from
>     shutting down. Needs investigating.
>
>     Matthias.
>
>


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Apr 19 12:10:00 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 19 Apr 2012 12:10:00 +0100
Subject: [rabbitmq-discuss] VIP configuration
In-Reply-To: <1308E5CFD51CA14DA7B024A689B8B168025139A38C@LDNPCMMGMB01.INTRANET.BARCAPINT.COM>
References: <1308E5CFD51CA14DA7B024A689B8B168025139A38C@LDNPCMMGMB01.INTRANET.BARCAPINT.COM>
Message-ID: <4F8FF288.8000807@rabbitmq.com>

Depends how your VIP can monitor things. Either live with these warnings 
(they're irritating but ultimately harmless), use the HTTP 
aliveness-test in the management plugin, or get a VIP that understands 
AMQP ;-)

Cheers, Simon

On 19/04/12 10:50, rui.favas at barclays.com wrote:
> What?s the best way to configure a VIP to point to a Cluster of two
> RabbitMQ brokers with mirrored queues?
>
> All clients currently connect using a VIP which monitors both brokers by
> monitoring the rabbitmq port. This causes the following errors on the
> rabbitMQ logs:-
>
> =INFO REPORT==== 19-Apr-2012::10:31:19 ===
>
> accepting AMQP connection <0.31581.1> (?:42047 -> ?:5672)
>
> =WARNING REPORT==== 19-Apr-2012::10:31:19 ===
>
> closing AMQP connection <0.31581.1> (?:42047 -> ?:5672):
>
> connection_closed_abruptly
>
> =INFO REPORT==== 19-Apr-2012::10:31:19 ===
>
> accepting AMQP connection <0.31591.1> (?:35008 -> ?:5672)
>
> =WARNING REPORT==== 19-Apr-2012::10:31:19 ===
>
> closing AMQP connection <0.31591.1> (?:35008 -> ?:5672):
>
> connection_closed_abruptly
>
> =INFO REPORT==== 19-Apr-2012::10:31:22 ===
>
> accepting AMQP connection <0.31619.1> (?:55908 -> ?:5672)
>
> =WARNING REPORT==== 19-Apr-2012::10:31:22 ===
>
> closing AMQP connection <0.31619.1> (?:55908 -> ?:5672):
>
> connection_closed_abruptly
>
> =INFO REPORT==== 19-Apr-2012::10:31:22 ===
>
> accepting AMQP connection <0.31624.1> (?:54412 -> ?:5672)
>
> =WARNING REPORT==== 19-Apr-2012::10:31:22 ===
>
> closing AMQP connection <0.31624.1> (?:54412 -> ?:5672):
>
> connection_closed_abruptly
>
> =INFO REPORT==== 19-Apr-2012::10:31:24 ===
>
> accepting AMQP connection <0.31638.1> (?:42234 -> ?:5672)
>
> =WARNING REPORT==== 19-Apr-2012::10:31:24 ===
>
> closing AMQP connection <0.31638.1> (?:42234 -> ?:5672):
>
> connection_closed_abruptly
>
> Rui Favas
>
> */Head of Services and Digital Media Technology/**//*
>
> */Barclays Investment Management Technology/*
>
> (ID: +44 (0)20 777 30866
>
> (Mobile: +44 (0) 7825023964
>
> (GD: 8773 0866
>
> *rui.favas at barclays.com <mailto:rui.favas at barclayscapital.com>
>
> 5 The North Colonnade
>
> Canary Wharf
>
> London
>
> E14 4BB
>
> For urgent issues email: _BCFS
> <mailto:xraGSCoperationsmana at barclayscapital.com> Services Dev_or visit
> our website: http://confluence.barcapint.com/display/ISS/BCFS+Services
>
> _______________________________________________
>
> Barclays is one of the world's leading banks, and we believe that by
> continuing to integrate the organisation we can better deliver the full
> power of Barclays to customers, clients and the communities in which we
> work.
>
> As a visible sign of that integration we are moving to a single Barclays
> brand for the majority of our divisions, including those formerly known
> as Barclays Capital, Barclays Wealth and Barclays Corporate.
>
> _______________________________________________
>
> This e-mail may contain information that is confidential, privileged or
> otherwise protected from disclosure. If you are not an intended
> recipient of this e-mail, do not duplicate or redistribute it by any
> means. Please delete it and any attachments and notify the sender that
> you have received it in error. Unless specifically indicated, this
> e-mail is not an offer to buy or sell or a solicitation to buy or sell
> any securities, investment products or other financial product or
> service, an official confirmation of any transaction, or an official
> statement of Barclays. Any views or opinions presented are solely those
> of the author and do not necessarily represent those of Barclays. This
> e-mail is subject to terms available at the following link:
> www.barcap.com/emaildisclaimer
> <http://www.barclays.com/emaildisclaimer>. By messaging with Barclays
> you consent to the foregoing.Barclays offers premier investment banking
> products and services to its clients throughBarclays Bank PLC, a company
> registered in England (number 1026167) with its registered office at 1
> Churchill Place, London, E14 5HP.This email may relate to or be sent
> from other members of the Barclays Group.//
>
> _______________________________________________
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From rui.favas at barclays.com  Thu Apr 19 12:25:12 2012
From: rui.favas at barclays.com (rui.favas at barclays.com)
Date: Thu, 19 Apr 2012 12:25:12 +0100
Subject: [rabbitmq-discuss] VIP configuration
In-Reply-To: <4F8FF288.8000807@rabbitmq.com>
References: <1308E5CFD51CA14DA7B024A689B8B168025139A38C@LDNPCMMGMB01.INTRANET.BARCAPINT.COM>
	<4F8FF288.8000807@rabbitmq.com>
Message-ID: <1308E5CFD51CA14DA7B024A689B8B168025139A392@LDNPCMMGMB01.INTRANET.BARCAPINT.COM>

The HTTP aliveness-test sounds like a better solution! What url should the VIP hit? 

-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: Thursday, April 19, 2012 12:10 PM
To: Favas, Rui: Barclays Capital (LDN)
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] VIP configuration

Depends how your VIP can monitor things. Either live with these warnings 
(they're irritating but ultimately harmless), use the HTTP 
aliveness-test in the management plugin, or get a VIP that understands 
AMQP ;-)

Cheers, Simon

On 19/04/12 10:50, rui.favas at barclays.com wrote:
> What's the best way to configure a VIP to point to a Cluster of two
> RabbitMQ brokers with mirrored queues?
>
> All clients currently connect using a VIP which monitors both brokers by
> monitoring the rabbitmq port. This causes the following errors on the
> rabbitMQ logs:-
>
> =INFO REPORT==== 19-Apr-2012::10:31:19 ===
>
> accepting AMQP connection <0.31581.1> (...:42047 -> ...:5672)
>
> =WARNING REPORT==== 19-Apr-2012::10:31:19 ===
>
> closing AMQP connection <0.31581.1> (...:42047 -> ...:5672):
>
> connection_closed_abruptly
>
> =INFO REPORT==== 19-Apr-2012::10:31:19 ===
>
> accepting AMQP connection <0.31591.1> (...:35008 -> ...:5672)
>
> =WARNING REPORT==== 19-Apr-2012::10:31:19 ===
>
> closing AMQP connection <0.31591.1> (...:35008 -> ...:5672):
>
> connection_closed_abruptly
>
> =INFO REPORT==== 19-Apr-2012::10:31:22 ===
>
> accepting AMQP connection <0.31619.1> (...:55908 -> ...:5672)
>
> =WARNING REPORT==== 19-Apr-2012::10:31:22 ===
>
> closing AMQP connection <0.31619.1> (...:55908 -> ...:5672):
>
> connection_closed_abruptly
>
> =INFO REPORT==== 19-Apr-2012::10:31:22 ===
>
> accepting AMQP connection <0.31624.1> (...:54412 -> ...:5672)
>
> =WARNING REPORT==== 19-Apr-2012::10:31:22 ===
>
> closing AMQP connection <0.31624.1> (...:54412 -> ...:5672):
>
> connection_closed_abruptly
>
> =INFO REPORT==== 19-Apr-2012::10:31:24 ===
>
> accepting AMQP connection <0.31638.1> (...:42234 -> ...:5672)
>
> =WARNING REPORT==== 19-Apr-2012::10:31:24 ===
>
> closing AMQP connection <0.31638.1> (...:42234 -> ...:5672):
>
> connection_closed_abruptly
>
> Rui Favas
>
> */Head of Services and Digital Media Technology/**//*
>
> */Barclays Investment Management Technology/*
>
> (ID: +44 (0)20 777 30866
>
> (Mobile: +44 (0) 7825023964
>
> (GD: 8773 0866
>
> *rui.favas at barclays.com <mailto:rui.favas at barclayscapital.com>
>
> 5 The North Colonnade
>
> Canary Wharf
>
> London
>
> E14 4BB
>
> For urgent issues email: _BCFS
> <mailto:xraGSCoperationsmana at barclayscapital.com> Services Dev_or visit
> our website: http://confluence.barcapint.com/display/ISS/BCFS+Services
>
> _______________________________________________
>
> Barclays is one of the world's leading banks, and we believe that by
> continuing to integrate the organisation we can better deliver the full
> power of Barclays to customers, clients and the communities in which we
> work.
>
> As a visible sign of that integration we are moving to a single Barclays
> brand for the majority of our divisions, including those formerly known
> as Barclays Capital, Barclays Wealth and Barclays Corporate.
>
> _______________________________________________
>
> This e-mail may contain information that is confidential, privileged or
> otherwise protected from disclosure. If you are not an intended
> recipient of this e-mail, do not duplicate or redistribute it by any
> means. Please delete it and any attachments and notify the sender that
> you have received it in error. Unless specifically indicated, this
> e-mail is not an offer to buy or sell or a solicitation to buy or sell
> any securities, investment products or other financial product or
> service, an official confirmation of any transaction, or an official
> statement of Barclays. Any views or opinions presented are solely those
> of the author and do not necessarily represent those of Barclays. This
> e-mail is subject to terms available at the following link:
> www.barcap.com/emaildisclaimer
> <http://www.barclays.com/emaildisclaimer>. By messaging with Barclays
> you consent to the foregoing.Barclays offers premier investment banking
> products and services to its clients throughBarclays Bank PLC, a company
> registered in England (number 1026167) with its registered office at 1
> Churchill Place, London, E14 5HP.This email may relate to or be sent
> from other members of the Barclays Group.//
>
> _______________________________________________
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware
_______________________________________________

This e-mail may contain information that is confidential, privileged or otherwise protected from 
disclosure. If you are not an intended recipient of this e-mail, do not duplicate or redistribute 
it by any means. Please delete it and any attachments and notify the sender that you have received 
it in error. Unless specifically indicated, this e-mail is not an offer to buy or sell or a 
solicitation to buy or sell any securities, investment products or other financial product or 
service, an official confirmation of any transaction, or an official statement of Barclays. Any 
views or opinions presented are solely those of the author and do not necessarily represent those 
of Barclays. This e-mail is subject to terms available at the following link: www.barcap.com/emaildisclaimer. 
By messaging with Barclays you consent to the foregoing.  Barclays offers premier investment banking 
products and services to its clients through Barclays Bank PLC, a company registered in England 
(number 1026167) with its registered office at 1 Churchill Place, London, E14 5HP.  This email may 
relate to or be sent from other members of the Barclays Group.

_______________________________________________

From simon at rabbitmq.com  Thu Apr 19 12:26:49 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 19 Apr 2012 12:26:49 +0100
Subject: [rabbitmq-discuss] VIP configuration
In-Reply-To: <1308E5CFD51CA14DA7B024A689B8B168025139A392@LDNPCMMGMB01.INTRANET.BARCAPINT.COM>
References: <1308E5CFD51CA14DA7B024A689B8B168025139A38C@LDNPCMMGMB01.INTRANET.BARCAPINT.COM>
	<4F8FF288.8000807@rabbitmq.com>
	<1308E5CFD51CA14DA7B024A689B8B168025139A392@LDNPCMMGMB01.INTRANET.BARCAPINT.COM>
Message-ID: <4F8FF679.1080901@rabbitmq.com>

On 19/04/12 12:25, rui.favas at barclays.com wrote:
> The HTTP aliveness-test sounds like a better solution! What url should the VIP hit?

/api/aliveness-test/<vhost>, e.g. /api/aliveness-test/%2f. See:

http://hg.rabbitmq.com/rabbitmq-management/raw-file/rabbitmq_v2_8_1/priv/www/api/index.html

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From m.luchak at smartasking.com  Thu Apr 19 12:49:02 2012
From: m.luchak at smartasking.com (m.luchak at smartasking.com)
Date: Thu, 19 Apr 2012 07:49:02 -0400 (EDT)
Subject: [rabbitmq-discuss] RabbitMQ as Android Service -
	keep-alive/heartbeat
Message-ID: <1334836142.083125370@apps.rackspace.com>


Hi All,
 
We are running RabbitMQ as a background service on Android to prinicpally receive notifications.  Is there something similar to keep-alive that we can implement to verify if the consumer is still connected and reset the connection timeout on the server?
 
It seems that the default method to do this is with heartbeat but the timer attribute of heartbeat doesn't work in the Android service scenario where the service is "woken up" every X minutes to test the connection. Using heartbeat we would need to leave Android running constantly and this defeats the purpose...
 
Soo.. Is there  "The Right Way" to ping the server when a background service is woken up or do we need to roll our own?
 
thanks very much,
Matthew
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120419/ce555554/attachment.htm>

From simon at rabbitmq.com  Thu Apr 19 13:12:51 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 19 Apr 2012 13:12:51 +0100
Subject: [rabbitmq-discuss] RabbitMQ as Android Service
	-	keep-alive/heartbeat
In-Reply-To: <1334836142.083125370@apps.rackspace.com>
References: <1334836142.083125370@apps.rackspace.com>
Message-ID: <4F900143.2010302@rabbitmq.com>

On 19/04/12 12:49, m.luchak at smartasking.com wrote:
> We are running RabbitMQ as a background service on Android to
> prinicpally receive notifications. Is there something similar to
> keep-alive that we can implement to verify if the consumer is still
> connected and reset the connection timeout on the server?
>
> It seems that the default method to do this is with heartbeat but the
> timer attribute of heartbeat doesn't work in the Android service
> scenario where the service is "woken up" every X minutes to test the
> connection. Using heartbeat we would need to leave Android running
> constantly and this defeats the purpose...
>
> Soo.. Is there "The Right Way" to ping the server when a background
> service is woken up or do we need to roll our own?

It's possible that enabling TCP keepalives will help:

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-January/017138.html

But you may need them on the client too, which may in turn require 
waking the client up; I'm not sure how that works on Android.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From m.luchak at smartasking.com  Thu Apr 19 13:42:06 2012
From: m.luchak at smartasking.com (m.luchak at smartasking.com)
Date: Thu, 19 Apr 2012 08:42:06 -0400 (EDT)
Subject: [rabbitmq-discuss] RabbitMQ as Android Service -
	keep-alive/heartbeat
In-Reply-To: <4F900143.2010302@rabbitmq.com>
References: <1334836142.083125370@apps.rackspace.com>
	<4F900143.2010302@rabbitmq.com>
Message-ID: <1334839326.553121917@apps.rackspace.com>


Hi Simon,
 
Yup, we are running TCP keepalives on the server... It's the Android side that we are questioning the proper way to implement..
 
We will just  implement writeFrame(new Frame(AMQP.FRAME_HEARTBEAT, 0));
when the service wakes up..
 
thanks very much,
Matthew
 
-----Original Message-----
From: "Simon MacMullen" <simon at rabbitmq.com>
Sent: Thursday, April 19, 2012 8:12am
To: m.luchak at smartasking.com
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] RabbitMQ as Android Service - keep-alive/heartbeat



On 19/04/12 12:49, m.luchak at smartasking.com wrote:
> We are running RabbitMQ as a background service on Android to
> prinicpally receive notifications. Is there something similar to
> keep-alive that we can implement to verify if the consumer is still
> connected and reset the connection timeout on the server?
>
> It seems that the default method to do this is with heartbeat but the
> timer attribute of heartbeat doesn't work in the Android service
> scenario where the service is "woken up" every X minutes to test the
> connection. Using heartbeat we would need to leave Android running
> constantly and this defeats the purpose...
>
> Soo.. Is there "The Right Way" to ping the server when a background
> service is woken up or do we need to roll our own?

It's possible that enabling TCP keepalives will help:

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-January/017138.html

But you may need them on the client too, which may in turn require 
waking the client up; I'm not sure how that works on Android.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120419/cff45adb/attachment.htm>

From jonathan.s.oliver42 at gmail.com  Thu Apr 19 18:18:55 2012
From: jonathan.s.oliver42 at gmail.com (Jonathan Oliver)
Date: Thu, 19 Apr 2012 10:18:55 -0700 (PDT)
Subject: [rabbitmq-discuss] .NET Client (2.8.1) Unhandled exception
Message-ID: <30404789.3147.1334855935909.JavaMail.geo-discussion-forums@ynjn4>

We are using RabbitMQ Server (v2.8.1) on Windows Server 2008 R2 x64. And we 
have a few NET 4.0 applications using the .NET RabbitMQ client library 
(v2.8.1).  Recently, we encountered an issue that caused the client to hang 
and run the CPU at 100%.  Interestingly enough, this issue occurred on two 
servers that are remote to the RabbitMQ broker server.  We had another 
instance of the application running on the same box as RabbitMQ broker and 
it was unaffected.

For the two machines that were affected, we took a crash dump of 
the process and then fired up Windbg to look at the misbehaving threads and 
associated stack traces.  The stack traces revealed an unhandled exception 
within the RabbitMQ client library that was being raised:

Exception type:   System.IO.EndOfStreamException
Message:          SharedQueue closed
InnerException:   <none>
StackTrace (generated):
    SP       IP       Function
    053FF04C 00D05C77 UNKNOWN!RabbitMQ.Util.SharedQueue.EnsureIsOpen()+0x37
    053FF054 00D05B18 UNKNOWN!RabbitMQ.Util.SharedQueue.Dequeue(Int32, 
System.Object ByRef)+0x78
    053FF0D0 00D05914 
UNKNOWN!RabbitMQ.Client.MessagePatterns.Subscription.Next(Int32, 
RabbitMQ.Client.Events.BasicDeliverEventArgs ByRef)+0x44

Perhaps there was some kind of network hiccup (I'm not sure), but in any 
case, when the subscription was attempting to read from the SharedQueue, it 
tried to read past the end of the stream and this caused the above 
exception which was not handled by the RabbitMQ client library.  We're 
modifying our code slightly to address this issue for now, but you may want 
to have either Emile Joubert or Alexandru Scvortov take a look at the code 
see what can be done.

I wasn't exactly sure how to file an official bug report, so I thought I'd 
post the issue here.

One other "nice to have" that's on a slightly different topic but still 
related to the .NET client library would be to mark the various methods and 
properties within RabbitMQ.Client.MessagePatterns.Subscription as virtual 
such that they can be override (mocked) during testing or perhaps an 
interface created which Subscription implements. This would ease some of 
our testing because we had to create a wrapper class to make Subscription 
testable during our development.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120419/880ad64d/attachment.htm>

From videlalvaro at gmail.com  Thu Apr 19 19:24:23 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Thu, 19 Apr 2012 20:24:23 +0200
Subject: [rabbitmq-discuss] DEMO - RabbitMQ running as Mac Standalone App
In-Reply-To: <65BDA61C13414D779FBAA918DF455454@gmail.com>
References: <46AEA592CFE3497894B1BE157795B799@gmail.com>
	<CAM8fPiRS0O6D5MeG=d32yEGWydYd9B9p-g4PXC3FOskOYHDp8g@mail.gmail.com>
	<E9E4F8687AB14AC1A1394A370232653D@gmail.com>
	<8ABC027D44A64CFE89B2B815B4A57D59@gmail.com>
	<4F8D4226.8080001@rabbitmq.com>
	<CAMcAHLXkhwrAPo=w0xu7AzQU4FMu1WSJMGWm-P9018Z3YEyFxw@mail.gmail.com>
	<65BDA61C13414D779FBAA918DF455454@gmail.com>
Message-ID: <CAMcAHLX8=0EfMV-fPT2tfcKXmYmzrfBV_261wP7RSUNZFV+1VA@mail.gmail.com>

Hi,

The new version has support for displaying logs in the app interface. See
here for a screenshot of how it looks like: http://i.imgur.com/mj1PS.png

The new app version that supports Snow Leopard and Lion can be obtained
here: http://dl.dropbox.com/u/58659506/RabbitMQ-2.8.1u.dmg

Regards,

Alvaro

On Tue, Apr 17, 2012 at 10:14 PM, Alvaro Videla <videlalvaro at gmail.com>wrote:

>  Hi,
>
> I just upgraded the release with compatibility for Snow Leopard as well.
> Get it here: http://dl.dropbox.com/u/58659506/RabbitMQ-2.8.1u.dmg
>
> Please let me know of any issues.
>
> Cheers,
>
> Alvaro
>
> --
> Sent with Sparrow <http://www.sparrowmailapp.com/?sig>
>
> On Tuesday, April 17, 2012 at 1:19 PM, Alvaro Videla wrote:
>
> Hi Simon,
>
> I just tried on Snow Leopard. So the standalone RabbitMQ works. (If you
> start it manually from the CLI)
>
> What doesn't work in Snow Leopard is the App itself. So I need to compile
> it for SL and then try again. I need to see how to do that with XCode since
> the Cocoa frameworks changed a bit from the previous version.
>
> Regards,
>
> Alvaro
>
> On Tue, Apr 17, 2012 at 12:12 PM, Simon MacMullen <simon at rabbitmq.com>wrote:
>
> Wow, thank you Alvaro, this is great stuff.
>
> Although I can't try it because my Mac is at home, and still runs Snow
> Leopard (hint :-)
>
> Does the UI part let you see the startup banner on stdout? Just thinking
> that would prove useful if the broker fails to start up.
>
> Thank you again.
>
> Cheers, Simon
>
>
> On 16/04/12 23:22, Alvaro Videla wrote:
>
> Hi,
>
> Here's the link to the .dmg with the App. It only works only on OS X
> Lion tho. I might try to get it running in Snow Leopard later.
>
> http://dl.dropbox.com/u/**58659506/RabbitMQ-2.8.1u.dmg<http://dl.dropbox.com/u/58659506/RabbitMQ-2.8.1u.dmg>
>
> Cheers,
>
> Alvaro
>
> --
> Sent with Sparrow <http://www.sparrowmailapp.**com/?sig<http://www.sparrowmailapp.com/?sig>
> >
>
>
> On Monday, April 16, 2012 at 10:16 PM, Alvaro Videla wrote:
>
>  Hi,
>
> The UI part is just an Xcode project using a WebKit webview control.
>
> The tricky part is to know when rabbitmq is actually running, so I'm
> using a shell script to tell that.
>
> Then the whole thing is just using NSTask all over the place to
> start/stop the broker.
>
> FYI, just installed the app in another Mac I have and this works
> (still OSX Lion). I also trying sending messages over the network and
> it works as well.
>
> Doing some code cleanup now before publishing.
>
> Cheers,
>
> Alvaro
>
> --
> Sent with Sparrow <http://www.sparrowmailapp.**com/?sig<http://www.sparrowmailapp.com/?sig>
> >
>
>
> On Monday, April 16, 2012 at 9:32 PM, Tony Garnock-Jones wrote:
>
>  That's great! I'm looking forward to seeing how you did it :-) (in
> particular the UI part)
>
> Regards,
> Tony
>
> On 16 April 2012 15:14, Alvaro Videla <videlalvaro at gmail.com
> <mailto:videlalvaro at gmail.com>**> wrote:
>
> Hi,
>
> Here's a little demo video of RabbitMQ running as standalone Mac App
>
> http://vimeo.com/40473369
>
> I will try to put it online soon, first I need to test it in another
> computer ;-)
>
> Cheers,
>
> Alvaro
>
> --
> Sent with Sparrow <http://www.sparrowmailapp.**com/?sig<http://www.sparrowmailapp.com/?sig>
> >
>
>
>
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> <mailto:rabbitmq-discuss@**lists.rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> >
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
>
>
>
> --
> Tony Garnock-Jones
> tonygarnockjones at gmail.com <mailto:tonygarnockjones@**gmail.com<tonygarnockjones at gmail.com>
> >
> http://homepages.kcbbs.gen.nz/**tonyg/<http://homepages.kcbbs.gen.nz/tonyg/>
>
>
>
>
>
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120419/55815bc4/attachment.htm>

From spamfodder42 at gmail.com  Thu Apr 19 21:27:10 2012
From: spamfodder42 at gmail.com (RoLo)
Date: Thu, 19 Apr 2012 13:27:10 -0700 (PDT)
Subject: [rabbitmq-discuss]  Enforcing single connection to a queue
Message-ID: <33716781.post@talk.nabble.com>


I'm working on a project where we need to enforce only a single client
connection to a queue.  Worse, the queue has to persist when the connection
closes, which rules out using the exclusive bit as the AMQP spec states that
an exclusive queue will always be auto-deleted when the client terminates
session.  

We've decided to use RabbitMQ.  After extensive searching, I haven't found
anything on the RabbitMQ side to enforce this requirement.  If there is, I'd
love to hear about it.

In the meantime, I've tried forging ahead with an attempt to implement this
manually.  We have a 'control' server which handles creating some special
exchanges and queues on the fly and which will handle some authentication
(outside of the AMQP authentication mechanisms).  The idea was to mark a
connection to the server for a specific user.  So the user authenticates
against our server, the server notes what connection the user is using and
on subsequent authentication requests by that user, we check the existence
of a live connection and if there is one, we kill it.  Our server is talking
to RabbitMQ via it's REST API, and the rest API needs the connection name in
order to DELETE a connection:

/api/connections/name	An individual connection. DELETEing it will close the
connection.

The problem is getting the connection name, it seems impossible.  The
connection name isn't sent back to the client so the client cannot report it
and the API to fetch all connections from the server doesn't expose anything
unique to the user.  We can't use IP because people may be behind a NATted
firewall, and besides that, we wouldn't know which connection to kill as at
that point the user would have two connections live, the zombie connection
and the new connection which is making the authentication request.  We need
a timestamp, which isn't there.

At this point, we're looking at inserting some custom properties (UID,
Timestamp) in the client_properties when the client initiates the
connection.  The server will parse the parameters and record them against
the user.  When a new authentication request comes in, the server will fetch
the list of connections from RabbitMQ via the REST API, and try to match the
UID and Timestamp, then pull the connection name and kil the old connection.

So I think there's a solution, but it's been a uphill battle to iron this
out.  I'm just curious if there is an easier way to do this that I'm just
not seeing as I'm fairly new to AMQP.  Input appreciated!
-- 
View this message in context: http://old.nabble.com/Enforcing-single-connection-to-a-queue-tp33716781p33716781.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From dan.j.marques at gmail.com  Thu Apr 19 23:49:58 2012
From: dan.j.marques at gmail.com (Daniel Marques)
Date: Thu, 19 Apr 2012 18:49:58 -0400
Subject: [rabbitmq-discuss] AMQP 1.0 Support
Message-ID: <CAL7CndvbTh8WFiJGpyyE_NDqnNfrcxOjZ7ik-yfGeSWECrwz+A@mail.gmail.com>

Hello.

(Absolute AMQP and RabbitMQ newbie here, so please point to the appropriate
place for this discussion if this is not it.)

We're about to embark on a new project, and am considering AMQP for it.
 We're hoping to unify at least 4 different messaging/communication
systems, and replace them with a single enterprise-wide message bus.  As we
have apps in at least 3 languages, on 2 OSs, and would like remain
vendor-independent, AMQP sounds like a good fit.  RabbitMQ seems like a
great implementation for our needs.

However, I'm concerned about the lack of a current AMQP 1.0 implementation
in RabbitMQ - I would hate to write the software using 0.9 and have to
rewrite it to support 1.0 once an implementation became available.  If
other vendors implement 1.0, it is not clear that will keep support for 0.9
around, in which case I would not see the benefit of vendor independence.

I guess I was just curious as to RabbitMQ's plans to implement (or not) 1.0
and what that timeline looked like.  I'd be also curious to hear how hard
it would be to convert an application from 0.9 to 1.0.

Thanks for your help.

Dan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120419/2f20433b/attachment.htm>

From jasonjwwilliams at gmail.com  Fri Apr 20 09:21:53 2012
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Fri, 20 Apr 2012 02:21:53 -0600
Subject: [rabbitmq-discuss] AMQP 1.0 Support
In-Reply-To: <CAL7CndvbTh8WFiJGpyyE_NDqnNfrcxOjZ7ik-yfGeSWECrwz+A@mail.gmail.com>
References: <CAL7CndvbTh8WFiJGpyyE_NDqnNfrcxOjZ7ik-yfGeSWECrwz+A@mail.gmail.com>
Message-ID: <A8C38C42-E706-4A29-95A2-EFE20AECBF08@gmail.com>

Hi Daniel,

AMQP 1.0 is so dissimilar from 0.9x that 1.0 should never have been called AMQP. It's literally as different as going from Gopher to HTTP. 

1.0 is very difficult to use as an app developer. It solves a very narrow problem set best suited to integrating AMQP brokers better with other non-AMQP brokers. 1.0 is architecture astronauts at their best. 

Rabbit is fairly protocol agnostic... 1.0 support was mocked up to my understanding and was able to run alongside 0.9.1. So even if 1.0 took over, 0.9.1 support in Rabbit isn't going anywhere. 

In reality 0.9.1 is a much better protocol for getting real work done as an app developer. The primitives are higher level and much more useful for 99% of the tasks you'll likely want to do. As a result I don't think 0.9.1 is going to go away...particularly amongst most AMQP users. 

Does that help?

-J

Sent via iPhone

Is your email Premiere?

On Apr 19, 2012, at 16:49, Daniel Marques <dan.j.marques at gmail.com> wrote:

> Hello.
> 
> (Absolute AMQP and RabbitMQ newbie here, so please point to the appropriate place for this discussion if this is not it.)
> 
> We're about to embark on a new project, and am considering AMQP for it.  We're hoping to unify at least 4 different messaging/communication systems, and replace them with a single enterprise-wide message bus.  As we have apps in at least 3 languages, on 2 OSs, and would like remain vendor-independent, AMQP sounds like a good fit.  RabbitMQ seems like a great implementation for our needs.
> 
> However, I'm concerned about the lack of a current AMQP 1.0 implementation in RabbitMQ - I would hate to write the software using 0.9 and have to rewrite it to support 1.0 once an implementation became available.  If other vendors implement 1.0, it is not clear that will keep support for 0.9 around, in which case I would not see the benefit of vendor independence.
> 
> I guess I was just curious as to RabbitMQ's plans to implement (or not) 1.0 and what that timeline looked like.  I'd be also curious to hear how hard it would be to convert an application from 0.9 to 1.0.
> 
> Thanks for your help.
> 
> Dan
> 
> 
> 
> 
> 
> 
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From lionel.cons at cern.ch  Fri Apr 20 09:55:24 2012
From: lionel.cons at cern.ch (Lionel Cons)
Date: Fri, 20 Apr 2012 10:55:24 +0200
Subject: [rabbitmq-discuss] SSL Error Filling Logs (ssl_session_cache,
	delete)
Message-ID: <20120420105001.d91f.abe10f7e5afbbb3a79ce619739541149@cern.ch>

We are getting the following errors using SSL & RabbitMQ 2.8.0:

=ERROR REPORT==== 20-Apr-2012::09:45:48 ===
Error in process <0.25610.7662> on node 'rabbitmq at broker with exit value: {undef,[{ssl_session_cache,delete,[{61233,<<32 bytes>>}]}]}

After googling, I found
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-July/014043.html
so the error may indeed harmless.

However, it's filling our logs VERY fast. On one broker, I saw 19k
errors per minute!

Is there a workaround to silent these?

Cheers,

Lionel

From matthias at rabbitmq.com  Fri Apr 20 10:43:33 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 20 Apr 2012 10:43:33 +0100
Subject: [rabbitmq-discuss] ConnectionFactory error on Android
In-Reply-To: <6e33c049-0d5d-4ef5-9d3f-be1292e4030f@v1g2000yqm.googlegroups.com>
References: <6e33c049-0d5d-4ef5-9d3f-be1292e4030f@v1g2000yqm.googlegroups.com>
Message-ID: <4F912FC5.10102@rabbitmq.com>

On 17/04/12 17:48, Kamran wrote:
> When I check the logcat of android there it gives an error related
> to connectionfactory? Is there something specific that I should look
> for?

What error shows up on the android device? Also, check the server log 
for errors.

Regards,

Matthias.

From matthias at rabbitmq.com  Fri Apr 20 10:50:48 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 20 Apr 2012 10:50:48 +0100
Subject: [rabbitmq-discuss] Idle TCP Connections to Broker
In-Reply-To: <AF4AD4ADFB23054CB4C75F50FF8C40B73B4189D3D2@MAILCCR.us.syncsort.com>
References: <CABzX+qx1sW_t4mjNmNdDjx4rt1VtxfwTJL8Xo0+4-ty2=PBpSQ@mail.gmail.com>
	<AF4AD4ADFB23054CB4C75F50FF8C40B73B4189D3D2@MAILCCR.us.syncsort.com>
Message-ID: <4F913178.6020800@rabbitmq.com>

Paul,

On 17/04/12 23:14, Bell, Paul M. wrote:
> I've heard a "rumor" that the broker will close TCP connections to
> consumers and producers if these connections are idle for some period
> of time.
>
> Can someone confirm the truth of this? If it's true, is this imposed
> by Rabbit, or are we talking about an underlying TCP behavior?

The broker does *not* close idle connections. But some firewalls are 
known to do that.

> At the same time, I heard tell of a way of connecting to the broker
> that allows you to specify a kind of "heartbeat" mode which keeps the
> connection active by periodically sending a heartbeat message to the
> broker. Is there such a connection option?

Yes. Check the documentation for the client library. E.g. in the java 
client the setting is at 
http://www.rabbitmq.com/releases/rabbitmq-java-client/v2.8.1/rabbitmq-java-client-javadoc-2.8.1/com/rabbitmq/client/ConnectionFactory.html#setRequestedHeartbeat(int)

Regards,

Matthias.

From abdullahsaima at yahoo.com  Thu Apr 19 13:41:11 2012
From: abdullahsaima at yahoo.com (Saima Asif)
Date: Thu, 19 Apr 2012 13:41:11 +0100 (BST)
Subject: [rabbitmq-discuss] what are message attributes used by broker
	in RABBITMQ
In-Reply-To: <4F8FDE71.9070405@rabbitmq.com>
References: <1334145243.23896.YahooMailNeo@web29703.mail.ird.yahoo.com>
	<4F8577F3.3060604@rabbitmq.com>
	<1334147886.33780.YahooMailNeo@web29704.mail.ird.yahoo.com>
	<4F85804C.70009@rabbitmq.com>
	<1334574888.94533.YahooMailNeo@web29704.mail.ird.yahoo.com>
	<4F8C024E.8040901@rabbitmq.com>
	<1334576533.63729.YahooMailNeo@web29703.mail.ird.yahoo.com>
	<4F8D40DE.60709@rabbitmq.com>
	<1334783134.40914.YahooMailNeo@web29701.mail.ird.yahoo.com>
	<4F8FDE71.9070405@rabbitmq.com>
Message-ID: <1334839271.63644.YahooMailNeo@web29701.mail.ird.yahoo.com>

Hi,
?
you are very right, I completely agree with your point here. I want to know is there anything other?than routing key involved in the message, what an exchange takes to do its routing and forwarding.
?
Is Rabbit MQ 2.8.1 follows the AMQP-1 logic?
?

Saima Asif
 

________________________________
 From: Simon MacMullen <simon at rabbitmq.com>
To: Saima Asif <abdullahsaima at yahoo.com> 
Cc: Emile Joubert <emile at rabbitmq.com> 
Sent: Thursday, 19 April 2012, 10:44
Subject: Re: [rabbitmq-discuss] what are message attributes used by broker in RABBITMQ
  
On 18/04/12 22:05, Saima Asif wrote:
> I am trying to get a general estimate about the latency based on all
> message properties

This is very unlikely to work. Message properties don't have very much to do with it.

In practice *by far* the biggest impact on latency is message rate - when the broker is near to its maximum message rate, latency heads for the sky. See the last chart at:

http://www.rabbitmq.com/blog/2012/04/17/rabbitmq-performance-measurements-part-1/

I would argue that RabbitMQ, like most software, is too complex a system to *model* with anything other than itself. If you want to find out how it will perform in a given context, take measurements.

Cheers, Simon

-- Simon MacMullen
RabbitMQ, VMware
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120419/7dd7e073/attachment.htm>

From muhammad.kamrana at gmail.com  Fri Apr 20 11:10:44 2012
From: muhammad.kamrana at gmail.com (Kamran Afridi)
Date: Fri, 20 Apr 2012 12:10:44 +0200
Subject: [rabbitmq-discuss] ConnectionFactory error on Android
In-Reply-To: <4F912FC5.10102@rabbitmq.com>
References: <6e33c049-0d5d-4ef5-9d3f-be1292e4030f@v1g2000yqm.googlegroups.com>
	<4F912FC5.10102@rabbitmq.com>
Message-ID: <CAKcHnZwt2v_UU_60VMa9a6iZZqs9C4LDF0vKUmgbdwpkd9kdKg@mail.gmail.com>

Hi,

01-09 19:06:55.754: E/AndroidRuntime(3896): FATAL EXCEPTION: main
01-09 19:06:55.754: E/AndroidRuntime(3896): java.lang.NoClassDefFoundError:
com.rabbitmq.client.ConnectionFactory
01-09 19:06:55.754: E/AndroidRuntime(3896): at
com.example.IConnectToRabbitMQ.connectToRabbitMQ(IConnectToRabbitMQ.java:62)
01-09 19:06:55.754: E/AndroidRuntime(3896): at
com.example.MessageConsumer.connectToRabbitMQ(MessageConsumer.java:65)
01-09 19:06:55.754: E/AndroidRuntime(3896): at
com.example.ActivityHome.onCreate(ActivityHome.java:30)

But I found the solution sometimes when we update our eclipse or Android
SDK we might face this problem. Though if we right-click ?lib? ->
build-path -> add as source folder?. then hopefully the application won?t
crash.

Regards,
Kamran

On Fri, Apr 20, 2012 at 11:43 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> On 17/04/12 17:48, Kamran wrote:
>
>> When I check the logcat of android there it gives an error related
>> to connectionfactory? Is there something specific that I should look
>> for?
>>
>
> What error shows up on the android device? Also, check the server log for
> errors.
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120420/83f51816/attachment.htm>

From matthew at rabbitmq.com  Fri Apr 20 11:17:56 2012
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 20 Apr 2012 11:17:56 +0100
Subject: [rabbitmq-discuss] SSL Error Filling Logs (ssl_session_cache,
 delete)
In-Reply-To: <20120420105001.d91f.abe10f7e5afbbb3a79ce619739541149@cern.ch>
References: <20120420105001.d91f.abe10f7e5afbbb3a79ce619739541149@cern.ch>
Message-ID: <20120420101756.GA32290@rabbitmq.com>

On Fri, Apr 20, 2012 at 10:55:24AM +0200, Lionel Cons wrote:
> However, it's filling our logs VERY fast. On one broker, I saw 19k
> errors per minute!
> 
> Is there a workaround to silent these?

Well, I believe it was fixed in later versions of Erlang, so an upgrade
may be the simplest.

You could also try making the log file a fifo, and then a cat with a
grep might work. But untested.

mkfifo /var/log/rabbitmq/rabbit@$(hostname).log
cat !!$ | grep -v ssl_session_cache > !!$.real

Definitely untested. Might work.

Matthew

From simon at rabbitmq.com  Fri Apr 20 11:20:32 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 20 Apr 2012 11:20:32 +0100
Subject: [rabbitmq-discuss] Enforcing single connection to a queue
In-Reply-To: <33716781.post@talk.nabble.com>
References: <33716781.post@talk.nabble.com>
Message-ID: <4F913870.5030306@rabbitmq.com>

On 19/04/12 21:27, RoLo wrote:
> I'm working on a project where we need to enforce only a single client
> connection to a queue.  Worse, the queue has to persist when the connection
> closes, which rules out using the exclusive bit as the AMQP spec states that
> an exclusive queue will always be auto-deleted when the client terminates
> session.

The way we always envisaged this working is:

* Don't allow any of your client users to connect to the management 
plugin (i.e. don't give them the "management", "monitoring" or 
"administrator" tags).

* Use cryptographically random queue names (such as server-generated names).

If the clients can't get into mgmt they can't list queues. And they 
can't guess another client's queue name. So each client can only see its 
own queue(s). If it wants to hand its queue names to other processes it 
can, but that's its business.

Inspired by: http://en.wikipedia.org/wiki/Capability-based_security

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From matthias at rabbitmq.com  Fri Apr 20 11:22:07 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 20 Apr 2012 11:22:07 +0100
Subject: [rabbitmq-discuss] STOMP instalation on Ubuntu
In-Reply-To: <1334590687.840122647@apps.rackspace.com>
References: <1334585549.279616963@apps.rackspace.com>	<4F8C2BCD.4030309@rabbitmq.com>
	<1334590687.840122647@apps.rackspace.com>
Message-ID: <4F9138CF.9000102@rabbitmq.com>

Matthew,

On 16/04/12 16:38, m.luchak at smartasking.com wrote:
> On my other question; Does anyone have insight as to the "right way" to
> implement the following:
>
> A consumer comes online and subscribes to a topic exchange after
> messages have been published. This consumer must receive the prior messages.

Can you explain in more detail what behaviour you are looking for? On 
the surface it would appear to require a broker to remember messages 
indefinitely. I.e. unless the broker has prior knowledge of all 
consumers, it has no way of knowing when it is safe to discard a message 
since another consumer may come along in, say, a year's time, subscribe 
to the topic, and expect to receive all prior messages.

> I understand that using STOMP is one way to acheive this, but is it the
> only way?

Rabbit's stomp plug-in uses AMQP under the covers. So whatever it 
accomplishes certainly can also be achieved with AMQP.

Regards,

Matthias.

From matthias at rabbitmq.com  Fri Apr 20 11:29:29 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 20 Apr 2012 11:29:29 +0100
Subject: [rabbitmq-discuss] Enforcing single connection to a queue
In-Reply-To: <33716781.post@talk.nabble.com>
References: <33716781.post@talk.nabble.com>
Message-ID: <4F913A89.6060902@rabbitmq.com>

On 19/04/12 21:27, RoLo wrote:
> I'm working on a project where we need to enforce only a single client
> connection to a queue.  Worse, the queue has to persist when the connection
> closes, which rules out using the exclusive bit as the AMQP spec states that
> an exclusive queue will always be auto-deleted when the client terminates
> session.
>
> We've decided to use RabbitMQ.  After extensive searching, I haven't found
> anything on the RabbitMQ side to enforce this requirement.  If there is, I'd
> love to hear about it.

There is an 'exclusive' flag on basic.consume. See 
http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.consume.exclusive. 
That works well for preventing clients from accidentally tripping over 
each other when consuming from a queue, but it wouldn't prevent 
malicious clients from, say, deleting or purging the queue, or fetching 
messages with basic.get. If that is a concern then secure queue names, 
as suggested by Simon, are the way to go.

Matthias.

From lionel.cons at cern.ch  Fri Apr 20 11:33:50 2012
From: lionel.cons at cern.ch (Lionel Cons)
Date: Fri, 20 Apr 2012 12:33:50 +0200
Subject: [rabbitmq-discuss] SSL Error Filling Logs (ssl_session_cache,
	delete)
In-Reply-To: <20120420101756.GA32290@rabbitmq.com> (Matthew Sackman's message
	of "Fri, 20 Apr 2012 11:17:56 +0100")
References: <20120420105001.d91f.abe10f7e5afbbb3a79ce619739541149@cern.ch>
	<20120420101756.GA32290@rabbitmq.com>
Message-ID: <bw71uni7kvl.fsf@mail.cern.ch>

Matthew Sackman <matthew at rabbitmq.com> writes:
> Well, I believe it was fixed in later versions of Erlang, so an upgrade
> may be the simplest.

Well, it depends what you mean by simplest...

We are currently using RHEL5 so, if we follow what is recommended at
http://www.rabbitmq.com/install-rpm.html, R14B-03 is the latest.

http://www.erlang-solutions.com/section/132/erlang-otp-packages gives
nothing more recent for RHEL5 or CentOS5...

> You could also try making the log file a fifo, and then a cat with a
> grep might work.

What about using something more flexible for logging (such as log4j)?

This way, admins would be able to tune the amount of logging they want
to see...

Cheers,

Lionel

From matthew at rabbitmq.com  Fri Apr 20 11:35:41 2012
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 20 Apr 2012 11:35:41 +0100
Subject: [rabbitmq-discuss] SSL Error Filling Logs (ssl_session_cache,
 delete)
In-Reply-To: <bw71uni7kvl.fsf@mail.cern.ch>
References: <20120420105001.d91f.abe10f7e5afbbb3a79ce619739541149@cern.ch>
	<20120420101756.GA32290@rabbitmq.com>
	<bw71uni7kvl.fsf@mail.cern.ch>
Message-ID: <20120420103541.GB32290@rabbitmq.com>

On Fri, Apr 20, 2012 at 12:33:50PM +0200, Lionel Cons wrote:
> What about using something more flexible for logging (such as log4j)?

Indeed. We all know we should do this. We have not done it. There are
other features that fall in this category too.

Matthew

From matthias at rabbitmq.com  Fri Apr 20 11:40:50 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 20 Apr 2012 11:40:50 +0100
Subject: [rabbitmq-discuss] SSL Error Filling Logs (ssl_session_cache,
 delete)
In-Reply-To: <20120420103541.GB32290@rabbitmq.com>
References: <20120420105001.d91f.abe10f7e5afbbb3a79ce619739541149@cern.ch>	<20120420101756.GA32290@rabbitmq.com>	<bw71uni7kvl.fsf@mail.cern.ch>
	<20120420103541.GB32290@rabbitmq.com>
Message-ID: <4F913D32.7020300@rabbitmq.com>

On 20/04/12 11:35, Matthew Sackman wrote:
> On Fri, Apr 20, 2012 at 12:33:50PM +0200, Lionel Cons wrote:
>> What about using something more flexible for logging (such as log4j)?
>
> Indeed. We all know we should do this. We have not done it. There are
> other features that fall in this category too.

Er, that error is logged in the bowels of the erlang ssl stack. Good 
luck in filtering that out; you'd have to find a logging framework that 
can filter based on a regexp match of the the log message. Or something 
similarly gross.

Matthias.

From matthew at rabbitmq.com  Fri Apr 20 11:45:17 2012
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 20 Apr 2012 11:45:17 +0100
Subject: [rabbitmq-discuss] SSL Error Filling Logs (ssl_session_cache,
 delete)
In-Reply-To: <4F913D32.7020300@rabbitmq.com>
References: <20120420105001.d91f.abe10f7e5afbbb3a79ce619739541149@cern.ch>
	<20120420101756.GA32290@rabbitmq.com>
	<bw71uni7kvl.fsf@mail.cern.ch>
	<20120420103541.GB32290@rabbitmq.com>
	<4F913D32.7020300@rabbitmq.com>
Message-ID: <20120420104517.GC32290@rabbitmq.com>

On Fri, Apr 20, 2012 at 11:40:50AM +0100, Matthias Radestock wrote:
> >Indeed. We all know we should do this. We have not done it. There are
> >other features that fall in this category too.
> 
> Er, that error is logged in the bowels of the erlang ssl stack. Good
> luck in filtering that out; you'd have to find a logging framework
> that can filter based on a regexp match of the the log message. Or
> something similarly gross.

Oh I know. I'm not for a moment suggesting it's an easy thing.

Matthew

From pbell at syncsort.com  Fri Apr 20 12:39:24 2012
From: pbell at syncsort.com (Bell, Paul M.)
Date: Fri, 20 Apr 2012 07:39:24 -0400
Subject: [rabbitmq-discuss] Idle TCP Connections to Broker
In-Reply-To: <4F913178.6020800@rabbitmq.com>
References: <CABzX+qx1sW_t4mjNmNdDjx4rt1VtxfwTJL8Xo0+4-ty2=PBpSQ@mail.gmail.com>
	<AF4AD4ADFB23054CB4C75F50FF8C40B73B4189D3D2@MAILCCR.us.syncsort.com>
	<4F913178.6020800@rabbitmq.com>
Message-ID: <42C1E75F-E84C-45B6-A2BA-FD192E9931F9@syncsort.com>

Thank you very much, Matthias.

-Paul



On Apr 20, 2012, at 5:50 AM, "Matthias Radestock" <matthias at rabbitmq.com> wrote:

> Paul,
>
> On 17/04/12 23:14, Bell, Paul M. wrote:
>> I've heard a "rumor" that the broker will close TCP connections to
>> consumers and producers if these connections are idle for some period
>> of time.
>>
>> Can someone confirm the truth of this? If it's true, is this imposed
>> by Rabbit, or are we talking about an underlying TCP behavior?
>
> The broker does *not* close idle connections. But some firewalls are
> known to do that.
>
>> At the same time, I heard tell of a way of connecting to the broker
>> that allows you to specify a kind of "heartbeat" mode which keeps the
>> connection active by periodically sending a heartbeat message to the
>> broker. Is there such a connection option?
>
> Yes. Check the documentation for the client library. E.g. in the java
> client the setting is at
> http://www.rabbitmq.com/releases/rabbitmq-java-client/v2.8.1/rabbitmq-java-client-javadoc-2.8.1/com/rabbitmq/client/ConnectionFactory.html#setRequestedHeartbeat(int)
>
> Regards,
>
> Matthias.



ATTENTION: -----

The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other  confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control.

From m.luchak at smartasking.com  Fri Apr 20 12:42:46 2012
From: m.luchak at smartasking.com (m.luchak at smartasking.com)
Date: Fri, 20 Apr 2012 07:42:46 -0400 (EDT)
Subject: [rabbitmq-discuss] STOMP instalation on Ubuntu
In-Reply-To: <4F9138CF.9000102@rabbitmq.com>
References: <1334585549.279616963@apps.rackspace.com>
	<4F8C2BCD.4030309@rabbitmq.com> 
	<1334590687.840122647@apps.rackspace.com>
	<4F9138CF.9000102@rabbitmq.com>
Message-ID: <1334922166.955618988@apps.rackspace.com>


Hi Matthias,
 
I apoligize as I had forgotten about this thread.  Thanks for the input.  This requirement of receiving messages previously published to an exchange was discarted... We were (are, hehe)  very green with AMQP and RabbitMQ and we didn't have a clear grasp of exchanges, queues etc..
 
We made a simple tweak to the sequence of when bindings are created to implement AMQP "the right way" and we no longer have clients who are missing messages.
 
thanks,
Matthew
 
-----Original Message-----
From: "Matthias Radestock" <matthias at rabbitmq.com>
Sent: Friday, April 20, 2012 6:22am
To: m.luchak at smartasking.com
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] STOMP instalation on Ubuntu



Matthew,

On 16/04/12 16:38, m.luchak at smartasking.com wrote:
> On my other question; Does anyone have insight as to the "right way" to
> implement the following:
>
> A consumer comes online and subscribes to a topic exchange after
> messages have been published. This consumer must receive the prior messages.

Can you explain in more detail what behaviour you are looking for? On 
the surface it would appear to require a broker to remember messages 
indefinitely. I.e. unless the broker has prior knowledge of all 
consumers, it has no way of knowing when it is safe to discard a message 
since another consumer may come along in, say, a year's time, subscribe 
to the topic, and expect to receive all prior messages.

> I understand that using STOMP is one way to acheive this, but is it the
> only way?

Rabbit's stomp plug-in uses AMQP under the covers. So whatever it 
accomplishes certainly can also be achieved with AMQP.

Regards,

Matthias.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120420/a3ea6059/attachment.htm>

From gsim at redhat.com  Fri Apr 20 14:23:05 2012
From: gsim at redhat.com (Gordon Sim)
Date: Fri, 20 Apr 2012 14:23:05 +0100
Subject: [rabbitmq-discuss] AMQP 1.0 Support
In-Reply-To: <A8C38C42-E706-4A29-95A2-EFE20AECBF08@gmail.com>
References: <CAL7CndvbTh8WFiJGpyyE_NDqnNfrcxOjZ7ik-yfGeSWECrwz+A@mail.gmail.com>
	<A8C38C42-E706-4A29-95A2-EFE20AECBF08@gmail.com>
Message-ID: <4F916339.7000102@redhat.com>

On 04/20/2012 09:21 AM, Jason J. W. Williams wrote:
> 1.0 is very difficult to use as an app developer.

I don't think it is.

Perhaps I'm misunderstanding the point or perhaps it depends on 
perspective. I would accept that the 1.0 specification *as a document* 
is not particularly useful to an app developer and indeed they were not 
the intended audience.

An app developer in my view would generally be using an AMQP library, 
rather than implementing the protocol directly, and I can't see how that 
would be made any more difficult (if anything for a certain class of 
users at least I think it would be more intuitive).

Whether it is more difficult to *implement* such a library is of course 
also a different question.

> It solves a very narrow problem set best suited to integrating AMQP brokers better with other non-AMQP brokers.

I very much disagree.

It is certainly not limited to - or even focused on - integration with 
non-AMQP brokers though it is deliberately less imposing in terms of a 
broker implementations internal architecture to promote even wider adoption.

I don't believe the target problem set has narrowed since earlier 
versions however, if anything it is the reverse.

What important problems does it not address in your view?

--Gordon.

From steve at rabbitmq.com  Fri Apr 20 14:26:08 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Fri, 20 Apr 2012 14:26:08 +0100
Subject: [rabbitmq-discuss] Cannot send message with STOMP
In-Reply-To: <CAM8fPiQym+sNwe_vwz_v208eKApS09WvMQ4HeCvBRmXdwZMmfA@mail.gmail.com>
References: <20120416153346.b41c.abe10f7e5afbbb3a79ce619739541149@cern.ch>
	<CAM8fPiT4grNkru+aRW+gb9=RQkyA-N39G7rnTk35BiUGkJngNQ@mail.gmail.com>
	<1D9CBD89533EE94D8295DFBFD923C23F649F007B@PLOXCHG03.cern.ch>
	<CAM8fPiSG4L1QwcKQVC7rrLqSTUJ3E23BQ9UFO7=Fokwz2qfvZQ@mail.gmail.com>
	<20365.234.891858.767694@mail.cern.ch>
	<CAM8fPiQym+sNwe_vwz_v208eKApS09WvMQ4HeCvBRmXdwZMmfA@mail.gmail.com>
Message-ID: <8679EBD0-F2E4-47DE-B5C2-1FDDDAB8ACAA@rabbitmq.com>

Lionel,
Thank you for reporting this problem with our header en/decoding.

The STOMP 1.0 specification is unsatisfactory in many respects, not
least because it says nothing about encoding headers (or what it means
by CHAR in its BNF).

The STOMP 1.1 specification has drawbacks of its own -- the rather
arbitrary notion of escaping colons in header values as well as names
(why?) and the insistence of UTF-8 for all header names and values (this
is not policed in RabbitMQ since this would involve another (complex)
parsing process -- and it is not clear what we should do with non-UTF-8
octet streams). Finally, it doesn't correctly describe the escape rules
in respect of backslashes.

STOMP 1.1 also prescribes (in its improved BNF) OCTETs in headers and
header values (whereas the text (using MUST) insists they consist of
UTF-8 sequences) and it (the BNF) allows backslash (followed by anything
other than c or n) in a header.

So I think it is _incorrect_ in that it specifies a considerable
superset of what you can receive (or are allowed to send) over the wire.

When RabbitMQ started to support STOMP 1.1 we made it backward
compatible with 1.0 clients as far as possible. So we do not police some
of the verboten practices in 1.1 -- for example, we do not insist upon
UTF-8 strings in header names and values, and we still allow
subscriptions without ids. (Policing colons in header values (as well as
names) was probably a mistake in retrospect.)

We managed to produce a STOMP adapter implementation which avoids having
complicating checks of the connection version on frame parsing and
generation. It looks like this will have to change.

I'm going to raise a bug [24896] to track this, and propose the
following solution:

We use the negotiated connection type to determine the parsing rules
(and generating rules) for frame headers.

For 1.0 connections we will allow OCTET streams for header names and
values, excepting colons in names, and excepting newlines (\u000A
newline character coded in UTF-8 is x'0A') anywhere, and do NO escaping
either on input or output. We will reject no headers on input unless
they do not contain a colon before the first newline (because they
cannot be malformed under these rules) though the remaining frame
parsing can fail.

For 1.1 connections we will allow OCTET streams for header names and
values, excepting colons, newlines and backslashes, interpreting escape
sequences for these, and generating escapes for these characters on
output. We will NOT reject non-UTF-8 OCTETs but instead just pass them
through asis in order to allow the simplest client access. We will NOT
reject other escapes (\ followed by non c, n or \), but leave these
asis.

Although this is not strictly what the spec says (we would not enforce
UTF-8 or the errors on bad escape sequences) I believe it is a
reasonable compromise.

Steve Powell
steve at rabbitmq.com
[wrk: +44-2380-111-528] [mob: +44-7815-838-558]

On 17 Apr 2012, at 12:02, Tony Garnock-Jones wrote:

> On 17 April 2012 01:34, Lionel Cons <lionel.cons at cern.ch> wrote:
> IMHO, the BNF definition is correct: it accurately defines what you
> can see on the wire and this is sufficient to extract frames. It does
> not however define how to interpret what you extract from the wire,
> like backslash escaping and UTF-8 encoding, which are defined elsewhere
> in the STOMP 1.1 specification.
> 
> Fair enough. Perhaps "incorrect" was a bit strong, but it could definitely have helped this casual reader avoid the dangerous misinterpretation I ended up making by reading the BNF alone. I believe it could profitably also describe the backslash-escaping. (After all, it would also be correct, in some sense, for it to specify the headers block as "a sequence of bytes not including two newlines in a row, followed by two newlines", leaving it up the the rest of the text to describe how to extract the key-value pairs from that structure! ;-) )
> 
> Here's the kind of thing I was expecting:
> 
> header              = header-name ":" header-value
> header-name         = 1*header-text-atom
> 
> header-value        = *header-text-atom
> header-text-atom    = "\n" | "\c" | "\\" | <any OCTET except LF or ":" or "\">
> 
> 
> I should have been paying more attention during the 1.1 development process.
> 
> Regards,
>   Tony
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From lionel.cons at cern.ch  Fri Apr 20 14:58:47 2012
From: lionel.cons at cern.ch (Lionel Cons)
Date: Fri, 20 Apr 2012 15:58:47 +0200
Subject: [rabbitmq-discuss] Cannot send message with STOMP
In-Reply-To: <8679EBD0-F2E4-47DE-B5C2-1FDDDAB8ACAA@rabbitmq.com>
References: <20120416153346.b41c.abe10f7e5afbbb3a79ce619739541149@cern.ch>
	<CAM8fPiT4grNkru+aRW+gb9=RQkyA-N39G7rnTk35BiUGkJngNQ@mail.gmail.com>
	<1D9CBD89533EE94D8295DFBFD923C23F649F007B@PLOXCHG03.cern.ch>
	<CAM8fPiSG4L1QwcKQVC7rrLqSTUJ3E23BQ9UFO7=Fokwz2qfvZQ@mail.gmail.com>
	<20365.234.891858.767694@mail.cern.ch>
	<CAM8fPiQym+sNwe_vwz_v208eKApS09WvMQ4HeCvBRmXdwZMmfA@mail.gmail.com>
	<8679EBD0-F2E4-47DE-B5C2-1FDDDAB8ACAA@rabbitmq.com>
Message-ID: <20369.27543.718619.701208@mail.cern.ch>

Steve Powell writes:
 > The STOMP 1.0 specification is unsatisfactory in many respects, [...]

Indeed. This is what triggered the creation of 1.1.

 > The STOMP 1.1 specification has drawbacks of its own -- [...]

Although I agree that 1.1 is not perfect (so I'm sure we will see 1.2
or 2.0 one day), I do not share your view on the points you mention.

 > the rather arbitrary notion of escaping colons in header values as
 > well as names (why?) [...]

Without backslash escaping, header names and values would have been
limited. This quite simple escaping removed this restriction.

 > and the insistence of UTF-8 for all header names and values [...]

Here again, without this in the spec, the headers would have been
limited to basically US-ASCII. Some users (us included) do need
more. This widely used encoding allows any text string in the header.
Icing on the cake: it's backward compatible with 1.0 and transparent
to implementations using only US-ASCII.

 > So I think it is _incorrect_ in that it specifies a considerable
 > superset of what you can receive (or are allowed to send) over the wire.

The BNF indeed allows more than what the protocol accepts. The best
solution is probably to ignore the BNF and only implement what is in
the protocol text. After all, it's probably two orders of magnitude
shorter than AMQP 1-0 ;-)

 > I'm going to raise a bug [24896] to track this, and propose the
 > following solution:

Thanks.

 > We use the negotiated connection type to determine the parsing rules
 > (and generating rules) for frame headers.

Perfect.

 > For 1.0 connections we will allow OCTET streams for header names and
 > values, excepting colons in names, and excepting newlines (\u000A
 > newline character coded in UTF-8 is x'0A') anywhere, and do NO escaping
 > either on input or output. We will reject no headers on input unless
 > they do not contain a colon before the first newline (because they
 > cannot be malformed under these rules) though the remaining frame
 > parsing can fail.

Maybe you also want reject empty header names (e.g. SEND\n:foo\n\n\0).
This is arguable.

 > For 1.1 connections we will allow OCTET streams for header names and
 > values, excepting colons, newlines and backslashes, interpreting escape
 > sequences for these, and generating escapes for these characters on
 > output. We will NOT reject non-UTF-8 OCTETs but instead just pass them
 > through asis in order to allow the simplest client access. We will NOT
 > reject other escapes (\ followed by non c, n or \), but leave these
 > asis.
 > 
 > Although this is not strictly what the spec says (we would not enforce
 > UTF-8 or the errors on bad escape sequences) I believe it is a
 > reasonable compromise.

Fair enough.

IMHO, the main point is that RabbitMQ should accept any valid STOMP
1.1 input. Your proposed solution seems address this point.

If you also accept invalid input, this should not be a problem in
practice.

Thanks for your work improving RabbitMQ's STOMP support.

Cheers,

Lionel

From emile at rabbitmq.com  Fri Apr 20 16:19:35 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 20 Apr 2012 16:19:35 +0100
Subject: [rabbitmq-discuss] .NET Client (2.8.1) Unhandled exception
In-Reply-To: <30404789.3147.1334855935909.JavaMail.geo-discussion-forums@ynjn4>
References: <30404789.3147.1334855935909.JavaMail.geo-discussion-forums@ynjn4>
Message-ID: <4F917E87.10506@rabbitmq.com>

Hi,

On 19/04/12 18:18, Jonathan Oliver wrote:
> RabbitMQ.Util.SharedQueue.EnsureIsOpen()
> RabbitMQ.Util.SharedQueue.Dequeue(Int32, System.Object ByRef)
> RabbitMQ.Client.MessagePatterns.Subscription.Next(Int32,
>    RabbitMQ.Client.Events.BasicDeliverEventArgs ByRef)

That exception is handled in the Subscription Next() methods. The root
cause of the problem may have been in a different thread. Are you able
to reproduce the error, or describe how to do so?


-Emile



From fearsome.lucidity at gmail.com  Fri Apr 20 17:51:18 2012
From: fearsome.lucidity at gmail.com (Elias Levy)
Date: Fri, 20 Apr 2012 09:51:18 -0700
Subject: [rabbitmq-discuss] Redefining queue/exchange attributes
Message-ID: <CAFDmHdORq02g8zAR4S36G9_1GPt_x5QotqOYVx6FaZqH29gsHg@mail.gmail.com>

Are there any plans to allow the modification of queue and exchange
attributes, say via the REST API?

At the moment if one must redefine the attributes of a queue or exchange,
you must destroy the queue or exchange and recreate it.  That is rather
disruptive in a production environment.  If means that bindings are
destroyed and must be recreated, that consumers must restart their
subscriptions, etc.

There are many scenarios where one would want to redefine the attributes.
 Either an error crept in during initial set up, or say, a node has gone
down and you want to redefine a HA queue by removing the dead node from its
config and adding a new node.

Thoughts?

Elias Levy
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120420/dea867f0/attachment.htm>

From simon at rabbitmq.com  Fri Apr 20 17:56:13 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 20 Apr 2012 17:56:13 +0100
Subject: [rabbitmq-discuss] Redefining queue/exchange attributes
In-Reply-To: <CAFDmHdORq02g8zAR4S36G9_1GPt_x5QotqOYVx6FaZqH29gsHg@mail.gmail.com>
References: <CAFDmHdORq02g8zAR4S36G9_1GPt_x5QotqOYVx6FaZqH29gsHg@mail.gmail.com>
Message-ID: <4F91952D.9070905@rabbitmq.com>

We're aware that the current situation with HA policies is inconvenient; 
it was the simplest thing that could possibly work.

However, we're more likely to go in the direction of having things like 
HA-ness defined outside of the AMQP arguments mechanism altogether in 
future. Really arguments should be for things that application authors 
care about; it's a contract with the application that these should not 
change. The application should not have to know that its queues are HA 
or its exchanges are federated; that's a matter for the broker 
administrator.

Cheers, Simon

On 20/04/12 17:51, Elias Levy wrote:
> Are there any plans to allow the modification of queue and exchange
> attributes, say via the REST API?
>
> At the moment if one must redefine the attributes of a queue or
> exchange, you must destroy the queue or exchange and recreate it.  That
> is rather disruptive in a production environment.  If means that
> bindings are destroyed and must be recreated, that consumers must
> restart their subscriptions, etc.
>
> There are many scenarios where one would want to redefine the
> attributes.  Either an error crept in during initial set up, or say, a
> node has gone down and you want to redefine a HA queue by removing the
> dead node from its config and adding a new node.
>
> Thoughts?
>
> Elias Levy
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From ooostin at gmail.com  Fri Apr 20 17:27:13 2012
From: ooostin at gmail.com (ostin)
Date: Fri, 20 Apr 2012 09:27:13 -0700 (PDT)
Subject: [rabbitmq-discuss] One message instance in couple of queues
Message-ID: <3fae4c5f-8721-4d63-9e9c-0f31923cf590@j3g2000vba.googlegroups.com>

Hello.

Please help me to find answer for my problem:
I have two abstract queues (Q1, Q2). I send a message (M1) to Q1 and
it is been copied to Q2. Below this point everything is rather simple,
I can use fanout, topic and headers exchange to deliver one message to
several queues :)
What I want is to have only one instance of M1 in the system: when I
delete message from Q1 is should disappear from Q2 either. As I
understand, message doesn't have any ID in the system so I can't
delete directly M1 from both queues.

So, is my problem solvable with RabbitMQ (amqp generally)?

Example application with topic exchange:
I push a message to server1.app1 queue and an other one to
server1.app2 queue. I monitor server1 queue to determine count of
processing messages on server 1. After app1 ends processing message it
shold be deleted from both queues: from app1 to prevent duplicate
processing, from server1 to have valid stats for monitoring. I assume
that there can be many applications with random names, so I cant
monitor just count of messages in app* queues.

Thanks.

From simon at rabbitmq.com  Fri Apr 20 18:00:16 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 20 Apr 2012 18:00:16 +0100
Subject: [rabbitmq-discuss] One message instance in couple of queues
In-Reply-To: <3fae4c5f-8721-4d63-9e9c-0f31923cf590@j3g2000vba.googlegroups.com>
References: <3fae4c5f-8721-4d63-9e9c-0f31923cf590@j3g2000vba.googlegroups.com>
Message-ID: <4F919620.20305@rabbitmq.com>

On 20/04/12 17:27, ostin wrote:
> Example application with topic exchange:
> I push a message to server1.app1 queue and an other one to
> server1.app2 queue. I monitor server1 queue to determine count of
> processing messages on server 1. After app1 ends processing message it
> shold be deleted from both queues: from app1 to prevent duplicate
> processing, from server1 to have valid stats for monitoring. I assume
> that there can be many applications with random names, so I cant
> monitor just count of messages in app* queues.

If you want to make sure that a given message is only ever consumed from 
server1.app1 OR server1.app2, why not have only a single queue and have 
both applications consume from it?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From jasonjwwilliams at gmail.com  Fri Apr 20 18:37:07 2012
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Fri, 20 Apr 2012 11:37:07 -0600
Subject: [rabbitmq-discuss] AMQP 1.0 Support
In-Reply-To: <4F916339.7000102@redhat.com>
References: <CAL7CndvbTh8WFiJGpyyE_NDqnNfrcxOjZ7ik-yfGeSWECrwz+A@mail.gmail.com>
	<A8C38C42-E706-4A29-95A2-EFE20AECBF08@gmail.com>
	<4F916339.7000102@redhat.com>
Message-ID: <CAHZAEpcNSz0r_gxKGMZ-osR3JVU5ykS=Ap5mDhh0vk38r+qQBg@mail.gmail.com>

Hi Gordon

>
> I don't think it is.

We'll have to disagree. RedHat is one of a couple corporate members of
the WG that were largely responsible for pushing the shift in
direction to what became 1.0, and 1.0 serves those interests.

> An app developer in my view would generally be using an AMQP library, rather
> than implementing the protocol directly, and I can't see how that would be
> made any more difficult (if anything for a certain class of users at least I
> think it would be more intuitive).

Client libraries reflect the primitives present in the protocol, and
thereby directly the difficulty or ease with which they can be used to
build applications.

1.0 replaces useful out-of-the-box ready primitives like queues,
exchanges and bindings with a "build-it-yourself" approach using
nodes, links and filters. 0.9.x gives us the equivalent of power
tools, 1.0 instead makes you build the tools before you can ever get
going. In this regard, 1.0 and ZeroMQ have a lot in common and of the
two ZeroMQ is frankly the better choice. The point to having a broker
is provide those messaging power tools so you can focus on your
application.

Furthermore, any client library attempting to emulate
queue/binding/exchange fabric primitives using 1.0 "bricks" would be
doing so as a  non-standard convention, one that would have to be
adopted by other library writers in exactly the same way to afford the
cross-platform capabilities that 0.9.x has from day one as a draft
standard.


> It is certainly not limited to - or even focused on - integration with
> non-AMQP brokers though it is deliberately less imposing in terms of a
> broker implementations internal architecture to promote even wider adoption.

Quoting from a JPMorgan preso on 1.0 as to the design goals:

* Simplify wire protocol
* Global Addressing
* Create a model more easy to retro-fit to legacy
brokers
* Extensible layered protocol


All of these serve federation and integration (i.e. broker writers),
not the app developer.

THE reason nodes/links/filters became the new 1.0 primitives was
precisely to enable easier federation with non-AMQP brokers. Want to
forward a message on to a federated broker? No problem, attach another
link pointing to the federated broker with the right filter. 1.0
exists to make life easier on broker implementers and integrators, not
to help app developers/users. It puts the burden on the app developer
to build up the actual primitive he wants. Again, ZMQ is a better 1.0
than 1.0: it has similar primitives, is simpler, and doesn't pretend
to be anything other than a transport erector set.


As an OASIS standard now, I foresee AMQP 1.0 continuing on it's trek
to serve it's corporate masters/designers...which would be fine if it
didn't throw app developers and their productivity to the wolves as
1.0 has done.

-J

From sustrik at 250bpm.com  Fri Apr 20 19:12:19 2012
From: sustrik at 250bpm.com (Martin Sustrik)
Date: Fri, 20 Apr 2012 20:12:19 +0200
Subject: [rabbitmq-discuss] AMQP 1.0 Support
In-Reply-To: <CAHZAEpcNSz0r_gxKGMZ-osR3JVU5ykS=Ap5mDhh0vk38r+qQBg@mail.gmail.com>
References: <CAL7CndvbTh8WFiJGpyyE_NDqnNfrcxOjZ7ik-yfGeSWECrwz+A@mail.gmail.com>	<A8C38C42-E706-4A29-95A2-EFE20AECBF08@gmail.com>	<4F916339.7000102@redhat.com>
	<CAHZAEpcNSz0r_gxKGMZ-osR3JVU5ykS=Ap5mDhh0vk38r+qQBg@mail.gmail.com>
Message-ID: <4F91A703.6030006@250bpm.com>

Hi Jason, Gordon,

Interesting discussion.

I think Jason has a point in that AMQP/1.0 has deliberately dropped to 
"model" part of spec (i.e. exchanges/queues/bindings) which was the real 
meat of the protocol.

I have no idea what the reasons were. In any case it dumbs down the 
protocol to the extent where it becomes an ugly version of TCP built on 
top of TCP.

I have to disagree though that ZeroMQ/Crossroads did a similar thing. 
Instead of dropping the AMQP model, my goal was to refine it, remove 
weird cases (like broadcasting messages to multiple queues, then 
load-balancing them to the consumers) and make the concepts implicitly 
contained in AMQP model, like request/reply, publish/subscribe etc. even 
more explicit.

Martin

On 20/04/12 19:37, Jason J. W. Williams wrote:
> Hi Gordon
>
>>
>> I don't think it is.
>
> We'll have to disagree. RedHat is one of a couple corporate members of
> the WG that were largely responsible for pushing the shift in
> direction to what became 1.0, and 1.0 serves those interests.
>
>> An app developer in my view would generally be using an AMQP library, rather
>> than implementing the protocol directly, and I can't see how that would be
>> made any more difficult (if anything for a certain class of users at least I
>> think it would be more intuitive).
>
> Client libraries reflect the primitives present in the protocol, and
> thereby directly the difficulty or ease with which they can be used to
> build applications.
>
> 1.0 replaces useful out-of-the-box ready primitives like queues,
> exchanges and bindings with a "build-it-yourself" approach using
> nodes, links and filters. 0.9.x gives us the equivalent of power
> tools, 1.0 instead makes you build the tools before you can ever get
> going. In this regard, 1.0 and ZeroMQ have a lot in common and of the
> two ZeroMQ is frankly the better choice. The point to having a broker
> is provide those messaging power tools so you can focus on your
> application.
>
> Furthermore, any client library attempting to emulate
> queue/binding/exchange fabric primitives using 1.0 "bricks" would be
> doing so as a  non-standard convention, one that would have to be
> adopted by other library writers in exactly the same way to afford the
> cross-platform capabilities that 0.9.x has from day one as a draft
> standard.
>
>
>> It is certainly not limited to - or even focused on - integration with
>> non-AMQP brokers though it is deliberately less imposing in terms of a
>> broker implementations internal architecture to promote even wider adoption.
>
> Quoting from a JPMorgan preso on 1.0 as to the design goals:
>
> * Simplify wire protocol
> * Global Addressing
> * Create a model more easy to retro-fit to legacy
> brokers
> * Extensible layered protocol
>
>
> All of these serve federation and integration (i.e. broker writers),
> not the app developer.
>
> THE reason nodes/links/filters became the new 1.0 primitives was
> precisely to enable easier federation with non-AMQP brokers. Want to
> forward a message on to a federated broker? No problem, attach another
> link pointing to the federated broker with the right filter. 1.0
> exists to make life easier on broker implementers and integrators, not
> to help app developers/users. It puts the burden on the app developer
> to build up the actual primitive he wants. Again, ZMQ is a better 1.0
> than 1.0: it has similar primitives, is simpler, and doesn't pretend
> to be anything other than a transport erector set.
>
>
> As an OASIS standard now, I foresee AMQP 1.0 continuing on it's trek
> to serve it's corporate masters/designers...which would be fine if it
> didn't throw app developers and their productivity to the wolves as
> 1.0 has done.
>
> -J
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From jasonjwwilliams at gmail.com  Fri Apr 20 21:11:11 2012
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Fri, 20 Apr 2012 14:11:11 -0600
Subject: [rabbitmq-discuss] AMQP 1.0 Support
In-Reply-To: <4F91A703.6030006@250bpm.com>
References: <CAL7CndvbTh8WFiJGpyyE_NDqnNfrcxOjZ7ik-yfGeSWECrwz+A@mail.gmail.com>
	<A8C38C42-E706-4A29-95A2-EFE20AECBF08@gmail.com>
	<4F916339.7000102@redhat.com>
	<CAHZAEpcNSz0r_gxKGMZ-osR3JVU5ykS=Ap5mDhh0vk38r+qQBg@mail.gmail.com>
	<4F91A703.6030006@250bpm.com>
Message-ID: <CAHZAEpepZSLui89Fv8KQNk=mwi2h4_RGDyJLuVELgx-hhhN78A@mail.gmail.com>

Hi Martin,

> I have to disagree though that ZeroMQ/Crossroads did a similar thing.
> Instead of dropping the AMQP model, my goal was to refine it, remove weird
> cases (like broadcasting messages to multiple queues, then load-balancing
> them to the consumers) and make the concepts implicitly contained in AMQP
> model, like request/reply, publish/subscribe etc. even more explicit.

I tend to think of (and use) ZeroMQ more of as a way to link
applications together in a brokerless topology and still get a lot of
the benefits of messaging. . My intention in drawing in the comparison
with ZMQ is to highlight that I think ZMQ does it right for those use
cases.

(I realize using ZMQ you can make one of your apps a broker and bake
in your own persistence)

I have a lot of respect for ZMQ.

-J

From gsim at redhat.com  Fri Apr 20 21:26:35 2012
From: gsim at redhat.com (Gordon Sim)
Date: Fri, 20 Apr 2012 21:26:35 +0100
Subject: [rabbitmq-discuss] AMQP 1.0 Support
In-Reply-To: <CAHZAEpcNSz0r_gxKGMZ-osR3JVU5ykS=Ap5mDhh0vk38r+qQBg@mail.gmail.com>
References: <CAL7CndvbTh8WFiJGpyyE_NDqnNfrcxOjZ7ik-yfGeSWECrwz+A@mail.gmail.com>	<A8C38C42-E706-4A29-95A2-EFE20AECBF08@gmail.com>	<4F916339.7000102@redhat.com>
	<CAHZAEpcNSz0r_gxKGMZ-osR3JVU5ykS=Ap5mDhh0vk38r+qQBg@mail.gmail.com>
Message-ID: <4F91C67B.7080506@redhat.com>

On 04/20/2012 06:37 PM, Jason J. W. Williams wrote:
> Client libraries reflect the primitives present in the protocol, and
> thereby directly the difficulty or ease with which they can be used to
> build applications.
>
> 1.0 replaces useful out-of-the-box ready primitives like queues,
> exchanges and bindings with a "build-it-yourself" approach using
> nodes, links and filters.

That isn't the case.

Nodes are simply a more general concept covering queues or exchanges or 
indeed other types of messaging endpoints.

Links are simply subscriptions (i.e. an indication of a desire to 
receive from a give queue/node) expanded to include an analogous concept 
for indicating the desire/intention to send to a given queue/node. That 
is useful for flow control and can enable faster routing decisions.

The same basic patterns - direct communication through shared queue, 
pub-sub, request-response - are all supported.

> 0.9.x gives us the equivalent of power
> tools, 1.0 instead makes you build the tools before you can ever get
> going.

No, you would get all the same tools from your broker.

> In this regard, 1.0 and ZeroMQ have a lot in common and of the
> two ZeroMQ is frankly the better choice. The point to having a broker
> is provide those messaging power tools so you can focus on your
> application.

And that is still the case. Brokers can provide exactly the same 
queueing and routing capabilities.

> Furthermore, any client library attempting to emulate
> queue/binding/exchange fabric primitives using 1.0 "bricks" would be
> doing so as a  non-standard convention, one that would have to be
> adopted by other library writers in exactly the same way to afford the
> cross-platform capabilities that 0.9.x has from day one as a draft
> standard.

The client library doesn't need to emulate that; it is brokers who will 
provide the equivalent functionality.

>> It is certainly not limited to - or even focused on - integration with
>> non-AMQP brokers though it is deliberately less imposing in terms of a
>> broker implementations internal architecture to promote even wider adoption.
>
> Quoting from a JPMorgan preso on 1.0 as to the design goals:
>
> * Simplify wire protocol
> * Global Addressing
> * Create a model more easy to retro-fit to legacy
> brokers
> * Extensible layered protocol
>
>
> All of these serve federation and integration (i.e. broker writers),
> not the app developer.
>
> THE reason nodes/links/filters became the new 1.0 primitives was
> precisely to enable easier federation with non-AMQP brokers.

No, the abstractions were generalised to be less prescriptive about the 
internals of a broker and to make the model simpler (e.g. no need to 
explicitly declare subscription queues for standard pub-sub pattern, let 
the broker do that for you) and more consistent (e.g. eliminate the need 
for clumsy workarounds like the default-exchange).

> Want to
> forward a message on to a federated broker? No problem, attach another
> link pointing to the federated broker with the right filter. 1.0
> exists to make life easier on broker implementers and integrators, not
> to help app developers/users. It puts the burden on the app developer
> to build up the actual primitive he wants. Again, ZMQ is a better 1.0
> than 1.0: it has similar primitives, is simpler, and doesn't pretend
> to be anything other than a transport erector set.

ZMQ does not have similar primitives. The primitives in AMQP 1.0 focus 
on reliable, flow controlled transfer of well defined message formats 
all of which are deliberately not addressed by ZeroMQ.

> As an OASIS standard now, I foresee AMQP 1.0 continuing on it's trek
> to serve it's corporate masters/designers...which would be fine if it
> didn't throw app developers and their productivity to the wolves as
> 1.0 has done.

As you say, we'll have to disagree. I am confident that app developers 
will be very productive on 1.0, but time will tell as they say ;-)

--Gordon.



From gsim at redhat.com  Fri Apr 20 21:35:50 2012
From: gsim at redhat.com (Gordon Sim)
Date: Fri, 20 Apr 2012 21:35:50 +0100
Subject: [rabbitmq-discuss] AMQP 1.0 Support
In-Reply-To: <4F91A703.6030006@250bpm.com>
References: <CAL7CndvbTh8WFiJGpyyE_NDqnNfrcxOjZ7ik-yfGeSWECrwz+A@mail.gmail.com>	<A8C38C42-E706-4A29-95A2-EFE20AECBF08@gmail.com>	<4F916339.7000102@redhat.com>	<CAHZAEpcNSz0r_gxKGMZ-osR3JVU5ykS=Ap5mDhh0vk38r+qQBg@mail.gmail.com>
	<4F91A703.6030006@250bpm.com>
Message-ID: <4F91C8A6.5050800@redhat.com>

On 04/20/2012 07:12 PM, Martin Sustrik wrote:
> I think Jason has a point in that AMQP/1.0 has deliberately dropped to
> "model" part of spec (i.e. exchanges/queues/bindings) which was the real
> meat of the protocol.

It has deliberately moved on from a model explicitly based on exchanges, 
binding and queues. It has generalised the model, making it simpler and 
more consistent, while supporting the same patterns.

I would disagree that the exchange/queue/binding was the real meat of AMQP.

> I have no idea what the reasons were. In any case it dumbs down the
> protocol to the extent where it becomes an ugly version of TCP built on
> top of TCP.

Beauty is in the eye of the beholder ;-) I don't think its fair to say 
it dumbs down the protocol though, as it is more capable than previous 
versions (more control over different options for reliability, more 
control over managing the flow of messages, standardised approaches to 
message signing etc).

The fact that TCP provides acking and flow control is not sufficient in 
many cases. An application level protocol still needs to have a solution 
to these, particularly one that aims to be a general protocol for 
asynchronous message transfer.

From jasonjwwilliams at gmail.com  Fri Apr 20 21:58:56 2012
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Fri, 20 Apr 2012 14:58:56 -0600
Subject: [rabbitmq-discuss] AMQP 1.0 Support
In-Reply-To: <4F91C67B.7080506@redhat.com>
References: <CAL7CndvbTh8WFiJGpyyE_NDqnNfrcxOjZ7ik-yfGeSWECrwz+A@mail.gmail.com>
	<A8C38C42-E706-4A29-95A2-EFE20AECBF08@gmail.com>
	<4F916339.7000102@redhat.com>
	<CAHZAEpcNSz0r_gxKGMZ-osR3JVU5ykS=Ap5mDhh0vk38r+qQBg@mail.gmail.com>
	<4F91C67B.7080506@redhat.com>
Message-ID: <CAHZAEpee=CC5KKhS3zsuucXsWzZBrZCsAUEhXPHez+aXa+hXfA@mail.gmail.com>

>
> Nodes are simply a more general concept covering queues or exchanges or
> indeed other types of messaging endpoints.

My point exactly..."build your own out of our primitives".


> Links are simply subscriptions (i.e. an indication of a desire to receive
> from a give queue/node) expanded to include an analogous concept for
> indicating the desire/intention to send to a given queue/node. That is
> useful for flow control and can enable faster routing decisions.
>
> The same basic patterns - direct communication through shared queue,
> pub-sub, request-response - are all supported.

It is not the totally async model 0.9 has where publishers don't have
to understand where their messages might end up due to exchanges. It's
up to both publisher and consumer nodes to build the elaborate
interconnections between them to emulate queues/exchange/bindings.



> No, you would get all the same tools from your broker.

No, but no point in arguing in circles.


>> In this regard, 1.0 and ZeroMQ have a lot in common and of the
>> two ZeroMQ is frankly the better choice. The point to having a broker
>> is provide those messaging power tools so you can focus on your
>> application.
>
>
> And that is still the case. Brokers can provide exactly the same queueing
> and routing capabilities.

....once you build it...


>
>
> The client library doesn't need to emulate that; it is brokers who will
> provide the equivalent functionality.

....once the client library tells the broker how to build an
equivalent set of nodes, links, and filters to create a queues,
exchanges and bindings. Since this is up to the client, this is
exactly what I was saying about replicating 0.9 primitives being by
convention of the library.



> No, the abstractions were generalised to be less prescriptive about the
> internals of a broker and to make the model simpler (e.g. no need to
> explicitly declare subscription queues for standard pub-sub pattern, let the
> broker do that for you) and more consistent (e.g. eliminate the need for
> clumsy workarounds like the default-exchange).

That's a new spin on what I've been hearing from those involved
directly for 2 years.


> ZMQ does not have similar primitives. The primitives in AMQP 1.0 focus on
> reliable, flow controlled transfer of well defined message formats all of
> which are deliberately not addressed by ZeroMQ.

ZMQ does offer reliable transfer and it's primitives are very similar.
It does also offer basic flow control.


> As you say, we'll have to disagree. I am confident that app developers will
> be very productive on 1.0, but time will tell as they say ;-)

Yes we will have to. I'm sure they'll be productive to the level of
WS-* and OASIS' other stable of technologies...

-J

From gsim at redhat.com  Fri Apr 20 22:38:45 2012
From: gsim at redhat.com (Gordon Sim)
Date: Fri, 20 Apr 2012 22:38:45 +0100
Subject: [rabbitmq-discuss] AMQP 1.0 Support
In-Reply-To: <CAHZAEpee=CC5KKhS3zsuucXsWzZBrZCsAUEhXPHez+aXa+hXfA@mail.gmail.com>
References: <CAL7CndvbTh8WFiJGpyyE_NDqnNfrcxOjZ7ik-yfGeSWECrwz+A@mail.gmail.com>	<A8C38C42-E706-4A29-95A2-EFE20AECBF08@gmail.com>	<4F916339.7000102@redhat.com>	<CAHZAEpcNSz0r_gxKGMZ-osR3JVU5ykS=Ap5mDhh0vk38r+qQBg@mail.gmail.com>	<4F91C67B.7080506@redhat.com>
	<CAHZAEpee=CC5KKhS3zsuucXsWzZBrZCsAUEhXPHez+aXa+hXfA@mail.gmail.com>
Message-ID: <4F91D765.1020601@redhat.com>

On 04/20/2012 09:58 PM, Jason J. W. Williams wrote:
> It is not the totally async model 0.9 has where publishers don't have
> to understand where their messages might end up due to exchanges.

It is. Your producer doesn't need to know any more about where messages 
end up than when publishing to an exchange. It simply sends messages to 
a named node on the broker (just like it would send to a named exchange 
pre 1.0).

> It's
> up to both publisher and consumer nodes to build the elaborate
> interconnections between them to emulate queues/exchange/bindings.

No, the broker provides all of that. You may need to create the broker 
node through which messages are flowing, much as you may need to create 
an exchange.

The producers don't need to know anything about the consumers however, 
and vice versa.

[...]
> ....once the client library tells the broker how to build an
> equivalent set of nodes, links, and filters to create a queues,
> exchanges and bindings. Since this is up to the client, this is
> exactly what I was saying about replicating 0.9 primitives being by
> convention of the library.

In 0.9, the publisher simply sends messages to the exchange. The 
subscriber indicates the messages it wants from that exchange (through 
bind requests).

In 1.0 the publisher sends messages to the node by establishing a link 
to the node and transferring messages over it. The subscriber indicates 
the messages it wants from the node by establishing a link from the 
node. That is standard, not convention.

Nodes are an extension point (as were exchanges before 1.0). I can 
define a new type of node behaviour for my broker, for example a last 
value queue, but this is no different from previous versions and it 
doesn't mean that applications themselves have to 'build their own'. The 
protocol for sending to- or subscribing to- the node however is standard 
and available to any 1.0 client (again just like a custom exchange would 
be).

[...]
> ZMQ does offer reliable transfer and it's primitives are very similar.
> It does also offer basic flow control.

Really? Can you give point me somewhere those are described?

--Gordon.

From jasonjwwilliams at gmail.com  Fri Apr 20 22:47:32 2012
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Fri, 20 Apr 2012 15:47:32 -0600
Subject: [rabbitmq-discuss] AMQP 1.0 Support
In-Reply-To: <4F91D765.1020601@redhat.com>
References: <CAL7CndvbTh8WFiJGpyyE_NDqnNfrcxOjZ7ik-yfGeSWECrwz+A@mail.gmail.com>
	<A8C38C42-E706-4A29-95A2-EFE20AECBF08@gmail.com>
	<4F916339.7000102@redhat.com>
	<CAHZAEpcNSz0r_gxKGMZ-osR3JVU5ykS=Ap5mDhh0vk38r+qQBg@mail.gmail.com>
	<4F91C67B.7080506@redhat.com>
	<CAHZAEpee=CC5KKhS3zsuucXsWzZBrZCsAUEhXPHez+aXa+hXfA@mail.gmail.com>
	<4F91D765.1020601@redhat.com>
Message-ID: <CAHZAEpd0fwVgRF6B0Kz58Bxj3duBmYjoyZ9WAC_FmpHdnU3W+A@mail.gmail.com>

> In 1.0 the publisher sends messages to the node by establishing a link to
> the node and transferring messages over it. The subscriber indicates the
> messages it wants from the node by establishing a link from the node. That
> is standard, not convention.

As you've stated the producer and consumer nodes need to know about
each other, which is not how an exchange operates, thus proving my
point. Emulating the behavior of an exchange would therefore be
convention.


> Really? Can you give point me somewhere those are described?

http://zguide.zeromq.org/

-J

From videlalvaro at gmail.com  Fri Apr 20 14:11:00 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 20 Apr 2012 15:11:00 +0200
Subject: [rabbitmq-discuss] what are message attributes used by broker
	in RABBITMQ
In-Reply-To: <29EDA52A-0C33-45D6-A427-FEA9BD244374@gmail.com>
References: <1334145243.23896.YahooMailNeo@web29703.mail.ird.yahoo.com>
	<4F8577F3.3060604@rabbitmq.com>
	<1334147886.33780.YahooMailNeo@web29704.mail.ird.yahoo.com>
	<4F85804C.70009@rabbitmq.com>
	<1334574888.94533.YahooMailNeo@web29704.mail.ird.yahoo.com>
	<4F8C024E.8040901@rabbitmq.com>
	<1334576533.63729.YahooMailNeo@web29703.mail.ird.yahoo.com>
	<4F8D40DE.60709@rabbitmq.com>
	<1334783134.40914.YahooMailNeo@web29701.mail.ird.yahoo.com>
	<4F8FDE71.9070405@rabbitmq.com>
	<1334839271.63644.YahooMailNeo@web29701.mail.ird.yahoo.com>
	<29EDA52A-0C33-45D6-A427-FEA9BD244374@gmail.com>
Message-ID: <1A4E5FF6-3BE8-4804-AB37-F8601618FC07@gmail.com>

Hi,

A direct exchange takes into account the routing key before delivering it to a queue. Actually it retrieves a list of queues bound to the exchange based on the routing key used to publish the message.

A fanout exchange ignores routing keys. It just retrieves the list of queues bound to the exchange.

A topic exchange takes into account the routing key. Same as with the direct exchange but in this case routing key matches are more complex than with the direct matching. See here: http://www.rabbitmq.com/blog/2010/09/14/very-fast-and-scalable-topic-routing-part-1/

Take a look at the descriptions here: http://www.rabbitmq.com/tutorials/amqp-concepts.html

RabbitMQ uses this version of the protocol: http://www.rabbitmq.com/amqp-0-9-1-quickref.html

Routing logic starts here: http://hg.rabbitmq.com/rabbitmq-server/file/a668b91616ba/src/rabbit_channel.erl#l617

I think this material is more than enough to start your research and continue from there.

Regards,

Alvaro
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120420/c96031d7/attachment.htm>

From dan.j.marques at gmail.com  Sat Apr 21 00:12:19 2012
From: dan.j.marques at gmail.com (Daniel Marques)
Date: Fri, 20 Apr 2012 19:12:19 -0400
Subject: [rabbitmq-discuss] AMQP 1.0 Support
In-Reply-To: <A8C38C42-E706-4A29-95A2-EFE20AECBF08@gmail.com>
References: <CAL7CndvbTh8WFiJGpyyE_NDqnNfrcxOjZ7ik-yfGeSWECrwz+A@mail.gmail.com>
	<A8C38C42-E706-4A29-95A2-EFE20AECBF08@gmail.com>
Message-ID: <CAL7CndvNyeyCWkyxhG9Q7Ry7hGU7qC8Au0qTd7obvG07hec3eQ@mail.gmail.com>

The reason I was drawn to AMQP was that the API (as far as I could tell
from the RabbitMQ tutorial) was fairly intuitive how I could implement the
communication patterns that my applications used.

Is there any documentation that describes the changes from 0.9x to 1.0?
 Does the AMQP group have any formal statement as to why they changed the
API so significantly?

Thanks.

Dan



On Fri, Apr 20, 2012 at 4:21 AM, Jason J. W. Williams <
jasonjwwilliams at gmail.com> wrote:

> Hi Daniel,
>
> AMQP 1.0 is so dissimilar from 0.9x that 1.0 should never have been called
> AMQP. It's literally as different as going from Gopher to HTTP.
>
> 1.0 is very difficult to use as an app developer. It solves a very narrow
> problem set best suited to integrating AMQP brokers better with other
> non-AMQP brokers. 1.0 is architecture astronauts at their best.
>
> Rabbit is fairly protocol agnostic... 1.0 support was mocked up to my
> understanding and was able to run alongside 0.9.1. So even if 1.0 took
> over, 0.9.1 support in Rabbit isn't going anywhere.
>
> In reality 0.9.1 is a much better protocol for getting real work done as
> an app developer. The primitives are higher level and much more useful for
> 99% of the tasks you'll likely want to do. As a result I don't think 0.9.1
> is going to go away...particularly amongst most AMQP users.
>
> Does that help?
>
> -J
>
> Sent via iPhone
>
> Is your email Premiere?
>
> On Apr 19, 2012, at 16:49, Daniel Marques <dan.j.marques at gmail.com> wrote:
>
> > Hello.
> >
> > (Absolute AMQP and RabbitMQ newbie here, so please point to the
> appropriate place for this discussion if this is not it.)
> >
> > We're about to embark on a new project, and am considering AMQP for it.
>  We're hoping to unify at least 4 different messaging/communication
> systems, and replace them with a single enterprise-wide message bus.  As we
> have apps in at least 3 languages, on 2 OSs, and would like remain
> vendor-independent, AMQP sounds like a good fit.  RabbitMQ seems like a
> great implementation for our needs.
> >
> > However, I'm concerned about the lack of a current AMQP 1.0
> implementation in RabbitMQ - I would hate to write the software using 0.9
> and have to rewrite it to support 1.0 once an implementation became
> available.  If other vendors implement 1.0, it is not clear that will keep
> support for 0.9 around, in which case I would not see the benefit of vendor
> independence.
> >
> > I guess I was just curious as to RabbitMQ's plans to implement (or not)
> 1.0 and what that timeline looked like.  I'd be also curious to hear how
> hard it would be to convert an application from 0.9 to 1.0.
> >
> > Thanks for your help.
> >
> > Dan
> >
> >
> >
> >
> >
> >
> >
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120420/83c5af10/attachment.htm>

From gsim at redhat.com  Sat Apr 21 00:21:42 2012
From: gsim at redhat.com (Gordon Sim)
Date: Sat, 21 Apr 2012 00:21:42 +0100
Subject: [rabbitmq-discuss] AMQP 1.0 Support
In-Reply-To: <CAHZAEpd0fwVgRF6B0Kz58Bxj3duBmYjoyZ9WAC_FmpHdnU3W+A@mail.gmail.com>
References: <CAL7CndvbTh8WFiJGpyyE_NDqnNfrcxOjZ7ik-yfGeSWECrwz+A@mail.gmail.com>	<A8C38C42-E706-4A29-95A2-EFE20AECBF08@gmail.com>	<4F916339.7000102@redhat.com>	<CAHZAEpcNSz0r_gxKGMZ-osR3JVU5ykS=Ap5mDhh0vk38r+qQBg@mail.gmail.com>	<4F91C67B.7080506@redhat.com>	<CAHZAEpee=CC5KKhS3zsuucXsWzZBrZCsAUEhXPHez+aXa+hXfA@mail.gmail.com>	<4F91D765.1020601@redhat.com>
	<CAHZAEpd0fwVgRF6B0Kz58Bxj3duBmYjoyZ9WAC_FmpHdnU3W+A@mail.gmail.com>
Message-ID: <4F91EF86.7080401@redhat.com>

On 04/20/2012 10:47 PM, Jason J. W. Williams wrote:
>> In 1.0 the publisher sends messages to the node by establishing a link to
>> the node and transferring messages over it. The subscriber indicates the
>> messages it wants from the node by establishing a link from the node. That
>> is standard, not convention.
>
> As you've stated the producer and consumer nodes need to know about
> each other,

No, they do not.

> which is not how an exchange operates, thus proving my
> point.

An exchange operates by having a publisher send messages to it and a 
subscriber bind their queue to it in order to receive (possibly a subset 
of) those messages.

Likewise in 1.0 the publisher publishes to the node and the subscriber 
links to it in order to receive (possible a subset of) those messages.

In neither case does the subscriber need to explicitly know about the 
publisher. They simply know about the exchange or, in 1.0 terminology, 
the node.

Of course prior to 1.0 you can have the subscriber simply subscribe to a 
pre configured queue and have the bindings set up as part of the 
configuration. The same is possible with the 1.0 model.

> Emulating the behavior of an exchange would therefore be
> convention.
>
>
>> Really? Can you give point me somewhere those are described?
>
> http://zguide.zeromq.org/

I'll take lack of anything more specific as confirmation that ZMQ does 
not offer primitives for reliability but deliberately leaves that to 
applications themselves.

From jasonjwwilliams at gmail.com  Sat Apr 21 03:04:43 2012
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Fri, 20 Apr 2012 20:04:43 -0600
Subject: [rabbitmq-discuss] AMQP 1.0 Support
In-Reply-To: <4F91EF86.7080401@redhat.com>
References: <CAL7CndvbTh8WFiJGpyyE_NDqnNfrcxOjZ7ik-yfGeSWECrwz+A@mail.gmail.com>
	<A8C38C42-E706-4A29-95A2-EFE20AECBF08@gmail.com>
	<4F916339.7000102@redhat.com>
	<CAHZAEpcNSz0r_gxKGMZ-osR3JVU5ykS=Ap5mDhh0vk38r+qQBg@mail.gmail.com>
	<4F91C67B.7080506@redhat.com>
	<CAHZAEpee=CC5KKhS3zsuucXsWzZBrZCsAUEhXPHez+aXa+hXfA@mail.gmail.com>
	<4F91D765.1020601@redhat.com>
	<CAHZAEpd0fwVgRF6B0Kz58Bxj3duBmYjoyZ9WAC_FmpHdnU3W+A@mail.gmail.com>
	<4F91EF86.7080401@redhat.com>
Message-ID: <E946F6E9-7966-4EA0-8DEE-B9FC655BDC09@gmail.com>



> I'll take lack of anything more specific as confirmation that ZMQ does not offer primitives for reliability but deliberately leaves that to applications themselves

Durable yes is up to the app, but reliability and durability are not the same thing. I'll take the lack of distinction as you painting them to be the same. 

-J

From Michael.Laing at nytimes.com  Sat Apr 21 13:27:46 2012
From: Michael.Laing at nytimes.com (Laing, Michael P.)
Date: Sat, 21 Apr 2012 08:27:46 -0400
Subject: [rabbitmq-discuss] Sender-selected distribution appears to not work
Message-ID: <CBB8194B.1F05%Michael.Laing@nytimes.com>

I would like to use this feature as documented at http://www.rabbitmq.com/blog/2011/03/ and http://www.rabbitmq.com/extensions.html

I tested both manually using the management console and with a coffeescript program but cannot make it work.

Of course it is possible ? even probable ? that I have an error in understanding? :)

My application is one where I would like to publish each message using multiple routing keys.

In general each subscriber will bind with one key.

Here is a test that fails both on my mac using RabbitMQ 2.7.1 / Erlang R15B and a linux box using RabbitMQ 2.7.1 / Erlang R14B:

# test.coffee
amqp = require 'amqp'

t1_message = (message, headers, properties) ->
  console.log ""+
    "\nSuccess: t1: message: #{JSON.stringify message}"+
    "\nheaders: #{JSON.stringify headers}"+
    "\nproperties: #{JSON.stringify properties, undefined, 4}"

  process.exit 0

t0_message = (message, headers, properties) ->
  console.log ""+
    "\nBroadcast: t0: message: #{JSON.stringify message}"+
    "\nheaders: #{JSON.stringify headers}"+
    "\nproperties: #{JSON.stringify properties, undefined, 4}"

bailout = ->
  console.log "\nFailure"
  process.exit 1

amqp_connection = amqp.createConnection()

amqp_connection.on 'ready', () ->
  properties = type:'topic', durable: true

  amqp_connection.exchange "test", properties, (exchange) ->
    properties = durable:true, autoDelete:false

    amqp_connection.queue "t1", properties, (queue) ->
      queue.bind exchange, "foo"

      queue.subscribe (message, headers, properties) ->
        t1_message message, headers, properties

      amqp_connection.queue "t0", properties, (queue) ->
        queue.bind exchange, "*"

        queue.subscribe (message, headers, properties) ->
          t0_message message, headers, properties

        cc_header = cc:["foo","bar"]
        properties = contentType:"application/json", headers:cc_header
        message = test:"message content"
        exchange.publish "whatever", message, properties
        setTimeout bailout, 1000

Here's the output ? if it had succeeded, both queues would have received the message:

Broadcast: t0: message: {"test":"message content"}
headers: {"cc":{"0":"foo","1":"bar"}}
properties: {
"contentType": "application/json",
"headers": {

        "cc": {
            "0": "foo",
            "1": "bar"
        }
    },
    "queue": "t0",
    "deliveryTag": 1,
    "redelivered": false,
    "exchange": "test",
    "routingKey": "whatever",
    "consumerTag": "node-amqp-38169-0.10587440640665591"
}

Failure
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120421/1668b6d9/attachment.htm>

From matthias at rabbitmq.com  Sat Apr 21 13:53:22 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 21 Apr 2012 13:53:22 +0100
Subject: [rabbitmq-discuss] Sender-selected distribution appears to not
 work
In-Reply-To: <CBB8194B.1F05%Michael.Laing@nytimes.com>
References: <CBB8194B.1F05%Michael.Laing@nytimes.com>
Message-ID: <4F92ADC2.5050509@rabbitmq.com>

On 21/04/12 13:27, Laing, Michael P. wrote:
> I would like to use this feature as documented at
> http://www.rabbitmq.com/blog/2011/03/ and
> http://www.rabbitmq.com/extensions.html
>
> I tested both manually using the management console and with a
> coffeescript program but cannot make it work.
>
> Of course it is possible ? even probable ? that I have an error in
> understanding? :)

s/cc/CC

See also the example at 
http://hg.rabbitmq.com/rabbitmq-java-client/file/default/test/src/com/rabbitmq/client/test/functional/CcRoutes.java 
for clues.

Matthias.

From Michael.Laing at nytimes.com  Sat Apr 21 14:05:48 2012
From: Michael.Laing at nytimes.com (Laing, Michael P.)
Date: Sat, 21 Apr 2012 09:05:48 -0400
Subject: [rabbitmq-discuss] Sender-selected distribution appears to not
 work
In-Reply-To: <4F92ADC2.5050509@rabbitmq.com>
Message-ID: <CBB82795.1F3C%Michael.Laing@nytimes.com>

Unfortunately, testing via the management console returns this:

406 PRECONDITION_FAILED - invalid message:
{unacceptable_type_in_header,longstr,"CC"}


(although it's not really clear how to enter an array in the field)

Testing via my program returns something similar:

Unhandled channel error: PRECONDITION_FAILED - invalid message:
{unacceptable_type_in_header,table,"CC"}


It seems to reject "CC" as a header.

ml

On 4/21/12 8:53 AM, "Matthias Radestock" <matthias at rabbitmq.com> wrote:

>On 21/04/12 13:27, Laing, Michael P. wrote:
>> I would like to use this feature as documented at
>> http://www.rabbitmq.com/blog/2011/03/ and
>> http://www.rabbitmq.com/extensions.html
>>
>> I tested both manually using the management console and with a
>> coffeescript program but cannot make it work.
>>
>> Of course it is possible ? even probable ? that I have an error in
>> understanding? :)
>
>s/cc/CC
>
>See also the example at
>http://hg.rabbitmq.com/rabbitmq-java-client/file/default/test/src/com/rabb
>itmq/client/test/functional/CcRoutes.java
>for clues.
>
>Matthias.


From matthias at rabbitmq.com  Sat Apr 21 14:15:22 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 21 Apr 2012 14:15:22 +0100
Subject: [rabbitmq-discuss] Sender-selected distribution appears to not
 work
In-Reply-To: <CBB82795.1F3C%Michael.Laing@nytimes.com>
References: <CBB82795.1F3C%Michael.Laing@nytimes.com>
Message-ID: <4F92B2EA.3080207@rabbitmq.com>

On 21/04/12 14:05, Laing, Michael P. wrote:
> Unfortunately, testing via the management console returns this:
>
> 406 PRECONDITION_FAILED - invalid message:
> {unacceptable_type_in_header,longstr,"CC"}
>
>
> (although it's not really clear how to enter an array in the field)
>
> Testing via my program returns something similar:
>
> Unhandled channel error: PRECONDITION_FAILED - invalid message:
> {unacceptable_type_in_header,table,"CC"}
>
>
> It seems to reject "CC" as a header.

The header value needs to be an AMQP 'array'. Unfortunately I have no 
idea how to enter that in the management UI or how to produce such a 
header in the client library you are using.

Matthias.

From Michael.Laing at nytimes.com  Sat Apr 21 14:25:22 2012
From: Michael.Laing at nytimes.com (Laing, Michael P.)
Date: Sat, 21 Apr 2012 09:25:22 -0400
Subject: [rabbitmq-discuss] Sender-selected distribution appears to not
 work
In-Reply-To: <4F92B2EA.3080207@rabbitmq.com>
Message-ID: <CBB82C0E.1F4A%Michael.Laing@nytimes.com>

If I quote the "CC" in the management console, I no longer get the 406
failure.

But my 'guessed at' format for array args in the console didn't work: I'll
experiment a bit.

And I'll dive into the client library for my test program.

I can always switch from nodejs to ruby if necessary. The nodejs library
is quite sketchy, unfortunately.

Thanks!

ml

On 4/21/12 9:15 AM, "Matthias Radestock" <matthias at rabbitmq.com> wrote:

>On 21/04/12 14:05, Laing, Michael P. wrote:
>> Unfortunately, testing via the management console returns this:
>>
>> 406 PRECONDITION_FAILED - invalid message:
>> {unacceptable_type_in_header,longstr,"CC"}
>>
>>
>> (although it's not really clear how to enter an array in the field)
>>
>> Testing via my program returns something similar:
>>
>> Unhandled channel error: PRECONDITION_FAILED - invalid message:
>> {unacceptable_type_in_header,table,"CC"}
>>
>>
>> It seems to reject "CC" as a header.
>
>The header value needs to be an AMQP 'array'. Unfortunately I have no
>idea how to enter that in the management UI or how to produce such a
>header in the client library you are using.
>
>Matthias.


From brendan at soundcloud.com  Sat Apr 21 17:01:44 2012
From: brendan at soundcloud.com (Brendan Hay)
Date: Sat, 21 Apr 2012 18:01:44 +0200
Subject: [rabbitmq-discuss] Redefining queue/exchange attributes
In-Reply-To: <4F91952D.9070905@rabbitmq.com>
References: <CAFDmHdORq02g8zAR4S36G9_1GPt_x5QotqOYVx6FaZqH29gsHg@mail.gmail.com>
	<4F91952D.9070905@rabbitmq.com>
Message-ID: <CAHZsVQaF2Eo1XN1Fwc0UoPJqxeu9WQb-4KmAiNJPFCKGOnE19Q@mail.gmail.com>

>
> However, we're more likely to go in the direction of having things like
> HA-ness defined outside of the AMQP arguments mechanism altogether in future



> The application should not have to know that its queues are HA or its
> exchanges are federated; that's a matter for the broker administrator


Great to hear that you've got that in mind, Simon! It would improve
things immeasurably for both application code, broker management,
and coincidentally is my biggest gripe with the current state of RabbitMQ
HA. Would love to see work in that direction sometime in the future.

- Brendan

On Fri, Apr 20, 2012 at 6:56 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> We're aware that the current situation with HA policies is inconvenient;
> it was the simplest thing that could possibly work.
>
> However, we're more likely to go in the direction of having things like
> HA-ness defined outside of the AMQP arguments mechanism altogether in
> future. Really arguments should be for things that application authors care
> about; it's a contract with the application that these should not change.
> The application should not have to know that its queues are HA or its
> exchanges are federated; that's a matter for the broker administrator.
>
> Cheers, Simon
>
>
> On 20/04/12 17:51, Elias Levy wrote:
>
>> Are there any plans to allow the modification of queue and exchange
>> attributes, say via the REST API?
>>
>> At the moment if one must redefine the attributes of a queue or
>> exchange, you must destroy the queue or exchange and recreate it.  That
>> is rather disruptive in a production environment.  If means that
>> bindings are destroyed and must be recreated, that consumers must
>> restart their subscriptions, etc.
>>
>> There are many scenarios where one would want to redefine the
>> attributes.  Either an error crept in during initial set up, or say, a
>> node has gone down and you want to redefine a HA queue by removing the
>> dead node from its config and adding a new node.
>>
>> Thoughts?
>>
>> Elias Levy
>>
>>
>>
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120421/6699dbbd/attachment.htm>

From videlalvaro at gmail.com  Sat Apr 21 17:37:35 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Sat, 21 Apr 2012 18:37:35 +0200
Subject: [rabbitmq-discuss] Missing dependency in management plugin/mochiweb
Message-ID: <3C92E5FA26164AD4AF31A8A37E031605@gmail.com>

Hi, 

Similar to xmerl last week I think either mochiweb or the management plugin should declare a dependecy on the inets app.

Regards,

Alvaro 

-- 
Sent with Sparrow (http://www.sparrowmailapp.com/?sig)

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120421/19c60d15/attachment.htm>

From Michael.Laing at nytimes.com  Sun Apr 22 00:45:47 2012
From: Michael.Laing at nytimes.com (Laing, Michael P.)
Date: Sat, 21 Apr 2012 19:45:47 -0400
Subject: [rabbitmq-discuss] Sender-selected distribution appears to not
 work
In-Reply-To: <CBB82C0E.1F4A%Michael.Laing@nytimes.com>
Message-ID: <CBB8BBFC.1F5A%Michael.Laing@nytimes.com>

The client library for nodejs, 'amqp', does not have support for the amqp
array data type in headers; I reported it.

So, just to wrap this up, I switched to ruby, and sender-selected
distribution worked as expected.

I will be implementing my app in ruby or python I guess - at least the
publisher portion.

Here's a ruby equivalent to the coffeescript I posted earlier; the message
is delivered to both queues:

#!/usr/bin/env ruby
# encoding: utf-8

require "rubygems"
require 'amqp'
require 'json'
require 'time'

EventMachine.run do
  AMQP.connect() do |connection|
    AMQP::Channel.new(connection) do |channel, open_ok|
      channel.on_error{|ch, err| puts "channel error: #{err.reply_text}"}
      exchange = channel.topic "test", :durable => true, :autoDelete =>
false
      t1_q = channel.queue "t1", :durable => true, :autoDelete => false
      

      t1_q.bind(exchange, :key => "foo").subscribe do |properties, message|
        puts(
          "\n#{Time.now.utc.iso8601(6)} got t1 (success)"+
          "\n  message: #{message}"+
          "\n  properties: #{properties.attributes.inspect}"
        )
      End
      

      t0_q = channel.queue "t0", :durable => true

      t0_q.bind(exchange, :key => "*").subscribe do |properties, message|
        puts(
          "\n#{Time.now.utc.iso8601(6)} got t0 (expected)"+
          "\n  message: #{message}"+
          "\n  properties: #{properties.attributes.inspect}"
        )
      End

      
      message = {:test => "message"}
      cc_header = ["foo","bar"] # note array

      
      exchange.publish(
        message.to_json(),
        :routing_key => "whatever",
        :headers => {:CC => cc_header},
        :content_type => "application/json"
      )
    end
  end
end




On 4/21/12 9:25 AM, "Laing, Michael P." <Michael.Laing at nytimes.com> wrote:

>If I quote the "CC" in the management console, I no longer get the 406
>failure.
>
>But my 'guessed at' format for array args in the console didn't work: I'll
>experiment a bit.
>
>And I'll dive into the client library for my test program.
>
>I can always switch from nodejs to ruby if necessary. The nodejs library
>is quite sketchy, unfortunately.
>
>Thanks!
>
>ml
>
>On 4/21/12 9:15 AM, "Matthias Radestock" <matthias at rabbitmq.com> wrote:
>
>>On 21/04/12 14:05, Laing, Michael P. wrote:
>>> Unfortunately, testing via the management console returns this:
>>>
>>> 406 PRECONDITION_FAILED - invalid message:
>>> {unacceptable_type_in_header,longstr,"CC"}
>>>
>>>
>>> (although it's not really clear how to enter an array in the field)
>>>
>>> Testing via my program returns something similar:
>>>
>>> Unhandled channel error: PRECONDITION_FAILED - invalid message:
>>> {unacceptable_type_in_header,table,"CC"}
>>>
>>>
>>> It seems to reject "CC" as a header.
>>
>>The header value needs to be an AMQP 'array'. Unfortunately I have no
>>idea how to enter that in the management UI or how to produce such a
>>header in the client library you are using.
>>
>>Matthias.
>


From matthias at rabbitmq.com  Sun Apr 22 09:23:21 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 22 Apr 2012 09:23:21 +0100
Subject: [rabbitmq-discuss] Sender-selected distribution appears to not
 work
In-Reply-To: <CBB8BBFC.1F5A%Michael.Laing@nytimes.com>
References: <CBB8BBFC.1F5A%Michael.Laing@nytimes.com>
Message-ID: <4F93BFF9.4090506@rabbitmq.com>

On 22/04/12 00:45, Laing, Michael P. wrote:
> So, just to wrap this up, I switched to ruby, and sender-selected
> distribution worked as expected.

Glad you got it working in the end. I have filed a bug to improve our 
documentation in this area.

> The client library for nodejs, 'amqp', does not have support for the amqp
> array data type in headers; I reported it.

I would hope that is easy to fix. Perhaps you could try producing a patch.

Matthias.

From ooostin at gmail.com  Sat Apr 21 00:46:22 2012
From: ooostin at gmail.com (Alexey Ostin)
Date: Sat, 21 Apr 2012 03:46:22 +0400
Subject: [rabbitmq-discuss] One message instance in couple of queues
In-Reply-To: <4F919620.20305@rabbitmq.com>
References: <3fae4c5f-8721-4d63-9e9c-0f31923cf590@j3g2000vba.googlegroups.com>
	<4F919620.20305@rabbitmq.com>
Message-ID: <CAFqMQdV2EJSbA6FJNc+11tFUtiL3cuQine=XgQkb7o99=ur+6A@mail.gmail.com>

Let me show one more example.

I've got some moderation queue. Whenever a moderator locks message (or
several messages) for moderation, it moves from main queue to personal
moderator's queue. Just to perform some long time lock (It can be minute or
hour, thus I can't use ack/nack to hold message in main queue). The goal is
to monitor all moderators queues as well as main one. The problem is that I
do not know all moderator's queues and I can't just monitor some fixed list
because it regenerates dynamically.

I've just thought about using separate exchange for moderator's queues. It
can help with monitoring, I'd watch over whole exchange.
But it is still interesting whether I can publish message to several queues
and consume it from them all at once. Sounds like gibberish.

To be honest I've got one more problem to solve - it is to automatically
release these locks (put a message from moderator's queue back to main) by
timeout, but it should be other conversation I think :)

Best regards, Ostin.

20 ?????? 2012 ?. 21:00 ???????????? Simon MacMullen
<simon at rabbitmq.com>???????:

> On 20/04/12 17:27, ostin wrote:
>
>> Example application with topic exchange:
>> I push a message to server1.app1 queue and an other one to
>> server1.app2 queue. I monitor server1 queue to determine count of
>> processing messages on server 1. After app1 ends processing message it
>> shold be deleted from both queues: from app1 to prevent duplicate
>> processing, from server1 to have valid stats for monitoring. I assume
>> that there can be many applications with random names, so I cant
>> monitor just count of messages in app* queues.
>>
>
> If you want to make sure that a given message is only ever consumed from
> server1.app1 OR server1.app2, why not have only a single queue and have
> both applications consume from it?
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120421/44d4a36f/attachment.htm>

From andrea.rosa at hp.com  Mon Apr 23 12:20:59 2012
From: andrea.rosa at hp.com (Rosa, Andrea (HP Cloud Services))
Date: Mon, 23 Apr 2012 11:20:59 +0000
Subject: [rabbitmq-discuss] log process
Message-ID: <5F389C517756284F80239F55BCA5DDDD36963612@G9W0721.americas.hpqcorp.net>

Hi all,

I had a strange issue with Rabbitmq 2.7.1 running on a linux box.

Rabbitmq didn't produce log files for 5 days, from the .log.1 to .log file there is a gap of 5 days and the last entry in the .log.1 is something related to log rotate:

INFO REPORT==== 15-Apr-2012::06:30:37 === Rotating logs with suffix  ''

The server was running during this gap and it's impossible not to have log entries in the log file as our system was running and producing entries.

I'd like to know if the log process for Rabbit is executed in a separated process and maybe this process died.
We restarted the service and the file log start to be "normal".

Someone has seen it before?
Thanks
--
Andrea Rosa

From gsim at redhat.com  Mon Apr 23 13:41:48 2012
From: gsim at redhat.com (Gordon Sim)
Date: Mon, 23 Apr 2012 13:41:48 +0100
Subject: [rabbitmq-discuss] AMQP 1.0 Support
In-Reply-To: <E946F6E9-7966-4EA0-8DEE-B9FC655BDC09@gmail.com>
References: <CAL7CndvbTh8WFiJGpyyE_NDqnNfrcxOjZ7ik-yfGeSWECrwz+A@mail.gmail.com>
	<A8C38C42-E706-4A29-95A2-EFE20AECBF08@gmail.com>
	<4F916339.7000102@redhat.com>
	<CAHZAEpcNSz0r_gxKGMZ-osR3JVU5ykS=Ap5mDhh0vk38r+qQBg@mail.gmail.com>
	<4F91C67B.7080506@redhat.com>
	<CAHZAEpee=CC5KKhS3zsuucXsWzZBrZCsAUEhXPHez+aXa+hXfA@mail.gmail.com>
	<4F91D765.1020601@redhat.com>
	<CAHZAEpd0fwVgRF6B0Kz58Bxj3duBmYjoyZ9WAC_FmpHdnU3W+A@mail.gmail.com>
	<4F91EF86.7080401@redhat.com>
	<E946F6E9-7966-4EA0-8DEE-B9FC655BDC09@gmail.com>
Message-ID: <4F954E0C.9060507@redhat.com>

On 04/21/2012 03:04 AM, Jason J. W. Williams wrote:
>
>
>> I'll take lack of anything more specific as confirmation that ZMQ does not offer primitives for reliability but deliberately leaves that to applications themselves
>
> Durable yes is up to the app, but reliability and durability are not the same thing. I'll take the lack of distinction as you painting them to be the same.

I'm not concerned with durability here (or I would have said so), but 
with _reliability_.

I see nothing in the API reference or the protocol specification to 
corroborate the assertion that ZMQ has similar primitives for 
reliability to AMQP.

The guide discusses reliability patterns that applications can build 
themselves given ZMQ does not provide primitives for that. (I'm not 
criticising that decision, merely clarifying the facts).



From dawgtool at aol.com  Mon Apr 23 14:54:59 2012
From: dawgtool at aol.com (DawgTool)
Date: Mon, 23 Apr 2012 09:54:59 -0400
Subject: [rabbitmq-discuss] Per-Connection Flow Control - RMQ 2.8.1
In-Reply-To: <4F8BFAB7.1070706@rabbitmq.com>
References: <4F6CD702.4050908@aol.com>
	<4F704404.8080504@rabbitmq.com>	<4F728392.5070602@aol.com>
	<4F72E8A4.1010609@rabbitmq.com> <4F730718.6080908@rabbitmq.com>
	<4F86EC12.7030602@aol.com> <4F8BFAB7.1070706@rabbitmq.com>
Message-ID: <4F955F33.9020003@aol.com>

Hi Simon,

Here are some stats on a few runs, modifying the flow control limits.
Attached is some graphs I created to show the memory consumption.

Test 1-5 all on a 16core/96gb server

Publisher(s): 4
Exchange(s): 1
Exchange Type(s): Topic
Topic Wildcards: 1234.#; 2345.#; 3456.#; (etc)
Queue Binding(s): 15
Active Queue(s): 2
Queue Type(s): Durable, TTL: 90,000
Consumer(s): 0

Modified File(s): (variables: X, Y)
X: 4000; 8000; 16000; 32000
Y: 1000; 2000; 4000; 8000

src/credit_flow.erl
-define(DEFAULT_CREDIT, {"X", "Y"}).

src/rabbit_amqqueue.erl
-define(MORE_CONSUMER_CREDIT_AFTER, "Y").

src/rabbit_amqqueue_process.erl
-define(UNSENT_MESSAGE_LIMIT,          "X").

It appears that at some point the non-persistent data is dropped to disk 
(most cases were ~4GB total memory).
Locking is occurring before the 4GB mark, usually within a few minutes 
or seconds (depending on the flow control setting).

Please let me know if you would like to discuss.

Thanks

On 4/16/12 6:55 AM, Simon MacMullen wrote:
> I would have thought that in your scenario you would be more bound by 
> disc performance than anything else - aren't you having messages 
> paging off the disc and being expired?
>
> Just to be clear, do you have a message rate for your use case that 
> leads to *stable* memory use in 2.7.1 but which cannot be maintained 
> by 2.8.1? I was unable to find one with my attempts at replicating 
> your scenario.
>
> Cheers, Simon
>
> On 12/04/12 15:52, DawgTool wrote:
>> Hi Simon,
>>
>> Just a quick update. I have collected some stats, but mostly looking at
>> the rabbitmqctl list_channels. Anyway, I will get those graphed at some
>> point.
>>
>> I did however build the same setup (2.8.1/R15B) on a 16 core/96GB
>> machine and I hit the same limits as the 4 core/16GB.
>>
>> So right now it doesn't appear to be a 'horse-power' issue, possible its
>> a logic/functional issue. Let me know what you think.
>>
>> Thanks
>>
>>
>> On 3/28/12 8:42 AM, Simon MacMullen wrote:
>>> On 28/03/12 11:32, Simon MacMullen wrote:
>>>> I will try to reproduce based on the above, but anything else you can
>>>> tell me would be a great help.
>>>
>>> Hmm, I'm struggling with this.
>>>
>>> I can certainly get into a state with a combination of x-message-ttl,
>>> lots of messages expiring, and enough memory pressure to push much of
>>> the queue onto disc, such that the queue performance fluctuates quite
>>> a bit (as it switches between accepting new messages / paging messages
>>> out to disc / paging them back in / expiring them).
>>>
>>> But I can't get a message rate that works OK in this scenario with
>>> flow control disabled but blocks for long periods with it enabled. If
>>> the message rate is high enough for flow control to kick in, then it's
>>> also high enough for memory use to go up as messages wait to enter the
>>> queue if flow control is disabled. Eventually the memory alarm goes
>>> off instead.
>>>
>>> So can you provide more information about your use pattern?
>>>
>>> Having said that, if you just want to disable flow control and are
>>> prepared to build from source, you could apply the following patch:
>>>
>>> diff -r f0dafaca6cd1 src/rabbit_reader.erl
>>> --- a/src/rabbit_reader.erl Mon Mar 26 17:12:41 2012 +0100
>>> +++ b/src/rabbit_reader.erl Wed Mar 28 13:40:03 2012 +0100
>>> @@ -360,7 +360,7 @@
>>>
>>> control_throttle(State = #v1{connection_state = CS,
>>> conserve_memory = Mem}) ->
>>> - case {CS, Mem orelse credit_flow:blocked()} of
>>> + case {CS, Mem} of
>>> {running, true} -> State#v1{connection_state = blocking};
>>> {blocking, false} -> State#v1{connection_state = running};
>>> {blocked, false} -> ok = rabbit_heartbeat:resume_monitor(
>>>
>>> But I would like to understand more about what you're seeing.
>>>
>>> Cheers, Simon
>>>
>>
>
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120423/761a3cc8/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: RabbitMQ2.8.1Custom.2012-04-23.jpg
Type: image/jpeg
Size: 697269 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120423/761a3cc8/attachment.jpg>

From sustrik at 250bpm.com  Mon Apr 23 15:02:20 2012
From: sustrik at 250bpm.com (Martin Sustrik)
Date: Mon, 23 Apr 2012 16:02:20 +0200
Subject: [rabbitmq-discuss] AMQP 1.0 Support
In-Reply-To: <4F954E0C.9060507@redhat.com>
References: <CAL7CndvbTh8WFiJGpyyE_NDqnNfrcxOjZ7ik-yfGeSWECrwz+A@mail.gmail.com>	<A8C38C42-E706-4A29-95A2-EFE20AECBF08@gmail.com>	<4F916339.7000102@redhat.com>	<CAHZAEpcNSz0r_gxKGMZ-osR3JVU5ykS=Ap5mDhh0vk38r+qQBg@mail.gmail.com>	<4F91C67B.7080506@redhat.com>	<CAHZAEpee=CC5KKhS3zsuucXsWzZBrZCsAUEhXPHez+aXa+hXfA@mail.gmail.com>	<4F91D765.1020601@redhat.com>	<CAHZAEpd0fwVgRF6B0Kz58Bxj3duBmYjoyZ9WAC_FmpHdnU3W+A@mail.gmail.com>	<4F91EF86.7080401@redhat.com>	<E946F6E9-7966-4EA0-8DEE-B9FC655BDC09@gmail.com>
	<4F954E0C.9060507@redhat.com>
Message-ID: <4F9560EC.8010509@250bpm.com>

On 23/04/12 14:41, Gordon Sim wrote:

> I see nothing in the API reference or the protocol specification to
> corroborate the assertion that ZMQ has similar primitives for
> reliability to AMQP.
>
> The guide discusses reliability patterns that applications can build
> themselves given ZMQ does not provide primitives for that. (I'm not
> criticising that decision, merely clarifying the facts).

It's using TCP (standard sliding window algorithm) to ensure reliability.

The interesting question is what *additional* reliability guarantees 
does AMQP (or, as a matter of fact, by any other messaging protocol) 
provide on top of TCP. That's a question that's bugging me for years and 
I haven't found an answer yet.

IIRC I've asked it during the "message broker websocket subsprotocol" 
IETF discussion with Mark Hapner (author of JMS) and Clebert Suconic 
(current HornetQ project lead) but never got an answer.

Anyway, I think we've strayed pretty far away from the intended topic of 
this mailing list.

Martin


From gsim at redhat.com  Mon Apr 23 15:50:00 2012
From: gsim at redhat.com (Gordon Sim)
Date: Mon, 23 Apr 2012 15:50:00 +0100
Subject: [rabbitmq-discuss] AMQP 1.0 Support
In-Reply-To: <4F9560EC.8010509@250bpm.com>
References: <CAL7CndvbTh8WFiJGpyyE_NDqnNfrcxOjZ7ik-yfGeSWECrwz+A@mail.gmail.com>	<A8C38C42-E706-4A29-95A2-EFE20AECBF08@gmail.com>	<4F916339.7000102@redhat.com>	<CAHZAEpcNSz0r_gxKGMZ-osR3JVU5ykS=Ap5mDhh0vk38r+qQBg@mail.gmail.com>	<4F91C67B.7080506@redhat.com>	<CAHZAEpee=CC5KKhS3zsuucXsWzZBrZCsAUEhXPHez+aXa+hXfA@mail.gmail.com>	<4F91D765.1020601@redhat.com>	<CAHZAEpd0fwVgRF6B0Kz58Bxj3duBmYjoyZ9WAC_FmpHdnU3W+A@mail.gmail.com>	<4F91EF86.7080401@redhat.com>	<E946F6E9-7966-4EA0-8DEE-B9FC655BDC09@gmail.com>
	<4F954E0C.9060507@redhat.com> <4F9560EC.8010509@250bpm.com>
Message-ID: <4F956C18.5040304@redhat.com>

On 04/23/2012 03:02 PM, Martin Sustrik wrote:
> The interesting question is what *additional* reliability guarantees
> does AMQP (or, as a matter of fact, by any other messaging protocol)
> provide on top of TCP. That's a question that's bugging me for years and
> I haven't found an answer yet.

It allows reliability to be defined in terms that are useful to the 
application layer.

The fact that the packet has made it to the remote host and been acked 
at the TCP level - even if that was somehow exposed through the socket 
API - does not mean that the message it is part of has been successfully 
processed.

--Gordon.

From mark.geib at echostar.com  Mon Apr 23 18:32:16 2012
From: mark.geib at echostar.com (geib)
Date: Mon, 23 Apr 2012 10:32:16 -0700 (PDT)
Subject: [rabbitmq-discuss] 2.4.1 broker failure/crash
In-Reply-To: <20120418210220.GB30018@wellquite.org>
References: <26652355.2332.1334779942949.JavaMail.geo-discussion-forums@ynaz34>
	<20120418210220.GB30018@wellquite.org>
Message-ID: <33732491.post@talk.nabble.com>


Matthew,

Sorry, had an issue with google groups, did not see any reply to either
postings.

Mark.


Matthew Sackman-3 wrote:
> 
> Hi Mark,
> 
> Did you not see my reply from this morning?
> 
> This was a known bug that has since been fixed. 2.4.1 is rather old now,
> and the easiest thing to do is upgrade to the current which is 2.8.1.
> 
> Best wishes,
> 
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://old.nabble.com/2.4.1-broker-failure-crash-tp33710406p33732491.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From nithyanirmal at gmail.com  Mon Apr 23 19:29:59 2012
From: nithyanirmal at gmail.com (Nithya Vijayakumar)
Date: Mon, 23 Apr 2012 11:29:59 -0700
Subject: [rabbitmq-discuss] How to remove a node from cluster without
	loosing data?
Message-ID: <CAJinw2pXYuA2Rb9i_KFEPbuj_1QyuaJ6XucaycTnij8Fm5SKAw@mail.gmail.com>

Hi,

Have a quick question regarding the steps to remove a node from a cluster.

I have a two node cluster and I want to remove the second node. In the
first node, I updated the /etc/rabbitmq/rabbitmq.config file with just the
first node's info and restarted rabbitmq including epmd. It still forms a
cluster with the second node. The second node was up and rabbitmq
application was running. I tried again after stopping the second node
rabbitmq, but the first node says it is still in cluster mode with the
second one.

I tried rabbitmqctl stop_app, rabbitmqctl reset and rabbitmqctl start_app
on the first node. This worked but all my queues and users on node one were
gone. I don't think this is right, I must be missing something.

Please help with the correct steps to remove the second node from cluster
and make the first node still retain the data.

Thanks!
Nithya
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120423/d86b57a2/attachment.htm>

From mpietrek at skytap.com  Mon Apr 23 21:41:42 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Mon, 23 Apr 2012 13:41:42 -0700
Subject: [rabbitmq-discuss] Cleaning up after a rabbitmq-server install
In-Reply-To: <20120409130217.GA15896@wellquite.org>
References: <CACLE7ixJa=VmrREd=KzuoNmGKtnprc4dL_rn7ecvoNFUeH_KpQ@mail.gmail.com>
	<20120409130217.GA15896@wellquite.org>
Message-ID: <CACLE7iwyTwnVUbzB=87mmEFSw4DoupsA4nAcXSWqzr5ZwQ_oeg@mail.gmail.com>

Hey Matthew,

Sorry for the delayed response - Was out of town for two weeks and
just got backed.

I understand rabbit's default choice to leave the service running
after installing - It makes the "new user" scenario much less error
prone. However, in production environments where state is very
explicitly controlled, it's considered bad form (at least around here)
to combine "installed" and "running" into a single state. We have very
explicit states, e.g.

- Install/configure services for execution - After this completes,
nothing should "just happen" to be running
- Launch services


Regarding your last point, making the user configurable via debconf,
that sounds like exactly like what we need. Please add it to whatever
request list you have!

Thanks,

Matt


On Mon, Apr 9, 2012 at 6:02 AM, Matthew Sackman <matthew at rabbitmq.com> wrote:
> Hi Matt,
>
> On Fri, Apr 06, 2012 at 09:51:04AM -0700, Matt Pietrek wrote:
>> Now, for a run-of-the-mill installation of some service ("apt-get
>> install <program-name>" ), I wouldn't expect anything to be left
>> running after the install completes. That is, installing a program
>> shouldn't just automatically leave the program running after
>> installing it, as well as other running bits and pieces.
>
> Hmm. My recollection is that installing things like apache, nginx,
> postgresql etc etc (i.e. system daemons) does exactly that and leaves
> them running. Please correct me if I'm wrong there, but I don't think we
> do anything abnormal.
>
>> However, I don't see a way to tell the rabbitmq-server install to just
>> drop the bits, and not leave anything running.
>
> Oh, there's probably some bizarre dpkg incantation that can do that -
> probably just "don't run the postinstall" or something, but that might
> leave the package in a badly configured state. Again, do other system
> daemons provide this sort of option? If so, how? We'll be more than
> happy to cope whatever is the standard way of achieving this for Debian.
>
>> The issue is: We don't want these leftover processes running as the
>> rabbitmq user hanging around after puppet completes. I've experimented
>> with adding "epmd -kill" to the Puppet scripts, and it successfully
>> kills epmd on about 30% of the nodes, but it fails (exit code != 0) on
>> the other 70%.
>
> Hmm, that suggests that we should probably have the user configurable
> via debconf, and then you can probably pre-seed the answers there. What
> do you reckon?
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From uday.subbarayan at yahoo.com  Tue Apr 24 00:45:38 2012
From: uday.subbarayan at yahoo.com (Uday Subbarayan)
Date: Mon, 23 Apr 2012 16:45:38 -0700 (PDT)
Subject: [rabbitmq-discuss] JavaScript Client
Message-ID: <1335224738.5010.YahooMailNeo@web44903.mail.sp1.yahoo.com>

Folks,
? ? ? ? I am looking for a JavaScript lib with callback to receive messages when a new message is posted in a queue in ?Rabbit MQ. I did research and understand discussions like this:
http://groups.google.com/group/rabbitmq-discuss/browse_thread/thread/6f9028fa34035331?pli=1?


Is,
Browser(Socket.IO)-----> Node.js---> Rabbit MQ
is the best solution with security?

Thanks,
-Uday.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120423/7040eb9e/attachment.htm>

From tbw at rg6.org  Mon Apr 23 20:47:16 2012
From: tbw at rg6.org (theBuckWheat)
Date: Mon, 23 Apr 2012 12:47:16 -0700 (PDT)
Subject: [rabbitmq-discuss]  Which RabbitMQ approach/pattern to use?
Message-ID: <33732871.post@talk.nabble.com>


My application sends a work file out to one of several available remote
slaves.    When the slave is done with the work, it posts a callback notice
and stands by for the master to fetch the results file.   When that file has
been downloaded, after a little housekeeping, the slave can be put on the
list of those available to send work.  

What is the best que structure to use with RabbitMQ to dispatch work to the
pool of slaves?  I have to manage the list of slaves because some might be
close to their bandwidth limits, so it does not appear I can use the
load-balance pattern.   



-- 
View this message in context: http://old.nabble.com/Which-RabbitMQ-approach-pattern-to-use--tp33732871p33732871.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From alexander.ward at quibids.com  Mon Apr 23 20:57:10 2012
From: alexander.ward at quibids.com (Alexander Ward)
Date: Mon, 23 Apr 2012 12:57:10 -0700 (PDT)
Subject: [rabbitmq-discuss] Dead Link on Specification page
Message-ID: <24667431.478.1335211030147.JavaMail.geo-discussion-forums@vbhe9>

On this page http://www.rabbitmq.com/specification.html there is a dead 
link to the 1.0 business requirements for AMQP 
(http://www.amqp.org/confluence/display/AMQP/AMQP%2B1-0%2BBusiness%2BRequirements).

I was curious about reading it, if anyone happens to know where it went. I 
found this page: http://www.amqp.org/product/features but I wasn't sure if 
there was more to it than that.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120423/54687e0f/attachment.htm>

From tbw at rg6.org  Mon Apr 23 23:49:24 2012
From: tbw at rg6.org (theBuckWheat)
Date: Mon, 23 Apr 2012 15:49:24 -0700 (PDT)
Subject: [rabbitmq-discuss] About how much memory does RabbitMQ server use
 under Linux?
Message-ID: <33734324.post@talk.nabble.com>


I would like to use RabbitMQ to handle messaging to a pool of remote slave
(virtual) machines running Linux.  These machines are configured to match
the application and typically have 256mb of memory.  If I am only using
RabbitMQ to handle 4 queues with no persistence, about how much memory will
the server service consume?


-- 
View this message in context: http://old.nabble.com/About-how-much-memory-does-RabbitMQ-server-use-under-Linux--tp33734324p33734324.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From emile at rabbitmq.com  Tue Apr 24 11:17:33 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 24 Apr 2012 11:17:33 +0100
Subject: [rabbitmq-discuss] Dead Link on Specification page
In-Reply-To: <24667431.478.1335211030147.JavaMail.geo-discussion-forums@vbhe9>
References: <24667431.478.1335211030147.JavaMail.geo-discussion-forums@vbhe9>
Message-ID: <4F967DBD.7050302@rabbitmq.com>

Hi Alexander,

On 23/04/12 20:57, Alexander Ward wrote:
> On this page http://www.rabbitmq.com/specification.html there is a dead
> link to the 1.0 business requirements for AMQP
> (http://www.amqp.org/confluence/display/AMQP/AMQP%2B1-0%2BBusiness%2BRequirements).
> 
> I was curious about reading it, if anyone happens to know where it went.
> I found this page: http://www.amqp.org/product/features but I wasn't
> sure if there was more to it than that.

Thanks for pointing this out. I don't know where that link went. I can't
find it either, maybe http://www.amqp.org/product/drivers ?

-Emile


From jim at rabbitmq.com  Tue Apr 24 11:22:59 2012
From: jim at rabbitmq.com (Jim Apperly)
Date: Tue, 24 Apr 2012 11:22:59 +0100
Subject: [rabbitmq-discuss] Dead Link on Specification page
In-Reply-To: <4F967DBD.7050302@rabbitmq.com>
References: <24667431.478.1335211030147.JavaMail.geo-discussion-forums@vbhe9>
	<4F967DBD.7050302@rabbitmq.com>
Message-ID: <CAOyH4DA=qZDSDG57dZnDznY+DXC2+14mgh=chWv-nn_jpPdn3A@mail.gmail.com>

On 24 April 2012 11:17, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi Alexander,
>
> On 23/04/12 20:57, Alexander Ward wrote:
> > On this page http://www.rabbitmq.com/specification.html there is a dead
> > link to the 1.0 business requirements for AMQP
> > (
> http://www.amqp.org/confluence/display/AMQP/AMQP%2B1-0%2BBusiness%2BRequirements
> ).
> >
> > I was curious about reading it, if anyone happens to know where it went.
> > I found this page: http://www.amqp.org/product/features but I wasn't
> > sure if there was more to it than that.
>
> Thanks for pointing this out. I don't know where that link went. I can't
> find it either, maybe http://www.amqp.org/product/drivers ?
>

On 23 April 2012 20:57, Alexander Ward <alexander.ward at quibids.com> wrote:

> I was curious about reading it, if anyone happens to know where it went. I
> found this page: http://www.amqp.org/product/features but I wasn't sure
> if there was more to it than that.
>

I found a copy here:
http://www.immagic.com/eLibrary/TECH/AMQP_US/A090314W.pdf

Jim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120424/d7d73aa4/attachment.htm>

From emile at rabbitmq.com  Tue Apr 24 11:35:56 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 24 Apr 2012 11:35:56 +0100
Subject: [rabbitmq-discuss] About how much memory does RabbitMQ server
 use under Linux?
In-Reply-To: <33734324.post@talk.nabble.com>
References: <33734324.post@talk.nabble.com>
Message-ID: <4F96820C.2020006@rabbitmq.com>

Hi,

On 23/04/12 23:49, theBuckWheat wrote:
> I would like to use RabbitMQ to handle messaging to a pool of remote slave
> (virtual) machines running Linux.  These machines are configured to match
> the application and typically have 256mb of memory.  If I am only using
> RabbitMQ to handle 4 queues with no persistence, about how much memory will
> the server service consume?

If the size of any messages approach a quarter of the available RAM
(64Mb in your case) then the server will come under memory pressure. If
the queues stay fairly short and there are no other services installed
on the server then it should work, but you should test instead of
believing me. You may also want to configure sufficient swap space and
lower the vm_memory_high_watermark.


-Emile


From rob.j.godfrey at gmail.com  Tue Apr 24 11:54:06 2012
From: rob.j.godfrey at gmail.com (Rob Godfrey)
Date: Tue, 24 Apr 2012 12:54:06 +0200
Subject: [rabbitmq-discuss] Dead Link on Specification page
In-Reply-To: <CACsaS96_5RwhOa2AqFWqcPE42=7f0zvfQVg5RsXxjCu5UrC+7w@mail.gmail.com>
References: <24667431.478.1335211030147.JavaMail.geo-discussion-forums@vbhe9>
	<CACsaS96_5RwhOa2AqFWqcPE42=7f0zvfQVg5RsXxjCu5UrC+7w@mail.gmail.com>
Message-ID: <CACsaS95Gb2st8AJd+WuF+QM+7Bq_bHWXiAvLwnKmQ_y=KJO1Zg@mail.gmail.com>

Hi Alexander,

Just to confirm, I believe that the link you found is essentially the
same text as was at the previous "Business Requirements" page (this
text is also included in the AMQP Working Group licensed version of
the specification [1]).

Should you have any questions on AMQP 1.0, please feel free to ping me
directly or you can use our new (and unpublicized :) ) discussion
forum [2].


Cheers,
Rob

[1] http://www.amqp.org/sites/amqp.org/files/amqp.pdf
[2] http://www.amqp.org/forums/oasis-amqp-v10-discussion


> On 23 April 2012 21:57, Alexander Ward <alexander.ward at quibids.com> wrote:
>
> On this page http://www.rabbitmq.com/specification.html there is a dead link to the 1.0 business requirements for AMQP (http://www.amqp.org/confluence/display/AMQP/AMQP%2B1-0%2BBusiness%2BRequirements).
>
> I was curious about reading it, if anyone happens to know where it went. I found this page: http://www.amqp.org/product/features but I wasn't sure if there was more to it than that.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From fearsome.lucidity at gmail.com  Tue Apr 24 17:16:22 2012
From: fearsome.lucidity at gmail.com (Elias Levy)
Date: Tue, 24 Apr 2012 09:16:22 -0700
Subject: [rabbitmq-discuss] Mnesia corrupting after node joining cluster
Message-ID: <CAFDmHdMLD1F1hsOtUi4zvEVQatXaU=jUzSR_4KohQ=X70MvW2g@mail.gmail.com>

Last night we had our first major production RabbitMQ incident.  We we
standing up a new cluster that was going to receive messages from the first
cluster through a shovel.  Sysops had not shutdown the Erlang ports between
the new and existing cluster, and the base image used the same Erlang
cookie.  Inadvertently one of the nodes of the new cluster appears to have
had an old config pointing to the old cluster.  That node joined the
existing cluster as a RAM node.  The sysops tried a few things to remove
the node from the existing cluster without success, then I was called in.

By the time I came in the new node had been reconfigured to join the new
cluster, but the old cluster still believed it to be a member.  Since
RabbitMQ has no mechanism to remove a node from a cluster except from the
node itself, I had them take the new node and join it once more to the
existing cluster, then remove it using the reset command on the new node.
 That left the new node thinking it was not a member of the cluster, but
the existing cluster still thought it was a RAM node.  We tried this a few
times unsuccessfully.

We figured we could try taking down each node in the existing cluster one
at a time, reseting it, and having it rejoin the cluster, hoping that it
would clear whatever issue it had.  So long as we kept at least one disk
node in the existing cluster our state should be maintained (mines any
non-HA queues and messages in them).  Apparently we choose the wrong node.
 When we tried to have it rejoin the remaining node in the existing cluster
it failed.  It seems Mnesia on the remaining node was corrupted somehow.

In the end we had to remove the RabbitMQ lib directory and rebuild the
existing cluster from scratch.  As you can imagine that was not much fun.

This is not the first time I've been Mnesia become confused somehow.

A few suggestions:

Can we please have a command that allows you to remove a node from a
cluster from a node other than the node you a trying to remove? Bring back
up a node just to remove it from the cluster is time consuming and
potentially error prone.

Can we please have some tools that will analyze Mnesia on each node and
give us an idea of its health?  Whether its corrupted or somehow out of
sync with other nodes in the cluster.


Elias Levy
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120424/f815da7c/attachment.htm>

From francesco at rabbitmq.com  Tue Apr 24 18:30:24 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Tue, 24 Apr 2012 18:30:24 +0100
Subject: [rabbitmq-discuss] Mnesia corrupting after node joining cluster
In-Reply-To: <CAFDmHdMLD1F1hsOtUi4zvEVQatXaU=jUzSR_4KohQ=X70MvW2g@mail.gmail.com>
References: <CAFDmHdMLD1F1hsOtUi4zvEVQatXaU=jUzSR_4KohQ=X70MvW2g@mail.gmail.com>
Message-ID: <4F96E330.3060902@rabbitmq.com>

Hi Eli,

> That left the new node thinking it was not a member of the
> cluster, but the existing cluster still thought it was a RAM node.

Uhm, if you mean that the cluster still thought that the reseted node 
was still part of the cluster, than that is weird and shouldn't happen. 
Can you reproduce this?

If you force_reseted the node, than that behavior is to be expected.

> We figured we could try taking down each node in the existing cluster
> one at a time, reseting it, and having it rejoin the cluster, hoping
> that it would clear whatever issue it had.  So long as we kept at least
> one disk node in the existing cluster our state should be maintained
> (mines any non-HA queues and messages in them).  Apparently we choose
> the wrong node.  When we tried to have it rejoin the remaining node in
> the existing cluster it failed.  It seems Mnesia on the remaining node
> was corrupted somehow.

If the cluster doesn't know that the other node left (which seems to be 
the case here) than it will try to sync its tables with the node it 
thinks is still in the cluster. However since the other node has been 
reset its tables will have different cookies and Mnesia will blow up. 
Posting the specific error would help in confirming that this was the 
problem.

> Can we please have a command that allows you to remove a node from a
> cluster from a node other than the node you a trying to remove? Bring
> back up a node just to remove it from the cluster is time consuming and
> potentially error prone.

This is definitely a feature we're planning to implement. In general we 
want to make clustering more user friendly, and part of the work will be 
more clustering rabbitmqctl commands ("join_cluster", "depart_cluster", 
etc.).

> Can we please have some tools that will analyze Mnesia on each node and
> give us an idea of its health?  Whether its corrupted or somehow out of
> sync with other nodes in the cluster.

If I understood correctly in this case the problem wasn't corrupted 
Mnesia tables, but the cluster not being aware of which nodes were part 
of the cluster. What's definitely needed is better error reporting when 
this kind of things happen, since right now the Mnesia error are 
particularly ugly. Again, we're working on that.

Francesco.

From majek04 at gmail.com  Tue Apr 24 19:34:23 2012
From: majek04 at gmail.com (Marek Majkowski)
Date: Tue, 24 Apr 2012 19:34:23 +0100
Subject: [rabbitmq-discuss] JavaScript Client
In-Reply-To: <1335224738.5010.YahooMailNeo@web44903.mail.sp1.yahoo.com>
References: <1335224738.5010.YahooMailNeo@web44903.mail.sp1.yahoo.com>
Message-ID: <CABzX+qx+XYZQQK=zBKOuvQ7p141WEVc-QaJyMts8GwytkyRJPw@mail.gmail.com>

On Tue, Apr 24, 2012 at 00:45, Uday Subbarayan
<uday.subbarayan at yahoo.com> wrote:
> Folks,
> ? ? ? ? I am looking for a JavaScript lib with callback to receive messages
> when a new message is posted in a queue in ?Rabbit MQ. I did research and
> understand discussions like this:
> http://groups.google.com/group/rabbitmq-discuss/browse_thread/thread/6f9028fa34035331?pli=1
>
> Is,
> Browser(Socket.IO)-----> Node.js---> Rabbit MQ
> is the best solution with security?

Uday,

That's not the worst design, if you can get that working.

Additionally, take a look at my SockJS project:
  https://github.com/sockjs/sockjs-client

And at node.js rabbitmq tutorials:
  https://github.com/rabbitmq/rabbitmq-tutorials/tree/master/javascript-nodejs

Marek

From bsvancara at gmail.com  Tue Apr 24 21:23:32 2012
From: bsvancara at gmail.com (Bohuslav Svancara)
Date: Tue, 24 Apr 2012 22:23:32 +0200
Subject: [rabbitmq-discuss] JavaScript Client
In-Reply-To: <1335224738.5010.YahooMailNeo@web44903.mail.sp1.yahoo.com>
References: <1335224738.5010.YahooMailNeo@web44903.mail.sp1.yahoo.com>
Message-ID: <CANJKu1DD6n6Z5j5DcP+246E+14h+vfY0j7eK+027dXpsw8tz_Q@mail.gmail.com>

Hi!

Some time ago I tried  https://github.com/dansimpson/amqp-js

It works fine. But it is not maintained and there is one issue (*"user/password
not taken into account"*) which prevented me to use this solution for a
real work.

It is a complete solution which can be used for Browser -> RabbitMQ
connection.

I do not know Adobe action script at all, but it looks like java. Maybe
some good soul could convert Dan Simpson's action scripts, which implement
probably complete access from browsers to RabbitMQ to SockJS .

Such solution in pure javascript - without Adobe Flash - would be a great
thing!
I believe someone will create such connection using SockJS sooner or
later.
I am waiting for a good browser <-> RabbitMQ connection for years!

Sincerely,
Bob


Dne 24. dubna 2012 1:45 Uday Subbarayan <uday.subbarayan at yahoo.com>napsal(a):

> Folks,
>         I am looking for a JavaScript lib with callback to receive
> messages when a new message is posted in a queue in  Rabbit MQ. I did
> research and understand discussions like this:
>
> http://groups.google.com/group/rabbitmq-discuss/browse_thread/thread/6f9028fa34035331?pli=1
>
>
> Is,
> Browser(Socket.IO)-----> Node.js---> Rabbit MQ
> is the best solution with security?
>
> Thanks,
> -Uday.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120424/f73427ba/attachment.htm>

From uday.subbarayan at yahoo.com  Tue Apr 24 23:50:24 2012
From: uday.subbarayan at yahoo.com (Uday Subbarayan)
Date: Tue, 24 Apr 2012 15:50:24 -0700 (PDT)
Subject: [rabbitmq-discuss] JavaScript Client
In-Reply-To: <CABzX+qx+XYZQQK=zBKOuvQ7p141WEVc-QaJyMts8GwytkyRJPw@mail.gmail.com>
References: <1335224738.5010.YahooMailNeo@web44903.mail.sp1.yahoo.com>
	<CABzX+qx+XYZQQK=zBKOuvQ7p141WEVc-QaJyMts8GwytkyRJPw@mail.gmail.com>
Message-ID: <1335307824.85430.YahooMailNeo@web44901.mail.sp1.yahoo.com>

Thanks?Marek. I will take a look at ?SockJS and get back to you.

Best,
-Uday.


________________________________
 From: Marek Majkowski <majek04 at gmail.com>
To: Uday Subbarayan <uday.subbarayan at yahoo.com> 
Cc: "rabbitmq-discuss at lists.rabbitmq.com" <rabbitmq-discuss at lists.rabbitmq.com> 
Sent: Tuesday, April 24, 2012 11:34 AM
Subject: Re: [rabbitmq-discuss] JavaScript Client
 
On Tue, Apr 24, 2012 at 00:45, Uday Subbarayan
<uday.subbarayan at yahoo.com> wrote:
> Folks,
> ? ? ? ? I am looking for a JavaScript lib with callback to receive messages
> when a new message is posted in a queue in ?Rabbit MQ. I did research and
> understand discussions like this:
> http://groups.google.com/group/rabbitmq-discuss/browse_thread/thread/6f9028fa34035331?pli=1
>
> Is,
> Browser(Socket.IO)-----> Node.js---> Rabbit MQ
> is the best solution with security?

Uday,

That's not the worst design, if you can get that working.

Additionally, take a look at my SockJS project:
? https://github.com/sockjs/sockjs-client

And at node.js rabbitmq tutorials:
? https://github.com/rabbitmq/rabbitmq-tutorials/tree/master/javascript-nodejs

Marek
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120424/1e9ed4da/attachment.htm>

From kot.begemot at gmail.com  Tue Apr 24 23:52:18 2012
From: kot.begemot at gmail.com (Vadim Chekan)
Date: Tue, 24 Apr 2012 15:52:18 -0700
Subject: [rabbitmq-discuss] .Net client: out of memory when garbage on the
	wire
Message-ID: <CAFWGgNHbsdtdbVpoM9npsGL8kUhR1j+ZaCZ8eutgUR5J7Lcb9g@mail.gmail.com>

Hi all,
I'm investigating a case when in certain conditions .net client can kill
server for ~15minutes.
We have a specific firewall setup and it can return an ascii string "uou do
not have access to this service". Details do not matter, but in such case
.net client will just kill the client box instantly. Even mouse wont move.

I've investigated it and found that the problem is in
RabbitMQ.Client.Impl.Frams.cs:ReadFrom():
            int payloadSize = reader.ReadInt32(); // FIXME - throw exn on
unreasonable value
In case if client attempts to connect to a socket which returns non-ampq
message, it will attempt to allocate an array, of generally speaking random
size.
Ampq-0.9.1 spec (paragraph 4.2.3  General Frame Format) says:
> If a peer receives a frame with a type that is not one of these defined
types, it MUST treat this as a
fatal protocol error and close the connection without sending any further
data on it

But I can not understand the logic of the code in Frame.ReadFrom:
http://hg.rabbitmq.com/rabbitmq-dotnet-client/file/0d3c7b59412e/projects/client/RabbitMQ.Client/src/client/impl/Frame.cs#l107

 if (type == 'A')

The local variable name which recieves the value is "type", but it checks
for "AMQP" which should not be expected and it fail to check for type in
1-4 range which should be expected according to the spec. And it will keep
reading "size" and "byte[size]" even though they can be a garbage.
Am I missing something?

Vadim.

-- 

From uday.subbarayan at yahoo.com  Tue Apr 24 23:53:49 2012
From: uday.subbarayan at yahoo.com (Uday Subbarayan)
Date: Tue, 24 Apr 2012 15:53:49 -0700 (PDT)
Subject: [rabbitmq-discuss] JavaScript Client
In-Reply-To: <CANJKu1DD6n6Z5j5DcP+246E+14h+vfY0j7eK+027dXpsw8tz_Q@mail.gmail.com>
References: <1335224738.5010.YahooMailNeo@web44903.mail.sp1.yahoo.com>
	<CANJKu1DD6n6Z5j5DcP+246E+14h+vfY0j7eK+027dXpsw8tz_Q@mail.gmail.com>
Message-ID: <1335308029.33640.YahooMailNeo@web44903.mail.sp1.yahoo.com>

Thanks for the pointer. We have a serious need for this solution and going to make it work: browser <--> Rabbit MQ communication.

Best,
-Uday.



________________________________
 From: Bohuslav Svancara <bsvancara at gmail.com>
To: rabbitmq-discuss at lists.rabbitmq.com 
Sent: Tuesday, April 24, 2012 1:23 PM
Subject: Re: [rabbitmq-discuss] JavaScript Client
 

Hi!

Some time ago I tried? https://github.com/dansimpson/amqp-js

It works fine. But it is not maintained and there is one issue ("user/password not taken into account") which prevented me to use this solution for a real work.

It is a complete solution which can be used for Browser -> RabbitMQ connection.

I do not know Adobe action script at all, but it looks like java.?Maybe some good soul could convert Dan Simpson's action scripts, which implement probably complete access from browsers to RabbitMQ to?SockJS?.

Such solution in pure javascript - without Adobe Flash -?would be a great thing!
I believe someone will create such connection using SockJS sooner or later.? 
I am waiting for a good browser <-> RabbitMQ connection for years!?

Sincerely,
Bob



Dne 24. dubna 2012 1:45 Uday Subbarayan <uday.subbarayan at yahoo.com> napsal(a):

Folks,
>? ? ? ? I am looking for a JavaScript lib with callback to receive messages when a new message is posted in a queue in ?Rabbit MQ. I did research and understand discussions like this:
>http://groups.google.com/group/rabbitmq-discuss/browse_thread/thread/6f9028fa34035331?pli=1?
>
>
>
>Is,
>Browser(Socket.IO)-----> Node.js---> Rabbit MQ
>is the best solution with security?
>
>
>Thanks,
>-Uday.
>_______________________________________________
>rabbitmq-discuss mailing list
>rabbitmq-discuss at lists.rabbitmq.com
>https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120424/a4725613/attachment.htm>

From nithyanirmal at gmail.com  Wed Apr 25 01:39:49 2012
From: nithyanirmal at gmail.com (Nithya Vijayakumar)
Date: Tue, 24 Apr 2012 17:39:49 -0700
Subject: [rabbitmq-discuss] How to remove a node from cluster without
	loosing data
Message-ID: <CAJinw2piGWnsNYK_hdcZgia8NKKeaii9PVELZQKLVTzg4hjupg@mail.gmail.com>

Hi,

I am using 2.7.1. I have a two node cluster and I want to remove the second
node. In the clustering guide it says that this can be done by running
stop_app, reset and start_app on the second node. In our setup, however, we
no longer have access to the second node and have access only to the first
node. We use automatic config file for clustering.

How to remove the second node from cluster by resetting the first node
without loosing data? In the first node, if I update the rabbitmq.config
file with just one entry and delete the mnesia folder and restart, the
cluster gets reset, but I loose all the users, queues and stored messages.
Is it possible to backup and restore the queues and users?

Thanks,
Nithya V
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120424/ea6b19eb/attachment.htm>

From emile at rabbitmq.com  Wed Apr 25 10:57:05 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 25 Apr 2012 10:57:05 +0100
Subject: [rabbitmq-discuss] .Net client: out of memory when garbage on
 the wire
In-Reply-To: <CAFWGgNHbsdtdbVpoM9npsGL8kUhR1j+ZaCZ8eutgUR5J7Lcb9g@mail.gmail.com>
References: <CAFWGgNHbsdtdbVpoM9npsGL8kUhR1j+ZaCZ8eutgUR5J7Lcb9g@mail.gmail.com>
Message-ID: <4F97CA71.5020703@rabbitmq.com>


Hi,

On 24/04/12 23:52, Vadim Chekan wrote:
> I'm investigating a case when in certain conditions .net client can kill
> server for ~15minutes.
> We have a specific firewall setup and it can return an ascii string "uou
> do not have access to this service". Details do not matter, but in such
> case .net client will just kill the client box instantly. Even mouse
> wont move.

The .net client attempts to allocate 543452960 bytes when connecting to
a server that replies in such a way. Thanks for reporting this issue - I
file file a bug.


-Emile




From andrea.rosa at hp.com  Wed Apr 25 11:43:59 2012
From: andrea.rosa at hp.com (Rosa, Andrea (HP Cloud Services))
Date: Wed, 25 Apr 2012 10:43:59 +0000
Subject: [rabbitmq-discuss] log process
In-Reply-To: <5F389C517756284F80239F55BCA5DDDD36963612@G9W0721.americas.hpqcorp.net>
References: <5F389C517756284F80239F55BCA5DDDD36963612@G9W0721.americas.hpqcorp.net>
Message-ID: <5F389C517756284F80239F55BCA5DDDD36964188@G9W0721.americas.hpqcorp.net>

Hi 

Any news about my previous question?
Regards
--
Andrea Rosa

>-----Original Message-----
>From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-
>discuss-bounces at lists.rabbitmq.com] On Behalf Of Rosa, Andrea (HP Cloud
>Services)
>Sent: 23 April 2012 12:21
>To: rabbitmq-discuss at lists.rabbitmq.com
>Subject: [rabbitmq-discuss] log process
>
>Hi all,
>
>I had a strange issue with Rabbitmq 2.7.1 running on a linux box.
>
>Rabbitmq didn't produce log files for 5 days, from the .log.1 to .log
>file there is a gap of 5 days and the last entry in the .log.1 is
>something related to log rotate:
>
>INFO REPORT==== 15-Apr-2012::06:30:37 === Rotating logs with suffix  ''
>
>The server was running during this gap and it's impossible not to have
>log entries in the log file as our system was running and producing
>entries.
>
>I'd like to know if the log process for Rabbit is executed in a
>separated process and maybe this process died.
>We restarted the service and the file log start to be "normal".
>
>Someone has seen it before?
>Thanks
>--
>Andrea Rosa
>_______________________________________________
>rabbitmq-discuss mailing list
>rabbitmq-discuss at lists.rabbitmq.com
>https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From brendan at soundcloud.com  Wed Apr 25 11:53:08 2012
From: brendan at soundcloud.com (Brendan Hay)
Date: Wed, 25 Apr 2012 12:53:08 +0200
Subject: [rabbitmq-discuss] log process
In-Reply-To: <5F389C517756284F80239F55BCA5DDDD36964188@G9W0721.americas.hpqcorp.net>
References: <5F389C517756284F80239F55BCA5DDDD36963612@G9W0721.americas.hpqcorp.net>
	<5F389C517756284F80239F55BCA5DDDD36964188@G9W0721.americas.hpqcorp.net>
Message-ID: <CAHZsVQamUcKi5+4dwcGVCp1Q-HgMW30zoSkGvkNX41h5VLM+yg@mail.gmail.com>

Hi Andrea,

That log entry is created by running "rabbitmqctl rotate_logs",  which is
usually triggered manually or by the postrotate option of your logrotate.d
configuration.

Are there any daemons/services which might have triggered that command? Or,
if you are using logrotate.d could you please post the config you're using?

- Brendan

On Wed, Apr 25, 2012 at 12:43 PM, Rosa, Andrea (HP Cloud Services) <
andrea.rosa at hp.com> wrote:

> Hi
>
> Any news about my previous question?
> Regards
> --
> Andrea Rosa
>
> >-----Original Message-----
> >From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-
> >discuss-bounces at lists.rabbitmq.com] On Behalf Of Rosa, Andrea (HP Cloud
> >Services)
> >Sent: 23 April 2012 12:21
> >To: rabbitmq-discuss at lists.rabbitmq.com
> >Subject: [rabbitmq-discuss] log process
> >
> >Hi all,
> >
> >I had a strange issue with Rabbitmq 2.7.1 running on a linux box.
> >
> >Rabbitmq didn't produce log files for 5 days, from the .log.1 to .log
> >file there is a gap of 5 days and the last entry in the .log.1 is
> >something related to log rotate:
> >
> >INFO REPORT==== 15-Apr-2012::06:30:37 === Rotating logs with suffix  ''
> >
> >The server was running during this gap and it's impossible not to have
> >log entries in the log file as our system was running and producing
> >entries.
> >
> >I'd like to know if the log process for Rabbit is executed in a
> >separated process and maybe this process died.
> >We restarted the service and the file log start to be "normal".
> >
> >Someone has seen it before?
> >Thanks
> >--
> >Andrea Rosa
> >_______________________________________________
> >rabbitmq-discuss mailing list
> >rabbitmq-discuss at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120425/34309bf8/attachment.htm>

From matthias at rabbitmq.com  Wed Apr 25 11:54:51 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 25 Apr 2012 11:54:51 +0100
Subject: [rabbitmq-discuss] Missing dependency in management
	plugin/mochiweb
In-Reply-To: <3C92E5FA26164AD4AF31A8A37E031605@gmail.com>
References: <3C92E5FA26164AD4AF31A8A37E031605@gmail.com>
Message-ID: <4F97D7FB.1020708@rabbitmq.com>

Alvaro,

On 21/04/12 17:37, Alvaro Videla wrote:
> Similar to xmerl last week I think either mochiweb or the management
> plugin should declare a dependecy on the inets app.

afaict mochiweb already does declare that dependency.

Matthias.

From majek04 at gmail.com  Wed Apr 25 12:02:05 2012
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 25 Apr 2012 12:02:05 +0100
Subject: [rabbitmq-discuss] JavaScript Client
In-Reply-To: <CANJKu1DD6n6Z5j5DcP+246E+14h+vfY0j7eK+027dXpsw8tz_Q@mail.gmail.com>
References: <1335224738.5010.YahooMailNeo@web44903.mail.sp1.yahoo.com>
	<CANJKu1DD6n6Z5j5DcP+246E+14h+vfY0j7eK+027dXpsw8tz_Q@mail.gmail.com>
Message-ID: <CABzX+qxTTmqNS+7bNzbBWAWA=Qnua=8A8r15mi5gi0WTM4aoKg@mail.gmail.com>

On Tue, Apr 24, 2012 at 21:23, Bohuslav Svancara <bsvancara at gmail.com> wrote:
> I am waiting for a good browser <-> RabbitMQ connection for years!

Nice to hear that, we do have a RabbitMQ-Web-Stomp plugin in the pipeline,
it should be released "soon". It will provide a STOMP-to-SockJS bridge as
a standard Rabbitmq plugin (rabbitmq-stomp is of course a needed dependency).

So, if you can use STOMP from the browser and if you're willing to
compile the plugin from sources, here it is:
  https://github.com/rabbitmq/rabbitmq-web-stomp
  https://github.com/rabbitmq/rabbitmq-web-stomp-examples


Cheers,
  Marek

From matthias at rabbitmq.com  Wed Apr 25 12:12:22 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 25 Apr 2012 12:12:22 +0100
Subject: [rabbitmq-discuss] Per-Connection Flow Control - RMQ 2.8.1
In-Reply-To: <4F955F33.9020003@aol.com>
References: <4F6CD702.4050908@aol.com>	<4F704404.8080504@rabbitmq.com>	<4F728392.5070602@aol.com>	<4F72E8A4.1010609@rabbitmq.com>
	<4F730718.6080908@rabbitmq.com>	<4F86EC12.7030602@aol.com>
	<4F8BFAB7.1070706@rabbitmq.com> <4F955F33.9020003@aol.com>
Message-ID: <4F97DC16.2010107@rabbitmq.com>

On 23/04/12 14:54, DawgTool wrote:
> Here are some stats on a few runs, modifying the flow control limits.
> Attached is some graphs I created to show the memory consumption.

I cannot see anything particularly unusual in those graphs.

The original problem you reported was that you saw lower rates in 2.8.1 
than previous releases. Simon previously asked
<quote>
Do you have a message rate for your use case that leads to *stable* 
memory use in 2.7.1 but which cannot be maintained by 2.8.1?
</quote>


Regards,

Matthias.

From videlalvaro at gmail.com  Wed Apr 25 12:52:38 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 25 Apr 2012 13:52:38 +0200
Subject: [rabbitmq-discuss] Missing dependency in management
	plugin/mochiweb
In-Reply-To: <4F97D7FB.1020708@rabbitmq.com>
References: <3C92E5FA26164AD4AF31A8A37E031605@gmail.com>
	<4F97D7FB.1020708@rabbitmq.com>
Message-ID: <CAMcAHLW1c07x_wGETuRaYJ8maXYh58MByfdHZO23DV6yB2bXYQ@mail.gmail.com>

Hi,

I tried to reproduce the problem. Actually *rabbitmq-server* needs to
declare *inets* in its app dependencies.

This is the error you get:

Activating RabbitMQ plugins ...
{"init terminating in
do_boot",{{badmatch,{error,{edge,{bad_vertex,inets},mochiweb,inets}}},[{rabbit_plugins,calculate_dependencies,3},{rabbit_prelaunch,prepare_plugins,3},{rabbit_prelaunch,start,0},{init,start_it,1},{init,start_em,1}]}}

For a enabled_plugins file with this content: [].

This happens when you generate a release for RabbitMQ only. Of course is
not a problem if you have Erlang installed since the inets app will be
found.

If you want to reproduce the error I can send you the release build
instructions from my own repo.

Regards,

Alvaro


On Wed, Apr 25, 2012 at 12:54 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Alvaro,
>
>
> On 21/04/12 17:37, Alvaro Videla wrote:
>
>> Similar to xmerl last week I think either mochiweb or the management
>> plugin should declare a dependecy on the inets app.
>>
>
> afaict mochiweb already does declare that dependency.
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120425/2fbe822e/attachment.htm>

From simon at rabbitmq.com  Wed Apr 25 12:57:58 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 25 Apr 2012 12:57:58 +0100
Subject: [rabbitmq-discuss] Missing dependency in
	management	plugin/mochiweb
In-Reply-To: <CAMcAHLW1c07x_wGETuRaYJ8maXYh58MByfdHZO23DV6yB2bXYQ@mail.gmail.com>
References: <3C92E5FA26164AD4AF31A8A37E031605@gmail.com>	<4F97D7FB.1020708@rabbitmq.com>
	<CAMcAHLW1c07x_wGETuRaYJ8maXYh58MByfdHZO23DV6yB2bXYQ@mail.gmail.com>
Message-ID: <4F97E6C6.4060307@rabbitmq.com>

On 25/04/12 12:52, Alvaro Videla wrote:
> I tried to reproduce the problem. Actually *rabbitmq-server* needs to
> declare *inets* in its app dependencies.

I still don't get it - does the release build thing that you have check 
only the rabbit.app descriptor, or those of all the plugins too?

If the former, why did adding xmerl to rabbitmq-management fix anything? 
(it was the right thing to do anyway, but why did it not cause this 
problem?)

If the latter, why is inets not being picked up due to its presence in 
mochiweb.app?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From matthias at rabbitmq.com  Wed Apr 25 13:22:59 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 25 Apr 2012 13:22:59 +0100
Subject: [rabbitmq-discuss] Missing dependency in management
	plugin/mochiweb
In-Reply-To: <CAMcAHLW1c07x_wGETuRaYJ8maXYh58MByfdHZO23DV6yB2bXYQ@mail.gmail.com>
References: <3C92E5FA26164AD4AF31A8A37E031605@gmail.com>	<4F97D7FB.1020708@rabbitmq.com>
	<CAMcAHLW1c07x_wGETuRaYJ8maXYh58MByfdHZO23DV6yB2bXYQ@mail.gmail.com>
Message-ID: <4F97ECA3.1030608@rabbitmq.com>

Alvaro,

On 25/04/12 12:52, Alvaro Videla wrote:
> I tried to reproduce the problem. Actually *rabbitmq-server* needs to
>  declare *inets* in its app dependencies.

The server itself does not depend on inets, so that would be wrong.

> This is the error you get:
>
> Activating RabbitMQ plugins ... {"init terminating in
> do_boot",{{badmatch,{error,{edge,{bad_vertex,inets},mochiweb,inets}}},[{rabbit_plugins,calculate_dependencies,3},{rabbit_prelaunch,prepare_plugins,3},{rabbit_prelaunch,start,0},{init,start_it,1},{init,start_em,1}]}}
>
>  For a enabled_plugins file with this content: [].
> This happens when you generate a release for RabbitMQ only.

Right. The plug-in dependency calculations filters out all app 
dependencies which can be loaded. More generally, the code in 
rabbit_plugins assumes that it executes on the user's rabbit runtime. 
Hence inets, kernel, stdlib, etc never feature in the dependency 
calculation in normal use.

It is not immediately clear what needs to change to make that code work 
in a different context, i.e. a release build. Over to you :)


Regards,

Matthias.

From videlalvaro at gmail.com  Wed Apr 25 13:24:14 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 25 Apr 2012 14:24:14 +0200
Subject: [rabbitmq-discuss] Missing dependency in management
	plugin/mochiweb
In-Reply-To: <4F97E6C6.4060307@rabbitmq.com>
References: <3C92E5FA26164AD4AF31A8A37E031605@gmail.com>
	<4F97D7FB.1020708@rabbitmq.com>
	<CAMcAHLW1c07x_wGETuRaYJ8maXYh58MByfdHZO23DV6yB2bXYQ@mail.gmail.com>
	<4F97E6C6.4060307@rabbitmq.com>
Message-ID: <CAMcAHLWnE0K5gv-86bvZopY73M5dEQhN24F5Jg7p=i=kD6Xv5A@mail.gmail.com>

Hi,

So let's start again because my first error report was wrong. I shouldn't
have mentioned mochiweb or the management plugin. I did so because the
first time this error happened to me I was trying to enable those plugins.

So, yes. The release is created based on the dependencies from the
rabbit.app which doesn't declare inets as one if its dependencies:

http://hg.rabbitmq.com/rabbitmq-server/file/89d34c362862/ebin/rabbit_app.in#l13

So when the Erlang release is generated the inets is not shipped with the
.tar created.

Actually I think any app used by the project which also appears here: ls
/usr/local/lib/erlang/lib/ should be declared as a dependency. (kernel and
stdlib are required anyway, same thing with erts and sasl if used).

Declaring the app dependency is not required to generate a release per-se,
but is required by the rabbit_prelaunch.erl script that generates the
release file automatically: See:
http://hg.rabbitmq.com/rabbitmq-server/file/89d34c362862/src/rabbit_prelaunch.erl#l72

So when generating a .rel file you can actually write all the app
dependencies manually but I automated the process by "borrowing" code from
the rabbit_prelaunch script.

So in my case to fix the issue I just added some extra apps here:
https://github.com/videlalvaro/tamedrabbit/blob/master/erlang/rabbit_release.erl#L9(Note
that rabbit_prelaunch.erl has the same erlang macro on top). By
adding inets and xmerl there I made sure that those apps are shipped with
my custom release.

So I use my own rabbit_release.erl to generate the release .tar and what
not. Then rabbitmq-server uses rabbit_prelaunch.erl to generate it's own
release file that is loaded during server startup. That release file
generated by the prelaunch script is based on the target system, that of
course will not include inets.

Does it make sense now?

Regards,

Alvaro

On Wed, Apr 25, 2012 at 1:57 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 25/04/12 12:52, Alvaro Videla wrote:
>
>> I tried to reproduce the problem. Actually *rabbitmq-server* needs to
>> declare *inets* in its app dependencies.
>>
>
> I still don't get it - does the release build thing that you have check
> only the rabbit.app descriptor, or those of all the plugins too?
>
> If the former, why did adding xmerl to rabbitmq-management fix anything?
> (it was the right thing to do anyway, but why did it not cause this
> problem?)
>
> If the latter, why is inets not being picked up due to its presence in
> mochiweb.app?
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120425/521fe727/attachment.htm>

From dawgtool at aol.com  Wed Apr 25 15:41:57 2012
From: dawgtool at aol.com (DawgTool)
Date: Wed, 25 Apr 2012 10:41:57 -0400
Subject: [rabbitmq-discuss] Per-Connection Flow Control - RMQ 2.8.1
In-Reply-To: <4F97DC16.2010107@rabbitmq.com>
References: <4F6CD702.4050908@aol.com>	<4F704404.8080504@rabbitmq.com>	<4F728392.5070602@aol.com>	<4F72E8A4.1010609@rabbitmq.com>
	<4F730718.6080908@rabbitmq.com>	<4F86EC12.7030602@aol.com>
	<4F8BFAB7.1070706@rabbitmq.com> <4F955F33.9020003@aol.com>
	<4F97DC16.2010107@rabbitmq.com>
Message-ID: <4F980D35.3040003@aol.com>

Hi Matthias,

I haven't run these same tests on 2.7.1 yet, since its our production 
machines (which are currently stable... enough).

The spiking and the locking is not unusual? ;)
Maybe the large gaps between queue memory and actual memory is not 
unusual also? ;)
Maybe the flat queue sizes for several seconds while hundreds of 
thousands of records are added and purged? ;)

All joking aside.... =)

When RabbitMQ is cleaning its index/journals and data files, the queues 
are all locked. Cleansing a queue could take several seconds/minutes 
depending on the volume. The current flow control {200,50} hides a lot 
of this, since you will not reach a large enough volume to cause a long 
enough 'purge' to notice.

On my test machine, all the non-persistent messages were dropped to disk 
(causing a lock) around 4GB every time. On smaller systems, its usually 
around 1.5 to 2GB.  This happens regardless of any settings on rabbitmq 
or mnesia (unless I missed something).

A work around I have tried which works (up until the 'purge'), was to 
mount the mnesia directory on a RAM disk and change the message to be 
persistent (instead of non).  This fixed the 4GB lock, since everything 
is on disk as its received (with a slight delay).

Thanks


On 4/25/12 7:12 AM, Matthias Radestock wrote:
> On 23/04/12 14:54, DawgTool wrote:
>> Here are some stats on a few runs, modifying the flow control limits.
>> Attached is some graphs I created to show the memory consumption.
>
> I cannot see anything particularly unusual in those graphs.
>
> The original problem you reported was that you saw lower rates in 
> 2.8.1 than previous releases. Simon previously asked
> <quote>
> Do you have a message rate for your use case that leads to *stable* 
> memory use in 2.7.1 but which cannot be maintained by 2.8.1?
> </quote>
>
>
> Regards,
>
> Matthias.


From francesco at rabbitmq.com  Wed Apr 25 16:00:18 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Wed, 25 Apr 2012 16:00:18 +0100
Subject: [rabbitmq-discuss] How to remove a node from cluster without
 loosing data
In-Reply-To: <CAJinw2piGWnsNYK_hdcZgia8NKKeaii9PVELZQKLVTzg4hjupg@mail.gmail.com>
References: <CAJinw2piGWnsNYK_hdcZgia8NKKeaii9PVELZQKLVTzg4hjupg@mail.gmail.com>
Message-ID: <4F981182.2030509@rabbitmq.com>

Hi Nithya,

> I am using 2.7.1. I have a two node cluster and I want to remove the
> second node. In the clustering guide it says that this can be done by
> running stop_app, reset and start_app on the second node. In our setup,
> however, we no longer have access to the second node and have access
> only to the first node. We use automatic config file for clustering.

Currently removing "problematic" nodes from your cluster is kind of tricky.

If your node is simply down, then the quickest way to do this is to set 
up an impostor node on the same host with the same name and remove that.

If for some reason you can't reach your node at all, then the situation 
is a lot uglier and I don't think there is a safe way to proceed.

We are aware that this is a problem and we're working on this, along 
with making clustering operations more user friendly in general.

Francesco.

From m.luchak at smartasking.com  Wed Apr 25 16:18:07 2012
From: m.luchak at smartasking.com (m.luchak at smartasking.com)
Date: Wed, 25 Apr 2012 11:18:07 -0400 (EDT)
Subject: [rabbitmq-discuss] client in browse mode in Rabbit
Message-ID: <1335367087.540417214@apps.rackspace.com>


Hey all,
 
Is there a way to implement a receiver in browse mode in Rabbit?  Perhaps using the 1.0 plug-in?
 
thanks,
Matthew
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120425/b97d146c/attachment.htm>

From majek04 at gmail.com  Wed Apr 25 16:25:11 2012
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 25 Apr 2012 16:25:11 +0100
Subject: [rabbitmq-discuss] client in browse mode in Rabbit
In-Reply-To: <1335367087.540417214@apps.rackspace.com>
References: <1335367087.540417214@apps.rackspace.com>
Message-ID: <CABzX+qyUiMgSdXcATfF1T=a7_pJaQj9HLBhXSDpThKm9YWJD6g@mail.gmail.com>

On Wed, Apr 25, 2012 at 16:18,  <m.luchak at smartasking.com> wrote:
> Is there a way to implement a receiver in browse mode in Rabbit? ?Perhaps
> using the 1.0 plug-in?


What do you mean by "in browse mode" ?

Marek

From m.luchak at smartasking.com  Wed Apr 25 16:30:55 2012
From: m.luchak at smartasking.com (m.luchak at smartasking.com)
Date: Wed, 25 Apr 2012 11:30:55 -0400 (EDT)
Subject: [rabbitmq-discuss] client in browse mode in Rabbit
In-Reply-To: <CABzX+qyUiMgSdXcATfF1T=a7_pJaQj9HLBhXSDpThKm9YWJD6g@mail.gmail.com>
References: <1335367087.540417214@apps.rackspace.com> 
	<CABzX+qyUiMgSdXcATfF1T=a7_pJaQj9HLBhXSDpThKm9YWJD6g@mail.gmail.com>
Message-ID: <1335367855.890221113@apps.rackspace.com>


In browse mode on Qpid you can have multiple receivers connected to the same Q and these receivers will receive all of the messages (not round robin or exclusive)..
 
 
 
 
-----Original Message-----
From: "Marek Majkowski" <majek04 at gmail.com>
Sent: Wednesday, April 25, 2012 11:25am
To: m.luchak at smartasking.com
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] client in browse mode in Rabbit



On Wed, Apr 25, 2012 at 16:18,  <m.luchak at smartasking.com> wrote:
> Is there a way to implement a receiver in browse mode in Rabbit?  Perhaps
> using the 1.0 plug-in?


What do you mean by "in browse mode" ?

Marek
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120425/0a961769/attachment.htm>

From majek04 at gmail.com  Wed Apr 25 16:38:39 2012
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 25 Apr 2012 16:38:39 +0100
Subject: [rabbitmq-discuss] client in browse mode in Rabbit
In-Reply-To: <1335367855.890221113@apps.rackspace.com>
References: <1335367087.540417214@apps.rackspace.com>
	<CABzX+qyUiMgSdXcATfF1T=a7_pJaQj9HLBhXSDpThKm9YWJD6g@mail.gmail.com>
	<1335367855.890221113@apps.rackspace.com>
Message-ID: <CABzX+qzYK9q6TCvW-D96gc1rSujgL-d1B=L73XTpLvdfCueZSg@mail.gmail.com>

On Wed, Apr 25, 2012 at 16:30,  <m.luchak at smartasking.com> wrote:
> In browse mode on Qpid you can have multiple receivers connected to the same
> Q and these receivers will receive all of the messages (not round robin or
> exclusive)..

This is not really supported by AMQP model, so it's unlikely to be
supported by Rabbit.

In AMQP if you wish to distribute a message multiple receivers you need to
have a separate queue per consumer. The simplest way of doing that
is to bind multiple queues to a single fanout exchange. And have
one consumer per queue.

If you need more sophisticated topology you may use RabbitMQ-specific
exchange-to-exchange bindings:
  http://www.rabbitmq.com/extensions.html

Cheers,
    Marek

From matthias at rabbitmq.com  Wed Apr 25 16:50:23 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 25 Apr 2012 16:50:23 +0100
Subject: [rabbitmq-discuss] Per-Connection Flow Control - RMQ 2.8.1
In-Reply-To: <4F980D35.3040003@aol.com>
References: <4F6CD702.4050908@aol.com>	<4F704404.8080504@rabbitmq.com>	<4F728392.5070602@aol.com>	<4F72E8A4.1010609@rabbitmq.com>
	<4F730718.6080908@rabbitmq.com>	<4F86EC12.7030602@aol.com>
	<4F8BFAB7.1070706@rabbitmq.com> <4F955F33.9020003@aol.com>
	<4F97DC16.2010107@rabbitmq.com> <4F980D35.3040003@aol.com>
Message-ID: <4F981D3F.6050706@rabbitmq.com>

On 25/04/12 15:41, DawgTool wrote:
> I haven't run these same tests on 2.7.1 yet, since its our production
> machines (which are currently stable... enough).

I see. So, just to be clear, we are now no longer looking at the 
original problem you reported, namely that you thought 2.7.1 could 
handle a considerably higher rate than 2.8.1?

> The spiking and the locking is not unusual? ;)
> Maybe the large gaps between queue memory and actual memory is not
> unusual also? ;)
> Maybe the flat queue sizes for several seconds while hundreds of
> thousands of records are added and purged? ;)
> All joking aside.... =)

Running, as you were, with considerably higher flow control credits than 
standard make all of the above worse. One of the reasons we introduced 
flow control (and picked the standard settings we have) is to reduce the 
magnitude of these.

> When RabbitMQ is cleaning its index/journals and data files, the queues
> are all locked.

Paging to disk happens largely asynchronously. However, ordering and 
other causality constraints may require certain operations to wait until 
others have completed. There is not much we can do about that.

> The current flow control {200,50} hides a lot of this

Yep. Quite intentionally.

> On my test machine, all the non-persistent messages were dropped to disk
> (causing a lock) around 4GB every time. On smaller systems, its usually
> around 1.5 to 2GB. This happens regardless of any settings on rabbitmq
> or mnesia (unless I missed something).

With the default credit settings I can get publishers to pause for a few 
seconds every now and then, but not longer. Are you seeing something 
different?

Regards,

Matthias.

From francesco at rabbitmq.com  Wed Apr 25 16:52:07 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Wed, 25 Apr 2012 16:52:07 +0100
Subject: [rabbitmq-discuss] How to remove a node from cluster without
 loosing data
In-Reply-To: <CAJinw2piGWnsNYK_hdcZgia8NKKeaii9PVELZQKLVTzg4hjupg@mail.gmail.com>
References: <CAJinw2piGWnsNYK_hdcZgia8NKKeaii9PVELZQKLVTzg4hjupg@mail.gmail.com>
Message-ID: <4F981DA7.4080100@rabbitmq.com>

Hi Nithya,

> Is it possible to backup and restore the queues and users?

I forgot to mention that this is possible by saving the config with the 
management plugin.

Francesco.

From emile at rabbitmq.com  Wed Apr 25 17:06:07 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 25 Apr 2012 17:06:07 +0100
Subject: [rabbitmq-discuss] Which RabbitMQ approach/pattern to use?
In-Reply-To: <33732871.post@talk.nabble.com>
References: <33732871.post@talk.nabble.com>
Message-ID: <4F9820EF.2020707@rabbitmq.com>

Hi,

On 23/04/12 20:47, theBuckWheat wrote:
> My application sends a work file out to one of several available remote

If the application does not need to designate a slave then work files
can go into a shared queue that all slaves subscribe to.

If your application must designate a slave then you could create a
dedicated queue for each slave.

> slaves.    When the slave is done with the work, it posts a callback notice
> and stands by for the master to fetch the results file.   When that file has
> been downloaded, after a little housekeeping, the slave can be put on the
> list of those available to send work.  

That sounds like an RPC pattern. The 6th tutorial discusses this:
http://www.rabbitmq.com/tutorials/tutorial-six-python.html

> What is the best que structure to use with RabbitMQ to dispatch work to the
> pool of slaves?  I have to manage the list of slaves because some might be
> close to their bandwidth limits, so it does not appear I can use the
> load-balance pattern.   

It is not clear who is responsible for observing this constraint. If it
is the slave then it could take itself out of service. If it is the
application then you will need a separate queue per slave.


-Emile



From simon at rabbitmq.com  Wed Apr 25 17:12:14 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 25 Apr 2012 17:12:14 +0100
Subject: [rabbitmq-discuss] How to remove a node from cluster without
 loosing data
In-Reply-To: <4F981DA7.4080100@rabbitmq.com>
References: <CAJinw2piGWnsNYK_hdcZgia8NKKeaii9PVELZQKLVTzg4hjupg@mail.gmail.com>
	<4F981DA7.4080100@rabbitmq.com>
Message-ID: <4F98225E.8000806@rabbitmq.com>

On 25/04/12 16:52, Francesco Mazzoli wrote:
> I forgot to mention that this is possible by saving the config with the
> management plugin.

...although this does not save queue contents, which might be something 
of an issue for many.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From dawgtool at aol.com  Wed Apr 25 17:14:44 2012
From: dawgtool at aol.com (DawgTool)
Date: Wed, 25 Apr 2012 12:14:44 -0400
Subject: [rabbitmq-discuss] Per-Connection Flow Control - RMQ 2.8.1
In-Reply-To: <4F981D3F.6050706@rabbitmq.com>
References: <4F6CD702.4050908@aol.com>	<4F704404.8080504@rabbitmq.com>	<4F728392.5070602@aol.com>	<4F72E8A4.1010609@rabbitmq.com>
	<4F730718.6080908@rabbitmq.com>	<4F86EC12.7030602@aol.com>
	<4F8BFAB7.1070706@rabbitmq.com> <4F955F33.9020003@aol.com>
	<4F97DC16.2010107@rabbitmq.com> <4F980D35.3040003@aol.com>
	<4F981D3F.6050706@rabbitmq.com>
Message-ID: <4F9822F4.2060507@aol.com>

Hi Matthias,

On 4/25/12 11:50 AM, Matthias Radestock wrote:
> On 25/04/12 15:41, DawgTool wrote:
>> I haven't run these same tests on 2.7.1 yet, since its our production
>> machines (which are currently stable... enough).
>
> I see. So, just to be clear, we are now no longer looking at the 
> original problem you reported, namely that you thought 2.7.1 could 
> handle a considerably higher rate than 2.8.1?
>
Comparing 2.7.1 to 2.8.1 has become less a priority as getting 2.8.1 to 
behave the same as our current 2.7.1 system.
(and I say behave meaning throughput count more then anything else)
>> The spiking and the locking is not unusual? ;)
>> Maybe the large gaps between queue memory and actual memory is not
>> unusual also? ;)
>> Maybe the flat queue sizes for several seconds while hundreds of
>> thousands of records are added and purged? ;)
>> All joking aside.... =)
>
In case you thought different, this really is a good nature poke. So 
please don't take my joking personally. =)

> Running, as you were, with considerably higher flow control credits 
> than standard make all of the above worse. One of the reasons we 
> introduced flow control (and picked the standard settings we have) is 
> to reduce the magnitude of these.
Agreed, the reason I was raising the credits was to give my publishers 
more time to publish before they got locked out.  At the default level 
{200,50}, my publishing minimum rate of 4k/sec (normal rate is 90k/s) 
blocked almost instantly.
The flat queue concerns me more then the queue vs total, I expected that 
there would be records piled up in the broker/exchange.
>
>> When RabbitMQ is cleaning its index/journals and data files, the queues
>> are all locked.
>
> Paging to disk happens largely asynchronously. However, ordering and 
> other causality constraints may require certain operations to wait 
> until others have completed. There is not much we can do about that.
>
I assumed the same thing, 'purging'/paging would be something done 
async, but in all my tests with non-persistent messages, paging locked 
everything without fail, regardless of disk type (SAS vs RAM). I haven't 
gone through the code enough to know when is the case, but i would 
assume its the index/journal rebuilding and not the disk i/o.
>> The current flow control {200,50} hides a lot of this
>
> Yep. Quite intentionally.
>
>> On my test machine, all the non-persistent messages were dropped to disk
>> (causing a lock) around 4GB every time. On smaller systems, its usually
>> around 1.5 to 2GB. This happens regardless of any settings on rabbitmq
>> or mnesia (unless I missed something).
>
> With the default credit settings I can get publishers to pause for a 
> few seconds every now and then, but not longer. Are you seeing 
> something different?
You can easily get this to behave poorly by pushing volume (3-4k/s) to a 
topic exchange with a short TTL on the queues (90000ms)
I can send my json object if you want to see the configuration I am 
using. Summary: 1 exchange(topic) -> 14 queues (TTL:90000ms)
>
> Regards,
>
> Matthias.


From nabeelak45 at gmail.com  Wed Apr 25 14:11:29 2012
From: nabeelak45 at gmail.com (Nabeel Akhtar)
Date: Wed, 25 Apr 2012 06:11:29 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ instances
Message-ID: <6401549.3099.1335359489722.JavaMail.geo-discussion-forums@vbxz8>

Hi:
If I want to collect logs from multiple machines, would I need to run 
RabbitMQ broker on all machines, or just one? If I run it on just one 
machine, then which component should I run on all nodes?

Thanks,
Nabeel
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120425/46a67226/attachment.htm>

From matthias at rabbitmq.com  Wed Apr 25 17:36:29 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 25 Apr 2012 17:36:29 +0100
Subject: [rabbitmq-discuss] Per-Connection Flow Control - RMQ 2.8.1
In-Reply-To: <4F9822F4.2060507@aol.com>
References: <4F6CD702.4050908@aol.com>	<4F704404.8080504@rabbitmq.com>	<4F728392.5070602@aol.com>	<4F72E8A4.1010609@rabbitmq.com>
	<4F730718.6080908@rabbitmq.com>	<4F86EC12.7030602@aol.com>
	<4F8BFAB7.1070706@rabbitmq.com> <4F955F33.9020003@aol.com>
	<4F97DC16.2010107@rabbitmq.com> <4F980D35.3040003@aol.com>
	<4F981D3F.6050706@rabbitmq.com> <4F9822F4.2060507@aol.com>
Message-ID: <4F98280D.4040703@rabbitmq.com>

On 25/04/12 17:14, DawgTool wrote:
> Comparing 2.7.1 to 2.8.1 has become less a priority as getting 2.8.1 to
> behave the same as our current 2.7.1 system.
> (and I say behave meaning throughput count more then anything else)

*Sustained* throughput on 2.8.1 should not be significantly lower than 
2.7.1. Do you have evidence to the contrary? That is certainly something 
we'd want to investigate.

2.7.1 can absorb longer spikes than 2.8.1; you can compensate for that 
somewhat by increasing the tcp buffer sizes.

> the reason I was raising the credits was to give my publishers
> more time to publish before they got locked out. At the default level
> {200,50}, my publishing minimum rate of 4k/sec (normal rate is 90k/s)
> blocked almost instantly.

What's the average message size? And how many queues does a single 
message get routed to on average?

90k/s is unlikely to be a sustainable rate even with tiny messages. 
4k/sec really shouldn't be a problem, unless the messages are huge.

> The flat queue concerns me more then the queue vs total, I expected that
> there would be records piled up in the broker/exchange.

One of the objectives of the credit based flow control is to prevent 
messages from piling up anywhere other than the queue or tcp buffers.

> You can easily get this to behave poorly by pushing volume (3-4k/s) to a
> topic exchange with a short TTL on the queues (90000ms)

Ah. TTLs. Handling those can be quite costly in some circumstances, and 
indeed block the queue for a while. This shouldn't have changed between 
2.7.1 and 2.8.1 though.


Regards,

Matthias.

From emile at rabbitmq.com  Wed Apr 25 17:43:54 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 25 Apr 2012 17:43:54 +0100
Subject: [rabbitmq-discuss] RabbitMQ instances
In-Reply-To: <6401549.3099.1335359489722.JavaMail.geo-discussion-forums@vbxz8>
References: <6401549.3099.1335359489722.JavaMail.geo-discussion-forums@vbxz8>
Message-ID: <4F9829CA.4080507@rabbitmq.com>

Hi Nabeel,

On 25/04/12 14:11, Nabeel Akhtar wrote:
> If I want to collect logs from multiple machines, would I need to run
> RabbitMQ broker on all machines, or just one? If I run it on just one
> machine, then which component should I run on all nodes?

You only need one broker. You will need a RabbitMQ client, or some
software that can speak a suitable protocol (such as STOMP) on all
machines that produce logs.

This post by Peter Ledbrook has some background that you may find useful:
http://blog.cloudfoundry.com/post/13481011156/rethink-application-logging-with-rabbitmq


-Emile



From alex.gronholm at nextday.fi  Thu Apr 26 06:08:57 2012
From: alex.gronholm at nextday.fi (=?UTF-8?B?QWxleCBHcsO2bmhvbG0=?=)
Date: Thu, 26 Apr 2012 08:08:57 +0300
Subject: [rabbitmq-discuss] Message timeouts
In-Reply-To: <20398578.95.1323605677788.JavaMail.geo-discussion-forums@yqfm20>
References: <6243898.229.1322825583745.JavaMail.geo-discussion-forums@yqny18>	<06c4412d-588f-4b82-9b8d-5f1caf2ece1d@u32g2000yqe.googlegroups.com>	<4ED8C280.9020707@rabbitmq.com>
	<19609256.257.1322829385090.JavaMail.geo-discussion-forums@yqiw17>
	<4ED8C82E.1070906@rabbitmq.com>
	<855F810E-DE11-413C-B3D6-D65D5CA82EC9@rabbitmq.com>
	<5024586.436.1323053328384.JavaMail.geo-discussion-forums@yqkp3>
	<A9B0DFE2-DA9D-4FE0-BD67-29174617F598@rabbitmq.com>
	<20398578.95.1323605677788.JavaMail.geo-discussion-forums@yqfm20>
Message-ID: <4F98D869.60400@nextday.fi>

11.12.2011 14:14, Alex Gr?nholm kirjoitti:
> Sorry for taking this long to respond. I've been otherwise engaged and 
> forgot about this conversation.
> Thank you for your replies.
>
>     If you don't want the server queue requests to be 'lost' then
>     don't allow the
>     queues to expire!
>
>     On the other hand your clients apparently wait forever.  Is there
>     a reason I
>     don't understand why the server queues expire but the clients
>     don't have a
>     timeout for the responses?
>
> If the upgrade of the server software fails and the developers do 
> nothing, the queue expires eventually so that stale requests are 
> dropped and the clients will start getting proper error messages 
> informing them of this condition.
> This is not the ideal solution of course (per-message TTL and return 
> notification would be).
>
>     You want requests to either be processed or (reliably) not
>     processed.  You
>     never want the clients to be in any doubt about whether the
>     request was
>     processed or not.  So you wait forever in the client.  However,
>     requests that
>     get discarded never return so the client doesn't know.  So you
>     want expiry to
>     trigger replies to the clients.  (Per-queue message TTLs also
>     don't return.)
>
>
>  Sounds about right.
>
>     Let's see -- how would we do this without a dead-letter mechanism?
>
Now that the dead-letter mechanism is part of the server, I don't still 
don't see how this could be done. The dead lettered RPC commands would 
still have to be processed somewhere.
>
>      Well, apart
>     from making the server transactional, it might be useful to have
>     an 'offline'
>     server that can take over any server's queue when it fails and
>     either deal with
>     the requests [by issuing an 'offline' response?] or arrange for
>     the server to
>     be restarted (and/or upgraded).
>
>
> This seems fairly complicated. I'll have to look into transactions to 
> see if they will help in my case.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120426/00ec443b/attachment.htm>

From monish.unni at gmail.com  Wed Apr 25 20:27:41 2012
From: monish.unni at gmail.com (cogitate)
Date: Wed, 25 Apr 2012 12:27:41 -0700 (PDT)
Subject: [rabbitmq-discuss] immediate, mandatory flag with no consumers
Message-ID: <fa3b9c55-7577-41c3-80f2-9176d4736a30@u7g2000yqc.googlegroups.com>

i am trying to understand the usage of "immediate" and "mandatory" vis-
a-vis when there are no consumers, to get rabbitmq broker to call
handleReturn callback, after i setup returnListener.

i ran through the following scenarios:
1. no exchange, no queue
2. exchange, no queue
3. exchange, queue - no consumers
but, i don't get a return call from the server.

following pseudo code/ fragment is what i use:
//setup queue
 REPLY_QUEUE = "REPLY_QUEUE;
 boolean durable = false;
 boolean autoDelete = true;
 boolean exclusive = false;
 try {
 
channel.queueDeclare(REPLY_QUEUE,durable,exclusive,autoDelete,null);
   } catch (IOException e) {}

//setup consumer:
consumer = new QueueingConsumer(channel);
 try {
            channel.basicConsume(REPLY_QUEUE,true,consumer);
 } catch (IOException e) {}

//setup listener:
channel.addReturnListener(new ReturnListener() {
            @Override
            public void handleReturn(int replyCode, String replyText,
String exchange, String routingKey, AMQP.BasicProperties properties,
byte[] body) throws IOException {
                log("[ERROR:Service :"+routingKey+" seems down,
returning with code="+replyCode+" message="+replyText+"]");
            }
        });

//publish message:
// using BasicProperties.Builder, i add a replyTo= REPLY_QUEUE
// props represents an instance of AMQP.BasicProperties w/ replyTo set
boolean mandatory=true;
boolean immediate=true;
channel.basicPublish(exchange, routingKey, mandatory,
immediate,props,payload);
......

any help in understanding is much appreciated.
i have gone through these posts :
*
http://groups.google.com/group/rabbitmq-discuss/browse_thread/thread/176fc9b40a8c0b52/b6629b6cd14dec01?lnk=gst&q=immediate#b6629b6cd14dec01
* http://groups.google.com/group/rabbitmq-discuss/browse_thread/thread/5490be59d478f88/52ee9568d07441a6?lnk=gst&q=immediate#52ee9568d07441a6
the second throws some light on use case 2. the first link, is quite
enlightening but, since it was a thread in 2010, wondering if it's
status quo.

thanks and regards,
-cogitate




From andrea.rosa at hp.com  Thu Apr 26 10:37:39 2012
From: andrea.rosa at hp.com (Rosa, Andrea (HP Cloud Services))
Date: Thu, 26 Apr 2012 09:37:39 +0000
Subject: [rabbitmq-discuss] log process
In-Reply-To: <CAHZsVQamUcKi5+4dwcGVCp1Q-HgMW30zoSkGvkNX41h5VLM+yg@mail.gmail.com>
References: <5F389C517756284F80239F55BCA5DDDD36963612@G9W0721.americas.hpqcorp.net>
	<5F389C517756284F80239F55BCA5DDDD36964188@G9W0721.americas.hpqcorp.net>
	<CAHZsVQamUcKi5+4dwcGVCp1Q-HgMW30zoSkGvkNX41h5VLM+yg@mail.gmail.com>
Message-ID: <5F389C517756284F80239F55BCA5DDDD369647EA@G9W0721.americas.hpqcorp.net>

HI

Here the configuration I am using:
cat /etc/logrotate.d/rabbitmq-server

/var/log/rabbitmq/*.log {
        weekly
        missingok
        rotate 20
        compress
        delaycompress
        notifempty
        sharedscripts
        postrotate
            /etc/init.d/rabbitmq-server rotate-logs > /dev/null
        endscript
}

Thanks
--
Andrea
From: Brendan Hay [mailto:brendan at soundcloud.com]
Sent: 25 April 2012 11:53
To: Rosa, Andrea (HP Cloud Services)
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] log process

Hi Andrea,

That log entry is created by running "rabbitmqctl rotate_logs",  which is usually triggered manually or by the postrotate option of your logrotate.d configuration.

Are there any daemons/services which might have triggered that command? Or, if you are using logrotate.d could you please post the config you're using?

- Brendan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120426/c743be42/attachment.htm>

From nabeelak45 at gmail.com  Thu Apr 26 14:21:34 2012
From: nabeelak45 at gmail.com (Nabeel Akhtar (Abu Yousuf))
Date: Thu, 26 Apr 2012 18:21:34 +0500
Subject: [rabbitmq-discuss] RabbitMQ instances
In-Reply-To: <4F9829CA.4080507@rabbitmq.com>
References: <6401549.3099.1335359489722.JavaMail.geo-discussion-forums@vbxz8>
	<4F9829CA.4080507@rabbitmq.com>
Message-ID: <CAAzxWXLd+Lwmz=mPG-S3KVkbzG-AXRtUGTsGBAxa6A_T0WA9eA@mail.gmail.com>

Thanks Emile,

If there is only one broker and number of clients increase, how well will
it scale? Do you think after a certain level RabbitMQ broker will become a
bottleneck?

Is it possible to have backup RabbitMQ brokers so if the original one goes
down, back-up becomes active?

Thanks,
Nabeel

On Wed, Apr 25, 2012 at 9:43 PM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi Nabeel,
>
> On 25/04/12 14:11, Nabeel Akhtar wrote:
> > If I want to collect logs from multiple machines, would I need to run
> > RabbitMQ broker on all machines, or just one? If I run it on just one
> > machine, then which component should I run on all nodes?
>
> You only need one broker. You will need a RabbitMQ client, or some
> software that can speak a suitable protocol (such as STOMP) on all
> machines that produce logs.
>
> This post by Peter Ledbrook has some background that you may find useful:
>
> http://blog.cloudfoundry.com/post/13481011156/rethink-application-logging-with-rabbitmq
>
>
> -Emile
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120426/ae1738b3/attachment.htm>

From emile at rabbitmq.com  Thu Apr 26 14:45:46 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 26 Apr 2012 14:45:46 +0100
Subject: [rabbitmq-discuss] RabbitMQ instances
In-Reply-To: <CAAzxWXLd+Lwmz=mPG-S3KVkbzG-AXRtUGTsGBAxa6A_T0WA9eA@mail.gmail.com>
References: <6401549.3099.1335359489722.JavaMail.geo-discussion-forums@vbxz8>
	<4F9829CA.4080507@rabbitmq.com>
	<CAAzxWXLd+Lwmz=mPG-S3KVkbzG-AXRtUGTsGBAxa6A_T0WA9eA@mail.gmail.com>
Message-ID: <4F99518A.1040008@rabbitmq.com>


Hi Nabeel,

On 26/04/12 14:21, Nabeel Akhtar (Abu Yousuf) wrote:
> If there is only one broker and number of clients increase, how well
> will it scale? Do you think after a certain level RabbitMQ broker will
> become a bottleneck?

Yes it may become a bottleneck, because an overloaded broker may use TCP
backpressure to prevent message producers from publishing.

Message producers may decide simply to drop messages if the broker
applies backpressure. If the message flood is temporary and some message
loss can be tolerated then this may be an acceptable option.

You should also consider using a cluster and multiple queues in order to
parallelise the workload better.

If message consumers are not able to keep up with publishers then the
broker is more likely to come under pressure and become a bottleneck.
The best way to avoid this is to ensure that consumers are able to
process messages fast enough.

> Is it possible to have backup RabbitMQ brokers so if the original one
> goes down, back-up becomes active?

For high availability you should look at mirrored queues:
http://www.rabbitmq.com/ha.html


-Emile




From olexandr.klymenko at gmail.com  Thu Apr 26 15:01:32 2012
From: olexandr.klymenko at gmail.com (Alexander Klimenko)
Date: Thu, 26 Apr 2012 17:01:32 +0300
Subject: [rabbitmq-discuss] rabbitmq-server load average
Message-ID: <CACqr=q0AOiHufEA-y4=FvP_L7A0ZepODL9JikXmjBFj=D0nx4g@mail.gmail.com>

Hi guys,
I use rabbitmq-server v. *2.5.1*-1 on *debian squeeze* with kernel *3.0.0-14
*.
At the moment I perform performance optimization. I noticed that when I
start rabbitmq-server (on Intel(R) Atom(TM) CPU D525, 2 cores) system load
average get growth from *~0.5* to *~1*. *So my question: what causes such
growth?*
rabbitmq-server has one subscriber process and if I switch it off
(subscriber) it doesn't change load average.
Thanks.

-- 
Best regards
Alexander Klimenko
+38067 3705009
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120426/6ac2e1bd/attachment.htm>

From emile at rabbitmq.com  Thu Apr 26 15:57:45 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 26 Apr 2012 15:57:45 +0100
Subject: [rabbitmq-discuss] immediate, mandatory flag with no consumers
In-Reply-To: <fa3b9c55-7577-41c3-80f2-9176d4736a30@u7g2000yqc.googlegroups.com>
References: <fa3b9c55-7577-41c3-80f2-9176d4736a30@u7g2000yqc.googlegroups.com>
Message-ID: <4F996269.1050005@rabbitmq.com>

Hi,

On 25/04/12 20:27, cogitate wrote:
> i am trying to understand the usage of "immediate" and "mandatory" vis-
> a-vis when there are no consumers, to get rabbitmq broker to call
> handleReturn callback, after i setup returnListener.
> 
> i ran through the following scenarios:
> 1. no exchange, no queue
> 2. exchange, no queue
> 3. exchange, queue - no consumers
> but, i don't get a return call from the server.

Do you give the return call time to be called? The channel will need to
remain open for long enough after the publish. If you close the channel
immediately after the publish then you won't see output. Using your
sample code I receive this message if no consumers are present:

 [ERROR:Service :REPLY_QUEUE seems down, returning with code=313
message=NO_CONSUMERS]

and this message if the exchange is not bound to a queue:

 [ERROR:Service :REPLY_QUEUE seems down, returning with code=312
message=NO_ROUTE]



-Emile





From monish.unni at gmail.com  Thu Apr 26 17:17:00 2012
From: monish.unni at gmail.com (Monish Unni)
Date: Thu, 26 Apr 2012 09:17:00 -0700
Subject: [rabbitmq-discuss] immediate, mandatory flag with no consumers
In-Reply-To: <4F996269.1050005@rabbitmq.com>
References: <fa3b9c55-7577-41c3-80f2-9176d4736a30@u7g2000yqc.googlegroups.com>
	<4F996269.1050005@rabbitmq.com>
Message-ID: <CAPwx=WNGYvmRaQe5F1_0w5bObzKuhdORGnwKhoT6sX-yUZaTBw@mail.gmail.com>

Thanks Emile for trying out the sample code!

I do have  a 3 second timeout when consuming messages.
so what's an appropriate wait time? what would be "long enough" ?

regards.



On Thu, Apr 26, 2012 at 7:57 AM, Emile Joubert <emile at rabbitmq.com> wrote:
> Hi,
>
> On 25/04/12 20:27, cogitate wrote:
>> i am trying to understand the usage of "immediate" and "mandatory" vis-
>> a-vis when there are no consumers, to get rabbitmq broker to call
>> handleReturn callback, after i setup returnListener.
>>
>> i ran through the following scenarios:
>> 1. no exchange, no queue
>> 2. exchange, no queue
>> 3. exchange, queue - no consumers
>> but, i don't get a return call from the server.
>
> Do you give the return call time to be called? The channel will need to
> remain open for long enough after the publish. If you close the channel
> immediately after the publish then you won't see output. Using your
> sample code I receive this message if no consumers are present:
>
> ?[ERROR:Service :REPLY_QUEUE seems down, returning with code=313
> message=NO_CONSUMERS]
>
> and this message if the exchange is not bound to a queue:
>
> ?[ERROR:Service :REPLY_QUEUE seems down, returning with code=312
> message=NO_ROUTE]
>
>
>
> -Emile
>
>
>
>



-- 
"we use light to see , ergo, we can never see light."

From emile at rabbitmq.com  Thu Apr 26 17:31:58 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 26 Apr 2012 17:31:58 +0100
Subject: [rabbitmq-discuss] immediate, mandatory flag with no consumers
In-Reply-To: <CAPwx=WNGYvmRaQe5F1_0w5bObzKuhdORGnwKhoT6sX-yUZaTBw@mail.gmail.com>
References: <fa3b9c55-7577-41c3-80f2-9176d4736a30@u7g2000yqc.googlegroups.com>
	<4F996269.1050005@rabbitmq.com>
	<CAPwx=WNGYvmRaQe5F1_0w5bObzKuhdORGnwKhoT6sX-yUZaTBw@mail.gmail.com>
Message-ID: <4F99787E.8030501@rabbitmq.com>

Hi,

On 26/04/12 17:17, Monish Unni wrote:
> I do have  a 3 second timeout when consuming messages.
> so what's an appropriate wait time? what would be "long enough" ?

I couldn't possibly say, because it depends partly on the expected
latency. 3s sounds sounds long enough - unless the broker is orbiting
Jupiter.

Something else to check is whether the broker state matches up with your
expectation:

rabbitmqctl list_queues name consumers
rabbitmqctl list_bindings

Also check the broker logfile. The problem is probably closer to the
client side though, since your code worked for me.

-Emile


From nshah at btisystems.com  Thu Apr 26 18:49:49 2012
From: nshah at btisystems.com (Nitin Shah)
Date: Thu, 26 Apr 2012 13:49:49 -0400
Subject: [rabbitmq-discuss] General Questions to the group
Message-ID: <D0E69E45B211C74F82F5EC699E0E37D0FAED327B@mail.btisystems.com>

Hi ,

I have been looking at the RabbitMQ "c" broker and its associated client. I have few basic questions that would help me understand the status of the broker and its c client.


1.       We are considering using the Broker. I would like to understand its performance experiences from the mailing list.

2.       How stable is the product.

3.       What version would one recommend.

4.       We would probably do a C++ wrapper around the c clients. Is that approach practical?

Thanks

Nitin



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120426/1cb0e675/attachment.htm>

From kot.begemot at gmail.com  Thu Apr 26 21:01:20 2012
From: kot.begemot at gmail.com (Vadim Chekan)
Date: Thu, 26 Apr 2012 13:01:20 -0700
Subject: [rabbitmq-discuss] Active-active crash report
Message-ID: <CAFWGgNFpLjY4Ufjj3OdM-AxwRp0C8Rbm=GqoGX4MeAhus3bQhw@mail.gmail.com>

Hi all,

I'm testing my active-active setup (2.8.1, linux 64) and I am randomly
running into some crashes when I'm stopping a node. I can stop one node
abut another one fails along with it. Below is a crash log.

Is "rabbitmq_management" the UI plugin? Could it bring down the whone node,
because I keep UI open in browser while doing my testing.

Vadim.

=INFO REPORT==== 26-Apr-2012::12:15:58 ===
Adding mirror of queue 'test_33' in vhost '/' on node 'rabbit at rabbitmq-dev-2':
<3066.4773.0>

=INFO REPORT==== 26-Apr-2012::12:15:58 ===
Adding mirror of queue 'test_34' in vhost '/' on node 'rabbit at rabbitmq-dev-2':
<3066.4777.0>

=INFO REPORT==== 26-Apr-2012::12:15:59 ===
Adding mirror of queue 'test_35' in vhost '/' on node 'rabbit at rabbitmq-dev-2':
<3066.4782.0>

=INFO REPORT==== 26-Apr-2012::12:15:59 ===
Adding mirror of queue 'test_36' in vhost '/' on node 'rabbit at rabbitmq-dev-2':
<3066.4786.0>

=INFO REPORT==== 26-Apr-2012::12:15:59 ===
Adding mirror of queue 'test_37' in vhost '/' on node 'rabbit at rabbitmq-dev-2':
<3066.4790.0>

=INFO REPORT==== 26-Apr-2012::12:15:59 ===
Adding mirror of queue 'test_38' in vhost '/' on node 'rabbit at rabbitmq-dev-2':
<3066.4795.0>

=INFO REPORT==== 26-Apr-2012::12:15:59 ===
Adding mirror of queue 'test_39' in vhost '/' on node 'rabbit at rabbitmq-dev-2':
<3066.4799.0>

=ERROR REPORT==== 26-Apr-2012::12:15:59 ===
Discarding message
{'$gen_call',{<0.1955.0>,#Ref<0.0.0.5513>},{add_on_right,{9,<0.1955.0>}}}
from <0.1955.0> to <0.26823.834>
 in an old incarnation (2) of this node (3)


=INFO REPORT==== 26-Apr-2012::12:15:59 ===
Adding mirror of queue 'test_40' in vhost '/' on node 'rabbit at rabbitmq-dev-2':
<3066.4803.0>

=INFO REPORT==== 26-Apr-2012::12:15:59 ===
Adding mirror of queue 'test_41' in vhost '/' on node 'rabbit at rabbitmq-dev-2':
<3066.4807.0>

=ERROR REPORT==== 26-Apr-2012::12:15:59 ===
Discarding message
{'$gen_call',{<0.1983.0>,#Ref<0.0.0.5648>},{add_on_right,{9,<0.1983.0>}}}
from <0.1983.0> to <0.26850.834>
 in an old incarnation (2) of this node (3)


=INFO REPORT==== 26-Apr-2012::12:15:59 ===
Adding mirror of queue 'test_42' in vhost '/' on node 'rabbit at rabbitmq-dev-2':
<3066.4811.0>

=INFO REPORT==== 26-Apr-2012::12:15:59 ===
Adding mirror of queue 'test_43' in vhost '/' on node 'rabbit at rabbitmq-dev-2':
<3066.4816.0>

=INFO REPORT==== 26-Apr-2012::12:16:39 ===
rabbit on node 'rabbit at rabbitmq-dev-3' up

=WARNING REPORT==== 26-Apr-2012::12:18:15 ===
closing AMQP connection <0.1433.0> (172.16.51.100:16360 -> 10.7.1.21:5672):
connection_closed_abruptly

=INFO REPORT==== 26-Apr-2012::12:23:57 ===
    application: rabbitmq_management
    exited: shutdown
    type: permanent

=INFO REPORT==== 26-Apr-2012::12:23:57 ===
stopped TCP Listener on 0.0.0.0:5672

=ERROR REPORT==== 26-Apr-2012::12:23:57 ===
** Generic server <0.1800.0> terminating
** Last message in was {'$gen_cast',{gm_deaths,[<0.4684.0>]}}
** When Server state == {state,
                            {amqqueue,
                                {resource,<<"/">>,queue,<<"test_29">>},
                                true,false,<0.1433.0>,
                                [{<<"x-ha-policy">>,longstr,<<"all">>},
                                 {<<"x-message-ttl">>,signedint,600000}],
                                <0.1799.0>,[],all},
                            <0.1801.0>,
                            {dict,0,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                            #Fun<rabbit_mirror_queue_master.1.2951048>,
                            #Fun<rabbit_mirror_queue_master.2.72654940>}
** Reason for termination ==
** {{case_clause,{ok,<3066.9234.0>,[<0.4683.0>]}},
    [{rabbit_mirror_queue_coordinator,handle_cast,2},
     {gen_server2,handle_msg,2},
     {proc_lib,wake_up,3}]}

=ERROR REPORT==== 26-Apr-2012::12:23:57 ===
** Generic server <0.1714.0> terminating
** Last message in was {'$gen_cast',{gm_deaths,[<0.4653.0>]}}
** When Server state == {state,
                            {amqqueue,
                                {resource,<<"/">>,queue,<<"test_23">>},
                                true,false,<0.1433.0>,
                                [{<<"x-ha-policy">>,longstr,<<"all">>},
                                 {<<"x-message-ttl">>,signedint,600000}],
                                <0.1712.0>,[],all},
                            <0.1715.0>,
                            {dict,0,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                            #Fun<rabbit_mirror_queue_master.1.2951048>,
                            #Fun<rabbit_mirror_queue_master.2.72654940>}
** Reason for termination ==
** {{case_clause,{ok,<3066.9155.0>,[<0.4652.0>]}},
    [{rabbit_mirror_queue_coordinator,handle_cast,2},
     {gen_server2,handle_msg,2},
     {proc_lib,wake_up,3}]}

=ERROR REPORT==== 26-Apr-2012::12:23:57 ===
** Generic server <0.1531.0> terminating
** Last message in was {'$gen_cast',{gm_deaths,[<0.4587.0>]}}
** When Server state == {state,
                            {amqqueue,
                                {resource,<<"/">>,queue,<<"test_10">>},
                                true,false,<0.1433.0>,
                                [{<<"x-ha-policy">>,longstr,<<"all">>},
                                 {<<"x-message-ttl">>,signedint,600000}],
                                <0.1530.0>,[],all},
                            <0.1532.0>,
                            {dict,0,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                            #Fun<rabbit_mirror_queue_master.1.2951048>,
                            #Fun<rabbit_mirror_queue_master.2.72654940>}
** Reason for termination ==
** {noproc,{gen_server2,call,[worker_pool,next_free,infinity]}}
(END)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120426/e224031c/attachment.htm>

From abdullahsaima at yahoo.com  Thu Apr 26 21:07:16 2012
From: abdullahsaima at yahoo.com (Saima Asif)
Date: Thu, 26 Apr 2012 21:07:16 +0100 (BST)
Subject: [rabbitmq-discuss] Exchange related question
Message-ID: <1335470836.82792.YahooMailNeo@web29703.mail.ird.yahoo.com>

Hi,

I have a simple question to confirm my idea about exchanges, When a message arrives and there are number of exchanges, does it move to all exchanges ,or before sending it to exchange it is decided that this message would be moved to this particular exchange if yes who decides this?

Thanks in advance.
?
Saima Asif
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120426/8c76fef4/attachment.htm>

From videlalvaro at gmail.com  Thu Apr 26 21:20:23 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Thu, 26 Apr 2012 22:20:23 +0200
Subject: [rabbitmq-discuss] Exchange related question
In-Reply-To: <1335470836.82792.YahooMailNeo@web29703.mail.ird.yahoo.com>
References: <1335470836.82792.YahooMailNeo@web29703.mail.ird.yahoo.com>
Message-ID: <7576566F69124E36B3784C4A8FD77A78@gmail.com>

Hi, 

You publish messages to an exchange when you do:

$channel->basic_publish('exchange_name', $message, 'routing_key');

So the message will go just to that exchange you specify during publish.

Regards,

Alvaro 

-- 
Sent with Sparrow (http://www.sparrowmailapp.com/?sig)


On Thursday, April 26, 2012 at 10:07 PM, Saima Asif wrote:

> Hi,
> 
> I have a simple question to confirm my idea about exchanges, When a message arrives and there are number of exchanges, does it move to all exchanges ,or before sending it to exchange it is decided that this message would be moved to this particular exchange if yes who decides this?
> 
> Thanks in advance.
>  
> Saima Asif
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120426/5335a7ce/attachment.htm>

From munni at etrade.com  Thu Apr 26 19:46:40 2012
From: munni at etrade.com (Unni, Monish)
Date: Thu, 26 Apr 2012 18:46:40 +0000
Subject: [rabbitmq-discuss] immediate, mandatory flag with no consumers
In-Reply-To: <4F99787E.8030501@rabbitmq.com>
References: <fa3b9c55-7577-41c3-80f2-9176d4736a30@u7g2000yqc.googlegroups.com>
	<4F996269.1050005@rabbitmq.com>
	<CAPwx=WNGYvmRaQe5F1_0w5bObzKuhdORGnwKhoT6sX-yUZaTBw@mail.gmail.com>
	<4F99787E.8030501@rabbitmq.com>
Message-ID: <AC888676-0872-4116-A55E-03FE45C567D8@etrade.com>

Thanks Emile for pointers!

i changed the timeout to 30 seconds - yet i don't get the return call.
i checked broker for list_queues, bindings and making sure there are no consumers - it seems to be configured correctly.

btw : this code is client-side, and i am testing if the server is up. 
emile, if you could send me the code that you tried as a stand-alone, it might help much.
as it is - thank you very much for looking at it.

regards,
-monish

On Apr 26, 2012, at 9:31 AM, Emile Joubert wrote:

> Hi,
> 
> On 26/04/12 17:17, Monish Unni wrote:
>> I do have  a 3 second timeout when consuming messages.
>> so what's an appropriate wait time? what would be "long enough" ?
> 
> I couldn't possibly say, because it depends partly on the expected
> latency. 3s sounds sounds long enough - unless the broker is orbiting
> Jupiter.
> 
> Something else to check is whether the broker state matches up with your
> expectation:
> 
> rabbitmqctl list_queues name consumers
> rabbitmqctl list_bindings
> 
> Also check the broker logfile. The problem is probably closer to the
> client side though, since your code worked for me.
> 
> -Emile
> 


From matthew at rabbitmq.com  Thu Apr 26 23:31:24 2012
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 26 Apr 2012 23:31:24 +0100
Subject: [rabbitmq-discuss] Active-active crash report
In-Reply-To: <CAFWGgNFpLjY4Ufjj3OdM-AxwRp0C8Rbm=GqoGX4MeAhus3bQhw@mail.gmail.com>
References: <CAFWGgNFpLjY4Ufjj3OdM-AxwRp0C8Rbm=GqoGX4MeAhus3bQhw@mail.gmail.com>
Message-ID: <20120426223123.GA9230@wellquite.org>

Hi Vadim,

On Thu, Apr 26, 2012 at 01:01:20PM -0700, Vadim Chekan wrote:
> I'm testing my active-active setup (2.8.1, linux 64) and I am randomly
> running into some crashes when I'm stopping a node. I can stop one node
> abut another one fails along with it. Below is a crash log.
> 
> =ERROR REPORT==== 26-Apr-2012::12:15:59 ===
> Discarding message
> {'$gen_call',{<0.1955.0>,#Ref<0.0.0.5513>},{add_on_right,{9,<0.1955.0>}}}
> from <0.1955.0> to <0.26823.834>
>  in an old incarnation (2) of this node (3)

I'm worried about these messages. Someone else on this list has seen
this sort of thing too and it's causing them trouble. I've not seen this
issue myself in testing which is frustrating. However, that's not the
cause of your crash in this case (I think).

> ** Generic server <0.1800.0> terminating
> ** Last message in was {'$gen_cast',{gm_deaths,[<0.4684.0>]}}
> ** When Server state == {state,
>                             {amqqueue,
>                                 {resource,<<"/">>,queue,<<"test_29">>},
>                                 true,false,<0.1433.0>,
>                                 [{<<"x-ha-policy">>,longstr,<<"all">>},
>                                  {<<"x-message-ttl">>,signedint,600000}],
>                                 <0.1799.0>,[],all},
>                             <0.1801.0>,
>                             {dict,0,16,16,8,80,48,
> 
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                  []},
>                                 {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                   [],[]}}},
>                             #Fun<rabbit_mirror_queue_master.1.2951048>,
>                             #Fun<rabbit_mirror_queue_master.2.72654940>}
> ** Reason for termination ==
> ** {{case_clause,{ok,<3066.9234.0>,[<0.4683.0>]}},
>     [{rabbit_mirror_queue_coordinator,handle_cast,2},
>      {gen_server2,handle_msg,2},
>      {proc_lib,wake_up,3}]}

Well this is very odd. We fixed a bug that looked like this, but it got
fixed in 2.7.1 (and related to x-ha-policy = nodes. Could you just check
that you really are running 2.8.1? We're not aware of any bug in this
area in 2.8.1, but that's certainly not saying there's not one there! Is
there any particular sequence of events that you can perform that
reliably triggers this crash? Could you also check the logs of the other
nodes (both .log and -sasl.log) to see if there's further crash reports
in there?

Also, there have been discovered lots of bugs relating to the code
changes made to add DLX support in 2.8.1, especially in relation to HA.
It's possible one of the issues I found with TTL and HA is causing this.
2.8.2 should be out soonish which might introduce fewer new bugs than it
fixes, but in the mean time, could you try without the TTL and see if
that helps?

Matthew

From pablomolnar at gmail.com  Thu Apr 26 23:35:45 2012
From: pablomolnar at gmail.com (Pablo Molnar)
Date: Thu, 26 Apr 2012 19:35:45 -0300
Subject: [rabbitmq-discuss] Ignore delivery mode 2 in some queues
Message-ID: <CANVSfpJXf6s39aKKXB9NoG=_tqXAHGi7rBP2DHmTQ3xx5Fvmdw@mail.gmail.com>

Hi there,

I'm sending persistant messages to a fanout exchange and consuming through
a durable queue. I'm also have another queue binded to the same exchange
just for logging purpose (all messages received are stored in a MongoDB).

The question is how I can ignore the delivery mode 2 (persistent) for the
log queue. Sometimes in peak hours there is a lot of enqueued in the log
queue and I feel it is due persistence overhead, I don't need high
availability for log queue.

Thanks!
Pablo
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120426/5d7cdac6/attachment.htm>

From matthew at rabbitmq.com  Thu Apr 26 23:42:06 2012
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 26 Apr 2012 23:42:06 +0100
Subject: [rabbitmq-discuss] Ignore delivery mode 2 in some queues
In-Reply-To: <CANVSfpJXf6s39aKKXB9NoG=_tqXAHGi7rBP2DHmTQ3xx5Fvmdw@mail.gmail.com>
References: <CANVSfpJXf6s39aKKXB9NoG=_tqXAHGi7rBP2DHmTQ3xx5Fvmdw@mail.gmail.com>
Message-ID: <20120426224204.GB9230@wellquite.org>

On Thu, Apr 26, 2012 at 07:35:45PM -0300, Pablo Molnar wrote:
> The question is how I can ignore the delivery mode 2 (persistent) for the
> log queue. Sometimes in peak hours there is a lot of enqueued in the log
> queue and I feel it is due persistence overhead, I don't need high
> availability for log queue.

Make the log queue non-durable. Messages are only immediately written to
disk if they are persistent and sent to a durable queue.

However, the same persistent msg sent to many durable queues only gets
written to disk once. Each queue has to do a small amount of on-disk
writing to record that the msg is in the queue, but the msg itself only
gets written once. Thus the extra cost of accidentally sending the msg
to another durable queue should be very low.

Matthew

From matthias at rabbitmq.com  Thu Apr 26 23:46:10 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 26 Apr 2012 23:46:10 +0100
Subject: [rabbitmq-discuss] Ignore delivery mode 2 in some queues
In-Reply-To: <20120426224204.GB9230@wellquite.org>
References: <CANVSfpJXf6s39aKKXB9NoG=_tqXAHGi7rBP2DHmTQ3xx5Fvmdw@mail.gmail.com>
	<20120426224204.GB9230@wellquite.org>
Message-ID: <4F99D032.7090401@rabbitmq.com>

On 26/04/12 23:42, Matthew Sackman wrote:
> However, the same persistent msg sent to many durable queues only gets
> written to disk once. Each queue has to do a small amount of on-disk
> writing to record that the msg is in the queue, but the msg itself only
> gets written once. Thus the extra cost of accidentally sending the msg
> to another durable queue should be very low.

Indeed. From the OP's description I rather suspect the bottleneck is not 
rabbit but the consumer which is writing messages to mongodb.

Matthias.

From kot.begemot at gmail.com  Fri Apr 27 00:27:48 2012
From: kot.begemot at gmail.com (Vadim Chekan)
Date: Thu, 26 Apr 2012 16:27:48 -0700
Subject: [rabbitmq-discuss] Active-active crash report
In-Reply-To: <20120426223123.GA9230@wellquite.org>
References: <CAFWGgNFpLjY4Ufjj3OdM-AxwRp0C8Rbm=GqoGX4MeAhus3bQhw@mail.gmail.com>
	<20120426223123.GA9230@wellquite.org>
Message-ID: <CAFWGgNFu6jnCp-qCwjg5AL=TZ0xrCkSZou472e1ZaE0=HRbPOw@mail.gmail.com>

Hi Matthew,

Thanks for your reply. At least web UI reports that all 3 nodes are 2.8.1
so I guess they are  up to date.
Reproducing this bug is difficult. I'll work on it for may be 2 more days,
trying to find a combination which would be reproducible. Very preliminary,
I have impression that "exclusive" queue flag have something to do with it,
but I will experiment with ttl too, as you suggested.

I dont know if it is related, but I had a strange situation when there was
an exclusive autodelete queue without a connection (connection reported
"unknown") and it was impossible to delete it because "resource lock"
error.
Hopefully I'll be able to report more tomorrow.

Thanks,
Vadim.

On Thu, Apr 26, 2012 at 3:31 PM, Matthew Sackman <matthew at rabbitmq.com>wrote:

> Hi Vadim,
>
> On Thu, Apr 26, 2012 at 01:01:20PM -0700, Vadim Chekan wrote:
> > I'm testing my active-active setup (2.8.1, linux 64) and I am randomly
> > running into some crashes when I'm stopping a node. I can stop one node
> > abut another one fails along with it. Below is a crash log.
> >
> > =ERROR REPORT==== 26-Apr-2012::12:15:59 ===
> > Discarding message
> > {'$gen_call',{<0.1955.0>,#Ref<0.0.0.5513>},{add_on_right,{9,<0.1955.0>}}}
> > from <0.1955.0> to <0.26823.834>
> >  in an old incarnation (2) of this node (3)
>
> I'm worried about these messages. Someone else on this list has seen
> this sort of thing too and it's causing them trouble. I've not seen this
> issue myself in testing which is frustrating. However, that's not the
> cause of your crash in this case (I think).
>
> > ** Generic server <0.1800.0> terminating
> > ** Last message in was {'$gen_cast',{gm_deaths,[<0.4684.0>]}}
> > ** When Server state == {state,
> >                             {amqqueue,
> >                                 {resource,<<"/">>,queue,<<"test_29">>},
> >                                 true,false,<0.1433.0>,
> >                                 [{<<"x-ha-policy">>,longstr,<<"all">>},
> >                                  {<<"x-message-ttl">>,signedint,600000}],
> >                                 <0.1799.0>,[],all},
> >                             <0.1801.0>,
> >                             {dict,0,16,16,8,80,48,
> >
> > {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
> >                                  []},
> >
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
> >                                   [],[]}}},
> >                             #Fun<rabbit_mirror_queue_master.1.2951048>,
> >                             #Fun<rabbit_mirror_queue_master.2.72654940>}
> > ** Reason for termination ==
> > ** {{case_clause,{ok,<3066.9234.0>,[<0.4683.0>]}},
> >     [{rabbit_mirror_queue_coordinator,handle_cast,2},
> >      {gen_server2,handle_msg,2},
> >      {proc_lib,wake_up,3}]}
>
> Well this is very odd. We fixed a bug that looked like this, but it got
> fixed in 2.7.1 (and related to x-ha-policy = nodes. Could you just check
> that you really are running 2.8.1? We're not aware of any bug in this
> area in 2.8.1, but that's certainly not saying there's not one there! Is
> there any particular sequence of events that you can perform that
> reliably triggers this crash? Could you also check the logs of the other
> nodes (both .log and -sasl.log) to see if there's further crash reports
> in there?
>
> Also, there have been discovered lots of bugs relating to the code
> changes made to add DLX support in 2.8.1, especially in relation to HA.
> It's possible one of the issues I found with TTL and HA is causing this.
> 2.8.2 should be out soonish which might introduce fewer new bugs than it
> fixes, but in the mean time, could you try without the TTL and see if
> that helps?
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 

From kot.begemot at gmail.com  Fri Apr 27 01:31:05 2012
From: kot.begemot at gmail.com (Vadim Chekan)
Date: Thu, 26 Apr 2012 17:31:05 -0700
Subject: [rabbitmq-discuss] Active-active crash report
In-Reply-To: <CAFWGgNFu6jnCp-qCwjg5AL=TZ0xrCkSZou472e1ZaE0=HRbPOw@mail.gmail.com>
References: <CAFWGgNFpLjY4Ufjj3OdM-AxwRp0C8Rbm=GqoGX4MeAhus3bQhw@mail.gmail.com>
	<20120426223123.GA9230@wellquite.org>
	<CAFWGgNFu6jnCp-qCwjg5AL=TZ0xrCkSZou472e1ZaE0=HRbPOw@mail.gmail.com>
Message-ID: <CAFWGgNH5c9eJfVa3w9Sks+wtF5VoBVPWGgxA54ECcZ0y3KCn-w@mail.gmail.com>

Ok, I got it again.
3 nodes. Stop slave, restart app(client), bring slave back online, stop
master, restart app, bring master back online, BOOM!
So here are logs from both nodes, the one which I shutdown (dev-2) and the
one which failed unexpectedly (dev-3)

dev-2 was the master node and when I stopped it, it brought dev-3 node down
with it.
Did everything started because of this?
> Reason:     reached_max_restart_intensity

Vadim

dev-3 log :
===============================================
=INFO REPORT==== 26-Apr-2012::16:50:38 ===
Management agent started.

=INFO REPORT==== 26-Apr-2012::16:50:38 ===
Management plugin started. Port: 55672, path: /

=INFO REPORT==== 26-Apr-2012::16:51:07 ===
    application: rabbitmq_management
    exited: shutdown
    type: permanent

=INFO REPORT==== 26-Apr-2012::16:51:08 ===
stopped TCP Listener on 0.0.0.0:5672
===============================================

dev-3-sasl.log
===============================================
=SUPERVISOR REPORT==== 26-Apr-2012::16:51:07 ===
     Supervisor: {local,rabbit_mgmt_sup}
     Context:    child_terminated
     Reason:     shutdown
     Offender:   [{pid,<0.396.0>},
                  {name,mirroring},
                  {mfa,
                      {mirrored_supervisor,start_internal,
                          [rabbit_mgmt_sup,
                           [{rabbit_mgmt_db,
                                {rabbit_mgmt_db,start_link,[]},
                                permanent,4294967295,worker,
                                [rabbit_mgmt_db]}]]}},
                  {restart_type,permanent},
                  {shutdown,4294967295},
                  {child_type,worker}]


=SUPERVISOR REPORT==== 26-Apr-2012::16:51:07 ===
     Supervisor: {local,rabbit_mgmt_sup}
     Context:    shutdown
     Reason:     reached_max_restart_intensity
     Offender:   [{pid,<0.396.0>},
                  {name,mirroring},
                  {mfa,
                      {mirrored_supervisor,start_internal,
                          [rabbit_mgmt_sup,
                           [{rabbit_mgmt_db,
                                {rabbit_mgmt_db,start_link,[]},
                                permanent,4294967295,worker,
                                [rabbit_mgmt_db]}]]}},
                  {restart_type,permanent},
                  {shutdown,4294967295},
                  {child_type,worker}]

===============================================

dev-2 log
===============================================
=INFO REPORT==== 26-Apr-2012::16:51:07 ===
Stopping Rabbit

=INFO REPORT==== 26-Apr-2012::16:51:07 ===
    application: rabbitmq_management_visualiser
    exited: stopped
    type: permanent

=INFO REPORT==== 26-Apr-2012::16:51:07 ===
    application: rabbitmq_management
    exited: stopped
    type: permanent

=INFO REPORT==== 26-Apr-2012::16:51:07 ===
    application: rabbitmq_management_agent
    exited: stopped
    type: permanent

=INFO REPORT==== 26-Apr-2012::16:51:07 ===
stopped TCP Listener on 0.0.0.0:5672

=INFO REPORT==== 26-Apr-2012::16:51:08 ===
rabbit on node 'rabbit at rabbitmq-dev-3' down

=INFO REPORT==== 26-Apr-2012::16:51:08 ===
Mirrored-queue (queue 'Advertiser-ONYX' in vhost '/'): Slave
<'rabbit at rabbitmq-dev-2'.1.265.0> saw deaths of mirrors
<'rabbit at rabbitmq-dev-3'.2.290.0>

=INFO REPORT==== 26-Apr-2012::16:51:08 ===
Mirrored-queue (queue 'Search-JROSE6420' in vhost '/'): Slave
<'rabbit at rabbitmq-dev-2'.1.276.0> saw deaths of mirrors
<'rabbit at rabbitmq-dev-3'.2.328.0>

=INFO REPORT==== 26-Apr-2012::16:51:08 ===
Mirrored-queue (queue 'Advertiser-DHOHMEYERGX280' in vhost '/'): Slave
<'rabbit at rabbitmq-dev-2'.1.268.0> saw deaths of mirrors
<'rabbit at rabbitmq-dev-3'.2.288.0>

=INFO REPORT==== 26-Apr-2012::16:51:08 ===
Mirrored-queue (queue 'CustomerAdmin-DHOHMEYERGX280' in vhost '/'): Slave
<'rabbit at rabbitmq-dev-2'.1.270.0> saw deaths of mirrors
<'rabbit at rabbitmq-dev-3'.2.294.0>

=INFO REPORT==== 26-Apr-2012::16:51:08 ===
Mirrored-queue (queue 'Tracking-JROSE6420' in vhost '/'): Slave
<'rabbit at rabbitmq-dev-2'.1.250.0> saw deaths of mirrors
<'rabbit at rabbitmq-dev-3'.2.247.0>

=ERROR REPORT==== 26-Apr-2012::16:51:08 ===
** Generic server rabbit_mirror_queue_slave_sup terminating
** Last message in was {'EXIT',<0.127.0>,shutdown}
** When Server state == {state,
                         {local,rabbit_mirror_queue_slave_sup},
                         simple_one_for_one_terminate,
                         [{child,undefined,rabbit_mirror_queue_slave,
                           {rabbit_mirror_queue_slave,start_link,[]},
                           temporary,4294967295,worker,
                           [rabbit_mirror_queue_slave]}],
                         {dict,11,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                          {{[],[],
                            [[<0.265.0>,
                              {amqqueue,

{resource,<<"/">>,queue,<<"Advertiser-ONYX">>},
                               false,false,none,
                               [{<<"x-ha-policy">>,longstr,<<"all">>},
                                {<<"x-message-ttl">>,signedint,1200000}],
                               <3067.289.0>,
                               [<3065.334.0>],
                               all}]],
                            [],
                            [[undefined,
                              {amqqueue,
                               {resource,<<"/">>,queue,
                                <<"Advertiser-heartbeat-DHOHMEYERGX280">>},
                               false,true,<3065.24765.0>,
                               [{<<"x-ha-policy">>,longstr,<<"all">>}],
                               <3065.24784.0>,
                               [<3067.12370.2>],
                               all}],
                             [<0.6730.0>,
                              {amqqueue,
                               {resource,<<"/">>,queue,
                                <<"Advertiser-heartbeat-DHOHMEYERGX280">>},
                               false,true,<3065.14349.1>,
                               [{<<"x-ha-policy">>,longstr,<<"all">>}],
                               <3065.14370.1>,[],all}]],
                            [[<0.268.0>,
                              {amqqueue,
                               {resource,<<"/">>,queue,
                                <<"Advertiser-DHOHMEYERGX280">>},
                               false,false,none,
                               [{<<"x-ha-policy">>,longstr,<<"all">>},
                                {<<"x-message-ttl">>,signedint,1200000}],
                               <3067.287.0>,
                               [<3065.332.0>],
                               all}]],
                            [],
                            [[<0.270.0>,
                              {amqqueue,
                               {resource,<<"/">>,queue,
                                <<"CustomerAdmin-DHOHMEYERGX280">>},
                               false,false,none,
                               [{<<"x-ha-policy">>,longstr,<<"all">>},
                                {<<"x-message-ttl">>,signedint,1200000}],
                               <3067.295.0>,
                               [<3065.338.0>],
                               all}]],
                            [],
                            [[<0.272.0>,
                              {amqqueue,
                               {resource,<<"/">>,queue,
                                <<"Sales-DHOHMEYERGX280">>},
                               false,false,none,
                               [{<<"x-ha-policy">>,longstr,<<"all">>},
                                {<<"x-message-ttl">>,signedint,1200000}],
                               <3067.317.0>,
                               [<3065.356.0>],
                               all}]],
                            [[<0.250.0>,
                              {amqqueue,
                               {resource,<<"/">>,queue,
                                <<"Tracking-JROSE6420">>},
                               false,false,none,
                               [{<<"x-ha-policy">>,longstr,<<"all">>},
                                {<<"x-message-ttl">>,signedint,1200000}],
                               <3067.247.0>,
                               [<3065.249.0>],
                               all}]],
                            [[<0.274.0>,
                              {amqqueue,
                               {resource,<<"/">>,queue,
                                <<"RelatedLinks-ROGERMOORE">>},
                               false,false,none,
                               [{<<"x-ha-policy">>,longstr,<<"all">>},
                                {<<"x-message-ttl">>,signedint,1200000}],
                               <3067.331.0>,
                               [<3065.370.0>],
                               all}]],
                            [[<0.252.0>,
                              {amqqueue,
                               {resource,<<"ActivityLogging">>,queue,

<<"vsw.activitylogging.conversion.pendingconversion">>},
                               true,false,none,
                               [{<<"x-ha-policy">>,longstr,<<"all">>}],
                               <3067.253.0>,
                               [<3065.257.0>],
                               all}]],
                            [[<0.276.0>,
                              {amqqueue,

{resource,<<"/">>,queue,<<"Search-JROSE6420">>},
                               false,false,none,
                               [{<<"x-ha-policy">>,longstr,<<"all">>},
                                {<<"x-message-ttl">>,signedint,1200000}],
                               <3067.26259.1>,
                               [<3065.4161.0>],
                               all}]],
                            [[<0.261.0>,
                              {amqqueue,
                               {resource,<<"/">>,queue,
                                <<"RelatedLinks-ONYX">>},
                               false,false,none,
                               [{<<"x-ha-policy">>,longstr,<<"all">>},
                                {<<"x-message-ttl">>,signedint,1200000}],
                               <3067.277.0>,
                               [<3065.322.0>],
                               all}]],
                            []}}},
                         10,10,[],rabbit_mirror_queue_slave_sup,[]}
** Reason for termination ==
** {badarg,[{erlang,unlink,[undefined]},
            {supervisor2,'-terminate_simple_children/3-fun-0-',4},
            {dict,fold_bucket,3},
            {dict,fold_seg,4},
            {dict,fold_segs,4},
            {supervisor2,terminate_simple_children,3},
            {supervisor2,terminate,2},
            {gen_server,terminate,6}]}

=INFO REPORT==== 26-Apr-2012::16:51:08 ===
Mirrored-queue (queue 'vsw.activitylogging.conversion.pendingconversion' in
vhost 'ActivityLogging'): Slave <'rabbit at rabbitmq-dev-2'.1.252.0> saw
deaths of mirrors <'rabbit at rabbitmq-dev-3'.2.253.0>

=ERROR REPORT==== 26-Apr-2012::16:51:08 ===
** Generic server <0.265.0> terminating
** Last message in was {'EXIT',<0.249.0>,
                           {badarg,
                               [{erlang,unlink,[undefined]},
                                {supervisor2,

'-terminate_simple_children/3-fun-0-',4},
                                {dict,fold_bucket,3},
                                {dict,fold_seg,4},
                                {dict,fold_segs,4},
                                {supervisor2,terminate_simple_children,3},
                                {supervisor2,terminate,2},
                                {gen_server,terminate,6}]}}
** When Server state == {state,
                         {amqqueue,
                          {resource,<<"/">>,queue,<<"Advertiser-ONYX">>},
                          false,false,none,
                          [{<<"x-ha-policy">>,longstr,<<"all">>},
                           {<<"x-message-ttl">>,signedint,1200000}],
                          <3067.289.0>,
                          [<3065.334.0>],
                          all},
                         <0.267.0>,<3065.334.0>,rabbit_variable_queue,
                         {vqstate,
                          {0,{[],[]}},
                          {0,{[],[]}},
                          {delta,undefined,0,undefined},
                          {0,{[],[]}},
                          {0,{[],[]}},
                          0,
                          {0,nil},
                          undefined,
                          {0,nil},
                          {qistate,
                           "/var/lib/rabbitmq/mnesia/rabbit at rabbitmq-dev-2
/queues/1ON03RTBZAE64B67H41L4ICDE",
                           {{dict,0,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                             {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                               []}}},
                            []},
                           undefined,0,262144,
                           #Fun<rabbit_variable_queue.2.91259159>,
                           {0,nil}},
                          {undefined,
                           {client_msstate,msg_store_transient,

<<228,99,153,84,177,114,138,215,76,30,0,48,128,77,
                              68,245>>,
                            {dict,0,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                             {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                               []}}},
                            {state,368709,
                             "/var/lib/rabbitmq/mnesia/rabbit at rabbitmq-dev-2
/msg_store_transient"},
                            rabbit_msg_store_ets_index,
                            "/var/lib/rabbitmq/mnesia/rabbit at rabbitmq-dev-2
/msg_store_transient",
                            <0.239.0>,372806,364585,376903,381000}},

false,0,#Fun<rabbit_mirror_queue_slave.3.29941254>,
                          0,0,infinity,0,0,0,0,0,
                          {rates,
                           {{1335,483942,985021},0},
                           {{1335,483942,985021},0},
                           0.0,0.0,
                           {1335,484240,226498}},
                          {0,nil},
                          {0,nil},
                          {0,nil},
                          {0,nil},
                          0,0,
                          {rates,
                           {{1335,483942,985021},0},
                           {{1335,483942,985021},0},
                           0.0,0.0,
                           {1335,484240,226498}}},
                         undefined,#Ref<0.0.9.158766>,
                         {dict,0,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                         {dict,0,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                         0,
                         {dict,0,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                         {dict,0,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                         true}
** Reason for termination ==
** {badarg,[{erlang,unlink,[undefined]},
            {supervisor2,'-terminate_simple_children/3-fun-0-',4},
            {dict,fold_bucket,3},
            {dict,fold_seg,4},
            {dict,fold_segs,4},
            {supervisor2,terminate_simple_children,3},
            {supervisor2,terminate,2},
            {gen_server,terminate,6}]}

=ERROR REPORT==== 26-Apr-2012::16:51:08 ===
** Generic server <0.6730.0> terminating
** Last message in was {'EXIT',<0.249.0>,
                           {badarg,
                               [{erlang,unlink,[undefined]},
                                {supervisor2,

'-terminate_simple_children/3-fun-0-',4},
                                {dict,fold_bucket,3},
                                {dict,fold_seg,4},
                                {dict,fold_segs,4},
                                {supervisor2,terminate_simple_children,3},
                                {supervisor2,terminate,2},
                                {gen_server,terminate,6}]}}
** When Server state == {state,
                         {amqqueue,
                          {resource,<<"/">>,queue,
                           <<"Advertiser-heartbeat-DHOHMEYERGX280">>},
                          false,true,<3065.14349.1>,
                          [{<<"x-ha-policy">>,longstr,<<"all">>}],
                          <3065.14370.1>,[],all},
                         <0.6731.0>,<3065.14370.1>,rabbit_variable_queue,
                         {vqstate,
                          {0,{[],[]}},
                          {0,{[],[]}},
                          {delta,undefined,0,undefined},
                          {0,{[],[]}},
                          {0,{[],[]}},
                          0,
                          {0,nil},
                          undefined,
                          {0,nil},
                          {qistate,
                           "/var/lib/rabbitmq/mnesia/rabbit at rabbitmq-dev-2
/queues/5R0GE9UEB8S0EMSJORBUKHBTE",
                           {{dict,0,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                             {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                               []}}},
                            []},
                           undefined,0,262144,
                           #Fun<rabbit_variable_queue.2.91259159>,
                           {0,nil}},
                          {undefined,
                           {client_msstate,msg_store_transient,

<<182,86,2,135,69,87,14,108,163,188,15,159,127,119,
                              55,241>>,
                            {dict,0,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                             {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                               []}}},
                            {state,368709,
                             "/var/lib/rabbitmq/mnesia/rabbit at rabbitmq-dev-2
/msg_store_transient"},
                            rabbit_msg_store_ets_index,
                            "/var/lib/rabbitmq/mnesia/rabbit at rabbitmq-dev-2
/msg_store_transient",
                            <0.239.0>,372806,364585,376903,381000}},

false,0,#Fun<rabbit_mirror_queue_slave.3.29941254>,
                          0,0,infinity,0,0,0,0,0,
                          {rates,
                           {{1335,484239,805553},0},
                           {{1335,484239,805553},0},
                           0.0,0.0,
                           {1335,484255,991021}},
                          {0,nil},
                          {0,nil},
                          {0,nil},
                          {0,nil},
                          0,0,
                          {rates,
                           {{1335,484239,805553},0},
                           {{1335,484239,805553},0},
                           0.0,0.0,
                           {1335,484255,991021}}},
                         undefined,#Ref<0.0.9.158602>,
                         {dict,0,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                         {dict,0,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                         0,
                         {dict,0,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                         {dict,0,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                         true}
** Reason for termination ==
** {badarg,[{erlang,unlink,[undefined]},
            {supervisor2,'-terminate_simple_children/3-fun-0-',4},
            {dict,fold_bucket,3},
            {dict,fold_seg,4},
            {dict,fold_segs,4},
            {supervisor2,terminate_simple_children,3},
            {supervisor2,terminate,2},
            {gen_server,terminate,6}]}

=ERROR REPORT==== 26-Apr-2012::16:51:08 ===
** Generic server <0.252.0> terminating
** Last message in was {'EXIT',<0.249.0>,shutdown}
** When Server state == {state,
                         {amqqueue,
                          {resource,<<"ActivityLogging">>,queue,

<<"vsw.activitylogging.conversion.pendingconversion">>},
                          true,false,none,
                          [{<<"x-ha-policy">>,longstr,<<"all">>}],
                          <3067.253.0>,
                          [<3065.257.0>],
                          all},
                         <0.253.0>,<3065.257.0>,rabbit_variable_queue,
                         {vqstate,
                          {0,{[],[]}},
                          {0,{[],[]}},
                          {delta,undefined,0,undefined},
                          {0,{[],[]}},
                          {0,{[],[]}},
                          0,
                          {0,nil},
                          undefined,
                          {0,nil},
                          {qistate,
                           "/var/lib/rabbitmq/mnesia/rabbit at rabbitmq-dev-2
/queues/9KDJJKR11HTT40SVOPWG0AWDM",
                           {{dict,0,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                             {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                               []}}},
                            []},
                           undefined,0,262144,
                           #Fun<rabbit_variable_queue.2.91259159>,
                           {0,nil}},
                          {{client_msstate,msg_store_persistent,

<<58,135,182,192,228,241,29,217,255,38,4,53,94,213,
                              95,102>>,
                            {dict,0,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                             {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                               []}}},
                            {state,389194,
                             "/var/lib/rabbitmq/mnesia/rabbit at rabbitmq-dev-2
/msg_store_persistent"},
                            rabbit_msg_store_ets_index,
                            "/var/lib/rabbitmq/mnesia/rabbit at rabbitmq-dev-2
/msg_store_persistent",
                            <0.244.0>,393291,385097,397388,401485},
                           {client_msstate,msg_store_transient,

<<63,170,201,248,36,125,208,20,133,142,139,71,219,
                              91,212,33>>,
                            {dict,0,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                             {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                               []}}},
                            {state,368709,
                             "/var/lib/rabbitmq/mnesia/rabbit at rabbitmq-dev-2
/msg_store_transient"},
                            rabbit_msg_store_ets_index,
                            "/var/lib/rabbitmq/mnesia/rabbit at rabbitmq-dev-2
/msg_store_transient",
                            <0.239.0>,372806,364585,376903,381000}},

true,0,#Fun<rabbit_mirror_queue_slave.3.29941254>,0,
                          0,infinity,0,0,0,0,0,
                          {rates,
                           {{1335,483943,551021},0},
                           {{1335,483943,551021},0},
                           0.0,0.0,
                           {1335,484240,51118}},
                          {0,nil},
                          {0,nil},
                          {0,nil},
                          {0,nil},
                          0,0,
                          {rates,
                           {{1335,483943,551021},0},
                           {{1335,483943,551021},0},
                           0.0,0.0,
                           {1335,484240,51118}}},
                         undefined,#Ref<0.0.9.158618>,
                         {dict,0,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                         {dict,0,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                         0,
                         {dict,0,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                         {dict,0,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                         true}
** Reason for termination ==
** {shutdown,
       {gen_server2,call,
           [msg_store_persistent,
            {client_terminate,

<<58,135,182,192,228,241,29,217,255,38,4,53,94,213,95,102>>},
            infinity]}}
** In 'terminate' callback with reason ==
** shutdown

=INFO REPORT==== 26-Apr-2012::16:51:08 ===
    application: rabbit
    exited: stopped
    type: permanent

=INFO REPORT==== 26-Apr-2012::16:51:08 ===
    application: os_mon
    exited: stopped
    type: permanent

=INFO REPORT==== 26-Apr-2012::16:51:08 ===
    application: mnesia
    exited: stopped
    type: permanent

=INFO REPORT==== 26-Apr-2012::16:51:08 ===
Halting Erlang VM

===============================================

dev-2-sasl.log
===============================================
=CRASH REPORT==== 26-Apr-2012::16:51:08 ===
  crasher:
    initial call: supervisor2:init/1
    pid: <0.249.0>
    registered_name: rabbit_mirror_queue_slave_sup
    exception exit: {badarg,
                        [{erlang,unlink,[undefined]},

{supervisor2,'-terminate_simple_children/3-fun-0-',4},
                         {dict,fold_bucket,3},
                         {dict,fold_seg,4},
                         {dict,fold_segs,4},
                         {supervisor2,terminate_simple_children,3},
                         {supervisor2,terminate,2},
                         {gen_server,terminate,6}]}
      in function  gen_server:terminate/6
    ancestors: [rabbit_sup,<0.126.0>]
    messages: [{'DOWN',#Ref<0.0.9.159703>,process,
                          {undefined,'rabbit at rabbitmq-dev-2'},
                          noproc}]
    links: [<0.265.0>,<0.6730.0>]
    dictionary: []
    trap_exit: true
    status: running
    heap_size: 987
    stack_size: 24
    reductions: 5064
  neighbours:

=SUPERVISOR REPORT==== 26-Apr-2012::16:51:08 ===
     Supervisor: {local,rabbit_sup}
     Context:    shutdown_error
     Reason:     {badarg,
                     [{erlang,unlink,[undefined]},
                      {supervisor2,'-terminate_simple_children/3-fun-0-',4},
                      {dict,fold_bucket,3},
                      {dict,fold_seg,4},
                      {dict,fold_segs,4},
                      {supervisor2,terminate_simple_children,3},
                      {supervisor2,terminate,2},
                      {gen_server,terminate,6}]}
     Offender:   [{pid,<0.249.0>},
                  {name,rabbit_mirror_queue_slave_sup},
                  {mfargs,{rabbit_mirror_queue_slave_sup,start_link,[]}},
                  {restart_type,transient},
                  {shutdown,infinity},
                  {child_type,supervisor}]


=CRASH REPORT==== 26-Apr-2012::16:51:08 ===
  crasher:
    initial call: gen:init_it/6
    pid: <0.265.0>
    registered_name: []
    exception exit: {badarg,
                        [{erlang,unlink,[undefined]},

{supervisor2,'-terminate_simple_children/3-fun-0-',4},
                         {dict,fold_bucket,3},
                         {dict,fold_seg,4},
                         {dict,fold_segs,4},
                         {supervisor2,terminate_simple_children,3},
                         {supervisor2,terminate,2},
                         {gen_server,terminate,6}]}
      in function  gen_server2:terminate/3
    ancestors: [rabbit_mirror_queue_slave_sup,rabbit_sup,<0.126.0>]
    messages: [{'EXIT',<0.267.0>,normal},
                  {'DOWN',#Ref<0.0.3.44831>,process,<3065.334.0>,normal}]
    links: []
    dictionary: [{{xtype_to_module,direct},rabbit_exchange_type_direct},
                  {{xtype_to_module,topic},rabbit_exchange_type_topic},
                  {guid,{{3831732564,2977073879,1277034544,2152547573},0}}]
    trap_exit: true
    status: running
    heap_size: 2584
    stack_size: 24
    reductions: 4916
  neighbours:

=CRASH REPORT==== 26-Apr-2012::16:51:08 ===
  crasher:
    initial call: gen:init_it/6
    pid: <0.6730.0>
    registered_name: []
    exception exit: {badarg,
                        [{erlang,unlink,[undefined]},

{supervisor2,'-terminate_simple_children/3-fun-0-',4},
                         {dict,fold_bucket,3},
                         {dict,fold_seg,4},
                         {dict,fold_segs,4},
                         {supervisor2,terminate_simple_children,3},
                         {supervisor2,terminate,2},
                         {gen_server,terminate,6}]}
      in function  gen_server2:terminate/3
    ancestors: [rabbit_mirror_queue_slave_sup,rabbit_sup,<0.126.0>]
    messages: [{'EXIT',<0.6731.0>,normal},
                  {'DOWN',#Ref<0.0.4.191216>,process,<3065.14370.1>,normal}]
    links: []
    dictionary: [{credit_blocked,[]},
                  {{xtype_to_module,direct},rabbit_exchange_type_direct},
                  {{xtype_to_module,fanout},rabbit_exchange_type_fanout},
                  {guid,{{3059090055,1163333228,2747010975,2138519537},0}}]
    trap_exit: true
    status: running
    heap_size: 1597
    stack_size: 24
    reductions: 8290
  neighbours:
===============================================
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120426/0e88bf17/attachment.htm>

From matthias at rabbitmq.com  Fri Apr 27 06:42:01 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 27 Apr 2012 06:42:01 +0100
Subject: [rabbitmq-discuss] Active-active crash report
In-Reply-To: <CAFWGgNH5c9eJfVa3w9Sks+wtF5VoBVPWGgxA54ECcZ0y3KCn-w@mail.gmail.com>
References: <CAFWGgNFpLjY4Ufjj3OdM-AxwRp0C8Rbm=GqoGX4MeAhus3bQhw@mail.gmail.com>	<20120426223123.GA9230@wellquite.org>	<CAFWGgNFu6jnCp-qCwjg5AL=TZ0xrCkSZou472e1ZaE0=HRbPOw@mail.gmail.com>
	<CAFWGgNH5c9eJfVa3w9Sks+wtF5VoBVPWGgxA54ECcZ0y3KCn-w@mail.gmail.com>
Message-ID: <4F9A31A9.3050900@rabbitmq.com>

Vadim,

On 27/04/12 01:31, Vadim Chekan wrote:
> Ok, I got it again.

This does look like a different bug, and one that, for a change, is 
easily fixed.

It is possible that this may either be triggered by or be the trigger of 
the previous bug. Is there nothing in the logs this time about 
"Discarding message" or "gm_deaths"?

Matthias.

From steve at rabbitmq.com  Fri Apr 27 09:35:34 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Fri, 27 Apr 2012 09:35:34 +0100
Subject: [rabbitmq-discuss] Cannot send message with STOMP
In-Reply-To: <20369.27543.718619.701208@mail.cern.ch>
References: <20120416153346.b41c.abe10f7e5afbbb3a79ce619739541149@cern.ch>
	<CAM8fPiT4grNkru+aRW+gb9=RQkyA-N39G7rnTk35BiUGkJngNQ@mail.gmail.com>
	<1D9CBD89533EE94D8295DFBFD923C23F649F007B@PLOXCHG03.cern.ch>
	<CAM8fPiSG4L1QwcKQVC7rrLqSTUJ3E23BQ9UFO7=Fokwz2qfvZQ@mail.gmail.com>
	<20365.234.891858.767694@mail.cern.ch>
	<CAM8fPiQym+sNwe_vwz_v208eKApS09WvMQ4HeCvBRmXdwZMmfA@mail.gmail.com>
	<8679EBD0-F2E4-47DE-B5C2-1FDDDAB8ACAA@rabbitmq.com>
	<20369.27543.718619.701208@mail.cern.ch>
Message-ID: <978D862C-5198-4892-94EC-AD04CE5B05B9@rabbitmq.com>

Thans Lionel,
(*The very tardy reply is my fault -- sorry*)

>> the rather arbitrary notion of escaping colons in header values as well
>> as names (why?) [...]
> 
> Without backslash escaping, header names and values would have been
> limited. This quite simple escaping removed this restriction.

Here is the problem: you are forcing us to escape colons. Why? The
terminator for a header value is the newline. Yes, to allow newlines we
need an escape for newline (and therefore for backslash) but not for
colon. Never for colon.

>> and the insistence of UTF-8 for all header names and values [...]
> 
> Here again, without this in the spec, the headers would have been
> limited to basically US-ASCII.

I really don't understand this. 1.1 limits headers to UTF-8 sequences.
There is no conceivable benefit in doing this -- all binary sequences
could have been used (with escapes for a few) but you chose to restrict
it. All this does is make the properly compliant server's job harder.
And, by the way, clients too.

One day, when two clients choose to represent the same UTF-8 string
using different UTF-8 encodings (with, say, resequenced decorations or
whatever) the spec will cause problems for implementations and clients
alike.

> Some users (us included) do need more. This widely used encoding allows
> any text string in the header.

Well, my point is we had (almost) enough already and 1.1 gave us less.
How is any binary OCTET sequence worse than any UTF-8 text string?

> The BNF indeed allows more than what the protocol accepts. The best
> solution is probably to ignore the BNF and only implement what is in the
> protocol text. After all, it's probably two orders of magnitude shorter
> than AMQP 1-0 ;-)

Well, I cannot deny that :-)

If UTF-8 wasn't there it would have been easy to improve so that the
valid forms of a frame were described in BNF. The only errors not then
identifiable would have been semantic ones (like use of an unknown id).

> Maybe you also want reject empty header names (e.g. SEND\n:foo\n\n\0).
> This is arguable.

I'll see what we currently do. It might be valid. Leading spaces? A space?

Incidentally, the spec(s) allow the server to not send an ERROR frame if
it doesn't want to, but I can see that if nothing is logged at all it could be
frustrating -- we will try to improve this.

Steve Powell
steve at rabbitmq.com
[wrk: +44-2380-111-528] [mob: +44-7815-838-558]

On 20 Apr 2012, at 14:58, Lionel Cons wrote:

> Steve Powell writes:
>> The STOMP 1.0 specification is unsatisfactory in many respects, [...]
> 
> Indeed. This is what triggered the creation of 1.1.
> 
>> The STOMP 1.1 specification has drawbacks of its own -- [...]
> 
> Although I agree that 1.1 is not perfect (so I'm sure we will see 1.2
> or 2.0 one day), I do not share your view on the points you mention.
> 
>> the rather arbitrary notion of escaping colons in header values as
>> well as names (why?) [...]
> 
> Without backslash escaping, header names and values would have been
> limited. This quite simple escaping removed this restriction.
> 
>> and the insistence of UTF-8 for all header names and values [...]
> 
> Here again, without this in the spec, the headers would have been
> limited to basically US-ASCII. Some users (us included) do need
> more. This widely used encoding allows any text string in the header.
> Icing on the cake: it's backward compatible with 1.0 and transparent
> to implementations using only US-ASCII.
> 
>> So I think it is _incorrect_ in that it specifies a considerable
>> superset of what you can receive (or are allowed to send) over the wire.
> 
> The BNF indeed allows more than what the protocol accepts. The best
> solution is probably to ignore the BNF and only implement what is in
> the protocol text. After all, it's probably two orders of magnitude
> shorter than AMQP 1-0 ;-)
> 
>> I'm going to raise a bug [24896] to track this, and propose the
>> following solution:
> 
> Thanks.
> 
>> We use the negotiated connection type to determine the parsing rules
>> (and generating rules) for frame headers.
> 
> Perfect.
> 
>> For 1.0 connections we will allow OCTET streams for header names and
>> values, excepting colons in names, and excepting newlines (\u000A
>> newline character coded in UTF-8 is x'0A') anywhere, and do NO escaping
>> either on input or output. We will reject no headers on input unless
>> they do not contain a colon before the first newline (because they
>> cannot be malformed under these rules) though the remaining frame
>> parsing can fail.
> 
> Maybe you also want reject empty header names (e.g. SEND\n:foo\n\n\0).
> This is arguable.
> 
>> For 1.1 connections we will allow OCTET streams for header names and
>> values, excepting colons, newlines and backslashes, interpreting escape
>> sequences for these, and generating escapes for these characters on
>> output. We will NOT reject non-UTF-8 OCTETs but instead just pass them
>> through asis in order to allow the simplest client access. We will NOT
>> reject other escapes (\ followed by non c, n or \), but leave these
>> asis.
>> 
>> Although this is not strictly what the spec says (we would not enforce
>> UTF-8 or the errors on bad escape sequences) I believe it is a
>> reasonable compromise.
> 
> Fair enough.
> 
> IMHO, the main point is that RabbitMQ should accept any valid STOMP
> 1.1 input. Your proposed solution seems address this point.
> 
> If you also accept invalid input, this should not be a problem in
> practice.
> 
> Thanks for your work improving RabbitMQ's STOMP support.
> 
> Cheers,
> 
> Lionel


From steve at rabbitmq.com  Fri Apr 27 10:03:02 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Fri, 27 Apr 2012 10:03:02 +0100
Subject: [rabbitmq-discuss] One message instance in couple of queues
In-Reply-To: <CAFqMQdV2EJSbA6FJNc+11tFUtiL3cuQine=XgQkb7o99=ur+6A@mail.gmail.com>
References: <3fae4c5f-8721-4d63-9e9c-0f31923cf590@j3g2000vba.googlegroups.com>
	<4F919620.20305@rabbitmq.com>
	<CAFqMQdV2EJSbA6FJNc+11tFUtiL3cuQine=XgQkb7o99=ur+6A@mail.gmail.com>
Message-ID: <23F5F7C7-C3F6-42D3-9181-04EFCF71BE0A@rabbitmq.com>

Ostin,
It is not clear to me what you are 'watching' these queues for, but if
you want to retrieve the message from the queues after a certain time,
then why not investigate Dead Letter Exchanges(DLX) and queue message
expiry?

If the moderator's private queues have an expiry time (TTL) on them,
then messages that have been on the queue for that time will be deleted
-- if there is a DeadLetterExchange associated with the queues, the
deleted message will be re-published to the new exchange. You can
arrange for the DLX to route the message to a queue of your choice --
the monitor process need only listen on this queue.

Be sure to code the moderator carefully (so as not to drop a message
while moving it) using publisher confirms and acks.

See
(http://www.rabbitmq.com/extensions.html/#dead-letter-exchanges)
and 
(http://www.rabbitmq.com/extensions.html/#queue-ttl)
for more information.

Steve Powell
steve at rabbitmq.com
[wrk: +44-2380-111-528] [mob: +44-7815-838-558]

On 21 Apr 2012, at 00:46, Alexey Ostin wrote:

> Let me show one more example. 
> 
> I've got some moderation queue. Whenever a moderator locks message (or several messages) for moderation, it moves from main queue to personal moderator's queue. Just to perform some long time lock (It can be minute or hour, thus I can't use ack/nack to hold message in main queue). The goal is to monitor all moderators queues as well as main one. The problem is that I do not know all moderator's queues and I can't just monitor some fixed list because it regenerates dynamically. 
> 
> I've just thought about using separate exchange for moderator's queues. It can help with monitoring, I'd watch over whole exchange. 
> But it is still interesting whether I can publish message to several queues and consume it from them all at once. Sounds like gibberish. 
> 
> To be honest I've got one more problem to solve - it is to automatically release these locks (put a message from moderator's queue back to main) by timeout, but it should be other conversation I think :) 
> 
> Best regards, Ostin.
> 
> 20 ?????? 2012 ?. 21:00 ???????????? Simon MacMullen <simon at rabbitmq.com> ???????:
> On 20/04/12 17:27, ostin wrote:
> Example application with topic exchange:
> I push a message to server1.app1 queue and an other one to
> server1.app2 queue. I monitor server1 queue to determine count of
> processing messages on server 1. After app1 ends processing message it
> shold be deleted from both queues: from app1 to prevent duplicate
> processing, from server1 to have valid stats for monitoring. I assume
> that there can be many applications with random names, so I cant
> monitor just count of messages in app* queues.
> 
> If you want to make sure that a given message is only ever consumed from server1.app1 OR server1.app2, why not have only a single queue and have both applications consume from it?
> 
> Cheers, Simon
> 
> -- 
> Simon MacMullen
> RabbitMQ, VMware
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From alexis at rabbitmq.com  Fri Apr 27 10:44:52 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Fri, 27 Apr 2012 10:44:52 +0100
Subject: [rabbitmq-discuss] General Questions to the group
In-Reply-To: <D0E69E45B211C74F82F5EC699E0E37D0FAED327B@mail.btisystems.com>
References: <D0E69E45B211C74F82F5EC699E0E37D0FAED327B@mail.btisystems.com>
Message-ID: <CACOPnvcvt1H-2wi6xuuSFGU4ukuy67zFCwMjps+Qyg9P4yC9TA@mail.gmail.com>

Nitin

(1-3) Which broker do you mean?

(4) Yes, and this has been done.  You should be able to find it via
our clients / community page, or via Alan Antonuk who is on this list.

alexis


On Thu, Apr 26, 2012 at 6:49 PM, Nitin Shah <nshah at btisystems.com> wrote:
> Hi ,
>
>
>
> I have been looking at the RabbitMQ ?c? broker and its associated client. I
> have few basic questions that would help me understand the status of the
> broker and its c client.
>
>
>
> 1.?????? We are considering using the Broker. I would like to understand its
> performance experiences from the mailing list.
>
> 2.?????? How stable is the product.
>
> 3.?????? What version would one recommend.
>
> 4.?????? We would probably do a C++ wrapper around the c clients. Is that
> approach practical?
>
>
>
> Thanks
>
>
>
> Nitin
>
>
>
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From brett.r.cameron at gmail.com  Fri Apr 27 10:53:30 2012
From: brett.r.cameron at gmail.com (Brett Cameron)
Date: Fri, 27 Apr 2012 21:53:30 +1200
Subject: [rabbitmq-discuss] General Questions to the group
In-Reply-To: <CACOPnvcvt1H-2wi6xuuSFGU4ukuy67zFCwMjps+Qyg9P4yC9TA@mail.gmail.com>
References: <D0E69E45B211C74F82F5EC699E0E37D0FAED327B@mail.btisystems.com>
	<CACOPnvcvt1H-2wi6xuuSFGU4ukuy67zFCwMjps+Qyg9P4yC9TA@mail.gmail.com>
Message-ID: <1335520410.4888.22.camel@ubuntu.ubuntu-domain>

Nitin,

Re (4), there's https://github.com/akalend/amqpcpp and
https://github.com/alanxz/SimpleAmqpClient, for example.

Brett


On Fri, 2012-04-27 at 10:44 +0100, Alexis Richardson wrote:
> Nitin
> 
> (1-3) Which broker do you mean?
> 
> (4) Yes, and this has been done.  You should be able to find it via
> our clients / community page, or via Alan Antonuk who is on this list.
> 
> alexis
> 
> 
> On Thu, Apr 26, 2012 at 6:49 PM, Nitin Shah <nshah at btisystems.com> wrote:
> > Hi ,
> >
> >
> >
> > I have been looking at the RabbitMQ ?c? broker and its associated client. I
> > have few basic questions that would help me understand the status of the
> > broker and its c client.
> >
> >
> >
> > 1.       We are considering using the Broker. I would like to understand its
> > performance experiences from the mailing list.
> >
> > 2.       How stable is the product.
> >
> > 3.       What version would one recommend.
> >
> > 4.       We would probably do a C++ wrapper around the c clients. Is that
> > approach practical?
> >
> >
> >
> > Thanks
> >
> >
> >
> > Nitin
> >
> >
> >
> >
> >
> >
> >
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



From ooostin at gmail.com  Fri Apr 27 11:37:07 2012
From: ooostin at gmail.com (Alexey Ostin)
Date: Fri, 27 Apr 2012 14:37:07 +0400
Subject: [rabbitmq-discuss] One message instance in couple of queues
In-Reply-To: <23F5F7C7-C3F6-42D3-9181-04EFCF71BE0A@rabbitmq.com>
References: <3fae4c5f-8721-4d63-9e9c-0f31923cf590@j3g2000vba.googlegroups.com>
	<4F919620.20305@rabbitmq.com>
	<CAFqMQdV2EJSbA6FJNc+11tFUtiL3cuQine=XgQkb7o99=ur+6A@mail.gmail.com>
	<23F5F7C7-C3F6-42D3-9181-04EFCF71BE0A@rabbitmq.com>
Message-ID: <CAFqMQdU+uSX3QJR1xdKcz2zFO5Bq-QPZnqai5gxzYYG242L5HQ@mail.gmail.com>

Thanks for that brilliant idea. I didn't know aboud these extensions.

Best regards, Ostin.

27 ?????? 2012 ?. 13:03 ???????????? Steve Powell <steve at rabbitmq.com>???????:

> Ostin,
> It is not clear to me what you are 'watching' these queues for, but if
> you want to retrieve the message from the queues after a certain time,
> then why not investigate Dead Letter Exchanges(DLX) and queue message
> expiry?
>
> If the moderator's private queues have an expiry time (TTL) on them,
> then messages that have been on the queue for that time will be deleted
> -- if there is a DeadLetterExchange associated with the queues, the
> deleted message will be re-published to the new exchange. You can
> arrange for the DLX to route the message to a queue of your choice --
> the monitor process need only listen on this queue.
>
> Be sure to code the moderator carefully (so as not to drop a message
> while moving it) using publisher confirms and acks.
>
> See
> (http://www.rabbitmq.com/extensions.html/#dead-letter-exchanges)
> and
> (http://www.rabbitmq.com/extensions.html/#queue-ttl)
> for more information.
>
> Steve Powell
> steve at rabbitmq.com
> [wrk: +44-2380-111-528] [mob: +44-7815-838-558]
>
> On 21 Apr 2012, at 00:46, Alexey Ostin wrote:
>
> > Let me show one more example.
> >
> > I've got some moderation queue. Whenever a moderator locks message (or
> several messages) for moderation, it moves from main queue to personal
> moderator's queue. Just to perform some long time lock (It can be minute or
> hour, thus I can't use ack/nack to hold message in main queue). The goal is
> to monitor all moderators queues as well as main one. The problem is that I
> do not know all moderator's queues and I can't just monitor some fixed list
> because it regenerates dynamically.
> >
> > I've just thought about using separate exchange for moderator's queues.
> It can help with monitoring, I'd watch over whole exchange.
> > But it is still interesting whether I can publish message to several
> queues and consume it from them all at once. Sounds like gibberish.
> >
> > To be honest I've got one more problem to solve - it is to automatically
> release these locks (put a message from moderator's queue back to main) by
> timeout, but it should be other conversation I think :)
> >
> > Best regards, Ostin.
> >
> > 20 ?????? 2012 ?. 21:00 ???????????? Simon MacMullen <simon at rabbitmq.com>
> ???????:
> > On 20/04/12 17:27, ostin wrote:
> > Example application with topic exchange:
> > I push a message to server1.app1 queue and an other one to
> > server1.app2 queue. I monitor server1 queue to determine count of
> > processing messages on server 1. After app1 ends processing message it
> > shold be deleted from both queues: from app1 to prevent duplicate
> > processing, from server1 to have valid stats for monitoring. I assume
> > that there can be many applications with random names, so I cant
> > monitor just count of messages in app* queues.
> >
> > If you want to make sure that a given message is only ever consumed from
> server1.app1 OR server1.app2, why not have only a single queue and have
> both applications consume from it?
> >
> > Cheers, Simon
> >
> > --
> > Simon MacMullen
> > RabbitMQ, VMware
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120427/95b1aa78/attachment.htm>

From lionel.cons at cern.ch  Fri Apr 27 11:45:44 2012
From: lionel.cons at cern.ch (Lionel Cons)
Date: Fri, 27 Apr 2012 12:45:44 +0200
Subject: [rabbitmq-discuss] Cannot send message with STOMP
In-Reply-To: <978D862C-5198-4892-94EC-AD04CE5B05B9@rabbitmq.com>
References: <20120416153346.b41c.abe10f7e5afbbb3a79ce619739541149@cern.ch>
	<CAM8fPiT4grNkru+aRW+gb9=RQkyA-N39G7rnTk35BiUGkJngNQ@mail.gmail.com>
	<1D9CBD89533EE94D8295DFBFD923C23F649F007B@PLOXCHG03.cern.ch>
	<CAM8fPiSG4L1QwcKQVC7rrLqSTUJ3E23BQ9UFO7=Fokwz2qfvZQ@mail.gmail.com>
	<20365.234.891858.767694@mail.cern.ch>
	<CAM8fPiQym+sNwe_vwz_v208eKApS09WvMQ4HeCvBRmXdwZMmfA@mail.gmail.com>
	<8679EBD0-F2E4-47DE-B5C2-1FDDDAB8ACAA@rabbitmq.com>
	<20369.27543.718619.701208@mail.cern.ch>
	<978D862C-5198-4892-94EC-AD04CE5B05B9@rabbitmq.com>
Message-ID: <20378.30936.738699.589873@mail.cern.ch>

Steve Powell writes:
 > Here is the problem: you are forcing us to escape colons. Why?

Without colon escaping, the header line "a:b:c" is ambiguous and can be
parsed either as (name "a" & value "b:c") or (name "a:b" & value "c").

In STOMP 1.1, the line above is invalid and, depending on the exact header,
it should appear as "a:b\cc" or "a\cb:c".

 > I really don't understand this. 1.1 limits headers to UTF-8 sequences.
 > There is no conceivable benefit in doing this -- all binary sequences
 > could have been used (with escapes for a few) but you chose to restrict
 > it.

This came under the assumption that headers usually are a table of text
strings (as opposed to binary strings). With Unicode, most text strings of
most languages can be expressed. With UTF-8, a standard encoding is defined
and it is backward compatible with US-ASCII, that many people use.

The reason behind this being in the spec is that the broker may need to
understand (= decode) what is in the header, for instance for envelope based
routing (e.g. a topic exchange or JMS-style message selectors). If the
encoding is not defined, how do I know how to encode/decode the lowercase e
with acute accent? Should it be 0xE9 (ISO-8859-1) or 0xC3A9 (UTF-8) or
0x00E9 (UTF-16)?

UTF-8 was not the only solution but it was felt standard, widely available,
compact and, last not least, backward compatible with US-ASCII. Another
option would have been MIME-style encoding such as "=?ISO-8859-1?Q?a?="
which is more flexible (allows per header entry encoding) but quite noisy
and probably far less easy to implement than UTF-8. Maybe this will be
reconsidered in a later spec.

 > Well, my point is we had (almost) enough already and 1.1 gave us less.
 > How is any binary OCTET sequence worse than any UTF-8 text string?

Because it lacks information on how to decode/interpret it.

Cheers,

Lionel

From videlalvaro at gmail.com  Fri Apr 27 13:33:17 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 27 Apr 2012 14:33:17 +0200
Subject: [rabbitmq-discuss] Exchange related question
In-Reply-To: <1335528728.30018.YahooMailNeo@web29704.mail.ird.yahoo.com>
References: <1335470836.82792.YahooMailNeo@web29703.mail.ird.yahoo.com>
	<7576566F69124E36B3784C4A8FD77A78@gmail.com>
	<1335528728.30018.YahooMailNeo@web29704.mail.ird.yahoo.com>
Message-ID: <CAMcAHLWYrS=h2X9aKpL+Z63FQ+AQ5einWh=hkd+ZhLJPwBACuQ@mail.gmail.com>

CC'ing rabbitmq-discuss again.

Saima,

Where did you read that?

-Alvaro

On Fri, Apr 27, 2012 at 2:12 PM, Saima Asif <abdullahsaima at yahoo.com> wrote:

> Thanks, But if the name of the exchange doesnt match it means it would be
> forwarded to other exchange. isntit?
>
> Saima Asif
>    *From:* Alvaro Videla <videlalvaro at gmail.com>
> *To:* Saima Asif <abdullahsaima at yahoo.com>
> *Cc:* "rabbitmq-discuss at lists.rabbitmq.com" <
> rabbitmq-discuss at lists.rabbitmq.com>
> *Sent:* Thursday, 26 April 2012, 21:20
> *Subject:* Re: [rabbitmq-discuss] Exchange related question
>
>  Hi,
>
> You publish messages to an exchange when you do:
>
> $channel->basic_publish('exchange_name', $message, 'routing_key');
>
> So the message will go just to that exchange you specify during publish.
>
> Regards,
>
> Alvaro
>
> --
> Sent with Sparrow <http://www.sparrowmailapp.com/?sig>
>
> On Thursday, April 26, 2012 at 10:07 PM, Saima Asif wrote:
>
> Hi,
>
> I have a simple question to confirm my idea about exchanges, When a
> message arrives and there are number of exchanges, does it move to all
> exchanges ,or before sending it to exchange it is decided that this message
> would be moved to this particular exchange if yes who decides this?
>
> Thanks in advance.
>
> Saima Asif
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120427/2b17731f/attachment.htm>

From abdullahsaima at yahoo.com  Fri Apr 27 13:45:34 2012
From: abdullahsaima at yahoo.com (Saima Asif)
Date: Fri, 27 Apr 2012 13:45:34 +0100 (BST)
Subject: [rabbitmq-discuss] Exchange related question
In-Reply-To: <CAMcAHLWYrS=h2X9aKpL+Z63FQ+AQ5einWh=hkd+ZhLJPwBACuQ@mail.gmail.com>
References: <1335470836.82792.YahooMailNeo@web29703.mail.ird.yahoo.com>
	<7576566F69124E36B3784C4A8FD77A78@gmail.com>
	<1335528728.30018.YahooMailNeo@web29704.mail.ird.yahoo.com>
	<CAMcAHLWYrS=h2X9aKpL+Z63FQ+AQ5einWh=hkd+ZhLJPwBACuQ@mail.gmail.com>
Message-ID: <1335530734.73787.YahooMailNeo@web29703.mail.ird.yahoo.com>

I just want to cofirm how message is routed through netwrok of exchanges.


Saima Asif
 

________________________________
 From: Alvaro Videla <videlalvaro at gmail.com>
To: Saima Asif <abdullahsaima at yahoo.com> 
Cc: rabbitmq-discuss at lists.rabbitmq.com 
Sent: Friday, 27 April 2012, 13:33
Subject: Re: [rabbitmq-discuss] Exchange related question
  

CC'ing rabbitmq-discuss again.

Saima, 

Where did you read that? 

-Alvaro 


On Fri, Apr 27, 2012 at 2:12 PM, Saima Asif <abdullahsaima at yahoo.com> wrote:

Thanks, But if the name of the exchange doesnt match it means it would be forwarded to other exchange. isntit? 
>
>Saima Asif
> 
> From: Alvaro Videla <videlalvaro at gmail.com>
>To: Saima Asif <abdullahsaima at yahoo.com> 
>Cc: "rabbitmq-discuss at lists.rabbitmq.com" <rabbitmq-discuss at lists.rabbitmq.com> 
>Sent: Thursday, 26 April 2012, 21:20
>Subject: Re: [rabbitmq-discuss] Exchange related question
> 
>
>
>Hi, 
>
>
>You publish messages to an exchange when you do:
>
>
>$channel->basic_publish('exchange_name', $message, 'routing_key');
>
> 
>So the message will go just to that exchange you specify during publish.
>
>
>Regards,
>
>
>Alvaro 
>
>
>--?
>Sent with Sparrow
>
> 
>On Thursday, April 26, 2012 at 10:07 PM, Saima Asif wrote: 
>Hi,
>>
>>
>>I have a simple question to confirm my idea about exchanges, When a message arrives and there are number of exchanges, does it move to all exchanges ,or before sending it to exchange it is decided that this message would be moved to this particular exchange if yes who decides this? 
>>
>>
>>Thanks in advance.
>>
>>Saima Asif
>>_______________________________________________
>>rabbitmq-discuss mailing list
>>rabbitmq-discuss at lists.rabbitmq.com 
>>https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss  
>
> 
>
>  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120427/5c49b95e/attachment.htm>

From steve at rabbitmq.com  Fri Apr 27 14:12:45 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Fri, 27 Apr 2012 14:12:45 +0100
Subject: [rabbitmq-discuss] Cannot send message with STOMP
In-Reply-To: <20378.30936.738699.589873@mail.cern.ch>
References: <20120416153346.b41c.abe10f7e5afbbb3a79ce619739541149@cern.ch>
	<CAM8fPiT4grNkru+aRW+gb9=RQkyA-N39G7rnTk35BiUGkJngNQ@mail.gmail.com>
	<1D9CBD89533EE94D8295DFBFD923C23F649F007B@PLOXCHG03.cern.ch>
	<CAM8fPiSG4L1QwcKQVC7rrLqSTUJ3E23BQ9UFO7=Fokwz2qfvZQ@mail.gmail.com>
	<20365.234.891858.767694@mail.cern.ch>
	<CAM8fPiQym+sNwe_vwz_v208eKApS09WvMQ4HeCvBRmXdwZMmfA@mail.gmail.com>
	<8679EBD0-F2E4-47DE-B5C2-1FDDDAB8ACAA@rabbitmq.com>
	<20369.27543.718619.701208@mail.cern.ch>
	<978D862C-5198-4892-94EC-AD04CE5B05B9@rabbitmq.com>
	<20378.30936.738699.589873@mail.cern.ch>
Message-ID: <18F2630D-1DF4-4CFB-A260-D3C578C90C85@rabbitmq.com>

Lionel,

> Without colon escaping, the header line "a:b:c" is ambiguous and can be
> parsed either as (name "a" & value "b:c") or (name "a:b" & value "c").

No. It's not ambiguous. It is the name "a" and value "b:c". Colons only
need to be escaped in the name, NOT in the value. The FIRST colon
delimits the name. That's it.

> The reason behind this being in the spec is that the broker may need to
> understand (= decode) what is in the header, for instance for envelope
> based routing (e.g. a topic exchange or JMS-style message selectors).

If the broker (or anyone else) stipulates they need a header value, they
define how it is encoded. If a client needs to know what it "means" they
will also know how to decode it.  UTF-8 strings are fine, but why force
everyone to use them?

>> Well, my point is we had (almost) enough already and 1.1 gave us less.
>> How is any binary OCTET sequence worse than any UTF-8 text string?
> 
> Because it lacks information on how to decode/interpret it.

No it doesn't. And saying it is UTF8 doesn't tell anyone anything useful
anyway. That information is implicit -- like UTF8 is implicit. If the
broker needs to pass headers to some other process/system it must
understand what format is required AND HOW THAT IS RENDERED IN UTF8. Raw
binary would be a nightmare, as would IEEE floating point, or object
references, or anything other than a String.

I repeat: there is no conceivable advantage in this rule, and it makes
life harder for brokers and clients.

Steve Powell
steve at rabbitmq.com
[wrk: +44-2380-111-528] [mob: +44-7815-838-558]

On 27 Apr 2012, at 11:45, Lionel Cons wrote:

> Steve Powell writes:
>> Here is the problem: you are forcing us to escape colons. Why?
> 
> Without colon escaping, the header line "a:b:c" is ambiguous and can be
> parsed either as (name "a" & value "b:c") or (name "a:b" & value "c").
> 
> In STOMP 1.1, the line above is invalid and, depending on the exact header,
> it should appear as "a:b\cc" or "a\cb:c".
> 
>> I really don't understand this. 1.1 limits headers to UTF-8 sequences.
>> There is no conceivable benefit in doing this -- all binary sequences
>> could have been used (with escapes for a few) but you chose to restrict
>> it.
> 
> This came under the assumption that headers usually are a table of text
> strings (as opposed to binary strings). With Unicode, most text strings of
> most languages can be expressed. With UTF-8, a standard encoding is defined
> and it is backward compatible with US-ASCII, that many people use.
> 
> The reason behind this being in the spec is that the broker may need to
> understand (= decode) what is in the header, for instance for envelope based
> routing (e.g. a topic exchange or JMS-style message selectors). If the
> encoding is not defined, how do I know how to encode/decode the lowercase e
> with acute accent? Should it be 0xE9 (ISO-8859-1) or 0xC3A9 (UTF-8) or
> 0x00E9 (UTF-16)?
> 
> UTF-8 was not the only solution but it was felt standard, widely available,
> compact and, last not least, backward compatible with US-ASCII. Another
> option would have been MIME-style encoding such as "=?ISO-8859-1?Q?a?="
> which is more flexible (allows per header entry encoding) but quite noisy
> and probably far less easy to implement than UTF-8. Maybe this will be
> reconsidered in a later spec.
> 
>> Well, my point is we had (almost) enough already and 1.1 gave us less.
>> How is any binary OCTET sequence worse than any UTF-8 text string?
> 
> Because it lacks information on how to decode/interpret it.
> 
> Cheers,
> 
> Lionel


From lionel.cons at cern.ch  Fri Apr 27 14:45:04 2012
From: lionel.cons at cern.ch (Lionel Cons)
Date: Fri, 27 Apr 2012 15:45:04 +0200
Subject: [rabbitmq-discuss] Cannot send message with STOMP
In-Reply-To: <18F2630D-1DF4-4CFB-A260-D3C578C90C85@rabbitmq.com>
References: <20120416153346.b41c.abe10f7e5afbbb3a79ce619739541149@cern.ch>
	<CAM8fPiT4grNkru+aRW+gb9=RQkyA-N39G7rnTk35BiUGkJngNQ@mail.gmail.com>
	<1D9CBD89533EE94D8295DFBFD923C23F649F007B@PLOXCHG03.cern.ch>
	<CAM8fPiSG4L1QwcKQVC7rrLqSTUJ3E23BQ9UFO7=Fokwz2qfvZQ@mail.gmail.com>
	<20365.234.891858.767694@mail.cern.ch>
	<CAM8fPiQym+sNwe_vwz_v208eKApS09WvMQ4HeCvBRmXdwZMmfA@mail.gmail.com>
	<8679EBD0-F2E4-47DE-B5C2-1FDDDAB8ACAA@rabbitmq.com>
	<20369.27543.718619.701208@mail.cern.ch>
	<978D862C-5198-4892-94EC-AD04CE5B05B9@rabbitmq.com>
	<20378.30936.738699.589873@mail.cern.ch>
	<18F2630D-1DF4-4CFB-A260-D3C578C90C85@rabbitmq.com>
Message-ID: <20378.41696.442773.270340@mail.cern.ch>

Steve Powell writes:
 > Colons only need to be escaped in the name, NOT in the value. The
 > FIRST colon delimits the name. That's it.


From dawgtool at aol.com  Fri Apr 27 15:42:51 2012
From: dawgtool at aol.com (DawgTool)
Date: Fri, 27 Apr 2012 10:42:51 -0400
Subject: [rabbitmq-discuss] Per-Connection Flow Control - RMQ 2.8.1
In-Reply-To: <4F98280D.4040703@rabbitmq.com>
References: <4F6CD702.4050908@aol.com>	<4F704404.8080504@rabbitmq.com>	<4F728392.5070602@aol.com>	<4F72E8A4.1010609@rabbitmq.com>
	<4F730718.6080908@rabbitmq.com>	<4F86EC12.7030602@aol.com>
	<4F8BFAB7.1070706@rabbitmq.com> <4F955F33.9020003@aol.com>
	<4F97DC16.2010107@rabbitmq.com> <4F980D35.3040003@aol.com>
	<4F981D3F.6050706@rabbitmq.com> <4F9822F4.2060507@aol.com>
	<4F98280D.4040703@rabbitmq.com>
Message-ID: <4F9AB06B.2010505@aol.com>

Hi Marrhais,

On 4/25/12 12:36 PM, Matthias Radestock wrote:
> On 25/04/12 17:14, DawgTool wrote:
>> Comparing 2.7.1 to 2.8.1 has become less a priority as getting 2.8.1 to
>> behave the same as our current 2.7.1 system.
>> (and I say behave meaning throughput count more then anything else)
>
> *Sustained* throughput on 2.8.1 should not be significantly lower than 
> 2.7.1. Do you have evidence to the contrary? That is certainly 
> something we'd want to investigate.
>
> 2.7.1 can absorb longer spikes than 2.8.1; you can compensate for that 
> somewhat by increasing the tcp buffer sizes.
>
Agreed that 2.7.1 absorbs the spikes, which I think a message broker 
should be able to do. Accept the message, route when message is ready or 
queue is available.  Removing the flow control from 2.8.1 (or setting to 
some obscene amount) has similar results as 2.7.1, but having tested 
with the same configuration as production.
>> the reason I was raising the credits was to give my publishers
>> more time to publish before they got locked out. At the default level
>> {200,50}, my publishing minimum rate of 4k/sec (normal rate is 90k/s)
>> blocked almost instantly.
>
> What's the average message size? And how many queues does a single 
> message get routed to on average?
>
message: ~500 bytes (payload) + ~50 bytes 
(header:routekey,messageid,timestamp)

> 90k/s is unlikely to be a sustainable rate even with tiny messages. 
> 4k/sec really shouldn't be a problem, unless the messages are huge.
The current 2.7.1 uses several machines to consume from the publishers 
(pub) which feed to other machines holding the queues (que), consumers 
connect to another set of machines to consume (csm), this seems to work 
enough to keep the current rate of 90K/sec, but wouldn't take much to 
tip-over. All the machines are in the same named cluster, queues are 
hard coded to machines along with a single HA for each queue. This is 
not ideal, which is why we are looking for alternatives.
>
>> The flat queue concerns me more then the queue vs total, I expected that
>> there would be records piled up in the broker/exchange.
>
> One of the objectives of the credit based flow control is to prevent 
> messages from piling up anywhere other than the queue or tcp buffers.
>
>> You can easily get this to behave poorly by pushing volume (3-4k/s) to a
>> topic exchange with a short TTL on the queues (90000ms)
>
> Ah. TTLs. Handling those can be quite costly in some circumstances, 
> and indeed block the queue for a while. This shouldn't have changed 
> between 2.7.1 and 2.8.1 though.
We had enough room on the 2.7.1 cluster that I don't think we have ever 
hit a TTL, but that doesn't leave us room for a large failure in 
consumer processing, ie: loosing a whole rack of servers.

>
>
> Regards,
>
> Matthias.

Thanks


From gautam.bakshi at gmail.com  Fri Apr 27 15:45:29 2012
From: gautam.bakshi at gmail.com (Gautam)
Date: Fri, 27 Apr 2012 07:45:29 -0700 (PDT)
Subject: [rabbitmq-discuss] Design pattern for queue with alot of small data?
Message-ID: <20084645.3670.1335537929981.JavaMail.geo-discussion-forums@vbq5>

Hi Everyone,

I am using rabbitmq as my queue server but my workers are having a slight 
problem.  I create a connection then send it to multiple threads who in 
turn create their own channels and then have each thread does its own work 
on the thread. Its basically a threaded version 
of: http://www.rabbitmq.com/tutorials/tutorial-two-java.html

But when I profile my code over half the time is spent 
in com.rabbitmq.client.impl.SocketFrameHandler.readFrame() I think it makes 
sense(if thats the part that reads the queue) as my work for each worker is 
not that much per item(there's just alot of items). 

Is there something I can do to make this part faster?  Right now, I set the 
awk to 200  and thread the awk part of the code.  Is there something that 
would allow me to download data in bulk? or anything else that could make 
it go faster(it seems like my program can finish the work quicker than the 
application can send it one a time)? 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120427/dd6a3dbc/attachment.htm>

From ivan.dyachkoff at gmail.com  Fri Apr 27 15:55:34 2012
From: ivan.dyachkoff at gmail.com (Ivan Dyachkov)
Date: Fri, 27 Apr 2012 16:55:34 +0200
Subject: [rabbitmq-discuss] amqp_client upgrade bug
Message-ID: <9322B1C6-BABD-4BC5-8B2B-CAAEA44D3B2A@gmail.com>

Hi guys,

this is really weird:

src/amqp_channel.erl:
   469 code_change(_OldVsn, State, _Extra) ->
   470     State.

when it must return {ok, State}. So when we try to upgrade node running amqp_client, upgrade fails.
Other modules implementing gen_server[2] behavior have the same issue.

/Ivan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120427/bc04180d/attachment.htm>

From videlalvaro at gmail.com  Fri Apr 27 16:18:04 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 27 Apr 2012 17:18:04 +0200
Subject: [rabbitmq-discuss] RFC - new exchange type idea
In-Reply-To: <CACOPnveOFxDC2OhQug5jGjFMeoKUgrUdNgGUy4zSJVdK-BVvLQ@mail.gmail.com>
References: <CAMcAHLU241feUdYNsZg0stpQmJk+22qTU+ipu5m9cJMJ6ewGfw@mail.gmail.com>
	<708689AA-8883-4017-BE81-5A6905CFF602@gmail.com>
	<CACOPnveOFxDC2OhQug5jGjFMeoKUgrUdNgGUy4zSJVdK-BVvLQ@mail.gmail.com>
Message-ID: <5FD73FB4097D46A282084C268D19EF03@gmail.com>

As a follow up just see today's hacker news top article: http://news.ycombinator.com/item?id=3899080  

Yes, that the article is top on HN might not mean much? but at least the idea suggested there is popular, ie: people might want that.

-Alvaro  

--  
Sent with Sparrow (http://www.sparrowmailapp.com/?sig)


On Wednesday, April 18, 2012 at 1:42 PM, Alexis Richardson wrote:

> I'm in favour of anything that makes it easier to get started.
>  
> I am continually surprised to hear things like "rabbit has queues but
> not pubsub" as well as "rabbit is good for pubsub but not queues".
> Not to forget "rabbit does not do persistence" as well as "rabbit is
> best for persistence" and of course "rabbit uses mnesia for message
> persistence" when it doesn't. In addition all kinds of FUD gets slung
> about.
>  
> The Redis community has been great at innovating from the bottom
> upwards, to deliver simplicity. This is immediately visible when you
> look at the slew of MQ-alike layers that people have created. These
> tend to focus on the core functions of pubsub, queue, and sometimes
> 1-1 and/or RPC; while ignoring eg flow control, paging, and other
> features. Some layer a work queue system on top of Redis, like
> Celery. Resque is a good example of that.
>  
> Here are more examples:
>  
> http://thechangelog.com/post/6791886560/thoonk-py-persistent-and-fast-push-feeds-queues-and-jobs
> ("a project that takes a unified approach to feeds, jobs, and queues,
> all with a Redis backend." and looks a lot like rabbit)
>  
> https://github.com/djhworld/redis-mq ("I felt tools like the
> excellent RabbitMQ were too complex for small projects like the ones I
> tend to make.")
>  
> https://github.com/ServiceStack/ServiceStack/wiki/Messaging-and-redis
> (WCF for hipsters)
>  
> http://restmq.com/ ("There are HTTP clients for pratically all
> languages. That's all that it takes to use RestMQ within your
> application. No special protocols or strategies, just dynamically
> created queues.")
>  
> http://lumberjaph.net/perl/2010/04/14/presque-a-redis-tatsumaki-based-message-queue.html
> ("a small message queue service build on top of redis and Tatsumaki.
> It?s heavily inspired by RestMQ and resque.")
>  
> http://flask.pocoo.org/snippets/73/ ("if you just want a very basic
> queue functionality to get started")
>  
> https://github.com/josiahcarlson/rpqueue (priority queue)
>  
> All of these projects are motivated by ease of use and a simple API.
> Let's make Rabbit easier to use.
>  
> alexis
>  
>  
>  
>  
> On Wed, Apr 11, 2012 at 5:36 PM, Jason J. W. Williams
> <jasonjwwilliams at gmail.com (mailto:jasonjwwilliams at gmail.com)> wrote:
> > I think this is a great idea. It makes it easier to on onboard those who initially need a simple message queue and end up using Redis. Whatever message queue tech people start with for their first quick and dirty needs they tend to stick with. So I think this is a great idea for getting folks converted to Rabbit early.
> >  
> > Yes functionally anonymous queues function the same way, but conceptually they break the idea exchanges are where you publish messages since you supply the "empty" exchange.
> >  
> > Whether its a new exchange type or a change to the library API for anonymous queues, I like the direction Alvaro's going for folks getting their feet wet.
> >  
> > -J
> >  
> > Sent via iPhone
> >  
> > Is your email Premiere?
> >  
> > On Apr 11, 2012, at 7:13, Alvaro Videla <videlalvaro at gmail.com (mailto:videlalvaro at gmail.com)> wrote:
> >  
> > > Hi,
> > >  
> > > I've been thinking on creating a new exchange type whose goal will be to simplify the ways messages are routed to queues.
> > >  
> > > So now for example to publish a message to a queue I need to do something like:
> > >  
> > > $ch->exchange_declare('foobar', 'direct');
> > > $ch->queue_declare('foobar');
> > > $ch->queue_bind('foobar', 'foobar');
> > > $ch->basic_publish($msg, 'foobar');
> > >  
> > > I want to be able to do this:
> > >  
> > > $ch->exchange_declare('foobar', 'new-exchange-type');
> > > $ch->basic_publish($msg, 'foobar');
> > >  
> > > So that means that by declaring a "foobar" exchange with the new type I will bind a new queue to that exchange during exchange creation on the broker side.
> > >  
> > > The queue will have similar durability properties as the exchange.
> > >  
> > > The exchange won't accept binding requests, so 1 exchange of that type will only have 1 queue bound to it.
> > >  
> > > The idea is also to not perform any query while searching for a queue where to route messages, so routing speed *should* be a bit faster than a normal direct exchange.
> > >  
> > > The exchange should act basically as a direct exchange.
> > >  
> > > Then as a user of RabbitMQ that just want to have a queue server for delayed jobs this is the most basic setup I think you can have.
> > >  
> > > BTW, I know you can publish messages to the anon exchange by using the queue name as routing key, but this requires that particular knowledge of AMQP.
> > >  
> > > What do you guys think?
> > >  
> > > -Alvaro
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> > > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > >  
> >  
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >  
>  
>  
>  


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120427/665f4404/attachment.htm>

From tonygarnockjones+rabbitmq at gmail.com  Fri Apr 27 16:30:38 2012
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Fri, 27 Apr 2012 11:30:38 -0400
Subject: [rabbitmq-discuss] amqp_client upgrade bug
In-Reply-To: <9322B1C6-BABD-4BC5-8B2B-CAAEA44D3B2A@gmail.com>
References: <9322B1C6-BABD-4BC5-8B2B-CAAEA44D3B2A@gmail.com>
Message-ID: <CAM8fPiScnV6eYmT4-sNwuUp=E-PpqbUj0NgxrMiaU8smRO73Bw@mail.gmail.com>

Wow, thank you for noticing that. I see that the bug you report is
extremely widespread. I wonder where it came from? I've updated all the
libraries I maintain that suffer from this problem.

Thanks again!

Regards,
  Tony

On 27 April 2012 10:55, Ivan Dyachkov <ivan.dyachkoff at gmail.com> wrote:

> Hi guys,
>
> this is really weird:
>
> src/amqp_channel.erl:
>
>    469 <http://hg.rabbitmq.com/rabbitmq-erlang-client/file/db6f2fb3b0ec/src/amqp_channel.erl#l469> code_change(_OldVsn, State, _Extra) ->
>
>    470 <http://hg.rabbitmq.com/rabbitmq-erlang-client/file/db6f2fb3b0ec/src/amqp_channel.erl#l470>     State.
>
>
> when it must return {ok, State}. So when we try to upgrade node running
> amqp_client, upgrade fails.
> Other modules implementing gen_server[2] behavior have the same issue.
>
> /Ivan
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
Tony Garnock-Jones
tonygarnockjones at gmail.com
http://homepages.kcbbs.gen.nz/tonyg/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120427/5181075b/attachment.htm>

From jon at jbrisbin.com  Fri Apr 27 17:11:55 2012
From: jon at jbrisbin.com (Jon Brisbin)
Date: Fri, 27 Apr 2012 11:11:55 -0500
Subject: [rabbitmq-discuss] amqp_client upgrade bug
In-Reply-To: <CAM8fPiScnV6eYmT4-sNwuUp=E-PpqbUj0NgxrMiaU8smRO73Bw@mail.gmail.com>
References: <9322B1C6-BABD-4BC5-8B2B-CAAEA44D3B2A@gmail.com>
	<CAM8fPiScnV6eYmT4-sNwuUp=E-PpqbUj0NgxrMiaU8smRO73Bw@mail.gmail.com>
Message-ID: <FF789C9A-5456-430D-A6B7-13C768916D4C@jbrisbin.com>

Looks like the rebar fork needs updating too. I'll do that ASAP.

FWIW- the terminate function is right above that in the code and it does not require {ok, State}, just State. Maybe a cut-and-paste error?

Anyhoo...will make the change shortly.

Sent from my iPad

On Apr 27, 2012, at 10:30 AM, Tony Garnock-Jones <tonygarnockjones+rabbitmq at gmail.com> wrote:

> Wow, thank you for noticing that. I see that the bug you report is extremely widespread. I wonder where it came from? I've updated all the libraries I maintain that suffer from this problem.
> 
> Thanks again!
> 
> Regards,
>   Tony
> 
> On 27 April 2012 10:55, Ivan Dyachkov <ivan.dyachkoff at gmail.com> wrote:
> Hi guys,
> 
> this is really weird:
> 
> src/amqp_channel.erl:
>    469 code_change(_OldVsn, State, _Extra) ->
>    470     State.
> 
> when it must return {ok, State}. So when we try to upgrade node running amqp_client, upgrade fails.
> Other modules implementing gen_server[2] behavior have the same issue.
> 
> /Ivan
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> 
> 
> -- 
> Tony Garnock-Jones
> tonygarnockjones at gmail.com
> http://homepages.kcbbs.gen.nz/tonyg/
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120427/9153b811/attachment.htm>

From christopher.loggins at gmail.com  Fri Apr 27 17:44:48 2012
From: christopher.loggins at gmail.com (caloggins)
Date: Fri, 27 Apr 2012 09:44:48 -0700 (PDT)
Subject: [rabbitmq-discuss] Can't get cluster to work on 2 Windows Machines
Message-ID: <b736e7af-0ddb-4ff6-b4a1-fc0521214f28@f27g2000yqc.googlegroups.com>

I'm attempting to get a cluster working between a 2008 R2 (rabbit1)
and Windows 7 (rabbit2). I've copied the .erlang.cookie files to all
the directories, opened ports on the firewalls, etc. I can do a status
locally, but not remotely. As illustrated below, rabbitmqctl status
shows the two nodes are not talking. What can/should I next check?

rabbit1 status:
--------------------
c:\Program Files (x86)\RabbitMQ Server
\rabbitmq_server-2.8.1\sbin>rabbitmqctl status
Status of node rabbit at rabbit1 ...
[{pid,6700},
 {running_applications,
     [{rabbitmq_management,"RabbitMQ Management Console","2.8.1"},
      {rabbitmq_management_agent,"RabbitMQ Management Agent","2.8.1"},
      {amqp_client,"RabbitMQ AMQP Client","2.8.1"},
      {rabbit,"RabbitMQ","2.8.1"},
      {os_mon,"CPO  CXC 138 46","2.2.9"},
      {sasl,"SASL  CXC 138 11","2.2.1"},
      {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.8.1"},
      {webmachine,"webmachine","1.7.0-rmq2.8.1-hg"},
      {mochiweb,"MochiMedia Web Server","1.3-rmq2.8.1-git"},
      {inets,"INETS  CXC 138 49","5.9"},
      {mnesia,"MNESIA  CXC 138 12","4.7"},
      {stdlib,"ERTS  CXC 138 10","1.18.1"},
      {kernel,"ERTS  CXC 138 10","2.15.1"}]},
 {os,{win32,nt}},
 {erlang_version,
     "Erlang R15B01 (erts-5.9.1) [64-bit] [smp:2:2] [async-threads:
30]\n"},
 {memory,
     [{total,33205360},
      {processes,12402021},
      {processes_used,12401872},
      {system,20803339},
      {atom,561761},
      {atom_used,544299},
      {binary,88496},
      {code,15357746},
      {ets,1272920}]},
 {vm_memory_high_watermark,0.39999999981371526},
 {vm_memory_limit,1717800140},
 {file_descriptors,
     [{total_limit,924},{total_used,4},{sockets_limit,829},
{sockets_used,2}]},
 {processes,[{limit,1048576},{used,176}]},
 {run_queue,0},
 {uptime,1368}]
...done.

c:\Program Files (x86)\RabbitMQ Server
\rabbitmq_server-2.8.1\sbin>rabbitmqctl -n rabbit at rabbit2 status
Status of node 'rabbit at rabbit2' ...
Error: unable to connect to node 'rabbit at rabbit2': nodedown

DIAGNOSTICS
===========

nodes in question: ['rabbit at rabbit2']

hosts, their running nodes and ports:
- rabbit2: [{rabbit,45001}]

current node details:
- node name: rabbitmqctl6126 at rabbit1
- home dir: W:\
- cookie hash: 6jCR7HdybYQeos3l+beiNQ==

rabbit2 status:
--------------------
c:\Program Files (x86)\RabbitMQ Server
\rabbitmq_server-2.8.1\sbin>rabbitmqctl status
Status of node 'rabbit at rabbit2' ...
[{pid,10024},
 {running_applications,
     [{rabbitmq_management,"RabbitMQ Management Console","2.8.1"},
      {rabbitmq_management_agent,"RabbitMQ Management Agent","2.8.1"},
      {amqp_client,"RabbitMQ AMQP Client","2.8.1"},
      {rabbit,"RabbitMQ","2.8.1"},
      {os_mon,"CPO  CXC 138 46","2.2.9"},
      {sasl,"SASL  CXC 138 11","2.2.1"},
      {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.8.1"},
      {webmachine,"webmachine","1.7.0-rmq2.8.1-hg"},
      {mochiweb,"MochiMedia Web Server","1.3-rmq2.8.1-git"},
      {inets,"INETS  CXC 138 49","5.9"},
      {mnesia,"MNESIA  CXC 138 12","4.7"},
      {stdlib,"ERTS  CXC 138 10","1.18.1"},
      {kernel,"ERTS  CXC 138 10","2.15.1"}]},
 {os,{win32,nt}},
 {erlang_version,
     "Erlang R15B01 (erts-5.9.1) [64-bit] [smp:8:8] [async-threads:
30]\n"},
 {memory,
     [{total,34142224},
      {processes,12659829},
      {processes_used,12650632},
      {system,21482395},
      {atom,561761},
      {atom_used,544353},
      {binary,118144},
      {code,15357746},
      {ets,1280456}]},
 {vm_memory_high_watermark,0.4},
 {vm_memory_limit,3416358912},
 {file_descriptors,
     [{total_limit,924},{total_used,4},{sockets_limit,829},
{sockets_used,2}]},
 {processes,[{limit,1048576},{used,182}]},
 {run_queue,0},
 {uptime,1657}]
...done.


c:\Program Files (x86)\RabbitMQ Server
\rabbitmq_server-2.8.1\sbin>rabbitmqctl -n rabbit at rabbit1 status
Status of node rabbit at rabbit1 ...
Error: unable to connect to node rabbit at rabbit1: nodedown

DIAGNOSTICS
===========

nodes in question: [rabbit at rabbit1]

hosts, their running nodes and ports:
- rabbit1: [{rabbit,45001}]

current node details:
- node name: 'rabbitmqctl17565 at rabbit2'
- home dir: W:\
- cookie hash: 6jCR7HdybYQeos3l+beiNQ==

rabbit1 debug:
---------------------
** Found 0 name clashes in code paths

+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
|   v2.8.1  +---+   |
|                   |
+-------------------+
AMQP 0-9-1 / 0-9 / 0-8
Copyright (C) 2007-2012 VMware, Inc.
Licensed under the MPL.  See http://www.rabbitmq.com/

node           : rabbit at rabbit1
app descriptor : c:/Program Files (x86)/RabbitMQ Server/
rabbitmq_server-2.8.1/sbin/../ebin/rabbit.app
home dir       : C:\Windows
config file(s) : c:/Users/christopher.loggins/AppData/Roaming/RabbitMQ/
rabbitmq.config
cookie hash    : 6jCR7HdybYQeos3l+beiNQ==
log            : C:/Users/christopher.loggins/AppData/Roaming/RabbitMQ/
log/rabbit at rabbit1.log
sasl log       : C:/Users/christopher.loggins/AppData/Roaming/RabbitMQ/
log/rabbit at rabbit1-sasl.log
database dir   : c:/Users/christopher.loggins/AppData/Roaming/RabbitMQ/
db/rabbit at rabbit1-mnesia
erlang version : 5.9.1

-- rabbit boot start
starting file handle cache
server                                     ...done
starting worker
pool                                                  ...done
starting
database                                                     ...done
starting database
sync                                                ...done
starting codec correctness
check                                      ...done
-- external infrastructure ready
starting plugin
registry                                              ...done
starting auth mechanism cr-
demo                                       ...done
starting auth mechanism
amqplain                                      ...done
starting auth mechanism
plain                                         ...done
starting statistics event
manager                                     ...done
starting logging
server                                               ...done
starting exchange type
direct                                         ...done
starting exchange type
fanout                                         ...done
starting exchange type
headers                                        ...done
starting exchange type
topic                                          ...done
-- kernel ready
starting alarm
handler                                                ...done
starting node
monitor                                                 ...done
starting cluster
delegate                                             ...done
starting guid
generator                                               ...done
starting memory
monitor                                               ...done
-- core initialized
starting management
agent                                             ...done
starting exchange, queue and binding
recovery                         ...done
starting configured
definitions                                       ...done
starting empty DB
check                                               ...done
starting mirror queue slave
sup                                       ...done
starting adding mirrors to
queues                                     ...done
-- message delivery logic ready
starting error log
relay                                              ...done
starting
networking                                                   ...done
starting direct
client                                                ...done
starting notify cluster
nodes                                         ...done

broker running
Eshell V5.9.1  (abort with ^G)
(rabbit at rabbit1)1>

rabbit2 debug:
--------------------
** Found 0 name clashes in code paths

+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
|   v2.8.1  +---+   |
|                   |
+-------------------+
AMQP 0-9-1 / 0-9 / 0-8
Copyright (C) 2007-2012 VMware, Inc.
Licensed under the MPL.  See http://www.rabbitmq.com/

node           : rabbit at rabbit2
app descriptor : c:/Program Files (x86)/RabbitMQ Server/
rabbitmq_server-2.8.1/sbin/../ebin/rabbit.app
home dir       : C:\Windows
config file(s) : c:/Users/christopher.loggins/AppData/Roaming/RabbitMQ/
rabbitmq.config
cookie hash    : 6jCR7HdybYQeos3l+beiNQ==
log            : C:/Users/christopher.loggins/AppData/Roaming/RabbitMQ/
log/rabbit at rabbit2.log
sasl log       : C:/Users/christopher.loggins/AppData/Roaming/RabbitMQ/
log/rabbit at rabbit2-sasl.log
database dir   : c:/Users/christopher.loggins/AppData/Roaming/RabbitMQ/
db/rabbit at rabbit2-mnesia
erlang version : 5.9.1

-- rabbit boot start
starting file handle cache
server                                     ...done
starting worker
pool                                                  ...done
starting
database                                                     ...done
starting database
sync                                                ...done
starting codec correctness
check                                      ...done
-- external infrastructure ready
starting plugin
registry                                              ...done
starting auth mechanism cr-
demo                                       ...done
starting auth mechanism
amqplain                                      ...done
starting auth mechanism
plain                                         ...done
starting statistics event
manager                                     ...done
starting logging
server                                               ...done
starting exchange type
direct                                         ...done
starting exchange type
fanout                                         ...done
starting exchange type
headers                                        ...done
starting exchange type
topic                                          ...done
-- kernel ready
starting alarm
handler                                                ...done
starting node
monitor                                                 ...done
starting cluster
delegate                                             ...done
starting guid
generator                                               ...done
starting memory
monitor                                               ...done
-- core initialized
starting management
agent                                             ...done
starting exchange, queue and binding
recovery                         ...done
starting configured
definitions                                       ...done
starting empty DB
check                                               ...done
starting mirror queue slave
sup                                       ...done
starting adding mirrors to
queues                                     ...done
-- message delivery logic ready
starting error log
relay                                              ...done
starting
networking                                                   ...done
starting direct
client                                                ...done
starting notify cluster
nodes                                         ...done

broker running
Eshell V5.9.1  (abort with ^G)
(rabbit at rabbit2)1>
win32sysinfo:Erlang has closed.ok
(rabbit at rabbit2)2>

config on both nodes:
------------------------------
[
	{kernel,[{inet_dist_listen_min,45001},{inet_dist_listen_max,45001}]}
].

From matthias at rabbitmq.com  Fri Apr 27 18:58:44 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 27 Apr 2012 18:58:44 +0100
Subject: [rabbitmq-discuss] Per-Connection Flow Control - RMQ 2.8.1
In-Reply-To: <4F9AB06B.2010505@aol.com>
References: <4F6CD702.4050908@aol.com>	<4F704404.8080504@rabbitmq.com>	<4F728392.5070602@aol.com>	<4F72E8A4.1010609@rabbitmq.com>
	<4F730718.6080908@rabbitmq.com>	<4F86EC12.7030602@aol.com>
	<4F8BFAB7.1070706@rabbitmq.com> <4F955F33.9020003@aol.com>
	<4F97DC16.2010107@rabbitmq.com> <4F980D35.3040003@aol.com>
	<4F981D3F.6050706@rabbitmq.com> <4F9822F4.2060507@aol.com>
	<4F98280D.4040703@rabbitmq.com> <4F9AB06B.2010505@aol.com>
Message-ID: <4F9ADE54.108@rabbitmq.com>

On 27/04/12 15:42, DawgTool wrote:
> On 4/25/12 12:36 PM, Matthias Radestock wrote:
>> 2.7.1 can absorb longer spikes than 2.8.1; you can compensate for that
>> somewhat by increasing the tcp buffer sizes.
>>
> Agreed that 2.7.1 absorbs the spikes, which I think a message broker
> should be able to do.

Both 2.7.1 and 2.8.1 can absorb spikes. 2.7.1 can absorb longer ones by 
default but at a price (see below).

> Accept the message, route when message is ready or queue is available.

The downside of this approach is that the broker builds up an enormous 
backlog of work. Eventually it is going to have to catch up. And when it 
does then message acceptance rate slows to a crawl, or indeed stops 
completely for sustained periods of time. That is undesirable in most 
use cases.

Furthermore, the per-message cost of processing messages that way is 
higher since the system is more highly stressed - memory allocation, 
garbage collection, scheduling all become more expensive. And Rabbit's 
page-to-disk logic is working sub-optimally since it operates only on 
messages residing in queues. All this combined results in the number of 
messages that the broker can process over a longer period of time to be 
noticeably lower than with the new credit flow control.

Having said that, the ultimate "accept messages as quickly as you can; 
think about them later" behaviour is achieved by increasing the tcp 
buffer sizes, as I noted in my previous reply. So if that's the 
behaviour you are after, then I'd suggest you focus your tuning efforts 
there.

Matthias.

From alan.antonuk at gmail.com  Fri Apr 27 19:49:32 2012
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Fri, 27 Apr 2012 14:49:32 -0400
Subject: [rabbitmq-discuss] General Questions to the group
In-Reply-To: <1335520410.4888.22.camel@ubuntu.ubuntu-domain>
References: <D0E69E45B211C74F82F5EC699E0E37D0FAED327B@mail.btisystems.com>
	<CACOPnvcvt1H-2wi6xuuSFGU4ukuy67zFCwMjps+Qyg9P4yC9TA@mail.gmail.com>
	<1335520410.4888.22.camel@ubuntu.ubuntu-domain>
Message-ID: <CAAt2poJ_SdYAHmMZqx5ufpTeQhz_tVY9uHfuFtqFxtdG=-2WFw@mail.gmail.com>

Correct me if I'm wrong Nitin:

Here's a clarification of what I think he's trying to ask, a quote from an
earlier email conversation I had with Nitin, to which I redirected him to
ask this question on the rabbit-discuss list as I think there are people on
this list better able to answer these questions:

-Alan

On Thu, Apr 26, 2012 at 11:51 AM, Nitin Shah <nshah at btisystems.com> wrote:

> Alan,****
>
> ** **
>
> You are the expert as I see it,  on RabbitMQ, so may I ask you questions?*
> ***
>
> How stable is the RabbitMq release broker, and does it support AMQP
> standard fully?****
>
> Is the broker written in ?C? and in terms of performance, what is your
> opinion?****
>
> ** **
>
> I notice that we also have an implementation from Apache Qpid, which I
> want to look at to get an idea of the differences.****
>
> ** **
>
> Any feedback is appreciated.****
>
> ** **
>
> Thanks****
>
> Nitin
>

On Fri, Apr 27, 2012 at 5:53 AM, Brett Cameron <brett.r.cameron at gmail.com>wrote:

> Nitin,
>
> Re (4), there's https://github.com/akalend/amqpcpp and
> https://github.com/alanxz/SimpleAmqpClient, for example.
>
> Brett
>
>
> On Fri, 2012-04-27 at 10:44 +0100, Alexis Richardson wrote:
> > Nitin
> >
> > (1-3) Which broker do you mean?
> >
> > (4) Yes, and this has been done.  You should be able to find it via
> > our clients / community page, or via Alan Antonuk who is on this list.
> >
> > alexis
> >
> >
> > On Thu, Apr 26, 2012 at 6:49 PM, Nitin Shah <nshah at btisystems.com>
> wrote:
> > > Hi ,
> > >
> > >
> > >
> > > I have been looking at the RabbitMQ ?c? broker and its associated
> client. I
> > > have few basic questions that would help me understand the status of
> the
> > > broker and its c client.
> > >
> > >
> > >
> > > 1.       We are considering using the Broker. I would like to
> understand its
> > > performance experiences from the mailing list.
> > >
> > > 2.       How stable is the product.
> > >
> > > 3.       What version would one recommend.
> > >
> > > 4.       We would probably do a C++ wrapper around the c clients. Is
> that
> > > approach practical?
> > >
> > >
> > >
> > > Thanks
> > >
> > >
> > >
> > > Nitin
> > >
> > >
> > >
> > >
> > >
> > >
> > >
> > >
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-discuss at lists.rabbitmq.com
> > > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120427/1a7fc889/attachment.htm>

From pablomolnar at gmail.com  Fri Apr 27 20:39:41 2012
From: pablomolnar at gmail.com (Pablo Molnar)
Date: Fri, 27 Apr 2012 16:39:41 -0300
Subject: [rabbitmq-discuss] RabbitMQ plugin mangament binding problem
Message-ID: <CANVSfpL69OvBSqr79r5XbJqS=UkQpDDkFJnMtogOAkuUNTsq2A@mail.gmail.com>

Hi guys,

I've noticed a problem binding/unbind to a header exchange with boolean
values using the RabbitMQ Management Plugin. I'm using RabbitMQ 2.7.1,
actually I don remember if this was working in 2.5.1.

Basically I can't bind thru the plugin something like in code would be:

channel.queueBind(queueName, headerExchange '', ['my_field_name': true,
'x-match': 'all'])

And also I cannot unbind something with the code above... only by code
(java driver).
I guess it must something related to string/boolean types missunderstood by
the plugin.

Is a known bug, should I raise a Jira or I'm doing somthing wrong?

Thx!
Pablo
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120427/b7104c08/attachment.htm>

From matthias at rabbitmq.com  Fri Apr 27 20:59:32 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 27 Apr 2012 20:59:32 +0100
Subject: [rabbitmq-discuss] amqp_client upgrade bug
In-Reply-To: <9322B1C6-BABD-4BC5-8B2B-CAAEA44D3B2A@gmail.com>
References: <9322B1C6-BABD-4BC5-8B2B-CAAEA44D3B2A@gmail.com>
Message-ID: <4F9AFAA4.5030704@rabbitmq.com>

Ivan,

On 27/04/12 15:55, Ivan Dyachkov wrote:
> src/amqp_channel.erl: [code_change/3 returns State] when it must
> return {ok, State}.

I've fixed that one an all the others in the rabbitmq-erlang-client repo 
on the 'default' branch. Should make it into the next release.

The only other occurrence in our repos I could find was in 
rabbit_limiter in the server. Fixed that one too.

Thanks for reporting this bug.

Matthias.

From aaron at agoragames.com  Fri Apr 27 21:31:49 2012
From: aaron at agoragames.com (Aaron Westendorf)
Date: Fri, 27 Apr 2012 16:31:49 -0400
Subject: [rabbitmq-discuss] haigha 0.5.0 release
Message-ID: <CAHiEoM4cQQYArYgcJEc4K4ocAV6MPRqMfFCYhywr1n_4rrS3RQ@mail.gmail.com>

I'm happy to announce the 0.5.0 release of haigha today. This includes
many bug fixes in the 0.4 series and a big round of bug fixes today
along with support for synchronous clients. Haigha no longer requires
an asynchronous IO loop and can be used with blocking sockets and
without callbacks.

Documentation is still lagging, but there are examples in the scripts
directory including a console application.

cheers,
Aaron

http://pypi.python.org/pypi/haigha
https://github.com/agoragames/haigha

-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From ivan.dyachkoff at gmail.com  Fri Apr 27 21:31:46 2012
From: ivan.dyachkoff at gmail.com (Ivan Dyachkov)
Date: Fri, 27 Apr 2012 22:31:46 +0200
Subject: [rabbitmq-discuss] amqp_client upgrade bug
In-Reply-To: <4F9AFAA4.5030704@rabbitmq.com>
References: <9322B1C6-BABD-4BC5-8B2B-CAAEA44D3B2A@gmail.com>
	<4F9AFAA4.5030704@rabbitmq.com>
Message-ID: <33CD63F8-255F-41A6-8F4B-BF43379ACB89@gmail.com>

Matthias, thanks a lot!

Regards,
Ivan

On Apr 27, 2012, at 21:59 , Matthias Radestock wrote:

> Ivan,
> 
> On 27/04/12 15:55, Ivan Dyachkov wrote:
>> src/amqp_channel.erl: [code_change/3 returns State] when it must
>> return {ok, State}.
> 
> I've fixed that one an all the others in the rabbitmq-erlang-client repo on the 'default' branch. Should make it into the next release.
> 
> The only other occurrence in our repos I could find was in rabbit_limiter in the server. Fixed that one too.
> 
> Thanks for reporting this bug.
> 
> Matthias.


From matthias at rabbitmq.com  Sat Apr 28 08:13:18 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 28 Apr 2012 08:13:18 +0100
Subject: [rabbitmq-discuss] Active-active crash report
In-Reply-To: <CAFWGgNHDT1oj5os0o_oEwFdp7Y3qrtG5Um-PtqwQ4FEMsfxbBg@mail.gmail.com>
References: <CAFWGgNFpLjY4Ufjj3OdM-AxwRp0C8Rbm=GqoGX4MeAhus3bQhw@mail.gmail.com>	<20120426223123.GA9230@wellquite.org>	<CAFWGgNFu6jnCp-qCwjg5AL=TZ0xrCkSZou472e1ZaE0=HRbPOw@mail.gmail.com>	<CAFWGgNH5c9eJfVa3w9Sks+wtF5VoBVPWGgxA54ECcZ0y3KCn-w@mail.gmail.com>	<4F9A31A9.3050900@rabbitmq.com>
	<CAFWGgNHDT1oj5os0o_oEwFdp7Y3qrtG5Um-PtqwQ4FEMsfxbBg@mail.gmail.com>
Message-ID: <4F9B988E.8070103@rabbitmq.com>

Vadim,

(putting the list back on cc)

On 27/04/12 23:28, Vadim Chekan wrote:
> I've spent some time today playing with different client settings. Seems
> ttl does not affect failures at all.

That's good to know. The more factors we can eliminate as possible 
causes the better.

> I managed to reproduce crash many times today. Basic idea is: an
> application, 40 threads create a pub/sub exchange and publish a message
> every second. Under this load I bring the master node (all queues are
> usually created on the same node) and often it causes another node to
> fail. Here is my load simulator (in c#):
> http://www.heypasteit.com/clip/0B5W

That code connects to "rabbitmq-dev". Is that a load balancer sitting in 
front of the three nodes?

How do you deal with the disconnects resulting from the shutting down of 
nodes? There doesn't seem to be any code to handle that.

Mind you, I suspect that the failure should still be reproducible 
without any subscriptions and publishes. Would be good to try that and 
just watch the broker logs for errors.

> As long as maillist does not allow zip attaches, I'm mailing to you guys
> directly

Thanks for posting these. There is an error in the logs that we haven't 
seen before:

            {{badmatch,[]},
             [{rabbit_mirror_queue_misc,'-remove_from_queue/2-fun-0-',2},
              {mnesia_tm,apply_fun,3},
              {mnesia_tm,execute_transaction,5},
              {rabbit_misc,'-execute_mnesia_transaction/1-fun-0-',1},
              {worker_pool_worker,handle_call,3},
              {gen_server2,handle_msg,2},
              {proc_lib,wake_up,3}]}

Looking at the code, this appears to indicate that there are no 
master/mirror processes left for the queue. Which is...unexpected. That 
should give us something to go on.

Regards,

Matthias.

From anacadeliana at gmail.com  Fri Apr 27 21:07:49 2012
From: anacadeliana at gmail.com (cadeli)
Date: Fri, 27 Apr 2012 13:07:49 -0700 (PDT)
Subject: [rabbitmq-discuss] Which dll to reference when building my own
	Producer-Consumer wrapper?
Message-ID: <e84d3895-51ee-4e5d-83c1-ab211a43d28e@ri8g2000pbc.googlegroups.com>

Beginner question here.
I am building my first Producer - Consumer .Net4.0 app, using
AMQP-0-9. I reference MessageBus.dll.
Just noticed that the Spring AMQP implementation references
RabbitMQ.Client.dll.
Should I switch? What would be the advantages/disadvantages?
Thank you,
cadeli

From achetreanu at atti.com  Fri Apr 27 21:21:01 2012
From: achetreanu at atti.com (cadeli)
Date: Fri, 27 Apr 2012 13:21:01 -0700 (PDT)
Subject: [rabbitmq-discuss] Begginer question - do I reference
 RabbitMQ.Client.dll or MessageBus.dll ?
Message-ID: <33760470.post@talk.nabble.com>


Building my first Producer-Consumer app on .Net4.0 using AMQP-0-9. Have been
referencing MessageBus.dll but just noticed that the Spring AMQP
implementation references RabbitMQ.Client.dll.

Should I switch? Are they equal or would I get more from
RabbitMQ.Client.dll? 
Do they both give me the latest RabbitMQ functionality? Any pros/cons I need
to know?

I only control the client side.

Thank you!
cadeli

(I apologize if this question was answered before on this forum) 
-- 
View this message in context: http://old.nabble.com/Begginer-question---do-I-reference-RabbitMQ.Client.dll-or-MessageBus.dll---tp33760470p33760470.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From cischmidt77 at gmail.com  Mon Apr 30 04:51:00 2012
From: cischmidt77 at gmail.com (Chris Schmidt)
Date: Sun, 29 Apr 2012 20:51:00 -0700 (PDT)
Subject: [rabbitmq-discuss] Enabling hipe_compile in RHEL 6
Message-ID: <3810557.644.1335757860507.JavaMail.geo-discussion-forums@pbaf5>

I'm running RabbitMQ 2.71/R14B04 on RHEL 6.2 and am encountering scaling 
issues with (I believe) RMQ. I'm interested in using the hipe_compile or 
other configurations to tune RMQ's throughput. Right now we get around 20k 
messages per second, but anything beyond that the queues begin to grow 
(there are a number of producer/consumer workers and around 15 
queues/exchanges they read/write to). Each worker is acknowledging messages 
as they are processed and sent on to the next process. The messages have 
variable size.

 I've changed the frame_max setting but that doesn't appear to help. I've 
tried increasing the number of workers across additional hardware as well, 
but Rabbit still seems to cap at 20k message/sec. When I set hipe_compile 
to true, the systems states 'Not HiPE compiling: HiPE not found in this 
Erlang installation.' What's odd is that erlang-hipe-R14B-04.1.el6.x86_64 
is installed. Is there something else that needs to be done for RHEL 
systems to enable hipe_compile? I think that it may help get beyond the 
current problem. If that doesn't help, are there other settings or 
something I can look at to determine where the bottleneck is? The RMQ 
server is 60% idle, doesn't have a large amount of I/O wait, and doesn't 
seem to be saturating its network cards (the server has a bonded ethernet 
interface). The worker machines are relatively idle as well.

Thanks,

 Chris
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120429/9277c7fd/attachment.htm>

From emile at rabbitmq.com  Mon Apr 30 10:38:31 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 30 Apr 2012 10:38:31 +0100
Subject: [rabbitmq-discuss] Enabling hipe_compile in RHEL 6
In-Reply-To: <3810557.644.1335757860507.JavaMail.geo-discussion-forums@pbaf5>
References: <3810557.644.1335757860507.JavaMail.geo-discussion-forums@pbaf5>
Message-ID: <4F9E5D97.6010900@rabbitmq.com>

Hi Chris,

On 30/04/12 04:51, Chris Schmidt wrote:
> I'm running RabbitMQ 2.71/R14B04 on RHEL 6.2 and am encountering scaling
> issues with (I believe) RMQ. I'm interested in using the hipe_compile or
> other configurations to tune RMQ's throughput. Right now we get around
> 20k messages per second, but anything beyond that the queues begin to
> grow (there are a number of producer/consumer workers and around 15
> queues/exchanges they read/write to). Each worker is acknowledging
> messages as they are processed and sent on to the next process. The
> messages have variable size.

If the queues start to grow then you should focus on speeding up the
consumers. If the consumers can't keep up then increasing the speed of
the broker won't keep the queues short.

Versions of the broker later then 2.7.1 feature internal flow control
which helps to limit latency. Your problem might benefit from this.

>  I've changed the frame_max setting but that doesn't appear to
> help. I've tried increasing the number of workers across additional
> hardware as well, but Rabbit still seems to cap at 20k message/sec. When

The maximum framesize allows you to choose between better latency (small
framesize) or throughput (large framesize). If many messages are larger
than 128Kb then increasing framesize may improve throughput (provided
consumers can keep up).

When you increased the number of workers, were you able to determine
whether the load was effectively spread amongst all of them? The QoS
prefetch count setting will help to ensure fair distribution. Try a
small number (e.g. 10) as a starting point for tuning this value.

> I set hipe_compile to true, the systems states 'Not HiPE compiling: HiPE
> not found in this Erlang installation.' What's odd is
> that erlang-hipe-R14B-04.1.el6.x86_64 is installed. Is there something
> else that needs to be done for RHEL systems to enable hipe_compile? I

That message means that your installation of Erlang lacks the hipe.beam
file in the code loading path. The name of the package that includes
this file depends on how Erlang was packaged in your system. Making use
of HiPE won't address the core problem though.

> think that it may help get beyond the current problem. If that doesn't
> help, are there other settings or something I can look at to determine
> where the bottleneck is? The RMQ server is 60% idle, doesn't have a
> large amount of I/O wait, and doesn't seem to be saturating its network
> cards (the server has a bonded ethernet interface). The worker machines
> are relatively idle as well.

Are *all* the workers idle, or are a small number taking all the load?
Uneven worker load is a potential cause for the problem you describe and
can be addressed using prefetch count:

http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.qos.prefetch-count


-Emile



From simon at rabbitmq.com  Mon Apr 30 11:43:47 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 30 Apr 2012 11:43:47 +0100
Subject: [rabbitmq-discuss] Enabling hipe_compile in RHEL 6
In-Reply-To: <4F9E5D97.6010900@rabbitmq.com>
References: <3810557.644.1335757860507.JavaMail.geo-discussion-forums@pbaf5>
	<4F9E5D97.6010900@rabbitmq.com>
Message-ID: <4F9E6CE3.4050708@rabbitmq.com>

On 30/04/12 10:38, Emile Joubert wrote:
>>   I've changed the frame_max setting but that doesn't appear to
>> help. I've tried increasing the number of workers across additional
>> hardware as well, but Rabbit still seems to cap at 20k message/sec. When
>
> The maximum framesize allows you to choose between better latency (small
> framesize) or throughput (large framesize). If many messages are larger
> than 128Kb then increasing framesize may improve throughput (provided
> consumers can keep up).

(But for small messages it makes no difference.)

> When you increased the number of workers, were you able to determine
> whether the load was effectively spread amongst all of them? The QoS
> prefetch count setting will help to ensure fair distribution. Try a
> small number (e.g. 10) as a starting point for tuning this value.
>
>> I set hipe_compile to true, the systems states 'Not HiPE compiling: HiPE
>> not found in this Erlang installation.' What's odd is
>> that erlang-hipe-R14B-04.1.el6.x86_64 is installed. Is there something
>> else that needs to be done for RHEL systems to enable hipe_compile? I
>
> That message means that your installation of Erlang lacks the hipe.beam
> file in the code loading path. The name of the package that includes
> this file depends on how Erlang was packaged in your system. Making use
> of HiPE won't address the core problem though.

Well, HiPE will help if a CPU-bound RabbitMQ is in fact the bottleneck. 
It won't help if RabbitMQ is IO-bound, or not the bottleneck.

But HiPE is two parts; there are support libraries in the HiPE package, 
but there also needs to be support in the VM - and I've just had a quick 
look at Peter's Erlang packages installed on my CentOS 5 box and it 
looks like HiPE support is not compiled into the VM. (You should see 
"[hipe]" in the banner displayed when starting erl.) That's not the same 
RPM as you're using, but maybe it comes from the same source?

>> think that it may help get beyond the current problem. If that doesn't
>> help, are there other settings or something I can look at to determine
>> where the bottleneck is? The RMQ server is 60% idle, doesn't have a
>> large amount of I/O wait, and doesn't seem to be saturating its network
>> cards (the server has a bonded ethernet interface). The worker machines
>> are relatively idle as well.
>
> Are *all* the workers idle, or are a small number taking all the load?
> Uneven worker load is a potential cause for the problem you describe and
> can be addressed using prefetch count:
>
> http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.qos.prefetch-count

This is certainly suspicious. Something somewhere in your system ought 
to be running at 100% capacity. If your queues are growing it should be 
the workers, but the other possibility is that RabbitMQ is not able to 
push out messages fast enough to the consumers. If so you'll be happy to 
hear that the imminent 2.8.2 release has some performance improvements 
in that area.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Mon Apr 30 11:50:29 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 30 Apr 2012 11:50:29 +0100
Subject: [rabbitmq-discuss] RabbitMQ plugin mangament binding problem
In-Reply-To: <CANVSfpL69OvBSqr79r5XbJqS=UkQpDDkFJnMtogOAkuUNTsq2A@mail.gmail.com>
References: <CANVSfpL69OvBSqr79r5XbJqS=UkQpDDkFJnMtogOAkuUNTsq2A@mail.gmail.com>
Message-ID: <4F9E6E75.8060704@rabbitmq.com>

On 27/04/12 20:39, Pablo Molnar wrote:
>
> And also I cannot unbind something with the code above... only by code
> (java driver).
> I guess it must something related to string/boolean types missunderstood
> by the plugin.

At the moment you can only bind with strings in mgmt. It's always been 
like this. So it's a known issue which will hopefully get some attention 
soon.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Mon Apr 30 12:50:44 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 30 Apr 2012 12:50:44 +0100
Subject: [rabbitmq-discuss] RabbitMQ 2.8.2 released
Message-ID: <4F9E7C94.1030208@rabbitmq.com>

The RabbitMQ team is pleased to announce the release of RabbitMQ 2.8.2.

This release fixes a number of bugs and improves performance in a 
variety of areas, as well as introducing disc space monitoring and 
federation status reporting.

See the attached release notes for more details.

As always, we welcome any questions, bug reports, and other feedback on
this release, as well as general suggestions for features and
enhancements in future releases. Mail us via the RabbitMQ discussion
list.

Regards,
                    The RabbitMQ Team
                    (http://www.rabbitmq.com)

-- 
Simon MacMullen
RabbitMQ, VMware





-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: README-2.8.2.txt
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120430/376652e4/attachment.txt>

From jon at jbrisbin.com  Mon Apr 30 14:51:35 2012
From: jon at jbrisbin.com (Jon Brisbin)
Date: Mon, 30 Apr 2012 08:51:35 -0500
Subject: [rabbitmq-discuss] Eliminated hrls from 2.8.2 source?
Message-ID: <A309BF45-DC76-481F-9B1A-49A6918195EC@jbrisbin.com>

I'm updating the rebar fork of amqp_client with 2.8.2 and I noticed that some .hrl files have been removed. Previously I had the following in the rabbit_common dependency:

include/rabbit_auth_backend_spec.hrl
include/rabbit_auth_mechanism_spec.hrl
include/rabbit_backing_queue_spec.hrl
include/rabbit_exchange_type_spec.hrl
include/rabbit_msg_store_index.hrl

These seem to be gone from rabbitmq-server/include now. Some of the specs appear in the source code, I see, while others seem to just be gone entirely.

Since I keep stuff tagged by version, we should be okay if someone is using rebar and depending on a specific version of rabbit_common (2.8.1 or earlier, say). But are there going to be any side effects of not having these include files any longer?

Thanks!

Jon Brisbin

http://jbrisbin.com
Twitter: @j_brisbin



From francesco at rabbitmq.com  Mon Apr 30 14:54:57 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Mon, 30 Apr 2012 14:54:57 +0100
Subject: [rabbitmq-discuss] Eliminated hrls from 2.8.2 source?
In-Reply-To: <A309BF45-DC76-481F-9B1A-49A6918195EC@jbrisbin.com>
References: <A309BF45-DC76-481F-9B1A-49A6918195EC@jbrisbin.com>
Message-ID: <4F9E99B1.8090202@rabbitmq.com>

Hi Jon,

The .hrl files were removed since now dyalizer offers a mechanism to 
type behaviours (the -callback signatures). You should remove whatever 
-include you might have containing them. There won't be any side effects 
apart from a cleaner dyalizer output :).

Francesco.

On 30/04/12 14:51, Jon Brisbin wrote:
> I'm updating the rebar fork of amqp_client with 2.8.2 and I noticed that some .hrl files have been removed. Previously I had the following in the rabbit_common dependency:
>
> include/rabbit_auth_backend_spec.hrl
> include/rabbit_auth_mechanism_spec.hrl
> include/rabbit_backing_queue_spec.hrl
> include/rabbit_exchange_type_spec.hrl
> include/rabbit_msg_store_index.hrl
>
> These seem to be gone from rabbitmq-server/include now. Some of the specs appear in the source code, I see, while others seem to just be gone entirely.
>
> Since I keep stuff tagged by version, we should be okay if someone is using rebar and depending on a specific version of rabbit_common (2.8.1 or earlier, say). But are there going to be any side effects of not having these include files any longer?
>
> Thanks!
>
> Jon Brisbin
>
> http://jbrisbin.com
> Twitter: @j_brisbin
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From jon at jbrisbin.com  Mon Apr 30 14:59:23 2012
From: jon at jbrisbin.com (Jon Brisbin)
Date: Mon, 30 Apr 2012 08:59:23 -0500
Subject: [rabbitmq-discuss] Eliminated hrls from 2.8.2 source?
In-Reply-To: <4F9E99B1.8090202@rabbitmq.com>
References: <A309BF45-DC76-481F-9B1A-49A6918195EC@jbrisbin.com>
	<4F9E99B1.8090202@rabbitmq.com>
Message-ID: <827E79AA-B055-4F56-B529-D020BD956BEF@jbrisbin.com>


On Apr 30, 2012, at 8:54 AM, Francesco Mazzoli wrote:

> Hi Jon,
> 
> The .hrl files were removed since now dyalizer offers a mechanism to type behaviours (the -callback signatures). You should remove whatever -include you might have containing them. There won't be any side effects apart from a cleaner dyalizer output :).


Sounds great. Thanks! :)


Jon Brisbin

http://jbrisbin.com
Twitter: @j_brisbin

> 
> Francesco.
> 
> On 30/04/12 14:51, Jon Brisbin wrote:
>> I'm updating the rebar fork of amqp_client with 2.8.2 and I noticed that some .hrl files have been removed. Previously I had the following in the rabbit_common dependency:
>> 
>> include/rabbit_auth_backend_spec.hrl
>> include/rabbit_auth_mechanism_spec.hrl
>> include/rabbit_backing_queue_spec.hrl
>> include/rabbit_exchange_type_spec.hrl
>> include/rabbit_msg_store_index.hrl
>> 
>> These seem to be gone from rabbitmq-server/include now. Some of the specs appear in the source code, I see, while others seem to just be gone entirely.
>> 
>> Since I keep stuff tagged by version, we should be okay if someone is using rebar and depending on a specific version of rabbit_common (2.8.1 or earlier, say). But are there going to be any side effects of not having these include files any longer?
>> 
>> Thanks!
>> 
>> Jon Brisbin
>> 
>> http://jbrisbin.com
>> Twitter: @j_brisbin
>> 
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From cischmidt77 at gmail.com  Mon Apr 30 15:48:26 2012
From: cischmidt77 at gmail.com (Chris Schmidt)
Date: Mon, 30 Apr 2012 07:48:26 -0700
Subject: [rabbitmq-discuss] Enabling hipe_compile in RHEL 6
In-Reply-To: <4F9E5D97.6010900@rabbitmq.com>
References: <3810557.644.1335757860507.JavaMail.geo-discussion-forums@pbaf5>
	<4F9E5D97.6010900@rabbitmq.com>
Message-ID: <CAEnikB6X44Em-CfWtTCvnJi12ea94VgGY72jLO9H-7nnpXVesg@mail.gmail.com>

On Mon, Apr 30, 2012 at 2:38 AM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi Chris,
>
> On 30/04/12 04:51, Chris Schmidt wrote:
> > I'm running RabbitMQ 2.71/R14B04 on RHEL 6.2 and am encountering scaling
> > issues with (I believe) RMQ. I'm interested in using the hipe_compile or
> > other configurations to tune RMQ's throughput. Right now we get around
> > 20k messages per second, but anything beyond that the queues begin to
> > grow (there are a number of producer/consumer workers and around 15
> > queues/exchanges they read/write to). Each worker is acknowledging
> > messages as they are processed and sent on to the next process. The
> > messages have variable size.
>
> If the queues start to grow then you should focus on speeding up the
> consumers. If the consumers can't keep up then increasing the speed of
> the broker won't keep the queues short.
>
> Versions of the broker later then 2.7.1 feature internal flow control
> which helps to limit latency. Your problem might benefit from this.
>
>
The workers are chained together A --> B --> C. One worker type processes
data, sends to an exchange which gets picks up from a queue by a downstream
worker. What I see is that the workers are consuming messages and then
spending a large amount of time publishing to the next exchange. This
causes the number of unacknowledged messages to grow and eventually RMQ
hits the memory limit and everything grinds almost to a halt. I am limiting
the number of messages held within each worker to a max of 50k (using Java,
basic queueing consumer with a blocking queue). Originally the internal
queue of messages grew unbounded and the workers would die with an out of
memory error.


> >  I've changed the frame_max setting but that doesn't appear to
> > help. I've tried increasing the number of workers across additional
> > hardware as well, but Rabbit still seems to cap at 20k message/sec. When
>
> The maximum framesize allows you to choose between better latency (small
> framesize) or throughput (large framesize). If many messages are larger
> than 128Kb then increasing framesize may improve throughput (provided
> consumers can keep up).
>
> When you increased the number of workers, were you able to determine
> whether the load was effectively spread amongst all of them? The QoS
> prefetch count setting will help to ensure fair distribution. Try a
> small number (e.g. 10) as a starting point for tuning this value.
>
>
I can see an even distribution of messages across the workers through the
RMQ management console. As the workers increase the number of messages
consumed per worker drops equally. I'll try the QoS setting for consumption
to see if that helps, but it does appear to be a fair distribution on the
consumption side.


> > I set hipe_compile to true, the systems states 'Not HiPE compiling: HiPE
> > not found in this Erlang installation.' What's odd is
> > that erlang-hipe-R14B-04.1.el6.x86_64 is installed. Is there something
> > else that needs to be done for RHEL systems to enable hipe_compile? I
>
> That message means that your installation of Erlang lacks the hipe.beam
> file in the code loading path. The name of the package that includes
> this file depends on how Erlang was packaged in your system. Making use
> of HiPE won't address the core problem though.
>
> > think that it may help get beyond the current problem. If that doesn't
> > help, are there other settings or something I can look at to determine
> > where the bottleneck is? The RMQ server is 60% idle, doesn't have a
> > large amount of I/O wait, and doesn't seem to be saturating its network
> > cards (the server has a bonded ethernet interface). The worker machines
> > are relatively idle as well.
>
> Are *all* the workers idle, or are a small number taking all the load?
> Uneven worker load is a potential cause for the problem you describe and
> can be addressed using prefetch count:
>
> http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.qos.prefetch-count
>
>
No, the workers are processing messages, the machine(s) in use are fairly
idle though (these are pretty beefy 12 core servers so  have room to run
more workers if necessary) I did a profile and the majority of the time is
spent in the basicPublish call. There's definitely a bottleneck here, I
just haven't found it yet. I'm going to verify that there isn't something
within the network causing the RMQ server to not be able to communicate
with the other servers appropriately.


>
> -Emile
>
>
>
Thanks!

 Chris
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120430/35e8ff9a/attachment.htm>

From emile at rabbitmq.com  Mon Apr 30 16:53:48 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 30 Apr 2012 16:53:48 +0100
Subject: [rabbitmq-discuss] Can't get cluster to work on 2 Windows
	Machines
In-Reply-To: <b736e7af-0ddb-4ff6-b4a1-fc0521214f28@f27g2000yqc.googlegroups.com>
References: <b736e7af-0ddb-4ff6-b4a1-fc0521214f28@f27g2000yqc.googlegroups.com>
Message-ID: <4F9EB58C.9010703@rabbitmq.com>


Hi Christopher,

A comparison of the Erlang cookie hashes shows that these are correct,
so the problem lies elsewhere. Can you confirm that the firewall is
allowing traffic on port 45001? A firewall blocking that port is a
possible explanation.

Are there any indications of a failed connection attempt in either
broker logfile at the corresponding times?


-Emile




From emile at rabbitmq.com  Mon Apr 30 17:36:21 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 30 Apr 2012 17:36:21 +0100
Subject: [rabbitmq-discuss] rabbitmq-server load average
In-Reply-To: <CACqr=q0AOiHufEA-y4=FvP_L7A0ZepODL9JikXmjBFj=D0nx4g@mail.gmail.com>
References: <CACqr=q0AOiHufEA-y4=FvP_L7A0ZepODL9JikXmjBFj=D0nx4g@mail.gmail.com>
Message-ID: <4F9EBF85.6000201@rabbitmq.com>

Hi Alexander,

On 26/04/12 15:01, Alexander Klimenko wrote:
> I use rabbitmq-server v. *2.5.1*-1 on *debian squeeze* with kernel
> *3.0.0-14*.
> At the moment I perform performance optimization. I noticed that when I
> start rabbitmq-server (on Intel(R) Atom(TM) CPU D525, 2 cores) system
> load average get growth from *~0.5* to *~1*. *So my question: what
> causes such growth?*
> rabbitmq-server has one subscriber process and if I switch it off
> (subscriber) it doesn't change load average.

Is the load of 1.0 sustained while the broker is idle, and does it
remain at that level indefinitely after all peers have disconnected? I'm
not familiar with that architecture, but on my workstation an idle
broker imposes negligible load.

The presence of producers as well as subscribers can impose load.  If
you still had producers connected then that could explain the load. You
can use "rabbitmqctl list_connections" to confirm that no peers are
connected to the broker.

Can you confirm that the beam (or beam.smp) process is responsible for
the load? If you have clients connecting over the loopback interface
then they may be responsible for the load.

If none of the above points to a culprit, and you have 'etop' included
in your Erlang installation then you may want to check whether any
Erlang processes are contributing disproportionately to the load:

 etop -node rabbit at host -lines 20 -sort reductions



-Emile



From kot.begemot at gmail.com  Mon Apr 30 17:43:54 2012
From: kot.begemot at gmail.com (Vadim Chekan)
Date: Mon, 30 Apr 2012 09:43:54 -0700
Subject: [rabbitmq-discuss] Active-active crash report
In-Reply-To: <4F9B988E.8070103@rabbitmq.com>
References: <CAFWGgNFpLjY4Ufjj3OdM-AxwRp0C8Rbm=GqoGX4MeAhus3bQhw@mail.gmail.com>
	<20120426223123.GA9230@wellquite.org>
	<CAFWGgNFu6jnCp-qCwjg5AL=TZ0xrCkSZou472e1ZaE0=HRbPOw@mail.gmail.com>
	<CAFWGgNH5c9eJfVa3w9Sks+wtF5VoBVPWGgxA54ECcZ0y3KCn-w@mail.gmail.com>
	<4F9A31A9.3050900@rabbitmq.com>
	<CAFWGgNHDT1oj5os0o_oEwFdp7Y3qrtG5Um-PtqwQ4FEMsfxbBg@mail.gmail.com>
	<4F9B988E.8070103@rabbitmq.com>
Message-ID: <CAFWGgNH8raZoyaQq=nyX+1pHHaouLXKp7+HbTEj8jOwnugM3vA@mail.gmail.com>

Thanks for looking into it Matthias,

"rabbitmq-dev": yes, it is load balancer.
Disconnects: I was too lazy to write code for it and just restarted client
manually.
I did make a short try to reproduce failure without any load but it worked
just fine. I'll try more today.

Vadim.

On Sat, Apr 28, 2012 at 12:13 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Vadim,
>
> (putting the list back on cc)
>
>
> On 27/04/12 23:28, Vadim Chekan wrote:
>
>> I've spent some time today playing with different client settings. Seems
>> ttl does not affect failures at all.
>>
>
> That's good to know. The more factors we can eliminate as possible causes
> the better.
>
>
>  I managed to reproduce crash many times today. Basic idea is: an
>> application, 40 threads create a pub/sub exchange and publish a message
>> every second. Under this load I bring the master node (all queues are
>> usually created on the same node) and often it causes another node to
>> fail. Here is my load simulator (in c#):
>> http://www.heypasteit.com/**clip/0B5W<http://www.heypasteit.com/clip/0B5W>
>>
>
> That code connects to "rabbitmq-dev". Is that a load balancer sitting in
> front of the three nodes?
>
> How do you deal with the disconnects resulting from the shutting down of
> nodes? There doesn't seem to be any code to handle that.
>
> Mind you, I suspect that the failure should still be reproducible without
> any subscriptions and publishes. Would be good to try that and just watch
> the broker logs for errors.
>
>
>  As long as maillist does not allow zip attaches, I'm mailing to you guys
>> directly
>>
>
> Thanks for posting these. There is an error in the logs that we haven't
> seen before:
>
>           {{badmatch,[]},
>            [{rabbit_mirror_queue_misc,'-**remove_from_queue/2-fun-0-',2}**
> ,
>             {mnesia_tm,apply_fun,3},
>             {mnesia_tm,execute_**transaction,5},
>             {rabbit_misc,'-execute_mnesia_**transaction/1-fun-0-',1},
>             {worker_pool_worker,handle_**call,3},
>             {gen_server2,handle_msg,2},
>             {proc_lib,wake_up,3}]}
>
> Looking at the code, this appears to indicate that there are no
> master/mirror processes left for the queue. Which is...unexpected. That
> should give us something to go on.
>
> Regards,
>
> Matthias.
>



-- 

From matthias at rabbitmq.com  Mon Apr 30 17:59:04 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 30 Apr 2012 17:59:04 +0100
Subject: [rabbitmq-discuss] Message timeouts
In-Reply-To: <4F98D869.60400@nextday.fi>
References: <6243898.229.1322825583745.JavaMail.geo-discussion-forums@yqny18>	<06c4412d-588f-4b82-9b8d-5f1caf2ece1d@u32g2000yqe.googlegroups.com>	<4ED8C280.9020707@rabbitmq.com>	<19609256.257.1322829385090.JavaMail.geo-discussion-forums@yqiw17>	<4ED8C82E.1070906@rabbitmq.com>	<855F810E-DE11-413C-B3D6-D65D5CA82EC9@rabbitmq.com>	<5024586.436.1323053328384.JavaMail.geo-discussion-forums@yqkp3>	<A9B0DFE2-DA9D-4FE0-BD67-29174617F598@rabbitmq.com>	<20398578.95.1323605677788.JavaMail.geo-discussion-forums@yqfm20>
	<4F98D869.60400@nextday.fi>
Message-ID: <4F9EC4D8.1090308@rabbitmq.com>

Alex,

On 26/04/12 06:08, Alex Gr?nholm wrote:
>> You want requests to either be processed or (reliably) not
>> processed. You never want the clients to be in any doubt about
>> whether the request was processed or not. So you wait forever in
>> the client. However, requests that get discarded never return so
>> the client doesn't know. So you want expiry to trigger replies to
>> the clients. (Per-queue message TTLs also don't return.) >>
>>
>>  Sounds about right.
>>
>> Let's see -- how would we do this without a dead-letter mechanism? >>
> Now that the dead-letter mechanism is part of the server, I don't still
> don't see how this could be done. The dead lettered RPC commands would
> still have to be processed somewhere.

Right. Ideally you'd need a way to specify a dead-letter destination 
*per message*. However, working with what is possible today, instead you 
could just have a single "dead request" queue to which all expired 
requests get routed. And then have a small app simply consuming messages 
from that queue and replying to them with some sort of error indication.

Regards,

Matthias.

From gautam.bakshi at gmail.com  Mon Apr 30 21:54:18 2012
From: gautam.bakshi at gmail.com (Gautam Bakshi)
Date: Mon, 30 Apr 2012 16:54:18 -0400
Subject: [rabbitmq-discuss] Can I set the level of replication for rabbitmq
	clustering?
Message-ID: <CAHSyJgKSbCu+SbfRmyLkUH9LX50rnV0GB0357=+w1-TqPEohJQ@mail.gmail.com>

Hi Everyone!

My work items are very small but amount of work is very large  and network
IO is quite a large overhead(not Rabbit's fault, my bandwidth is limited).
So I'm thinking of running a local rabbitmq on each of my worker servers
and then replicating work locally for them to pull and push messages to.

I can write a program that messages the queue by monitoring them and if one
servers queue gets empty it takes a few thousand from another server but
I'm wondering if thats needed if I use the clustering feature? I know how
to set it up but how it works is a bit unclear to me.  Can I set the
replication not to replicate everything all the time but only a few jobs
when the queues get below a specific threshold?

Also, right now I'm using localhost to connect but if all my access is
entirely local is there a faster way to connect such a direct socket?  Any
suggestions or ideas would be greatly appreciated.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120430/58b02ef7/attachment.htm>

