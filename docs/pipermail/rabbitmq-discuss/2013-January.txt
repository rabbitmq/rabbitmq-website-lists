From matthias at rabbitmq.com  Tue Jan  1 00:43:14 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 01 Jan 2013 00:43:14 +0000
Subject: [rabbitmq-discuss] Persistence and Transactions
In-Reply-To: <1356994942426-24257.post@n5.nabble.com>
References: <1356569140927-24204.post@n5.nabble.com>
	<1356994942426-24257.post@n5.nabble.com>
Message-ID: <50E23122.7080109@rabbitmq.com>

On 31/12/12 23:02, CJ wrote:
> In the examples, Why is the channel.waitForConfirmsOrDie() only performed
> after a batch of publishes, and not after each time a basicPublish is
> performed

Efficiency. If you call waitForConfirms after every publish you are 
effectively making publication synchronous, with network latency and 
disk fsyncs clobbering performance.

> Also, I do not understand the difference between the following 2 persistence
> tyopes:
>
>      MessageProperties.PERSISTENT_TEXT_PLAIN
>      MessageProperties.PERSISTENT_BASIC

These are not persistence types per se but convenient combinations of 
AMQP basic properties settings. See 
http://www.rabbitmq.com/javadoc/com/rabbitmq/client/MessageProperties.html 
for their definitions. The API guide 
(http://www.rabbitmq.com/api-guide.html) shows how to build your own 
AMQP.BasicProperties if none of the supplied ones meet your needs.

Regards,

Matthias.

From david.barshow at gmail.com  Wed Jan  2 00:14:47 2013
From: david.barshow at gmail.com (David Barshow)
Date: Tue, 1 Jan 2013 16:14:47 -0800 (PST)
Subject: [rabbitmq-discuss] Queue delete if-empty will delete the queue if
 there are in the unacked state
Message-ID: <e856d749-18df-48de-ac04-314eb5034d07@googlegroups.com>

I think this may be a bug.

Queues will delete when the if-empty bit is set to true when messages are 
in the unacknowledged state.  If messages are in the ready state this 
option performs as expected.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130101/5fbbc086/attachment.htm>

From matthias at rabbitmq.com  Wed Jan  2 04:53:34 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 02 Jan 2013 04:53:34 +0000
Subject: [rabbitmq-discuss] Queue delete if-empty will delete the queue
 if there are in the unacked state
In-Reply-To: <e856d749-18df-48de-ac04-314eb5034d07@googlegroups.com>
References: <e856d749-18df-48de-ac04-314eb5034d07@googlegroups.com>
Message-ID: <50E3BD4E.4070103@rabbitmq.com>

David,

On 02/01/13 00:14, David Barshow wrote:
> I think this may be a bug.
>
> Queues will delete when the if-empty bit is set to true when messages
> are in the unacknowledged state.

The AMQP spec is silent on this. The reason for choosing the current 
behaviour is for consistency with the various operations that return 
message-counts, such as queue.declare and basic.get. The spec mandates 
that these counts do not include messages pending acknowledgement. And 
indeed that kinda makes sense since it would be a bit odd to be told 
that the queue has messages, issue a basic.get, and be told (by a 
basic.get-empty response) that the queue is empty (since all the 
messages were pending acknowledgement). Also, conceptually, messages 
that are pending acknowledgement are not really in the queue anymore; 
or, rather, there is nothing in AMQP that suggests, let alone mandates, 
such a view.

Having said that, I can certainly see a case for "empty" to mean "no 
ready messages and no messages pending acknowledgement". Alas I don't 
know how we'd go about meeting such a requirement; I'd be reluctant to 
change the semantics of something that has been around for five years, 
particularly since we've had zero complaints to date about the current 
semantics.

Regards,

Matthias.

From jervisliu at gmail.com  Wed Jan  2 09:58:52 2013
From: jervisliu at gmail.com (Jervis Liu)
Date: Wed, 2 Jan 2013 17:58:52 +0800
Subject: [rabbitmq-discuss] RabbitMQ binary uses a ton of memory
Message-ID: <CAM9W9p2F9kBRb5KDjTKvM6u6hHdkJQTSARxZVR4+jCvnpGmLfg@mail.gmail.com>

Hi,

I am having a memory problem with RabbitMQ. My setup is something like
the following:

 - 1 server exclusively running RabbitMQ on Ubunto 11 (16G memory,
set_vm_memory_high_watermark=0.8), RabbitMQ 3.0.1, Erlang R15B03, no
plugin enabled.
 - non-exclusive, durable, non-autodelete queues binds to a durable
and non-autoDelete "fanout" exchange.

As soon as I have 10000+ connections, RabbitMQ starts to eat up a lof
of memory. Most of the memory usage are kind of expected except the
memory used by binary. The memory taken by
binary seems to be consistent, i.e., each connection takes about 88K
memory. The number of 88K is not affected by whether or not there is
any message delivering nor the number is affected by using durable,
non-autodelete queues or non-durable autodelete
queues.

Below are some of the memory reports:

4000 connections/queues  (1.251G used by Rabbit. 360M by binary, 90K each conn):
[{pid,1390},
 {running_applications,[{rabbit,"RabbitMQ","3.0.1"},
                        {mnesia,"MNESIA  CXC 138 12","4.7.1"},
                        {os_mon,"CPO  CXC 138 46","2.2.10"},
                        {sasl,"SASL  CXC 138 11","2.2.1"},
                        {stdlib,"ERTS  CXC 138 10","1.18.3"},
                        {kernel,"ERTS  CXC 138 10","2.15.3"}]},
 {os,{unix,linux}},
 {erlang_version,"Erlang R15B03 (erts-5.9.3.1) [source] [64-bit]
[smp:16:16] [async-threads:30] [hipe] [kernel-poll:true]\n"},
 {memory,[{total,1251251016},
          {connection_procs,201979944},
          {queue_procs,58421048},
          {plugins,0},
          {other_proc,2041234},
          {mnesia,6213536},
          {mgmt_db,0},
          {msg_index,6489376},
          {other_ets,9019392},
          {binary,360259160},
          {code,12271177},
          {atom,512601},
          {other_system,594043548}]},
 {vm_memory_high_watermark,0.4},
 {vm_memory_limit,6738516377},
 {disk_free_limit,1000000000},
 {disk_free,8423047168},
 {file_descriptors,[{total_limit,1048476},
                    {total_used,4003},
                    {sockets_limit,943626},
                    {sockets_used,4001}]},
 {processes,[{limit,1048576},{used,44138}]},
 {run_queue,0},
 {uptime,6547}]


22000 connections/queues (4.26G used by Rabbit. 1.936G used by binary)?
 {memory,[{total,4267102664},
          {connection_procs,1084229624},
          {queue_procs,406099296},
          {plugins,0},
          {other_proc,0},
          {mnesia,85761360},
          {mgmt_db,0},
          {msg_index,33168232},
          {other_ets,32735296},
          {binary,1936619736},
          {code,12271177},
          {atom,512601},
          {other_system,704048653}]},
 {vm_memory_high_watermark,0.4},
 {vm_memory_limit,6738516377},
 {disk_free_limit,1000000000},
 {disk_free,8411611136},
 {file_descriptors,[{total_limit,1048476},
                    {total_used,42949},
                    {sockets_limit,943626},
                    {sockets_used,21977}]},
 {processes,[{limit,1048576},{used,247898}]},
 {run_queue,0},
 {uptime,2351}]


62000 connections/queues (10.813G used by RabbitMQ. 5.422G used by binary)?
 {memory,[{total,10813159784},
          {connection_procs,3353922600},
          {queue_procs,799,643,168},
          {plugins,0},
          {other_proc,0},
          {mnesia,213449152},
          {mgmt_db,0},
          {msg_index,70512576},
          {other_ets,81005552},
          {binary,5422175992},
          {code,12271177},
          {atom,512601},
          {other_system,917633974}]},
 {vm_memory_high_watermark,0.8},
 {vm_memory_limit,13477032755},
 {disk_free_limit,1000000000},
 {disk_free,8393551872},
 {file_descriptors,[{total_limit,1048476},
                    {total_used,82643},
                    {sockets_limit,943626},
                    {sockets_used,61671}]},
 {processes,[{limit,1048576},{used,686559}]},
 {run_queue,0},
 {uptime,8120}]

Please note, above reports were taken when the system is in a quite
state, ie., no messaged published, no unacked messages, no message is
ready in the queue. The doc says "Binarys is the Memory used by shared
binary data in the Erlang VM. In-memory message bodies show up here.".
However my observation is that the binary takes ton of memory even
when there is no message is being delivered in the system. I made this
sure by starting RabbitMQ from a fresh state (rabbitmqctl reset), then
going ahead to create 22000 connections, there is absolutely no
message published to the Rabbit when I printed the memory report.
binary still took about 1.936G (88K each connection).

I am wondering if this memory usage of binary is an expected behavior
(I hope it is not) or I am missing anything?  Any help is appreciated.

Thanks,
Jervis

From matthias at rabbitmq.com  Wed Jan  2 10:23:07 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 02 Jan 2013 10:23:07 +0000
Subject: [rabbitmq-discuss] RabbitMQ binary uses a ton of memory
In-Reply-To: <CAM9W9p2F9kBRb5KDjTKvM6u6hHdkJQTSARxZVR4+jCvnpGmLfg@mail.gmail.com>
References: <CAM9W9p2F9kBRb5KDjTKvM6u6hHdkJQTSARxZVR4+jCvnpGmLfg@mail.gmail.com>
Message-ID: <50E40A8B.1070206@rabbitmq.com>

Jervis,

On 02/01/13 09:58, Jervis Liu wrote:
> As soon as I have 10000+ connections, RabbitMQ starts to eat up a
> lof of memory. Most of the memory usage are kind of expected except
> the memory used by binary. The memory taken by binary seems to be
> consistent, i.e., each connection takes about 88K memory.

That's likely the socket buffers. By default rabbit just leaves their 
sizing to the O/S. You can tune their size by setting sndbuf, recbuf and 
buffer in the rabbit tcp_listen_options, e.g. put the following in your 
rabbitmq.config file:

[{rabbit, [{tcp_listen_options, [binary,
                                  {sndbuf,        1024},
                                  {recbuf,        1024},
                                  {buffer,        1024},
                                  {packet,        raw},
                                  {reuseaddr,     true},
                                  {backlog,       128},
                                  {nodelay,       true},
                                  {linger,        {true, 0}},
                                  {exit_on_close, false}]}]}].

(all the other values are copies of the default config)

Regards,

Matthias.

From michael.s.klishin at gmail.com  Wed Jan  2 15:53:44 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 2 Jan 2013 19:53:44 +0400
Subject: [rabbitmq-discuss] Bunny 0.9 documentation updates
Message-ID: <CAE3HoVQtzWDA5W2GT=4wVscPOdMBMhDv7_GdBn=QFxcC-0xhAg@mail.gmail.com>

Happy New Year and all,

There is a couple more guides for Bunny 0.9 that are already very useful.
If you are
a Bunny 0.9 or considering giving it a shot, plase take a look:

 * Exchanges and Publishers: http://rubybunny.info/articles/exchanges.html
 * RabbitMQ Extensions: http://rubybunny.info/articles/extensions.html
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130102/729e6bc1/attachment.htm>

From mabra77 at gmail.com  Wed Jan  2 16:59:27 2013
From: mabra77 at gmail.com (mabra)
Date: Wed, 2 Jan 2013 08:59:27 -0800 (PST)
Subject: [rabbitmq-discuss] Migrating from MSMQ:Identifying queue features
Message-ID: <f261250a-682e-4223-ac50-b42e06efb404@googlegroups.com>

Hello !

I just made some minor steps to evaluate Rabbit, but I cannot see, if the 
follwoing feautures
are present and probably, someone knows the answer.

I have several apps A, which generates messages with expiration time of 
about 2 hours. I have
several apps B, which evals these Messages. They are sometimes running, 
sometimes not.

Usually the B type is running permanently and in normal operation, it reads 
each message, but
does this by peek-ing the the queue and leave them in the queue.

With MSMQ, each message has a unique id, so, if my app restarts, it can 
just peek tha last
message it has been processsed and then continue peeking the remaining 
messages.

I concurrent to the B app, on demand another B is comming to the same 
queue, evealuating
the same messages with our rules.

The is probbaly more a CEP app with a fast temporary store [to avoid 
databases]. This works
exceptionally fast with MSMQ and I am abel to read more then 15k messages/s.

A good note, hint or ref to a doc or something could really help me a lot. 
I am using C#/mono.

Thanks so far an
best regards,

++mabra


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130102/0cef93f2/attachment.htm>

From mabra77 at gmail.com  Wed Jan  2 17:04:15 2013
From: mabra77 at gmail.com (mabra)
Date: Wed, 2 Jan 2013 09:04:15 -0800 (PST)
Subject: [rabbitmq-discuss] Sending messages to another computer
Message-ID: <68c2bf53-c60b-40e5-9e95-b03397dada79@googlegroups.com>

Hello !

I am coming from MSMQ und looking for a little advanced sample, which show 
me the
following:

App A on Computer A send a message to a local queue.
App B on Computer B will read/receive this message fro a local queue.
Wether A nor B should know the foreign computer at all.
I need this to ensure reliablilty of messages on dead computers
or networks. The communication should - at best [like I know this
from MSMQ] - happen automatically.

Thanks a lot.

Best regards,

++mabra

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130102/208cccbf/attachment.htm>

From michael.s.klishin at gmail.com  Wed Jan  2 17:31:04 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 2 Jan 2013 21:31:04 +0400
Subject: [rabbitmq-discuss] Sending messages to another computer
In-Reply-To: <68c2bf53-c60b-40e5-9e95-b03397dada79@googlegroups.com>
References: <68c2bf53-c60b-40e5-9e95-b03397dada79@googlegroups.com>
Message-ID: <CAE3HoVTUoCCzS9n15t92TotuxnNf82KmCQchYyO5Aq5N__Mbaw@mail.gmail.com>

2013/1/2 mabra <mabra77 at gmail.com>

> App A on Computer A send a message to a local queue.
> App B on Computer B will read/receive this message fro a local queue.
> Wether A nor B should know the foreign computer at all.
> I need this to ensure reliablilty of messages on dead computers
> or networks. The communication should - at best [like I know this
> from MSMQ] - happen automatically.
>

Take a look at these plugins:

http://www.rabbitmq.com/shovel.html
http://www.rabbitmq.com/federation.html
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130102/6616874f/attachment.htm>

From mpietrek at skytap.com  Wed Jan  2 21:39:07 2013
From: mpietrek at skytap.com (Matt Pietrek)
Date: Wed, 2 Jan 2013 13:39:07 -0800
Subject: [rabbitmq-discuss] Returned messages when Federation in effect?
Message-ID: <CACLE7ixv65x8=aH11NejLoj=u1Twd-idYnCo+GXLkkAOjL=CFg@mail.gmail.com>

I imagine this is already answered somewhere, but I can't seem to locate a
concise answer.

if a client publishes a messages using a routing key that doesn't resolve
to anywhere reachable, should the message be returned to the client via
basic.return?

Background:

I'm currently working with 2.8.7 using a topic exchange to route between
rabbitmq instances. The federation looks like this:

client1 <--> master <--> client2

Maxhops is set to 1, and client1 and client2 don't have federation between
them.

Each routing key instance looks something like 'client1.xxx.yyy. or
'master.xxx.yyy', that is, the routing key contains the broker name that
the message is intended for.

If client1 attempts to write a message using 'client2.xxx.yyy', should I
expect to see the message returned to me or is it just dropped on the floor?

Thanks,

Matt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130102/7d6d9e03/attachment.htm>

From jerryk at rbcon.com  Thu Jan  3 01:51:47 2013
From: jerryk at rbcon.com (Jerry Kuch)
Date: Wed, 2 Jan 2013 17:51:47 -0800
Subject: [rabbitmq-discuss] RabbitMQ binary uses a ton of memory
In-Reply-To: <50E40A8B.1070206@rabbitmq.com>
References: <CAM9W9p2F9kBRb5KDjTKvM6u6hHdkJQTSARxZVR4+jCvnpGmLfg@mail.gmail.com>
	<50E40A8B.1070206@rabbitmq.com>
Message-ID: <CAE0Sz=x+=tryF+N1GJBFq8_txozB6PVKi8rW29GiWoSBEs0YhA@mail.gmail.com>

Jervis:

Also, since you're on Linux, IIRC, you can check out:

/proc/sys/net/ipv4/tcp_rmem
/proc/sys/net/ipv4/tcp_wmem

(or very similar to those paths, poke around /proc a bit and you should
find them).

Those should reveal the minimum, default and maximum memory size values
that Linux is going to choose/allow for these buffers.  Informed by those
numbers, you can fiddle with your tcp_listen_options as Matthias suggests.

Best regards,
Jerry
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130102/f3e5f05c/attachment.htm>

From meyer at paperplanes.de  Thu Jan  3 09:52:04 2013
From: meyer at paperplanes.de (Mathias Meyer)
Date: Thu, 3 Jan 2013 10:52:04 +0100
Subject: [rabbitmq-discuss] Automating a RabbitMQ 3.0 cluster on EC2
In-Reply-To: <loom.20121229T153535-125@post.gmane.org>
References: <9882557829464795BC4C6547C54DDED1@paperplanes.de>
	<87623rk7p0.wl%f@mazzo.li>
	<FCE85C15E7F94F3392318548DE2E6634@paperplanes.de>
	<loom.20121229T144749-15@post.gmane.org>
	<2E46CFA181E247DDAC9AB06CFBBC9720@paperplanes.de>
	<loom.20121229T153535-125@post.gmane.org>
Message-ID: <5AC741B1884E4BC1A6CFFC3565228BD1@paperplanes.de>

On Saturday, 29. December 2012 at 15:37, Francesco Mazzoli wrote:
> OK, I think I understand your issues better now: you?d like better tools to
> exist to setup clustering in an automated environment like Chef. Right now we
> don?t provide much in that space.
>  
> What we had in mind is something along the lines of ?take a declarative
> description of a cluster, e.g. ?I want a rabbit cluster consisting of four
> nodes, A,B,C,D. A & B shall be disk nodes, C & D ram nodes?, and try to convert
> that into a set of commands to execute on the four machines, with the commands
> being idempotent and execution order between machines being irrelevant.?. This
> sounds reasonable and not too hard to do. I can?t promise anything though :).
>  
That sounds like a great idea, and I'm all for it. In general it'd be great to have some more operational and automation knowledge collected in the documentation too.  
>  
> For what concerns now, things like
>  
> > join_cluster does fit my needs, but in an automated environment, e.g. with
> > Chef, that command would be triggered every 30 minutes. Would you consider
> > that a good practice to do?
> >  
>  
>  
> Are perfectly fine, you can easily check periodically if a node is clustered as
> you want and fix it if something is not of your liking. However be aware that
> `join_cluster' will leave the current cluster the node is in and thus reset the
> node, so act carefully.
>  
That sound reasonable. It's also why I like the configuration file approach though. It's a declarative approach and doesn't require any commands to be fired to e.g. check if the node is part of the cluster and make it join via join_cluster, when run via Chef, reducing resource overhead just a little bit :)

Thanks!

Cheers, Mathias

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130103/f6a1ee7a/attachment.htm>

From chalmersbrown92 at gmail.com  Thu Jan  3 05:20:12 2013
From: chalmersbrown92 at gmail.com (Chalmers Brown)
Date: Wed, 2 Jan 2013 21:20:12 -0800 (PST)
Subject: [rabbitmq-discuss] rabbitmq on remote server?
Message-ID: <ff4f57fd-b64f-4f8c-927a-1dffd82af6ed@googlegroups.com>

Is it possible to run rabbitmq on a remote server such as a web hosting 
account? If so, then how? Thanks!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130102/606b7c4f/attachment.htm>

From wmywipured at gmail.com  Thu Jan  3 06:57:13 2013
From: wmywipured at gmail.com (kevin)
Date: Wed, 2 Jan 2013 22:57:13 -0800 (PST)
Subject: [rabbitmq-discuss] rpc Tutorials why the server queue no need to
	binding
Message-ID: <bdef0421-6092-4fcf-98ed-e8e0e5ee3d9b@googlegroups.com>

Hi,
I am a newer for rabbitMQ,when i read the 
*Tutorials* <http://www.rabbitmq.com/getstarted.html> 6 rpc, i notice that 
client publish a message :channel.basicPublish("", "rpc_queue", props, 
message.getBytes());
1.  i check in the sdk,the second parameter is routing key,but explaination 
show: 
"The request is sent to an rpc_queue queue" ,it is correct? i think it will 
be sent to any queue?
 
 2. when the server receive this message ,why no need to binding?because it 
use default exchange?
 
anyone know the answer please kindly reply me as soon,thanks.
 
 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130102/f2527231/attachment.htm>

From sustrik at 250bpm.com  Thu Jan  3 11:08:33 2013
From: sustrik at 250bpm.com (Martin Sustrik)
Date: Thu, 03 Jan 2013 12:08:33 +0100
Subject: [rabbitmq-discuss]
 =?utf-8?q?Any_movement_on_RabbitMQ-=C3=98MQ=3F?=
In-Reply-To: <4c327716-f2f5-4c30-a8e8-160b14460296@googlegroups.com>
References: <4c327716-f2f5-4c30-a8e8-160b14460296@googlegroups.com>
Message-ID: <50E566B1.8020107@250bpm.com>

Hi Murray,

On 28/12/12 22:24, Murray Williams wrote:
> I'm trying to build some glue between a system that uses a low-level ?MQ
> implementation and some Enterprise (J2EE for the moment) frameworks, and
> I got excited when I read the blog about the RabbitMQ-?MQ plugin.
> Unfortunately, that plugin seems to depend on the older Erlang-?MQ
> (erlzmq) bindings instead of the newer erlzmq2 bindings, and the older
> bindings don't compile against my recent version of Erlang ("Driver
> compiled with incorrect version of erl_driver.h") so I'm stuck, unless I
> want to downgrade my system's Erlang version, but even if I did that,
> this would give me a very brittle solution.

Here's Martin Sustrik, one of the original authors or RMQ/0MQ plug-in.

I don't have time to look into the plugin at the moment, however, if you 
have any specific questions about it feel free to ask.

Martin

From videlalvaro at gmail.com  Thu Jan  3 11:11:20 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Thu, 3 Jan 2013 12:11:20 +0100
Subject: [rabbitmq-discuss] rpc Tutorials why the server queue no need
	to binding
In-Reply-To: <bdef0421-6092-4fcf-98ed-e8e0e5ee3d9b@googlegroups.com>
References: <bdef0421-6092-4fcf-98ed-e8e0e5ee3d9b@googlegroups.com>
Message-ID: <CAMcAHLXHHhMRxaH7T2G9L0CYO9gxDox_h3MhL+O=Vt2iNAPBCg@mail.gmail.com>

Hi,

Queues are always bound by default to the "unnamed" exchange and the
routing key is the queue name. That's why you can publish messages to the
exchange named "", using "rpc_queue" as routing key.

Regards,

Alvaro


On Thu, Jan 3, 2013 at 7:57 AM, kevin <wmywipured at gmail.com> wrote:

> Hi,
> I am a newer for rabbitMQ,when i read the
> *Tutorials* <http://www.rabbitmq.com/getstarted.html> 6 rpc, i notice
> that client publish a message :channel.basicPublish("", "rpc_queue", props
> , message.getBytes());
> 1.  i check in the sdk,the second parameter is routing key,but
> explaination show:
> "The request is sent to an rpc_queue queue" ,it is correct? i think it
> will be sent to any queue?
>
>  2. when the server receive this message ,why no need to binding?because
> it use default exchange?
>
> anyone know the answer please kindly reply me as soon,thanks.
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130103/05f6e835/attachment.htm>

From simon at rabbitmq.com  Thu Jan  3 11:12:47 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 03 Jan 2013 11:12:47 +0000
Subject: [rabbitmq-discuss] rpc Tutorials why the server queue no need
 to binding
In-Reply-To: <bdef0421-6092-4fcf-98ed-e8e0e5ee3d9b@googlegroups.com>
References: <bdef0421-6092-4fcf-98ed-e8e0e5ee3d9b@googlegroups.com>
Message-ID: <50E567AF.8030603@rabbitmq.com>

On 03/01/13 06:57, kevin wrote:
> # 2. when the server receive this message ,why no need to binding?because
> it use default exchange?

Yes. All queues are implicitly bound to the default exchange "" with 
their name as the routing key.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Jan  3 11:25:13 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 03 Jan 2013 11:25:13 +0000
Subject: [rabbitmq-discuss] Get A list of nodes in the RabbitMQ cluster
In-Reply-To: <45E7B334-76C7-4ED1-B3BE-60A1A45AE25A@rabbitmq.com>
References: <CAO6pa4TuU0S5zht44Dp4guhju1CwG1XCgv_-ShMQru7nOV4HGg@mail.gmail.com>
	<45E7B334-76C7-4ED1-B3BE-60A1A45AE25A@rabbitmq.com>
Message-ID: <50E56A99.3020506@rabbitmq.com>

Although if the OP wants to have clients which check on the cluster 
status at connection time, running rabbitmqctl is likely to be much 
uglier than enabling a plugin!

Jimi, although it's not automatic, you could manually set the 
server_properties configuration item on each node in the cluster. Your 
clients can then retrieve this after connecting.

Cheers, Simon

On 27/12/12 15:43, Tim Watson wrote:
> 'rabbitmqctl cluster_status' should do it
>
> On 27 Dec 2012, at 15:22, Jimi Riblei <newsjimi at gmail.com
> <mailto:newsjimi at gmail.com>> wrote:
>
>> Hello,
>> Which are the way for  get the list of nodes in the RabbitMQ cluster ?
>>
>> Currentely I'm using  :
>> curl -i -u guest:guest http://192.168.40.6:15672/api/nodes
>>
>>
>> I need to get the nodes for bind dynamically other machine without
>> have a "master".
>>
>> I'd like to don't install a plug-in!
>>
>>
>> Thank you!
>> J.
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Jan  3 11:32:58 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 03 Jan 2013 11:32:58 +0000
Subject: [rabbitmq-discuss] Additional fields returned via /api/overview?
In-Reply-To: <CACLE7izSWAQGR5O7_qJqMTkHMtjJTkveyRh1jXqSisJmYdL=Jw@mail.gmail.com>
References: <CACLE7iyNO4LFNUJq8Aqd_ZfZbWF9M=S_t3w4q+tvZ84SVkE7Dg@mail.gmail.com>
	<50DCF677.20809@rabbitmq.com>
	<CACLE7izSWAQGR5O7_qJqMTkHMtjJTkveyRh1jXqSisJmYdL=Jw@mail.gmail.com>
Message-ID: <50E56C6A.5080608@rabbitmq.com>

On 28/12/12 18:58, Matt Pietrek wrote:
> A tiny bit more background - I'm starting to write tooling that will
> work against both 2.8 and 3.0 versions, so I need to query which version
> of the server I'm talking to. I initially queried a 3.0.1 instance for
> /api/overview and found the "rabbitmq_version" element. Great! So I
> coded that up in my tooling, and was then surprised when I didn't find
> that element when querying a 2.8.7 instance.

2.8.x doesn't enforce that all your cluster nodes run the same Erlang / 
RabbitMQ versions (things just might break). So you have to check 
/api/nodes.

> Is this normal? Correct? Who knows? I have no schema reference to
> consult. :-)

Yeah, I guess this is missing documentation. Urgh. There's a ton of it...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From npmarks at gmail.com  Thu Jan  3 13:04:43 2013
From: npmarks at gmail.com (Nate Marks)
Date: Thu, 3 Jan 2013 08:04:43 -0500
Subject: [rabbitmq-discuss] rabbit starts failing when I set up freeipa
	client
Message-ID: <CAHM9UcGwoC3rL5FvpbS-fmWwH3EJbaf+UFSDNqOO65Nvuf-oEw@mail.gmail.com>

The problem is reversible (by uninstalling freeipa)  but I need to
troubleshoot the problem.  I get the following in my rabbit server log:
=WARNING REPORT==== 3-Jan-2013::12:54:40 ===
exception on TCP connection <0.3350.0> from 127.0.0.1:51207
connection_closed_abruptly

=INFO REPORT==== 3-Jan-2013::12:54:40 ===
closing TCP connection <0.3350.0> from 127.0.0.1:51207

=WARNING REPORT==== 3-Jan-2013::12:54:41 ===
exception on TCP connection <0.3315.0> from 127.0.0.1:51101
connection_closed_abruptly

=INFO REPORT==== 3-Jan-2013::12:54:41 ===
closing TCP connection <0.3315.0> from 127.0.0.1:51101

=INFO REPORT==== 3-Jan-2013::12:54:42 ===
stopped TCP Listener on [::]:5672

=INFO REPORT==== 3-Jan-2013::12:54:52 ===
    application: rabbit
    exited: stopped
    type: permanent

=INFO REPORT==== 3-Jan-2013::12:54:52 ===
    application: mnesia
    exited: stopped
    type: permanent

=INFO REPORT==== 3-Jan-2013::12:54:52 ===
    application: os_mon
    exited: stopped
    type: permanent


I can imagine that free ipa might possibly affect name resolution or
certificate, but I need to narrow it down.  Thanks in advance
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130103/c76c38ac/attachment.htm>

From simon at rabbitmq.com  Thu Jan  3 13:14:49 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 03 Jan 2013 13:14:49 +0000
Subject: [rabbitmq-discuss] rabbit starts failing when I set up freeipa
 client
In-Reply-To: <CAHM9UcGwoC3rL5FvpbS-fmWwH3EJbaf+UFSDNqOO65Nvuf-oEw@mail.gmail.com>
References: <CAHM9UcGwoC3rL5FvpbS-fmWwH3EJbaf+UFSDNqOO65Nvuf-oEw@mail.gmail.com>
Message-ID: <50E58449.7000005@rabbitmq.com>

What do you mean by "starts failing"? The log you posted shows RabbitMQ 
stopping - are you saying you did not stop it?

If so, is there anything in the SASL log?

Cheers, Simon

On 03/01/13 13:04, Nate Marks wrote:
> The problem is reversible (by uninstalling freeipa)  but I need to
> troubleshoot the problem.  I get the following in my rabbit server log:
> =WARNING REPORT==== 3-Jan-2013::12:54:40 ===
> exception on TCP connection <0.3350.0> from 127.0.0.1:51207
> <http://127.0.0.1:51207>
> connection_closed_abruptly
>
> =INFO REPORT==== 3-Jan-2013::12:54:40 ===
> closing TCP connection <0.3350.0> from 127.0.0.1:51207
> <http://127.0.0.1:51207>
>
> =WARNING REPORT==== 3-Jan-2013::12:54:41 ===
> exception on TCP connection <0.3315.0> from 127.0.0.1:51101
> <http://127.0.0.1:51101>
> connection_closed_abruptly
>
> =INFO REPORT==== 3-Jan-2013::12:54:41 ===
> closing TCP connection <0.3315.0> from 127.0.0.1:51101
> <http://127.0.0.1:51101>
>
> =INFO REPORT==== 3-Jan-2013::12:54:42 ===
> stopped TCP Listener on [::]:5672
>
> =INFO REPORT==== 3-Jan-2013::12:54:52 ===
>      application: rabbit
>      exited: stopped
>      type: permanent
>
> =INFO REPORT==== 3-Jan-2013::12:54:52 ===
>      application: mnesia
>      exited: stopped
>      type: permanent
>
> =INFO REPORT==== 3-Jan-2013::12:54:52 ===
>      application: os_mon
>      exited: stopped
>      type: permanent
>
>
> I can imagine that free ipa might possibly affect name resolution or
> certificate, but I need to narrow it down.  Thanks in advance
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Thu Jan  3 13:21:32 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 03 Jan 2013 13:21:32 +0000
Subject: [rabbitmq-discuss] rabbitmq on remote server?
In-Reply-To: <ff4f57fd-b64f-4f8c-927a-1dffd82af6ed@googlegroups.com>
References: <ff4f57fd-b64f-4f8c-927a-1dffd82af6ed@googlegroups.com>
Message-ID: <50E585DC.5000703@rabbitmq.com>


Hi,

On 03/01/13 05:20, Chalmers Brown wrote:
> Is it possible to run rabbitmq on a remote server such as a web hosting
> account? If so, then how? Thanks!

It depends on what kind of web hosting account your have. You will not
be able to run RabbitMQ on a web hosting service that does not allow
running Erlang applications.

If you have remote console access and you are able to open access to TCP
port 5672 for AMQP clients then you can follow the installation
instructions as if the server was local:
http://www.rabbitmq.com/download.html

If your infrastructure is provided by Amazon EC2 then these notes might
be helpful:
http://www.rabbitmq.com/ec2.html


-Emile




From npmarks at gmail.com  Thu Jan  3 13:25:22 2013
From: npmarks at gmail.com (Nate Marks)
Date: Thu, 3 Jan 2013 08:25:22 -0500
Subject: [rabbitmq-discuss] rabbit starts failing when I set up freeipa
	client
In-Reply-To: <50E58449.7000005@rabbitmq.com>
References: <CAHM9UcGwoC3rL5FvpbS-fmWwH3EJbaf+UFSDNqOO65Nvuf-oEw@mail.gmail.com>
	<50E58449.7000005@rabbitmq.com>
Message-ID: <CAHM9UcFz9F+6WTJmW+2w-TBZncB2WBuzqa_D8mPXK8Zf=ST3eA@mail.gmail.com>

sorry I was unclear.  you have it exactly.  the service stops as soon as it
starts.

On Thu, Jan 3, 2013 at 8:14 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> What do you mean by "starts failing"? The log you posted shows RabbitMQ
> stopping - are you saying you did not stop it?
>
> If so, is there anything in the SASL log?
>
> Cheers, Simon
>
>
> On 03/01/13 13:04, Nate Marks wrote:
>
>> The problem is reversible (by uninstalling freeipa)  but I need to
>> troubleshoot the problem.  I get the following in my rabbit server log:
>> =WARNING REPORT==== 3-Jan-2013::12:54:40 ===
>> exception on TCP connection <0.3350.0> from 127.0.0.1:51207
>> <http://127.0.0.1:51207>
>>
>> connection_closed_abruptly
>>
>> =INFO REPORT==== 3-Jan-2013::12:54:40 ===
>> closing TCP connection <0.3350.0> from 127.0.0.1:51207
>> <http://127.0.0.1:51207>
>>
>>
>> =WARNING REPORT==== 3-Jan-2013::12:54:41 ===
>> exception on TCP connection <0.3315.0> from 127.0.0.1:51101
>> <http://127.0.0.1:51101>
>>
>> connection_closed_abruptly
>>
>> =INFO REPORT==== 3-Jan-2013::12:54:41 ===
>> closing TCP connection <0.3315.0> from 127.0.0.1:51101
>> <http://127.0.0.1:51101>
>>
>>
>> =INFO REPORT==== 3-Jan-2013::12:54:42 ===
>> stopped TCP Listener on [::]:5672
>>
>> =INFO REPORT==== 3-Jan-2013::12:54:52 ===
>>      application: rabbit
>>      exited: stopped
>>      type: permanent
>>
>> =INFO REPORT==== 3-Jan-2013::12:54:52 ===
>>      application: mnesia
>>      exited: stopped
>>      type: permanent
>>
>> =INFO REPORT==== 3-Jan-2013::12:54:52 ===
>>      application: os_mon
>>      exited: stopped
>>      type: permanent
>>
>>
>> I can imagine that free ipa might possibly affect name resolution or
>> certificate, but I need to narrow it down.  Thanks in advance
>>
>>
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130103/96ab42e3/attachment.htm>

From simon at rabbitmq.com  Thu Jan  3 13:26:51 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 03 Jan 2013 13:26:51 +0000
Subject: [rabbitmq-discuss] rabbit starts failing when I set up freeipa
 client
In-Reply-To: <CAHM9UcFz9F+6WTJmW+2w-TBZncB2WBuzqa_D8mPXK8Zf=ST3eA@mail.gmail.com>
References: <CAHM9UcGwoC3rL5FvpbS-fmWwH3EJbaf+UFSDNqOO65Nvuf-oEw@mail.gmail.com>
	<50E58449.7000005@rabbitmq.com>
	<CAHM9UcFz9F+6WTJmW+2w-TBZncB2WBuzqa_D8mPXK8Zf=ST3eA@mail.gmail.com>
Message-ID: <50E5871B.2090904@rabbitmq.com>

And is there anything in the SASL log?

Cheers, Simon

On 03/01/13 13:25, Nate Marks wrote:
> sorry I was unclear.  you have it exactly.  the service stops as soon as
> it starts.
>
> On Thu, Jan 3, 2013 at 8:14 AM, Simon MacMullen <simon at rabbitmq.com
> <mailto:simon at rabbitmq.com>> wrote:
>
>     What do you mean by "starts failing"? The log you posted shows
>     RabbitMQ stopping - are you saying you did not stop it?
>
>     If so, is there anything in the SASL log?
>
>     Cheers, Simon
>
>
>     On 03/01/13 13:04, Nate Marks wrote:
>
>         The problem is reversible (by uninstalling freeipa)  but I need to
>         troubleshoot the problem.  I get the following in my rabbit
>         server log:
>         =WARNING REPORT==== 3-Jan-2013::12:54:40 ===
>         exception on TCP connection <0.3350.0> from 127.0.0.1:51207
>         <http://127.0.0.1:51207>
>         <http://127.0.0.1:51207>
>
>         connection_closed_abruptly
>
>         =INFO REPORT==== 3-Jan-2013::12:54:40 ===
>         closing TCP connection <0.3350.0> from 127.0.0.1:51207
>         <http://127.0.0.1:51207>
>         <http://127.0.0.1:51207>
>
>
>         =WARNING REPORT==== 3-Jan-2013::12:54:41 ===
>         exception on TCP connection <0.3315.0> from 127.0.0.1:51101
>         <http://127.0.0.1:51101>
>         <http://127.0.0.1:51101>
>
>         connection_closed_abruptly
>
>         =INFO REPORT==== 3-Jan-2013::12:54:41 ===
>         closing TCP connection <0.3315.0> from 127.0.0.1:51101
>         <http://127.0.0.1:51101>
>         <http://127.0.0.1:51101>
>
>
>         =INFO REPORT==== 3-Jan-2013::12:54:42 ===
>         stopped TCP Listener on [::]:5672
>
>         =INFO REPORT==== 3-Jan-2013::12:54:52 ===
>               application: rabbit
>               exited: stopped
>               type: permanent
>
>         =INFO REPORT==== 3-Jan-2013::12:54:52 ===
>               application: mnesia
>               exited: stopped
>               type: permanent
>
>         =INFO REPORT==== 3-Jan-2013::12:54:52 ===
>               application: os_mon
>               exited: stopped
>               type: permanent
>
>
>         I can imagine that free ipa might possibly affect name resolution or
>         certificate, but I need to narrow it down.  Thanks in advance
>
>
>         _________________________________________________
>         rabbitmq-discuss mailing list
>         rabbitmq-discuss at lists.__rabbitmq.com
>         <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>         https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss
>         <https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
>
>
>     --
>     Simon MacMullen
>     RabbitMQ, VMware
>
>


-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Thu Jan  3 13:53:14 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 03 Jan 2013 13:53:14 +0000
Subject: [rabbitmq-discuss] Migrating from MSMQ:Identifying queue
	features
In-Reply-To: <f261250a-682e-4223-ac50-b42e06efb404@googlegroups.com>
References: <f261250a-682e-4223-ac50-b42e06efb404@googlegroups.com>
Message-ID: <50E58D4A.90300@rabbitmq.com>



Hi,

On 02/01/13 16:59, mabra wrote:
> I have several apps A, which generates messages with expiration time
> of about 2 hours. I have several apps B, which evals these Messages.
> They are sometimes running, sometimes not.

It is possible to define per-queue or per-message timeouts:
http://www.rabbitmq.com/ttl.html

> Usually the B type is running permanently and in normal operation, it
> reads each message, but does this by peek-ing the the queue and leave
> them in the queue.

It is possible to dequeue and requeue a message, which is similar to
peeking at the head of the queue. Bear in mind that repeating this
operation in the absence of other consumers will lead to the same
message being observed.

For rejecting using the .net client see
http://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v3.0.1/rabbitmq-dotnet-client-3.0.1-client-htmldoc/html/type-RabbitMQ.Client.IModel.html#method-M:RabbitMQ.Client.IModel.BasicReject%28System.UInt64,System.Boolean%29

Using rejection of messages to implement message selection in consumers
is not recommended. If different consumers (app B) process different
messages then you are advised to route message based on that difference
so that consumers only ever observe messages that they are able to process.

> With MSMQ, each message has a unique id, so, if my app restarts, it
> can just peek tha last message it has been processsed and then
> continue peeking the remaining messages.

Publishers (app A) could add a unique ID to messages in a header when
publishing which can be used in the same way.

> I concurrent to the B app, on demand another B is comming to the
> same queue, evealuating the same messages with our rules.

It is possible for multiple consumers to read from the same queue. See
tutorial 2:
http://www.rabbitmq.com/tutorials/tutorial-two-java.html

> The is probbaly more a CEP app with a fast temporary store [to avoid 
> databases]. This works exceptionally fast with MSMQ and I am abel to
> read more then 15k messages/s.

RabbitMQ is generally able to exceed that frequency, though it depends
greatly on consumers keeping up, the messaging pattern and hardware
being employed.

For notes about performance see these blog posts:
http://www.rabbitmq.com/blog/2012/04/17/rabbitmq-performance-measurements-part-1/
http://www.rabbitmq.com/blog/2012/04/25/rabbitmq-performance-measurements-part-2/

> A good note, hint or ref to a doc or something could really help me a
> lot. I am using C#/mono.

You may find this book of interest:
http://manning.com/videla/

RabbitMQ has ships with a mature C# client:
http://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v3.0.1/rabbitmq-dotnet-client-3.0.1-user-guide.pdf



-Emile





From chalmersbrown92 at gmail.com  Thu Jan  3 15:03:10 2013
From: chalmersbrown92 at gmail.com (Chalmers Brown)
Date: Thu, 3 Jan 2013 10:03:10 -0500
Subject: [rabbitmq-discuss] rabbitmq on remote server?
In-Reply-To: <50E585DC.5000703@rabbitmq.com>
References: <ff4f57fd-b64f-4f8c-927a-1dffd82af6ed@googlegroups.com>
	<50E585DC.5000703@rabbitmq.com>
Message-ID: <CAKNxOyAjSP+ZNrEcxLbyH_48TKgLutWJEtCehCaAk6g_HAWMJw@mail.gmail.com>

What is the best option ( or a really good option ) for running rabbitMQ
remotely? This question is kinda for any application I would like to
install remotely. I have started to learn how to use things such as
MongoDB, Node.js, etc. but I am only able to install and play with them
locally, so I need a good remote solution. Hopefully that all makes sense
lol Thanks for your help!

Sincerely,
Chalmers Brown
Pre-Med and Computer Science Major, Chemistry Minor
Rutgers, The State University of New Jersey, Class of 2014


On Thu, Jan 3, 2013 at 8:21 AM, Emile Joubert <emile at rabbitmq.com> wrote:

>
> Hi,
>
> On 03/01/13 05:20, Chalmers Brown wrote:
> > Is it possible to run rabbitmq on a remote server such as a web hosting
> > account? If so, then how? Thanks!
>
> It depends on what kind of web hosting account your have. You will not
> be able to run RabbitMQ on a web hosting service that does not allow
> running Erlang applications.
>
> If you have remote console access and you are able to open access to TCP
> port 5672 for AMQP clients then you can follow the installation
> instructions as if the server was local:
> http://www.rabbitmq.com/download.html
>
> If your infrastructure is provided by Amazon EC2 then these notes might
> be helpful:
> http://www.rabbitmq.com/ec2.html
>
>
> -Emile
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130103/b260710b/attachment.htm>

From murraytodd at gmail.com  Thu Jan  3 15:50:45 2013
From: murraytodd at gmail.com (Murray Williams)
Date: Thu, 3 Jan 2013 10:50:45 -0500
Subject: [rabbitmq-discuss]
	=?utf-8?q?Any_movement_on_RabbitMQ-=C3=98MQ=3F?=
In-Reply-To: <50E566B1.8020107@250bpm.com>
References: <4c327716-f2f5-4c30-a8e8-160b14460296@googlegroups.com>
	<50E566B1.8020107@250bpm.com>
Message-ID: <CACDmYq9gGkiMfGQGSO+0h1DBFCFqBaM=vELdLPPMB1mjsAEv4g@mail.gmail.com>

On Thu, Jan 3, 2013 at 6:08 AM, Martin Sustrik <sustrik at 250bpm.com> wrote:

> Hi Murray,
>
> On 28/12/12 22:24, Murray Williams wrote:
>
>> I'm trying to build some glue between a system that uses a low-level ?MQ
>> implementation and some Enterprise (J2EE for the moment) frameworks, and
>> I got excited when I read the blog about the RabbitMQ-?MQ plugin.
>> Unfortunately, that plugin seems to depend on the older Erlang-?MQ
>> (erlzmq) bindings instead of the newer erlzmq2 bindings, and the older
>> bindings don't compile against my recent version of Erlang ("Driver
>> compiled with incorrect version of erl_driver.h") so I'm stuck, unless I
>> want to downgrade my system's Erlang version, but even if I did that,
>> this would give me a very brittle solution.
>>
>
> Here's Martin Sustrik, one of the original authors or RMQ/0MQ plug-in.
>
> I don't have time to look into the plugin at the moment, however, if you
> have any specific questions about it feel free to ask.
>
> Martin
>

Ah hello! Excellent!

In fact, I've been working pretty hard at seeing if I could bring that code
up to date. (And, in the process, I'm reading *Erlang and OTP in Action!* so
I'm not completely in the dark here.) I started by creating a brand new
RabbitMQ plugin?using the rabbitmq-metronome as an example, since I'm
guessing/hoping it follows the most current plugin conventions for RabbitmQ
3.x. I created each module from scratch and copied your original functions
one-by-one so I could examine them and catch-and-change the older zmq:
calls and update them to the newer Erlzmq2 APIs. (That's not very hard. The
biggest change is that you have to create a "context" and pass it to the
calls that create ?MQ sockets. Also, "upstream" and "downstream" names were
changed to "push" and "pull".)

Everything compiles, and I can install and enable the plugin, but right now
it looks like the supervisor keeps shutting down for some reason that I
can't quite figure out yet. Part of it is just that I don't quite
understand the various init and start_link conventions for gen_server?that
will come in due time. The other thing is that I don't know how the
configuration information information makes it to the supervisor. I thought
it was being passed as the arguments in the application's start/2 call, but
that looks like it's being called with an empty list. (Maybe that's how
things worked with the older versions of RabbitMQ? It's hard to know since
there isn't much plugin documentation out there.)

Looking at rabbitmq-stomp, I'm guessing that actually entries in the
rabbit.config are supposed to update/replace elements in the .app.src
file's {env, []} element, and that I need to write code to extract all that
stuff from the environment. I was going to tackle playing with that today.

Does any of the above make sense? If you have any pieces of advice, I'd
love to hear any pointers. Also, I'll get everything I've done up on my
github fork soon.

Thanks,

Murray

P.S. Being new to Erlang, I'm completely confused when I look at r0mq_sup's
full_address(Address) functions. Hopefully it'll just work in place, but I
would love it if you could just tell me what exactly it's trying to
validate, especially the part where the io_lib:char_list(Address) test
fails. Is that suggesting that the ipv4 address is in a packed (4-byte)
representation as opposed to being written out in ascii characters?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130103/5d2a4856/attachment.htm>

From simon at rabbitmq.com  Thu Jan  3 16:13:44 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 03 Jan 2013 16:13:44 +0000
Subject: [rabbitmq-discuss]
 =?windows-1252?q?Any_movement_on_RabbitMQ-=D8M?=
 =?windows-1252?q?Q=3F?=
In-Reply-To: <CACDmYq9gGkiMfGQGSO+0h1DBFCFqBaM=vELdLPPMB1mjsAEv4g@mail.gmail.com>
References: <4c327716-f2f5-4c30-a8e8-160b14460296@googlegroups.com>
	<50E566B1.8020107@250bpm.com>
	<CACDmYq9gGkiMfGQGSO+0h1DBFCFqBaM=vELdLPPMB1mjsAEv4g@mail.gmail.com>
Message-ID: <50E5AE38.8000700@rabbitmq.com>

On 03/01/13 15:50, Murray Williams wrote:
> In fact, I've been working pretty hard at seeing if I could bring that
> code up to date.

Cool! I did not touch the 0mq plugin, but here are some half-answers...

  (And, in the process, I'm reading /Erlang and OTP in
> Action!/ so I'm not completely in the dark here.) I started by creating
> a brand new RabbitMQ plugin?using the rabbitmq-metronome as an example,
> since I'm guessing/hoping it follows the most current plugin conventions
> for RabbitmQ 3.x.

Yes it does.

> Everything compiles, and I can install and enable the plugin, but right
> now it looks like the supervisor keeps shutting down for some reason
> that I can't quite figure out yet.

If you point me at the source I might be able to help.

> Part of it is just that I don't quite
> understand the various init and start_link conventions for
> gen_server?that will come in due time. The other thing is that I don't
> know how the configuration information information makes it to the
> supervisor. I thought it was being passed as the arguments in the
> application's start/2 call, but that looks like it's being called with
> an empty list.

That's a generic way to pass arguments to a new process, part of OTP.

> (Maybe that's how things worked with the older versions
> of RabbitMQ? It's hard to know since there isn't much plugin
> documentation out there.)
>
> Looking at rabbitmq-stomp, I'm guessing that actually entries in the
> rabbit.config are supposed to update/replace elements in the .app.src
> file's {env, []} element, and that I need to write code to extract all
> that stuff from the environment. I was going to tackle playing with that
> today.

...but yes, to read from the config file, use application:get_env/2. 
This hasn't changed in Rabbit versions.

> P.S. Being new to Erlang, I'm completely confused when I look at
> r0mq_sup's full_address(Address) functions. Hopefully it'll just work in
> place, but I would love it if you could just tell me what exactly it's
> trying to validate, especially the part where
> the io_lib:char_list(Address) test fails.

AFAICS that looks like full_address/1 can also take a list of addresses. 
So the io_lib:char_list/1 test is testing whether you have a 
string-implemented-as-list-of-integers, or a list of addresses.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Jan  3 16:21:21 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 03 Jan 2013 16:21:21 +0000
Subject: [rabbitmq-discuss] Returned messages when Federation in effect?
In-Reply-To: <CACLE7ixv65x8=aH11NejLoj=u1Twd-idYnCo+GXLkkAOjL=CFg@mail.gmail.com>
References: <CACLE7ixv65x8=aH11NejLoj=u1Twd-idYnCo+GXLkkAOjL=CFg@mail.gmail.com>
Message-ID: <50E5B001.5040807@rabbitmq.com>

On 02/01/13 21:39, Matt Pietrek wrote:
> I imagine this is already answered somewhere, but I can't seem to locate
> a concise answer.
>
> if a client publishes a messages using a routing key that doesn't
> resolve to anywhere reachable, should the message be returned to the
> client via basic.return?

Yes. Ish.

Since the bindings get propagated upstream, it should be the case that 
if a message won't get routed, you'll find out about it.

However, note that in the single broker / cluster case, this happens 
immediately - as soon as you unbind a queue from an exchange you will 
start to get basic.returns for messages that would no longer be routed. 
Due to the eventually consistent nature of federation, you're not 
guaranteed this will happen immediately.

Also note that there were bugs in the pre-3.0.0 binding propagation code 
which could cause bindings to never be removed upstream.

Cheers, Simon

>
> Background:
>
> I'm currently working with 2.8.7 using a topic exchange to route between
> rabbitmq instances. The federation looks like this:
>
> client1 <--> master <--> client2
>
> Maxhops is set to 1, and client1 and client2 don't have federation
> between them.
>
> Each routing key instance looks something like 'client1.xxx.yyy. or
> 'master.xxx.yyy', that is, the routing key contains the broker name that
> the message is intended for.
>
> If client1 attempts to write a message using 'client2.xxx.yyy', should I
> expect to see the message returned to me or is it just dropped on the floor?
>
> Thanks,
>
> Matt
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Thu Jan  3 16:43:21 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 03 Jan 2013 16:43:21 +0000
Subject: [rabbitmq-discuss] rabbitmq on remote server?
In-Reply-To: <CAKNxOyAjSP+ZNrEcxLbyH_48TKgLutWJEtCehCaAk6g_HAWMJw@mail.gmail.com>
References: <ff4f57fd-b64f-4f8c-927a-1dffd82af6ed@googlegroups.com>
	<50E585DC.5000703@rabbitmq.com>
	<CAKNxOyAjSP+ZNrEcxLbyH_48TKgLutWJEtCehCaAk6g_HAWMJw@mail.gmail.com>
Message-ID: <50E5B529.1030201@rabbitmq.com>

Hi Chalmers,

On 03/01/13 15:03, Chalmers Brown wrote:
> What is the best option ( or a really good option ) for running rabbitMQ
> remotely?

I'm not in a position to recommend hosting providers, but depending on
what you are trying to achieve you might consider CloudFoundry:
http://docs.cloudfoundry.com/services/rabbitmq/rabbitmq.html
http://blog.cloudfoundry.com/2011/08/09/rabbitmq-cloud-foundry-cloud-messaging-that-just-works/

Any hosting provider that allows you to install and run Erlang apps and
open ports will work though.

-Emile







From scotta1white at gmail.com  Thu Jan  3 20:21:14 2013
From: scotta1white at gmail.com (Scott White)
Date: Thu, 3 Jan 2013 14:21:14 -0600
Subject: [rabbitmq-discuss] Mirrored queue with federation possible?
Message-ID: <CAPZTcDoyhDBKF55C8LS_gYi-E_3RexDxv0CUM-pi2FGKNxLW3A@mail.gmail.com>

Hi,

Is it possible to setup two separate clusters with mirrored queues in each
cluster, and then federate the mirrored queues to other cluster
symmetrically?

I was attempting to configure this, but noticed that only one
policy can apply to an exchange/queue at a time.

Is it possible to federate a mirrored queue?  Or should shovel be used
instead?

Regards,

Scott
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130103/bbed2d4d/attachment.htm>

From murraytodd at gmail.com  Thu Jan  3 22:04:57 2013
From: murraytodd at gmail.com (Murray Williams)
Date: Thu, 3 Jan 2013 17:04:57 -0500
Subject: [rabbitmq-discuss]
	=?utf-8?q?Any_movement_on_RabbitMQ-=C3=98MQ=3F?=
In-Reply-To: <50E5AE38.8000700@rabbitmq.com>
References: <4c327716-f2f5-4c30-a8e8-160b14460296@googlegroups.com>
	<50E566B1.8020107@250bpm.com>
	<CACDmYq9gGkiMfGQGSO+0h1DBFCFqBaM=vELdLPPMB1mjsAEv4g@mail.gmail.com>
	<50E5AE38.8000700@rabbitmq.com>
Message-ID: <CACDmYq-sKQJBAfRcOyj+g=GYbNuCMoQzoF8cJq=BnttSOz91eg@mail.gmail.com>

On Thu, Jan 3, 2013 at 11:13 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 03/01/13 15:50, Murray Williams wrote:
>
>> Everything compiles, and I can install and enable the plugin, but right
>> now it looks like the supervisor keeps shutting down for some reason
>> that I can't quite figure out yet.
>>
>
> If you point me at the source I might be able to help.



Okay, I've made some progress since this morning?but at this point I'm
completely gobsmacked as to what might be going on. I forked the github
rabitmq/rmq-0mq repository and then remote-pulled and merged the commits
from Luis Rasc?o's outstanding pull request (
https://github.com/lrascao/rmq-0mq), and then re-did the work I'd done
before replacing the erlzmq (zmq:) API calls with erlzmq2 (erlzmq:) calls.

You can see my work at https://github.com/murraytodd/rmq-0mq

I can actually build and deploy the plugin, and things appear to be
starting up, but I'm getting an error in the strangest of places: not from
the *zeromq* part but rather from the aqmp_client. Specifically, my
r0mq_service.erl file at line 43 calls:

 {ok, Connection} = amqp_connection:start(*#amqp_params_direct{}*)

and my RabbitMQ server crashes at amqp_connection_sup.erl line 34:

        case AmqpParams of
            *#amqp_params_direct{}*  -> {direct,  amqp_direct_connection};
            #amqp_params_network{} -> {network, amqp_network_connection}
        end,

with a server response of

{{*badmatch*,
  {error,
    {'EXIT',
      {{case_clause,
        {amqp_params_direct,<<"guest">>,none, <<"/">>,'Thor at thor',none,[]}},
          [{amqp_connection_sup,start_link,1,
           [{file,"src/amqp_connection_sup.erl"},{line,34}]},

My RabbitMQ installation (MacPorts) says it's v 2.8.7 and the plugins
directory says it has amqp_client-2.8.7.ez in it. But it seems that the
rabbit-public-unbrella repository, whether I use the "default / stable"
branch or even the branch marked "rabbitmq_v2_8_x", I find that the
amqp_client.hrl include file has an extra "password" field for the
amqp_params_direct record.

Do you have any idea what might be going on? Do you think it's my MacPorts
version of RabbitMQ?

Cheers,

Murray
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130103/d6c7a74d/attachment.htm>

From shawn.smith at gengo.com  Thu Jan  3 22:26:15 2013
From: shawn.smith at gengo.com (Shawn Smith)
Date: Fri, 4 Jan 2013 07:26:15 +0900
Subject: [rabbitmq-discuss] Error: unable to connect to node rabbit@rabbit1:
	nodedown
Message-ID: <CABWKhpBd=p017MVwo7Tg5prv3bX47MZwA8022G_dhRnAA9R=Yg@mail.gmail.com>

Hi,

I can't cluster two rabbit nodes running on EC2. I've gone through the
troubleshooting docs as well as done quite a bit of Googling.

The EC2 firewalls are allowing all TCP traffic. When I run `sudo
rabbitmqctl -n rabbit at rabbit1 status` from the second node (rabbit2), I see
this:

ubuntu at second_rabbit:~$ sudo rabbitmqctl -n rabbit at rabbit1 status
Status of node rabbit at rabbit1 ...
Error: unable to connect to node rabbit at rabbit1: nodedown

DIAGNOSTICS
===========

nodes in question: [rabbit at rabbit1]

hosts, their running nodes and ports:
- rabbit1: [{rabbit,51588}]

current node details:
- node name: 'rabbitmqctl9276 at second_rabbit'
- home dir: /var/lib/rabbitmq
- cookie hash: XDJW5BX8HtadjBvTgWRdXw==

The Erlang cookies in /var/lib/rabbitmq/.erlang.cookie are the same.

I've added the IPs and hosts to /etc/hosts like so:

[on rabbit1]:

127.0.0.1 localhost
127.0.0.1 rabbit1
[rabbit2's IP] rabbit2

[on rabbit2]:

127.0.0.1 localhost
127.0.0.1 rabbit2
[rabbit1's IP] rabbit1

I can telnet from rabbit2 to rabbit1 ports 5672 and 4369.

Can anyone help me out or point me at some docs?

Best,
Shawn
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130104/676b390e/attachment.htm>

From shawn.smith at gengo.com  Thu Jan  3 22:29:06 2013
From: shawn.smith at gengo.com (Shawn Smith)
Date: Fri, 4 Jan 2013 07:29:06 +0900
Subject: [rabbitmq-discuss] Typos in clustering docs
Message-ID: <CABWKhpBCMv8VhPesWp-Q+5kC1OUMzqKicX0Onzq_poSWv=XFrg@mail.gmail.com>

Hi, I found some typos in the clustering docs:

http://www.rabbitmq.com/clustering.html

Sixth paragraph down:

"However, not that..." => "However, note that..."

"reccomended" => "recommended"

Best,
Shawn
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130104/be150290/attachment.htm>

From simon at rabbitmq.com  Thu Jan  3 22:35:01 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 03 Jan 2013 22:35:01 +0000
Subject: [rabbitmq-discuss]
 =?utf-8?q?Any_movement_on_RabbitMQ-=C3=98MQ=3F?=
In-Reply-To: <CACDmYq-sKQJBAfRcOyj+g=GYbNuCMoQzoF8cJq=BnttSOz91eg@mail.gmail.com>
References: <4c327716-f2f5-4c30-a8e8-160b14460296@googlegroups.com>
	<50E566B1.8020107@250bpm.com>
	<CACDmYq9gGkiMfGQGSO+0h1DBFCFqBaM=vELdLPPMB1mjsAEv4g@mail.gmail.com>
	<50E5AE38.8000700@rabbitmq.com>
	<CACDmYq-sKQJBAfRcOyj+g=GYbNuCMoQzoF8cJq=BnttSOz91eg@mail.gmail.com>
Message-ID: <50E60795.6080707@rabbitmq.com>

On 03/01/2013 10:04PM, Murray Williams wrote:
> My RabbitMQ installation (MacPorts) says it's v 2.8.7 and the plugins
> directory says it has amqp_client-2.8.7.ez in it. But it seems that the
> rabbit-public-unbrella repository, whether I use the "default / stable"
> branch or even the branch marked "rabbitmq_v2_8_x", I find that the
> amqp_client.hrl include file has an extra "password" field for the
> amqp_params_direct record.

You are on the right track here; it's to do with building against the 
wrong version of the Erlang client. You do need rabbitmq_v2_8_x - 
"stable" is 3.0.x and "default" will be 3.1.0.

However - the rabbitmq-public-umbrella repo contains a load of 
sub-repositories, including the Erlang client. If you just changed 
branch with "hg up -r rabbitmq_v2_8_x" that will only change the 
umbrella. Try "make up_c BRANCH=rabbitmq_v2_8_x".

Cheers, Simon

From shawn.smith at gengo.com  Thu Jan  3 22:49:40 2013
From: shawn.smith at gengo.com (Shawn Smith)
Date: Fri, 4 Jan 2013 07:49:40 +0900
Subject: [rabbitmq-discuss] Error: unable to connect to node
	rabbit@rabbit1: nodedown
In-Reply-To: <CABWKhpBd=p017MVwo7Tg5prv3bX47MZwA8022G_dhRnAA9R=Yg@mail.gmail.com>
References: <CABWKhpBd=p017MVwo7Tg5prv3bX47MZwA8022G_dhRnAA9R=Yg@mail.gmail.com>
Message-ID: <CABWKhpASXd-Jv=gdinnDVGnoz-O-nK2pjrFK6bbPXUHhjXVVxg@mail.gmail.com>

I believe this was a problem with hostnames (I added entries to /etc/hosts
but did not change hostnames on the actual machines. Did not know it
mattered.)

The cluster appears to work now.

Thanks,
Shawn

On Fri, Jan 4, 2013 at 7:26 AM, Shawn Smith <shawn.smith at gengo.com> wrote:

> Hi,
>
> I can't cluster two rabbit nodes running on EC2. I've gone through the
> troubleshooting docs as well as done quite a bit of Googling.
>
> The EC2 firewalls are allowing all TCP traffic. When I run `sudo
> rabbitmqctl -n rabbit at rabbit1 status` from the second node (rabbit2), I
> see this:
>
> ubuntu at second_rabbit:~$ sudo rabbitmqctl -n rabbit at rabbit1 status
> Status of node rabbit at rabbit1 ...
> Error: unable to connect to node rabbit at rabbit1: nodedown
>
> DIAGNOSTICS
> ===========
>
> nodes in question: [rabbit at rabbit1]
>
> hosts, their running nodes and ports:
> - rabbit1: [{rabbit,51588}]
>
> current node details:
> - node name: 'rabbitmqctl9276 at second_rabbit'
> - home dir: /var/lib/rabbitmq
> - cookie hash: XDJW5BX8HtadjBvTgWRdXw==
>
> The Erlang cookies in /var/lib/rabbitmq/.erlang.cookie are the same.
>
> I've added the IPs and hosts to /etc/hosts like so:
>
> [on rabbit1]:
>
> 127.0.0.1 localhost
> 127.0.0.1 rabbit1
> [rabbit2's IP] rabbit2
>
> [on rabbit2]:
>
> 127.0.0.1 localhost
> 127.0.0.1 rabbit2
> [rabbit1's IP] rabbit1
>
> I can telnet from rabbit2 to rabbit1 ports 5672 and 4369.
>
> Can anyone help me out or point me at some docs?
>
> Best,
> Shawn
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130104/0845c703/attachment.htm>

From murraytodd at gmail.com  Thu Jan  3 22:52:58 2013
From: murraytodd at gmail.com (Murray Williams)
Date: Thu, 3 Jan 2013 17:52:58 -0500
Subject: [rabbitmq-discuss]
	=?utf-8?q?Any_movement_on_RabbitMQ-=C3=98MQ=3F?=
In-Reply-To: <50E60795.6080707@rabbitmq.com>
References: <4c327716-f2f5-4c30-a8e8-160b14460296@googlegroups.com>
	<50E566B1.8020107@250bpm.com>
	<CACDmYq9gGkiMfGQGSO+0h1DBFCFqBaM=vELdLPPMB1mjsAEv4g@mail.gmail.com>
	<50E5AE38.8000700@rabbitmq.com>
	<CACDmYq-sKQJBAfRcOyj+g=GYbNuCMoQzoF8cJq=BnttSOz91eg@mail.gmail.com>
	<50E60795.6080707@rabbitmq.com>
Message-ID: <CACDmYq8L7npLWkU7YGzi2v+rC_vVYqJyqYTnETtD3VWNBVbdRw@mail.gmail.com>

On Thu, Jan 3, 2013 at 5:35 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 03/01/2013 10:04PM, Murray Williams wrote:
>
>> My RabbitMQ installation (MacPorts) says it's v 2.8.7 and the plugins
>> directory says it has amqp_client-2.8.7.ez in it. But it seems that the
>> rabbit-public-unbrella repository, whether I use the "default / stable"
>> branch or even the branch marked "rabbitmq_v2_8_x", I find that the
>> amqp_client.hrl include file has an extra "password" field for the
>> amqp_params_direct record.
>>
>
> You are on the right track here; it's to do with building against the
> wrong version of the Erlang client. You do need rabbitmq_v2_8_x - "stable"
> is 3.0.x and "default" will be 3.1.0.
>
> However - the rabbitmq-public-umbrella repo contains a load of
> sub-repositories, including the Erlang client. If you just changed branch
> with "hg up -r rabbitmq_v2_8_x" that will only change the umbrella. Try
> "make up_c BRANCH=rabbitmq_v2_8_x".
>

Interestingly, the cowboy-wrapper repository is lacking a tag for
rabbitmq_v2_8_x, so things briefly stalled with an error there. I temporary
relocated that sub-repo and things were able to date. The include .hrl file
looks right now. It's reaching the end of the day, but I'll pick things up
tomorrow.

Thanks,

Murray
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130103/f0831f65/attachment.htm>

From evasilchenko at groupcommerce.com  Thu Jan  3 23:32:07 2013
From: evasilchenko at groupcommerce.com (Eugene Vasilchenko)
Date: Thu, 3 Jan 2013 15:32:07 -0800 (PST)
Subject: [rabbitmq-discuss] Can someone please confirm the clustered
 durable queue behavior?
In-Reply-To: <fcdf1ea5-2224-43f2-9243-91ffefbbeaab@googlegroups.com>
References: <fcdf1ea5-2224-43f2-9243-91ffefbbeaab@googlegroups.com>
Message-ID: <15f9121d-e675-4669-a461-b410a46cf7e5@googlegroups.com>

In case someone stumbles here looking for an answer. (Not sure why it 
wasn't posted here)

Thanks to Matthias the answer is as follows:

The old master rejoins the cluster as a slave with an empty and 
unsynchronized queue and catches up to the current master. This is of 
course unless all nodes go down, then the last disc node to go down should 
be brought back up in order to get the messages that were persisted to disc.



On Friday, December 28, 2012 1:17:36 PM UTC-5, Eugene Vasilchenko wrote:
>
> We are planning on using RabbitMQ extensively and I am writing some 
> documentation right now so I just wanted to confirm something. Let's say I 
> have a cluster of 3 machines running rabbit. All of my queues are durable 
> and the node with the master durable queue dies. A new master is chosen and 
> life goes on. Well, what happens when this old master rejoins the cluster? 
> From what I understand is that it just gets a new empty slave copy and just 
> drains the old master queue of messages until it's empty? Am I way off base 
> here?
>
> Thanks a lot for your help.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130103/ab268541/attachment.htm>

From pablomolnar at gmail.com  Thu Jan  3 23:42:44 2013
From: pablomolnar at gmail.com (Pablo Molnar)
Date: Thu, 3 Jan 2013 20:42:44 -0300
Subject: [rabbitmq-discuss] =?windows-1252?q?Using_RabbitMQ_at_the_World?=
	=?windows-1252?q?=92s_8th_Largest_Retailer?=
Message-ID: <CANVSfpJkCkoJ7_gdyf7+wFrPNbuu-KCnRZnmZWQba18XPWefUQ@mail.gmail.com>

Hey all,

Let me share you a blog post that I wrote explaining how we are using
RabbitMQ in MercadoLibre.

http://blogs.vmware.com/vfabric/2013/01/messaging-architecture-using-rabbitmq-at-the-worlds-8th-largest-retailer.html?utm_source=rss&utm_medium=rss&utm_campaign=messaging-architecture-using-rabbitmq-at-the-worlds-8th-largest-retailer

Hope you find it of interest.

Cheers,
Pablo
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130103/52468770/attachment.htm>

From wmywipured at gmail.com  Fri Jan  4 01:36:32 2013
From: wmywipured at gmail.com (kevin)
Date: Thu, 3 Jan 2013 17:36:32 -0800 (PST)
Subject: [rabbitmq-discuss] rpc Tutorials why the server queue no need
 to binding
In-Reply-To: <CAMcAHLXHHhMRxaH7T2G9L0CYO9gxDox_h3MhL+O=Vt2iNAPBCg@mail.gmail.com>
References: <bdef0421-6092-4fcf-98ed-e8e0e5ee3d9b@googlegroups.com>
	<CAMcAHLXHHhMRxaH7T2G9L0CYO9gxDox_h3MhL+O=Vt2iNAPBCg@mail.gmail.com>
Message-ID: <b07b9d1f-a662-4c28-afa4-20f67987de5f@googlegroups.com>

thanks:)
 

? 2013?1?3????UTC+8??7?11?20??Alvaro Videla???

> Hi, 
>
> Queues are always bound by default to the "unnamed" exchange and the 
> routing key is the queue name. That's why you can publish messages to the 
> exchange named "", using "rpc_queue" as routing key.
>
> Regards,
>
> Alvaro
>
>
> On Thu, Jan 3, 2013 at 7:57 AM, kevin <wmywi... at gmail.com <javascript:>>wrote:
>
>> Hi,
>> I am a newer for rabbitMQ,when i read the 
>> *Tutorials* <http://www.rabbitmq.com/getstarted.html> 6 rpc, i notice 
>> that client publish a message :channel.basicPublish("", "rpc_queue", 
>> props, message.getBytes());
>> 1.  i check in the sdk,the second parameter is routing key,but 
>> explaination show: 
>> "The request is sent to an rpc_queue queue" ,it is correct? i think it 
>> will be sent to any queue?
>>  
>>  2. when the server receive this message ,why no need to binding?because 
>> it use default exchange?
>>  
>> anyone know the answer please kindly reply me as soon,thanks.
>>  
>>  
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq... at lists.rabbitmq.com <javascript:>
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130103/089c65ad/attachment.htm>

From wuaner at gmail.com  Fri Jan  4 02:06:33 2013
From: wuaner at gmail.com (javaLee)
Date: Fri, 4 Jan 2013 10:06:33 +0800
Subject: [rabbitmq-discuss] How amqp-client modify & reject(requeue
 true) a message back to the original queue in rabbit broker?
In-Reply-To: <50D4BE88.6020009@rabbitmq.com>
References: <147b8d62-71c1-4abd-b5f9-99b67f0158d9@googlegroups.com>
	<50D33ED2.9070305@rabbitmq.com>
	<CALQDGEDLn1GW6dDrBsZzpS1QtQsZDEXkuQWZ8tiqGt8gS1yJjw@mail.gmail.com>
	<50D4BE88.6020009@rabbitmq.com>
Message-ID: <CALQDGEBtwryOfS=_aq5M=yRsnTj-AJ_zsPoyLtoT39OH6Yqk5w@mail.gmail.com>

I am really appreciated for your enthusiastic reply, guys!


On Sat, Dec 22, 2012 at 3:54 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> On 21/12/12 02:02, javaLee wrote:
>
>> /*M*//y understanding/: Queue in rabbitmq broker will never drop the
>>
>> unacknowledged message before client ack-or-reject it,
>> ack-or-reject-operationing on the client side do not need resend the
>> message to rabbitmq broker, that's why client side cannot modify the
>> message, is that true?
>>
>
> Correct.
>
>
>  I really need the requeue function, because on client side i want do
>> some retry operation with spring-retry. if max-retry-count is exhausted
>> & the message is still not be processing appropriately, i will not
>> requeue it (to the original queue) any more & put it to the
>> dead-letter-exchange.
>> But before put it to the DLX, i really want add some error-description
>> to this message, So another consumer that listening to the DLX can
>> retrieve & analysis & process it according to the error-description,
>> that's why i want modify message before reject it.
>>
>
> So don't use reject. Instead publish the modified message to the original
> queue or DLX - depending on the retry-count - and ack the original message.
>
> Regards,
>
> Matthias
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130104/e1da6b6b/attachment.htm>

From alexis at rabbitmq.com  Fri Jan  4 07:42:27 2013
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Fri, 4 Jan 2013 07:42:27 +0000
Subject: [rabbitmq-discuss]
	=?windows-1252?q?Using_RabbitMQ_at_the_World?=
	=?windows-1252?q?=92s_8th_Largest_Retailer?=
In-Reply-To: <CANVSfpJkCkoJ7_gdyf7+wFrPNbuu-KCnRZnmZWQba18XPWefUQ@mail.gmail.com>
References: <CANVSfpJkCkoJ7_gdyf7+wFrPNbuu-KCnRZnmZWQba18XPWefUQ@mail.gmail.com>
Message-ID: <CACOPnvf2F0+SQM2wa-Bys_AfzNXd_Trb07nz-T0ShnVetD-0KA@mail.gmail.com>

Thanks very much Pablo :-)

alexis


On Thu, Jan 3, 2013 at 11:42 PM, Pablo Molnar <pablomolnar at gmail.com> wrote:
> Hey all,
>
> Let me share you a blog post that I wrote explaining how we are using
> RabbitMQ in MercadoLibre.
>
> http://blogs.vmware.com/vfabric/2013/01/messaging-architecture-using-rabbitmq-at-the-worlds-8th-largest-retailer.html?utm_source=rss&utm_medium=rss&utm_campaign=messaging-architecture-using-rabbitmq-at-the-worlds-8th-largest-retailer
>
> Hope you find it of interest.
>
> Cheers,
> Pablo
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From antony.pulicken at gmail.com  Fri Jan  4 09:55:58 2013
From: antony.pulicken at gmail.com (antony)
Date: Fri, 4 Jan 2013 01:55:58 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ for synchronous communication
Message-ID: <1357293358901-24301.post@n5.nabble.com>

Hi,

We are planning to use RabbitMQ RPC in some use cases where 'synchronous'
communication is required and I have gone through the RPC tutorial. The
goals are 1) to de-couple the existing C++ commponents from the new
functionalities/components that are being developed 2) new components will
be developed in Java and it will subscribe to the messages produced by the
C++ component 3) In future we can add more subscribers for doing various
other operations. 

I would like to know the following:

1) In the Asynchronous mode we have various options for guaranteed delivery
like auto ack, explicit ack from the subscriber etc. How do we handle the
same in 'synchronous' scenario with the request queue and response queue in
picture?

2) We are planning to have highly available queues in a cluster by taking
advantage of queue mirroring feature supported in rabbitmq for asynchronous
scenarios. Is the approach same for synchronous use cases and do we need to
mirror both request and response queues ?

3)Are there any other recommendations considering it will be a synchronous
reliable system in a highly available cluster ? 

Regards,
Antony.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-for-synchronous-communication-tp24301.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From simon at rabbitmq.com  Fri Jan  4 10:26:34 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 04 Jan 2013 10:26:34 +0000
Subject: [rabbitmq-discuss] Mirrored queue with federation possible?
In-Reply-To: <CAPZTcDoyhDBKF55C8LS_gYi-E_3RexDxv0CUM-pi2FGKNxLW3A@mail.gmail.com>
References: <CAPZTcDoyhDBKF55C8LS_gYi-E_3RexDxv0CUM-pi2FGKNxLW3A@mail.gmail.com>
Message-ID: <50E6AE5A.5010806@rabbitmq.com>

Well, you can have one policy that defines both mirroring and federation 
if you like. So mirrored queues can be involved with federation.

But bear in mind that it's *exchanges* that are federated, not queues.

Cheers, Simon

On 03/01/13 20:21, Scott White wrote:
> Hi,
> Is it possible to setup two separate clusters with mirrored queues in
> each cluster, and then federate the mirrored queues to other cluster
> symmetrically?
> I was attempting to configure this, but noticed that only one
> policy can apply to an exchange/queue at a time.
> Is it possible to federate a mirrored queue?  Or should shovel be used
> instead?
> Regards,
> Scott
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Fri Jan  4 10:29:02 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 04 Jan 2013 10:29:02 +0000
Subject: [rabbitmq-discuss] Typos in clustering docs
In-Reply-To: <CABWKhpBCMv8VhPesWp-Q+5kC1OUMzqKicX0Onzq_poSWv=XFrg@mail.gmail.com>
References: <CABWKhpBCMv8VhPesWp-Q+5kC1OUMzqKicX0Onzq_poSWv=XFrg@mail.gmail.com>
Message-ID: <50E6AEEE.8070706@rabbitmq.com>

On 03/01/13 22:29, Shawn Smith wrote:
> Hi, I found some typos in the clustering docs:

Ah, thank you. Fixed.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Fri Jan  4 12:00:41 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 04 Jan 2013 12:00:41 +0000
Subject: [rabbitmq-discuss] RabbitMQ for synchronous communication
In-Reply-To: <1357293358901-24301.post@n5.nabble.com>
References: <1357293358901-24301.post@n5.nabble.com>
Message-ID: <50E6C469.8050907@rabbitmq.com>

Hi,

On 04/01/13 09:55, antony wrote:
> 1) In the Asynchronous mode we have various options for guaranteed delivery
> like auto ack, explicit ack from the subscriber etc. How do we handle the
> same in 'synchronous' scenario with the request queue and response queue in
> picture?

You can select client or server acknowledgements with synchronous mode
using the no-ack field of the basic.ack method:
http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.get.no-ack
Some clients call this field "auto-ack".

> 2) We are planning to have highly available queues in a cluster by taking
> advantage of queue mirroring feature supported in rabbitmq for asynchronous
> scenarios. Is the approach same for synchronous use cases and do we need to
> mirror both request and response queues ?

Whether messages are retrieved synchronously and whether queues are
mirrored are orthogonal so you can use these together in any
combination.

You should decide whether to mirror queues based on the same
considerations you would normally apply. Eg, are there sufficient
resources to support mirroring and what is the impact of a node crashing?




-Emile


















From yusuf.mahdi at gmail.com  Fri Jan  4 15:26:15 2013
From: yusuf.mahdi at gmail.com (Mahdi Yusuf)
Date: Fri, 4 Jan 2013 10:26:15 -0500
Subject: [rabbitmq-discuss] unacknowledged messages.
Message-ID: <CA+dfWhCAre_bCqKWSkL+PpvjOTRSG6Cobz+C=xiYRAdFLP8D=A@mail.gmail.com>

Hi,

I am trying to diagnose an issue I am having with RabbitMQ that deals with
scheduled tasks (eta). I am aware that messages sent with an eta are sent
off an await acknowledgement in the unacknowledged state.

That being said the following scenario has me quite confused. So lets say I
have fired off 30 eta task which land in the unacknowledged state. Once
they are process they cleared from that state. Using the same rabbitmq
instance I am also processing around a few thousand processes that aren't
eta tasks, but just run through  RabbitMQ and immediately acknowledged as
they are processed.

Now the issue is that i am losing some of the eta tasks that were in the
unacknowledged state and they aren't being processed. What could be
happening here? Ideas? I need for these eta tasks to be fired and robustly
handled.

Any help would be appreciated.

-- 
Mahdi Yusuf
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130104/eefa4037/attachment.htm>

From yusuf.mahdi at gmail.com  Fri Jan  4 15:30:47 2013
From: yusuf.mahdi at gmail.com (Mahdi Yusuf)
Date: Fri, 4 Jan 2013 10:30:47 -0500
Subject: [rabbitmq-discuss] unacknowledged messages.
In-Reply-To: <CA+dfWhCAre_bCqKWSkL+PpvjOTRSG6Cobz+C=xiYRAdFLP8D=A@mail.gmail.com>
References: <CA+dfWhCAre_bCqKWSkL+PpvjOTRSG6Cobz+C=xiYRAdFLP8D=A@mail.gmail.com>
Message-ID: <CA+dfWhCx=k4h-jr_=czXREKd-k9vASvwQ7Cj9AtbyJZHqRJ9mw@mail.gmail.com>

I am using celery as my consumer.

On Fri, Jan 4, 2013 at 10:26 AM, Mahdi Yusuf <yusuf.mahdi at gmail.com> wrote:

> Hi,
>
> I am trying to diagnose an issue I am having with RabbitMQ that deals with
> scheduled tasks (eta). I am aware that messages sent with an eta are sent
> off an await acknowledgement in the unacknowledged state.
>
> That being said the following scenario has me quite confused. So lets say
> I have fired off 30 eta task which land in the unacknowledged state. Once
> they are process they cleared from that state. Using the same rabbitmq
> instance I am also processing around a few thousand processes that aren't
> eta tasks, but just run through  RabbitMQ and immediately acknowledged as
> they are processed.
>
> Now the issue is that i am losing some of the eta tasks that were in the
> unacknowledged state and they aren't being processed. What could be
> happening here? Ideas? I need for these eta tasks to be fired and robustly
> handled.
>
> Any help would be appreciated.
>
> --
> Mahdi Yusuf
>



-- 
Mahdi Yusuf
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130104/18575140/attachment.htm>

From matthias at rabbitmq.com  Fri Jan  4 15:34:22 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 04 Jan 2013 15:34:22 +0000
Subject: [rabbitmq-discuss] unacknowledged messages.
In-Reply-To: <CA+dfWhCx=k4h-jr_=czXREKd-k9vASvwQ7Cj9AtbyJZHqRJ9mw@mail.gmail.com>
References: <CA+dfWhCAre_bCqKWSkL+PpvjOTRSG6Cobz+C=xiYRAdFLP8D=A@mail.gmail.com>
	<CA+dfWhCx=k4h-jr_=czXREKd-k9vASvwQ7Cj9AtbyJZHqRJ9mw@mail.gmail.com>
Message-ID: <50E6F67E.1010605@rabbitmq.com>

Mahdi,

On 04/01/13 15:30, Mahdi Yusuf wrote:
> I am using celery as my consumer.

The celery-users googlegroup is probably a better place to ask your 
question.

Matthias.

From yusuf.mahdi at gmail.com  Fri Jan  4 15:37:09 2013
From: yusuf.mahdi at gmail.com (Mahdi Yusuf)
Date: Fri, 4 Jan 2013 10:37:09 -0500
Subject: [rabbitmq-discuss] unacknowledged messages.
In-Reply-To: <50E6F67E.1010605@rabbitmq.com>
References: <CA+dfWhCAre_bCqKWSkL+PpvjOTRSG6Cobz+C=xiYRAdFLP8D=A@mail.gmail.com>
	<CA+dfWhCx=k4h-jr_=czXREKd-k9vASvwQ7Cj9AtbyJZHqRJ9mw@mail.gmail.com>
	<50E6F67E.1010605@rabbitmq.com>
Message-ID: <CA+dfWhAOKBaW4rHRd0i7xL+GVsFd=Md-p1Cq2oHhnkZ_bycbnA@mail.gmail.com>

So you think celery is pull messages off the queue and celery isn't
processing them?

On Fri, Jan 4, 2013 at 10:34 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Mahdi,
>
>
> On 04/01/13 15:30, Mahdi Yusuf wrote:
>
>> I am using celery as my consumer.
>>
>
> The celery-users googlegroup is probably a better place to ask your
> question.
>
> Matthias.
>



-- 
Mahdi Yusuf
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130104/be390c03/attachment.htm>

From matthias at rabbitmq.com  Fri Jan  4 15:42:10 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 04 Jan 2013 15:42:10 +0000
Subject: [rabbitmq-discuss] unacknowledged messages.
In-Reply-To: <CA+dfWhAOKBaW4rHRd0i7xL+GVsFd=Md-p1Cq2oHhnkZ_bycbnA@mail.gmail.com>
References: <CA+dfWhCAre_bCqKWSkL+PpvjOTRSG6Cobz+C=xiYRAdFLP8D=A@mail.gmail.com>
	<CA+dfWhCx=k4h-jr_=czXREKd-k9vASvwQ7Cj9AtbyJZHqRJ9mw@mail.gmail.com>
	<50E6F67E.1010605@rabbitmq.com>
	<CA+dfWhAOKBaW4rHRd0i7xL+GVsFd=Md-p1Cq2oHhnkZ_bycbnA@mail.gmail.com>
Message-ID: <50E6F852.7040309@rabbitmq.com>

On 04/01/13 15:37, Mahdi Yusuf wrote:
> So you think celery is pull messages off the queue and celery isn't
> processing them?

I have no idea, but scheduled tasks aren't a native RabbitMQ feature.

Matthias.

From yusuf.mahdi at gmail.com  Fri Jan  4 15:46:00 2013
From: yusuf.mahdi at gmail.com (Mahdi Yusuf)
Date: Fri, 4 Jan 2013 10:46:00 -0500
Subject: [rabbitmq-discuss] unacknowledged messages.
In-Reply-To: <50E6F852.7040309@rabbitmq.com>
References: <CA+dfWhCAre_bCqKWSkL+PpvjOTRSG6Cobz+C=xiYRAdFLP8D=A@mail.gmail.com>
	<CA+dfWhCx=k4h-jr_=czXREKd-k9vASvwQ7Cj9AtbyJZHqRJ9mw@mail.gmail.com>
	<50E6F67E.1010605@rabbitmq.com>
	<CA+dfWhAOKBaW4rHRd0i7xL+GVsFd=Md-p1Cq2oHhnkZ_bycbnA@mail.gmail.com>
	<50E6F852.7040309@rabbitmq.com>
Message-ID: <CA+dfWhD2UeFrrtghTtVEBGGhrTrDDxr6ykxeYBH-D7wMhNRUSg@mail.gmail.com>

Thats perfectly fine though. The issue I am facing has more to do with
unacknowledged messages disappearing. It has nothing to do with the firing
mechanism associated with it which is handled by celery in memory. I just
need to understand what is happening with the rabbitmq unacknowledged
messages that seem to be effectively disappearing from time to time.

I think it has something to do with memory, but I can't be sure, I really
dont know how rabbitmq handles these things internally.

--
Mahdi

On Fri, Jan 4, 2013 at 10:42 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> On 04/01/13 15:37, Mahdi Yusuf wrote:
>
>> So you think celery is pull messages off the queue and celery isn't
>> processing them?
>>
>
> I have no idea, but scheduled tasks aren't a native RabbitMQ feature.
>
> Matthias.
>



-- 
Mahdi Yusuf
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130104/245a1539/attachment.htm>

From matthias at rabbitmq.com  Fri Jan  4 15:48:27 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 04 Jan 2013 15:48:27 +0000
Subject: [rabbitmq-discuss] unacknowledged messages.
In-Reply-To: <CA+dfWhD2UeFrrtghTtVEBGGhrTrDDxr6ykxeYBH-D7wMhNRUSg@mail.gmail.com>
References: <CA+dfWhCAre_bCqKWSkL+PpvjOTRSG6Cobz+C=xiYRAdFLP8D=A@mail.gmail.com>
	<CA+dfWhCx=k4h-jr_=czXREKd-k9vASvwQ7Cj9AtbyJZHqRJ9mw@mail.gmail.com>
	<50E6F67E.1010605@rabbitmq.com>
	<CA+dfWhAOKBaW4rHRd0i7xL+GVsFd=Md-p1Cq2oHhnkZ_bycbnA@mail.gmail.com>
	<50E6F852.7040309@rabbitmq.com>
	<CA+dfWhD2UeFrrtghTtVEBGGhrTrDDxr6ykxeYBH-D7wMhNRUSg@mail.gmail.com>
Message-ID: <50E6F9CB.2000502@rabbitmq.com>

On 04/01/13 15:46, Mahdi Yusuf wrote:
> Thats perfectly fine though. The issue I am facing has more to do with
> unacknowledged messages disappearing. It has nothing to do with the
> firing mechanism associated with it which is handled by celery in
> memory. I just need to understand what is happening with the rabbitmq
> unacknowledged messages that seem to be effectively disappearing from
> time to time.
>
> I think it has something to do with memory, but I can't be sure, I
> really dont know how rabbitmq handles these things internally.

RabbitMQ does not throw away unacknowledged messages. Ever.

Matthias.

From matthew.collinge at comparethemarket.com  Fri Jan  4 15:13:46 2013
From: matthew.collinge at comparethemarket.com (matthew.collinge at comparethemarket.com)
Date: Fri, 4 Jan 2013 07:13:46 -0800 (PST)
Subject: [rabbitmq-discuss] Consistent Hash Exchange
Message-ID: <7d19f083-9002-4a75-8a6d-53cbe1caaf0d@googlegroups.com>



We are looking at using your consistent hash exchange for partitioning 
messages that we need to be processes synchronously based on a partition 
key (GUID in our case). The issue we currently face is that we are already 
using the routing key for subscriptions based on message type. As there 
will be messages of multiple types for the same partition key this will 
result in different routing keys and therefore different hashes of those 
keys for message that we want partitioned into the same destination queue.

What would be the best way to go about trying to achieve this? I have 
thought of the following options but do not know the relative merits with 
respect to performance and the inner workings of RabbitMQ:

i)                    Hash based on the first or last portion of a routing 
key (<HashME>.Iamused.For.Other.Routing)

ii)                   Hash based on a Message Header

iii)                 Hash based on a Message Property

Is there any approach that you would advocate or indeed strongly advise 
against?

Thank you in advance.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130104/9a7ae4da/attachment.htm>

From simon at rabbitmq.com  Fri Jan  4 17:14:43 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 04 Jan 2013 17:14:43 +0000
Subject: [rabbitmq-discuss] Consistent Hash Exchange
In-Reply-To: <7d19f083-9002-4a75-8a6d-53cbe1caaf0d@googlegroups.com>
References: <7d19f083-9002-4a75-8a6d-53cbe1caaf0d@googlegroups.com>
Message-ID: <50E70E03.4000306@rabbitmq.com>

So some of this comes down to "it depends what you want to do". If you 
are doing some routing based on the routing key (before?) the messages 
hit the CHX then you presumably are using e2e bindings like so:

                 /> Q1
          > CHX1 -> Q2
         /       \> Q3
        /        /> Q4
P -> X --> CHX2 -> Q5
        \        \> Q6
         \       /> Q7
          > CHX3 -> Q8
                 \> Q9

with routing for message type at X and then load balancing at CHX{1,2,3}.

So if the X in question is a topic exchange then option i) should work 
fine in the scenario above. Putting the hash at either end is fine, the 
key becomes a tree structure for routing anyway.

I don't know what exchange type you are currently using although I guess 
topic; if you are using a direct exchange you would either have to 
switch to topic or change your publishers to publish to one of several 
CHXs rather than to one DX with one of several routing keys.

Options ii) and iii) struggle with the fact that the CHX doesn't 
currently support hashing on anything other than the routing key.

Cheers, Simon

On 04/01/13 15:13, matthew.collinge at comparethemarket.com wrote:
> We are looking at using your consistent hash exchange for partitioning
> messages that we need to be processes synchronously based on a partition
> key (GUID in our case). The issue we currently face is that we are
> already using the routing key for subscriptions based on message type.
> As there will be messages of multiple types for the same partition key
> this will result in different routing keys and therefore different
> hashes of those keys for message that we want partitioned into the same
> destination queue.
>
> What would be the best way to go about trying to achieve this? I have
> thought of the following options but do not know the relative merits
> with respect to performance and the inner workings of RabbitMQ:
>
> i)Hash based on the first or last portion of a routing key
> (<HashME>.Iamused.For.Other.Routing)
>
> ii)Hash based on a Message Header
>
> iii)Hash based on a Message Property
>
> Is there any approach that you would advocate or indeed strongly advise
> against?
>
> Thank you in advance.
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From Bin.Chen at kla-tencor.com  Fri Jan  4 19:05:07 2013
From: Bin.Chen at kla-tencor.com (Chen, Bin)
Date: Fri, 4 Jan 2013 11:05:07 -0800
Subject: [rabbitmq-discuss] .NET client:
	intermittentAlreadyClosedException - connected host has
	failed to respond
In-Reply-To: <50D4BC68.4000701@rabbitmq.com>
References: <6762d23c-8815-4624-8f92-e86b75ecedab@googlegroups.com><50B5E4E2.8040500@rabbitmq.com><CAE_3mL7abp5e+CP6D6KjUCZfdB31u-nAk8FS5mK2aEbEVTky9w@mail.gmail.com><CAE_3mL4BYCS6LWhMH28kFe=D3KEGJecLHx9uFy6momvszGzFAw@mail.gmail.com><50BC7A9A.3020609@rabbitmq.com>
	<BCC407A444557E41B0D8B0260D68499205C6C620@CA1EXCLV07.adcorp.kla-tencor.com>
	<BCC407A444557E41B0D8B0260D68499205C6C627@CA1EXCLV07.adcorp.kla-tencor.com>
	<50D4BC68.4000701@rabbitmq.com>
Message-ID: <BCC407A444557E41B0D8B0260D68499205C6D0D1@CA1EXCLV07.adcorp.kla-tencor.com>

Hi Matthias,

I've been tracing the AlreadyClosedException problem in my system
recently.
In my case, the AlreadyClosedException is originally caused by the error
"Frame received for invalid channel xxx".

I read the .NET client code. When the main loop of ConnectionBase
receives a frame of an unknown session, 
an ChannelErrorException exception is thrown with the error message "
received for invalid channel xxx".

Because of that exception, the whole connection is shut down.

My questions are:

1) Why could "Frame received for invalid channel ???" error happen? 
   My client code always uses Close() to close a Model.
   Is this a bug in server side?

   
2) Can we add a property in ConnectionBase to allow ignoring the above
"Frame received for invalid channel xxx" error?
   A single bad frame should not ruin the whole connection.


Regards,
Bin Chen


-----Original Message-----
From: Matthias Radestock [mailto:matthias at rabbitmq.com] 
Sent: Friday, December 21, 2012 11:46 AM
To: Discussions about RabbitMQ
Cc: Chen, Bin
Subject: Re: [rabbitmq-discuss] .NET client:
intermittentAlreadyClosedException - connected host has failed to
respond

On 21/12/12 19:38, Chen, Bin wrote:
> I forgot to mention that our client code does set up the heartbeat for

> 10s.
> Somehow, the intermittent AlreadyClosedException still happens.

Hmm. that's odd.

Is there anything of interest in the server logs?

Regardless, I do suggest you upgrade to 3.0.1.

Regards,

Matthias

From matthias at rabbitmq.com  Fri Jan  4 19:30:16 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 04 Jan 2013 19:30:16 +0000
Subject: [rabbitmq-discuss] .NET client:
 intermittentAlreadyClosedException - connected host has failed to respond
In-Reply-To: <BCC407A444557E41B0D8B0260D68499205C6D0D1@CA1EXCLV07.adcorp.kla-tencor.com>
References: <6762d23c-8815-4624-8f92-e86b75ecedab@googlegroups.com><50B5E4E2.8040500@rabbitmq.com><CAE_3mL7abp5e+CP6D6KjUCZfdB31u-nAk8FS5mK2aEbEVTky9w@mail.gmail.com><CAE_3mL4BYCS6LWhMH28kFe=D3KEGJecLHx9uFy6momvszGzFAw@mail.gmail.com><50BC7A9A.3020609@rabbitmq.com>
	<BCC407A444557E41B0D8B0260D68499205C6C620@CA1EXCLV07.adcorp.kla-tencor.com>
	<BCC407A444557E41B0D8B0260D68499205C6C627@CA1EXCLV07.adcorp.kla-tencor.com>
	<50D4BC68.4000701@rabbitmq.com>
	<BCC407A444557E41B0D8B0260D68499205C6D0D1@CA1EXCLV07.adcorp.kla-tencor.com>
Message-ID: <50E72DC8.5010109@rabbitmq.com>

On 04/01/13 19:05, Chen, Bin wrote:
> My questions are:
>
> 1) Why could "Frame received for invalid channel ???" error happen?

This would happen if the session somehow got removed from the session 
manager before the AMQP channel closure handshake was completed.

What channel number got reported in the error?

>     Is this a bug in server side?

Nope. It could be a bug in the client library.

Have you got a test case that reproduces the problem?

Regards,

Matthias.

From cischmidt77 at gmail.com  Fri Jan  4 23:08:04 2013
From: cischmidt77 at gmail.com (Chris Schmidt)
Date: Fri, 4 Jan 2013 15:08:04 -0800
Subject: [rabbitmq-discuss] RMQ performance between high MHz/low core vs
 lower MHz/high core servers
In-Reply-To: <50D4AE74.3080505@rabbitmq.com>
References: <CAEnikB4AZQ35HkxnCDEyxUdkbU8bGFaxE4nmz5FHgXmcA+ih7g@mail.gmail.com>
	<50D345D1.3060102@rabbitmq.com>
	<91DCE58C-EB72-4556-AE70-4AD8B0F7AFBE@gmail.com>
	<50D4AE74.3080505@rabbitmq.com>
Message-ID: <CAEnikB558pu10v0FZ+EKDwpUjoyd2MUPaHHswAQy3iu5+w0HvA@mail.gmail.com>

Thanks for the pointers Matthias, I wasn't able to do a lot of changes
before the holidays, but I've done a few things since the last email.

I've updated to RMQ 3.0.1 and R15B03 of Erlang. I noticed a slight
improvement in performance but not much. Increasing the number of queues
also didn't seem to make a large impact. One thing that I'm noticing while
running in HIPE mode is the amount of system utilization on the server.
System utilization is at 85-90% while user processes are only at 8%. I went
to the stock Erlang configuration and just changed the +swt setting. I
noticed that setting it to very_high caused a dip in performance while
very_low was about the same as not modifying the setting.

The server has 4 NUMA nodes configured (one for each 10 core CPU).
Interestingly, running against a single NUMA node by wrapping the start of
RMQ with numactl almost doubles performance. Kernel utilization drops to
15% and user utilization is about the same. As soon as I run RMQ across
more than one NUMA node performance suffers. Is there anything within the
Erlang settings that would allow me to run RMQ across more cores but keep
the kernel utilization down? I'm guessing that schedulers are spawning
across NUMA nodes and passing data back and forth between them, causing the
kernel time to increase. If there is some way to localize the schedulers
that work together within the same node that will be ideal. I tried a few
+sbt options again but that didn't seem to make a difference.

Thanks,

 Chris


On Fri, Dec 21, 2012 at 10:46 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Chris,
>
>
> On 20/12/12 17:27, Chris Schmidt wrote:
>
>> RHEL 6.2 doesn't seem to have the latest version of Erlang available
>> in the repositories. Does anyone have experience with manually
>> building Erlang on that platform with success? We're on R14B04 right
>> now. There are a huge number of erlang related rpms that get
>> installed I'm not certain if a single Erlang version for CentOS
>> would work properly or not.
>>
>
> You may want to give
> https://my.vmware.com/web/**vmware/details?downloadGroup=**
> VFEL_15B02&productId=267<https://my.vmware.com/web/vmware/details?downloadGroup=VFEL_15B02&productId=267>
> a try - it's R15B02 (so not quite the latest but close enough) with
> "batteries included", i.e. no dependencies.
>
>
>  I had +K true -smp enable +native +sbtps plus the other RMQ defaults
>>
>
> "+K true" is already part of the standard config. So is "-smp auto",
> which enables smp when there is more than one core. "+native" is a
> compile-time option and I would not recommend using it. As for +sbtps, I
> suggest you leave that out and stick with the default.
>
> As I said in my earlier email, playing with the +swt option may yield
> some benefits.
>
>
>  I also had 15 consumers running against the initial queue that was
>> having problems.
>>
>
> Increasing the number of consumers only helps when the consumers, rather
> than the queue, are the bottleneck.
>
>
>  I also tried sending the data into 2 - 40 exchanges (and updated the
>> queue to read from those exchanges) in order to see if I could spread
>> the load that way.
>>
>
> Exchanges are not represented by processes, so you don't gain anything
> by spreading the load over them. Increasing the number of producers can
> increase the message ingestion rate, but only if the messages get routed to
> different queues.
>
>
>  Does a single process manage each queue?
>>
>
> yes.
>
>
>  If so I can see that being a potential bottleneck due to the core's
>> speed difference.
>>
>
> Exactly.
>
>
>  Is there an erlang or rabbitmqctl command that I can run against the
>> RMQ server to determine if the queues themselves are the bottleneck?
>>
>
> If the queues are growing then the bottleneck is on the outbound side
> (rabbit's AMQP encoding, network, consumers).
>
> If the queues stay short/empty then the bottleneck is on the inbound side
> (producer, network, rabbit's AMQP decoding, routing, the queue). If
> connections get blocked due to flow control then the bottleneck is in the
> latter three. Narrowing it down any further is tricky.
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130104/c1cbea97/attachment.htm>

From matthias at rabbitmq.com  Fri Jan  4 23:51:09 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 04 Jan 2013 23:51:09 +0000
Subject: [rabbitmq-discuss] RMQ performance between high MHz/low core vs
 lower MHz/high core servers
In-Reply-To: <CAEnikB558pu10v0FZ+EKDwpUjoyd2MUPaHHswAQy3iu5+w0HvA@mail.gmail.com>
References: <CAEnikB4AZQ35HkxnCDEyxUdkbU8bGFaxE4nmz5FHgXmcA+ih7g@mail.gmail.com>
	<50D345D1.3060102@rabbitmq.com>
	<91DCE58C-EB72-4556-AE70-4AD8B0F7AFBE@gmail.com>
	<50D4AE74.3080505@rabbitmq.com>
	<CAEnikB558pu10v0FZ+EKDwpUjoyd2MUPaHHswAQy3iu5+w0HvA@mail.gmail.com>
Message-ID: <50E76AED.8060506@rabbitmq.com>

Chris,

On 04/01/13 23:08, Chris Schmidt wrote:
> The server has 4 NUMA nodes configured (one for each 10 core CPU).
> Interestingly, running against a single NUMA node by wrapping the start
> of RMQ with numactl almost doubles performance. Kernel utilization drops
> to 15% and user utilization is about the same. As soon as I run RMQ
> across more than one NUMA node performance suffers. Is there anything
> within the Erlang settings that would allow me to run RMQ across more
> cores but keep the kernel utilization down?

You could try running one rabbit per NUMA node, and cluster them.

I am not familiar with the intricacies of Erlang's schedulers, and how 
they could be tuned for best performance on NUMA architectures. 
erlang-questions is your best bet for that.

Regards,

Matthias.

From Bin.Chen at kla-tencor.com  Sat Jan  5 01:30:01 2013
From: Bin.Chen at kla-tencor.com (Chen, Bin)
Date: Fri, 4 Jan 2013 17:30:01 -0800
Subject: [rabbitmq-discuss] .NET client:
	intermittentAlreadyClosedException - connected host has
	failed to respond
In-Reply-To: <50E72DC8.5010109@rabbitmq.com>
References: <6762d23c-8815-4624-8f92-e86b75ecedab@googlegroups.com><50B5E4E2.8040500@rabbitmq.com><CAE_3mL7abp5e+CP6D6KjUCZfdB31u-nAk8FS5mK2aEbEVTky9w@mail.gmail.com><CAE_3mL4BYCS6LWhMH28kFe=D3KEGJecLHx9uFy6momvszGzFAw@mail.gmail.com><50BC7A9A.3020609@rabbitmq.com>
	<BCC407A444557E41B0D8B0260D68499205C6C620@CA1EXCLV07.adcorp.kla-tencor.com>
	<BCC407A444557E41B0D8B0260D68499205C6C627@CA1EXCLV07.adcorp.kla-tencor.com>
	<50D4BC68.4000701@rabbitmq.com>
	<BCC407A444557E41B0D8B0260D68499205C6D0D1@CA1EXCLV07.adcorp.kla-tencor.com>
	<50E72DC8.5010109@rabbitmq.com>
Message-ID: <BCC407A444557E41B0D8B0260D68499205C6D202@CA1EXCLV07.adcorp.kla-tencor.com>

> My questions are:
>
> 1) Why could "Frame received for invalid channel ???" error happen?

This would happen if the session somehow got removed from the session
manager before the AMQP channel closure handshake was completed.

What channel number got reported in the error?


[BC]  The channel number was 9 last time. I saw different channel
numbers before. None of them was 0. I think all were positive and less
than 20.



>     Is this a bug in server side?

Nope. It could be a bug in the client library.

Have you got a test case that reproduces the problem?


[BC] The problem happened randomly.  But it is not difficult to make it
happen. I just need to run some long jobs.



Regards,
Bin Chen

From matthias at rabbitmq.com  Sat Jan  5 02:09:08 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 05 Jan 2013 02:09:08 +0000
Subject: [rabbitmq-discuss] .NET client:
 intermittentAlreadyClosedException - connected host has failed to respond
In-Reply-To: <BCC407A444557E41B0D8B0260D68499205C6D202@CA1EXCLV07.adcorp.kla-tencor.com>
References: <6762d23c-8815-4624-8f92-e86b75ecedab@googlegroups.com><50B5E4E2.8040500@rabbitmq.com><CAE_3mL7abp5e+CP6D6KjUCZfdB31u-nAk8FS5mK2aEbEVTky9w@mail.gmail.com><CAE_3mL4BYCS6LWhMH28kFe=D3KEGJecLHx9uFy6momvszGzFAw@mail.gmail.com><50BC7A9A.3020609@rabbitmq.com>
	<BCC407A444557E41B0D8B0260D68499205C6C620@CA1EXCLV07.adcorp.kla-tencor.com>
	<BCC407A444557E41B0D8B0260D68499205C6C627@CA1EXCLV07.adcorp.kla-tencor.com>
	<50D4BC68.4000701@rabbitmq.com>
	<BCC407A444557E41B0D8B0260D68499205C6D0D1@CA1EXCLV07.adcorp.kla-tencor.com>
	<50E72DC8.5010109@rabbitmq.com>
	<BCC407A444557E41B0D8B0260D68499205C6D202@CA1EXCLV07.adcorp.kla-tencor.com>
Message-ID: <50E78B44.8080904@rabbitmq.com>

On 05/01/13 01:30, Chen, Bin wrote:
> [BC]  The channel number was 9 last time. I saw different channel
> numbers before. None of them was 0.

ok. The not-zero bit is what I wanted to know.

> [BC] The problem happened randomly.  But it is not difficult to make it
> happen. I just need to run some long jobs.

Can you get that code into a form where it's a standalone app that runs 
until the error occurs, and send that to me?

Regards,

Matthias.

From jervisliu at gmail.com  Sat Jan  5 05:33:43 2013
From: jervisliu at gmail.com (Jervis Liu)
Date: Sat, 5 Jan 2013 13:33:43 +0800
Subject: [rabbitmq-discuss] RabbitMQ binary uses a ton of memory
In-Reply-To: <CAE0Sz=x+=tryF+N1GJBFq8_txozB6PVKi8rW29GiWoSBEs0YhA@mail.gmail.com>
References: <CAM9W9p2F9kBRb5KDjTKvM6u6hHdkJQTSARxZVR4+jCvnpGmLfg@mail.gmail.com>
	<50E40A8B.1070206@rabbitmq.com>
	<CAE0Sz=x+=tryF+N1GJBFq8_txozB6PVKi8rW29GiWoSBEs0YhA@mail.gmail.com>
Message-ID: <CAM9W9p0MVgPOdQN35ZZ863A7NczFU1_F6y7gi_W_AkyY6J2EQQ@mail.gmail.com>

The default value on my system is:

cat  /proc/sys/net/ipv4/tcp_rmem
4096    87380   4194304

This is indeed inline with what I have observed, i..e, each connection
takes about 87K memory.

Thanks!
Jervis

On Thu, Jan 3, 2013 at 9:51 AM, Jerry Kuch <jerryk at rbcon.com> wrote:
> Jervis:
>
> Also, since you're on Linux, IIRC, you can check out:
>
> /proc/sys/net/ipv4/tcp_rmem
> /proc/sys/net/ipv4/tcp_wmem
>
> (or very similar to those paths, poke around /proc a bit and you should find
> them).
>
> Those should reveal the minimum, default and maximum memory size values that
> Linux is going to choose/allow for these buffers.  Informed by those
> numbers, you can fiddle with your tcp_listen_options as Matthias suggests.
>
> Best regards,
> Jerry
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From matthias at rabbitmq.com  Sat Jan  5 12:48:59 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 05 Jan 2013 12:48:59 +0000
Subject: [rabbitmq-discuss] rabbit starts failing when I set up freeipa
 client
In-Reply-To: <CAHM9UcG+Bk9h61KYSpc-a3g25c6JRM89brpfSrn-1HV6fcGvgQ@mail.gmail.com>
References: <CAHM9UcGwoC3rL5FvpbS-fmWwH3EJbaf+UFSDNqOO65Nvuf-oEw@mail.gmail.com>
	<50E58449.7000005@rabbitmq.com>
	<CAHM9UcFz9F+6WTJmW+2w-TBZncB2WBuzqa_D8mPXK8Zf=ST3eA@mail.gmail.com>
	<50E5871B.2090904@rabbitmq.com>
	<CAHM9UcE7iXCFr_W=_xHwm4qTM+b2Rq+i0Rs5Wvx-v8d+UvhLMA@mail.gmail.com>
	<CAHM9UcFAyAvtRzxrZ1ctwGKKj96j-MwPr18imJJ1WKuSqY__PA@mail.gmail.com>
	<50E58B11.1020600@rabbitmq.com>
	<CAHM9UcHnw1H-4oE8q7SY0tBdzCJq61+x62MM0bEpjYiteX+3_g@mail.gmail.com>
	<50E6DD15.60400@rabbitmq.com>
	<CAHM9UcFrvL1tJYcCuMi8QYRoJS_xSTV6uGR8=eeDXz1V6-Euog@mail.gmail.com>
	<CAHM9UcFxC4zpFbh5idxDb29WMWYkbfOs=fDzhpnY5qJv-0SB4g@mail.gmail.com>
	<50E78D1D.40604@rabbitmq.com>
	<CAHM9UcG+Bk9h61KYSpc-a3g25c6JRM89brpfSrn-1HV6fcGvgQ@mail.gmail.com>
Message-ID: <50E8213B.2040302@rabbitmq.com>

Nate,

On 05/01/13 11:23, Nate Marks wrote:
> I'd be happy to  cc the public mailing list.

(putting list back on cc)

For the benefit of the list... Nate found that

<quote>
I can solve the problem by just disabling sssd.  of course SSO doesn't 
work then, but maybe this points us in the right direction.

chkconfig sssd off
init 6

the rabbitmq-server comes up fine.

It sounds like there's an sssd fix upstream that's working it's way 
down.  An alternative that worked for me is to keep sssd disabled and 
start it after rabbitmq.  that seems to be a reasonable hack while I 
wait for the sssd fix.
</quote>

We had a similar problem report some months ago that we were never able 
to reproduce but thought we had fixed by some changes to our startup 
scripts.

> The opscode chef server bootstrap process installed rabbitmq from EPEL
> (details below).
> Name        : rabbitmq-server
> Version     : 2.6.1

That would be the problem then. The aforementioned change was made in 
2.8.0. Please follow the instructions at 
http://www.rabbitmq.com/install-rpm.html to get the latest version of 
RabbitMQ; given that you have Epel 6 set up already you should be able 
to simply download the 3.0.1 rpm and install it.

Regards,

Matthias.

From reustmd at gmail.com  Mon Jan  7 17:40:39 2013
From: reustmd at gmail.com (Mike)
Date: Mon, 7 Jan 2013 09:40:39 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ monitoring app shows load balancer IP
	instead of client IP
Message-ID: <abdd0428-6c47-427d-9c14-9efc7b7e2193@googlegroups.com>



I have a rabbitMQ cluster running on EC2 behind an AWS load-balancer. In 
the rabbitMQ monitoring app, it shows the IP address of each machine that's 
currently connected to rabbitMQ. Since the clients are hitting rabbitMQ 
through the LB, it's showing the LBs IP address, instead of the client.

Is there a way to get the rabbitMQ monitoring plugin to show the 
x-forwarded-for request header, which contains the actual client IP address?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130107/e4834fe4/attachment.htm>

From tim at rabbitmq.com  Mon Jan  7 17:55:14 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 7 Jan 2013 17:55:14 +0000
Subject: [rabbitmq-discuss] RabbitMQ monitoring app shows load balancer
	IP instead of client IP
In-Reply-To: <abdd0428-6c47-427d-9c14-9efc7b7e2193@googlegroups.com>
References: <abdd0428-6c47-427d-9c14-9efc7b7e2193@googlegroups.com>
Message-ID: <2BEC9767-EC99-442A-9BBC-DE72CD81928F@rabbitmq.com>

Hi

On 7 Jan 2013, at 17:40, Mike wrote:

> I have a rabbitMQ cluster running on EC2 behind an AWS load-balancer. In the rabbitMQ monitoring app, it shows the IP address of each machine that's currently connected to rabbitMQ. Since the clients are hitting rabbitMQ through the LB, it's showing the LBs IP address, instead of the client.
> 
> Is there a way to get the rabbitMQ monitoring plugin to show the x-forwarded-for request header, which contains the actual client IP address?
> 

I'm assuming here that by 'the actual client IP address' you mean the client's which are publishing to and consuming from the broker? Because those are AMQP client, and x-forwarded-for is an HTTP header if I'm not mistaken.

Cheers,
Tim

From Petr.Gotthard at Honeywell.com  Mon Jan  7 18:33:36 2013
From: Petr.Gotthard at Honeywell.com (Gotthard, Petr)
Date: Mon, 7 Jan 2013 18:33:36 +0000
Subject: [rabbitmq-discuss] .NET client with 0-9-1 protocol is sending the
	AMQP 0-8 header
Message-ID: <F9E85480F62349458DF67CE8BA000D8D2A63984E@FR44EX3005.global.ds.honeywell.com>

Hello,

I believe the .NET client is sending wrong AMQP header (the very first 8 octets).

When I set the protocol to 0-9-1 (and RabbitMQ correctly reports the 0-9-1 protocol), the first 8 octets sent by the .NET client still contain AMQP x1 x1 x9 x1 (which is the header used in AMQP 0-8) although it should contain AMQP x0 x0 x9 x1.


Regards,
Petr

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130107/cdd4aa88/attachment.htm>

From matthias at rabbitmq.com  Mon Jan  7 18:50:51 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 07 Jan 2013 18:50:51 +0000
Subject: [rabbitmq-discuss] .NET client with 0-9-1 protocol is sending
 the AMQP 0-8 header
In-Reply-To: <F9E85480F62349458DF67CE8BA000D8D2A63984E@FR44EX3005.global.ds.honeywell.com>
References: <F9E85480F62349458DF67CE8BA000D8D2A63984E@FR44EX3005.global.ds.honeywell.com>
Message-ID: <50EB190B.5010401@rabbitmq.com>

Petr,

On 07/01/13 18:33, Gotthard, Petr wrote:
> I believe the .NET client is sending wrong AMQP header (the very first 8
> octets).

I can assure you it is not, unless you are using a truly ancient client 
which pre-dates 0-9-1.

> When I set the protocol to 0-9-1

How are you doing that? The .net client is in fact selecting 0-9-1 by 
default, so this step shouldn't be necessary.

Regards,

Matthias.

From dr_tech_2013 at hush.com  Mon Jan  7 08:25:52 2013
From: dr_tech_2013 at hush.com (omid dimo)
Date: Mon, 7 Jan 2013 08:25:52 +0000 (UTC)
Subject: [rabbitmq-discuss] RabbitMQ + Qt
References: <33980826.post@talk.nabble.com>
Message-ID: <loom.20130107T092338-204@post.gmane.org>

hay, 
just searck for "Qt QAMQP" in google and hopefully you definitely find
what ur looking for. But, remember, I think you would need some investigation
and playing with code + optimization before gettin it into work.
bests




From Matthew.Collinge at bglgroup.co.uk  Mon Jan  7 22:10:39 2013
From: Matthew.Collinge at bglgroup.co.uk (Matthew Collinge)
Date: Mon, 7 Jan 2013 22:10:39 +0000
Subject: [rabbitmq-discuss] Consistent Hash Exchange
In-Reply-To: <50E70E03.4000306@rabbitmq.com>
References: <7d19f083-9002-4a75-8a6d-53cbe1caaf0d@googlegroups.com>
	<50E70E03.4000306@rabbitmq.com>
Message-ID: <CE7FFC70C4C3864CA0CCEA77E53801C60D7CCC@bre-exch02.insurance.financial.local>

Simon,

Thanks for your reply. Here is an example of our use case based on your topology:

X is bound to CHX1 with "MessageTypeA.Something.#" and "MessageTypeB.SomethingElse.#"

P publishes message M1 with routing key: "MessageTypeA.Something.<HashMe>"  - This is delivered to Exchange CHX1
P then publishes another message M2 with a different routing key:  "MessageTypeB.SomethingElse.<HashMe>"  - This is delivered to Exchange CHX1

<HashMe> from message M1 is the same as <HashMe> from message M2 and should be delivered to the same queue say Q1 as they must be consumed by the same consumer.

The way the Consistent Hash Exchange seems to work is that it takes the entire routing key and hashes that. Is there a way to make it use a segment of the routing key?

Cheers

Matt

-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com]
Sent: 04 January 2013 17:15
To: Discussions about RabbitMQ
Cc: Matthew Collinge
Subject: Re: [rabbitmq-discuss] Consistent Hash Exchange

So some of this comes down to "it depends what you want to do". If you are doing some routing based on the routing key (before?) the messages hit the CHX then you presumably are using e2e bindings like so:

                 /> Q1
          > CHX1 -> Q2
         /       \> Q3
        /        /> Q4
P -> X --> CHX2 -> Q5
        \        \> Q6
         \       /> Q7
          > CHX3 -> Q8
                 \> Q9

with routing for message type at X and then load balancing at CHX{1,2,3}.

So if the X in question is a topic exchange then option i) should work fine in the scenario above. Putting the hash at either end is fine, the key becomes a tree structure for routing anyway.

I don't know what exchange type you are currently using although I guess topic; if you are using a direct exchange you would either have to switch to topic or change your publishers to publish to one of several CHXs rather than to one DX with one of several routing keys.

Options ii) and iii) struggle with the fact that the CHX doesn't currently support hashing on anything other than the routing key.

Cheers, Simon

On 04/01/13 15:13, matthew.collinge at comparethemarket.com wrote:
> We are looking at using your consistent hash exchange for partitioning
> messages that we need to be processes synchronously based on a
> partition key (GUID in our case). The issue we currently face is that
> we are already using the routing key for subscriptions based on message type.
> As there will be messages of multiple types for the same partition key
> this will result in different routing keys and therefore different
> hashes of those keys for message that we want partitioned into the
> same destination queue.
>
> What would be the best way to go about trying to achieve this? I have
> thought of the following options but do not know the relative merits
> with respect to performance and the inner workings of RabbitMQ:
>
> i)Hash based on the first or last portion of a routing key
> (<HashME>.Iamused.For.Other.Routing)
>
> ii)Hash based on a Message Header
>
> iii)Hash based on a Message Property
>
> Is there any approach that you would advocate or indeed strongly
> advise against?
>
> Thank you in advance.
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


--
Simon MacMullen
RabbitMQ, VMware

________________________________

This message is intended for the stated addressee(s) only and may be confidential. Access to this email by anyone else is unauthorised. Any opinions expressed in this email do not necessarily reflect the opinions of BGL Group Limited and its subsidiaries . Any unauthorised disclosure, use or dissemination, either whole or in part is prohibited. If you are not the intended recipient of this message, please notify the sender immediately.

Please scan all attachments for viruses.

From bradbury at corenap.com  Mon Jan  7 22:29:41 2013
From: bradbury at corenap.com (Matt Bradbury)
Date: Mon, 7 Jan 2013 16:29:41 -0600
Subject: [rabbitmq-discuss] rabbit_auth_backend_ldap and Active Directory
Message-ID: <8F348D9D79ADA24993FCE45FE44F16240271B444AA48@exchange01.corp.corenap.com>

All/Simon?

I'm new to the RabbitMQ world and like the product, but I'm about to pull my hair out on AD authentication.

So, I'm looking to authorize with my unix username which are the same as our windows logins.

I'm having a lot of trouble getting the DNs to play nice.  Since my DN has my fullname as the cn part, I don't know how to map the username to the full name.

If I login with my full name "Matt Bradbury" so that my full user_dn matches my group structure, it works just fine.
i.e.  {user_dn_pattern,       "CN=${username},OU=Users,DC=corp,DC=example,DC=com"},

To use my unix name I have to use: {user_dn_pattern,       "${username}@CORP"},

This lets me login, but I'm then unable to match the DN with my groups since they use my full name in the DN.

Does anyone have a nice little recipe that lets me login with my shortname, which corresponds to the sAMAccountName attribute in AD LDAP?

Also, I can't seem to get dn_lookup_base or dn_lookup_attribute to make any difference to the LDAP queries when I look at the logs.  I feel like the solution is with these commands but I think I'm missing something here.

Is there a way to search for a DN from the sAMAccountName when I do resource_access_query?

FYI, I'm using other_bind for directory lookups after the login check.

Thank you for your time.

-Matt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130107/3a0e8328/attachment.htm>

From bradbury at corenap.com  Mon Jan  7 22:45:16 2013
From: bradbury at corenap.com (Matt Bradbury)
Date: Mon, 7 Jan 2013 16:45:16 -0600
Subject: [rabbitmq-discuss] rabbit_auth_backend_ldap and Active Directory
Message-ID: <8F348D9D79ADA24993FCE45FE44F16240271B444AA4B@exchange01.corp.corenap.com>

All/Simon?

I'm new to the RabbitMQ world and like the product, but I'm about to pull my hair out on AD authentication.

So, I'm looking to authorize with my unix username which are the same as our windows logins.

I'm having a lot of trouble getting the DNs to play nice.  Since my DN has my fullname as the cn part, I don't know how to map the username to the full name.

If I login with my full name "Matt Bradbury" so that my full user_dn matches my group structure, it works just fine.
i.e.  {user_dn_pattern,       "CN=${username},OU=Users,DC=corp,DC=example,DC=com"},

To use my unix name I have to use: {user_dn_pattern,       "${username}@CORP"},

This lets me login, but I'm then unable to match the DN with my groups since they use my full name in the DN.

Does anyone have a nice little recipe that lets me login with my shortname, which corresponds to the sAMAccountName attribute in AD LDAP?

Also, I can't seem to get dn_lookup_base or dn_lookup_attribute to make any difference to the LDAP queries when I look at the logs.  I feel like the solution is with these commands but I think I'm missing something here.

Is there a way to search for a DN from the sAMAccountName when I do resource_access_query?

FYI, I'm using other_bind for directory lookups after the login check.

Thank you for your time.

-Matt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130107/46447fe4/attachment.htm>

From rmqjava1a at yahoo.com  Tue Jan  8 00:34:37 2013
From: rmqjava1a at yahoo.com (CJ)
Date: Mon, 7 Jan 2013 16:34:37 -0800 (PST)
Subject: [rabbitmq-discuss] Transactions
Message-ID: <5cc06b2d-a235-4bb6-b6e2-92c8e4f24508@googlegroups.com>

I am trying to figure out Rabbit Tx's
 
My producer sends 100 Persistent TX and dies as I directed.
 
Than I run a consumer that reads the messages from the durable Q with a 
txcommit after the reception
 
Then my receiver can consume all 100 messages, and does so.
 
I am happy with this result, so I start over 
 
......
 
I have my producer send another 100 messages.
 
But this time I have the consumer only read 50 persistent messages with a 
txcommit.
 
I read in all of the first 50 messages correctly.
 
So I run the consumer again, hoping to get the next 50, but this time it 
does not see any persistent Tx on the Q, and receive zero messages
 
What it looks like is that when the receiver opens the channel, Rabbit 
sends a batch of messages from the database and the consumer can open them 
one by one, and if the receiver closes the channel before the batch 
processing of all the records has completed, those messages will be lost 
regardless of whether they are persistent or not., and therefore I have to 
take that into account when I write my consumers.  Is this a correct 
assumption, or did I make a mistake ?
 
 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130107/99686f54/attachment.htm>

From matthias at rabbitmq.com  Tue Jan  8 00:47:37 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 08 Jan 2013 00:47:37 +0000
Subject: [rabbitmq-discuss] Transactions
In-Reply-To: <5cc06b2d-a235-4bb6-b6e2-92c8e4f24508@googlegroups.com>
References: <5cc06b2d-a235-4bb6-b6e2-92c8e4f24508@googlegroups.com>
Message-ID: <50EB6CA9.5010100@rabbitmq.com>

On 08/01/13 00:34, CJ wrote:
> I have my producer send another 100 messages.
> But this time I have the consumer only read 50 persistent messages with
> a txcommit.
> I read in all of the first 50 messages correctly.
> So I run the consumer again, hoping to get the next 50, but this time it
> does not see any persistent Tx on the Q, and receive zero messages.

 From http://www.rabbitmq.com/semantics.html#tx
<quote>
AMQP transactions only apply to publishes and acks. [...] On the 
consuming side, the acknowledgements are transactional, not the 
consuming of the messages themselves.
</quote>

So for your test to work the way you expect, it needs to a) consume in 
ack-mode, and b) ack all the received messages, before issuing the 
tx.commit.

As an aside, the tx mode doesn't actually buy you much on the consuming 
side; you are probably better off consuming & ack'ing on a 
non-transactional channel. And on the producing side 'confirms' 
(http://www.rabbitmq.com/confirms.html) are more efficient than 
transactions and provide most of the same guarantees.

Regards,

Matthias.

From Petr.Gotthard at Honeywell.com  Tue Jan  8 08:14:25 2013
From: Petr.Gotthard at Honeywell.com (Gotthard, Petr)
Date: Tue, 8 Jan 2013 08:14:25 +0000
Subject: [rabbitmq-discuss] .NET client with 0-9-1 protocol is sending
 the AMQP 0-8 header
In-Reply-To: <50EB190B.5010401@rabbitmq.com>
References: <F9E85480F62349458DF67CE8BA000D8D2A63984E@FR44EX3005.global.ds.honeywell.com>
	<50EB190B.5010401@rabbitmq.com>
Message-ID: <F9E85480F62349458DF67CE8BA000D8D2A6399F7@FR44EX3005.global.ds.honeywell.com>

Matthias,
at least the .NET client sends a different header than the Erlang client, although RabbitMQ indicates both connections are using AMQP 0-9-1.

The Erlang client (by default, without any protocol switching) sends "AMQP 0x00 0x00 0x09 0x01", which is a protocol header for AMQP 0-9-1 (based on http://www.rabbitmq.com/resources/specs/amqp0-9-1.pdf). This is as expected.

However, the .NET client (by default, but also when 0-9-1 is set explicitly) sends "AMQP 0x01 0x01 0x09 0x01", which is a protocol header for AMQP 0-8 (http://www.rabbitmq.com/resources/specs/amqp0-8.pdf). I believe this is wrong.


How shall I prove it? ;-) Attached is a Wireshark screenshot from Erlang and .NET communication. Do I do something wrong? Did I miss some errata to the standard?

I thought I use the wrong protocol, so I did set it explicitly by:
            ConnectionFactory factory = new ConnectionFactory();
            factory.Protocol = Protocols.AMQP_0_9_1;

but the outcome was the same as before. I use the .NET client from August 2012 (version 2.8.5).

Please note that I manually inspect all the protocol frames and the rest of the communication does (seem to) match the 0-9-1 specification also for the .NET client. It's only the header which is.... different.

Are you sure there cannot be a bug?


Regards,
Petr

-----Original Message-----
From: Matthias Radestock [mailto:matthias at rabbitmq.com] 
Sent: 7. ledna 2013 19:51
To: Discussions about RabbitMQ
Cc: Gotthard, Petr
Subject: Re: [rabbitmq-discuss] .NET client with 0-9-1 protocol is sending the AMQP 0-8 header

Petr,

On 07/01/13 18:33, Gotthard, Petr wrote:
> I believe the .NET client is sending wrong AMQP header (the very first 8
> octets).

I can assure you it is not, unless you are using a truly ancient client 
which pre-dates 0-9-1.

> When I set the protocol to 0-9-1

How are you doing that? The .net client is in fact selecting 0-9-1 by 
default, so this step shouldn't be necessary.

Regards,

Matthias.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: erlang.png
Type: image/png
Size: 62542 bytes
Desc: erlang.png
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130108/7fed64d5/attachment.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: dotnet.png
Type: image/png
Size: 62289 bytes
Desc: dotnet.png
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130108/7fed64d5/attachment-0001.png>

From simon at rabbitmq.com  Tue Jan  8 09:16:55 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 08 Jan 2013 09:16:55 +0000
Subject: [rabbitmq-discuss] rabbit_auth_backend_ldap and Active Directory
In-Reply-To: <8F348D9D79ADA24993FCE45FE44F16240271B444AA4B@exchange01.corp.corenap.com>
References: <8F348D9D79ADA24993FCE45FE44F16240271B444AA4B@exchange01.corp.corenap.com>
Message-ID: <50EBE407.5050001@rabbitmq.com>

Hi. dn_lookup_base and dn_lookup_attribute should do what you want. I 
would expect something like:

  {dn_lookup_base,      "OU=Users,DC=corp,DC=example,DC=com"},
  {dn_lookup_attribute, "sAMAccountName"}

should work.

Do the logs (in 'network' mode) not show a search after the bind?

If not: which version of RabbitMQ are you using? Can you post your 
config, and a screenshot or similar showing your account in AD?

Cheers, Simon

On 07/01/2013 10:45PM, Matt Bradbury wrote:
> All/Simon?
>
> I?m new to the RabbitMQ world and like the product, but I?m about to
> pull my hair out on AD authentication.
>
> So, I?m looking to authorize with my unix username which are the same as
> our windows logins.
>
> I?m having a lot of trouble getting the DNs to play nice.  Since my DN
> has my fullname as the cn part, I don?t know how to map the username to
> the full name.
>
> If I login with my full name ?Matt Bradbury? so that my full user_dn
> matches my group structure, it works just fine.
>
> i.e.  {user_dn_pattern,
> "CN=${username},OU=Users,DC=corp,DC=example,DC=com"},
>
> To use my unix name I have to use: {user_dn_pattern,
> "${username}@CORP"},
>
> This lets me login, but I?m then unable to match the DN with my groups
> since they use my full name in the DN.
>
> Does anyone have a nice little recipe that lets me login with my
> shortname, which corresponds to the sAMAccountName attribute in AD LDAP?
>
> Also, I can?t seem to get dn_lookup_base or dn_lookup_attribute to make
> any difference to the LDAP queries when I look at the logs.  I feel like
> the solution is with these commands but I think I?m missing something here.
>
> Is there a way to search for a DN from the sAMAccountName when I do
> resource_access_query?
>
> FYI, I?m using other_bind for directory lookups after the login check.
>
> Thank you for your time.
>
> -Matt
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From armsargis at gmail.com  Tue Jan  8 09:27:18 2013
From: armsargis at gmail.com (Sargis Harutyunyan)
Date: Tue, 8 Jan 2013 01:27:18 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ 3.0.1,
	Erlang R15B03  Management plugin error
Message-ID: <5dcf9e49-9aa0-4320-849f-76c0ea6960c4@googlegroups.com>

Hi I am trying to view messages in queues(or publish) 
using management plugin and have following errors

=ERROR REPORT==== 8-Jan-2013::11:17:06 ===
webmachine error: path="/api/queues/%2Ftwm/sad.reftables"
{error,
    {badmatch,
        {error,
            {'EXIT',
                {{case_clause,
                     {amqp_params_direct,<<"admin">>,<<"admin123">>,
                         <<"/twm">>,rabbit at sargis,none,[]}},
                 [{amqp_connection_sup,start_link,1,
                      [{file,"src/amqp_connection_sup.erl"},{line,34}]},
                  {supervisor2,do_start_child_i,3,[]},
                  {supervisor2,handle_call,3,[]},
                  {gen_server,handle_msg,5,
                      [{file,"gen_server.erl"},{line,588}]},
                  {proc_lib,init_p_do_apply,3,
                      [{file,"proc_lib.erl"},{line,227}]}]}}}},
    
[{amqp_connection,start,1,[{file,"src/amqp_connection.erl"},{line,159}]},
     {rabbit_mgmt_util,with_channel,5,[]},
     {webmachine_resource,resource_call,3,[]},
     {webmachine_resource,do,3,[]},
     {webmachine_decision_core,resource_call,1,[]},
     {webmachine_decision_core,decision,1,[]},
     {webmachine_decision_core,handle_request,2,[]},
     {rabbit_webmachine,'-makeloop/1-fun-0-',2,[]}]}

=ERROR REPORT==== 8-Jan-2013::11:20:55 ===
webmachine error: path="/api/queues/%2Ftwm/sad.callback/get"
{error,
    {error,
        {badmatch,
            {error,
                {'EXIT',
                    {{case_clause,
                         {amqp_params_direct,<<"admin">>,<<"admin123">>,
                             <<"/twm">>,rabbit at sargis,none,[]}},
                     [{amqp_connection_sup,start_link,1,
                          [{file,"src/amqp_connection_sup.erl"},{line,34}]},
                      {supervisor2,do_start_child_i,3,[]},
                      {supervisor2,handle_call,3,[]},
                      {gen_server,handle_msg,5,
                          [{file,"gen_server.erl"},{line,588}]},
                      {proc_lib,init_p_do_apply,3,
                          [{file,"proc_lib.erl"},{line,227}]}]}}}},
        [{amqp_connection,start,1,
             [{file,"src/amqp_connection.erl"},{line,159}]},
         {rabbit_mgmt_util,with_channel,5,[]},
         {rabbit_mgmt_util,with_decode,5,[]},
         {rabbit_mgmt_wm_queue_get,process_post,2,[]},
         {webmachine_resource,resource_call,3,[]},
         {webmachine_resource,do,3,[]},
         {webmachine_decision_core,resource_call,1,[]},
         {webmachine_decision_core,decision,1,[]}]}}

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130108/74086567/attachment.htm>

From kfuglsang at gmail.com  Tue Jan  8 07:41:37 2013
From: kfuglsang at gmail.com (Kenneth Fuglsang)
Date: Mon, 7 Jan 2013 23:41:37 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ 3.0.1 crash badmatch
Message-ID: <d7a5a29a-0f7d-4f6a-a3da-74d96acb8848@googlegroups.com>

I'm running RabbitMQ 3.0.1 on a Windows Server 2008 x64 machine with Erlang 
R15B01, but from time to time RabbitMQ crashes and corrupts its database.

When starting, I get the following error in my log file.

Error description:
   {could_not_start,rabbit,
    {bad_return,
     {{rabbit,start,[normal,[]]},
      {'EXIT',
       {rabbit,failure_during_boot,
        {badmatch,
         {error,
          {{{function_clause,
             [{rabbit_queue_index,journal_minus_segment1,
               [{no_pub,no_del,ack},undefined],
               []},
              {rabbit_queue_index,'-journal_minus_segment/2-fun-0-',4,[]},
              {array,sparse_foldl_3,7,[{file,"array.erl"},{line,1675}]},
              {array,sparse_foldl_2,9,[{file,"array.erl"},{line,1669}]},
              {rabbit_queue_index,'-recover_journal/1-fun-0-',1,[]},
              {lists,map,2,[{file,"lists.erl"},{line,1173}]},
              {rabbit_queue_index,segment_map,2,[]},
              {rabbit_queue_index,recover_journal,1,[]}]},
            {gen_server2,call,[<0.211.0>,out,infinity]}},
           {child,undefined,msg_store_persistent,
            {rabbit_msg_store,start_link,
             [msg_store_persistent,
              
"c:/Users/RabbitUser/AppData/Roaming/RabbitMQ/db/rabbit at RH-PORTAL-mnesia",
              [],
              {#Fun<rabbit_queue_index.2.89252852>,
               {start,
                
[{resource,<<"rexholmmcb">>,queue,<<"DynamicsNav_control">>},
                 {resource,<<"rexholmmcb">>,queue,
                  <<"RexholmService_control">>},
                 {resource,<<"rexholmmcb">>,queue,<<"RexholmService">>},
                 {resource,<<"rexholmmcb">>,queue,<<"DynamicsNav">>},
                 {resource,<<"rexholmmcb">>,queue,<<"McbService">>},
                 {resource,<<"rexholmmcb">>,queue,<<"McbService_error">>},
                 {resource,<<"rexholmmcb">>,queue,
                  <<"McbService_control">>}]}}]},
            transient,4294967295,worker,
            [rabbit_msg_store]}}}}}}}}}

Log files (may contain more information):
   C:/Users/RabbitUser/AppData/Roaming/RabbitMQ/log/rabbit at RH-PORTAL.log
  
 C:/Users/RabbitUser/AppData/Roaming/RabbitMQ/log/rabbit at RH-PORTAL-sasl.log

Just before that badmatch error, I have these two entries in the log:
=ERROR REPORT==== 7-Jan-2013::13:50:35 ===
** Generic server <0.165.0> terminating
** Last message in was {'$gen_cast',
                           {submit_async,
                               #Fun<rabbit_queue_index.26.17658518>}}
** When Server state == 1
** Reason for termination == 
** {function_clause,
       [{rabbit_queue_index,journal_minus_segment1,
            [{no_pub,no_del,ack},undefined],
            []},
        {rabbit_queue_index,'-journal_minus_segment/2-fun-0-',4,[]},
        {array,sparse_foldl_3,7,[{file,"array.erl"},{line,1675}]},
        {array,sparse_foldl_2,9,[{file,"array.erl"},{line,1669}]},
        {rabbit_queue_index,'-recover_journal/1-fun-0-',1,[]},
        {lists,map,2,[{file,"lists.erl"},{line,1173}]},
        {rabbit_queue_index,segment_map,2,[]},
        {rabbit_queue_index,recover_journal,1,[]}]}

=ERROR REPORT==== 7-Jan-2013::13:50:35 ===
** Generic server <0.216.0> terminating
** Last message in was {'$gen_cast',
                           {submit_async,
                               #Fun<rabbit_queue_index.26.17658518>}}
** When Server state == 1
** Reason for termination == 
** {noproc,[{erlang,link,[<0.215.0>],[]},
            {rabbit_queue_index,'-queue_index_walker/1-fun-0-',2,[]},
            {worker_pool_worker,handle_cast,2,[]},
            {gen_server2,handle_msg,2,[]},
            
{proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]}

=ERROR REPORT==== 7-Jan-2013::13:50:35 ===
** Generic server <0.217.0> terminating
** Last message in was {'$gen_cast',
                           {submit_async,
                               #Fun<rabbit_queue_index.26.17658518>}}
** When Server state == 2
** Reason for termination == 
** {noproc,[{erlang,link,[<0.215.0>],[]},
            {rabbit_queue_index,'-queue_index_walker/1-fun-0-',2,[]},
            {worker_pool_worker,handle_cast,2,[]},
            {gen_server2,handle_msg,2,[]},
            
{proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]}

Is this a known problem, and what could I do to resolve it?
I don't know how to provoke it. It happens sporadically with several weeks 
between.

Best Regards
Kenneth
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130107/07f82028/attachment.htm>

From kfuglsang at gmail.com  Tue Jan  8 07:45:39 2013
From: kfuglsang at gmail.com (Kenneth Fuglsang)
Date: Mon, 7 Jan 2013 23:45:39 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ 3.0.1 crash badmatch
In-Reply-To: <d7a5a29a-0f7d-4f6a-a3da-74d96acb8848@googlegroups.com>
References: <d7a5a29a-0f7d-4f6a-a3da-74d96acb8848@googlegroups.com>
Message-ID: <39df6782-d63c-4f04-b7f8-e9dbef01f79e@googlegroups.com>

By the way, I was able to get RabbitMQ running again by deleting the queues 
and msg_store_transient directories.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130107/11538ef7/attachment.htm>

From matthias at rabbitmq.com  Tue Jan  8 09:42:54 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 08 Jan 2013 09:42:54 +0000
Subject: [rabbitmq-discuss] .NET client with 0-9-1 protocol is sending
 the AMQP 0-8 header
In-Reply-To: <F9E85480F62349458DF67CE8BA000D8D2A6399F7@FR44EX3005.global.ds.honeywell.com>
References: <F9E85480F62349458DF67CE8BA000D8D2A63984E@FR44EX3005.global.ds.honeywell.com>
	<50EB190B.5010401@rabbitmq.com>
	<F9E85480F62349458DF67CE8BA000D8D2A6399F7@FR44EX3005.global.ds.honeywell.com>
Message-ID: <50EBEA1E.1030406@rabbitmq.com>

Petr,

On 08/01/13 08:14, Gotthard, Petr wrote:
> However, the .NET client (by default, but also when 0-9-1 is set
> explicitly) sends "AMQP 0x01 0x01 0x09 0x01", which is a protocol
> header for AMQP 0-8
> (http://www.rabbitmq.com/resources/specs/amqp0-8.pdf). I believe this
> is wrong.
>
> How shall I prove it? ;-) Attached is a Wireshark screenshot from
> Erlang and .NET communication.

If you look carefully, you'll see it is actually sending 0x01 0x01 0x00 
0x09, which is the protocol header for AMQP 0-9.

So we were both wrong :)

I have filed a bug.

In practical terms this doesn't matter as long as the client is talking 
to rabbit since rabbit will happily accept 0-9 connections and treat 
them as 0-9-1. The wire format is backward compatible between the 
versions so a genuine 0-9 client can connect too.

Regards,

Matthias.

From simon at rabbitmq.com  Tue Jan  8 10:32:29 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 08 Jan 2013 10:32:29 +0000
Subject: [rabbitmq-discuss] RabbitMQ 3.0.1,
 Erlang R15B03  Management plugin error
In-Reply-To: <5dcf9e49-9aa0-4320-849f-76c0ea6960c4@googlegroups.com>
References: <5dcf9e49-9aa0-4320-849f-76c0ea6960c4@googlegroups.com>
Message-ID: <50EBF5BD.7090203@rabbitmq.com>

On 08/01/13 09:27, Sargis Harutyunyan wrote:
> Hi I am trying to view messages in queues(or publish)
> using management plugin and have following errors
>
>                  {{case_clause,
>                       {amqp_params_direct,<<"admin">>,<<"admin123">>,
>                           <<"/twm">>,rabbit at sargis,none,[]}},

That looks like you are somehow using the 3.0.x management plugin 
against the 2.8.x (or earlier) Erlang client. That really should not be 
possible unless you have somehow modified the installation yourself.

How did you install RabbitMQ?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From armsargis at gmail.com  Tue Jan  8 11:15:01 2013
From: armsargis at gmail.com (Sargis)
Date: Tue, 8 Jan 2013 15:15:01 +0400
Subject: [rabbitmq-discuss] RabbitMQ 3.0.1,
 Erlang R15B03 Management plugin error
In-Reply-To: <50EBF5BD.7090203@rabbitmq.com>
References: <5dcf9e49-9aa0-4320-849f-76c0ea6960c4@googlegroups.com>
	<50EBF5BD.7090203@rabbitmq.com>
Message-ID: <CADYjvJSCiCJwAojpZ1ZLAjxWwRv=hTnMMFXc227NAMJBmwSb1g@mail.gmail.com>

I installed using rpm -Uvh and my OS.

sargis at sargis:~> uname -a
Linux sargis.webbfontaine.fr 3.4.11-2.16-desktop #1 SMP PREEMPT Wed Sep 26
17:05:00 UTC 2012 (259fc87) x86_64 x86_64 x86_64 GNU/Linux
sargis at sargis:~>

sargis at sargis:~> cat /etc/SuSE-release
openSUSE 12.2 (x86_64)
VERSION = 12.2
CODENAME = Mantis
sargis at sargis:~>

Willt try to uninstall and install again although I cleaned folder from old
version but still have error:

sargis at sargis:~> tree -L 2 /usr/lib/rabbitmq/
/usr/lib/rabbitmq/
|-- bin
|   |-- rabbitmqctl -> ../lib/rabbitmq_server-3.0.1/sbin/rabbitmqctl
|   |-- rabbitmq-defaults ->
../lib/rabbitmq_server-3.0.1/sbin/rabbitmq-defaults
|   |-- rabbitmq-env -> ../lib/rabbitmq_server-3.0.1/sbin/rabbitmq-env
|   |-- rabbitmq-plugins ->
../lib/rabbitmq_server-3.0.1/sbin/rabbitmq-plugins
|   `-- rabbitmq-server -> ../lib/rabbitmq_server-3.0.1/sbin/rabbitmq-server
`-- lib
    `-- rabbitmq_server-3.0.1

3 directories, 5 files
sargis at sargis:~>




On Tue, Jan 8, 2013 at 2:32 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 08/01/13 09:27, Sargis Harutyunyan wrote:
>
>> Hi I am trying to view messages in queues(or publish)
>> using management plugin and have following errors
>>
>>                  {{case_clause,
>>                       {amqp_params_direct,<<"admin">**>,<<"admin123">>,
>>                           <<"/twm">>,rabbit at sargis,none,**[]}},
>>
>
> That looks like you are somehow using the 3.0.x management plugin against
> the 2.8.x (or earlier) Erlang client. That really should not be possible
> unless you have somehow modified the installation yourself.
>
> How did you install RabbitMQ?
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130108/7af1fe00/attachment.htm>

From simon at rabbitmq.com  Tue Jan  8 11:19:48 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 08 Jan 2013 11:19:48 +0000
Subject: [rabbitmq-discuss] RabbitMQ 3.0.1,
 Erlang R15B03 Management plugin error
In-Reply-To: <CADYjvJSCiCJwAojpZ1ZLAjxWwRv=hTnMMFXc227NAMJBmwSb1g@mail.gmail.com>
References: <5dcf9e49-9aa0-4320-849f-76c0ea6960c4@googlegroups.com>
	<50EBF5BD.7090203@rabbitmq.com>
	<CADYjvJSCiCJwAojpZ1ZLAjxWwRv=hTnMMFXc227NAMJBmwSb1g@mail.gmail.com>
Message-ID: <50EC00D4.8080302@rabbitmq.com>

It would be interesting to see the contents of

   /usr/lib/rabbitmq/lib/rabbitmq_server-3.0.1/plugins/

Cheers, Simon

On 08/01/13 11:15, Sargis wrote:
> I installed using rpm -Uvh and my OS.
>
> sargis at sargis:~> uname -a
> Linux sargis.webbfontaine.fr <http://sargis.webbfontaine.fr>
> 3.4.11-2.16-desktop #1 SMP PREEMPT Wed Sep 26 17:05:00 UTC 2012
> (259fc87) x86_64 x86_64 x86_64 GNU/Linux
> sargis at sargis:~>
>
> sargis at sargis:~> cat /etc/SuSE-release
> openSUSE 12.2 (x86_64)
> VERSION = 12.2
> CODENAME = Mantis
> sargis at sargis:~>
>
> Willt try to uninstall and install again although I cleaned folder from
> old version but still have error:
>
> sargis at sargis:~> tree -L 2 /usr/lib/rabbitmq/
> /usr/lib/rabbitmq/
> |-- bin
> |   |-- rabbitmqctl -> ../lib/rabbitmq_server-3.0.1/sbin/rabbitmqctl
> |   |-- rabbitmq-defaults ->
> ../lib/rabbitmq_server-3.0.1/sbin/rabbitmq-defaults
> |   |-- rabbitmq-env -> ../lib/rabbitmq_server-3.0.1/sbin/rabbitmq-env
> |   |-- rabbitmq-plugins ->
> ../lib/rabbitmq_server-3.0.1/sbin/rabbitmq-plugins
> |   `-- rabbitmq-server -> ../lib/rabbitmq_server-3.0.1/sbin/rabbitmq-server
> `-- lib
>      `-- rabbitmq_server-3.0.1
>
> 3 directories, 5 files
> sargis at sargis:~>
>
>
>
>
> On Tue, Jan 8, 2013 at 2:32 PM, Simon MacMullen <simon at rabbitmq.com
> <mailto:simon at rabbitmq.com>> wrote:
>
>     On 08/01/13 09:27, Sargis Harutyunyan wrote:
>
>         Hi I am trying to view messages in queues(or publish)
>         using management plugin and have following errors
>
>                           {{case_clause,
>
>         {amqp_params_direct,<<"admin">__>,<<"admin123">>,
>                                    <<"/twm">>,rabbit at sargis,none,__[]}},
>
>
>     That looks like you are somehow using the 3.0.x management plugin
>     against the 2.8.x (or earlier) Erlang client. That really should not
>     be possible unless you have somehow modified the installation yourself.
>
>     How did you install RabbitMQ?
>
>     Cheers, Simon
>
>     --
>     Simon MacMullen
>     RabbitMQ, VMware
>
>


-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Tue Jan  8 11:22:48 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 08 Jan 2013 11:22:48 +0000
Subject: [rabbitmq-discuss] RabbitMQ 3.0.1 crash badmatch
In-Reply-To: <d7a5a29a-0f7d-4f6a-a3da-74d96acb8848@googlegroups.com>
References: <d7a5a29a-0f7d-4f6a-a3da-74d96acb8848@googlegroups.com>
Message-ID: <50EC0188.1000406@rabbitmq.com>


Hi Kenneth,

On 08/01/13 07:41, Kenneth Fuglsang wrote:
> I'm running RabbitMQ 3.0.1 on a Windows Server 2008 x64 machine with
> Erlang R15B01, but from time to time RabbitMQ crashes and corrupts its
> database.

>           {{{function_clause,
>              [{rabbit_queue_index,journal_minus_segment1,
>                [{no_pub,no_del,ack},undefined],
>                []},
>               {rabbit_queue_index,'-journal_minus_segment/2-fun-0-',4,[]},

> Is this a known problem, and what could I do to resolve it?
> I don't know how to provoke it. It happens sporadically with several
> weeks between.

This is not a known problem. In order to investigate further it will be
useful to get a copy of the entire mnesia database directory as well as
the output of "rabbitmqctl report" and complete logfiles. Please feel
free to contact me off-list to arrange.

Can you rule out any other process tampering with the files in the
mnesia database directory? Errors like the one you report are possible
if any other process makes any changes to the files in that directory.
If there is any filesystem corruption or issues with the storage
hardware then problems are also possible.




-Emile











From armsargis at gmail.com  Tue Jan  8 11:22:52 2013
From: armsargis at gmail.com (Sargis)
Date: Tue, 8 Jan 2013 15:22:52 +0400
Subject: [rabbitmq-discuss] RabbitMQ 3.0.1,
 Erlang R15B03 Management plugin error
In-Reply-To: <50EC00D4.8080302@rabbitmq.com>
References: <5dcf9e49-9aa0-4320-849f-76c0ea6960c4@googlegroups.com>
	<50EBF5BD.7090203@rabbitmq.com>
	<CADYjvJSCiCJwAojpZ1ZLAjxWwRv=hTnMMFXc227NAMJBmwSb1g@mail.gmail.com>
	<50EC00D4.8080302@rabbitmq.com>
Message-ID: <CADYjvJQFGxj03Dy7jrx4_bZ8Jw3bvBhs1XRFO+gdx-bibVasOw@mail.gmail.com>

sargis:~ # tree  /usr/lib/rabbitmq/lib/rabbitmq_server-3.0.1/plugins/
/usr/lib/rabbitmq/lib/rabbitmq_server-3.0.1/plugins/
??? amqp_client-3.0.1.ez
??? cowboy-0.5.0-rmq3.0.1-git4b93c2d.ez
??? eldap-3.0.1-gite309de4.ez
??? mochiweb-2.3.1-rmq3.0.1-gitd541e9a.ez
??? rabbitmq_auth_backend_ldap-3.0.1.ez
??? rabbitmq_auth_mechanism_ssl-3.0.1.ez
??? rabbitmq_consistent_hash_exchange-3.0.1.ez
??? rabbitmq_federation-3.0.1.ez
??? rabbitmq_federation_management-3.0.1.ez
??? rabbitmq_jsonrpc-3.0.1.ez
??? rabbitmq_jsonrpc_channel-3.0.1.ez
??? rabbitmq_jsonrpc_channel_examples-3.0.1.ez
??? rabbitmq_management-3.0.1.ez
??? rabbitmq_management_agent-3.0.1.ez
??? rabbitmq_management_visualiser-3.0.1.ez
??? rabbitmq_mochiweb-3.0.1.ez
??? rabbitmq_mqtt-3.0.1.ez
??? rabbitmq_old_federation-3.0.1.ez
??? rabbitmq_shovel-3.0.1.ez
??? rabbitmq_shovel_management-3.0.1.ez
??? rabbitmq_stomp-3.0.1.ez
??? rabbitmq_tracing-3.0.1.ez
??? rabbitmq_web_stomp-3.0.1.ez
??? rabbitmq_web_stomp_examples-3.0.1.ez
??? README
??? rfc4627_jsonrpc-3.0.1-git7ab174b.ez
??? sockjs-0.3.3-rmq3.0.1-git92d4ba4.ez
??? webmachine-1.9.1-rmq3.0.1-git52e62bc.ez

0 directories, 28 files
sargis:~ #


On Tue, Jan 8, 2013 at 3:19 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> /usr/lib/rabbitmq/lib/**rabbitmq_server-3.0.1/plugins/




On Tue, Jan 8, 2013 at 3:19 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> It would be interesting to see the contents of
>
>   /usr/lib/rabbitmq/lib/**rabbitmq_server-3.0.1/plugins/
>
> Cheers, Simon
>
>
> On 08/01/13 11:15, Sargis wrote:
>
>> I installed using rpm -Uvh and my OS.
>>
>> sargis at sargis:~> uname -a
>> Linux sargis.webbfontaine.fr <http://sargis.webbfontaine.fr**>
>>
>> 3.4.11-2.16-desktop #1 SMP PREEMPT Wed Sep 26 17:05:00 UTC 2012
>> (259fc87) x86_64 x86_64 x86_64 GNU/Linux
>> sargis at sargis:~>
>>
>> sargis at sargis:~> cat /etc/SuSE-release
>> openSUSE 12.2 (x86_64)
>> VERSION = 12.2
>> CODENAME = Mantis
>> sargis at sargis:~>
>>
>> Willt try to uninstall and install again although I cleaned folder from
>> old version but still have error:
>>
>> sargis at sargis:~> tree -L 2 /usr/lib/rabbitmq/
>> /usr/lib/rabbitmq/
>> |-- bin
>> |   |-- rabbitmqctl -> ../lib/rabbitmq_server-3.0.1/**sbin/rabbitmqctl
>> |   |-- rabbitmq-defaults ->
>> ../lib/rabbitmq_server-3.0.1/**sbin/rabbitmq-defaults
>> |   |-- rabbitmq-env -> ../lib/rabbitmq_server-3.0.1/**sbin/rabbitmq-env
>> |   |-- rabbitmq-plugins ->
>> ../lib/rabbitmq_server-3.0.1/**sbin/rabbitmq-plugins
>> |   `-- rabbitmq-server -> ../lib/rabbitmq_server-3.0.1/**
>> sbin/rabbitmq-server
>> `-- lib
>>      `-- rabbitmq_server-3.0.1
>>
>> 3 directories, 5 files
>> sargis at sargis:~>
>>
>>
>>
>>
>> On Tue, Jan 8, 2013 at 2:32 PM, Simon MacMullen <simon at rabbitmq.com
>> <mailto:simon at rabbitmq.com>> wrote:
>>
>>     On 08/01/13 09:27, Sargis Harutyunyan wrote:
>>
>>         Hi I am trying to view messages in queues(or publish)
>>         using management plugin and have following errors
>>
>>                           {{case_clause,
>>
>>         {amqp_params_direct,<<"admin">**__>,<<"admin123">>,
>>                                    <<"/twm">>,rabbit at sargis,none,**
>> __[]}},
>>
>>
>>
>>     That looks like you are somehow using the 3.0.x management plugin
>>     against the 2.8.x (or earlier) Erlang client. That really should not
>>     be possible unless you have somehow modified the installation
>> yourself.
>>
>>     How did you install RabbitMQ?
>>
>>     Cheers, Simon
>>
>>     --
>>     Simon MacMullen
>>     RabbitMQ, VMware
>>
>>
>>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130108/19be3d55/attachment.htm>

From armsargis at gmail.com  Tue Jan  8 11:36:12 2013
From: armsargis at gmail.com (Sargis)
Date: Tue, 8 Jan 2013 15:36:12 +0400
Subject: [rabbitmq-discuss] RabbitMQ 3.0.1,
 Erlang R15B03 Management plugin error
In-Reply-To: <CADYjvJQFGxj03Dy7jrx4_bZ8Jw3bvBhs1XRFO+gdx-bibVasOw@mail.gmail.com>
References: <5dcf9e49-9aa0-4320-849f-76c0ea6960c4@googlegroups.com>
	<50EBF5BD.7090203@rabbitmq.com>
	<CADYjvJSCiCJwAojpZ1ZLAjxWwRv=hTnMMFXc227NAMJBmwSb1g@mail.gmail.com>
	<50EC00D4.8080302@rabbitmq.com>
	<CADYjvJQFGxj03Dy7jrx4_bZ8Jw3bvBhs1XRFO+gdx-bibVasOw@mail.gmail.com>
Message-ID: <CADYjvJRv58beFEVkCA6m-1BTRoWkBOtbwD_BdFg1COCEMBvNBw@mail.gmail.com>

As info if you need to compare:

sargis:/usr/lib/rabbitmq/lib/rabbitmq_server-3.0.1/plugins # md5sum
/usr/lib/rabbitmq/lib/rabbitmq_server-3.0.1/plugins/*
e5b55402e7eb965f9825fd973065a25e
 /usr/lib/rabbitmq/lib/rabbitmq_server-3.0.1/plugins/amqp_client-3.0.1.ez
8ac5e7c1c90e76ffaa56299fe6777615
 /usr/lib/rabbitmq/lib/rabbitmq_server-3.0.1/plugins/cowboy-0.5.0-rmq3.0.1-git4b93c2d.ez
d0ebf2ac977d3ed97e1695ed16b93206
 /usr/lib/rabbitmq/lib/rabbitmq_server-3.0.1/plugins/eldap-3.0.1-gite309de4.ez
1ea2cc034bcacceaed68f9d8d09c102a
 /usr/lib/rabbitmq/lib/rabbitmq_server-3.0.1/plugins/mochiweb-2.3.1-rmq3.0.1-gitd541e9a.ez
e4c9e75a11cbd71fc7252d2ccbbb4347
 /usr/lib/rabbitmq/lib/rabbitmq_server-3.0.1/plugins/rabbitmq_auth_backend_ldap-3.0.1.ez
5cbf3646a8ab698d476f4241170276f8
 /usr/lib/rabbitmq/lib/rabbitmq_server-3.0.1/plugins/rabbitmq_auth_mechanism_ssl-3.0.1.ez
a40de59a4296ad24da5a5b3f92f82312
 /usr/lib/rabbitmq/lib/rabbitmq_server-3.0.1/plugins/rabbitmq_consistent_hash_exchange-3.0.1.ez
b7f13fdd267a724051e426e89725ec23
 /usr/lib/rabbitmq/lib/rabbitmq_server-3.0.1/plugins/rabbitmq_federation-3.0.1.ez
534807b1122723534d73be8b1ae3b94f
 /usr/lib/rabbitmq/lib/rabbitmq_server-3.0.1/plugins/rabbitmq_federation_management-3.0.1.ez
91f45cb577dc1b8e711801546f4c1e64
 /usr/lib/rabbitmq/lib/rabbitmq_server-3.0.1/plugins/rabbitmq_jsonrpc-3.0.1.ez
c2510cbf1afd7ab4190acf480b1f2030
 /usr/lib/rabbitmq/lib/rabbitmq_server-3.0.1/plugins/rabbitmq_jsonrpc_channel-3.0.1.ez
84b44da375bc84d6c935b00cad390114
 /usr/lib/rabbitmq/lib/rabbitmq_server-3.0.1/plugins/rabbitmq_jsonrpc_channel_examples-3.0.1.ez
d7be107d1684ca25a0ced9a59b208298
 /usr/lib/rabbitmq/lib/rabbitmq_server-3.0.1/plugins/rabbitmq_management-3.0.1.ez
3bc8517a4f5c9a9df80d67a4f646b87a
 /usr/lib/rabbitmq/lib/rabbitmq_server-3.0.1/plugins/rabbitmq_management_agent-3.0.1.ez
82763aef88a80ee05ca536148647c08d
 /usr/lib/rabbitmq/lib/rabbitmq_server-3.0.1/plugins/rabbitmq_management_visualiser-3.0.1.ez
4c09e5cbf23b781dc944d48e11de1cf3
 /usr/lib/rabbitmq/lib/rabbitmq_server-3.0.1/plugins/rabbitmq_mochiweb-3.0.1.ez
89c92ff80c07186f10d7917bcc4ebcdc
 /usr/lib/rabbitmq/lib/rabbitmq_server-3.0.1/plugins/rabbitmq_mqtt-3.0.1.ez
6c33546e12adfe1902b7993a6e172c0d
 /usr/lib/rabbitmq/lib/rabbitmq_server-3.0.1/plugins/rabbitmq_old_federation-3.0.1.ez
2cf96f79a45cdf9aa2b19bb53ed25783
 /usr/lib/rabbitmq/lib/rabbitmq_server-3.0.1/plugins/rabbitmq_shovel-3.0.1.ez
9c48649b6c03355a37a5d288fc7d4d60
 /usr/lib/rabbitmq/lib/rabbitmq_server-3.0.1/plugins/rabbitmq_shovel_management-3.0.1.ez
a57f9d204f6e11f5e7f8cf08ab19e04a
 /usr/lib/rabbitmq/lib/rabbitmq_server-3.0.1/plugins/rabbitmq_stomp-3.0.1.ez
dd1fcc2ffb29ede8137533fa994e23fd
 /usr/lib/rabbitmq/lib/rabbitmq_server-3.0.1/plugins/rabbitmq_tracing-3.0.1.ez
a958ca2ff0470640bfab852dab358c35
 /usr/lib/rabbitmq/lib/rabbitmq_server-3.0.1/plugins/rabbitmq_web_stomp-3.0.1.ez
3e64a59f05b8091edeee61d84e05e54d
 /usr/lib/rabbitmq/lib/rabbitmq_server-3.0.1/plugins/rabbitmq_web_stomp_examples-3.0.1.ez
5fb06a5758105df640b9d08eb1451364
 /usr/lib/rabbitmq/lib/rabbitmq_server-3.0.1/plugins/README
99007a8a818e726d1cffe706fc2c4f6b
 /usr/lib/rabbitmq/lib/rabbitmq_server-3.0.1/plugins/rfc4627_jsonrpc-3.0.1-git7ab174b.ez
f8d68e1b2b2a15fb72c06860e91f7cf1
 /usr/lib/rabbitmq/lib/rabbitmq_server-3.0.1/plugins/sockjs-0.3.3-rmq3.0.1-git92d4ba4.ez
5e77be58c8af8c321cbe032861db5f52
 /usr/lib/rabbitmq/lib/rabbitmq_server-3.0.1/plugins/webmachine-1.9.1-rmq3.0.1-git52e62bc.ez
sargis:/usr/lib/rabbitmq/lib/rabbitmq_server-3.0.1/plugins #



On Tue, Jan 8, 2013 at 3:22 PM, Sargis <armsargis at gmail.com> wrote:

> sargis:~ # tree  /usr/lib/rabbitmq/lib/rabbitmq_server-3.0.1/plugins/
> /usr/lib/rabbitmq/lib/rabbitmq_server-3.0.1/plugins/
> ??? amqp_client-3.0.1.ez
> ??? cowboy-0.5.0-rmq3.0.1-git4b93c2d.ez
> ??? eldap-3.0.1-gite309de4.ez
> ??? mochiweb-2.3.1-rmq3.0.1-gitd541e9a.ez
> ??? rabbitmq_auth_backend_ldap-3.0.1.ez
> ??? rabbitmq_auth_mechanism_ssl-3.0.1.ez
> ??? rabbitmq_consistent_hash_exchange-3.0.1.ez
> ??? rabbitmq_federation-3.0.1.ez
> ??? rabbitmq_federation_management-3.0.1.ez
> ??? rabbitmq_jsonrpc-3.0.1.ez
> ??? rabbitmq_jsonrpc_channel-3.0.1.ez
> ??? rabbitmq_jsonrpc_channel_examples-3.0.1.ez
> ??? rabbitmq_management-3.0.1.ez
> ??? rabbitmq_management_agent-3.0.1.ez
> ??? rabbitmq_management_visualiser-3.0.1.ez
> ??? rabbitmq_mochiweb-3.0.1.ez
> ??? rabbitmq_mqtt-3.0.1.ez
> ??? rabbitmq_old_federation-3.0.1.ez
> ??? rabbitmq_shovel-3.0.1.ez
> ??? rabbitmq_shovel_management-3.0.1.ez
> ??? rabbitmq_stomp-3.0.1.ez
> ??? rabbitmq_tracing-3.0.1.ez
> ??? rabbitmq_web_stomp-3.0.1.ez
> ??? rabbitmq_web_stomp_examples-3.0.1.ez
> ??? README
> ??? rfc4627_jsonrpc-3.0.1-git7ab174b.ez
> ??? sockjs-0.3.3-rmq3.0.1-git92d4ba4.ez
> ??? webmachine-1.9.1-rmq3.0.1-git52e62bc.ez
>
> 0 directories, 28 files
> sargis:~ #
>
>
> On Tue, Jan 8, 2013 at 3:19 PM, Simon MacMullen <simon at rabbitmq.com>
>  wrote:
>
>> /usr/lib/rabbitmq/lib/**rabbitmq_server-3.0.1/plugins/
>
>
>
>
> On Tue, Jan 8, 2013 at 3:19 PM, Simon MacMullen <simon at rabbitmq.com>wrote:
>
>> It would be interesting to see the contents of
>>
>>   /usr/lib/rabbitmq/lib/**rabbitmq_server-3.0.1/plugins/
>>
>> Cheers, Simon
>>
>>
>> On 08/01/13 11:15, Sargis wrote:
>>
>>> I installed using rpm -Uvh and my OS.
>>>
>>> sargis at sargis:~> uname -a
>>> Linux sargis.webbfontaine.fr <http://sargis.webbfontaine.fr**>
>>>
>>> 3.4.11-2.16-desktop #1 SMP PREEMPT Wed Sep 26 17:05:00 UTC 2012
>>> (259fc87) x86_64 x86_64 x86_64 GNU/Linux
>>> sargis at sargis:~>
>>>
>>> sargis at sargis:~> cat /etc/SuSE-release
>>> openSUSE 12.2 (x86_64)
>>> VERSION = 12.2
>>> CODENAME = Mantis
>>> sargis at sargis:~>
>>>
>>> Willt try to uninstall and install again although I cleaned folder from
>>> old version but still have error:
>>>
>>> sargis at sargis:~> tree -L 2 /usr/lib/rabbitmq/
>>> /usr/lib/rabbitmq/
>>> |-- bin
>>> |   |-- rabbitmqctl -> ../lib/rabbitmq_server-3.0.1/**sbin/rabbitmqctl
>>> |   |-- rabbitmq-defaults ->
>>> ../lib/rabbitmq_server-3.0.1/**sbin/rabbitmq-defaults
>>> |   |-- rabbitmq-env -> ../lib/rabbitmq_server-3.0.1/**sbin/rabbitmq-env
>>> |   |-- rabbitmq-plugins ->
>>> ../lib/rabbitmq_server-3.0.1/**sbin/rabbitmq-plugins
>>> |   `-- rabbitmq-server -> ../lib/rabbitmq_server-3.0.1/**
>>> sbin/rabbitmq-server
>>> `-- lib
>>>      `-- rabbitmq_server-3.0.1
>>>
>>> 3 directories, 5 files
>>> sargis at sargis:~>
>>>
>>>
>>>
>>>
>>> On Tue, Jan 8, 2013 at 2:32 PM, Simon MacMullen <simon at rabbitmq.com
>>> <mailto:simon at rabbitmq.com>> wrote:
>>>
>>>     On 08/01/13 09:27, Sargis Harutyunyan wrote:
>>>
>>>         Hi I am trying to view messages in queues(or publish)
>>>         using management plugin and have following errors
>>>
>>>                           {{case_clause,
>>>
>>>         {amqp_params_direct,<<"admin">**__>,<<"admin123">>,
>>>                                    <<"/twm">>,rabbit at sargis,none,**
>>> __[]}},
>>>
>>>
>>>
>>>     That looks like you are somehow using the 3.0.x management plugin
>>>     against the 2.8.x (or earlier) Erlang client. That really should not
>>>     be possible unless you have somehow modified the installation
>>> yourself.
>>>
>>>     How did you install RabbitMQ?
>>>
>>>     Cheers, Simon
>>>
>>>     --
>>>     Simon MacMullen
>>>     RabbitMQ, VMware
>>>
>>>
>>>
>>
>> --
>> Simon MacMullen
>> RabbitMQ, VMware
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130108/c4e249b7/attachment.htm>

From matthias at rabbitmq.com  Tue Jan  8 11:41:31 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 08 Jan 2013 11:41:31 +0000
Subject: [rabbitmq-discuss] RabbitMQ 3.0.1,
 Erlang R15B03 Management plugin error
In-Reply-To: <50EC00D4.8080302@rabbitmq.com>
References: <5dcf9e49-9aa0-4320-849f-76c0ea6960c4@googlegroups.com>
	<50EBF5BD.7090203@rabbitmq.com>
	<CADYjvJSCiCJwAojpZ1ZLAjxWwRv=hTnMMFXc227NAMJBmwSb1g@mail.gmail.com>
	<50EC00D4.8080302@rabbitmq.com>
Message-ID: <50EC05EB.6060702@rabbitmq.com>

On 08/01/13 11:19, Simon MacMullen wrote:
> It would be interesting to see the contents of
>
>    /usr/lib/rabbitmq/lib/rabbitmq_server-3.0.1/plugins/

...and the output of 'rabbitmqctl status'.

Matthias.

From armsargis at gmail.com  Tue Jan  8 11:44:02 2013
From: armsargis at gmail.com (Sargis)
Date: Tue, 8 Jan 2013 15:44:02 +0400
Subject: [rabbitmq-discuss] RabbitMQ 3.0.1,
 Erlang R15B03 Management plugin error
In-Reply-To: <50EC05EB.6060702@rabbitmq.com>
References: <5dcf9e49-9aa0-4320-849f-76c0ea6960c4@googlegroups.com>
	<50EBF5BD.7090203@rabbitmq.com>
	<CADYjvJSCiCJwAojpZ1ZLAjxWwRv=hTnMMFXc227NAMJBmwSb1g@mail.gmail.com>
	<50EC00D4.8080302@rabbitmq.com> <50EC05EB.6060702@rabbitmq.com>
Message-ID: <CADYjvJQumzjvSiN3HTQbhZ4egEXrs3CHXDHYDMfB-g4BY0c4Wg@mail.gmail.com>

sargis:/usr/lib/rabbitmq/lib/rabbitmq_server-3.0.1/plugins # rabbitmqctl
status
Status of node rabbit at sargis ...
[{pid,26577},
 {running_applications,
     [{rabbitmq_management,"RabbitMQ Management Console","3.0.1"},
      {rabbitmq_management_agent,"RabbitMQ Management Agent","3.0.1"},
      {rabbit,"RabbitMQ","3.0.1"},
      {os_mon,"CPO  CXC 138 46","2.2.10"},
      {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","3.0.1"},
      {webmachine,"webmachine","1.9.1-rmq3.0.1-git52e62bc"},
      {mochiweb,"MochiMedia Web Server","2.3.1-rmq3.0.1-gitd541e9a"},
      {xmerl,"XML parser","1.3.2"},
      {inets,"INETS  CXC 138 49","5.9.2"},
      {mnesia,"MNESIA  CXC 138 12","4.7.1"},
      {amqp_client,"RabbitMQ AMQP Client","2.8.7"},
      {sasl,"SASL  CXC 138 11","2.2.1"},
      {stdlib,"ERTS  CXC 138 10","1.18.3"},
      {kernel,"ERTS  CXC 138 10","2.15.3"}]},
 {os,{unix,linux}},
 {erlang_version,
     "Erlang R15B03 (erts-5.9.3) [source] [64-bit] [smp:8:8]
[async-threads:30] [hipe] [kernel-poll:true]\n"},
 {memory,
     [{total,35536760},
      {connection_procs,11720},
      {queue_procs,116408},
      {plugins,274800},
      {other_proc,10517976},
      {mnesia,85936},
      {mgmt_db,76512},
      {msg_index,22736},
      {other_ets,1090336},
      {binary,122632},
      {code,18259720},
      {atom,670601},
      {other_system,4287383}]},
 {vm_memory_high_watermark,0.4},
 {vm_memory_limit,3351329177},
 {disk_free_limit,1000000000},
 {disk_free,30633836544},
 {file_descriptors,

 [{total_limit,924},{total_used,12},{sockets_limit,829},{sockets_used,1}]},
 {processes,[{limit,1048576},{used,212}]},
 {run_queue,0},
 {uptime,27}]
...done.
sargis:/usr/lib/rabbitmq/lib/rabbitmq_server-3.0.1/plugins #



On Tue, Jan 8, 2013 at 3:41 PM, Matthias Radestock <matthias at rabbitmq.com>wrote:

> On 08/01/13 11:19, Simon MacMullen wrote:
>
>> It would be interesting to see the contents of
>>
>>    /usr/lib/rabbitmq/lib/**rabbitmq_server-3.0.1/plugins/
>>
>
> ...and the output of 'rabbitmqctl status'.
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130108/0e0afbc4/attachment.htm>

From matthias at rabbitmq.com  Tue Jan  8 11:49:23 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 08 Jan 2013 11:49:23 +0000
Subject: [rabbitmq-discuss] RabbitMQ 3.0.1,
 Erlang R15B03 Management plugin error
In-Reply-To: <CADYjvJQumzjvSiN3HTQbhZ4egEXrs3CHXDHYDMfB-g4BY0c4Wg@mail.gmail.com>
References: <5dcf9e49-9aa0-4320-849f-76c0ea6960c4@googlegroups.com>
	<50EBF5BD.7090203@rabbitmq.com>
	<CADYjvJSCiCJwAojpZ1ZLAjxWwRv=hTnMMFXc227NAMJBmwSb1g@mail.gmail.com>
	<50EC00D4.8080302@rabbitmq.com> <50EC05EB.6060702@rabbitmq.com>
	<CADYjvJQumzjvSiN3HTQbhZ4egEXrs3CHXDHYDMfB-g4BY0c4Wg@mail.gmail.com>
Message-ID: <50EC07C3.7060708@rabbitmq.com>

On 08/01/13 11:44, Sargis wrote:
>        {amqp_client,"RabbitMQ AMQP Client","2.8.7"},

There's your problem.

You must have the 2.8.7 version of the RabbitMQ AMQP Erlang client lying 
around on the Erlang load path. Shouldn't be hard to find; just search 
for 'amqp_client.beam' on your system.

Regards,

Matthias.

From armsargis at gmail.com  Tue Jan  8 11:54:45 2013
From: armsargis at gmail.com (Sargis)
Date: Tue, 8 Jan 2013 15:54:45 +0400
Subject: [rabbitmq-discuss] RabbitMQ 3.0.1,
 Erlang R15B03 Management plugin error
In-Reply-To: <50EC07C3.7060708@rabbitmq.com>
References: <5dcf9e49-9aa0-4320-849f-76c0ea6960c4@googlegroups.com>
	<50EBF5BD.7090203@rabbitmq.com>
	<CADYjvJSCiCJwAojpZ1ZLAjxWwRv=hTnMMFXc227NAMJBmwSb1g@mail.gmail.com>
	<50EC00D4.8080302@rabbitmq.com> <50EC05EB.6060702@rabbitmq.com>
	<CADYjvJQumzjvSiN3HTQbhZ4egEXrs3CHXDHYDMfB-g4BY0c4Wg@mail.gmail.com>
	<50EC07C3.7060708@rabbitmq.com>
Message-ID: <CADYjvJTNer-+dOj3=4QX8OfUC0nX1E0HObJXx488L2dTQcGFsA@mail.gmail.com>

sargis:/usr/lib/rabbitmq # rpm -qa | grep -i rabbit
erlang-rabbitmq-client-2.8.7-17.3.x86_64

^C
sargis:/usr/lib/rabbitmq # rpm -e erlang-rabbitmq-client-2.8.7-17.3.x86_64
sargis:/usr/lib/rabbitmq # service rabbitmq-server restart
sargis:/usr/lib/rabbitmq #

Now its ok thanks a lot :)


On Tue, Jan 8, 2013 at 3:49 PM, Matthias Radestock <matthias at rabbitmq.com>wrote:

> On 08/01/13 11:44, Sargis wrote:
>
>>        {amqp_client,"RabbitMQ AMQP Client","2.8.7"},
>>
>
> There's your problem.
>
> You must have the 2.8.7 version of the RabbitMQ AMQP Erlang client lying
> around on the Erlang load path. Shouldn't be hard to find; just search for
> 'amqp_client.beam' on your system.
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130108/c699e4ed/attachment.htm>

From bmkgeek at gmail.com  Tue Jan  8 11:56:15 2013
From: bmkgeek at gmail.com (B MK)
Date: Tue, 8 Jan 2013 17:26:15 +0530
Subject: [rabbitmq-discuss] Connection error on RabbitMQ consumer behind
	haproxy
Message-ID: <CADD0VadOdz3w3pR_iWSV0=UfQM9_eKmOEk+Br8wAU5WYbu81-Q@mail.gmail.com>

Hello,

I am using rabbit mq cluster. My consumer is connected this cluster via
haproxy.

Consumer raised the following exception connected through the haproxy. If
consumer directly connected to the node will not raise any exceptions.

2013-01-08 16:25:09,745 WARN | SimpleAsyncTaskExecutor-1 |
o.s.amqp.rabbit.listener.SimpleMessageListenerContainer | Consumer raised
exception, processing can restart if the connection factory supports it.
Exception summary: com.rabbitmq.client.ShutdownSignalException: connection
error; reason: java.io.EOFException

See my ha-proxy configuration.

global
    log 127.0.0.1    local0
    log 127.0.0.1    local1 notice
    #log loghost    local0 info
    maxconn 4096
    #chroot /usr/share/haproxy
    user haproxy
    group haproxy
    daemon
    #debug
    #quiet

defaults
    log    global
#    mode    http
#    option    httplog
    option    dontlognull
    retries    3
    option redispatch
    maxconn    5000
    contimeout    10000
    clitimeout    60000
    srvtimeout    60000


listen rabbitmq_producer_cluster 0.0.0.0:5672
    mode tcp
    balance roundrobin

    server rabbit_1 rabbit1:5672 check inter 5000 rise 2 fall 3
    server rabbit_2 rabbit2:5672 check inter 5000 rise 2 fall 3
    #server rabbit_3 rabbit3:5672 check inter 5000 rise 2 fall 3

listen rabbitmq_consumer_cluster 0.0.0.0:5673
    mode tcp
    balance roundrobin
    option tcpka

    server rabbit_1 rabbit1:5672 check inter 5000 rise 2 fall 3
    server rabbit_2 rabbit2:5672 backup check inter 5000 rise 2 fall 3
    #server rabbit_3 rabbit3:5672 check inter 5000 rise 2 fall 3

listen private_monitoring :8100
    mode http
    option httplog
    stats enable
    stats uri   /stats
    stats refresh 5s
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130108/661353de/attachment.htm>

From simon at rabbitmq.com  Tue Jan  8 12:34:06 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 08 Jan 2013 12:34:06 +0000
Subject: [rabbitmq-discuss] RabbitMQ 3.0.1,
 Erlang R15B03 Management plugin error
In-Reply-To: <CADYjvJTNer-+dOj3=4QX8OfUC0nX1E0HObJXx488L2dTQcGFsA@mail.gmail.com>
References: <5dcf9e49-9aa0-4320-849f-76c0ea6960c4@googlegroups.com>
	<50EBF5BD.7090203@rabbitmq.com>
	<CADYjvJSCiCJwAojpZ1ZLAjxWwRv=hTnMMFXc227NAMJBmwSb1g@mail.gmail.com>
	<50EC00D4.8080302@rabbitmq.com> <50EC05EB.6060702@rabbitmq.com>
	<CADYjvJQumzjvSiN3HTQbhZ4egEXrs3CHXDHYDMfB-g4BY0c4Wg@mail.gmail.com>
	<50EC07C3.7060708@rabbitmq.com>
	<CADYjvJTNer-+dOj3=4QX8OfUC0nX1E0HObJXx488L2dTQcGFsA@mail.gmail.com>
Message-ID: <50EC123E.8040707@rabbitmq.com>

On 08/01/13 11:54, Sargis wrote:
> sargis:/usr/lib/rabbitmq # rpm -qa | grep -i rabbit
> erlang-rabbitmq-client-2.8.7-17.3.x86_64

Ah, thank you. Never heard of that one before.

I have filed

https://bugzilla.novell.com/show_bug.cgi?id=797238

against this package.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From videlalvaro at gmail.com  Tue Jan  8 14:35:47 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Tue, 8 Jan 2013 15:35:47 +0100
Subject: [rabbitmq-discuss] RabbitMQ Simulator
Message-ID: <CAMcAHLW6GD+W104xRoJn7VZD=PPbQKEOCNNypfiknfBDVt9RiQ@mail.gmail.com>

Hi,

I'd like to share a sneak peek of a RabbitMQ simulator I've been working on
lately:

https://vimeo.com/56986242

The goal of this app is to use it as a teaching tool for tutorials,
presentations & more. Also it could serve as a topology designer for
messaging applications since it supports exporting the design to RabbitMQ.

I hope to be able to open source it soon.

Regards,

Alvaro
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130108/f278d41d/attachment.htm>

From tim at rabbitmq.com  Tue Jan  8 14:35:42 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 08 Jan 2013 14:35:42 +0000
Subject: [rabbitmq-discuss] RabbitMQ Simulator
In-Reply-To: <CAMcAHLW6GD+W104xRoJn7VZD=PPbQKEOCNNypfiknfBDVt9RiQ@mail.gmail.com>
References: <CAMcAHLW6GD+W104xRoJn7VZD=PPbQKEOCNNypfiknfBDVt9RiQ@mail.gmail.com>
Message-ID: <50EC2EBE.4070703@rabbitmq.com>

Alvaro this is massively cool! :D

On 01/08/2013 02:35 PM, Alvaro Videla wrote:
> Hi,
>
> I'd like to share a sneak peek of a RabbitMQ simulator I've been 
> working on lately:
>
> https://vimeo.com/56986242
>
> The goal of this app is to use it as a teaching tool for tutorials, 
> presentations & more. Also it could serve as a topology designer for 
> messaging applications since it supports exporting the design to RabbitMQ.
>
> I hope to be able to open source it soon.
>
> Regards,
>
> Alvaro
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130108/64a94c22/attachment.htm>

From simon at rabbitmq.com  Tue Jan  8 17:09:59 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 08 Jan 2013 17:09:59 +0000
Subject: [rabbitmq-discuss] Consistent Hash Exchange
In-Reply-To: <CE7FFC70C4C3864CA0CCEA77E53801C60D7CCC@bre-exch02.insurance.financial.local>
References: <7d19f083-9002-4a75-8a6d-53cbe1caaf0d@googlegroups.com>
	<50E70E03.4000306@rabbitmq.com>
	<CE7FFC70C4C3864CA0CCEA77E53801C60D7CCC@bre-exch02.insurance.financial.local>
Message-ID: <50EC52E7.7080507@rabbitmq.com>

On 07/01/13 22:10, Matthew Collinge wrote:
> The way the Consistent Hash Exchange seems to work is that it takes
> the entire routing key and hashes that. Is there a way to make it use
> a segment of the routing key?

Ah, right - I understand what you are doing now.

No, although it wouldn't be too hard to change it. Although I would be 
more inclined to change it to hash off a property / header.

I'll look into this.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From Matthew.Collinge at bglgroup.co.uk  Tue Jan  8 18:26:38 2013
From: Matthew.Collinge at bglgroup.co.uk (Matthew Collinge)
Date: Tue, 8 Jan 2013 18:26:38 +0000
Subject: [rabbitmq-discuss] Consistent Hash Exchange
In-Reply-To: <50EC52E7.7080507@rabbitmq.com>
References: <7d19f083-9002-4a75-8a6d-53cbe1caaf0d@googlegroups.com>
	<50E70E03.4000306@rabbitmq.com>
	<CE7FFC70C4C3864CA0CCEA77E53801C60D7CCC@bre-exch02.insurance.financial.local>
	<50EC52E7.7080507@rabbitmq.com>
Message-ID: <CE7FFC70C4C3864CA0CCEA77E53801C60D9D6B@bre-exch02.insurance.financial.local>

Thanks would be much appreciated.

-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com]
Sent: 08 January 2013 17:10
To: Matthew Collinge
Cc: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Consistent Hash Exchange

On 07/01/13 22:10, Matthew Collinge wrote:
> The way the Consistent Hash Exchange seems to work is that it takes
> the entire routing key and hashes that. Is there a way to make it use
> a segment of the routing key?

Ah, right - I understand what you are doing now.

No, although it wouldn't be too hard to change it. Although I would be more inclined to change it to hash off a property / header.

I'll look into this.

Cheers, Simon

--
Simon MacMullen
RabbitMQ, VMware

________________________________

This message is intended for the stated addressee(s) only and may be confidential. Access to this email by anyone else is unauthorised. Any opinions expressed in this email do not necessarily reflect the opinions of BGL Group Limited and its subsidiaries . Any unauthorised disclosure, use or dissemination, either whole or in part is prohibited. If you are not the intended recipient of this message, please notify the sender immediately.

Please scan all attachments for viruses.

From bradbury at corenap.com  Tue Jan  8 18:51:51 2013
From: bradbury at corenap.com (Matt Bradbury)
Date: Tue, 8 Jan 2013 12:51:51 -0600
Subject: [rabbitmq-discuss] rabbit_auth_backend_ldap and Active Directory
In-Reply-To: <50EBE407.5050001@rabbitmq.com>
References: <8F348D9D79ADA24993FCE45FE44F16240271B444AA4B@exchange01.corp.corenap.com>
	<50EBE407.5050001@rabbitmq.com>
Message-ID: <8F348D9D79ADA24993FCE45FE44F16240271B444AA69@exchange01.corp.corenap.com>

Got it working.

Thought I'd pass along the config I used.  I was not able to login with a user_dn_pattern of just ${username}, so I guess my solution wouldn't do well in a forest of multiple domains, but it works for me.

I hadn't noticed the {log, network}, option before, so that helped in the debugging.

Thanks again.

-Matt

[
{rabbit, [{auth_backends, [rabbit_auth_backend_internal, rabbit_auth_backend_ldap]}]},
  {rabbitmq_auth_backend_ldap,
   [ {servers,               ["xxxx"]},
     {use_ssl,               false},
     {port,                  389},
     {log,                   network},

     {dn_lookup_base,        "DC=corp,DC=example,DC=com"},
     {dn_lookup_attribute,   "userPrincipalName"},
     {user_dn_pattern,       "${username}@corp.example.com"},



     {vhost_access_query,    {in_group,
                              "CN=Domain Admins,CN=Users,DC=corp,DC=example,DC=com"}},
     {resource_access_query,
      {for, [{permission, configure, {in_group, "CN=Domain Admins,CN=Users,DC=corp,DC=example,DC=com"}},
             {permission, write,
              {for, [{resource, queue,    {in_group, "CN=Domain Admins,CN=Users,DC=corp,DC=example,DC=com"}},
                     {resource, exchange, {constant, true}}]}},
             {permission, read,
              {for, [{resource, exchange, {in_group, "CN=Domain Admins,CN=Users,DC=corp,DC=example,DC=com"}},
                     {resource, queue,    {constant, true}}]}}
            ]
      }},
     {tag_queries,           [{administrator, {constant, true}},
                              {management,    {constant, false}}]}
   ]
  }
].

-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: Tuesday, January 08, 2013 3:17 AM
To: Discussions about RabbitMQ
Cc: Matt Bradbury
Subject: Re: [rabbitmq-discuss] rabbit_auth_backend_ldap and Active Directory

Hi. dn_lookup_base and dn_lookup_attribute should do what you want. I would expect something like:

  {dn_lookup_base,      "OU=Users,DC=corp,DC=example,DC=com"},
  {dn_lookup_attribute, "sAMAccountName"}

should work.

Do the logs (in 'network' mode) not show a search after the bind?

If not: which version of RabbitMQ are you using? Can you post your config, and a screenshot or similar showing your account in AD?

Cheers, Simon

On 07/01/2013 10:45PM, Matt Bradbury wrote:
> All/Simon?
>
> I'm new to the RabbitMQ world and like the product, but I'm about to 
> pull my hair out on AD authentication.
>
> So, I'm looking to authorize with my unix username which are the same 
> as our windows logins.
>
> I'm having a lot of trouble getting the DNs to play nice.  Since my DN 
> has my fullname as the cn part, I don't know how to map the username 
> to the full name.
>
> If I login with my full name "Matt Bradbury" so that my full user_dn 
> matches my group structure, it works just fine.
>
> i.e.  {user_dn_pattern,
> "CN=${username},OU=Users,DC=corp,DC=example,DC=com"},
>
> To use my unix name I have to use: {user_dn_pattern, 
> "${username}@CORP"},
>
> This lets me login, but I'm then unable to match the DN with my groups 
> since they use my full name in the DN.
>
> Does anyone have a nice little recipe that lets me login with my 
> shortname, which corresponds to the sAMAccountName attribute in AD LDAP?
>
> Also, I can't seem to get dn_lookup_base or dn_lookup_attribute to 
> make any difference to the LDAP queries when I look at the logs.  I 
> feel like the solution is with these commands but I think I'm missing something here.
>
> Is there a way to search for a DN from the sAMAccountName when I do 
> resource_access_query?
>
> FYI, I'm using other_bind for directory lookups after the login check.
>
> Thank you for your time.
>
> -Matt
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From rmqjava1a at yahoo.com  Tue Jan  8 21:39:37 2013
From: rmqjava1a at yahoo.com (CJ)
Date: Tue, 8 Jan 2013 13:39:37 -0800 (PST)
Subject: [rabbitmq-discuss] Transactions
In-Reply-To: <5cc06b2d-a235-4bb6-b6e2-92c8e4f24508@googlegroups.com>
References: <5cc06b2d-a235-4bb6-b6e2-92c8e4f24508@googlegroups.com>
Message-ID: <da9e0a77-7e2e-492e-8b28-19205aa14e34@googlegroups.com>

This is working correctly now.
 
I switched to autoAck = false and wrote my own basicAct, and now everything 
works very well
 
 
 

On Monday, January 7, 2013 7:34:37 PM UTC-5, CJ wrote:

> I am trying to figure out Rabbit Tx's
>  
> My producer sends 100 Persistent TX and dies as I directed.
>  
> Than I run a consumer that reads the messages from the durable Q with a 
> txcommit after the reception
>  
> Then my receiver can consume all 100 messages, and does so.
>  
> I am happy with this result, so I start over 
>  
> ......
>  
> I have my producer send another 100 messages.
>  
> But this time I have the consumer only read 50 persistent messages with a 
> txcommit.
>  
> I read in all of the first 50 messages correctly.
>  
> So I run the consumer again, hoping to get the next 50, but this time it 
> does not see any persistent Tx on the Q, and receive zero messages
>  
> What it looks like is that when the receiver opens the channel, Rabbit 
> sends a batch of messages from the database and the consumer can open them 
> one by one, and if the receiver closes the channel before the batch 
> processing of all the records has completed, those messages will be lost 
> regardless of whether they are persistent or not., and therefore I have to 
> take that into account when I write my consumers.  Is this a correct 
> assumption, or did I make a mistake ?
>  
>  
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130108/40cffb45/attachment.htm>

From alexis at rabbitmq.com  Tue Jan  8 22:06:25 2013
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Tue, 8 Jan 2013 22:06:25 +0000
Subject: [rabbitmq-discuss] RabbitMQ Simulator
In-Reply-To: <50EC2EBE.4070703@rabbitmq.com>
References: <CAMcAHLW6GD+W104xRoJn7VZD=PPbQKEOCNNypfiknfBDVt9RiQ@mail.gmail.com>
	<50EC2EBE.4070703@rabbitmq.com>
Message-ID: <CACOPnvf4L0P7mmRsHmDKY4=YbF+SkWvuQKFgmur_wfH7_o_WaQ@mail.gmail.com>

+1

On Tue, Jan 8, 2013 at 2:35 PM, Tim Watson <tim at rabbitmq.com> wrote:
> Alvaro this is massively cool! :D
>
>
> On 01/08/2013 02:35 PM, Alvaro Videla wrote:
>
> Hi,
>
> I'd like to share a sneak peek of a RabbitMQ simulator I've been working on
> lately:
>
> https://vimeo.com/56986242
>
> The goal of this app is to use it as a teaching tool for tutorials,
> presentations & more. Also it could serve as a topology designer for
> messaging applications since it supports exporting the design to RabbitMQ.
>
> I hope to be able to open source it soon.
>
> Regards,
>
> Alvaro
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From mabra at manfbraun.de  Tue Jan  8 18:59:05 2013
From: mabra at manfbraun.de (mabra at manfbraun.de)
Date: Tue, 8 Jan 2013 19:59:05 +0100
Subject: [rabbitmq-discuss] Migrating from MSMQ:Identifying queue
	features
In-Reply-To: <50E58D4A.90300@rabbitmq.com>
References: <f261250a-682e-4223-ac50-b42e06efb404@googlegroups.com>
	<50E58D4A.90300@rabbitmq.com>
Message-ID: <!&!AAAAAAAAAAAYAAAAAAAAAOosgHnoPqdNlUO2DUrQ/DfCgAAAEAAAAMO/rQvjTkFEkLjICdGdmIsBAAAAAA==@manfbraun.de>

Hello !

Thank you very much; I'll try to go in now.

Bye,

++mabra


> -----Original Message-----
> From: Emile Joubert [mailto:emile at rabbitmq.com]
> Sent: Thursday, January 03, 2013 2:53 PM
> To: Discussions about RabbitMQ
> Cc: mabra
> Subject: Re: [rabbitmq-discuss] Migrating from MSMQ:Identifying queue
> features
> 
> 
> 
> Hi,
> 
> On 02/01/13 16:59, mabra wrote:
> > I have several apps A, which generates messages with expiration time
> > of about 2 hours. I have several apps B, which evals these Messages.
> > They are sometimes running, sometimes not.
> 
> It is possible to define per-queue or per-message timeouts:
> http://www.rabbitmq.com/ttl.html
> 
> > Usually the B type is running permanently and in normal operation, it
> > reads each message, but does this by peek-ing the the queue and leave
> > them in the queue.
> 
> It is possible to dequeue and requeue a message, which is similar to
> peeking at the head of the queue. Bear in mind that repeating this
> operation in the absence of other consumers will lead to the same
> message being observed.
> 
> For rejecting using the .net client see
> http://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v3.0.1/rabbitmq-
> dotnet-client-3.0.1-client-htmldoc/html/type-
> RabbitMQ.Client.IModel.html#method-
> M:RabbitMQ.Client.IModel.BasicReject%28System.UInt64,System.Boolean%29
> 
> Using rejection of messages to implement message selection in consumers
> is not recommended. If different consumers (app B) process different
> messages then you are advised to route message based on that difference
> so that consumers only ever observe messages that they are able to
process.
> 
> > With MSMQ, each message has a unique id, so, if my app restarts, it
> > can just peek tha last message it has been processsed and then
> > continue peeking the remaining messages.
> 
> Publishers (app A) could add a unique ID to messages in a header when
> publishing which can be used in the same way.
> 
> > I concurrent to the B app, on demand another B is comming to the
> > same queue, evealuating the same messages with our rules.
> 
> It is possible for multiple consumers to read from the same queue. See
> tutorial 2:
> http://www.rabbitmq.com/tutorials/tutorial-two-java.html
> 
> > The is probbaly more a CEP app with a fast temporary store [to avoid
> > databases]. This works exceptionally fast with MSMQ and I am abel to
> > read more then 15k messages/s.
> 
> RabbitMQ is generally able to exceed that frequency, though it depends
> greatly on consumers keeping up, the messaging pattern and hardware
> being employed.
> 
> For notes about performance see these blog posts:
> http://www.rabbitmq.com/blog/2012/04/17/rabbitmq-performance-
> measurements-part-1/
> http://www.rabbitmq.com/blog/2012/04/25/rabbitmq-performance-
> measurements-part-2/
> 
> > A good note, hint or ref to a doc or something could really help me a
> > lot. I am using C#/mono.
> 
> You may find this book of interest:
> http://manning.com/videla/
> 
> RabbitMQ has ships with a mature C# client:
> http://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v3.0.1/rabbitmq-
> dotnet-client-3.0.1-user-guide.pdf
> 
> 
> 
> -Emile
> 
> 
> 




From thkrebs at googlemail.com  Tue Jan  8 22:13:57 2013
From: thkrebs at googlemail.com (Thomas Krebs)
Date: Tue, 8 Jan 2013 14:13:57 -0800 (PST)
Subject: [rabbitmq-discuss] two factor authentication with tokens
Message-ID: <e3be344f-3c2f-4866-8157-38f736ee63c6@googlegroups.com>

Does RabbitMQ support two factor authentication for example with a RSA 
token. 

Tom
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130108/13176bb1/attachment.htm>

From irmo.manie at gmail.com  Wed Jan  9 07:36:32 2013
From: irmo.manie at gmail.com (Irmo Manie)
Date: Wed, 9 Jan 2013 08:36:32 +0100
Subject: [rabbitmq-discuss] RabbitMQ Simulator
In-Reply-To: <CACOPnvf4L0P7mmRsHmDKY4=YbF+SkWvuQKFgmur_wfH7_o_WaQ@mail.gmail.com>
References: <CAMcAHLW6GD+W104xRoJn7VZD=PPbQKEOCNNypfiknfBDVt9RiQ@mail.gmail.com>
	<50EC2EBE.4070703@rabbitmq.com>
	<CACOPnvf4L0P7mmRsHmDKY4=YbF+SkWvuQKFgmur_wfH7_o_WaQ@mail.gmail.com>
Message-ID: <CAAcXTOaF8BBowAdntM1294EL96nJhObh4QdqMKa9um_WyMhrpw@mail.gmail.com>

Nice!


On Tue, Jan 8, 2013 at 11:06 PM, Alexis Richardson <alexis at rabbitmq.com>wrote:

> +1
>
> On Tue, Jan 8, 2013 at 2:35 PM, Tim Watson <tim at rabbitmq.com> wrote:
> > Alvaro this is massively cool! :D
> >
> >
> > On 01/08/2013 02:35 PM, Alvaro Videla wrote:
> >
> > Hi,
> >
> > I'd like to share a sneak peek of a RabbitMQ simulator I've been working
> on
> > lately:
> >
> > https://vimeo.com/56986242
> >
> > The goal of this app is to use it as a teaching tool for tutorials,
> > presentations & more. Also it could serve as a topology designer for
> > messaging applications since it supports exporting the design to
> RabbitMQ.
> >
> > I hope to be able to open source it soon.
> >
> > Regards,
> >
> > Alvaro
> >
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130109/2f99a426/attachment.htm>

From tlhuang at 800best.com  Wed Jan  9 10:32:58 2013
From: tlhuang at 800best.com (Huang Tonglang)
Date: Wed, 9 Jan 2013 18:32:58 +0800
Subject: [rabbitmq-discuss] RabbitMQ support JMS in the future?
Message-ID: <023CBAD52AC91842B08759362DE8396C1D92A244@bestex3.800best.net>

Is it possible that RabbitMQ can support JMS in the future? Although QPID client can connect to RabbitMQ, but the quality of its code is really not so good.

Thank you.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130109/d08b669b/attachment.htm>

From simon at rabbitmq.com  Wed Jan  9 12:25:14 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 09 Jan 2013 12:25:14 +0000
Subject: [rabbitmq-discuss] RabbitMQ support JMS in the future?
In-Reply-To: <023CBAD52AC91842B08759362DE8396C1D92A244@bestex3.800best.net>
References: <023CBAD52AC91842B08759362DE8396C1D92A244@bestex3.800best.net>
Message-ID: <50ED61AA.30609@rabbitmq.com>

On 09/01/13 10:32, Huang Tonglang wrote:
> Is it possible that RabbitMQ can support JMS in the future? Although
> QPID client can connect to RabbitMQ, but the quality of its code is
> really not so good.

This is being worked on; we hope to have more news in the next few months...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed Jan  9 12:36:18 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 09 Jan 2013 12:36:18 +0000
Subject: [rabbitmq-discuss] Consistent Hash Exchange
In-Reply-To: <CE7FFC70C4C3864CA0CCEA77E53801C60D9D6B@bre-exch02.insurance.financial.local>
References: <7d19f083-9002-4a75-8a6d-53cbe1caaf0d@googlegroups.com>
	<50E70E03.4000306@rabbitmq.com>
	<CE7FFC70C4C3864CA0CCEA77E53801C60D7CCC@bre-exch02.insurance.financial.local>
	<50EC52E7.7080507@rabbitmq.com>
	<CE7FFC70C4C3864CA0CCEA77E53801C60D9D6B@bre-exch02.insurance.financial.local>
Message-ID: <50ED6442.5070707@rabbitmq.com>

On 08/01/13 18:26, Matthew Collinge wrote:
> Thanks would be much appreciated.

You might want to try this:

http://www.rabbitmq.com/releases/plugins/v3.0.1-hash-headers/

(Drop it in your plugins directory, move the original consistent hash 
plugin out of the way, and restart.)

Declare a consistent hash exchange with a string argument called 
"hash-header", naming the header you want to use instead of the routing key.

This functionality should make its way into future releases.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From michael.s.klishin at gmail.com  Wed Jan  9 14:30:52 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 9 Jan 2013 14:30:52 +0000
Subject: [rabbitmq-discuss] ANN Bunny 0.9.0.pre5 is released
Message-ID: <CAE3HoVQv8ZOmTAPxfCFxf6Q6AKrZPDOhUZHJgrOooiU63AjpuQ@mail.gmail.com>

TL;DR
-----------------------------------------------------------------------------------------------------------------------

Bunny 0.9.0.pre5 is released to rubygems.org [1].

This is a bug fix and usability release. There is one minor
backwards-incompatible
change that will affect a very small fraction of the users.


Change log
-----------------------------------------------------------------------------------------------------------------------

Change log is available on GitHub:

https://github.com/ruby-amqp/bunny/blob/master/ChangeLog.md#changes-between-bunny-090pre4-and-090pre5


Documentation improvements
-----------------------------------------------------------------------------------------------------------------------

With this release, all major documentation guides at
http://rubybunny.infoare done.
Recent additions and major updates include

 * Exchanges & Publishers: http://rubybunny.info/articles/exchanges.html
 * Queues and Consumers: http://rubybunny.info/articles/queues.html
 * RabbitMQ Extensions: http://rubybunny.info/articles/extensions.html
 * Bindings: http://rubybunny.info/articles/bindings.html

Please take a look and file issues if something is not covered well.
Excellent documentation is
one of the top goals for Bunny 0.9 (and beyond).

Have a good day!

1. https://rubygems.org/gems/bunny/versions/0.9.0.pre5
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130109/eb8de1be/attachment.htm>

From chris.d at frugalit.co.uk  Wed Jan  9 14:35:17 2013
From: chris.d at frugalit.co.uk (Chris Duncan)
Date: Wed, 9 Jan 2013 06:35:17 -0800 (PST)
Subject: [rabbitmq-discuss] Publisher confirms
Message-ID: <1b201fb2-31f8-4427-977f-b9bb5775307b@googlegroups.com>

Hi,

I'm testing publisher confirms and am not seeing any acks from my RabbitMQ 
server in response to my basic.publish calls. I'm monitoring communications 
with Wireshark and the following appears to be happening when my publisher 
script runs:

1. Normal connection messages are sent and received. Both Connection.Start 
and Connection.Start-Ok show that the capabilities table contains 
publisher_confirms.
2. Confirm.Select and Confirm.Select-Ok are sent and received.
3. Basic.Publish is sent and the message appears in the target queue, 
however, I do not observe any message coming back from the server. I 
expected to see a Basic.Ack.

I'm using RabbitMQ 3.0.1, Ubuntu 12.04 LTS 32-bit, Erlang R14B04. My 
exchange and queue are both durable and the message that I'm sending is 
persistent.

I'm wondering whether my expectations are correct or not. If my 
expectations are correct, is there something that I've failed to do?

Any suggestions would be appreciated.

Cheers,

Chris
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130109/da627533/attachment.htm>

From michael.s.klishin at gmail.com  Wed Jan  9 15:24:45 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 9 Jan 2013 15:24:45 +0000
Subject: [rabbitmq-discuss] Publisher confirms
In-Reply-To: <1b201fb2-31f8-4427-977f-b9bb5775307b@googlegroups.com>
References: <1b201fb2-31f8-4427-977f-b9bb5775307b@googlegroups.com>
Message-ID: <CAE3HoVR9X+SO5w5erV+zGbbpkKN5pj_X2gHxpdNg563gU3qcRA@mail.gmail.com>

2013/1/9 Chris Duncan <chris.d at frugalit.co.uk>

> I'm wondering whether my expectations are correct or not. If my
> expectations are correct, is there something that I've failed to do?


Chris,

Can you please post your code and, if possible, what tshark output looks
like when you run it
as

tshark -i lo0 -O amqp -R amqp

(you will need to update the interface argument if RabbitMQ is not running
on localhost).
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130109/27bc9e32/attachment.htm>

From celldee at gmail.com  Wed Jan  9 15:51:54 2013
From: celldee at gmail.com (Chris Duncan)
Date: Wed, 09 Jan 2013 15:51:54 +0000
Subject: [rabbitmq-discuss] Publisher confirms
In-Reply-To: <CAE3HoVR9X+SO5w5erV+zGbbpkKN5pj_X2gHxpdNg563gU3qcRA@mail.gmail.com>
References: <1b201fb2-31f8-4427-977f-b9bb5775307b@googlegroups.com>
	<CAE3HoVR9X+SO5w5erV+zGbbpkKN5pj_X2gHxpdNg563gU3qcRA@mail.gmail.com>
Message-ID: <50ED921A.2000408@gmail.com>

Hi Michael,

On 09/01/13 15:24, Michael Klishin wrote:
>
> 2013/1/9 Chris Duncan <chris.d at frugalit.co.uk 
> <mailto:chris.d at frugalit.co.uk>>
>
>     I'm wondering whether my expectations are correct or not. If my
>     expectations are correct, is there something that I've failed to do?
>
>
> Chris,
>
> Can you please post your code and, if possible, what tshark output 
> looks like when you run it
> as
>
> tshark -i lo0 -O amqp -R amqp
>
> (you will need to update the interface argument if RabbitMQ is not 
> running on localhost).
> -- 
> MK
Please find my code and tshark output attached. I run the consumer 
first. My version of wireshark doesn't recognise AMQP method class 85 
(confirm.select and confirm.select-ok) but they do appear in the output.

Cheers,

Chris
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130109/5dbd7dae/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: hello_world_consumer.rb
Type: application/x-ruby
Size: 482 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130109/5dbd7dae/attachment.rb>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: hello_world_publisher_confirms.rb
Type: application/x-ruby
Size: 220 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130109/5dbd7dae/attachment-0001.rb>
-------------- next part --------------
Frame 8: 401 bytes on wire (3208 bits), 401 bytes captured (3208 bits)
Ethernet II, Src: 00:00:00_00:00:00 (00:00:00:00:00:00), Dst: 00:00:00_00:00:00 (00:00:00:00:00:00)
Internet Protocol Version 4, Src: 127.0.0.1 (127.0.0.1), Dst: 127.0.0.1 (127.0.0.1)
Transmission Control Protocol, Src Port: amqp (5672), Dst Port: 39165 (39165), Seq: 1, Ack: 9, Len: 335
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 0
    Length: 327
    Class: Connection (10)
    Method: Start (10)
    Arguments
        Version-Major: 0
        Version-Minor: 9
        Server-Properties
            capabilities (field table): ...
            copyright (string): Copyright (C) 2007-2012 VMware, Inc.
            information (string): Licensed under the MPL.  See http://www.rabbitmq.com/
            platform (string): Erlang/OTP
            product (string): RabbitMQ
            version (string): 3.0.1
        Mechanisms: 504c41494e20414d51504c41494e
        Locales: 656e5f5553

Frame 10: 376 bytes on wire (3008 bits), 376 bytes captured (3008 bits)
Ethernet II, Src: 00:00:00_00:00:00 (00:00:00:00:00:00), Dst: 00:00:00_00:00:00 (00:00:00:00:00:00)
Internet Protocol Version 4, Src: 127.0.0.1 (127.0.0.1), Dst: 127.0.0.1 (127.0.0.1)
Transmission Control Protocol, Src Port: 39165 (39165), Dst Port: amqp (5672), Seq: 9, Ack: 336, Len: 310
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 0
    Length: 302
    Class: Connection (10)
    Method: Start-Ok (11)
    Arguments
        Client-Properties
            capabilities (field table): ...
            product (string): Bunny
            platform (string): ruby 1.9.3p362 (2012-12-25 revision 38607) [i686-linux]
            version (string): 0.9.0.pre5
            information (string): http://github.com/ruby-amqp/bunny
        Mechanism: PLAIN
        Response: 006775657374006775657374
        Locale: en_GB

Frame 11: 86 bytes on wire (688 bits), 86 bytes captured (688 bits)
Ethernet II, Src: 00:00:00_00:00:00 (00:00:00:00:00:00), Dst: 00:00:00_00:00:00 (00:00:00:00:00:00)
Internet Protocol Version 4, Src: 127.0.0.1 (127.0.0.1), Dst: 127.0.0.1 (127.0.0.1)
Transmission Control Protocol, Src Port: amqp (5672), Dst Port: 39165 (39165), Seq: 336, Ack: 319, Len: 20
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 0
    Length: 12
    Class: Connection (10)
    Method: Tune (30)
    Arguments
        Channel-Max: 0
        Frame-Max: 131072
        Heartbeat: 600

Frame 12: 86 bytes on wire (688 bits), 86 bytes captured (688 bits)
Ethernet II, Src: 00:00:00_00:00:00 (00:00:00:00:00:00), Dst: 00:00:00_00:00:00 (00:00:00:00:00:00)
Internet Protocol Version 4, Src: 127.0.0.1 (127.0.0.1), Dst: 127.0.0.1 (127.0.0.1)
Transmission Control Protocol, Src Port: 39165 (39165), Dst Port: amqp (5672), Seq: 319, Ack: 356, Len: 20
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 0
    Length: 12
    Class: Connection (10)
    Method: Tune-Ok (31)
    Arguments
        Channel-Max: 0
        Frame-Max: 131072
        Heartbeat: 600

Frame 14: 82 bytes on wire (656 bits), 82 bytes captured (656 bits)
Ethernet II, Src: 00:00:00_00:00:00 (00:00:00:00:00:00), Dst: 00:00:00_00:00:00 (00:00:00:00:00:00)
Internet Protocol Version 4, Src: 127.0.0.1 (127.0.0.1), Dst: 127.0.0.1 (127.0.0.1)
Transmission Control Protocol, Src Port: 39165 (39165), Dst Port: amqp (5672), Seq: 339, Ack: 356, Len: 16
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 0
    Length: 8
    Class: Connection (10)
    Method: Open (40)
    Arguments
        Virtual-Host: /
        Capabilities: 
        .... ...0 = Insist: False

Frame 16: 79 bytes on wire (632 bits), 79 bytes captured (632 bits)
Ethernet II, Src: 00:00:00_00:00:00 (00:00:00:00:00:00), Dst: 00:00:00_00:00:00 (00:00:00:00:00:00)
Internet Protocol Version 4, Src: 127.0.0.1 (127.0.0.1), Dst: 127.0.0.1 (127.0.0.1)
Transmission Control Protocol, Src Port: amqp (5672), Dst Port: 39165 (39165), Seq: 356, Ack: 355, Len: 13
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 0
    Length: 5
    Class: Connection (10)
    Method: Open-Ok (41)
    Arguments
        Known-Hosts: 

Frame 17: 79 bytes on wire (632 bits), 79 bytes captured (632 bits)
Ethernet II, Src: 00:00:00_00:00:00 (00:00:00:00:00:00), Dst: 00:00:00_00:00:00 (00:00:00:00:00:00)
Internet Protocol Version 4, Src: 127.0.0.1 (127.0.0.1), Dst: 127.0.0.1 (127.0.0.1)
Transmission Control Protocol, Src Port: 39165 (39165), Dst Port: amqp (5672), Seq: 355, Ack: 369, Len: 13
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 1
    Length: 5
    Class: Channel (20)
    Method: Open (10)
    Arguments
        Out-Of-Band: 

Frame 18: 82 bytes on wire (656 bits), 82 bytes captured (656 bits)
Ethernet II, Src: 00:00:00_00:00:00 (00:00:00:00:00:00), Dst: 00:00:00_00:00:00 (00:00:00:00:00:00)
Internet Protocol Version 4, Src: 127.0.0.1 (127.0.0.1), Dst: 127.0.0.1 (127.0.0.1)
Transmission Control Protocol, Src Port: amqp (5672), Dst Port: 39165 (39165), Seq: 369, Ack: 368, Len: 16
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 1
    Length: 8
    Class: Channel (20)
    Method: Open-Ok (11)
    Arguments
        Channel-Id: <MISSING>

Frame 19: 79 bytes on wire (632 bits), 79 bytes captured (632 bits)
Ethernet II, Src: 00:00:00_00:00:00 (00:00:00:00:00:00), Dst: 00:00:00_00:00:00 (00:00:00:00:00:00)
Internet Protocol Version 4, Src: 127.0.0.1 (127.0.0.1), Dst: 127.0.0.1 (127.0.0.1)
Transmission Control Protocol, Src Port: 39165 (39165), Dst Port: amqp (5672), Seq: 368, Ack: 385, Len: 13
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 5
    Class: Channel (20)
    Method: Open (10)
    Arguments
        Out-Of-Band: 

Frame 20: 82 bytes on wire (656 bits), 82 bytes captured (656 bits)
Ethernet II, Src: 00:00:00_00:00:00 (00:00:00:00:00:00), Dst: 00:00:00_00:00:00 (00:00:00:00:00:00)
Internet Protocol Version 4, Src: 127.0.0.1 (127.0.0.1), Dst: 127.0.0.1 (127.0.0.1)
Transmission Control Protocol, Src Port: amqp (5672), Dst Port: 39165 (39165), Seq: 385, Ack: 381, Len: 16
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 8
    Class: Channel (20)
    Method: Open-Ok (11)
    Arguments
        Channel-Id: <MISSING>

Frame 21: 79 bytes on wire (632 bits), 79 bytes captured (632 bits)
Ethernet II, Src: 00:00:00_00:00:00 (00:00:00:00:00:00), Dst: 00:00:00_00:00:00 (00:00:00:00:00:00)
Internet Protocol Version 4, Src: 127.0.0.1 (127.0.0.1), Dst: 127.0.0.1 (127.0.0.1)
Transmission Control Protocol, Src Port: 39165 (39165), Dst Port: amqp (5672), Seq: 381, Ack: 401, Len: 13
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 5
    Class: Unknown (85)
    [Expert Info (Error/Protocol): Unknown method class 85]
        [Message: Unknown method class 85]
        [Severity level: Error]
        [Group: Protocol]

Frame 22: 78 bytes on wire (624 bits), 78 bytes captured (624 bits)
Ethernet II, Src: 00:00:00_00:00:00 (00:00:00:00:00:00), Dst: 00:00:00_00:00:00 (00:00:00:00:00:00)
Internet Protocol Version 4, Src: 127.0.0.1 (127.0.0.1), Dst: 127.0.0.1 (127.0.0.1)
Transmission Control Protocol, Src Port: amqp (5672), Dst Port: 39165 (39165), Seq: 401, Ack: 394, Len: 12
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 4
    Class: Unknown (85)
    [Expert Info (Error/Protocol): Unknown method class 85]
        [Message: Unknown method class 85]
        [Severity level: Error]
        [Group: Protocol]

Frame 23: 107 bytes on wire (856 bits), 107 bytes captured (856 bits)
Ethernet II, Src: 00:00:00_00:00:00 (00:00:00:00:00:00), Dst: 00:00:00_00:00:00 (00:00:00:00:00:00)
Internet Protocol Version 4, Src: 127.0.0.1 (127.0.0.1), Dst: 127.0.0.1 (127.0.0.1)
Transmission Control Protocol, Src Port: 39165 (39165), Dst Port: amqp (5672), Seq: 394, Ack: 413, Len: 41
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 1
    Length: 33
    Class: Exchange (40)
    Method: Declare (10)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Type: direct
        .... ...0 = Passive: False
        .... ..1. = Durable: True
        .... .0.. = Auto-Delete: False
        .... 0... = Internal: False
        ...0 .... = Nowait: False
        Arguments

Frame 24: 78 bytes on wire (624 bits), 78 bytes captured (624 bits)
Ethernet II, Src: 00:00:00_00:00:00 (00:00:00:00:00:00), Dst: 00:00:00_00:00:00 (00:00:00:00:00:00)
Internet Protocol Version 4, Src: 127.0.0.1 (127.0.0.1), Dst: 127.0.0.1 (127.0.0.1)
Transmission Control Protocol, Src Port: amqp (5672), Dst Port: 39165 (39165), Seq: 413, Ack: 435, Len: 12
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 1
    Length: 4
    Class: Exchange (40)
    Method: Declare-Ok (11)
    Arguments

Frame 25: 101 bytes on wire (808 bits), 101 bytes captured (808 bits)
Ethernet II, Src: 00:00:00_00:00:00 (00:00:00:00:00:00), Dst: 00:00:00_00:00:00 (00:00:00:00:00:00)
Internet Protocol Version 4, Src: 127.0.0.1 (127.0.0.1), Dst: 127.0.0.1 (127.0.0.1)
Transmission Control Protocol, Src Port: 39165 (39165), Dst Port: amqp (5672), Seq: 435, Ack: 425, Len: 35
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 1
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False

Frame 27: 135 bytes on wire (1080 bits), 135 bytes captured (1080 bits)
Ethernet II, Src: 00:00:00_00:00:00 (00:00:00:00:00:00), Dst: 00:00:00_00:00:00 (00:00:00:00:00:00)
Internet Protocol Version 4, Src: 127.0.0.1 (127.0.0.1), Dst: 127.0.0.1 (127.0.0.1)
Transmission Control Protocol, Src Port: 39165 (39165), Dst Port: amqp (5672), Seq: 470, Ack: 425, Len: 69
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 1
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 12
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 1
    Length: 12
    Payload: 54657374206d657373616765


From Matthew.Collinge at bglgroup.co.uk  Wed Jan  9 16:05:13 2013
From: Matthew.Collinge at bglgroup.co.uk (Matthew Collinge)
Date: Wed, 9 Jan 2013 16:05:13 +0000
Subject: [rabbitmq-discuss] Consistent Hash Exchange
In-Reply-To: <50ED6442.5070707@rabbitmq.com>
References: <7d19f083-9002-4a75-8a6d-53cbe1caaf0d@googlegroups.com>
	<50E70E03.4000306@rabbitmq.com>
	<CE7FFC70C4C3864CA0CCEA77E53801C60D7CCC@bre-exch02.insurance.financial.local>
	<50EC52E7.7080507@rabbitmq.com>
	<CE7FFC70C4C3864CA0CCEA77E53801C60D9D6B@bre-exch02.insurance.financial.local>
	<50ED6442.5070707@rabbitmq.com>
Message-ID: <CE7FFC70C4C3864CA0CCEA77E53801C60DB03A@bre-exch02.insurance.financial.local>

Excellent! I will give it a go.

Cheers

Matt

-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com]
Sent: 09 January 2013 12:36
To: Matthew Collinge
Cc: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Consistent Hash Exchange

On 08/01/13 18:26, Matthew Collinge wrote:
> Thanks would be much appreciated.

You might want to try this:

http://www.rabbitmq.com/releases/plugins/v3.0.1-hash-headers/

(Drop it in your plugins directory, move the original consistent hash plugin out of the way, and restart.)

Declare a consistent hash exchange with a string argument called "hash-header", naming the header you want to use instead of the routing key.

This functionality should make its way into future releases.

Cheers, Simon

--
Simon MacMullen
RabbitMQ, VMware

________________________________

This message is intended for the stated addressee(s) only and may be confidential. Access to this email by anyone else is unauthorised. Any opinions expressed in this email do not necessarily reflect the opinions of BGL Group Limited and its subsidiaries . Any unauthorised disclosure, use or dissemination, either whole or in part is prohibited. If you are not the intended recipient of this message, please notify the sender immediately.

Please scan all attachments for viruses.

From dseltzer at tveyes.com  Wed Jan  9 16:22:42 2013
From: dseltzer at tveyes.com (Dave Seltzer)
Date: Wed, 9 Jan 2013 11:22:42 -0500
Subject: [rabbitmq-discuss] RabbitMQ Instability in 3.0.1
Message-ID: <CAHW0W4NhRQYcoWaGVt7znHpiWbd8OdVKK+S_ek_5Yrw+Pm5yUA@mail.gmail.com>

I have a RabbitMQ 3.0.1 cluster which I upgraded from 2.7.x

For the first couple of days it was quite stable.

This morning however I started noticing some odd behavior. Notably, I would
issue BasicPublish commands and they would run forever before finally
timing out. I attempted to restart the cluster and this ended with bad
results.

I finally got the cluster back online, but now its not behaving properly.

Node2 Starts up like this:

starting memory monitor
...done
-- core initialized
starting federation
...done
starting federation exchange decorator
 ...done
starting federation parameters
 ...done
starting federation upstream exchange type
 ...done
starting management agent
...done
starting HA policy validation
...done
starting policy parameters
 ...done
starting exchange, queue and binding recovery
...done
starting configured definitions
...done
starting empty DB check
...done
starting mirror queue slave sup                                       ...

BOOT FAILED
===========

Error description:
   {shutdown,
       {gen_server,call,
           [rabbit_sup,
            {start_child,
                {rabbit_mirror_queue_slave_sup,
                    {rabbit_mirror_queue_slave_sup,start_link,[]},
                    transient,infinity,supervisor,
                    [rabbit_mirror_queue_slave_sup]}},
            infinity]}}

Log files (may contain more information):
   /var/log/rabbitmq/rabbit at egressqueue02.log
   /var/log/rabbitmq/rabbit at egressqueue02-sasl.log

Stack trace:
   [{gen_server,call,3,[{file,"gen_server.erl"},{line,188}]},
    {rabbit_sup,start_supervisor_child,3,[]},
    {rabbit,'-run_boot_step/1-lc$^1/1-1-',1,[]},
    {rabbit,run_boot_step,1,[]},
    {rabbit,'-start/2-lc$^0/1-0-',1,[]},
    {rabbit,start,2,[]},
    {application_master,start_it_old,4,
                        [{file,"application_master.erl"},{line,274}]}]



BOOT FAILED
===========

Error description:
   {could_not_start,rabbit,
    {bad_return,
     {{rabbit,start,[normal,[]]},
      {'EXIT',
       {rabbit,failure_during_boot,
        {shutdown,
         {gen_server,call,
          [rabbit_sup,
           {start_child,
            {rabbit_mirror_queue_slave_sup,
             {rabbit_mirror_queue_slave_sup,start_link,[]},
             transient,infinity,supervisor,
             [rabbit_mirror_queue_slave_sup]}},
           infinity]}}}}}}}

Log files (may contain more information):
   /var/log/rabbitmq/rabbit at egressqueue02.log
   /var/log/rabbitmq/rabbit at egressqueue02-sasl.log

{"init terminating in
do_boot",{rabbit,failure_during_boot,{could_not_start,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot,{shutdown,{gen_server,call,[rabbit_sup,{start_child,{rabbit_mirror_queue_slave_sup,{rabbit_mirror_queue_slave_sup,start_link,[]},transient,infinity,supervisor,[rabbit_mirror_queue_slave_sup]}},infinity]}}}}}}}}}

I'm not sure how to proceed. Any advice would be hugely helpful.

Thanks!

-- 
Dave
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130109/18ec3dd5/attachment.htm>

From simon at rabbitmq.com  Wed Jan  9 16:46:40 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 09 Jan 2013 16:46:40 +0000
Subject: [rabbitmq-discuss] Publisher confirms
In-Reply-To: <50ED921A.2000408@gmail.com>
References: <1b201fb2-31f8-4427-977f-b9bb5775307b@googlegroups.com>
	<CAE3HoVR9X+SO5w5erV+zGbbpkKN5pj_X2gHxpdNg563gU3qcRA@mail.gmail.com>
	<50ED921A.2000408@gmail.com>
Message-ID: <50ED9EF0.3070506@rabbitmq.com>

On 09/01/13 15:51, Chris Duncan wrote:
> Please find my code and tshark output attached. I run the consumer
> first. My version of wireshark doesn't recognise AMQP method class 85
> (confirm.select and confirm.select-ok) but they do appear in the output.

Hi Chris. You appear to be invoking confirm.select on channel 2, and 
basic.publish (and everything else) on channel 1. confirm.select, like 
most things in AMQP, has channel-wide scope.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From celldee at gmail.com  Wed Jan  9 17:07:34 2013
From: celldee at gmail.com (Chris Duncan)
Date: Wed, 09 Jan 2013 17:07:34 +0000
Subject: [rabbitmq-discuss] Publisher confirms
In-Reply-To: <50ED9EF0.3070506@rabbitmq.com>
References: <1b201fb2-31f8-4427-977f-b9bb5775307b@googlegroups.com>
	<CAE3HoVR9X+SO5w5erV+zGbbpkKN5pj_X2gHxpdNg563gU3qcRA@mail.gmail.com>
	<50ED921A.2000408@gmail.com> <50ED9EF0.3070506@rabbitmq.com>
Message-ID: <50EDA3D6.5070800@gmail.com>

Hi Simon,

On 09/01/13 16:46, Simon MacMullen wrote:
>
> Hi Chris. You appear to be invoking confirm.select on channel 2, and 
> basic.publish (and everything else) on channel 1. confirm.select, like 
> most things in AMQP, has channel-wide scope.
>
> Cheers, Simon
>
Thanks, couldn't see the wood for the trees :)

From michael.s.klishin at gmail.com  Wed Jan  9 17:08:44 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 9 Jan 2013 17:08:44 +0000
Subject: [rabbitmq-discuss] Publisher confirms
In-Reply-To: <50ED921A.2000408@gmail.com>
References: <1b201fb2-31f8-4427-977f-b9bb5775307b@googlegroups.com>
	<CAE3HoVR9X+SO5w5erV+zGbbpkKN5pj_X2gHxpdNg563gU3qcRA@mail.gmail.com>
	<50ED921A.2000408@gmail.com>
Message-ID: <CAE3HoVRYYiyUxccwiMT6LnFnSbnjD19yRrJUE-M8gjfme29R0Q@mail.gmail.com>

2013/1/9 Chris Duncan <celldee at gmail.com>

> Please find my code and tshark output attached. I run the consumer first.
> My version of wireshark doesn't recognise AMQP method class 85
> (confirm.select and confirm.select-ok) but they do appear in the output.


Chris,

You are using conn.direct which causes default channel (a backwards
compatibility thing) to be used.
So you are enabling confirms on one channel and publishing on a different
one.

-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130109/18251429/attachment.htm>

From celldee at gmail.com  Wed Jan  9 17:16:21 2013
From: celldee at gmail.com (Chris Duncan)
Date: Wed, 09 Jan 2013 17:16:21 +0000
Subject: [rabbitmq-discuss] Publisher confirms
In-Reply-To: <CAE3HoVRYYiyUxccwiMT6LnFnSbnjD19yRrJUE-M8gjfme29R0Q@mail.gmail.com>
References: <1b201fb2-31f8-4427-977f-b9bb5775307b@googlegroups.com>
	<CAE3HoVR9X+SO5w5erV+zGbbpkKN5pj_X2gHxpdNg563gU3qcRA@mail.gmail.com>
	<50ED921A.2000408@gmail.com>
	<CAE3HoVRYYiyUxccwiMT6LnFnSbnjD19yRrJUE-M8gjfme29R0Q@mail.gmail.com>
Message-ID: <50EDA5E5.5050504@gmail.com>

On 09/01/13 17:08, Michael Klishin wrote:
>
> Chris,
>
> You are using conn.direct which causes default channel (a backwards 
> compatibility thing) to be used.
> So you are enabling confirms on one channel and publishing on a 
> different one.
>
> -- 
> MK
>
Thanks Michael. It all makes sense now.

From adamrabung at gmail.com  Wed Jan  9 16:19:10 2013
From: adamrabung at gmail.com (Adam Rabung)
Date: Wed, 9 Jan 2013 11:19:10 -0500
Subject: [rabbitmq-discuss] Unsynchronised Slaves in 3.0
Message-ID: <CAAN_EDo5dtMpf4HWPt_ALKRximKBdyJ+2k9wh6d_u78kRPEv0Q@mail.gmail.com>

Hello,
With all of the improvements to queue mirroring in 3.0, I was wondering if
the is any update to the handling of "Unsynchronised Slaves". Specifically,
I'm curious about the problem described
here<http://grokbase.com/t/rabbitmq/rabbitmq-discuss/11bqb6j59m/messages-disappearing-from-queues-when-clustered-brokers-are-restarted>.
Does 3.0 include the ability to prompt slaves to eagerly synch?

If 3.0 did not change in this regard, how are people managing this problem?

Any input much appreciated.

Thanks,
Adam
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130109/bdb78b82/attachment.htm>

From albunn at gmail.com  Wed Jan  9 18:57:54 2013
From: albunn at gmail.com (Alexandre Bunn)
Date: Wed, 9 Jan 2013 10:57:54 -0800 (PST)
Subject: [rabbitmq-discuss] loss o messages on a cluster + durable queues +
	mirrored queues
Message-ID: <713977d2-894a-4db1-bf9b-34560a73615f@googlegroups.com>

Good afternoon

I have a 2 nodes cluster with mirrored queues and I'm setting delivery_mode 
= 2 when I'm publishing messages to the cluster. I'm missing messages when 
I follow these steps below (for test issues).

Step 0 - Node1 (master) Node2 (slave)

# rabbitmqctl cluster_status
Cluster status of node 'rabbit at vid-mq01-mia' ...
[{nodes,[{disc,['rabbit at vid-mq01-mia','rabbit at vid-mq02-mia']}]},
 {running_nodes,['rabbit at vid-mq02-mia','rabbit at vid-mq01-mia']},
 {partitions,[]}]
...done.

# rabbitmqctl list_policies
Listing policies ...
/       ha-all  ^ha\\.  {"ha-mode":"all"}       0
...done.

## rabbitmqctl list_queues name durable policy
Listing queues ...
ha.teste        true    ha-all
...done.


- Step 1 - I write 2 messages, at ha.teste queue, 1 on each member of the 
cluster and the messages are mirrored as expected. Here there are two 
messages on each nodes (rabbitmqctl list_queues)

-- node1
# rabbitmqctl list_queues
Listing queues ...
ha.teste        2
...done.
# rabbitmqctl list_queues name pid slave_pids synchronised_slave_pids
Listing queues ...
ha.teste        <'rabbit at vid-mq01-mia'.3.253.0> 
[<'rabbit at vid-mq02-mia'.2.252.0>]       [<'rabbit at vid-mq02-mia'.2.252.0>]
...done.

-- node2
# rabbitmqctl list_queues
Listing queues ...
ha.teste        2
...done.
# rabbitmqctl list_queues name pid slave_pids synchronised_slave_pids
Listing queues ...
ha.teste        <'rabbit at vid-mq01-mia'.3.253.0> 
[<'rabbit at vid-mq02-mia'.2.252.0>]       [<'rabbit at vid-mq02-mia'.2.252.0>]
...done.

- Step 2 - I've stopped rabbitmq-server on node1 and node2 assume the 
master. Here there are the two messages on node2

-- Logs on node2
Mirrored-queue (queue 'ha.teste' in vhost '/'): Promoting slave 
<'rabbit at vid-mq02-mia'.2.252.0> to master

-- Status of the cluster on node2

# rabbitmqctl cluster_status
Cluster status of node 'rabbit at vid-mq02-mia' ...
[{nodes,[{disc,['rabbit at vid-mq01-mia','rabbit at vid-mq02-mia']}]},
 {running_nodes,['rabbit at vid-mq02-mia']},
 {partitions,[]}]
...done.

-- Status of the ha.teste queue on node2

# rabbitmqctl list_queues
Listing queues ...
ha.teste        2
...done.
# rabbitmqctl list_queues name pid slave_pids synchronised_slave_pids
Listing queues ...
ha.teste        <'rabbit at vid-mq02-mia'.2.252.0> []      []
...done.

- Step 3 - I start the rabbitmq-server on node1, node2 still master and 
node1 is running as slave. Here there are the two messages on node1 and 
node2

-- Log on node2
=INFO REPORT==== 9-Jan-2013::18:40:46 ===
rabbit on node 'rabbit at vid-mq01-mia' up

-- Status of the cluster on node1

# rabbitmqctl cluster_status
Cluster status of node 'rabbit at vid-mq01-mia' ...
[{nodes,[{disc,['rabbit at vid-mq01-mia','rabbit at vid-mq02-mia']}]},
 {running_nodes,['rabbit at vid-mq02-mia','rabbit at vid-mq01-mia']},
 {partitions,[]}]
...done.

-- Status of the ha.teste queue on node2
# rabbitmqctl list_queues
Listing queues ...
ha.teste        2
...done.

# rabbitmqctl list_queues name pid slave_pids synchronised_slave_pids
Listing queues ...
ha.teste        <'rabbit at vid-mq02-mia'.2.252.0> 
[<'rabbit at vid-mq01-mia'.1.253.0>]       []
...done.

- Step 4 - I've stopped rabbitmq-server on node2 and node1 assume the 
master but the messages disapeared

-- Logs on node1

=INFO REPORT==== 9-Jan-2013::18:43:42 ===
Mirrored-queue (queue 'ha.teste' in vhost '/'): Promoting slave 
<'rabbit at vid-mq01-mia'.1.253.0> to master

=INFO REPORT==== 9-Jan-2013::18:43:42 ===
rabbit on node 'rabbit at vid-mq02-mia' down

-- Cluster status on node1

# rabbitmqctl cluster_status
Cluster status of node 'rabbit at vid-mq01-mia' ...
[{nodes,[{disc,['rabbit at vid-mq01-mia','rabbit at vid-mq02-mia']}]},
 {running_nodes,['rabbit at vid-mq01-mia']},
 {partitions,[]}]
...done.

-- Status of the ha.teste queue on node1

# rabbitmqctl list_queues
Listing queues ...
ha.teste        0
...done.

# rabbitmqctl list_queues name pid slave_pids synchronised_slave_pids
Listing queues ...
ha.teste        <'rabbit at vid-mq01-mia'.1.253.0> []      []
...done.

Is it expected? What we have to do at server side or client side (python 
script) to make the messages really durable? All the servers are running 
centos6 x86_64 and rabbitmq 3.0.1-1.

Thanks

Alexandre Bunn
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130109/f3841dd6/attachment.htm>

From simon at rabbitmq.com  Wed Jan  9 21:07:13 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 09 Jan 2013 21:07:13 +0000
Subject: [rabbitmq-discuss] Unsynchronised Slaves in 3.0
In-Reply-To: <CAAN_EDo5dtMpf4HWPt_ALKRximKBdyJ+2k9wh6d_u78kRPEv0Q@mail.gmail.com>
References: <CAAN_EDo5dtMpf4HWPt_ALKRximKBdyJ+2k9wh6d_u78kRPEv0Q@mail.gmail.com>
Message-ID: <50EDDC01.2010704@rabbitmq.com>

On 09/01/2013 4:19PM, Adam Rabung wrote:
> With all of the improvements to queue mirroring in 3.0, I was wondering
> if the is any update to the handling of "Unsynchronised Slaves".
> Specifically, I'm curious about the problem described here
> <http://grokbase.com/t/rabbitmq/rabbitmq-discuss/11bqb6j59m/messages-disappearing-from-queues-when-clustered-brokers-are-restarted>.
> Does 3.0 include the ability to prompt slaves to eagerly synch?

No.

The good news is 3.1 will. We're expecting to release in March / April-ish.

Cheers, Simon

From matthias at rabbitmq.com  Wed Jan  9 21:12:46 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 09 Jan 2013 21:12:46 +0000
Subject: [rabbitmq-discuss] Unsynchronised Slaves in 3.0
In-Reply-To: <50EDDC01.2010704@rabbitmq.com>
References: <CAAN_EDo5dtMpf4HWPt_ALKRximKBdyJ+2k9wh6d_u78kRPEv0Q@mail.gmail.com>
	<50EDDC01.2010704@rabbitmq.com>
Message-ID: <50EDDD4E.6010202@rabbitmq.com>

On 09/01/13 21:07, Simon MacMullen wrote:
> On 09/01/2013 4:19PM, Adam Rabung wrote:
>> Does 3.0 include the ability to prompt slaves to eagerly synch?
>
> No.
>
> The good news is 3.1 will. We're expecting to release in March /
> April-ish.

And if you want to play with a preview... the next nightly builds
(http://www.rabbitmq.com/nightly-builds.html), which should appear in a
few hours, will contain this new functionality.

Matthias

From matthias at rabbitmq.com  Wed Jan  9 21:22:16 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 09 Jan 2013 21:22:16 +0000
Subject: [rabbitmq-discuss] loss o messages on a cluster + durable
 queues + mirrored queues
In-Reply-To: <713977d2-894a-4db1-bf9b-34560a73615f@googlegroups.com>
References: <713977d2-894a-4db1-bf9b-34560a73615f@googlegroups.com>
Message-ID: <50EDDF88.1000601@rabbitmq.com>

Alexandre,

On 09/01/13 18:57, Alexandre Bunn wrote:
> Step 0 - Node1 (master) Node2 (slave)
> Step 1 - I write 2 messages, at ha.teste queue, 1 on each member of
> the cluster and the messages are mirrored as expected. Here there are
> two messages on each nodes (rabbitmqctl list_queues)

As an aside (this isn't the source of your problem)...

In a cluster, queues are visible on all nodes regardless of mirroring. 
And mirroring in rabbit is a strict master-slave setup - *all* actions 
take place on the master and are then replicated on the slaves.

So, in the above case, when you are publishing the message to the 2nd 
node it actually gets sent from there to the queue's master node, is 
processed there, and then replicated to all slaves.

> - Step 2 - I've stopped rabbitmq-server on node1 and node2 assume the
> master.
> - Step 3 - I start the rabbitmq-server on node1, node2 still master and
> node1 is running as slave.
> - Step 4 - I've stopped rabbitmq-server on node2 and node1 assume the
> master but the messages disapeared

You are running into http://www.rabbitmq.com/ha.html#unsynchronised-slaves.

Regards,

Matthias.

From matthias at rabbitmq.com  Wed Jan  9 21:44:27 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 09 Jan 2013 21:44:27 +0000
Subject: [rabbitmq-discuss] RabbitMQ Instability in 3.0.1
In-Reply-To: <CAHW0W4NhRQYcoWaGVt7znHpiWbd8OdVKK+S_ek_5Yrw+Pm5yUA@mail.gmail.com>
References: <CAHW0W4NhRQYcoWaGVt7znHpiWbd8OdVKK+S_ek_5Yrw+Pm5yUA@mail.gmail.com>
Message-ID: <50EDE4BB.6000907@rabbitmq.com>

Dave,

On 09/01/13 16:22, Dave Seltzer wrote:
> I would issue BasicPublish commands and they would run forever before
> finally timing out.

Sounds like you may have run out of memory or disk space. Check the logs.

> I attempted to restart the cluster and this ended  with bad results.
> BOOT FAILED
> ===========
> Error description: {shutdown, {gen_server,call, [rabbit_sup,
> {start_child, {rabbit_mirror_queue_slave_sup,
> {rabbit_mirror_queue_slave_sup,start_link,[]},
> transient,infinity,supervisor, [rabbit_mirror_queue_slave_sup]}},
> infinity]}}
>
> Log files (may contain more information):
> /var/log/rabbitmq/rabbit at egressqueue02.log
> /var/log/rabbitmq/rabbit at egressqueue02-sasl.log

Check those log files for any errors.

Regards,

Matthias.

From adamrabung at gmail.com  Wed Jan  9 22:11:44 2013
From: adamrabung at gmail.com (Adam Rabung)
Date: Wed, 9 Jan 2013 17:11:44 -0500
Subject: [rabbitmq-discuss] Unsynchronised Slaves in 3.0
In-Reply-To: <50EDDD4E.6010202@rabbitmq.com>
References: <CAAN_EDo5dtMpf4HWPt_ALKRximKBdyJ+2k9wh6d_u78kRPEv0Q@mail.gmail.com>
	<50EDDC01.2010704@rabbitmq.com> <50EDDD4E.6010202@rabbitmq.com>
Message-ID: <CAAN_EDr+iM3nfCWStNt6K6o6HtNb-RV-=_L2H_fsso75xgwmoA@mail.gmail.com>

Nightly builds, very cool!  Thanks for the quick answers.
Adam


On Wed, Jan 9, 2013 at 4:12 PM, Matthias Radestock <matthias at rabbitmq.com>wrote:

> On 09/01/13 21:07, Simon MacMullen wrote:
>
>> On 09/01/2013 4:19PM, Adam Rabung wrote:
>>
>>> Does 3.0 include the ability to prompt slaves to eagerly synch?
>>>
>>
>> No.
>>
>> The good news is 3.1 will. We're expecting to release in March /
>> April-ish.
>>
>
> And if you want to play with a preview... the next nightly builds
> (http://www.rabbitmq.com/**nightly-builds.html<http://www.rabbitmq.com/nightly-builds.html>),
> which should appear in a
> few hours, will contain this new functionality.
>
> Matthias
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130109/86e04a50/attachment.htm>

From jerryk at rbcon.com  Thu Jan 10 00:36:49 2013
From: jerryk at rbcon.com (Jerry Kuch)
Date: Wed, 9 Jan 2013 16:36:49 -0800
Subject: [rabbitmq-discuss] two factor authentication with tokens
In-Reply-To: <e3be344f-3c2f-4866-8157-38f736ee63c6@googlegroups.com>
References: <e3be344f-3c2f-4866-8157-38f736ee63c6@googlegroups.com>
Message-ID: <CAE0Sz=xJzJp5C76SWMXXY7-1mjG4_3+zP2aC3wtvTy2vfs7rdg@mail.gmail.com>

Hi, Thomas:

Not out of the box... although the Rabbit authentication and authorization
mechanisms are pluggable and can be replaced if one is willing to write a
bit of Erlang.

To that end, how does one implement the server end of RSA-token based two
factor authentication?  Is there an SDK or APIs that one must gain access
to?

Also, two factor auth seems most useful when there's a human involved in
the log-on process, something which for a messaging broker may often not
really be true.  Can you say more about the nature of your desire for RSA
two factor with Rabbit?

Best regards,
Jerry
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130109/bf3ccca6/attachment.htm>

From tlhuang at 800best.com  Thu Jan 10 01:19:01 2013
From: tlhuang at 800best.com (Huang Tonglang)
Date: Thu, 10 Jan 2013 09:19:01 +0800
Subject: [rabbitmq-discuss] RabbitMQ support JMS in the future?
In-Reply-To: <50ED61AA.30609@rabbitmq.com>
References: <023CBAD52AC91842B08759362DE8396C1D92A244@bestex3.800best.net>
	<50ED61AA.30609@rabbitmq.com>
Message-ID: <023CBAD52AC91842B08759362DE8396C1D92A245@bestex3.800best.net>

It is great news!

My team is planning to transfer from ActiveMQ to RabbitMQ, however, the biggest problem to us is we have to rewrite all of existing JMS-compatible code to work with Rabbit client. Since you guys are working on it now, we will just wait for the new Rabbit JMS client. 

Thank you!


-----????-----
???: Simon MacMullen [mailto:simon at rabbitmq.com] 
????: 2013?1?9? 20:25
???: Discussions about RabbitMQ
??: Huang Tonglang
??: Re: [rabbitmq-discuss] RabbitMQ support JMS in the future?

On 09/01/13 10:32, Huang Tonglang wrote:
> Is it possible that RabbitMQ can support JMS in the future? Although
> QPID client can connect to RabbitMQ, but the quality of its code is
> really not so good.

This is being worked on; we hope to have more news in the next few months...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From tim at rabbitmq.com  Thu Jan 10 10:59:29 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 10 Jan 2013 10:59:29 +0000
Subject: [rabbitmq-discuss] Connection error on RabbitMQ consumer behind
 haproxy
In-Reply-To: <CADD0VadOdz3w3pR_iWSV0=UfQM9_eKmOEk+Br8wAU5WYbu81-Q@mail.gmail.com>
References: <CADD0VadOdz3w3pR_iWSV0=UfQM9_eKmOEk+Br8wAU5WYbu81-Q@mail.gmail.com>
Message-ID: <50EE9F11.7040102@rabbitmq.com>

Hi

On 01/08/2013 11:56 AM, B MK wrote:
> Hello,
>
> I am using rabbit mq cluster. My consumer is connected this cluster 
> via haproxy.
>
> Consumer raised the following exception connected through the haproxy. 
> If consumer directly connected to the node will not raise any exceptions.
>
> 2013-01-08 16:25:09,745 WARN | SimpleAsyncTaskExecutor-1 | 
> o.s.amqp.rabbit.listener.SimpleMessageListenerContainer | Consumer 
> raised exception, processing can restart if the connection factory 
> supports it. Exception summary: 
> com.rabbitmq.client.ShutdownSignalException: connection error; reason: 
> java.io.EOFException
>

Is this exception raised immediately (i.e., the consumer cannot 
establish a proper connection at all) or does this exception get 
generated after some time?

From bmkgeek at gmail.com  Thu Jan 10 12:22:57 2013
From: bmkgeek at gmail.com (B MK)
Date: Thu, 10 Jan 2013 17:52:57 +0530
Subject: [rabbitmq-discuss] Connection error on RabbitMQ consumer behind
	haproxy
In-Reply-To: <50EE9F11.7040102@rabbitmq.com>
References: <CADD0VadOdz3w3pR_iWSV0=UfQM9_eKmOEk+Br8wAU5WYbu81-Q@mail.gmail.com>
	<50EE9F11.7040102@rabbitmq.com>
Message-ID: <CADD0VadeSbz-ScCn5eAFP6Kh8HLzveeXSii0SAkgU69DN0ptwQ@mail.gmail.com>

This exception is raised every minute.  If i have connected directly
without haproxy did not raise any exception.


On Thu, Jan 10, 2013 at 4:29 PM, Tim Watson <tim at rabbitmq.com> wrote:

> Hi
>
>
> On 01/08/2013 11:56 AM, B MK wrote:
>
>> Hello,
>>
>> I am using rabbit mq cluster. My consumer is connected this cluster via
>> haproxy.
>>
>> Consumer raised the following exception connected through the haproxy. If
>> consumer directly connected to the node will not raise any exceptions.
>>
>> 2013-01-08 16:25:09,745 WARN | SimpleAsyncTaskExecutor-1 |
>> o.s.amqp.rabbit.listener.**SimpleMessageListenerContainer | Consumer
>> raised exception, processing can restart if the connection factory supports
>> it. Exception summary: com.rabbitmq.client.**ShutdownSignalException:
>> connection error; reason: java.io.EOFException
>>
>>
> Is this exception raised immediately (i.e., the consumer cannot establish
> a proper connection at all) or does this exception get generated after some
> time?
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130110/3f16b7cd/attachment.htm>

From tim at rabbitmq.com  Thu Jan 10 12:48:52 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 10 Jan 2013 12:48:52 +0000
Subject: [rabbitmq-discuss] Connection error on RabbitMQ consumer behind
	haproxy
In-Reply-To: <CADD0VadeSbz-ScCn5eAFP6Kh8HLzveeXSii0SAkgU69DN0ptwQ@mail.gmail.com>
References: <CADD0VadOdz3w3pR_iWSV0=UfQM9_eKmOEk+Br8wAU5WYbu81-Q@mail.gmail.com>
	<50EE9F11.7040102@rabbitmq.com>
	<CADD0VadeSbz-ScCn5eAFP6Kh8HLzveeXSii0SAkgU69DN0ptwQ@mail.gmail.com>
Message-ID: <16A85E19-7137-4D89-A9CA-B4011854D536@rabbitmq.com>

On 10 Jan 2013, at 12:22, B MK wrote:

> This exception is raised every minute.  If i have connected directly without haproxy did not raise any exception.
> 
> 

Right, so we're looking at a regular/consistent connection failure. Have you tried the ha-proxy mailing list: haproxy at formilux.org? I don't think this is a rabbit problem, but it's not clear what (if anything) is wrong with your config, as others on the list have posted similar config that claimed to work (see http://rabbitmq.1065348.n5.nabble.com/Recommended-haproxy-config-td23069.html for example, which had problems after node failure but not dropping connections each minute). 

Cheers,
Tim

> On Thu, Jan 10, 2013 at 4:29 PM, Tim Watson <tim at rabbitmq.com> wrote:
> Hi
> 
> 
> On 01/08/2013 11:56 AM, B MK wrote:
> Hello,
> 
> I am using rabbit mq cluster. My consumer is connected this cluster via haproxy.
> 
> Consumer raised the following exception connected through the haproxy. If consumer directly connected to the node will not raise any exceptions.
> 
> 2013-01-08 16:25:09,745 WARN | SimpleAsyncTaskExecutor-1 | o.s.amqp.rabbit.listener.SimpleMessageListenerContainer | Consumer raised exception, processing can restart if the connection factory supports it. Exception summary: com.rabbitmq.client.ShutdownSignalException: connection error; reason: java.io.EOFException
> 
> 
> Is this exception raised immediately (i.e., the consumer cannot establish a proper connection at all) or does this exception get generated after some time?
> 


From adamrabung at gmail.com  Thu Jan 10 13:24:42 2013
From: adamrabung at gmail.com (Adam Rabung)
Date: Thu, 10 Jan 2013 08:24:42 -0500
Subject: [rabbitmq-discuss] "Load balancing" queue creation
Message-ID: <CAAN_EDqTb++DU5CVQWjT_Dw0nh7qShNrJMkhVM9NX=OyhsTLkg@mail.gmail.com>

Hello,
After reading this<http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-January/017297.html>and
this<http://rabbitmq.1065348.n5.nabble.com/Are-queues-replicated-across-a-cluster-td4670.html>,
I understand that connecting to random nodes of a cluster does not really
help spread the processing cost across all of the nodes - processing
happens in the master (and slaves), regardless of what node I connect to.

Does this suggest that I should take great care of what node I connect to
when _creating_ a queue? If I use
ConnectionFactory.newConnection(Address[]) with the same array each time,
won't a majority of queues be created on the first node of that array,
creating a load balance problem? This scenario assumes we mirror only to a
subset of nodes.

Thank you,
Adam
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130110/4f6346b1/attachment.htm>

From dseltzer at tveyes.com  Thu Jan 10 13:54:04 2013
From: dseltzer at tveyes.com (Dave Seltzer)
Date: Thu, 10 Jan 2013 08:54:04 -0500
Subject: [rabbitmq-discuss] Server-Side Limit for a Channel's Unacknowledged
	Messages
Message-ID: <CAHW0W4PZHvZF_OvcoP0Jc_0_ktOJcyLua6fdrT7MivhBm+oNVQ@mail.gmail.com>

I have a Queue server which serves messages to business partners. Sometimes
our partners use our "reference message receiver", but other times they opt
to roll their own using one of the many RabbitMQ Client APIs. As a result
of this, some of my partners end up with millions of messages which have
been transmitted and are waiting ACK (usually because software on their end
isn't fast enough to process the data and then ACK it.)

In the past this situation has led to trouble. Either a partner disconnects
and all those messages flood back into the "Ready" state to be
re-transmitted. Or the messages TTL expires (and I don't know how this is
handled.)

I was wondering if there's a way to set a policy on the broker that would
effectively limit the size of the pre-fetch queue for clients?

Thanks so much!

-D
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130110/f8b24693/attachment.htm>

From ryan.rajkomar at gmail.com  Thu Jan 10 18:22:57 2013
From: ryan.rajkomar at gmail.com (Shadowalker)
Date: Thu, 10 Jan 2013 10:22:57 -0800 (PST)
Subject: [rabbitmq-discuss] One Producer, X Consumers where X can change
Message-ID: <43c48ee8-ad82-40e2-a11e-9873e89ee8fd@googlegroups.com>

Hi, 
I need to find a solution to a problem of mine and I thought there might be 
one within rabbitmq so here it is :
I have a manager that, when requested to delete an element from its DB, 
needs to notify all other elements that reference the element it needs to 
delete also no logner reference it.

The main idea to keep in mind is that those references that need be removed 
are not necessarily stored in the same DB (nor same server) as the initial 
manager.

So I thought I could use a queue to notify that references to the element I 
want to delete need to be removed. And all element that could have a 
reference to that type of element are set to listen on that queue.

What I'd like to know now is whether I can configure my manager to wait for 
a return "from the queue" (or something else) to be notified that all 
references have been removed.

say 
Manager sends a message to queue Q1.
I can have 1,2,3,more other managers listening on Q1.

Each of them would consume the message and once all of them have consumed 
the message 
I would either send directly a notification to the first manager, or create 
a entry in a queue that the manager listens on so that he would be notified 
that it can delete the element.


Is there anyway to do this ?
Note : the fact that the complete removal of the element is not immediate 
is not an issue ( ex: I can ask for deletion a 11:00 and the deletion be 
effective at 13:00)
Note2 : I've seen the documentation about RPC calls but this is not really 
what I'm looking for and if avoidable, I'll rather do so.

Thanks.

Cheers.


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130110/c8dfe1dd/attachment.htm>

From psl88506 at gmail.com  Fri Jan 11 05:01:55 2013
From: psl88506 at gmail.com (PSL 88506)
Date: Fri, 11 Jan 2013 10:31:55 +0530
Subject: [rabbitmq-discuss]  fanout Exchanges
Message-ID: <CANPBPZnFniXtoPk-kRDUV9n0MXGmT1xOocjNSR0DwGiepZO6ig@mail.gmail.com>

Hi,

We have a requirement, where Fanout exchanges should be used.

Currently we are using E2E binding.

Does RabbitMQ support the below scenarios:

 1) Topic exchange is primary and fanout is secondary.

2) One primary fanout exchange and multiple(N) secondary exchanges wherein
N-1 are secondary  exchanges are topic and only one secondary exchange is
fanout.

Someone please respond.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130111/7b3240a6/attachment.htm>

From raise-0 at 163.com  Fri Jan 11 05:36:24 2013
From: raise-0 at 163.com (raise-0)
Date: Fri, 11 Jan 2013 13:36:24 +0800 (CST)
Subject: [rabbitmq-discuss] log with rabbitmq-client
Message-ID: <3ef1a7dd.840d.13c281bedab.Coremail.raise-0@163.com>

 I came across one issue yesterday, and still not resolved now.
Server: CentOS 6.3 x64, RabbitMQ Server v2.8.7
Client:  CentOS 6.3 x64, RabbitMQ Java Client v2.8.7 Spring AMQP v1.1.3

Problem:

There is one queue with one million message, when i start the client application, the client application can not get any message, from the web admin page, I saw no consumer connection to this queue. The client application is nothing change before restart. I tried to log debug message from the rabbitmq-java-client, but I found it not depend on any log compoment. Before restart, the message can be consumered, but stoped with no error message logged. I was confused. Now, my client application can not start, with no error message logged.

Any one know why and how to resolve it ?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130111/adbf13ae/attachment.htm>

From scott.brown at secondsupper.com  Thu Jan 10 23:29:24 2013
From: scott.brown at secondsupper.com (Scott Brown)
Date: Thu, 10 Jan 2013 15:29:24 -0800 (PST)
Subject: [rabbitmq-discuss] loss o messages on a cluster + durable
	queues + mirrored queues
In-Reply-To: <713977d2-894a-4db1-bf9b-34560a73615f@googlegroups.com>
References: <713977d2-894a-4db1-bf9b-34560a73615f@googlegroups.com>
Message-ID: <dddb908b-de4b-4523-b127-da71592622e7@googlegroups.com>

Alex, I believe what you are seeing is because mirrored queues do not 
automatically sync.

   - When you restart node1 it has 0 messages and is not synced with node2. 
    Since node1 was offline, the durable messages in it's queue are considered 
   out dated, since node2 is more likely to be up to date, and are discarded. 
    Node1 is now a slave of node2, but the messages in node2 are not copied to 
   node1.
   - Then when you restart node2, node1 with 0 messages becomes the master.
   
This can feel odd, because often you bounce one box and then the other for 
maintenance or similar.  You need to make sure that all messages in the 
queue when one node is bounced have been drained before bouncing the other 
node.  You can verify this in a few ways, but the easiest is to just peek 
at the Admin console and your queue will show -1 (or -n for n nodes) rather 
than +1.  This tells you that the mirrors are not synced.


On Wednesday, January 9, 2013 1:57:54 PM UTC-5, Alexandre Bunn wrote:
>
> Good afternoon
>
> I have a 2 nodes cluster with mirrored queues and I'm setting 
> delivery_mode = 2 when I'm publishing messages to the cluster. I'm missing 
> messages when I follow these steps below (for test issues).
>
> Step 0 - Node1 (master) Node2 (slave)
>
> # rabbitmqctl cluster_status
> Cluster status of node 'rabbit at vid-mq01-mia' ...
> [{nodes,[{disc,['rabbit at vid-mq01-mia','rabbit at vid-mq02-mia']}]},
>  {running_nodes,['rabbit at vid-mq02-mia','rabbit at vid-mq01-mia']},
>  {partitions,[]}]
> ...done.
>
> # rabbitmqctl list_policies
> Listing policies ...
> /       ha-all  ^ha\\.  {"ha-mode":"all"}       0
> ...done.
>
> ## rabbitmqctl list_queues name durable policy
> Listing queues ...
> ha.teste        true    ha-all
> ...done.
>
>
> - Step 1 - I write 2 messages, at ha.teste queue, 1 on each member of the 
> cluster and the messages are mirrored as expected. Here there are two 
> messages on each nodes (rabbitmqctl list_queues)
>
> -- node1
> # rabbitmqctl list_queues
> Listing queues ...
> ha.teste        2
> ...done.
> # rabbitmqctl list_queues name pid slave_pids synchronised_slave_pids
> Listing queues ...
> ha.teste        <'rabbit at vid-mq01-mia'.3.253.0> 
> [<'rabbit at vid-mq02-mia'.2.252.0>]       [<'rabbit at vid-mq02-mia'.2.252.0>]
> ...done.
>
> -- node2
> # rabbitmqctl list_queues
> Listing queues ...
> ha.teste        2
> ...done.
> # rabbitmqctl list_queues name pid slave_pids synchronised_slave_pids
> Listing queues ...
> ha.teste        <'rabbit at vid-mq01-mia'.3.253.0> 
> [<'rabbit at vid-mq02-mia'.2.252.0>]       [<'rabbit at vid-mq02-mia'.2.252.0>]
> ...done.
>
> - Step 2 - I've stopped rabbitmq-server on node1 and node2 assume the 
> master. Here there are the two messages on node2
>
> -- Logs on node2
> Mirrored-queue (queue 'ha.teste' in vhost '/'): Promoting slave 
> <'rabbit at vid-mq02-mia'.2.252.0> to master
>
> -- Status of the cluster on node2
>
> # rabbitmqctl cluster_status
> Cluster status of node 'rabbit at vid-mq02-mia' ...
> [{nodes,[{disc,['rabbit at vid-mq01-mia','rabbit at vid-mq02-mia']}]},
>  {running_nodes,['rabbit at vid-mq02-mia']},
>  {partitions,[]}]
> ...done.
>
> -- Status of the ha.teste queue on node2
>
> # rabbitmqctl list_queues
> Listing queues ...
> ha.teste        2
> ...done.
> # rabbitmqctl list_queues name pid slave_pids synchronised_slave_pids
> Listing queues ...
> ha.teste        <'rabbit at vid-mq02-mia'.2.252.0> []      []
> ...done.
>
> - Step 3 - I start the rabbitmq-server on node1, node2 still master and 
> node1 is running as slave. Here there are the two messages on node1 and 
> node2
>
> -- Log on node2
> =INFO REPORT==== 9-Jan-2013::18:40:46 ===
> rabbit on node 'rabbit at vid-mq01-mia' up
>
> -- Status of the cluster on node1
>
> # rabbitmqctl cluster_status
> Cluster status of node 'rabbit at vid-mq01-mia' ...
> [{nodes,[{disc,['rabbit at vid-mq01-mia','rabbit at vid-mq02-mia']}]},
>  {running_nodes,['rabbit at vid-mq02-mia','rabbit at vid-mq01-mia']},
>  {partitions,[]}]
> ...done.
>
> -- Status of the ha.teste queue on node2
> # rabbitmqctl list_queues
> Listing queues ...
> ha.teste        2
> ...done.
>
> # rabbitmqctl list_queues name pid slave_pids synchronised_slave_pids
> Listing queues ...
> ha.teste        <'rabbit at vid-mq02-mia'.2.252.0> 
> [<'rabbit at vid-mq01-mia'.1.253.0>]       []
> ...done.
>
> - Step 4 - I've stopped rabbitmq-server on node2 and node1 assume the 
> master but the messages disapeared
>
> -- Logs on node1
>
> =INFO REPORT==== 9-Jan-2013::18:43:42 ===
> Mirrored-queue (queue 'ha.teste' in vhost '/'): Promoting slave 
> <'rabbit at vid-mq01-mia'.1.253.0> to master
>
> =INFO REPORT==== 9-Jan-2013::18:43:42 ===
> rabbit on node 'rabbit at vid-mq02-mia' down
>
> -- Cluster status on node1
>
> # rabbitmqctl cluster_status
> Cluster status of node 'rabbit at vid-mq01-mia' ...
> [{nodes,[{disc,['rabbit at vid-mq01-mia','rabbit at vid-mq02-mia']}]},
>  {running_nodes,['rabbit at vid-mq01-mia']},
>  {partitions,[]}]
> ...done.
>
> -- Status of the ha.teste queue on node1
>
> # rabbitmqctl list_queues
> Listing queues ...
> ha.teste        0
> ...done.
>
> # rabbitmqctl list_queues name pid slave_pids synchronised_slave_pids
> Listing queues ...
> ha.teste        <'rabbit at vid-mq01-mia'.1.253.0> []      []
> ...done.
>
> Is it expected? What we have to do at server side or client side (python 
> script) to make the messages really durable? All the servers are running 
> centos6 x86_64 and rabbitmq 3.0.1-1.
>
> Thanks
>
> Alexandre Bunn
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130110/f7be03ae/attachment.htm>

From Dragos.Manolescu at servicenow.com  Fri Jan 11 02:04:20 2013
From: Dragos.Manolescu at servicenow.com (Dragos Manolescu)
Date: Fri, 11 Jan 2013 02:04:20 +0000
Subject: [rabbitmq-discuss] pika's blocking channel exchange_declare
	hanging???
Message-ID: <E29A2349FBDC2F429089E672A7FD29A92F9268F9@SJC4EXDAG01-01.corp.service-now.com>

Hi --

I am experiencing a behavior I didn't expect--and don't understand :( In the following simplified code:

        try:
            self.out_channel.exchange_declare\
                ( exchange=exchange
                , type="topic"
                , passive=False
                , durable=True
                , auto_delete=False
                , nowait=True
            )
            msg_props = pika.BasicProperties(content_type="application/json", delivery_mode=2)
            self.out_channel.basic_publish\
                ( body=message
                , exchange=exchange
                , properties=msg_props
                , routing_key=routing_key
                )
        except pika.exceptions.AMQPError:
            self.logger.exception("Message not sent")

The exchange_declare above seems to block indefinitely; out-channel is a channel obtained from a blocking connection.

Here's the context: node N1 (which contains the above code) uses pika.BlockingConnection to communicate with the broker, which is connected to two other nodes N2 and N3. Upon receiving a message from N2 via a fanout exchange, N1 acknowledges it and then sends N2 a message over a different, topic exchange. The interaction between N1 and N3 follows an identical pattern.

I noticed that when both N2 and N3 send messages to N1, the above code works as I thought it would only for one of them (say N2), while the exchange_declare hangs for the other (N3). The code works fine if I comment out the exchange_declare call. N1 uses 2 channels, one for incoming messages (fanout exchange) and one for outgoing messages (topic exchange).

I am using RabbitMQ 3.0.0 and pika 0.9.8.

Many (but not) all samples invoke exchange_declare as I did above (as it is idempotent) so I assume that I'm missing something rather than making a call I should not make. FWIW the exchange_declare for N1's other, fanout exchange never hangs.

Thanks,

-dm


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130111/8a63431c/attachment.htm>

From emile at rabbitmq.com  Fri Jan 11 10:10:54 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 11 Jan 2013 10:10:54 +0000
Subject: [rabbitmq-discuss] fanout Exchanges
In-Reply-To: <CANPBPZnFniXtoPk-kRDUV9n0MXGmT1xOocjNSR0DwGiepZO6ig@mail.gmail.com>
References: <CANPBPZnFniXtoPk-kRDUV9n0MXGmT1xOocjNSR0DwGiepZO6ig@mail.gmail.com>
Message-ID: <50EFE52E.6070505@rabbitmq.com>

On 11/01/13 05:01, PSL 88506 wrote:
>  1) Topic exchange is primary and fanout is secondary. 

I assume you consider the exchange that publishers send to as the
primary and the exchange bound to the primary as the secondary. Yes
rabbit supports this. The secondary exchange will need to bind with a
sensible routing key and it is possible to achieve an equivalent effect
if consumers bind to the primary exchange with the same routing key.

> 2) One primary fanout exchange and multiple(N) secondary exchanges
> wherein N-1 are secondary  exchanges are topic and only one secondary
> exchange is fanout.

This is a supported topology, though I can't think of any good reasons
for the secondary fanout exchange.


-Emile



From matthias at rabbitmq.com  Fri Jan 11 10:14:28 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 11 Jan 2013 10:14:28 +0000
Subject: [rabbitmq-discuss] fanout Exchanges
In-Reply-To: <50EFE52E.6070505@rabbitmq.com>
References: <CANPBPZnFniXtoPk-kRDUV9n0MXGmT1xOocjNSR0DwGiepZO6ig@mail.gmail.com>
	<50EFE52E.6070505@rabbitmq.com>
Message-ID: <50EFE604.3000900@rabbitmq.com>

On 11/01/13 10:10, Emile Joubert wrote:
> On 11/01/13 05:01, PSL 88506 wrote:
>>   1) Topic exchange is primary and fanout is secondary.
>
> Yes, rabbit supports this.
>> 2) One primary fanout exchange and multiple(N) secondary exchanges
>> wherein N-1 are secondary  exchanges are topic and only one secondary
>> exchange is fanout.
>
> This is a supported topology

All of which one could quite easily discover by playing with the 
management UI.

Matthias.


From tim at rabbitmq.com  Fri Jan 11 10:23:39 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 11 Jan 2013 10:23:39 +0000
Subject: [rabbitmq-discuss] log with rabbitmq-client
In-Reply-To: <3ef1a7dd.840d.13c281bedab.Coremail.raise-0@163.com>
References: <3ef1a7dd.840d.13c281bedab.Coremail.raise-0@163.com>
Message-ID: <14A53B53-BB5A-465B-876D-95037D728730@rabbitmq.com>

Hi

On 11 Jan 2013, at 05:36, raise-0 wrote:

>  I came across one issue yesterday, and still not resolved now.
> Server: CentOS 6.3 x64, RabbitMQ Server v2.8.7
> Client:  CentOS 6.3 x64, RabbitMQ Java Client v2.8.7 Spring AMQP v1.1.3
> Problem:
> There is one queue with one million message, when i start the client application, the client application can not get any message, from the web admin page, I saw no consumer connection to this queue. The client application is nothing change before restart. I tried to log debug message from the rabbitmq-java-client, but I found it not depend on any log compoment. Before restart, the message can be consumered, but stoped with no error message logged. I was confused. Now, my client application can not start, with no error message logged.
> 

It's very unclear what you're asking here and you've given us almost nothing to go on, so it's quite hard to suggest where to start. First you say that when starting the client you 'can not get any message', then later on you say the 'client application is nothing change [sic] before restart' - does this mean that you've restarted the broker whilst the client is still running? The RabbitMQ java client does not automatically re-connect after a broker restarts (thereby terminating the connection), although spring AMQP *may* offer some support for this - see http://forum.springsource.org/showthread.php?111170-rabbitmq-Retry-Reconnection-policy.

'Now, my client application can not start' - this is a different issue from not being able to consume messages after a restart.

> Any one know why and how to resolve it ?

If you're dealing with a client that *was* connected before the broker was restarted, then your client will have lost its connection to the broker. The client will need to re-connect to the broker, and you will need to write the code to handle that unless you're using some external library to do it for you.

For the latter problem, viz 'my client application can not start' the answer is "it depends". What do you mean by "cannot start" - the fact there is no logging in the client is irrelevant to some extent. You *must* know which branch of your code attempts to establish the connection, so what is not happening when the client starts that you were expecting to happen? Is there an exception, or does the code block indefinitely, or do small gremlins climb out of the server and start attacking people!? The more information you give us, the better we'll be able to help you ok! ;-)

Cheers,
Tim

From albunn at gmail.com  Fri Jan 11 10:51:38 2013
From: albunn at gmail.com (Alexandre Bunn)
Date: Fri, 11 Jan 2013 02:51:38 -0800 (PST)
Subject: [rabbitmq-discuss] loss o messages on a cluster + durable
	queues + mirrored queues
In-Reply-To: <dddb908b-de4b-4523-b127-da71592622e7@googlegroups.com>
References: <713977d2-894a-4db1-bf9b-34560a73615f@googlegroups.com>
	<dddb908b-de4b-4523-b127-da71592622e7@googlegroups.com>
Message-ID: <a8e3cf90-27c3-4ef0-86eb-2f48e141f445@googlegroups.com>

I've found in a forum 
(http://comments.gmane.org/gmane.comp.networking.rabbitmq.general/12438) a 
user that have reported the same situation and an user have answered:

"

You can run "rabbitmqctl list_queues name slave_pids
synchronised_slave_pids" to see if the cluster is synchronized or not
but I can tell you right now that they will not be. In step 3 when you
start vm1 back up and it is the slave. It is telling you that there
are 10 messages in the vm2 queue. When you talk to a broker in a
cluster it will talk to the master queue. VM1 will not be synchronized
until all 10 messages are read out of the vm2 queue, because rabbitmq
mirrored clusters do not read old messages that are already in the
master queue. The slave reads the tail of the new message being sent
to the master and expects that once it has been long enough then it
will catch up to the same state as the master.
http://www.rabbitmq.com/ha.html "Unsynchronised Slaves" I think does a
good job of explaining it.
"


Does rabbitmq continues with this behavior? Is there any configuration that 
I can do to solve this issue?

Thanks

Alexandre

Em quinta-feira, 10 de janeiro de 2013 21h29min24s UTC-2, Scott Brown 
escreveu:
>
> Alex, I believe what you are seeing is because mirrored queues do not 
> automatically sync.
>
>    - When you restart node1 it has 0 messages and is not synced with 
>    node2.  Since node1 was offline, the durable messages in it's queue are 
>    considered out dated, since node2 is more likely to be up to date, and are 
>    discarded.  Node1 is now a slave of node2, but the messages in node2 are 
>    not copied to node1.
>    - Then when you restart node2, node1 with 0 messages becomes the 
>    master.
>    
> This can feel odd, because often you bounce one box and then the other for 
> maintenance or similar.  You need to make sure that all messages in the 
> queue when one node is bounced have been drained before bouncing the other 
> node.  You can verify this in a few ways, but the easiest is to just peek 
> at the Admin console and your queue will show -1 (or -n for n nodes) rather 
> than +1.  This tells you that the mirrors are not synced.
>
>
> On Wednesday, January 9, 2013 1:57:54 PM UTC-5, Alexandre Bunn wrote:
>>
>> Good afternoon
>>
>> I have a 2 nodes cluster with mirrored queues and I'm setting 
>> delivery_mode = 2 when I'm publishing messages to the cluster. I'm missing 
>> messages when I follow these steps below (for test issues).
>>
>> Step 0 - Node1 (master) Node2 (slave)
>>
>> # rabbitmqctl cluster_status
>> Cluster status of node 'rabbit at vid-mq01-mia' ...
>> [{nodes,[{disc,['rabbit at vid-mq01-mia','rabbit at vid-mq02-mia']}]},
>>  {running_nodes,['rabbit at vid-mq02-mia','rabbit at vid-mq01-mia']},
>>  {partitions,[]}]
>> ...done.
>>
>> # rabbitmqctl list_policies
>> Listing policies ...
>> /       ha-all  ^ha\\.  {"ha-mode":"all"}       0
>> ...done.
>>
>> ## rabbitmqctl list_queues name durable policy
>> Listing queues ...
>> ha.teste        true    ha-all
>> ...done.
>>
>>
>> - Step 1 - I write 2 messages, at ha.teste queue, 1 on each member of the 
>> cluster and the messages are mirrored as expected. Here there are two 
>> messages on each nodes (rabbitmqctl list_queues)
>>
>> -- node1
>> # rabbitmqctl list_queues
>> Listing queues ...
>> ha.teste        2
>> ...done.
>> # rabbitmqctl list_queues name pid slave_pids synchronised_slave_pids
>> Listing queues ...
>> ha.teste        <'rabbit at vid-mq01-mia'.3.253.0> 
>> [<'rabbit at vid-mq02-mia'.2.252.0>]       [<'rabbit at vid-mq02-mia'.2.252.0>]
>> ...done.
>>
>> -- node2
>> # rabbitmqctl list_queues
>> Listing queues ...
>> ha.teste        2
>> ...done.
>> # rabbitmqctl list_queues name pid slave_pids synchronised_slave_pids
>> Listing queues ...
>> ha.teste        <'rabbit at vid-mq01-mia'.3.253.0> 
>> [<'rabbit at vid-mq02-mia'.2.252.0>]       [<'rabbit at vid-mq02-mia'.2.252.0>]
>> ...done.
>>
>> - Step 2 - I've stopped rabbitmq-server on node1 and node2 assume the 
>> master. Here there are the two messages on node2
>>
>> -- Logs on node2
>> Mirrored-queue (queue 'ha.teste' in vhost '/'): Promoting slave 
>> <'rabbit at vid-mq02-mia'.2.252.0> to master
>>
>> -- Status of the cluster on node2
>>
>> # rabbitmqctl cluster_status
>> Cluster status of node 'rabbit at vid-mq02-mia' ...
>> [{nodes,[{disc,['rabbit at vid-mq01-mia','rabbit at vid-mq02-mia']}]},
>>  {running_nodes,['rabbit at vid-mq02-mia']},
>>  {partitions,[]}]
>> ...done.
>>
>> -- Status of the ha.teste queue on node2
>>
>> # rabbitmqctl list_queues
>> Listing queues ...
>> ha.teste        2
>> ...done.
>> # rabbitmqctl list_queues name pid slave_pids synchronised_slave_pids
>> Listing queues ...
>> ha.teste        <'rabbit at vid-mq02-mia'.2.252.0> []      []
>> ...done.
>>
>> - Step 3 - I start the rabbitmq-server on node1, node2 still master and 
>> node1 is running as slave. Here there are the two messages on node1 and 
>> node2
>>
>> -- Log on node2
>> =INFO REPORT==== 9-Jan-2013::18:40:46 ===
>> rabbit on node 'rabbit at vid-mq01-mia' up
>>
>> -- Status of the cluster on node1
>>
>> # rabbitmqctl cluster_status
>> Cluster status of node 'rabbit at vid-mq01-mia' ...
>> [{nodes,[{disc,['rabbit at vid-mq01-mia','rabbit at vid-mq02-mia']}]},
>>  {running_nodes,['rabbit at vid-mq02-mia','rabbit at vid-mq01-mia']},
>>  {partitions,[]}]
>> ...done.
>>
>> -- Status of the ha.teste queue on node2
>> # rabbitmqctl list_queues
>> Listing queues ...
>> ha.teste        2
>> ...done.
>>
>> # rabbitmqctl list_queues name pid slave_pids synchronised_slave_pids
>> Listing queues ...
>> ha.teste        <'rabbit at vid-mq02-mia'.2.252.0> 
>> [<'rabbit at vid-mq01-mia'.1.253.0>]       []
>> ...done.
>>
>> - Step 4 - I've stopped rabbitmq-server on node2 and node1 assume the 
>> master but the messages disapeared
>>
>> -- Logs on node1
>>
>> =INFO REPORT==== 9-Jan-2013::18:43:42 ===
>> Mirrored-queue (queue 'ha.teste' in vhost '/'): Promoting slave 
>> <'rabbit at vid-mq01-mia'.1.253.0> to master
>>
>> =INFO REPORT==== 9-Jan-2013::18:43:42 ===
>> rabbit on node 'rabbit at vid-mq02-mia' down
>>
>> -- Cluster status on node1
>>
>> # rabbitmqctl cluster_status
>> Cluster status of node 'rabbit at vid-mq01-mia' ...
>> [{nodes,[{disc,['rabbit at vid-mq01-mia','rabbit at vid-mq02-mia']}]},
>>  {running_nodes,['rabbit at vid-mq01-mia']},
>>  {partitions,[]}]
>> ...done.
>>
>> -- Status of the ha.teste queue on node1
>>
>> # rabbitmqctl list_queues
>> Listing queues ...
>> ha.teste        0
>> ...done.
>>
>> # rabbitmqctl list_queues name pid slave_pids synchronised_slave_pids
>> Listing queues ...
>> ha.teste        <'rabbit at vid-mq01-mia'.1.253.0> []      []
>> ...done.
>>
>> Is it expected? What we have to do at server side or client side (python 
>> script) to make the messages really durable? All the servers are running 
>> centos6 x86_64 and rabbitmq 3.0.1-1.
>>
>> Thanks
>>
>> Alexandre Bunn
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130111/096c6d24/attachment.htm>

From matthias at rabbitmq.com  Fri Jan 11 10:59:30 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 11 Jan 2013 10:59:30 +0000
Subject: [rabbitmq-discuss] loss o messages on a cluster + durable
 queues + mirrored queues
In-Reply-To: <a8e3cf90-27c3-4ef0-86eb-2f48e141f445@googlegroups.com>
References: <713977d2-894a-4db1-bf9b-34560a73615f@googlegroups.com>
	<dddb908b-de4b-4523-b127-da71592622e7@googlegroups.com>
	<a8e3cf90-27c3-4ef0-86eb-2f48e141f445@googlegroups.com>
Message-ID: <50EFF092.9090605@rabbitmq.com>

Alexandre,

On 11/01/13 10:51, Alexandre Bunn wrote:
> Does rabbitmq continues with this behavior?

See 
http://rabbitmq.1065348.n5.nabble.com/Unsynchronised-Slaves-in-3-0-tt24374.html

Matthias.

From tim at rabbitmq.com  Fri Jan 11 10:59:28 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 11 Jan 2013 10:59:28 +0000
Subject: [rabbitmq-discuss] "Load balancing" queue creation
In-Reply-To: <CAAN_EDqTb++DU5CVQWjT_Dw0nh7qShNrJMkhVM9NX=OyhsTLkg@mail.gmail.com>
References: <CAAN_EDqTb++DU5CVQWjT_Dw0nh7qShNrJMkhVM9NX=OyhsTLkg@mail.gmail.com>
Message-ID: <50EFF090.8010005@rabbitmq.com>

Hi Adam,

On 01/10/2013 01:24 PM, Adam Rabung wrote:
> Hello,
> After reading this 
> <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-January/017297.html> 
> and this 
> <http://rabbitmq.1065348.n5.nabble.com/Are-queues-replicated-across-a-cluster-td4670.html>, 
> I understand that connecting to random nodes of a cluster does not 
> really help spread the processing cost across all of the nodes - 
> processing happens in the master (and slaves), regardless of what node 
> I connect to.
>
> Does this suggest that I should take great care of what node I connect 
> to when _creating_ a queue? If I use 
> ConnectionFactory.newConnection(Address[]) with the same array each 
> time, won't a majority of queues be created on the first node of that 
> array, creating a load balance problem? This scenario assumes we 
> mirror only to a subset of nodes.
>

No that's not the case. RabbitMQ clusters replicate *all* entities 
across *all* nodes (in the cluster), so it doesn't matter where you 
_create_ the queue/exchange. Mirroring is somewhat orthogonal to 
clustering, in that if you create a queue Foo then it will exist on all 
the nodes anyway, but only if you mirror the queues across some nodes 
will messages arriving at the said queue on one particular node get 
replicated to the same queue on the other (mirrored) nodes.

HTH

Tim

> Thank you,
> Adam
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130111/d324fb1f/attachment.htm>

From raise-0 at 163.com  Fri Jan 11 11:08:38 2013
From: raise-0 at 163.com (raise-0)
Date: Fri, 11 Jan 2013 19:08:38 +0800 (CST)
Subject: [rabbitmq-discuss] log with rabbitmq-client
In-Reply-To: <14A53B53-BB5A-465B-876D-95037D728730@rabbitmq.com>
References: <3ef1a7dd.840d.13c281bedab.Coremail.raise-0@163.com>
	<14A53B53-BB5A-465B-876D-95037D728730@rabbitmq.com>
Message-ID: <39201dc5.ca5f.13c294c1839.Coremail.raise-0@163.com>

Sorry,Tim, It is my problem that make such unclear question.


I can not get more message, log4j loglevel is debug, and still no exception logged.  I restarted my applications again and again and want to get some log from rabbmit-java-client,but got none.

If it is the application's problem, why my app can get message in early days? What i have done is just restart, no other change.
If it is the rabbitmq's problem, why other application and queue is running whithout any problem ?


At last, I killed the rabbitmq-server process, restart it , and also restart my application again, erverything goes fine. So confused.


My question is , Is rabbitmq-java-client supports any logging compoments?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130111/122e6f46/attachment.htm>

From tim at rabbitmq.com  Fri Jan 11 11:11:10 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 11 Jan 2013 11:11:10 +0000
Subject: [rabbitmq-discuss] "Load balancing" queue creation
In-Reply-To: <50EFF090.8010005@rabbitmq.com>
References: <CAAN_EDqTb++DU5CVQWjT_Dw0nh7qShNrJMkhVM9NX=OyhsTLkg@mail.gmail.com>
	<50EFF090.8010005@rabbitmq.com>
Message-ID: <50EFF34E.1010403@rabbitmq.com>

Adam - sorry, ignore me, I'm talking nonsense here... :/

On 01/11/2013 10:59 AM, Tim Watson wrote:
> Hi Adam,
>
> On 01/10/2013 01:24 PM, Adam Rabung wrote:
>> Hello,
>> After reading this 
>> <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-January/017297.html> 
>> and this 
>> <http://rabbitmq.1065348.n5.nabble.com/Are-queues-replicated-across-a-cluster-td4670.html>, 
>> I understand that connecting to random nodes of a cluster does not 
>> really help spread the processing cost across all of the nodes - 
>> processing happens in the master (and slaves), regardless of what 
>> node I connect to.
>>
>> Does this suggest that I should take great care of what node I 
>> connect to when _creating_ a queue? If I use 
>> ConnectionFactory.newConnection(Address[]) with the same array each 
>> time, won't a majority of queues be created on the first node of that 
>> array, creating a load balance problem? This scenario assumes we 
>> mirror only to a subset of nodes.
>>

I should have taken more notice of Address[] here, but also if you're 
*not* mirroring then whilst the queue records get replicated throughout 
the cluster, the queue process (which actually handles messages) only 
resides on the one node. So yes, you should Random.shuffle (or something 
like that) the Address[] or load balance. Also even with mirror queues 
the master is where the bulk of the work is taking place, so the same 
applies.

Sorry for the confusion!

Cheers,
Tim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130111/17bdc3c5/attachment.htm>

From emile at rabbitmq.com  Fri Jan 11 11:30:00 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 11 Jan 2013 11:30:00 +0000
Subject: [rabbitmq-discuss] One Producer, X Consumers where X can change
In-Reply-To: <43c48ee8-ad82-40e2-a11e-9873e89ee8fd@googlegroups.com>
References: <43c48ee8-ad82-40e2-a11e-9873e89ee8fd@googlegroups.com>
Message-ID: <50EFF7B8.5090709@rabbitmq.com>


Hi,

On 10/01/13 18:22, Shadowalker wrote:
> What I'd like to know now is whether I can configure my manager to wait
> for a return "from the queue" (or something else) to be notified that
> all references have been removed.

If the manager knows how many responses to expect then a possible
solution would be for the manager to populate the "reply-to" property in
the request message and have replies sent to this queue. The manager can
take action as soon as all replies are received.

If the manager does not know how many replies to expect then the problem
becomes alot harder. It becomes tricky to distinguish between a consumer
crashing and a message taking very long to process. You may need to
tolerate the presence of timeouts.

> Note2 : I've seen the documentation about RPC calls but this is not
> really what I'm looking for and if avoidable, I'll rather do so.

Two-way communication is the easiest way to solve this problem. Can you
explain your reluctance to avoid RPC?



-Emile




From tim at rabbitmq.com  Fri Jan 11 11:37:25 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 11 Jan 2013 11:37:25 +0000
Subject: [rabbitmq-discuss] One Producer, X Consumers where X can change
In-Reply-To: <43c48ee8-ad82-40e2-a11e-9873e89ee8fd@googlegroups.com>
References: <43c48ee8-ad82-40e2-a11e-9873e89ee8fd@googlegroups.com>
Message-ID: <50EFF975.5090108@rabbitmq.com>

Hi

On 01/10/2013 06:22 PM, Shadowalker wrote:
> Hi,
> I need to find a solution to a problem of mine and I thought there 
> might be one within rabbitmq so here it is :
> I have a manager that, when requested to delete an element from its 
> DB, needs to notify all other elements that reference the element it 
> needs to delete also no logner reference it.
>
> The main idea to keep in mind is that those references that need be 
> removed are not necessarily stored in the same DB (nor same server) as 
> the initial manager.
>
> So I thought I could use a queue to notify that references to the 
> element I want to delete need to be removed. And all element that 
> could have a reference to that type of element are set to listen on 
> that queue.
>

That's fine, but remember that queues will deliver messages in a 
round-robin fashion when there are multiple consumers. What you'd need 
for this is a pub-sub model, so a fanout exchange and multiple temporary 
(exclusive, auto-delete) queues would be the canonical approach. See 
http://www.rabbitmq.com/tutorials/tutorial-three-python.html for example.

> What I'd like to know now is whether I can configure my manager to 
> wait for a return "from the queue" (or something else) to be notified 
> that all references have been removed.
>

This is a very different problem to notifying all the consumers. If you 
have N consumers and you want to wait for N replies that the reference 
has been deleted/cleared, how do you know the value of N in the manager? 
Without knowing the value of N, there's no way to implement this with 
queues or otherwise.

> say
> Manager sends a message to queue Q1.
> I can have 1,2,3,more other managers listening on Q1.
>
> Each of them would consume the message and once all of them have 
> consumed the message
> I would either send directly a notification to the first manager, or 
> create a entry in a queue that the manager listens on so that he would 
> be notified that it can delete the element.
>
>
> Is there anyway to do this ?

Yes, you can set up as many queues and bindings, backwards and forwards 
between the various publishers and receivers as you like. But what 
you've described doesn't seem to address the requirement you stated above.

> Note : the fact that the complete removal of the element is not 
> immediate is not an issue ( ex: I can ask for deletion a 11:00 and the 
> deletion be effective at 13:00)
> Note2 : I've seen the documentation about RPC calls but this is not 
> really what I'm looking for and if avoidable, I'll rather do so.

Well, what you're describing is *inherently* an RPC call from the way 
you've described it. Of course the 'manager' sending a "Release Ref#1" 
message might need to get on with other work whilst waiting for the 
replies to come in, so you'd have a pretty interesting topology here.

Firstly, the manager who sends the 'release' notification needs to know 
how many replies to expect. In order to know this, the manager needs to 
*first* receive a message to 'acquire' the resource for each 
participant. Because the manager responsible for releasing also needs to 
know about acquisition, I'm going to refer to this manager as the 
'master' node from now on. Once the master knows about all the acquired 
references, when it is time to release the resource the manager can 
transmit a release notification to a fanout exchange as I described 
earlier. Then the master waits on *another* queue for replies from all 
the participants holding a reference to say they've released it.

participant(s) => res.acquire [direct-exchange]   => master
participant(s) <= res.release [fanout-exchange] <= master
participant(s) => res.released_ok                        => master

Of course there are some things missing from this topology. For the 
participants to deal robustly with their references, they might need to 
wait for the master to respond that it has accepted their 'acquire' 
request, otherwise what if the master was down? Secondly, and this is 
*most* important, the master has no way to *know* if one of the 
participants crashes or if the network between the broker and the 
clients goes down. This means that that master could get stuck forever 
waiting for the 'released_ok' message from that participant. Even if the 
master wasn't blocking on those replies, it would still not correctly 
release the resource because one (or more) replies was missing. The AMQP 
protocol doesn't provide any primitives for a connected client to know 
about the state of other connected clients.

The problem you're describing, distributed resource management (e.g., 
locking or reference counting) is a fairly complex one. I'm not entirely 
convinced that a messaging based solution is the right fit for your 
needs by itself. You could, of course, design a solution using AMQP as 
the communication protocol between nodes, but there would need to be a 
significant amount of software running on each node to handle things 
like member(ship) state in the connected graph as well.

It sounds to me like a distributed database would be a *much* more 
natural fit to what you're doing. Another approach would be to soft 
delete the element initially, then only hard delete it once you've seen 
all the replies. This is a half-and-half solution that doesn't assume 
the master is able to know about crashing or disconnecting clients on 
other nodes. If you get into a situation where a node N1 that held a 
lock/reference dies and becomes unrecoverable (i.e., hdd crashed and 
database for the node is lost) then an administrator could then go into 
the database and perform the hard delete providing the lock-count has 
decremented to [N1] and thus we know no other locks/references exist.

I hope I haven't put you off using Rabbit, but I hope I have pointed out 
the many general pitfalls in trying to manage distributed locks. Feel 
free to push back with any further questions.

Cheers,
Tim

From andrea.girardi at gmail.com  Fri Jan 11 13:34:25 2013
From: andrea.girardi at gmail.com (Andrea Girardi)
Date: Fri, 11 Jan 2013 05:34:25 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ and Camel : route interrupted due to
 "Message dropped on recovery"
Message-ID: <11126d73-8df0-40f4-9c4e-d627b8c05028@googlegroups.com>



Hi there,



I'm having a frustrating issue with RabbitMQ and sprimg-amqp, maybe someone 
could help me.


I need to send a message to a queue from an external process (a JUnit class 
just to test if routing works well). This is my camel-context.xml file:


 <camelContext xmlns="http://camel.apache.org/schema/spring">

<route> 

<from uri=
"spring-amqp:KipcastDirect:KipcastQueue:KipcastRouting?type=direct&amp;autodelete=true&amp;durable=true" 
/>

<log message="Message received!!! "/> 

<to   uri=
"spring-amqp:KipcastDirect2:TestQueue:KipcastRouting2?type=direct&amp;autodelete=false&amp;durable=true" 
/>

</route>

</camelContext>


when I started it using maven camel:run it works fine. The exchange is 
available and also queue in RabbitMQ Management. The problem happens when I 
try to send a message to that Exchange:


ConnectionFactory factory = new ConnectionFactory();

factory.setHost("10.211.55.20");

factory.setPort(5672);

factory.setVirtualHost("/");

factory.setUsername("guest");

factory.setPassword("guest");

Connection connection = factory.newConnection();

Channel channel = connection.createChannel();


channel.exchangeDeclare("KipcastDirect", "direct", 

   true, /* durable */

   true, /* autodelete */

   null); /* */

   

byte[] messageBodyBytes = "Hello, world!".getBytes();

  

AMQP.BasicProperties.Builder bob = new AMQP.BasicProperties.Builder();

AMQP.BasicProperties minBasic = bob.build();

minBasic = bob.priority(0).messageId("Test").build(); 

minBasic = bob.priority(0).deliveryMode(1).build(); 


while (true) {


    channel.basicPublish("KipcastDirect", "KipcastRouting", minBasic, 
messageBodyBytes);

    System.out.println(" [x] Sent ");

    

}


Messages are correctly sent to queue (I can see them on log) but an 
exception is raised and the route is stopped:


[     SimpleAsyncTaskExecutor-1] SpringAMQPConsumer             WARN  
Caused by: [
org.springframework.amqp.rabbit.listener.ListenerExecutionFailedException - 
Listener threw exception]

org.springframework.amqp.rabbit.listener.ListenerExecutionFailedException: 
Listener threw exception

at 
org.springframework.amqp.rabbit.listener.AbstractMessageListenerContainer.wrapToListenerExecutionFailedExceptionIfNeeded(
AbstractMessageListenerContainer.java:590)[spring-rabbit-1.0.0.RELEASE.jar:]

at 
org.springframework.amqp.rabbit.listener.AbstractMessageListenerContainer.doInvokeListener(
AbstractMessageListenerContainer.java:529)[spring-rabbit-1.0.0.RELEASE.jar:]

at 
org.springframework.amqp.rabbit.listener.AbstractMessageListenerContainer.invokeListener(
AbstractMessageListenerContainer.java:472)[spring-rabbit-1.0.0.RELEASE.jar:]

at 
org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.access$001(
SimpleMessageListenerContainer.java:56)[spring-rabbit-1.0.0.RELEASE.jar:]

at 
org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer$1.invokeListener(
SimpleMessageListenerContainer.java:103)[spring-rabbit-1.0.0.RELEASE.jar:]

at sun.reflect.GeneratedMethodAccessor21.invoke(Unknown Source)

at sun.reflect.DelegatingMethodAccessorImpl.invoke(
DelegatingMethodAccessorImpl.java:25)[:1.6.0_37]

at java.lang.reflect.Method.invoke(Method.java:597)[:1.6.0_37]

at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(
AopUtils.java:309)[spring-aop-3.0.7.RELEASE.jar:3.0.7.RELEASE]

at 
org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(
ReflectiveMethodInvocation.java:183
)[spring-aop-3.0.7.RELEASE.jar:3.0.7.RELEASE]

at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(
ReflectiveMethodInvocation.java:150
)[spring-aop-3.0.7.RELEASE.jar:3.0.7.RELEASE]

at 
org.springframework.retry.interceptor.StatefulRetryOperationsInterceptor$MethodInvocationRetryCallback.doWithRetry(
StatefulRetryOperationsInterceptor.java:173
)[spring-retry-1.0.0.RELEASE.jar:]

at org.springframework.retry.support.RetryTemplate.doExecute(
RetryTemplate.java:239)[spring-retry-1.0.0.RELEASE.jar:]

at org.springframework.retry.support.RetryTemplate.execute(
RetryTemplate.java:186)[spring-retry-1.0.0.RELEASE.jar:]

at 
org.springframework.retry.interceptor.StatefulRetryOperationsInterceptor.invoke(
StatefulRetryOperationsInterceptor.java:145
)[spring-retry-1.0.0.RELEASE.jar:]

at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(
ReflectiveMethodInvocation.java:172
)[spring-aop-3.0.7.RELEASE.jar:3.0.7.RELEASE]

at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(
JdkDynamicAopProxy.java:202)[spring-aop-3.0.7.RELEASE.jar:3.0.7.RELEASE]

at $Proxy46.invokeListener(Unknown Source)[:]

at 
org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.invokeListener(
SimpleMessageListenerContainer.java:560)[spring-rabbit-1.0.0.RELEASE.jar:]

at 
org.springframework.amqp.rabbit.listener.AbstractMessageListenerContainer.executeListener(
AbstractMessageListenerContainer.java:452)[spring-rabbit-1.0.0.RELEASE.jar:]

at 
org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.doReceiveAndExecute(
SimpleMessageListenerContainer.java:436)[spring-rabbit-1.0.0.RELEASE.jar:]

at 
org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.receiveAndExecute(
SimpleMessageListenerContainer.java:420)[spring-rabbit-1.0.0.RELEASE.jar:]

at 
org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.access$200(
SimpleMessageListenerContainer.java:56)[spring-rabbit-1.0.0.RELEASE.jar:]

at 
org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer$AsyncMessageProcessingConsumer.run(
SimpleMessageListenerContainer.java:505)[spring-rabbit-1.0.0.RELEASE.jar:]

at java.lang.Thread.run(Thread.java:680)[:1.6.0_37]

[     SimpleAsyncTaskExecutor-1] erationsInterceptorFactoryBean WARN  
Message dropped on recovery: (Body:'Hello, world!'; ID:Test; 
Content:text/plain; Headers:{}; Exchange:KipcastDirect; 
RoutingKey:KipcastRouting; Reply:null; DeliveryMode:NON_PERSISTENT; 
DeliveryTag:2)

org.springframework.amqp.rabbit.listener.ListenerExecutionFailedException: 
Listener threw exception

at 
org.springframework.amqp.rabbit.listener.AbstractMessageListenerContainer.wrapToListenerExecutionFailedExceptionIfNeeded(
AbstractMessageListenerContainer.java:590)[spring-rabbit-1.0.0.RELEASE.jar:]

at 
org.springframework.amqp.rabbit.listener.AbstractMessageListenerContainer.doInvokeListener(
AbstractMessageListenerContainer.java:529)[spring-rabbit-1.0.0.RELEASE.jar:]

at 
org.springframework.amqp.rabbit.listener.AbstractMessageListenerContainer.invokeListener(
AbstractMessageListenerContainer.java:472)[spring-rabbit-1.0.0.RELEASE.jar:]

at 
org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.access$001(
SimpleMessageListenerContainer.java:56)[spring-rabbit-1.0.0.RELEASE.jar:]

at 
org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer$1.invokeListener(
SimpleMessageListenerContainer.java:103)[spring-rabbit-1.0.0.RELEASE.jar:]

at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)[:1.6.0_37]

at sun.reflect.NativeMethodAccessorImpl.invoke(
NativeMethodAccessorImpl.java:39)[:1.6.0_37]

at sun.reflect.DelegatingMethodAccessorImpl.invoke(
DelegatingMethodAccessorImpl.java:25)[:1.6.0_37]

at java.lang.reflect.Method.invoke(Method.java:597)[:1.6.0_37]

at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(
AopUtils.java:309)[spring-aop-3.0.7.RELEASE.jar:3.0.7.RELEASE]

at 
org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(
ReflectiveMethodInvocation.java:183
)[spring-aop-3.0.7.RELEASE.jar:3.0.7.RELEASE]

at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(
ReflectiveMethodInvocation.java:150
)[spring-aop-3.0.7.RELEASE.jar:3.0.7.RELEASE]

at 
org.springframework.retry.interceptor.StatefulRetryOperationsInterceptor$MethodInvocationRetryCallback.doWithRetry(
StatefulRetryOperationsInterceptor.java:173
)[spring-retry-1.0.0.RELEASE.jar:]

at org.springframework.retry.support.RetryTemplate.doExecute(
RetryTemplate.java:239)[spring-retry-1.0.0.RELEASE.jar:]

at org.springframework.retry.support.RetryTemplate.execute(
RetryTemplate.java:186)[spring-retry-1.0.0.RELEASE.jar:]

at 
org.springframework.retry.interceptor.StatefulRetryOperationsInterceptor.invoke(
StatefulRetryOperationsInterceptor.java:145
)[spring-retry-1.0.0.RELEASE.jar:]

at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(
ReflectiveMethodInvocation.java:172
)[spring-aop-3.0.7.RELEASE.jar:3.0.7.RELEASE]

at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(
JdkDynamicAopProxy.java:202)[spring-aop-3.0.7.RELEASE.jar:3.0.7.RELEASE]

at $Proxy46.invokeListener(Unknown Source)[:]

at 
org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.invokeListener(
SimpleMessageListenerContainer.java:560)[spring-rabbit-1.0.0.RELEASE.jar:]

at 
org.springframework.amqp.rabbit.listener.AbstractMessageListenerContainer.executeListener(
AbstractMessageListenerContainer.java:452)[spring-rabbit-1.0.0.RELEASE.jar:]

at 
org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.doReceiveAndExecute(
SimpleMessageListenerContainer.java:436)[spring-rabbit-1.0.0.RELEASE.jar:]

at 
org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.receiveAndExecute(
SimpleMessageListenerContainer.java:420)[spring-rabbit-1.0.0.RELEASE.jar:]

at 
org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.access$200(
SimpleMessageListenerContainer.java:56)[spring-rabbit-1.0.0.RELEASE.jar:]

at 
org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer$AsyncMessageProcessingConsumer.run(
SimpleMessageListenerContainer.java:505)[spring-rabbit-1.0.0.RELEASE.jar:]

at java.lang.Thread.run(Thread.java:680)[:1.6.0_37]


What's wrong with that? What's the reason for which I must generate the 
Message ID?


thanks for your time, I really appreciate that.


Andrea
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130111/457257ed/attachment.htm>

From scott.brown at secondsupper.com  Fri Jan 11 14:32:53 2013
From: scott.brown at secondsupper.com (Scott Brown)
Date: Fri, 11 Jan 2013 06:32:53 -0800 (PST)
Subject: [rabbitmq-discuss] loss o messages on a cluster + durable
	queues + mirrored queues
In-Reply-To: <a8e3cf90-27c3-4ef0-86eb-2f48e141f445@googlegroups.com>
References: <713977d2-894a-4db1-bf9b-34560a73615f@googlegroups.com>
	<dddb908b-de4b-4523-b127-da71592622e7@googlegroups.com>
	<a8e3cf90-27c3-4ef0-86eb-2f48e141f445@googlegroups.com>
Message-ID: <fc12ecc2-ff3a-44b5-9f7d-280c920bca99@googlegroups.com>

In general your queues should not be "stopped" so this would not be a 
problem.  In practice there can be reasons this occurs.  I would look first 
at minimizing the amount of time a message spends in a queue.  If you have 
error queues that hold messages, don't use rabbit to store these.  Read 
them off and store them in a db.
If you absolutely feel you must be able to sync queues, the best I know of 
is to create a process that reads and requeues the message.  You are likely 
to lose message order if you have new messages coming in.

On Friday, January 11, 2013 5:51:38 AM UTC-5, Alexandre Bunn wrote:
>
> I've found in a forum (
> http://comments.gmane.org/gmane.comp.networking.rabbitmq.general/12438) a 
> user that have reported the same situation and an user have answered:
>
> "
>
> You can run "rabbitmqctl list_queues name slave_pids
> synchronised_slave_pids" to see if the cluster is synchronized or not
> but I can tell you right now that they will not be. In step 3 when you
> start vm1 back up and it is the slave. It is telling you that there
> are 10 messages in the vm2 queue. When you talk to a broker in a
> cluster it will talk to the master queue. VM1 will not be synchronized
> until all 10 messages are read out of the vm2 queue, because rabbitmq
> mirrored clusters do not read old messages that are already in the
> master queue. The slave reads the tail of the new message being sent
> to the master and expects that once it has been long enough then it
> will catch up to the same state as the master.
> http://www.rabbitmq.com/ha.html "Unsynchronised Slaves" I think does a
> good job of explaining it.
> "
>
>
> Does rabbitmq continues with this behavior? Is there any configuration 
> that I can do to solve this issue?
>
> Thanks
>
> Alexandre
>
> Em quinta-feira, 10 de janeiro de 2013 21h29min24s UTC-2, Scott Brown 
> escreveu:
>>
>> Alex, I believe what you are seeing is because mirrored queues do not 
>> automatically sync.
>>
>>    - When you restart node1 it has 0 messages and is not synced with 
>>    node2.  Since node1 was offline, the durable messages in it's queue are 
>>    considered out dated, since node2 is more likely to be up to date, and are 
>>    discarded.  Node1 is now a slave of node2, but the messages in node2 are 
>>    not copied to node1.
>>    - Then when you restart node2, node1 with 0 messages becomes the 
>>    master.
>>    
>> This can feel odd, because often you bounce one box and then the other 
>> for maintenance or similar.  You need to make sure that all messages in the 
>> queue when one node is bounced have been drained before bouncing the other 
>> node.  You can verify this in a few ways, but the easiest is to just peek 
>> at the Admin console and your queue will show -1 (or -n for n nodes) rather 
>> than +1.  This tells you that the mirrors are not synced.
>>
>>
>> On Wednesday, January 9, 2013 1:57:54 PM UTC-5, Alexandre Bunn wrote:
>>>
>>> Good afternoon
>>>
>>> I have a 2 nodes cluster with mirrored queues and I'm setting 
>>> delivery_mode = 2 when I'm publishing messages to the cluster. I'm missing 
>>> messages when I follow these steps below (for test issues).
>>>
>>> Step 0 - Node1 (master) Node2 (slave)
>>>
>>> # rabbitmqctl cluster_status
>>> Cluster status of node 'rabbit at vid-mq01-mia' ...
>>> [{nodes,[{disc,['rabbit at vid-mq01-mia','rabbit at vid-mq02-mia']}]},
>>>  {running_nodes,['rabbit at vid-mq02-mia','rabbit at vid-mq01-mia']},
>>>  {partitions,[]}]
>>> ...done.
>>>
>>> # rabbitmqctl list_policies
>>> Listing policies ...
>>> /       ha-all  ^ha\\.  {"ha-mode":"all"}       0
>>> ...done.
>>>
>>> ## rabbitmqctl list_queues name durable policy
>>> Listing queues ...
>>> ha.teste        true    ha-all
>>> ...done.
>>>
>>>
>>> - Step 1 - I write 2 messages, at ha.teste queue, 1 on each member of 
>>> the cluster and the messages are mirrored as expected. Here there are two 
>>> messages on each nodes (rabbitmqctl list_queues)
>>>
>>> -- node1
>>> # rabbitmqctl list_queues
>>> Listing queues ...
>>> ha.teste        2
>>> ...done.
>>> # rabbitmqctl list_queues name pid slave_pids synchronised_slave_pids
>>> Listing queues ...
>>> ha.teste        <'rabbit at vid-mq01-mia'.3.253.0> 
>>> [<'rabbit at vid-mq02-mia'.2.252.0>]       [<'rabbit at vid-mq02-mia'.2.252.0>]
>>> ...done.
>>>
>>> -- node2
>>> # rabbitmqctl list_queues
>>> Listing queues ...
>>> ha.teste        2
>>> ...done.
>>> # rabbitmqctl list_queues name pid slave_pids synchronised_slave_pids
>>> Listing queues ...
>>> ha.teste        <'rabbit at vid-mq01-mia'.3.253.0> 
>>> [<'rabbit at vid-mq02-mia'.2.252.0>]       [<'rabbit at vid-mq02-mia'.2.252.0>]
>>> ...done.
>>>
>>> - Step 2 - I've stopped rabbitmq-server on node1 and node2 assume the 
>>> master. Here there are the two messages on node2
>>>
>>> -- Logs on node2
>>> Mirrored-queue (queue 'ha.teste' in vhost '/'): Promoting slave 
>>> <'rabbit at vid-mq02-mia'.2.252.0> to master
>>>
>>> -- Status of the cluster on node2
>>>
>>> # rabbitmqctl cluster_status
>>> Cluster status of node 'rabbit at vid-mq02-mia' ...
>>> [{nodes,[{disc,['rabbit at vid-mq01-mia','rabbit at vid-mq02-mia']}]},
>>>  {running_nodes,['rabbit at vid-mq02-mia']},
>>>  {partitions,[]}]
>>> ...done.
>>>
>>> -- Status of the ha.teste queue on node2
>>>
>>> # rabbitmqctl list_queues
>>> Listing queues ...
>>> ha.teste        2
>>> ...done.
>>> # rabbitmqctl list_queues name pid slave_pids synchronised_slave_pids
>>> Listing queues ...
>>> ha.teste        <'rabbit at vid-mq02-mia'.2.252.0> []      []
>>> ...done.
>>>
>>> - Step 3 - I start the rabbitmq-server on node1, node2 still master and 
>>> node1 is running as slave. Here there are the two messages on node1 and 
>>> node2
>>>
>>> -- Log on node2
>>> =INFO REPORT==== 9-Jan-2013::18:40:46 ===
>>> rabbit on node 'rabbit at vid-mq01-mia' up
>>>
>>> -- Status of the cluster on node1
>>>
>>> # rabbitmqctl cluster_status
>>> Cluster status of node 'rabbit at vid-mq01-mia' ...
>>> [{nodes,[{disc,['rabbit at vid-mq01-mia','rabbit at vid-mq02-mia']}]},
>>>  {running_nodes,['rabbit at vid-mq02-mia','rabbit at vid-mq01-mia']},
>>>  {partitions,[]}]
>>> ...done.
>>>
>>> -- Status of the ha.teste queue on node2
>>> # rabbitmqctl list_queues
>>> Listing queues ...
>>> ha.teste        2
>>> ...done.
>>>
>>> # rabbitmqctl list_queues name pid slave_pids synchronised_slave_pids
>>> Listing queues ...
>>> ha.teste        <'rabbit at vid-mq02-mia'.2.252.0> 
>>> [<'rabbit at vid-mq01-mia'.1.253.0>]       []
>>> ...done.
>>>
>>> - Step 4 - I've stopped rabbitmq-server on node2 and node1 assume the 
>>> master but the messages disapeared
>>>
>>> -- Logs on node1
>>>
>>> =INFO REPORT==== 9-Jan-2013::18:43:42 ===
>>> Mirrored-queue (queue 'ha.teste' in vhost '/'): Promoting slave 
>>> <'rabbit at vid-mq01-mia'.1.253.0> to master
>>>
>>> =INFO REPORT==== 9-Jan-2013::18:43:42 ===
>>> rabbit on node 'rabbit at vid-mq02-mia' down
>>>
>>> -- Cluster status on node1
>>>
>>> # rabbitmqctl cluster_status
>>> Cluster status of node 'rabbit at vid-mq01-mia' ...
>>> [{nodes,[{disc,['rabbit at vid-mq01-mia','rabbit at vid-mq02-mia']}]},
>>>  {running_nodes,['rabbit at vid-mq01-mia']},
>>>  {partitions,[]}]
>>> ...done.
>>>
>>> -- Status of the ha.teste queue on node1
>>>
>>> # rabbitmqctl list_queues
>>> Listing queues ...
>>> ha.teste        0
>>> ...done.
>>>
>>> # rabbitmqctl list_queues name pid slave_pids synchronised_slave_pids
>>> Listing queues ...
>>> ha.teste        <'rabbit at vid-mq01-mia'.1.253.0> []      []
>>> ...done.
>>>
>>> Is it expected? What we have to do at server side or client side (python 
>>> script) to make the messages really durable? All the servers are running 
>>> centos6 x86_64 and rabbitmq 3.0.1-1.
>>>
>>> Thanks
>>>
>>> Alexandre Bunn
>>>
>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130111/ebcc4cfc/attachment.htm>

From scott.brown at secondsupper.com  Fri Jan 11 14:32:53 2013
From: scott.brown at secondsupper.com (Scott Brown)
Date: Fri, 11 Jan 2013 06:32:53 -0800 (PST)
Subject: [rabbitmq-discuss] loss o messages on a cluster + durable
	queues + mirrored queues
In-Reply-To: <a8e3cf90-27c3-4ef0-86eb-2f48e141f445@googlegroups.com>
References: <713977d2-894a-4db1-bf9b-34560a73615f@googlegroups.com>
	<dddb908b-de4b-4523-b127-da71592622e7@googlegroups.com>
	<a8e3cf90-27c3-4ef0-86eb-2f48e141f445@googlegroups.com>
Message-ID: <fc12ecc2-ff3a-44b5-9f7d-280c920bca99@googlegroups.com>

In general your queues should not be "stopped" so this would not be a 
problem.  In practice there can be reasons this occurs.  I would look first 
at minimizing the amount of time a message spends in a queue.  If you have 
error queues that hold messages, don't use rabbit to store these.  Read 
them off and store them in a db.
If you absolutely feel you must be able to sync queues, the best I know of 
is to create a process that reads and requeues the message.  You are likely 
to lose message order if you have new messages coming in.

On Friday, January 11, 2013 5:51:38 AM UTC-5, Alexandre Bunn wrote:
>
> I've found in a forum (
> http://comments.gmane.org/gmane.comp.networking.rabbitmq.general/12438) a 
> user that have reported the same situation and an user have answered:
>
> "
>
> You can run "rabbitmqctl list_queues name slave_pids
> synchronised_slave_pids" to see if the cluster is synchronized or not
> but I can tell you right now that they will not be. In step 3 when you
> start vm1 back up and it is the slave. It is telling you that there
> are 10 messages in the vm2 queue. When you talk to a broker in a
> cluster it will talk to the master queue. VM1 will not be synchronized
> until all 10 messages are read out of the vm2 queue, because rabbitmq
> mirrored clusters do not read old messages that are already in the
> master queue. The slave reads the tail of the new message being sent
> to the master and expects that once it has been long enough then it
> will catch up to the same state as the master.
> http://www.rabbitmq.com/ha.html "Unsynchronised Slaves" I think does a
> good job of explaining it.
> "
>
>
> Does rabbitmq continues with this behavior? Is there any configuration 
> that I can do to solve this issue?
>
> Thanks
>
> Alexandre
>
> Em quinta-feira, 10 de janeiro de 2013 21h29min24s UTC-2, Scott Brown 
> escreveu:
>>
>> Alex, I believe what you are seeing is because mirrored queues do not 
>> automatically sync.
>>
>>    - When you restart node1 it has 0 messages and is not synced with 
>>    node2.  Since node1 was offline, the durable messages in it's queue are 
>>    considered out dated, since node2 is more likely to be up to date, and are 
>>    discarded.  Node1 is now a slave of node2, but the messages in node2 are 
>>    not copied to node1.
>>    - Then when you restart node2, node1 with 0 messages becomes the 
>>    master.
>>    
>> This can feel odd, because often you bounce one box and then the other 
>> for maintenance or similar.  You need to make sure that all messages in the 
>> queue when one node is bounced have been drained before bouncing the other 
>> node.  You can verify this in a few ways, but the easiest is to just peek 
>> at the Admin console and your queue will show -1 (or -n for n nodes) rather 
>> than +1.  This tells you that the mirrors are not synced.
>>
>>
>> On Wednesday, January 9, 2013 1:57:54 PM UTC-5, Alexandre Bunn wrote:
>>>
>>> Good afternoon
>>>
>>> I have a 2 nodes cluster with mirrored queues and I'm setting 
>>> delivery_mode = 2 when I'm publishing messages to the cluster. I'm missing 
>>> messages when I follow these steps below (for test issues).
>>>
>>> Step 0 - Node1 (master) Node2 (slave)
>>>
>>> # rabbitmqctl cluster_status
>>> Cluster status of node 'rabbit at vid-mq01-mia' ...
>>> [{nodes,[{disc,['rabbit at vid-mq01-mia','rabbit at vid-mq02-mia']}]},
>>>  {running_nodes,['rabbit at vid-mq02-mia','rabbit at vid-mq01-mia']},
>>>  {partitions,[]}]
>>> ...done.
>>>
>>> # rabbitmqctl list_policies
>>> Listing policies ...
>>> /       ha-all  ^ha\\.  {"ha-mode":"all"}       0
>>> ...done.
>>>
>>> ## rabbitmqctl list_queues name durable policy
>>> Listing queues ...
>>> ha.teste        true    ha-all
>>> ...done.
>>>
>>>
>>> - Step 1 - I write 2 messages, at ha.teste queue, 1 on each member of 
>>> the cluster and the messages are mirrored as expected. Here there are two 
>>> messages on each nodes (rabbitmqctl list_queues)
>>>
>>> -- node1
>>> # rabbitmqctl list_queues
>>> Listing queues ...
>>> ha.teste        2
>>> ...done.
>>> # rabbitmqctl list_queues name pid slave_pids synchronised_slave_pids
>>> Listing queues ...
>>> ha.teste        <'rabbit at vid-mq01-mia'.3.253.0> 
>>> [<'rabbit at vid-mq02-mia'.2.252.0>]       [<'rabbit at vid-mq02-mia'.2.252.0>]
>>> ...done.
>>>
>>> -- node2
>>> # rabbitmqctl list_queues
>>> Listing queues ...
>>> ha.teste        2
>>> ...done.
>>> # rabbitmqctl list_queues name pid slave_pids synchronised_slave_pids
>>> Listing queues ...
>>> ha.teste        <'rabbit at vid-mq01-mia'.3.253.0> 
>>> [<'rabbit at vid-mq02-mia'.2.252.0>]       [<'rabbit at vid-mq02-mia'.2.252.0>]
>>> ...done.
>>>
>>> - Step 2 - I've stopped rabbitmq-server on node1 and node2 assume the 
>>> master. Here there are the two messages on node2
>>>
>>> -- Logs on node2
>>> Mirrored-queue (queue 'ha.teste' in vhost '/'): Promoting slave 
>>> <'rabbit at vid-mq02-mia'.2.252.0> to master
>>>
>>> -- Status of the cluster on node2
>>>
>>> # rabbitmqctl cluster_status
>>> Cluster status of node 'rabbit at vid-mq02-mia' ...
>>> [{nodes,[{disc,['rabbit at vid-mq01-mia','rabbit at vid-mq02-mia']}]},
>>>  {running_nodes,['rabbit at vid-mq02-mia']},
>>>  {partitions,[]}]
>>> ...done.
>>>
>>> -- Status of the ha.teste queue on node2
>>>
>>> # rabbitmqctl list_queues
>>> Listing queues ...
>>> ha.teste        2
>>> ...done.
>>> # rabbitmqctl list_queues name pid slave_pids synchronised_slave_pids
>>> Listing queues ...
>>> ha.teste        <'rabbit at vid-mq02-mia'.2.252.0> []      []
>>> ...done.
>>>
>>> - Step 3 - I start the rabbitmq-server on node1, node2 still master and 
>>> node1 is running as slave. Here there are the two messages on node1 and 
>>> node2
>>>
>>> -- Log on node2
>>> =INFO REPORT==== 9-Jan-2013::18:40:46 ===
>>> rabbit on node 'rabbit at vid-mq01-mia' up
>>>
>>> -- Status of the cluster on node1
>>>
>>> # rabbitmqctl cluster_status
>>> Cluster status of node 'rabbit at vid-mq01-mia' ...
>>> [{nodes,[{disc,['rabbit at vid-mq01-mia','rabbit at vid-mq02-mia']}]},
>>>  {running_nodes,['rabbit at vid-mq02-mia','rabbit at vid-mq01-mia']},
>>>  {partitions,[]}]
>>> ...done.
>>>
>>> -- Status of the ha.teste queue on node2
>>> # rabbitmqctl list_queues
>>> Listing queues ...
>>> ha.teste        2
>>> ...done.
>>>
>>> # rabbitmqctl list_queues name pid slave_pids synchronised_slave_pids
>>> Listing queues ...
>>> ha.teste        <'rabbit at vid-mq02-mia'.2.252.0> 
>>> [<'rabbit at vid-mq01-mia'.1.253.0>]       []
>>> ...done.
>>>
>>> - Step 4 - I've stopped rabbitmq-server on node2 and node1 assume the 
>>> master but the messages disapeared
>>>
>>> -- Logs on node1
>>>
>>> =INFO REPORT==== 9-Jan-2013::18:43:42 ===
>>> Mirrored-queue (queue 'ha.teste' in vhost '/'): Promoting slave 
>>> <'rabbit at vid-mq01-mia'.1.253.0> to master
>>>
>>> =INFO REPORT==== 9-Jan-2013::18:43:42 ===
>>> rabbit on node 'rabbit at vid-mq02-mia' down
>>>
>>> -- Cluster status on node1
>>>
>>> # rabbitmqctl cluster_status
>>> Cluster status of node 'rabbit at vid-mq01-mia' ...
>>> [{nodes,[{disc,['rabbit at vid-mq01-mia','rabbit at vid-mq02-mia']}]},
>>>  {running_nodes,['rabbit at vid-mq01-mia']},
>>>  {partitions,[]}]
>>> ...done.
>>>
>>> -- Status of the ha.teste queue on node1
>>>
>>> # rabbitmqctl list_queues
>>> Listing queues ...
>>> ha.teste        0
>>> ...done.
>>>
>>> # rabbitmqctl list_queues name pid slave_pids synchronised_slave_pids
>>> Listing queues ...
>>> ha.teste        <'rabbit at vid-mq01-mia'.1.253.0> []      []
>>> ...done.
>>>
>>> Is it expected? What we have to do at server side or client side (python 
>>> script) to make the messages really durable? All the servers are running 
>>> centos6 x86_64 and rabbitmq 3.0.1-1.
>>>
>>> Thanks
>>>
>>> Alexandre Bunn
>>>
>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130111/ebcc4cfc/attachment-0001.htm>

From chris.d at frugalit.co.uk  Fri Jan 11 14:56:08 2013
From: chris.d at frugalit.co.uk (Chris Duncan)
Date: Fri, 11 Jan 2013 14:56:08 +0000
Subject: [rabbitmq-discuss] Publisher confirms and lost messages
Message-ID: <50F02808.2090300@frugalit.co.uk>

Hi,

I'm continuing with testing of publisher confirms and have come across a 
repeatable test scenario that ends in some messages being lost and I'm 
not sure why.

My setup is Ubuntu 12.04 LTS 32-bit, Erlang R14B04, RabbitMQ 3.0.1, 
Bunny 0.9.5.pre AMQP clien and Ruby 1.9.3.

I have a Ruby publisher script that simply publishes 100 messages via a 
channel that is in confirmation mode. It does not close the AMQP 
connection and channels before it finishes. Every time that the 
Wireshark trace shows a final TCP frame that contains a large number of 
AMQP basic.publish framesets then a variable number of messages do not 
arrive on the queue.

However, I never lose any messages when I include a close method at the 
end of the script. I've run this test many times now and the results are 
always the same.

It doesn't look as though Bunny is doing anything peculiar. The messages 
do seem to be getting sent to the broker correctly.

I have attached my publisher code and Wireshark output should anyone 
want to take a look.

As usual I would be grateful for any ideas.

Regards,

Chris


-------------- next part --------------
A non-text attachment was scrubbed...
Name: hello_world_publisher_confirms.rb
Type: application/x-ruby
Size: 341 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130111/a97cfef5/attachment.rb>
-------------- next part --------------
Frame 16: 401 bytes on wire (3208 bits), 401 bytes captured (3208 bits)
Ethernet II, Src: 00:00:00_00:00:00 (00:00:00:00:00:00), Dst: 00:00:00_00:00:00 (00:00:00:00:00:00)
Internet Protocol Version 4, Src: 127.0.0.1 (127.0.0.1), Dst: 127.0.0.1 (127.0.0.1)
Transmission Control Protocol, Src Port: amqp (5672), Dst Port: 50683 (50683), Seq: 1, Ack: 9, Len: 335
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 0
    Length: 327
    Class: Connection (10)
    Method: Start (10)
    Arguments
        Version-Major: 0
        Version-Minor: 9
        Server-Properties
            capabilities (field table): ...
            copyright (string): Copyright (C) 2007-2012 VMware, Inc.
            information (string): Licensed under the MPL.  See http://www.rabbitmq.com/
            platform (string): Erlang/OTP
            product (string): RabbitMQ
            version (string): 3.0.1
        Mechanisms: 504c41494e20414d51504c41494e
        Locales: 656e5f5553

Frame 18: 376 bytes on wire (3008 bits), 376 bytes captured (3008 bits)
Ethernet II, Src: 00:00:00_00:00:00 (00:00:00:00:00:00), Dst: 00:00:00_00:00:00 (00:00:00:00:00:00)
Internet Protocol Version 4, Src: 127.0.0.1 (127.0.0.1), Dst: 127.0.0.1 (127.0.0.1)
Transmission Control Protocol, Src Port: 50683 (50683), Dst Port: amqp (5672), Seq: 9, Ack: 336, Len: 310
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 0
    Length: 302
    Class: Connection (10)
    Method: Start-Ok (11)
    Arguments
        Client-Properties
            capabilities (field table): ...
            product (string): Bunny
            platform (string): ruby 1.9.3p362 (2012-12-25 revision 38607) [i686-linux]
            version (string): 0.9.0.pre5
            information (string): http://github.com/ruby-amqp/bunny
        Mechanism: PLAIN
        Response: 006775657374006775657374
        Locale: en_GB

Frame 19: 86 bytes on wire (688 bits), 86 bytes captured (688 bits)
Ethernet II, Src: 00:00:00_00:00:00 (00:00:00:00:00:00), Dst: 00:00:00_00:00:00 (00:00:00:00:00:00)
Internet Protocol Version 4, Src: 127.0.0.1 (127.0.0.1), Dst: 127.0.0.1 (127.0.0.1)
Transmission Control Protocol, Src Port: amqp (5672), Dst Port: 50683 (50683), Seq: 336, Ack: 319, Len: 20
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 0
    Length: 12
    Class: Connection (10)
    Method: Tune (30)
    Arguments
        Channel-Max: 0
        Frame-Max: 131072
        Heartbeat: 600

Frame 20: 86 bytes on wire (688 bits), 86 bytes captured (688 bits)
Ethernet II, Src: 00:00:00_00:00:00 (00:00:00:00:00:00), Dst: 00:00:00_00:00:00 (00:00:00:00:00:00)
Internet Protocol Version 4, Src: 127.0.0.1 (127.0.0.1), Dst: 127.0.0.1 (127.0.0.1)
Transmission Control Protocol, Src Port: 50683 (50683), Dst Port: amqp (5672), Seq: 319, Ack: 356, Len: 20
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 0
    Length: 12
    Class: Connection (10)
    Method: Tune-Ok (31)
    Arguments
        Channel-Max: 0
        Frame-Max: 131072
        Heartbeat: 600

Frame 22: 82 bytes on wire (656 bits), 82 bytes captured (656 bits)
Ethernet II, Src: 00:00:00_00:00:00 (00:00:00:00:00:00), Dst: 00:00:00_00:00:00 (00:00:00:00:00:00)
Internet Protocol Version 4, Src: 127.0.0.1 (127.0.0.1), Dst: 127.0.0.1 (127.0.0.1)
Transmission Control Protocol, Src Port: 50683 (50683), Dst Port: amqp (5672), Seq: 339, Ack: 356, Len: 16
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 0
    Length: 8
    Class: Connection (10)
    Method: Open (40)
    Arguments
        Virtual-Host: /
        Capabilities: 
        .... ...0 = Insist: False

Frame 24: 79 bytes on wire (632 bits), 79 bytes captured (632 bits)
Ethernet II, Src: 00:00:00_00:00:00 (00:00:00:00:00:00), Dst: 00:00:00_00:00:00 (00:00:00:00:00:00)
Internet Protocol Version 4, Src: 127.0.0.1 (127.0.0.1), Dst: 127.0.0.1 (127.0.0.1)
Transmission Control Protocol, Src Port: amqp (5672), Dst Port: 50683 (50683), Seq: 356, Ack: 355, Len: 13
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 0
    Length: 5
    Class: Connection (10)
    Method: Open-Ok (41)
    Arguments
        Known-Hosts: 

Frame 25: 79 bytes on wire (632 bits), 79 bytes captured (632 bits)
Ethernet II, Src: 00:00:00_00:00:00 (00:00:00:00:00:00), Dst: 00:00:00_00:00:00 (00:00:00:00:00:00)
Internet Protocol Version 4, Src: 127.0.0.1 (127.0.0.1), Dst: 127.0.0.1 (127.0.0.1)
Transmission Control Protocol, Src Port: 50683 (50683), Dst Port: amqp (5672), Seq: 355, Ack: 369, Len: 13
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 1
    Length: 5
    Class: Channel (20)
    Method: Open (10)
    Arguments
        Out-Of-Band: 

Frame 26: 82 bytes on wire (656 bits), 82 bytes captured (656 bits)
Ethernet II, Src: 00:00:00_00:00:00 (00:00:00:00:00:00), Dst: 00:00:00_00:00:00 (00:00:00:00:00:00)
Internet Protocol Version 4, Src: 127.0.0.1 (127.0.0.1), Dst: 127.0.0.1 (127.0.0.1)
Transmission Control Protocol, Src Port: amqp (5672), Dst Port: 50683 (50683), Seq: 369, Ack: 368, Len: 16
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 1
    Length: 8
    Class: Channel (20)
    Method: Open-Ok (11)
    Arguments
        Channel-Id: <MISSING>

Frame 27: 79 bytes on wire (632 bits), 79 bytes captured (632 bits)
Ethernet II, Src: 00:00:00_00:00:00 (00:00:00:00:00:00), Dst: 00:00:00_00:00:00 (00:00:00:00:00:00)
Internet Protocol Version 4, Src: 127.0.0.1 (127.0.0.1), Dst: 127.0.0.1 (127.0.0.1)
Transmission Control Protocol, Src Port: 50683 (50683), Dst Port: amqp (5672), Seq: 368, Ack: 385, Len: 13
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 5
    Class: Channel (20)
    Method: Open (10)
    Arguments
        Out-Of-Band: 

Frame 28: 82 bytes on wire (656 bits), 82 bytes captured (656 bits)
Ethernet II, Src: 00:00:00_00:00:00 (00:00:00:00:00:00), Dst: 00:00:00_00:00:00 (00:00:00:00:00:00)
Internet Protocol Version 4, Src: 127.0.0.1 (127.0.0.1), Dst: 127.0.0.1 (127.0.0.1)
Transmission Control Protocol, Src Port: amqp (5672), Dst Port: 50683 (50683), Seq: 385, Ack: 381, Len: 16
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 8
    Class: Channel (20)
    Method: Open-Ok (11)
    Arguments
        Channel-Id: <MISSING>

Frame 29: 107 bytes on wire (856 bits), 107 bytes captured (856 bits)
Ethernet II, Src: 00:00:00_00:00:00 (00:00:00:00:00:00), Dst: 00:00:00_00:00:00 (00:00:00:00:00:00)
Internet Protocol Version 4, Src: 127.0.0.1 (127.0.0.1), Dst: 127.0.0.1 (127.0.0.1)
Transmission Control Protocol, Src Port: 50683 (50683), Dst Port: amqp (5672), Seq: 381, Ack: 401, Len: 41
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 33
    Class: Exchange (40)
    Method: Declare (10)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Type: direct
        .... ...0 = Passive: False
        .... ..1. = Durable: True
        .... .0.. = Auto-Delete: False
        .... 0... = Internal: False
        ...0 .... = Nowait: False
        Arguments

Frame 30: 78 bytes on wire (624 bits), 78 bytes captured (624 bits)
Ethernet II, Src: 00:00:00_00:00:00 (00:00:00:00:00:00), Dst: 00:00:00_00:00:00 (00:00:00:00:00:00)
Internet Protocol Version 4, Src: 127.0.0.1 (127.0.0.1), Dst: 127.0.0.1 (127.0.0.1)
Transmission Control Protocol, Src Port: amqp (5672), Dst Port: 50683 (50683), Seq: 401, Ack: 422, Len: 12
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 4
    Class: Exchange (40)
    Method: Declare-Ok (11)
    Arguments

Frame 31: 97 bytes on wire (776 bits), 97 bytes captured (776 bits)
Ethernet II, Src: 00:00:00_00:00:00 (00:00:00:00:00:00), Dst: 00:00:00_00:00:00 (00:00:00:00:00:00)
Internet Protocol Version 4, Src: 127.0.0.1 (127.0.0.1), Dst: 127.0.0.1 (127.0.0.1)
Transmission Control Protocol, Src Port: 50683 (50683), Dst Port: amqp (5672), Seq: 422, Ack: 413, Len: 31
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 23
    Class: Queue (50)
    Method: Declare (10)
    Arguments
        Ticket: 0
        Queue: hello-queue
        .... ...0 = Passive: False
        .... ..1. = Durable: True
        .... .0.. = Exclusive: False
        .... 0... = Auto-Delete: False
        ...0 .... = Nowait: False
        Arguments

Frame 32: 98 bytes on wire (784 bits), 98 bytes captured (784 bits)
Ethernet II, Src: 00:00:00_00:00:00 (00:00:00:00:00:00), Dst: 00:00:00_00:00:00 (00:00:00:00:00:00)
Internet Protocol Version 4, Src: 127.0.0.1 (127.0.0.1), Dst: 127.0.0.1 (127.0.0.1)
Transmission Control Protocol, Src Port: amqp (5672), Dst Port: 50683 (50683), Seq: 413, Ack: 453, Len: 32
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 24
    Class: Queue (50)
    Method: Declare-Ok (11)
    Arguments
        Queue: hello-queue
        Message-Count: 0
        Consumer-Count: 0

Frame 33: 79 bytes on wire (632 bits), 79 bytes captured (632 bits)
Ethernet II, Src: 00:00:00_00:00:00 (00:00:00:00:00:00), Dst: 00:00:00_00:00:00 (00:00:00:00:00:00)
Internet Protocol Version 4, Src: 127.0.0.1 (127.0.0.1), Dst: 127.0.0.1 (127.0.0.1)
Transmission Control Protocol, Src Port: 50683 (50683), Dst Port: amqp (5672), Seq: 453, Ack: 445, Len: 13
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 5
    Class: Unknown (85)
    [Expert Info (Error/Protocol): Unknown method class 85]
        [Message: Unknown method class 85]
        [Severity level: Error]
        [Group: Protocol]

Frame 34: 78 bytes on wire (624 bits), 78 bytes captured (624 bits)
Ethernet II, Src: 00:00:00_00:00:00 (00:00:00:00:00:00), Dst: 00:00:00_00:00:00 (00:00:00:00:00:00)
Internet Protocol Version 4, Src: 127.0.0.1 (127.0.0.1), Dst: 127.0.0.1 (127.0.0.1)
Transmission Control Protocol, Src Port: amqp (5672), Dst Port: 50683 (50683), Seq: 445, Ack: 466, Len: 12
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 4
    Class: Unknown (85)
    [Expert Info (Error/Protocol): Unknown method class 85]
        [Message: Unknown method class 85]
        [Severity level: Error]
        [Group: Protocol]

Frame 35: 101 bytes on wire (808 bits), 101 bytes captured (808 bits)
Ethernet II, Src: 00:00:00_00:00:00 (00:00:00:00:00:00), Dst: 00:00:00_00:00:00 (00:00:00:00:00:00)
Internet Protocol Version 4, Src: 127.0.0.1 (127.0.0.1), Dst: 127.0.0.1 (127.0.0.1)
Transmission Control Protocol, Src Port: 50683 (50683), Dst Port: amqp (5672), Seq: 466, Ack: 457, Len: 35
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False

Frame 37: 10821 bytes on wire (86568 bits), 10821 bytes captured (86568 bits)
Ethernet II, Src: 00:00:00_00:00:00 (00:00:00:00:00:00), Dst: 00:00:00_00:00:00 (00:00:00:00:00:00)
Internet Protocol Version 4, Src: 127.0.0.1 (127.0.0.1), Dst: 127.0.0.1 (127.0.0.1)
Transmission Control Protocol, Src Port: 50683 (50683), Dst Port: amqp (5672), Seq: 501, Ack: 457, Len: 10755
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 15
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 15
    Payload: 303a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 15
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 15
    Payload: 313a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 15
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 15
    Payload: 323a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 15
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 15
    Payload: 333a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 15
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 15
    Payload: 343a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 15
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 15
    Payload: 353a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 15
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 15
    Payload: 363a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 15
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 15
    Payload: 373a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 15
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 15
    Payload: 383a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 15
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 15
    Payload: 393a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 31303a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 31313a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 31323a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 31333a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 31343a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 31353a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 31363a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 31373a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 31383a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 31393a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 32303a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 32313a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 32323a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 32333a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 32343a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 32353a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 32363a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 32373a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 32383a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 32393a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 33303a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 33313a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 33323a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 33333a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 33343a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 33353a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 33363a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 33373a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 33383a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 33393a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 34303a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 34313a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 34323a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 34333a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 34343a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 34353a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 34363a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 34373a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 34383a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 34393a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 35303a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 35313a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 35323a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 35333a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 35343a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 35353a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 35363a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 35373a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 35383a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 35393a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 36303a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 36313a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 36323a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 36333a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 36343a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 36353a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 36363a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 36373a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 36383a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 36393a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 37303a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 37313a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 37323a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 37333a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 37343a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 37353a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 37363a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 37373a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 37383a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 37393a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 38303a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 38313a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 38323a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 38333a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 38343a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 38353a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 38363a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 38373a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 38383a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 38393a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 39303a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 39313a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 39323a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 39333a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 39343a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 39353a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 39363a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 39373a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 39383a2054657374206d657373616765
Advanced Message Queueing Protocol
    Type: Method (1)
    Channel: 2
    Length: 27
    Class: Basic (60)
    Method: Publish (40)
    Arguments
        Ticket: 0
        Exchange: hello-exchange
        Routing-Key: hola
        .... ...0 = Mandatory: False
        .... ..0. = Immediate: False
Advanced Message Queueing Protocol
    Type: Content header (2)
    Channel: 2
    Length: 41
    Class ID: Basic (60)
    Weight: 0
    Body size: 16
    Property flags: 0x9800
    Properties
        Content-Type: application/octet-stream
        Delivery-Mode: 2
        Priority: 0
Advanced Message Queueing Protocol
    Type: Content body (3)
    Channel: 2
    Length: 16
    Payload: 39393a2054657374206d657373616765


From 0x6e6562 at gmail.com  Fri Jan 11 14:59:39 2013
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Fri, 11 Jan 2013 14:59:39 +0000
Subject: [rabbitmq-discuss] two factor authentication with tokens
In-Reply-To: <CAE0Sz=xJzJp5C76SWMXXY7-1mjG4_3+zP2aC3wtvTy2vfs7rdg@mail.gmail.com>
References: <e3be344f-3c2f-4866-8157-38f736ee63c6@googlegroups.com>
	<CAE0Sz=xJzJp5C76SWMXXY7-1mjG4_3+zP2aC3wtvTy2vfs7rdg@mail.gmail.com>
Message-ID: <BE2DB2BAD46C49BDB96B62901C13D607@gmail.com>

Hi all,

In order to implement this, would this be a case of:

Configure a client side SASLMechanism that supplies a token;
Configure the server to accept this mechanism;
Implement a rabbit_auth_mechanism behavior that defers the processing of the token to some upstream provider;

?

Cheers,

Ben  

On Thursday, 10 January 2013 at 00:36, Jerry Kuch wrote:

> Hi, Thomas:
> 
> Not out of the box... although the Rabbit authentication and authorization mechanisms are pluggable and can be replaced if one is willing to write a bit of Erlang.
> 
> To that end, how does one implement the server end of RSA-token based two factor authentication?  Is there an SDK or APIs that one must gain access to? 
> 
> Also, two factor auth seems most useful when there's a human involved in the log-on process, something which for a messaging broker may often not really be true.  Can you say more about the nature of your desire for RSA two factor with Rabbit? 
> 
> Best regards,
> Jerry
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130111/88420bc4/attachment.htm>

From simon at rabbitmq.com  Fri Jan 11 15:01:59 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 11 Jan 2013 15:01:59 +0000
Subject: [rabbitmq-discuss] two factor authentication with tokens
In-Reply-To: <BE2DB2BAD46C49BDB96B62901C13D607@gmail.com>
References: <e3be344f-3c2f-4866-8157-38f736ee63c6@googlegroups.com>
	<CAE0Sz=xJzJp5C76SWMXXY7-1mjG4_3+zP2aC3wtvTy2vfs7rdg@mail.gmail.com>
	<BE2DB2BAD46C49BDB96B62901C13D607@gmail.com>
Message-ID: <50F02967.6080208@rabbitmq.com>

Yes, that's how it's intended to work.

Cheers, Simon

On 11/01/13 14:59, Ben Hood wrote:
> Hi all,
>
> In order to implement this, would this be a case of:
>
>   * Configure a client side SASLMechanism that supplies a token;
>   * Configure the server to accept this mechanism;
>   * Implement a rabbit_auth_mechanism behavior that defers the
>     processing of the token to some upstream provider;
>
> ?
>
> Cheers,
>
> Ben
>
> On Thursday, 10 January 2013 at 00:36, Jerry Kuch wrote:
>
>> Hi, Thomas:
>>
>> Not out of the box... although the Rabbit authentication and
>> authorization mechanisms are pluggable and can be replaced if one is
>> willing to write a bit of Erlang.
>>
>> To that end, how does one implement the server end of RSA-token based
>> two factor authentication?  Is there an SDK or APIs that one must gain
>> access to?
>>
>> Also, two factor auth seems most useful when there's a human involved
>> in the log-on process, something which for a messaging broker may
>> often not really be true.  Can you say more about the nature of your
>> desire for RSA two factor with Rabbit?
>>
>> Best regards,
>> Jerry
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From prabodh.upreti at vce.com  Fri Jan 11 16:36:16 2013
From: prabodh.upreti at vce.com (Prabodh Upreti)
Date: Fri, 11 Jan 2013 08:36:16 -0800 (PST)
Subject: [rabbitmq-discuss] log rotate
Message-ID: <1357922176509-24408.post@n5.nabble.com>

Hello

I am sure this has been asked before. What is the best way to manage
rabbitmq log rotation: linux logrotate 
or rabbitmqctl rotate_logs .  I need to rotate log files every day and then
zip it end of month. thx.




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/log-rotate-tp24408.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From matthias at rabbitmq.com  Fri Jan 11 17:19:27 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 11 Jan 2013 17:19:27 +0000
Subject: [rabbitmq-discuss] RabbitMQ and Camel : route interrupted due
 to "Message dropped on recovery"
In-Reply-To: <11126d73-8df0-40f4-9c4e-d627b8c05028@googlegroups.com>
References: <11126d73-8df0-40f4-9c4e-d627b8c05028@googlegroups.com>
Message-ID: <50F0499F.6060005@rabbitmq.com>

Andrea,

On 11/01/13 13:34, Andrea Girardi wrote:
> I'm having a frustrating issue with RabbitMQ and sprimg-amqp, maybe
> someone could help me.

You may want to ask on 
http://forum.springsource.org/forumdisplay.php?74-AMQP

Regards,

Matthias.

From 0x6e6562 at gmail.com  Fri Jan 11 17:47:03 2013
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Fri, 11 Jan 2013 17:47:03 +0000
Subject: [rabbitmq-discuss] two factor authentication with tokens
In-Reply-To: <50F02967.6080208@rabbitmq.com>
References: <e3be344f-3c2f-4866-8157-38f736ee63c6@googlegroups.com>
	<CAE0Sz=xJzJp5C76SWMXXY7-1mjG4_3+zP2aC3wtvTy2vfs7rdg@mail.gmail.com>
	<BE2DB2BAD46C49BDB96B62901C13D607@gmail.com>
	<50F02967.6080208@rabbitmq.com>
Message-ID: <A72183C2BA7B40AD9FA3E607B3D765AC@gmail.com>

Cool.

Can this also be made to work in conjunction with an LDAP provider, i.e. by chaining the supported LDAP backend with a custom backend to additionally validate the the token? I wondering whether you can require the client to answer both a username/password challenge (evaluated by the supported LDAP auth backend) as well as having the token checked by the the custom backend? Does the protocol and wiring flow allow for the LDAP backend to get re-used in this way or would you need to implement the custom backend that wraps the lookup against the LDAP directory and the lookup against the Radius server?


On Friday, 11 January 2013 at 15:01, Simon MacMullen wrote:

> Yes, that's how it's intended to work.
> 
> Cheers, Simon
> 
> On 11/01/13 14:59, Ben Hood wrote:
> > Hi all,
> > 
> > In order to implement this, would this be a case of:
> > 
> > * Configure a client side SASLMechanism that supplies a token;
> > * Configure the server to accept this mechanism;
> > * Implement a rabbit_auth_mechanism behavior that defers the
> > processing of the token to some upstream provider;
> > 
> > ?
> > 
> > Cheers,
> > 
> > Ben
> > 
> > On Thursday, 10 January 2013 at 00:36, Jerry Kuch wrote:
> > 
> > > Hi, Thomas:
> > > 
> > > Not out of the box... although the Rabbit authentication and
> > > authorization mechanisms are pluggable and can be replaced if one is
> > > willing to write a bit of Erlang.
> > > 
> > > To that end, how does one implement the server end of RSA-token based
> > > two factor authentication? Is there an SDK or APIs that one must gain
> > > access to?
> > > 
> > > Also, two factor auth seems most useful when there's a human involved
> > > in the log-on process, something which for a messaging broker may
> > > often not really be true. Can you say more about the nature of your
> > > desire for RSA two factor with Rabbit?
> > > 
> > > Best regards,
> > > Jerry
> > > 
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> > > <mailto:rabbitmq-discuss at lists.rabbitmq.com>
> > > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > > 
> > 
> > 
> > 
> > 
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > 
> 
> 
> 
> -- 
> Simon MacMullen
> RabbitMQ, VMware
> 
> 


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130111/4c6bee24/attachment.htm>

From jerryk at rbcon.com  Fri Jan 11 18:02:50 2013
From: jerryk at rbcon.com (Jerry Kuch)
Date: Fri, 11 Jan 2013 10:02:50 -0800
Subject: [rabbitmq-discuss] two factor authentication with tokens
In-Reply-To: <A72183C2BA7B40AD9FA3E607B3D765AC@gmail.com>
References: <e3be344f-3c2f-4866-8157-38f736ee63c6@googlegroups.com>
	<CAE0Sz=xJzJp5C76SWMXXY7-1mjG4_3+zP2aC3wtvTy2vfs7rdg@mail.gmail.com>
	<BE2DB2BAD46C49BDB96B62901C13D607@gmail.com>
	<50F02967.6080208@rabbitmq.com>
	<A72183C2BA7B40AD9FA3E607B3D765AC@gmail.com>
Message-ID: <CAE0Sz=ztd-xTR-eyzxFFgfxYXoCoT+UjH2hGgMZZW8Bko=c2+w@mail.gmail.com>

On Fri, Jan 11, 2013 at 9:47 AM, Ben Hood <0x6e6562 at gmail.com> wrote:

>
> Can this also be made to work in conjunction with an LDAP provider, i.e.
> by chaining the supported LDAP backend with a custom backend to
> additionally validate the the token? I wondering whether you can require
> the client to answer both a username/password challenge (evaluated by the
> supported LDAP auth backend) as well as having the token checked by the the
> custom backend? Does the protocol and wiring flow allow for the LDAP
> backend to get re-used in this way or would you need to implement the
> custom backend that wraps the lookup against the LDAP directory and the
> lookup against the Radius server?
>

If I recall correctly, one backend or the other would have to know about
the other one and take care of the chaining rather than something like this
being possible in the Rabbit configuration.  The backend chosen to go with
a given connection is basically the first one in the rabbitmq.config file's
list of backends that succeeds as they're tried in order, and is bound
irrevocably to that session thereafter.

Pursuing this outcome you might be able to call into specific parts of the
LDAP backend as helpers, but a good hunk of your hybrid auth logic would be
in your plugin itself.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130111/c60b66d4/attachment.htm>

From frank.ritchie at dealer.com  Fri Jan 11 15:10:30 2013
From: frank.ritchie at dealer.com (frank.ritchie at dealer.com)
Date: Fri, 11 Jan 2013 07:10:30 -0800 (PST)
Subject: [rabbitmq-discuss] new channels constantly being opened
Message-ID: <193f791d-beaa-4b7b-966c-40fb6aa9ac22@googlegroups.com>

Hi all,

I am troubleshooting an issue where new channels are constantly being 
opened until rabbitmq reaches it's memory limit.

The connection is not dropping as the client TCP port is static (it does 
change if I manually disconnect the connection).

I am not a developer, just a system administrator. What can I do to gain 
some insight as to what might be happening.

This is only happening for a pair of email servers using rabbitmq. 
Connections opened by others servers do not exhibit this behavior. When 
there is only 1 email server there is no issue (or at least it is not seen).

I am using rabbitmq 2.5.1-1.

Thanks,
Frank
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130111/bd34e471/attachment.htm>

From tim at rabbitmq.com  Fri Jan 11 21:08:07 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 11 Jan 2013 21:08:07 +0000
Subject: [rabbitmq-discuss] log with rabbitmq-client
In-Reply-To: <39201dc5.ca5f.13c294c1839.Coremail.raise-0@163.com>
References: <3ef1a7dd.840d.13c281bedab.Coremail.raise-0@163.com>
	<14A53B53-BB5A-465B-876D-95037D728730@rabbitmq.com>
	<39201dc5.ca5f.13c294c1839.Coremail.raise-0@163.com>
Message-ID: <9136BA19-840D-44DB-A2A2-7486B6167525@rabbitmq.com>

Hi

On 11 Jan 2013, at 11:08, raise-0 wrote:

> Sorry,Tim, It is my problem that make such unclear question.
> 

That's ok, I just wanted to press you for a bit more information. :)

> I can not get more message, log4j loglevel is debug, and still no exception logged.

RabbitMQ's java client does not use any logging library.

>  I restarted my applications again and again and want to get some log from rabbmit-java-client,but got none.

No indeed - there are no calls to log4j, logback, commons-logging, slf4j or even java.util.logging APIs in the client library. 

> If it is the application's problem, why my app can get message in early days? What i have done is just restart, no other change.

If you restarted the broker, what do you think happens to the sockets that the broker held open to communicate with your application? They've been closed and the connection between client and broker has been removed. How do you expect the client to receive messages if the connection is dropped? It can't, and of course because it is a consumer there is no 'indication' that the connection drops until the operating system decides to set an error code on the socket. If you want to be notified of this then you should register a ShutdownListener on the connection or channel: see http://www.rabbitmq.com/api-guide.html#shutdown for details.

> If it is the rabbitmq's problem, why other application and queue is running whithout any problem ?
> 

I have no idea, because this is the first you've mentioned 'other application's in this thread. I could offer some guesses, but I'd need more details on these other applications first.

> At last, I killed the rabbitmq-server process, restart it , and also restart my application again, erverything goes fine. So confused.
> 

It is that second step that fixed your problem ..

> restart my application again

.. because this forces the application to re-establish the network connection to the broker. If you do not manually (or in your code) re-establish the network connection that is broken when the server is stopped or restarted, then it will not magically happen. Unless you're using spring which has some support for re-connecting as I mentioned earlier in the thread.

> My question is , Is rabbitmq-java-client supports any logging compoments?
> 

I'm assuming that you mean "does the rabbitmq-java-client log any debugging information using log4j or some such" and the answer is no - the client library is not tied to any particular logging framework or API.

HTH

Cheers,
Tim



From insolence9 at gmail.com  Sat Jan 12 02:59:58 2013
From: insolence9 at gmail.com (Eric Carmichael)
Date: Fri, 11 Jan 2013 18:59:58 -0800 (PST)
Subject: [rabbitmq-discuss] Server restart and now Rabbit's behaving
	strangely?!
Message-ID: <6cb5fba3-52ac-4558-ba69-83704beb22f7@googlegroups.com>

Hey guys, first of all I'll just say I don't know a lot about RabbitMQ.  I 
had it working from a few weeks ago and it has been working fine.

Now when I try to start the server, the startup log says:

BOOT FAILED
===========
Error description:
   {error,corrupt_cluster_status_files,[]}
Log files (may contain more information):
   /var/log/rabbitmq/rabbit at server1.log
   /var/log/rabbitmq/rabbit at server1-sasl.log
Stack trace:
   [{rabbit_node_monitor,'-prepare_cluster_status_files/0-fun-0-',1},
    {rabbit_node_monitor,prepare_cluster_status_files,0},
    {rabbit,'-boot/0-fun-1-',0},
    {rabbit,start_it,1},
    {init,start_it,1},
    {init,start_em,1}]
{"init terminating in 
do_boot",{rabbit,failure_during_boot,{error,corrupt_cluster_status_files,[]}}}


I've been Googling my little hands off, trying to find out what's wrong.  I 
don't even think I did any special configuration for RabbitMQ so I can't 
find any specific configuration files aside from 
"/etc/rabbitmq/rabbitmq-env.conf" which seems to do its own thing.

Anyone have a clue what went wrong?  If not, what are the steps to 
uninstalling + reinstalling RabbitMQ?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130111/31c391d5/attachment.htm>

From chris.d at frugalit.co.uk  Sat Jan 12 11:59:38 2013
From: chris.d at frugalit.co.uk (Chris Duncan)
Date: Sat, 12 Jan 2013 11:59:38 +0000
Subject: [rabbitmq-discuss] Publisher confirms when the unexpected happens
Message-ID: <50F1502A.8090406@frugalit.co.uk>

Hi,

I am publishing persistent messages which get routed via a durable 
direct exchange to a durable queue. The channel that I'm using is in 
confirmation mode. There are no consumers subscribed to the queue.

What I would like to understand is what happens if my publisher loses 
its AMQP connection and channels after it has sent all of its messages 
but before it can receive any confirmations. I'm testing this in two ways:

1. My publisher sends its messages and then exits immediately.
2. My publisher sends its messages, closes the connection/channels in a 
controlled manner and then exits.

No. 2 above always results in all of the messages appearing in the 
target queue. I don't have any issues with this behaviour.

However, when I perform No. 1 above, I am observing inconsistent 
behaviour. Sometimes all of the messages appear in the target queue, but 
at other times only some of the messages appear. There are always some 
messages in the queue - never zero.

In the case of No. 1 above, I have observed that when I run my script 
and only some messages appear in the queue, the last TCP frame sent to 
RabbitMQ always contains multiple AMQP basic.publish framesets. Every 
time that the last TCP frame sent contains a single AMQP basic.publish 
frameset, all messages appear in the target queue. This may have no 
bearing on what's happening in RabbitMQ, but the results are always 
predictable based on what I'm seeing going across the wire using Wireshark.

What I was hoping for was an 'all or nothing' outcome for No. 1 as in 
No. 2. So what I'd like to know is - is the behaviour that I'm seeing 
expected from a RabbitMQ point of view?

If anybody wants to run my publisher code then it's here - 
http://gist.github.com/4512337

My test environments are using Ubuntu 12.04 LTS 32 and 64-bit, Erlang 
R14B04, Ruby gem Bunny 0.9.0.pre5 and Ruby 1.9.3-p362. The Bunny gem can 
be installed by running -

gem install bunny --pre

Regards,

Chris


From matthias at rabbitmq.com  Sat Jan 12 12:09:59 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 12 Jan 2013 12:09:59 +0000
Subject: [rabbitmq-discuss] Publisher confirms and lost messages
In-Reply-To: <50F02808.2090300@frugalit.co.uk>
References: <50F02808.2090300@frugalit.co.uk>
Message-ID: <50F15297.4060903@rabbitmq.com>

Chris,

On 11/01/13 14:56, Chris Duncan wrote:
> I have a Ruby publisher script that simply publishes 100 messages via a
> channel that is in confirmation mode. It does not close the AMQP
> connection and channels before it finishes. Every time that the
> Wireshark trace shows a final TCP frame that contains a large number of
> AMQP basic.publish framesets then a variable number of messages do not
> arrive on the queue.
>
> However, I never lose any messages when I include a close method at the
> end of the script. I've run this test many times now and the results are
> always the same.
>
> It doesn't look as though Bunny is doing anything peculiar. The messages
> do seem to be getting sent to the broker correctly.

If you didn't receive a confirm for a message then there is no guarantee 
that the message has made to and been processed by the broker. That's 
the whole point of having confirms.

A correct AMQP connection closure handshake, which apps/clients should 
always perform, ensures that the messages have made it to the broker, 
but not that they have been processed. Under normal circumstances little 
can go wrong once the messages have been received by the broker, so a 
proper connection closure provides a pretty good guarantee. But the 
guarantee offered by confirms is stronger.

Regards,

Matthias.

From matthias at rabbitmq.com  Sat Jan 12 12:19:14 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 12 Jan 2013 12:19:14 +0000
Subject: [rabbitmq-discuss] Publisher confirms when the unexpected
	happens
In-Reply-To: <50F1502A.8090406@frugalit.co.uk>
References: <50F1502A.8090406@frugalit.co.uk>
Message-ID: <50F154C2.20602@rabbitmq.com>

Chris,

On 12/01/13 11:59, Chris Duncan wrote:
> I am publishing persistent messages which get routed via a durable
> direct exchange to a durable queue. The channel that I'm using is in
> confirmation mode. There are no consumers subscribed to the queue.
>
> What I would like to understand is what happens if my publisher loses
> its AMQP connection and channels after it has sent all of its messages
> but before it can receive any confirmations. I'm testing this in two ways:
>
> 1. My publisher sends its messages and then exits immediately.
> 2. My publisher sends its messages, closes the connection/channels in a
> controlled manner and then exits.
>
> No. 2 above always results in all of the messages appearing in the
> target queue. I don't have any issues with this behaviour.
>
> However, when I perform No. 1 above, I am observing inconsistent
> behaviour. Sometimes all of the messages appear in the target queue, but
> at other times only some of the messages appear. There are always some
> messages in the queue - never zero.
>
> What I was hoping for was an 'all or nothing' outcome for No. 1 as in
> No. 2. So what I'd like to know is - is the behaviour that I'm seeing
> expected from a RabbitMQ point of view?

That behaviour is perfectly normal and expected. See my reply to your 
other message.

The fact that you have the channel in confirm mode is irrelevant here, 
since you are not actually looking at the confirmations. If you did then 
you'd know which message definitely have been received and processed by 
the broker. But you still wouldn't have an "all or nothing" guarantee. 
Transactions are the closest you can get for that.

Regards,

Matthias.

From videlalvaro at gmail.com  Sat Jan 12 12:25:35 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Sat, 12 Jan 2013 13:25:35 +0100
Subject: [rabbitmq-discuss] RabbitMQ Management API Client for PHP
Message-ID: <CAMcAHLW=o0PhO1PTb021hisaayoKefmXZxaXwtOB9zaqKDLBYg@mail.gmail.com>

Hi,

Today I've found this project that offers a PHP client for the Management
API.

Read more on its docs website:

https://rabbitmq-management-api-client.readthedocs.org/en/latest/

Regards,

Alvaro
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130112/3b50f4c9/attachment.htm>

From celldee at gmail.com  Sat Jan 12 12:30:35 2013
From: celldee at gmail.com (Chris Duncan)
Date: Sat, 12 Jan 2013 12:30:35 +0000
Subject: [rabbitmq-discuss] Publisher confirms when the unexpected
	happens
In-Reply-To: <50F154C2.20602@rabbitmq.com>
References: <50F1502A.8090406@frugalit.co.uk> <50F154C2.20602@rabbitmq.com>
Message-ID: <50F1576B.5010201@gmail.com>

Hi Matthias,

On 12/01/13 12:19, Matthias Radestock wrote:
> Chris,
>
> That behaviour is perfectly normal and expected. See my reply to your 
> other message.
>
> The fact that you have the channel in confirm mode is irrelevant here, 
> since you are not actually looking at the confirmations. If you did 
> then you'd know which message definitely have been received and 
> processed by the broker. But you still wouldn't have an "all or 
> nothing" guarantee. Transactions are the closest you can get for that.
>
Thanks for your replies. Just kicking around some 'what if' scenarios 
and it's always useful to have a good idea about possible outcomes.

Cheers


From michael.s.klishin at gmail.com  Sat Jan 12 12:43:22 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sat, 12 Jan 2013 12:43:22 +0000
Subject: [rabbitmq-discuss] new channels constantly being opened
In-Reply-To: <193f791d-beaa-4b7b-966c-40fb6aa9ac22@googlegroups.com>
References: <193f791d-beaa-4b7b-966c-40fb6aa9ac22@googlegroups.com>
Message-ID: <CAE3HoVTSmXAj7Rp9mdDrr1ikpewCLa0QcrMvAFQRYn6dvKk7QQ@mail.gmail.com>

2013/1/11 <frank.ritchie at dealer.com>

> I am not a developer, just a system administrator. What can I do to gain
> some insight as to what might be happening.


Frank,

This means some applications keep opening new channels without closing the
old ones.

What clients and/or plugins do you use?
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130112/dc7edf81/attachment.htm>

From matthias at rabbitmq.com  Sat Jan 12 14:34:01 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 12 Jan 2013 14:34:01 +0000
Subject: [rabbitmq-discuss] Server-Side Limit for a Channel's
 Unacknowledged Messages
In-Reply-To: <CAHW0W4PZHvZF_OvcoP0Jc_0_ktOJcyLua6fdrT7MivhBm+oNVQ@mail.gmail.com>
References: <CAHW0W4PZHvZF_OvcoP0Jc_0_ktOJcyLua6fdrT7MivhBm+oNVQ@mail.gmail.com>
Message-ID: <50F17459.1000007@rabbitmq.com>

Dave,

On 10/01/13 13:54, Dave Seltzer wrote:
> I was wondering if there's a way to set a policy on the broker that
> would effectively limit the size of the pre-fetch queue for clients?

It is not uncommon for for novice users (and some clients) to forget to 
ack messages, or accidentally buffer vast quantities of messages in the 
client.

We did consider setting basic.qos{prefetch_count=1} as a default, i.e. 
all channels would be limited like that unless the app issues a 
basic.qos of its own.

Unfortunately that a) could break existing apps, and b) significantly 
reduces throughput.

As you say, one option would be to make this server configurable. Since 
we try to keep the number of config settings small, this is really a 
last resort. Still, it might be worth exploring...

At what granularity should a prefetch count be configurable?

a) server
b) user
c) vhost
d) user & vhost
e) peer ip
f) ...


Regards,

Matthias

From strack at Mathematik.Uni-Marburg.de  Sat Jan 12 14:41:23 2013
From: strack at Mathematik.Uni-Marburg.de (Christian Strack)
Date: Sat, 12 Jan 2013 15:41:23 +0100
Subject: [rabbitmq-discuss] Publishing binary data using the java client
Message-ID: <50F17613.8000308@mathematik.uni-marburg.de>

Hi there,

for benchmarking purposes i have set up a an astract testing suite to 
transfer data using several transport implementations. The transmitted 
data are integers converted to byte arrays using ByteBuffer. While the 
en- and decoding of these data is successful using UDP sockets, the 
decoding fails when being transmitted using rabbitmq and the rabbitmq 
java libraries. The results are just random bytes but the array size is 
correct. I have tried to set the encoding to different BasicProperties 
which had no impact. Is there a flag that needs to be set to prevent 
that rabbitmq alters the data? Below are the important snippets of my code.

Greetings and thanks in advance for any comment or answer
Christian

Sender:
         ConnectionFactory factory = new ConnectionFactory();
         factory.setHost(params[0]);
         factory.setUsername(params[1]);
         factory.setPassword(params[2]);

         connection = factory.newConnection();

         channel = connection.createChannel();
         channel.exchangeDeclare(exchange, "fanout");

         try {
             channel.basicPublish(exchange, "", false, 
MessageProperties.BASIC, sendData);
         } catch (IOException e) {
             // TODO Auto-generated catch block
             e.printStackTrace();
         }


Receiver:
         ConnectionFactory factory = new ConnectionFactory();
         factory.setHost(params[0]);
         factory.setUsername(params[1]);
         factory.setPassword(params[2]);

         connection = factory.newConnection();

         channel = connection.createChannel();
         channel.exchangeDeclare(exchange, "fanout");

         String queue = channel.queueDeclare().getQueue();
         channel.queueBind(queue, exchange, "");

         consumer = new QueueingConsumer(channel);
         channel.basicConsume(queue, true, consumer);

         Delivery delivery = consumer.nextDelivery();
         if (delivery != null){
              data = delivery.getBody();
         }

From michael.s.klishin at gmail.com  Sat Jan 12 17:04:15 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sat, 12 Jan 2013 17:04:15 +0000
Subject: [rabbitmq-discuss] Publishing binary data using the java client
In-Reply-To: <50F17613.8000308@mathematik.uni-marburg.de>
References: <50F17613.8000308@mathematik.uni-marburg.de>
Message-ID: <CAE3HoVTScw5chGC+Cdm=WyPN5owccXe4kOkPwKV4pGiaA4njBg@mail.gmail.com>

2013/1/12 Christian Strack <strack at mathematik.uni-marburg.de>

> Is there a flag that needs to be set to prevent that rabbitmq alters the
> data? Below are the important snippets of my code.


Christian,

RabbitMQ never alters message contents. Can you post the code that does
encoding and decoding?
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130112/b406bbca/attachment.htm>

From matthias at rabbitmq.com  Sat Jan 12 17:04:58 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 12 Jan 2013 17:04:58 +0000
Subject: [rabbitmq-discuss] Publishing binary data using the java client
In-Reply-To: <50F17613.8000308@mathematik.uni-marburg.de>
References: <50F17613.8000308@mathematik.uni-marburg.de>
Message-ID: <50F197BA.90805@rabbitmq.com>

Christian,

On 12/01/13 14:41, Christian Strack wrote:
> for benchmarking purposes i have set up a an astract testing suite to
> transfer data using several transport implementations. The transmitted
> data are integers converted to byte arrays using ByteBuffer. While the
> en- and decoding of these data is successful using UDP sockets, the
> decoding fails when being transmitted using rabbitmq and the rabbitmq
> java libraries. The results are just random bytes but the array size is
> correct. I have tried to set the encoding to different BasicProperties
> which had no impact. Is there a flag that needs to be set to prevent
> that rabbitmq alters the data? Below are the important snippets of my code.

The RabbitMQ server does not touch the message body. So this is either a 
problem with your code or, far less likely, the client library.

I cannot see anything obviously wrong with the snippet you sent, but 
since it's only a snippet the error is probably elsewhere. So please 
submit a complete, self-contained program that publishes and consumes a 
single byte[] message and exhibits the problem.

Regards,

Matthias.

From dseltzer at tveyes.com  Sat Jan 12 20:28:57 2013
From: dseltzer at tveyes.com (Dave Seltzer)
Date: Sat, 12 Jan 2013 15:28:57 -0500
Subject: [rabbitmq-discuss] Server-Side Limit for a Channel's
 Unacknowledged Messages
In-Reply-To: <50F17459.1000007@rabbitmq.com>
References: <CAHW0W4PZHvZF_OvcoP0Jc_0_ktOJcyLua6fdrT7MivhBm+oNVQ@mail.gmail.com>
	<50F17459.1000007@rabbitmq.com>
Message-ID: <CAHW0W4P6PC5uky4PbwKB3HQiMG5y0byKZz-LAsP3JHFAkBCPaA@mail.gmail.com>

If you're asking me, then I think the answer might be the ability to set a
limit on the number of un-acked messages per channel, and then the ability
to limit the number of channels per user/vhost.

Perhaps the new Policy framework in RabbitMQ 3.0+ would provide an
interesting way to configure this behavior.

I think that part of the problem is that most of the examples in the
ClientAPI documentation don't touch on this issue, so a naive user, who
copies and pastes an example, might find themselves with an enormous
pre-fetch queue and never even know it. But, even if my users were more
conscientious about setting this variable, I think there's still a
compelling argument to be made that a broker-administrator should be able
to limit it.

Thanks for taking the time to explain the complexity!

-D


On Sat, Jan 12, 2013 at 9:34 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Dave,
>
> On 10/01/13 13:54, Dave Seltzer wrote:
>
>> I was wondering if there's a way to set a policy on the broker that
>> would effectively limit the size of the pre-fetch queue for clients?
>>
>
> It is not uncommon for for novice users (and some clients) to forget to
> ack messages, or accidentally buffer vast quantities of messages in the
> client.
>
> We did consider setting basic.qos{prefetch_count=1} as a default, i.e. all
> channels would be limited like that unless the app issues a basic.qos of
> its own.
>
> Unfortunately that a) could break existing apps, and b) significantly
> reduces throughput.
>
> As you say, one option would be to make this server configurable. Since we
> try to keep the number of config settings small, this is really a last
> resort. Still, it might be worth exploring...
>
> At what granularity should a prefetch count be configurable?
>
> a) server
> b) user
> c) vhost
> d) user & vhost
> e) peer ip
> f) ...
>
>
> Regards,
>
> Matthias
>



-- 
Dave Seltzer <dseltzer at tveyes.com>
Chief Systems Architect
TVEyes
(203) 254-3600 x222
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130112/fe9b4365/attachment.htm>

From strack at Mathematik.Uni-Marburg.de  Sat Jan 12 17:44:16 2013
From: strack at Mathematik.Uni-Marburg.de (Christian Strack)
Date: Sat, 12 Jan 2013 18:44:16 +0100
Subject: [rabbitmq-discuss] Publishing binary data using the java client
In-Reply-To: <50F197BA.90805@rabbitmq.com>
References: <50F17613.8000308@mathematik.uni-marburg.de>
	<50F197BA.90805@rabbitmq.com>
Message-ID: <50F1A0F0.5090100@mathematik.uni-marburg.de>

Hello Matthias and Michael and thank you for your fast response. In this 
mail is the full code including de- and encoding:

package de.bench.message.transport;

import java.io.IOException;

import com.rabbitmq.client.Channel;
import com.rabbitmq.client.Connection;
import com.rabbitmq.client.ConnectionFactory;
import com.rabbitmq.client.ConsumerCancelledException;
import com.rabbitmq.client.MessageProperties;
import com.rabbitmq.client.QueueingConsumer;
import com.rabbitmq.client.QueueingConsumer.Delivery;
import com.rabbitmq.client.ShutdownSignalException;

public class AMQPTransport extends Transport{

     Connection connection;
     Channel channel;
     String exchange;
     QueueingConsumer consumer;
     int role;

     public AMQPTransport() {
         // TODO Auto-generated constructor stub
     }

     @Override
     public void initialise(String info) {
         String[] params = info.split("/");
         ConnectionFactory factory = new ConnectionFactory();
         factory.setHost(params[0]);
         factory.setUsername(params[1]);
         factory.setPassword(params[2]);
         exchange = params[3];
         role = Integer.parseInt(params[4]);


         try {
             connection = factory.newConnection();
             channel = connection.createChannel();
             channel.exchangeDeclare(exchange, "fanout");

             if(role == 1){
                 String queue = channel.queueDeclare().getQueue();
                 channel.queueBind(queue, exchange, "");
                 consumer = new QueueingConsumer(channel);
                 channel.basicConsume(queue, true, consumer);
             }
         } catch (IOException e) {
             // TODO Auto-generated catch block
             e.printStackTrace();
         }


     }

     @Override
     public int write(byte[] sendData, int len) {
         try {
             channel.basicPublish(exchange, "", false, 
MessageProperties.BASIC, sendData);
         } catch (IOException e) {
             // TODO Auto-generated catch block
             e.printStackTrace();
         }
         return 0;
     }

     @Override
     public int read(byte[] data, int len) {
         try {
             Delivery delivery = consumer.nextDelivery();
             if (delivery != null){
                 data = delivery.getBody();
                 System.out.println(new String(data));
                 return len;
             }
             return 0;
         } catch (ShutdownSignalException e) {
             // TODO Auto-generated catch block
             e.printStackTrace();
             return -1;
         } catch (ConsumerCancelledException e) {
             // TODO Auto-generated catch block
             e.printStackTrace();
             return -2;
         } catch (InterruptedException e) {
             // TODO Auto-generated catch block
             e.printStackTrace();
             return -3;
         }
     }

     @Override
     public void close() {
         try {
             channel.close();
             connection.close();
         } catch (IOException e) {
             // TODO Auto-generated catch block
             e.printStackTrace();
         }


     }

}

Sender:
     public void benchmarkPackageLossSender(Transport t, int count) 
throws IOException{
         bwLogWriter.write("Benchmark Package Loss As Sender");
         bwLogWriter.newLine();
         bwLogWriter.write("Count: "+count);
         bwLogWriter.newLine();
         bwLogWriter.newLine();

         for(int i=0; i<count;i++){
             ByteBuffer bb = ByteBuffer.allocate(4);
             byte[] data = bb.putInt(i).array();
             System.out.println("Sent package #"+i);
             t.write(data, data.length);
         }
         bwLogWriter.write("Benchmark finished");
         bwLogWriter.newLine();
     }

Receiver
     public void benchmarkPackageLossReceiver(Transport t, int count) 
throws IOException{
         bwLogWriter.write("Benchmark Package Loss As Receiver");
         bwLogWriter.newLine();
         bwLogWriter.write("Count: "+count);
         bwLogWriter.newLine();
         bwLogWriter.newLine();

         System.out.println("Begin Benchmark");

         byte[] data = new byte[4];
         int last_value = -1;
         int new_value = -1;

         for(int i=0; i<count;i++){
             t.read(data, 4);
             System.out.println("Received Package #"+i);
             new_value = ByteBuffer.wrap(data).getInt();
             // Here only random bytes are printed
             System.out.println("Content: "+new_value);
             if(new_value != ++last_value){
                 bwLogWriter.write("Message Loss! Last Message: 
"+last_value+"\t New Message: "+new_value);
                 bwLogWriter.newLine();
             }
             last_value = new_value;
         }
         System.out.println("Benchmark finished");
         bwLogWriter.write("Benchmark finished");
         bwLogWriter.newLine();
     }

On 01/12/2013 06:04 PM, Matthias Radestock wrote:
> Christian,
>
> On 12/01/13 14:41, Christian Strack wrote:
>> for benchmarking purposes i have set up a an astract testing suite to
>> transfer data using several transport implementations. The transmitted
>> data are integers converted to byte arrays using ByteBuffer. While the
>> en- and decoding of these data is successful using UDP sockets, the
>> decoding fails when being transmitted using rabbitmq and the rabbitmq
>> java libraries. The results are just random bytes but the array size is
>> correct. I have tried to set the encoding to different BasicProperties
>> which had no impact. Is there a flag that needs to be set to prevent
>> that rabbitmq alters the data? Below are the important snippets of my 
>> code.
>
> The RabbitMQ server does not touch the message body. So this is either 
> a problem with your code or, far less likely, the client library.
>
> I cannot see anything obviously wrong with the snippet you sent, but 
> since it's only a snippet the error is probably elsewhere. So please 
> submit a complete, self-contained program that publishes and consumes 
> a single byte[] message and exhibits the problem.
>
> Regards,
>
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From f at mazzo.li  Sat Jan 12 18:10:57 2013
From: f at mazzo.li (Francesco Mazzoli)
Date: Sat, 12 Jan 2013 18:10:57 +0000
Subject: [rabbitmq-discuss] Server restart and now Rabbit's
	behaving	strangely?!
In-Reply-To: <6cb5fba3-52ac-4558-ba69-83704beb22f7@googlegroups.com>
References: <6cb5fba3-52ac-4558-ba69-83704beb22f7@googlegroups.com>
Message-ID: <87zk0eff0u.wl%f@mazzo.li>



At Fri, 11 Jan 2013 18:59:58 -0800 (PST),
Eric Carmichael wrote:
> Hey guys, first of all I'll just say I don't know a lot about RabbitMQ.  I 
> had it working from a few weeks ago and it has been working fine.
> 
> Now when I try to start the server, the startup log says:
> 
> BOOT FAILED
> ===========
> Error description:
>    {error,corrupt_cluster_status_files,[]}

This message indicates that something went wrong when trying to reading the
contents of the cluster status file.

The cluster status file should contain an erlang term with various information
about the node?s (you guessed it) cluster, and it?s located in
?<mnesia_dir>/cluster_nodes.config?.  Unless you?re manually providing it (or
your packager has changed it), you can find out about the default location of
the mnesia directory here: <http://www.rabbitmq.com/relocate.html#unix>.

You should check that that file is there, and that RabbitMQ process has the
permissions to read it.  If that?s the case, please post its contents.  If the
node is not clustered, then you can just delete it and start the node, and
things should be fine.

Francesco


From matthias at rabbitmq.com  Sat Jan 12 23:15:57 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 12 Jan 2013 23:15:57 +0000
Subject: [rabbitmq-discuss] Publishing binary data using the java client
In-Reply-To: <50F1A0F0.5090100@mathematik.uni-marburg.de>
References: <50F17613.8000308@mathematik.uni-marburg.de>
	<50F197BA.90805@rabbitmq.com>
	<50F1A0F0.5090100@mathematik.uni-marburg.de>
Message-ID: <50F1EEAD.3050001@rabbitmq.com>

Christian,

On 12/01/13 17:44, Christian Strack wrote:
> Hello Matthias and Michael and thank you for your fast response. In
> this mail is the full code including de- and encoding:

Thanks for posting this. While it's not executable code, I think I've 
spotted the problem...

Here's a fragment of the receiver code:

>         byte[] data = new byte[4];
>
>         for(int i=0; i<count;i++){
>             t.read(data, 4);
>             System.out.println("Received Package #"+i);
>             new_value = ByteBuffer.wrap(data).getInt();

You appear to expect the 'read' invocation to modify the 'data' array 
that you pass in as an argument.

But 'read' looks like this:

>     public int read(byte[] data, int len) {
>         try {
>             Delivery delivery = consumer.nextDelivery();
>             if (delivery != null){
>                 data = delivery.getBody();
>                 System.out.println(new String(data));
>                 return len;
>             }

The delivery.getBody() call returns a reference to an array, and the 
above simply assigns a that reference to the local 'data' variable.

So the data that is being read never makes it out of that function.


Regards,

Matthias.

From strack at Mathematik.Uni-Marburg.de  Sun Jan 13 08:58:54 2013
From: strack at Mathematik.Uni-Marburg.de (Christian Strack)
Date: Sun, 13 Jan 2013 09:58:54 +0100
Subject: [rabbitmq-discuss] Publishing binary data using the java client
In-Reply-To: <50F1EEAD.3050001@rabbitmq.com>
References: <50F17613.8000308@mathematik.uni-marburg.de>
	<50F197BA.90805@rabbitmq.com>
	<50F1A0F0.5090100@mathematik.uni-marburg.de>
	<50F1EEAD.3050001@rabbitmq.com>
Message-ID: <55F56AC4-DE1E-4DC7-A263-D5EBD5052CC5@Mathematik.Uni-Marburg.de>

Hello Matthias

Thank you for pointing that out for me. This solved my problem. Sorry for not sending directly executable code, I must have overseen this request.

Regards,
Christian

Am 13.01.2013 um 00:15 schrieb Matthias Radestock <matthias at rabbitmq.com>:

> Christian,
> 
> On 12/01/13 17:44, Christian Strack wrote:
>> Hello Matthias and Michael and thank you for your fast response. In
>> this mail is the full code including de- and encoding:
> 
> Thanks for posting this. While it's not executable code, I think I've spotted the problem...
> 
> Here's a fragment of the receiver code:
> 
>>        byte[] data = new byte[4];
>> 
>>        for(int i=0; i<count;i++){
>>            t.read(data, 4);
>>            System.out.println("Received Package #"+i);
>>            new_value = ByteBuffer.wrap(data).getInt();
> 
> You appear to expect the 'read' invocation to modify the 'data' array that you pass in as an argument.
> 
> But 'read' looks like this:
> 
>>    public int read(byte[] data, int len) {
>>        try {
>>            Delivery delivery = consumer.nextDelivery();
>>            if (delivery != null){
>>                data = delivery.getBody();
>>                System.out.println(new String(data));
>>                return len;
>>            }
> 
> The delivery.getBody() call returns a reference to an array, and the above simply assigns a that reference to the local 'data' variable.
> 
> So the data that is being read never makes it out of that function.
> 
> 
> Regards,
> 
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From matthias at rabbitmq.com  Sun Jan 13 16:11:39 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 13 Jan 2013 16:11:39 +0000
Subject: [rabbitmq-discuss] log rotate
In-Reply-To: <1357922176509-24408.post@n5.nabble.com>
References: <1357922176509-24408.post@n5.nabble.com>
Message-ID: <50F2DCBB.70105@rabbitmq.com>

On 11/01/13 16:36, Prabodh Upreti wrote:
> I am sure this has been asked before. What is the best way to manage
> rabbitmq log rotation: linux logrotate
> or rabbitmqctl rotate_logs .  I need to rotate log files every day and then
> zip it end of month. thx.

'rabbitmqctl rotate_logs' is designed with invocation from logrotate in 
mind. The RabbitMQ server .deb and rpm packages ship with a logrotate 
configuration. See the end of 
http://www.rabbitmq.com/install-debian.html#managing-unix and 
http://www.rabbitmq.com/install-rpm.html#managing-unix.

Regards,

Matthias.

From ryan.rajkomar at gmail.com  Mon Jan 14 08:34:00 2013
From: ryan.rajkomar at gmail.com (Shadowalker)
Date: Mon, 14 Jan 2013 00:34:00 -0800 (PST)
Subject: [rabbitmq-discuss] One Producer, X Consumers where X can change
In-Reply-To: <43c48ee8-ad82-40e2-a11e-9873e89ee8fd@googlegroups.com>
References: <43c48ee8-ad82-40e2-a11e-9873e89ee8fd@googlegroups.com>
Message-ID: <762d6737-941d-44ed-b9b8-83d9e1c3781a@googlegroups.com>

Hi again, 
Been doing a lot of googling on the queue/topic/listening for consumed 
messages count an found this on activemq : 

http://activemq.apache.org/cms/handling-advisory-messages.html
It allows one to check the count of currently listening consumer a 
queue/topic. 

Is there anything like this in rabbit mq ?
This might allow me to create a listener that would only send a message to 
notify the first manager that the references were removed.
Another could be to define the "delete referenrences" message to live for x 
consumptions (x being the number of listener on the "delete references" 
queue) and add an advisory listener on the deletion of the message from the 
queue to process deletion of initial data.
Cheers.

Le jeudi 10 janvier 2013 19:22:57 UTC+1, Shadowalker a ?crit :
>
> Hi, 
> I need to find a solution to a problem of mine and I thought there might 
> be one within rabbitmq so here it is :
> I have a manager that, when requested to delete an element from its DB, 
> needs to notify all other elements that reference the element it needs to 
> delete also no logner reference it.
>
> The main idea to keep in mind is that those references that need be 
> removed are not necessarily stored in the same DB (nor same server) as the 
> initial manager.
>
> So I thought I could use a queue to notify that references to the element 
> I want to delete need to be removed. And all element that could have a 
> reference to that type of element are set to listen on that queue.
>
> What I'd like to know now is whether I can configure my manager to wait 
> for a return "from the queue" (or something else) to be notified that all 
> references have been removed.
>
> say 
> Manager sends a message to queue Q1.
> I can have 1,2,3,more other managers listening on Q1.
>
> Each of them would consume the message and once all of them have consumed 
> the message 
> I would either send directly a notification to the first manager, or 
> create a entry in a queue that the manager listens on so that he would be 
> notified that it can delete the element.
>
>
> Is there anyway to do this ?
> Note : the fact that the complete removal of the element is not immediate 
> is not an issue ( ex: I can ask for deletion a 11:00 and the deletion be 
> effective at 13:00)
> Note2 : I've seen the documentation about RPC calls but this is not really 
> what I'm looking for and if avoidable, I'll rather do so.
>
> Thanks.
>
> Cheers.
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130114/f00a6640/attachment.htm>

From tim at rabbitmq.com  Mon Jan 14 09:37:19 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 14 Jan 2013 09:37:19 +0000
Subject: [rabbitmq-discuss] One Producer, X Consumers where X can change
In-Reply-To: <762d6737-941d-44ed-b9b8-83d9e1c3781a@googlegroups.com>
References: <43c48ee8-ad82-40e2-a11e-9873e89ee8fd@googlegroups.com>
	<762d6737-941d-44ed-b9b8-83d9e1c3781a@googlegroups.com>
Message-ID: <50F3D1CF.1070104@rabbitmq.com>

Hi,

On 01/14/2013 08:34 AM, Shadowalker wrote:
> Hi again,
> Been doing a lot of googling on the queue/topic/listening for consumed 
> messages count an found this on activemq :
>
> http://activemq.apache.org/cms/handling-advisory-messages.html 
> <http://activemq.apache.org/cms/handling-advisory-messages.html>
> It allows one to check the count of currently listening consumer a 
> queue/topic.
>

I would not recommend an architecture for distributed resource tracking 
based on that. What happens if a consumer is temporarily disconnected 
when you go into the check, but reconnects after (or whilst) the rest of 
the participants are being updated? You've introduced even more 
possibilities for race conditions than before.

What I would suggest is that you carefully consider whether you actually 
need synchronous communications here, as messaging based architectures 
inherently de-couple producers from consumers, yet you've repeatedly 
attempted to force some 'awareness' of consumers into the producer 
whilst discussing this design. I would like to posit that this reveals 
an 'impedance mismatch' between your requirements and the inherently 
disconnected nature of a queue based solution. Of course distributed 
locking is often implemented using asynchronous communication protocols, 
but this is usually done at a *much lower protocol level* - I'd suggest 
researching Paxos or similar distributed consensus algorithms to get an 
idea of what's involved in designing a reliable solution to this kind of 
problem.

> Is there anything like this in rabbit mq ?

Not that I know of, although it's possible to use the HTTP APIs in order 
to track consumers but that is, as I mentioned above, subject to lots of 
*nasty* race conditions. You *could* look at using Tony G's presence 
exchange (https://github.com/tonyg/presence-exchange) to track bindings 
- although this would complicate your topology quite a lot, it might 
make tracking the various participants plausibly useful, providing you 
use a known set of binding keys.

> This might allow me to create a listener that would only send a 
> message to notify the first manager that the references were removed.

I'm not clear on how that helps!? I did have a bit of an early start 
this morning though... ;)

> Another could be to define the "delete referenrences" message to live 
> for x consumptions (x being the number of listener on the "delete 
> references" queue) and add an advisory listener on the deletion of the 
> message from the queue to process deletion of initial data.

That doesn't help at all unless you've actually tracked the number of 
acquired messages in the first place. Plus you *can* do that without 
'detecting' the number of consumers. You just insist on getting a 
'make-ref' message from the consumer (with some unique id) before 
incrementing the reference count. There's no real difference between 
*detecting* the consumer's connection/channel and providing a ref/lock 
acquisition queue, except that the latter is probably more structured, 
architecturally clearer and quite likely to be more reliable.

Even if you used ActiveMQ's detection functionality or RabbitMQ's 
management HTTP APIs, the fundamental problem of race conditions 
wouldn't go away. Before we go much further discussing various ways you 
can design a solution - and I *am* interested in this discussion BTW - 
please read 
http://en.wikipedia.org/wiki/Byzantine_fault_tolerance#Byzantine_failures and 
make sure you've understood the consequences of nodes *just 
disappearing* and then *maybe* coming back later on.

You've also still not explained what the consequences of loosing track 
of resources actually are. If one of your nodes dies, when it comes back 
to life has any state been persisted and will that state thus be used to 
try and re-acquire or release the 'lock count' for this resource? What 
happens if your node sends an 'acquire' request asynchronously, then 
starts to write the resource/lock state to its own local database and 
dies (e.g., the machine crashes) before committing the transaction? 
Because the 'acquire' request was not synchronous, the master now thinks 
that your node holds the lock, whilst the node does *not* think the 
same. If you bring the node back online and then start asking for the 
resource lock, you're breaking the contract for lock acquisition on that 
node unless you're willing to make 'acquire' idempotent, which has its 
own pitfalls. If you don't make 'acquire' idempotent, then acquisition 
will fail. If you try to handle this by making 'acquire' re-entrant and 
then try to release the node's locl, the master will be confused as it 
thinks you hold the lock twice and the *lost lock acquisition* will 
never be released.

tldr; this is not a simple problem.

Cheers,
Tim

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130114/c3dfa35a/attachment.htm>

From emile at rabbitmq.com  Mon Jan 14 09:51:36 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 14 Jan 2013 09:51:36 +0000
Subject: [rabbitmq-discuss] One Producer, X Consumers where X can change
In-Reply-To: <762d6737-941d-44ed-b9b8-83d9e1c3781a@googlegroups.com>
References: <43c48ee8-ad82-40e2-a11e-9873e89ee8fd@googlegroups.com>
	<762d6737-941d-44ed-b9b8-83d9e1c3781a@googlegroups.com>
Message-ID: <50F3D528.2090405@rabbitmq.com>

On 14/01/13 08:34, Shadowalker wrote:
> http://activemq.apache.org/cms/handling-advisory-messages.html
> <http://activemq.apache.org/cms/handling-advisory-messages.html>
> It allows one to check the count of currently listening consumer a
> queue/topic.
> 
> Is there anything like this in rabbit mq ?

RabbitMQ has something similar, but I don't think it can be used to
solve your problem. The "amq.rabbitmq.log" exchange receives all
messages that are sent to the logfile and can be used to track connections.

Also see
https://www.rabbitmq.com/firehose.html
This is a way to see all messages entering and leaving the broker.





-Emile




From michael.s.klishin at gmail.com  Mon Jan 14 14:28:11 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 14 Jan 2013 14:28:11 +0000
Subject: [rabbitmq-discuss] One Producer, X Consumers where X can change
In-Reply-To: <762d6737-941d-44ed-b9b8-83d9e1c3781a@googlegroups.com>
References: <43c48ee8-ad82-40e2-a11e-9873e89ee8fd@googlegroups.com>
	<762d6737-941d-44ed-b9b8-83d9e1c3781a@googlegroups.com>
Message-ID: <CAE3HoVTKVbE2J2QJEa=HDWy8=d78jXV_9C-KrzhkZrPs+SO-ig@mail.gmail.com>

2013/1/14 Shadowalker <ryan.rajkomar at gmail.com>

> It allows one to check the count of currently listening consumer a
> queue/topic.
>
> Is there anything like this in rabbit mq ?
>


Declaring a queue with the passive parameter set to true will return
queue.declare-ok
that carries number of consumers on the queue. Some clients expose this
trick as a separate
method in the API.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130114/18feb6b9/attachment.htm>

From tim at rabbitmq.com  Mon Jan 14 15:15:29 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 14 Jan 2013 15:15:29 +0000
Subject: [rabbitmq-discuss] Fwd:  One Producer,
	X Consumers where X can change
References: <CAG=bwtNPXSLL0w0qjiXJvsk66t6V0avdfGVqJLTtYLzRw_Cs4g@mail.gmail.com>
Message-ID: <9589A02B-642D-4235-A43F-D558956EC09D@rabbitmq.com>

Putting the list back on CC - I didn't realise I hadn't hit reply-all.

Begin forwarded message:

> From: "Ryan R." <ryan.rajkomar at gmail.com>
> Subject: Re: [rabbitmq-discuss] One Producer, X Consumers where X can change
> Date: 14 January 2013 10:21:48 GMT
> To: Tim Watson <tim at rabbitmq.com>
> 
> Hi,
> 
> First of all thanks for the quick reply,
> 
> I'm well aware that trying to use such solution as many issues (mostly the data integrity should a error arise somewhere along the process) and that is indeed problematic.
> I was actually just looking for a potential way of doing what I need : I have one (or more) webservices whose objects might contains references to objects of another webservice (ideally each WS has its own DB on a different server)
> 
> The issue here is how to keep data integrity when trying to delete the referenced element : if one of the references can't be deleted (for any reason) nothing should be deleted. However here, since data on on different database/webservices/server, I can't do a simple DB transaction.
> 
> Initially I did not really intend to use rabbitMQ for this but only for a notifications system.
> But I figured, since having a delay in my deletion process between the request and the actual deletion wasn't an issue, maybe I might be able to find a solution there.
> 
> Finally, and this has nothing to do with my research, for some reason I do not see your post in google groups. How come?
> 
> Thanks again,
> Cheers.
> 
> 
> 2013/1/14 Tim Watson <tim at rabbitmq.com>
> Hi,
> 
> 
> On 01/14/2013 08:34 AM, Shadowalker wrote:
>> 
>> Hi again, 
>> Been doing a lot of googling on the queue/topic/listening for consumed messages count an found this on activemq : 
>> 
>> http://activemq.apache.org/cms/handling-advisory-messages.html
>> It allows one to check the count of currently listening consumer a queue/topic. 
>> 
> 
> I would not recommend an architecture for distributed resource tracking based on that. What happens if a consumer is temporarily disconnected when you go into the check, but reconnects after (or whilst) the rest of the participants are being updated? You've introduced even more possibilities for race conditions than before.
> 
> What I would suggest is that you carefully consider whether you actually need synchronous communications here, as messaging based architectures inherently de-couple producers from consumers, yet you've repeatedly attempted to force some 'awareness' of consumers into the producer whilst discussing this design. I would like to posit that this reveals an 'impedance mismatch' between your requirements and the inherently disconnected nature of a queue based solution. Of course distributed locking is often implemented using asynchronous communication protocols, but this is usually done at a *much lower protocol level* - I'd suggest researching Paxos or similar distributed consensus algorithms to get an idea of what's involved in designing a reliable solution to this kind of problem.
> 
> 
>> Is there anything like this in rabbit mq ?
> 
> Not that I know of, although it's possible to use the HTTP APIs in order to track consumers but that is, as I mentioned above, subject to lots of *nasty* race conditions. You *could* look at using Tony G's presence exchange (https://github.com/tonyg/presence-exchange) to track bindings - although this would complicate your topology quite a lot, it might make tracking the various participants plausibly useful, providing you use a known set of binding keys.
> 
> 
>> This might allow me to create a listener that would only send a message to notify the first manager that the references were removed.
> 
> I'm not clear on how that helps!? I did have a bit of an early start this morning though... ;)
> 
> 
>> Another could be to define the "delete referenrences" message to live for x consumptions (x being the number of listener on the "delete references" queue) and add an advisory listener on the deletion of the message from the queue to process deletion of initial data.
> 
> That doesn't help at all unless you've actually tracked the number of acquired messages in the first place. Plus you *can* do that without 'detecting' the number of consumers. You just insist on getting a 'make-ref' message from the consumer (with some unique id) before incrementing the reference count. There's no real difference between *detecting* the consumer's connection/channel and providing a ref/lock acquisition queue, except that the latter is probably more structured, architecturally clearer and quite likely to be more reliable.
> 
> Even if you used ActiveMQ's detection functionality or RabbitMQ's management HTTP APIs, the fundamental problem of race conditions wouldn't go away. Before we go much further discussing various ways you can design a solution - and I *am* interested in this discussion BTW - please read http://en.wikipedia.org/wiki/Byzantine_fault_tolerance#Byzantine_failures and make sure you've understood the consequences of nodes *just disappearing* and then *maybe* coming back later on.
> 
> You've also still not explained what the consequences of loosing track of resources actually are. If one of your nodes dies, when it comes back to life has any state been persisted and will that state thus be used to try and re-acquire or release the 'lock count' for this resource? What happens if your node sends an 'acquire' request asynchronously, then starts to write the resource/lock state to its own local database and dies (e.g., the machine crashes) before committing the transaction? Because the 'acquire' request was not synchronous, the master now thinks that your node holds the lock, whilst the node does *not* think the same. If you bring the node back online and then start asking for the resource lock, you're breaking the contract for lock acquisition on that node unless you're willing to make 'acquire' idempotent, which has its own pitfalls. If you don't make 'acquire' idempotent, then acquisition will fail. If you try to handle this by making 'acquire' re-entrant and then try to release the node's locl, the master will be confused as it thinks you hold the lock twice and the *lost lock acquisition* will never be released.
> 
> tldr; this is not a simple problem.
> 
> Cheers,
> Tim
> 
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130114/3fd592bd/attachment.htm>

From j_depp_99 at yahoo.com  Mon Jan 14 15:18:09 2013
From: j_depp_99 at yahoo.com (jdepp)
Date: Mon, 14 Jan 2013 07:18:09 -0800 (PST)
Subject: [rabbitmq-discuss] newbie with data feed application to Rabbit
Message-ID: <1358176689127-24436.post@n5.nabble.com>

I would like to set up a rabbitMQ system that will be used for an application
that has multiple data feeds and parsers to these feeds. Basically I will
have one process that accesses all these feeds and places the data in queues
and my parsers will be the consumers. I think after reading I will just have
to create a producer to grab the feeds and place in queues and have the
consumers access those queues. I am not sure as to what would then be the
broker and how does this relate to my intended project. Does anyone know of
any samples related to such a project type?



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/newbie-with-data-feed-application-to-Rabbit-tp24436.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From schokkal at cisco.com  Mon Jan 14 16:36:44 2013
From: schokkal at cisco.com (Sudhakar Chokkalingam (schokkal))
Date: Mon, 14 Jan 2013 16:36:44 +0000
Subject: [rabbitmq-discuss]  Message routing
In-Reply-To: <AC1CECBE58B36646AE85DD6BEB7AFFF1108424@xmb-aln-x14.cisco.com>
Message-ID: <AC1CECBE58B36646AE85DD6BEB7AFFF110843E@xmb-aln-x14.cisco.com>


Hi Team,
I need your guidance on routing messages in the rabbit MQ. I am trying to route the menages in a round-robin menthol between the queues which are bonded to an exchange.  In the document page I read that, if we have a same routing key with the direct exchange then we can load balance at consumer level, but not at the queue level. Here. I assume, in the consumer has to discard the message if it is already consumed by others.  But I like to do the distribution at queue level and make the consumers to process every message instead of checking with other consumers whether it is already processed or not.

Could please help me, how we can do this round-robin distribution in queue level.
Thanks
Sudhakar


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130114/bba17833/attachment.htm>

From ask at rabbitmq.com  Mon Jan 14 16:56:30 2013
From: ask at rabbitmq.com (Ask Solem)
Date: Mon, 14 Jan 2013 16:56:30 +0000
Subject: [rabbitmq-discuss] pika's blocking channel exchange_declare
	hanging???
In-Reply-To: <E29A2349FBDC2F429089E672A7FD29A92F9268F9@SJC4EXDAG01-01.corp.service-now.com>
References: <E29A2349FBDC2F429089E672A7FD29A92F9268F9@SJC4EXDAG01-01.corp.service-now.com>
Message-ID: <0FEAF483-63D0-45AA-AE8F-6FDCEAA4B3B1@rabbitmq.com>


On Jan 11, 2013, at 2:04 AM, Dragos Manolescu <Dragos.Manolescu at servicenow.com> wrote:

> Hi --
> 
> I am experiencing a behavior I didn't expect--and don't understand :( In the following simplified code:
> 
>         try:
>             self.out_channel.exchange_declare\
>                 ( exchange=exchange
>                 , type="topic"
>                 , passive=False
>                 , durable=True
>                 , auto_delete=False
>                 , nowait=True
>             )
>             msg_props = pika.BasicProperties(content_type="application/json", delivery_mode=2)
>             self.out_channel.basic_publish\
>                 ( body=message
>                 , exchange=exchange
>                 , properties=msg_props
>                 , routing_key=routing_key
>                 )
>         except pika.exceptions.AMQPError:
>             self.logger.exception("Message not sent")
> 
> The exchange_declare above seems to block indefinitely; out-channel is a channel obtained from a blocking connection.

Do you have a traceback from the blocking (usually you can get one from hitting Ctrl+C).
Does the rabbitmq logs say anything during this period?

> 
> Here's the context: node N1 (which contains the above code) uses pika.BlockingConnection to communicate with the broker, which is connected to two other nodes N2 and N3. Upon receiving  a message from N2 via a fanout exchange, N1 acknowledges it and then sends N2 a message over a different, topic exchange. The interaction between N1 and N3 follows an identical pattern.
> 
> I noticed that when both N2 and N3 send messages to N1, the above code works as I thought it would only for one of them (say N2), while the exchange_declare hangs for the other (N3). The code works fine if I comment out the exchange_declare call. N1 uses 2 channels, one for incoming messages (fanout exchange) and one for outgoing messages (topic exchange).
> 
> I am using RabbitMQ 3.0.0 and pika 0.9.8.
> 
> Many (but not) all samples invoke exchange_declare as I did above (as it is idempotent) so I assume that I'm missing something rather than making a call I should not make. FWIW the exchange_declare for N1's other, fanout exchange never hangs.
> 
> Thanks,
> 
> -dm
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From jerryk at rbcon.com  Mon Jan 14 17:16:15 2013
From: jerryk at rbcon.com (Jerry Kuch)
Date: Mon, 14 Jan 2013 09:16:15 -0800
Subject: [rabbitmq-discuss] newbie with data feed application to Rabbit
In-Reply-To: <1358176689127-24436.post@n5.nabble.com>
References: <1358176689127-24436.post@n5.nabble.com>
Message-ID: <CAE0Sz=wmap_jzTYc5h3SL_j887JR42k1BCMC6TsP-mEpGGB6Vw@mail.gmail.com>

On Mon, Jan 14, 2013 at 7:18 AM, jdepp <j_depp_99 at yahoo.com> wrote:

> I would like to set up a rabbitMQ system that will be used for an
> application
> that has multiple data feeds and parsers to these feeds. Basically I will
> have one process that accesses all these feeds and places the data in
> queues
> and my parsers will be the consumers. I think after reading I will just
> have
> to create a producer to grab the feeds and place in queues and have the
> consumers access those queues. I am not sure as to what would then be the
> broker and how does this relate to my intended project. Does anyone know of
> any samples related to such a project type?
>

Your scenario sounds like a fairly standard work queueing scheme and people
do this with RabbitMQ all the time.

I am wondering what you mean by "I am not sure as to what would then be the
broker."  In the Rabbit world, the 'broker' is the RabbitMQ server (or
cluster of servers) itself.  A producer connects to the broker and
publishes messages into it, while consumer connect to the broker and
consume messages from queues.  Your queues exist within the broker.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130114/2a37edce/attachment.htm>

From michael.s.klishin at gmail.com  Mon Jan 14 17:28:40 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 14 Jan 2013 17:28:40 +0000
Subject: [rabbitmq-discuss] Message routing
In-Reply-To: <AC1CECBE58B36646AE85DD6BEB7AFFF110843E@xmb-aln-x14.cisco.com>
References: <AC1CECBE58B36646AE85DD6BEB7AFFF1108424@xmb-aln-x14.cisco.com>
	<AC1CECBE58B36646AE85DD6BEB7AFFF110843E@xmb-aln-x14.cisco.com>
Message-ID: <CAE3HoVTkpZbDBXYtw1WoAnZkk5rtcYoRFFx3tpZ+=qBzXv5FLA@mail.gmail.com>

2013/1/14 Sudhakar Chokkalingam (schokkal) <schokkal at cisco.com>

> Could please help me, how we can do this round-robin distribution in queue
> level.


Sudhakar,

If you want to distribute messages between queues, you need to use
Consistent Hash exchange [1] type
which is available as a plugin. With RabbitMQ 3.0, you can enable it with

rabbitmq-plugins enable rabbitmq_consistent_hash_exchange

If having multiple consumers on a shared queue is an option, with equal
prefetch levels you will get round
robin delivery to consumers, as demonstrated in [2].

With multiple queues you will get better overall throughput on multicore
machines. With a single shared
queue there is no need to use any plugins.

1. https://github.com/rabbitmq/rabbitmq-consistent-hash-exchange
2. http://www.rabbitmq.com/tutorials/tutorial-two-python.html
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130114/7b53c6fd/attachment.htm>

From michael.s.klishin at gmail.com  Mon Jan 14 17:48:15 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 14 Jan 2013 17:48:15 +0000
Subject: [rabbitmq-discuss] ANN Bunny 0.9.0.pre6 is released
Message-ID: <CAE3HoVTuHzX4Sy1muxtpKseXZ1xQ23NcrbOZjOSZRtzYLv2Sgg@mail.gmail.com>

TL;DR
-----------------------------------------------------------------------------------------------------------------------

Bunny 0.9.0.pre6 is released to rubygems.org [1].

This release includes one major feature and a few bug fixes. It is 100%
backwards
compatible.

The major feature is automatic network failure recovery. This includes
recovery of
exchanges, queues, bindings and consumers that were declared/added on the
recovered Bunny connection.

In addition, documentation guides on error handling and recovery is now up
online:
http://rubybunny.info/articles/error_handling.html<http://rubybunny.info/articles/exchanges.html>

Change log
-----------------------------------------------------------------------------------------------------------------------

Change log is available on GitHub:

https://github.com/ruby-amqp/bunny/blob/master/ChangeLog.md#changes-between-
bunny-090pre5-and-090pre<https://github.com/ruby-amqp/bunny/blob/master/ChangeLog.md#changes-between-bunny-090pre4-and-090pre5>
6


Plans for 0.9.0 Final
-----------------------------------------------------------------------------------------------------------------------

There is still a few things we need to do before Bunny 0.9 can be declared
complete:

 * Make network failure recovery configurable
 * Bring back TLS support
 * Add logging
 * API reference documentation

Changes are, the next release will be RC1.


1. https://rubygems.org/gems/bunny/versions/0.9.0.pre<https://rubygems.org/gems/bunny/versions/0.9.0.pre5>
6
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130114/d2bae8f1/attachment.htm>

From j_depp_99 at yahoo.com  Mon Jan 14 18:39:54 2013
From: j_depp_99 at yahoo.com (jdepp)
Date: Mon, 14 Jan 2013 10:39:54 -0800 (PST)
Subject: [rabbitmq-discuss] newbie with data feed application to Rabbit
In-Reply-To: <CAE0Sz=wmap_jzTYc5h3SL_j887JR42k1BCMC6TsP-mEpGGB6Vw@mail.gmail.com>
References: <1358176689127-24436.post@n5.nabble.com>
	<CAE0Sz=wmap_jzTYc5h3SL_j887JR42k1BCMC6TsP-mEpGGB6Vw@mail.gmail.com>
Message-ID: <1358188794288-24442.post@n5.nabble.com>

thanks for the response. Finally figured that out...not much of a
reader...understand the broker, producer, consumer on a single level in the
context of what I need to do. 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/newbie-with-data-feed-application-to-Rabbit-tp24436p24442.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From j_depp_99 at yahoo.com  Mon Jan 14 18:43:52 2013
From: j_depp_99 at yahoo.com (jdepp)
Date: Mon, 14 Jan 2013 10:43:52 -0800 (PST)
Subject: [rabbitmq-discuss] newbie with data feed application to Rabbit
In-Reply-To: <1358188794288-24442.post@n5.nabble.com>
References: <1358176689127-24436.post@n5.nabble.com>
	<CAE0Sz=wmap_jzTYc5h3SL_j887JR42k1BCMC6TsP-mEpGGB6Vw@mail.gmail.com>
	<1358188794288-24442.post@n5.nabble.com>
Message-ID: <1358189032611-24443.post@n5.nabble.com>

if you don't mind me asking a couple more just based on definitions - how is
the routing key associated with a queue; is it just a sort of identifier to
pass a msg to a specific queue? 
Sort of attaching a label (routing key) to a paper that needs to be filed
and the queue is the folder that will hold the paper.
Also what exactly is the virtual host for then within a broker. I am sorry
about these questions, but I get a better understanding when explained in
simple words.
Thanks in advance



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/newbie-with-data-feed-application-to-Rabbit-tp24436p24443.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From ward.mark at gmail.com  Mon Jan 14 19:35:53 2013
From: ward.mark at gmail.com (Mark Ward)
Date: Mon, 14 Jan 2013 11:35:53 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ 3.0 Policy ha-all delete issue
In-Reply-To: <50ABBA6A.4000105@rabbitmq.com>
References: <1353429487353-23527.post@n5.nabble.com>
	<1353430965372-23530.post@n5.nabble.com>
	<50ABBA6A.4000105@rabbitmq.com>
Message-ID: <1358192153681-24444.post@n5.nabble.com>

Hi Matthais,

I have been on other projects and getting back to thinking about RabbitMQ
and what you said

>That would be the "one queue per message" anti-pattern. 

Would the one-queue-per-message still be an anti-pattern if the cost of
creating queues was less?  

I have tried to find more information about this anti-pattern.  I am
thinking it is an anti-pattern due to the cost to create, subscribe, and
publish the queue on a per message basis.  I am not finding information if
it is a messaging architecture anti-pattern.

I went with the one-queue-per-message for the request/response model to
avoid single-purpose queues with a listener class that acted as a router
between the requester and the queue.  No two thread request/response calls
should block each other due to being sent to the same queue. 

You have provided good ideas for working around performance issues with
short-lived queues.  Right now I am trying to understand the anti-pattern
better.

-Mark





--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-3-0-Policy-ha-all-delete-issue-tp23527p24444.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From jerryk at rbcon.com  Mon Jan 14 19:46:25 2013
From: jerryk at rbcon.com (Jerry Kuch)
Date: Mon, 14 Jan 2013 11:46:25 -0800
Subject: [rabbitmq-discuss] newbie with data feed application to Rabbit
In-Reply-To: <1358189032611-24443.post@n5.nabble.com>
References: <1358176689127-24436.post@n5.nabble.com>
	<CAE0Sz=wmap_jzTYc5h3SL_j887JR42k1BCMC6TsP-mEpGGB6Vw@mail.gmail.com>
	<1358188794288-24442.post@n5.nabble.com>
	<1358189032611-24443.post@n5.nabble.com>
Message-ID: <CAE0Sz=xRFxwEAbibgyTchWxfooN6HgsxOGjepqQErUb09hFaDg@mail.gmail.com>

Hi, jdepp:

On Mon, Jan 14, 2013 at 10:43 AM, jdepp <j_depp_99 at yahoo.com> wrote:

> if you don't mind me asking a couple more just based on definitions - how
> is
> the routing key associated with a queue; is it just a sort of identifier to
> pass a msg to a specific queue?
> Sort of attaching a label (routing key) to a paper that needs to be filed
> and the queue is the folder that will hold the paper.
> Also what exactly is the virtual host for then within a broker. I am sorry
> about these questions, but I get a better understanding when explained in
> simple words.
>

The tutorials here should clarify some things:

http://www.rabbitmq.com/getstarted.html

Your understanding of routing keys is in the ballpark.  In brief:

A producer publishes to *exchanges*.  Queues are bound to exchanges and
these queues will receive messages published to the bound exchange
depending on:

   1. The type of the exchange
   2. The routing key used on message (if appropriate for exchange type)
   3. The binding key associated with the binding of the queue to the
   exchange

The tutorial examples show you the behaviors of a couple of different
exchange types and how they interact with routing and binding keys.  In
particular the "publish/subscribe," "routing," and "topics" examples show
how choice of exchange type and keys support fairly rich and flexible
routing of your messages.

A virtual host is just a way of partitioning up the resources of a RabbitMQ
broker.  Users can be given access to particular vhosts, and a given vhost
provides a sealed namespace fo the queues/exchanges/routings/etc. that
exist within it.  Thus queue "q_foo" in vhost "host_blah" and "q_foo" in
vhost "host_blarg" are different entities, with access to them governed
separately.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130114/fc7c4926/attachment.htm>

From matthias at rabbitmq.com  Mon Jan 14 19:52:45 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 14 Jan 2013 19:52:45 +0000
Subject: [rabbitmq-discuss] RabbitMQ 3.0 Policy ha-all delete issue
In-Reply-To: <1358192153681-24444.post@n5.nabble.com>
References: <1353429487353-23527.post@n5.nabble.com>
	<1353430965372-23530.post@n5.nabble.com>
	<50ABBA6A.4000105@rabbitmq.com>
	<1358192153681-24444.post@n5.nabble.com>
Message-ID: <50F4620D.8080707@rabbitmq.com>

Mark,

On 14/01/13 19:35, Mark Ward wrote:
> Would the one-queue-per-message still be an anti-pattern if the cost of
> creating queues was less?

No, though it would have to be *considerably* less expensive.

> I have tried to find more information about this anti-pattern.  I am
> thinking it is an anti-pattern due to the cost to create, subscribe, and
> publish the queue on a per message basis.  I am not finding information if
> it is a messaging architecture anti-pattern.

I doubt there are many messaging architectures where message 
publish/receive/ack is anywhere near as expensive as queue creation, 
subscription and deletion. So in that sense one-queue-per-message is an 
a general anti-pattern.

Regards,

Matthias.

From pavel.kogan at cortica.com  Mon Jan 14 21:21:16 2013
From: pavel.kogan at cortica.com (Pavel Kogan)
Date: Mon, 14 Jan 2013 16:21:16 -0500
Subject: [rabbitmq-discuss] Performance Issue
Message-ID: <CAABB5w9FiJm_76kLF+CH7YautOM6ugxrGoru4PgM0z0TCnt5fA@mail.gmail.com>

Hi all,

I have a rabbit server on single dedicated CentOS machine (Quad Core with
16Gb RAM) connected to 1Gbit LAN.
I have many queues running, but total number of messages is not very high
for such a machine.

The problem is following:
1) I connect client A to some queue (with many many messages ready) with
some routing key - it processes 150 messages per sec (its limit).
2) I connect another client A in parallel on identical server to same queue
with same routing key. Now I have 2 identical consumers on same queue and
messages are distributed on round robin
    manner, but somehow second unit receives only 50 messages per sec.
3) If I disconnect A1, A2 starts working normally. If I connect A1 back it
becomes a slow node.

The model is TOPIC with acknowledgments.
Attached screenshots from manager and top command on rabbit machine.
Did anyone experience similar problem?

Thanks a lot,
   Pavel


Publish*148*msg/s
Deliver*744*msg/s
Redelivered*0.00*msg/s
Acknowledge*746*msg/s








NameFile descriptors (?)(used / available)Socket descriptors (?)(used /
available)Erlang processes(used / available)MemoryDisk spaceUptimeType
297 / 1024
135 / 829
16815 / 1048576
826.6MB
6.2GB high waterm


Tasks: 598 total,   1 running, 597 sleeping,   0 stopped,   0 zombie
Cpu0  : 29.8%us,  6.0%sy,  0.0%ni, 64.2%id,  0.0%wa,  0.0%hi,  0.0%si,
 0.0%st
Cpu1  : 33.2%us,  5.6%sy,  0.0%ni, 61.1%id,  0.0%wa,  0.0%hi,  0.0%si,
 0.0%st
Cpu2  : 34.7%us,  6.1%sy,  0.0%ni, 59.3%id,  0.0%wa,  0.0%hi,  0.0%si,
 0.0%st
Cpu3  : 30.1%us,  4.7%sy,  0.0%ni, 64.5%id,  0.7%wa,  0.0%hi,  0.0%si,
 0.0%st
Cpu4  : 29.7%us,  5.3%sy,  0.0%ni, 65.0%id,  0.0%wa,  0.0%hi,  0.0%si,
 0.0%st
Cpu5  : 34.2%us,  6.2%sy,  0.0%ni, 56.8%id,  0.0%wa,  0.0%hi,  2.7%si,
 0.0%st
Cpu6  : 19.9%us,  3.4%sy,  0.0%ni, 76.4%id,  0.0%wa,  0.0%hi,  0.3%si,
 0.0%st
Cpu7  :  2.3%us,  1.0%sy,  0.0%ni, 96.7%id,  0.0%wa,  0.0%hi,  0.0%si,
 0.0%st
Mem:  16217336k total, 13285852k used,  2931484k free,   191072k buffers
Swap:  2097144k total,     4904k used,  2092240k free, 10533540k cached

 PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND


19404 rabbitmq  20   0 3551m 806m 2480 S 254.6  5.1  21417:07 beam.smp
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130114/9862b272/attachment.htm>

From videlalvaro at gmail.com  Mon Jan 14 21:33:21 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Mon, 14 Jan 2013 22:33:21 +0100
Subject: [rabbitmq-discuss] Performance Issue
In-Reply-To: <CAABB5w9FiJm_76kLF+CH7YautOM6ugxrGoru4PgM0z0TCnt5fA@mail.gmail.com>
References: <CAABB5w9FiJm_76kLF+CH7YautOM6ugxrGoru4PgM0z0TCnt5fA@mail.gmail.com>
Message-ID: <CAMcAHLWZJ+6EapjJK1jH=z=Y3wQWGACmDCYm1YE4UfqxjnPdMQ@mail.gmail.com>

Maybe you could take a look at your basic_qos settings, setting the
prefetch_count to some reasonable number?

See http://www.rabbitmq.com/amqp-0-9-1-quickref.html#basic.qos

and
http://www.rabbitmq.com/blog/2011/10/27/performance-of-queues-when-less-is-more/

Regards,

Alvaro


On Mon, Jan 14, 2013 at 10:21 PM, Pavel Kogan <pavel.kogan at cortica.com>wrote:

> Hi all,
>
> I have a rabbit server on single dedicated CentOS machine (Quad Core with
> 16Gb RAM) connected to 1Gbit LAN.
> I have many queues running, but total number of messages is not very high
> for such a machine.
>
> The problem is following:
> 1) I connect client A to some queue (with many many messages ready) with
> some routing key - it processes 150 messages per sec (its limit).
> 2) I connect another client A in parallel on identical server to same
> queue with same routing key. Now I have 2 identical consumers on same queue
> and messages are distributed on round robin
>     manner, but somehow second unit receives only 50 messages per sec.
> 3) If I disconnect A1, A2 starts working normally. If I connect A1 back it
> becomes a slow node.
>
> The model is TOPIC with acknowledgments.
> Attached screenshots from manager and top command on rabbit machine.
> Did anyone experience similar problem?
>
> Thanks a lot,
>    Pavel
>
>
>  Publish*148*msg/s
> Deliver*744*msg/s
> Redelivered*0.00*msg/s
> Acknowledge*746*msg/s
>
>
>
>
>
>
>
>
> Name File descriptors (?)(used / available) Socket descriptors (?)(used /
> available) Erlang processes(used / available) MemoryDisk space UptimeType
> 297 / 1024
> 135 / 829
> 16815 / 1048576
> 826.6MB
> 6.2GB high waterm
>
>
> Tasks: 598 total,   1 running, 597 sleeping,   0 stopped,   0 zombie
> Cpu0  : 29.8%us,  6.0%sy,  0.0%ni, 64.2%id,  0.0%wa,  0.0%hi,  0.0%si,
>  0.0%st
> Cpu1  : 33.2%us,  5.6%sy,  0.0%ni, 61.1%id,  0.0%wa,  0.0%hi,  0.0%si,
>  0.0%st
> Cpu2  : 34.7%us,  6.1%sy,  0.0%ni, 59.3%id,  0.0%wa,  0.0%hi,  0.0%si,
>  0.0%st
> Cpu3  : 30.1%us,  4.7%sy,  0.0%ni, 64.5%id,  0.7%wa,  0.0%hi,  0.0%si,
>  0.0%st
> Cpu4  : 29.7%us,  5.3%sy,  0.0%ni, 65.0%id,  0.0%wa,  0.0%hi,  0.0%si,
>  0.0%st
> Cpu5  : 34.2%us,  6.2%sy,  0.0%ni, 56.8%id,  0.0%wa,  0.0%hi,  2.7%si,
>  0.0%st
> Cpu6  : 19.9%us,  3.4%sy,  0.0%ni, 76.4%id,  0.0%wa,  0.0%hi,  0.3%si,
>  0.0%st
> Cpu7  :  2.3%us,  1.0%sy,  0.0%ni, 96.7%id,  0.0%wa,  0.0%hi,  0.0%si,
>  0.0%st
> Mem:  16217336k total, 13285852k used,  2931484k free,   191072k buffers
> Swap:  2097144k total,     4904k used,  2092240k free, 10533540k cached
>
>  PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND
>
>
> 19404 rabbitmq  20   0 3551m 806m 2480 S 254.6  5.1  21417:07 beam.smp
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130114/09463306/attachment.htm>

From matthias at rabbitmq.com  Mon Jan 14 22:44:44 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 14 Jan 2013 22:44:44 +0000
Subject: [rabbitmq-discuss] Performance Issue
In-Reply-To: <CAABB5w9FiJm_76kLF+CH7YautOM6ugxrGoru4PgM0z0TCnt5fA@mail.gmail.com>
References: <CAABB5w9FiJm_76kLF+CH7YautOM6ugxrGoru4PgM0z0TCnt5fA@mail.gmail.com>
Message-ID: <50F48A5C.3040100@rabbitmq.com>

Pavel,

On 14/01/13 21:21, Pavel Kogan wrote:
> I have a rabbit server on single dedicated CentOS machine (Quad Core
> with 16Gb RAM) connected to 1Gbit LAN.

What version of Erlang and Rabbit are you running? If it's not the 
latest of both then please upgrade.

> I have many queues running, but total number of messages is not very
> high for such a machine.

What are all those queues doing? Are the completely idle or is there a 
trickle of messages flowing in/out/through them?

> The problem is following:
> 1) I connect client A to some queue (with many many messages ready) with
> some routing key - it processes 150 messages per sec (its limit).

What do you mean by "connect... to some queue... with some routing key"? 
Consuming from a queue does not involve a routing key.

> 2) I connect another client A in parallel on identical server to same
> queue with same routing key. Now I have 2 identical consumers on same
> queue and messages are distributed on round robin
>      manner, but somehow second unit receives only 50 messages per sec.
> 3) If I disconnect A1, A2 starts working normally. If I connect A1 back
> it becomes a slow node.

As Alvaro said, check your basic.qos settings; if they are too low then 
throughput becomes bounded by network latency.

Also, check that there aren't any extraneous AMQP commands being issued 
by your client. e.g. it would be bad if, say, it (re)declared the queue 
every time it receives a message. You may want to connect through the 
tracer (http://www.rabbitmq.com/api-guide.html#tracer) and examine the 
command stream.


Regards,

Matthias.

From pavel.kogan at cortica.com  Tue Jan 15 00:18:22 2013
From: pavel.kogan at cortica.com (Pavel Kogan)
Date: Mon, 14 Jan 2013 19:18:22 -0500
Subject: [rabbitmq-discuss] Performance Issue
In-Reply-To: <50F48A5C.3040100@rabbitmq.com>
References: <CAABB5w9FiJm_76kLF+CH7YautOM6ugxrGoru4PgM0z0TCnt5fA@mail.gmail.com>
	<50F48A5C.3040100@rabbitmq.com>
Message-ID: <CAABB5w9ob5-vkaMUU46UYBBJFwcOKUWAMUf9+vOz5Tr2kra=RQ@mail.gmail.com>

Matthias, Alvaro

Thanks for quick reply.

1) Rabbit version: 2.8.4
    Erlang version: R14B04

2) The other queues are some idle some working (not very hard - up to 30-40
message per second).

3) Meaning:
    a) Declaring durable named queue: channel.queueDeclare(queue_name,
true, .... ).
    b) Binding queue: channel.queueBind(queue_name, exchange_name,
routing_key).

4) I will take a closer look at basic.qos

5) We are declaring queue only once on initialization (we are using JAVA
client).

Thanks,
   Pavel



On Mon, Jan 14, 2013 at 5:44 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Pavel,
>
>
> On 14/01/13 21:21, Pavel Kogan wrote:
>
>> I have a rabbit server on single dedicated CentOS machine (Quad Core
>> with 16Gb RAM) connected to 1Gbit LAN.
>>
>
> What version of Erlang and Rabbit are you running? If it's not the latest
> of both then please upgrade.
>
>
>  I have many queues running, but total number of messages is not very
>> high for such a machine.
>>
>
> What are all those queues doing? Are the completely idle or is there a
> trickle of messages flowing in/out/through them?
>
>
>  The problem is following:
>> 1) I connect client A to some queue (with many many messages ready) with
>> some routing key - it processes 150 messages per sec (its limit).
>>
>
> What do you mean by "connect... to some queue... with some routing key"?
> Consuming from a queue does not involve a routing key.
>
>
>  2) I connect another client A in parallel on identical server to same
>> queue with same routing key. Now I have 2 identical consumers on same
>> queue and messages are distributed on round robin
>>      manner, but somehow second unit receives only 50 messages per sec.
>> 3) If I disconnect A1, A2 starts working normally. If I connect A1 back
>> it becomes a slow node.
>>
>
> As Alvaro said, check your basic.qos settings; if they are too low then
> throughput becomes bounded by network latency.
>
> Also, check that there aren't any extraneous AMQP commands being issued by
> your client. e.g. it would be bad if, say, it (re)declared the queue every
> time it receives a message. You may want to connect through the tracer (
> http://www.rabbitmq.com/api-**guide.html#tracer<http://www.rabbitmq.com/api-guide.html#tracer>)
> and examine the command stream.
>
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130114/956cfeaa/attachment.htm>

From matthias at rabbitmq.com  Tue Jan 15 01:56:42 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 15 Jan 2013 01:56:42 +0000
Subject: [rabbitmq-discuss] Performance Issue
In-Reply-To: <CAABB5w9ob5-vkaMUU46UYBBJFwcOKUWAMUf9+vOz5Tr2kra=RQ@mail.gmail.com>
References: <CAABB5w9FiJm_76kLF+CH7YautOM6ugxrGoru4PgM0z0TCnt5fA@mail.gmail.com>
	<50F48A5C.3040100@rabbitmq.com>
	<CAABB5w9ob5-vkaMUU46UYBBJFwcOKUWAMUf9+vOz5Tr2kra=RQ@mail.gmail.com>
Message-ID: <50F4B75A.9010703@rabbitmq.com>

Pavel,

On 15/01/13 00:18, Pavel Kogan wrote:
> 1) Rabbit version: 2.8.4

That's ancient. There have been many bug fixes and other improvements, 
including to performance.

Please upgrade.

>      Erlang version: R14B04

That's ok, though R15B03 would be better.

> 2) The other queues are some idle some working (not very hard - up to
> 30-40 message per second).

Your management screen shot indicated 16815 Erlang processes. Unless 
something weird is going on (which is possible, since you are running 
such an old version of rabbit) that means you must have thousands of 
queues. Is that what you are expecting to see?

> 5) We are declaring queue only once on initialization (we are using JAVA
> client).

I only mentioned that as an example. Basically you'll want to make sure 
that on your consuming channel there is usually nothing but basic.acks 
flowing from the client to the broker.

Regards,

Matthias.

From pavel.kogan at cortica.com  Tue Jan 15 02:45:39 2013
From: pavel.kogan at cortica.com (Pavel Kogan)
Date: Mon, 14 Jan 2013 21:45:39 -0500
Subject: [rabbitmq-discuss] Performance Issue
In-Reply-To: <50F4B75A.9010703@rabbitmq.com>
References: <CAABB5w9FiJm_76kLF+CH7YautOM6ugxrGoru4PgM0z0TCnt5fA@mail.gmail.com>
	<50F48A5C.3040100@rabbitmq.com>
	<CAABB5w9ob5-vkaMUU46UYBBJFwcOKUWAMUf9+vOz5Tr2kra=RQ@mail.gmail.com>
	<50F4B75A.9010703@rabbitmq.com>
Message-ID: <CAABB5w93foXjERRPS9_R6Av7Ed14iPyQnkF3dEZ8K8sEYVeaiA@mail.gmail.com>

Thanks Matthias,

1) How many Erlang processes should normally run? - we have arround 100
queues.
2) What is a good way to upgrade Rabbit seamlessly to production.

Thanks,
   Pavel

On Mon, Jan 14, 2013 at 8:56 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Pavel,
>
> On 15/01/13 00:18, Pavel Kogan wrote:
>
>> 1) Rabbit version: 2.8.4
>>
>
> That's ancient. There have been many bug fixes and other improvements,
> including to performance.
>
> Please upgrade.
>
>       Erlang version: R14B04
>>
>
> That's ok, though R15B03 would be better.
>
>
>  2) The other queues are some idle some working (not very hard - up to
>> 30-40 message per second).
>>
>
> Your management screen shot indicated 16815 Erlang processes. Unless
> something weird is going on (which is possible, since you are running such
> an old version of rabbit) that means you must have thousands of queues. Is
> that what you are expecting to see?
>
>
>  5) We are declaring queue only once on initialization (we are using JAVA
>> client).
>>
>
> I only mentioned that as an example. Basically you'll want to make sure
> that on your consuming channel there is usually nothing but basic.acks
> flowing from the client to the broker.
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130114/aaa03489/attachment.htm>

From matthias at rabbitmq.com  Tue Jan 15 02:58:12 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 15 Jan 2013 02:58:12 +0000
Subject: [rabbitmq-discuss] Performance Issue
In-Reply-To: <CAABB5w93foXjERRPS9_R6Av7Ed14iPyQnkF3dEZ8K8sEYVeaiA@mail.gmail.com>
References: <CAABB5w9FiJm_76kLF+CH7YautOM6ugxrGoru4PgM0z0TCnt5fA@mail.gmail.com>
	<50F48A5C.3040100@rabbitmq.com>
	<CAABB5w9ob5-vkaMUU46UYBBJFwcOKUWAMUf9+vOz5Tr2kra=RQ@mail.gmail.com>
	<50F4B75A.9010703@rabbitmq.com>
	<CAABB5w93foXjERRPS9_R6Av7Ed14iPyQnkF3dEZ8K8sEYVeaiA@mail.gmail.com>
Message-ID: <50F4C5C4.2090906@rabbitmq.com>

Pavel,

On 15/01/13 02:45, Pavel Kogan wrote:
> 1) How many Erlang processes should normally run? - we have arround 100
> queues.

if you only have 100 queues then the 16k+ processes must be something 
other than queues.

You don't appear to have lots of connections, but perhaps some of these 
connections have lots of channels, which are represented by 2-3 
processes each. That's not really a problem per-se, but it's worth 
checking and investigating if that's not what you expect to see.

> 2) What is a good way to upgrade Rabbit seamlessly to production.

Not sure what you are asking here. There are upgrade instructions at the 
bottom of all the RabbitMQ release notes.

Regards,

Matthias.

From pavel.kogan at cortica.com  Tue Jan 15 03:05:43 2013
From: pavel.kogan at cortica.com (Pavel Kogan)
Date: Mon, 14 Jan 2013 22:05:43 -0500
Subject: [rabbitmq-discuss] Performance Issue
In-Reply-To: <50F4C5C4.2090906@rabbitmq.com>
References: <CAABB5w9FiJm_76kLF+CH7YautOM6ugxrGoru4PgM0z0TCnt5fA@mail.gmail.com>
	<50F48A5C.3040100@rabbitmq.com>
	<CAABB5w9ob5-vkaMUU46UYBBJFwcOKUWAMUf9+vOz5Tr2kra=RQ@mail.gmail.com>
	<50F4B75A.9010703@rabbitmq.com>
	<CAABB5w93foXjERRPS9_R6Av7Ed14iPyQnkF3dEZ8K8sEYVeaiA@mail.gmail.com>
	<50F4C5C4.2090906@rabbitmq.com>
Message-ID: <CAABB5w-yruZROkYon3iqZySmZ5BXs9G403MLtNTW9rN9SD9MOA@mail.gmail.com>

Yes, there are instructions, I just want to be sure that when I upgrade the
production would not stop working even for a seconds.
Is it so?

Thanks,
   Pavel

On Mon, Jan 14, 2013 at 9:58 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Pavel,
>
>
> On 15/01/13 02:45, Pavel Kogan wrote:
>
>> 1) How many Erlang processes should normally run? - we have arround 100
>> queues.
>>
>
> if you only have 100 queues then the 16k+ processes must be something
> other than queues.
>
> You don't appear to have lots of connections, but perhaps some of these
> connections have lots of channels, which are represented by 2-3 processes
> each. That's not really a problem per-se, but it's worth checking and
> investigating if that's not what you expect to see.
>
>
>  2) What is a good way to upgrade Rabbit seamlessly to production.
>>
>
> Not sure what you are asking here. There are upgrade instructions at the
> bottom of all the RabbitMQ release notes.
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130114/ac358d1f/attachment.htm>

From matthias at rabbitmq.com  Tue Jan 15 03:07:02 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 15 Jan 2013 03:07:02 +0000
Subject: [rabbitmq-discuss] Performance Issue
In-Reply-To: <CAABB5w-yruZROkYon3iqZySmZ5BXs9G403MLtNTW9rN9SD9MOA@mail.gmail.com>
References: <CAABB5w9FiJm_76kLF+CH7YautOM6ugxrGoru4PgM0z0TCnt5fA@mail.gmail.com>
	<50F48A5C.3040100@rabbitmq.com>
	<CAABB5w9ob5-vkaMUU46UYBBJFwcOKUWAMUf9+vOz5Tr2kra=RQ@mail.gmail.com>
	<50F4B75A.9010703@rabbitmq.com>
	<CAABB5w93foXjERRPS9_R6Av7Ed14iPyQnkF3dEZ8K8sEYVeaiA@mail.gmail.com>
	<50F4C5C4.2090906@rabbitmq.com>
	<CAABB5w-yruZROkYon3iqZySmZ5BXs9G403MLtNTW9rN9SD9MOA@mail.gmail.com>
Message-ID: <50F4C7D6.2050602@rabbitmq.com>

On 15/01/13 03:05, Pavel Kogan wrote:
> Yes, there are instructions, I just want to be sure that when I upgrade
> the production would not stop working even for a seconds.
> Is it so?

Upgrading the broker does entail stopping and starting it.

Matthias.

From 0x6e6562 at gmail.com  Tue Jan 15 09:33:45 2013
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Tue, 15 Jan 2013 09:33:45 +0000
Subject: [rabbitmq-discuss] two factor authentication with tokens
In-Reply-To: <CAE0Sz=ztd-xTR-eyzxFFgfxYXoCoT+UjH2hGgMZZW8Bko=c2+w@mail.gmail.com>
References: <e3be344f-3c2f-4866-8157-38f736ee63c6@googlegroups.com>
	<CAE0Sz=xJzJp5C76SWMXXY7-1mjG4_3+zP2aC3wtvTy2vfs7rdg@mail.gmail.com>
	<BE2DB2BAD46C49BDB96B62901C13D607@gmail.com>
	<50F02967.6080208@rabbitmq.com>
	<A72183C2BA7B40AD9FA3E607B3D765AC@gmail.com>
	<CAE0Sz=ztd-xTR-eyzxFFgfxYXoCoT+UjH2hGgMZZW8Bko=c2+w@mail.gmail.com>
Message-ID: <43B9E94D78F648D5AD89312192B7414C@gmail.com>

In addition to the previous questions, is it possible to configure the auth challenge on the broker side to be vhost specific? For example, clients connecting to vhost 1 should be taken down the aforementioned LDAP + Radius path, but clients connecting to vhost 2 can just be authenticated with a plain LDAP lookup. 

Or does the SASL handshake occur before the client presents the target vhost to the broker - in which case I presume you would have to encapsulate this information into the custom SASL mechanism and evaluate it selectively in the custom auth plugin that wraps Radius and LDAP (as discussed previously)? 


On Friday, 11 January 2013 at 18:02, Jerry Kuch wrote:

> 
> 
> On Fri, Jan 11, 2013 at 9:47 AM, Ben Hood <0x6e6562 at gmail.com (mailto:0x6e6562 at gmail.com)> wrote:
> > 
> > Can this also be made to work in conjunction with an LDAP provider, i.e. by chaining the supported LDAP backend with a custom backend to additionally validate the the token? I wondering whether you can require the client to answer both a username/password challenge (evaluated by the supported LDAP auth backend) as well as having the token checked by the the custom backend? Does the protocol and wiring flow allow for the LDAP backend to get re-used in this way or would you need to implement the custom backend that wraps the lookup against the LDAP directory and the lookup against the Radius server? 
> 
> If I recall correctly, one backend or the other would have to know about the other one and take care of the chaining rather than something like this being possible in the Rabbit configuration.  The backend chosen to go with a given connection is basically the first one in the rabbitmq.config file's list of backends that succeeds as they're tried in order, and is bound irrevocably to that session thereafter. 
> 
> Pursuing this outcome you might be able to call into specific parts of the LDAP backend as helpers, but a good hunk of your hybrid auth logic would be in your plugin itself.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130115/5cd01f49/attachment.htm>

From 0x6e6562 at gmail.com  Tue Jan 15 10:31:27 2013
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Tue, 15 Jan 2013 10:31:27 +0000
Subject: [rabbitmq-discuss] two factor authentication with tokens
In-Reply-To: <43B9E94D78F648D5AD89312192B7414C@gmail.com>
References: <e3be344f-3c2f-4866-8157-38f736ee63c6@googlegroups.com>
	<CAE0Sz=xJzJp5C76SWMXXY7-1mjG4_3+zP2aC3wtvTy2vfs7rdg@mail.gmail.com>
	<BE2DB2BAD46C49BDB96B62901C13D607@gmail.com>
	<50F02967.6080208@rabbitmq.com>
	<A72183C2BA7B40AD9FA3E607B3D765AC@gmail.com>
	<CAE0Sz=ztd-xTR-eyzxFFgfxYXoCoT+UjH2hGgMZZW8Bko=c2+w@mail.gmail.com>
	<43B9E94D78F648D5AD89312192B7414C@gmail.com>
Message-ID: <F7BDE79D91E94E498C3C29F088B09A13@gmail.com>

Thinking about this a little further, what I am proposing with encoding a vhost based challenge in the SASL mechanism would then make the subsequent vhost authorization liable to be hi-jacked by a client that declares itself in the SASL challenge to want to access the low security (non-2FA vhost) and only supply 1FA, but then in the ConnectionOpen frame it could freely request to access the 2FA vhost. 

So maybe this conditional execution is not so cool from a security perspective, unless you somehow patch the whole handshake to prevent the vhost from being forged. 


On Tuesday, 15 January 2013 at 09:33, Ben Hood wrote:

> In addition to the previous questions, is it possible to configure the auth challenge on the broker side to be vhost specific? For example, clients connecting to vhost 1 should be taken down the aforementioned LDAP + Radius path, but clients connecting to vhost 2 can just be authenticated with a plain LDAP lookup. 
> 
> Or does the SASL handshake occur before the client presents the target vhost to the broker - in which case I presume you would have to encapsulate this information into the custom SASL mechanism and evaluate it selectively in the custom auth plugin that wraps Radius and LDAP (as discussed previously)? 
> 
> On Friday, 11 January 2013 at 18:02, Jerry Kuch wrote:
> 
> > 
> > 
> > On Fri, Jan 11, 2013 at 9:47 AM, Ben Hood <0x6e6562 at gmail.com (mailto:0x6e6562 at gmail.com)> wrote:
> > > 
> > > Can this also be made to work in conjunction with an LDAP provider, i.e. by chaining the supported LDAP backend with a custom backend to additionally validate the the token? I wondering whether you can require the client to answer both a username/password challenge (evaluated by the supported LDAP auth backend) as well as having the token checked by the the custom backend? Does the protocol and wiring flow allow for the LDAP backend to get re-used in this way or would you need to implement the custom backend that wraps the lookup against the LDAP directory and the lookup against the Radius server? 
> > 
> > If I recall correctly, one backend or the other would have to know about the other one and take care of the chaining rather than something like this being possible in the Rabbit configuration.  The backend chosen to go with a given connection is basically the first one in the rabbitmq.config file's list of backends that succeeds as they're tried in order, and is bound irrevocably to that session thereafter. 
> > 
> > Pursuing this outcome you might be able to call into specific parts of the LDAP backend as helpers, but a good hunk of your hybrid auth logic would be in your plugin itself.
> > 
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > 
> > 
> > 
> 
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130115/d292c576/attachment.htm>

From simon at rabbitmq.com  Tue Jan 15 10:53:15 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 15 Jan 2013 10:53:15 +0000
Subject: [rabbitmq-discuss] Message routing
In-Reply-To: <AC1CECBE58B36646AE85DD6BEB7AFFF110843E@xmb-aln-x14.cisco.com>
References: <AC1CECBE58B36646AE85DD6BEB7AFFF110843E@xmb-aln-x14.cisco.com>
Message-ID: <50F5351B.7020403@rabbitmq.com>

On 14/01/13 16:36, Sudhakar Chokkalingam (schokkal) wrote:
> Could please help me, how we can do this round-robin distribution in
> queue level.

Michael has already pointed out the existence of the consistent hash 
exchange. But there's another question: what are you trying to achieve? 
Why is having one queue and many consumers not an option? - it sounds 
like it's what you want...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From cheryl.protas at physio-control.com  Tue Jan 15 17:05:47 2013
From: cheryl.protas at physio-control.com (Protas, Cheryl)
Date: Tue, 15 Jan 2013 17:05:47 +0000
Subject: [rabbitmq-discuss] unsubscribe
Message-ID: <52C393117E8FFA4E8D3C96CDFE8E02B601D15B9A@redm1exch02.corp.physio-control.com>




________________________________
[CONFIDENTIALITY AND PRIVACY NOTICE]

Information transmitted by this email is proprietary to Physio-Control and is intended for use only by the individual or entity to which it is addressed, and may contain information that is private, privileged, confidential or exempt from disclosure under applicable law. If you are not the intended recipient or it appears that this mail has been forwarded to you without proper authority, you are notified that any use or dissemination of this information in any manner is strictly prohibited. In such cases, please delete this mail from your records.

To view this notice in other languages you can either select the following link or manually copy and paste the link into the address bar of a web browser: http://www.physio-control.com/emaildisclaimer/

________________________________
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130115/82f17c35/attachment.htm>

From j_depp_99 at yahoo.com  Tue Jan 15 17:46:35 2013
From: j_depp_99 at yahoo.com (jdepp)
Date: Tue, 15 Jan 2013 09:46:35 -0800 (PST)
Subject: [rabbitmq-discuss] connecting to an exchange and queues
Message-ID: <1358271995258-24460.post@n5.nabble.com>

what happens to a message that has an incorrect or unknown routing key for a
specific exchange. Does it get added to any queue?

I have setup 2 exchanges with 100 queues and each queue assigned a routing
key and the consumer is assigned that key.

chan.BasicPublish("F_EXCHANGE", rkey, props, msgBodyBytes)



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/connecting-to-an-exchange-and-queues-tp24460.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From simon at rabbitmq.com  Tue Jan 15 17:50:06 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 15 Jan 2013 17:50:06 +0000
Subject: [rabbitmq-discuss] connecting to an exchange and queues
In-Reply-To: <1358271995258-24460.post@n5.nabble.com>
References: <1358271995258-24460.post@n5.nabble.com>
Message-ID: <50F596CE.2050902@rabbitmq.com>

On 15/01/13 17:46, jdepp wrote:
> what happens to a message that has an incorrect or unknown routing key for a
> specific exchange. Does it get added to any queue?

Not by default.

If you want to detect this you can either:

1) Declare an alternate exchange for the specific exchange 
(http://www.rabbitmq.com/ae.html)

2) Have your clients publish with mandatory=true, and then check for 
basic.return messages coming back to indicate that messages could not be 
routed.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From j_depp_99 at yahoo.com  Tue Jan 15 18:32:31 2013
From: j_depp_99 at yahoo.com (jdepp)
Date: Tue, 15 Jan 2013 10:32:31 -0800 (PST)
Subject: [rabbitmq-discuss] connecting to an exchange and queues
In-Reply-To: <50F596CE.2050902@rabbitmq.com>
References: <1358271995258-24460.post@n5.nabble.com>
	<50F596CE.2050902@rabbitmq.com>
Message-ID: <1358274751430-24462.post@n5.nabble.com>

thanks for your response; on a related note:

is it possible to have a consumer connect to the server and consume messages
from an exchange without it knowing the names of the queues and if so how?
Does it need the routing keys?



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/connecting-to-an-exchange-and-queues-tp24460p24462.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From j_depp_99 at yahoo.com  Tue Jan 15 19:06:15 2013
From: j_depp_99 at yahoo.com (jdepp)
Date: Tue, 15 Jan 2013 11:06:15 -0800 (PST)
Subject: [rabbitmq-discuss] message added time - queue
Message-ID: <1358276775366-24463.post@n5.nabble.com>

Is there anyway a consumer can find the time a message was added to the queue
as you would do in MSQMQ.


          getDate = message.ArrivedTime



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/message-added-time-queue-tp24463.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From michael.s.klishin at gmail.com  Tue Jan 15 20:16:57 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 15 Jan 2013 20:16:57 +0000
Subject: [rabbitmq-discuss] connecting to an exchange and queues
In-Reply-To: <1358274751430-24462.post@n5.nabble.com>
References: <1358271995258-24460.post@n5.nabble.com>
	<50F596CE.2050902@rabbitmq.com>
	<1358274751430-24462.post@n5.nabble.com>
Message-ID: <CAE3HoVR4GTpTEqiaXWxpvK+8CwNmQuAEchn0RFkd8CdjUJtXUg@mail.gmail.com>

2013/1/15 jdepp <j_depp_99 at yahoo.com>

> is it possible to have a consumer connect to the server and consume
> messages
> from an exchange without it knowing the names of the queues and if so how?
> Does it need the routing keys?
>

Messages are consumed from queues and published to exchanges.
Consumers need to know queue names but need not to know where messages
were published and how they were routed.

More on the concepts:
http://www.rabbitmq.com/tutorials/amqp-concepts.html
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130115/4e7f4f1e/attachment.htm>

From michael.s.klishin at gmail.com  Tue Jan 15 20:21:04 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 15 Jan 2013 20:21:04 +0000
Subject: [rabbitmq-discuss] message added time - queue
In-Reply-To: <1358276775366-24463.post@n5.nabble.com>
References: <1358276775366-24463.post@n5.nabble.com>
Message-ID: <CAE3HoVTLntDE99E8K0BDPqPg72LR7zeCg9Nr7bt0OXB9B7TXNQ@mail.gmail.com>

2013/1/15 jdepp <j_depp_99 at yahoo.com>

> Is there anyway a consumer can find the time a message was added to the
> queue
> as you would do in MSQMQ.
>

Messages have an [optional] property for that, timestamp. If your
publishers set it,
then consumers can inspect it. RabbitMQ itself does not timestamp messages.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130115/d5e4dd79/attachment.htm>

From pavel.kogan at cortica.com  Tue Jan 15 21:17:11 2013
From: pavel.kogan at cortica.com (Pavel Kogan)
Date: Tue, 15 Jan 2013 16:17:11 -0500
Subject: [rabbitmq-discuss] Performance Issue
In-Reply-To: <50F4C7D6.2050602@rabbitmq.com>
References: <CAABB5w9FiJm_76kLF+CH7YautOM6ugxrGoru4PgM0z0TCnt5fA@mail.gmail.com>
	<50F48A5C.3040100@rabbitmq.com>
	<CAABB5w9ob5-vkaMUU46UYBBJFwcOKUWAMUf9+vOz5Tr2kra=RQ@mail.gmail.com>
	<50F4B75A.9010703@rabbitmq.com>
	<CAABB5w93foXjERRPS9_R6Av7Ed14iPyQnkF3dEZ8K8sEYVeaiA@mail.gmail.com>
	<50F4C5C4.2090906@rabbitmq.com>
	<CAABB5w-yruZROkYon3iqZySmZ5BXs9G403MLtNTW9rN9SD9MOA@mail.gmail.com>
	<50F4C7D6.2050602@rabbitmq.com>
Message-ID: <CAABB5w88hKqMXT6wt6q-pdb+UhtCfZUPopY4xWvfj=EuvkVizg@mail.gmail.com>

Hi Matthias,

I installed new clean RabbitMq server (RabbitMQ 3.0.1, Erlang R14B04) to
isolate the problem.
It have only one queue and two consumers of same queue. The consumers do
nothing - only sleep 1 second in 100 threads generated by pool,
as if it was unit working at 100/s rate.
The problem remained - so it is probably client issue, or most possible our
usage issue.

Can you please guide me where to look for the problem?

Many thanks,
   Pavel


Queued messages (?)
Ready*0*
Unacknowledged*32147*-79 msg/s
Total*32147*-79 msg/s
Message rates (?)
Publish*49*msg/s
Deliver*49*msg/s
Redelivered*0.00*msg/s
Acknowledge*124*msg/s
Global counts (?)
Connections: *3*
Channels: *3*
Exchanges: *9*
Queues: *1*
Consumers: *2*
Nodes
NameFile descriptors (?)Socket descriptors (?)Erlang processesMemoryDisk
spaceUptimeTyperabbit at ne-r037-350cl<http://iweb87.iweb.cortica.com:15672/#/nodes/rabbit%40ne-r037-350cl>
24
1024 available
4
829 available
225
1048576 available
104.5MB
3.0GB high watermark
864.9GB
953.7MB low watermark
56m 33sDisc Stats *

Messages
Ready*0*
Unacknowledged*25893*-73 msg/s
Total*25893*-73 msg/s
DetailsParametersdurable:truePolicyExclusive ownerNoneStatusActiveConsumers2
active (?)
2 totalMemory71.5MB
Message rates
IncomingExchangepublishconfirmcortica<http://iweb87.iweb.cortica.com:15672/#/exchanges/%2F/cortica>
47/sTotal:47/sDeliveriesChanneldeliver / getack10.4.117.105:49571
(1)<http://iweb87.iweb.cortica.com:15672/#/channels/10.4.117.105%3A49571%20-%3E%2010.4.117.189%3A5672%20(1)>
24/s24/s10.4.117.106:61409
(1)<http://iweb87.iweb.cortica.com:15672/#/channels/10.4.117.106%3A61409%20-%3E%2010.4.117.189%3A5672%20(1)>
26/s100/sTotal:50/s124/s
Consumers
ChannelConsumer tagAck requiredExclusive10.4.117.106:61409
(1)<http://iweb87.iweb.cortica.com:15672/#/channels/10.4.117.106%3A61409%20-%3E%2010.4.117.189%3A5672%20(1)>
amq.ctag-DFKbB5hhaIx1d1EsO3yx8A??10.4.117.105:49571
(1)<http://iweb87.iweb.cortica.com:15672/#/channels/10.4.117.105%3A49571%20-%3E%2010.4.117.189%3A5672%20(1)>
amq.ctag-POpA3pUubhjyHQD_m86lrg??




On Mon, Jan 14, 2013 at 10:07 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> On 15/01/13 03:05, Pavel Kogan wrote:
>
>> Yes, there are instructions, I just want to be sure that when I upgrade
>> the production would not stop working even for a seconds.
>> Is it so?
>>
>
> Upgrading the broker does entail stopping and starting it.
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130115/73145e13/attachment.htm>

From matthias at rabbitmq.com  Tue Jan 15 21:51:40 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 15 Jan 2013 21:51:40 +0000
Subject: [rabbitmq-discuss] Performance Issue
In-Reply-To: <CAABB5w88hKqMXT6wt6q-pdb+UhtCfZUPopY4xWvfj=EuvkVizg@mail.gmail.com>
References: <CAABB5w9FiJm_76kLF+CH7YautOM6ugxrGoru4PgM0z0TCnt5fA@mail.gmail.com>
	<50F48A5C.3040100@rabbitmq.com>
	<CAABB5w9ob5-vkaMUU46UYBBJFwcOKUWAMUf9+vOz5Tr2kra=RQ@mail.gmail.com>
	<50F4B75A.9010703@rabbitmq.com>
	<CAABB5w93foXjERRPS9_R6Av7Ed14iPyQnkF3dEZ8K8sEYVeaiA@mail.gmail.com>
	<50F4C5C4.2090906@rabbitmq.com>
	<CAABB5w-yruZROkYon3iqZySmZ5BXs9G403MLtNTW9rN9SD9MOA@mail.gmail.com>
	<50F4C7D6.2050602@rabbitmq.com>
	<CAABB5w88hKqMXT6wt6q-pdb+UhtCfZUPopY4xWvfj=EuvkVizg@mail.gmail.com>
Message-ID: <50F5CF6C.2080705@rabbitmq.com>

Pavel,

On 15/01/13 21:17, Pavel Kogan wrote:
> It have only one queue and two consumers of same queue. The consumers do
> nothing - only sleep 1 second in 100 threads generated by pool,
> as if it was unit working at 100/s rate.

So that would give you a maximum rate of 200Hz, which is not that far 
off the rate you are seeing in the management UI. The difference will be 
accounted for by network latency, *especially* if you are using 
basic.qos with a low prefetch count.

Regards,

Matthias.

From pavel.kogan at cortica.com  Tue Jan 15 21:56:09 2013
From: pavel.kogan at cortica.com (Pavel Kogan)
Date: Tue, 15 Jan 2013 16:56:09 -0500
Subject: [rabbitmq-discuss] Performance Issue
In-Reply-To: <50F5CF6C.2080705@rabbitmq.com>
References: <CAABB5w9FiJm_76kLF+CH7YautOM6ugxrGoru4PgM0z0TCnt5fA@mail.gmail.com>
	<50F48A5C.3040100@rabbitmq.com>
	<CAABB5w9ob5-vkaMUU46UYBBJFwcOKUWAMUf9+vOz5Tr2kra=RQ@mail.gmail.com>
	<50F4B75A.9010703@rabbitmq.com>
	<CAABB5w93foXjERRPS9_R6Av7Ed14iPyQnkF3dEZ8K8sEYVeaiA@mail.gmail.com>
	<50F4C5C4.2090906@rabbitmq.com>
	<CAABB5w-yruZROkYon3iqZySmZ5BXs9G403MLtNTW9rN9SD9MOA@mail.gmail.com>
	<50F4C7D6.2050602@rabbitmq.com>
	<CAABB5w88hKqMXT6wt6q-pdb+UhtCfZUPopY4xWvfj=EuvkVizg@mail.gmail.com>
	<50F5CF6C.2080705@rabbitmq.com>
Message-ID: <CAABB5w9BWGQu9Ck2rsXc=WxPp5oeai5n-+-5hxSSQNT2fb0C7w@mail.gmail.com>

I am playing now with basic.qos setting but I am not seeing 200Hz.
I see 124Hz which is distributed 100 + 24 and not 62 + 62.

Look again:
Channeldeliver / getack10.4.117.105:49571
(1)<http://iweb87.iweb.cortica.com:15672/#/channels/10.4.117.105%3A49571%20-%3E%2010.4.117.189%3A5672%20(1)>
24/s24/s10.4.117.106:61409
(1)<http://iweb87.iweb.cortica.com:15672/#/channels/10.4.117.106%3A61409%20-%3E%2010.4.117.189%3A5672%20(1)>
26/s100/sTotal:50/s124/s
What is recommended value for prefetch_count for maximal throughput?

Thanks,
  Pavle


Thanks,
  Pavel



On Tue, Jan 15, 2013 at 4:51 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Pavel,
>
>
> On 15/01/13 21:17, Pavel Kogan wrote:
>
>> It have only one queue and two consumers of same queue. The consumers do
>> nothing - only sleep 1 second in 100 threads generated by pool,
>> as if it was unit working at 100/s rate.
>>
>
> So that would give you a maximum rate of 200Hz, which is not that far off
> the rate you are seeing in the management UI. The difference will be
> accounted for by network latency, *especially* if you are using basic.qos
> with a low prefetch count.
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130115/7645c140/attachment.htm>

From matthias at rabbitmq.com  Tue Jan 15 22:14:02 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 15 Jan 2013 22:14:02 +0000
Subject: [rabbitmq-discuss] Performance Issue
In-Reply-To: <CAABB5w9BWGQu9Ck2rsXc=WxPp5oeai5n-+-5hxSSQNT2fb0C7w@mail.gmail.com>
References: <CAABB5w9FiJm_76kLF+CH7YautOM6ugxrGoru4PgM0z0TCnt5fA@mail.gmail.com>
	<50F48A5C.3040100@rabbitmq.com>
	<CAABB5w9ob5-vkaMUU46UYBBJFwcOKUWAMUf9+vOz5Tr2kra=RQ@mail.gmail.com>
	<50F4B75A.9010703@rabbitmq.com>
	<CAABB5w93foXjERRPS9_R6Av7Ed14iPyQnkF3dEZ8K8sEYVeaiA@mail.gmail.com>
	<50F4C5C4.2090906@rabbitmq.com>
	<CAABB5w-yruZROkYon3iqZySmZ5BXs9G403MLtNTW9rN9SD9MOA@mail.gmail.com>
	<50F4C7D6.2050602@rabbitmq.com>
	<CAABB5w88hKqMXT6wt6q-pdb+UhtCfZUPopY4xWvfj=EuvkVizg@mail.gmail.com>
	<50F5CF6C.2080705@rabbitmq.com>
	<CAABB5w9BWGQu9Ck2rsXc=WxPp5oeai5n-+-5hxSSQNT2fb0C7w@mail.gmail.com>
Message-ID: <50F5D4AA.3060007@rabbitmq.com>

Pavel,

On 15/01/13 21:56, Pavel Kogan wrote:
> I am playing now with basic.qos setting but I am not seeing 200Hz. I
> see 124Hz which is distributed 100 + 24 and not 62 + 62.

No idea why that would happen. Could be a quirk of the stats reporting 
since evidently you are receiving more acks than messages, which cannot 
possibly be true for anything other than brief periods.

> What is recommended value for prefetch_count for maximal throughput?

As high as possible, though I doubt anything much higher than 100 will 
be beneficial in your case.

The downsides of high prefetch counts are:

- increase in client buffering requirements

- work load imbalance at consumers when work loads are non-uniform

- increased cost at broker when consumer connections are interrupted

Regards,

Matthias.

From pavel.kogan at cortica.com  Tue Jan 15 22:20:38 2013
From: pavel.kogan at cortica.com (Pavel Kogan)
Date: Tue, 15 Jan 2013 17:20:38 -0500
Subject: [rabbitmq-discuss] Performance Issue
In-Reply-To: <50F5D4AA.3060007@rabbitmq.com>
References: <CAABB5w9FiJm_76kLF+CH7YautOM6ugxrGoru4PgM0z0TCnt5fA@mail.gmail.com>
	<50F48A5C.3040100@rabbitmq.com>
	<CAABB5w9ob5-vkaMUU46UYBBJFwcOKUWAMUf9+vOz5Tr2kra=RQ@mail.gmail.com>
	<50F4B75A.9010703@rabbitmq.com>
	<CAABB5w93foXjERRPS9_R6Av7Ed14iPyQnkF3dEZ8K8sEYVeaiA@mail.gmail.com>
	<50F4C5C4.2090906@rabbitmq.com>
	<CAABB5w-yruZROkYon3iqZySmZ5BXs9G403MLtNTW9rN9SD9MOA@mail.gmail.com>
	<50F4C7D6.2050602@rabbitmq.com>
	<CAABB5w88hKqMXT6wt6q-pdb+UhtCfZUPopY4xWvfj=EuvkVizg@mail.gmail.com>
	<50F5CF6C.2080705@rabbitmq.com>
	<CAABB5w9BWGQu9Ck2rsXc=WxPp5oeai5n-+-5hxSSQNT2fb0C7w@mail.gmail.com>
	<50F5D4AA.3060007@rabbitmq.com>
Message-ID: <CAABB5w8oM3uovQPKk=fqQ4ZyxQYc7Pkc2c72hPi32_cWkSGSDw@mail.gmail.com>

And what is default prefetch_count? 0(unlimited) or 1? I believe it depends
on client but cant find function that return its value.

Thanks,
   Pavel

On Tue, Jan 15, 2013 at 5:14 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Pavel,
>
>
> On 15/01/13 21:56, Pavel Kogan wrote:
>
>> I am playing now with basic.qos setting but I am not seeing 200Hz. I
>> see 124Hz which is distributed 100 + 24 and not 62 + 62.
>>
>
> No idea why that would happen. Could be a quirk of the stats reporting
> since evidently you are receiving more acks than messages, which cannot
> possibly be true for anything other than brief periods.
>
>
>  What is recommended value for prefetch_count for maximal throughput?
>>
>
> As high as possible, though I doubt anything much higher than 100 will be
> beneficial in your case.
>
> The downsides of high prefetch counts are:
>
> - increase in client buffering requirements
>
> - work load imbalance at consumers when work loads are non-uniform
>
> - increased cost at broker when consumer connections are interrupted
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130115/5cad730d/attachment.htm>

From matthias at rabbitmq.com  Tue Jan 15 22:23:14 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 15 Jan 2013 22:23:14 +0000
Subject: [rabbitmq-discuss] Performance Issue
In-Reply-To: <CAABB5w8oM3uovQPKk=fqQ4ZyxQYc7Pkc2c72hPi32_cWkSGSDw@mail.gmail.com>
References: <CAABB5w9FiJm_76kLF+CH7YautOM6ugxrGoru4PgM0z0TCnt5fA@mail.gmail.com>
	<50F48A5C.3040100@rabbitmq.com>
	<CAABB5w9ob5-vkaMUU46UYBBJFwcOKUWAMUf9+vOz5Tr2kra=RQ@mail.gmail.com>
	<50F4B75A.9010703@rabbitmq.com>
	<CAABB5w93foXjERRPS9_R6Av7Ed14iPyQnkF3dEZ8K8sEYVeaiA@mail.gmail.com>
	<50F4C5C4.2090906@rabbitmq.com>
	<CAABB5w-yruZROkYon3iqZySmZ5BXs9G403MLtNTW9rN9SD9MOA@mail.gmail.com>
	<50F4C7D6.2050602@rabbitmq.com>
	<CAABB5w88hKqMXT6wt6q-pdb+UhtCfZUPopY4xWvfj=EuvkVizg@mail.gmail.com>
	<50F5CF6C.2080705@rabbitmq.com>
	<CAABB5w9BWGQu9Ck2rsXc=WxPp5oeai5n-+-5hxSSQNT2fb0C7w@mail.gmail.com>
	<50F5D4AA.3060007@rabbitmq.com>
	<CAABB5w8oM3uovQPKk=fqQ4ZyxQYc7Pkc2c72hPi32_cWkSGSDw@mail.gmail.com>
Message-ID: <50F5D6D2.3010808@rabbitmq.com>

Pavel,

On 15/01/13 22:20, Pavel Kogan wrote:
> And what is default prefetch_count? 0(unlimited) or 1? I believe it
> depends on client but cant find function that return its value.

The default, i.e. if the client does not issue a basic.qos, is 0(unlimited).

Btw, since all your 100 consumer threads share a single AMQP consume 
(and hence channel), you'll want a prefetch count of *at least* 100, 
otherwise some of the threads will be idle.

Matthias.

From pavel.kogan at cortica.com  Tue Jan 15 22:25:06 2013
From: pavel.kogan at cortica.com (Pavel Kogan)
Date: Tue, 15 Jan 2013 17:25:06 -0500
Subject: [rabbitmq-discuss] Performance Issue
In-Reply-To: <50F5D6D2.3010808@rabbitmq.com>
References: <CAABB5w9FiJm_76kLF+CH7YautOM6ugxrGoru4PgM0z0TCnt5fA@mail.gmail.com>
	<50F48A5C.3040100@rabbitmq.com>
	<CAABB5w9ob5-vkaMUU46UYBBJFwcOKUWAMUf9+vOz5Tr2kra=RQ@mail.gmail.com>
	<50F4B75A.9010703@rabbitmq.com>
	<CAABB5w93foXjERRPS9_R6Av7Ed14iPyQnkF3dEZ8K8sEYVeaiA@mail.gmail.com>
	<50F4C5C4.2090906@rabbitmq.com>
	<CAABB5w-yruZROkYon3iqZySmZ5BXs9G403MLtNTW9rN9SD9MOA@mail.gmail.com>
	<50F4C7D6.2050602@rabbitmq.com>
	<CAABB5w88hKqMXT6wt6q-pdb+UhtCfZUPopY4xWvfj=EuvkVizg@mail.gmail.com>
	<50F5CF6C.2080705@rabbitmq.com>
	<CAABB5w9BWGQu9Ck2rsXc=WxPp5oeai5n-+-5hxSSQNT2fb0C7w@mail.gmail.com>
	<50F5D4AA.3060007@rabbitmq.com>
	<CAABB5w8oM3uovQPKk=fqQ4ZyxQYc7Pkc2c72hPi32_cWkSGSDw@mail.gmail.com>
	<50F5D6D2.3010808@rabbitmq.com>
Message-ID: <CAABB5w95Hi7kSe0dfd8F+T6vx326KNLR6eNcg0ZaUqNtzVZfag@mail.gmail.com>

I will try,
   Thanks.

On Tue, Jan 15, 2013 at 5:23 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Pavel,
>
>
> On 15/01/13 22:20, Pavel Kogan wrote:
>
>> And what is default prefetch_count? 0(unlimited) or 1? I believe it
>> depends on client but cant find function that return its value.
>>
>
> The default, i.e. if the client does not issue a basic.qos, is
> 0(unlimited).
>
> Btw, since all your 100 consumer threads share a single AMQP consume (and
> hence channel), you'll want a prefetch count of *at least* 100, otherwise
> some of the threads will be idle.
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130115/3839351d/attachment.htm>

From pavel.kogan at cortica.com  Tue Jan 15 23:00:43 2013
From: pavel.kogan at cortica.com (Pavel Kogan)
Date: Tue, 15 Jan 2013 18:00:43 -0500
Subject: [rabbitmq-discuss] Performance Issue
In-Reply-To: <CAABB5w95Hi7kSe0dfd8F+T6vx326KNLR6eNcg0ZaUqNtzVZfag@mail.gmail.com>
References: <CAABB5w9FiJm_76kLF+CH7YautOM6ugxrGoru4PgM0z0TCnt5fA@mail.gmail.com>
	<50F48A5C.3040100@rabbitmq.com>
	<CAABB5w9ob5-vkaMUU46UYBBJFwcOKUWAMUf9+vOz5Tr2kra=RQ@mail.gmail.com>
	<50F4B75A.9010703@rabbitmq.com>
	<CAABB5w93foXjERRPS9_R6Av7Ed14iPyQnkF3dEZ8K8sEYVeaiA@mail.gmail.com>
	<50F4C5C4.2090906@rabbitmq.com>
	<CAABB5w-yruZROkYon3iqZySmZ5BXs9G403MLtNTW9rN9SD9MOA@mail.gmail.com>
	<50F4C7D6.2050602@rabbitmq.com>
	<CAABB5w88hKqMXT6wt6q-pdb+UhtCfZUPopY4xWvfj=EuvkVizg@mail.gmail.com>
	<50F5CF6C.2080705@rabbitmq.com>
	<CAABB5w9BWGQu9Ck2rsXc=WxPp5oeai5n-+-5hxSSQNT2fb0C7w@mail.gmail.com>
	<50F5D4AA.3060007@rabbitmq.com>
	<CAABB5w8oM3uovQPKk=fqQ4ZyxQYc7Pkc2c72hPi32_cWkSGSDw@mail.gmail.com>
	<50F5D6D2.3010808@rabbitmq.com>
	<CAABB5w95Hi7kSe0dfd8F+T6vx326KNLR6eNcg0ZaUqNtzVZfag@mail.gmail.com>
Message-ID: <CAABB5w8z0XsK_F5S9umYuw79THJ0NOuVHO99gOQH=qEMquM=DA@mail.gmail.com>

Isn't the unlimited prefetch count should be the best for throughput?

Thanks,
   Pavel

On Tue, Jan 15, 2013 at 5:25 PM, Pavel Kogan <pavel.kogan at cortica.com>wrote:

> I will try,
>    Thanks.
>
>
> On Tue, Jan 15, 2013 at 5:23 PM, Matthias Radestock <matthias at rabbitmq.com
> > wrote:
>
>> Pavel,
>>
>>
>> On 15/01/13 22:20, Pavel Kogan wrote:
>>
>>> And what is default prefetch_count? 0(unlimited) or 1? I believe it
>>> depends on client but cant find function that return its value.
>>>
>>
>> The default, i.e. if the client does not issue a basic.qos, is
>> 0(unlimited).
>>
>> Btw, since all your 100 consumer threads share a single AMQP consume (and
>> hence channel), you'll want a prefetch count of *at least* 100, otherwise
>> some of the threads will be idle.
>>
>> Matthias.
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130115/a117c015/attachment.htm>

From matthias at rabbitmq.com  Tue Jan 15 23:03:28 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 15 Jan 2013 23:03:28 +0000
Subject: [rabbitmq-discuss] Performance Issue
In-Reply-To: <CAABB5w8z0XsK_F5S9umYuw79THJ0NOuVHO99gOQH=qEMquM=DA@mail.gmail.com>
References: <CAABB5w9FiJm_76kLF+CH7YautOM6ugxrGoru4PgM0z0TCnt5fA@mail.gmail.com>
	<50F48A5C.3040100@rabbitmq.com>
	<CAABB5w9ob5-vkaMUU46UYBBJFwcOKUWAMUf9+vOz5Tr2kra=RQ@mail.gmail.com>
	<50F4B75A.9010703@rabbitmq.com>
	<CAABB5w93foXjERRPS9_R6Av7Ed14iPyQnkF3dEZ8K8sEYVeaiA@mail.gmail.com>
	<50F4C5C4.2090906@rabbitmq.com>
	<CAABB5w-yruZROkYon3iqZySmZ5BXs9G403MLtNTW9rN9SD9MOA@mail.gmail.com>
	<50F4C7D6.2050602@rabbitmq.com>
	<CAABB5w88hKqMXT6wt6q-pdb+UhtCfZUPopY4xWvfj=EuvkVizg@mail.gmail.com>
	<50F5CF6C.2080705@rabbitmq.com>
	<CAABB5w9BWGQu9Ck2rsXc=WxPp5oeai5n-+-5hxSSQNT2fb0C7w@mail.gmail.com>
	<50F5D4AA.3060007@rabbitmq.com>
	<CAABB5w8oM3uovQPKk=fqQ4ZyxQYc7Pkc2c72hPi32_cWkSGSDw@mail.gmail.com>
	<50F5D6D2.3010808@rabbitmq.com>
	<CAABB5w95Hi7kSe0dfd8F+T6vx326KNLR6eNcg0ZaUqNtzVZfag@mail.gmail.com>
	<CAABB5w8z0XsK_F5S9umYuw79THJ0NOuVHO99gOQH=qEMquM=DA@mail.gmail.com>
Message-ID: <50F5E040.60007@rabbitmq.com>

Pavel,

On 15/01/13 23:00, Pavel Kogan wrote:
> Isn't the unlimited prefetch count should be the best for throughput?

Not necessarily. See the "downsides of a high prefetch count" list in 
one of my earlier emails.

Regards,

Matthias

From sankalp.acharya at gmail.com  Tue Jan 15 20:55:06 2013
From: sankalp.acharya at gmail.com (Sankalp Acharya)
Date: Tue, 15 Jan 2013 12:55:06 -0800 (PST)
Subject: [rabbitmq-discuss] Rabbitmq 2.5-2.6.1 java hanging on close of
 connection
In-Reply-To: <1e468380-de44-4f31-b2fb-138ad2a4befb@googlegroups.com>
References: <CAGnU7ug+99pP+POgULhXhc4LhAgVdtvjjM5Ge3a7dx_n5gtgZQ@mail.gmail.com>	<D585A544-3AFF-402B-ABA6-0EDE650DC505@rabbitmq.com>	<CAGnU7uianGGj9_L5MMa43u1+CHnvgGjbySqfCO695H=3jJnE+w@mail.gmail.com>	<1AA56A76-6AB5-45B2-ABD1-5FFBE5F3DB39@rabbitmq.com>	<CAGnU7ujONU1YHXbr8b_2XhMet12KMXzY0DBTpZOCKqoAXBjP-Q@mail.gmail.com>	<4EC030E3.1090807@rabbitmq.com>	<CAGnU7uj8PhXp+7JMcJ-XsDrcYNDKno-t5HnGnrwup+F41vCyHw@mail.gmail.com>	<4EC0CCDE.3030505@rabbitmq.com>	<CAGnU7uj3U-CHE-Bo_TcxuPxsGdRLyUcngnx-F9xrP=Q3jR-uuA@mail.gmail.com>	<4EC15EA2.4010507@rabbitmq.com>	<CAGnU7ugZ-QkC7n8n7XxqcV_AVyLDRaVTA6bo2vK+S7=Nki6yjw@mail.gmail.com>	<CAGnU7uiEduM3C3cvd=f3VeBGUEhudSDU9KDRMmUtxcHv-TzMQA@mail.gmail.com>	<4ECA4CFE.5000406@rabbitmq.com>	<CAGnU7uhPjyUWkhWf82Vj-LmxwSijM6kUx9==MEEDx6ykGWw0vA@mail.gmail.com>	<4ED3B167.20307@rabbitmq.com>	<CAGnU7uiTks2iiJ=-EhGUgbMzd5LPoRGmYP9ATa1KHkUPp9Xd3A@mail.gmail.com>
	<CAGnU7uhcW5qfx2UuQxB+2V_7B6a-OADnt4vPAhjWy97M0byVOg@mail.gmail.com>
	<4F577AB1.5090006@rabbitmq.com>
	<1e468380-de44-4f31-b2fb-138ad2a4befb@googlegroups.com>
Message-ID: <53391561-a6fc-4d66-9aee-ef184be772d2@googlegroups.com>


Incidentally, we figured out what the problem is.

It seems that when the watermark checking was added in RabbitMQ 2.8.1, 
there was a feature that was added that basically blocks all currently-open 
connections until the watermark thresholds are cleared. What was happening 
on our build servers is that the test instance of RabbitMQ was just barely 
crossing the disk watermark threshold to where the MQ server started 
blocking connections. This would happen intermittently, depending on which 
side of the watermark the free disk space was at.

It seems that the connection blocking, in turn, *also* blocks close 
requests from being ack'd! This certainly seems like a bug to me ? I'm not 
sure why the server should deny already-connected clients the ability to 
close their connections.

At any rate, I wanted to post to this thread in case anyone else ran into 
this error.

Sankalp Acharya
WhaleShark Media

On Friday, January 11, 2013 3:58:31 PM UTC-6, Sankalp Acharya wrote:
>
>
> Hi,
>
> We are seeing this same exact behavior, but on a newer version of RabbitMQ 
> (2.8.2).
>
> What's strange is that the problem had not been occurring until recently. 
> We are also using Spring AMQP (1.1.3), and we have virtually the same use 
> case (running from unit tests, the test tries to wind down, and on 
> disposing the Spring context, it tries to close the 
> CachingConnectionFactory, upon which we are trying to close the connection 
> to RabbitMQ, etc.)
>
> Is there something else we are missing, that we need to do (either in the 
> configuration of our CachingConnectionFactory, or in the rest of our Spring 
> wireup) in order to not run into this issue?
>
> Regards,
> Sankalp Acharya
> WhaleShark Media
>
> On Wednesday, March 7, 2012 9:11:45 AM UTC-6, Simon MacMullen wrote:
>>
>> On 07/03/12 14:41, Benjamin Bennett wrote:
>> > Just wondering if this has been fixed in the latest releases?
>>
>> Yes, it was fixed in 2.7.1.
>>
>> Cheers, Simon
>>
>> -- 
>> Simon MacMullen
>> RabbitMQ, VMware
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq... at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130115/1352cbae/attachment.htm>

From matthias at rabbitmq.com  Tue Jan 15 23:30:26 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 15 Jan 2013 23:30:26 +0000
Subject: [rabbitmq-discuss] Rabbitmq 2.5-2.6.1 java hanging on close of
 connection
In-Reply-To: <53391561-a6fc-4d66-9aee-ef184be772d2@googlegroups.com>
References: <CAGnU7ug+99pP+POgULhXhc4LhAgVdtvjjM5Ge3a7dx_n5gtgZQ@mail.gmail.com>	<1AA56A76-6AB5-45B2-ABD1-5FFBE5F3DB39@rabbitmq.com>	<CAGnU7ujONU1YHXbr8b_2XhMet12KMXzY0DBTpZOCKqoAXBjP-Q@mail.gmail.com>	<4EC030E3.1090807@rabbitmq.com>	<CAGnU7uj8PhXp+7JMcJ-XsDrcYNDKno-t5HnGnrwup+F41vCyHw@mail.gmail.com>	<4EC0CCDE.3030505@rabbitmq.com>	<CAGnU7uj3U-CHE-Bo_TcxuPxsGdRLyUcngnx-F9xrP=Q3jR-uuA@mail.gmail.com>	<4EC15EA2.4010507@rabbitmq.com>	<CAGnU7ugZ-QkC7n8n7XxqcV_AVyLDRaVTA6bo2vK+S7=Nki6yjw@mail.gmail.com>	<CAGnU7uiEduM3C3cvd=f3VeBGUEhudSDU9KDRMmUtxcHv-TzMQA@mail.gmail.com>	<4ECA4CFE.5000406@rabbitmq.com>	<CAGnU7uhPjyUWkhWf82Vj-LmxwSijM6kUx9==MEEDx6ykGWw0vA@mail.gmail.com>	<4ED3B167.20307@rabbitmq.com>	<CAGnU7uiTks2iiJ=-EhGUgbMzd5LPoRGmYP9ATa1KHkUPp9Xd3A@mail.gmail.com>
	<CAGnU7uhcW5qfx2UuQxB+2V_7B6a-OADnt4vPAhjWy97M0byVOg@mail.gmail.com>
	<4F577AB1.5090006@rabbitmq.com>
	<1e468380-de44-4f31-b2fb-138ad2a4befb@googlegroups.com>
	<53391561-a6fc-4d66-9aee-ef184be772d2@googlegroups.com>
Message-ID: <50F5E692.6080804@rabbitmq.com>

Sankalp,

On 15/01/13 20:55, Sankalp Acharya wrote:
> Incidentally, we figured out what the problem is.

Glad to hear that.

> It seems that the connection blocking, in turn, /also/ blocks close
> requests from being ack'd! This certainly seems like a bug to me ? I'm
> not sure why the server should deny already-connected clients the
> ability to close their connections.

Connection blocking happens at the tcp level since that's the only way 
the broker can make sure it will not be receiving any more messages 
regardless of what the client is doing.

Consequently the AMQP connection.close command will not be received by 
the broker either. There's nothing we can do about that at the broker end.

Clients could have some sort of timeout for these situations, but few 
client libraries support that.

Regards,

Matthias.

From richard at raseley.com  Tue Jan 15 23:29:36 2013
From: richard at raseley.com (Richard Raseley)
Date: Tue, 15 Jan 2013 15:29:36 -0800 (PST)
Subject: [rabbitmq-discuss] Securing Messages Over WAN Link
Message-ID: <22a5201a-39b3-4ce2-8c36-dd82309349c3@googlegroups.com>

I have a desire to send messages via RabbitMQ over a WAN link between data 
centers in different continents. One of the primary concerns that I have is 
for securing the messages while they are in transit. 

I originally was considering offloading the encryption / decryption to our 
commercial load balancers because I was concerned about high processing 
overhead for encryption and decryption on each packet; upon further 
investigation I had to eliminate this as an option because our commercial 
load balancers only allow us to encrypt / decrypt the traffic if it is 
already in the HTTP format (which RabbitMQ's communications obviously are 
not).

Could anyone provide any guidance on what they use for securing traffic 
over the WAN? Is the built in SSL / TLS support in RabbitMQ (as outlined 
here http://www.rabbitmq.com/ssl.html) sufficient for such purposes? Should 
I be concerned about the additional overhead in processing requirements for 
an estimated 10 million+ messages per day?

Any help would be greatly appreciated. Thank you in advance.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130115/86349fca/attachment.htm>

From pjwerneck at gmail.com  Wed Jan 16 00:36:50 2013
From: pjwerneck at gmail.com (Pedro Werneck)
Date: Tue, 15 Jan 2013 16:36:50 -0800 (PST)
Subject: [rabbitmq-discuss] Rate limiting queues
Message-ID: <d1391582-a98d-4073-8804-8cb8014b0878@googlegroups.com>

I'm running RabbitMQ 3.0.1 with celery 3.0.11 for a stack of applications 
based on the Python framework Flask, with a demand for a dozen million 
messages a day.

The problem is, some queues have to be rate limited dynamically during the 
day. We had a lot of problems with rate limiting the workers, using the 
rate_limit provided by celery and other client side solutions, and decided 
to look for some limiting on the deliver rate by the broker itself. I 
searched a lot and couldn't find anything like that, which surprised me, 
nor a reason why something like that isn't implemented. I found a plugin 
that implements throttling between the exchange and the queue, but I'm not 
sure how reliable it is. 
https://github.com/flopezluis/rabbitmq-throttling-exchange

I'm not familiar with Erlang and the RabbitMQ internals, so we adopted an 
ugly hackish solution for now, which is to have an input queue, an output 
queue, and a background process using a token bucket algorithm and amqp to 
get the messages from the input queue and send them back to the exchange 
and the output queue with the given rate. It isn't pretty, but is working 
reliably and we know everything that's going on.

Is there any reliable solution I missed? If not, is there any way to 
improve this solution we adopted?


Thanks for any help


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130115/c571a610/attachment.htm>

From stuff at moesel.net  Wed Jan 16 03:14:50 2013
From: stuff at moesel.net (Chris)
Date: Tue, 15 Jan 2013 22:14:50 -0500
Subject: [rabbitmq-discuss] Implementing User Messaging Using RabbitMQ
Message-ID: <CAHEpgBDUKZnM95zRcqEShd_BDmA=AmoUh+CGR6OUz_baCuVdHQ@mail.gmail.com>

Hello RabbitMQ Gurus,

If you don't mind, I'd love some help trying to arrive at the right design
for a user messaging system I am working on.

High-Level Requirements
=======================
- users can send messages to another user, several users, a group, or
everyone
  - users and groups are managed in a proprietary user management system
- no chat rooms-- each user just has a message feed or "timeline" of
incoming & outgoing messages
- message history must be preserved (in a database)
- if a user is offline, the message should be forwarded to the user's email
- 5000 concurrent users sending a few messages every few minutes (20,000
users total in system).

Environment
===========
The primary interface is a web application (or maybe a few web
applications), but future iterations may introduce standalone clients.
 RabbitMQ is 3.x and likely to be clustered or replicated, and running on
same machine(s) as web application servers.

General Approach
================
In order to store every message in a database (for historical purposes),
all messages are initially sent to a direct exchange with a worker queue.
 Consumers of the worker queue (let's call them messaging service workers)
receive the message and store it to the database.  Then they distribute the
message to the intended recipients (this is the part I think I need most
help with).

Message Distribution Option 1: Direct Exchange w/ Queue Per User
=================================================================
Message is sent to a direct exchange with username as the routing key.  For
every logged in user, the webapp declares a queue and binds with the
username.

Issue 1: How to support groups?  The messaging service worker could resolve
the group to a list of users and post the message multiple times (once for
each user/routing key)-- but this would not scale very well.  Or we could
create individual queues for every group too, but this increases complexity
in the web app (and later in our other clients) since they need to
determine what groups they need to listen for and who to distribute to.

Issue 2: Is 5000 queues a bit much?  Especially when they are all
ultimately going to the same consumer (in the webapp case)?  This isn't the
only use of RabbitMQ, so there will be other queues/exchanges/bindings as
well...

Message Distribution Option 2: Topic Exchange w/ Single Queue per Webapp
========================================================================
Message is sent to topic exchange with routing key containing ALL addressed
users (i.e., "|usera|userb|userc|").  Webapp declares single queue and a
separate binding to the exchange for each user (i.e., "#|usera|#",
"#|userb|#", etc.).  This is similar to Option 1, but with the benefit that
each message only has to be sent once.

Issue 1: Routing key can get huge (20000 names if addressed to "everyone"
group).
Issue 2: It just seems like the wrong use of topic exchange.

Message Distribution Option 3: Fanout Exchange w/ Single Queue per Webapp
=========================================================================
Message is sent to fanout exchange.  Webapp listens on fanout exchange and
simply discards all messages for users that aren't logged in.

Issue 1: Doesn't scale well (or even if it does, there is lots of waste
filtering on the client side).
Issue 2: Not at all secure (although, for now, we won't try to solve
security).

Message Distribution Option 4: Direct Exchange w/ Single Queue per Webapp
========================================================================
Webapp must notify messaging service worker as users log in and out-- and
of the single queue on which it wants messages.  When a message needs to be
distributed, messaging service worker checks to see which users are logged
in where.  It sends message to the queue of each webapp that has logged in
users that the message is addressed to (message itself contains "to:" list
so webapp can send to right user UI).

Issue 1: Messaging Service Worker now has a lot more state and processing
messages is a lot heavier.  Need to make sure it stays in synch with webapp.

Issue 2: Messaging Service Worker is now doing the routing-- which just
seems wrong since that is what RabbitMQ is so good at!

Message Distribution Option 5: Fanout Exchanges for Groups
==========================================================
Same as option 1 (queue per user), but also create a fanout exchange for
every group.  The individual user queues need to be bound to the fanout
exchange corresponding to each group they belong to.

Issue 1: Could result in a lot of exchanges (not sure how many groups there
are).

Issue 2: Still seems like a lot of queues too (5000).

Message Distribution Option 6: Custom Exchange
==============================================
Create our own exchange that allows consumers to bind with usernames.  When
a message is posted to the exchange, it knows how to read the "to:" list
from it, can even resolve groups, and then sends to the correct queues
based on the bindings.

Issue 1: We don't have any Erlang experience.

Issue 2: Resolving groups in an Erlang custom exchange could be tricky (not
sure about the APIs to our User Management).

Something Else
==============
I'm more than open to other ideas too!

BONUS QUESTION
==============
Whatever the correct approach is, how do we determine if a user is
"offline" and we need to forward the message to their email?  If we are
using queue-per-user, then we can set the mandatory flag, I guess?  If we
are using another approach, what then?

Thanks to anyone who can help point me in the right direction (or steer me
away from the wrong direction)...  I'm not familiar enough yet with
RabbitMQ performance characteristics to know what is a bad idea, and not
familiar enough yet with its many features to know what is a good idea...
;-)

Thanks again,
Chris
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130115/4549e186/attachment.htm>

From tim at rabbitmq.com  Wed Jan 16 09:53:22 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 16 Jan 2013 09:53:22 +0000
Subject: [rabbitmq-discuss] Rate limiting queues
In-Reply-To: <d1391582-a98d-4073-8804-8cb8014b0878@googlegroups.com>
References: <d1391582-a98d-4073-8804-8cb8014b0878@googlegroups.com>
Message-ID: <3386E40C-1034-4912-B2D5-D67900C511B9@rabbitmq.com>

Hi

On 16 Jan 2013, at 00:36, Pedro Werneck wrote:

> I'm running RabbitMQ 3.0.1 with celery 3.0.11 for a stack of applications based on the Python framework Flask, with a demand for a dozen million messages a day.
> 
> The problem is, some queues have to be rate limited dynamically during the day. We had a lot of problems with rate limiting the workers, using the rate_limit provided by celery and other client side solutions, and decided to look for some limiting on the deliver rate by the broker itself. I searched a lot and couldn't find anything like that, which surprised me, nor a reason why something like that isn't implemented.

Rabbit *does* rate limiting with regards flow control, so if the broker is struggling (e.g., consumers cannot keep up with producers) then back pressure will be exerted on the producers. There's nothing in place right now to rate limit based on other factors, though it's possible such a feature might be useful. How would you envisage something like that working? 

> I found a plugin that implements throttling between the exchange and the queue, but I'm not sure how reliable it is. https://github.com/flopezluis/rabbitmq-throttling-exchange
> 

I would be cautious about using that. The exchange will be called in the reader process, and I'm pretty certain that performing a blocking receive doesn't make sense there.

> I'm not familiar with Erlang and the RabbitMQ internals, so we adopted an ugly hackish solution for now, which is to have an input queue, an output queue, and a background process using a token bucket algorithm and amqp to get the messages from the input queue and send them back to the exchange and the output queue with the given rate. It isn't pretty, but is working reliably and we know everything that's going on.
> 

That sounds reasonably sensible to me. I assume you've read http://dougbarth.github.com/2011/06/10/keeping-the-rabbit-on-a-leash.html ??

> Is there any reliable solution I missed? If not, is there any way to improve this solution we adopted?
> 

It might be more efficient to run the rate limiting process inside the broker using the direct Erlang client to avoid the overhead of serialising data and transmitting it over the network. That's probably a half-way house to just doing this in the broker though.

The broker does have an effective credit-based flow control mechanism already. It might be possible to add additional 'sensors' to the broker which could be used to trigger changes in available credit and cause the flow control mechanism to kick in, though I'm not sure whether this is something that would be considered desirable. It certainly *sounds* interesting, but I suspect it might fall into the category of 'one too many knobs to twiddle' though. Rabbit has been made deliberately minimal with regards knob twiddling.

The *other* thing you might consider is rate limiting at the network level. Decent commercially available load balancers that handle non HTTP traffic can do this for you, though I've not seen any AMQP-aware offerings and this might impact negatively on performance if you can't configure the traffic manager to handle frame sizes correctly.

Cheers,
T


From emile at rabbitmq.com  Wed Jan 16 10:24:13 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 16 Jan 2013 10:24:13 +0000
Subject: [rabbitmq-discuss] Securing Messages Over WAN Link
In-Reply-To: <22a5201a-39b3-4ce2-8c36-dd82309349c3@googlegroups.com>
References: <22a5201a-39b3-4ce2-8c36-dd82309349c3@googlegroups.com>
Message-ID: <50F67FCD.6070009@rabbitmq.com>

Hi,

On 15/01/13 23:29, Richard Raseley wrote:
> Could anyone provide any guidance on what they use for securing traffic
> over the WAN? Is the built in SSL / TLS support in RabbitMQ (as outlined
> here http://www.rabbitmq.com/ssl.html) sufficient for such purposes?
> Should I be concerned about the additional overhead in processing
> requirements for an estimated 10 million+ messages per day?

I assume you want to secure the link between federated exchanges or a
shovel connection, because clustering over a WAN link is not
recommended. SSL will provide confidentiality and if you use certificate
verification then it can provide authentication. SSL also provides
integrity by hashing data.

If you care about performance then select an appropriate cipher (e.g.
avoid 3DES). If you have crypto hardware support then make sure that is
enabled.

SSL will not protect the data written to disk by the broker, or messages
held in RAM in the broker. Message producers should encrypt the message
payloads if that's what you need.

If you want to secure clustering links then the Erlang distribution
protocol must be set up with "inet_tls". This is not presently a rabbit
configuration option, but the Erlang documentation shows how to set that
up: http://www.erlang.org/doc/apps/ssl/ssl_distribution.html





-Emile








From simon at rabbitmq.com  Wed Jan 16 10:29:11 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 16 Jan 2013 10:29:11 +0000
Subject: [rabbitmq-discuss] Securing Messages Over WAN Link
In-Reply-To: <50F67FCD.6070009@rabbitmq.com>
References: <22a5201a-39b3-4ce2-8c36-dd82309349c3@googlegroups.com>
	<50F67FCD.6070009@rabbitmq.com>
Message-ID: <50F680F7.8050808@rabbitmq.com>

On 16/01/13 10:24, Emile Joubert wrote:
> On 15/01/13 23:29, Richard Raseley wrote:
>> Could anyone provide any guidance on what they use for securing traffic
>> over the WAN? Is the built in SSL / TLS support in RabbitMQ (as outlined
>> here http://www.rabbitmq.com/ssl.html) sufficient for such purposes?
>> Should I be concerned about the additional overhead in processing
>> requirements for an estimated 10 million+ messages per day?
>
> I assume you want to secure the link between federated exchanges or a
> shovel connection, because clustering over a WAN link is not
> recommended. SSL will provide confidentiality and if you use certificate
> verification then it can provide authentication. SSL also provides
> integrity by hashing data.

I assume the OP was talking about securing standard client -> server 
connections.

> If you care about performance then select an appropriate cipher (e.g.
> avoid 3DES). If you have crypto hardware support then make sure that is
> enabled.

10m messages per day is only 115 msg/s. Presumably there will be spikes, 
but at that sort of rate, SSL performance is unlikely to be an issue.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From wamrewam at googlemail.com  Wed Jan 16 11:05:36 2013
From: wamrewam at googlemail.com (PJ)
Date: Wed, 16 Jan 2013 03:05:36 -0800 (PST)
Subject: [rabbitmq-discuss] ANN Bunny 0.9.0.pre6 is released
In-Reply-To: <CAE3HoVTuHzX4Sy1muxtpKseXZ1xQ23NcrbOZjOSZRtzYLv2Sgg@mail.gmail.com>
References: <CAE3HoVTuHzX4Sy1muxtpKseXZ1xQ23NcrbOZjOSZRtzYLv2Sgg@mail.gmail.com>
Message-ID: <826ea348-5c06-4a21-89e5-4ffc6b35401d@googlegroups.com>

Hi Michael,

First of all: this is a fantastic addition. Thank you so much.

Just one thing though: is network failure recovery supposed to work with 
q.pop as well? The reason I am asking is I can't get it to work. I modified 
slightly one of your examples:

require 'bunny'

broker = Bunny.new
broker.start
channel = broker.create_channel
exchange = channel.default_exchange

loop do
  sleep 2
  puts "Tick"
  
  q = channel.queue("foo")
  delivery_info, properties, payload = q.pop
  
end


If you run the script and stop the RabbitMQ server while the script is 
executing, the script hangs on q.pop.
If you then restart the server, the script will pass the q.pop once, then 
hang again and nothing happens anymore.

Is this expected?

Thanks a lot
PJ


On Monday, January 14, 2013 5:48:15 PM UTC, Michael Klishin wrote:
>
> TL;DR
>
> -----------------------------------------------------------------------------------------------------------------------
>
> Bunny 0.9.0.pre6 is released to rubygems.org [1].
>
> This release includes one major feature and a few bug fixes. It is 100% 
> backwards
> compatible.
>
> The major feature is automatic network failure recovery. This includes 
> recovery of
> exchanges, queues, bindings and consumers that were declared/added on the
> recovered Bunny connection.
>
> In addition, documentation guides on error handling and recovery is now up 
> online:
> http://rubybunny.info/articles/error_handling.html<http://rubybunny.info/articles/exchanges.html>
>
> Change log
>
> -----------------------------------------------------------------------------------------------------------------------
>
> Change log is available on GitHub:
>
> https://github.com/ruby-amqp/bunny
> /blob/master/ChangeLog.md#changes-between-bunny-090pre5-and-090pre<https://github.com/ruby-amqp/bunny/blob/master/ChangeLog.md#changes-between-bunny-090pre4-and-090pre5>
> 6
>
>
> Plans for 0.9.0 Final
>
> -----------------------------------------------------------------------------------------------------------------------
>
> There is still a few things we need to do before Bunny 0.9 can be declared 
> complete:
>
>  * Make network failure recovery configurable
>  * Bring back TLS support
>  * Add logging
>  * API reference documentation
>
> Changes are, the next release will be RC1.
>
>
> 1. https://rubygems.org/gems/bunny/versions/0.9.0.pre<https://rubygems.org/gems/bunny/versions/0.9.0.pre5>
> 6
> -- 
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130116/65454c56/attachment.htm>

From michael.s.klishin at gmail.com  Wed Jan 16 11:28:22 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 16 Jan 2013 11:28:22 +0000
Subject: [rabbitmq-discuss] ANN Bunny 0.9.0.pre6 is released
In-Reply-To: <826ea348-5c06-4a21-89e5-4ffc6b35401d@googlegroups.com>
References: <CAE3HoVTuHzX4Sy1muxtpKseXZ1xQ23NcrbOZjOSZRtzYLv2Sgg@mail.gmail.com>
	<826ea348-5c06-4a21-89e5-4ffc6b35401d@googlegroups.com>
Message-ID: <CAE3HoVQz+=EVNwuG68LO0UYkmg8yjBq28t7QhNi07JHRVr9Y+A@mail.gmail.com>

2013/1/16 PJ <wamrewam at googlemail.com>

> Is this expected?


Yes, although I have an idea about how to make that work.

Thanks for bringing up this example.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130116/51daa127/attachment.htm>

From kamaradclimber at gmail.com  Wed Jan 16 12:21:38 2013
From: kamaradclimber at gmail.com (=?UTF-8?Q?Gr=C3=A9goire_Seux?=)
Date: Wed, 16 Jan 2013 13:21:38 +0100
Subject: [rabbitmq-discuss] consistent hashing plugin
Message-ID: <CAE3ghBvo-EOQXG8s8Tr0AS2yd1QU4trD8+ThEk1Pbj44998z=w@mail.gmail.com>

Hello,

I was testing consistent hashing plugin and noticed a weird behavior
when using autodelete objects : some messages sent to an consistent
hashing exchange are never transferred to the bound queues.

To reproduce :
1. create a consistent hashing exchange (auto-delete, non durable),
start send messages with random routing key
2. create a queue (non durable, exlusive, auto delete) and bind it to
the exchange (routing key : "20"), consume messages from it
3. delete the queue
4. create a new queue with the same parameters and a different name,
consume messages

After 2., all messages are routed to the queue, after 4. around half
messages just disappear, the other are normally consumed by the new
queue.


If you replace the 4th step with
4b. create a new queue with the same parameters and the _same_ name
it works as expected.

Am I missing something?

I have reproduced this befavior with rabbitmq 2.8.2, 2.8.4 and 3.0.1
on centos. I have used the webinterface to see messages rates
(example: http://img832.imageshack.us/img832/2291/weirdhashing.png)

Any comment is welcome!

--
Gregoire

From ernest.staszuk at comarch.pl  Wed Jan 16 14:15:53 2013
From: ernest.staszuk at comarch.pl (Ernest Staszuk)
Date: Wed, 16 Jan 2013 15:15:53 +0100
Subject: [rabbitmq-discuss] consistent hashing plugin
In-Reply-To: <CAE3ghBvo-EOQXG8s8Tr0AS2yd1QU4trD8+ThEk1Pbj44998z=w@mail.gmail.com>
References: <CAE3ghBvo-EOQXG8s8Tr0AS2yd1QU4trD8+ThEk1Pbj44998z=w@mail.gmail.com>
Message-ID: <50F6B619.2050907@comarch.pl>

 From plugin's readme:

    Each message gets delivered to at most one queue. Normally, each

    message gets delivered to exactly one queue, but there is a race

    between the determination of which queue to send a message to, and the

    deletion/death of that queue that does permit the possibility of the

    message being sent to a queue which then disappears before the message

    is processed. Hence in general, at most one queue.

Note that consistent-hashing does not ensure persistence of messages due 
this issue.

In my experience consistent-hashing handles bindings removal or queue 
deletions
poorly. I had been running into NO ROUTE exception constantly when I used
consistent-hashing-exchange with auto-deleted queues.

I also tried to use alternate-exchanges to catch bad cases. Had 
difficulties
with that also.

On 01/16/2013 01:21 PM, Gr?goire Seux wrote:
> 1. create a consistent hashing exchange (auto-delete, non durable),
> start send messages with random routing key
> 2. create a queue (non durable, exlusive, auto delete) and bind it to
> the exchange (routing key : "20"), consume messages from it
> 3. delete the queue

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130116/fcfd9978/attachment.htm>

From stuff at moesel.net  Wed Jan 16 14:37:37 2013
From: stuff at moesel.net (Chris)
Date: Wed, 16 Jan 2013 09:37:37 -0500
Subject: [rabbitmq-discuss] Implementing User Messaging Using RabbitMQ
In-Reply-To: <CAHEpgBDUKZnM95zRcqEShd_BDmA=AmoUh+CGR6OUz_baCuVdHQ@mail.gmail.com>
References: <CAHEpgBDUKZnM95zRcqEShd_BDmA=AmoUh+CGR6OUz_baCuVdHQ@mail.gmail.com>
Message-ID: <CAHEpgBAnJzC0oJOBPYoHT=Q_HLit9XJzQgL=c94HMdX0p+7tig@mail.gmail.com>

My colleague also just mentioned that we might be able to solve the
requirement for persisting all user messages by using an
exchange-to-exchange binding (instead of the Messaging Service Worker).  So
we would have a fanout exchange that goes to a worker queue of "Message
History Workers" and goes to the other exchange for distribution.  An
interesting idea, but of course, we still need to figure out the best way
to do that exchange for distribution!

-Chris


On Tue, Jan 15, 2013 at 10:14 PM, Chris <stuff at moesel.net> wrote:

> Hello RabbitMQ Gurus,
>
> If you don't mind, I'd love some help trying to arrive at the right design
> for a user messaging system I am working on.
>
> High-Level Requirements
> =======================
> - users can send messages to another user, several users, a group, or
> everyone
>   - users and groups are managed in a proprietary user management system
> - no chat rooms-- each user just has a message feed or "timeline" of
> incoming & outgoing messages
> - message history must be preserved (in a database)
> - if a user is offline, the message should be forwarded to the user's email
> - 5000 concurrent users sending a few messages every few minutes (20,000
> users total in system).
>
> Environment
> ===========
> The primary interface is a web application (or maybe a few web
> applications), but future iterations may introduce standalone clients.
>  RabbitMQ is 3.x and likely to be clustered or replicated, and running on
> same machine(s) as web application servers.
>
> General Approach
> ================
> In order to store every message in a database (for historical purposes),
> all messages are initially sent to a direct exchange with a worker queue.
>  Consumers of the worker queue (let's call them messaging service workers)
> receive the message and store it to the database.  Then they distribute the
> message to the intended recipients (this is the part I think I need most
> help with).
>
> Message Distribution Option 1: Direct Exchange w/ Queue Per User
> =================================================================
> Message is sent to a direct exchange with username as the routing key.
>  For every logged in user, the webapp declares a queue and binds with the
> username.
>
> Issue 1: How to support groups?  The messaging service worker could
> resolve the group to a list of users and post the message multiple times
> (once for each user/routing key)-- but this would not scale very well.  Or
> we could create individual queues for every group too, but this increases
> complexity in the web app (and later in our other clients) since they need
> to determine what groups they need to listen for and who to distribute to.
>
> Issue 2: Is 5000 queues a bit much?  Especially when they are all
> ultimately going to the same consumer (in the webapp case)?  This isn't the
> only use of RabbitMQ, so there will be other queues/exchanges/bindings as
> well...
>
> Message Distribution Option 2: Topic Exchange w/ Single Queue per Webapp
> ========================================================================
> Message is sent to topic exchange with routing key containing ALL
> addressed users (i.e., "|usera|userb|userc|").  Webapp declares single
> queue and a separate binding to the exchange for each user (i.e.,
> "#|usera|#", "#|userb|#", etc.).  This is similar to Option 1, but with the
> benefit that each message only has to be sent once.
>
> Issue 1: Routing key can get huge (20000 names if addressed to "everyone"
> group).
> Issue 2: It just seems like the wrong use of topic exchange.
>
> Message Distribution Option 3: Fanout Exchange w/ Single Queue per Webapp
> =========================================================================
> Message is sent to fanout exchange.  Webapp listens on fanout exchange and
> simply discards all messages for users that aren't logged in.
>
> Issue 1: Doesn't scale well (or even if it does, there is lots of waste
> filtering on the client side).
> Issue 2: Not at all secure (although, for now, we won't try to solve
> security).
>
> Message Distribution Option 4: Direct Exchange w/ Single Queue per Webapp
> ========================================================================
> Webapp must notify messaging service worker as users log in and out-- and
> of the single queue on which it wants messages.  When a message needs to be
> distributed, messaging service worker checks to see which users are logged
> in where.  It sends message to the queue of each webapp that has logged in
> users that the message is addressed to (message itself contains "to:" list
> so webapp can send to right user UI).
>
> Issue 1: Messaging Service Worker now has a lot more state and processing
> messages is a lot heavier.  Need to make sure it stays in synch with webapp.
>
> Issue 2: Messaging Service Worker is now doing the routing-- which just
> seems wrong since that is what RabbitMQ is so good at!
>
> Message Distribution Option 5: Fanout Exchanges for Groups
> ==========================================================
> Same as option 1 (queue per user), but also create a fanout exchange for
> every group.  The individual user queues need to be bound to the fanout
> exchange corresponding to each group they belong to.
>
> Issue 1: Could result in a lot of exchanges (not sure how many groups
> there are).
>
> Issue 2: Still seems like a lot of queues too (5000).
>
> Message Distribution Option 6: Custom Exchange
> ==============================================
> Create our own exchange that allows consumers to bind with usernames.
>  When a message is posted to the exchange, it knows how to read the "to:"
> list from it, can even resolve groups, and then sends to the correct queues
> based on the bindings.
>
> Issue 1: We don't have any Erlang experience.
>
> Issue 2: Resolving groups in an Erlang custom exchange could be tricky
> (not sure about the APIs to our User Management).
>
> Something Else
> ==============
> I'm more than open to other ideas too!
>
> BONUS QUESTION
> ==============
> Whatever the correct approach is, how do we determine if a user is
> "offline" and we need to forward the message to their email?  If we are
> using queue-per-user, then we can set the mandatory flag, I guess?  If we
> are using another approach, what then?
>
> Thanks to anyone who can help point me in the right direction (or steer me
> away from the wrong direction)...  I'm not familiar enough yet with
> RabbitMQ performance characteristics to know what is a bad idea, and not
> familiar enough yet with its many features to know what is a good idea...
> ;-)
>
> Thanks again,
> Chris
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130116/6b208ee2/attachment.htm>

From kamaradclimber at gmail.com  Wed Jan 16 16:15:39 2013
From: kamaradclimber at gmail.com (=?UTF-8?Q?Gr=C3=A9goire_Seux?=)
Date: Wed, 16 Jan 2013 17:15:39 +0100
Subject: [rabbitmq-discuss] consistent hashing plugin
In-Reply-To: <50F6B619.2050907@comarch.pl>
References: <CAE3ghBvo-EOQXG8s8Tr0AS2yd1QU4trD8+ThEk1Pbj44998z=w@mail.gmail.com>
	<50F6B619.2050907@comarch.pl>
Message-ID: <CAE3ghBt0Sog_vM34VvTn5MGZ-LuWKitwESMHuAHXg5VQMzMHUA@mail.gmail.com>

Thanks for your reply.
In my case, the race condition is not really the issue since it is
supposed to be short, the issue I have noticed last forever after
queue deletion.

I have noticed that this behavior happens only when we delete the last
bound queue.

Should I open a bug report for this ?


--
Gr?goire

From matthias at rabbitmq.com  Wed Jan 16 16:32:04 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 16 Jan 2013 16:32:04 +0000
Subject: [rabbitmq-discuss] consistent hashing plugin
In-Reply-To: <CAE3ghBt0Sog_vM34VvTn5MGZ-LuWKitwESMHuAHXg5VQMzMHUA@mail.gmail.com>
References: <CAE3ghBvo-EOQXG8s8Tr0AS2yd1QU4trD8+ThEk1Pbj44998z=w@mail.gmail.com>
	<50F6B619.2050907@comarch.pl>
	<CAE3ghBt0Sog_vM34VvTn5MGZ-LuWKitwESMHuAHXg5VQMzMHUA@mail.gmail.com>
Message-ID: <50F6D604.4020604@rabbitmq.com>

On 16/01/13 16:15, Gr?goire Seux wrote:
> Should I open a bug report for this ?

Can you condense your observations into a short program? i.e. 
programmatically go through all the steps from your first email, and 
then send some messages to the exchange, count the number of messages 
received by the consumer, and note any difference.

Matthias.

From kamaradclimber at gmail.com  Wed Jan 16 17:32:02 2013
From: kamaradclimber at gmail.com (=?UTF-8?Q?Gr=C3=A9goire_Seux?=)
Date: Wed, 16 Jan 2013 18:32:02 +0100
Subject: [rabbitmq-discuss] consistent hashing plugin
In-Reply-To: <50F6D604.4020604@rabbitmq.com>
References: <CAE3ghBvo-EOQXG8s8Tr0AS2yd1QU4trD8+ThEk1Pbj44998z=w@mail.gmail.com>
	<50F6B619.2050907@comarch.pl>
	<CAE3ghBt0Sog_vM34VvTn5MGZ-LuWKitwESMHuAHXg5VQMzMHUA@mail.gmail.com>
	<50F6D604.4020604@rabbitmq.com>
Message-ID: <CAE3ghBtfFMLKxCB-gtmiUYeDsmxdLaBCYwtz7Paiz9FVPm9VEA@mail.gmail.com>

Hello Matthias,

here is a C# program using the official lib (sorry I don't speak
erlang) reproducing the issue.

--
Gr?goire
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Program.cs
Type: application/octet-stream
Size: 3863 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130116/db52f11f/attachment.obj>

From adam.aquilon at ericsson.com  Wed Jan 16 17:40:09 2013
From: adam.aquilon at ericsson.com (Adam Aquilon)
Date: Wed, 16 Jan 2013 18:40:09 +0100
Subject: [rabbitmq-discuss] How to use federation with clustering for best
	HA-behaviour?
Message-ID: <op.wq0l07ich82nkl@e778e7d1af99b9.eemea.ericsson.se>

Hello!

This is my first post, so be nice please? :-)

For the impatient:

I'm trying to understand how to achieve the best possible High
Availability-setup with RabbitMQ. The documentation seems to say
that I don't need to mirror the queues created by the federation
plugin, but then I don't get uninterrupted traffic.

Once I created a policy that included "ha-mode":"all" for federated
queues, I could crash single cluster nodes with no interruption in
traffic. Did I misunderstand the documentation or is there something
else going on here?


Background:

Currently, I have six test nodes running on my linux box, arranged
in three clusters of two nodes each: {n1,n2}, {n3,n4} and {n5,n6}.

The clusters are called "kista", "linkoping" and "lindholmen"
respectively. They are meant to represent different sites.
For the details, please see the end of this email which has
output from rabbitmqadmin.

I've defined separate upstreams and upstream-sets for each one-way
link between clusters. (Is that the way to do it?)

For test purposes I defined three topic exchanges per site:

  o "local.ci"  -- for intra-site messages
  o "ci"        -- for normal messages
  o "<site>.ci" -- filtered "ci" messages, federated

E.g. the "kista.ci" exchange only gets those "ci" messages we
would like to be visible to other sites. (Exchange to exchange
binding.)


During the test runs, I had a producer in "kista" and consumers
both in "kista" and the other two sites.


First test:

For the first test, I didn't have the "^federation:" policy rule.
In this case, it seemed as the federation plugin only setup one
link to each site, to one specific node.

When I deliberately killed that node, messages did not get sent
to the corresponding site.

When the node was restarted, the connection was resumed and messages
started flowing again.

Second test:

Here I defined the policy that mirrored the federation queues.

Now, when I killed one node, traffic continued uninterrupted (at
least seemingly). Restoring one node and killing the other also
worked (as expected). I had to kill both nodes at a site to stop
messages, which is the behaviour I wanted.


Question:

Have I understood correctly how to setup federation in clustered
sites?

Is there a better way?


Thank you for your time!
Kind regards,
Adam Aquilon


======================================================================

Policies for the "kista" site (nodes n1,n2):
+-------+------------+-------------------------------------------------------------+-----------------------+----------+
| vhost |    name    |                         definition                          |        pattern        | priority |
+-------+------------+-------------------------------------------------------------+-----------------------+----------+
| /     | lindholmen | {"ha-mode": "all", "federation-upstream-set": "lindholmen"} | ^lindholmen\.         | 0        |
| /     | linkoping  | {"ha-mode": "all", "federation-upstream-set": "linkoping"}  | ^linkoping\.          | 0        |
| /     | local      | {"ha-mode": "all"}                                          | ^(ci|local\.|kista\.) | 0        |
| /     | mirrored   | {"ha-mode": "all"}                                          | ^federation:          | 0        |
+-------+------------+-------------------------------------------------------------+-----------------------+----------+

Policies for the "linkoping" site (nodes n3,n4):
+-------+------------+-------------------------------------------------------------+--------------------------+----------+
| vhost |    name    |                         definition                          |         pattern          | priority |
+-------+------------+-------------------------------------------------------------+--------------------------+----------+
| /     | kista      | {"ha-mode": "all", "federation-upstream-set": "kista"}      | ^kista\.                 | 0        |
| /     | lindholmen | {"ha-mode": "all", "federation-upstream-set": "lindholmen"} | ^lindholmen\.            | 0        |
| /     | local      | {"ha-mode": "all"}                                          | ^(ci|local\.linkoping\.) | 0        |
| /     | mirrored   | {"ha-mode": "all"}                                          | ^federation:             | 0        |
+-------+------------+-------------------------------------------------------------+--------------------------+----------+

Policies for the "lindholmen" site (nodes n5,n6):
+-------+-----------+------------------------------------------------------------+----------------------------+----------+
| vhost |   name    |                         definition                         |          pattern           | priority |
+-------+-----------+------------------------------------------------------------+----------------------------+----------+
| /     | kista     | {"ha-mode": "all", "federation-upstream-set": "kista"}     | ^kista\.                   | 0        |
| /     | linkoping | {"ha-mode": "all", "federation-upstream-set": "linkoping"} | ^linkoping\.               | 0        |
| /     | local     | {"ha-mode": "all"}                                         | ^(ci|local\.|lindholmen\.) | 0        |
| /     | mirrored  | {"ha-mode": "all"}                                         | ^federation:               | 0        |
+-------+-----------+------------------------------------------------------------+----------------------------+----------+


Parameters for the "kista" site (nodes n1,n2):
+-------+----------------+-------------------------+--------------------------------------------------------------+
| vhost |      name      |        component        |                            value                             |
+-------+----------------+-------------------------+--------------------------------------------------------------+
| /     | lindholmen     | federation-upstream-set | [{"upstream": "lindholmen5"}, {"upstream": "lindholmen6"}]   |
| /     | lindholmen5    | federation-upstream     | {"uri": "amqp://localhost:5675", "max-hops": 1}              |
| /     | lindholmen6    | federation-upstream     | {"uri": "amqp://localhost:5676", "max-hops": 1}              |
| /     | linkoping      | federation-upstream-set | [{"upstream": "linkoping3"}, {"upstream": "linkoping4"}]     |
| /     | linkoping3     | federation-upstream     | {"uri": "amqp://localhost:5673", "max-hops": 1}              |
| /     | linkoping4     | federation-upstream     | {"uri": "amqp://localhost:5674", "max-hops": 1}              |
| /     | local-nodename | federation              | kista at myhost                                                |
| /     | local-username | federation              | guest                                                        |
+-------+----------------+-------------------------+--------------------------------------------------------------+

Parameters for the "linkoping" site (nodes n3,n4):
+-------+----------------+-------------------------+--------------------------------------------------------------+
| vhost |      name      |        component        |                            value                             |
+-------+----------------+-------------------------+--------------------------------------------------------------+
| /     | kista          | federation-upstream-set | [{"upstream": "kista1"}, {"upstream": "kista2"}]             |
| /     | kista1         | federation-upstream     | {"uri": "amqp://localhost:5671", "max-hops": 1}              |
| /     | kista2         | federation-upstream     | {"uri": "amqp://localhost:5672", "max-hops": 1}              |
| /     | lindholmen     | federation-upstream-set | [{"upstream": "lindholmen5"}, {"upstream": "lindholmen6"}]   |
| /     | lindholmen5    | federation-upstream     | {"uri": "amqp://localhost:5675", "max-hops": 1}              |
| /     | lindholmen6    | federation-upstream     | {"uri": "amqp://localhost:5676", "max-hops": 1}              |
| /     | local-nodename | federation              | linkoping at myhost                                          |
| /     | local-username | federation              | guest                                                        |
+-------+----------------+-------------------------+--------------------------------------------------------------+

Parameters for the "lindholmen" site (nodes n5,n6):
+-------+----------------+-------------------------+------------------------------------------------------------+
| vhost |      name      |        component        |                           value                            |
+-------+----------------+-------------------------+------------------------------------------------------------+
| /     | kista          | federation-upstream-set | [{"upstream": "kista1"}, {"upstream": "kista2"}]           |
| /     | kista1         | federation-upstream     | {"uri": "amqp://localhost:5671", "max-hops": 1}            |
| /     | kista2         | federation-upstream     | {"uri": "amqp://localhost:5672", "max-hops": 1}            |
| /     | linkoping      | federation-upstream-set | [{"upstream": "linkoping3"}, {"upstream": "linkoping4"}]   |
| /     | linkoping3     | federation-upstream     | {"uri": "amqp://localhost:5673", "max-hops": 1}            |
| /     | linkoping4     | federation-upstream     | {"uri": "amqp://localhost:5674", "max-hops": 1}            |
| /     | local-nodename | federation              | lindholmen at myhost                                       |
| /     | local-username | federation              | guest                                                      |
+-------+----------------+-------------------------+------------------------------------------------------------+

From michael.s.klishin at gmail.com  Wed Jan 16 17:57:28 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 16 Jan 2013 17:57:28 +0000
Subject: [rabbitmq-discuss] ANN Bunny 0.9.0.pre6 is released
In-Reply-To: <826ea348-5c06-4a21-89e5-4ffc6b35401d@googlegroups.com>
References: <CAE3HoVTuHzX4Sy1muxtpKseXZ1xQ23NcrbOZjOSZRtzYLv2Sgg@mail.gmail.com>
	<826ea348-5c06-4a21-89e5-4ffc6b35401d@googlegroups.com>
Message-ID: <CAE3HoVQtNEfy0eKk+CvbWR-vPrk6upu7DAeTVaTLuijRnyJceQ@mail.gmail.com>

2013/1/16 PJ <wamrewam at googlemail.com>

> Just one thing though: is network failure recovery supposed to work with
> q.pop as well? The reason I am asking is I can't get it to work.


PJ,

Please try with master, I've just pushed something that should make
basic.get and other synchronous
operations unblock when a network failure is detected.

This makes an example very similar to yours recover fine for me.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130116/1305cf1a/attachment.htm>

From matthias at rabbitmq.com  Wed Jan 16 19:42:07 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 16 Jan 2013 19:42:07 +0000
Subject: [rabbitmq-discuss] consistent hashing plugin
In-Reply-To: <CAE3ghBtfFMLKxCB-gtmiUYeDsmxdLaBCYwtz7Paiz9FVPm9VEA@mail.gmail.com>
References: <CAE3ghBvo-EOQXG8s8Tr0AS2yd1QU4trD8+ThEk1Pbj44998z=w@mail.gmail.com>
	<50F6B619.2050907@comarch.pl>
	<CAE3ghBt0Sog_vM34VvTn5MGZ-LuWKitwESMHuAHXg5VQMzMHUA@mail.gmail.com>
	<50F6D604.4020604@rabbitmq.com>
	<CAE3ghBtfFMLKxCB-gtmiUYeDsmxdLaBCYwtz7Paiz9FVPm9VEA@mail.gmail.com>
Message-ID: <50F7028F.8080701@rabbitmq.com>

Gr?goire,

On 16/01/13 17:32, Gr?goire Seux wrote:
> here is a C# program using the official lib

Cheers. It's a bug. Triggered by the declaration of the exchanges as 
'auto-delete'. Removing that from the test code makes the test succeed.

Thanks for reporting this. Have filed a bug.

Matthias.

From shanyu.zhao at intel.com  Wed Jan 16 19:54:23 2013
From: shanyu.zhao at intel.com (Zhao, Shanyu)
Date: Wed, 16 Jan 2013 19:54:23 +0000
Subject: [rabbitmq-discuss] Rabbitmq boot failure with "tables_not_present"
Message-ID: <D963620277BBFD4B87CF34F284738F2D3AA6F5E4@ORSMSX102.amr.corp.intel.com>

Hi,

We have two rabbitmq servers to form a cluster. It mostly runs great. But sometimes after redeploy, we saw some boot failure error in rabbitmq server log.

The relevant part of the log is shown below. But the problem is that we saw these log messages repeated every 7-8 seconds and can last as long as 80 minutes before rabbit finally start up correctly. During this time any connection to the rabbitmq cluster will get a disconnected exception.

Any idea on what might have caused this problem?

=INFO REPORT==== 16-Jan-2013::14:11:36 ===
Starting RabbitMQ 3.0.1 on Erlang R14B04

=INFO REPORT==== 16-Jan-2013::14:11:37 ===
Limiting to approx 924 file handles (829 sockets)

=INFO REPORT==== 16-Jan-2013::14:11:37 ===
Error description:
   {case_clause,{error,tables_not_present}}

Log files (may contain more information):
   /var/log/rabbitmq/rabbit at ip-10-0-2-97.log
   /var/log/rabbitmq/rabbit at ip-10-0-2-97-sasl.log

Stack trace:
   [{rabbit_mnesia,discover_cluster,1},
    {rabbit_mnesia,init_from_config,0},
    {rabbit_mnesia,init,0},
    {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
    {rabbit,run_boot_step,1},
    {rabbit,'-start/2-lc$^0/1-0-',1},
    {rabbit,start,2},
    {application_master,start_it_old,4}]


=INFO REPORT==== 16-Jan-2013::14:11:38 ===
    application: rabbit
    exited: {bad_return,
                {{rabbit,start,[normal,[]]},
                 {'EXIT',
                     {rabbit,failure_during_boot,
                         {case_clause,{error,tables_not_present}}}}}}
type: temporary


I really appreciate any insight into this problem!

Thanks,
Shanyu

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
"I always like to point out that it isn't methodologies that succeed or fail, it's teams that succeed or fail. Taking on a process can help a team raise its game, but in the end it's the team that matters and carries the responsibility to do what works for them."
--by Martin Fowler

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130116/473989c4/attachment.htm>

From wamrewam at googlemail.com  Wed Jan 16 20:17:14 2013
From: wamrewam at googlemail.com (PJ)
Date: Wed, 16 Jan 2013 12:17:14 -0800 (PST)
Subject: [rabbitmq-discuss] ANN Bunny 0.9.0.pre6 is released
In-Reply-To: <826ea348-5c06-4a21-89e5-4ffc6b35401d@googlegroups.com>
References: <CAE3HoVTuHzX4Sy1muxtpKseXZ1xQ23NcrbOZjOSZRtzYLv2Sgg@mail.gmail.com>
	<826ea348-5c06-4a21-89e5-4ffc6b35401d@googlegroups.com>
Message-ID: <37152ea0-4a01-45d0-a064-160cad7ac27f@googlegroups.com>

Hi guys,

Bunny 0.9 is fantastic so I really don't want to be a pain with this: 
please do let me know if it is not the right place or too early to discuss 
these potential issues.

I just tried pre7 - it works better on basic_get, thank you! Yet:

- the automatic_recovery_with_client_named_queues.rb example does not work 
anymore (if you stop the server, then start it again, messages are not 
received anymore - it used to work on pre6).
- in the basic_get case, when the server is down, q.pop still hangs 
indefinitely. Is it expected and it should be handled by the client?

Thanks
PJ


On Wednesday, January 16, 2013 11:05:36 AM UTC, PJ wrote:
>
> Hi Michael,
>
> First of all: this is a fantastic addition. Thank you so much.
>
> Just one thing though: is network failure recovery supposed to work with 
> q.pop as well? The reason I am asking is I can't get it to work. I modified 
> slightly one of your examples:
>
> require 'bunny'
>
> broker = Bunny.new
> broker.start
> channel = broker.create_channel
> exchange = channel.default_exchange
>
> loop do
>   sleep 2
>   puts "Tick"
>   
>   q = channel.queue("foo")
>   delivery_info, properties, payload = q.pop
>   
> end
>
>
> If you run the script and stop the RabbitMQ server while the script is 
> executing, the script hangs on q.pop.
> If you then restart the server, the script will pass the q.pop once, then 
> hang again and nothing happens anymore.
>
> Is this expected?
>
> Thanks a lot
> PJ
>
>
> On Monday, January 14, 2013 5:48:15 PM UTC, Michael Klishin wrote:
>>
>> TL;DR
>>
>> -----------------------------------------------------------------------------------------------------------------------
>>
>> Bunny 0.9.0.pre6 is released to rubygems.org [1].
>>
>> This release includes one major feature and a few bug fixes. It is 100% 
>> backwards
>> compatible.
>>
>> The major feature is automatic network failure recovery. This includes 
>> recovery of
>> exchanges, queues, bindings and consumers that were declared/added on the
>> recovered Bunny connection.
>>
>> In addition, documentation guides on error handling and recovery is now 
>> up online:
>> http://rubybunny.info/articles/error_handling.html<http://rubybunny.info/articles/exchanges.html>
>>
>> Change log
>>
>> -----------------------------------------------------------------------------------------------------------------------
>>
>> Change log is available on GitHub:
>>
>> https://github.com/ruby-amqp/bunny
>> /blob/master/ChangeLog.md#changes-between-bunny-090pre5-and-090pre<https://github.com/ruby-amqp/bunny/blob/master/ChangeLog.md#changes-between-bunny-090pre4-and-090pre5>
>> 6
>>
>>
>> Plans for 0.9.0 Final
>>
>> -----------------------------------------------------------------------------------------------------------------------
>>
>> There is still a few things we need to do before Bunny 0.9 can be 
>> declared complete:
>>
>>  * Make network failure recovery configurable
>>  * Bring back TLS support
>>  * Add logging
>>  * API reference documentation
>>
>> Changes are, the next release will be RC1.
>>
>>
>> 1. https://rubygems.org/gems/bunny/versions/0.9.0.pre<https://rubygems.org/gems/bunny/versions/0.9.0.pre5>
>> 6
>> -- 
>> MK
>>
>> http://github.com/michaelklishin
>> http://twitter.com/michaelklishin
>>  
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130116/1bd1791a/attachment.htm>

From cao at ll.mit.edu  Wed Jan 16 21:13:02 2013
From: cao at ll.mit.edu (Cao, Yican - 0551 - MITLL)
Date: Wed, 16 Jan 2013 16:13:02 -0500
Subject: [rabbitmq-discuss] RabbitMQ Highly Available Queues
Message-ID: <8894FA9D-1284-4ACF-9719-A7355CFEBB50@ll.mit.edu>

Hi,

Question about RabbitMQ Highly Available Queues:

I have active/active HAQ  and have publishers to send messages to one of it's clustered nodes (maybe master's URI, maybe slave's URI).
I have few consumers consume messages through different slave's URI as well as consumer connected to master URI by chance. According the documentation, consumer actually consumes message through master node. It is not visible to end user who is master, who are slaves. 

My question is what is going to happen to the consumer actually connected to master's URI when master node is dead. I can understand that consumers connected to original slave's URI won't notice any difference. Thanks.


Yican Cao

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 5652 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130116/4c653f11/attachment.bin>

From prabodh.upreti at vce.com  Wed Jan 16 21:54:08 2013
From: prabodh.upreti at vce.com (Prabodh Upreti)
Date: Wed, 16 Jan 2013 13:54:08 -0800 (PST)
Subject: [rabbitmq-discuss] durable message server restart
Message-ID: <1358373248611-24497.post@n5.nabble.com>

Hello

I understand I need to create a durable queue so I can hold messages for
consumers that connect in the future to retrieve those messages.

Does this mean I need to create a durable exchange too?  Also when I publish
messages do I need to do anything special so that it can survive a server
restart.  I am assuming here that since the queue is durable, the already
published messages should survive a server restart.  I would appreciate you
clarification. Thank you.

regards



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/durable-message-server-restart-tp24497.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From michael.s.klishin at gmail.com  Wed Jan 16 22:23:26 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 17 Jan 2013 02:23:26 +0400
Subject: [rabbitmq-discuss] durable message server restart
In-Reply-To: <1358373248611-24497.post@n5.nabble.com>
References: <1358373248611-24497.post@n5.nabble.com>
Message-ID: <CAE3HoVR-uRW7nFAhqAyTCi98EP2vc8q65LtpkNV4udLZ-LGgGQ@mail.gmail.com>

2013/1/17 Prabodh Upreti <prabodh.upreti at vce.com>

> Does this mean I need to create a durable exchange too?
>

AFAIR only durable queues can be bound to durable exchanges. So, yes.


> Also when I publish
> messages do I need to do anything special so that it can survive a server
> restart.  I am assuming here that since the queue is durable, the already
> published messages should survive a server restart.  I would appreciate you
> clarification.
>

Messages need to be published as persistent (delivery mode 2). Different
clients expose it in slightly different ways, see the publishing function in
your client.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130117/e63c841d/attachment.htm>

From matthias at rabbitmq.com  Wed Jan 16 22:44:35 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 16 Jan 2013 22:44:35 +0000
Subject: [rabbitmq-discuss] durable message server restart
In-Reply-To: <CAE3HoVR-uRW7nFAhqAyTCi98EP2vc8q65LtpkNV4udLZ-LGgGQ@mail.gmail.com>
References: <1358373248611-24497.post@n5.nabble.com>
	<CAE3HoVR-uRW7nFAhqAyTCi98EP2vc8q65LtpkNV4udLZ-LGgGQ@mail.gmail.com>
Message-ID: <50F72D53.7020008@rabbitmq.com>

On 16/01/13 22:23, Michael Klishin wrote:
>
> 2013/1/17 Prabodh Upreti <prabodh.upreti at vce.com
> <mailto:prabodh.upreti at vce.com>>
>
>     Does this mean I need to create a durable exchange too?
>
>
> AFAIR only durable queues can be bound to durable exchanges.

Actually, that restriction was lifted some time ago.

Also, to the OP's question...

"I understand I need to create a durable queue so I can hold messages 
for consumers that connect in the future to retrieve those messages."

Durability is there for one thing and one thing only: retaining data in 
the event of broker restarts.

So, technically, to "hold messages for consumers that connect in the 
future", an ordinary queue suffices. Though if that future might entail 
broker restarts then yes, you should make the queue durable.

Another thing worth noting is that durability only affects performance 
of resource operation - i.e. creating/deleting queues, exchanges and 
bindings - *not* messaging. Though combining durability with persistence 
(see below) *does* affect performance.

> Messages need to be published as persistent (delivery mode 2).

Right. It's the conjunction of message persistence and queue durability 
that results in messages getting written to disk and survive broker 
restarts.

Regards,

Matthias.

From jerryk at rbcon.com  Wed Jan 16 23:55:37 2013
From: jerryk at rbcon.com (Jerry Kuch)
Date: Wed, 16 Jan 2013 15:55:37 -0800
Subject: [rabbitmq-discuss] RabbitMQ Highly Available Queues
In-Reply-To: <8894FA9D-1284-4ACF-9719-A7355CFEBB50@ll.mit.edu>
References: <8894FA9D-1284-4ACF-9719-A7355CFEBB50@ll.mit.edu>
Message-ID: <CAE0Sz=y=mC3rQOXNFcpMnojR7QjAP0xhFyF+uKt7WojWnbJBDQ@mail.gmail.com>

On Wed, Jan 16, 2013 at 1:13 PM, Cao, Yican - 0551 - MITLL
<cao at ll.mit.edu>wrote:

Hi, Cao:

My question is what is going to happen to the consumer actually connected
> to master's URI when master node is dead. I can understand that consumers
> connected to original slave's URI won't notice any difference. Thanks.
>

Please see here for details:  http://www.rabbitmq.com/ha.html

You are quite correct in that, regardless of which cluster node a consumer
is connected to, the consuming is done from the master node of the mirror
set.  In the event of a master failure however, the following sequence of
events happens:

   - The eldest slave is promoted to become the new master
   - The slave considers *all* previous consumers to have been abruptly
   disconnected.  As a result all messages that have been delivered to clients
   but for which receipt of ACK is pending are requeued for redelivery.  This
   guards against cases where a delivery happened, but the ACK hadn't reached
   the master before its failure, or where the receipt of the ACK hadn't been
   successfully broadcast to the slaves prior to master failure.
   - Clients that were consuming from the mirrored queue (regardless of
   which node they had explicitly connected to) and that support the Consumer
   Cancellation Notification extension will be notified that their
   subscription to the mirrored queue has been cancelled.  They must then:
      - Re-consume from the queue, which will pick up the newly promoted
      master

The reason the CCN exists is to inform clients that the master was lost.

If the clients aren't told this, they may continue to ACK messages sent by
a now departed master, and they may be surprised by seeing messages a
second time (due to the requeuing in the second bullet point above).  If a
client happened to be connected directly to the crashed master, he'd of
course be disconnected and have to reconnect to a live node in the cluster.

So when you say "consumers connected to original slave's URI won't notice
any difference" that's not quite entirely true.  Further, the answer to
your question about "what is going to happen to the consumer actually
connected to master's URI when master node is dead" is that such a consumer
will be disconnected, have to reconnect to the cluster, and reconsume from
the queue.

Best regards,
Jerry
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130116/9ce26681/attachment.htm>

From jerryk at rbcon.com  Thu Jan 17 00:01:44 2013
From: jerryk at rbcon.com (Jerry Kuch)
Date: Wed, 16 Jan 2013 16:01:44 -0800
Subject: [rabbitmq-discuss] Rabbitmq boot failure with
	"tables_not_present"
In-Reply-To: <D963620277BBFD4B87CF34F284738F2D3AA6F5E4@ORSMSX102.amr.corp.intel.com>
References: <D963620277BBFD4B87CF34F284738F2D3AA6F5E4@ORSMSX102.amr.corp.intel.com>
Message-ID: <CAE0Sz=zu_44CTw_mf4h+pKueu8kTWyRbyuSphx4CkuXH_Okfpg@mail.gmail.com>

On Wed, Jan 16, 2013 at 11:54 AM, Zhao, Shanyu <shanyu.zhao at intel.com>wrote:


> The relevant part of the log is shown below. But the problem is that we
> saw these log messages repeated every 7-8 seconds and can last as long as
> 80 minutes before rabbit finally start up correctly. During this time any
> connection to the rabbitmq cluster will get a disconnected exception.
>
> **
>
> ** **
>
> Any idea on what might have caused this problem?
>
****
>
> =INFO REPORT==== 16-Jan-2013::14:11:37 ===**
>
> **
>
> Error description:****
>
>    {case_clause,{error,tables_not_present}}****
>
> ** **
>
> Log files (may contain more information):****
>
>    /var/log/rabbitmq/rabbit at ip-10-0-2-97.log****
>
>    /var/log/rabbitmq/rabbit at ip-10-0-2-97-sasl.log****
>
> ** **
>
> Stack trace:****
>
>    [{rabbit_mnesia,discover_cluster,1},****
>
>     {rabbit_mnesia,init_from_config,0},****
>
>     {rabbit_mnesia,init,0},****
>
>     {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},****
>
>     {rabbit,run_boot_step,1},****
>
>     {rabbit,'-start/2-lc$^0/1-0-',1},****
>
>     {rabbit,start,2},****
>
>     {application_master,start_it_old,4}]****
>
> ** **
>
> ** **
>
> =INFO REPORT==== 16-Jan-2013::14:11:38 ===****
>
>     application: rabbit****
>
>     exited: {bad_return,****
>
>                 {{rabbit,start,[normal,[]]},****
>
>                  {'EXIT',****
>
>                      {rabbit,failure_during_boot,****
>
>                          {case_clause,{error,tables_not_present}}}}}}****
>
> type: temporary
>

You mention that you sometime see this after a redeploy.  Depending on how
you've redeployed, have you successfully clustered the nodes in the first
place?  The error means that some of the tables in Erlang's Mnesia
distributed database upon which Rabbit relies to maintain broker metadata
weren't found, suggesting that some prior state or configuration perished
during your redeploy process.

Best regards,
Jerry
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130116/e5c04d00/attachment.htm>

From shanyu.zhao at intel.com  Thu Jan 17 00:38:43 2013
From: shanyu.zhao at intel.com (Zhao, Shanyu)
Date: Thu, 17 Jan 2013 00:38:43 +0000
Subject: [rabbitmq-discuss] Rabbitmq boot failure
	with	"tables_not_present"
In-Reply-To: <CAE0Sz=zu_44CTw_mf4h+pKueu8kTWyRbyuSphx4CkuXH_Okfpg@mail.gmail.com>
References: <D963620277BBFD4B87CF34F284738F2D3AA6F5E4@ORSMSX102.amr.corp.intel.com>
	<CAE0Sz=zu_44CTw_mf4h+pKueu8kTWyRbyuSphx4CkuXH_Okfpg@mail.gmail.com>
Message-ID: <D963620277BBFD4B87CF34F284738F2D3AA6F754@ORSMSX102.amr.corp.intel.com>

Hi Jerry,

From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Jerry Kuch
Sent: Wednesday, January 16, 2013 4:02 PM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Rabbitmq boot failure with "tables_not_present"

On Wed, Jan 16, 2013 at 11:54 AM, Zhao, Shanyu <shanyu.zhao at intel.com<mailto:shanyu.zhao at intel.com>> wrote:

The relevant part of the log is shown below. But the problem is that we saw these log messages repeated every 7-8 seconds and can last as long as 80 minutes before rabbit finally start up correctly. During this time any connection to the rabbitmq cluster will get a disconnected exception.

Any idea on what might have caused this problem?
=INFO REPORT==== 16-Jan-2013::14:11:37 ===
Error description:
   {case_clause,{error,tables_not_present}}

Log files (may contain more information):
   /var/log/rabbitmq/rabbit at ip-10-0-2-97.log<mailto:/var/log/rabbitmq/rabbit at ip-10-0-2-97.log>
   /var/log/rabbitmq/rabbit at ip-10-0-2-97-sasl.log<mailto:/var/log/rabbitmq/rabbit at ip-10-0-2-97-sasl.log>

Stack trace:
   [{rabbit_mnesia,discover_cluster,1},
    {rabbit_mnesia,init_from_config,0},
    {rabbit_mnesia,init,0},
    {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
    {rabbit,run_boot_step,1},
    {rabbit,'-start/2-lc$^0/1-0-',1},
    {rabbit,start,2},
    {application_master,start_it_old,4}]


=INFO REPORT==== 16-Jan-2013::14:11:38 ===
    application: rabbit
    exited: {bad_return,
                {{rabbit,start,[normal,[]]},
                 {'EXIT',
                     {rabbit,failure_during_boot,
                         {case_clause,{error,tables_not_present}}}}}}
type: temporary

You mention that you sometime see this after a redeploy.  Depending on how you've redeployed, have you successfully clustered the nodes in the first place?  The error means that some of the tables in Erlang's Mnesia distributed database upon which Rabbit relies to maintain broker metadata weren't found, suggesting that some prior state or configuration perished during your redeploy process.

I think during the time the error logs are generated, the cluster may not be successfully formed. As part of the deployment scripts, I deleted all content in /var/lib/rabbitmq/mnesia to recover from some scenario when cluster cannot be formed. Here is the relevant part of the deployment scripts:

sudo("bash -c 'echo XXXXXXXXXXXXXXXX > /var/lib/rabbitmq/.erlang.cookie'")
sudo("chown rabbitmq /var/lib/rabbitmq/.erlang.cookie")
sudo("chmod 600 /var/lib/rabbitmq/.erlang.cookie")
sudo("rm -fr /var/lib/rabbitmq/mnesia")

What I want to achieve after redeployment is to erase previous states completely and let the cluster starts with a clean state, that's why I erased the /mnesia folder (is there a better way to do that?). The problem is sometimes the error messages show up for a few minutes then everything works fine after that, but other times I saw the error message being logged for 80 minutes before the cluster works correctly. Do you have any suggestions?

Thanks,
Shanyu


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130117/fc2cf3d5/attachment.htm>

From jerryk at rbcon.com  Thu Jan 17 00:45:43 2013
From: jerryk at rbcon.com (Jerry Kuch)
Date: Wed, 16 Jan 2013 16:45:43 -0800
Subject: [rabbitmq-discuss] Rabbitmq boot failure with
	"tables_not_present"
In-Reply-To: <D963620277BBFD4B87CF34F284738F2D3AA6F754@ORSMSX102.amr.corp.intel.com>
References: <D963620277BBFD4B87CF34F284738F2D3AA6F5E4@ORSMSX102.amr.corp.intel.com>
	<CAE0Sz=zu_44CTw_mf4h+pKueu8kTWyRbyuSphx4CkuXH_Okfpg@mail.gmail.com>
	<D963620277BBFD4B87CF34F284738F2D3AA6F754@ORSMSX102.amr.corp.intel.com>
Message-ID: <CAE0Sz=xUPNDeQP7XyPgXR+en-4YLeVJyeQVspcRdJKiJCaSpLw@mail.gmail.com>

>
> I think during the time the error logs are generated, the cluster may not
> be successfully formed. As part of the deployment scripts, I deleted all
> content in /var/lib/rabbitmq/mnesia to recover from some scenario when
> cluster cannot be formed. Here is the relevant part of the deployment
> scripts:
>
 **
>
> sudo("bash -c 'echo XXXXXXXXXXXXXXXX > /var/lib/rabbitmq/.erlang.cookie'")
> ****
>
> sudo("chown rabbitmq /var/lib/rabbitmq/.erlang.cookie")****
>
> sudo("chmod 600 /var/lib/rabbitmq/.erlang.cookie")****
>
> sudo("rm -fr /var/lib/rabbitmq/mnesia")
>

That is indeed a fine way to get rid of your Mnesia contents including
clustering info and any metadata that needs to be shared amongst the nodes
(queue, exchange, binding, user, vhost, etc. definitions).

On the other hand, after you've done it, you've got no really good reason
to expect your nodes to act as clustered.


> ****
>
> What I want to achieve after redeployment is to erase previous states
> completely and let the cluster starts with a clean state, that?s why I
> erased the /mnesia folder (is there a better way to do that?). The problem
> is sometimes the error messages show up for a few minutes then everything
> works fine after that, but other times I saw the error message being logged
> for 80 minutes before the cluster works correctly. Do you have any
> suggestions?
>

Are you establishing your clusters using the rabbitmq command line tools or
by statically encoding their properties in your rabbitmq.config files?
 You're going to have to repeat whichever you did when you bring a newly
redeployed cluster, having gone through the cleansing you outline above,
back online.

You might consider setting up scripts to execute the appropriate commands,
as per our clustering guide, on the appropriate nodes after you've done the
scripted clean-up you describe.

Best regards,
Jerry
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130116/5bcc8503/attachment.htm>

From doug at hacks.perl.sh  Thu Jan 17 04:29:55 2013
From: doug at hacks.perl.sh (Doug)
Date: Thu, 17 Jan 2013 12:29:55 +0800
Subject: [rabbitmq-discuss] rabbitmq gets high load
Message-ID: <CAJxbUuX3ODTFCmKuYDRjPW_Jz+RA5VvY4+wZN1ajLH=xuZ=ujQ@mail.gmail.com>

  PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND
17994 rabbitmq  20   0 11.6g  10g 1764 S  367 66.2 416834:07 beam.smp

As you see, rabbitmq process has lots of system load (367% CPU, 66.2% memory).
It even can't list the queue now:

root at ubuntu:~# rabbitmqctl -p /pay list_queues
Listing queues ...
^C
BREAK: (a)bort (c)ontinue (p)roc info (i)nfo (l)oaded
       (v)ersion (k)ill (D)b-tables (d)istribution


So how to handle this case? Thanks.

From kamaradclimber at gmail.com  Thu Jan 17 07:41:56 2013
From: kamaradclimber at gmail.com (=?UTF-8?Q?Gr=C3=A9goire_Seux?=)
Date: Thu, 17 Jan 2013 08:41:56 +0100
Subject: [rabbitmq-discuss] consistent hashing plugin
In-Reply-To: <50F7028F.8080701@rabbitmq.com>
References: <CAE3ghBvo-EOQXG8s8Tr0AS2yd1QU4trD8+ThEk1Pbj44998z=w@mail.gmail.com>
	<50F6B619.2050907@comarch.pl>
	<CAE3ghBt0Sog_vM34VvTn5MGZ-LuWKitwESMHuAHXg5VQMzMHUA@mail.gmail.com>
	<50F6D604.4020604@rabbitmq.com>
	<CAE3ghBtfFMLKxCB-gtmiUYeDsmxdLaBCYwtz7Paiz9FVPm9VEA@mail.gmail.com>
	<50F7028F.8080701@rabbitmq.com>
Message-ID: <CAE3ghBtQUSvfUPzrbWn-fsV1VUdNsaDd6d7gVx6O7rzcwpbw7g@mail.gmail.com>

On Wed, Jan 16, 2013 at 8:42 PM, Matthias Radestock
<matthias at rabbitmq.com> wrote:
> Cheers. It's a bug. Triggered by the declaration of the exchanges as
> 'auto-delete'. Removing that from the test code makes the test succeed.

Ok, thanks for the feedback.
I guess you don't provide a link to the bug report because the bug
tracker is not public.
Is there any way I can be aware of any progress done on a resolution ?


--
Gr?goire

From dbmqconfig at yahoo.com  Wed Jan 16 23:24:52 2013
From: dbmqconfig at yahoo.com (dbmqconfig at yahoo.com)
Date: Wed, 16 Jan 2013 15:24:52 -0800 (PST)
Subject: [rabbitmq-discuss] Can not start Mgmt Console
Message-ID: <274b38b4-69aa-4af2-ab61-0af4b0383f0c@googlegroups.com>

I have RabbitMQ up and running and can perform the java example
 
I can not seem to be able to get the console to work
 
I isntalled RabbitMQ as follows from the RabbitMQ command prompt session
 
Microsoft Windows [Version 6.1.7601]
Copyright (c) 2009 Microsoft Corporation.  All rights reserved.
C:\Program Files (x86)\RabbitMQ 
Server\rabbitmq_server-2.8.6\sbin>rabbitmq-plugi
ns enable rabbitmq_management
The following plugins have been enabled:
  mochiweb
  webmachine
  rabbitmq_mochiweb
  amqp_client
  rabbitmq_management_agent
  rabbitmq_management
Plugin configuration has changed. Restart RabbitMQ for changes to take 
effect.
If you have RabbitMQ running as a service then you must reinstall by running
  rabbitmq-service.bat stop
  rabbitmq-service.bat install
  rabbitmq-service.bat start

C:\Program Files (x86)\RabbitMQ Server\rabbitmq_server-2.8.6\sbin>
 
So this looked good.  I made sure the Rabbitmq service on Windows was 
running, and then brought up a browser and entered both the following IPs 
at different times
 
 
http://127.0.0.1:55672/ 
 
http://127.0.0.1:15672/ 
 
Neither of these worked.  I also tried to telnet to the ip and port, with 
no luck
 
What did I do wrong.  Did I miss a step.  How can I investigate or resolve ?
 
 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130116/b4a4228f/attachment.htm>

From tim at rabbitmq.com  Thu Jan 17 09:53:08 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 17 Jan 2013 09:53:08 +0000
Subject: [rabbitmq-discuss] rabbitmq gets high load
In-Reply-To: <CAJxbUuX3ODTFCmKuYDRjPW_Jz+RA5VvY4+wZN1ajLH=xuZ=ujQ@mail.gmail.com>
References: <CAJxbUuX3ODTFCmKuYDRjPW_Jz+RA5VvY4+wZN1ajLH=xuZ=ujQ@mail.gmail.com>
Message-ID: <017025F8-9CD2-44F5-9187-DA26F96D0766@rabbitmq.com>

Hi Doug

On 17 Jan 2013, at 04:29, Doug wrote:

>  PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND
> 17994 rabbitmq  20   0 11.6g  10g 1764 S  367 66.2 416834:07 beam.smp
> 
> As you see, rabbitmq process has lots of system load (367% CPU, 66.2% memory).

Certainly looks like it. That level of CPU utilisation is a bit surprising.

> It even can't list the queue now:
> 
> root at ubuntu:~# rabbitmqctl -p /pay list_queues
> Listing queues ...
> ^C
> BREAK: (a)bort (c)ontinue (p)roc info (i)nfo (l)oaded
>       (v)ersion (k)ill (D)b-tables (d)istribution
> 
> 
> So how to handle this case? Thanks.

You've not given us much to go on here. Normally I'd ask you to run the output of `rabbitmqctl report` but that's likely to lock up just as list_queues is doing. Can you post the regular as sasl rabbit logs please? If they're too bit to post, a /paste/ url will do fine and of course you may wish to scrub the logs to remove any private information if that's relevant.

Also what kind of /usage/ is this rabbit subject to at the time? Is it serving a large number of producers, consumers, both? Have you looked at any stats around the time this starts happening in order to see what the broker is up to?

Cheers,
Tim

From tim at rabbitmq.com  Thu Jan 17 09:54:51 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 17 Jan 2013 09:54:51 +0000
Subject: [rabbitmq-discuss] Can not start Mgmt Console
In-Reply-To: <274b38b4-69aa-4af2-ab61-0af4b0383f0c@googlegroups.com>
References: <274b38b4-69aa-4af2-ab61-0af4b0383f0c@googlegroups.com>
Message-ID: <B60861B3-F66E-402E-909E-FF665671AE8E@rabbitmq.com>

Hi

On 16 Jan 2013, at 23:24, dbmqconfig at yahoo.com wrote:
> So this looked good.  I made sure the Rabbitmq service on Windows was running, and then brought up a browser and entered both the following IPs at different times
>  
> http://127.0.0.1:55672/
> http://127.0.0.1:15672/
>  
> Neither of these worked.  I also tried to telnet to the ip and port, with no luck
>  

Turn off or reconfigure your firewall.

From simon at rabbitmq.com  Thu Jan 17 10:04:24 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 17 Jan 2013 10:04:24 +0000
Subject: [rabbitmq-discuss] Can not start Mgmt Console
In-Reply-To: <274b38b4-69aa-4af2-ab61-0af4b0383f0c@googlegroups.com>
References: <274b38b4-69aa-4af2-ab61-0af4b0383f0c@googlegroups.com>
Message-ID: <50F7CCA8.9000906@rabbitmq.com>

On 16/01/13 23:24, dbmqconfig at yahoo.com wrote:
> Plugin configuration has changed. Restart RabbitMQ for changes to take
> effect.
> If you have RabbitMQ running as a service then you must reinstall by running
>    rabbitmq-service.bat stop
>    rabbitmq-service.bat install
>    rabbitmq-service.bat start
>
> C:\Program Files (x86)\RabbitMQ Server\rabbitmq_server-2.8.6\sbin>
> So this looked good.  I made sure the Rabbitmq service on Windows was
> running, and then brought up a browser and entered both the following
> IPs at different times

Did you do what the message said? Stop the service, reinstall the 
service, start the service again?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Thu Jan 17 10:04:19 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 17 Jan 2013 10:04:19 +0000
Subject: [rabbitmq-discuss] Can not start Mgmt Console
In-Reply-To: <274b38b4-69aa-4af2-ab61-0af4b0383f0c@googlegroups.com>
References: <274b38b4-69aa-4af2-ab61-0af4b0383f0c@googlegroups.com>
Message-ID: <50F7CCA3.5020207@rabbitmq.com>

On 16/01/13 23:24, dbmqconfig at yahoo.com wrote:
> If you have RabbitMQ running as a service then you must reinstall by running
>   rabbitmq-service.bat stop
>   rabbitmq-service.bat install
>   rabbitmq-service.bat start

> Did I miss a step.

You failed to mention whether you reinstalled the service. The
management plugin will not be available until you do that.

You could also check the console log to confirm which plugins have been
started. See the description of RABBITMQ_CONSOLE_LOG in
http://www.rabbitmq.com/man/rabbitmq-service.man.html

If you did reinstall the service, and you obtain confirmation of that in
the console, and it still doesn't work then check the network.




-Emile




From simon at rabbitmq.com  Thu Jan 17 10:30:58 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 17 Jan 2013 10:30:58 +0000
Subject: [rabbitmq-discuss] Rabbitmq boot failure with
	"tables_not_present"
In-Reply-To: <CAE0Sz=xUPNDeQP7XyPgXR+en-4YLeVJyeQVspcRdJKiJCaSpLw@mail.gmail.com>
References: <D963620277BBFD4B87CF34F284738F2D3AA6F5E4@ORSMSX102.amr.corp.intel.com>
	<CAE0Sz=zu_44CTw_mf4h+pKueu8kTWyRbyuSphx4CkuXH_Okfpg@mail.gmail.com>
	<D963620277BBFD4B87CF34F284738F2D3AA6F754@ORSMSX102.amr.corp.intel.com>
	<CAE0Sz=xUPNDeQP7XyPgXR+en-4YLeVJyeQVspcRdJKiJCaSpLw@mail.gmail.com>
Message-ID: <50F7D2E2.8030301@rabbitmq.com>

On 17/01/13 00:45, Jerry Kuch wrote:
> That is indeed a fine way to get rid of your Mnesia contents including
> clustering info and any metadata that needs to be shared amongst the
> nodes (queue, exchange, binding, user, vhost, etc. definitions).

Yes. You could also use 'rabbitmqctl reset'.

> On the other hand, after you've done it, you've got no really good
> reason to expect your nodes to act as clustered.

...unless you have set cluster_nodes in the configuration file.

> Are you establishing your clusters using the rabbitmq command line tools
> or by statically encoding their properties in your rabbitmq.config
> files?

The stack trace in the OP shows the latter.

Cheers, Simon


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Jan 17 10:35:04 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 17 Jan 2013 10:35:04 +0000
Subject: [rabbitmq-discuss] Rabbitmq boot failure with
	"tables_not_present"
In-Reply-To: <D963620277BBFD4B87CF34F284738F2D3AA6F5E4@ORSMSX102.amr.corp.intel.com>
References: <D963620277BBFD4B87CF34F284738F2D3AA6F5E4@ORSMSX102.amr.corp.intel.com>
Message-ID: <50F7D3D8.2050501@rabbitmq.com>

On 16/01/13 19:54, Zhao, Shanyu wrote:
> We have two rabbitmq servers to form a cluster. It mostly runs great.
> But sometimes after redeploy, we saw some boot failure error in rabbitmq
> server log.

Hi. I've reproduced the problem. In order for this to occur:

* You must be using the cluster_nodes configuration parameter
* You must stop all nodes and then fully reset them
* You must then start all nodes simultaneously

I suspect it's the latter bit which is causing this to be intermittent 
for you. I'll file a bug to get this fixed, but in the mean time if you 
could stagger the start of your cluster nodes (so that one node starts 
on its own, and then others can start simultaneously or apart) that will 
act as a workaround.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From milindchangire at gmail.com  Thu Jan 17 10:35:39 2013
From: milindchangire at gmail.com (Milind Changire)
Date: Thu, 17 Jan 2013 16:05:39 +0530
Subject: [rabbitmq-discuss] Default queue TTL when auto_delete is false on
	DeclareQueue()
Message-ID: <CANmksPSDqZmmf5XL9OiMgiiNkNCJDNJZjMXCYs5MvWY8Ej5W8w@mail.gmail.com>

Hi,
I'm using rabbitmq_server-3.0.0 on Windows XP and would like to know
the default ttl of a queue when auto_delete parameter is false when
doing a DeclareQueue().

Regards,
Milind

From simon at rabbitmq.com  Thu Jan 17 11:14:14 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 17 Jan 2013 11:14:14 +0000
Subject: [rabbitmq-discuss] How to use federation with clustering for
 best HA-behaviour?
In-Reply-To: <op.wq0l07ich82nkl@e778e7d1af99b9.eemea.ericsson.se>
References: <op.wq0l07ich82nkl@e778e7d1af99b9.eemea.ericsson.se>
Message-ID: <50F7DD06.1020601@rabbitmq.com>

On 16/01/13 17:40, Adam Aquilon wrote:
> I'm trying to understand how to achieve the best possible High
> Availability-setup with RabbitMQ. The documentation seems to say
> that I don't need to mirror the queues created by the federation
> plugin, but then I don't get uninterrupted traffic.

Oh, the queues used by federation are not magic - if you need them to 
work in case of node failure in a cluster then they should be mirrored.

> Once I created a policy that included "ha-mode":"all" for federated
> queues, I could crash single cluster nodes with no interruption in
> traffic. Did I misunderstand the documentation or is there something
> else going on here?

No, you understand right. Where in the documentation did it say that? I 
can't see anything obvious but I might be suffering from familiarity 
blindness.

> Background:
>
> Currently, I have six test nodes running on my linux box, arranged
> in three clusters of two nodes each: {n1,n2}, {n3,n4} and {n5,n6}.
>
> The clusters are called "kista", "linkoping" and "lindholmen"
> respectively. They are meant to represent different sites.
> For the details, please see the end of this email which has
> output from rabbitmqadmin.
>
> I've defined separate upstreams and upstream-sets for each one-way
> link between clusters. (Is that the way to do it?)

I see that you are using upstream sets to get redundancy in federation 
links - that's not really what they're intended for (we expect each 
upstream in an upstream set to point to a different cluster), so this 
will lead to message ordering getting broken as both upstreams connect 
to the same queue simultaneously.

However, there's no way at the moment for an upstream to point to 
multiple cluster nodes, with the intention of connecting to exactly one 
of them, so I don't think you have a choice. There should be though; I 
have filed a bug to do this.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Jan 17 11:20:42 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 17 Jan 2013 11:20:42 +0000
Subject: [rabbitmq-discuss] two factor authentication with tokens
In-Reply-To: <F7BDE79D91E94E498C3C29F088B09A13@gmail.com>
References: <e3be344f-3c2f-4866-8157-38f736ee63c6@googlegroups.com>
	<CAE0Sz=xJzJp5C76SWMXXY7-1mjG4_3+zP2aC3wtvTy2vfs7rdg@mail.gmail.com>
	<BE2DB2BAD46C49BDB96B62901C13D607@gmail.com>
	<50F02967.6080208@rabbitmq.com>
	<A72183C2BA7B40AD9FA3E607B3D765AC@gmail.com>
	<CAE0Sz=ztd-xTR-eyzxFFgfxYXoCoT+UjH2hGgMZZW8Bko=c2+w@mail.gmail.com>
	<43B9E94D78F648D5AD89312192B7414C@gmail.com>
	<F7BDE79D91E94E498C3C29F088B09A13@gmail.com>
Message-ID: <50F7DE8A.3050400@rabbitmq.com>

Yes, but that shouldn't be too problematic - while all our auth 
mechanisms invoke rabbit_access_control:check_user_pass_login/2 or 
similar (which ends up looking up and driving auth backends), you could 
write an auth mechanism which either drives an auth backend directly, or 
contains its own auth backend. Then it can do whatever it wants - the 
contract of an auth mechanism is to reject login or provide a user.

Cheers, Simon

On 15/01/13 10:31, Ben Hood wrote:
> Thinking about this a little further, what I am proposing with encoding
> a vhost based challenge in the SASL mechanism would then make the
> subsequent vhost authorization liable to be hi-jacked by a client that
> declares itself in the SASL challenge to want to access the low security
> (non-2FA vhost) and only supply 1FA, but then in the ConnectionOpen
> frame it could freely request to access the 2FA vhost.
>
> So maybe this conditional execution is not so cool from a security
> perspective, unless you somehow patch the whole handshake to prevent the
> vhost from being forged.
>
> On Tuesday, 15 January 2013 at 09:33, Ben Hood wrote:
>
>> In addition to the previous questions, is it possible to configure the
>> auth challenge on the broker side to be vhost specific? For example,
>> clients connecting to vhost 1 should be taken down the aforementioned
>> LDAP + Radius path, but clients connecting to vhost 2 can just be
>> authenticated with a plain LDAP lookup.
>>
>> Or does the SASL handshake occur before the client presents the target
>> vhost to the broker - in which case I presume you would have to
>> encapsulate this information into the custom SASL mechanism and
>> evaluate it selectively in the custom auth plugin that wraps Radius
>> and LDAP (as discussed previously)?
>>
>> On Friday, 11 January 2013 at 18:02, Jerry Kuch wrote:
>>
>>>
>>>
>>> On Fri, Jan 11, 2013 at 9:47 AM, Ben Hood <0x6e6562 at gmail.com
>>> <mailto:0x6e6562 at gmail.com>> wrote:
>>>>
>>>> Can this also be made to work in conjunction with an LDAP provider,
>>>> i.e. by chaining the supported LDAP backend with a custom backend to
>>>> additionally validate the the token? I wondering whether you can
>>>> require the client to answer both a username/password challenge
>>>> (evaluated by the supported LDAP auth backend) as well as having the
>>>> token checked by the the custom backend? Does the protocol and
>>>> wiring flow allow for the LDAP backend to get re-used in this way or
>>>> would you need to implement the custom backend that wraps the lookup
>>>> against the LDAP directory and the lookup against the Radius server?
>>>
>>> If I recall correctly, one backend or the other would have to know
>>> about the other one and take care of the chaining rather than
>>> something like this being possible in the Rabbit configuration.  The
>>> backend chosen to go with a given connection is basically the first
>>> one in the rabbitmq.config file's list of backends that succeeds as
>>> they're tried in order, and is bound irrevocably to that session
>>> thereafter.
>>>
>>> Pursuing this outcome you might be able to call into specific parts
>>> of the LDAP backend as helpers, but a good hunk of your hybrid auth
>>> logic would be in your plugin itself.
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From ninuhadida at gmail.com  Thu Jan 17 12:26:33 2013
From: ninuhadida at gmail.com (Jean Paul Galea)
Date: Thu, 17 Jan 2013 13:26:33 +0100
Subject: [rabbitmq-discuss] Increasing the file descriptors limit
Message-ID: <50F7EDF9.9060509@gmail.com>

Hi,

We have made a fresh install of RabbitMQ on a two machine cluster. Both 
machines are running the following software;

Ubuntu 12.04.1 LTS
RabbitMQ 3.0.1
Erlang R15B03

We're trying to increase the file descriptors limits for RabbitMQ to no 
avail. Here's what we did;

~# # check the current nofile value
~# su rabbitmq -s /bin/sh -c 'ulimit -n'
1024

~# # set soft,hard nofile limit for 'rabbitmq' user to 102400
~# cat >> /etc/security/limits.conf << "EOF"
rabbitmq	-	nofile	102400
EOF

~# # pam_limits.so is required for limits.conf to take affect
~# cat >> /etc/pam.d/common-session << "EOF"
session	required	pam_limits.so
EOF

~# # verifies new setting
~# su rabbitmq -s /bin/sh -c 'ulimit -n'
102400

However, RabbitMQ fails to start up with this limit. We have tried 
restarting the RabbitMQ service and also a system reboot.

~# rabbitmqctl status
  {file_descriptors,
 
[{total_limit,924},{total_used,3},{sockets_limit,829},{sockets_used,1}]},

~# rabbitmqctl eval 'proplists:get_value(max_fds, 
erlang:system_info(check_io)).'
1024
...done.

~# su rabbitmq -s /bin/sh -c "rabbitmqctl eval 
'proplists:get_value(max_fds, erlang:system_info(check_io)).'"
1024
...done.

In the log file there appears to be no warnings or errors either:

=INFO REPORT==== 17-Jan-2013::11:46:58 ===
Starting RabbitMQ 3.0.1 on Erlang R15B03

=INFO REPORT==== 17-Jan-2013::11:46:58 ===
Limiting to approx 924 file handles (829 sockets)

Anyone run into the same issue? Perhaps we're missing a small detail?

Thanks,
Jean Paul

From adam.aquilon at ericsson.com  Thu Jan 17 12:39:58 2013
From: adam.aquilon at ericsson.com (Adam Aquilon)
Date: Thu, 17 Jan 2013 13:39:58 +0100
Subject: [rabbitmq-discuss] How to use federation with clustering for
 best HA-behaviour?
In-Reply-To: <50F7DD06.1020601@rabbitmq.com>
References: <op.wq0l07ich82nkl@e778e7d1af99b9.eemea.ericsson.se>
	<50F7DD06.1020601@rabbitmq.com>
Message-ID: <op.wq12swt0h82nkl@e778e7d1af99b9.eemea.ericsson.se>

On Thu, 17 Jan 2013 12:14:14 +0100, Simon MacMullen <simon at rabbitmq.com> wrote:

> Oh, the queues used by federation are not magic - if you need them to
> work in case of node failure in a cluster then they should be mirrored.

Ah, good!

In the federation plugin docs (http://www.rabbitmq.com/federation.html)
it says:

"ha-policy
  Determines the "x-ha-policy" argument for the upstream queue (see expires). This is only of interest when connecting to old brokers which determine queue HA mode using this argument. Default is 'none', meaning the queue is not HA."

So what it says is not entirely true -- you also need it for "federation
HA" behaviour.


> No, you understand right. Where in the documentation did it say that? I
> can't see anything obvious but I might be suffering from familiarity
> blindness.

Hmm, I just tried to find it, but I've read so many forums and comments
so it might have been some non-official post somewhere, but I'm pretty
sure it was made by someone associated with Rabbit or I wouldn't have
relied on it. Although, when I think about it, I probably didn't check
on the age of the post so maybe the comment was valid for an earlier
RabbitMQ version.

(I also forgot to mention that I'm running 3.0.1.)


> I see that you are using upstream sets to get redundancy in federation
> links - that's not really what they're intended for (we expect each
> upstream in an upstream set to point to a different cluster), so this
> will lead to message ordering getting broken as both upstreams connect
> to the same queue simultaneously.

Hmm, that is a problem for us. Message ordering is important.

(My simple test setup didn't take message ordering into account.)


> However, there's no way at the moment for an upstream to point to
> multiple cluster nodes, with the intention of connecting to exactly one
> of them, so I don't think you have a choice. There should be though.

Is there some whitepaper or similar that describes in more detail how
the federation plugin (and/or RabbitMQ) handles single-node failures?

(I'm Erlang literate, so I could perhaps look at the code. But code
usually takes a while to decipher so it would be quicker if there was
a 'shortcut'. :-)


> I have filed a bug to do this.

Thank you!  I'm hoping for a quick solution, as we are currently in the
process of choosing a message broker for internal CI use and as a fan
of Erlang, I'd rather use RabbitMQ. :-)


BTW, you wouldn't happen to have some tips on how to do upgrades without
downtime?

I've studied the documentation for clustered installations and it seems
you don't use the Erlang facilities for 'upgrading on the fly' and that
any upgrade *will* require downtime. (A problem for any company, but
especially for a large one...)


Kind regards,
Adam A.

From tim at rabbitmq.com  Thu Jan 17 12:47:39 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 17 Jan 2013 12:47:39 +0000
Subject: [rabbitmq-discuss] Increasing the file descriptors limit
In-Reply-To: <50F7EDF9.9060509@gmail.com>
References: <50F7EDF9.9060509@gmail.com>
Message-ID: <950778A4-3C22-4A26-A4F6-B8EE80D54CF9@rabbitmq.com>

Hi 

On 17 Jan 2013, at 12:26, Jean Paul Galea wrote:
> We're trying to increase the file descriptors limits for RabbitMQ to no avail. Here's what we did;
> 
> ~# # check the current nofile value
> ~# su rabbitmq -s /bin/sh -c 'ulimit -n'
> 1024
> 
> ~# # set soft,hard nofile limit for 'rabbitmq' user to 102400
> ~# cat >> /etc/security/limits.conf << "EOF"
> rabbitmq	-	nofile	102400
> EOF
> 

Don't you need to change /etc/sysctl.conf as well?

> ~# # pam_limits.so is required for limits.conf to take affect
> ~# cat >> /etc/pam.d/common-session << "EOF"
> session	required	pam_limits.so
> EOF
> 
> ~# # verifies new setting
> ~# su rabbitmq -s /bin/sh -c 'ulimit -n'
> 102400
> 

Hmn, does `sysctl fs.file-max` return the same?

> However, RabbitMQ fails to start up with this limit. We have tried restarting the RabbitMQ service and also a system reboot.
> 
> ~# rabbitmqctl status
> {file_descriptors,
> [{total_limit,924},{total_used,3},{sockets_limit,829},{sockets_used,1}]},
> 
> ~# rabbitmqctl eval 'proplists:get_value(max_fds, erlang:system_info(check_io)).'
> 1024
> ...done.

Was erlang compiled with epoll support enabled? Erlang will fall back on 'select' if it can't find/use epoll or if epoll is not enabled during compilation, and that will leave you with max 1024 fd limit, regardless of what the OS will allow.


From tim at rabbitmq.com  Thu Jan 17 12:52:16 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 17 Jan 2013 12:52:16 +0000
Subject: [rabbitmq-discuss] How to use federation with clustering for
	best HA-behaviour?
In-Reply-To: <op.wq12swt0h82nkl@e778e7d1af99b9.eemea.ericsson.se>
References: <op.wq0l07ich82nkl@e778e7d1af99b9.eemea.ericsson.se>
	<50F7DD06.1020601@rabbitmq.com>
	<op.wq12swt0h82nkl@e778e7d1af99b9.eemea.ericsson.se>
Message-ID: <29A5C876-61D1-4EC2-98EC-0158A8B5DCE9@rabbitmq.com>

Hi  Adam
On 17 Jan 2013, at 12:39, Adam Aquilon wrote:
> In the federation plugin docs (http://www.rabbitmq.com/federation.html)
> it says:
> 
> "ha-policy
> Determines the "x-ha-policy" argument for the upstream queue (see expires). This is only of interest when connecting to old brokers which determine queue HA mode using this argument. Default is 'none', meaning the queue is not HA."
> 
> So what it says is not entirely true -- you also need it for "federation
> HA" behaviour.
> 

If I'm not mistaken then this won't work when the upstream broker is running a 3.x version. You'll need to enable x-ha-policy *on the broker* as passing this as a queue argument no longer works.  

> BTW, you wouldn't happen to have some tips on how to do upgrades without
> downtime?
> 
> I've studied the documentation for clustered installations and it seems
> you don't use the Erlang facilities for 'upgrading on the fly' and that
> any upgrade *will* require downtime. (A problem for any company, but
> especially for a large one...)
> 

There isn't any support for this at the moment and I don't know of any plans to do so. A load balancer and warm standby using HA is probably the simplest way to deal with this.

From ninuhadida at gmail.com  Thu Jan 17 12:57:32 2013
From: ninuhadida at gmail.com (Jean Paul Galea)
Date: Thu, 17 Jan 2013 13:57:32 +0100
Subject: [rabbitmq-discuss] Increasing the file descriptors limit
In-Reply-To: <950778A4-3C22-4A26-A4F6-B8EE80D54CF9@rabbitmq.com>
References: <50F7EDF9.9060509@gmail.com>
	<950778A4-3C22-4A26-A4F6-B8EE80D54CF9@rabbitmq.com>
Message-ID: <50F7F53C.6030900@gmail.com>

On 01/17/2013 01:47 PM, Tim Watson wrote:
> Don't you need to change /etc/sysctl.conf as well?

Not sure, but re. your next question;

> Hmn, does `sysctl fs.file-max` return the same?

~# sysctl fs.file-max
fs.file-max = 6513989

~# cat /proc/sys/fs/file-max
6513989

~# cat /proc/sys/fs/file-nr
416	0	6513989

So I assume we don't need to change /etc/sysctl.conf since the maximum 
limit is much higher than the 102400 we're trying to allocate for RabbitMQ.


> Was erlang compiled with epoll support enabled? Erlang will fall back on 'select' if it can't find/use epoll or if epoll is not enabled during compilation, and that will leave you with max 1024 fd limit, regardless of what the OS will allow.

We installed Erlang using the esl-erlang package from erlang-solutions. 
How can I check if epoll support is enabled? I'm not very Erlang 
literate I'm afraid.

Thanks.

From tim at rabbitmq.com  Thu Jan 17 13:01:06 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 17 Jan 2013 13:01:06 +0000
Subject: [rabbitmq-discuss] Increasing the file descriptors limit
In-Reply-To: <50F7F53C.6030900@gmail.com>
References: <50F7EDF9.9060509@gmail.com>
	<950778A4-3C22-4A26-A4F6-B8EE80D54CF9@rabbitmq.com>
	<50F7F53C.6030900@gmail.com>
Message-ID: <8651BE05-6E8E-486E-A81E-5F1C02FE6966@rabbitmq.com>

Hi Jean

On 17 Jan 2013, at 12:57, Jean Paul Galea wrote:
> 
> We installed Erlang using the esl-erlang package from erlang-solutions. How can I check if epoll support is enabled? I'm not very Erlang literate I'm afraid.
> 

No problem at all. Just run `erl` and post back what the banner says. Mine looks like this:

t4 at iske:distributed-process $ erl
Erlang R15B01 (erts-5.9.1) [source] [64-bit] [smp:4:4] [async-threads:0] [hipe] [kernel-poll:false] [lock-counting]

Eshell V5.9.1  (abort with ^G)
1> 
BREAK: (a)bort (c)ontinue (p)roc info (i)nfo (l)oaded
       (v)ersion (k)ill (D)b-tables (d)istribution
a

Note that I'm on a mac, where kernel-poll is not supported by Erlang at all. On other *nix based systems this should say 'true' if the emulator was built with epoll (or kqueue, i.e., on bsd) support enabled.


From matthias at rabbitmq.com  Thu Jan 17 13:01:35 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 17 Jan 2013 13:01:35 +0000
Subject: [rabbitmq-discuss] consistent hashing plugin
In-Reply-To: <CAE3ghBtQUSvfUPzrbWn-fsV1VUdNsaDd6d7gVx6O7rzcwpbw7g@mail.gmail.com>
References: <CAE3ghBvo-EOQXG8s8Tr0AS2yd1QU4trD8+ThEk1Pbj44998z=w@mail.gmail.com>
	<50F6B619.2050907@comarch.pl>
	<CAE3ghBt0Sog_vM34VvTn5MGZ-LuWKitwESMHuAHXg5VQMzMHUA@mail.gmail.com>
	<50F6D604.4020604@rabbitmq.com>
	<CAE3ghBtfFMLKxCB-gtmiUYeDsmxdLaBCYwtz7Paiz9FVPm9VEA@mail.gmail.com>
	<50F7028F.8080701@rabbitmq.com>
	<CAE3ghBtQUSvfUPzrbWn-fsV1VUdNsaDd6d7gVx6O7rzcwpbw7g@mail.gmail.com>
Message-ID: <50F7F62F.4030405@rabbitmq.com>

Gr?goire,

On 17/01/13 07:41, Gr?goire Seux wrote:
> Is there any way I can be aware of any progress done on a resolution ?

The bug will be fixed in the next point release.

Presumably this bug isn't a real problem for you, unless you need 
short-lived exchanges, which is fairly unusual.

Matthias.


From ninuhadida at gmail.com  Thu Jan 17 13:06:22 2013
From: ninuhadida at gmail.com (Jean Paul Galea)
Date: Thu, 17 Jan 2013 14:06:22 +0100
Subject: [rabbitmq-discuss] Increasing the file descriptors limit
In-Reply-To: <8651BE05-6E8E-486E-A81E-5F1C02FE6966@rabbitmq.com>
References: <50F7EDF9.9060509@gmail.com>
	<950778A4-3C22-4A26-A4F6-B8EE80D54CF9@rabbitmq.com>
	<50F7F53C.6030900@gmail.com>
	<8651BE05-6E8E-486E-A81E-5F1C02FE6966@rabbitmq.com>
Message-ID: <50F7F74E.7000802@gmail.com>

On 01/17/2013 02:01 PM, Tim Watson wrote:
> No problem at all. Just run `erl` and post back what the banner says. Mine looks like this:
>
> t4 at iske:distributed-process $ erl
> Erlang R15B01 (erts-5.9.1) [source] [64-bit] [smp:4:4] [async-threads:0] [hipe] [kernel-poll:false] [lock-counting]
>
> Eshell V5.9.1  (abort with ^G)
> 1>
> BREAK: (a)bort (c)ontinue (p)roc info (i)nfo (l)oaded
>         (v)ersion (k)ill (D)b-tables (d)istribution
> a
>
> Note that I'm on a mac, where kernel-poll is not supported by Erlang at all. On other *nix based systems this should say 'true' if the emulator was built with epoll (or kqueue, i.e., on bsd) support enabled.

Hi Tim,

Here's the output:

~# erl
Erlang R15B03 (erts-5.9.3.1) [source] [64-bit] [smp:8:8] 
[async-threads:0] [hipe] [kernel-poll:false]

Eshell V5.9.3.1  (abort with ^G)
1>
BREAK: (a)bort (c)ontinue (p)roc info (i)nfo (l)oaded
        (v)ersion (k)ill (D)b-tables (d)istribution
a

So that unfortunately confirms that epoll is not enabled. Any hints on 
how to change this? Is it configurable or do we have to compile the 
package ourselves?

Thanks,
Jean Paul

From michael.s.klishin at gmail.com  Thu Jan 17 13:13:56 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 17 Jan 2013 17:13:56 +0400
Subject: [rabbitmq-discuss] Default queue TTL when auto_delete is false
	on DeclareQueue()
In-Reply-To: <CANmksPSDqZmmf5XL9OiMgiiNkNCJDNJZjMXCYs5MvWY8Ej5W8w@mail.gmail.com>
References: <CANmksPSDqZmmf5XL9OiMgiiNkNCJDNJZjMXCYs5MvWY8Ej5W8w@mail.gmail.com>
Message-ID: <CAE3HoVRUQA0mSH+0vFvnRL6PGFCk7AA4CvZeExYaPWsY3GP3dA@mail.gmail.com>

2013/1/17 Milind Changire <milindchangire at gmail.com>

> I'm using rabbitmq_server-3.0.0 on Windows XP and would like to know
> the default ttl of a queue when auto_delete parameter is false when
> doing a DeclareQueue()
>

Milind,

There is no default TTL.

Automatically deleted queues are deleted when the last consumer is
cancelled (removed).
Exclusive queues are deleted when the connection that declared them is
closed.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130117/128a66c7/attachment.htm>

From 0x6e6562 at gmail.com  Thu Jan 17 13:17:13 2013
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Thu, 17 Jan 2013 13:17:13 +0000
Subject: [rabbitmq-discuss] two factor authentication with tokens
In-Reply-To: <50F7DE8A.3050400@rabbitmq.com>
References: <e3be344f-3c2f-4866-8157-38f736ee63c6@googlegroups.com>
	<CAE0Sz=xJzJp5C76SWMXXY7-1mjG4_3+zP2aC3wtvTy2vfs7rdg@mail.gmail.com>
	<BE2DB2BAD46C49BDB96B62901C13D607@gmail.com>
	<50F02967.6080208@rabbitmq.com>
	<A72183C2BA7B40AD9FA3E607B3D765AC@gmail.com>
	<CAE0Sz=ztd-xTR-eyzxFFgfxYXoCoT+UjH2hGgMZZW8Bko=c2+w@mail.gmail.com>
	<43B9E94D78F648D5AD89312192B7414C@gmail.com>
	<F7BDE79D91E94E498C3C29F088B09A13@gmail.com>
	<50F7DE8A.3050400@rabbitmq.com>
Message-ID: <B533B714551F42F1BB731B72FFADAB48@gmail.com>

Hey Simon, 


On Thursday, 17 January 2013 at 11:20, Simon MacMullen wrote:

> Yes, but that shouldn't be too problematic - while all our auth 
> mechanisms invoke rabbit_access_control:check_user_pass_login/2 or 
> similar (which ends up looking up and driving auth backends), you could 
> write an auth mechanism which either drives an auth backend directly, or 
> contains its own auth backend. Then it can do whatever it wants - the 
> contract of an auth mechanism is to reject login or provide a user.


Since I posted a number of times into this thread, I'm not sure which question you are answering here. My latest question was about the fact that I could encode the
username;
password;
vhost;
(optional) radius token, depending on whether the specified vhost is subject to a extra token verification or not;

into the SASL payload and my custom rabbit_auth_mechanism would decode this, and decide based on the vhost supplied whether to perform a lookup on the token. All of this is up to this custom implementation.

What I don't understand about your observation may stem from my misunderstanding the flow of the handshake during AMQP connection establishment. I was assuming that due to the sequence of AMQP frames defined in the protocol, Rabbit would initially delegate the authentication to my custom rabbit_auth_mechanism, which could present vhost X. Once this callback has successfully done everything it needs to do and returns a user back to Rabbit, then the client would be able to send a connection.open frame. At this point, the client could potentially encode vhost Y into that frame, and hence effectively by-pass the logic of the custom rabbit_auth_mechanism.

Maybe I'm missing the point here.

Having said all of this, in the meantime I've come up with an alternative solution - just run separate Rabbit instances for each vhost.

Cheers,

Ben




-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130117/32f00bf1/attachment.htm>

From ninuhadida at gmail.com  Thu Jan 17 13:20:36 2013
From: ninuhadida at gmail.com (Jean Paul Galea)
Date: Thu, 17 Jan 2013 14:20:36 +0100
Subject: [rabbitmq-discuss] Increasing the file descriptors limit
In-Reply-To: <50F7F74E.7000802@gmail.com>
References: <50F7EDF9.9060509@gmail.com>
	<950778A4-3C22-4A26-A4F6-B8EE80D54CF9@rabbitmq.com>
	<50F7F53C.6030900@gmail.com>
	<8651BE05-6E8E-486E-A81E-5F1C02FE6966@rabbitmq.com>
	<50F7F74E.7000802@gmail.com>
Message-ID: <50F7FAA4.3070301@gmail.com>

On 01/17/2013 02:06 PM, Jean Paul Galea wrote:
> Hi Tim,
>
> Here's the output:
>
> ~# erl
> Erlang R15B03 (erts-5.9.3.1) [source] [64-bit] [smp:8:8]
> [async-threads:0] [hipe] [kernel-poll:false]
>
> Eshell V5.9.3.1 (abort with ^G)
> 1>
> BREAK: (a)bort (c)ontinue (p)roc info (i)nfo (l)oaded
> (v)ersion (k)ill (D)b-tables (d)istribution
> a
>
> So that unfortunately confirms that epoll is not enabled. Any hints on
> how to change this? Is it configurable or do we have to compile the
> package ourselves?
>
> Thanks,
> Jean Paul


I think I know what needs to be done. From `man erl`:

+K true | false:
Enables  or  disables  the kernel poll functionality if the emulator 
supports it. Default is false (disabled). If the emulator does not 
support kernel poll, and the +K flag is passed to the emulator, a 
warning is issued at startup.

So it's a question of seeing how erlang is started when rabbitmq-server 
is initiated.

Will post back if I come up with a solution.

From tim at rabbitmq.com  Thu Jan 17 13:22:16 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 17 Jan 2013 13:22:16 +0000
Subject: [rabbitmq-discuss] Increasing the file descriptors limit
In-Reply-To: <50F7FAA4.3070301@gmail.com>
References: <50F7EDF9.9060509@gmail.com>
	<950778A4-3C22-4A26-A4F6-B8EE80D54CF9@rabbitmq.com>
	<50F7F53C.6030900@gmail.com>
	<8651BE05-6E8E-486E-A81E-5F1C02FE6966@rabbitmq.com>
	<50F7F74E.7000802@gmail.com> <50F7FAA4.3070301@gmail.com>
Message-ID: <E75F6936-2E45-43B7-ACE1-318B1015663A@rabbitmq.com>

Hi Jean,

Simon has just pointed out that he's able to get max_fd > 1024 without kernel poll enabled. It seems that the 'kernel-poll' indication in the banner might refer to the scheduling rather than the raw limit available to the vm, so this may have been a red herring. Sorry about that!

You might want to try setting ERL_MAX_PORTS - http://erlang.org/doc/man/erlang.html#ERL_MAX_PORTS. And make sure that the ulimit really is working for the shell your rabbit is running in.

Cheers,
Tim

On 17 Jan 2013, at 13:20, Jean Paul Galea wrote:

> On 01/17/2013 02:06 PM, Jean Paul Galea wrote:
>> Hi Tim,
>> 
>> Here's the output:
>> 
>> ~# erl
>> Erlang R15B03 (erts-5.9.3.1) [source] [64-bit] [smp:8:8]
>> [async-threads:0] [hipe] [kernel-poll:false]
>> 
>> Eshell V5.9.3.1 (abort with ^G)
>> 1>
>> BREAK: (a)bort (c)ontinue (p)roc info (i)nfo (l)oaded
>> (v)ersion (k)ill (D)b-tables (d)istribution
>> a
>> 
>> So that unfortunately confirms that epoll is not enabled. Any hints on
>> how to change this? Is it configurable or do we have to compile the
>> package ourselves?
>> 
>> Thanks,
>> Jean Paul
> 
> 
> I think I know what needs to be done. From `man erl`:
> 
> +K true | false:
> Enables  or  disables  the kernel poll functionality if the emulator supports it. Default is false (disabled). If the emulator does not support kernel poll, and the +K flag is passed to the emulator, a warning is issued at startup.
> 
> So it's a question of seeing how erlang is started when rabbitmq-server is initiated.
> 
> Will post back if I come up with a solution.


From simon at rabbitmq.com  Thu Jan 17 13:39:01 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 17 Jan 2013 13:39:01 +0000
Subject: [rabbitmq-discuss] Increasing the file descriptors limit
In-Reply-To: <50F7EDF9.9060509@gmail.com>
References: <50F7EDF9.9060509@gmail.com>
Message-ID: <50F7FEF5.8070702@rabbitmq.com>

On 17/01/13 12:26, Jean Paul Galea wrote:
> ~# # set soft,hard nofile limit for 'rabbitmq' user to 102400
> ~# cat >> /etc/security/limits.conf << "EOF"
> rabbitmq    -    nofile    102400
> EOF
>
> ~# # pam_limits.so is required for limits.conf to take affect
> ~# cat >> /etc/pam.d/common-session << "EOF"
> session    required    pam_limits.so
> EOF

Hi Jean Paul. On Ubuntu / Debian we now start RabbitMQ with 
start-stop-daemon, which quite explicitly does *not* start a new PAM 
session, so the second change you made did does not take effect.

http://superuser.com/questions/454465/make-ulimits-work-with-start-stop-daemon

discusses this issue (in non-RabbitMQ-specific terms).

The best thing you can do is add a line to /etc/security/limits.conf for 
*root* - the RabbitMQ service will then inherit this.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From videlalvaro at gmail.com  Thu Jan 17 14:59:48 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Thu, 17 Jan 2013 15:59:48 +0100
Subject: [rabbitmq-discuss] [ANN] php-amqplib v.2.0.0 is released
Message-ID: <CAMcAHLWy_a1XWV9tZvqxaRuHwQpvBQoArTFkae899nmHCgBggA@mail.gmail.com>

Hi,

I've released a new version of the library php-amqplib with support for
AMQP 0.9.1 (better late than never they said).

The library also support some RabbitMQ extensions like exchange to exchange
bindings and nack, besides, extensions that don't require new methods like
alternate exchanges are supported.

You shouldn't need to modify your code to use the new protocol version,
nevertheless check the library README for more details on BC breaking
changes.

The new version is already available on the composer website:

https://packagist.org/packages/videlalvaro/php-amqplib

To install it add the following to the "require" entry from composer.json

You can also obtain the source code here:

https://github.com/videlalvaro/php-amqplib/

If you find any bugs please report them here:
https://github.com/videlalvaro/php-amqplib/issues

Regards,

Alvaro
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130117/29ebb26a/attachment.htm>

From prabodh.upreti at vce.com  Thu Jan 17 15:22:54 2013
From: prabodh.upreti at vce.com (Prabodh Upreti)
Date: Thu, 17 Jan 2013 07:22:54 -0800 (PST)
Subject: [rabbitmq-discuss] log rotate validation
Message-ID: <1358436174256-24530.post@n5.nabble.com>

Hello

I need to make sure logrotate for rabbitmq is working as configured on our
custom rabbitmq-server config.  I need to a way to fill up the rabbitmq logs
and see if things are working as expected.  Anything I can do to simulate
that.  Looks like just publishing messages does not do anything.  thank you.





--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/log-rotate-validation-tp24530.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From simon at rabbitmq.com  Thu Jan 17 15:34:41 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 17 Jan 2013 15:34:41 +0000
Subject: [rabbitmq-discuss] log rotate validation
In-Reply-To: <1358436174256-24530.post@n5.nabble.com>
References: <1358436174256-24530.post@n5.nabble.com>
Message-ID: <50F81A11.8010408@rabbitmq.com>

On 17/01/13 15:22, Prabodh Upreti wrote:
> I need to a way to fill up the rabbitmq logs
> and see if things are working as expected.  Anything I can do to simulate
> that.  Looks like just publishing messages does not do anything.

Probably your best bet is to open / close connections in a loop; by 
default that gets logged.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Jan 17 16:07:15 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 17 Jan 2013 16:07:15 +0000
Subject: [rabbitmq-discuss] two factor authentication with tokens
In-Reply-To: <B533B714551F42F1BB731B72FFADAB48@gmail.com>
References: <e3be344f-3c2f-4866-8157-38f736ee63c6@googlegroups.com>
	<CAE0Sz=xJzJp5C76SWMXXY7-1mjG4_3+zP2aC3wtvTy2vfs7rdg@mail.gmail.com>
	<BE2DB2BAD46C49BDB96B62901C13D607@gmail.com>
	<50F02967.6080208@rabbitmq.com>
	<A72183C2BA7B40AD9FA3E607B3D765AC@gmail.com>
	<CAE0Sz=ztd-xTR-eyzxFFgfxYXoCoT+UjH2hGgMZZW8Bko=c2+w@mail.gmail.com>
	<43B9E94D78F648D5AD89312192B7414C@gmail.com>
	<F7BDE79D91E94E498C3C29F088B09A13@gmail.com>
	<50F7DE8A.3050400@rabbitmq.com>
	<B533B714551F42F1BB731B72FFADAB48@gmail.com>
Message-ID: <50F821B3.3080001@rabbitmq.com>

On 17/01/13 13:17, Ben Hood wrote:
> What I don't understand about your observation may stem from my
> misunderstanding the flow of the handshake during AMQP connection
> establishment. I was assuming that due to the sequence of AMQP frames
>  defined in the protocol, Rabbit would initially delegate the
> authentication to my custom rabbit_auth_mechanism, which could
> present vhost X. Once this callback has successfully done everything
> it needs to do and returns a user back to Rabbit, then the client
> would be able to send a connection.open frame. At this point, the
> client could potentially encode vhost Y into that frame, and hence
> effectively by-pass the logic of the custom rabbit_auth_mechanism.

Well, assuming you have a rabbit_auth_mechanism and a
rabbit_auth_backend that know about each other, you can have your
rabbit_auth_mechanism return a #user{} containing knowledge of how
authentication was done, and the rabbit_auth_backend could then
reference this when checking whether to allow vhost access. So you can't
determine the auth mechanism based on the vhost (as you state, the
protocol does not allow that) but you can ensure that invalid auth
mechanism / vhost combinations don't grant access, which is the
important bit.

> Having said all of this, in the meantime I've come up with an
> alternative solution - just run separate Rabbit instances for each
> vhost.

...but this is of course simpler.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From ninuhadida at gmail.com  Thu Jan 17 16:25:37 2013
From: ninuhadida at gmail.com (Jean Paul Galea)
Date: Thu, 17 Jan 2013 17:25:37 +0100
Subject: [rabbitmq-discuss] Increasing the file descriptors limit
In-Reply-To: <50F7FEF5.8070702@rabbitmq.com>
References: <50F7EDF9.9060509@gmail.com> <50F7FEF5.8070702@rabbitmq.com>
Message-ID: <50F82601.4030906@gmail.com>

On 01/17/2013 02:39 PM, Simon MacMullen wrote:
> Hi Jean Paul. On Ubuntu / Debian we now start RabbitMQ with
> start-stop-daemon, which quite explicitly does *not* start a new PAM
> session, so the second change you made did does not take effect.
>
> http://superuser.com/questions/454465/make-ulimits-work-with-start-stop-daemon
>
>
> discusses this issue (in non-RabbitMQ-specific terms).
>
> The best thing you can do is add a line to /etc/security/limits.conf for
> *root* - the RabbitMQ service will then inherit this.
>
> Cheers, Simon

Hi Simon and Tim,

Apparently I was complicating the whole issue.

There is no need to edit any files such as /etc/security/limits.conf or 
/etc/pam.d/common-session.

Only the following needs to be done:

cat > /etc/default/rabbitmq-server << "EOF"
# This file is sourced by /etc/init.d/rabbitmq-server. Its primary
# reason for existing is to allow adjustment of system limits for the
# rabbitmq-server process.
#
# Maximum number of open file handles. This will need to be increased
# to handle many simultaneous connections. Refer to the system
# documentation for ulimit (in man bash) for more information.
#
ulimit -n 102400
EOF

This file is already created by the rabbitmq-server package, except that 
the last line is commented out and has a different value.

As described well in the comment, the file will be sourced by the init 
script. Since the init script is run by a privileged user, there are no 
problems with increasing the hard limit.

Thank you both for your help, appreciate it.

Jean Paul

From mcintoshj at gmail.com  Thu Jan 17 17:27:07 2013
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Thu, 17 Jan 2013 11:27:07 -0600
Subject: [rabbitmq-discuss] RabbitMQAdmin declare parameters
Message-ID: <CAD6m6fFBBHfVrg+LRfyKGgGc5L7B5z2Vemb0AzE9XFqOuGkSmw@mail.gmail.com>

So been trying to figure this out for a bit, had to toss a question to the
group.  I'm trying to use on 3.0.1 rabbitmqadmin to create an exchange with
an alternate-exchange.  I can patch the rabbitmqadmin command to add that
functionality (per
http://old.nabble.com/-PATCH--rabbitmqadmin-support-for-mirrored-queues-and-alternate-exchanges-p33369697.html

But rather than doing that, I was looking to see if I could pass arguments
to the creation of the exchange somehow.  Any advice on this?

Jason
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130117/40604d5d/attachment.htm>

From shanyu.zhao at intel.com  Thu Jan 17 17:35:03 2013
From: shanyu.zhao at intel.com (Zhao, Shanyu)
Date: Thu, 17 Jan 2013 17:35:03 +0000
Subject: [rabbitmq-discuss] Rabbitmq boot failure
	with	"tables_not_present"
In-Reply-To: <CAE0Sz=xUPNDeQP7XyPgXR+en-4YLeVJyeQVspcRdJKiJCaSpLw@mail.gmail.com>
References: <D963620277BBFD4B87CF34F284738F2D3AA6F5E4@ORSMSX102.amr.corp.intel.com>
	<CAE0Sz=zu_44CTw_mf4h+pKueu8kTWyRbyuSphx4CkuXH_Okfpg@mail.gmail.com>
	<D963620277BBFD4B87CF34F284738F2D3AA6F754@ORSMSX102.amr.corp.intel.com>
	<CAE0Sz=xUPNDeQP7XyPgXR+en-4YLeVJyeQVspcRdJKiJCaSpLw@mail.gmail.com>
Message-ID: <D963620277BBFD4B87CF34F284738F2D3AA6F96C@ORSMSX102.amr.corp.intel.com>

Hi Jerry,
sudo("bash -c 'echo XXXXXXXXXXXXXXXX > /var/lib/rabbitmq/.erlang.cookie'")
sudo("chown rabbitmq /var/lib/rabbitmq/.erlang.cookie")
sudo("chmod 600 /var/lib/rabbitmq/.erlang.cookie")
sudo("rm -fr /var/lib/rabbitmq/mnesia")

That is indeed a fine way to get rid of your Mnesia contents including clustering info and any metadata that needs to be shared amongst the nodes (queue, exchange, binding, user, vhost, etc. definitions).

On the other hand, after you've done it, you've got no really good reason to expect your nodes to act as clustered.
What I want to achieve after redeployment is to erase previous states completely and let the cluster starts with a clean state, that's why I erased the /mnesia folder (is there a better way to do that?). The problem is sometimes the error messages show up for a few minutes then everything works fine after that, but other times I saw the error message being logged for 80 minutes before the cluster works correctly. Do you have any suggestions?

Are you establishing your clusters using the rabbitmq command line tools or by statically encoding their properties in your rabbitmq.config files?  You're going to have to repeat whichever you did when you bring a newly redeployed cluster, having gone through the cleansing you outline above, back online.

You might consider setting up scripts to execute the appropriate commands, as per our clustering guide, on the appropriate nodes after you've done the scripted clean-up you describe.

Oh, I used rabbitmq.conf to config clustering, like Simon has pointed it out in another email, here is what it looks like:
[
{rabbit,
  [
    {tcp_listeners, [5672]},
    {cluster_nodes, {['rabbit at ip-10-0-2-97', 'rabbit at ip-10-0-2-106'], disc}}
  ]
}
].
I have the same config file shown above on the two rabbitmq servers 10.0.2.97 and 10.0.2.106.

Do you have any suggestions that what might have gone wrong? This configuration works fine in about 80% of time, when the "tables_not_present" error only show up for a few minutes. In about 20% of time, this error appears in the log file for as long as several hours, but in the end the cluster successfully established. Is this a normal behavior?

Thanks,
Shanyu

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130117/34fc0f38/attachment.htm>

From shanyu.zhao at intel.com  Thu Jan 17 17:38:39 2013
From: shanyu.zhao at intel.com (Zhao, Shanyu)
Date: Thu, 17 Jan 2013 17:38:39 +0000
Subject: [rabbitmq-discuss] Rabbitmq boot failure
	with	"tables_not_present"
In-Reply-To: <50F7D2E2.8030301@rabbitmq.com>
References: <D963620277BBFD4B87CF34F284738F2D3AA6F5E4@ORSMSX102.amr.corp.intel.com>
	<CAE0Sz=zu_44CTw_mf4h+pKueu8kTWyRbyuSphx4CkuXH_Okfpg@mail.gmail.com>
	<D963620277BBFD4B87CF34F284738F2D3AA6F754@ORSMSX102.amr.corp.intel.com>
	<CAE0Sz=xUPNDeQP7XyPgXR+en-4YLeVJyeQVspcRdJKiJCaSpLw@mail.gmail.com>
	<50F7D2E2.8030301@rabbitmq.com>
Message-ID: <D963620277BBFD4B87CF34F284738F2D3AA6F982@ORSMSX102.amr.corp.intel.com>

Simon,

>On 17/01/13 00:45, Jerry Kuch wrote:
>> That is indeed a fine way to get rid of your Mnesia contents including
>> clustering info and any metadata that needs to be shared amongst the
>> nodes (queue, exchange, binding, user, vhost, etc. definitions).
>
>Yes. You could also use 'rabbitmqctl reset'.

I think I used this before. But in rare situations when the clustering config messed up (when the two rabbitmq server appears to be two standalone rabbitmq servers), doing a 'rabbitmq reset' couldn't fix the problem.

>
>> On the other hand, after you've done it, you've got no really good
>> reason to expect your nodes to act as clustered.
>
>...unless you have set cluster_nodes in the configuration file.
>
>> Are you establishing your clusters using the rabbitmq command line
>> tools or by statically encoding their properties in your
>> rabbitmq.config files?
>
>The stack trace in the OP shows the latter.
>
>Cheers, Simon
>
>
>--
>Simon MacMullen
>RabbitMQ, VMware
>_______________________________________________
>rabbitmq-discuss mailing list
>rabbitmq-discuss at lists.rabbitmq.com
>https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

Thanks,
Shanyu

From shanyu.zhao at intel.com  Thu Jan 17 17:47:26 2013
From: shanyu.zhao at intel.com (Zhao, Shanyu)
Date: Thu, 17 Jan 2013 17:47:26 +0000
Subject: [rabbitmq-discuss] Rabbitmq boot failure with
 "tables_not_present"
In-Reply-To: <50F7D3D8.2050501@rabbitmq.com>
References: <D963620277BBFD4B87CF34F284738F2D3AA6F5E4@ORSMSX102.amr.corp.intel.com>
	<50F7D3D8.2050501@rabbitmq.com>
Message-ID: <D963620277BBFD4B87CF34F284738F2D3AA6F9BE@ORSMSX102.amr.corp.intel.com>

Hi Simon,

>-----Original Message-----
>From: Simon MacMullen [mailto:simon at rabbitmq.com]
>Sent: Thursday, January 17, 2013 2:35 AM
>To: Discussions about RabbitMQ
>Cc: Zhao, Shanyu
>Subject: Re: [rabbitmq-discuss] Rabbitmq boot failure with
>"tables_not_present"
>
>On 16/01/13 19:54, Zhao, Shanyu wrote:
>> We have two rabbitmq servers to form a cluster. It mostly runs great.
>> But sometimes after redeploy, we saw some boot failure error in
>> rabbitmq server log.
>
>Hi. I've reproduced the problem. In order for this to occur:
>
>* You must be using the cluster_nodes configuration parameter
>* You must stop all nodes and then fully reset them
>* You must then start all nodes simultaneously
>
>I suspect it's the latter bit which is causing this to be intermittent for
>you. I'll file a bug to get this fixed, but in the mean time if you could
>stagger the start of your cluster nodes (so that one node starts on its own,
>and then others can start simultaneously or apart) that will act as a
>workaround.

Thanks a lot for your help! Yes, our deployment scripts simultaneously deploy the rabbitmq servers for efficiency. I'll try the workaround you mentioned here.

Shanyu

>
>Cheers, Simon
>
>--
>Simon MacMullen
>RabbitMQ, VMware

From matthias at rabbitmq.com  Thu Jan 17 17:49:23 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 17 Jan 2013 17:49:23 +0000
Subject: [rabbitmq-discuss] Rabbitmq boot failure
	with	"tables_not_present"
In-Reply-To: <D963620277BBFD4B87CF34F284738F2D3AA6F96C@ORSMSX102.amr.corp.intel.com>
References: <D963620277BBFD4B87CF34F284738F2D3AA6F5E4@ORSMSX102.amr.corp.intel.com>
	<CAE0Sz=zu_44CTw_mf4h+pKueu8kTWyRbyuSphx4CkuXH_Okfpg@mail.gmail.com>
	<D963620277BBFD4B87CF34F284738F2D3AA6F754@ORSMSX102.amr.corp.intel.com>
	<CAE0Sz=xUPNDeQP7XyPgXR+en-4YLeVJyeQVspcRdJKiJCaSpLw@mail.gmail.com>
	<D963620277BBFD4B87CF34F284738F2D3AA6F96C@ORSMSX102.amr.corp.intel.com>
Message-ID: <50F839A3.7070306@rabbitmq.com>

On 17/01/13 17:35, Zhao, Shanyu wrote:
> Do you have any suggestions that what might have gone wrong?

See Simon's reply 
(http://rabbitmq.1065348.n5.nabble.com/Rabbitmq-boot-failure-with-tables-not-present-tp24494p24512.html)

Matthias.

From jslusher at opinionlab.com  Thu Jan 17 16:42:15 2013
From: jslusher at opinionlab.com (Jon Slusher)
Date: Thu, 17 Jan 2013 10:42:15 -0600
Subject: [rabbitmq-discuss] rabbitmq-management plugin not listening
Message-ID: <B6EE87A8-FCB6-4015-875C-7DE0D2383A2F@opinionlab.com>

I followed the very straightforward instructions on the management plugin page from the rabbitmq documentation, but I seem to be missing something because I don't see any indication that the plugin is starting or listening on the port I specified. I'm running the latest rabbitmq on a centos 6 VM and I've opened port 15672 in iptables. When I run a netstat -ntap, I don't see that port listening on any interface. I've installed a very basic configuration of rabbitmq and added one other node in a cluster configuration with HA mirroring configured. I've been able to successfully test everything I've installed using the tutorials up until now. I don't see anything giving me any clue in the logs, except that perhaps there is nothing telling me the plugin is starting. I've tried searching through the documentation, but I'm out of ideas as to what to check next.

Any pointing in the right direction would be great. Thank you in advance.


Jon

--------------
Here's the result of the list command for the plugins. As you can see, they management plugin seems to be enabled.

rabbitmq-plugins list
[e] amqp_client                       3.0.1
[ ] cowboy                            0.5.0-rmq3.0.1-git4b93c2d
[ ] eldap                             3.0.1-gite309de4
[e] mochiweb                          2.3.1-rmq3.0.1-gitd541e9a
[ ] rabbitmq_auth_backend_ldap        3.0.1
[ ] rabbitmq_auth_mechanism_ssl       3.0.1
[ ] rabbitmq_consistent_hash_exchange 3.0.1
[ ] rabbitmq_federation               3.0.1
[ ] rabbitmq_federation_management    3.0.1
[ ] rabbitmq_jsonrpc                  3.0.1
[ ] rabbitmq_jsonrpc_channel          3.0.1
[ ] rabbitmq_jsonrpc_channel_examples 3.0.1
[E] rabbitmq_management               3.0.1
[e] rabbitmq_management_agent         3.0.1
[ ] rabbitmq_management_visualiser    3.0.1
[e] rabbitmq_mochiweb                 3.0.1
[ ] rabbitmq_mqtt                     3.0.1
[ ] rabbitmq_old_federation           3.0.1
[ ] rabbitmq_shovel                   3.0.1
[ ] rabbitmq_shovel_management        3.0.1
[ ] rabbitmq_stomp                    3.0.1
[ ] rabbitmq_tracing                  3.0.1
[ ] rabbitmq_web_stomp                3.0.1
[ ] rabbitmq_web_stomp_examples       3.0.1
[ ] rfc4627_jsonrpc                   3.0.1-git7ab174b
[ ] sockjs                            0.3.3-rmq3.0.1-git92d4ba4
[e] webmachine                        1.9.1-rmq3.0.1-git52e62bc


Here is the status of my rabbitmq node:

rabbit status
Status of node 'rabbit at rabbitvm03-stage' ...
[{pid,1159},
 {running_applications,[{rabbit,"RabbitMQ","3.0.1"},
                        {os_mon,"CPO  CXC 138 46","2.2.7"},
                        {mnesia,"MNESIA  CXC 138 12","4.5"},
                        {sasl,"SASL  CXC 138 11","2.1.10"},
                        {stdlib,"ERTS  CXC 138 10","1.17.5"},
                        {kernel,"ERTS  CXC 138 10","2.14.5"}]},
 {os,{unix,linux}},
 {erlang_version,"Erlang R14B04 (erts-5.8.5) [source] [64-bit] [rq:1] [async-threads:30] [kernel-poll:true]\n"},
 {memory,[{total,24533712},
          {connection_procs,8680},
          {queue_procs,113424},
          {plugins,0},
          {other_proc,9281056},
          {mnesia,83256},
          {mgmt_db,0},
          {msg_index,27072},
          {other_ets,732880},
          {binary,88256},
          {code,11672017},
          {atom,1200145},
          {other_system,1326926}]},
 {vm_memory_high_watermark,0.4},
 {vm_memory_limit,416414105},
 {disk_free_limit,1000000000},
 {disk_free,2456965120},
 {file_descriptors,[{total_limit,924},
                    {total_used,3},
                    {sockets_limit,829},
                    {sockets_used,1}]},
 {processes,[{limit,1048576},{used,137}]},
 {run_queue,0},
 {uptime,582723}]



From matthias at rabbitmq.com  Thu Jan 17 19:50:40 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 17 Jan 2013 19:50:40 +0000
Subject: [rabbitmq-discuss] Increasing the file descriptors limit
In-Reply-To: <50F82601.4030906@gmail.com>
References: <50F7EDF9.9060509@gmail.com> <50F7FEF5.8070702@rabbitmq.com>
	<50F82601.4030906@gmail.com>
Message-ID: <50F85610.2090203@rabbitmq.com>

On 17/01/13 16:25, Jean Paul Galea wrote:
> Only the following needs to be done:
>
> cat > /etc/default/rabbitmq-server << "EOF"
> # This file is sourced by /etc/init.d/rabbitmq-server. Its primary
> # reason for existing is to allow adjustment of system limits for the
> # rabbitmq-server process.
> #
> # Maximum number of open file handles. This will need to be increased
> # to handle many simultaneous connections. Refer to the system
> # documentation for ulimit (in man bash) for more information.
> #
> ulimit -n 102400
> EOF
>
> This file is already created by the rabbitmq-server package, except that
> the last line is commented out and has a different value.

Ah yes. That is in fact documented at 
http://www.rabbitmq.com/install-debian.html#debian-system-limits.

Matthias.

From richard at raseley.com  Thu Jan 17 21:25:03 2013
From: richard at raseley.com (Richard Raseley)
Date: Thu, 17 Jan 2013 13:25:03 -0800
Subject: [rabbitmq-discuss] Securing Messages Over WAN Link
In-Reply-To: <50F680F7.8050808@rabbitmq.com>
References: <22a5201a-39b3-4ce2-8c36-dd82309349c3@googlegroups.com>
	<50F67FCD.6070009@rabbitmq.com> <50F680F7.8050808@rabbitmq.com>
Message-ID: <CAO=6ox_6Kh91m-hgmtN=1vMd7kFM_V1Tc1uRxEGfr7vXHp0qAw@mail.gmail.com>

Emile,

Thank you for your response.

Simon,

You are correct - I was primarily interested in securing the "channel" from
the producer / consumer to the exchange / queue. Any guidance with that in
mind?

Regards,

Richard


On Wed, Jan 16, 2013 at 2:29 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 16/01/13 10:24, Emile Joubert wrote:
>
>> On 15/01/13 23:29, Richard Raseley wrote:
>>
>>> Could anyone provide any guidance on what they use for securing traffic
>>> over the WAN? Is the built in SSL / TLS support in RabbitMQ (as outlined
>>> here http://www.rabbitmq.com/ssl.**html<http://www.rabbitmq.com/ssl.html>)
>>> sufficient for such purposes?
>>> Should I be concerned about the additional overhead in processing
>>> requirements for an estimated 10 million+ messages per day?
>>>
>>
>> I assume you want to secure the link between federated exchanges or a
>> shovel connection, because clustering over a WAN link is not
>> recommended. SSL will provide confidentiality and if you use certificate
>> verification then it can provide authentication. SSL also provides
>> integrity by hashing data.
>>
>
> I assume the OP was talking about securing standard client -> server
> connections.
>
>
>  If you care about performance then select an appropriate cipher (e.g.
>> avoid 3DES). If you have crypto hardware support then make sure that is
>> enabled.
>>
>
> 10m messages per day is only 115 msg/s. Presumably there will be spikes,
> but at that sort of rate, SSL performance is unlikely to be an issue.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130117/56109bfc/attachment.htm>

From simon at rabbitmq.com  Thu Jan 17 21:25:34 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 17 Jan 2013 21:25:34 +0000
Subject: [rabbitmq-discuss] rabbitmq-management plugin not listening
In-Reply-To: <B6EE87A8-FCB6-4015-875C-7DE0D2383A2F@opinionlab.com>
References: <B6EE87A8-FCB6-4015-875C-7DE0D2383A2F@opinionlab.com>
Message-ID: <50F86C4E.5050805@rabbitmq.com>

Hmm. The plugin is definitely not running.

Sorry to ask a possibly patronising question, but did you restart the 
server after enabling the plugin?

If not that then... did you install from the RPM, or via some other means?

Cheers, Simon

On 17/01/2013 4:42PM, Jon Slusher wrote:
> I followed the very straightforward instructions on the management plugin page from the rabbitmq documentation, but I seem to be missing something because I don't see any indication that the plugin is starting or listening on the port I specified. I'm running the latest rabbitmq on a centos 6 VM and I've opened port 15672 in iptables. When I run a netstat -ntap, I don't see that port listening on any interface. I've installed a very basic configuration of rabbitmq and added one other node in a cluster configuration with HA mirroring configured. I've been able to successfully test everything I've installed using the tutorials up until now. I don't see anything giving me any clue in the logs, except that perhaps there is nothing telling me the plugin is starting. I've tried searching through the documentation, but I'm out of ideas as to what to check next.
>
> Any pointing in the right direction would be great. Thank you in advance.
>
>
> Jon
>
> --------------
> Here's the result of the list command for the plugins. As you can see, they management plugin seems to be enabled.
>
> rabbitmq-plugins list
> [e] amqp_client                       3.0.1
> [ ] cowboy                            0.5.0-rmq3.0.1-git4b93c2d
> [ ] eldap                             3.0.1-gite309de4
> [e] mochiweb                          2.3.1-rmq3.0.1-gitd541e9a
> [ ] rabbitmq_auth_backend_ldap        3.0.1
> [ ] rabbitmq_auth_mechanism_ssl       3.0.1
> [ ] rabbitmq_consistent_hash_exchange 3.0.1
> [ ] rabbitmq_federation               3.0.1
> [ ] rabbitmq_federation_management    3.0.1
> [ ] rabbitmq_jsonrpc                  3.0.1
> [ ] rabbitmq_jsonrpc_channel          3.0.1
> [ ] rabbitmq_jsonrpc_channel_examples 3.0.1
> [E] rabbitmq_management               3.0.1
> [e] rabbitmq_management_agent         3.0.1
> [ ] rabbitmq_management_visualiser    3.0.1
> [e] rabbitmq_mochiweb                 3.0.1
> [ ] rabbitmq_mqtt                     3.0.1
> [ ] rabbitmq_old_federation           3.0.1
> [ ] rabbitmq_shovel                   3.0.1
> [ ] rabbitmq_shovel_management        3.0.1
> [ ] rabbitmq_stomp                    3.0.1
> [ ] rabbitmq_tracing                  3.0.1
> [ ] rabbitmq_web_stomp                3.0.1
> [ ] rabbitmq_web_stomp_examples       3.0.1
> [ ] rfc4627_jsonrpc                   3.0.1-git7ab174b
> [ ] sockjs                            0.3.3-rmq3.0.1-git92d4ba4
> [e] webmachine                        1.9.1-rmq3.0.1-git52e62bc
>
>
> Here is the status of my rabbitmq node:
>
> rabbit status
> Status of node 'rabbit at rabbitvm03-stage' ...
> [{pid,1159},
>   {running_applications,[{rabbit,"RabbitMQ","3.0.1"},
>                          {os_mon,"CPO  CXC 138 46","2.2.7"},
>                          {mnesia,"MNESIA  CXC 138 12","4.5"},
>                          {sasl,"SASL  CXC 138 11","2.1.10"},
>                          {stdlib,"ERTS  CXC 138 10","1.17.5"},
>                          {kernel,"ERTS  CXC 138 10","2.14.5"}]},
>   {os,{unix,linux}},
>   {erlang_version,"Erlang R14B04 (erts-5.8.5) [source] [64-bit] [rq:1] [async-threads:30] [kernel-poll:true]\n"},
>   {memory,[{total,24533712},
>            {connection_procs,8680},
>            {queue_procs,113424},
>            {plugins,0},
>            {other_proc,9281056},
>            {mnesia,83256},
>            {mgmt_db,0},
>            {msg_index,27072},
>            {other_ets,732880},
>            {binary,88256},
>            {code,11672017},
>            {atom,1200145},
>            {other_system,1326926}]},
>   {vm_memory_high_watermark,0.4},
>   {vm_memory_limit,416414105},
>   {disk_free_limit,1000000000},
>   {disk_free,2456965120},
>   {file_descriptors,[{total_limit,924},
>                      {total_used,3},
>                      {sockets_limit,829},
>                      {sockets_used,1}]},
>   {processes,[{limit,1048576},{used,137}]},
>   {run_queue,0},
>   {uptime,582723}]
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From jerryk at rbcon.com  Thu Jan 17 22:17:01 2013
From: jerryk at rbcon.com (Jerry Kuch)
Date: Thu, 17 Jan 2013 14:17:01 -0800
Subject: [rabbitmq-discuss] Securing Messages Over WAN Link
In-Reply-To: <CAO=6ox_6Kh91m-hgmtN=1vMd7kFM_V1Tc1uRxEGfr7vXHp0qAw@mail.gmail.com>
References: <22a5201a-39b3-4ce2-8c36-dd82309349c3@googlegroups.com>
	<50F67FCD.6070009@rabbitmq.com> <50F680F7.8050808@rabbitmq.com>
	<CAO=6ox_6Kh91m-hgmtN=1vMd7kFM_V1Tc1uRxEGfr7vXHp0qAw@mail.gmail.com>
Message-ID: <CAE0Sz=zN_WWZLahhN54ub=su6uvVj=ZhnEs5jo1deT2+fYBScA@mail.gmail.com>

Hi Richard...

On Thu, Jan 17, 2013 at 1:25 PM, Richard Raseley <richard at raseley.com>wrote:

> You are correct - I was primarily interested in securing the "channel"
> from the producer / consumer to the exchange / queue. Any guidance with
> that in mind?
>

If your concern is securing the connections between clients who are
producing/consuming and the broker, you should be fine with the regular SSL
story:

http://www.rabbitmq.com/ssl.html

Modulo of course key and certificate management, if you want to go so far
as cert-based client authentication.

Best regards,
Jerry
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130117/bdf50ac9/attachment.htm>

From linda.linda.guo at gmail.com  Thu Jan 17 22:41:55 2013
From: linda.linda.guo at gmail.com (linda)
Date: Thu, 17 Jan 2013 14:41:55 -0800 (PST)
Subject: [rabbitmq-discuss] c# wget gets 401 from RabbitMQ 3.0.1 management
	plugin
Message-ID: <1358462515598-24544.post@n5.nabble.com>

Hi,

I have a c# app to poll vhost/queue from http management plugin. It works
fine with RabbitMQ 2.7. After upgrading to 3.0.1, the app gets 401. The app
uses guest user. I can log into the server 3.0 with guest user and the guest
has all the permissions. Does 3.0.1 change the authentication?

string uri = "http://localhost:55672/api/vhosts";

HttpWebRequest req = WebRequest.Create(uri) as HttpWebRequest;

            req.Headers.Add(HttpRequestHeader.Authorization, "Basic
Z3Vlc3Q6Z3Vlc3Q=");   //base64 encode guest:guest

           
            req.ContentType = "application/json;";
          
            req.Proxy = null;
            req.Credentials = new NetworkCredential("guest", "guest");

            using (HttpWebResponse response = req.GetResponse() as
HttpWebResponse)
            {
                // Get the response stream 
                StreamReader reader = new
StreamReader(response.GetResponseStream());

                string responseString = reader.ReadToEnd();
            }
 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/c-wget-gets-401-from-RabbitMQ-3-0-1-management-plugin-tp24544.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From aggarwalsandeep at optonline.net  Thu Jan 17 22:49:37 2013
From: aggarwalsandeep at optonline.net (Sandeep Aggarwal)
Date: Thu, 17 Jan 2013 14:49:37 -0800 (PST)
Subject: [rabbitmq-discuss] How to handle poison messages (version 3.0.1)?
Message-ID: <717579d0-3ac1-4c4e-83ef-c94ad7ed850b@googlegroups.com>

Hi All -

I'm using RabbitMQ version 3.0.1 and trying to handle the case with poison 
messages. 

In our code here, if there is a problem with processing the message, we 
nack the message with redeliver flag set to true. However, this causes the 
message to go back in the queue and in turn the consumer reads the same 
message again (and again in a loop). This causes my consumer to crash or go 
fishing in a loop.

I know there are features in some other messaging libraries (such as MSMQ) 
to handle poison messages - there does not seem to be an out of the box 
option in RabbitMQ for this feature. Could someone please suggest what 
others are doing to handle this scenario? 

I do have an option in mind - we can check for the redelivered flag to be 
true and if its true more than 3 times for a given message, we can post 
this message to a poison queue and ack it in the main queue. It's do-able 
but I'm hoping there is some option directly from rabbitMQ. Thanks in 
advance. 

Thanks,
Sandy
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130117/92090159/attachment.htm>

From jerryk at rbcon.com  Thu Jan 17 23:22:51 2013
From: jerryk at rbcon.com (Jerry Kuch)
Date: Thu, 17 Jan 2013 15:22:51 -0800
Subject: [rabbitmq-discuss] How to handle poison messages (version
	3.0.1)?
In-Reply-To: <717579d0-3ac1-4c4e-83ef-c94ad7ed850b@googlegroups.com>
References: <717579d0-3ac1-4c4e-83ef-c94ad7ed850b@googlegroups.com>
Message-ID: <CAE0Sz=y3D2A6Cew1bP=2m3esa3bboDBJrDsODFN7Z0nr9y=-cA@mail.gmail.com>

Hi, Sandeep:

I'm using RabbitMQ version 3.0.1 and trying to handle the case with poison
> messages.
>

I assume that by a "poison message" you mean a message that a consumer can
definitively determine is somehow bad and should never be considered for
processing again?


> In our code here, if there is a problem with processing the message, we
> nack the message with redeliver flag set to true. However, this causes the
> message to go back in the queue and in turn the consumer reads the same
> message again (and again in a loop). This causes my consumer to crash or go
> fishing in a loop.
>

If we're using the same definition of poison message you could basic.reject
the message, specifying requeue=false.  This will cause Rabbit to dispose
of the message and not bother you with it again.


> I do have an option in mind - we can check for the redelivered flag to be
> true and if its true more than 3 times for a given message, we can post
> this message to a poison queue and ack it in the main queue. It's do-able
> but I'm hoping there is some option directly from rabbitMQ. Thanks in
> advance.
>

Such a compromise solution seems only to make sense if the message itself
wasn't truly poisonous, but rather the consumer that dequeued it just
wasn't able to deal with it properly upon taking possession of it.  Of
course counting the number of times a given message has arrived with the
redelivered flag set to true would require you to coordinate this count
globally across all of your consumers if there were more than one and this
might be a hassle.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130117/5d8e177d/attachment.htm>

From matthias at rabbitmq.com  Thu Jan 17 23:23:58 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 17 Jan 2013 23:23:58 +0000
Subject: [rabbitmq-discuss] How to handle poison messages (version
	3.0.1)?
In-Reply-To: <717579d0-3ac1-4c4e-83ef-c94ad7ed850b@googlegroups.com>
References: <717579d0-3ac1-4c4e-83ef-c94ad7ed850b@googlegroups.com>
Message-ID: <50F8880E.6050706@rabbitmq.com>

Sandy,

On 17/01/13 22:49, Sandeep Aggarwal wrote:
> I'm using RabbitMQ version 3.0.1 and trying to handle the case with
> poison messages.

This does come up from time to time. And no, there is nothing built into 
rabbitmq.

> In our code here, if there is a problem with processing the message, we
> nack the message with redeliver flag set to true. However, this causes
> the message to go back in the queue and in turn the consumer reads the
> same message again (and again in a loop). This causes my consumer to
> crash or go fishing in a loop.

Instead of nack'ing the message the consumer could send it straight to 
the poison queue, and ack it to the main queue.

Though this doesn't work if the consumer simply dies when its eating the 
poison message.

Regards,

Matthias.

From doug at hacks.perl.sh  Fri Jan 18 03:42:32 2013
From: doug at hacks.perl.sh (Doug)
Date: Fri, 18 Jan 2013 11:42:32 +0800
Subject: [rabbitmq-discuss] rabbitmq gets high load
In-Reply-To: <017025F8-9CD2-44F5-9187-DA26F96D0766@rabbitmq.com>
References: <CAJxbUuX3ODTFCmKuYDRjPW_Jz+RA5VvY4+wZN1ajLH=xuZ=ujQ@mail.gmail.com>
	<017025F8-9CD2-44F5-9187-DA26F96D0766@rabbitmq.com>
Message-ID: <CAJxbUuXSxtfk8j2Tdh=60crZd155aK2-u+vZYRSQ6uSPOisbcA@mail.gmail.com>

Thanks Tim.

This is the info in sasl log (many of these):

=SUPERVISOR REPORT==== 17-Jan-2013::17:00:31 ===
     Supervisor: {<0.31128.1705>,
                                           rabbit_channel_sup_sup}
     Context:    shutdown_error
     Reason:     noproc
     Offender:   [{pid,<0.31130.1705>},
                  {name,channel_sup},
                  {mfa,{rabbit_channel_sup,start_link,[]}},
                  {restart_type,temporary},
                  {shutdown,infinity},
                  {child_type,supervisor}]


=SUPERVISOR REPORT==== 17-Jan-2013::17:02:41 ===
     Supervisor: {<0.30250.1707>,
                                           rabbit_channel_sup_sup}
     Context:    shutdown_error
     Reason:     shutdown
     Offender:   [{pid,<0.30252.1707>},
                  {name,channel_sup},
                  {mfa,{rabbit_channel_sup,start_link,[]}},
                  {restart_type,temporary},
                  {shutdown,infinity},
                  {child_type,supervisor}]


And this is the status report:

Status of node 'testmq-master at ubuntu' ...
[{pid,17994},
 {running_applications,[{rabbit,"RabbitMQ","2.8.2"},
                        {os_mon,"CPO  CXC 138 46","2.2.9"},
                        {sasl,"SASL  CXC 138 11","2.2.1"},
                        {mnesia,"MNESIA  CXC 138 12","4.7"},
                        {stdlib,"ERTS  CXC 138 10","1.18.1"},
                        {kernel,"ERTS  CXC 138 10","2.15.1"}]},
 {os,{unix,linux}},
 {erlang_version,"Erlang R15B01 (erts-5.9.1) [source] [64-bit]
[smp:8:8] [async-threads:30] [kernel-poll:true]\n"},
 {memory,[{total,394953040},
          {processes,313197287},
          {processes_used,313056817},
          {system,81755753},
          {atom,1788105},
          {atom_used,1770587},
          {binary,16938376},
          {code,11936253},
          {ets,5830120}]},
 {vm_memory_high_watermark,0.6},
 {vm_memory_limit,10114781184},
 {disk_free_limit,16857968640},
 {disk_free,206313144320},
 {file_descriptors,[{total_limit,65435},
                    {total_used,151},
                    {sockets_limit,58889},
                    {sockets_used,137}]},
 {processes,[{limit,1048576},{used,2867}]},
 {run_queue,13},
 {uptime,8705279}]
...done.



2013/1/17 Tim Watson <tim at rabbitmq.com>:
> Hi Doug
>
> On 17 Jan 2013, at 04:29, Doug wrote:
>
>>  PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND
>> 17994 rabbitmq  20   0 11.6g  10g 1764 S  367 66.2 416834:07 beam.smp
>>
>> As you see, rabbitmq process has lots of system load (367% CPU, 66.2% memory).
>
> Certainly looks like it. That level of CPU utilisation is a bit surprising.
>
>> It even can't list the queue now:
>>
>> root at ubuntu:~# rabbitmqctl -p /pay list_queues
>> Listing queues ...
>> ^C
>> BREAK: (a)bort (c)ontinue (p)roc info (i)nfo (l)oaded
>>       (v)ersion (k)ill (D)b-tables (d)istribution
>>
>>
>> So how to handle this case? Thanks.
>
> You've not given us much to go on here. Normally I'd ask you to run the output of `rabbitmqctl report` but that's likely to lock up just as list_queues is doing. Can you post the regular as sasl rabbit logs please? If they're too bit to post, a /paste/ url will do fine and of course you may wish to scrub the logs to remove any private information if that's relevant.
>
> Also what kind of /usage/ is this rabbit subject to at the time? Is it serving a large number of producers, consumers, both? Have you looked at any stats around the time this starts happening in order to see what the broker is up to?
>
> Cheers,
> Tim
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From dmitriy.bannikov at gmail.com  Thu Jan 17 23:04:23 2013
From: dmitriy.bannikov at gmail.com (Dmitriy Bannikov)
Date: Thu, 17 Jan 2013 15:04:23 -0800 (PST)
Subject: [rabbitmq-discuss] ReturnListener is not invoked
Message-ID: <c44e9322-9f6c-4272-bb61-c74210f32d9c@googlegroups.com>

Hello,

I have a problem with ReturnListener - failed messages are not invoking it 
in Linux. 

Same code works fine in Windows.

I've created a test Java class which tries to publish message into a fake 
queue. 
In Windows this message is failing, and ReturnListener shows it's output. 
In Linux there're not error or fails.

I've just upgraded rabbitmq from 2.8.6 to 3.0.1 on both WIndows and Linux 
machines.

Code is following:

package my.test.rabbitmq;

import com.rabbitmq.client.AMQP;
import com.rabbitmq.client.Channel;
import com.rabbitmq.client.Connection;
import com.rabbitmq.client.ConnectionFactory;
import com.rabbitmq.client.ReturnListener;

import java.io.IOException;

public class RabbitMQReturn
{

    public static void main(String[] args) throws Exception
    {
        ConnectionFactory factory = new ConnectionFactory();

        factory.setHost("localhost");
        factory.setUsername("testusr");
        factory.setPassword("testpwd");
        factory.setPort(5672);

        Connection connection = factory.newConnection();

        final Channel channel = connection.createChannel();

        channel.addReturnListener(new ReturnListener()
        {
            @Override
            public void handleReturn(int i, String s, String s2, String s3, 
AMQP.BasicProperties basicProperties,
                    byte[] bytes) throws IOException
            {
                System.err.println("Sending failed: " + s + " [" + i + "]");
            }
        });

        AMQP.BasicProperties props = new 
AMQP.BasicProperties("application/octet-stream",
                null,
                null,
                2,
                0, null, null, null,
                null, null, null, null,
                null, null);

        channel.basicPublish("", "fake_queue_112233", true, true, props, 
"Test String".getBytes());
    }
}


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130117/b511b0b8/attachment.htm>

From matthias at rabbitmq.com  Fri Jan 18 06:41:14 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 18 Jan 2013 06:41:14 +0000
Subject: [rabbitmq-discuss] ReturnListener is not invoked
In-Reply-To: <c44e9322-9f6c-4272-bb61-c74210f32d9c@googlegroups.com>
References: <c44e9322-9f6c-4272-bb61-c74210f32d9c@googlegroups.com>
Message-ID: <50F8EE8A.4050602@rabbitmq.com>

On 17/01/13 23:04, Dmitriy Bannikov wrote:
> I've created a test Java class which tries to publish message into a
> fake queue.
> In Windows this message is failing, and ReturnListener shows it's
> output. In Linux there're not error or fails.
>
> I've just upgraded rabbitmq from 2.8.6 to 3.0.1 on both WIndows and
> Linux machines.
>
> Code is following:  [...]
>          channel.basicPublish("", "fake_queue_112233", true, true,
> props, "Test String".getBytes());

That call has the 'immediate' flag set. The RabbitMQ server stopped 
supporting that in 3.0.0, so the above will result in an 
connection-level error.

But since publishing is asynchronous, a client won't see that error 
unless it a) stays around long enough for the error to arrive, and b) 
either performs some other action on the channel or has an appropriate 
error handler (in case of the Java client a ShutdownListener) configured 
on the channel. Since the basicPublish is the last thing your program 
does, and no handler is installed, the error won't show up. And since 
the error that is generated is a connection level error, the connection 
will be closed and the program terminates. If you, say, added a 
connection.close() at the end of your program, you'd get an error.

Now, if you were just setting mandatory, or running 2.8.6 (where 
'immediate' doesn't result in an error) then the return listener should 
get invoked. And since a return is a not an error, the connection will 
stay alive and the program won't terminate. Indeed all that happens for 
me, on Linux, when I try it.

As to why this would behave differently on windows and linux, I suspect 
the upgrade of the broker didn't actually happen on the former, so it's 
still running 2.8.6.

Regards,

Matthias.

From simon at rabbitmq.com  Fri Jan 18 08:42:31 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 18 Jan 2013 08:42:31 +0000
Subject: [rabbitmq-discuss] c# wget gets 401 from RabbitMQ 3.0.1
 management plugin
In-Reply-To: <1358462515598-24544.post@n5.nabble.com>
References: <1358462515598-24544.post@n5.nabble.com>
Message-ID: <50F90AF7.90605@rabbitmq.com>

Authentication did not change in any significant way.

One thing to note is that the port changed from 55672 to 15672. The API 
should give you a 301 redirect which presumably the HttpWebRequest is 
handling for you - but maybe that causes it to forget authentication 
information? I would change the port to 15672 and see if that helps.

Cheers, Simon

On 17/01/2013 10:41PM, linda wrote:
> Hi,
>
> I have a c# app to poll vhost/queue from http management plugin. It works
> fine with RabbitMQ 2.7. After upgrading to 3.0.1, the app gets 401. The app
> uses guest user. I can log into the server 3.0 with guest user and the guest
> has all the permissions. Does 3.0.1 change the authentication?
>
> string uri = "http://localhost:55672/api/vhosts";
>
> HttpWebRequest req = WebRequest.Create(uri) as HttpWebRequest;
>
>              req.Headers.Add(HttpRequestHeader.Authorization, "Basic
> Z3Vlc3Q6Z3Vlc3Q=");   //base64 encode guest:guest
>
>
>              req.ContentType = "application/json;";
>
>              req.Proxy = null;
>              req.Credentials = new NetworkCredential("guest", "guest");
>
>              using (HttpWebResponse response = req.GetResponse() as
> HttpWebResponse)
>              {
>                  // Get the response stream
>                  StreamReader reader = new
> StreamReader(response.GetResponseStream());
>
>                  string responseString = reader.ReadToEnd();
>              }
>
>
>
>
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/c-wget-gets-401-from-RabbitMQ-3-0-1-management-plugin-tp24544.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From watson.timothy at gmail.com  Fri Jan 18 09:26:34 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Fri, 18 Jan 2013 09:26:34 +0000
Subject: [rabbitmq-discuss] rabbitmq gets high load
In-Reply-To: <CAJxbUuXSxtfk8j2Tdh=60crZd155aK2-u+vZYRSQ6uSPOisbcA@mail.gmail.com>
References: <CAJxbUuX3ODTFCmKuYDRjPW_Jz+RA5VvY4+wZN1ajLH=xuZ=ujQ@mail.gmail.com>
	<017025F8-9CD2-44F5-9187-DA26F96D0766@rabbitmq.com>
	<CAJxbUuXSxtfk8j2Tdh=60crZd155aK2-u+vZYRSQ6uSPOisbcA@mail.gmail.com>
Message-ID: <48DB6BA5-51DD-4F35-8DAD-203F39D493A0@rabbitmq.com>

Hey Doug

On 18 Jan 2013, at 03:42, Doug <doug at hacks.perl.sh> wrote:
> 
> This is the info in sasl log (many of these):
> 

Do they all look the same (talking about channel_sup_sup and chanel_sup with the same errors?

> =SUPERVISOR REPORT==== 17-Jan-2013::17:00:31 ===
>     Supervisor: {<0.31128.1705>,
>                                           rabbit_channel_sup_sup}
>     Context:    shutdown_error
>     Reason:     noproc
>     Offender:   [{pid,<0.31130.1705>},
>                  {name,channel_sup},
>                  {mfa,{rabbit_channel_sup,start_link,[]}},
>                  {restart_type,temporary},
>                  {shutdown,infinity},
>                  {child_type,supervisor}]
> 
> 
> =SUPERVISOR REPORT==== 17-Jan-2013::17:02:41 ===
>     Supervisor: {<0.30250.1707>,
>                                           rabbit_channel_sup_sup}
>     Context:    shutdown_error
>     Reason:     shutdown
>     Offender:   [{pid,<0.30252.1707>},
>                  {name,channel_sup},
>                  {mfa,{rabbit_channel_sup,start_link,[]}},
>                  {restart_type,temporary},
>                  {shutdown,infinity},
>                  {child_type,supervisor}]
> 
> 
> And this is the status report:
> 
> Status of node 'testmq-master at ubuntu' ...
> [{pid,17994},
> {running_applications,[{rabbit,"RabbitMQ","2.8.2"},
>                        {os_mon,"CPO  CXC 138 46","2.2.9"},
>                        {sasl,"SASL  CXC 138 11","2.2.1"},
>                        {mnesia,"MNESIA  CXC 138 12","4.7"},
>                        {stdlib,"ERTS  CXC 138 10","1.18.1"},
>                        {kernel,"ERTS  CXC 138 10","2.15.1"}]},
> {os,{unix,linux}},
> {erlang_version,"Erlang R15B01 (erts-5.9.1) [source] [64-bit]
> [smp:8:8] [async-threads:30] [kernel-poll:true]\n"},
> {memory,[{total,394953040},
>          {processes,313197287},
>          {processes_used,313056817},
>          {system,81755753},
>          {atom,1788105},
>          {atom_used,1770587},
>          {binary,16938376},
>          {code,11936253},
>          {ets,5830120}]},
> {vm_memory_high_watermark,0.6},
> {vm_memory_limit,10114781184},
> {disk_free_limit,16857968640},
> {disk_free,206313144320},
> {file_descriptors,[{total_limit,65435},
>                    {total_used,151},
>                    {sockets_limit,58889},
>                    {sockets_used,137}]},
> {processes,[{limit,1048576},{used,2867}]},
> {run_queue,13},
> {uptime,8705279}]
> ...done.
> 
> 
> 
> 2013/1/17 Tim Watson <tim at rabbitmq.com>:
>> Hi Doug
>> 
>> On 17 Jan 2013, at 04:29, Doug wrote:
>> 
>>> PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND
>>> 17994 rabbitmq  20   0 11.6g  10g 1764 S  367 66.2 416834:07 beam.smp
>>> 
>>> As you see, rabbitmq process has lots of system load (367% CPU, 66.2% memory).
>> 
>> Certainly looks like it. That level of CPU utilisation is a bit surprising.
>> 
>>> It even can't list the queue now:
>>> 
>>> root at ubuntu:~# rabbitmqctl -p /pay list_queues
>>> Listing queues ...
>>> ^C
>>> BREAK: (a)bort (c)ontinue (p)roc info (i)nfo (l)oaded
>>>      (v)ersion (k)ill (D)b-tables (d)istribution
>>> 
>>> 
>>> So how to handle this case? Thanks.
>> 
>> You've not given us much to go on here. Normally I'd ask you to run the output of `rabbitmqctl report` but that's likely to lock up just as list_queues is doing. Can you post the regular as sasl rabbit logs please? If they're too bit to post, a /paste/ url will do fine and of course you may wish to scrub the logs to remove any private information if that's relevant.
>> 
>> Also what kind of /usage/ is this rabbit subject to at the time? Is it serving a large number of producers, consumers, both? Have you looked at any stats around the time this starts happening in order to see what the broker is up to?
>> 
>> Cheers,
>> Tim
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From mabra77 at gmail.com  Fri Jan 18 10:25:21 2013
From: mabra77 at gmail.com (mabra)
Date: Fri, 18 Jan 2013 02:25:21 -0800 (PST)
Subject: [rabbitmq-discuss] configure shovel for message throttling
Message-ID: <f90f16a3-f729-4aa2-93fa-f43c56ab1ab0@googlegroups.com>

Hello !

I have the follwong config:
- there are 10 sites, having its own broker
- there is one central site with one broker
- shovel is used to shovel the messages from the sites to the central node.

There will be an unwished behavior, if the central node network goes first
down and then re-appears. All shovel [and even all other network 
connections]
try to occupy the re-esabtlished network connection with causes a ver strong
bottleneck, make the network nearly unusable for some time.

I am looking for settings in shovel to throttle the sending of the messages,
respective limit the bandwith in use. This will not disturb normal shoveling
if the rate is in an acceptible range. But it helps a lot at the message 
flood
on re-connects.

Any hints tips or other help would be really great!

br,

++mabra

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130118/7120ea92/attachment.htm>

From anilkumar.dannina at gmail.com  Fri Jan 18 08:55:37 2013
From: anilkumar.dannina at gmail.com (anilkumar.dannina at gmail.com)
Date: Fri, 18 Jan 2013 00:55:37 -0800 (PST)
Subject: [rabbitmq-discuss] RabbirMq server is getting hanged continously in
	Multi node setup
Message-ID: <31d37e34-374d-4faf-a342-b10c18859ad3@googlegroups.com>

Hi all,

In our organization, as part of one product we are building a multinode 
openstack setup. The setup contains once controller node(api, scheduler, 
cert services are installed in it) and more than one compute nodes(Compute 
and Network services are installed in it). In this setup, sometimes the 
rabbitmq service is getting continuously hanged, with the command *rabbitmqctl 
list_queues*, not all the compute nodes are listing. 

In the scheduler logs, we are continuously getting the following error.

2013-01-18 07:29:02 INFO nova.rpc.common [-] Reconnecting to AMQP server on 
---------------
2013-01-18 07:29:02 ERROR nova.rpc.common [-] AMQP server on -------------- 
is unreachable: [Errno 111] ECONNREFUSED. Trying again in 3 seconds.
2013-01-18 07:29:02 TRACE nova.rpc.common Traceback (most recent call last):
2013-01-18 07:29:02 TRACE nova.rpc.common   File 
"/usr/local/lib/python2.7/dist-packages/nova-2012.1.1-py2.7.egg/nova/rpc/impl_kombu.py", 
line 446, in reconnect
2013-01-18 07:29:02 TRACE nova.rpc.common     self._connect()
2013-01-18 07:29:02 TRACE nova.rpc.common   File 
"/usr/local/lib/python2.7/dist-packages/nova-2012.1.1-py2.7.egg/nova/rpc/impl_kombu.py", 
line 423, in _connect
2013-01-18 07:29:02 TRACE nova.rpc.common     self.connection.connect()
2013-01-18 07:29:02 TRACE nova.rpc.common   File 
"/usr/lib/python2.7/dist-packages/kombu/connection.py", line 95, in connect
2013-01-18 07:29:02 TRACE nova.rpc.common     return self.connection
2013-01-18 07:29:02 TRACE nova.rpc.common   File 
"/usr/lib/python2.7/dist-packages/kombu/connection.py", line 396, in 
connection
2013-01-18 07:29:02 TRACE nova.rpc.common     self._connection = 
self._establish_connection()
2013-01-18 07:29:02 TRACE nova.rpc.common   File 
"/usr/lib/python2.7/dist-packages/kombu/connection.py", line 364, in 
_establish_connection
2013-01-18 07:29:02 TRACE nova.rpc.common     return 
self.transport.establish_connection()
2013-01-18 07:29:02 TRACE nova.rpc.common   File 
"/usr/lib/python2.7/dist-packages/kombu/transport/pyamqplib.py", line 219, 
in establish_connection
2013-01-18 07:29:02 TRACE nova.rpc.common     
connect_timeout=conninfo.connect_timeout)
2013-01-18 07:29:02 TRACE nova.rpc.common   File 
"/usr/lib/python2.7/dist-packages/kombu/transport/pyamqplib.py", line 45, 
in __init__
2013-01-18 07:29:02 TRACE nova.rpc.common     super(Connection, 
self).__init__(*args, **kwargs)
2013-01-18 07:29:02 TRACE nova.rpc.common   File 
"/usr/lib/python2.7/dist-packages/amqplib/client_0_8/connection.py", line 
129, in __init__
2013-01-18 07:29:02 TRACE nova.rpc.common     self.transport = 
create_transport(host, connect_timeout, ssl)
2013-01-18 07:29:02 TRACE nova.rpc.common   File 
"/usr/lib/python2.7/dist-packages/amqplib/client_0_8/transport.py", line 
281, in create_transport
2013-01-18 07:29:02 TRACE nova.rpc.common     return TCPTransport(host, 
connect_timeout)
2013-01-18 07:29:02 TRACE nova.rpc.common   File 
"/usr/lib/python2.7/dist-packages/amqplib/client_0_8/transport.py", line 
85, in __init__
2013-01-18 07:29:02 TRACE nova.rpc.common     raise socket.error, msg
2013-01-18 07:29:02 TRACE nova.rpc.common error: [Errno 111] ECONNREFUSED


Can any one please suggest the solution, how can i make the rabbitmq server 
service available all the time.

Thanks in advance,
D Anil Kumar.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130118/764edfe8/attachment.htm>

From emile at rabbitmq.com  Fri Jan 18 10:38:56 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 18 Jan 2013 10:38:56 +0000
Subject: [rabbitmq-discuss] RabbirMq server is getting hanged
 continously in Multi node setup
In-Reply-To: <31d37e34-374d-4faf-a342-b10c18859ad3@googlegroups.com>
References: <31d37e34-374d-4faf-a342-b10c18859ad3@googlegroups.com>
Message-ID: <50F92640.8090807@rabbitmq.com>

Hi,

On 18/01/13 08:55, anilkumar.dannina at gmail.com wrote:
> Can any one please suggest the solution,

The best first place to look is in the broker logfile, to see if the
reason for the problem is reported there. Check the sasl logfile too.



-Emile






From antony.pulicken at gmail.com  Fri Jan 18 10:47:57 2013
From: antony.pulicken at gmail.com (antony)
Date: Fri, 18 Jan 2013 02:47:57 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ RPC | Multiple consumers
Message-ID: <1358506077003-24556.post@n5.nabble.com>

Hi,

We are planning to use RabbitMQ RPC for synchronous messaging. Apart from
the server component that will process the incoming message and sends a
response to the call back queue, we also have few other components who are
interested in the event/payload published by the client.  So, my question is
can we have more than one subscriber in case of RPC scenario ? If yes, can
you please more details about it ?

Regards,
Antony. 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-RPC-Multiple-consumers-tp24556.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From videlalvaro at gmail.com  Fri Jan 18 10:58:11 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 18 Jan 2013 11:58:11 +0100
Subject: [rabbitmq-discuss] RabbitMQ RPC | Multiple consumers
In-Reply-To: <1358506077003-24556.post@n5.nabble.com>
References: <1358506077003-24556.post@n5.nabble.com>
Message-ID: <CAMcAHLV29+v1QbNO1VsV-S2qfpP-oJ+bv_38G+NETh82Ta1Wog@mail.gmail.com>

Hi,

A RabbitMQ RPC Server is no more than a simple consumer that gets messages
from queue, process them, inspects their "reply_to" property and replies to
that address with the result, possibly passing along the message
"correlation_id" so the RPC Client can keep track of the responses.

So you could run one of those process, or many in parallel, it doesn't
matter.

Now if you want to have more than one process to pick up the message and do
something with it, then you will have to put a fanout exchange in front of
your RPC Server. That would be the easiest way to get the RPC Request to
different components.

Regards,

Alvaro



On Fri, Jan 18, 2013 at 11:47 AM, antony <antony.pulicken at gmail.com> wrote:

> Hi,
>
> We are planning to use RabbitMQ RPC for synchronous messaging. Apart from
> the server component that will process the incoming message and sends a
> response to the call back queue, we also have few other components who are
> interested in the event/payload published by the client.  So, my question
> is
> can we have more than one subscriber in case of RPC scenario ? If yes, can
> you please more details about it ?
>
> Regards,
> Antony.
>
>
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-RPC-Multiple-consumers-tp24556.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130118/dae1e4d1/attachment.htm>

From simon at rabbitmq.com  Fri Jan 18 11:05:51 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 18 Jan 2013 11:05:51 +0000
Subject: [rabbitmq-discuss] RabbitMQAdmin declare parameters
In-Reply-To: <CAD6m6fFBBHfVrg+LRfyKGgGc5L7B5z2Vemb0AzE9XFqOuGkSmw@mail.gmail.com>
References: <CAD6m6fFBBHfVrg+LRfyKGgGc5L7B5z2Vemb0AzE9XFqOuGkSmw@mail.gmail.com>
Message-ID: <50F92C8F.302@rabbitmq.com>

On 17/01/13 17:27, Jason McIntosh wrote:
> I was looking to see if I could pass
> arguments to the creation of the exchange somehow.  Any advice on this?

This isn't possible in the version of rabbitmqadmin that ships with 
3.0.1. But I just merged support for arguments. So you can download an 
updated rabbitmqadmin from

http://hg.rabbitmq.com/rabbitmq-management/raw-file/5c771ead6890/bin/rabbitmqadmin

and then use it like so:

rabbitmqadmin declare exchange name=test type=topic \
   'arguments={"alternate-exchange":"amq.fanout"}'

(The single quotes are there to defend the JSON from sh. Quoting rules 
may differ in other shells or on Windows.)

This feature will ship in 3.1.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Fri Jan 18 13:31:19 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 18 Jan 2013 13:31:19 +0000
Subject: [rabbitmq-discuss] rabbitmq gets high load
In-Reply-To: <CAJxbUuXSxtfk8j2Tdh=60crZd155aK2-u+vZYRSQ6uSPOisbcA@mail.gmail.com>
References: <CAJxbUuX3ODTFCmKuYDRjPW_Jz+RA5VvY4+wZN1ajLH=xuZ=ujQ@mail.gmail.com>
	<017025F8-9CD2-44F5-9187-DA26F96D0766@rabbitmq.com>
	<CAJxbUuXSxtfk8j2Tdh=60crZd155aK2-u+vZYRSQ6uSPOisbcA@mail.gmail.com>
Message-ID: <50F94EA7.3020208@rabbitmq.com>

On 18/01/13 03:42, Doug wrote:
> {rabbit,"RabbitMQ","2.8.2"}

Hmm. There have been a couple of bugs which caused high CPU load which 
have been fixed since then; it is likely to be worth upgrading; 
especially if you use mirrored queues or have more queues than file 
descriptors (which were two triggers).

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From Petr.Gotthard at Honeywell.com  Fri Jan 18 15:14:26 2013
From: Petr.Gotthard at Honeywell.com (Gotthard, Petr)
Date: Fri, 18 Jan 2013 15:14:26 +0000
Subject: [rabbitmq-discuss] no function clause matching
	amqp_network_connection:handle_message
Message-ID: <F9E85480F62349458DF67CE8BA000D8D2A645D94@FR44EX3004.global.ds.honeywell.com>

Hello,
when an Erlang client 2.8.7 connection is closed by force (by calling gen_tcp:close) we are getting the following message

gen_server <0.331.0> terminated with reason: no function clause matching amqp_network_connection:handle_message({'EXIT',#Port<0.6672>,normal}, {state,#Port<0.6672>,5,<0.335.0>,131072,undefined,false}) line 57

According to the source codes the 'EXIT' message is really not handled in amqp_network_connection. Could this be a bug, or did we do something wrong?

Note we cannot call amqp_connection:close because the link is dead at that moment. We only want to close the connection without waiting for the heartbeats to discover the link is inactive.


Thanks,
Petr

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130118/c62ea2b8/attachment.htm>

From info at travo.se  Fri Jan 18 15:18:02 2013
From: info at travo.se (kecke)
Date: Fri, 18 Jan 2013 07:18:02 -0800 (PST)
Subject: [rabbitmq-discuss] WCF .net problems
Message-ID: <1358522281970-24561.post@n5.nabble.com>

We are trying to run with rabbitmq instead of msmq, due to the size limit in
msmq of 4mb per message.But we have some problems.1. We want the queues
messages to be persistant(e.g - if rabbitmq service is stopped and restarted
the messages will still be in queue). Is there any way to do this(e.g set
deliverymode=2) in the app.config in  or  or somewhere else? 2. We want
durable queues. We found in this messagelist a post about that, and the
trick was to change this on line 152 in
rabbitmq.servicemodel.rabbitmqinputchannelBefore: string queue =
m_model.QueueDeclare();After: string queue =
m_model.QueueDeclare(base.LocalAddress.Uri.AbsolutePath, true, false, false,
null); ...we then got durable queues. This couldnt be done in any other
way?3. We want the client(which in our case is a WCF-service) to post a
message to the queue and then forget(and be sure that sometime in the future
the message will be delivered), so we have oneway="true" in our app.configs.
The consumer is also a WCF-service. If we stop the rabbitmq server, then our
services get an error - like its always connected to RabbitMQ. Is there a
way in the app.config to tell the services we have to only connect when
messages is delivered or retrieved?4. It seems that the messages isn't
consumed one by one-it seems that it gets them all att once? Is there a way
to tell service to fetch them one by one?5. Please check our app.config
below and if something needs to be changed we are very greatful for any
input. For example, bigger messages(like 20mb) seem to not be consumed, just
disapears from queue.The clients app config:                                                                                              	                  	           
--------------------------------------------------------The consumers
app.config:                                                                                                                                                                                                                                                                    



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/WCF-net-problems-tp24561.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130118/78ba94f8/attachment.htm>

From info at travo.se  Fri Jan 18 15:22:43 2013
From: info at travo.se (kecke)
Date: Fri, 18 Jan 2013 07:22:43 -0800 (PST)
Subject: [rabbitmq-discuss] WCF .net problems
In-Reply-To: <1358522281970-24561.post@n5.nabble.com>
References: <1358522281970-24561.post@n5.nabble.com>
Message-ID: <1358522563094-24562.post@n5.nabble.com>

Seems that the app.configs where cut off, here it is:

The clients app config:
<system.serviceModel>

    
    <extensions>
      <bindingExtensions>
        <add
          name="rabbitMQBinding"
          type="RabbitMQ.ServiceModel.RabbitMQBindingSection,
RabbitMQ.ServiceModel, Version=1.0.110.0, Culture=neutral,
PublicKeyToken=null"/>
      </bindingExtensions>
    </extensions>


    <client>     

      
      <endpoint address="soap.amqp:///UpdateSparePartListQue"
                 binding="rabbitMQBinding"
                 behaviorConfiguration
="CabasUpdateSparePartListServiceBehavior"
                 bindingConfiguration="rabbitMQConfig"
                
contract="CabasUpdateSparePartListServiceReference.ICabasUpdateSparePartListService"
                 name="RabbitMQBinding_ICabasUpdateSparePartListService" 
                 />
    </client>

     <bindings>
      
      <rabbitMQBinding>

        <binding name="rabbitMQConfig"
                   hostname="localhost"
                   port="5672"
                   protocolversion="AMQP_0_9_1"
                   oneWay="true"
                   maxmessagesize="2147483647"                   
                  />
      </rabbitMQBinding>
    </bindings>

  </behaviors>
	<endpointBehaviors>
        <behavior name="CabasUpdateSparePartListServiceBehavior">
          	<dataContractSerializer maxItemsInObjectGraph="2147483647"/>
        </behavior>
  </behaviors>
  </system.serviceModel>
--------------------------------------------------------
The consumers app.config:

 <system.serviceModel>

    
    <extensions>
      <bindingExtensions>
        <add
          name="rabbitMQBinding"
          type="RabbitMQ.ServiceModel.RabbitMQBindingSection,
RabbitMQ.ServiceModel, Version=1.0.110.0, Culture=neutral,
PublicKeyToken=null"/>
      </bindingExtensions>
    </extensions>

 <bindings>

      
      <rabbitMQBinding>

        <binding name="rabbitMQConfig"
                   hostname="localhost"
                   port="5672"
                   protocolversion="AMQP_0_9_1"
                   oneWay="true"
                   maxmessagesize="2147483647"
                  />                           
      </rabbitMQBinding>
 </bindings>

<services>
          

      <service
name="CAB.CABAS.UPDATE.SERVICES.Services.CabasUpdateSparePartListService"
behaviorConfiguration="CAB.CABAS.UPDATE.SERVICES.Services.CabasUpdateSparePartListServiceBehavior">
        <host>
          <baseAddresses>
            <add baseAddress = "soap.amqp:///" />
            <add
baseAddress="http://localhost:8632/CABAS/CabasUpdateSparePartListService" />
          </baseAddresses>
        </host>
        <endpoint
          address="UpdateSparePartListQue"
          binding="rabbitMQBinding"
          bindingConfiguration="rabbitMQConfig"
         
contract="CAB.CABAS.UPDATE.SERVICES.Services.ICabasUpdateSparePartListService"/>
        <endpoint address="mex" binding="mexHttpBinding"
bindingConfiguration=""
        name="mexEndpoint"
contract="CAB.CABAS.UPDATE.SERVICES.Services.ICabasUpdateSparePartListService"
/>
      </service>

</services>

<behaviors>
      <serviceBehaviors>

        <behavior
name="CAB.CABAS.UPDATE.SERVICES.Services.CabasUpdateSparePartListServiceBehavior">
          
          <serviceMetadata httpGetEnabled="True"/>
          
          <serviceDebug includeExceptionDetailInFaults="True"/>

          <dataContractSerializer maxItemsInObjectGraph="2147483647" />
        </behavior>
  </serviceBehaviors>
</behaviors>





--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/WCF-net-problems-tp24561p24562.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From alexis at rabbitmq.com  Fri Jan 18 15:39:16 2013
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Fri, 18 Jan 2013 15:39:16 +0000
Subject: [rabbitmq-discuss] can rabbitmq be used in the bank business?
In-Reply-To: <4FCDAC3B.4050603@riseup.net>
References: <4FCDAC3B.4050603@riseup.net>
Message-ID: <CACOPnvc5y5yMAW8D39X2rFJog0b8Lix25-Rk=iF7LtQ1goR1DA@mail.gmail.com>

On Tue, Jun 5, 2012 at 7:50 AM, pangj <pangj at riseup.net> wrote:
> Hi,
>
> ...
> In this case Rabbitmq works perfectly, we didn't find a problem.
> My question is, can rabbitmq run for high serious business? for example, the
> bank business, they require very high reliability.

By the way, here is a banking use case..

http://blogs.vmware.com/vfabric/2013/01/interview-worlds-most-innovative-bank-on-using-rabbitmq.html




> If so, do you have any suggestions?
>
> Thanks.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From pekowski at gmail.com  Fri Jan 18 16:25:55 2013
From: pekowski at gmail.com (Ray Pekowski)
Date: Fri, 18 Jan 2013 10:25:55 -0600
Subject: [rabbitmq-discuss] RabbitMQ scaling with OpenStack
Message-ID: <CAJcv3CRYfYsNsVSKkdJVm2frtqkF=CjTvmX+v3u9JdEEHrDtog@mail.gmail.com>

Here is a link to a Dell study of RabitMQ scalability as used by
OpenStack.  It addresses the current low performing way in which OpenStack
implemented RPC calls over AMQP, creating a new queue and exchange on each
RPC call for receiving the call response.  It also measure a prototyped fix
which uses as single (per process) queue and exchange for all RPC call
replies.  I thought the RabbitMQ community might be interested in these
results.

https://docs.google.com/file/d/0B-droFdkDaVhVzhsN3RKRlFLODQ/edit

Ray
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130118/29d8f8a1/attachment.htm>

From alexis at rabbitmq.com  Fri Jan 18 17:14:15 2013
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Fri, 18 Jan 2013 17:14:15 +0000
Subject: [rabbitmq-discuss] RabbitMQ scaling with OpenStack
In-Reply-To: <CAJcv3CRYfYsNsVSKkdJVm2frtqkF=CjTvmX+v3u9JdEEHrDtog@mail.gmail.com>
References: <CAJcv3CRYfYsNsVSKkdJVm2frtqkF=CjTvmX+v3u9JdEEHrDtog@mail.gmail.com>
Message-ID: <CACOPnvcJmosfyKYq2pcu9E-QiArtXBj0dcq5nmk-YjXDb6-HMA@mail.gmail.com>

Ray

Thanks very much for posting this.

Some of the numbers you saw seem oddly low, and I wonder if there is
more going on that is easily fixed.  The config of Rabbit in OpenStack
may be very borked.

Can I ask what clients you used?  It may be worth testing a few different ones.

alexis


On Fri, Jan 18, 2013 at 4:25 PM, Ray Pekowski <pekowski at gmail.com> wrote:
> Here is a link to a Dell study of RabitMQ scalability as used by OpenStack.
> It addresses the current low performing way in which OpenStack implemented
> RPC calls over AMQP, creating a new queue and exchange on each RPC call for
> receiving the call response.  It also measure a prototyped fix which uses as
> single (per process) queue and exchange for all RPC call replies.  I thought
> the RabbitMQ community might be interested in these results.
>
> https://docs.google.com/file/d/0B-droFdkDaVhVzhsN3RKRlFLODQ/edit
>
> Ray
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From shanyu.zhao at intel.com  Fri Jan 18 17:57:32 2013
From: shanyu.zhao at intel.com (Zhao, Shanyu)
Date: Fri, 18 Jan 2013 17:57:32 +0000
Subject: [rabbitmq-discuss] Rabbitmq boot failure with
 "tables_not_present"
In-Reply-To: <D963620277BBFD4B87CF34F284738F2D3AA6F9BE@ORSMSX102.amr.corp.intel.com>
References: <D963620277BBFD4B87CF34F284738F2D3AA6F5E4@ORSMSX102.amr.corp.intel.com>
	<50F7D3D8.2050501@rabbitmq.com>
	<D963620277BBFD4B87CF34F284738F2D3AA6F9BE@ORSMSX102.amr.corp.intel.com>
Message-ID: <D963620277BBFD4B87CF34F284738F2D3AA6FE25@ORSMSX102.amr.corp.intel.com>

Hi Simon,

>>On 16/01/13 19:54, Zhao, Shanyu wrote:
>>> We have two rabbitmq servers to form a cluster. It mostly runs great.
>>> But sometimes after redeploy, we saw some boot failure error in
>>> rabbitmq server log.
>>
>>Hi. I've reproduced the problem. In order for this to occur:
>>
>>* You must be using the cluster_nodes configuration parameter
>>* You must stop all nodes and then fully reset them
>>* You must then start all nodes simultaneously
>>
>>I suspect it's the latter bit which is causing this to be intermittent
>>for you. I'll file a bug to get this fixed, but in the mean time if you
>>could stagger the start of your cluster nodes (so that one node starts
>>on its own, and then others can start simultaneously or apart) that
>>will act as a workaround.
>
>Thanks a lot for your help! Yes, our deployment scripts simultaneously
>deploy the rabbitmq servers for efficiency. I'll try the workaround you
>mentioned here.

We've tried your workaround and it works great! Thanks a lot!

Shanyu

From matthias at rabbitmq.com  Fri Jan 18 17:58:58 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 18 Jan 2013 17:58:58 +0000
Subject: [rabbitmq-discuss] RabbitMQ scaling with OpenStack
In-Reply-To: <CACOPnvcJmosfyKYq2pcu9E-QiArtXBj0dcq5nmk-YjXDb6-HMA@mail.gmail.com>
References: <CAJcv3CRYfYsNsVSKkdJVm2frtqkF=CjTvmX+v3u9JdEEHrDtog@mail.gmail.com>
	<CACOPnvcJmosfyKYq2pcu9E-QiArtXBj0dcq5nmk-YjXDb6-HMA@mail.gmail.com>
Message-ID: <50F98D62.8030300@rabbitmq.com>

On 18/01/13 17:14, Alexis Richardson wrote:
> Can I ask what clients you used?

And *what versions* of the client and the server. For example, mirrored 
queue performance, which is part of the tests, improved significantly in 
3.0.0, and again in 3.0.1.

Matthias.

From linda.linda.guo at gmail.com  Fri Jan 18 18:57:29 2013
From: linda.linda.guo at gmail.com (linda)
Date: Fri, 18 Jan 2013 10:57:29 -0800 (PST)
Subject: [rabbitmq-discuss] c# wget gets 401 from RabbitMQ 3.0.1
	management plugin
In-Reply-To: <50F90AF7.90605@rabbitmq.com>
References: <1358462515598-24544.post@n5.nabble.com>
	<50F90AF7.90605@rabbitmq.com>
Message-ID: <1358535449343-24568.post@n5.nabble.com>

After changing the port to 15672, it works fine. Thanks a lot!




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/c-wget-gets-401-from-RabbitMQ-3-0-1-management-plugin-tp24544p24568.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From matthias at rabbitmq.com  Fri Jan 18 19:35:21 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 18 Jan 2013 19:35:21 +0000
Subject: [rabbitmq-discuss] c# wget gets 401 from RabbitMQ 3.0.1
 management plugin
In-Reply-To: <1358535449343-24568.post@n5.nabble.com>
References: <1358462515598-24544.post@n5.nabble.com>
	<50F90AF7.90605@rabbitmq.com>
	<1358535449343-24568.post@n5.nabble.com>
Message-ID: <50F9A3F9.9070302@rabbitmq.com>

On 18/01/13 18:57, linda wrote:
> After changing the port to 15672, it works fine. Thanks a lot!

It is mind-boggling how many HTTP client libraries do not handle 
redirects automatically and/or correctly. Redirects have been in the 
spec, with the note that "action [is] to be taken (normally 
automatically) by the client in order to fulfil the request", since 1992!

Matthias.

From dmitriy.bannikov at gmail.com  Fri Jan 18 20:18:58 2013
From: dmitriy.bannikov at gmail.com (Dmitriy Bannikov)
Date: Fri, 18 Jan 2013 12:18:58 -0800
Subject: [rabbitmq-discuss] ReturnListener is not invoked
In-Reply-To: <50F8EE8A.4050602@rabbitmq.com>
References: <c44e9322-9f6c-4272-bb61-c74210f32d9c@googlegroups.com>
	<50F8EE8A.4050602@rabbitmq.com>
Message-ID: <CAOLJz+hh2BXopekfrdvMrhiTofHMWOb=4rDSf2gdmP5qsjkUdg@mail.gmail.com>

I think it's a problem of this particular instance. I've downgraded
RabbitMQ to 2.8.7, and still have same behavior - no reaction to invalid
action, no errors at all.

I've checked RabbitMQ logs - nothing related to my actions.

I've executed "rabbitmqctl status" to ensure that version is correct:

 rabbitmqctl status
Status of node 'rabbit at ip-10-182-22-183' ...
[{pid,30523},
 {running_applications,[{rabbit,"RabbitMQ","2.8.7"},
                        {os_mon,"CPO  CXC 138 46","2.2.10"},
                        {sasl,"SASL  CXC 138 11","2.2.1"},
                        {mnesia,"MNESIA  CXC 138 12","4.7.1"},
                        {stdlib,"ERTS  CXC 138 10","1.18.2"},
                        {kernel,"ERTS  CXC 138 10","2.15.2"}]},
 {os,{unix,linux}},
 {erlang_version,"Erlang R15B02 (erts-5.9.2) [source] [64-bit] [smp:2:2]
[async-threads:30] [hipe] [kernel-poll:true]\n"},
 {memory,[{total,27509232},
          {processes,10481394},
          {processes_used,10481380},
          {system,17027838},
          {atom,504409},
          {atom_used,476697},
          {binary,640152},
          {code,11973387},
          {ets,823696}]},
 {vm_memory_high_watermark,0.4},
 {vm_memory_limit,3221225472},
 {disk_free_limit,1000000000},
 {disk_free,267063296},
 {file_descriptors,[{total_limit,924},
                    {total_used,4},
                    {sockets_limit,829},
                    {sockets_used,2}]},
 {processes,[{limit,1048576},{used,127}]},
 {run_queue,0},
 {uptime,173}]
...done.


Is there anything else I can check?


2013/1/17 Matthias Radestock <matthias at rabbitmq.com>

> On 17/01/13 23:04, Dmitriy Bannikov wrote:
>
>> I've created a test Java class which tries to publish message into a
>> fake queue.
>> In Windows this message is failing, and ReturnListener shows it's
>> output. In Linux there're not error or fails.
>>
>> I've just upgraded rabbitmq from 2.8.6 to 3.0.1 on both WIndows and
>> Linux machines.
>>
>> Code is following:  [...]
>>          channel.basicPublish("", "fake_queue_112233", true, true,
>> props, "Test String".getBytes());
>>
>
> That call has the 'immediate' flag set. The RabbitMQ server stopped
> supporting that in 3.0.0, so the above will result in an connection-level
> error.
>
> But since publishing is asynchronous, a client won't see that error unless
> it a) stays around long enough for the error to arrive, and b) either
> performs some other action on the channel or has an appropriate error
> handler (in case of the Java client a ShutdownListener) configured on the
> channel. Since the basicPublish is the last thing your program does, and no
> handler is installed, the error won't show up. And since the error that is
> generated is a connection level error, the connection will be closed and
> the program terminates. If you, say, added a connection.close() at the end
> of your program, you'd get an error.
>
> Now, if you were just setting mandatory, or running 2.8.6 (where
> 'immediate' doesn't result in an error) then the return listener should get
> invoked. And since a return is a not an error, the connection will stay
> alive and the program won't terminate. Indeed all that happens for me, on
> Linux, when I try it.
>
> As to why this would behave differently on windows and linux, I suspect
> the upgrade of the broker didn't actually happen on the former, so it's
> still running 2.8.6.
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130118/d683b407/attachment.htm>

From matthias at rabbitmq.com  Fri Jan 18 20:30:27 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 18 Jan 2013 20:30:27 +0000
Subject: [rabbitmq-discuss] ReturnListener is not invoked
In-Reply-To: <CAOLJz+hh2BXopekfrdvMrhiTofHMWOb=4rDSf2gdmP5qsjkUdg@mail.gmail.com>
References: <c44e9322-9f6c-4272-bb61-c74210f32d9c@googlegroups.com>
	<50F8EE8A.4050602@rabbitmq.com>
	<CAOLJz+hh2BXopekfrdvMrhiTofHMWOb=4rDSf2gdmP5qsjkUdg@mail.gmail.com>
Message-ID: <50F9B0E3.3000808@rabbitmq.com>

On 18/01/13 20:18, Dmitriy Bannikov wrote:
> I think it's a problem of this particular instance. I've downgraded
> RabbitMQ to 2.8.7, and still have same behavior - no reaction to invalid
> action, no errors at all.
>
> I've checked RabbitMQ logs - nothing related to my actions.

Do you see the client *connections* in the logs? If not then perhaps 
your test code is talking to a different server.

Matthias.

From matthias at rabbitmq.com  Fri Jan 18 20:52:24 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 18 Jan 2013 20:52:24 +0000
Subject: [rabbitmq-discuss] no function clause matching
	amqp_network_connection:handle_message
In-Reply-To: <F9E85480F62349458DF67CE8BA000D8D2A645D94@FR44EX3004.global.ds.honeywell.com>
References: <F9E85480F62349458DF67CE8BA000D8D2A645D94@FR44EX3004.global.ds.honeywell.com>
Message-ID: <50F9B608.8030403@rabbitmq.com>

Petr,

On 18/01/13 15:14, Gotthard, Petr wrote:
> when an Erlang client 2.8.7 connection is closed by force (by calling
> gen_tcp:close) we are getting the following message
>
> gen_server <0.331.0> terminated with reason: no function clause matching
> amqp_network_connection:handle_message({'EXIT',#Port<0.6672>,normal},
> {state,#Port<0.6672>,5,<0.335.0>,131072,undefined,false}) line 57
>
> According to the source codes the ?EXIT? message is really not handled
> in amqp_network_connection. Could this be a bug, or did we do something
> wrong?
>
> Note we cannot call amqp_connection:close because the link is dead at
> that moment. We only want to close the connection without waiting for
> the heartbeats to discover the link is inactive.

The 3.0.x Erlang client has a 'close' function with a timeout value. 
When the timeout occurs the connection is closed forcefully. That *may* 
do what you want. Give it a try.

Regards,

Matthias.

From mcintoshj at gmail.com  Fri Jan 18 21:14:24 2013
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Fri, 18 Jan 2013 15:14:24 -0600
Subject: [rabbitmq-discuss] RabbitMQAdmin declare parameters
In-Reply-To: <50F92C8F.302@rabbitmq.com>
References: <CAD6m6fFBBHfVrg+LRfyKGgGc5L7B5z2Vemb0AzE9XFqOuGkSmw@mail.gmail.com>
	<50F92C8F.302@rabbitmq.com>
Message-ID: <CAD6m6fGbwngRgy-FzfQ8zStTecHE9HOWp5kz_j6aLbSLJKMnWw@mail.gmail.com>

So I actually moddified the rabbitmqadmin stuff myself to add support.
 Either method would work, attached is the diff with the changes I made if
you'd prefer something like it.  It adds similar to the option parameters
argument parameters for the 3 I've seen the most - x-dead-letter-exchange,
x-dead-letter-routing-key, and alternate-exchange.  Obviously dead letters
are for queues and alternate exchanges are for exchanges :)

Jason



On Fri, Jan 18, 2013 at 5:05 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 17/01/13 17:27, Jason McIntosh wrote:
>
>> I was looking to see if I could pass
>> arguments to the creation of the exchange somehow.  Any advice on this?
>>
>
> This isn't possible in the version of rabbitmqadmin that ships with 3.0.1.
> But I just merged support for arguments. So you can download an updated
> rabbitmqadmin from
>
> http://hg.rabbitmq.com/**rabbitmq-management/raw-file/**
> 5c771ead6890/bin/rabbitmqadmin<http://hg.rabbitmq.com/rabbitmq-management/raw-file/5c771ead6890/bin/rabbitmqadmin>
>
> and then use it like so:
>
> rabbitmqadmin declare exchange name=test type=topic \
>   'arguments={"alternate-**exchange":"amq.fanout"}'
>
> (The single quotes are there to defend the JSON from sh. Quoting rules may
> differ in other shells or on Windows.)
>
> This feature will ship in 3.1.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>



-- 
Jason McIntosh
http://mcintosh.poetshome.com/blog/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130118/690b47d1/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbitmqadmin.diff
Type: application/octet-stream
Size: 2576 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130118/690b47d1/attachment.obj>

From mcintoshj at gmail.com  Fri Jan 18 21:21:19 2013
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Fri, 18 Jan 2013 15:21:19 -0600
Subject: [rabbitmq-discuss] Scripts to create shovel configuration for
	multiple queues
Message-ID: <CAD6m6fH8D0Apj-hEKqQnBkq-mfDJoFfAN5crycNVigKUbXFJ5w@mail.gmail.com>

I'm attaching a couple of sample scripts for creating shovel configurations
(these are basic basic examples).  Just thought I'd share in case others
might have use of em.  We're using remote servers and configuring them with
shovel to send them to an enterprise warehouse.  Since federation is a pull
not a push, shovel tends to work better to dynamically allow clients to
come online and start sending data.  Anyways, thought I'd share and see
what people thought,
Jason
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130118/486c5939/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: config.sh
Type: application/x-sh
Size: 525 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130118/486c5939/attachment.sh>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: single_shovel.template.erl
Type: application/octet-stream
Size: 483 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130118/486c5939/attachment.obj>

From cpenev at incognito.com  Fri Jan 18 22:24:19 2013
From: cpenev at incognito.com (Chris Penev)
Date: Fri, 18 Jan 2013 14:24:19 -0800
Subject: [rabbitmq-discuss] High Cpu Usage
Message-ID: <CAPT6dp2pQQFv0Ui4d2j_N-Tee=qMzmL6tDaR7aXjpLi0t29-Vw@mail.gmail.com>

On December 21, 2012, I noticed my rabbitmq server using up 100% cpu even
though I had nothing connected to it. I checked my uptime (70 days) and
noted when rabbitmq was started (Oct 25).

Two days ago I once again, accidentally decided to check what processes are
running and how much cpu they are taking, noticing rabbitmq once again at a
steady 45% cpu.

Following this I wrote a simple shell script to monitor the resource usage
of rabbitmq. It became clear in the first eight hours and rabbitmq was
"leaking" resources, consuming more and more cpu, even though _no_ services
were connected to it. I kept the script running (cron job taking eight top
samples every 30 minutes) and graphed the cpu usage using gnuplot
(following the first eight hours, I then did start connecting and
disconnecting rabbitmq-clients).

I have attached below the graph I plotted, as well as the top samples that
were taken. The version of rabbitmq I am using is 2.7.1

$ echo $(< /etc/issue); uname -a; erl -version
Debian GNU/Linux wheezy/sid \n \l
Linux cpenev 3.2.0-4-amd64 #1 SMP Debian 3.2.32-1 x86_64 GNU/Linux
Erlang (SMP,ASYNC_THREADS) (BEAM) emulator version 5.9.1
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130118/4d2eba91/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: cpu.txt.gz
Type: application/x-gzip
Size: 11859 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130118/4d2eba91/attachment.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: graph.png
Type: image/png
Size: 64889 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130118/4d2eba91/attachment.png>

From cpenev at incognito.com  Fri Jan 18 22:27:26 2013
From: cpenev at incognito.com (Chris Penev)
Date: Fri, 18 Jan 2013 14:27:26 -0800
Subject: [rabbitmq-discuss] High Cpu Usage
In-Reply-To: <CAPT6dp2pQQFv0Ui4d2j_N-Tee=qMzmL6tDaR7aXjpLi0t29-Vw@mail.gmail.com>
References: <CAPT6dp2pQQFv0Ui4d2j_N-Tee=qMzmL6tDaR7aXjpLi0t29-Vw@mail.gmail.com>
Message-ID: <CAPT6dp1uALD1ZyOLv=K1tpAayCJHpA5a0qiminnxia7cBvnUmw@mail.gmail.com>

Once I restart the server, cpu usage drops back down to less than one
percent.

On Fri, Jan 18, 2013 at 2:24 PM, Chris Penev <cpenev at incognito.com> wrote:

> On December 21, 2012, I noticed my rabbitmq server using up 100% cpu even
> though I had nothing connected to it. I checked my uptime (70 days) and
> noted when rabbitmq was started (Oct 25).
>
> Two days ago I once again, accidentally decided to check what processes
> are running and how much cpu they are taking, noticing rabbitmq once again
> at a steady 45% cpu.
>
> Following this I wrote a simple shell script to monitor the resource usage
> of rabbitmq. It became clear in the first eight hours and rabbitmq was
> "leaking" resources, consuming more and more cpu, even though _no_ services
> were connected to it. I kept the script running (cron job taking eight top
> samples every 30 minutes) and graphed the cpu usage using gnuplot
> (following the first eight hours, I then did start connecting and
> disconnecting rabbitmq-clients).
>
> I have attached below the graph I plotted, as well as the top samples that
> were taken. The version of rabbitmq I am using is 2.7.1
>
> $ echo $(< /etc/issue); uname -a; erl -version
> Debian GNU/Linux wheezy/sid \n \l
> Linux cpenev 3.2.0-4-amd64 #1 SMP Debian 3.2.32-1 x86_64 GNU/Linux
> Erlang (SMP,ASYNC_THREADS) (BEAM) emulator version 5.9.1
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130118/8ba4f1cb/attachment.htm>

From dmitriy.bannikov at gmail.com  Fri Jan 18 22:42:43 2013
From: dmitriy.bannikov at gmail.com (Dmitriy Bannikov)
Date: Fri, 18 Jan 2013 14:42:43 -0800
Subject: [rabbitmq-discuss] ReturnListener is not invoked
In-Reply-To: <50F9B0E3.3000808@rabbitmq.com>
References: <c44e9322-9f6c-4272-bb61-c74210f32d9c@googlegroups.com>
	<50F8EE8A.4050602@rabbitmq.com>
	<CAOLJz+hh2BXopekfrdvMrhiTofHMWOb=4rDSf2gdmP5qsjkUdg@mail.gmail.com>
	<50F9B0E3.3000808@rabbitmq.com>
Message-ID: <CAOLJz+gV8d5-iehNCofsMsxqyRp01oEvyt8C18K8VX8d9GNEbA@mail.gmail.com>

Yes, I see client connections in the log


2013/1/18 Matthias Radestock <matthias at rabbitmq.com>

> On 18/01/13 20:18, Dmitriy Bannikov wrote:
>
>> I think it's a problem of this particular instance. I've downgraded
>> RabbitMQ to 2.8.7, and still have same behavior - no reaction to invalid
>> action, no errors at all.
>>
>> I've checked RabbitMQ logs - nothing related to my actions.
>>
>
> Do you see the client *connections* in the logs? If not then perhaps your
> test code is talking to a different server.
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130118/27aaa477/attachment.htm>

From matthias at rabbitmq.com  Fri Jan 18 23:05:17 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 18 Jan 2013 23:05:17 +0000
Subject: [rabbitmq-discuss] ReturnListener is not invoked
In-Reply-To: <CAOLJz+gV8d5-iehNCofsMsxqyRp01oEvyt8C18K8VX8d9GNEbA@mail.gmail.com>
References: <c44e9322-9f6c-4272-bb61-c74210f32d9c@googlegroups.com>
	<50F8EE8A.4050602@rabbitmq.com>
	<CAOLJz+hh2BXopekfrdvMrhiTofHMWOb=4rDSf2gdmP5qsjkUdg@mail.gmail.com>
	<50F9B0E3.3000808@rabbitmq.com>
	<CAOLJz+gV8d5-iehNCofsMsxqyRp01oEvyt8C18K8VX8d9GNEbA@mail.gmail.com>
Message-ID: <50F9D52D.9070001@rabbitmq.com>

On 18/01/13 22:42, Dmitriy Bannikov wrote:
> Yes, I see client connections in the log

That's all very strange.

please run your test program against the RabbitMQ protocol tracer 
(http://www.rabbitmq.com/api-guide.html#tracer) and post the tracer 
output here.

Regards,

Matthias.


From matthias at rabbitmq.com  Fri Jan 18 23:09:40 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 18 Jan 2013 23:09:40 +0000
Subject: [rabbitmq-discuss] High Cpu Usage
In-Reply-To: <CAPT6dp1uALD1ZyOLv=K1tpAayCJHpA5a0qiminnxia7cBvnUmw@mail.gmail.com>
References: <CAPT6dp2pQQFv0Ui4d2j_N-Tee=qMzmL6tDaR7aXjpLi0t29-Vw@mail.gmail.com>
	<CAPT6dp1uALD1ZyOLv=K1tpAayCJHpA5a0qiminnxia7cBvnUmw@mail.gmail.com>
Message-ID: <50F9D634.8060607@rabbitmq.com>

On 18/01/13 22:27, Chris Penev wrote:
> Once I restart the server, cpu usage drops back down to less than one
> percent.

I suggest you upgrade the server to the latest release (3.0.1). Quite a 
few resource usage related issues were addressed since the 2.7.1 version 
you are running.

Matthias.

From cpenev at incognito.com  Fri Jan 18 23:10:45 2013
From: cpenev at incognito.com (Chris Penev)
Date: Fri, 18 Jan 2013 15:10:45 -0800
Subject: [rabbitmq-discuss] High Cpu Usage
In-Reply-To: <50F9D634.8060607@rabbitmq.com>
References: <CAPT6dp2pQQFv0Ui4d2j_N-Tee=qMzmL6tDaR7aXjpLi0t29-Vw@mail.gmail.com>
	<CAPT6dp1uALD1ZyOLv=K1tpAayCJHpA5a0qiminnxia7cBvnUmw@mail.gmail.com>
	<50F9D634.8060607@rabbitmq.com>
Message-ID: <CAPT6dp3i9g0DgQgTWWXiQx-yjgjwJ+UrO6wHgvpqTSEfFv6OPw@mail.gmail.com>

Will do and post an update. Thanks for the reply.

On Fri, Jan 18, 2013 at 3:09 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> On 18/01/13 22:27, Chris Penev wrote:
>
>> Once I restart the server, cpu usage drops back down to less than one
>> percent.
>>
>
> I suggest you upgrade the server to the latest release (3.0.1). Quite a
> few resource usage related issues were addressed since the 2.7.1 version
> you are running.
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130118/9ad4e5de/attachment.htm>

From dmitriy.bannikov at gmail.com  Fri Jan 18 23:43:10 2013
From: dmitriy.bannikov at gmail.com (Dmitriy Bannikov)
Date: Fri, 18 Jan 2013 15:43:10 -0800
Subject: [rabbitmq-discuss] ReturnListener is not invoked
In-Reply-To: <50F9D52D.9070001@rabbitmq.com>
References: <c44e9322-9f6c-4272-bb61-c74210f32d9c@googlegroups.com>
	<50F8EE8A.4050602@rabbitmq.com>
	<CAOLJz+hh2BXopekfrdvMrhiTofHMWOb=4rDSf2gdmP5qsjkUdg@mail.gmail.com>
	<50F9B0E3.3000808@rabbitmq.com>
	<CAOLJz+gV8d5-iehNCofsMsxqyRp01oEvyt8C18K8VX8d9GNEbA@mail.gmail.com>
	<50F9D52D.9070001@rabbitmq.com>
Message-ID: <CAOLJz+hRzG_pYdnVKyay4OTYTLX5sraQn+O0dNxaAX1_0kxMsw@mail.gmail.com>

This is tracer output:

*java -cp rabbitmq-client.jar com.rabbitmq.tools.Tracer 5673 localhost 5672*

Usage: Tracer [<listenport> [<connecthost> [<connectport>]]]
   Serially traces connections on the <listenport>, logging
   frames received and passing them to the connect host and port.
Invoked as: Tracer 5673 localhost 5672
com.rabbitmq.tools.Tracer.WITHHOLD_INBOUND_HEARTBEATS = false
com.rabbitmq.tools.Tracer.WITHHOLD_OUTBOUND_HEARTBEATS = false
com.rabbitmq.tools.Tracer.NO_ASSEMBLE_FRAMES = false
com.rabbitmq.tools.Tracer.NO_DECODE_FRAMES = false
com.rabbitmq.tools.Tracer.SUPPRESS_COMMAND_BODIES = false
1358552412716: <Tracer-0> ch#0 <-
{#method<connection.start>(version-major=0, version-minor=9,
server-properties={product=RabbitMQ, information=Licensed under the MPL.
 See http://www.rabbitmq.com/, platform=Erlang/OTP,
capabilities={exchange_exchange_bindings=true, consumer_cancel_notify=true,
basic.nack=true, publisher_confirms=true}, copyright=Copyright (C)
2007-2012 VMware, Inc., version=2.8.7}, mechanisms=PLAIN AMQPLAIN,
locales=en_US), null, ""}
1358552412751: <Tracer-0> ch#0 ->
{#method<connection.start-ok>(client-properties={product=RabbitMQ,
information=Licensed under the MPL. See http://www.rabbitmq.com/,
platform=Java, capabilities={exchange_exchange_bindings=true,
publisher_confirms=true, basic.nack=true, consumer_cancel_notify=true},
copyright=Copyright (C) 2007-2012 VMware, Inc., version=2.8.6},
mechanism=PLAIN, response=testusrtestpwd, locale=en_US), null, ""}
1358552412790: <Tracer-0> ch#0 <- {#method<connection.tune>(channel-max=0,
frame-max=131072, heartbeat=0), null, ""}
1358552412795: <Tracer-0> ch#0 ->
{#method<connection.tune-ok>(channel-max=0, frame-max=131072, heartbeat=0),
null, ""}
1358552412796: <Tracer-0> ch#0 -> {#method<connection.open>(virtual-host=/,
capabilities=, insist=false), null, ""}
1358552412835: <Tracer-0> ch#0 <-
{#method<connection.open-ok>(known-hosts=), null, ""}
1358552412886: <Tracer-0> ch#1 -> {#method<channel.open>(out-of-band=),
null, ""}
1358552412926: <Tracer-0> ch#1 <- {#method<channel.open-ok>(channel-id=),
null, ""}
1358552412974: <Tracer-0> ch#1 -> {#method<basic.publish>(ticket=0,
exchange=, routing-key=fake_queue_112233, mandatory=true, immediate=false),
#contentHeader<basic>(content-type=application/octet-stream,
content-encoding=null, headers=null, delivery-mode=2, priority=0,
correlation-id=null, reply-to=null, expiration=null, message-id=null,
timestamp=null, type=null, user-id=null, app-id=null, cluster-id=null),
"Test String"}


Best regards,
*Dmitriy*

2013/1/18 Matthias Radestock <matthias at rabbitmq.com>

> On 18/01/13 22:42, Dmitriy Bannikov wrote:
>
>> Yes, I see client connections in the log
>>
>
> That's all very strange.
>
> please run your test program against the RabbitMQ protocol tracer (
> http://www.rabbitmq.com/api-**guide.html#tracer<http://www.rabbitmq.com/api-guide.html#tracer>)
> and post the tracer output here.
>
> Regards,
>
> Matthias.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130118/698e2c3b/attachment.htm>

From matthias at rabbitmq.com  Sat Jan 19 12:03:13 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 19 Jan 2013 12:03:13 +0000
Subject: [rabbitmq-discuss] ReturnListener is not invoked
In-Reply-To: <CAOLJz+hRzG_pYdnVKyay4OTYTLX5sraQn+O0dNxaAX1_0kxMsw@mail.gmail.com>
References: <c44e9322-9f6c-4272-bb61-c74210f32d9c@googlegroups.com>
	<50F8EE8A.4050602@rabbitmq.com>
	<CAOLJz+hh2BXopekfrdvMrhiTofHMWOb=4rDSf2gdmP5qsjkUdg@mail.gmail.com>
	<50F9B0E3.3000808@rabbitmq.com>
	<CAOLJz+gV8d5-iehNCofsMsxqyRp01oEvyt8C18K8VX8d9GNEbA@mail.gmail.com>
	<50F9D52D.9070001@rabbitmq.com>
	<CAOLJz+hRzG_pYdnVKyay4OTYTLX5sraQn+O0dNxaAX1_0kxMsw@mail.gmail.com>
Message-ID: <50FA8B81.3020401@rabbitmq.com>

Dmitriy,

On 18/01/13 23:43, Dmitriy Bannikov wrote:
> This is tracer output:
> [...]

So there is indeed no basic.return to be seen. Very strange.

Does the program terminate at the end or just sit there? It *should* do 
the latter.

Also, please repeat the test using the both the 3.0.1 Java client and 
broker.

Regards,

Matthias.

From matthias at rabbitmq.com  Sat Jan 19 12:16:22 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 19 Jan 2013 12:16:22 +0000
Subject: [rabbitmq-discuss] ReturnListener is not invoked
In-Reply-To: <50FA8B81.3020401@rabbitmq.com>
References: <c44e9322-9f6c-4272-bb61-c74210f32d9c@googlegroups.com>
	<50F8EE8A.4050602@rabbitmq.com>
	<CAOLJz+hh2BXopekfrdvMrhiTofHMWOb=4rDSf2gdmP5qsjkUdg@mail.gmail.com>
	<50F9B0E3.3000808@rabbitmq.com>
	<CAOLJz+gV8d5-iehNCofsMsxqyRp01oEvyt8C18K8VX8d9GNEbA@mail.gmail.com>
	<50F9D52D.9070001@rabbitmq.com>
	<CAOLJz+hRzG_pYdnVKyay4OTYTLX5sraQn+O0dNxaAX1_0kxMsw@mail.gmail.com>
	<50FA8B81.3020401@rabbitmq.com>
Message-ID: <50FA8E96.8050805@rabbitmq.com>

On 19/01/13 12:03, Matthias Radestock wrote:
> So there is indeed no basic.return to be seen. Very strange.
>
> Does the program terminate at the end or just sit there? It *should* do
> the latter.
>
> Also, please repeat the test using the both the 3.0.1 Java client and
> broker.

Scratch that. I found the problem:

 From your 'rabbitmqctl status' output...

  {disk_free_limit,1000000000},
  {disk_free,267063296},

So you have less than the required 1GB disk space available and hence 
publishing will be blocked. See 
http://www.rabbitmq.com/memory.html#diskfreesup-usage

There should be an alarm recorded in the logs. Please check. And the 
alarm should be visible in the management UI too. And any publishing 
connections should show as 'blocked' in both 'rabbitmqctl 
list_connection' and the management UI.

Regards,

Matthias.

From zhujun.corp at gmail.com  Sat Jan 19 12:38:34 2013
From: zhujun.corp at gmail.com (uniguyit)
Date: Sat, 19 Jan 2013 04:38:34 -0800 (PST)
Subject: [rabbitmq-discuss] Appear ''SharedQueue closed" Error when i send
 RabbitMQ Message in MonoProject(iOS)
Message-ID: <1358599114463-24584.post@n5.nabble.com>

I have correctly send message in MonoTouch Project using RabbitMQ.NET Client
DLL. 

and use this to get receive messages(all parameters is correct): 

                        IModel channel=null; 
                        string ServerIP="192.168.68.4"; 
                        string queueName="172.16.1.1"; 
                        //int port=15672; 
                        ConnectionFactory cf=new ConnectionFactory(); 
                        
                        
                        cf.HostName=ServerIP; 
                
                        
                        //
cf.Protocol=RabbitMQ.Client.Protocols.DefaultProtocol; 
                        
                        IConnection conn=cf.CreateConnection(); 
                                
                        Console.WriteLine ("factory.CreateConnection()"); 

                        channel = conn.CreateModel (); 

                        Console.WriteLine ("RECEIVE :
_RMQConnection.CreateModel()"); 

                        channel.QueueDeclare(queueName, true,
false,false,null); 
                        

        
                                _receiveMessageConsumer = new
QueueingBasicConsumer(channel); 
                                
                                channel.BasicConsume(queueName, true,
_receiveMessageConsumer); 

                               
Console.WriteLine("channel.BasicConsume(_QueueName, true,
_receiveMessageConsumer)...."); 

                                while (_DoneFlag==false) { 
                                        object result = null; 
                                       
_receiveMessageConsumer.Queue.Dequeue(400, out result); 
                                        
                                BasicDeliverEventArgs messageInEnvelope =
null; 
                                   if (result!=null) 
                                { 
                                        messageInEnvelope =
(BasicDeliverEventArgs)result; 
                                } 
                                        
                                        if (messageInEnvelope == null) { 
                                                
                                               
Console.WriteLine("messageInEnvelope == null)"); 
                                                continue; 
                                        } 
                                        
                                        byte[] bytes =
messageInEnvelope.Body;                     
                                        string
str=System.Text.Encoding.UTF8.GetString(bytes);                     
                                        Console.WriteLine("???????" + str); 
                                        
                                        //RMQMessage msg =
JsonConvert.DeserializeObject<RMQMessage>(System.Text.Encoding.UTF8.GetString(bytes)); 

                                //System.Threading.Thread.Sleep(30); 
                                } 


---> When i send message to RabbitMQ Server(by manual or programmiaclly) ,
it occurs ''SharedQueue closed" Error (System.IO.EndOfStreamException )....
help :) 

Those are all exception information: 


System.IO.EndOfStreamException: SharedQueue closed 
  at RabbitMQ.Util.SharedQueue.EnsureIsOpen () [0x00000] in <filename
unknown>:0 
  at RabbitMQ.Util.SharedQueue.Dequeue (Int32 millisecondsTimeout,
System.Object& result) [0x00000] in <filename unknown>:0 
  at RabbitMQ_MonoTouchTest.MainViewController.StartReceiveTest1 ()
[0x00082] in
/Users/yj/Desktop/RMQ2/RabbitMQ/RabbitMQ_MonoTouchTest/MainViewController.cs:163 
  at RabbitMQ_MonoTouchTest.MainViewController.ViewDidLoad () [0x00006] in
/Users/yj/Desktop/RMQ2/RabbitMQ/RabbitMQ_MonoTouchTest/MainViewController.cs:63 
  at (wrapper managed-to-native)
MonoTouch.UIKit.UIApplication:UIApplicationMain (int,string[],intptr,intptr) 
  at MonoTouch.UIKit.UIApplication.Main (System.String[] args, System.String
principalClassName, System.String delegateClassName) [0x0004c] in
/Developer/MonoTouch/Source/monotouch/src/UIKit/UIApplication.cs:38 
  at RabbitMQ_MonoTouchTest.Application.Main (System.String[] args)
[0x00000] in
/Users/yj/Desktop/RMQ2/RabbitMQ/RabbitMQ_MonoTouchTest/Main.cs:27 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Appear-SharedQueue-closed-Error-when-i-send-RabbitMQ-Message-in-MonoProject-iOS-tp24584.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From zhujun.corp at gmail.com  Sat Jan 19 15:04:37 2013
From: zhujun.corp at gmail.com (uniguyit)
Date: Sat, 19 Jan 2013 07:04:37 -0800 (PST)
Subject: [rabbitmq-discuss] Occurs 404 or 405 http error when use RabbitMQ
	HTTP API
Message-ID: <1358607877596-24585.post@n5.nabble.com>


I use .NET Code 's Webclient and Firefox's HTTPRequester to call RabbitMQ
HTTP API ( for getting queue messages) , it not work , and occurs 405 or 405
ERROR, or : The requested document was not found on this server!!


all parameters are correct.

but i use FireFox to post the same parameters ,the same URL i can get
correct RabbitMQ Message!

Those are code:

				string serverIP="192.168.68.4";				
				string localIP="172.16.1.1";				
				int port=15672;				
				string apiaddr ="/api/queues/%2F/" + localIP + "/get";
				string requestURL="http://" + serverIP + ":" + port + apiaddr;			
				string
postbody="{\"vhost\":\"/\",\"name\":\"172.16.1.1\",\"truncate\":\"50000\",\"requeue\":\"true\",\"encoding\":\"auto\",\"count\":\"1\"}";
					
				Console.WriteLine(requestURL);
				Console.WriteLine(postbody);
				WebClient wc=new WebClient();

	
			//wc.Headers["Connection"]="keep-alive";

			wc.Headers["Content-Type"]="application/json; charset=UTF-8";

			wc.Headers["Pragma"]="no-cache";


			wc.Credentials=new System.Net.NetworkCredential("guest","guest");

				string result=	wc.UploadString(requestURL,"POST",postbody);



---> RMQServer 3.0.1 Version and  3.0.1 .NET Client DLL.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Occurs-404-or-405-http-error-when-use-RabbitMQ-HTTP-API-tp24585.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From jbdupont at gmail.com  Sat Jan 19 18:26:25 2013
From: jbdupont at gmail.com (jbdupont)
Date: Sat, 19 Jan 2013 10:26:25 -0800 (PST)
Subject: [rabbitmq-discuss] Cluster nodes stop/start order can lead
	to	failures
In-Reply-To: <87k3vn8qo0.wl%francesco@rabbitmq.com>
References: <4e96ad11-4d71-4858-8faa-9323e5a6b8e2@googlegroups.com>
	<8ad1ab95-fa5c-4fda-b8f3-b096664147e9@googlegroups.com>
	<9c2c6423-65f7-4a18-82d7-edbfc6b17272@googlegroups.com>
	<87k3vn8qo0.wl%francesco@rabbitmq.com>
Message-ID: <1358619985694-24586.post@n5.nabble.com>

Ok, I understand the reasoning behind this behaviour.
However, how can I unlock the situation of the node that I cannot restart at
the moment?

My app is such that node2 is the normal, node1 is used as backup is node2
fails.
When I restart I may be in a situation where node2 is started first and then
node1 - at present I fall into a lock situation.

Is there a way to start afresh node2 without being stuck in the current
situation?
For instance restarting out of the cluster, and then joining the cluster
again ?

That would suit my needs actually.

Othewise, I would need to design a different architecture without cluster...
This may be the way I will have to go.

Thanks to point me into the right direction on this.
Regards,
jb



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Cluster-nodes-stop-start-order-can-lead-to-failures-tp21965p24586.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From cpenev at incognito.com  Sat Jan 19 20:49:01 2013
From: cpenev at incognito.com (Chris Penev)
Date: Sat, 19 Jan 2013 12:49:01 -0800
Subject: [rabbitmq-discuss] High Cpu Usage
In-Reply-To: <CAPT6dp3i9g0DgQgTWWXiQx-yjgjwJ+UrO6wHgvpqTSEfFv6OPw@mail.gmail.com>
References: <CAPT6dp2pQQFv0Ui4d2j_N-Tee=qMzmL6tDaR7aXjpLi0t29-Vw@mail.gmail.com>
	<CAPT6dp1uALD1ZyOLv=K1tpAayCJHpA5a0qiminnxia7cBvnUmw@mail.gmail.com>
	<50F9D634.8060607@rabbitmq.com>
	<CAPT6dp3i9g0DgQgTWWXiQx-yjgjwJ+UrO6wHgvpqTSEfFv6OPw@mail.gmail.com>
Message-ID: <CAPT6dp0CsqvDorfhA3uBFvrYmdet3+ZWdxZVXT2r8GV--SkPKg@mail.gmail.com>

After updating to 3.0.1 this bug is not longer reproducible. Thanks for
your help.

On Fri, Jan 18, 2013 at 3:10 PM, Chris Penev <cpenev at incognito.com> wrote:

> Will do and post an update. Thanks for the reply.
>
>
> On Fri, Jan 18, 2013 at 3:09 PM, Matthias Radestock <matthias at rabbitmq.com
> > wrote:
>
>> On 18/01/13 22:27, Chris Penev wrote:
>>
>>> Once I restart the server, cpu usage drops back down to less than one
>>> percent.
>>>
>>
>> I suggest you upgrade the server to the latest release (3.0.1). Quite a
>> few resource usage related issues were addressed since the 2.7.1 version
>> you are running.
>>
>> Matthias.
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130119/968aedea/attachment.htm>

From pekowski at gmail.com  Sun Jan 20 05:47:56 2013
From: pekowski at gmail.com (Ray Pekowski)
Date: Sat, 19 Jan 2013 23:47:56 -0600
Subject: [rabbitmq-discuss] RabbitMQ scaling with OpenStack
In-Reply-To: <CAJcv3CRYfYsNsVSKkdJVm2frtqkF=CjTvmX+v3u9JdEEHrDtog@mail.gmail.com>
References: <CAJcv3CRYfYsNsVSKkdJVm2frtqkF=CjTvmX+v3u9JdEEHrDtog@mail.gmail.com>
Message-ID: <CAJcv3CT6NwrQX0TEL0g6iPT=amKa7Pi2xdHfTdWGZTBECghZzw@mail.gmail.com>

Alexis,

Thanks for commenting.

On Fri, Jan 18, 2013 at 17:14 GMT, Alexis Richardson
<alexis at rabbitmq.com> wrote:
>
> Some of the numbers you saw seem oddly low, and I wonder if there is
> more going on that is easily fixed.  The config of Rabbit in OpenStack
> may be very borked.

Some possible things that could make the results lower than you would
expect are:
1) All machines are virtual machines, including the RabbitMQ servers.
Virtualization typically costs around 40%.
2) All VMs were only assigned 2 CPUs.  The CPUs are Intel Xeon E5620 @ 2.4 GHz.

>
> Can I ask what clients you used?  It may be worth testing a few different ones.>>

OpenStack uses the kombu.  Unless there is a client with a compatible
API, I don't think it would be easy to change.

Ray

From pekowski at gmail.com  Sun Jan 20 05:59:40 2013
From: pekowski at gmail.com (Ray Pekowski)
Date: Sat, 19 Jan 2013 23:59:40 -0600
Subject: [rabbitmq-discuss] RabbitMQ scaling with OpenStack
In-Reply-To: <CAJcv3CRYfYsNsVSKkdJVm2frtqkF=CjTvmX+v3u9JdEEHrDtog@mail.gmail.com>
References: <CAJcv3CRYfYsNsVSKkdJVm2frtqkF=CjTvmX+v3u9JdEEHrDtog@mail.gmail.com>
Message-ID: <CAJcv3CS+U8Or2vHbb7hhAt8sOKbquvDR=Z=05KEhHp2WhM5mFw@mail.gmail.com>

On Fri Jan 18 17:58:58 GMT 2013, Matthias Radestock
<matthias at rabbitmqp.com> wrote:

> And *what versions* of the client and the server. For example, mirrored
> queue performance, which is part of the tests, improved significantly in
> 3.0.0, and again in 3.0.1.

Good question.  I'm using these versions:

rabbitmq-server 3.0.0-1
python-kombu 1.4.3-1

I'm glad to hear that mirroring continues to be improved.

Ray

From mabra77 at gmail.com  Sun Jan 20 15:57:39 2013
From: mabra77 at gmail.com (mabra)
Date: Sun, 20 Jan 2013 07:57:39 -0800 (PST)
Subject: [rabbitmq-discuss] rabbitmqctl.bat not working:Cookie handling
 problem [windows multi-user access]
Message-ID: <3d3768a0-0370-49e6-9bb8-bdeb230a662d@googlegroups.com>

Hello !

I want to control the shovel status [start/stop/get] and I have to this 
from my own program,
which just spawns a sub-process, which uses "rabbitmqctl.bat". It does not 
work, but this
is decribed in the trouble shooting document a bit.

I needed hours to find out the consequence of this statement [from the 
troubleshooting guide]:

"Evidence of this comes in the form of a mismatch in the node home dir 
shown by the broker on startup vs what is displayed in the rabbitmqctl 
diagnostics."

is just no help on how to find the cookie, which is in use and how to allow 
other users
to use this. In the service-docs is just a small hint:

"It is therefore necessary to synchronise Erlang cookies
   between the local system account (typically C:\WINDOWS\.erlang.cookie and
   the account that will be used to run rabbitmqctl"

This leads to the little nightmare to copy the services cookie to all users 
homedirs,
which should be able to run "rabbitmqctl.bat". The cookie value is not in 
the services
logfile, so, one cannot know it.

So, is ther another way ? This way would require to copy the cookie each 
time, the
service is restarted [so, at least on each boot!]. Is there probably a 
direct accessible
way from a Net Framework program ?

Thanks,

++mabra

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130120/fd3d45e9/attachment.htm>

From mabra77 at gmail.com  Sun Jan 20 16:07:07 2013
From: mabra77 at gmail.com (mabra)
Date: Sun, 20 Jan 2013 08:07:07 -0800 (PST)
Subject: [rabbitmq-discuss] logfile maintenance in windows
Message-ID: <7422e7d8-29aa-429d-9a20-a4037e5717ff@googlegroups.com>

Hello !

The logfile grows and grows ... Is there any way to make a roll-over or 
have a logfile
per date ?

Another thing so would be to find a documentation, which shows the 
structure of the
logentries. Because nothing is logged into the Windows NT Eventlog, one has 
to
parse it by a separate program. So it is essential to find, where a 
messages starts
and stops and mostly, if the entry is an information, a warning or an error.

Sorry to say that, but this is completely platform ignorance :-(
[Even the delimiter of the messages is unix].

Thanks so far,

++mabra

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130120/c56aeed7/attachment.htm>

From mabra77 at gmail.com  Sun Jan 20 16:40:56 2013
From: mabra77 at gmail.com (mabra)
Date: Sun, 20 Jan 2013 08:40:56 -0800 (PST)
Subject: [rabbitmq-discuss] shovel status improperly displayed on web UI
Message-ID: <366bfb7b-4683-4b41-a0fa-f062f0079119@googlegroups.com>

Hello !

I am playing around with shovel and I am usually using the RabbitMQ Web 
Management.
If I stop shovel via commandline, the status on the webpage causes an 
"internal server error".
I have expected to see "status:stopped" [or something like this]. Is this 
"by design" or more
"like a bug" ??

[BTW: The bug-display is not removed, is shovel is up again].

Best regards,

++mabra

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130120/b37da3fa/attachment.htm>

From tim at rabbitmq.com  Sun Jan 20 19:23:55 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Sun, 20 Jan 2013 19:23:55 +0000
Subject: [rabbitmq-discuss] shovel status improperly displayed on web UI
In-Reply-To: <366bfb7b-4683-4b41-a0fa-f062f0079119@googlegroups.com>
References: <366bfb7b-4683-4b41-a0fa-f062f0079119@googlegroups.com>
Message-ID: <FDAFE33B-126C-4D73-B8FF-5376C9E5551A@rabbitmq.com>

Hi Mabra,

Can you post a screenshot please, and what version of RabbitMQ and the shovel+management plugins are you using please?

Cheers,
Tim

On 20 Jan 2013, at 16:40, mabra wrote:

> Hello !
> 
> I am playing around with shovel and I am usually using the RabbitMQ Web Management.
> If I stop shovel via commandline, the status on the webpage causes an "internal server error".
> I have expected to see "status:stopped" [or something like this]. Is this "by design" or more
> "like a bug" ??
> 
> [BTW: The bug-display is not removed, is shovel is up again].
> 
> Best regards,
> 
> ++mabra
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From watson.timothy at gmail.com  Sun Jan 20 19:33:42 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Sun, 20 Jan 2013 19:33:42 +0000
Subject: [rabbitmq-discuss] rabbitmqctl.bat not working:Cookie handling
	problem [windows multi-user access]
In-Reply-To: <3d3768a0-0370-49e6-9bb8-bdeb230a662d@googlegroups.com>
References: <3d3768a0-0370-49e6-9bb8-bdeb230a662d@googlegroups.com>
Message-ID: <FD8AA686-4271-46F4-A946-E639EA5C0822@rabbitmq.com>

Hi

On 20 Jan 2013, at 15:57, mabra wrote:

> Hello !
> 
> I want to control the shovel status [start/stop/get] and I have to this from my own program,
> which just spawns a sub-process, which uses "rabbitmqctl.bat". It does not work, but this
> is decribed in the trouble shooting document a bit.
> 
> I needed hours to find out the consequence of this statement [from the troubleshooting guide]:
> 
> "Evidence of this comes in the form of a mismatch in the node home dir shown by the broker on startup vs what is displayed in the rabbitmqctl diagnostics."
> 
> is just no help on how to find the cookie, which is in use and how to allow other users
> to use this. In the service-docs is just a small hint:
> 
> "It is therefore necessary to synchronise Erlang cookies
>    between the local system account (typically C:\WINDOWS\.erlang.cookie and
>    the account that will be used to run rabbitmqctl"
> 

That's hardly a *small* hint - it says that 'it is necessary' to do this. Erlang nodes require a cookie file in order to secure communication with one another. Furthermore, the installation guide for Windows states categorically:

"Erlang Security Cookies used by the service account and the user running rabbitmqctl.bat must be synchronised for rabbitmqctl.bat to function. To ensure Erlang cookie files contain the same string, copy the .erlang.cookie file from the Windows directory (normally C:\WINDOWS\.erlang.cookie) to replace the user .erlang.cookie. The user cookie will be in the user's home directory (%HOMEDRIVE%%HOMEPATH%), e.g. C:\Documents and Settings\%USERNAME%\.erlang.cookie or C:\Users\%USERNAME%\.erlang.cookie (Windows Vista and later)." 

Is that not clear enough?

> This leads to the little nightmare to copy the services cookie to all users homedirs,
> which should be able to run "rabbitmqctl.bat". The cookie value is not in the services
> logfile, so, one cannot know it.
> 

Following the Windows installation guide should obviate the need to know what the cookie value is set to.

> So, is ther another way ? This way would require to copy the cookie each time, the
> service is restarted [so, at least on each boot!].

Why would you have to copy the cookie after the service was restarted? Even when running a manually installed Windows Service, you still only need to re-sync the cookies if they have changed. Perhaps I'm missing something? Can't you just copy the cookie to the home directory of the user under which the program always runs? If the cookie is static, can't you just bundle it as an assembly resource and handle it when spawning the sub-process?

> Is there probably a direct accessible
> way from a Net Framework program ?
> 

A 'direct accessible way' of doing what from a .NET program? 


From patryk.moura at gmail.com  Sun Jan 20 23:59:59 2013
From: patryk.moura at gmail.com (Patryk Moura)
Date: Sun, 20 Jan 2013 21:59:59 -0200
Subject: [rabbitmq-discuss] .net installer with rabbitmq
Message-ID: <CAEuREo0VTpzj7HccZ6GKitwHWJ0u-XeG3HqcJB8rmoUoF9Gi8w@mail.gmail.com>

Guys, there s anyway to make a installer in .net c# or in another
plataform, that installs automatically the rabbitmq, the management plugin
and that changes the guest password?

any samples ?

thanks a lot!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130120/35a430d4/attachment.htm>

From info at travo.se  Mon Jan 21 08:36:14 2013
From: info at travo.se (kecke)
Date: Mon, 21 Jan 2013 00:36:14 -0800 (PST)
Subject: [rabbitmq-discuss] WCF .net problems
Message-ID: <1358757374669-24596.post@n5.nabble.com>

We are trying to run with rabbitmq instead of msmq, due to the size limit in
msmq of 4mb per message. But we have some problems. 

1. We want the queues messages to be persistant(e.g - if rabbitmq service is
stopped and restarted the messages will still be in the queue). Is there any
way to do this(e.g set deliverymode=2) in the app.config? 

2. We want durable queues. We found in this messagelist a post about that,
and the trick was to change this on line 152 in
rabbitmq.servicemodel.rabbitmqinputchannel Before: string queue =
m_model.QueueDeclare(); After: string queue =
m_model.QueueDeclare(base.LocalAddress.Uri.AbsolutePath, true, false, false,
null); ...we then got durable queues. This couldnt be done in any other way?
3. 

We want the client(which in our case is a WCF-service) to post a message to
the queue and then forget(and be sure that sometime in the future the
message will be delivered), so we have oneway="true" in our app.configs. The
consumer is also a WCF-service. If we stop the rabbitmq server, then our
services get an error - like its always connected to RabbitMQ. Is there a
way in the app.config to tell the services we have to only connect when
messages is delivered or retrieved? 

4. It seems that the messages isn't consumed one by one-it seems that it
gets them all att once? Is there a way to tell service to fetch them one by
one? 

5. We try to do WCF and have all config in app.config, so we dont code
rabbitmq specific code. 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/WCF-net-problems-tp24596.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From doug at hacks.perl.sh  Mon Jan 21 08:37:05 2013
From: doug at hacks.perl.sh (Doug)
Date: Mon, 21 Jan 2013 16:37:05 +0800
Subject: [rabbitmq-discuss] rabbitmq gets high load
In-Reply-To: <50F94EA7.3020208@rabbitmq.com>
References: <CAJxbUuX3ODTFCmKuYDRjPW_Jz+RA5VvY4+wZN1ajLH=xuZ=ujQ@mail.gmail.com>
	<017025F8-9CD2-44F5-9187-DA26F96D0766@rabbitmq.com>
	<CAJxbUuXSxtfk8j2Tdh=60crZd155aK2-u+vZYRSQ6uSPOisbcA@mail.gmail.com>
	<50F94EA7.3020208@rabbitmq.com>
Message-ID: <CAJxbUuUEFfB9J_Ntb+b7gHj763=my2DmM7CJSeOtOUWNSJobOQ@mail.gmail.com>

Hello,

I tried to upgrade it to the latest 3.0.1 version with:

root at ubuntu:~# dpkg -i rabbitmq-server_3.0.1-1_all.deb
(Reading database ... 69128 files and directories currently installed.)
Preparing to replace rabbitmq-server 2.8.2-1 (using
rabbitmq-server_3.0.1-1_all.deb) ...
 * Stopping message broker rabbitmq-server




But the server can't get stopped. The sasl log says:

=SUPERVISOR REPORT==== 21-Jan-2013::16:24:59 ===
     Supervisor: {<0.13724.7782>,
                                           rabbit_channel_sup_sup}
     Context:    shutdown_error
     Reason:     shutdown
     Offender:   [{pid,<0.8461.1817>},
                  {name,channel_sup},
                  {mfa,{rabbit_channel_sup,start_link,[]}},
                  {restart_type,temporary},
                  {shutdown,infinity},
                  {child_type,supervisor}]

So?

Thanks.

2013/1/18 Simon MacMullen <simon at rabbitmq.com>:
> On 18/01/13 03:42, Doug wrote:
>>
>> {rabbit,"RabbitMQ","2.8.2"}
>
>
> Hmm. There have been a couple of bugs which caused high CPU load which have
> been fixed since then; it is likely to be worth upgrading; especially if you
> use mirrored queues or have more queues than file descriptors (which were
> two triggers).
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware

From matthias at rabbitmq.com  Mon Jan 21 08:46:26 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 21 Jan 2013 08:46:26 +0000
Subject: [rabbitmq-discuss] rabbitmq gets high load
In-Reply-To: <CAJxbUuUEFfB9J_Ntb+b7gHj763=my2DmM7CJSeOtOUWNSJobOQ@mail.gmail.com>
References: <CAJxbUuX3ODTFCmKuYDRjPW_Jz+RA5VvY4+wZN1ajLH=xuZ=ujQ@mail.gmail.com>
	<017025F8-9CD2-44F5-9187-DA26F96D0766@rabbitmq.com>
	<CAJxbUuXSxtfk8j2Tdh=60crZd155aK2-u+vZYRSQ6uSPOisbcA@mail.gmail.com>
	<50F94EA7.3020208@rabbitmq.com>
	<CAJxbUuUEFfB9J_Ntb+b7gHj763=my2DmM7CJSeOtOUWNSJobOQ@mail.gmail.com>
Message-ID: <50FD0062.5070108@rabbitmq.com>

On 21/01/13 08:37, Doug wrote:
> I tried to upgrade it to the latest 3.0.1 version with:
>
> root at ubuntu:~# dpkg -i rabbitmq-server_3.0.1-1_all.deb
> (Reading database ... 69128 files and directories currently installed.)
> Preparing to replace rabbitmq-server 2.8.2-1 (using
> rabbitmq-server_3.0.1-1_all.deb) ...
>   * Stopping message broker rabbitmq-server
>
> But the server can't get stopped.
>
> So?

Just kill it. Look for processes running as the 'rabbitmq' user and nuke 
them with 'kill'.

Matthias.

From doug at hacks.perl.sh  Mon Jan 21 08:53:23 2013
From: doug at hacks.perl.sh (Doug)
Date: Mon, 21 Jan 2013 16:53:23 +0800
Subject: [rabbitmq-discuss] rabbitmq gets high load
In-Reply-To: <50FD0062.5070108@rabbitmq.com>
References: <CAJxbUuX3ODTFCmKuYDRjPW_Jz+RA5VvY4+wZN1ajLH=xuZ=ujQ@mail.gmail.com>
	<017025F8-9CD2-44F5-9187-DA26F96D0766@rabbitmq.com>
	<CAJxbUuXSxtfk8j2Tdh=60crZd155aK2-u+vZYRSQ6uSPOisbcA@mail.gmail.com>
	<50F94EA7.3020208@rabbitmq.com>
	<CAJxbUuUEFfB9J_Ntb+b7gHj763=my2DmM7CJSeOtOUWNSJobOQ@mail.gmail.com>
	<50FD0062.5070108@rabbitmq.com>
Message-ID: <CAJxbUuUK6+R-BA8s24WQXXtw8rYS0ND-jpJbQ4PzHWNNYH_LWg@mail.gmail.com>

OK I have kiiled it,  things get done. Thanks.


2013/1/21 Matthias Radestock <matthias at rabbitmq.com>:
> On 21/01/13 08:37, Doug wrote:
>>
>> I tried to upgrade it to the latest 3.0.1 version with:
>>
>> root at ubuntu:~# dpkg -i rabbitmq-server_3.0.1-1_all.deb
>> (Reading database ... 69128 files and directories currently installed.)
>> Preparing to replace rabbitmq-server 2.8.2-1 (using
>> rabbitmq-server_3.0.1-1_all.deb) ...
>>   * Stopping message broker rabbitmq-server
>>
>> But the server can't get stopped.
>>
>> So?
>
>
> Just kill it. Look for processes running as the 'rabbitmq' user and nuke
> them with 'kill'.
>
> Matthias.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From watson.timothy at gmail.com  Mon Jan 21 10:00:26 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Mon, 21 Jan 2013 10:00:26 +0000
Subject: [rabbitmq-discuss] .net installer with rabbitmq
In-Reply-To: <CAEuREo0VTpzj7HccZ6GKitwHWJ0u-XeG3HqcJB8rmoUoF9Gi8w@mail.gmail.com>
References: <CAEuREo0VTpzj7HccZ6GKitwHWJ0u-XeG3HqcJB8rmoUoF9Gi8w@mail.gmail.com>
Message-ID: <D5C3BB83-D163-409A-B4C1-0CBB08675F68@rabbitmq.com>

There is an msi available in the downloads page?

On 20 Jan 2013, at 23:59, Patryk Moura <patryk.moura at gmail.com> wrote:

> Guys, there s anyway to make a installer in .net c# or in another plataform, that installs automatically the rabbitmq, the management plugin and that changes the guest password?
> 
> any samples ?
> 
> thanks a lot!
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthias at rabbitmq.com  Mon Jan 21 10:08:44 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 21 Jan 2013 10:08:44 +0000
Subject: [rabbitmq-discuss] .net installer with rabbitmq
In-Reply-To: <D5C3BB83-D163-409A-B4C1-0CBB08675F68@rabbitmq.com>
References: <CAEuREo0VTpzj7HccZ6GKitwHWJ0u-XeG3HqcJB8rmoUoF9Gi8w@mail.gmail.com>
	<D5C3BB83-D163-409A-B4C1-0CBB08675F68@rabbitmq.com>
Message-ID: <50FD13AC.4000207@rabbitmq.com>

On 21/01/13 10:00, Tim Watson wrote:
> There is an msi available in the downloads page?

I believe the OP was asking how to construct a custom installer that...

>> installs automatically the rabbitmq, the management
>> plugin and that changes the guest password

The msi only does the first of these. (well, it also installs the 
management plug-in, but it doesn't enable it).

To answer the OP... you'll have to learn to write installers, which is 
an acquired taste. MSIs can be nested, i.e. you should be able to 
construct an msi installer that includes the existing rabbit msi 
installer plus the extra bits to enable management and change the password.

Matthias.

From emile at rabbitmq.com  Mon Jan 21 10:22:47 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 21 Jan 2013 10:22:47 +0000
Subject: [rabbitmq-discuss] Appear ''SharedQueue closed" Error when i
 send RabbitMQ Message in MonoProject(iOS)
In-Reply-To: <1358599114463-24584.post@n5.nabble.com>
References: <1358599114463-24584.post@n5.nabble.com>
Message-ID: <50FD16F7.9010404@rabbitmq.com>

Hi,

On 19/01/13 12:38, uniguyit wrote:
> I have correctly send message in MonoTouch Project using RabbitMQ.NET Client
> DLL. 

> _receiveMessageConsumer.Queue.Dequeue(400, out result); 

> System.IO.EndOfStreamException: SharedQueue closed 
>   at RabbitMQ.Util.SharedQueue.EnsureIsOpen () [0x00000] in <filename
> unknown>:0 
>   at RabbitMQ.Util.SharedQueue.Dequeue (Int32 millisecondsTimeout,
> System.Object& result) [0x00000] in <filename unknown>:0 

It looks like the connection dropped while waiting for a message. Was
anything logged to the broker logfile or the sasl log when this
happened? Was there any network interruption?



-Emile





From simon at rabbitmq.com  Mon Jan 21 10:45:44 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 21 Jan 2013 10:45:44 +0000
Subject: [rabbitmq-discuss] shovel status improperly displayed on web UI
In-Reply-To: <366bfb7b-4683-4b41-a0fa-f062f0079119@googlegroups.com>
References: <366bfb7b-4683-4b41-a0fa-f062f0079119@googlegroups.com>
Message-ID: <50FD1C58.900@rabbitmq.com>

On 20/01/13 16:40, mabra wrote:
> Hello !
>
> I am playing around with shovel and I am usually using the RabbitMQ Web
> Management.
> If I stop shovel via commandline, the status on the webpage causes an
> "internal server error".

Good point - that's a bug. (Sort of - we normally assume you won't stop 
individual plugins by hand.)

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From info at travo.se  Mon Jan 21 10:46:00 2013
From: info at travo.se (kecke)
Date: Mon, 21 Jan 2013 02:46:00 -0800 (PST)
Subject: [rabbitmq-discuss] The maximum array length quota (16384) has been
 exceeded while reading XML data
Message-ID: <1358765160001-24603.post@n5.nabble.com>

Im using WCF with app.config and i get this error on the consumer that array
length need to be increased.
In normal WCF(not rabbitmq's servicemodel) I can just add
<ReaderQoutas maxArrayLength="12334444"> to <binding> in my app.config, but
this cant be done with rabbitmq? I get error that <ReaderQoutas&quot; is not
correct.
My app.config:
 &lt;system.serviceModel>

    
    <extensions>
      <bindingExtensions>
        <add
          name="rabbitMQBinding"
          type="RabbitMQ.ServiceModel.RabbitMQBindingSection,
RabbitMQ.ServiceModel, Version=1.0.110.0, Culture=neutral,
PublicKeyToken=null"/>
      </bindingExtensions>
    </extensions>


<client>
      
      <endpoint address="soap.amqp:///ResponseMessageQue"
                 binding="rabbitMQBinding"
                 bindingConfiguration="rabbitMQConfig"
                
contract="CiwisServicesResponseMessageServiceReference.ICiwisServicesResponseMessageService"
                 name="RabbitMQBinding_ICiwisServicesResponseMessageService"
                 />

    </client>

 <bindings>

      
      <rabbitMQBinding>

        <binding name="rabbitMQConfig"
                   hostname="localhost"
                   port="5672"
                   protocolversion="AMQP_0_9_1"
                   oneWay="true"
                   maxmessagesize="2147483647"                   
                  />
       
      </rabbitMQBinding>
</bindings>

 <services>


      <service
name="CAB.CABAS.UPDATE.SERVICES.Services.CabasUpdateSparePartListService"
behaviorConfiguration="CAB.CABAS.UPDATE.SERVICES.Services.CabasUpdateSparePartListServiceBehavior">
        <host>
          <baseAddresses>
            <add baseAddress = "soap.amqp:///" />
            <add
baseAddress="http://localhost:8632/CABAS/CabasUpdateSparePartListService" />
          </baseAddresses>
        </host>
        <endpoint
          address="UpdateSparePartListQue"
          binding="rabbitMQBinding"
          bindingConfiguration="rabbitMQConfig"
         
contract="CAB.CABAS.UPDATE.SERVICES.Services.ICabasUpdateSparePartListService"
          />
        <endpoint address="mex" binding="mexHttpBinding"
bindingConfiguration=""
        name="mexEndpoint"
contract="CAB.CABAS.UPDATE.SERVICES.Services.ICabasUpdateSparePartListService"
/>
      </service>
</services>

  <behaviors>
      <serviceBehaviors>

        <behavior
name="CAB.CABAS.UPDATE.SERVICES.Services.CabasUpdateSparePartListServiceBehavior">
          
          <serviceMetadata httpGetEnabled="False"/>
          
          <serviceDebug includeExceptionDetailInFaults="True"/>
          

          <dataContractSerializer maxItemsInObjectGraph="2147483647" />
        </behavior>
  <behaviors>
      <serviceBehaviors>
 <system.serviceModel>




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/The-maximum-array-length-quota-16384-has-been-exceeded-while-reading-XML-data-tp24603.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From emile at rabbitmq.com  Mon Jan 21 10:45:57 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 21 Jan 2013 10:45:57 +0000
Subject: [rabbitmq-discuss] WCF .net problems
In-Reply-To: <1358757374669-24596.post@n5.nabble.com>
References: <1358757374669-24596.post@n5.nabble.com>
Message-ID: <50FD1C65.80907@rabbitmq.com>

Hi,

On 21/01/13 08:36, kecke wrote:
> 1. We want the queues messages to be persistant(e.g - if rabbitmq service is
> stopped and restarted the messages will still be in the queue). Is there any
> way to do this(e.g set deliverymode=2) in the app.config? 

The WCF binding currently publishes messages with default parameters, so
it is not possible to select deliverymode=2.

> 2. We want durable queues. We found in this messagelist a post about that,
> and the trick was to change this on line 152 in
> rabbitmq.servicemodel.rabbitmqinputchannel Before: string queue =
> m_model.QueueDeclare(); After: string queue =
> m_model.QueueDeclare(base.LocalAddress.Uri.AbsolutePath, true, false, false,
> null); ...we then got durable queues. This couldnt be done in any other way?

A bug has been filed to enhance the WCF binding to offer this feature.
Unfortunately, as with deliverymode=2 the only way to obtain this
feature at the moment is to modify the source and recompile.

> 3. 
> 
> We want the client(which in our case is a WCF-service) to post a message to
> the queue and then forget(and be sure that sometime in the future the
> message will be delivered), so we have oneway="true" in our app.configs. The
> consumer is also a WCF-service. If we stop the rabbitmq server, then our
> services get an error - like its always connected to RabbitMQ. Is there a
> way in the app.config to tell the services we have to only connect when
> messages is delivered or retrieved? 

That's not possible, because the service cannot predict when a message
will arrive and the queues used internally are transient. The service
must always be running.

> 4. It seems that the messages isn't consumed one by one-it seems that it
> gets them all att once? Is there a way to tell service to fetch them one by
> one? 

Unfortunately no control over the QoS parameter is provided. The WCF
binding consumes with the default QoS parameter. The only way currently
to obtain this functionality is to modify RabbitMQInputChannel and
recompile.

> 5. We try to do WCF and have all config in app.config, so we dont code
> rabbitmq specific code. 

For  the degree of control that you require I would suggest that you use
the RabbitMQ .net client directly instead of WCF. This will give you all
the control that you need until the WCF binding is enhanced.



-Emile






From emile at rabbitmq.com  Mon Jan 21 11:01:04 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 21 Jan 2013 11:01:04 +0000
Subject: [rabbitmq-discuss] logfile maintenance in windows
In-Reply-To: <7422e7d8-29aa-429d-9a20-a4037e5717ff@googlegroups.com>
References: <7422e7d8-29aa-429d-9a20-a4037e5717ff@googlegroups.com>
Message-ID: <50FD1FF0.4000304@rabbitmq.com>

Hi,

On 20/01/13 16:07, mabra wrote:
> The logfile grows and grows ... Is there any way to make a roll-over
> or have a logfile per date ?

You can use "rabbitmqctl rotate_logs", as described in
http://www.rabbitmq.com/install-windows.html

> Another thing so would be to find a documentation, which shows the 
> structure of the logentries. Because nothing is logged into the
> Windows NT Eventlog, one has to parse it by a separate program. So it
> is essential to find, where a messages starts and stops and mostly,
> if the entry is an information, a warning or an error.

http://www.erlang.org/doc/man/error_logger.html
If you need further details then you may need to consult the Erlang
sources in error_logger_file_h.erl

If you installed the broker as a Windows service then messages about
that service may appear in the eventlog. Regular broker log messages
will not appear in the eventlog unless you make special arrangements for
that to happen.
(e.g. see http://www.erlang.org/doc/man/nteventlog.html)





-Emile






From simon at rabbitmq.com  Mon Jan 21 11:04:40 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 21 Jan 2013 11:04:40 +0000
Subject: [rabbitmq-discuss] Occurs 404 or 405 http error when use
 RabbitMQ HTTP API
In-Reply-To: <1358607877596-24585.post@n5.nabble.com>
References: <1358607877596-24585.post@n5.nabble.com>
Message-ID: <50FD20C8.20402@rabbitmq.com>

Hi. I ran your example code in Visual Studio 2008 and looked at 
Wireshark. It seems like WebClient is modifying 
"/api/queues/%2f/blah/get" to "/api/queues///blah/get", which is 
logically the same as "/api/queues/blah/get". As far as I can see this 
is a bug in WebClient - RFC 1738 section 2.2 says not to do this.

Unfortunately I don't know if Microsoft would listen to a bug report. 
Your best workaround may be to rename the virtual host. Sorry about this.

Cheers, Simon

On 19/01/13 15:04, uniguyit wrote:
>
> I use .NET Code 's Webclient and Firefox's HTTPRequester to call RabbitMQ
> HTTP API ( for getting queue messages) , it not work , and occurs 405 or 405
> ERROR, or : The requested document was not found on this server!!
>
>
> all parameters are correct.
>
> but i use FireFox to post the same parameters ,the same URL i can get
> correct RabbitMQ Message!
>
> Those are code:
>
> 				string serverIP="192.168.68.4";				
> 				string localIP="172.16.1.1";				
> 				int port=15672;				
> 				string apiaddr ="/api/queues/%2F/" + localIP + "/get";
> 				string requestURL="http://" + serverIP + ":" + port + apiaddr;			
> 				string
> postbody="{\"vhost\":\"/\",\"name\":\"172.16.1.1\",\"truncate\":\"50000\",\"requeue\":\"true\",\"encoding\":\"auto\",\"count\":\"1\"}";
> 					
> 				Console.WriteLine(requestURL);
> 				Console.WriteLine(postbody);
> 				WebClient wc=new WebClient();
>
> 	
> 			//wc.Headers["Connection"]="keep-alive";
>
> 			wc.Headers["Content-Type"]="application/json; charset=UTF-8";
>
> 			wc.Headers["Pragma"]="no-cache";
>
>
> 			wc.Credentials=new System.Net.NetworkCredential("guest","guest");
>
> 				string result=	wc.UploadString(requestURL,"POST",postbody);
>
>
>
> ---> RMQServer 3.0.1 Version and  3.0.1 .NET Client DLL.
>
>
>
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/Occurs-404-or-405-http-error-when-use-RabbitMQ-HTTP-API-tp24585.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Mon Jan 21 11:08:01 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 21 Jan 2013 11:08:01 +0000
Subject: [rabbitmq-discuss] logfile maintenance in windows
In-Reply-To: <50FD1FF0.4000304@rabbitmq.com>
References: <7422e7d8-29aa-429d-9a20-a4037e5717ff@googlegroups.com>
	<50FD1FF0.4000304@rabbitmq.com>
Message-ID: <50FD2191.3090909@rabbitmq.com>

On 21/01/13 11:01, Emile Joubert wrote:
> Regular broker log messages will not appear in the eventlog unless
> you make special arrangements for that to happen.
> (e.g. see http://www.erlang.org/doc/man/nteventlog.html)

I just noticed that nteventlog is for observing events rather than
sending them to the system eventlog. For writing to the Windows eventlog
a logging framework with that capability will need to be in place, e.g.
Lager: https://github.com/basho/lager
That is not the case at the moment.


-Emile






From simon at rabbitmq.com  Mon Jan 21 11:14:15 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 21 Jan 2013 11:14:15 +0000
Subject: [rabbitmq-discuss] .net installer with rabbitmq
In-Reply-To: <50FD13AC.4000207@rabbitmq.com>
References: <CAEuREo0VTpzj7HccZ6GKitwHWJ0u-XeG3HqcJB8rmoUoF9Gi8w@mail.gmail.com>
	<D5C3BB83-D163-409A-B4C1-0CBB08675F68@rabbitmq.com>
	<50FD13AC.4000207@rabbitmq.com>
Message-ID: <50FD2307.9060202@rabbitmq.com>

On 21/01/13 10:08, Matthias Radestock wrote:
> On 21/01/13 10:00, Tim Watson wrote:
>> There is an msi available in the downloads page?
>
> I believe the OP was asking how to construct a custom installer that...
>
>>> installs automatically the rabbitmq, the management
>>> plugin and that changes the guest password
>
> The msi only does the first of these. (well, it also installs the
> management plug-in, but it doesn't enable it).
>
> To answer the OP... you'll have to learn to write installers, which is
> an acquired taste. MSIs can be nested, i.e. you should be able to
> construct an msi installer that includes the existing rabbit msi
> installer plus the extra bits to enable management and change the password.

It's simpler than that.

The Windows installer is an exe created by NSIS, and supports the NSIS 
"/S" (silent) flag. So you could write a batch file which invokes 
rabbitmq-server-3.x.x.exe, then CDs to the bin directory and invokes:

rabbitmqctl.bat change_password guest newpassword
rabbitmq-plugins.bat enable rabbitmq_management
rabbitmq-service.bat stop
rabbitmq-service.bat start

Alternatively you could probably hack the existing installer to do these 
things - it already shells out to batch files to install the service. 
Sources are in rabbitmq-server/packaging/windows-exe. Building it is a 
bit fiddly though.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Mon Jan 21 11:36:26 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 21 Jan 2013 11:36:26 +0000
Subject: [rabbitmq-discuss] The maximum array length quota (16384) has
 been exceeded while reading XML data
In-Reply-To: <1358765160001-24603.post@n5.nabble.com>
References: <1358765160001-24603.post@n5.nabble.com>
Message-ID: <50FD283A.8030408@rabbitmq.com>

Hi,

On 21/01/13 10:46, kecke wrote:
> <ReaderQoutas maxArrayLength="12334444">

I'm afraid this is another configuration option that is not exposed. You
can set the maximum message size but not the array limit. A future
version of the WCF binding may include this feature, but for now I
suggest that you use the RabbitMQ .net client instead which does not
impose limits on message size.



-Emile




From antony.pulicken at gmail.com  Mon Jan 21 13:06:01 2013
From: antony.pulicken at gmail.com (antony)
Date: Mon, 21 Jan 2013 05:06:01 -0800 (PST)
Subject: [rabbitmq-discuss] Container for RabbitMQ Listener/Consumer (Java)
Message-ID: <1358773561132-24611.post@n5.nabble.com>

Hi,

Is it recommended to have a container/server for the queue
listeners/consumers in Java in a production environment? What are the
recommendations from a 1)HA , 2) Scalability and 3) performance perspective
?  

Regards,
Antony.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Container-for-RabbitMQ-Listener-Consumer-Java-tp24611.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From michael.s.klishin at gmail.com  Mon Jan 21 13:50:03 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 21 Jan 2013 17:50:03 +0400
Subject: [rabbitmq-discuss] ANN Bunny 0.9 API reference
Message-ID: <CAE3HoVQ2CxuCbiDo+aOgascvuQ3t1y2RfafmqePW1WvQeeuOYg@mail.gmail.com>

I'm happy to announce that Bunny 0.9 API reference is done and now
available at http://reference.rubybunny.info.

Documentation guides are also finished, check them out at
http://rubybunny.info.

I'd like to thank Chris Duncan for helping with the docs, and in particular
for editing them.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130121/1462a54d/attachment.htm>

From fred at dushin.net  Mon Jan 21 15:03:45 2013
From: fred at dushin.net (Fred Dushin)
Date: Mon, 21 Jan 2013 10:03:45 -0500
Subject: [rabbitmq-discuss] shovel status improperly displayed on web UI
In-Reply-To: <50FD1C58.900@rabbitmq.com>
References: <366bfb7b-4683-4b41-a0fa-f062f0079119@googlegroups.com>
	<50FD1C58.900@rabbitmq.com>
Message-ID: <77A59F3E-1AAE-4531-B7F4-E716E61FED46@dushin.net>

For my application intermittently stopping the shovel is a requirement in some cases (until we implement scheduled shovels); e.g, reconfiguration, bandwidth priority over a WAN, etc.

I have seen the same internal server error (3.0.1), but the problem goes away with a shovel restart, and we are not using the management console, except for debugging.

I'd like to start making suggestions about more CRUD management operations on shovels through the management APIs, but I need to study the mochiweb stuff in more detail.  Has this been discussed before?

-Fred

On Jan 21, 2013, at 5:45 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 20/01/13 16:40, mabra wrote:
>> Hello !
>> 
>> I am playing around with shovel and I am usually using the RabbitMQ Web
>> Management.
>> If I stop shovel via commandline, the status on the webpage causes an
>> "internal server error".
> 
> Good point - that's a bug. (Sort of - we normally assume you won't stop individual plugins by hand.)
> 
> Cheers, Simon
> 
> -- 
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simon at rabbitmq.com  Mon Jan 21 16:45:43 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 21 Jan 2013 16:45:43 +0000
Subject: [rabbitmq-discuss] shovel status improperly displayed on web UI
In-Reply-To: <77A59F3E-1AAE-4531-B7F4-E716E61FED46@dushin.net>
References: <366bfb7b-4683-4b41-a0fa-f062f0079119@googlegroups.com>
	<50FD1C58.900@rabbitmq.com>
	<77A59F3E-1AAE-4531-B7F4-E716E61FED46@dushin.net>
Message-ID: <50FD70B7.4020702@rabbitmq.com>

On 21/01/13 15:03, Fred Dushin wrote:
> For my application intermittently stopping the shovel is a
> requirement in some cases (until we implement scheduled shovels);
> e.g, reconfiguration, bandwidth priority over a WAN, etc.
>
> I have seen the same internal server error (3.0.1), but the problem
> goes away with a shovel restart, and we are not using the management
> console, except for debugging.

Ah, OK. It's worth pointing out that the bug is cosmetic (and also will 
be fixed in 3.0.2).

> I'd like to start making suggestions about more CRUD management
> operations on shovels through the management APIs, but I need to
> study the mochiweb stuff in more detail.  Has this been discussed
> before?

No. We do intend to do something along those lines, by reworking the 
shovel plugin to be driven by the parameters mechanism, the same way 
federation is in 3.0. So the HTTP bit of that is already done :)

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From sank16mail at gmail.com  Tue Jan 22 07:16:59 2013
From: sank16mail at gmail.com (Alexander Scherbakov)
Date: Mon, 21 Jan 2013 23:16:59 -0800 (PST)
Subject: [rabbitmq-discuss] Federation Plugin
Message-ID: <99fd60eb-0127-4bf3-89cc-2471f2a1e5ee@googlegroups.com>

Hello.

I can't set up Federation Plugin. I do everything according to the 
description (http://www.rabbitmq.com/federation.html), but messages don`t 
repost to second node.
I have 2 nodes: node1 and node2
The node2 i set up:

rabbitmqctl set_parameter federation-upstream my-upstream 
'{"uri":"amqp://node1","expires":3600000}'

...ok...

rabbitmqctl set_policy federate-me "^amq\." 
'{"federation-upstream-set":"all"}'

...ok... 

When i publish messages to node2, i don't see them on node1 ...

What am I doing wrong?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130121/1ff40263/attachment.htm>

From tim at rabbitmq.com  Tue Jan 22 09:38:17 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 22 Jan 2013 09:38:17 +0000
Subject: [rabbitmq-discuss] Federation Plugin
In-Reply-To: <99fd60eb-0127-4bf3-89cc-2471f2a1e5ee@googlegroups.com>
References: <99fd60eb-0127-4bf3-89cc-2471f2a1e5ee@googlegroups.com>
Message-ID: <A23ADFCE-737A-4E3B-919C-94E2DD738267@rabbitmq.com>

Alexander,

On 22 Jan 2013, at 07:16, Alexander Scherbakov wrote:
> When i publish messages to node2, i don't see them on node1 ...
> 
> What am I doing wrong?
> 

It's the other way around. From that documentation page you linked to: "... messages published to the *upstream* exchanges are copied to the federated exchange" and you seen to be publishing to the federated exchange and expecting to see the messages make their way back upstream.

Hope that makes sense! 

Cheers,
Tim

> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From ask at rabbitmq.com  Tue Jan 22 13:43:36 2013
From: ask at rabbitmq.com (Ask Solem)
Date: Tue, 22 Jan 2013 13:43:36 +0000
Subject: [rabbitmq-discuss] RabbitMQ scaling with OpenStack
In-Reply-To: <CAJcv3CT6NwrQX0TEL0g6iPT=amKa7Pi2xdHfTdWGZTBECghZzw@mail.gmail.com>
References: <CAJcv3CRYfYsNsVSKkdJVm2frtqkF=CjTvmX+v3u9JdEEHrDtog@mail.gmail.com>
	<CAJcv3CT6NwrQX0TEL0g6iPT=amKa7Pi2xdHfTdWGZTBECghZzw@mail.gmail.com>
Message-ID: <358CB771-226F-4F3E-A5FA-0D4CF68AAE68@rabbitmq.com>


On Jan 20, 2013, at 5:47 AM, Ray Pekowski <pekowski at gmail.com> wrote:

> Alexis,
> 
> Thanks for commenting.
> 
> On Fri, Jan 18, 2013 at 17:14 GMT, Alexis Richardson
> <alexis at rabbitmq.com> wrote:
>> 
>> Some of the numbers you saw seem oddly low, and I wonder if there is
>> more going on that is easily fixed.  The config of Rabbit in OpenStack
>> may be very borked.
> 
> Some possible things that could make the results lower than you would
> expect are:
> 1) All machines are virtual machines, including the RabbitMQ servers.
> Virtualization typically costs around 40%.
> 2) All VMs were only assigned 2 CPUs.  The CPUs are Intel Xeon E5620 @ 2.4 GHz.
> 
>> 
>> Can I ask what clients you used?  It may be worth testing a few different ones.>>
> 
> OpenStack uses the kombu.  Unless there is a client with a compatible
> API, I don't think it would be easy to change.
> 

If by an "RPC call" you mean a simple request-reply then 35/s is indeed terribly low,
even with persistent messages you should be able to do a few thousands a sec (depending
on hardware).  With non-persistent messages and using kombu+librabbitmq as the underlying transport
I'm able to do 20,000 messages/s on my laptop...


From ask at rabbitmq.com  Tue Jan 22 13:58:34 2013
From: ask at rabbitmq.com (Ask Solem)
Date: Tue, 22 Jan 2013 13:58:34 +0000
Subject: [rabbitmq-discuss] RabbitMQ scaling with OpenStack
In-Reply-To: <358CB771-226F-4F3E-A5FA-0D4CF68AAE68@rabbitmq.com>
References: <CAJcv3CRYfYsNsVSKkdJVm2frtqkF=CjTvmX+v3u9JdEEHrDtog@mail.gmail.com>
	<CAJcv3CT6NwrQX0TEL0g6iPT=amKa7Pi2xdHfTdWGZTBECghZzw@mail.gmail.com>
	<358CB771-226F-4F3E-A5FA-0D4CF68AAE68@rabbitmq.com>
Message-ID: <D459DBAB-3A8E-4DC4-94C7-9AE98B731852@rabbitmq.com>


On Jan 22, 2013, at 1:43 PM, Ask Solem <ask at rabbitmq.com> wrote:

> 
> On Jan 20, 2013, at 5:47 AM, Ray Pekowski <pekowski at gmail.com> wrote:
> 
>> Alexis,
>> 
>> Thanks for commenting.
>> 
>> On Fri, Jan 18, 2013 at 17:14 GMT, Alexis Richardson
>> <alexis at rabbitmq.com> wrote:
>>> 
>>> Some of the numbers you saw seem oddly low, and I wonder if there is
>>> more going on that is easily fixed.  The config of Rabbit in OpenStack
>>> may be very borked.
>> 
>> Some possible things that could make the results lower than you would
>> expect are:
>> 1) All machines are virtual machines, including the RabbitMQ servers.
>> Virtualization typically costs around 40%.
>> 2) All VMs were only assigned 2 CPUs.  The CPUs are Intel Xeon E5620 @ 2.4 GHz.
>> 
>>> 
>>> Can I ask what clients you used?  It may be worth testing a few different ones.>>
>> 
>> OpenStack uses the kombu.  Unless there is a client with a compatible
>> API, I don't think it would be easy to change.
>> 
> 
> If by an "RPC call" you mean a simple request-reply then 35/s is indeed terribly low,
> even with persistent messages you should be able to do a few thousands a sec (depending
> on hardware).  With non-persistent messages and using kombu+librabbitmq as the underlying transport
> I'm able to do 20,000 messages/s on my laptop...


And oh, just noticed you said it creates a new queue for every response.
This is not a very efficient way to implement RPC, but not just that.

In my benchmarks I suddenly noticed queue_declare calls taking several seconds to complete,
something which did not happen in earlier RabbitMQ versions.

I discussed it with other rabbit developers and they told me that this could
be caused by the broker having to do fsync's, and it may be more likely
if the queue is declared with the auto_delete flag.


I could help you review the code as I have lots of experience optimizing
this pattern and Python consumers.

From matthias at rabbitmq.com  Tue Jan 22 14:10:02 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 22 Jan 2013 14:10:02 +0000
Subject: [rabbitmq-discuss] RabbitMQ scaling with OpenStack
In-Reply-To: <D459DBAB-3A8E-4DC4-94C7-9AE98B731852@rabbitmq.com>
References: <CAJcv3CRYfYsNsVSKkdJVm2frtqkF=CjTvmX+v3u9JdEEHrDtog@mail.gmail.com>
	<CAJcv3CT6NwrQX0TEL0g6iPT=amKa7Pi2xdHfTdWGZTBECghZzw@mail.gmail.com>
	<358CB771-226F-4F3E-A5FA-0D4CF68AAE68@rabbitmq.com>
	<D459DBAB-3A8E-4DC4-94C7-9AE98B731852@rabbitmq.com>
Message-ID: <50FE9DBA.9090801@rabbitmq.com>

On 22/01/13 13:58, Ask Solem wrote:
> In my benchmarks I suddenly noticed queue_declare calls taking
> several seconds to complete,

That doesn't sound right.

> I discussed it with other rabbit developers and they told me that this could
> be caused by the broker having to do fsync's, and it may be more likely
> if the queue is declared with the auto_delete flag.

'durable', perhaps. But it still shouldn't take seconds.

Matthias.

From ask at rabbitmq.com  Tue Jan 22 14:29:17 2013
From: ask at rabbitmq.com (Ask Solem)
Date: Tue, 22 Jan 2013 14:29:17 +0000
Subject: [rabbitmq-discuss] RabbitMQ scaling with OpenStack
In-Reply-To: <50FE9DBA.9090801@rabbitmq.com>
References: <CAJcv3CRYfYsNsVSKkdJVm2frtqkF=CjTvmX+v3u9JdEEHrDtog@mail.gmail.com>
	<CAJcv3CT6NwrQX0TEL0g6iPT=amKa7Pi2xdHfTdWGZTBECghZzw@mail.gmail.com>
	<358CB771-226F-4F3E-A5FA-0D4CF68AAE68@rabbitmq.com>
	<D459DBAB-3A8E-4DC4-94C7-9AE98B731852@rabbitmq.com>
	<50FE9DBA.9090801@rabbitmq.com>
Message-ID: <7A556A12-E7A1-4F6A-AA90-9B271E8B7DCF@rabbitmq.com>


On Jan 22, 2013, at 2:10 PM, Matthias Radestock <matthias at rabbitmq.com> wrote:

> On 22/01/13 13:58, Ask Solem wrote:
>> In my benchmarks I suddenly noticed queue_declare calls taking
>> several seconds to complete,
> 
> That doesn't sound right.

Do note that this is an anecdote, not a confirmed problem.

It could've been something affecting the environment or with the platform (OSX),
but something to investigate if he is seeing low numbers while doing
lots of queue_declare calls.


> 
>> I discussed it with other rabbit developers and they told me that this could
>> be caused by the broker having to do fsync's, and it may be more likely
>> if the queue is declared with the auto_delete flag.
> 
> 'durable', perhaps. But it still shouldn't take seconds.



From j_depp_99 at yahoo.com  Tue Jan 22 15:27:02 2013
From: j_depp_99 at yahoo.com (jdepp)
Date: Tue, 22 Jan 2013 07:27:02 -0800 (PST)
Subject: [rabbitmq-discuss] how to set timestamp on basic properties
Message-ID: <1358868422757-24621.post@n5.nabble.com>

I would like to set the timestamp on the message properties before adding to
a queue but seem to get an error trying to do it. I could I guess add it to
the header but would like to try and use the timestamp value.


        Dim props As IBasicProperties = chan.CreateBasicProperties()

         props.Timestamp = DateTime.Now.ToString


Value of string cannot be converted to rabbitmq.client.amqp.timestamp



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/how-to-set-timestamp-on-basic-properties-tp24621.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From emile at rabbitmq.com  Tue Jan 22 15:53:09 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 22 Jan 2013 15:53:09 +0000
Subject: [rabbitmq-discuss] how to set timestamp on basic properties
In-Reply-To: <1358868422757-24621.post@n5.nabble.com>
References: <1358868422757-24621.post@n5.nabble.com>
Message-ID: <50FEB5E5.7080509@rabbitmq.com>

Hi,

On 22/01/13 15:27, jdepp wrote:
> I would like to set the timestamp on the message properties before adding to
> a queue but seem to get an error trying to do it. I could I guess add it to
> the header but would like to try and use the timestamp value.
> 
> 
>         Dim props As IBasicProperties = chan.CreateBasicProperties()
> 
>          props.Timestamp = DateTime.Now.ToString

The timestamp property in AMQP 0-9-1 is defined as a 64bit Unix
timestamp, which is seconds since 1970/1/1, instead of a string. Also
note the comments in the AmqpTimestamp class.

As you say, if consumers and producers both agree on a string date
format and you don't care about interoperability then you can include a
data string as a header instead of the property.



-Emile








From j_depp_99 at yahoo.com  Tue Jan 22 16:48:28 2013
From: j_depp_99 at yahoo.com (jdepp)
Date: Tue, 22 Jan 2013 08:48:28 -0800 (PST)
Subject: [rabbitmq-discuss] how to set timestamp on basic properties
In-Reply-To: <50FEB5E5.7080509@rabbitmq.com>
References: <1358868422757-24621.post@n5.nabble.com>
	<50FEB5E5.7080509@rabbitmq.com>
Message-ID: <1358873308288-24623.post@n5.nabble.com>

thanks for your response. Makes sense.
one unrelated question: do you know if one can obtain the list of queues
binded to an exchange programmatically.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/how-to-set-timestamp-on-basic-properties-tp24621p24623.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From emile at rabbitmq.com  Tue Jan 22 16:56:38 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 22 Jan 2013 16:56:38 +0000
Subject: [rabbitmq-discuss] how to set timestamp on basic properties
In-Reply-To: <1358873308288-24623.post@n5.nabble.com>
References: <1358868422757-24621.post@n5.nabble.com>
	<50FEB5E5.7080509@rabbitmq.com>
	<1358873308288-24623.post@n5.nabble.com>
Message-ID: <50FEC4C6.9090300@rabbitmq.com>

Hi,

On 22/01/13 16:48, jdepp wrote:
> thanks for your response. Makes sense.
> one unrelated question: do you know if one can obtain the list of queues
> binded to an exchange programmatically.

Not through AMQP no. But you can query the HTTP API, which is what
provides the information displayed in the management console.

You could also parse the output of the relevant "rabbitmqctl list_*"
commands, either by invoking rabbitmqctl directly or by attaching to the
broker as an Erlang node. This needs access to the .erlang.cookie file.



-Emile





From j_depp_99 at yahoo.com  Tue Jan 22 18:43:40 2013
From: j_depp_99 at yahoo.com (jdepp)
Date: Tue, 22 Jan 2013 10:43:40 -0800 (PST)
Subject: [rabbitmq-discuss] .net version of the subscriber
Message-ID: <1358880220490-24625.post@n5.nabble.com>

I am trying to interprate the following and convert into .net code to
implement creating multiple consumers and have them subscribe to a queue.

def callback(ch, method, properties, body):
    print " [x] Received %r" % (body,)
    time.sleep( body.count('.') )
    print " [x] Done"
    ch.basic_ack(delivery_tag = method.delivery_tag)

channel.basic_qos(prefetch_count=1)
channel.basic_consume(callback,
                      queue='task_queue')

channel.start_consuming()


what is the callback method? Is that the function that is called and how is
this faster than using a basicget within your own loop. It is still one
consumer to a queue right or does rabbit implement its own threading
somehow.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/net-version-of-the-subscriber-tp24625.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From lvauthrin at gmail.com  Tue Jan 22 19:41:51 2013
From: lvauthrin at gmail.com (Laurent)
Date: Tue, 22 Jan 2013 11:41:51 -0800 (PST)
Subject: [rabbitmq-discuss] Channel Usage
Message-ID: <1358883711555-24626.post@n5.nabble.com>

Hello,

I've previously asked questions about channel thread safety and was
recommended to use a channel per thread over sharing a channel amongst many
thread.  I was also curious if there were any limitations (other than object
creation overhead) to just creating a channel for every publish.

Also, as far as channel pooling goes, is commons-pool the best way to go or
is there are better route?

Thanks.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Channel-Usage-tp24626.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From matthias at rabbitmq.com  Tue Jan 22 19:56:14 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 22 Jan 2013 19:56:14 +0000
Subject: [rabbitmq-discuss] configure shovel for message throttling
In-Reply-To: <f90f16a3-f729-4aa2-93fa-f43c56ab1ab0@googlegroups.com>
References: <f90f16a3-f729-4aa2-93fa-f43c56ab1ab0@googlegroups.com>
Message-ID: <50FEEEDE.2070700@rabbitmq.com>

On 18/01/13 10:25, mabra wrote:
> I am looking for settings in shovel to throttle the sending of the messages,
> respective limit the bandwith in use. This will not disturb normal shoveling
> if the rate is in an acceptible range. But it helps a lot at the message
> flood
> on re-connects.
>
> Any hints tips or other help would be really great!

Have you tried setting a (low) prefetch_count in the shovel config?

Regards,

Matthias.

From streamweaver at gmail.com  Tue Jan 22 19:54:10 2013
From: streamweaver at gmail.com (Scott Turnbull)
Date: Tue, 22 Jan 2013 11:54:10 -0800 (PST)
Subject: [rabbitmq-discuss] Trouble starting RabbitMQ on new install.
Message-ID: <b979c34c-cf21-4fb0-979c-46a8cca248c0@googlegroups.com>

I'm a new RabbitMQ user trying to install RabbitMQ on an EC2 instance in 
Ubuntu.  I've followed the Debian/Ubuntu install instructions and the 
application seems to install in the expected /var/lib/rabbitmq and 
/etc/rabbitmq locations however there is nothing added to /etc/init.d as I 
think is expected.

My problem comes in trying to start the service.  Using the command

> sudo rabbitmqctl start_app

I get the following output:

========= OUTPUT =======================
Starting node 'rabbit at domU-12-31-39-0E-B9-35' ...
Error: unable to connect to node 'rabbit at domU-12-31-39-0E-B9-35': nodedown

DIAGNOSTICS
===========

nodes in question: ['rabbit at domU-12-31-39-0E-B9-35']

hosts, their running nodes and ports:
- domU-12-31-39-0E-B9-35: [{rabbitmqctl23773,49314}]

current node details:
- node name: 'rabbitmqctl23773 at domU-12-31-39-0E-B9-35'
- home dir: /var/lib/rabbitmq
- cookie hash: TTgDEq/ip10RejnAnWGTAA==

========== END OUTPUT ==============================


Some additional details that may help.

* This is all under the default config, no additional config changes have 
been added.
* when I compare the cookie hash in the output above with 
/var/lib/rabbitmq/.erlang.cookies I see they are different
* No files at all appear in the /var/log/rabbitmq directory

The cookie mismatch and fact that no log files are being generated make me 
expect it's a user/permission issue but I'm not sure what I need to change. 
 The install was done under sudo apt-get as is the execution of rabbitmqctl

I appologize for my newness but would appreciate any insight.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130122/8e8c711e/attachment.htm>

From videlalvaro at gmail.com  Tue Jan 22 20:08:23 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Tue, 22 Jan 2013 21:08:23 +0100
Subject: [rabbitmq-discuss] Trouble starting RabbitMQ on new install.
In-Reply-To: <b979c34c-cf21-4fb0-979c-46a8cca248c0@googlegroups.com>
References: <b979c34c-cf21-4fb0-979c-46a8cca248c0@googlegroups.com>
Message-ID: <CAMcAHLXkCc7oStENg2F9uZDLsLEf28ufWTis+=wGJYS-sj=aNg@mail.gmail.com>

Hi,

To start the server you need to execute:
./sbin/rabbitmq-server

-Alvaro


On Tue, Jan 22, 2013 at 8:54 PM, Scott Turnbull <streamweaver at gmail.com>wrote:

> I'm a new RabbitMQ user trying to install RabbitMQ on an EC2 instance in
> Ubuntu.  I've followed the Debian/Ubuntu install instructions and the
> application seems to install in the expected /var/lib/rabbitmq and
> /etc/rabbitmq locations however there is nothing added to /etc/init.d as I
> think is expected.
>
> My problem comes in trying to start the service.  Using the command
>
> > sudo rabbitmqctl start_app
>
> I get the following output:
>
> ========= OUTPUT =======================
> Starting node 'rabbit at domU-12-31-39-0E-B9-35' ...
> Error: unable to connect to node 'rabbit at domU-12-31-39-0E-B9-35': nodedown
>
> DIAGNOSTICS
> ===========
>
> nodes in question: ['rabbit at domU-12-31-39-0E-B9-35']
>
> hosts, their running nodes and ports:
> - domU-12-31-39-0E-B9-35: [{rabbitmqctl23773,49314}]
>
> current node details:
> - node name: 'rabbitmqctl23773 at domU-12-31-39-0E-B9-35'
> - home dir: /var/lib/rabbitmq
> - cookie hash: TTgDEq/ip10RejnAnWGTAA==
>
> ========== END OUTPUT ==============================
>
>
> Some additional details that may help.
>
> * This is all under the default config, no additional config changes have
> been added.
> * when I compare the cookie hash in the output above with
> /var/lib/rabbitmq/.erlang.cookies I see they are different
> * No files at all appear in the /var/log/rabbitmq directory
>
> The cookie mismatch and fact that no log files are being generated make me
> expect it's a user/permission issue but I'm not sure what I need to change.
>  The install was done under sudo apt-get as is the execution of rabbitmqctl
>
> I appologize for my newness but would appreciate any insight.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130122/77c8a139/attachment.htm>

From michael.s.klishin at gmail.com  Tue Jan 22 20:58:45 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 23 Jan 2013 00:58:45 +0400
Subject: [rabbitmq-discuss] Channel Usage
In-Reply-To: <1358883711555-24626.post@n5.nabble.com>
References: <1358883711555-24626.post@n5.nabble.com>
Message-ID: <CAE3HoVSiPENdYmwRx9PR71DzfNWZ4msOnf7wBNQJjHo3QsXfDg@mail.gmail.com>

2013/1/22 Laurent <lvauthrin at gmail.com>

> I was also curious if there were any limitations (other than object
> creation overhead) to just creating a channel for every publish.
>

Opening a channel requires a network roundtrip. This means lower throughput.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130123/13d368a3/attachment.htm>

From j_depp_99 at yahoo.com  Tue Jan 22 21:54:41 2013
From: j_depp_99 at yahoo.com (jdepp)
Date: Tue, 22 Jan 2013 13:54:41 -0800 (PST)
Subject: [rabbitmq-discuss] messages not getting acknowledged as it should be
Message-ID: <1358891681463-24631.post@n5.nabble.com>

I changed my code from using the basic get for the consumer to use the
subscribe option. With the basicget I could see each message get
acknowledged after processing. Using the subscribe method I see the messages
disappear from the ready queue at a fast rate but appear in the Unacked
column and then get acknowledged but at a slower rate.


      
        Dim consumer As New QueueingBasicConsumer(gchannel)
        Dim consumerTag As [String] = gchannel.BasicConsume(queueName,
False, consumer)


        While True
            counter += 1
            Try
                // basic get code commented out
                ' Dim noAck As Boolean = False
                ' Dim result As BasicGetResult =
gconsumer.BasicGet("raw.data.output", noAck)

                Dim e As RabbitMQ.Client.Events.BasicDeliverEventArgs =
DirectCast(consumer.Queue.Dequeue(),
RabbitMQ.Client.Events.BasicDeliverEventArgs)
                Dim props As IBasicProperties = e.BasicProperties
                Dim result As Byte() = e.Body


                 Dim body As String =
System.Text.Encoding.UTF8.GetChars(result)
                 body = Trim(body)
                
                 If Not String.IsNullOrEmpty(body) Then
                        gchannel.BasicAck(e.DeliveryTag, False)
                        AddMessagePost(body)
                  EndIf




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/messages-not-getting-acknowledged-as-it-should-be-tp24631.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From matthias at rabbitmq.com  Tue Jan 22 22:10:27 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 22 Jan 2013 22:10:27 +0000
Subject: [rabbitmq-discuss] messages not getting acknowledged as it
 should be
In-Reply-To: <1358891681463-24631.post@n5.nabble.com>
References: <1358891681463-24631.post@n5.nabble.com>
Message-ID: <50FF0E53.2060805@rabbitmq.com>

On 22/01/13 21:54, jdepp wrote:
> I changed my code from using the basic get for the consumer to use the
> subscribe option. With the basicget I could see each message get
> acknowledged after processing. Using the subscribe method I see the messages
> disappear from the ready queue at a fast rate but appear in the Unacked
> column and then get acknowledged but at a slower rate.

You may want to read 
http://www.rabbitmq.com/blog/2012/05/11/some-queuing-theory-throughput-latency-and-bandwidth/. 
Well, the first half anyway.

Matthias.

From adamrabung at gmail.com  Tue Jan 22 22:13:22 2013
From: adamrabung at gmail.com (Adam Rabung)
Date: Tue, 22 Jan 2013 17:13:22 -0500
Subject: [rabbitmq-discuss]  error on startup
Message-ID: <CAAN_EDoWuKZHJWk+n9UWVN9=mrLghtZZGEzSqEZWQT8-Tg04mA@mail.gmail.com>

Hello,
I am having problems starting up my Rabbit instance.  This instance had
been running happily for about a year.

My googling of various interesting parts of the trace is coming up empty,
could someone help? Here's a slightly edited log file of the error on
startup:

https://gist.github.com/4598977

This is 2.8.7.

Thanks for any input.
Adam
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130122/57e6a99f/attachment.htm>

From alex.damian at gmail.com  Tue Jan 22 22:23:24 2013
From: alex.damian at gmail.com (Alex Damian)
Date: Tue, 22 Jan 2013 14:23:24 -0800 (PST)
Subject: [rabbitmq-discuss] Cannot access rabbitmqadmin.
Message-ID: <5753af5f-6c71-42db-91db-58279c63d685@googlegroups.com>

Hi

I have followed all the instructions on 
http://www.rabbitmq.com/management.html and enabled the plugin, but after 
than there is no webserver running anywhere on my machine. There is no way 
to connect to Mochiweb at all. I have restarted the service and still 
nothing. I have also tried the "http://*server-name*:15672/" URL with 
"localhost", 127.0.0.1 and also the full server name, all of which are 
/etc/hosts file. My vhost is the default "/". Should I add something in my 
config file perhaps? I have also tried a *curl* command and still nothing.

I am running on Fedora Core 17 with all latest libs including latest 
rabbitMQ sw. I have checked the listening ports on the server and i only 
see the AMQP one. 
Also I can run rabbitmq-server and rabbitmqctl without issues. I have also 
been able to create exchanges/queues via rabbit.js on Node. However not 
having a proper admin tool is a bit drawback. I wonder why it's not 
possible to supply one like (or enhance) rabbitmqctl. Seems to do the job 
just fine. 

Any help would be greatly appreciated!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130122/83829b51/attachment.htm>

From dmitriy.bannikov at gmail.com  Tue Jan 22 22:29:24 2013
From: dmitriy.bannikov at gmail.com (Dmitriy Bannikov)
Date: Tue, 22 Jan 2013 14:29:24 -0800
Subject: [rabbitmq-discuss] ReturnListener is not invoked
In-Reply-To: <50FA8E96.8050805@rabbitmq.com>
References: <c44e9322-9f6c-4272-bb61-c74210f32d9c@googlegroups.com>
	<50F8EE8A.4050602@rabbitmq.com>
	<CAOLJz+hh2BXopekfrdvMrhiTofHMWOb=4rDSf2gdmP5qsjkUdg@mail.gmail.com>
	<50F9B0E3.3000808@rabbitmq.com>
	<CAOLJz+gV8d5-iehNCofsMsxqyRp01oEvyt8C18K8VX8d9GNEbA@mail.gmail.com>
	<50F9D52D.9070001@rabbitmq.com>
	<CAOLJz+hRzG_pYdnVKyay4OTYTLX5sraQn+O0dNxaAX1_0kxMsw@mail.gmail.com>
	<50FA8B81.3020401@rabbitmq.com> <50FA8E96.8050805@rabbitmq.com>
Message-ID: <CAOLJz+iOKt2aRcuO3AaSOrB9gsVxrCgwPq_VvL3sjcAKKQgsSQ@mail.gmail.com>

Matthias,

It worked! Thanks a lot! I've changed the limit to 100mb, and it started
receiving failed message,

Thank you very much for you help.

Dmitriy


2013/1/19 Matthias Radestock <matthias at rabbitmq.com>

> On 19/01/13 12:03, Matthias Radestock wrote:
>
>> So there is indeed no basic.return to be seen. Very strange.
>>
>> Does the program terminate at the end or just sit there? It *should* do
>> the latter.
>>
>> Also, please repeat the test using the both the 3.0.1 Java client and
>> broker.
>>
>
> Scratch that. I found the problem:
>
> From your 'rabbitmqctl status' output...
>
>  {disk_free_limit,1000000000},
>  {disk_free,267063296},
>
> So you have less than the required 1GB disk space available and hence
> publishing will be blocked. See http://www.rabbitmq.com/**
> memory.html#diskfreesup-usage<http://www.rabbitmq.com/memory.html#diskfreesup-usage>
>
> There should be an alarm recorded in the logs. Please check. And the alarm
> should be visible in the management UI too. And any publishing connections
> should show as 'blocked' in both 'rabbitmqctl list_connection' and the
> management UI.
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130122/516e87ce/attachment.htm>

From dmitriy.bannikov at gmail.com  Tue Jan 22 22:35:49 2013
From: dmitriy.bannikov at gmail.com (Dmitriy Bannikov)
Date: Tue, 22 Jan 2013 14:35:49 -0800
Subject: [rabbitmq-discuss] ReturnListener is not invoked
In-Reply-To: <50FA8E96.8050805@rabbitmq.com>
References: <c44e9322-9f6c-4272-bb61-c74210f32d9c@googlegroups.com>
	<50F8EE8A.4050602@rabbitmq.com>
	<CAOLJz+hh2BXopekfrdvMrhiTofHMWOb=4rDSf2gdmP5qsjkUdg@mail.gmail.com>
	<50F9B0E3.3000808@rabbitmq.com>
	<CAOLJz+gV8d5-iehNCofsMsxqyRp01oEvyt8C18K8VX8d9GNEbA@mail.gmail.com>
	<50F9D52D.9070001@rabbitmq.com>
	<CAOLJz+hRzG_pYdnVKyay4OTYTLX5sraQn+O0dNxaAX1_0kxMsw@mail.gmail.com>
	<50FA8B81.3020401@rabbitmq.com> <50FA8E96.8050805@rabbitmq.com>
Message-ID: <CAOLJz+hX2k5Wv6DhT_UepwrFW+AOg-MZJZQqbpb+mRD_dkotcg@mail.gmail.com>

By the way, does it mean that if RabbitMQ server doesn't have available
disk space more than disk_free_limit, messages will be lost?

I'm checking server status using Management, but how will I know that this
particular message hasn't been added to queue?

Best regards,
Dmitriy


2013/1/19 Matthias Radestock <matthias at rabbitmq.com>

> On 19/01/13 12:03, Matthias Radestock wrote:
>
>> So there is indeed no basic.return to be seen. Very strange.
>>
>> Does the program terminate at the end or just sit there? It *should* do
>> the latter.
>>
>> Also, please repeat the test using the both the 3.0.1 Java client and
>> broker.
>>
>
> Scratch that. I found the problem:
>
> From your 'rabbitmqctl status' output...
>
>  {disk_free_limit,1000000000},
>  {disk_free,267063296},
>
> So you have less than the required 1GB disk space available and hence
> publishing will be blocked. See http://www.rabbitmq.com/**
> memory.html#diskfreesup-usage<http://www.rabbitmq.com/memory.html#diskfreesup-usage>
>
> There should be an alarm recorded in the logs. Please check. And the alarm
> should be visible in the management UI too. And any publishing connections
> should show as 'blocked' in both 'rabbitmqctl list_connection' and the
> management UI.
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130122/cb43c0b5/attachment.htm>

From j_depp_99 at yahoo.com  Tue Jan 22 23:16:23 2013
From: j_depp_99 at yahoo.com (jdepp)
Date: Tue, 22 Jan 2013 15:16:23 -0800 (PST)
Subject: [rabbitmq-discuss] messages not getting acknowledged as it
	should be
In-Reply-To: <50FF0E53.2060805@rabbitmq.com>
References: <1358891681463-24631.post@n5.nabble.com>
	<50FF0E53.2060805@rabbitmq.com>
Message-ID: <1358896583919-24637.post@n5.nabble.com>

thanks....so setting basicqos will help a little but basically it all boils
down to the actual processing of my consumer, right?



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/messages-not-getting-acknowledged-as-it-should-be-tp24631p24637.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From matthias at rabbitmq.com  Tue Jan 22 23:28:27 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 22 Jan 2013 23:28:27 +0000
Subject: [rabbitmq-discuss] messages not getting acknowledged as it
 should be
In-Reply-To: <1358896583919-24637.post@n5.nabble.com>
References: <1358891681463-24631.post@n5.nabble.com>
	<50FF0E53.2060805@rabbitmq.com>
	<1358896583919-24637.post@n5.nabble.com>
Message-ID: <50FF209B.8020509@rabbitmq.com>

On 22/01/13 23:16, jdepp wrote:
> thanks....so setting basicqos will help a little but basically it all boils
> down to the actual processing of my consumer, right?

If you set the basic.qos prefetch to 1 then consuming will be no faster 
than basic.get. By setting a higher value - tuned to the network latency 
and consumer processing time - one can ensure that a consumer neither 
has to wait for the broker (as it would with a too low prefetch 
settings) nor buffer lots of messages (as it would with a too high 
prefetch settings).

Matthias.


From matthias at rabbitmq.com  Tue Jan 22 23:31:01 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 22 Jan 2013 23:31:01 +0000
Subject: [rabbitmq-discuss] ReturnListener is not invoked
In-Reply-To: <CAOLJz+hX2k5Wv6DhT_UepwrFW+AOg-MZJZQqbpb+mRD_dkotcg@mail.gmail.com>
References: <c44e9322-9f6c-4272-bb61-c74210f32d9c@googlegroups.com>
	<50F8EE8A.4050602@rabbitmq.com>
	<CAOLJz+hh2BXopekfrdvMrhiTofHMWOb=4rDSf2gdmP5qsjkUdg@mail.gmail.com>
	<50F9B0E3.3000808@rabbitmq.com>
	<CAOLJz+gV8d5-iehNCofsMsxqyRp01oEvyt8C18K8VX8d9GNEbA@mail.gmail.com>
	<50F9D52D.9070001@rabbitmq.com>
	<CAOLJz+hRzG_pYdnVKyay4OTYTLX5sraQn+O0dNxaAX1_0kxMsw@mail.gmail.com>
	<50FA8B81.3020401@rabbitmq.com> <50FA8E96.8050805@rabbitmq.com>
	<CAOLJz+hX2k5Wv6DhT_UepwrFW+AOg-MZJZQqbpb+mRD_dkotcg@mail.gmail.com>
Message-ID: <50FF2135.1000105@rabbitmq.com>

Dmitriy,

On 22/01/13 22:35, Dmitriy Bannikov wrote:
> By the way, does it mean that if RabbitMQ server doesn't have available
> disk space more than disk_free_limit, messages will be lost?

Depends. The server stops reading from the TCP socket, since it has 
nowhere to put the messages it would be reading. So the messages will 
pile up in various buffers, and eventually the publishing application's 
tcp send operations will encounter full buffers (and, usually, block).

If at that point the disk alarm (or any similar alarm) goes away then 
the message flow will resume and everything will continue as if nothing 
had happened. It's no different from a the server just appearing a bit slow.

If, otoh, the connection drops then the data in the various buffers 
along the way will be lost.

> but how will I know that this particular message hasn't been added
> to  queue?

Publishing in AMQP is an asynchronous operation - the only way to get 
acceptable performance regardless of network latency. So there is no 
direct/immediate indication of the fate of the message. However...

Any successfully completed synchronous operation following a series of 
publishes (or other async operations) serves as an indicator that the 
preceding async operations were received by the server and successfully 
processed.

Though this still doesn't mean the messages have been safely enqueued, 
stored on disk if necessary, mirrored, etc, etc.

That's what confirms are for. http://www.rabbitmq.com/confirms.html

Regards,

Matthias.

From matthias at rabbitmq.com  Tue Jan 22 23:37:21 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 22 Jan 2013 23:37:21 +0000
Subject: [rabbitmq-discuss] configure shovel for message throttling
In-Reply-To: <!&!AAAAAAAAAAAYAAAAAAAAAOosgHnoPqdNlUO2DUrQ/DfCgAAAEAAAACWyEasZpNRMgQV85uhFCl8BAAAAAA==@manfbraun.de>
References: <f90f16a3-f729-4aa2-93fa-f43c56ab1ab0@googlegroups.com>
	<50FEEEDE.2070700@rabbitmq.com>
	<!&!AAAAAAAAAAAYAAAAAAAAAOosgHnoPqdNlUO2DUrQ/DfCgAAAEAAAACWyEasZpNRMgQV85uhFCl8BAAAAAA==@manfbraun.de>
Message-ID: <50FF22B1.1070406@rabbitmq.com>

On 22/01/13 22:42, mabra at manfbraun.de wrote:
> Thanks. I was not sure, that the given value is per time and with
> which unit.

It's a count. Of the maximum number of messages "in flight".

> BTW: If I change the shovel config [the property, you mentioned]
> via program and use start/stop, would this apply the new config,
> or do I have to restart RabbitMQ ??

The rabbitmq.config file is only read on startup.

Matthias.

From tim at rabbitmq.com  Tue Jan 22 23:38:56 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 22 Jan 2013 23:38:56 +0000
Subject: [rabbitmq-discuss] Cannot access rabbitmqadmin.
In-Reply-To: <5753af5f-6c71-42db-91db-58279c63d685@googlegroups.com>
References: <5753af5f-6c71-42db-91db-58279c63d685@googlegroups.com>
Message-ID: <EAA46E3E-FE28-4FED-94AA-A8C36CF53066@rabbitmq.com>

Alex

On 22 Jan 2013, at 22:23, Alex Damian wrote:
> Also I can run rabbitmq-server and rabbitmqctl without issues.

When you start rabbitmq-server, what does the startup banner say about running/enabled plugins? Presumably you've checked that the plugin is showing up as enabled when you run `rabbitmq-plugins list` as well? 

From matthias at rabbitmq.com  Tue Jan 22 23:46:10 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 22 Jan 2013 23:46:10 +0000
Subject: [rabbitmq-discuss] .net version of the subscriber
In-Reply-To: <1358880220490-24625.post@n5.nabble.com>
References: <1358880220490-24625.post@n5.nabble.com>
Message-ID: <50FF24C2.4080008@rabbitmq.com>

On 22/01/13 18:43, jdepp wrote:
> I am trying to interprate the following and convert into .net code to
> implement creating multiple consumers and have them subscribe to a queue.
>
> def callback(ch, method, properties, body):
>      print " [x] Received %r" % (body,)
>      time.sleep( body.count('.') )
>      print " [x] Done"
>      ch.basic_ack(delivery_tag = method.delivery_tag)
>
> channel.basic_qos(prefetch_count=1)
> channel.basic_consume(callback,
>                        queue='task_queue')
>
> channel.start_consuming()
>
>
> what is the callback method? Is that the function that is called

yes.

> and how is this faster than using a basicget within your own loop.

I answered that in the other thread.

> It is still one consumer to a queue

Yes. Depending on your definition of 'consumer'. It's certainly just one 
client connected to rabbit. And it's certainly just one AMQP consumer 
(since there is only one basic.consume method). But it *could* 
potentially spawn a new thread for every message received, or use a 
thread pool.

> right or does rabbit implement its own threading somehow.

Depends on the client library. There are certainly some that maintain 
thread pools for invoking consumer callbacks - the RabbitMQ Java client 
is an example - but usually even then only a single thread is used for 
all messages arriving for a single AMQP consumer, or even across an 
entire channel, since that way messages can be guaranteed to get 
processed on order.

Regards,

Matthias.

From matthias at rabbitmq.com  Tue Jan 22 23:48:25 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 22 Jan 2013 23:48:25 +0000
Subject: [rabbitmq-discuss] configure shovel for message throttling
In-Reply-To: <!&!AAAAAAAAAAAYAAAAAAAAAOosgHnoPqdNlUO2DUrQ/DfCgAAAEAAAAJSi4XOvF8xDuplN+zvpI0YBAAAAAA==@manfbraun.de>
References: <f90f16a3-f729-4aa2-93fa-f43c56ab1ab0@googlegroups.com>
	<50FEEEDE.2070700@rabbitmq.com>
	<!&!AAAAAAAAAAAYAAAAAAAAAOosgHnoPqdNlUO2DUrQ/DfCgAAAEAAAACWyEasZpNRMgQV85uhFCl8BAAAAAA==@manfbraun.de>
	<50FF22B1.1070406@rabbitmq.com>
	<!&!AAAAAAAAAAAYAAAAAAAAAOosgHnoPqdNlUO2DUrQ/DfCgAAAEAAAAJSi4XOvF8xDuplN+zvpI0YBAAAAAA==@manfbraun.de>
Message-ID: <50FF2549.8060903@rabbitmq.com>

On 22/01/13 23:41, mabra at manfbraun.de wrote:
> So I have probably to stay at my start/stop [which is, naturally, not
> a good pattern ...]. If one adds a new queue, which shovels messages
> to the next broker [the same, like other, existing queues], one has
> to adapt these values and start/stop rabbit :-(

As Simon said yesterday, we do intend to make shovel configuration more 
dynamic. eventually.

Matthias.

From matthias at rabbitmq.com  Tue Jan 22 23:58:11 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 22 Jan 2013 23:58:11 +0000
Subject: [rabbitmq-discuss] error on startup
In-Reply-To: <CAAN_EDoWuKZHJWk+n9UWVN9=mrLghtZZGEzSqEZWQT8-Tg04mA@mail.gmail.com>
References: <CAAN_EDoWuKZHJWk+n9UWVN9=mrLghtZZGEzSqEZWQT8-Tg04mA@mail.gmail.com>
Message-ID: <50FF2793.9070106@rabbitmq.com>

Adam,

On 22/01/13 22:13, Adam Rabung wrote:
> I am having problems starting up my Rabbit instance.  This instance had
> been running happily for about a year.
>
> My googling of various interesting parts of the trace is coming up
> empty, could someone help? Here's a slightly edited log file of the
> error on startup:
>
> https://gist.github.com/4598977
>
> This is 2.8.7.

Looks like a corrupt persistent message store. We've had a couple of 
reports of that happening but have never been able to track down the cause.

Would it be possible to get a copy of the /data/sq/db directory, and of 
the tail of log files from the long-running rabbit instance? Happy to 
take this off-list if necessary.

Can you think of any external factors that might have caused data 
corruption? disk filling up. cosmic rays. etc. How did your ageing 
rabbit meet its end? power failure by any chance?

Regards,

Matthias.

From matthias at rabbitmq.com  Wed Jan 23 00:03:07 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 23 Jan 2013 00:03:07 +0000
Subject: [rabbitmq-discuss] error on startup
In-Reply-To: <50FF2793.9070106@rabbitmq.com>
References: <CAAN_EDoWuKZHJWk+n9UWVN9=mrLghtZZGEzSqEZWQT8-Tg04mA@mail.gmail.com>
	<50FF2793.9070106@rabbitmq.com>
Message-ID: <50FF28BB.5060606@rabbitmq.com>

On 22/01/13 23:58, Matthias Radestock wrote:
> Would it be possible to get a copy of the /data/sq/db directory, and of
> the tail of log files from the long-running rabbit instance? Happy to
> take this off-list if necessary.

Forgot to mention that if you move that dir to a safe place (so we can 
look at it later) then rabbit should start fine, though it will have 
lost all persistent data.

Matthias.

From pekowski at gmail.com  Wed Jan 23 02:04:18 2013
From: pekowski at gmail.com (Ray Pekowski)
Date: Tue, 22 Jan 2013 20:04:18 -0600
Subject: [rabbitmq-discuss] RabbitMQ scaling with OpenStack
Message-ID: <CAJcv3CSQBm3nq_YBTpmnZ7h8J9SNt-dO=BHkUGw3XRPyaKR8zA@mail.gmail.com>

On Jan 22, 2013, at 1:58 PM, Ask Solem <ask at rabbitmq.com> wrote:

> I could help you review the code as I have lots of experience optimizing
> this pattern and Python consumers.

It would be great if you could review the code.  Here is where the Kombu
interface is implemented in OpenStack

https://github.com/openstack/nova/blob/master/nova/openstack/common/rpc/impl_kombu.py

Roughly, the RPC call is sent by TopicPublisher (caller), then received by
TopicConsumers (callee).  The response is sent by DirectPublisher (callee)
and received by DirectConsumer (caller).  In real time, the consumes happen
before the publishes.

The RPC calls to impl_kombu.py come from amqp.py. which is simply a common
higher level set of methods that either calls methods from impl_kombu.py or
impl_qpid.py depending upon which implementation is configured.

Ray
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130122/b791958b/attachment.htm>

From naveen.kadiyala at kony.com  Wed Jan 23 05:30:01 2013
From: naveen.kadiyala at kony.com (Naveen Kadiyala)
Date: Tue, 22 Jan 2013 23:30:01 -0600
Subject: [rabbitmq-discuss] Upgrade of RabbitMq version
Message-ID: <BF667F8975AEED429CF51D41871462546145D634@MBX35.exg5.exghost.com>

Hi All,

Please let me know how to Upgrade  RabbitMq version from 2.2 to 2.6 and above.

[root at XXXX]# sudo rabbitmqctl status
Status of node 'rabbit at domU-XXXX ...
[{running_applications,[{rabbit,"RabbitMQ","2.2.0"},


Thanks for your time.

Regards,
Naveen Kumar K







This mail and/or attachments are confidential and may also be legally privileged. If you are not the  intended recipient, any disclosure, copying, distribution or action taken relying on the contents is strictly prohibited and may be unlawful. If you have received this communication in error, please notify the sender immediately by responding to this email and deleting the contents of the email & related attachments from your system. Though Kony has taken reasonable steps to ensure no viruses are present in this email, it cannot accept responsibility for any loss or damage arising from the use of this email or attachments. No contracts may be concluded with Kony through email communication.Please consider the environment before printing this mail.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130122/776814b2/attachment-0001.htm>

From stuff at moesel.net  Wed Jan 23 04:11:52 2013
From: stuff at moesel.net (Chris)
Date: Tue, 22 Jan 2013 23:11:52 -0500
Subject: [rabbitmq-discuss] Rabbit Node Won't Boot No Matter What I Do
	(schema_integrity_check_failed)
Message-ID: <CAHEpgBBobVThFXDybfHTx1VTFkDBJ0NeNP=YzYzk8=1C97aiUA@mail.gmail.com>

Hello,

I am trying to simulate a federated, clustered RabbitMQ environment on my
Mac 10.8 system.  I am using RabbitMQ 3.0.1, installed by HomeBrew.

The first time I setup the environment, everything worked great.  So great
that I wanted others to be able to do it too, so I created a script to do
it all.

Then I stopped all my rabbit nodes (using rabbitmqctl -n nodename stop) and
ran the script to do it all again.  This resulted in some nodes not being
able to boot up.  Now, no matter what, I can't get these particular nodes
up again (schema_integrity_check_failed).  I've read that this can be
resolved by deleting the mnesia DBs (/usr/local/var/lib/rabbitmq/mnesia/*),
but even that didn't help!

Is this a bug or am I doing something wrong?  I've attached my script, a
crash dump, and some logs.  Any help is appreciated!

Thanks,
Chris
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130122/40289fdd/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: setup_rabbit_env.sh
Type: application/x-sh
Size: 8153 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130122/40289fdd/attachment-0001.sh>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: erl_crash.dump
Type: application/octet-stream
Size: 1855341 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130122/40289fdd/attachment-0003.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbita.log
Type: application/octet-stream
Size: 19220 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130122/40289fdd/attachment-0004.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbita-sasl.log
Type: application/octet-stream
Size: 5603 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130122/40289fdd/attachment-0005.obj>

From tim at rabbitmq.com  Wed Jan 23 09:31:16 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 23 Jan 2013 09:31:16 +0000
Subject: [rabbitmq-discuss] Upgrade of RabbitMq version
In-Reply-To: <BF667F8975AEED429CF51D41871462546145D634@MBX35.exg5.exghost.com>
References: <BF667F8975AEED429CF51D41871462546145D634@MBX35.exg5.exghost.com>
Message-ID: <50FFADE4.9030601@rabbitmq.com>

Hi Naveen,

Instructions for upgrading are available in the release notes.

"To upgrade a non-clustered RabbitMQ from release 2.1.1 or later, simply 
install the new version. All configuration and persistent message data 
is retained."

Kind regards,
Tim

On 01/23/2013 05:30 AM, Naveen Kadiyala wrote:
>
> Hi All,
>
> Please let me know how to Upgrade  RabbitMq version from 2.2 to 2.6 
> and above.
>
> [root at XXXX]# sudo rabbitmqctl status
>
> Status of node 'rabbit at domU-XXXX ...
>
> [{running_applications,[{rabbit,"RabbitMQ","*2.2.0*"},
>
> Thanks for your time.
>
> Regards,
>
> Naveen Kumar K
>
>
>
> This mail and/or attachments are confidential and may also be legally 
> privileged. If you are not the intended recipient, any disclosure, 
> copying, distribution or action taken relying on the contents is 
> strictly prohibited and may be unlawful. If you have received this 
> communication in error, please notify the sender immediately by 
> responding to this email and deleting the contents of the email & 
> related attachments from your system. Though Kony has taken reasonable 
> steps to ensure no viruses are present in this email, it cannot accept 
> responsibility for any loss or damage arising from the use of this 
> email or attachments. No contracts may be concluded with Kony through 
> email communication.Please consider the environment before printing 
> this mail.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130123/7a86d721/attachment.htm>

From matthias at rabbitmq.com  Wed Jan 23 09:39:58 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 23 Jan 2013 09:39:58 +0000
Subject: [rabbitmq-discuss] Upgrade of RabbitMq version
In-Reply-To: <BF667F8975AEED429CF51D41871462546145D634@MBX35.exg5.exghost.com>
References: <BF667F8975AEED429CF51D41871462546145D634@MBX35.exg5.exghost.com>
Message-ID: <50FFAFEE.50703@rabbitmq.com>

Naveen,

On 23/01/13 05:30, Naveen Kadiyala wrote:
> Please let me know how to Upgrade  RabbitMq version from 2.2 to 2.6 and
> above.

 From the rabbitmq release notes...

<quote>
To upgrade a non-clustered RabbitMQ from release 2.1.1 or later, simply 
install the new version. All configuration and persistent message data 
is retained.

To upgrade a clustered RabbitMQ from release 2.1.1 or later, install the 
new version on all the nodes and follow the instructions at 
http://www.rabbitmq.com/clustering.html#upgrading .
</quote>

Btw, I would strongly recommend upgrading to the latest version (3.0.1).


Regards,

Matthias.

From tim at rabbitmq.com  Wed Jan 23 09:36:18 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 23 Jan 2013 09:36:18 +0000
Subject: [rabbitmq-discuss] Rabbit Node Won't Boot No Matter What I Do
 (schema_integrity_check_failed)
In-Reply-To: <CAHEpgBBobVThFXDybfHTx1VTFkDBJ0NeNP=YzYzk8=1C97aiUA@mail.gmail.com>
References: <CAHEpgBBobVThFXDybfHTx1VTFkDBJ0NeNP=YzYzk8=1C97aiUA@mail.gmail.com>
Message-ID: <50FFAF12.2010703@rabbitmq.com>

Hi Chris

On 01/23/2013 04:11 AM, Chris wrote:
> Then I stopped all my rabbit nodes (using rabbitmqctl -n nodename 
> stop) and ran the script to do it all again.  This resulted in some 
> nodes not being able to boot up.  Now, no matter what, I can't get 
> these particular nodes up again (schema_integrity_check_failed).  I've 
> read that this can be resolved by deleting the mnesia DBs 
> (/usr/local/var/lib/rabbitmq/mnesia/*), but even that didn't help!
>

If you successfully deleted the mnesia DBs then the schema integrity 
check cannot fail, as there is no database to check! Where do you set 
the RABBITMQ_MNESIA_BASE and/or RABBITMQ_MNESIA_DIR for the individual 
nodes?

> Is this a bug or am I doing something wrong?  I've attached my script, 
> a crash dump, and some logs.  Any help is appreciated!
>

I strongly suspect the latter! ;)

Can you confirm the database directory deletion by running `ls -la` 
afterwards to make sure everything's gone, and then try starting up a 
single node.

From naveen.kadiyala at kony.com  Wed Jan 23 09:43:35 2013
From: naveen.kadiyala at kony.com (Naveen Kadiyala)
Date: Wed, 23 Jan 2013 03:43:35 -0600
Subject: [rabbitmq-discuss] Upgrade of RabbitMq version
In-Reply-To: <50FFADE4.9030601@rabbitmq.com>
References: <BF667F8975AEED429CF51D41871462546145D634@MBX35.exg5.exghost.com>
	<50FFADE4.9030601@rabbitmq.com>
Message-ID: <BF667F8975AEED429CF51D41871462546145D646@MBX35.exg5.exghost.com>

Hi All,

Have installed the latest rabbitmq "RabbitMQ","3.0.1 in two instance in cloud. Now need help to configure clustering and also the Highly Available Queues. In AWS instance.

Centos release 5.4 (Final)

Thanks for you rime

Regards,
Naveen Kumar K


From: Tim Watson [mailto:tim at rabbitmq.com]
Sent: Wednesday, January 23, 2013 3:01 PM
To: Discussions about RabbitMQ
Cc: Naveen Kadiyala; info at rabbitmq.com
Subject: Re: [rabbitmq-discuss] Upgrade of RabbitMq version

Hi Naveen,

Instructions for upgrading are available in the release notes.

"To upgrade a non-clustered RabbitMQ from release 2.1.1 or later, simply install the new version. All configuration and persistent message data is retained."

Kind regards,
Tim

On 01/23/2013 05:30 AM, Naveen Kadiyala wrote:
Hi All,

Please let me know how to Upgrade  RabbitMq version from 2.2 to 2.6 and above.

[root at XXXX]# sudo rabbitmqctl status
Status of node 'rabbit at domU-XXXX ...
[{running_applications,[{rabbit,"RabbitMQ","2.2.0"},


Thanks for your time.

Regards,
Naveen Kumar K





This mail and/or attachments are confidential and may also be legally privileged. If you are not the intended recipient, any disclosure, copying, distribution or action taken relying on the contents is strictly prohibited and may be unlawful. If you have received this communication in error, please notify the sender immediately by responding to this email and deleting the contents of the email & related attachments from your system. Though Kony has taken reasonable steps to ensure no viruses are present in this email, it cannot accept responsibility for any loss or damage arising from the use of this
 email or attachments. No contracts may be concluded with Kony through email
 communication.Please consider the environment before printing this mail.



_______________________________________________

rabbitmq-discuss mailing list

rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>

https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss





This mail and/or attachments are confidential and may also be legally privileged. If you are not the  intended recipient, any disclosure, copying, distribution or action taken relying on the contents is strictly prohibited and may be unlawful. If you have received this communication in error, please notify the sender immediately by responding to this email and deleting the contents of the email & related attachments from your system. Though Kony has taken reasonable steps to ensure no viruses are present in this email, it cannot accept responsibility for any loss or damage arising from the use of this email or attachments. No contracts may be concluded with Kony through email communication.Please consider the environment before printing this mail.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130123/2442820b/attachment.htm>

From tim at rabbitmq.com  Wed Jan 23 09:49:18 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 23 Jan 2013 09:49:18 +0000
Subject: [rabbitmq-discuss] Upgrade of RabbitMq version
In-Reply-To: <BF667F8975AEED429CF51D41871462546145D646@MBX35.exg5.exghost.com>
References: <BF667F8975AEED429CF51D41871462546145D634@MBX35.exg5.exghost.com>
	<50FFADE4.9030601@rabbitmq.com>
	<BF667F8975AEED429CF51D41871462546145D646@MBX35.exg5.exghost.com>
Message-ID: <50FFB21E.9010405@rabbitmq.com>

Naveen,

Start with http://www.rabbitmq.com/documentation.html and give us a 
shout if you get stuck with anything.

Kind regards,

Tim

On 01/23/2013 09:43 AM, Naveen Kadiyala wrote:
>
> Hi All,
>
> Have installed the latest rabbitmq "RabbitMQ","3.0.1 in two instance 
> in cloud. Now need help to configure clustering and also the Highly 
> Available Queues. In AWS instance.
>
> Centos release 5.4 (Final)
>
> Thanks for you rime
>
> Regards,
>
> Naveen Kumar K
>
> *From:*Tim Watson [mailto:tim at rabbitmq.com]
> *Sent:* Wednesday, January 23, 2013 3:01 PM
> *To:* Discussions about RabbitMQ
> *Cc:* Naveen Kadiyala; info at rabbitmq.com
> *Subject:* Re: [rabbitmq-discuss] Upgrade of RabbitMq version
>
> Hi Naveen,
>
> Instructions for upgrading are available in the release notes.
>
> "To upgrade a non-clustered RabbitMQ from release 2.1.1 or later, 
> simply install the new version. All configuration and persistent 
> message data is retained."
>
> Kind regards,
> Tim
>
> On 01/23/2013 05:30 AM, Naveen Kadiyala wrote:
>
> Hi All,
>
> Please let me know how to Upgrade  RabbitMq version from 2.2 to 2.6 
> and above.
>
> [root at XXXX]# sudo rabbitmqctl status
>
> Status of node 'rabbit at domU-XXXX ...
>
> [{running_applications,[{rabbit,"RabbitMQ","*2.2.0*"},
>
> Thanks for your time.
>
> Regards,
>
> Naveen Kumar K
>
>
>
> This mail and/or attachments are confidential and may also be legally 
> privileged. If you are not the intended recipient, any disclosure, 
> copying, distribution or action taken relying on the contents is 
> strictly prohibited and may be unlawful. If you have received this 
> communication in error, please notify the sender immediately by 
> responding to this email and deleting the contents of the email & 
> related attachments from your system. Though Kony has taken reasonable 
> steps to ensure no viruses are present in this email, it cannot accept 
> responsibility for any loss or damage arising from the use of this 
> email or attachments. No contracts may be concluded with Kony through 
> email communication.Please consider the environment before printing 
> this mail.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com  <mailto:rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> This mail and/or attachments are confidential and may also be legally 
> privileged. If you are not the intended recipient, any disclosure, 
> copying, distribution or action taken relying on the contents is 
> strictly prohibited and may be unlawful. If you have received this 
> communication in error, please notify the sender immediately by 
> responding to this email and deleting the contents of the email & 
> related attachments from your system. Though Kony has taken reasonable 
> steps to ensure no viruses are present in this email, it cannot accept 
> responsibility for any loss or damage arising from the use of this 
> email or attachments. No contracts may be concluded with Kony through 
> email communication.Please consider the environment before printing 
> this mail. 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130123/802e862e/attachment.htm>

From matthias at rabbitmq.com  Wed Jan 23 09:57:12 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 23 Jan 2013 09:57:12 +0000
Subject: [rabbitmq-discuss] Rabbit Node Won't Boot No Matter What I Do
 (schema_integrity_check_failed)
In-Reply-To: <50FFAF12.2010703@rabbitmq.com>
References: <CAHEpgBBobVThFXDybfHTx1VTFkDBJ0NeNP=YzYzk8=1C97aiUA@mail.gmail.com>
	<50FFAF12.2010703@rabbitmq.com>
Message-ID: <50FFB3F8.5010100@rabbitmq.com>

On 23/01/13 09:36, Tim Watson wrote:
> Where do you set
> the RABBITMQ_MNESIA_BASE and/or RABBITMQ_MNESIA_DIR for the individual
> nodes?

The script supplies a RABBITMQ_NODENAME, which is sufficient.

Btw, as an aside, I notice that the script employs a mixture of 
rabbitmqctl and management API access. The latter for creating vhosts, 
granting user permissions, setting up queue mirroring policies and 
federated exchanges. All but the last one can be done with rabbitmqctl.

> Can you confirm the database directory deletion by running `ls -la`
> afterwards to make sure everything's gone, and then try starting up a
> single node.

Indeed.

One problem with the scripts is that the servers are started 
asynchronously, with -detached, so they may not have fully started by 
the time the subsequent rabbitmqctl invocations try to talk to them. A 
judicious insertion of 'rabbitmqctl wait <pid_file>' should solve that.

Regards,

Matthias.

From james.scicluna at seekda.com  Wed Jan 23 10:00:25 2013
From: james.scicluna at seekda.com (James Scicluna)
Date: Wed, 23 Jan 2013 11:00:25 +0100
Subject: [rabbitmq-discuss] Publishing on an x-consistent-hash exchange
Message-ID: <50FFB4B9.8000507@seekda.com>

Hi,
we are currently testing the x-consistent-hash plugin [1] for rabbitmq.
When publishing to the respective exchange, the (Java) client succeeds
but the server logs indicate an error which we are currently unable to
understand: https://gist.github.com/e6ec16827b3d5d19bed6.

For your convenience, you can also find a Java snippet code here:
https://gist.github.com/33497f783785d7253813. What our message producer
is doing is publishing a message to the exchange with a specific routing
key upon which the plugin's hash function will be executed.

Thank you for any insight,
James


[1] https://github.com/rabbitmq/rabbitmq-consistent-hash-exchange

-- 
seekda GmbH
Grabenweg 68, 6020 Innsbruck, Austria | Neubaugasse 10/15, 1070 Wien,
Austria
Web: http://seekda.com
Jabber/Mail: james.scicluna at seekda.com

From naveen.kadiyala at kony.com  Wed Jan 23 10:19:56 2013
From: naveen.kadiyala at kony.com (Naveen Kadiyala)
Date: Wed, 23 Jan 2013 04:19:56 -0600
Subject: [rabbitmq-discuss] Upgrade of RabbitMq version
In-Reply-To: <50FFB21E.9010405@rabbitmq.com>
References: <BF667F8975AEED429CF51D41871462546145D634@MBX35.exg5.exghost.com>
	<50FFADE4.9030601@rabbitmq.com>
	<BF667F8975AEED429CF51D41871462546145D646@MBX35.exg5.exghost.com>
	<50FFB21E.9010405@rabbitmq.com>
Message-ID: <BF667F8975AEED429CF51D41871462546145D64A@MBX35.exg5.exghost.com>

Hi Tim,

For clustering flowing the link http://www.rabbitmq.com/clustering.html, was stuck while joining the clustering .

[root at domU-XXXX ]# rabbitmqctl join_cluster rabbit at domU-XXXXXX
Clustering node 'rabbit at domU-XXXX with 'rabbit at domU-XXXXX ...
Error: cannot_discover_cluster: The nodes provided are either offline or not running

Regards,
Naveen Kumar K



From: Tim Watson [mailto:tim at rabbitmq.com]
Sent: Wednesday, January 23, 2013 3:19 PM
To: Naveen Kadiyala
Cc: Discussions about RabbitMQ; info at rabbitmq.com
Subject: Re: [rabbitmq-discuss] Upgrade of RabbitMq version

Naveen,

Start with http://www.rabbitmq.com/documentation.html and give us a shout if you get stuck with anything.

Kind regards,

Tim

On 01/23/2013 09:43 AM, Naveen Kadiyala wrote:
Hi All,

Have installed the latest rabbitmq "RabbitMQ","3.0.1 in two instance in cloud. Now need help to configure clustering and also the Highly Available Queues. In AWS instance.

Centos release 5.4 (Final)

Thanks for you rime

Regards,
Naveen Kumar K


From: Tim Watson [mailto:tim at rabbitmq.com]
Sent: Wednesday, January 23, 2013 3:01 PM
To: Discussions about RabbitMQ
Cc: Naveen Kadiyala; info at rabbitmq.com<mailto:info at rabbitmq.com>
Subject: Re: [rabbitmq-discuss] Upgrade of RabbitMq version

Hi Naveen,

Instructions for upgrading are available in the release notes.

"To upgrade a non-clustered RabbitMQ from release 2.1.1 or later, simply install the new version. All configuration and persistent message data is retained."

Kind regards,
Tim

On 01/23/2013 05:30 AM, Naveen Kadiyala wrote:
Hi All,

Please let me know how to Upgrade  RabbitMq version from 2.2 to 2.6 and above.

[root at XXXX]# sudo rabbitmqctl status
Status of node 'rabbit at domU-XXXX ...
[{running_applications,[{rabbit,"RabbitMQ","2.2.0"},


Thanks for your time.

Regards,
Naveen Kumar K





This mail and/or attachments are confidential and may also be legally privileged. If you are not the intended recipient, any disclosure, copying, distribution or action taken relying on the contents is strictly prohibited and may be unlawful. If you have received this communication in error, please notify the sender immediately by responding to this email and deleting the contents of the email & related attachments from your system. Though Kony has taken reasonable steps to ensure no viruses are present in this email, it cannot accept responsibility for any loss or damage arising from the use of this
 email or attachments. No contracts may be concluded with Kony through email
 communication.Please consider the environment before printing this mail.




_______________________________________________

rabbitmq-discuss mailing list

rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>

https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



This mail and/or attachments are confidential and may also be legally privileged. If you are not the intended recipient, any disclosure, copying, distribution or action taken relying on the contents is strictly prohibited and may be unlawful. If you have received this communication in error, please notify the sender immediately by responding to this email and deleting the contents of the email & related attachments from your system. Though Kony has taken reasonable steps to ensure no viruses are present in this email, it cannot accept responsibility for any loss or damage arising from the use of this
 email or attachments. No contracts may be concluded with Kony through email
 communication.Please consider the environment before printing this mail.





This mail and/or attachments are confidential and may also be legally privileged. If you are not the  intended recipient, any disclosure, copying, distribution or action taken relying on the contents is strictly prohibited and may be unlawful. If you have received this communication in error, please notify the sender immediately by responding to this email and deleting the contents of the email & related attachments from your system. Though Kony has taken reasonable steps to ensure no viruses are present in this email, it cannot accept responsibility for any loss or damage arising from the use of this email or attachments. No contracts may be concluded with Kony through email communication.Please consider the environment before printing this mail.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130123/2a03ced8/attachment.htm>

From simon at rabbitmq.com  Wed Jan 23 10:23:52 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 23 Jan 2013 10:23:52 +0000
Subject: [rabbitmq-discuss] Cannot access rabbitmqadmin.
In-Reply-To: <5753af5f-6c71-42db-91db-58279c63d685@googlegroups.com>
References: <5753af5f-6c71-42db-91db-58279c63d685@googlegroups.com>
Message-ID: <50FFBA38.4040608@rabbitmq.com>

On 22/01/13 22:23, Alex Damian wrote:
> I have followed all the instructions on
> http://www.rabbitmq.com/management.html
> <http://www.rabbitmq.com/management.html> and enabled the plugin, but
> after than there is no webserver running anywhere on my machine.

The webserver is internal to RabbitMQ, so you would not necessarily see 
anything different.

Some things to try:

* Check rabbitmq-plugins list, to see if the plugin really is enabled

* Check rabbitmqctl status, to see if the plugin really started 
(rabbitmq_management should be listed under running_applications)

* Check the logs, there should be a log entry like:

=INFO REPORT==== 22-Jan-2013::17:15:39 ===
Management plugin started. Port: 15672

* Check something like "netstat -nptl | grep 15672" to make sure the 
port is open.

* Check iptables. At least RHEL ships with a fairly restrictive firewall 
by default that will block access, I don't know if fedora does.

Finally, what sort of failure are you seeing? Connection refused, 
connection timed out, or something else?

Cheers, Simon

> Should I add something in my config file perhaps?

No, you should just have to enable the plugin, restart the server and be 
good.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed Jan 23 10:29:48 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 23 Jan 2013 10:29:48 +0000
Subject: [rabbitmq-discuss] Publishing on an x-consistent-hash exchange
In-Reply-To: <50FFB4B9.8000507@seekda.com>
References: <50FFB4B9.8000507@seekda.com>
Message-ID: <50FFBB9C.5000206@rabbitmq.com>

On 23/01/13 10:00, James Scicluna wrote:
> we are currently testing the x-consistent-hash plugin [1] for rabbitmq.
> When publishing to the respective exchange, the (Java) client succeeds
> but the server logs indicate an error which we are currently unable to
> understand:https://gist.github.com/e6ec16827b3d5d19bed6.

Hmm. That error looks like a mismatch between the rabbitmq-server 
version and the consistent hash plugin version. How did you install 
RabbitMQ? Recent versions should ship with the plugin, but did you build 
it yourself? What does "rabbitmqctl status" show?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From tim at rabbitmq.com  Wed Jan 23 10:33:37 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 23 Jan 2013 10:33:37 +0000
Subject: [rabbitmq-discuss] Upgrade of RabbitMq version
In-Reply-To: <BF667F8975AEED429CF51D41871462546145D64A@MBX35.exg5.exghost.com>
References: <BF667F8975AEED429CF51D41871462546145D634@MBX35.exg5.exghost.com>
	<50FFADE4.9030601@rabbitmq.com>
	<BF667F8975AEED429CF51D41871462546145D646@MBX35.exg5.exghost.com>
	<50FFB21E.9010405@rabbitmq.com>
	<BF667F8975AEED429CF51D41871462546145D64A@MBX35.exg5.exghost.com>
Message-ID: <50FFBC81.6030900@rabbitmq.com>

Hi Naveen

On 01/23/2013 10:19 AM, Naveen Kadiyala wrote:
> For clustering flowing the link 
> http://www.rabbitmq.com/clustering.html, was stuck while joining the 
> clustering .
>
> [root at domU-XXXX ]# rabbitmqctl join_cluster rabbit at domU-XXXXXX
>
> Clustering node 'rabbit at domU-XXXX with 'rabbit at domU-XXXXX ...
>
> *Error: cannot_discover_cluster: The nodes provided are either offline 
> or not running*
>

That error message clearly states that thereis some kind of connectivity 
problem between the nodes. I've not used Amazon EC2 before, but 60 
seconds on google yielded this: 
http://karlgrz.com/rabbitmq-highly-available-queues-and-clustering-using-amazon-ec2/

Might I suggest you read through that and see if it helps.

Regards,
Tim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130123/0a8ead5f/attachment.htm>

From naveen.kadiyala at kony.com  Wed Jan 23 10:41:11 2013
From: naveen.kadiyala at kony.com (Naveen Kadiyala)
Date: Wed, 23 Jan 2013 04:41:11 -0600
Subject: [rabbitmq-discuss] Upgrade of RabbitMq version
In-Reply-To: <50FFBC81.6030900@rabbitmq.com>
References: <BF667F8975AEED429CF51D41871462546145D634@MBX35.exg5.exghost.com>
	<50FFADE4.9030601@rabbitmq.com>
	<BF667F8975AEED429CF51D41871462546145D646@MBX35.exg5.exghost.com>
	<50FFB21E.9010405@rabbitmq.com>
	<BF667F8975AEED429CF51D41871462546145D64A@MBX35.exg5.exghost.com>
	<50FFBC81.6030900@rabbitmq.com>
Message-ID: <BF667F8975AEED429CF51D41871462546145D64B@MBX35.exg5.exghost.com>

Hi Tim,

Thanks for the information. Will  check the link .

Regards,
Naveen Kumar K



From: Tim Watson [mailto:tim at rabbitmq.com]
Sent: Wednesday, January 23, 2013 4:04 PM
To: Naveen Kadiyala
Cc: Discussions about RabbitMQ; info at rabbitmq.com
Subject: Re: [rabbitmq-discuss] Upgrade of RabbitMq version

Hi Naveen

On 01/23/2013 10:19 AM, Naveen Kadiyala wrote:
For clustering flowing the link http://www.rabbitmq.com/clustering.html, was stuck while joining the clustering .

[root at domU-XXXX ]# rabbitmqctl join_cluster rabbit at domU-XXXXXX
Clustering node 'rabbit at domU-XXXX with 'rabbit at domU-XXXXX ...
Error: cannot_discover_cluster: The nodes provided are either offline or not running


That error message clearly states that there is some kind of connectivity problem between the nodes. I've not used Amazon EC2 before, but 60 seconds on
 google yielded this: http://karlgrz.com/rabbitmq-highly-available-queues-and-clustering-using-amazon-ec2/

Might I suggest you read through that and see if it helps.

Regards,
Tim




This mail and/or attachments are confidential and may also be legally privileged. If you are not the  intended recipient, any disclosure, copying, distribution or action taken relying on the contents is strictly prohibited and may be unlawful. If you have received this communication in error, please notify the sender immediately by responding to this email and deleting the contents of the email & related attachments from your system. Though Kony has taken reasonable steps to ensure no viruses are present in this email, it cannot accept responsibility for any loss or damage arising from the use of this email or attachments. No contracts may be concluded with Kony through email communication.Please consider the environment before printing this mail.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130123/4d41c256/attachment.htm>

From antony.pulicken at gmail.com  Wed Jan 23 12:14:07 2013
From: antony.pulicken at gmail.com (antony)
Date: Wed, 23 Jan 2013 04:14:07 -0800 (PST)
Subject: [rabbitmq-discuss] Container for RabbitMQ Listener/Consumer
	(Java)
In-Reply-To: <1358773561132-24611.post@n5.nabble.com>
References: <1358773561132-24611.post@n5.nabble.com>
Message-ID: <1358943247907-24661.post@n5.nabble.com>

I will try to re-phrase the question. 

So far we have been using a stand alone Java program that listens to a
particular queue in an infinite while loop for all the POCs as mentioned in
all the examples. 

   while (true) {
        String response = null;
        
        QueueingConsumer.Delivery delivery = consumer.nextDelivery();

What I want to understand is how the listeners are set up/deployed in a
production environment? Do we need to have container like Spring ? How
exactly Scalability, HA are handled ? Hope to get a response.

Thanks,
Antony. 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Container-for-RabbitMQ-Listener-Consumer-Java-tp24611p24661.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From james.scicluna at seekda.com  Wed Jan 23 12:45:57 2013
From: james.scicluna at seekda.com (James Scicluna)
Date: Wed, 23 Jan 2013 13:45:57 +0100
Subject: [rabbitmq-discuss] Publishing on an x-consistent-hash exchange
In-Reply-To: <50FFBB9C.5000206@rabbitmq.com>
References: <50FFB4B9.8000507@seekda.com> <50FFBB9C.5000206@rabbitmq.com>
Message-ID: <50FFDB85.6030708@seekda.com>

Hi Simon,
we are indeed running an old version of the queue which we built
manually while installing the plugin. We will be installing the latest
version.

Thanks for the quick reply!
James

On 01/23/2013 11:29 AM, Simon MacMullen wrote:
> On 23/01/13 10:00, James Scicluna wrote:
>> we are currently testing the x-consistent-hash plugin [1] for rabbitmq.
>> When publishing to the respective exchange, the (Java) client succeeds
>> but the server logs indicate an error which we are currently unable to
>> understand:https://gist.github.com/e6ec16827b3d5d19bed6.
> 
> Hmm. That error looks like a mismatch between the rabbitmq-server
> version and the consistent hash plugin version. How did you install
> RabbitMQ? Recent versions should ship with the plugin, but did you build
> it yourself? What does "rabbitmqctl status" show?
> 
> Cheers, Simon
> 

-- 
seekda GmbH
Grabenweg 68, 6020 Innsbruck, Austria | Neubaugasse 10/15, 1070 Wien,
Austria
Web: http://seekda.com
Jabber/Mail: james.scicluna at seekda.com

From stuff at moesel.net  Wed Jan 23 12:53:20 2013
From: stuff at moesel.net (Chris)
Date: Wed, 23 Jan 2013 07:53:20 -0500
Subject: [rabbitmq-discuss] Rabbit Node Won't Boot No Matter What I Do
	(schema_integrity_check_failed)
In-Reply-To: <50FFB3F8.5010100@rabbitmq.com>
References: <CAHEpgBBobVThFXDybfHTx1VTFkDBJ0NeNP=YzYzk8=1C97aiUA@mail.gmail.com>
	<50FFAF12.2010703@rabbitmq.com> <50FFB3F8.5010100@rabbitmq.com>
Message-ID: <CAHEpgBA_KEr98QhUKpyYLTH+oPU3zkDXPOopE=FK+zgnxWfjwA@mail.gmail.com>

Thank you, Tim and Matthias.

Tim: Yes, I'm aware that many of these things can use rabbitmqctl instead
of HTTP API.  I had started switching things to HTTP API (so, in theory, if
I ever need to put my own GUI on these commands, I'll know the calls)-- but
didn't get through it all yet.  In hindsight, maybe I should stick with
rabbitmqctl for now so I can more easily see what is going on.  Thanks for
making me think about it.

Regarding the startup of servers, that's a good point and something I had
thought of.  While troubleshooting, I inserted a "sleep 2" after the rabbit
startups to give them a couple of seconds to sleep.  I don't think I can
use "rabbitmqctl wait <pid_file>" because when I start the servers in
detached mode it specifically says: "Warning: PID file not written;
-detached was passed."  I tried "rabbitmqctl -n rabbita wait", but get back
an error saying it is an invalid command.  I guess I will experiment with
"sleep" again, but use a value greater than 2 seconds.

Matthias: After deleting the mnesia database I tried multiple times to get
the node up.  Maybe there was a different error the first time, but I noted
the error from subsequent times.  I'll try from scratch again and see what
happens.

Thanks again-- I really appreciate the pointers.

-Chris


On Wed, Jan 23, 2013 at 4:57 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> On 23/01/13 09:36, Tim Watson wrote:
>
>> Where do you set
>> the RABBITMQ_MNESIA_BASE and/or RABBITMQ_MNESIA_DIR for the individual
>> nodes?
>>
>
> The script supplies a RABBITMQ_NODENAME, which is sufficient.
>
> Btw, as an aside, I notice that the script employs a mixture of
> rabbitmqctl and management API access. The latter for creating vhosts,
> granting user permissions, setting up queue mirroring policies and
> federated exchanges. All but the last one can be done with rabbitmqctl.
>
>
>  Can you confirm the database directory deletion by running `ls -la`
>> afterwards to make sure everything's gone, and then try starting up a
>> single node.
>>
>
> Indeed.
>
> One problem with the scripts is that the servers are started
> asynchronously, with -detached, so they may not have fully started by the
> time the subsequent rabbitmqctl invocations try to talk to them. A
> judicious insertion of 'rabbitmqctl wait <pid_file>' should solve that.
>
> Regards,
>
> Matthias.
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130123/7f8a52db/attachment.htm>

From tim at rabbitmq.com  Wed Jan 23 12:48:47 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 23 Jan 2013 12:48:47 +0000
Subject: [rabbitmq-discuss] Container for RabbitMQ Listener/Consumer
	(Java)
In-Reply-To: <1358943247907-24661.post@n5.nabble.com>
References: <1358773561132-24611.post@n5.nabble.com>
	<1358943247907-24661.post@n5.nabble.com>
Message-ID: <50FFDC2F.6080908@rabbitmq.com>

Hi Antony,

On 01/23/2013 12:14 PM, antony wrote:
> I will try to re-phrase the question.
>
> So far we have been using a stand alone Java program that listens to a
> particular queue in an infinite while loop for all the POCs as mentioned in
> all the examples.
>
>     while (true) {
>          String response = null;
>
>          QueueingConsumer.Delivery delivery = consumer.nextDelivery();
>
> What I want to understand is how the listeners are set up/deployed in a
> production environment? Do we need to have container like Spring ? How
> exactly Scalability, HA are handled ? Hope to get a response.

How you choose to deploy components of your own application is entirely 
up to you. The fact that your application components interact with a 
messaging server is orthogonal to questions about deployment topology 
and/or the use of Spring. Here's my perspective on this.

1. If you need an application server, then use one.

This won't have any effect on the broker (which is an external program 
running on another machine) but if your application can benefit from 
running in a container then go for it. Whether your consumer code is 
running in a container or not, you'll still need to write code to 
interact with the broker, handle acks and/or confirms, and so on. The 
container is a deployment environment which may (or may not) offer some 
useful services to the application, but the RabbitMQ java client will be 
completely unaware of these and therefore it's up to you to choose 
whether they make sense for your particular use case.

2. Spring is also orthogonal  ....

... at least to some extent. The Spring AMQP and Spring messaging layers 
offer many useful features that you may wish to take advantage of, but 
they're not magic - simply re-usable code that has been well tested. 
There's no reason why a standalone Java application that uses the 
RabbitMQ Java client directly shouldn't be just as stable and reliable 
as an application written using Spring, but using Spring might make it 
easier to achieve those goals.

3. Scalability/HA are the responsibility of the broker ....

to some extent. :)

Actually you'll want to think carefully about your messaging topology 
and the way in which producer and consumer applications interact with 
the broker. Connecting to a cluster might complicate the design of your 
application, with regards issues such as connecting to different nodes 
and so on. In terms of Scalability - how your application performs, and 
appears to perform (from an outside perspective) can depend on a lot of 
different factors. It's impossible to offer any advice without knowing 
more specifics, but in general you should be looking at what the broker 
offers (in terms of message delivery guarantees for HA and in terms of 
performance profiles with various different settings and under various 
topologies) and make your design decisions based on there.

Running your application in a container won't change the broker's 
message delivery guarantees or performance profile at all, but may offer 
other benefits. Using Spring won't 'enable' HA or improve scalability by 
itself either, but some features (such as auto-reconnect for 
disconnected consumers) may be useful to your application and improve 
its reliability.

Hope that helps. I'd suggest spending a good amount of time in the 
documentation to make sure you understand all the features Rabbit has to 
offer, and then of course feel free to drop back here and ask any 
specific questions. :)

Kind regards,
Tim

From stuff at moesel.net  Wed Jan 23 14:57:05 2013
From: stuff at moesel.net (Chris)
Date: Wed, 23 Jan 2013 09:57:05 -0500
Subject: [rabbitmq-discuss] Rabbit Node Won't Boot No Matter What I Do
	(schema_integrity_check_failed)
In-Reply-To: <CAHEpgBA_KEr98QhUKpyYLTH+oPU3zkDXPOopE=FK+zgnxWfjwA@mail.gmail.com>
References: <CAHEpgBBobVThFXDybfHTx1VTFkDBJ0NeNP=YzYzk8=1C97aiUA@mail.gmail.com>
	<50FFAF12.2010703@rabbitmq.com> <50FFB3F8.5010100@rabbitmq.com>
	<CAHEpgBA_KEr98QhUKpyYLTH+oPU3zkDXPOopE=FK+zgnxWfjwA@mail.gmail.com>
Message-ID: <CAHEpgBCU1M9otYNy+_2sx-_2za29M1RnFA9VNZ6WODXgiODDAg@mail.gmail.com>

An update:

If I delete the database *and* insert a 30-second sleep after the server
starts in the script, then it seems to work reliably.  Hurray!

It's worth noting, however, that if I remove the 30-second sleep (so it
immediately goes to stop_app/reset/start_app), then it can corrupt the
database on subsequent runs.  Once corrupted, it seems there is no way to
recover but delete the mnesia database.  So something in stop_app, reset,
or start_app seems to be destructive to a still-initializing RabbitMQ
server.

Thanks again for the help!  I had tried the sleep before-- but I guess it
wasn't long enough.

-Chris


On Wed, Jan 23, 2013 at 7:53 AM, Chris <stuff at moesel.net> wrote:

> Thank you, Tim and Matthias.
>
> Tim: Yes, I'm aware that many of these things can use rabbitmqctl instead
> of HTTP API.  I had started switching things to HTTP API (so, in theory, if
> I ever need to put my own GUI on these commands, I'll know the calls)-- but
> didn't get through it all yet.  In hindsight, maybe I should stick with
> rabbitmqctl for now so I can more easily see what is going on.  Thanks for
> making me think about it.
>
> Regarding the startup of servers, that's a good point and something I had
> thought of.  While troubleshooting, I inserted a "sleep 2" after the rabbit
> startups to give them a couple of seconds to sleep.  I don't think I can
> use "rabbitmqctl wait <pid_file>" because when I start the servers in
> detached mode it specifically says: "Warning: PID file not written;
> -detached was passed."  I tried "rabbitmqctl -n rabbita wait", but get back
> an error saying it is an invalid command.  I guess I will experiment with
> "sleep" again, but use a value greater than 2 seconds.
>
> Matthias: After deleting the mnesia database I tried multiple times to get
> the node up.  Maybe there was a different error the first time, but I noted
> the error from subsequent times.  I'll try from scratch again and see what
> happens.
>
> Thanks again-- I really appreciate the pointers.
>
> -Chris
>
>
> On Wed, Jan 23, 2013 at 4:57 AM, Matthias Radestock <matthias at rabbitmq.com
> > wrote:
>
>> On 23/01/13 09:36, Tim Watson wrote:
>>
>>> Where do you set
>>> the RABBITMQ_MNESIA_BASE and/or RABBITMQ_MNESIA_DIR for the individual
>>> nodes?
>>>
>>
>> The script supplies a RABBITMQ_NODENAME, which is sufficient.
>>
>> Btw, as an aside, I notice that the script employs a mixture of
>> rabbitmqctl and management API access. The latter for creating vhosts,
>> granting user permissions, setting up queue mirroring policies and
>> federated exchanges. All but the last one can be done with rabbitmqctl.
>>
>>
>>  Can you confirm the database directory deletion by running `ls -la`
>>> afterwards to make sure everything's gone, and then try starting up a
>>> single node.
>>>
>>
>> Indeed.
>>
>> One problem with the scripts is that the servers are started
>> asynchronously, with -detached, so they may not have fully started by the
>> time the subsequent rabbitmqctl invocations try to talk to them. A
>> judicious insertion of 'rabbitmqctl wait <pid_file>' should solve that.
>>
>> Regards,
>>
>> Matthias.
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130123/0e660f1e/attachment.htm>

From j_depp_99 at yahoo.com  Wed Jan 23 15:07:57 2013
From: j_depp_99 at yahoo.com (jdepp)
Date: Wed, 23 Jan 2013 07:07:57 -0800 (PST)
Subject: [rabbitmq-discuss] messages not getting acknowledged as it
	should be
In-Reply-To: <50FF209B.8020509@rabbitmq.com>
References: <1358891681463-24631.post@n5.nabble.com>
	<50FF0E53.2060805@rabbitmq.com>
	<1358896583919-24637.post@n5.nabble.com>
	<50FF209B.8020509@rabbitmq.com>
Message-ID: <1358953677809-24666.post@n5.nabble.com>

thanks for the response.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/messages-not-getting-acknowledged-as-it-should-be-tp24631p24666.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From carl.hoerberg at gmail.com  Wed Jan 23 15:48:34 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Wed, 23 Jan 2013 07:48:34 -0800 (PST)
Subject: [rabbitmq-discuss] Memory introspection
Message-ID: <1358956114166-24667.post@n5.nabble.com>

Do you have any tips on how to inspect the memory usage for a 2.8.7 cluster?
Some of my nodes use 600mb and some 6GB and I don't know how to analyze
what's causing it. 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Memory-introspection-tp24667.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From matthias at rabbitmq.com  Wed Jan 23 16:01:07 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 23 Jan 2013 16:01:07 +0000
Subject: [rabbitmq-discuss] Memory introspection
In-Reply-To: <1358956114166-24667.post@n5.nabble.com>
References: <1358956114166-24667.post@n5.nabble.com>
Message-ID: <51000943.2070601@rabbitmq.com>

On 23/01/13 15:48, carlhoerberg wrote:
> Do you have any tips on how to inspect the memory usage for a 2.8.7
> cluster?

Upgrade to 3.0.1 and use the management/rabbitmqctl's built-in memory 
reporting introduced in 3.0.0.

> Some of my nodes use 600mb and some 6GB and I don't know how to analyze
> what's causing it.

There were a few memory leaks / gc issues that got resolved in 3.0.x, so 
that's another reason to upgrade.

Matthias.

From pekowski at gmail.com  Wed Jan 23 16:43:04 2013
From: pekowski at gmail.com (Ray Pekowski)
Date: Wed, 23 Jan 2013 10:43:04 -0600
Subject: [rabbitmq-discuss] RabbitMQ scaling with OpenStack
In-Reply-To: <CAJcv3CT6NwrQX0TEL0g6iPT=amKa7Pi2xdHfTdWGZTBECghZzw@mail.gmail.com>
References: <CAJcv3CRYfYsNsVSKkdJVm2frtqkF=CjTvmX+v3u9JdEEHrDtog@mail.gmail.com>
	<CAJcv3CT6NwrQX0TEL0g6iPT=amKa7Pi2xdHfTdWGZTBECghZzw@mail.gmail.com>
Message-ID: <CAJcv3CRbrbwoEHH57jhcZ_e0kqEfDbSXFoNVfN+Zhcu_jdw7Ag@mail.gmail.com>

On Sat, Jan 19, 2013 at 11:47 PM, Ray Pekowski <pekowski at gmail.com> wrote:

> Some possible things that could make the results lower than you would
> expect are:
> 1) All machines are virtual machines, including the RabbitMQ servers.
> Virtualization typically costs around 40%.
> 2) All VMs were only assigned 2 CPUs.  The CPUs are Intel Xeon E5620 @ 2.4
> GHz.
>
> I forgot to mention some other possible reasons:

3) OpenStack RPC implementation over AMQP (RabbitMQ and Qpid) sends two
messages for each reply.  This means there are three messages sent per RPC,
one for the request and two for the reply.

The effective rate in terms of RabbitMQ message/sec for the cluster of
three RabbitMQ servers and mirroring enabled and the OpenStack patch to use
a single queue per process for the reply is 812 X 3 ~= 2400 msg/sec, which
might still be considered low but perhaps the 2 CPU VMs per RabbitMQ server
is the biggest reason for this.

4) The OpenStack RPC producers re-declare the queues and exchanges upon
which they send messages.  I say re-declare, because under normal
circumstances in the OpenStack implementation, the consumers exist before
the producers and so have already declared/created the exchanges and
queues.  I think this is done in case an RPC call is made to a service that
isn't up at the time.  I wonder that is a good practice, but I may be
missing some other reason for it.  I might play around with prototyping a
removal of the producer side re-declares.

Ray
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130123/311ccf9d/attachment.htm>

From Martin.Kafka at concur.com  Wed Jan 23 15:17:35 2013
From: Martin.Kafka at concur.com (Martin Kafka)
Date: Wed, 23 Jan 2013 07:17:35 -0800
Subject: [rabbitmq-discuss] RabbitMQ Windows Service start issue
Message-ID: <259E7C9866776E46A3032B27CBEA153B1E6553DEBE@USREDEXCH.concur.concurtech.org>

Hello,

It looks like RabbitMQ windows service is reporting to Windows as running, but it is still starting.

We have RabbitMQ service and our client service on the same Windows machine and we have problem while starting our client service. We are starting as dependent service and sometimes we can't connect to RabbitMQ server. We get exception:

None of the specified endpoints were reachable
Endpoints attempted:
------------------------------------------------
endpoint=amqp-0-9://localhost:5672, attempts=1

Best regards

Martin

________________________________
This e-mail message is authorized for use by the intended recipient only and may contain information that is privileged and confidential. If you received this message in error, please call us immediately at (425) 702-8808 and ask to speak to the message sender. Please do not copy, disseminate, or retain this message unless you are the intended recipient. In addition, to ensure the security of your data, please do not send any unencrypted credit card or personally identifiable information to this email address. Thank you.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130123/5e3ebc11/attachment.htm>

From ahives at hotmail.com  Wed Jan 23 16:48:55 2013
From: ahives at hotmail.com (ALBERT HIVES)
Date: Wed, 23 Jan 2013 16:48:55 +0000
Subject: [rabbitmq-discuss] Where to find list of all available arguments
 for creating exchanges, queues, and bindings
Message-ID: <BLU174-W1951FDDCBA43B168EA237FCF150@phx.gbl>




Hi,

 

Does anyone know where I can find a list of all of the available arguments
for declaring exchanges, queues, and bindings? All the documentation I have
found suggests that there are several arguments that can be passed to the
declare methods for creating exchanges and queues as a table of sorts but I cannot find a
definitive list of allowable arguments. It just says that the arguments
parameter is based on the server implementation. All I have been able to find
thus far is arguments x-message-ttl and x-expires. I am building an OSS project that
consumes the REST API and I would like to find this information.

 

The project can be found here: www.github.com/ahives/HareDu

 

Thanks.



Albert
 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130123/d90f0efb/attachment.htm>

From simon at rabbitmq.com  Wed Jan 23 17:52:41 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 23 Jan 2013 17:52:41 +0000
Subject: [rabbitmq-discuss] Where to find list of all available
 arguments for creating exchanges, queues, and bindings
In-Reply-To: <BLU174-W1951FDDCBA43B168EA237FCF150@phx.gbl>
References: <BLU174-W1951FDDCBA43B168EA237FCF150@phx.gbl>
Message-ID: <51002369.2000508@rabbitmq.com>

Hi. There is no list of all arguments, but there is a list of all 
extensions at http://www.rabbitmq.com/extensions.html. Not all 
extensions are expressed through arguments, but all such arguments are 
considered to be extensions.

Hope this helps.

Cheers, Simon

On 23/01/13 16:48, ALBERT HIVES wrote:
> Hi,
>
> Does anyone know where I can find a list of all of the available
> arguments for declaring exchanges, queues, and bindings? All the
> documentation I have found suggests that there are several arguments
> that can be passed to the declare methods for creating exchanges and
> queues as a table of sorts but I cannot find a definitive list of
> allowable arguments. It just says that the arguments parameter is based
> on the server implementation. All I have been able to find thus far is
> arguments x-message-ttl and x-expires. I am building an OSS project that
> consumes the REST API and I would like to find this information.
>
> The project can be found here: www.github.com/ahives/HareDu
> <http://www.github.com/ahives/HareDu>
>
> Thanks.
>
>
>
> Albert
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed Jan 23 18:00:23 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 23 Jan 2013 18:00:23 +0000
Subject: [rabbitmq-discuss] RabbitMQ Windows Service start issue
In-Reply-To: <259E7C9866776E46A3032B27CBEA153B1E6553DEBE@USREDEXCH.concur.concurtech.org>
References: <259E7C9866776E46A3032B27CBEA153B1E6553DEBE@USREDEXCH.concur.concurtech.org>
Message-ID: <51002537.8010705@rabbitmq.com>

On 23/01/13 15:17, Martin Kafka wrote:
> Hello,
>
> It looks like RabbitMQ windows service is reporting to Windows as
> running, but it is still starting.

Yes, that's correct. Unfortunately this is a hard problem to solve; 
erlsrv kicks off the RabbitMQ boot process and immediately tells Windows 
the service is started. And erlsrv doesn't give us a mechanism to 
override this :-(

> We have RabbitMQ service and our client service on the same Windows
> machine and we have problem while starting our client service. We are
> starting as dependent service and sometimes we can?t connect to RabbitMQ
> server. We get exception:
>
> None of the specified endpoints were reachable
>
> Endpoints attempted:
>
> ------------------------------------------------
>
> endpoint=amqp-0-9://localhost:5672, attempts=1

I suspect your best bet is to have your service repeatedly try to 
connect to port 5672 and delay startup until that succeeds.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From Gnana.Prakash at RelayHealth.com  Wed Jan 23 22:31:32 2013
From: Gnana.Prakash at RelayHealth.com (Prakash, Gnana)
Date: Wed, 23 Jan 2013 22:31:32 +0000
Subject: [rabbitmq-discuss] Change Cluster Node Type
Message-ID: <93A5705559C3B84E9745066CF0E6C3BE4698BAAF@DDCEP50015.na.corp.mckesson.com>

Hi,

I'm able to create a cluster with 2 nodes but the second node defaults to "ram" rather than "disc". I'm not able to change the node type. change_cluster_node_type command does not work with version 2.8.7.

Any thoughts.

Thanks
Gnana

PS C:\RabbitMQ\rabbitmq_server-2.8.7\sbin> .\rabbitmq-server.bat -detached
Activating RabbitMQ plugins ...
1 plugins activated:
* rabbitmq_auth_backend_ldap-2.8.7

node with name "rabbit" already running on "RABBITMQ2"

DIAGNOSTICS
===========

nodes in question: [rabbit at RABBITMQ2]

hosts, their running nodes and ports:
- RABBITMQ2: [{rabbit,55918},{rabbitmqprelaunch962753,55994}]

current node details:
- node name: rabbitmqprelaunch962753 at RABBITMQ2
- home dir: C:\Users\eh7kwek.TESTING-FRONT
- cookie hash: f2v782qNIYIvndlidMfADw==

PS C:\RabbitMQ\rabbitmq_server-2.8.7\sbin> .\rabbitmqctl.bat stop_app
Stopping node rabbit at RABBITMQ2 ...
...done.
PS C:\RabbitMQ\rabbitmq_server-2.8.7\sbin> .\rabbitmqctl.bat cluster rabbit at RABBITMQ1
Clustering node rabbit at RABBITMQ2 with [rabbit at RABBITMQ1] ...
...done.
PS C:\RabbitMQ\rabbitmq_server-2.8.7\sbin> .\rabbitmqctl.bat start_app
Starting node rabbit at RABBITMQ2 ...
...done.
PS C:\RabbitMQ\rabbitmq_server-2.8.7\sbin> .\rabbitmqctl.bat cluster_status
Cluster status of node rabbit at RABBITMQ2 ...
[{nodes,[{disc,[rabbit at RABBITMQ1]},{ram,[rabbit at RABBITMQ2]}]},
{running_nodes,[rabbit at RABBITMQ1,rabbit at RABBITMQ2]}]
...done.
PS C:\RabbitMQ\rabbitmq_server-2.8.7\sbin>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130123/275314d8/attachment.htm>

From matthias at rabbitmq.com  Wed Jan 23 23:03:12 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 23 Jan 2013 23:03:12 +0000
Subject: [rabbitmq-discuss] Change Cluster Node Type
In-Reply-To: <93A5705559C3B84E9745066CF0E6C3BE4698BAAF@DDCEP50015.na.corp.mckesson.com>
References: <93A5705559C3B84E9745066CF0E6C3BE4698BAAF@DDCEP50015.na.corp.mckesson.com>
Message-ID: <51006C30.5020001@rabbitmq.com>

Gnana,

On 23/01/13 22:31, Prakash, Gnana wrote:
> I?m able to create a cluster with 2 nodes but the second node defaults
> to ?ram? rather than ?disc?. I?m not able to change the node type.
> *change_cluster_node_type* command does not work with version 2.8.7.

You should upgrade. Clustering in 3.0.x is much improved and easier to 
understand.

Failing that, read the documentation for 2.8.x at 
http://previous.rabbitmq.com. In particular...

> >*.\rabbitmqctl.bat cluster rabbit at RABBITMQ1
> Clustering node rabbit at RABBITMQ2 with [rabbit at RABBITMQ1] ...
> ...done.

 From the documentation of 'rabbitmqctl cluster' at 
http://previous.rabbitmq.com/man/rabbitmqctl.1.man.html
<quote>
If the current node is to become a disk node it needs to appear in the 
cluster node list. Otherwise it becomes a ram node.
</quote>

Yes, this is somewhat less than obvious. Which is one reason why we 
switched to the new 'join_cluster' command in 3.0.0.


Regards,

Matthias.

From schokkal at cisco.com  Wed Jan 23 23:06:43 2013
From: schokkal at cisco.com (Sudhakar Chokkalingam (schokkal))
Date: Wed, 23 Jan 2013 23:06:43 +0000
Subject: [rabbitmq-discuss] Message routing
In-Reply-To: <50F5351B.7020403@rabbitmq.com>
Message-ID: <AC1CECBE58B36646AE85DD6BEB7AFFF110C569@xmb-aln-x14.cisco.com>

Simon,
Thanks for asking. Sorry for the late response. Yes Michael suggestion
helped here. The reason why we
like to distribute at queue level is,
1. As Michael, we will have multiple cores in our server where having
multiple queues will improve the performance.
2. And then, in our application we have a need to do different kind of
processing based on the message types we receive. Initially, we thought
will have multiple queues irrespective of message type and post the
message in a round robing method and then consume it for processing. In
the processing will do the deduction of message type and apply the right
processor. This was the reason why I asked for doing the round robin
distribution at queue level.

But now, we are thinking of different approach where we can avoid the
message type deduction at all, by having dedicated queue for each type and
have a dedicated consumer to process it. By this approach we think that
the elimination of message type deduction will not add bottle neck in the
processing. In this approach, if we see any bottle neck of having one
queue for one type of messages, then we may make re-think of having a
multiple queues for each type and consumers. Or May be multiple consumers
with one queue can also reduce the over load on the queue. Here the object
is the system shoe not drop any messages.

Hope this helps.
Thanks again for asking.
Sudhakar

Note:
In our application the message types are
1 E-mail 
2. SNMP Trap
3. JMS message etc 


On 1/15/13 4:53 AM, "Simon MacMullen" <simon at rabbitmq.com> wrote:

>On 14/01/13 16:36, Sudhakar Chokkalingam (schokkal) wrote:
>> Could please help me, how we can do this round-robin distribution in
>> queue level.
>
>Michael has already pointed out the existence of the consistent hash
>exchange. But there's another question: what are you trying to achieve?
>Why is having one queue and many consumers not an option? - it sounds
>like it's what you want...
>
>Cheers, Simon
>
>-- 
>Simon MacMullen
>RabbitMQ, VMware


From alex.damian at gmail.com  Thu Jan 24 05:56:23 2013
From: alex.damian at gmail.com (Alex Damian)
Date: Wed, 23 Jan 2013 21:56:23 -0800 (PST)
Subject: [rabbitmq-discuss] Cannot access rabbitmqadmin.
In-Reply-To: <5753af5f-6c71-42db-91db-58279c63d685@googlegroups.com>
References: <5753af5f-6c71-42db-91db-58279c63d685@googlegroups.com>
Message-ID: <0790b109-e918-4261-924e-129cd7978e99@googlegroups.com>

I finally got it working. Restarting and stopping the server with 
rabbitmqctl did not work. So I rebooted then restarted directly with the 
rabbitmq-server start command and this time it seemed to load all the 
plugins including Mochiweb and I was able to open the admin webpage. I'm 
not sure why it did not work immediately after the plugins were 
enabled...however I'm happy with this solution albeit not ideal since it 
required a reboot. 

On Tuesday, January 22, 2013 5:23:24 PM UTC-5, Alex Damian wrote:
>
> Hi
>
> I have followed all the instructions on 
> http://www.rabbitmq.com/management.html and enabled the plugin, but after 
> than there is no webserver running anywhere on my machine. There is no way 
> to connect to Mochiweb at all. I have restarted the service and still 
> nothing. I have also tried the "http://*server-name*:15672/" URL with 
> "localhost", 127.0.0.1 and also the full server name, all of which are 
> /etc/hosts file. My vhost is the default "/". Should I add something in my 
> config file perhaps? I have also tried a *curl* command and still nothing.
>
> I am running on Fedora Core 17 with all latest libs including latest 
> rabbitMQ sw. I have checked the listening ports on the server and i only 
> see the AMQP one. 
> Also I can run rabbitmq-server and rabbitmqctl without issues. I have also 
> been able to create exchanges/queues via rabbit.js on Node. However not 
> having a proper admin tool is a bit drawback. I wonder why it's not 
> possible to supply one like (or enhance) rabbitmqctl. Seems to do the job 
> just fine. 
>
> Any help would be greatly appreciated!
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130123/e817fb63/attachment.htm>

From simon at rabbitmq.com  Thu Jan 24 13:26:20 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 24 Jan 2013 13:26:20 +0000
Subject: [rabbitmq-discuss] Cannot access rabbitmqadmin.
In-Reply-To: <0790b109-e918-4261-924e-129cd7978e99@googlegroups.com>
References: <5753af5f-6c71-42db-91db-58279c63d685@googlegroups.com>
	<0790b109-e918-4261-924e-129cd7978e99@googlegroups.com>
Message-ID: <5101367C.6000005@rabbitmq.com>

Ah - so you were using "rabbitmqctl stop_app" and "rabbitmqctl 
start_app" - yes that would not work since they never halt the Erlang 
VM. "service rabbitmq-server restart" would have worked without a reboot.

I guess we should try to make that clearer.

Cheers, Simon

On 24/01/13 05:56, Alex Damian wrote:
> I finally got it working. Restarting and stopping the server with
> rabbitmqctl did not work. So I rebooted then restarted directly with the
> rabbitmq-server start command and this time it seemed to load all the
> plugins including Mochiweb and I was able to open the admin webpage. I'm
> not sure why it did not work immediately after the plugins were
> enabled...however I'm happy with this solution albeit not ideal since it
> required a reboot.
>
> On Tuesday, January 22, 2013 5:23:24 PM UTC-5, Alex Damian wrote:
>
>     Hi
>
>     I have followed all the instructions on
>     http://www.rabbitmq.com/management.html
>     <http://www.rabbitmq.com/management.html> and enabled the plugin,
>     but after than there is no webserver running anywhere on my machine.
>     There is no way to connect to Mochiweb at all. I have restarted the
>     service and still nothing. I have also tried the
>     "http:///server-name/:15672/" URL with "localhost", 127.0.0.1 and
>     also the full server name, all of which are /etc/hosts file. My
>     vhost is the default "/". Should I add something in my config file
>     perhaps? I have also tried a /curl/ command and still nothing.
>
>     I am running on Fedora Core 17 with all latest libs including latest
>     rabbitMQ sw. I have checked the listening ports on the server and i
>     only see the AMQP one.
>     Also I can run rabbitmq-server and rabbitmqctl without issues. I
>     have also been able to create exchanges/queues via rabbit.js on
>     Node. However not having a proper admin tool is a bit drawback. I
>     wonder why it's not possible to supply one like (or enhance)
>     rabbitmqctl. Seems to do the job just fine.
>
>     Any help would be greatly appreciated!
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From tim at rabbitmq.com  Thu Jan 24 16:36:13 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 24 Jan 2013 16:36:13 +0000
Subject: [rabbitmq-discuss] Cluster nodes stop/start order can lead to
 failures
In-Reply-To: <1358619985694-24586.post@n5.nabble.com>
References: <4e96ad11-4d71-4858-8faa-9323e5a6b8e2@googlegroups.com>
	<8ad1ab95-fa5c-4fda-b8f3-b096664147e9@googlegroups.com>
	<9c2c6423-65f7-4a18-82d7-edbfc6b17272@googlegroups.com>
	<87k3vn8qo0.wl%francesco@rabbitmq.com>
	<1358619985694-24586.post@n5.nabble.com>
Message-ID: <510162FD.6070601@rabbitmq.com>

Hi jb

On 01/19/2013 06:26 PM, jbdupont wrote:
> Ok, I understand the reasoning behind this behaviour.
> However, how can I unlock the situation of the node that I cannot restart at
> the moment?
>
> My app is such that node2 is the normal, node1 is used as backup is node2
> fails.
> When I restart I may be in a situation where node2 is started first and then
> node1 - at present I fall into a lock situation.

Surely which node starts first is under your control? Also it is the 
order in which the nodes were shut down that matters when it comes to 
starting them.

> Is there a way to start afresh node2 without being stuck in the current
> situation?
> For instance restarting out of the cluster, and then joining the cluster
> again ?

The only way to do that - for a node which *was* a member previously - 
is to remove / move the mnesia database directory and restart as a 
virgin node. If you don't mind the data loss. You can start a third 
virgin node and have it join any time you like. Also I'm not really sure 
how this is meant to help you?

> That would suit my needs actually.
>
> Othewise, I would need to design a different architecture without cluster...
> This may be the way I will have to go.
>
> Thanks to point me into the right direction on this.
> Regards,
> jb
>
>
>
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/Cluster-nodes-stop-start-order-can-lead-to-failures-tp21965p24586.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From matthias at rabbitmq.com  Thu Jan 24 21:38:09 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 24 Jan 2013 21:38:09 +0000
Subject: [rabbitmq-discuss] RabbitMQ scaling with OpenStack
In-Reply-To: <CAJcv3CRbrbwoEHH57jhcZ_e0kqEfDbSXFoNVfN+Zhcu_jdw7Ag@mail.gmail.com>
References: <CAJcv3CRYfYsNsVSKkdJVm2frtqkF=CjTvmX+v3u9JdEEHrDtog@mail.gmail.com>
	<CAJcv3CT6NwrQX0TEL0g6iPT=amKa7Pi2xdHfTdWGZTBECghZzw@mail.gmail.com>
	<CAJcv3CRbrbwoEHH57jhcZ_e0kqEfDbSXFoNVfN+Zhcu_jdw7Ag@mail.gmail.com>
Message-ID: <5101A9C1.6090000@rabbitmq.com>

Ray,

On 23/01/13 16:43, Ray Pekowski wrote:
> 4) The OpenStack RPC producers re-declare the queues and exchanges upon
> which they send messages.  I say re-declare, because under normal
> circumstances in the OpenStack implementation, the consumers exist
> before the producers and so have already declared/created the exchanges
> and queues.  I think this is done in case an RPC call is made to a
> service that isn't up at the time.  I wonder that is a good practice,
> but I may be missing some other reason for it.  I might play around with
> prototyping a removal of the producer side re-declares.

{queue,exchange}.declare when the resource already exists are quite 
cheap. However, the latency of the associated network roundtrip can 
badly affect performance. Unless you set the nowait flags, thus 
suppressing the response and making the commands asynchronous. Even then 
though these are not commands you'd want to send for every message.

Regards,

Matthias.

From jerryk at rbcon.com  Fri Jan 25 02:48:43 2013
From: jerryk at rbcon.com (Jerry Kuch)
Date: Thu, 24 Jan 2013 18:48:43 -0800 (PST)
Subject: [rabbitmq-discuss] Implementing User Messaging Using RabbitMQ
In-Reply-To: <CAHEpgBDUKZnM95zRcqEShd_BDmA=AmoUh+CGR6OUz_baCuVdHQ@mail.gmail.com>
References: <CAHEpgBDUKZnM95zRcqEShd_BDmA=AmoUh+CGR6OUz_baCuVdHQ@mail.gmail.com>
Message-ID: <1359082123352-24681.post@n5.nabble.com>

Hi, Chris...

Answers inline.  Apologies for such a slow response to your question.
It was information dense enough that finding time to respond carefully
took a little while.

> High-Level Requirements
> =======================
> - users can send messages to another user, several users, a group, or
> everyone
>   - users and groups are managed in a proprietary user management system
> - no chat rooms-- each user just has a message feed or "timeline" of
>   incoming & outgoing messages
> - message history must be preserved (in a database)

A natural way to do this would be to, somewhere early in your routing,
shunt every message being published through an initial filtering
exchange.  One binding would carry it off to a queue from which a
worker/consumer would pull the messages as work items, and update
whatever your back-end data store is.  Another binding could carry
your messages onward to another exchange, whose type and binding keys
would be chosen to give you whatever routing you want for messages for
their 'real' (i.e. not just for persistence) handling.

> - if a user is offline, the message should be forwarded to the
> user's email

Depending on how you decide to represent the notion of
online/offline-ness in your app there are a number of ways you might
do this.  One idea would be to use 'alternate exchanges' as described
here:

http://www.rabbitmq.com/ae.html

In brief, when you configure an AE for an exchange, then any message
that the latter exchange can't route to a queue will be published to
the specified AE instead.  If your user's queues are created on
demand, and set to auto-delete so that they go away when users
disconnected, and that's a sufficiently strong notion of
"on-line-ness" for you, this allows messages for which there's no
recipient to be sent off somewhere else.  You can then put them in
another work queue, that a consumer process in your system can pull
out and convert into emails.

> - 5000 concurrent users sending a few messages every few minutes
> (20,000 users total in system).

If there's one user per queue, 5000 queues isn't really a terrifying
number, since the processes that represent queues are fairly
lightweight.  Performance will be affected by such factors as whether
the queues are durable, whether persistence is requested for messages, etc.

> In order to store every message in a database (for historical
> purposes), all messages are initially sent to a direct exchange with a
> worker queue.  Consumers of the worker queue (let's call them
> messaging service workers) receive the message and store it to the
> database.  Then they distribute the message to the intended recipients
> (this is the part I think I need most help with).

Sounds reasonable so far, and well aligned with what I said near the
start of this post.

Now to look at the options you outline, and try to add some hopefully
useful remarks...

> Message Distribution Option 1: Direct Exchange w/ Queue Per User
> =================================================================
> Message is sent to a direct exchange with username as the routing key.
> For every logged in user, the webapp declares a queue and binds with
> the username.

Entirely reasonable way to represent logged-in-ness and get the right
messages to the right places.

> Issue 1: How to support groups?  The messaging service worker could
> resolve the group to a list of users and post the message multiple
> times (once for each user/routing key)-- but this would not scale very
> well.

And indeed, you may be able to use AMQP mechanisms to implement this
within your message fabric.  For example, some entity in your system,
with suitable permissions could create a fanout exchange per group, bind it
to the queues corresponding to the user's in the group, and then
messages published to the group would be broadcast to all members.
Alas, if the sender was one of those user's he'd also hear his own
message.  An advantage of this is that resource usage will be more
modest as internally the broker can de-duplicate the representations
of all of the 'copies' of the message sent group-wide.

If a group member receiving his own messages is something you can't
tolerate in the client side code handling that group member, you could
imagine using one of the other exchange types, along with some routing
key chicanery to be more selective.  See if the previous paragraph's
idea agrees with you, and if you find it lacking, we can chip away at
it a bit more.

> Or we could create individual queues for every group too, but
> this increases complexity in the web app (and later in our other
> clients) since they need to determine what groups they need to listen
> for and who to distribute to.

This is another option.  If the idea of fanout-exchange-per-group
isn't agreeable, you could consider this, although the former is
probably simpler.

> Issue 2: Is 5000 queues a bit much?  Especially when they are all
> ultimately going to the same consumer (in the webapp case)?  This
> isn't the only use of RabbitMQ, so there will be other
> queues/exchanges/bindings as well...

Probably not.

> Message Distribution Option 2: Topic Exchange w/ Single Queue per Webapp
> ========================================================================
>
> Message is sent to topic exchange with routing key containing ALL
> addressed users (i.e., "|usera|userb|userc|").  Webapp declares single
> queue and a separate binding to the exchange for each user (i.e.,
> "#|usera|#", "#|userb|#", etc.).  This is similar to Option 1, but
> with the benefit that each message only has to be sent once.

Right, and this is along the lines of the alternate solution I hinted
at above.

> Issue 1: Routing key can get huge (20000 names if addressed to "everyone"
> group).
> Issue 2: It just seems like the wrong use of topic exchange.

I'd worry mainly that this could get very awkward to manage and push a
lot of complexity into your application, although it's not an a priori
insane use of the topic exchange conceptually, given that topic
exchanges are intended to route messages based on pattern matches
against the routing keys stamped on them.  I may not be following your
description but you may find the actual matching behavior isn't quite
what you want in what you're describing.

> Message Distribution Option 3: Fanout Exchange w/ Single Queue per Webapp
> =========================================================================
>
> Message is sent to fanout exchange.  Webapp listens on fanout exchange
> and simply discards all messages for users that aren't logged in.

Actually if a not-logged-in user, has no queue that he owns bound to
that exchange, your web app doesn't even have to do that much.  The
unroutable messages will be quietly dropped.

> Issue 1: Doesn't scale well (or even if it does, there is lots of
> waste filtering on the client side).

I'd worry more about the waste filtering.  The amount of message
duplication you'd think that this scenario requires doesn't really
happen, as Rabbit's internals aren't totally naive about how to handle
such a case.

> Issue 2: Not at all secure (although, for now, we won't try to solve
> security).

I was actually going to ask about that... You may want to carefully
consult the table in:

http://www.rabbitmq.com/access-control.html

which states which of the AMQP commands require which permissions.
Also, keep in mind that rather than there being ACLs, which list who
can do things to a given broker resource, Rabbit works the other way.
A user gets a regex-ish list of resource *names* to which he has each
of the three permissions.  Different AMQP commands require different
privileges on different resources, e.g. to bind a queue means you must
be able to write the queue and read the exchange.

This model works fine for most enterprise uses of Rabbit and leads to
reasonable user management.  It can break down in the fringes though
if you have lots of ephemeral users, or users with sort of dubious
trust relationships between them, or users that can vouch for other
entities, etc.  In cases such as that, one might solve one's problem
by writing custom authorization backends, although the decision is
best not taken too lightly.

> Message Distribution Option 4: Direct Exchange w/ Single Queue per Webapp
> ========================================================================
> Webapp must notify messaging service worker as users log in and out--
> and of the single queue on which it wants messages.  When a message
> needs to be distributed, messaging service worker checks to see which
> users are logged in where.  It sends message to the queue of each
> webapp that has logged in users that the message is addressed to
> (message itself contains "to:" list so webapp can send to right user
> UI).
>
> Issue 1: Messaging Service Worker now has a lot more state and
> processing messages is a lot heavier.  Need to make sure it stays in
> synch with webapp.

Agreed.  It's also not totally clear to me from what you've said that
you really need to do this, and, as you point out, it's going to be
non-trivial to implement and get right.

> Issue 2: Messaging Service Worker is now doing the routing-- which
> just seems wrong since that is what RabbitMQ is so good at!

Absolutely true.  Which probably leads us to favor the proposals
enumerated earlier. :-)

> Message Distribution Option 5: Fanout Exchanges for Groups
> ==========================================================
> Same as option 1 (queue per user), but also create a fanout exchange
> for every group.  The individual user queues need to be bound to the
> fanout exchange corresponding to each group they belong to.
>
> Issue 1: Could result in a lot of exchanges (not sure how many
> groups there are).

Worry not here: Exchanges are cheap in their implementation.  Unlike
queues, each of which has a live, resource-consuming Erlang process
babysitting it, an exchange is essentially just metadata inside
Rabbit's internal database which defines the exchange's configuration.
The actual work of routing and decision making that happens "in" an
exchange is really done on the channel process associated with the
publisher who's pushing stuff into the exchange.

> Issue 2: Still seems like a lot of queues too (5000).

But that's not that frightening a number probably.  An Erlang VM on
well provisioned hardware can accomodate many Erlang processes, which
are sort of lightweight 'green threads' that get distributed across a
pool of real OS threads when they're scheduled.

> Message Distribution Option 6: Custom Exchange
> ==============================================
> Create our own exchange that allows consumers to bind with usernames.
> When a message is posted to the exchange, it knows how to read the
> "to:" list from it, can even resolve groups, and then sends to the
> correct queues based on the bindings.
>
> Issue 1: We don't have any Erlang experience.
>
> Issue 2: Resolving groups in an Erlang custom exchange could be tricky
> (not sure about the APIs to our User Management).

If your needs really do turn out to be too exotic for the stuff we
talked about earlier you could consider this, although it is work.
There are nice examples of how to write a custom exchange in the
Manning book "RabbitMQ in Action" and we can likely point you at some
other examples like the 'presence exchange' and others on GitHub.

One would of course have to get a bit comfortable in Erlang to do so.

> Whatever the correct approach is, how do we determine if a user is
> "offline" and we need to forward the message to their email?  If we
> are using queue-per-user, then we can set the mandatory flag, I guess?
> If we are using another approach, what then?

Start by taking a peek at the documentation I point to above and see
if you can get what you want out of the alternate exchange mechanism.
It seems quite plausible to me that it will get you all or most of the
way there.  The mandatory flag will also catch you if there's no queue
into which your message can be routed, but in the case of a fanout
exchange, the presence of any queue will keep it from doing anything.
Also, your publisher then has to be somewhat aware of what's going on
and the mandatory-flagged publish fails.  You might find bouncing
stuff to an alternate exchange, where some consumer/worker transforms
those messages into emails gets tricky, case-wise work out of your
publisher and into a consumer that pretty much only does one, simple thing.

> Thanks to anyone who can help point me in the right direction (or
> steer me away from the wrong direction)...  I'm not familiar enough
> yet with RabbitMQ performance characteristics to know what is a bad
> idea, and not familiar enough yet with its many features to know what
> is a good idea... ;-)

It sounds like you're off to a good start.  You're already turning
over an entirely reasonable set of stones looking for pragmatic ways
to map your needs on to how Rabbit and AMQP works.

Take some time to digest the commentary above, and please return to
the list as your thinking evolves, other questions spring to mind,
etc.

Best regards,
Jerry




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Implementing-User-Messaging-Using-RabbitMQ-tp24479p24681.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From matthias at rabbitmq.com  Fri Jan 25 05:54:54 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 25 Jan 2013 05:54:54 +0000
Subject: [rabbitmq-discuss] Implementing User Messaging Using RabbitMQ
In-Reply-To: <1359082123352-24681.post@n5.nabble.com>
References: <CAHEpgBDUKZnM95zRcqEShd_BDmA=AmoUh+CGR6OUz_baCuVdHQ@mail.gmail.com>
	<1359082123352-24681.post@n5.nabble.com>
Message-ID: <51021E2E.1010009@rabbitmq.com>

On 25/01/13 02:48, Jerry Kuch wrote:
>> Issue 1: How to support groups?  The messaging service worker could
>> resolve the group to a list of users and post the message multiple
>> times (once for each user/routing key)-- but this would not scale very
>> well.
> [discussion of various options]

One option that wasn't mentioned is to use 
http://www.rabbitmq.com/sender-selected.html, i.e. send a single message 
with all group members as recipients.

That's the escape hatch if, for whatever reason, group membership cannot 
be represented directly in the routing topology.

Matthias.

From pekowski at gmail.com  Fri Jan 25 06:36:28 2013
From: pekowski at gmail.com (Ray Pekowski)
Date: Fri, 25 Jan 2013 00:36:28 -0600
Subject: [rabbitmq-discuss] RabbitMQ scaling with OpenStack
In-Reply-To: <5101A9C1.6090000@rabbitmq.com>
References: <CAJcv3CRYfYsNsVSKkdJVm2frtqkF=CjTvmX+v3u9JdEEHrDtog@mail.gmail.com>
	<CAJcv3CT6NwrQX0TEL0g6iPT=amKa7Pi2xdHfTdWGZTBECghZzw@mail.gmail.com>
	<CAJcv3CRbrbwoEHH57jhcZ_e0kqEfDbSXFoNVfN+Zhcu_jdw7Ag@mail.gmail.com>
	<5101A9C1.6090000@rabbitmq.com>
Message-ID: <CAJcv3CRXKt3v6KdtoB8z3jSj4NK5DfRSkySohcQ77ZLNXcHFQw@mail.gmail.com>

On Thu, Jan 24, 2013 at 3:38 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> {queue,exchange}.declare when the resource already exists are quite cheap.
> However, the latency of the associated network roundtrip can badly affect
> performance. Unless you set the nowait flags, thus suppressing the response
> and making the commands asynchronous. Even then though these are not
> commands you'd want to send for every message.
>

Matthias, thanks, that is good to know.  Latency isn't the issue in my
study.  I drove the RabbitMQ servers in a cluster of up to 3 to 100% CPU
and throughput was my main metric.  It would be interesting to profile the
RabbitMQ server to see where it is spending most of it's time.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130125/09568799/attachment.htm>

From stuff at moesel.net  Fri Jan 25 12:51:23 2013
From: stuff at moesel.net (Chris)
Date: Fri, 25 Jan 2013 07:51:23 -0500
Subject: [rabbitmq-discuss] Implementing User Messaging Using RabbitMQ
In-Reply-To: <51021E2E.1010009@rabbitmq.com>
References: <CAHEpgBDUKZnM95zRcqEShd_BDmA=AmoUh+CGR6OUz_baCuVdHQ@mail.gmail.com>
	<1359082123352-24681.post@n5.nabble.com>
	<51021E2E.1010009@rabbitmq.com>
Message-ID: <CAHEpgBBTXjz5ToxVSPu5-Lyjt4V4Wi01kkNr_oiDvJSYTm+aqw@mail.gmail.com>

Wow.  I had given up on receiving an answer.  But... it was worth the wait,
for sure! ;-)

Thanks for the very thorough response, Jerry.  It's extremely helpful as we
move forward on this.  I'll definitely take some time to digest your
thoughts and suggestions...  There's some real good stuff in there!

Once again, thanks so much!
Chris


On Fri, Jan 25, 2013 at 12:54 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> On 25/01/13 02:48, Jerry Kuch wrote:
>
>> Issue 1: How to support groups?  The messaging service worker could
>>> resolve the group to a list of users and post the message multiple
>>> times (once for each user/routing key)-- but this would not scale very
>>> well.
>>>
>> [discussion of various options]
>>
>
> One option that wasn't mentioned is to use http://www.rabbitmq.com/**
> sender-selected.html <http://www.rabbitmq.com/sender-selected.html>, i.e.
> send a single message with all group members as recipients.
>
> That's the escape hatch if, for whatever reason, group membership cannot
> be represented directly in the routing topology.
>
> Matthias.
>
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130125/eff35341/attachment.htm>

From fred at dushin.net  Fri Jan 25 13:38:22 2013
From: fred at dushin.net (Dushin Fred)
Date: Fri, 25 Jan 2013 08:38:22 -0500
Subject: [rabbitmq-discuss] configure shovel for message throttling
In-Reply-To: <50FF2549.8060903@rabbitmq.com>
References: <f90f16a3-f729-4aa2-93fa-f43c56ab1ab0@googlegroups.com>
	<50FEEEDE.2070700@rabbitmq.com>
	<!&!AAAAAAAAAAAYAAAAAAAAAOosgHnoPqdNlUO2DUrQ/DfCgAAAEAAAACWyEasZpNRMgQV85uhFCl8BAAAAAA==@manfbraun.de>
	<50FF22B1.1070406@rabbitmq.com>
	<!&!AAAAAAAAAAAYAAAAAAAAAOosgHnoPqdNlUO2DUrQ/DfCgAAAEAAAAJSi4XOvF8xDuplN+zvpI0YBAAAAAA==@manfbraun.de>
	<50FF2549.8060903@rabbitmq.com>
Message-ID: <0DCF5051-4134-4FD4-8744-6E1B1FF687AB@dushin.net>

As a workaround, you can restart the rabbitmq_shovel OTP application with a new shovels environment, along the lines of something like:

rabbitmqctl eval 'application:stop(rabbitmq_shovel), {ok, [[{rabbit, _}|[{rabbitmq_mochiweb, _}|[{rabbitmq_shovel, [{shovels, Shovels}]}]]]]} = file:consult(".../rabbitmq.config"), application:set_env(rabbitmq_shovel, shovels, Shovels), application:start(rabbitmq_shovel).'

Note that in my case I have complete control over the structure of the rabbitmq.config file, so this solution is not general purpose, but it does work in my limited scenario, and I am sure with a little more creative Erlang you could make the binding to Shovels a bit more resilient...

But the above does not require a restart of the entire broker, or more specifically of the rabbit OTP application.

-Fred

On Jan 22, 2013, at 6:48 PM, Matthias Radestock <matthias at rabbitmq.com> wrote:

> On 22/01/13 23:41, mabra at manfbraun.de wrote:
>> So I have probably to stay at my start/stop [which is, naturally, not
>> a good pattern ...]. If one adds a new queue, which shovels messages
>> to the next broker [the same, like other, existing queues], one has
>> to adapt these values and start/stop rabbit :-(
> 
> As Simon said yesterday, we do intend to make shovel configuration more dynamic. eventually.
> 
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From fred at dushin.net  Fri Jan 25 13:44:38 2013
From: fred at dushin.net (Dushin Fred)
Date: Fri, 25 Jan 2013 08:44:38 -0500
Subject: [rabbitmq-discuss] Upgrade of RabbitMq version
In-Reply-To: <50FFADE4.9030601@rabbitmq.com>
References: <BF667F8975AEED429CF51D41871462546145D634@MBX35.exg5.exghost.com>
	<50FFADE4.9030601@rabbitmq.com>
Message-ID: <A016100E-19EB-4E84-9EFD-9AB8964438DE@dushin.net>


Just a quick follow-up question, more of a curiosity, than anything else.

Does Rabbit support in-place upgrades, without requiring a reboot of the service?  I realize than enabling or disabling a plugin requires a reboot (unfortunately, but I am sure there are serious technical issues for this).  But as an Erlang/OTP advocate in my org, I am curious whether we can get service continuity through an upgrade in Rabbit?

(Not a high priority question, and yes, I should try it myself before even asking)

-Fred

On Jan 23, 2013, at 4:31 AM, Tim Watson <tim at rabbitmq.com> wrote:

> Hi Naveen,
> 
> Instructions for upgrading are available in the release notes.
> 
> "To upgrade a non-clustered RabbitMQ from release 2.1.1 or later, simply install the new version. All configuration and persistent message data is retained."
> 
> Kind regards,
> Tim
> 
> On 01/23/2013 05:30 AM, Naveen Kadiyala wrote:
>> 
>> Hi All,
>>  
>> Please let me know how to Upgrade  RabbitMq version from 2.2 to 2.6 and above.
>>  
>> [root at XXXX]# sudo rabbitmqctl status
>> Status of node 'rabbit at domU-XXXX ...
>> [{running_applications,[{rabbit,"RabbitMQ","2.2.0"},
>>  
>>  
>> Thanks for your time.
>>  
>> Regards,
>> Naveen Kumar K
>>  
>>  
>>  
>> 
>> 
>> This mail and/or attachments are confidential and may also be legally privileged. If you are not the intended recipient, any disclosure, copying, distribution or action taken relying on the contents is strictly prohibited and may be unlawful. If you have received this communication in error, please notify the sender immediately by responding to this email and deleting the contents of the email & related attachments from your system. Though Kony has taken reasonable steps to ensure no viruses are present in this email, it cannot accept responsibility for any loss or damage arising from the use of this email or attachments. No contracts may be concluded with Kony through email communication.Please consider the environment before printing this mail. 
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130125/2226a556/attachment.htm>

From watson.timothy at gmail.com  Fri Jan 25 13:50:51 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Fri, 25 Jan 2013 13:50:51 +0000
Subject: [rabbitmq-discuss] Upgrade of RabbitMq version
In-Reply-To: <A016100E-19EB-4E84-9EFD-9AB8964438DE@dushin.net>
References: <BF667F8975AEED429CF51D41871462546145D634@MBX35.exg5.exghost.com>
	<50FFADE4.9030601@rabbitmq.com>
	<A016100E-19EB-4E84-9EFD-9AB8964438DE@dushin.net>
Message-ID: <C8BB734B-ED8F-430D-ADC1-DFE2AF9D046F@rabbitmq.com>

Fred

On 25 Jan 2013, at 13:44, Dushin Fred <fred at dushin.net> wrote:

> Just a quick follow-up question, more of a curiosity, than anything else.
> 
> Does Rabbit support in-place upgrades, without requiring a reboot of the service?  

No it does not, as doing so introduces a very large burden of maintenance work for each change.

> I realize than enabling or disabling a plugin requires a reboot (unfortunately, but I am sure there are serious technical issues for this).

Actually we're almost in a position to do  runtime plugin enable/disable now, since we no longer use boot scripts to activate the plugin applications. There is a bit more work to do though, and there is an open ticket to address the gap.

>  But as an Erlang/OTP advocate in my org, I am curious whether we can get service continuity through an upgrade in Rabbit?
> 

Erlang makes this possible, but there's still a lot of work involved and it is an ongoing maintenance overhead rather than just a one off task. I don't know of any plans to support rolling upgrades in future.

From fred at dushin.net  Fri Jan 25 14:21:49 2013
From: fred at dushin.net (Dushin Fred)
Date: Fri, 25 Jan 2013 09:21:49 -0500
Subject: [rabbitmq-discuss] Securing Messages Over WAN Link
In-Reply-To: <50F67FCD.6070009@rabbitmq.com>
References: <22a5201a-39b3-4ce2-8c36-dd82309349c3@googlegroups.com>
	<50F67FCD.6070009@rabbitmq.com>
Message-ID: <F7E3EFC5-166F-4112-87EB-9D2146A8AFB7@dushin.net>


On Jan 16, 2013, at 5:24 AM, Emile Joubert <emile at rabbitmq.com> wrote:

> SSL will not protect the data written to disk by the broker, or messages
> held in RAM in the broker. Message producers should encrypt the message
> payloads if that's what you need.

I would add that if you care about data integrity, then you will also want to include both a cryptographic hash, as well as some sort of sequencing information in the payload, so that consumers can detect attacks that may have, for example, removed or re-ordered messages.  If you're even more paranoid, you could also roll keys, so that compromise of a key at one point will not compromise the secrecy/integrity of previous messages, but that is obviously more complicated (== more expensive to implement).

-Fred

From dseltzer at tveyes.com  Fri Jan 25 14:28:38 2013
From: dseltzer at tveyes.com (Dave Seltzer)
Date: Fri, 25 Jan 2013 09:28:38 -0500
Subject: [rabbitmq-discuss] Server-Side Limit for a Channel's
 Unacknowledged Messages
In-Reply-To: <CAHW0W4P6PC5uky4PbwKB3HQiMG5y0byKZz-LAsP3JHFAkBCPaA@mail.gmail.com>
References: <CAHW0W4PZHvZF_OvcoP0Jc_0_ktOJcyLua6fdrT7MivhBm+oNVQ@mail.gmail.com>
	<50F17459.1000007@rabbitmq.com>
	<CAHW0W4P6PC5uky4PbwKB3HQiMG5y0byKZz-LAsP3JHFAkBCPaA@mail.gmail.com>
Message-ID: <CAHW0W4O1VBdtdjrU0WX_Lwk7fYYZ-7Ek8et6fFQ+D2XrYp2SVQ@mail.gmail.com>

I just wanted to follow up on this question.

This morning I came in to find this situation:
[image: Inline image 1]

A partner who seems to be having issues has caused 2.3M messages to be
waiting for ACKs.

I'm quite sure that many of these messages should have expired, but are not
being deleted because they're waiting ACK. (I'm running RabbitMQ 3.0.1)

1) How should a message behave if it's TTL has expired and it's waiting for
ACK?
2) Is there really not that much interest setting a per-channel prefetch
queue limit?

Thanks so much!

-Dave






On Sat, Jan 12, 2013 at 3:28 PM, Dave Seltzer <dseltzer at tveyes.com> wrote:

> If you're asking me, then I think the answer might be the ability to set a
> limit on the number of un-acked messages per channel, and then the ability
> to limit the number of channels per user/vhost.
>
> Perhaps the new Policy framework in RabbitMQ 3.0+ would provide an
> interesting way to configure this behavior.
>
> I think that part of the problem is that most of the examples in the
> ClientAPI documentation don't touch on this issue, so a naive user, who
> copies and pastes an example, might find themselves with an enormous
> pre-fetch queue and never even know it. But, even if my users were more
> conscientious about setting this variable, I think there's still a
> compelling argument to be made that a broker-administrator should be able
> to limit it.
>
> Thanks for taking the time to explain the complexity!
>
> -D
>
>
> On Sat, Jan 12, 2013 at 9:34 AM, Matthias Radestock <matthias at rabbitmq.com
> > wrote:
>
>> Dave,
>>
>> On 10/01/13 13:54, Dave Seltzer wrote:
>>
>>> I was wondering if there's a way to set a policy on the broker that
>>> would effectively limit the size of the pre-fetch queue for clients?
>>>
>>
>> It is not uncommon for for novice users (and some clients) to forget to
>> ack messages, or accidentally buffer vast quantities of messages in the
>> client.
>>
>> We did consider setting basic.qos{prefetch_count=1} as a default, i.e.
>> all channels would be limited like that unless the app issues a basic.qos
>> of its own.
>>
>> Unfortunately that a) could break existing apps, and b) significantly
>> reduces throughput.
>>
>> As you say, one option would be to make this server configurable. Since
>> we try to keep the number of config settings small, this is really a last
>> resort. Still, it might be worth exploring...
>>
>> At what granularity should a prefetch count be configurable?
>>
>> a) server
>> b) user
>> c) vhost
>> d) user & vhost
>> e) peer ip
>> f) ...
>>
>>
>> Regards,
>>
>> Matthias
>>
>
>
>
> --
> Dave Seltzer <dseltzer at tveyes.com>
> Chief Systems Architect
> TVEyes
> (203) 254-3600 x222
>



-- 
Dave Seltzer <dseltzer at tveyes.com>
Chief Systems Architect
TVEyes
(203) 254-3600 x222
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130125/db0d92cd/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 3822 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130125/db0d92cd/attachment.png>

From ben.west at mobankgroup.com  Fri Jan 25 09:52:30 2013
From: ben.west at mobankgroup.com (ben.west at mobankgroup.com)
Date: Fri, 25 Jan 2013 01:52:30 -0800 (PST)
Subject: [rabbitmq-discuss] Instable HA cluster
Message-ID: <876324c5-235e-4395-99d9-2aeabd04ef6c@googlegroups.com>

Hi,


I've been having lots of instability problems with a rabbit cluster I have 
set up.
Since deploying Rabbit MQ a few months ago we have experienced ongoing 
instability with the service.

Our setup:


   - RabbitMQ 3.0.1 running on Windows Azure VMs (Server 2012)
   - We have 2 VMs set up with a rabbit running on each and clustered (with 
   a HA policy), both running as disk nodes
   - Using EasyNetQ for producers consumers


When I first set up the cluster everything seems to be running well and can 
see through the Rabbit console the HA mirroring is all set up.

However after a couple of days I will log into the console and find the 
cluster is broken, usually with one node saying "Node not running" and a 
number of the consumers have dropped off the queues. I then have to tear 
down the cluster and build it all up again - not a massive job, but I'm 
sure i shouldn't need to do this every week!

At first I thought it may be due to Windows updates automatically 
restarting the server and possibly breaking the cluster, but have now 
turned these off and still get the same problem. I have also tried 
rebooting the servers one at a time to test this but the cluster seems to 
pick itself back up once the reboot has finished.

I've done lots of reading online but cant seem to find too many suggestions 
so I hope someone here may be able to help.

I'm more thank happy to provide logs if these may be useful?

Any help will be grately appreciated!

Thanks,

Ben

-- 
 <http://www.mopowered.co.uk>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130125/12f03a1a/attachment.htm>

From syhpoon at gmail.com  Fri Jan 25 14:59:08 2013
From: syhpoon at gmail.com (Max E. Kuznecov)
Date: Fri, 25 Jan 2013 06:59:08 -0800 (PST)
Subject: [rabbitmq-discuss] How to debug queue memory leak
Message-ID: <b428c3a8-1a26-40a8-a5aa-8bac4446d350@googlegroups.com>

Hello

In my application I have a pool of temporary queues, used for RPC-like 
messaging.
Queues are created with flags durable and exclusive.

I'm observing a constant growth in queues memory as the time passes despite 
the fact rabbitmqctl shows zeros in messages column.
The output looks like this:

rabbitmqctl list_queues memory name messages consumers | sort -rn | head
10772176        amq.gen-qnA00cF1K0o2vq1KyO9_yQ  0       1
10772104        amq.gen-os12dLIRtGJYqEwG7xpZOA  0       1
10771888        amq.gen-YJkYswabMY0eUQi057xdHA  1       0
10771888        amq.gen-X8_I9wVBb6H2bHb_yt5zrw  0       0
10771888        amq.gen-wLAXnQjySs9QgVlaZOlXaw  0       0
....

And this number just continues to grow until memory high watermark is hit.
Maybe I'm missing something but how is this possible? Message rate is about 
50 msg/s, it is not so high.
Is it possible somehow to find out why is memory not being freed?

rabbitmq version 3.0.1 on linux x86_64 box with erlang client API.

Thank you.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130125/9af43d2b/attachment.htm>

From simon at rabbitmq.com  Fri Jan 25 15:32:12 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 25 Jan 2013 15:32:12 +0000
Subject: [rabbitmq-discuss] Instable HA cluster
In-Reply-To: <876324c5-235e-4395-99d9-2aeabd04ef6c@googlegroups.com>
References: <876324c5-235e-4395-99d9-2aeabd04ef6c@googlegroups.com>
Message-ID: <5102A57C.4010003@rabbitmq.com>

On 25/01/13 09:52, ben.west at mobankgroup.com wrote:
> I'm more thank happy to provide logs if these may be useful?

That would be useful. Preferably if you can also tell us about the time 
at which the cluster broke (even if it's just "some time on Wednesday" 
or similar).

Cheers, Simon
-- 
Simon MacMullen
RabbitMQ, VMware

From michael.s.klishin at gmail.com  Fri Jan 25 15:35:36 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 25 Jan 2013 19:35:36 +0400
Subject: [rabbitmq-discuss] How to debug queue memory leak
In-Reply-To: <b428c3a8-1a26-40a8-a5aa-8bac4446d350@googlegroups.com>
References: <b428c3a8-1a26-40a8-a5aa-8bac4446d350@googlegroups.com>
Message-ID: <CAE3HoVQ_bH6p0nYHKfPEu9nTD8FYR0q9yCaqYnPT0CUCD4Lwkw@mail.gmail.com>

2013/1/25 Max E. Kuznecov <syhpoon at gmail.com>

> I'm observing a constant growth in queues memory as the time passes
> despite the fact rabbitmqctl shows zeros in messages column.


Max,

RabbitMQ will not delete queues when they have 0 messages in them. You have
a number of options
to deal with the temporary queues explosion:

 * Clean them up manually after clients receive responses
 * Use auto-delete queues and remove consumers (they will be deleted when
the last consumer disconnects)
 * Use exclusive queues. They will be removed when the connection that
declared them closes.

The latter is probably not an option for long running systems.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130125/af23636b/attachment.htm>

From matthias at rabbitmq.com  Fri Jan 25 15:44:50 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 25 Jan 2013 15:44:50 +0000
Subject: [rabbitmq-discuss] How to debug queue memory leak
In-Reply-To: <b428c3a8-1a26-40a8-a5aa-8bac4446d350@googlegroups.com>
References: <b428c3a8-1a26-40a8-a5aa-8bac4446d350@googlegroups.com>
Message-ID: <5102A872.3000801@rabbitmq.com>

On 25/01/13 14:59, Max E. Kuznecov wrote:
> I'm observing a constant growth in queues memory as the time passes
> despite the fact rabbitmqctl shows zeros in messages column.

That is odd indeed.

Please send the output of 'rabbitmqctl report'.

Also, run 'rabbitmqctl list_queues name pid', which will display 
something like

Listing queues ...
amq.gen-4QD6-qQk5qJYLJDA0uLlcA	<rabbit at i.2.377.0>
amq.gen-jwB5qlTRULXTW4WXEfgTJg	<rabbit at i.2.388.0>
...done.

pick one of the pids shown and plug it into

rabbitmqctl eval 'process_info(rabbit_misc:string_to_pid("<ThePid>")).'.

and send us the output of that.

Regards,

Matthias.

From emile at rabbitmq.com  Fri Jan 25 22:39:46 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 25 Jan 2013 22:39:46 +0000
Subject: [rabbitmq-discuss] Securing Messages Over WAN Link
In-Reply-To: <F7E3EFC5-166F-4112-87EB-9D2146A8AFB7@dushin.net>
References: <22a5201a-39b3-4ce2-8c36-dd82309349c3@googlegroups.com>
	<50F67FCD.6070009@rabbitmq.com>
	<F7E3EFC5-166F-4112-87EB-9D2146A8AFB7@dushin.net>
Message-ID: <510309B2.30905@rabbitmq.com>

On 25/01/13 14:21, Dushin Fred wrote:
> I would add that if you care about data integrity, then you will also
> want to include both a cryptographic hash, as well as some sort of
> sequencing information in the payload, so that consumers can detect
> attacks that may have, for example, removed or re-ordered messages.

SSL already provides this. The SSL message transport includes a message
authentication code, using secure hash functions (e.g., SHA, MD5).  SSL
transmissions also include a sequence number so that missing, re-ordered
or extra messages are detectable.

> If you're even more paranoid, you could also roll keys, so that
> compromise of a key at one point will not compromise the
> secrecy/integrity of previous messages, but that is obviously more
> complicated (== more expensive to implement).

Restrict the allowed cipher suites to those that offer forward secrecy
if you care about this. The available cipher suites offered by the
broker can be retrieved with this command:
rabbitmqctl eval 'ssl:cipher_suites().'



-Emile



From brettflitter at gmail.com  Sat Jan 26 14:51:24 2013
From: brettflitter at gmail.com (nybras)
Date: Sat, 26 Jan 2013 06:51:24 -0800 (PST)
Subject: [rabbitmq-discuss] Check for binding between Exchange & Queue
Message-ID: <1359211884530-24696.post@n5.nabble.com>

Hi,

Is there anyway to check to see if there is a binding between an exchange
and queue? I'm creating an app which needs to display what exhanges the
user(a queue) has binded to. I'm using the Java client API but can't find
anything suitable in there. 

Example:

if (user has binding between Exchange x and Queue q) 
then
      display a 'tick' in box to confirm subscription 
else
      display box 'unticked' to show no subscription currently 

Thanks




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Check-for-binding-between-Exchange-Queue-tp24696.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From michael.s.klishin at gmail.com  Sat Jan 26 15:07:19 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sat, 26 Jan 2013 19:07:19 +0400
Subject: [rabbitmq-discuss] Check for binding between Exchange & Queue
In-Reply-To: <1359211884530-24696.post@n5.nabble.com>
References: <1359211884530-24696.post@n5.nabble.com>
Message-ID: <CAE3HoVRJ2ZGJETGhqUQ3NbhvpMsrTmTUhFF8Bh8XZ+qPYLDmSw@mail.gmail.com>

2013/1/26 nybras <brettflitter at gmail.com>

> Is there anyway to check to see if there is a binding between an exchange
> and queue?
>

It's possible using the HTTP API:
http://hg.rabbitmq.com/rabbitmq-management/raw-file/3646dee55e02/priv/www-api/help.html

I am not aware of a Java HTTP API client.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130126/7b2e25cc/attachment.htm>

From romanass at gmail.com  Sat Jan 26 11:58:36 2013
From: romanass at gmail.com (Romanas S.)
Date: Sat, 26 Jan 2013 03:58:36 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ cluster with potentially millions of
	connections
Message-ID: <f75213a1-1571-415b-a5ba-e84c0d6bd0c9@googlegroups.com>

Hi guys,
 I'm trying to come up with an architecture for a RabbitMQ cluster that 
could potentially handle millions of (persistent) connections. I've set up 
a cluster of Rabbits with 3 nodes (16GB RAM, 4x cpu cores each) and a Load 
Balancer in front of them, increased all of the system limits on sockets 
and file descriptors, but can't seem to scale to more then 30k connections 
on the entire cluster. 

Each connections has it's own exchange and a temporary direct queue, RAM 
usage is about 2-3GB on each node and CPU usage peaks at about 200% (which 
on 4 cores isn't all that bad). At first all is quite well and the cluster 
manages upwards of 1k msgs/second (I haven't tried more, pretty sure it 
would handle it). However, after scaling to that many connections, the 
cluster seems to grind to a halt and eventually nodes become unresponsive. 
The management API takes upwards of 5 (FIVE!) minutes to retrieve a server 
summary report. Am I missing something here? Or is this just a bad idea 
altogether? I was expecting that if each node was able to handle 30k+ 
connections, I could have a cluster of 50 or so (with multiple balancers, 
of course!) and live a happy life  ;-)

Thanks,
Roman
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130126/f278a7d7/attachment.htm>

From brettflitter at gmail.com  Sat Jan 26 15:53:46 2013
From: brettflitter at gmail.com (nybras)
Date: Sat, 26 Jan 2013 07:53:46 -0800 (PST)
Subject: [rabbitmq-discuss] Check for binding between Exchange & Queue
In-Reply-To: <CAE3HoVRJ2ZGJETGhqUQ3NbhvpMsrTmTUhFF8Bh8XZ+qPYLDmSw@mail.gmail.com>
References: <1359211884530-24696.post@n5.nabble.com>
	<CAE3HoVRJ2ZGJETGhqUQ3NbhvpMsrTmTUhFF8Bh8XZ+qPYLDmSw@mail.gmail.com>
Message-ID: <1359215626838-24699.post@n5.nabble.com>

Ah ha, Excellent! Thank you very much 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Check-for-binding-between-Exchange-Queue-tp24696p24699.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mcintoshj at gmail.com  Sat Jan 26 17:14:27 2013
From: mcintoshj at gmail.com (McIntosh Jason)
Date: Sat, 26 Jan 2013 11:14:27 -0600
Subject: [rabbitmq-discuss] RabbitMQ cluster with potentially millions
	of connections
In-Reply-To: <f75213a1-1571-415b-a5ba-e84c0d6bd0c9@googlegroups.com>
References: <f75213a1-1571-415b-a5ba-e84c0d6bd0c9@googlegroups.com>
Message-ID: <B7054A02-D98F-488F-A76B-EE22B047BE74@gmail.com>

Romanas:

Umm, I'm reasonably sure millions of persistent connections isn't possible through a single entry point.  First, with TCP/IP communications an interface only has 65k ports (roughly).  Of those, quite a few are typically in use for things like SSH requests or similar.  I'm actually surprised you made it to 30k simultaneous connections.  Now, you should be able to handle that many channels when distributed across a cluster - at least I think so though I've not really tested that situation.  The kicker is even if a server can handle say 30k connections and so you have your 50 servers, the load balancer itself would become your bottle neck as it couldn't keep open a million persistent connections (again, 65k limit, which is really a lot lower).  Most load balancers act as a proxy, not as a DNS lookup in concept.

Second, even on a single connection, with only a few channels, with my testing on a newer machine with only 8GB of RAM, and 4 cores, I was able to push through 20+k messages a second easily.  With HIPE turned on I was pushing closer to 30k messages a second (these were very small messages though for testing purposes).  The the performance on this with durable messages seems to be very dependent on message size.

Jason

On Jan 26, 2013, at 5:58 AM, Romanas S. wrote:

> Hi guys,
>  I'm trying to come up with an architecture for a RabbitMQ cluster that could potentially handle millions of (persistent) connections. I've set up a cluster of Rabbits with 3 nodes (16GB RAM, 4x cpu cores each) and a Load Balancer in front of them, increased all of the system limits on sockets and file descriptors, but can't seem to scale to more then 30k connections on the entire cluster. 
> 
> Each connections has it's own exchange and a temporary direct queue, RAM usage is about 2-3GB on each node and CPU usage peaks at about 200% (which on 4 cores isn't all that bad). At first all is quite well and the cluster manages upwards of 1k msgs/second (I haven't tried more, pretty sure it would handle it). However, after scaling to that many connections, the cluster seems to grind to a halt and eventually nodes become unresponsive. The management API takes upwards of 5 (FIVE!) minutes to retrieve a server summary report. Am I missing something here? Or is this just a bad idea altogether? I was expecting that if each node was able to handle 30k+ connections, I could have a cluster of 50 or so (with multiple balancers, of course!) and live a happy life  ;-)
> 
> Thanks,
> Roman
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From matthias at rabbitmq.com  Sat Jan 26 17:45:53 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 26 Jan 2013 17:45:53 +0000
Subject: [rabbitmq-discuss] RabbitMQ cluster with potentially millions
 of connections
In-Reply-To: <f75213a1-1571-415b-a5ba-e84c0d6bd0c9@googlegroups.com>
References: <f75213a1-1571-415b-a5ba-e84c0d6bd0c9@googlegroups.com>
Message-ID: <51041651.1040402@rabbitmq.com>

Roman,

On 26/01/13 11:58, Romanas S. wrote:
> Each connections has it's own exchange and a temporary direct queue,

The meta data for exchanges and queues is held in RAM *on all nodes* in 
a cluster. Shouldn't be more than a few hundred bytes, but still. It's 
quite unusual to create one exchange per connection. You may want to try 
eliminating that.

> However, after scaling to that many connections, the cluster seems to
> grind to a halt and eventually nodes become unresponsive. The
> management API takes upwards of 5 (FIVE!) minutes to retrieve a
> server summary report.

Make sure you are running the latest version of RabbitMQ, i.e. 3.0.1. 
Recent release contain some significant improvements to behaviour under 
load.

You may also want to try disabling the management plug-in.

Regards,

Matthias.

From brettflitter at gmail.com  Sat Jan 26 19:27:21 2013
From: brettflitter at gmail.com (nybras)
Date: Sat, 26 Jan 2013 11:27:21 -0800 (PST)
Subject: [rabbitmq-discuss] User Permissions
Message-ID: <1359228441933-24702.post@n5.nabble.com>

Hi I don't really understand how to use the regular expressions to dictate
what the user can and can't do in the management plugin.

I'm also not really sure about how to go about security. At the moment I've
created an app which connects just through one account (admin/root account)
with no permission restrictions which I'm guessing is not good.  Do I create
a 'user' account for each new user that uses my app or I do I create one
'user' account with restricted permissions that all users can connect
through??

I've started using the http API so I can make requests to see how many
bindings a user has made which is also currently being accessed through this
'one admin account', should I just create a basic user account to allow
these GET requests? Again I don't understand what to do with the regular
expressions.

THank you



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/User-Permissions-tp24702.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From liwei_chour at mail.apex.com.tw  Mon Jan 28 07:18:51 2013
From: liwei_chour at mail.apex.com.tw (=?big5?B?pLOl37C2?=)
Date: Mon, 28 Jan 2013 15:18:51 +0800
Subject: [rabbitmq-discuss] The message size will slow down the speed of
	RabbitMQ C library
Message-ID: <001e01cdfd27$b9236970$2b6a3c50$@apex.com.tw>

Hi All:

I test the performance of the RabbitMQ C library and find a question. The
question is :

I use the example programs ?amqp_prodcuer? and ?amqp_consumer? to do the
test. 

When the speed of amqp_producer is 10000 messages per second and the size of
message is 256, the amqp_consumer is working find(getting 10000 messages per
second at amqp_consumer).

When the speed of amqp_producer is 10000 messages per second and the size of
message is 50, the speed of the amqp_consumer down to 400 messages per
second.

But I slow down the speed(form 10000 to 5000), any size of message are
working find.(getting 5000 message per second at amqp_consumer).

 

Ps:

The version of RabbitMQ C library is 0.3.0. 

Client OS is Windows 7 64 bits

RabbitMQ : 3.0.1 Erlang R15B03 running on Windows Server 2003 SP2

  

 

Sincerely

Liwei Chour in OFFICe

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130128/21b1a3fd/attachment.htm>

From matthias at rabbitmq.com  Mon Jan 28 08:19:42 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 28 Jan 2013 08:19:42 +0000
Subject: [rabbitmq-discuss] How to debug queue memory leak
In-Reply-To: <CAGb0cFmoEFqTMbNKKqAO2bLjjp2EGMX8owONbBby97zrq1WJwQ@mail.gmail.com>
References: <b428c3a8-1a26-40a8-a5aa-8bac4446d350@googlegroups.com>
	<5102A872.3000801@rabbitmq.com>
	<CAGb0cFmoEFqTMbNKKqAO2bLjjp2EGMX8owONbBby97zrq1WJwQ@mail.gmail.com>
Message-ID: <5106349E.6010208@rabbitmq.com>

On 28/01/13 00:53, Max Kuznecov wrote:
> rabbitmqctl report output: http://pastebin.com/7xuebg84
>
> And the process_info of the queue with highest memory usage:

Do you remember what the pid was of that queue? So I can correlate that 
with the report output.

Anyway, it looks like all the queues with a high memory usage are 
slow-moving. Since garbage collection is triggered based on the 
reduction count, that means they can hold on to a fair amount of memory. 
By contrast, idle queues go into hibernation, which compacts their memory.

We introduced a background gc in 3.0.0, which should control the memory 
consumption of slow moving queues and other lightly-used processes. 
However, it runs at most once per minute, less frequently if gc takes a 
long of time. I wonder whether that is too infrequent for your usage 
pattern.

This may be particularly an issue when the messages are large. What's 
the average message size passing through the queues?

One way to check whether (lack of) gc is an issue, is to perform an 
explicit gc on the process with

rabbitmqctl eval 'garbage_collect(rabbit_misc:string_to_pid("<ThePid>")).'

and see whether that drops the memory usage significantly.

Regards,

Matthias.

From emile at rabbitmq.com  Mon Jan 28 10:35:35 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 28 Jan 2013 10:35:35 +0000
Subject: [rabbitmq-discuss] The message size will slow down the speed of
 RabbitMQ C library
In-Reply-To: <001e01cdfd27$b9236970$2b6a3c50$@apex.com.tw>
References: <001e01cdfd27$b9236970$2b6a3c50$@apex.com.tw>
Message-ID: <51065477.8070904@rabbitmq.com>

On 28/01/13 07:18, ??? wrote:
> The version of RabbitMQ C library is 0.3.0.
> Client OS is Windows 7 64 bits
> RabbitMQ : 3.0.1 Erlang R15B03 running on Windows Server 2003 SP2

I tried the same test on Linux with version 0.2.0 and 0.3.0 of the C
library and was not able to reproduce the result. The consumer matched
the speed of the producer.


-Emile




From mek at mek.uz.ua  Mon Jan 28 10:32:23 2013
From: mek at mek.uz.ua (Max Kuznecov)
Date: Mon, 28 Jan 2013 12:32:23 +0200
Subject: [rabbitmq-discuss] How to debug queue memory leak
In-Reply-To: <5106349E.6010208@rabbitmq.com>
References: <b428c3a8-1a26-40a8-a5aa-8bac4446d350@googlegroups.com>
	<5102A872.3000801@rabbitmq.com>
	<CAGb0cFmoEFqTMbNKKqAO2bLjjp2EGMX8owONbBby97zrq1WJwQ@mail.gmail.com>
	<5106349E.6010208@rabbitmq.com>
Message-ID: <CAGb0cFksGm8SM7q_hLHPadDq0VXCdwXq21XMz1suB6bY6=V6gw@mail.gmail.com>

2013/1/28 Matthias Radestock <matthias at rabbitmq.com>:

> Do you remember what the pid was of that queue? So I can correlate that with
> the report output.

I was <rabbit at sps.3.3485.3>

> We introduced a background gc in 3.0.0, which should control the memory
> consumption of slow moving queues and other lightly-used processes. However,
> it runs at most once per minute, less frequently if gc takes a long of time.
> I wonder whether that is too infrequent for your usage pattern.

Should I try 2.8.7 to see if the same going to happen?

> This may be particularly an issue when the messages are large. What's the
> average message size passing through the queues?

Well, I'm not sure, there are lots of small messages (about hundred of
bytes) but large messages (several kilobytes) are being sent from time
to time as well.

> One way to check whether (lack of) gc is an issue, is to perform an explicit
> gc on the process with
>
> rabbitmqctl eval 'garbage_collect(rabbit_misc:string_to_pid("<ThePid>")).'
>
> and see whether that drops the memory usage significantly.
>

It doesn't seem to have any effect in my case.


--
~syhpoon

From matthias at rabbitmq.com  Mon Jan 28 10:43:40 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 28 Jan 2013 10:43:40 +0000
Subject: [rabbitmq-discuss] How to debug queue memory leak
In-Reply-To: <CAGb0cFksGm8SM7q_hLHPadDq0VXCdwXq21XMz1suB6bY6=V6gw@mail.gmail.com>
References: <b428c3a8-1a26-40a8-a5aa-8bac4446d350@googlegroups.com>
	<5102A872.3000801@rabbitmq.com>
	<CAGb0cFmoEFqTMbNKKqAO2bLjjp2EGMX8owONbBby97zrq1WJwQ@mail.gmail.com>
	<5106349E.6010208@rabbitmq.com>
	<CAGb0cFksGm8SM7q_hLHPadDq0VXCdwXq21XMz1suB6bY6=V6gw@mail.gmail.com>
Message-ID: <5106565C.7070108@rabbitmq.com>

On 28/01/13 10:32, Max Kuznecov wrote:
> 2013/1/28 Matthias Radestock <matthias at rabbitmq.com>:
>> We introduced a background gc in 3.0.0  [...]
>
> Should I try 2.8.7 to see if the same going to happen?

Nah, 2.8.7 has no background gc at all, so could only do worse.

>> gc on the process with
>>
>> rabbitmqctl eval 'garbage_collect(rabbit_misc:string_to_pid("<ThePid>")).'
>>
>> and see whether that drops the memory usage significantly.
>>
> It doesn't seem to have any effect in my case.

Curious. We'll have to look into this further. At the moment I have no 
idea where the memory could be going.

Btw, it appears that your previous message didn't make it to the mailing 
list. Would you mind re-sending it?

Regards,

Matthias.

From simon at rabbitmq.com  Mon Jan 28 10:55:39 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 28 Jan 2013 10:55:39 +0000
Subject: [rabbitmq-discuss] Instable HA cluster
In-Reply-To: <CAMQJgDoLakskhjFe9wtt8jc+aS1fr2yK=GadGTu_8r9cULs9SQ@mail.gmail.com>
References: <876324c5-235e-4395-99d9-2aeabd04ef6c@googlegroups.com>
	<5102A57C.4010003@rabbitmq.com>
	<CAMQJgDoZX=OZqdRTaaXuCerAJxJtdRqpNODkG7rXKYrPSCYeEg@mail.gmail.com>
	<5102B59D.7090304@rabbitmq.com>
	<CAMQJgDoLakskhjFe9wtt8jc+aS1fr2yK=GadGTu_8r9cULs9SQ@mail.gmail.com>
Message-ID: <5106592B.6000705@rabbitmq.com>

Hi, thanks. So it looks like the cluster is experiencing network partitions:

http://www.rabbitmq.com/partitions.html

since we can see (for example) that around 18-Jan-2013 03:30:21 both 
nodes saw the other one go down. RabbitMQ clusters do not tolerate 
partitions well, so this needs to be fixed I'm afraid.

You should not need to rebuild the cluster when this happens however, 
just stopping and starting nodes should be enough to recover.

Cheers, Simon

On 25/01/13 17:04, Ben West wrote:
> Hi Simon,
>
> Please find attached.
>
> Thanks again,
>
> Ben
>
>
> On 25 January 2013 16:41, Simon MacMullen <simon at rabbitmq.com
> <mailto:simon at rabbitmq.com>> wrote:
>
>     Could you send the log for MOPAYPL2 as well? It would be useful to
>     correlate what's happening with it too.
>
>     Cheers, Simon
>
>
>     On 25/01/13 16:28, Ben West wrote:
>
>
>         Hi Simon,
>
>         Thanks for for coming back to me.
>
>         Attached is a rabbit mq log from one of the nodes.
>
>         As I mentioned before, this seems to happen once every week or
>         two. I
>         can be too specific on when it happened because i only noticed
>         when I
>         check the console, however I believe the last occurrence would
>         have been
>         yesterday (24th Jan).
>
>         If you need further logs / info let me know and I'll dig it out
>         for you.
>
>         Kind regards,
>
>         Ben
>
>
>         On 25 January 2013 15:32, Simon MacMullen <simon at rabbitmq.com
>         <mailto:simon at rabbitmq.com>
>         <mailto:simon at rabbitmq.com <mailto:simon at rabbitmq.com>>> wrote:
>
>              On 25/01/13 09:52, ben.west at mobankgroup.com
>         <mailto:ben.west at mobankgroup.com>
>              <mailto:ben.west at mobankgroup.__com
>         <mailto:ben.west at mobankgroup.com>> wrote:
>
>                  I'm more thank happy to provide logs if these may be
>         useful?
>
>
>              That would be useful. Preferably if you can also tell us
>         about the
>              time at which the cluster broke (even if it's just "some
>         time on
>              Wednesday" or similar).
>
>              Cheers, Simon
>              --
>              Simon MacMullen
>              RabbitMQ, VMware
>
>
>
>         <http://www.mopowered.co.uk>
>
>
>
>     --
>     Simon MacMullen
>     RabbitMQ, VMware
>
>
>
> <http://www.mopowered.co.uk>


-- 
Simon MacMullen
RabbitMQ, VMware

From ask at rabbitmq.com  Mon Jan 28 11:44:39 2013
From: ask at rabbitmq.com (Ask Solem)
Date: Mon, 28 Jan 2013 11:44:39 +0000
Subject: [rabbitmq-discuss] RabbitMQ scaling with OpenStack
In-Reply-To: <CAJcv3CSQBm3nq_YBTpmnZ7h8J9SNt-dO=BHkUGw3XRPyaKR8zA@mail.gmail.com>
References: <CAJcv3CSQBm3nq_YBTpmnZ7h8J9SNt-dO=BHkUGw3XRPyaKR8zA@mail.gmail.com>
Message-ID: <50AFC3AB-981C-42D8-AB02-31496E42D8B4@rabbitmq.com>


On Jan 23, 2013, at 2:04 AM, Ray Pekowski <pekowski at gmail.com> wrote:

> On Jan 22, 2013, at 1:58 PM, Ask Solem <ask at rabbitmq.com> wrote:
> 
> > I could help you review the code as I have lots of experience optimizing
> > this pattern and Python consumers.
> 
> It would be great if you could review the code.  Here is where the Kombu interface is implemented in OpenStack
> 
> https://github.com/openstack/nova/blob/master/nova/openstack/common/rpc/impl_kombu.py
> 
> Roughly, the RPC call is sent by TopicPublisher (caller), then received by TopicConsumers (callee).  The response is sent by DirectPublisher (callee) and received by DirectConsumer (caller).  In real time, the consumes happen before the publishes.
> 
> The RPC calls to impl_kombu.py come from amqp.py. which is simply a common higher level set of methods that either calls methods from impl_kombu.py or impl_qpid.py depending upon which implementation is configured.
> 
> Ray
> 

I've spent some time reviewing the code, but it's really hard to follow, and it's
reinventing a lot of things that Kombu already supports.   Having two sets of
implementations means that we both have to debug and maintain it, this code could
definitely be reduced by a lot.

One thing that I'm unable to understand is whether it's creating a channel or not
(other than the Connection.default_channel), and if so if it creates a channel for
every request.  This would be bad since creating channels is very expensive (at least in amqplib/py-amqp).

Also, it seems that the reply messages are persistent, do they have to be?


From ben.west at mobankgroup.com  Mon Jan 28 11:17:16 2013
From: ben.west at mobankgroup.com (Ben West)
Date: Mon, 28 Jan 2013 11:17:16 +0000
Subject: [rabbitmq-discuss] Instable HA cluster
In-Reply-To: <5106592B.6000705@rabbitmq.com>
References: <876324c5-235e-4395-99d9-2aeabd04ef6c@googlegroups.com>
	<5102A57C.4010003@rabbitmq.com>
	<CAMQJgDoZX=OZqdRTaaXuCerAJxJtdRqpNODkG7rXKYrPSCYeEg@mail.gmail.com>
	<5102B59D.7090304@rabbitmq.com>
	<CAMQJgDoLakskhjFe9wtt8jc+aS1fr2yK=GadGTu_8r9cULs9SQ@mail.gmail.com>
	<5106592B.6000705@rabbitmq.com>
Message-ID: <CAMQJgDrduyL=3c1aXWCmZJdQQ54vwLjzYq0XYVq3dvxAriK1kw@mail.gmail.com>

Hi Simon,

Thanks for taking the time to look into this.

I had a feeling this was an environmental issue because it only occurred on
our QA and PreLive environments, we do not experience the same issue on our
LIVE environment (hosted in another service, not Azure).

I will get in touch with Microsoft and find out what our options are with
Azure VMs and establish if there is anything we can do to eliminate network
partitions. We do not currently use their Virtual Networks so we may try
setting up the two VMs in a virtual Network to increase the stability
between the two nodes. Failing that we may look at the Federation / Shovel
solutions mentioned in the link.

Cheers,

Ben


Ben West
Product Owner

Mobile: +44(0)7824 617 813
ben.west at mobankgroup.com

www.mopowered.co.uk <http://goog_1166506706/>



On 28 January 2013 10:55, Simon MacMullen <simon at rabbitmq.com> wrote:

> Hi, thanks. So it looks like the cluster is experiencing network
> partitions:
>
> http://www.rabbitmq.com/**partitions.html<http://www.rabbitmq.com/partitions.html>
>
> since we can see (for example) that around 18-Jan-2013 03:30:21 both nodes
> saw the other one go down. RabbitMQ clusters do not tolerate partitions
> well, so this needs to be fixed I'm afraid.
>
> You should not need to rebuild the cluster when this happens however, just
> stopping and starting nodes should be enough to recover.
>
> Cheers, Simon
>
>
> On 25/01/13 17:04, Ben West wrote:
>
>> Hi Simon,
>>
>> Please find attached.
>>
>> Thanks again,
>>
>> Ben
>>
>>
>> On 25 January 2013 16:41, Simon MacMullen <simon at rabbitmq.com
>> <mailto:simon at rabbitmq.com>> wrote:
>>
>>     Could you send the log for MOPAYPL2 as well? It would be useful to
>>     correlate what's happening with it too.
>>
>>     Cheers, Simon
>>
>>
>>     On 25/01/13 16:28, Ben West wrote:
>>
>>
>>         Hi Simon,
>>
>>         Thanks for for coming back to me.
>>
>>         Attached is a rabbit mq log from one of the nodes.
>>
>>         As I mentioned before, this seems to happen once every week or
>>         two. I
>>         can be too specific on when it happened because i only noticed
>>         when I
>>         check the console, however I believe the last occurrence would
>>         have been
>>         yesterday (24th Jan).
>>
>>         If you need further logs / info let me know and I'll dig it out
>>         for you.
>>
>>         Kind regards,
>>
>>         Ben
>>
>>
>>         On 25 January 2013 15:32, Simon MacMullen <simon at rabbitmq.com
>>         <mailto:simon at rabbitmq.com>
>>         <mailto:simon at rabbitmq.com <mailto:simon at rabbitmq.com>>> wrote:
>>
>>              On 25/01/13 09:52, ben.west at mobankgroup.com
>>         <mailto:ben.west at mobankgroup.**com <ben.west at mobankgroup.com>>
>>              <mailto:ben.west at mobankgroup._**_com
>>
>>         <mailto:ben.west at mobankgroup.**com <ben.west at mobankgroup.com>>>
>> wrote:
>>
>>                  I'm more thank happy to provide logs if these may be
>>         useful?
>>
>>
>>              That would be useful. Preferably if you can also tell us
>>         about the
>>              time at which the cluster broke (even if it's just "some
>>         time on
>>              Wednesday" or similar).
>>
>>              Cheers, Simon
>>              --
>>              Simon MacMullen
>>              RabbitMQ, VMware
>>
>>
>>
>>         <http://www.mopowered.co.uk>
>>
>>
>>
>>     --
>>     Simon MacMullen
>>     RabbitMQ, VMware
>>
>>
>>
>> <http://www.mopowered.co.uk>
>>
>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>

-- 
 <http://www.mopowered.co.uk>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130128/3556aea1/attachment.htm>

From graeme.roy.taylor at googlemail.com  Mon Jan 28 12:12:52 2013
From: graeme.roy.taylor at googlemail.com (Graeme Taylor)
Date: Mon, 28 Jan 2013 04:12:52 -0800 (PST)
Subject: [rabbitmq-discuss] Potential Bug in C# Client
Message-ID: <22c4933a-6c71-4f67-9d23-501e9372d663@googlegroups.com>

Hi,
 
I am using RabbitMQ 3.0.1 and RabbitMQ.Client (3.0.1) from C#.  
 
Whilst the mistake is in my usage, I thought it worth mentioning.
 
I have declared a listener where I achknowledge a message on receipt.  
However, in my publisher, I had set NoAck to TRUE.  The result of this is 
after the first message, the bindings and queues are removed from the 
exchange and no further messages are received by the subscriber.
 
Changing the NoAck to FALSE solved the issue.  Code samples available if 
required.
 
Thanks,
 
Graeme
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130128/a0dbb69f/attachment.htm>

From bme at saseco.dk  Mon Jan 28 12:43:05 2013
From: bme at saseco.dk (Bernhard Mogens Ege)
Date: Mon, 28 Jan 2013 12:43:05 +0000
Subject: [rabbitmq-discuss] Upgraded RabbitMQ and now nothing works
Message-ID: <C44C93396408924FBBF479F57FD429FC058B9243@AM2PRD0210MB361.eurprd02.prod.outlook.com>

I have just upgraded my RabbitMQ server from 2.8.7 to 3.0.1 (and erl from 15b02 to 15b03). But now my RabbitMQ clients cannot communicate with the server anymore and I am completely in the dark as to why. This is the error I get:

Unhandled Exception: System.IO.IOException: Unable to read data from the transport connection: An existing connection was forcibly closed by the remote host. ---> System.Net.Sockets.SocketException: An existing connection was forcibly closed by the remote host
   at System.Net.Sockets.Socket.Receive(Byte[] buffer, Int32 offset, Int32 size, SocketFlags socketFlags)
   at System.Net.Sockets.NetworkStream.Read(Byte[] buffer, Int32 offset, Int32 size)
   --- End of inner exception stack trace ---
   at RabbitMQ.Client.Impl.ConnectionBase.System.IDisposable.Dispose()
   at SendBifrostCommand.Program.sendCommand(String routingKey, IDictionary headers, Byte[] payload) in C:\Users\bme\Documents\Visual Studio 2010\Projects\SendBifrostCommand\SendBifrostCommand\Program.cs:line 97
   at SendBifrostCommand.Program.GetGatewayStatus(String gateway_id) in C:\Users\bme\Documents\Visual Studio 2010\Projects\SendBifrostCommand\SendBifrostCommand\Program.cs:line 66
at SendBifrostCommand.Program.Main(String[] args) in C:\Users\bme\Documents\Visual Studio 2010\Projects\SendBifrostCommand\SendBifrostCommand\Program.cs:line 35

All I do is try to send a message (error is happening in BasicPublish):

        static void sendCommand(string routingKey, IDictionary headers, byte[] payload)
        {
            const string EXCHANGE_NAME = "bifrost";
            const string AMQPURI = "amqp://127.0.0.1:5672/";

            ConnectionFactory factory = new ConnectionFactory { Uri = AMQPURI };

            using (IConnection connection = factory.CreateConnection())
            {
                using (IModel channel = connection.CreateModel())
                {
                    channel.ExchangeDeclare(EXCHANGE_NAME, ExchangeType.Topic, false, true, null);
                    channel.BasicReturn += (o, e) =>
                    {
                        Console.WriteLine("Command was not received: " + System.Text.Encoding.UTF8.GetString(e.Body) + " " + e.ReplyText.ToString());
                    };
                    IBasicProperties bp = channel.CreateBasicProperties();
                    bp.ContentEncoding = "utf-8";
                    bp.Headers = headers;
                    channel.BasicPublish(EXCHANGE_NAME, routingKey, false, true, bp, payload);
                }
            }
        }

This used to work fine with 2.8.7 but not anymore. Has RabbitMQ server changed so much?

Thanks,

Bernhard

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130128/210858ca/attachment.htm>

From simon at rabbitmq.com  Mon Jan 28 12:53:06 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 28 Jan 2013 12:53:06 +0000
Subject: [rabbitmq-discuss] Upgraded RabbitMQ and now nothing works
In-Reply-To: <C44C93396408924FBBF479F57FD429FC058B9243@AM2PRD0210MB361.eurprd02.prod.outlook.com>
References: <C44C93396408924FBBF479F57FD429FC058B9243@AM2PRD0210MB361.eurprd02.prod.outlook.com>
Message-ID: <510674B2.5090508@rabbitmq.com>

On 28/01/13 12:43, Bernhard Mogens Ege wrote:
> I have just upgraded my RabbitMQ server from 2.8.7 to 3.0.1 (and erl
> from 15b02 to 15b03). But now my RabbitMQ clients cannot communicate
> with the server anymore and I am completely in the dark as to why. This
> is the error I get:

It looks like you are trying to use immediate mode publish - support for 
immediate mode was removed in 3.0.0 (see 
http://www.rabbitmq.com/blog/2012/11/19/breaking-things-with-rabbitmq-3-0/)

It's usually worth checking the server logs when your client is 
misbehaving like this, they should contain an error message like:

=ERROR REPORT==== 28-Jan-2013::12:52:42 ===
AMQP connection <0.351.0> (running), channel 1 - error:
{amqp_error,not_implemented,"immediate=true",'basic.publish'}

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From bme at saseco.dk  Mon Jan 28 13:21:51 2013
From: bme at saseco.dk (Bernhard Mogens Ege)
Date: Mon, 28 Jan 2013 13:21:51 +0000
Subject: [rabbitmq-discuss] Upgraded RabbitMQ and now nothing works
In-Reply-To: <510674B2.5090508@rabbitmq.com>
References: <C44C93396408924FBBF479F57FD429FC058B9243@AM2PRD0210MB361.eurprd02.prod.outlook.com>
	<510674B2.5090508@rabbitmq.com>
Message-ID: <C44C93396408924FBBF479F57FD429FC058B92BB@AM2PRD0210MB361.eurprd02.prod.outlook.com>

Hmm yes, you are correct. I guess I can use the mandatory flag instead (I do get to know then if a submitted message doesn't fit into a queue, correct?).

Thanks,

Bernhard

-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: 28. januar 2013 13:53
To: Discussions about RabbitMQ
Cc: Bernhard Mogens Ege
Subject: Re: [rabbitmq-discuss] Upgraded RabbitMQ and now nothing works

On 28/01/13 12:43, Bernhard Mogens Ege wrote:
> I have just upgraded my RabbitMQ server from 2.8.7 to 3.0.1 (and erl 
> from 15b02 to 15b03). But now my RabbitMQ clients cannot communicate 
> with the server anymore and I am completely in the dark as to why. 
> This is the error I get:

It looks like you are trying to use immediate mode publish - support for immediate mode was removed in 3.0.0 (see
http://www.rabbitmq.com/blog/2012/11/19/breaking-things-with-rabbitmq-3-0/)

It's usually worth checking the server logs when your client is misbehaving like this, they should contain an error message like:

=ERROR REPORT==== 28-Jan-2013::12:52:42 === AMQP connection <0.351.0> (running), channel 1 - error:
{amqp_error,not_implemented,"immediate=true",'basic.publish'}

Cheers, Simon

--
Simon MacMullen
RabbitMQ, VMware



From simon at rabbitmq.com  Mon Jan 28 13:24:11 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 28 Jan 2013 13:24:11 +0000
Subject: [rabbitmq-discuss] Upgraded RabbitMQ and now nothing works
In-Reply-To: <C44C93396408924FBBF479F57FD429FC058B92BB@AM2PRD0210MB361.eurprd02.prod.outlook.com>
References: <C44C93396408924FBBF479F57FD429FC058B9243@AM2PRD0210MB361.eurprd02.prod.outlook.com>
	<510674B2.5090508@rabbitmq.com>
	<C44C93396408924FBBF479F57FD429FC058B92BB@AM2PRD0210MB361.eurprd02.prod.outlook.com>
Message-ID: <51067BFB.9090500@rabbitmq.com>

On 28/01/13 13:21, Bernhard Mogens Ege wrote:
> Hmm yes, you are correct. I guess I can use the mandatory flag
> instead (I do get to know then if a submitted message doesn't fit
> into a queue, correct?).

Yes, that's correct.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From matthias at rabbitmq.com  Mon Jan 28 13:28:52 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 28 Jan 2013 13:28:52 +0000
Subject: [rabbitmq-discuss] Upgraded RabbitMQ and now nothing works
In-Reply-To: <51067BFB.9090500@rabbitmq.com>
References: <C44C93396408924FBBF479F57FD429FC058B9243@AM2PRD0210MB361.eurprd02.prod.outlook.com>
	<510674B2.5090508@rabbitmq.com>
	<C44C93396408924FBBF479F57FD429FC058B92BB@AM2PRD0210MB361.eurprd02.prod.outlook.com>
	<51067BFB.9090500@rabbitmq.com>
Message-ID: <51067D14.2020900@rabbitmq.com>

On 28/01/13 13:24, Simon MacMullen wrote:
> On 28/01/13 13:21, Bernhard Mogens Ege wrote:
>> Hmm yes, you are correct. I guess I can use the mandatory flag
>> instead (I do get to know then if a submitted message doesn't fit
>> into a queue, correct?).
>
> Yes, that's correct.

Though note that there is no such condition as "message doesn't fit into 
a queue".

'mandatory' causes messages to be returned that *cannot be routed* to 
any queue, e.g. due to the exchange to which the message was published 
not having any bindings that match the message's routing key.

Matthias.

From prabodh.upreti at vce.com  Mon Jan 28 14:34:22 2013
From: prabodh.upreti at vce.com (Prabodh Upreti)
Date: Mon, 28 Jan 2013 06:34:22 -0800 (PST)
Subject: [rabbitmq-discuss] hostname change
Message-ID: <1359383662020-24717.post@n5.nabble.com>

Hello

I have a hostname change on a box after install.  I understand I have to do
a rabbitmq-server restart to recreate the database,log files and start the
server properly.

I have to modify my code to connect to new servername instead of localhost
on java client connect.

rabbitmqctl is failing I think because it is still trying to connect to
localhost. What do I fix that?  What else do I need to do?  Could you please
provide me some steps I need to follow. Thank you.

prabodh



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/hostname-change-tp24717.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From emile at rabbitmq.com  Mon Jan 28 15:28:21 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 28 Jan 2013 15:28:21 +0000
Subject: [rabbitmq-discuss] Potential Bug in C# Client
In-Reply-To: <22c4933a-6c71-4f67-9d23-501e9372d663@googlegroups.com>
References: <22c4933a-6c71-4f67-9d23-501e9372d663@googlegroups.com>
Message-ID: <51069915.3020901@rabbitmq.com>

Hi,

On 28/01/13 12:12, Graeme Taylor wrote:
> [...] I had set NoAck to TRUE. The result of this is after the first
> message, the bindings and queues are removed from the exchange and 
> no further messages are received by the subscriber.
> 
> Changing the NoAck to FALSE solved the issue.  Code samples
> available if required.

If you acknowledge a message which did not require an acknowledgement
then the broker will treat that as an error and close the channel. The
consequences that you describe are consistent with a closing channel. To
confirm you should check the broker logfile.

The other possible solution (other than setting NoAck to false) is not
to acknowledge messages when NoAck is true.


-Emile





From bme at saseco.dk  Mon Jan 28 16:26:11 2013
From: bme at saseco.dk (Bernhard Mogens Ege)
Date: Mon, 28 Jan 2013 16:26:11 +0000
Subject: [rabbitmq-discuss] Upgraded RabbitMQ and now nothing works
In-Reply-To: <51067D14.2020900@rabbitmq.com>
References: <C44C93396408924FBBF479F57FD429FC058B9243@AM2PRD0210MB361.eurprd02.prod.outlook.com>
	<510674B2.5090508@rabbitmq.com>
	<C44C93396408924FBBF479F57FD429FC058B92BB@AM2PRD0210MB361.eurprd02.prod.outlook.com>
	<51067BFB.9090500@rabbitmq.com> <51067D14.2020900@rabbitmq.com>
Message-ID: <C44C93396408924FBBF479F57FD429FC058B94B7@AM2PRD0210MB361.eurprd02.prod.outlook.com>

This is how I interpreted the original message. But thanks for clarifying. :)

(I wish Outlook supported your kind of email quoting...)


-----Original Message-----
From: Matthias Radestock [mailto:matthias at rabbitmq.com] 
Sent: 28. januar 2013 14:29
To: Discussions about RabbitMQ
Cc: Simon MacMullen; Bernhard Mogens Ege
Subject: Re: [rabbitmq-discuss] Upgraded RabbitMQ and now nothing works

On 28/01/13 13:24, Simon MacMullen wrote:
> On 28/01/13 13:21, Bernhard Mogens Ege wrote:
>> Hmm yes, you are correct. I guess I can use the mandatory flag 
>> instead (I do get to know then if a submitted message doesn't fit 
>> into a queue, correct?).
>
> Yes, that's correct.

Though note that there is no such condition as "message doesn't fit into a queue".

'mandatory' causes messages to be returned that *cannot be routed* to any queue, e.g. due to the exchange to which the message was published not having any bindings that match the message's routing key.

Matthias.



From romanass at gmail.com  Mon Jan 28 17:11:22 2013
From: romanass at gmail.com (Romanas)
Date: Mon, 28 Jan 2013 09:11:22 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ cluster with potentially millions
	of connections
In-Reply-To: <B7054A02-D98F-488F-A76B-EE22B047BE74@gmail.com>
References: <f75213a1-1571-415b-a5ba-e84c0d6bd0c9@googlegroups.com>
	<B7054A02-D98F-488F-A76B-EE22B047BE74@gmail.com>
Message-ID: <1359393082853-24720.post@n5.nabble.com>

Hi Jason,

mc717990 wrote
> Umm, I'm reasonably sure millions of persistent connections isn't possible
> through a single entry point.  First, with TCP/IP communications an
> interface only has 65k ports (roughly).  Of those, quite a few are
> typically in use for things like SSH requests or similar.  I'm actually
> surprised you made it to 30k simultaneous connections.  Now, you should be
> able to handle that many channels when distributed across a cluster - at
> least I think so though I've not really tested that situation.  The kicker
> is even if a server can handle say 30k connections and so you have your 50
> servers, the load balancer itself would become your bottle neck as it
> couldn't keep open a million persistent connections (again, 65k limit,
> which is really a lot lower).  Most load balancers act as a proxy, not as
> a DNS lookup in concept.

Yes I'm aware of this limitation - there are ways around it, e.g. having
multiple LBs and perform DNS load balancing on them (like the Amazon ELB
does) or having multiple outbound network interfaces on the LB. However
that's not the point. My problems is that even if I spread the load myself
without going through the LB, the cluster seems to grind to a halt after a
while. 

As Matthias suggested, I've switched to using a single exchange for all
connections (each connection with it's own routing key), however I'm still
struggling to go above 10-15k connections per node. I did disable the
management plugin on all but one node (just to keep track of what's going
on), but that didn't seem to help much. I'm pretty sure this isn't such an
obscure use case. Is there anything I could do to try troubleshooting this
(the log files aren't very useful!)? 

Regards,
Roman



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-cluster-with-potentially-millions-of-connections-tp24698p24720.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From tonygarnockjones+rabbitmq at gmail.com  Mon Jan 28 17:43:37 2013
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Mon, 28 Jan 2013 12:43:37 -0500
Subject: [rabbitmq-discuss] TCP-level connection limitations (was Re:
 RabbitMQ cluster with potentially millions of connections)
Message-ID: <CAM8fPiRV41h2ACCiCHO3SfJBY9P0-961hfycqJEtWWSb5aD5fA@mail.gmail.com>

Hi Jason,

On 26 January 2013 12:14, McIntosh Jason <mcintoshj at gmail.com> wrote:

> with TCP/IP communications an interface only has 65k ports (roughly).


If my understanding is correct, this is less of a limitation than it seems.

TCP connections are identified by a quad of source-IP, source-port, dest-IP
and dest-port. So if you have a service listening on 10.1.2.3 port 5672,
the connections will, on the server, look like

  192.168.34.56:43556 <--> 10.1.2.3:5672
  172.16.99.104:50602 <--> 10.1.2.3:5672
  10.202.14.66:61082 <--> 10.1.2.3:5672

and so on. In each case, the IP/port of the server's end of the socket is
the same. This means that you're not limited to 65k TCP connections per
interface; instead, you're limited to approximately 2^48
= 281,474,976,710,656 connections *per listening socket* :-)

The rest of your message is spot on, in particular regarding file
descriptor and memory limits in the operating system and C libraries.

Regards,
  Tony


-- 
Tony Garnock-Jones
tonygarnockjones at gmail.com
http://homepages.kcbbs.gen.nz/tonyg/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130128/3dceea2d/attachment.htm>

From simon at rabbitmq.com  Mon Jan 28 17:56:34 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 28 Jan 2013 17:56:34 +0000
Subject: [rabbitmq-discuss] RabbitMQ cluster with potentially millions
 of connections
In-Reply-To: <1359393082853-24720.post@n5.nabble.com>
References: <f75213a1-1571-415b-a5ba-e84c0d6bd0c9@googlegroups.com>
	<B7054A02-D98F-488F-A76B-EE22B047BE74@gmail.com>
	<1359393082853-24720.post@n5.nabble.com>
Message-ID: <5106BBD2.7030205@rabbitmq.com>

On 28/01/13 17:11, Romanas wrote:
> As Matthias suggested, I've switched to using a single exchange for all
> connections (each connection with it's own routing key), however I'm still
> struggling to go above 10-15k connections per node. I did disable the
> management plugin on all but one node (just to keep track of what's going
> on), but that didn't seem to help much. I'm pretty sure this isn't such an
> obscure use case. Is there anything I could do to try troubleshooting this
> (the log files aren't very useful!)?

I think Matthias meant to disable management altogether. Elsewhere you 
mentioned that the management overview page was very slow; this is a 
known issue with large numbers of queues / connections (which we are 
working on) so don't take that as evidence of the cluster grinding to a 
halt. And management does have some per-object overheads of its own; it 
would be good to eliminate them.

So what goes wrong when you start this many connections? (and queues - I 
assume you still have one queue per connection?) Do you run out of 
memory, does CPU reach 100%? "rabbitmqctl status" can tell you more 
about where memory is going.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Mon Jan 28 17:56:37 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 28 Jan 2013 17:56:37 +0000
Subject: [rabbitmq-discuss] TCP-level connection limitations (was Re:
 RabbitMQ cluster with potentially millions of connections)
In-Reply-To: <CAM8fPiRV41h2ACCiCHO3SfJBY9P0-961hfycqJEtWWSb5aD5fA@mail.gmail.com>
References: <CAM8fPiRV41h2ACCiCHO3SfJBY9P0-961hfycqJEtWWSb5aD5fA@mail.gmail.com>
Message-ID: <5106BBD5.9010200@rabbitmq.com>

On 28/01/13 17:43, Tony Garnock-Jones wrote:
> This means that you're not limited to 65k TCP connections
> per interface; instead, you're limited to approximately 2^48
> = 281,474,976,710,656 connections *per listening socket* :-)

Well, for that number you'd have to take over the world and dedicate the 
whole internet to your task. And do so before any IPv6 transition happens.

Nevertheless it's a large number.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From brettflitter at gmail.com  Mon Jan 28 18:15:21 2013
From: brettflitter at gmail.com (nybras)
Date: Mon, 28 Jan 2013 10:15:21 -0800 (PST)
Subject: [rabbitmq-discuss] User Permissions
In-Reply-To: <1359228441933-24702.post@n5.nabble.com>
References: <1359228441933-24702.post@n5.nabble.com>
Message-ID: <1359396921172-24724.post@n5.nabble.com>

Is my question just too stupid to be answered? Can someone please point me in
the right direction please? The RabbitMQ doc doesn't explain it in layman's
terms.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/User-Permissions-tp24702p24724.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From jerryk at rbcon.com  Mon Jan 28 18:54:37 2013
From: jerryk at rbcon.com (Jerry Kuch)
Date: Mon, 28 Jan 2013 10:54:37 -0800
Subject: [rabbitmq-discuss] User Permissions
In-Reply-To: <1359228441933-24702.post@n5.nabble.com>
References: <1359228441933-24702.post@n5.nabble.com>
Message-ID: <CAE0Sz=wyszL5e-QcmReXbYoCr3h=vH_wtWD9ayf9Fh_mJSUcnw@mail.gmail.com>

Hi, Nybras:

On Sat, Jan 26, 2013 at 11:27 AM, nybras <brettflitter at gmail.com> wrote:

> Hi I don't really understand how to use the regular expressions to dictate
> what the user can and can't do in the management plugin.
>

Please see here:  http://www.rabbitmq.com/management.html

Note also, that things changed and became a bit more flexibly a few
versions ago.


> I'm also not really sure about how to go about security. At the moment I've
> created an app which connects just through one account (admin/root account)
> with no permission restrictions which I'm guessing is not good.


Probably not.  You'd want to create a user account for that app, and then
adorn it with the permissions needed to perform the various AMQP operations
it needs to perform as it goes about its business.

See here for summary information:
http://www.rabbitmq.com/access-control.html

Note that rather than an ACL, listing who can do a thing to an AMQP object,
the permissions model works the other direction, perhaps slightly more akin
to a bare bones capabilities system.

In the Rabbit model, a user has configure, read and write permissions.
 Associated with each is a regex naming the resources that the user is
allowed to configure/read/write.  Each AMQP command requires the resource
it's trying to operate on to match the appropriate permission regex as
summarized in the table at http://www.rabbitmq.com/access-control.html


>  Do I create
> a 'user' account for each new user that uses my app or I do I create one
> 'user' account with restricted permissions that all users can connect
> through??
>

That depends on your application.  If the users of your messaging system
really need disparate and partitioned access control, you may have to
create multiple accounts.  Otherwise, it's common to see multiple logical
applications in a broker (e.g. payment processing, status updates, etc.)
and to perhaps create a user per logical app with suitable permissions,
assuming of course there isn't going to be a single user whose concerns
span the entities of both.  You can also segregate at the virtual host
level which is an even sharper division.


> I've started using the http API so I can make requests to see how many
> bindings a user has made which is also currently being accessed through
> this
> 'one admin account', should I just create a basic user account to allow
> these GET requests? Again I don't understand what to do with the regular
> expressions.
>

For access to management capabilities themselves, things are a bit
different.  The management plugin extends the basic AMQP permissions model
up above and allows arbitrary tags to be attached to users.  The management
plugin respects tags called "management", "monitoring" and "administrator,"
each of which has different powers over administrative functions as
summarized at:  http://www.rabbitmq.com/management.html

Give those links a look, see how well they digest, and by all means return
if you have further questions!

Best regards,
Jerry
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130128/3e6f6c79/attachment.htm>

From jerryk at rbcon.com  Mon Jan 28 18:55:56 2013
From: jerryk at rbcon.com (Jerry Kuch)
Date: Mon, 28 Jan 2013 10:55:56 -0800
Subject: [rabbitmq-discuss] hostname change
In-Reply-To: <1359383662020-24717.post@n5.nabble.com>
References: <1359383662020-24717.post@n5.nabble.com>
Message-ID: <CAE0Sz=xMP+LUxC4L6Bqi5AubjrgcjnEvs5TVtF=uoM9r1f5qDg@mail.gmail.com>

Hi, Prabodh:

Can you post what exactly you're seeing when rabbitmqctl fails?  There are
a number of possible causes...

Jerry

On Mon, Jan 28, 2013 at 6:34 AM, Prabodh Upreti <prabodh.upreti at vce.com>wrote:

> Hello
>
> I have a hostname change on a box after install.  I understand I have to do
> a rabbitmq-server restart to recreate the database,log files and start the
> server properly.
>
> I have to modify my code to connect to new servername instead of localhost
> on java client connect.
>
> rabbitmqctl is failing I think because it is still trying to connect to
> localhost. What do I fix that?  What else do I need to do?  Could you
> please
> provide me some steps I need to follow. Thank you.
>
> prabodh
>
>
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/hostname-change-tp24717.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130128/0d8b1a56/attachment.htm>

From mcintoshj at gmail.com  Mon Jan 28 19:16:43 2013
From: mcintoshj at gmail.com (McIntosh Jason)
Date: Mon, 28 Jan 2013 13:16:43 -0600
Subject: [rabbitmq-discuss] TCP-level connection limitations (was Re:
	RabbitMQ cluster with potentially millions of connections)
In-Reply-To: <CAM8fPiRV41h2ACCiCHO3SfJBY9P0-961hfycqJEtWWSb5aD5fA@mail.gmail.com>
References: <CAM8fPiRV41h2ACCiCHO3SfJBY9P0-961hfycqJEtWWSb5aD5fA@mail.gmail.com>
Message-ID: <524EF106-ACC1-4489-AF7B-34FE6FD69789@gmail.com>

The kicker is if there's a load balancer between then the load balancer would act as a proxy to the various nodes - so it has a limited number of connections it can make to a single server.

So a suggestion - remove the load balancer and even cluster - start with a single box.  See how many connections it can handle solo.  Though if possible limited connections with multiple channels is a better idea.

Jason

Sent from my iPhone

On Jan 28, 2013, at 11:43 AM, Tony Garnock-Jones <tonygarnockjones+rabbitmq at gmail.com> wrote:

> Hi Jason,
> 
> On 26 January 2013 12:14, McIntosh Jason <mcintoshj at gmail.com> wrote:
>> with TCP/IP communications an interface only has 65k ports (roughly).
> 
> If my understanding is correct, this is less of a limitation than it seems.
> 
> TCP connections are identified by a quad of source-IP, source-port, dest-IP and dest-port. So if you have a service listening on 10.1.2.3 port 5672, the connections will, on the server, look like
> 
>   192.168.34.56:43556 <--> 10.1.2.3:5672
>   172.16.99.104:50602 <--> 10.1.2.3:5672
>   10.202.14.66:61082 <--> 10.1.2.3:5672
> 
> and so on. In each case, the IP/port of the server's end of the socket is the same. This means that you're not limited to 65k TCP connections per interface; instead, you're limited to approximately 2^48 = 281,474,976,710,656 connections *per listening socket* :-)
> 
> The rest of your message is spot on, in particular regarding file descriptor and memory limits in the operating system and C libraries.
> 
> Regards,
>   Tony
> 
> 
> -- 
> Tony Garnock-Jones
> tonygarnockjones at gmail.com
> http://homepages.kcbbs.gen.nz/tonyg/ 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130128/7695d234/attachment.htm>

From romanass at gmail.com  Mon Jan 28 20:42:50 2013
From: romanass at gmail.com (Romanas)
Date: Mon, 28 Jan 2013 20:42:50 +0000
Subject: [rabbitmq-discuss] RabbitMQ cluster with potentially millions
	of connections
In-Reply-To: <5106BBD2.7030205@rabbitmq.com>
References: <f75213a1-1571-415b-a5ba-e84c0d6bd0c9@googlegroups.com>
	<B7054A02-D98F-488F-A76B-EE22B047BE74@gmail.com>
	<1359393082853-24720.post@n5.nabble.com>
	<5106BBD2.7030205@rabbitmq.com>
Message-ID: <CABHYwy866TWdOYQMjBq4K7FuN6iS6=19inNs9s=SE+Pvj3JO9Q@mail.gmail.com>

Hi Simon,


> I think Matthias meant to disable management altogether. Elsewhere you
> mentioned that the management overview page was very slow; this is a known
> issue with large numbers of queues / connections (which we are working on)
> so don't take that as evidence of the cluster grinding to a halt. And
> management does have some per-object overheads of its own; it would be good
> to eliminate them.
>

I'll try disabling management altogether and see what happens then - I'll
post my results. Although if you do that, it gets annoyingly difficult to
see what's going on.


> So what goes wrong when you start this many connections? (and queues - I
> assume you still have one queue per connection?) Do you run out of memory,
> does CPU reach 100%? "rabbitmqctl status" can tell you more about where
> memory is going.
>

Both CPU and RAM seem to be increasing at a stable pace and are nowhere
near the limits. At some point one node decides to lock up (=no new
connections), then another, then another... It would look very much like
running out of file handles / sockets, but those are nowhere near the
limits as well (30k out of 100k limit for open sockets) and there's nothing
in the logs. I'll do some more tests and try to play around with logging to
get some more out of this, maybe it's AWS imposing some secret limits.


Regards,
Roman
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130128/5752b966/attachment.htm>

From cao at ll.mit.edu  Mon Jan 28 21:36:53 2013
From: cao at ll.mit.edu (Cao, Yican - 0551 - MITLL)
Date: Mon, 28 Jan 2013 16:36:53 -0500
Subject: [rabbitmq-discuss] Federation in a cluster
Message-ID: <3A89DE15-04CB-4209-90A4-A694A3170C0C@ll.mit.edu>

Hi,


In federation document, it says:
"When using a federation in a cluster, all the nodes of the cluster must have the federation plugin installed. ..."

I have 2 clustered HAQ nodes [A, B, C] and [E, F].
[A, B, C] is clustered and so does [E, F].

Do I have to:
in E:
rabbitmqctl set_parameter federation-upstream my-upstream '{"uri":"amqp://A", "expires":3600}'
rabbitmqctl set_policy...
....
rabbitmqctl set_parameter federation-upstream my-upstream '{"uri":"amqp://B", "expires":3600}'
rabbitmqctl set_policy...
....
rabbitmqctl set_parameter federation-upstream my-upstream '{"uri":"amqp://C", "expires":3600}'
rabbitmqctl set_policy...
....


and do the same in F:
rabbitmqctl set_parameter federation-upstream my-upstream '{"uri":"amqp://A", "expires":3600}'
rabbitmqctl set_policy...
....
rabbitmqctl set_parameter federation-upstream my-upstream '{"uri":"amqp://B", "expires":3600}'
rabbitmqctl set_policy...
....
rabbitmqctl set_parameter federation-upstream my-upstream '{"uri":"amqp://C", "expires":3600}'
rabbitmqctl set_policy...
....

?


If I want to use Pair of federated exchanges in your example topologies,

Shall I setup same in A, B and C?


Thanks.


Yican Cao
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 5652 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130128/84eaaef8/attachment.bin>

From matthias at rabbitmq.com  Mon Jan 28 22:00:04 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 28 Jan 2013 22:00:04 +0000
Subject: [rabbitmq-discuss] How to debug queue memory leak
In-Reply-To: <5106565C.7070108@rabbitmq.com>
References: <b428c3a8-1a26-40a8-a5aa-8bac4446d350@googlegroups.com>
	<5102A872.3000801@rabbitmq.com>
	<CAGb0cFmoEFqTMbNKKqAO2bLjjp2EGMX8owONbBby97zrq1WJwQ@mail.gmail.com>
	<5106349E.6010208@rabbitmq.com>
	<CAGb0cFksGm8SM7q_hLHPadDq0VXCdwXq21XMz1suB6bY6=V6gw@mail.gmail.com>
	<5106565C.7070108@rabbitmq.com>
Message-ID: <5106F4E4.10706@rabbitmq.com>

On 28/01/13 10:43, Matthias Radestock wrote:
> Btw, it appears that your previous message didn't make it to the mailing
> list. Would you mind re-sending it?

Please do that; the process_info output it shows is quite important.

I think I have some idea of what's going on. To help me analyse this 
further, please also post the output of

rabbitmqctl eval 'sys:get_status(rabbit_misc:string_to_pid("<ThePid>")).'

for the pid of the queue we've been looking at.


Regards,

Matthias.

From hcoyote at ghostar.org  Mon Jan 28 22:02:11 2013
From: hcoyote at ghostar.org (Travis)
Date: Mon, 28 Jan 2013 16:02:11 -0600
Subject: [rabbitmq-discuss] Detecting mnesia network partitions in 2.8.6
Message-ID: <CAChq9g0_p-Rf9q48=QvZ+3wc7awq8hbPAyeXstu9UJedRgi0-w@mail.gmail.com>

Hello,

We recently discovered that our 2.8.6 cluster is occasionally partitioning
itself.  We're trying to come up with a method to detect this so we can
respond in a more timely manner.

http://www.rabbitmq.com/partitions.html says that doing a rabbitmqctl
cluster_status should show something like:

# rabbitmqctl cluster_status
Cluster status of node rabbit at smacmullen ...
[{nodes,[{disc,[hare at smacmullen,rabbit at smacmullen]}]},
 {running_nodes,[rabbit at smacmullen,hare at smacmullen]},
 {partitions,[]}]
...done.


to give you an idea of any partitions that might be occurring.

2.8.6 has a different output, though:

Cluster status of node 'rabbit at aus-rmq4' ...
[{nodes,[{disc,['rabbit at aus-rmq3','rabbit at aus-rmq4']}]},
 {running_nodes,['rabbit at aus-rmq3','rabbit at aus-rmq4']}]
...done.


So, my questions are:

1) is this partitions output a feature of a newer version of RabbitMQ?
 Which version?
2) Is there a reliable way of detecting a partitioned mnesia database in
2.8.6 that doesn't rely upon tailing the log file and looking for something
like:

  Mnesia('rabbit at aus-rmq4'): ** ERROR ** mnesia_event got
{inconsistent_database, starting_partitioned_network, 'rabbit at aus-rmq3'}

We will be upgrading soon, but we're not quite through with our testing yet
so we can't just flip the version right now.

Thanks,
Travis

-- 
Travis Campbell
travis at ghostar.org
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130128/5488b764/attachment.htm>

From simon at rabbitmq.com  Mon Jan 28 22:15:08 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 28 Jan 2013 22:15:08 +0000
Subject: [rabbitmq-discuss] Detecting mnesia network partitions in 2.8.6
In-Reply-To: <CAChq9g0_p-Rf9q48=QvZ+3wc7awq8hbPAyeXstu9UJedRgi0-w@mail.gmail.com>
References: <CAChq9g0_p-Rf9q48=QvZ+3wc7awq8hbPAyeXstu9UJedRgi0-w@mail.gmail.com>
Message-ID: <5106F86C.6090305@rabbitmq.com>

On 28/01/2013 10:02PM, Travis wrote:
> 1) is this partitions output a feature of a newer version of RabbitMQ?
>   Which version?

Yes, 3.0.0.

> 2) Is there a reliable way of detecting a partitioned mnesia database in
> 2.8.6 that doesn't rely upon tailing the log file and looking for
> something like:
>
>    Mnesia('rabbit at aus-rmq4'): ** ERROR ** mnesia_event got
> {inconsistent_database, starting_partitioned_network, 'rabbit at aus-rmq3'}

No, that's all you have in 2.x I'm afraid.

Cheers, Simon

From mek at mek.uz.ua  Mon Jan 28 22:43:51 2013
From: mek at mek.uz.ua (Max Kuznecov)
Date: Tue, 29 Jan 2013 00:43:51 +0200
Subject: [rabbitmq-discuss] How to debug queue memory leak
In-Reply-To: <5106F4E4.10706@rabbitmq.com>
References: <b428c3a8-1a26-40a8-a5aa-8bac4446d350@googlegroups.com>
	<5102A872.3000801@rabbitmq.com>
	<CAGb0cFmoEFqTMbNKKqAO2bLjjp2EGMX8owONbBby97zrq1WJwQ@mail.gmail.com>
	<5106349E.6010208@rabbitmq.com>
	<CAGb0cFksGm8SM7q_hLHPadDq0VXCdwXq21XMz1suB6bY6=V6gw@mail.gmail.com>
	<5106565C.7070108@rabbitmq.com> <5106F4E4.10706@rabbitmq.com>
Message-ID: <CAGb0cFkaS-e08qXK9kaQdCqAvCa7hOjwVHK62Vc=wqAUc0us_A@mail.gmail.com>

Here's again my data:

rabbitmqctl report: http://pastebin.com/Qj5m2kjY

rabbitmqctl eval
'process_info(rabbit_misc:string_to_pid("<rabbit at sps.3.3412.3>")).':

[{current_function,{gen_server2,process_next_msg,1}},
 {initial_call,{proc_lib,init_p,5}},
 {status,waiting},
 {message_queue_len,0},
 {messages,[]},
 {links,[#Port<5267.151951>,<5267.216.0>]},
 {dictionary,[{fhc_age_tree,{1,
                             {{1359,412427,139619},
                              #Ref<5267.0.145.241905>,nil,nil}}},
              {{xtype_to_module,direct},rabbit_exchange_type_direct},
              {{credit_to,<5267.3349.3>},37},
              {{"/var/lib/rabbitmq/mnesia/rabbit at sps/queues/CETWHIRGIYJIN4QVAPTOYM3TM/journal.jif",
                fhc_file},
               {file,1,true}},
              {{#Ref<5267.0.145.241905>,fhc_handle},
               {handle,{file_descriptor,prim_file,{#Port<5267.151951>,65}},
                       3333456,false,0,infinity,[],true,

"/var/lib/rabbitmq/mnesia/rabbit at sps/queues/CETWHIRGIYJIN4QVAPTOYM3TM/journal.jif",
                       [write,binary,raw,read],
                       [{write_buffer,infinity}],
                       true,true,
                       {1359,412427,139619}}},
              {'$ancestors',[rabbit_amqqueue_sup,rabbit_sup,<5267.155.0>]},
              {{credit_from,<5267.210.0>},1519},
              {{credit_to,<5267.3365.3>},32},
              {guid,{{269445283,67762708,3568719908,1494013915},1}},
              {'$initial_call',{gen,init_it,6}}]},
 {trap_exit,true},
 {error_handler,error_handler},
 {priority,normal},
 {group_leader,<5267.154.0>},
 {total_heap_size,2103540},
 {heap_size,2103540},
{stack_size,7},
 {reductions,403100490},
 {garbage_collection,[{min_bin_vheap_size,46368},
                      {min_heap_size,233},
                      {fullsweep_after,65535},
                      {minor_gcs,0}]},
 {suspending,[]}]

rabbitmqctl eval
'sys:get_status(rabbit_misc:string_to_pid("<rabbit at sps.3.3412.3>")).
output is huge - 15 megabyte!
I've compressed it - http://dl.dropbox.com/u/22762166/report2.bz2

P.S. I'm posting the messages to the list as well, but then I get auto
reply - "message is pending for approval" or something like that.

2013/1/29 Matthias Radestock <matthias at rabbitmq.com>:
> On 28/01/13 10:43, Matthias Radestock wrote:
>>
>> Btw, it appears that your previous message didn't make it to the mailing
>> list. Would you mind re-sending it?
>
>
> Please do that; the process_info output it shows is quite important.
>
> I think I have some idea of what's going on. To help me analyse this
> further, please also post the output of
>
> rabbitmqctl eval 'sys:get_status(rabbit_misc:string_to_pid("<ThePid>")).'
>
> for the pid of the queue we've been looking at.
>
>
> Regards,
>
> Matthias.



-- 
~syhpoon

From matthias at rabbitmq.com  Mon Jan 28 23:11:21 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 28 Jan 2013 23:11:21 +0000
Subject: [rabbitmq-discuss] Detecting mnesia network partitions in 2.8.6
In-Reply-To: <CAChq9g0_p-Rf9q48=QvZ+3wc7awq8hbPAyeXstu9UJedRgi0-w@mail.gmail.com>
References: <CAChq9g0_p-Rf9q48=QvZ+3wc7awq8hbPAyeXstu9UJedRgi0-w@mail.gmail.com>
Message-ID: <51070599.2090307@rabbitmq.com>

Travis,

Simon has already answered the substance of your question, but as an 
aside...

On 28/01/13 22:02, Travis wrote:
> http://www.rabbitmq.com/partitions.html says that doing a rabbitmqctl
> cluster_status should show something like: [...]
> 2.8.6 has a different output, though: [...]

The docs for 2.8.7 are available at http://previous.rabbitmq.com/


Regards,

Matthias.

From matthias at rabbitmq.com  Mon Jan 28 23:28:03 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 28 Jan 2013 23:28:03 +0000
Subject: [rabbitmq-discuss] How to debug queue memory leak
In-Reply-To: <CAGb0cFkaS-e08qXK9kaQdCqAvCa7hOjwVHK62Vc=wqAUc0us_A@mail.gmail.com>
References: <b428c3a8-1a26-40a8-a5aa-8bac4446d350@googlegroups.com>
	<5102A872.3000801@rabbitmq.com>
	<CAGb0cFmoEFqTMbNKKqAO2bLjjp2EGMX8owONbBby97zrq1WJwQ@mail.gmail.com>
	<5106349E.6010208@rabbitmq.com>
	<CAGb0cFksGm8SM7q_hLHPadDq0VXCdwXq21XMz1suB6bY6=V6gw@mail.gmail.com>
	<5106565C.7070108@rabbitmq.com> <5106F4E4.10706@rabbitmq.com>
	<CAGb0cFkaS-e08qXK9kaQdCqAvCa7hOjwVHK62Vc=wqAUc0us_A@mail.gmail.com>
Message-ID: <51070983.8020605@rabbitmq.com>

On 28/01/13 22:43, Max Kuznecov wrote:
> Here's again my data: [...]

Cheers.

This confirms what I thought. Your setup is pathological ;) The 
combination of a large number of slow-moving (but never slow enough to 
hibernate) queues with persistent messages causes a substantial amount 
of data to be held in memory for a long period of time. The memory usage 
should be bounded at a few tens of Mb per queue, but that's obviously 
quite a lot when there are many queues.

I will file a bug to investigate what we can do about this.

Meanwhile, one way to reduce the memory usage is to configure rabbit 
with a lower queue index journal size by putting s.t. like the following 
into your rabbitmq.config:

[{rabbit, [{queue_index_max_journal_entries, 65536}]}].

The default value here is 262144, and the above should cut your max 
per-queue memory usage to about 1/4th.

Regards,

Matthias.

From hcoyote at ghostar.org  Tue Jan 29 00:22:48 2013
From: hcoyote at ghostar.org (Travis)
Date: Mon, 28 Jan 2013 18:22:48 -0600
Subject: [rabbitmq-discuss] Detecting mnesia network partitions in 2.8.6
In-Reply-To: <5106F86C.6090305@rabbitmq.com>
References: <CAChq9g0_p-Rf9q48=QvZ+3wc7awq8hbPAyeXstu9UJedRgi0-w@mail.gmail.com>
	<5106F86C.6090305@rabbitmq.com>
Message-ID: <CAChq9g3f8qXm_VnT31ZNoUVa9La+RVDn3yxhLuY4bZZk64XQ+g@mail.gmail.com>

On Mon, Jan 28, 2013 at 4:15 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 28/01/2013 10:02PM, Travis wrote:
>
>> 1) is this partitions output a feature of a newer version of RabbitMQ?
>>   Which version?
>>
>
> Yes, 3.0.0.
>
>
>  2) Is there a reliable way of detecting a partitioned mnesia database in
>> 2.8.6 that doesn't rely upon tailing the log file and looking for
>> something like:
>>
>>    Mnesia('rabbit at aus-rmq4'): ** ERROR ** mnesia_event got
>> {inconsistent_database, starting_partitioned_network, 'rabbit at aus-rmq3'}
>>
>
> No, that's all you have in 2.x I'm afraid.
>

Awesome, thanks.

I'll just setup a logstash config to follow the file and forward an event
off for alerting then.

Travis
-- 
Travis Campbell
travis at ghostar.org
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130128/edcd2311/attachment.htm>

From mek at mek.uz.ua  Tue Jan 29 01:11:49 2013
From: mek at mek.uz.ua (Max Kuznecov)
Date: Tue, 29 Jan 2013 03:11:49 +0200
Subject: [rabbitmq-discuss] How to debug queue memory leak
In-Reply-To: <51070983.8020605@rabbitmq.com>
References: <b428c3a8-1a26-40a8-a5aa-8bac4446d350@googlegroups.com>
	<5102A872.3000801@rabbitmq.com>
	<CAGb0cFmoEFqTMbNKKqAO2bLjjp2EGMX8owONbBby97zrq1WJwQ@mail.gmail.com>
	<5106349E.6010208@rabbitmq.com>
	<CAGb0cFksGm8SM7q_hLHPadDq0VXCdwXq21XMz1suB6bY6=V6gw@mail.gmail.com>
	<5106565C.7070108@rabbitmq.com> <5106F4E4.10706@rabbitmq.com>
	<CAGb0cFkaS-e08qXK9kaQdCqAvCa7hOjwVHK62Vc=wqAUc0us_A@mail.gmail.com>
	<51070983.8020605@rabbitmq.com>
Message-ID: <CAGb0cFn4BWQepMTbvwLp6Rg9SpLJURnwHa5TJHcbUyjEYMtbRw@mail.gmail.com>

2013/1/29 Matthias Radestock <matthias at rabbitmq.com>:
> {queue_index_max_journal_entries, 65536}

Thank you, Matthias!

I'll try to set this option. Also I've implemented some garbage
collection of idle queues in my pool, so, I hope all this combined
will fix the problem.

--
~syhpoon

From toby.corkindale at strategicdata.com.au  Tue Jan 29 04:59:55 2013
From: toby.corkindale at strategicdata.com.au (Toby Corkindale)
Date: Tue, 29 Jan 2013 15:59:55 +1100
Subject: [rabbitmq-discuss] 3.0.1 STOMP bug - reply-to header
In-Reply-To: <50D4820F.4020700@rabbitmq.com>
References: <50D3B048.6020803@strategicdata.com.au>
	<50D4820F.4020700@rabbitmq.com>
Message-ID: <5107574B.90305@strategicdata.com.au>

On 22/12/12 02:36, Matthias Radestock wrote:
> Toby,
>
> On 21/12/12 00:41, Toby Corkindale wrote:
>> When testing against RabbitMQ 3.0.1, we're seeing what looks like a bug
>> and regression compared to the last 2.9 version.
>>
>> The stomp adapter is turning a reply-to header for a topic queue into a
>> temp queue.
>> Eg, the reply queue name is getting munged from
>>    /topic/foo.export.pid    to  /reply-queue//topic/foo.export.pid
>
> This looks like an accidental side effect of the change we made to allow
> AMQP clients to handle reply-to headers created by stomp clients. Thanks
> for reporting this. I have filed a bug.

Hi Matthias,
I wondered how this bug was going?
I couldn't see it listed at either of these addresses, so wondered if 
it'd been fixed and I'd just missed the release announcement?

https://github.com/rabbitmq/rabbitmq-server/issues
https://github.com/rabbitmq/rabbitmq-stomp/issues

cheers,
Toby

From antouboduor at gmail.com  Tue Jan 29 07:39:27 2013
From: antouboduor at gmail.com (Anthony Oduor)
Date: Tue, 29 Jan 2013 10:39:27 +0300
Subject: [rabbitmq-discuss] Cannot access rabbitmqadmin.
In-Reply-To: <5101367C.6000005@rabbitmq.com>
References: <5753af5f-6c71-42db-91db-58279c63d685@googlegroups.com>
	<0790b109-e918-4261-924e-129cd7978e99@googlegroups.com>
	<5101367C.6000005@rabbitmq.com>
Message-ID: <CAEey+bJXVYP_q-yaiKZa3CMX0Ph1CK0jMWyyt+eU=KwqspFsUg@mail.gmail.com>

Hello,

Encountered this issue too. Everything is running fine, ports 4369 with
epmd is up, but cannot access the web management page.

$ ./rabbitmq-plugins list
[e] amqp_client                       2.8.4
[ ] eldap                             2.8.4-git
[ ] erlando                           2.8.4
[e] mochiweb                          1.3-rmq2.8.4-git
[ ] rabbitmq_auth_backend_ldap        2.8.4
[ ] rabbitmq_auth_mechanism_ssl       2.8.4
[ ] rabbitmq_consistent_hash_exchange 2.8.4
[ ] rabbitmq_federation               2.8.4
[ ] rabbitmq_federation_management    2.8.4
[ ] rabbitmq_jsonrpc                  2.8.4
[ ] rabbitmq_jsonrpc_channel          2.8.4
[ ] rabbitmq_jsonrpc_channel_examples 2.8.4
[E] rabbitmq_management               2.8.4
[e] rabbitmq_management_agent         2.8.4
[E] rabbitmq_management_visualiser    2.8.4
[e] rabbitmq_mochiweb                 2.8.4
[ ] rabbitmq_shovel                   2.8.4
[ ] rabbitmq_shovel_management        2.8.4
[ ] rabbitmq_stomp                    2.8.4
[ ] rabbitmq_tracing                  2.8.4
[ ] rfc4627_jsonrpc                   2.8.4-git
[e] webmachine                        1.7.0-rmq2.8.4-hg

But it still failed to activate the plugins this time.

The log ends without activating the plugins, see below:

...
-- message delivery logic ready
starting error log relay
 ...done
starting networking
...done
starting direct client
 ...done
starting notify cluster nodes
...done

broker running
** Found 0 name clashes in code paths

RabbitMQ v2.8.4, Ubuntu 10.04

Thanks!

On Thu, Jan 24, 2013 at 4:26 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> Ah - so you were using "rabbitmqctl stop_app" and "rabbitmqctl start_app"
> - yes that would not work since they never halt the Erlang VM. "service
> rabbitmq-server restart" would have worked without a reboot.
>
> I guess we should try to make that clearer.
>
> Cheers, Simon
>
>
> On 24/01/13 05:56, Alex Damian wrote:
>
>> I finally got it working. Restarting and stopping the server with
>> rabbitmqctl did not work. So I rebooted then restarted directly with the
>> rabbitmq-server start command and this time it seemed to load all the
>> plugins including Mochiweb and I was able to open the admin webpage. I'm
>> not sure why it did not work immediately after the plugins were
>> enabled...however I'm happy with this solution albeit not ideal since it
>> required a reboot.
>>
>> On Tuesday, January 22, 2013 5:23:24 PM UTC-5, Alex Damian wrote:
>>
>>     Hi
>>
>>     I have followed all the instructions on
>>     http://www.rabbitmq.com/**management.html<http://www.rabbitmq.com/management.html>
>>     <http://www.rabbitmq.com/**management.html<http://www.rabbitmq.com/management.html>>
>> and enabled the plugin,
>>     but after than there is no webserver running anywhere on my machine.
>>     There is no way to connect to Mochiweb at all. I have restarted the
>>     service and still nothing. I have also tried the
>>     "http:///server-name/:15672/" URL with "localhost", 127.0.0.1 and
>>
>>     also the full server name, all of which are /etc/hosts file. My
>>     vhost is the default "/". Should I add something in my config file
>>     perhaps? I have also tried a /curl/ command and still nothing.
>>
>>
>>     I am running on Fedora Core 17 with all latest libs including latest
>>     rabbitMQ sw. I have checked the listening ports on the server and i
>>     only see the AMQP one.
>>     Also I can run rabbitmq-server and rabbitmqctl without issues. I
>>     have also been able to create exchanges/queues via rabbit.js on
>>     Node. However not having a proper admin tool is a bit drawback. I
>>     wonder why it's not possible to supply one like (or enhance)
>>     rabbitmqctl. Seems to do the job just fine.
>>
>>     Any help would be greatly appreciated!
>>
>>
>>
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>



-- 

http://about.me/outhorand/bio
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130129/2175399c/attachment.htm>

From matthias at rabbitmq.com  Tue Jan 29 09:24:47 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 29 Jan 2013 09:24:47 +0000
Subject: [rabbitmq-discuss] 3.0.1 STOMP bug - reply-to header
In-Reply-To: <5107574B.90305@strategicdata.com.au>
References: <50D3B048.6020803@strategicdata.com.au>
	<50D4820F.4020700@rabbitmq.com>
	<5107574B.90305@strategicdata.com.au>
Message-ID: <5107955F.7060306@rabbitmq.com>

Toby,

On 29/01/13 04:59, Toby Corkindale wrote:
> On 22/12/12 02:36, Matthias Radestock wrote:
>> On 21/12/12 00:41, Toby Corkindale wrote:
>>> When testing against RabbitMQ 3.0.1, we're seeing what looks like a bug
>>> and regression compared to the last 2.9 version.
>>>
>>> The stomp adapter is turning a reply-to header for a topic queue into a
>>> temp queue.
>>> Eg, the reply queue name is getting munged from
>>>    /topic/foo.export.pid    to  /reply-queue//topic/foo.export.pid
>>
>> This looks like an accidental side effect of the change we made to allow
>> AMQP clients to handle reply-to headers created by stomp clients. Thanks
>> for reporting this. I have filed a bug.
>
> I wondered how this bug was going?
> I [...] wondered if it'd been fixed and I'd just missed the release
> announcement?

It's been fixed but not released yet - 3.0.1, the version you were 
testing, is (still) the most recent rabbit release.

If you don't want to wait until the next release you can try a nightly 
build - http://www.rabbitmq.com/nightly-builds.html

Regards,

Matthias.

From simon at rabbitmq.com  Tue Jan 29 10:31:31 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 29 Jan 2013 10:31:31 +0000
Subject: [rabbitmq-discuss] Cannot access rabbitmqadmin.
In-Reply-To: <CAEey+bJXVYP_q-yaiKZa3CMX0Ph1CK0jMWyyt+eU=KwqspFsUg@mail.gmail.com>
References: <5753af5f-6c71-42db-91db-58279c63d685@googlegroups.com>
	<0790b109-e918-4261-924e-129cd7978e99@googlegroups.com>
	<5101367C.6000005@rabbitmq.com>
	<CAEey+bJXVYP_q-yaiKZa3CMX0Ph1CK0jMWyyt+eU=KwqspFsUg@mail.gmail.com>
Message-ID: <5107A503.3090505@rabbitmq.com>

Hmm. Your symptoms are consistent with rabbitmq-plugins and 
rabbitmq-server using a different enabled_plugins file. How did you 
install RabbitMQ? I notice that you are invoking rabbitmq-plugins from 
the current directory as a normal user, so did you perform a manual 
installation?

If so, make sure that both rabbitmq-plugins and rabbitmq-server see the 
same value for RABBITMQ_ENABLED_PLUGINS_FILE.

Cheers, Simon

On 29/01/13 07:39, Anthony Oduor wrote:
> Hello,
>
> Encountered this issue too. Everything is running fine, ports 4369 with
> epmd is up, but cannot access the web management page.
>
> $ ./rabbitmq-plugins list
> [e] amqp_client                       2.8.4
> [ ] eldap                             2.8.4-git
> [ ] erlando                           2.8.4
> [e] mochiweb                          1.3-rmq2.8.4-git
> [ ] rabbitmq_auth_backend_ldap        2.8.4
> [ ] rabbitmq_auth_mechanism_ssl       2.8.4
> [ ] rabbitmq_consistent_hash_exchange 2.8.4
> [ ] rabbitmq_federation               2.8.4
> [ ] rabbitmq_federation_management    2.8.4
> [ ] rabbitmq_jsonrpc                  2.8.4
> [ ] rabbitmq_jsonrpc_channel          2.8.4
> [ ] rabbitmq_jsonrpc_channel_examples 2.8.4
> [E] rabbitmq_management               2.8.4
> [e] rabbitmq_management_agent         2.8.4
> [E] rabbitmq_management_visualiser    2.8.4
> [e] rabbitmq_mochiweb                 2.8.4
> [ ] rabbitmq_shovel                   2.8.4
> [ ] rabbitmq_shovel_management        2.8.4
> [ ] rabbitmq_stomp                    2.8.4
> [ ] rabbitmq_tracing                  2.8.4
> [ ] rfc4627_jsonrpc                   2.8.4-git
> [e] webmachine                        1.7.0-rmq2.8.4-hg
>
> But it still failed to activate the plugins this time.
>
> The log ends without activating the plugins, see below:
>
> ...
> -- message delivery logic ready
> starting error log relay
>   ...done
> starting networking
> ...done
> starting direct client
>   ...done
> starting notify cluster nodes
> ...done
>
> broker running
> ** Found 0 name clashes in code paths
>
> RabbitMQ v2.8.4, Ubuntu 10.04
>
> Thanks!
>
> On Thu, Jan 24, 2013 at 4:26 PM, Simon MacMullen <simon at rabbitmq.com
> <mailto:simon at rabbitmq.com>> wrote:
>
>     Ah - so you were using "rabbitmqctl stop_app" and "rabbitmqctl
>     start_app" - yes that would not work since they never halt the
>     Erlang VM. "service rabbitmq-server restart" would have worked
>     without a reboot.
>
>     I guess we should try to make that clearer.
>
>     Cheers, Simon
>
>
>     On 24/01/13 05:56, Alex Damian wrote:
>
>         I finally got it working. Restarting and stopping the server with
>         rabbitmqctl did not work. So I rebooted then restarted directly
>         with the
>         rabbitmq-server start command and this time it seemed to load
>         all the
>         plugins including Mochiweb and I was able to open the admin
>         webpage. I'm
>         not sure why it did not work immediately after the plugins were
>         enabled...however I'm happy with this solution albeit not ideal
>         since it
>         required a reboot.
>
>         On Tuesday, January 22, 2013 5:23:24 PM UTC-5, Alex Damian wrote:
>
>              Hi
>
>              I have followed all the instructions on
>         http://www.rabbitmq.com/__management.html
>         <http://www.rabbitmq.com/management.html>
>              <http://www.rabbitmq.com/__management.html
>         <http://www.rabbitmq.com/management.html>> and enabled the plugin,
>              but after than there is no webserver running anywhere on my
>         machine.
>              There is no way to connect to Mochiweb at all. I have
>         restarted the
>              service and still nothing. I have also tried the
>              "http:///server-name/:15672/" URL with "localhost",
>         127.0.0.1 and
>
>              also the full server name, all of which are /etc/hosts file. My
>              vhost is the default "/". Should I add something in my
>         config file
>              perhaps? I have also tried a /curl/ command and still nothing.
>
>
>              I am running on Fedora Core 17 with all latest libs
>         including latest
>              rabbitMQ sw. I have checked the listening ports on the
>         server and i
>              only see the AMQP one.
>              Also I can run rabbitmq-server and rabbitmqctl without
>         issues. I
>              have also been able to create exchanges/queues via rabbit.js on
>              Node. However not having a proper admin tool is a bit
>         drawback. I
>              wonder why it's not possible to supply one like (or enhance)
>              rabbitmqctl. Seems to do the job just fine.
>
>              Any help would be greatly appreciated!
>
>
>
>         _________________________________________________
>         rabbitmq-discuss mailing list
>         rabbitmq-discuss at lists.__rabbitmq.com
>         <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>         https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss
>         <https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
>
>
>     --
>     Simon MacMullen
>     RabbitMQ, VMware
>     _________________________________________________
>     rabbitmq-discuss mailing list
>     rabbitmq-discuss at lists.__rabbitmq.com
>     <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>     https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss
>     <https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
>
>
>
> --
>
> http://about.me/outhorand/bio
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From brettflitter at gmail.com  Tue Jan 29 11:01:26 2013
From: brettflitter at gmail.com (nybras)
Date: Tue, 29 Jan 2013 03:01:26 -0800 (PST)
Subject: [rabbitmq-discuss] User Permissions
In-Reply-To: <CAE0Sz=wyszL5e-QcmReXbYoCr3h=vH_wtWD9ayf9Fh_mJSUcnw@mail.gmail.com>
References: <1359228441933-24702.post@n5.nabble.com>
	<CAE0Sz=wyszL5e-QcmReXbYoCr3h=vH_wtWD9ayf9Fh_mJSUcnw@mail.gmail.com>
Message-ID: <1359457286549-24742.post@n5.nabble.com>

That's great thank you very much. So if I wanted allow my users to only:

queue.bind
queue.unbind
basic.get
basic.consume

Would I create a user account (say 'users') and fill in regex parts (i'm
creating this in the Management Plugin)
Write regexp = '^amq\.queue.bind|amq\.queue.unbind$'
Read regexp = '^amq\.basic.get|amq\.basic.consume$'

???
Or have I completely misunderstood this?

My app is a publish/subscribe scenario where each user has their very own
queue with multiple binds to various exchanges (the producers). I'm guessing
to allow users to only consume from their own queue I would have to create a
user account for each user of the app. Or I could randomly generate queue
names for each user so that these queue names could not be guessed (which
would be secure enough)??



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/User-Permissions-tp24702p24742.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From antouboduor at gmail.com  Tue Jan 29 11:20:38 2013
From: antouboduor at gmail.com (Anthony Oduor)
Date: Tue, 29 Jan 2013 14:20:38 +0300
Subject: [rabbitmq-discuss] Cannot access rabbitmqadmin.
In-Reply-To: <5107A503.3090505@rabbitmq.com>
References: <5753af5f-6c71-42db-91db-58279c63d685@googlegroups.com>
	<0790b109-e918-4261-924e-129cd7978e99@googlegroups.com>
	<5101367C.6000005@rabbitmq.com>
	<CAEey+bJXVYP_q-yaiKZa3CMX0Ph1CK0jMWyyt+eU=KwqspFsUg@mail.gmail.com>
	<5107A503.3090505@rabbitmq.com>
Message-ID: <CAEey+bJRcBf_h6B4QE1CzbBOqix+UPtzBgePp3bqy2wRXuGUKg@mail.gmail.com>

Thanks for your reply.

Yes, installed via *rabbitmq-server-generic-unix-2.8.4.tar.gz* on my
/home/anthony/rabbitmq/

I am able to access the sbin and run the rabbitmq-* scripts with the same
user. In this case, I am not sure how they could be reading different
values of RABBITMQ_ENABLED_PLUGINS_FILE. This just happened yesterday when
restarted the rabbitmq-server, I haven't encountered this before.


On Tue, Jan 29, 2013 at 1:31 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> Hmm. Your symptoms are consistent with rabbitmq-plugins and
> rabbitmq-server using a different enabled_plugins file. How did you install
> RabbitMQ? I notice that you are invoking rabbitmq-plugins from the current
> directory as a normal user, so did you perform a manual installation?
>
> If so, make sure that both rabbitmq-plugins and rabbitmq-server see the
> same value for RABBITMQ_ENABLED_PLUGINS_FILE.
>
> Cheers, Simon
>
>
> On 29/01/13 07:39, Anthony Oduor wrote:
>
>> Hello,
>>
>> Encountered this issue too. Everything is running fine, ports 4369 with
>> epmd is up, but cannot access the web management page.
>>
>> $ ./rabbitmq-plugins list
>> [e] amqp_client                       2.8.4
>> [ ] eldap                             2.8.4-git
>> [ ] erlando                           2.8.4
>> [e] mochiweb                          1.3-rmq2.8.4-git
>> [ ] rabbitmq_auth_backend_ldap        2.8.4
>> [ ] rabbitmq_auth_mechanism_ssl       2.8.4
>> [ ] rabbitmq_consistent_hash_**exchange 2.8.4
>> [ ] rabbitmq_federation               2.8.4
>> [ ] rabbitmq_federation_management    2.8.4
>> [ ] rabbitmq_jsonrpc                  2.8.4
>> [ ] rabbitmq_jsonrpc_channel          2.8.4
>> [ ] rabbitmq_jsonrpc_channel_**examples 2.8.4
>> [E] rabbitmq_management               2.8.4
>> [e] rabbitmq_management_agent         2.8.4
>> [E] rabbitmq_management_visualiser    2.8.4
>> [e] rabbitmq_mochiweb                 2.8.4
>> [ ] rabbitmq_shovel                   2.8.4
>> [ ] rabbitmq_shovel_management        2.8.4
>> [ ] rabbitmq_stomp                    2.8.4
>> [ ] rabbitmq_tracing                  2.8.4
>> [ ] rfc4627_jsonrpc                   2.8.4-git
>> [e] webmachine                        1.7.0-rmq2.8.4-hg
>>
>> But it still failed to activate the plugins this time.
>>
>> The log ends without activating the plugins, see below:
>>
>> ...
>> -- message delivery logic ready
>> starting error log relay
>>   ...done
>> starting networking
>> ...done
>> starting direct client
>>   ...done
>> starting notify cluster nodes
>> ...done
>>
>> broker running
>> ** Found 0 name clashes in code paths
>>
>> RabbitMQ v2.8.4, Ubuntu 10.04
>>
>> Thanks!
>>
>> On Thu, Jan 24, 2013 at 4:26 PM, Simon MacMullen <simon at rabbitmq.com
>> <mailto:simon at rabbitmq.com>> wrote:
>>
>>     Ah - so you were using "rabbitmqctl stop_app" and "rabbitmqctl
>>     start_app" - yes that would not work since they never halt the
>>     Erlang VM. "service rabbitmq-server restart" would have worked
>>     without a reboot.
>>
>>     I guess we should try to make that clearer.
>>
>>     Cheers, Simon
>>
>>
>>     On 24/01/13 05:56, Alex Damian wrote:
>>
>>         I finally got it working. Restarting and stopping the server with
>>         rabbitmqctl did not work. So I rebooted then restarted directly
>>         with the
>>         rabbitmq-server start command and this time it seemed to load
>>         all the
>>         plugins including Mochiweb and I was able to open the admin
>>         webpage. I'm
>>         not sure why it did not work immediately after the plugins were
>>         enabled...however I'm happy with this solution albeit not ideal
>>         since it
>>         required a reboot.
>>
>>         On Tuesday, January 22, 2013 5:23:24 PM UTC-5, Alex Damian wrote:
>>
>>              Hi
>>
>>              I have followed all the instructions on
>>         http://www.rabbitmq.com/__**management.html<http://www.rabbitmq.com/__management.html>
>>         <http://www.rabbitmq.com/**management.html<http://www.rabbitmq.com/management.html>
>> >
>>              <http://www.rabbitmq.com/__**management.html<http://www.rabbitmq.com/__management.html>
>>
>>         <http://www.rabbitmq.com/**management.html<http://www.rabbitmq.com/management.html>>>
>> and enabled the plugin,
>>              but after than there is no webserver running anywhere on my
>>         machine.
>>              There is no way to connect to Mochiweb at all. I have
>>         restarted the
>>              service and still nothing. I have also tried the
>>              "http:///server-name/:15672/" URL with "localhost",
>>         127.0.0.1 and
>>
>>              also the full server name, all of which are /etc/hosts file.
>> My
>>              vhost is the default "/". Should I add something in my
>>         config file
>>              perhaps? I have also tried a /curl/ command and still
>> nothing.
>>
>>
>>              I am running on Fedora Core 17 with all latest libs
>>         including latest
>>              rabbitMQ sw. I have checked the listening ports on the
>>         server and i
>>              only see the AMQP one.
>>              Also I can run rabbitmq-server and rabbitmqctl without
>>         issues. I
>>              have also been able to create exchanges/queues via rabbit.js
>> on
>>              Node. However not having a proper admin tool is a bit
>>         drawback. I
>>              wonder why it's not possible to supply one like (or enhance)
>>              rabbitmqctl. Seems to do the job just fine.
>>
>>              Any help would be greatly appreciated!
>>
>>
>>
>>         ______________________________**___________________
>>         rabbitmq-discuss mailing list
>>         rabbitmq-discuss at lists.__rabbi**tmq.com <http://rabbitmq.com>
>>         <mailto:rabbitmq-discuss@**lists.rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> >
>>         https://lists.rabbitmq.com/__**cgi-bin/mailman/listinfo/__**
>> rabbitmq-discuss<https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss>
>>
>>         <https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**
>> rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>> >
>>
>>
>>
>>     --
>>     Simon MacMullen
>>     RabbitMQ, VMware
>>     ______________________________**___________________
>>     rabbitmq-discuss mailing list
>>     rabbitmq-discuss at lists.__rabbi**tmq.com <http://rabbitmq.com>
>>     <mailto:rabbitmq-discuss@**lists.rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> >
>>     https://lists.rabbitmq.com/__**cgi-bin/mailman/listinfo/__**
>> rabbitmq-discuss<https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss>
>>
>>     <https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**
>> rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>> >
>>
>>
>>
>>
>> --
>>
>> http://about.me/outhorand/bio
>>
>>
>>
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>



-- 

http://about.me/outhorand/bio
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130129/d5f4f261/attachment.htm>

From lars.ericsson at kollmorgen.com  Tue Jan 29 11:45:02 2013
From: lars.ericsson at kollmorgen.com (Ericsson, Lars)
Date: Tue, 29 Jan 2013 11:45:02 +0000
Subject: [rabbitmq-discuss] RabbitMQ 3.0.1: Windows, firewall configuration.
Message-ID: <5836E138DBF1EE4780820D1A6B535943C4FF221F@DHREUSVXM03.danaher.org>

Hi,

Just installed the rabbitmq and having problems with the Windows firewall.

Installing from the https://www.rabbitmq.com/releases/rabbitmq-server/v3.0.1/rabbitmq-server-3.0.1.exe 
it does not look like any FW rules are added automatically at install time.

When running, rabbitmqctl.bat stop, a firewall pops up and I'm able to add FW rules for, in my case,
C:\program files\erl5.9.3.1\bin\erl.exe.

When later starting the service, C:\program files \erl5.9.3.1\erts-5.9.3.1\bin\erl.exe, I'm not bale to connect from remote systems.
Checking the FW rules, no rules exist that map, C:\program files \erl5.9.3.1\erts-5.9.3.1\bin\erl.exe.
The one manually created for C:\program files\erl5.9.3.1\bin\erl.exe, looks like the same EXE but in a different location.

Questions:
1) Should the installation add FW rules automatically ?
2) Why are there two copies of the ...\erl5.9.3.1\bin folder installed?

I can see FW discussions in case of clustering, but not for standalone usage of rabbitmq.

Regards
Lars


Please be advised that this email may contain confidential 
information.  If you are not the intended recipient, please notify us 
by email by replying to the sender and delete this message.  The 
sender disclaims that the content of this email constitutes an offer 
to enter into, or the acceptance of, any agreement; provided that the 
foregoing does not invalidate the binding effect of any digital or 
other electronic reproduction of a manual signature that is included 
in any attachment.



From eytanes at gmail.com  Tue Jan 29 13:53:12 2013
From: eytanes at gmail.com (Eytan)
Date: Tue, 29 Jan 2013 05:53:12 -0800 (PST)
Subject: [rabbitmq-discuss] WCF service not firing Faulted event
Message-ID: <fcacc389-cb9b-4af0-ac88-547a3db23804@googlegroups.com>

Hey,

I've been using the WCF tests in the c# examples and I've been testing how 
the service reacts to network disconnects.
If I open both a  WCF client and server (using the DuplexTest) and kill tcp 
connections (from the app to the broker) I see that there are events that 
are fired internally, such-as RabbitMQChannelBase.Faulted, however neither 
the service or the client fire the Faulted event.
Is there a way to propagate this channel fault up to the client and 
service? or is there a way to listen to the channel fault event?

Without knowing that the service is dead we have no ability to rebuild the 
ServiceHost.

Thanks,
Eytan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130129/2aa0884b/attachment.htm>

From simon at rabbitmq.com  Tue Jan 29 16:17:46 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 29 Jan 2013 16:17:46 +0000
Subject: [rabbitmq-discuss] Cannot access rabbitmqadmin.
In-Reply-To: <CAEey+bJRcBf_h6B4QE1CzbBOqix+UPtzBgePp3bqy2wRXuGUKg@mail.gmail.com>
References: <5753af5f-6c71-42db-91db-58279c63d685@googlegroups.com>
	<0790b109-e918-4261-924e-129cd7978e99@googlegroups.com>
	<5101367C.6000005@rabbitmq.com>
	<CAEey+bJXVYP_q-yaiKZa3CMX0Ph1CK0jMWyyt+eU=KwqspFsUg@mail.gmail.com>
	<5107A503.3090505@rabbitmq.com>
	<CAEey+bJRcBf_h6B4QE1CzbBOqix+UPtzBgePp3bqy2wRXuGUKg@mail.gmail.com>
Message-ID: <5107F62A.2050207@rabbitmq.com>

Hmm. I just downloaded the 2.8.4 tarball and tried this out - both 
rabbitmq-plugins and rabbitmq-server picked up the same location for the 
file.

It might be worth editing the two scripts to add:

echo RABBITMQ_ENABLED_PLUGINS_FILE=$RABBITMQ_ENABLED_PLUGINS_FILE

just before the "exec erl" so you can see what the two scripts are seeing.

Just to be clear, you are starting rabbitmq-server by invoking 
"./rabbitmq-server"?

Cheers, Simon

On 29/01/13 11:20, Anthony Oduor wrote:
> Thanks for your reply.
>
> Yes, installed via /rabbitmq-server-generic-unix-2.8.4.tar.gz/ on my
> /home/anthony/rabbitmq/
>
> I am able to access the sbin and run the rabbitmq-* scripts with the
> same user. In this case, I am not sure how they could be reading
> different values of RABBITMQ_ENABLED_PLUGINS_FILE. This just happened
> yesterday when restarted the rabbitmq-server, I haven't encountered this
> before.
>
>
> On Tue, Jan 29, 2013 at 1:31 PM, Simon MacMullen <simon at rabbitmq.com
> <mailto:simon at rabbitmq.com>> wrote:
>
>     Hmm. Your symptoms are consistent with rabbitmq-plugins and
>     rabbitmq-server using a different enabled_plugins file. How did you
>     install RabbitMQ? I notice that you are invoking rabbitmq-plugins
>     from the current directory as a normal user, so did you perform a
>     manual installation?
>
>     If so, make sure that both rabbitmq-plugins and rabbitmq-server see
>     the same value for RABBITMQ_ENABLED_PLUGINS_FILE.
>
>     Cheers, Simon
>
>
>     On 29/01/13 07:39, Anthony Oduor wrote:
>
>         Hello,
>
>         Encountered this issue too. Everything is running fine, ports
>         4369 with
>         epmd is up, but cannot access the web management page.
>
>         $ ./rabbitmq-plugins list
>         [e] amqp_client                       2.8.4
>         [ ] eldap                             2.8.4-git
>         [ ] erlando                           2.8.4
>         [e] mochiweb                          1.3-rmq2.8.4-git
>         [ ] rabbitmq_auth_backend_ldap        2.8.4
>         [ ] rabbitmq_auth_mechanism_ssl       2.8.4
>         [ ] rabbitmq_consistent_hash___exchange 2.8.4
>         [ ] rabbitmq_federation               2.8.4
>         [ ] rabbitmq_federation_management    2.8.4
>         [ ] rabbitmq_jsonrpc                  2.8.4
>         [ ] rabbitmq_jsonrpc_channel          2.8.4
>         [ ] rabbitmq_jsonrpc_channel___examples 2.8.4
>         [E] rabbitmq_management               2.8.4
>         [e] rabbitmq_management_agent         2.8.4
>         [E] rabbitmq_management_visualiser    2.8.4
>         [e] rabbitmq_mochiweb                 2.8.4
>         [ ] rabbitmq_shovel                   2.8.4
>         [ ] rabbitmq_shovel_management        2.8.4
>         [ ] rabbitmq_stomp                    2.8.4
>         [ ] rabbitmq_tracing                  2.8.4
>         [ ] rfc4627_jsonrpc                   2.8.4-git
>         [e] webmachine                        1.7.0-rmq2.8.4-hg
>
>         But it still failed to activate the plugins this time.
>
>         The log ends without activating the plugins, see below:
>
>         ...
>         -- message delivery logic ready
>         starting error log relay
>            ...done
>         starting networking
>         ...done
>         starting direct client
>            ...done
>         starting notify cluster nodes
>         ...done
>
>         broker running
>         ** Found 0 name clashes in code paths
>
>         RabbitMQ v2.8.4, Ubuntu 10.04
>
>         Thanks!
>
>         On Thu, Jan 24, 2013 at 4:26 PM, Simon MacMullen
>         <simon at rabbitmq.com <mailto:simon at rabbitmq.com>
>         <mailto:simon at rabbitmq.com <mailto:simon at rabbitmq.com>>> wrote:
>
>              Ah - so you were using "rabbitmqctl stop_app" and "rabbitmqctl
>              start_app" - yes that would not work since they never halt the
>              Erlang VM. "service rabbitmq-server restart" would have worked
>              without a reboot.
>
>              I guess we should try to make that clearer.
>
>              Cheers, Simon
>
>
>              On 24/01/13 05:56, Alex Damian wrote:
>
>                  I finally got it working. Restarting and stopping the
>         server with
>                  rabbitmqctl did not work. So I rebooted then restarted
>         directly
>                  with the
>                  rabbitmq-server start command and this time it seemed
>         to load
>                  all the
>                  plugins including Mochiweb and I was able to open the admin
>                  webpage. I'm
>                  not sure why it did not work immediately after the
>         plugins were
>                  enabled...however I'm happy with this solution albeit
>         not ideal
>                  since it
>                  required a reboot.
>
>                  On Tuesday, January 22, 2013 5:23:24 PM UTC-5, Alex
>         Damian wrote:
>
>                       Hi
>
>                       I have followed all the instructions on
>         http://www.rabbitmq.com/____management.html
>         <http://www.rabbitmq.com/__management.html>
>                  <http://www.rabbitmq.com/__management.html
>         <http://www.rabbitmq.com/management.html>>
>                       <http://www.rabbitmq.com/____management.html
>         <http://www.rabbitmq.com/__management.html>
>
>                  <http://www.rabbitmq.com/__management.html
>         <http://www.rabbitmq.com/management.html>>> and enabled the plugin,
>                       but after than there is no webserver running
>         anywhere on my
>                  machine.
>                       There is no way to connect to Mochiweb at all. I have
>                  restarted the
>                       service and still nothing. I have also tried the
>                       "http:///server-name/:15672/" URL with "localhost",
>                  127.0.0.1 and
>
>                       also the full server name, all of which are
>         /etc/hosts file. My
>                       vhost is the default "/". Should I add something in my
>                  config file
>                       perhaps? I have also tried a /curl/ command and
>         still nothing.
>
>
>                       I am running on Fedora Core 17 with all latest libs
>                  including latest
>                       rabbitMQ sw. I have checked the listening ports on the
>                  server and i
>                       only see the AMQP one.
>                       Also I can run rabbitmq-server and rabbitmqctl without
>                  issues. I
>                       have also been able to create exchanges/queues via
>         rabbit.js on
>                       Node. However not having a proper admin tool is a bit
>                  drawback. I
>                       wonder why it's not possible to supply one like
>         (or enhance)
>                       rabbitmqctl. Seems to do the job just fine.
>
>                       Any help would be greatly appreciated!
>
>
>
>                  ___________________________________________________
>                  rabbitmq-discuss mailing list
>                  rabbitmq-discuss at lists.__rabbi__tmq.com
>         <http://rabbitmq.com>
>                  <mailto:rabbitmq-discuss at __lists.rabbitmq.com
>         <mailto:rabbitmq-discuss at lists.rabbitmq.com>>
>         https://lists.rabbitmq.com/____cgi-bin/mailman/listinfo/____rabbitmq-discuss
>         <https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss>
>
>
>         <https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss
>         <https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>>
>
>
>
>              --
>              Simon MacMullen
>              RabbitMQ, VMware
>              ___________________________________________________
>              rabbitmq-discuss mailing list
>              rabbitmq-discuss at lists.__rabbi__tmq.com <http://rabbitmq.com>
>              <mailto:rabbitmq-discuss at __lists.rabbitmq.com
>         <mailto:rabbitmq-discuss at lists.rabbitmq.com>>
>         https://lists.rabbitmq.com/____cgi-bin/mailman/listinfo/____rabbitmq-discuss
>         <https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss>
>
>
>         <https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss
>         <https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>>
>
>
>
>
>         --
>
>         http://about.me/outhorand/bio
>
>
>
>         _________________________________________________
>         rabbitmq-discuss mailing list
>         rabbitmq-discuss at lists.__rabbitmq.com
>         <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>         https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss
>         <https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
>
>
>     --
>     Simon MacMullen
>     RabbitMQ, VMware
>
>
>
>
> --
>
> http://about.me/outhorand/bio
>


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Tue Jan 29 16:20:34 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 29 Jan 2013 16:20:34 +0000
Subject: [rabbitmq-discuss] RabbitMQ 3.0.1: Windows,
	firewall configuration.
In-Reply-To: <5836E138DBF1EE4780820D1A6B535943C4FF221F@DHREUSVXM03.danaher.org>
References: <5836E138DBF1EE4780820D1A6B535943C4FF221F@DHREUSVXM03.danaher.org>
Message-ID: <5107F6D2.1040509@rabbitmq.com>

On 29/01/13 11:45, Ericsson, Lars wrote:
> Just installed the rabbitmq and having problems with the Windows firewall.
>
> Installing from the https://www.rabbitmq.com/releases/rabbitmq-server/v3.0.1/rabbitmq-server-3.0.1.exe
> it does not look like any FW rules are added automatically at install time.

No, that's correct.

> When running, rabbitmqctl.bat stop, a firewall pops up and I'm able to add FW rules for, in my case,
> C:\program files\erl5.9.3.1\bin\erl.exe.
>
> When later starting the service, C:\program files \erl5.9.3.1\erts-5.9.3.1\bin\erl.exe, I'm not bale to connect from remote systems.
> Checking the FW rules, no rules exist that map, C:\program files \erl5.9.3.1\erts-5.9.3.1\bin\erl.exe.
> The one manually created for C:\program files\erl5.9.3.1\bin\erl.exe, looks like the same EXE but in a different location.
>
> Questions:
> 1) Should the installation add FW rules automatically ?

Possibly it should. It doesn't though. I'll file a bug - but I have no 
idea how easy or difficult this is to do.

> 2) Why are there two copies of the ...\erl5.9.3.1\bin folder installed?

That's just the way Erlang is distributed.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Tue Jan 29 16:27:41 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 29 Jan 2013 16:27:41 +0000
Subject: [rabbitmq-discuss] Federation in a cluster
In-Reply-To: <3A89DE15-04CB-4209-90A4-A694A3170C0C@ll.mit.edu>
References: <3A89DE15-04CB-4209-90A4-A694A3170C0C@ll.mit.edu>
Message-ID: <5107F87D.8040305@rabbitmq.com>

You don't need to declare the same parameters and policies in E and F, 
they're cluster-wide.

You should note that if you specify nodes from the same cluster as 
separate upstreams then the federated exchange will attempt to consume 
from them all simultaneously - this might break message ordering. So you 
would normally add each cluster once.

At the moment there's no way to say "all these upstreams are in the same 
cluster, just ensure you use one of them" although we hope to add this 
in a future release.

Cheers, Simon

On 28/01/13 21:36, Cao, Yican - 0551 - MITLL wrote:
> Hi,
>
>
> In federation document, it says:
> "When using a federation in a cluster, all the nodes of the cluster must have the federation plugin installed. ..."
>
> I have 2 clustered HAQ nodes [A, B, C] and [E, F].
> [A, B, C] is clustered and so does [E, F].
>
> Do I have to:
> in E:
> rabbitmqctl set_parameter federation-upstream my-upstream '{"uri":"amqp://A", "expires":3600}'
> rabbitmqctl set_policy...
> ....
> rabbitmqctl set_parameter federation-upstream my-upstream '{"uri":"amqp://B", "expires":3600}'
> rabbitmqctl set_policy...
> ....
> rabbitmqctl set_parameter federation-upstream my-upstream '{"uri":"amqp://C", "expires":3600}'
> rabbitmqctl set_policy...
> ....
>
>
> and do the same in F:
> rabbitmqctl set_parameter federation-upstream my-upstream '{"uri":"amqp://A", "expires":3600}'
> rabbitmqctl set_policy...
> ....
> rabbitmqctl set_parameter federation-upstream my-upstream '{"uri":"amqp://B", "expires":3600}'
> rabbitmqctl set_policy...
> ....
> rabbitmqctl set_parameter federation-upstream my-upstream '{"uri":"amqp://C", "expires":3600}'
> rabbitmqctl set_policy...
> ....
>
> ?
>
>
> If I want to use Pair of federated exchanges in your example topologies,
>
> Shall I setup same in A, B and C?
>
>
> Thanks.
>
>
> Yican Cao
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Tue Jan 29 16:41:39 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 29 Jan 2013 16:41:39 +0000
Subject: [rabbitmq-discuss] WCF service not firing Faulted event
In-Reply-To: <fcacc389-cb9b-4af0-ac88-547a3db23804@googlegroups.com>
References: <fcacc389-cb9b-4af0-ac88-547a3db23804@googlegroups.com>
Message-ID: <5107FBC3.9080701@rabbitmq.com>

On 29/01/13 13:53, Eytan wrote:
> Without knowing that the service is dead we have no ability to rebuild
> the ServiceHost.

The internal channels are aware of network faults but at the moment the
RabbitMQ WCF binding cannot cope with network errors. The only kind of
error that it is designed for is exceptions thrown by the service. Take
a look at the FaultTest example for how to make use of this. I will file
a bug to make the improvements you suggested.



-Emile



From lars.ericsson at kollmorgen.com  Tue Jan 29 17:05:26 2013
From: lars.ericsson at kollmorgen.com (Ericsson, Lars)
Date: Tue, 29 Jan 2013 17:05:26 +0000
Subject: [rabbitmq-discuss] RabbitMQ 3.0.1: Windows,
 firewall configuration.
In-Reply-To: <5107F6D2.1040509@rabbitmq.com>
References: <5836E138DBF1EE4780820D1A6B535943C4FF221F@DHREUSVXM03.danaher.org>
	<5107F6D2.1040509@rabbitmq.com>
Message-ID: <5836E138DBF1EE4780820D1A6B535943C4FF25A8@DHREUSVXM03.danaher.org>

>> Questions:
>> 1) Should the installation add FW rules automatically ?
>
> Possibly it should. It doesn't though. I'll file a bug - but I have no 
> idea how easy or difficult this is to do.

I might be able to help:
- What installation build is used ?
- Is the Windows installation/configuration/project/files available for me?

/Lars


Please be advised that this email may contain confidential 
information.  If you are not the intended recipient, please notify us 
by email by replying to the sender and delete this message.  The 
sender disclaims that the content of this email constitutes an offer 
to enter into, or the acceptance of, any agreement; provided that the 
foregoing does not invalidate the binding effect of any digital or 
other electronic reproduction of a manual signature that is included 
in any attachment.



From cao at ll.mit.edu  Tue Jan 29 17:05:40 2013
From: cao at ll.mit.edu (Cao, Yican - 0551 - MITLL)
Date: Tue, 29 Jan 2013 12:05:40 -0500
Subject: [rabbitmq-discuss] Federation in a cluster
In-Reply-To: <5107F87D.8040305@rabbitmq.com>
References: <3A89DE15-04CB-4209-90A4-A694A3170C0C@ll.mit.edu>
	<5107F87D.8040305@rabbitmq.com>
Message-ID: <C0AA40FB-D66B-4697-9282-7861EFE5C6CC@ll.mit.edu>

Thanks much Simon, 

You are saying I only need to declare one setting in E? 
ie. 
in E:
rabbitmqctl set_parameter federation-upstream my-upstream '{"uri":"amqp://A", "expires":3600}'
rabbitmqctl set_policy...
....

Now, it comes that if A which is my upstream fails, what would happen? [A, B, C] is running with HAQ (active/active).
Do I just lost federation?
If not, how does E handle this in case of 
1) A is a master
2) A is a slave 
?

[E, F] also runs HAQ cluster, what if E dies, how to config F continue to perform as down-stream nodes as HAQ suppose to do ? Can we achieve this?

Thanks.


Yican




On Jan 29, 2013, at 11:27 AM, Simon MacMullen wrote:

> You don't need to declare the same parameters and policies in E and F, 
> they're cluster-wide.
> 
> You should note that if you specify nodes from the same cluster as 
> separate upstreams then the federated exchange will attempt to consume 
> from them all simultaneously - this might break message ordering. So you 
> would normally add each cluster once.
> 
> At the moment there's no way to say "all these upstreams are in the same 
> cluster, just ensure you use one of them" although we hope to add this 
> in a future release.
> 
> Cheers, Simon
> 
> On 28/01/13 21:36, Cao, Yican - 0551 - MITLL wrote:
>> Hi,
>> 
>> 
>> In federation document, it says:
>> "When using a federation in a cluster, all the nodes of the cluster must have the federation plugin installed. ..."
>> 
>> I have 2 clustered HAQ nodes [A, B, C] and [E, F].
>> [A, B, C] is clustered and so does [E, F].
>> 
>> Do I have to:
>> in E:
>> rabbitmqctl set_parameter federation-upstream my-upstream '{"uri":"amqp://A", "expires":3600}'
>> rabbitmqctl set_policy...
>> ....
>> rabbitmqctl set_parameter federation-upstream my-upstream '{"uri":"amqp://B", "expires":3600}'
>> rabbitmqctl set_policy...
>> ....
>> rabbitmqctl set_parameter federation-upstream my-upstream '{"uri":"amqp://C", "expires":3600}'
>> rabbitmqctl set_policy...
>> ....
>> 
>> 
>> and do the same in F:
>> rabbitmqctl set_parameter federation-upstream my-upstream '{"uri":"amqp://A", "expires":3600}'
>> rabbitmqctl set_policy...
>> ....
>> rabbitmqctl set_parameter federation-upstream my-upstream '{"uri":"amqp://B", "expires":3600}'
>> rabbitmqctl set_policy...
>> ....
>> rabbitmqctl set_parameter federation-upstream my-upstream '{"uri":"amqp://C", "expires":3600}'
>> rabbitmqctl set_policy...
>> ....
>> 
>> ?
>> 
>> 
>> If I want to use Pair of federated exchanges in your example topologies,
>> 
>> Shall I setup same in A, B and C?
>> 
>> 
>> Thanks.
>> 
>> 
>> Yican Cao
>> 
>> 
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
> 
> 
> -- 
> Simon MacMullen
> RabbitMQ, VMware

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130129/0073dcf4/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 5652 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130129/0073dcf4/attachment.bin>

From dseltzer at tveyes.com  Tue Jan 29 17:08:22 2013
From: dseltzer at tveyes.com (Dave Seltzer)
Date: Tue, 29 Jan 2013 12:08:22 -0500
Subject: [rabbitmq-discuss] RabbitMQ Crash in 3.0.1
Message-ID: <CAHW0W4Og1xt_qSm2TvtSpWEXBKmiOesqNw1ZQqkSu9VT0yHnEA@mail.gmail.com>

Hello,

Today I had a single RabbitMQ instance crash. The server was running
RabbitMQ 3.0.1 on R15B02 and was not in a cluster. There was nothing in the
shutdown log.

The only indication of trouble was in /var/log/messages

Jan 29 11:51:41 egressqueue01 kernel: beam.smp[9371]: segfault at
fffffffffffffffe ip 00000000005419ba sp 00007f476bccad00 error 4 in
beam.smp[400000+214000]

Issuing a "/etc/init.d/rabbitmq start" brought the service back up, and
after a little while it started passing messages again.

Any idea where I should be looking?

Thanks so much!

-D
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130129/a8e633c3/attachment.htm>

From simon at rabbitmq.com  Tue Jan 29 17:15:08 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 29 Jan 2013 17:15:08 +0000
Subject: [rabbitmq-discuss] RabbitMQ 3.0.1: Windows,
	firewall configuration.
In-Reply-To: <5836E138DBF1EE4780820D1A6B535943C4FF25A8@DHREUSVXM03.danaher.org>
References: <5836E138DBF1EE4780820D1A6B535943C4FF221F@DHREUSVXM03.danaher.org>
	<5107F6D2.1040509@rabbitmq.com>
	<5836E138DBF1EE4780820D1A6B535943C4FF25A8@DHREUSVXM03.danaher.org>
Message-ID: <5108039C.4050402@rabbitmq.com>

On 29/01/13 17:05, Ericsson, Lars wrote:
> I might be able to help:

Cool! (There would be a contributor agreement to sign though I'm afraid.)

> - What installation build is used ?

NSIS.

> - Is the Windows installation/configuration/project/files available for me?

Sure, see packaging/windows-exe in the rabbitmq-server repository. You 
can get that repo from http://hg.rabbitmq.com/rabbitmq-server/ or 
https://github.com/rabbitmq/rabbitmq-server/

Dealing with the entire RabbitMQ build system is a bit involved for the 
uninitiated. Fortunately the Windows installer build takes the Windows 
zip as an input, so you can just download that and not deal with the 
wider build system.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Tue Jan 29 17:33:09 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 29 Jan 2013 17:33:09 +0000
Subject: [rabbitmq-discuss] RabbitMQ Crash in 3.0.1
In-Reply-To: <CAHW0W4Og1xt_qSm2TvtSpWEXBKmiOesqNw1ZQqkSu9VT0yHnEA@mail.gmail.com>
References: <CAHW0W4Og1xt_qSm2TvtSpWEXBKmiOesqNw1ZQqkSu9VT0yHnEA@mail.gmail.com>
Message-ID: <510807D5.40700@rabbitmq.com>


Hi Dave,

On 29/01/13 17:08, Dave Seltzer wrote:
> Jan 29 11:51:41 egressqueue01 kernel: beam.smp[9371]: segfault at
> fffffffffffffffe ip 00000000005419ba sp 00007f476bccad00 error 4 in
> beam.smp[400000+214000]
> 
> Issuing a "/etc/init.d/rabbitmq start" brought the service back up, and
> after a little while it started passing messages again.

That should not be taken lightly. Segfaults in the VM should not happen
with a default installation. If you are running or developing a plugin
with code that runs in the VM then segfaults could occur as a result.
They are also more likely when you enable HiPE. If you have HiPE enabled
then turn it off and see if that makes a difference. In some cases
hardware errors can be to blame, so make sure the server hardware is in
good shape.

If the segfault produced a core file then it should be possible to work
out where the error occurred. It will most likely be produced in the
working directory of the account that runs the broker. The information
from the core file can be reported to the erlang-bugs mailing list, or
we can forward it on your behalf. If the Erlang VM was not compiled with
debugging information then there is probably little information to be
gleaned from the core file. If the error is reproducible then it may be
worth getting hold of an Erlang VM with debugging symbols.

In some cases a erl_crash.dump file will be produced when the VM
crashes. If you find one (probably also in the working directory of the
account that runs the broker) then please compress and send it to us.



-Emile






From dseltzer at tveyes.com  Tue Jan 29 17:40:40 2013
From: dseltzer at tveyes.com (Dave Seltzer)
Date: Tue, 29 Jan 2013 12:40:40 -0500
Subject: [rabbitmq-discuss] RabbitMQ Crash in 3.0.1
In-Reply-To: <510807D5.40700@rabbitmq.com>
References: <CAHW0W4Og1xt_qSm2TvtSpWEXBKmiOesqNw1ZQqkSu9VT0yHnEA@mail.gmail.com>
	<510807D5.40700@rabbitmq.com>
Message-ID: <CAHW0W4MGHrH9JCGEZXmDpWv-Zk_fhRb8m+MemiXfRgJjWk+BMA@mail.gmail.com>

Thanks Emile,

I'm not sure what HiPE is, and I haven't been running any unusual plugins.
There was an erl_crash.dump file, but it's dated from the early this month,
so it may be from a previous crash.

The server is running Centos 6.3 on XenServer. I think I need to look at
the Linux VM itself and see if there's something which could be causing it
to be unstable.

Thanks for your advice!

-D


On Tue, Jan 29, 2013 at 12:33 PM, Emile Joubert <emile at rabbitmq.com> wrote:

>
> Hi Dave,
>
> On 29/01/13 17:08, Dave Seltzer wrote:
> > Jan 29 11:51:41 egressqueue01 kernel: beam.smp[9371]: segfault at
> > fffffffffffffffe ip 00000000005419ba sp 00007f476bccad00 error 4 in
> > beam.smp[400000+214000]
> >
> > Issuing a "/etc/init.d/rabbitmq start" brought the service back up, and
> > after a little while it started passing messages again.
>
> That should not be taken lightly. Segfaults in the VM should not happen
> with a default installation. If you are running or developing a plugin
> with code that runs in the VM then segfaults could occur as a result.
> They are also more likely when you enable HiPE. If you have HiPE enabled
> then turn it off and see if that makes a difference. In some cases
> hardware errors can be to blame, so make sure the server hardware is in
> good shape.
>
> If the segfault produced a core file then it should be possible to work
> out where the error occurred. It will most likely be produced in the
> working directory of the account that runs the broker. The information
> from the core file can be reported to the erlang-bugs mailing list, or
> we can forward it on your behalf. If the Erlang VM was not compiled with
> debugging information then there is probably little information to be
> gleaned from the core file. If the error is reproducible then it may be
> worth getting hold of an Erlang VM with debugging symbols.
>
> In some cases a erl_crash.dump file will be produced when the VM
> crashes. If you find one (probably also in the working directory of the
> account that runs the broker) then please compress and send it to us.
>
>
>
> -Emile
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130129/c3323469/attachment.htm>

From fred at dushin.net  Tue Jan 29 19:56:19 2013
From: fred at dushin.net (Dushin Fred)
Date: Tue, 29 Jan 2013 14:56:19 -0500
Subject: [rabbitmq-discuss] hostname change
In-Reply-To: <1359383662020-24717.post@n5.nabble.com>
References: <1359383662020-24717.post@n5.nabble.com>
Message-ID: <2E74050D-BD49-4800-BE80-F40ABB31F78E@dushin.net>


Funny, I am hitting this issue now, and (of course) at the 11th hour...

In my case, I have created virtual hosts, users (with user-definable passwords), and I am using message persistence.  If the host name changes, a new mnesia db is created, and the old data is not recoverable (as far as I can tell).  

I am using the RABBITMQ_NODENAME environment variable, but that appears to only set the first part of the node name.  Via the admin console, I still see the @<hostname> suffix.  The directory name (under ${RABBITMQ_MNESIA_BASE}) does not contain the @$HOSTNAME suffix, but if I do a recursive grep through the directory, I still find artifacts with my previous host name.  And a hostname reset (and reboot) results in a fresh DB, even if I start the broker by explicitly setting HOSTNAME to the previous value.

Is this expected behavior?  I am gathering it is, from the docs, and given clustering, it may be a non-trivial fix.  But it would be a welcome one, at least for my application.

Thanks,
-Fred

On Jan 28, 2013, at 9:34 AM, Prabodh Upreti <prabodh.upreti at vce.com> wrote:

> I have a hostname change on a box after install.  I understand I have to do
> a rabbitmq-server restart to recreate the database,log files and start the
> server properly.


From aggarwalsandeep at optonline.net  Tue Jan 29 20:12:38 2013
From: aggarwalsandeep at optonline.net (Sandeep Aggarwal)
Date: Tue, 29 Jan 2013 12:12:38 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ cluster with potentially millions
	of connections
In-Reply-To: <f75213a1-1571-415b-a5ba-e84c0d6bd0c9@googlegroups.com>
References: <f75213a1-1571-415b-a5ba-e84c0d6bd0c9@googlegroups.com>
Message-ID: <59b8eb8a-8b8f-48d2-ac22-acb7399b1ead@googlegroups.com>

To RabbitMQ gurus - Could you please post the replies here instead of just 
replying to the original person (Roman in this case). This is something of 
interest to me as well and I would like to follow this thread. Thx!

On Saturday, January 26, 2013 6:58:36 AM UTC-5, Romanas S. wrote:
>
> Hi guys,
>  I'm trying to come up with an architecture for a RabbitMQ cluster that 
> could potentially handle millions of (persistent) connections. I've set up 
> a cluster of Rabbits with 3 nodes (16GB RAM, 4x cpu cores each) and a Load 
> Balancer in front of them, increased all of the system limits on sockets 
> and file descriptors, but can't seem to scale to more then 30k connections 
> on the entire cluster. 
>
> Each connections has it's own exchange and a temporary direct queue, RAM 
> usage is about 2-3GB on each node and CPU usage peaks at about 200% (which 
> on 4 cores isn't all that bad). At first all is quite well and the cluster 
> manages upwards of 1k msgs/second (I haven't tried more, pretty sure it 
> would handle it). However, after scaling to that many connections, the 
> cluster seems to grind to a halt and eventually nodes become unresponsive. 
> The management API takes upwards of 5 (FIVE!) minutes to retrieve a server 
> summary report. Am I missing something here? Or is this just a bad idea 
> altogether? I was expecting that if each node was able to handle 30k+ 
> connections, I could have a cluster of 50 or so (with multiple balancers, 
> of course!) and live a happy life  ;-)
>
> Thanks,
> Roman
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130129/5024e7a2/attachment.htm>

From videlalvaro at gmail.com  Tue Jan 29 20:15:56 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Tue, 29 Jan 2013 21:15:56 +0100
Subject: [rabbitmq-discuss] RabbitMQ cluster with potentially millions
	of connections
In-Reply-To: <59b8eb8a-8b8f-48d2-ac22-acb7399b1ead@googlegroups.com>
References: <f75213a1-1571-415b-a5ba-e84c0d6bd0c9@googlegroups.com>
	<59b8eb8a-8b8f-48d2-ac22-acb7399b1ead@googlegroups.com>
Message-ID: <CAMcAHLWVdR6+fEMJVBr5h=J3nGuXNhbgtihUHh9m2xK9oGu4wg@mail.gmail.com>

You can access the thread history here:
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2013-January/025176.html


On Tue, Jan 29, 2013 at 9:12 PM, Sandeep Aggarwal <
aggarwalsandeep at optonline.net> wrote:

> To RabbitMQ gurus - Could you please post the replies here instead of just
> replying to the original person (Roman in this case). This is something of
> interest to me as well and I would like to follow this thread. Thx!
>
>
> On Saturday, January 26, 2013 6:58:36 AM UTC-5, Romanas S. wrote:
>>
>> Hi guys,
>>  I'm trying to come up with an architecture for a RabbitMQ cluster that
>> could potentially handle millions of (persistent) connections. I've set up
>> a cluster of Rabbits with 3 nodes (16GB RAM, 4x cpu cores each) and a Load
>> Balancer in front of them, increased all of the system limits on sockets
>> and file descriptors, but can't seem to scale to more then 30k connections
>> on the entire cluster.
>>
>> Each connections has it's own exchange and a temporary direct queue, RAM
>> usage is about 2-3GB on each node and CPU usage peaks at about 200% (which
>> on 4 cores isn't all that bad). At first all is quite well and the cluster
>> manages upwards of 1k msgs/second (I haven't tried more, pretty sure it
>> would handle it). However, after scaling to that many connections, the
>> cluster seems to grind to a halt and eventually nodes become unresponsive.
>> The management API takes upwards of 5 (FIVE!) minutes to retrieve a server
>> summary report. Am I missing something here? Or is this just a bad idea
>> altogether? I was expecting that if each node was able to handle 30k+
>> connections, I could have a cluster of 50 or so (with multiple balancers,
>> of course!) and live a happy life  ;-)
>>
>> Thanks,
>> Roman
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130129/83e832d7/attachment.htm>

From gmr at meetme.com  Wed Jan 30 02:46:01 2013
From: gmr at meetme.com (Gavin M. Roy)
Date: Tue, 29 Jan 2013 21:46:01 -0500
Subject: [rabbitmq-discuss] pika 0.9.9 Released
Message-ID: <31A5ABE4E2A046F580D64060621E1F4C@meetme.com>

Pika 0.9.9 is purely a bugfix release addressing issues raised in 0.9.8 and has been uploaded to pypi.

The documentation has been updated with a few more examples and edits for clarification and can found at http://pika.readthedocs.org/

Bugfixes

Only remove the tornado_connection.TornadoConnection file descriptor from the IOLoop if it's still open (Issue #221)
Allow messages with no body (Issue #227)
Allow for empty routing keys (Issue #224)
Don't raise an exception when trying to send a frame to a closed connection (Issue #229)
Only send a Connection.CloseOk if the connection is still open. (Issue #236 - Fix by noleaf)
Fix timeout threshold in blocking connection - (Issue #232 - Fix by Adam Flynn)
Fix closing connection while a channel is still open (Issue #230 - Fix by Adam Flynn)
Fixed misleading warning and exception messages in BaseConnection (Issue #237 - Fix by Tristan Penman)
Pluralised and altered the wording of the AMQPConnectionError exception (Issue #237 - Fix by Tristan Penman)
Fixed _adapter_disconnect in TornadoConnection class (Issue #237 - Fix by Tristan Penman)
Fixing hang when closing connection without any channel in BlockingConnection (Issue #244 - Fix by Ales Teska)
Remove the process_timeouts() call in SelectConnection (Issue #239)
Change the string validation to basestring for host connection parameters (Issue #231)
Add a poller to the BlockingConnection to address latency issues introduced in Pika 0.9.8 (Issue #242)
reply_code and reply_text is not set in ChannelException (Issue #250)
Add the missing constraint parameter for Channel._on_return callback processing (Issue #257 - Fix by patcpsc)
Channel callbacks not being removed from callback manager when channel is closed or deleted (Issue #261)

Roadmap

0.9.10 is slated to re-introduce the Twisted adapter and will abstract out frame marshaling and demarshalling to the pamqp library. The goal is to use this library to provide an abstraction around the pure-python AMQP implementation while allowing for transparent use of librabbitmq for performance enhancements. Any future versions after 0.9.10 will be purely bug fix versions until 1.0 which will be used to signify a stable API with no intended backwards-incompatible changes.

I have begun the initial investigation of Python 3 support and believe that by implementing the use of the pamqp library in 0.9.10 it will make it much easier to port Pika to Python 3 without breakage.

As always, if you happen across any bugs, please report them at https://github.com/pika/pika/issues

Regards,

Gavin

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130129/f01cf9d4/attachment.htm>

From antouboduor at gmail.com  Wed Jan 30 06:42:43 2013
From: antouboduor at gmail.com (Anthony Oduor)
Date: Wed, 30 Jan 2013 09:42:43 +0300
Subject: [rabbitmq-discuss]  Cannot access rabbitmqadmin.
In-Reply-To: <CAEey+b+u0rfE5vY5-avwt_UEaAkWYC=64oABiFDUqib2ZAw17w@mail.gmail.com>
References: <5753af5f-6c71-42db-91db-58279c63d685@googlegroups.com>
	<0790b109-e918-4261-924e-129cd7978e99@googlegroups.com>
	<5101367C.6000005@rabbitmq.com>
	<CAEey+bJXVYP_q-yaiKZa3CMX0Ph1CK0jMWyyt+eU=KwqspFsUg@mail.gmail.com>
	<5107A503.3090505@rabbitmq.com>
	<CAEey+bJRcBf_h6B4QE1CzbBOqix+UPtzBgePp3bqy2wRXuGUKg@mail.gmail.com>
	<5107F62A.2050207@rabbitmq.com>
	<CAEey+b+u0rfE5vY5-avwt_UEaAkWYC=64oABiFDUqib2ZAw17w@mail.gmail.com>
Message-ID: <CAEey+bLzgBKpUBQoHqR=kQ_nPRpLxjTXnM8r9HgH3PsAkcwDvg@mail.gmail.com>

---------- Forwarded message ----------
From: Anthony Oduor <antouboduor at gmail.com>
Date: Wed, Jan 30, 2013 at 9:41 AM
Subject: Re: [rabbitmq-discuss] Cannot access rabbitmqadmin.
To: Simon MacMullen <simon at rabbitmq.com>


Yes. That's the command I am using to start RabbitMQ. The problem seems to
have disappeared after restarting the machine, I will add the echo for
future debug  purposes in-case it happens again. Both scripts had the same
value when I added the echo:

RABBITMQ_ENABLED_PLUGINS_FILE=./../etc/rabbitmq/enabled_plugins

Thank you Simon.


On Tue, Jan 29, 2013 at 7:17 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> Hmm. I just downloaded the 2.8.4 tarball and tried this out - both
> rabbitmq-plugins and rabbitmq-server picked up the same location for the
> file.
>
> It might be worth editing the two scripts to add:
>
> echo RABBITMQ_ENABLED_PLUGINS_FILE=**$RABBITMQ_ENABLED_PLUGINS_FILE
>
> just before the "exec erl" so you can see what the two scripts are seeing.
>
> Just to be clear, you are starting rabbitmq-server by invoking
> "./rabbitmq-server"?
>
> Cheers, Simon
>
>
> On 29/01/13 11:20, Anthony Oduor wrote:
>
>> Thanks for your reply.
>>
>> Yes, installed via /rabbitmq-server-generic-unix-**2.8.4.tar.gz/ on my
>>
>> /home/anthony/rabbitmq/
>>
>> I am able to access the sbin and run the rabbitmq-* scripts with the
>> same user. In this case, I am not sure how they could be reading
>> different values of RABBITMQ_ENABLED_PLUGINS_FILE. This just happened
>> yesterday when restarted the rabbitmq-server, I haven't encountered this
>> before.
>>
>>
>> On Tue, Jan 29, 2013 at 1:31 PM, Simon MacMullen <simon at rabbitmq.com
>> <mailto:simon at rabbitmq.com>> wrote:
>>
>>     Hmm. Your symptoms are consistent with rabbitmq-plugins and
>>     rabbitmq-server using a different enabled_plugins file. How did you
>>     install RabbitMQ? I notice that you are invoking rabbitmq-plugins
>>     from the current directory as a normal user, so did you perform a
>>     manual installation?
>>
>>     If so, make sure that both rabbitmq-plugins and rabbitmq-server see
>>     the same value for RABBITMQ_ENABLED_PLUGINS_FILE.
>>
>>     Cheers, Simon
>>
>>
>>     On 29/01/13 07:39, Anthony Oduor wrote:
>>
>>         Hello,
>>
>>         Encountered this issue too. Everything is running fine, ports
>>         4369 with
>>         epmd is up, but cannot access the web management page.
>>
>>         $ ./rabbitmq-plugins list
>>         [e] amqp_client                       2.8.4
>>         [ ] eldap                             2.8.4-git
>>         [ ] erlando                           2.8.4
>>         [e] mochiweb                          1.3-rmq2.8.4-git
>>         [ ] rabbitmq_auth_backend_ldap        2.8.4
>>         [ ] rabbitmq_auth_mechanism_ssl       2.8.4
>>         [ ] rabbitmq_consistent_hash___**exchange 2.8.4
>>
>>         [ ] rabbitmq_federation               2.8.4
>>         [ ] rabbitmq_federation_management    2.8.4
>>         [ ] rabbitmq_jsonrpc                  2.8.4
>>         [ ] rabbitmq_jsonrpc_channel          2.8.4
>>         [ ] rabbitmq_jsonrpc_channel___**examples 2.8.4
>>
>>         [E] rabbitmq_management               2.8.4
>>         [e] rabbitmq_management_agent         2.8.4
>>         [E] rabbitmq_management_visualiser    2.8.4
>>         [e] rabbitmq_mochiweb                 2.8.4
>>         [ ] rabbitmq_shovel                   2.8.4
>>         [ ] rabbitmq_shovel_management        2.8.4
>>         [ ] rabbitmq_stomp                    2.8.4
>>         [ ] rabbitmq_tracing                  2.8.4
>>         [ ] rfc4627_jsonrpc                   2.8.4-git
>>         [e] webmachine                        1.7.0-rmq2.8.4-hg
>>
>>         But it still failed to activate the plugins this time.
>>
>>         The log ends without activating the plugins, see below:
>>
>>         ...
>>         -- message delivery logic ready
>>         starting error log relay
>>            ...done
>>         starting networking
>>         ...done
>>         starting direct client
>>            ...done
>>         starting notify cluster nodes
>>         ...done
>>
>>         broker running
>>         ** Found 0 name clashes in code paths
>>
>>         RabbitMQ v2.8.4, Ubuntu 10.04
>>
>>         Thanks!
>>
>>         On Thu, Jan 24, 2013 at 4:26 PM, Simon MacMullen
>>         <simon at rabbitmq.com <mailto:simon at rabbitmq.com>
>>         <mailto:simon at rabbitmq.com <mailto:simon at rabbitmq.com>>> wrote:
>>
>>              Ah - so you were using "rabbitmqctl stop_app" and
>> "rabbitmqctl
>>              start_app" - yes that would not work since they never halt
>> the
>>              Erlang VM. "service rabbitmq-server restart" would have
>> worked
>>              without a reboot.
>>
>>              I guess we should try to make that clearer.
>>
>>              Cheers, Simon
>>
>>
>>              On 24/01/13 05:56, Alex Damian wrote:
>>
>>                  I finally got it working. Restarting and stopping the
>>         server with
>>                  rabbitmqctl did not work. So I rebooted then restarted
>>         directly
>>                  with the
>>                  rabbitmq-server start command and this time it seemed
>>         to load
>>                  all the
>>                  plugins including Mochiweb and I was able to open the
>> admin
>>                  webpage. I'm
>>                  not sure why it did not work immediately after the
>>         plugins were
>>                  enabled...however I'm happy with this solution albeit
>>         not ideal
>>                  since it
>>                  required a reboot.
>>
>>                  On Tuesday, January 22, 2013 5:23:24 PM UTC-5, Alex
>>         Damian wrote:
>>
>>                       Hi
>>
>>                       I have followed all the instructions on
>>         http://www.rabbitmq.com/____**management.html<http://www.rabbitmq.com/____management.html>
>>         <http://www.rabbitmq.com/__**management.html<http://www.rabbitmq.com/__management.html>
>> >
>>                  <http://www.rabbitmq.com/__**management.html<http://www.rabbitmq.com/__management.html>
>>         <http://www.rabbitmq.com/**management.html<http://www.rabbitmq.com/management.html>
>> >>
>>                       <http://www.rabbitmq.com/____**management.html<http://www.rabbitmq.com/____management.html>
>>         <http://www.rabbitmq.com/__**management.html<http://www.rabbitmq.com/__management.html>
>> >
>>
>>
>>                  <http://www.rabbitmq.com/__**management.html<http://www.rabbitmq.com/__management.html>
>>         <http://www.rabbitmq.com/**management.html<http://www.rabbitmq.com/management.html>>>>
>> and enabled the plugin,
>>                       but after than there is no webserver running
>>         anywhere on my
>>                  machine.
>>                       There is no way to connect to Mochiweb at all. I
>> have
>>                  restarted the
>>                       service and still nothing. I have also tried the
>>                       "http:///server-name/:15672/" URL with "localhost",
>>                  127.0.0.1 and
>>
>>                       also the full server name, all of which are
>>         /etc/hosts file. My
>>                       vhost is the default "/". Should I add something in
>> my
>>                  config file
>>                       perhaps? I have also tried a /curl/ command and
>>         still nothing.
>>
>>
>>                       I am running on Fedora Core 17 with all latest libs
>>                  including latest
>>                       rabbitMQ sw. I have checked the listening ports on
>> the
>>                  server and i
>>                       only see the AMQP one.
>>                       Also I can run rabbitmq-server and rabbitmqctl
>> without
>>                  issues. I
>>                       have also been able to create exchanges/queues via
>>         rabbit.js on
>>                       Node. However not having a proper admin tool is a
>> bit
>>                  drawback. I
>>                       wonder why it's not possible to supply one like
>>         (or enhance)
>>                       rabbitmqctl. Seems to do the job just fine.
>>
>>                       Any help would be greatly appreciated!
>>
>>
>>
>>                  ______________________________**_____________________
>>                  rabbitmq-discuss mailing list
>>                  rabbitmq-discuss at lists.__rabbi**__tmq.com<http://rabbi__tmq.com>
>>         <http://rabbitmq.com>
>>                  <mailto:rabbitmq-discuss at __lis**ts.rabbitmq.com<http://lists.rabbitmq.com>
>>         <mailto:rabbitmq-discuss@**lists.rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> >>
>>         https://lists.rabbitmq.com/___**_cgi-bin/mailman/listinfo/____**
>> rabbitmq-discuss<https://lists.rabbitmq.com/____cgi-bin/mailman/listinfo/____rabbitmq-discuss>
>>         <https://lists.rabbitmq.com/__**cgi-bin/mailman/listinfo/__**
>> rabbitmq-discuss<https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss>
>> >
>>
>>
>>
>>         <https://lists.rabbitmq.com/__**cgi-bin/mailman/listinfo/__**
>> rabbitmq-discuss<https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss>
>>         <https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**
>> rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>> >>
>>
>>
>>
>>              --
>>              Simon MacMullen
>>              RabbitMQ, VMware
>>              ______________________________**_____________________
>>              rabbitmq-discuss mailing list
>>              rabbitmq-discuss at lists.__rabbi**__tmq.com<http://rabbi__tmq.com><
>> http://rabbitmq.com>
>>              <mailto:rabbitmq-discuss at __lis**ts.rabbitmq.com<http://lists.rabbitmq.com>
>>         <mailto:rabbitmq-discuss@**lists.rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> >>
>>         https://lists.rabbitmq.com/___**_cgi-bin/mailman/listinfo/____**
>> rabbitmq-discuss<https://lists.rabbitmq.com/____cgi-bin/mailman/listinfo/____rabbitmq-discuss>
>>         <https://lists.rabbitmq.com/__**cgi-bin/mailman/listinfo/__**
>> rabbitmq-discuss<https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss>
>> >
>>
>>
>>
>>         <https://lists.rabbitmq.com/__**cgi-bin/mailman/listinfo/__**
>> rabbitmq-discuss<https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss>
>>         <https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**
>> rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>> >>
>>
>>
>>
>>
>>         --
>>
>>         http://about.me/outhorand/bio
>>
>>
>>
>>         ______________________________**___________________
>>         rabbitmq-discuss mailing list
>>         rabbitmq-discuss at lists.__rabbi**tmq.com <http://rabbitmq.com>
>>         <mailto:rabbitmq-discuss@**lists.rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> >
>>         https://lists.rabbitmq.com/__**cgi-bin/mailman/listinfo/__**
>> rabbitmq-discuss<https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss>
>>         <https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**
>> rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>> >
>>
>>
>>
>>     --
>>     Simon MacMullen
>>     RabbitMQ, VMware
>>
>>
>>
>>
>> --
>>
>> http://about.me/outhorand/bio
>>
>>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>



-- 

http://about.me/outhorand/bio



-- 

http://about.me/outhorand/bio
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130130/e5bec866/attachment.htm>

From matthias at rabbitmq.com  Wed Jan 30 08:04:50 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 30 Jan 2013 08:04:50 +0000
Subject: [rabbitmq-discuss] Cannot access rabbitmqadmin.
In-Reply-To: <CAEey+bLzgBKpUBQoHqR=kQ_nPRpLxjTXnM8r9HgH3PsAkcwDvg@mail.gmail.com>
References: <5753af5f-6c71-42db-91db-58279c63d685@googlegroups.com>
	<0790b109-e918-4261-924e-129cd7978e99@googlegroups.com>
	<5101367C.6000005@rabbitmq.com>
	<CAEey+bJXVYP_q-yaiKZa3CMX0Ph1CK0jMWyyt+eU=KwqspFsUg@mail.gmail.com>
	<5107A503.3090505@rabbitmq.com>
	<CAEey+bJRcBf_h6B4QE1CzbBOqix+UPtzBgePp3bqy2wRXuGUKg@mail.gmail.com>
	<5107F62A.2050207@rabbitmq.com>
	<CAEey+b+u0rfE5vY5-avwt_UEaAkWYC=64oABiFDUqib2ZAw17w@mail.gmail.com>
	<CAEey+bLzgBKpUBQoHqR=kQ_nPRpLxjTXnM8r9HgH3PsAkcwDvg@mail.gmail.com>
Message-ID: <5108D422.9040009@rabbitmq.com>

Anthony,

On 30/01/13 06:42, Anthony Oduor wrote:
> Yes. That's the command I am using to start RabbitMQ. The problem
> seems to have disappeared after restarting the machine

It certainly shouldn't be necessary to reboot the machine to enable plugins.

> I will add the echo for future debug  purposes in-case it happens
> again.

Can you enable plugins now w/o rebooting?

E.g. what happens if, say, you enable the stomp plugin with

$ cd rabbitmq_server-2.8.4/sbin/
$ ./rabbitmq-plugins enable rabbitmq_stomp
$ ./rabbitmqctl stop
$ ./rabbitmq-server

?

Regards,

Matthias.

From siva.savitala at gmail.com  Wed Jan 30 09:32:02 2013
From: siva.savitala at gmail.com (siva)
Date: Wed, 30 Jan 2013 15:02:02 +0530
Subject: [rabbitmq-discuss] Rabbit MQ Mgt Plugin Installation on Linux
Message-ID: <CAODRQXpoQDeFdVeRCZR9hj0spFZUU7NKdnR-p-=rdbFEwCDbyw@mail.gmail.com>

Hi..

My Name is Siva,

I've a doubt regarding Management Plugins Installation for RabbitMQ on
Linux, as i tried and not get succeded.

can anyone help me out on this.

Thanks,
Siva.S
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130130/1f4915d1/attachment.htm>

From emile at rabbitmq.com  Wed Jan 30 10:01:12 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 30 Jan 2013 10:01:12 +0000
Subject: [rabbitmq-discuss] Rabbit MQ Mgt Plugin Installation on Linux
In-Reply-To: <CAODRQXpoQDeFdVeRCZR9hj0spFZUU7NKdnR-p-=rdbFEwCDbyw@mail.gmail.com>
References: <CAODRQXpoQDeFdVeRCZR9hj0spFZUU7NKdnR-p-=rdbFEwCDbyw@mail.gmail.com>
Message-ID: <5108EF68.10302@rabbitmq.com>

Hi,

On 30/01/13 09:32, siva wrote:
> I've a doubt regarding Management Plugins Installation for RabbitMQ on
> Linux, as i tried and not get succeded.
That is not enough information. Please quote what was displayed on the
console and any errors reported in the main and sasl broker logs, after
following the instructions at http://www.rabbitmq.com/management.html .




-Emile




From matthias at rabbitmq.com  Wed Jan 30 10:24:16 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 30 Jan 2013 10:24:16 +0000
Subject: [rabbitmq-discuss] Federation in a cluster
In-Reply-To: <C0AA40FB-D66B-4697-9282-7861EFE5C6CC@ll.mit.edu>
References: <3A89DE15-04CB-4209-90A4-A694A3170C0C@ll.mit.edu>
	<5107F87D.8040305@rabbitmq.com>
	<C0AA40FB-D66B-4697-9282-7861EFE5C6CC@ll.mit.edu>
Message-ID: <5108F4D0.2000909@rabbitmq.com>

Yican,

On 29/01/13 17:05, Cao, Yican - 0551 - MITLL wrote:
> You are saying I only need to declare one setting in E?

As Simon said, parameters and policies are cluster wide, so declaring 
them on one of the cluster nodes is sufficient. You *can* declare them 
on all nodes, but there is no point; you'd just be (re-)setting the same 
cluster-wide setting over and over.

> ie.
> in E:
> rabbitmqctl set_parameter federation-upstream my-upstream
> '{"uri":"amqp://A", "expires":3600}'
> rabbitmqctl set_policy...
> ....

Yes.

> Now, it comes that if A which is my upstream fails, what would
> happen? [A, B, C] is running with HAQ (active/active).
> Do I just lost federation?

Yes, the federation link will be broken. As Simon says, the federation 
plug-in currently does not have any built-in failover. One way around 
that is to stick a load-balancer in front of [A,B,C] and connect to that 
instead of an individual node.

> [E, F] also runs HAQ cluster, what if E dies, how to config F continue
> to perform as down-stream nodes as HAQ suppose to do ? Can we achieve this?

 From http://www.rabbitmq.com/federation.html#getting-started
<quote>
If a node fails, links to upstream exchanges will be recreated on a 
surviving node.
</quote>


Matthias.

From simlu at su.se  Wed Jan 30 12:31:06 2013
From: simlu at su.se (Simon =?iso-8859-1?Q?Lundstr=F6m?=)
Date: Wed, 30 Jan 2013 13:31:06 +0100
Subject: [rabbitmq-discuss] Creating an auth plugin (Kerberos)
In-Reply-To: <05223E0E-9BBE-4842-AC20-DBEB330791BD@rabbitmq.com>
References: <20121205155530.GL335@kaka.it.su.se>
	<20121211162045.GE754@kaka.it.su.se>
	<C6E90E05-4AE0-490E-9E45-EC9DE96F03BA@rabbitmq.com>
	<20121211193803.GG754@kaka.it.su.se>
	<4D859580-D762-4BFA-A759-43F94B500FC7@rabbitmq.com>
	<20121212093115.GH754@kaka.it.su.se>
	<8D205910-A3E3-472D-A7AA-8D5737812DC4@rabbitmq.com>
	<20121221093949.GA14329@kaka.it.su.se>
	<53443B9F-8877-4993-9732-35F417AE04F0@rabbitmq.com>
	<05223E0E-9BBE-4842-AC20-DBEB330791BD@rabbitmq.com>
Message-ID: <20130130123105.GO407@kaka.it.su.se>

On Fri, 2012-12-28 at 14:10:25 +0000, Tim Watson wrote:
> Here's what I did. Firstly, I tweaked the package.mk so that the plugin got included in the release bundle,

Please elaborate on this. Why should I do this? I use `make dist` when I
build the plugin (see below also).

> plus I had to add some noise to the compiler flags in order to build the native library on 64bit Mac OS (Lion).

Hm, I'm on 64bit Mac OS (Lion 10.7.5) and I don't get any noise. I'm
using some flags though:

rabbitmq-public-umbrella/rabbitmq-auth-backend-kerberos$ LDFLAGS="-L/usr/heimdal/lib -undefined dynamic_lookup -dynamiclib" CFLAGS="-I/usr/heimdal/include -I/usr/local/Cellar/erlang/R15B02/lib/erlang/usr/include/" make dist

> Then I made sure that the hard coded path which the on_load function uses to locate the image was exactly where $RABBITMQ_PLUGINS_EXPAND_DIR points to, plus the app+vsn/priv/.... etc.

Hm, how did you change the path for on_load?

> After this, the plugin loads correctly, the NIF is instantiated properly and I can interact with the kinit module as expected:

Woo! \o/

> I suspect your problem is that you're not calculating the location of the directory into which the plugins are exploded properly. Take a look at rabbit_plugins:setup/0 to see how all these things are calculated, then try and mimic this behaviour to locate your target directory dynamically (and correctly!) at runtime.

Ah, it seems that you are using 3.x (because I can't find the setup/0 function
in rabbitmq-server/src/rabbit_plugins.erl)? I'm still on 2.8.7 but I'd recon
this is the time to upgrade and make my plugin >3.x only.

Thanks,
- Simon

From tim at rabbitmq.com  Wed Jan 30 13:42:03 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 30 Jan 2013 13:42:03 +0000
Subject: [rabbitmq-discuss] Creating an auth plugin (Kerberos)
In-Reply-To: <20130130123105.GO407@kaka.it.su.se>
References: <20121205155530.GL335@kaka.it.su.se>
	<20121211162045.GE754@kaka.it.su.se>
	<C6E90E05-4AE0-490E-9E45-EC9DE96F03BA@rabbitmq.com>
	<20121211193803.GG754@kaka.it.su.se>
	<4D859580-D762-4BFA-A759-43F94B500FC7@rabbitmq.com>
	<20121212093115.GH754@kaka.it.su.se>
	<8D205910-A3E3-472D-A7AA-8D5737812DC4@rabbitmq.com>
	<20121221093949.GA14329@kaka.it.su.se>
	<53443B9F-8877-4993-9732-35F417AE04F0@rabbitmq.com>
	<05223E0E-9BBE-4842-AC20-DBEB330791BD@rabbitmq.com>
	<20130130123105.GO407@kaka.it.su.se>
Message-ID: <B5A8398F-1ADD-407D-B3CD-38E60313BC4C@rabbitmq.com>

Hi Simon

On 30 Jan 2013, at 12:31, Simon Lundstr?m wrote:

> On Fri, 2012-12-28 at 14:10:25 +0000, Tim Watson wrote:
>> Here's what I did. Firstly, I tweaked the package.mk so that the plugin got included in the release bundle,
> 
> Please elaborate on this. Why should I do this? I use `make dist` when I
> build the plugin (see below also).
> 

Sure, but if you don't put `RELEASABLE:=true` in the package.mk then the plugin doesn't make it into the right directory.

>> plus I had to add some noise to the compiler flags in order to build the native library on 64bit Mac OS (Lion).
> 
> Hm, I'm on 64bit Mac OS (Lion 10.7.5) and I don't get any noise. I'm
> using some flags though:
> 
> rabbitmq-public-umbrella/rabbitmq-auth-backend-kerberos$ LDFLAGS="-L/usr/heimdal/lib -undefined dynamic_lookup -dynamiclib" CFLAGS="-I/usr/heimdal/include -I/usr/local/Cellar/erlang/R15B02/lib/erlang/usr/include/" make dist
> 

Well that's fine, I did it through CC_OPTS in package.mk like so:

CC_OPTS:=-g -Wall -pedantic -std=c99 -O2 -arch x86_64 -fPIC -bundle -flat_namespace -undefined suppress -I/Users/t4/Library/Erlang/Current/lib/erlang/erts-5.9.1/include $(CFLAGS) $(LDFLAGS)

If your erlang is 32bit you wouldn't need the -arch check, and I suppose '-undefined suppress' isn't very structured. :/

>> Then I made sure that the hard coded path which the on_load function uses to locate the image was exactly where $RABBITMQ_PLUGINS_EXPAND_DIR points to, plus the app+vsn/priv/.... etc.
> 
> Hm, how did you change the path for on_load?
> 

Like I said below, I changed it to look in the *right* place:

Kinit = "/tmp/rabbitmq-rabbit-plugins-scratch/rabbitmq_auth_backend_kerberos-0.0.0/priv/kinit",
erlang:load_nif(Kinit, 0).

> 
>> I suspect your problem is that you're not calculating the location of the directory into which the plugins are exploded properly. Take a look at rabbit_plugins:setup/0 to see how all these things are calculated, then try and mimic this behaviour to locate your target directory dynamically (and correctly!) at runtime.
> 
> Ah, it seems that you are using 3.x (because I can't find the setup/0 function
> in rabbitmq-server/src/rabbit_plugins.erl)? I'm still on 2.8.7 but I'd recon
> this is the time to upgrade and make my plugin >3.x only.
> 

Yes - that's a good plan anyway. Like I said, you can use some os:getenv/1 calls to find the right directory path to look in, and rabbit_plugins:setup/0 uses these so you can copy the approach from there. From what I recall, you can use RABBITMQ_PLUGINS_SCRATCH_DIR but I'm not 100% sure that gets set in all cases. It's probably worth looking at the various scripts in ../rabbitmq-server/scripts to figure out which environment variables are *always* set and the generate a relative path using the filename module.

Cheers,
Tim


From prabodh.upreti at vce.com  Wed Jan 30 14:14:35 2013
From: prabodh.upreti at vce.com (Prabodh Upreti)
Date: Wed, 30 Jan 2013 06:14:35 -0800 (PST)
Subject: [rabbitmq-discuss] hostname change
In-Reply-To: <CAE0Sz=xMP+LUxC4L6Bqi5AubjrgcjnEvs5TVtF=uoM9r1f5qDg@mail.gmail.com>
References: <1359383662020-24717.post@n5.nabble.com>
	<CAE0Sz=xMP+LUxC4L6Bqi5AubjrgcjnEvs5TVtF=uoM9r1f5qDg@mail.gmail.com>
Message-ID: <1359555275747-24767.post@n5.nabble.com>

I am going to replicate this again and update the details. For now, I solved
the problem by creating the RABBITMQ_HOSTNAME variable. Rabbitmqctl seems to
be working now.  I did not care about the old data so I am good. I will be
doing message persistence in the future and need to fully understand the
implication of hostname change. I will update my errors shortly. Thank you.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/hostname-change-tp24717p24767.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From romanass at gmail.com  Wed Jan 30 16:34:22 2013
From: romanass at gmail.com (Romanas)
Date: Wed, 30 Jan 2013 16:34:22 +0000
Subject: [rabbitmq-discuss] RabbitMQ cluster with potentially millions
	of connections
In-Reply-To: <CABHYwy866TWdOYQMjBq4K7FuN6iS6=19inNs9s=SE+Pvj3JO9Q@mail.gmail.com>
References: <f75213a1-1571-415b-a5ba-e84c0d6bd0c9@googlegroups.com>
	<B7054A02-D98F-488F-A76B-EE22B047BE74@gmail.com>
	<1359393082853-24720.post@n5.nabble.com>
	<5106BBD2.7030205@rabbitmq.com>
	<CABHYwy866TWdOYQMjBq4K7FuN6iS6=19inNs9s=SE+Pvj3JO9Q@mail.gmail.com>
Message-ID: <CABHYwy9U08ViLAgn32Awc9W025a1MUChTqrVBK0=mA71rxWSeA@mail.gmail.com>

Hi guys,
 after disabling the management plugin, I'm able to scale to more than 50k
connections per node in a cluster, with a cluster of 250k nodes so far.
Unfortunately I reached the limits of my AWS account, so can't scale more
right now, but this has definitely upped my confidence in Rabbit. I really
hope the management plugin will get improved, since it's a pain to see
what's going on without it!

Regards,
Roman
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130130/05417fd5/attachment.htm>

From matthias at rabbitmq.com  Wed Jan 30 16:43:42 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 30 Jan 2013 16:43:42 +0000
Subject: [rabbitmq-discuss] RabbitMQ cluster with potentially millions
 of connections
In-Reply-To: <CABHYwy9U08ViLAgn32Awc9W025a1MUChTqrVBK0=mA71rxWSeA@mail.gmail.com>
References: <f75213a1-1571-415b-a5ba-e84c0d6bd0c9@googlegroups.com>
	<B7054A02-D98F-488F-A76B-EE22B047BE74@gmail.com>
	<1359393082853-24720.post@n5.nabble.com>
	<5106BBD2.7030205@rabbitmq.com>
	<CABHYwy866TWdOYQMjBq4K7FuN6iS6=19inNs9s=SE+Pvj3JO9Q@mail.gmail.com>
	<CABHYwy9U08ViLAgn32Awc9W025a1MUChTqrVBK0=mA71rxWSeA@mail.gmail.com>
Message-ID: <51094DBE.2090605@rabbitmq.com>

Roman,

On 30/01/13 16:34, Romanas wrote:
> with a cluster of 250k nodes

You didn't really test with 250,000 nodes. Or did you?!?

Matthias.

From simon at rabbitmq.com  Wed Jan 30 16:45:29 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 30 Jan 2013 16:45:29 +0000
Subject: [rabbitmq-discuss] RabbitMQ cluster with potentially millions
 of connections
In-Reply-To: <CABHYwy9U08ViLAgn32Awc9W025a1MUChTqrVBK0=mA71rxWSeA@mail.gmail.com>
References: <f75213a1-1571-415b-a5ba-e84c0d6bd0c9@googlegroups.com>
	<B7054A02-D98F-488F-A76B-EE22B047BE74@gmail.com>
	<1359393082853-24720.post@n5.nabble.com>
	<5106BBD2.7030205@rabbitmq.com>
	<CABHYwy866TWdOYQMjBq4K7FuN6iS6=19inNs9s=SE+Pvj3JO9Q@mail.gmail.com>
	<CABHYwy9U08ViLAgn32Awc9W025a1MUChTqrVBK0=mA71rxWSeA@mail.gmail.com>
Message-ID: <51094E29.50005@rabbitmq.com>

On 30/01/13 16:34, Romanas wrote:
> I really hope the management plugin will get improved, since it's a pain
> to see what's going on without it!

It's possible you could get improvements by switching off fine grained 
statistics and increasing the statistics interval, as documented at:

http://www.rabbitmq.com/management.html#configuration-file

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed Jan 30 16:49:23 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 30 Jan 2013 16:49:23 +0000
Subject: [rabbitmq-discuss] RabbitMQ and Erlang R16A
Message-ID: <51094F13.4010801@rabbitmq.com>

Just a heads up to anyone who's interested in bleeding-edge(ish) Erlang: 
RabbitMQ won't currently compile on Erlang R16A. If compiled on an 
earlier version it will run on R16A.

More details: the core broker compiles fine. But mochiweb depends on 
parameterised modules which have been removed from the compiler, so 
mochiweb and all the plugins which depend on it (principally management) 
won't compile.

We hope to have a fix out soon...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From romanass at gmail.com  Wed Jan 30 17:11:44 2013
From: romanass at gmail.com (Romanas)
Date: Wed, 30 Jan 2013 17:11:44 +0000
Subject: [rabbitmq-discuss] RabbitMQ cluster with potentially millions
	of connections
In-Reply-To: <51094DBE.2090605@rabbitmq.com>
References: <f75213a1-1571-415b-a5ba-e84c0d6bd0c9@googlegroups.com>
	<B7054A02-D98F-488F-A76B-EE22B047BE74@gmail.com>
	<1359393082853-24720.post@n5.nabble.com>
	<5106BBD2.7030205@rabbitmq.com>
	<CABHYwy866TWdOYQMjBq4K7FuN6iS6=19inNs9s=SE+Pvj3JO9Q@mail.gmail.com>
	<CABHYwy9U08ViLAgn32Awc9W025a1MUChTqrVBK0=mA71rxWSeA@mail.gmail.com>
	<51094DBE.2090605@rabbitmq.com>
Message-ID: <CABHYwy9MJ425Q5n-T1GDDC_cihUddcfpRAZfxVjEjvoDtozopg@mail.gmail.com>

> On 30/01/13 16:34, Romanas wrote:
>
>> with a cluster of 250k nodes
>>
>
> You didn't really test with 250,000 nodes. Or did you?!?


:)) Yes, sorry, I obviously meant connections. There were 5 nodes.

Roman
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130130/f643bcec/attachment.htm>

From videlalvaro at gmail.com  Wed Jan 30 17:28:37 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 30 Jan 2013 18:28:37 +0100
Subject: [rabbitmq-discuss] RabbitMQ and Erlang R16A
In-Reply-To: <51094F13.4010801@rabbitmq.com>
References: <51094F13.4010801@rabbitmq.com>
Message-ID: <CAMcAHLWPY1i+i6ESi7G92AuiXp4cpqMnxtznqXF02R+8kT7dTw@mail.gmail.com>

Hi,

It seems Steve Vinoski has patched Mochiweb already:
https://twitter.com/stevevinoski/status/296670414250319872

Regards,

Alvaro


On Wed, Jan 30, 2013 at 5:49 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> Just a heads up to anyone who's interested in bleeding-edge(ish) Erlang:
> RabbitMQ won't currently compile on Erlang R16A. If compiled on an earlier
> version it will run on R16A.
>
> More details: the core broker compiles fine. But mochiweb depends on
> parameterised modules which have been removed from the compiler, so
> mochiweb and all the plugins which depend on it (principally management)
> won't compile.
>
> We hope to have a fix out soon...
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130130/c4c70494/attachment.htm>

From n16483 at cray.com  Wed Jan 30 17:26:59 2013
From: n16483 at cray.com (Eric Cozzi)
Date: Wed, 30 Jan 2013 11:26:59 -0600
Subject: [rabbitmq-discuss] Performance Hit when using Federation
Message-ID: <510957E3.6020500@cray.com>

Hello all,

I am investigating RabbitMQ for a project where we would need to 
federate multiple brokers. From my testing, I'm seeing acceptable 
throughput results as long as the server and client are bot talking to 
the same RabbitMQ server instance. However, as soon as I have the Server 
and Client talking to different servers using a federated exchange, I'm 
only seeing 1/4 of the throughput. Is this expected? I've looked at 
changing the prefetch counts, to no obvious avail. Any other items that 
I can tune?

Thanks,
Eric

From simon at rabbitmq.com  Wed Jan 30 17:49:55 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 30 Jan 2013 17:49:55 +0000
Subject: [rabbitmq-discuss] RabbitMQ and Erlang R16A
In-Reply-To: <CAMcAHLWPY1i+i6ESi7G92AuiXp4cpqMnxtznqXF02R+8kT7dTw@mail.gmail.com>
References: <51094F13.4010801@rabbitmq.com>
	<CAMcAHLWPY1i+i6ESi7G92AuiXp4cpqMnxtznqXF02R+8kT7dTw@mail.gmail.com>
Message-ID: <51095D43.5030706@rabbitmq.com>

Ah, I see. That wasn't there when I posted.

I think for RabbitMQ we're more likely to use the parse transform since 
we have a bunch of code using mochiweb that I don't want to rewrite 
(except to move to cowboy...)

Cheers, Simon

On 30/01/13 17:28, Alvaro Videla wrote:
> Hi,
>
> It seems Steve Vinoski has patched Mochiweb already:
> https://twitter.com/stevevinoski/status/296670414250319872
>
> Regards,
>
> Alvaro
>
>
> On Wed, Jan 30, 2013 at 5:49 PM, Simon MacMullen <simon at rabbitmq.com
> <mailto:simon at rabbitmq.com>> wrote:
>
>     Just a heads up to anyone who's interested in bleeding-edge(ish)
>     Erlang: RabbitMQ won't currently compile on Erlang R16A. If compiled
>     on an earlier version it will run on R16A.
>
>     More details: the core broker compiles fine. But mochiweb depends on
>     parameterised modules which have been removed from the compiler, so
>     mochiweb and all the plugins which depend on it (principally
>     management) won't compile.
>
>     We hope to have a fix out soon...
>
>     Cheers, Simon
>
>     --
>     Simon MacMullen
>     RabbitMQ, VMware
>     _________________________________________________
>     rabbitmq-discuss mailing list
>     rabbitmq-discuss at lists.__rabbitmq.com
>     <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>     https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss
>     <https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed Jan 30 17:59:34 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 30 Jan 2013 17:59:34 +0000
Subject: [rabbitmq-discuss] Performance Hit when using Federation
In-Reply-To: <510957E3.6020500@cray.com>
References: <510957E3.6020500@cray.com>
Message-ID: <51095F86.1030100@rabbitmq.com>

On 30/01/13 17:26, Eric Cozzi wrote:
> Hello all,
>
> I am investigating RabbitMQ for a project where we would need to
> federate multiple brokers. From my testing, I'm seeing acceptable
> throughput results as long as the server and client are bot talking to
> the same RabbitMQ server instance. However, as soon as I have the Server
> and Client talking to different servers using a federated exchange, I'm
> only seeing 1/4 of the throughput. Is this expected?

Well, federation does require that the message be published on the 
source broker, consumed and republished by the federation plugin and 
finally consumed for real. So I would expect 1/2 the throughput for a 
simple Producer -> Broker A -> Broker B -> Consumer case.

Where federation *helps* throughput is when most of your messages can be 
local. Ultimately if every message has to go everywhere, you have a 
scaling problem anyway :-)

However, I wouldn't expect 1/4 the throughput... except that federation 
does transfer messages using confirms and acks. If your publishers and 
consumers are *not* using confirms / acks then they could go faster 
enough that the federation step in the middle would be that much more 
expensive. Does that sound like what might be happening?

And would anyone be interested in an optional mode for federation to 
disable confirms and acks, going faster at the expense of guaranteed 
delivery?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From n16483 at cray.com  Wed Jan 30 18:18:28 2013
From: n16483 at cray.com (Eric Cozzi)
Date: Wed, 30 Jan 2013 12:18:28 -0600
Subject: [rabbitmq-discuss] Performance Hit when using Federation
In-Reply-To: <51095F86.1030100@rabbitmq.com>
References: <510957E3.6020500@cray.com> <51095F86.1030100@rabbitmq.com>
Message-ID: <510963F4.10505@cray.com>

Wouldn't republishing more so affect latency, not throughput? I'd expect 
that the federated brokers should be able to republish the messages 
nearly as quickly as they received them. Sure there is going to be 
processing time to perform the network read, queue and re-send the 
message, but that shouldn't affect 'how many' messages a federated 
broker can send in a second?

One of the use cases that we're look at is being able to make an RPC 
call where the client and server are potentially on disparate, 
non-routable networks. Essentially, there would only be a few gateway 
nodes that would span both networks. We're looking at installing 
RabbitMQ on these gateway nodes, and at other key points in our system. 
Thus, we need to be able to support RPC across several intermediate 
RabbitMQ brokers. Federation seemed a natural fit, but is there 
another/better option? The shovel plugin doesn't look to me like it 
would easily fill our need, if I'm not mistaken.

As for having a mode where federation optimized speed over reliability, 
that might be interesting to us.

Eric

On 01/30/2013 11:59 AM, Simon MacMullen wrote:
> On 30/01/13 17:26, Eric Cozzi wrote:
>> Hello all,
>>
>> I am investigating RabbitMQ for a project where we would need to
>> federate multiple brokers. From my testing, I'm seeing acceptable
>> throughput results as long as the server and client are bot talking to
>> the same RabbitMQ server instance. However, as soon as I have the Server
>> and Client talking to different servers using a federated exchange, I'm
>> only seeing 1/4 of the throughput. Is this expected?
>
> Well, federation does require that the message be published on the 
> source broker, consumed and republished by the federation plugin and 
> finally consumed for real. So I would expect 1/2 the throughput for a 
> simple Producer -> Broker A -> Broker B -> Consumer case.
>
> Where federation *helps* throughput is when most of your messages can 
> be local. Ultimately if every message has to go everywhere, you have a 
> scaling problem anyway :-)
>
> However, I wouldn't expect 1/4 the throughput... except that 
> federation does transfer messages using confirms and acks. If your 
> publishers and consumers are *not* using confirms / acks then they 
> could go faster enough that the federation step in the middle would be 
> that much more expensive. Does that sound like what might be happening?
>
> And would anyone be interested in an optional mode for federation to 
> disable confirms and acks, going faster at the expense of guaranteed 
> delivery?
>
> Cheers, Simon
>

From kyleo at 0b10.mx  Wed Jan 30 18:26:00 2013
From: kyleo at 0b10.mx (Kyle O'Donnell)
Date: Wed, 30 Jan 2013 13:26:00 -0500 (EST)
Subject: [rabbitmq-discuss] Erlang R15B03
In-Reply-To: <392508914.15734.1359570159975.JavaMail.root@0b10.mx>
Message-ID: <847733117.15745.1359570360191.JavaMail.root@0b10.mx>

Hi,

Is anyone aware of performance degradation of rabbitmq (tested 2.8.7 3.0.1) when compiled with R15B03?  We've been using 2.7.2 built via R14B04 and noticed our app was timing out on occasion when we replaced the version of rabbit?  I haven't tested 2.7.2 with R15 yet, so perhaps this might be something changed in 2.8 and above?

Unfortunately I don't have specific details from our dev team yet, but I was wondering if anyone else had seen (or felt :) the same about R15?

Thanks,
Kyle

From brett.r.cameron at gmail.com  Wed Jan 30 19:01:45 2013
From: brett.r.cameron at gmail.com (Brett Cameron)
Date: Thu, 31 Jan 2013 08:01:45 +1300
Subject: [rabbitmq-discuss] RabbitMQ and Erlang R16A
In-Reply-To: <CAMcAHLWPY1i+i6ESi7G92AuiXp4cpqMnxtznqXF02R+8kT7dTw@mail.gmail.com>
References: <51094F13.4010801@rabbitmq.com>
	<CAMcAHLWPY1i+i6ESi7G92AuiXp4cpqMnxtznqXF02R+8kT7dTw@mail.gmail.com>
Message-ID: <CALPqkirHgW6TmTcHgwikohrct3KcPdOaHfNsRQe1ceQGgx26Aw@mail.gmail.com>

He's a good man that Mr V!

I sense an evening's hacking coming on....

On Thu, Jan 31, 2013 at 6:28 AM, Alvaro Videla <videlalvaro at gmail.com>wrote:

> Hi,
>
> It seems Steve Vinoski has patched Mochiweb already:
> https://twitter.com/stevevinoski/status/296670414250319872
>
> Regards,
>
> Alvaro
>
>
> On Wed, Jan 30, 2013 at 5:49 PM, Simon MacMullen <simon at rabbitmq.com>wrote:
>
>> Just a heads up to anyone who's interested in bleeding-edge(ish) Erlang:
>> RabbitMQ won't currently compile on Erlang R16A. If compiled on an earlier
>> version it will run on R16A.
>>
>> More details: the core broker compiles fine. But mochiweb depends on
>> parameterised modules which have been removed from the compiler, so
>> mochiweb and all the plugins which depend on it (principally management)
>> won't compile.
>>
>> We hope to have a fix out soon...
>>
>> Cheers, Simon
>>
>> --
>> Simon MacMullen
>> RabbitMQ, VMware
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130131/627f71e9/attachment.htm>

From phillpafford at gmail.com  Wed Jan 30 15:53:38 2013
From: phillpafford at gmail.com (Phill Pafford)
Date: Wed, 30 Jan 2013 07:53:38 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ Implementation
Message-ID: <71a8c6ed-9522-440b-8073-2d8d796f5cc7@googlegroups.com>

Here is a little about the setup I have currently. ( 
http://stackoverflow.com/questions/14594569/rabbitmq-implementation )

- REST API to push ( POST ) data into a queue
- The Queue has a Consumer that's always running and Produces to en Exchange
- The Exchange routes to several other Queues ( like 20+ )
- Each of the ( 20+ ) Queues does a specific task ( The Consumers always 
runs as well )
- Cron job runs to check if all the ( 20+ ) Tasks are completed and 
Produces to yet another Queue

I'm not sure I like the Consumers running all the time as each Consumer 
utilizes around 300MB of Ram ( I think it's MBs, it's not in front of me at 
the moment ) and I'm looking for another implementation.

        M <-- Message coming from REST API
        |
        |
        +-First Queue
        |
        |
        | <-- The Exchange
       /|\
      / | \
     /  |  \ <-- bind to multiple queues ( 20+ )
    Q1  Q2  Q3 <-- Each Queue is a task that must be completed
    
    
        | <-- CRON runs to check if all queues above have completed
        |
        |
        Q4 <-- Queues 1,2 and 3 must finish first before Queue 4 can start
        |
        C <-- Consumer 

I the related question below it was suggested to use RPC but the problem 
with this is the RPC ( to my understanding ) Will have multiple instances. 
This is a resource intense process as is and I think by adding the RPC 
calls it will just bog down the server and then become unresponsive ( 
Please correct me if I'm wrong ).

Another approach was to use the Aggregator pattern 

 - http://www.eaipatterns.com/Aggregator.html

Which looks exactly what I need but I found the documentation limited. Has 
anyone done this pattern? 

My question is I'm not happy with how it's currently implemented and I'm 
looking for ways to improve the process. I'm looking to either get rid of 
the CRON, Implement a new Pattern and Not have the Consumers run all the 
time.

The process currently also only supports a single instance of each 
consumer. It can have multiple consumers but how we have implemented it we 
only wanted one at the time.

This is implemented in PHP, Symfony2 Framework using the RabbitMQBundle

Related Question:

 - 
http://stackoverflow.com/questions/13861459/rabbitmq-wait-for-multiple-queues-to-finish

 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130130/fea82468/attachment.htm>

From developmentalmadness at gmail.com  Wed Jan 30 18:25:00 2013
From: developmentalmadness at gmail.com (Mark Miller)
Date: Wed, 30 Jan 2013 10:25:00 -0800 (PST)
Subject: [rabbitmq-discuss] Why connection.CreateModel in C#?
Message-ID: <913c7398-a6af-40a2-b811-443745b8f0ba@googlegroups.com>

Why does C# use IModel and IConnection.CreateModel() instead of calling it 
a channel like in the other clients? 

I'm a newbie and it doesn't really matter, but I'm really curious about why 
the .NET client would use a different name than the other clients?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130130/b87bd7e4/attachment.htm>

From matthias at rabbitmq.com  Wed Jan 30 19:13:24 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 30 Jan 2013 19:13:24 +0000
Subject: [rabbitmq-discuss] Why connection.CreateModel in C#?
In-Reply-To: <913c7398-a6af-40a2-b811-443745b8f0ba@googlegroups.com>
References: <913c7398-a6af-40a2-b811-443745b8f0ba@googlegroups.com>
Message-ID: <510970D4.5090909@rabbitmq.com>

On 30/01/13 18:25, Mark Miller wrote:
> Why does C# use IModel and IConnection.CreateModel() instead of calling
> it a channel like in the other clients?

The .net client pre-dates many of the other client. The "model" 
terminology stems from an attempt to abstract away from the AMQP 
specific terminology of "channel". Never caught on, but we are stuck 
with it now.

Matthias.

From matthias at rabbitmq.com  Wed Jan 30 19:19:25 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 30 Jan 2013 19:19:25 +0000
Subject: [rabbitmq-discuss] Server-Side Limit for a Channel's
 Unacknowledged Messages
In-Reply-To: <CAHW0W4O1VBdtdjrU0WX_Lwk7fYYZ-7Ek8et6fFQ+D2XrYp2SVQ@mail.gmail.com>
References: <CAHW0W4PZHvZF_OvcoP0Jc_0_ktOJcyLua6fdrT7MivhBm+oNVQ@mail.gmail.com>
	<50F17459.1000007@rabbitmq.com>
	<CAHW0W4P6PC5uky4PbwKB3HQiMG5y0byKZz-LAsP3JHFAkBCPaA@mail.gmail.com>
	<CAHW0W4O1VBdtdjrU0WX_Lwk7fYYZ-7Ek8et6fFQ+D2XrYp2SVQ@mail.gmail.com>
Message-ID: <5109723D.2090003@rabbitmq.com>

Dave,

On 25/01/13 14:28, Dave Seltzer wrote:
> 1) How should a message behave if it's TTL has expired and it's waiting
> for ACK?

It sticks around. Whether that's what it *should* do is a matter for debate.

> 2) Is there really not that much interest setting a per-channel prefetch
> queue limit?

Apparently not, judging by the lack of responses to your question ;)

But we haven't forgotten about this, and I'm sure we will look into it 
eventually.

Matthias.

From jerryk at rbcon.com  Wed Jan 30 19:33:45 2013
From: jerryk at rbcon.com (Jerry Kuch)
Date: Wed, 30 Jan 2013 11:33:45 -0800
Subject: [rabbitmq-discuss] User Permissions
In-Reply-To: <1359457286549-24742.post@n5.nabble.com>
References: <1359228441933-24702.post@n5.nabble.com>
	<CAE0Sz=wyszL5e-QcmReXbYoCr3h=vH_wtWD9ayf9Fh_mJSUcnw@mail.gmail.com>
	<1359457286549-24742.post@n5.nabble.com>
Message-ID: <CAE0Sz=wJ0obSX1TH9piGZvi_nT_ztmDx9pm69eExw_nLAPGWpA@mail.gmail.com>

Hi, Nybras...

You're still a bit turned around...

That's great thank you very much. So if I wanted allow my users to only:
>

Consulting the table at:  http://www.rabbitmq.com/access-control.html

We see...


> queue.bind

queue.unbind
>

Both require you to be able to write the queue and read the exchange.


> basic.get

basic.consume
>

Both requires you to be able to read the queue.


> Would I create a user account (say 'users') and fill in regex parts (im
> creating this in the Management Plugin)
> Write regexp = '^amq\.queue.bind|amq\.queue.unbind$'
> Read regexp = '^amq\.basic.get|amq\.basic.consume$'
>
> Or have I completely misunderstood this?
>

Your regexes are referring to the names of AMQP operations.  The regexes
are supposed to match the names of the entities on which you're granting
those permissions (whether they exist yet or not).

So suppose you wanted a user to be able to bind a queue named "fooqueue" to
an exchange named "barexchange".  Then you need to do a queue.bind you need
to make sure that whatever write permission regex you've given the user
will match "fooqueue" and that whatever read permission you've given the
user will match the name "barexchange."

Naturally this requires a bit of planning of your namespace.


> My app is a publish/subscribe scenario where each user has their very own
> queue with multiple binds to various exchanges (the producers).


Then a user coming in would need the configure permission with regex
including whatever name he plans to queue.declare his queues under, a read
regex that includes the names of those exchanges to which he may want to
bind things, and a write regex that includes the name of the queue he
wishes to bind.


> I'm guessing
> to allow users to only consume from their own queue I would have to create
> a
> user account for each user of the app. Or I could randomly generate queue
> names for each user so that these queue names could not be guessed (which
> would be secure enough)??
>

You certainly could do per user permissioning that only grants appropriate
permissions on resources that match a naming convention of your devising.
 I'd suggest you avoid the "generate obscure queue names" as a security
policy. You might also consider declaring *exclusive* queues which can only
be used by the declaring consumer.  Mixing those with the *auto-delete*
property can be a convenient way to make transient, private queues that
will go away when your consumer departs, which might be nice from a
resource management standpoint if you have a lot of distinct user
identities in the mix.

Best regards,
Jerry
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130130/c3d0cda4/attachment.htm>

From videlalvaro at gmail.com  Wed Jan 30 19:34:26 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 30 Jan 2013 20:34:26 +0100
Subject: [rabbitmq-discuss] RabbitMQ Implementation
In-Reply-To: <71a8c6ed-9522-440b-8073-2d8d796f5cc7@googlegroups.com>
References: <71a8c6ed-9522-440b-8073-2d8d796f5cc7@googlegroups.com>
Message-ID: <CAMcAHLVYQwAqLXxuyH7dKVv=54+hJYSMsdvnsU6UBvuebabNeQ@mail.gmail.com>

I've just replied to your question:
http://stackoverflow.com/a/14612183/342013

Regards,

Alvaro


On Wed, Jan 30, 2013 at 4:53 PM, Phill Pafford <phillpafford at gmail.com>wrote:

> Here is a little about the setup I have currently. (
> http://stackoverflow.com/questions/14594569/rabbitmq-implementation )
>
> - REST API to push ( POST ) data into a queue
> - The Queue has a Consumer that's always running and Produces to en
> Exchange
> - The Exchange routes to several other Queues ( like 20+ )
> - Each of the ( 20+ ) Queues does a specific task ( The Consumers always
> runs as well )
> - Cron job runs to check if all the ( 20+ ) Tasks are completed and
> Produces to yet another Queue
>
> I'm not sure I like the Consumers running all the time as each Consumer
> utilizes around 300MB of Ram ( I think it's MBs, it's not in front of me at
> the moment ) and I'm looking for another implementation.
>
>         M <-- Message coming from REST API
>         |
>         |
>         +-First Queue
>         |
>         |
>         | <-- The Exchange
>        /|\
>       / | \
>      /  |  \ <-- bind to multiple queues ( 20+ )
>     Q1  Q2  Q3 <-- Each Queue is a task that must be completed
>
>
>         | <-- CRON runs to check if all queues above have completed
>         |
>         |
>         Q4 <-- Queues 1,2 and 3 must finish first before Queue 4 can start
>         |
>         C <-- Consumer
>
> I the related question below it was suggested to use RPC but the problem
> with this is the RPC ( to my understanding ) Will have multiple instances.
> This is a resource intense process as is and I think by adding the RPC
> calls it will just bog down the server and then become unresponsive (
> Please correct me if I'm wrong ).
>
> Another approach was to use the Aggregator pattern
>
>  - http://www.eaipatterns.com/Aggregator.html
>
> Which looks exactly what I need but I found the documentation limited. Has
> anyone done this pattern?
>
> My question is I'm not happy with how it's currently implemented and I'm
> looking for ways to improve the process. I'm looking to either get rid of
> the CRON, Implement a new Pattern and Not have the Consumers run all the
> time.
>
> The process currently also only supports a single instance of each
> consumer. It can have multiple consumers but how we have implemented it we
> only wanted one at the time.
>
> This is implemented in PHP, Symfony2 Framework using the RabbitMQBundle
>
> Related Question:
>
>  -
> http://stackoverflow.com/questions/13861459/rabbitmq-wait-for-multiple-queues-to-finish
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130130/34dc7aef/attachment.htm>

From matthias at rabbitmq.com  Wed Jan 30 20:01:50 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 30 Jan 2013 20:01:50 +0000
Subject: [rabbitmq-discuss] User Permissions
In-Reply-To: <CAE0Sz=wJ0obSX1TH9piGZvi_nT_ztmDx9pm69eExw_nLAPGWpA@mail.gmail.com>
References: <1359228441933-24702.post@n5.nabble.com>
	<CAE0Sz=wyszL5e-QcmReXbYoCr3h=vH_wtWD9ayf9Fh_mJSUcnw@mail.gmail.com>
	<1359457286549-24742.post@n5.nabble.com>
	<CAE0Sz=wJ0obSX1TH9piGZvi_nT_ztmDx9pm69eExw_nLAPGWpA@mail.gmail.com>
Message-ID: <51097C2E.4050306@rabbitmq.com>

On 30/01/13 19:33, Jerry Kuch wrote:
> I'd suggest you avoid the "generate obscure queue names"
> as a security policy.

That actually works pretty well as long as the names are 
cryptographically strong, since names of queues, exchanges, etc are not 
discoverable through AMQP or the various other messaging protocol 
RabbitMQ speaks; though they *are* visible in the management API.

Server-generated names (i.e. the ones a client gets back when declaring 
a queue with a blank name) fit that bill. So would client generated 
names that, say, were created by cryptographically hashing a salted 
client identify.

Things can get tricky though when it comes to remembering these names 
(or salts) across restarts of the app, and doing so in a sufficiently 
secure manner.

> You might also consider declaring *exclusive*
> queues which can only be used by the declaring consumer.

More precisely, exclusive queues are only accessible from the connection 
that declared them, and they get deleted when that connection terminates.

> Mixing those
> with the *auto-delete* property can be a convenient way to make
> transient, private queues that will go away when your consumer departs

Actually, "auto-delete" queues are typically shared between consumers on 
multiple connections (which implies that they cannot be exclusive 
queues), with the server deleting the queue when the last such consumer 
disappears.

Matthias.

From developmentalmadness at gmail.com  Wed Jan 30 20:28:12 2013
From: developmentalmadness at gmail.com (Mark Miller)
Date: Wed, 30 Jan 2013 12:28:12 -0800 (PST)
Subject: [rabbitmq-discuss] Why connection.CreateModel in C#?
In-Reply-To: <913c7398-a6af-40a2-b811-443745b8f0ba@googlegroups.com>
References: <913c7398-a6af-40a2-b811-443745b8f0ba@googlegroups.com>
Message-ID: <9e44ddbd-03af-4421-9f2e-59956fabcf20@googlegroups.com>

I got a response from Matthias Radestock. So to share the answer for others 
who might be interested and give credit :

> The .net client pre-dates many of the other client. The "model" 
terminology stems from 
> an attempt to abstract away from the AMQP specific terminology of 
"channel". Never caught on, 
> but we are stuck with it now.

Thanks, Matthias
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130130/69a247c9/attachment.htm>

From behrk2 at gmail.com  Thu Jan 31 01:33:18 2013
From: behrk2 at gmail.com (Kevin Behr)
Date: Wed, 30 Jan 2013 20:33:18 -0500
Subject: [rabbitmq-discuss] Consumer Clients as Tomcat Web Applications and
	Work Queue Configuration
Message-ID: <CAC_yGURXNFrgJ6SM7vb5QjZn2m5GKBXgucUFvuQ4QodNzrz3yA@mail.gmail.com>

Hello everyone,

I have five RabbitMQ consumer clients that are written and deployed as
Tomcat web applications.  My original intention was to consume messages in
the typical fashion:

while (true) {
QueueingConsumer.Delivery delivery = consumer.nextDelivery();
 String message = new String(delivery.getBody());
System.out.println(" [x] Received '" + message + "'");
}

However, I was unable to stop the Tomcat application by using the while
loop (see my post @
http://stackoverflow.com/questions/14164517/trouble-stopping-a-tomcat-server-that-is-running-a-web-application-with-a-while
).

Instead, I now use a Java ScheduledExecutorService which will call a
consumer once every *x *milliseconds.

scheduler = Executors.newSingleThreadScheduledExecutor();
scheduler.scheduleAtFixedRate(new ScheduledConsumer(), 0, 15000,
TimeUnit.MILLISECONDS);

I modified the consumer to only retrieve one individual message,
using Channel.basicGet:

GetResponse response = channel.basicGet(queueName, autoAck);

This workaround has been working for me without any problems.  However, I'm
starting to wonder if I am going about it all wrong.  You see, I now need
to set up a work queue model, so that I can scale my resources and deploy
additional consumers as the need arises.  So I could spin up a new Tomcat
server and deploy my consumer .war files, and voila.  But it was brought to
my attention that by using Channel.basicGet, I am not in fact truly
consuming - messages are not being pushed down.  I am instead "pulling"
messages.

Therefore, I assume that my consumers will not enjoy the luxury of fair,
round robin dispatching.  Consumer client "A" might retrieve more messages
than consumer client "B", solely because of the fixed rate at which it was
set to consume.

My questions are as follows:

   1. Is it a bad idea to deploy consumers as Tomcat web applications?  Are
   there any advantages or disadvantages as compared to the alternative of
   running system level Java clients?

   2. In the case of work queues, am I better off retrieving messages that
   are pushed down to my clients, and setting a prefetchCount
   (channel.basicQos(1)) to ensure that I only receive one message at a time?


I would appreciate any advice or suggestions.

Thanks!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130130/f5b4c38c/attachment.htm>

From streamweaver at gmail.com  Thu Jan 31 02:15:05 2013
From: streamweaver at gmail.com (Scott Turnbull)
Date: Wed, 30 Jan 2013 18:15:05 -0800 (PST)
Subject: [rabbitmq-discuss] Federation Management error
Message-ID: <ce8533f0-44ba-4e23-b88b-4714542bf342@googlegroups.com>

I'm a new RabbitMQ admin and having some difficulty setting our server up.

I'm running EC2 Ubuntu with RabbitMQ 3.0.0.1 and did a base install of 
RabbitMQ itself, The Web UI management interface and the Federation 
Management plugin.

When in the admin UI as the default guest user I click on any of the 
Federation links in the sidebar under Admin and in each case get

"The object you clicked on was not found; it may have been deleted on the 
server."

I've enabled HTTP request logging in the management plugin but don't see an 
error.  I'm pasting the two logged events form the latest request for 
reference. 

I'm somewhat stuck and wondered if anyone has run into this before.

---------- logfile output ------------
76.122.71.107 - - [31/Jan/2013:02:04:37 +0000] "GET /api/federation-links 
HTTP/1.1" 200 2 "http://aptrust.duracloud.org:15672/" "Mozilla/5.0 
(Macintosh; Intel Mac OS X 10_8_2) AppleWebKit/537.17 (KHTML, like Gecko) 
Chrome/24.0.1312.57 Safari/537.17"
76.122.71.107 - - [31/Jan/2013:02:04:37 +0000] "GET /api/vhosts HTTP/1.1" 
200 30 "http://aptrust.duracloud.org:15672/" "Mozilla/5.0 (Macintosh; Intel 
Mac OS X 10_8_2) AppleWebKit/537.17 (KHTML, like Gecko) Chrome/24.0.1312.57 
Safari/537.17"
76.122.71.107 - - [31/Jan/2013:02:04:37 +0000] "GET 
/api/parameters/federation-upstream HTTP/1.1" 404 193 
"http://aptrust.duracloud.org:15672/" "Mozilla/5.0 (Macintosh; Intel Mac OS 
X 1
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130130/cb572212/attachment.htm>

From streamweaver at gmail.com  Thu Jan 31 02:31:50 2013
From: streamweaver at gmail.com (Scott Turnbull)
Date: Wed, 30 Jan 2013 18:31:50 -0800 (PST)
Subject: [rabbitmq-discuss] Federation Management error
In-Reply-To: <ce8533f0-44ba-4e23-b88b-4714542bf342@googlegroups.com>
References: <ce8533f0-44ba-4e23-b88b-4714542bf342@googlegroups.com>
Message-ID: <8aebc45b-e67a-49fa-a74f-02a34765b7d5@googlegroups.com>

Sorry I meant RabbitMQ version 3.0.1 and erlang version R14B04

On Wednesday, January 30, 2013 9:15:05 PM UTC-5, Scott Turnbull wrote:
>
> I'm a new RabbitMQ admin and having some difficulty setting our server up.
>
> I'm running EC2 Ubuntu with RabbitMQ 3.0.0.1 and did a base install of 
> RabbitMQ itself, The Web UI management interface and the Federation 
> Management plugin.
>
> When in the admin UI as the default guest user I click on any of the 
> Federation links in the sidebar under Admin and in each case get
>
> "The object you clicked on was not found; it may have been deleted on the 
> server."
>
> I've enabled HTTP request logging in the management plugin but don't see 
> an error.  I'm pasting the two logged events form the latest request for 
> reference. 
>
> I'm somewhat stuck and wondered if anyone has run into this before.
>
> ---------- logfile output ------------
> 76.122.71.107 - - [31/Jan/2013:02:04:37 +0000] "GET /api/federation-links 
> HTTP/1.1" 200 2 "http://aptrust.duracloud.org:15672/" "Mozilla/5.0 
> (Macintosh; Intel Mac OS X 10_8_2) AppleWebKit/537.17 (KHTML, like Gecko) 
> Chrome/24.0.1312.57 Safari/537.17"
> 76.122.71.107 - - [31/Jan/2013:02:04:37 +0000] "GET /api/vhosts HTTP/1.1" 
> 200 30 "http://aptrust.duracloud.org:15672/" "Mozilla/5.0 (Macintosh; 
> Intel Mac OS X 10_8_2) AppleWebKit/537.17 (KHTML, like Gecko) 
> Chrome/24.0.1312.57 Safari/537.17"
> 76.122.71.107 - - [31/Jan/2013:02:04:37 +0000] "GET 
> /api/parameters/federation-upstream HTTP/1.1" 404 193 "
> http://aptrust.duracloud.org:15672/" "Mozilla/5.0 (Macintosh; Intel Mac 
> OS X 1
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130130/50a12f5b/attachment.htm>

From matthias at rabbitmq.com  Thu Jan 31 04:01:45 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 31 Jan 2013 04:01:45 +0000
Subject: [rabbitmq-discuss] Federation Management error
In-Reply-To: <ce8533f0-44ba-4e23-b88b-4714542bf342@googlegroups.com>
References: <ce8533f0-44ba-4e23-b88b-4714542bf342@googlegroups.com>
Message-ID: <5109ECA9.5010800@rabbitmq.com>

Scott,

On 31/01/13 02:15, Scott Turnbull wrote:
> I'm running EC2 Ubuntu with RabbitMQ 3.0.0.1 and did a base install of
> RabbitMQ itself, The Web UI management interface and the Federation
> Management plugin.
>
> When in the admin UI as the default guest user I click on any of the
> Federation links in the sidebar under Admin and in each case get

You need to enable the rabbitmq_federation plug-in as well.

Regards,

Matthias.

From deepdesai.nitt at gmail.com  Thu Jan 31 05:22:37 2013
From: deepdesai.nitt at gmail.com (deep desai)
Date: Thu, 31 Jan 2013 10:52:37 +0530
Subject: [rabbitmq-discuss] Rabbitmq start,restart,status,stop hangs
Message-ID: <CAJHL58YrdrSu-Q5Gon1wwr6c2JCRqx_1SSKuig_4v_vB5yxrBQ@mail.gmail.com>

hi,

I am having rabbitmq version 3.0 and 2.8.6 installed in different setups,
one on centos 5 and another on Amazon Linux 2012.09. Many a times the
rabbitmq restart,stop,status,start do not respond. I face this issue with
both the setups. I have Erlang version : R14B-04.1.el5 installed. I have to
then kill all the processes and start rabbitmq again and sometimes even
that hangs.

Can someone tell me what can be the issues regarding this?

Thanks

--
deep
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130131/e5ea6033/attachment.htm>

From toby.corkindale at strategicdata.com.au  Thu Jan 31 06:01:10 2013
From: toby.corkindale at strategicdata.com.au (Toby Corkindale)
Date: Thu, 31 Jan 2013 17:01:10 +1100
Subject: [rabbitmq-discuss] 3.0.1 STOMP bug - reply-to header
In-Reply-To: <5107955F.7060306@rabbitmq.com>
References: <50D3B048.6020803@strategicdata.com.au>
	<50D4820F.4020700@rabbitmq.com>
	<5107574B.90305@strategicdata.com.au>
	<5107955F.7060306@rabbitmq.com>
Message-ID: <510A08A6.7070204@strategicdata.com.au>

On 29/01/13 20:24, Matthias Radestock wrote:
> Toby,
>
> On 29/01/13 04:59, Toby Corkindale wrote:
>> On 22/12/12 02:36, Matthias Radestock wrote:
>>> On 21/12/12 00:41, Toby Corkindale wrote:
>>>> When testing against RabbitMQ 3.0.1, we're seeing what looks like a bug
>>>> and regression compared to the last 2.9 version.
>>>>
>>>> The stomp adapter is turning a reply-to header for a topic queue into a
>>>> temp queue.
>>>> Eg, the reply queue name is getting munged from
>>>>    /topic/foo.export.pid    to  /reply-queue//topic/foo.export.pid
>>>
>>> This looks like an accidental side effect of the change we made to allow
>>> AMQP clients to handle reply-to headers created by stomp clients. Thanks
>>> for reporting this. I have filed a bug.
>>
>> I wondered how this bug was going?
>> I [...] wondered if it'd been fixed and I'd just missed the release
>> announcement?
>
> It's been fixed but not released yet - 3.0.1, the version you were
> testing, is (still) the most recent rabbit release.
>
> If you don't want to wait until the next release you can try a nightly
> build - http://www.rabbitmq.com/nightly-builds.html

Thanks Matthias.
I've tested our app against the nightly build 3.0.1.40127-1, and it now 
passes our tests that were failing before.

cheers,
Toby


From antouboduor at gmail.com  Thu Jan 31 06:25:05 2013
From: antouboduor at gmail.com (Anthony Oduor)
Date: Thu, 31 Jan 2013 09:25:05 +0300
Subject: [rabbitmq-discuss] Cannot access rabbitmqadmin.
In-Reply-To: <5108D422.9040009@rabbitmq.com>
References: <5753af5f-6c71-42db-91db-58279c63d685@googlegroups.com>
	<0790b109-e918-4261-924e-129cd7978e99@googlegroups.com>
	<5101367C.6000005@rabbitmq.com>
	<CAEey+bJXVYP_q-yaiKZa3CMX0Ph1CK0jMWyyt+eU=KwqspFsUg@mail.gmail.com>
	<5107A503.3090505@rabbitmq.com>
	<CAEey+bJRcBf_h6B4QE1CzbBOqix+UPtzBgePp3bqy2wRXuGUKg@mail.gmail.com>
	<5107F62A.2050207@rabbitmq.com>
	<CAEey+b+u0rfE5vY5-avwt_UEaAkWYC=64oABiFDUqib2ZAw17w@mail.gmail.com>
	<CAEey+bLzgBKpUBQoHqR=kQ_nPRpLxjTXnM8r9HgH3PsAkcwDvg@mail.gmail.com>
	<5108D422.9040009@rabbitmq.com>
Message-ID: <CAEey+bKLXEKvoHo5m-f8nTyxY6m03Y6rAq0EOW0vTn-e3y0rGw@mail.gmail.com>

Yes. I can enable a plugin without reboot, like the one below worked fine.
The rabbitmqadmin not loading was quite unusual, it had never happened
before and we have been using it for close to a year now.

Thanks Matthias.

On Wed, Jan 30, 2013 at 11:04 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Anthony,
>
>
> On 30/01/13 06:42, Anthony Oduor wrote:
>
>> Yes. That's the command I am using to start RabbitMQ. The problem
>> seems to have disappeared after restarting the machine
>>
>
> It certainly shouldn't be necessary to reboot the machine to enable
> plugins.
>
>
>  I will add the echo for future debug  purposes in-case it happens
>> again.
>>
>
> Can you enable plugins now w/o rebooting?
>
> E.g. what happens if, say, you enable the stomp plugin with
>
> $ cd rabbitmq_server-2.8.4/sbin/
> $ ./rabbitmq-plugins enable rabbitmq_stomp
> $ ./rabbitmqctl stop
> $ ./rabbitmq-server
>
> ?
>
> Regards,
>
> Matthias.
>



-- 

http://about.me/outhorand/bio
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130131/97e5e560/attachment.htm>

From oldhomelh at gmail.com  Thu Jan 31 07:08:20 2013
From: oldhomelh at gmail.com (andy lin)
Date: Wed, 30 Jan 2013 23:08:20 -0800 (PST)
Subject: [rabbitmq-discuss] what's the  meaning of deliver and get ?
Message-ID: <1359616100831-24797.post@n5.nabble.com>

<http://rabbitmq.1065348.n5.nabble.com/file/n24797/2.jpg> 
 In the picture , I find there are two value in the column of deliver/get,so
I doubt that why it has two values and what  the meaning of them ,also you
can see that the rate of deliver is 626 but the ack  is only 1.4/s
so Could you tell me the reason and the difference between deliver and get?

<http://rabbitmq.1065348.n5.nabble.com/file/n24797/11.jpg>     

In the picture ,there is only one value and the rate of deliver equals the
ack.why?



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/what-s-the-meaning-of-deliver-and-get-tp24797.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From fenghe at nsbeta.info  Thu Jan 31 07:30:50 2013
From: fenghe at nsbeta.info (Feng He)
Date: Thu, 31 Jan 2013 15:30:50 +0800
Subject: [rabbitmq-discuss] what's the  meaning of deliver and get ?
In-Reply-To: <1359616100831-24797.post@n5.nabble.com>
References: <1359616100831-24797.post@n5.nabble.com>
Message-ID: <510A1DAA.9090801@nsbeta.info>

? 2013-1-31 15:08, andy lin ??:
> In the picture ,there is only one value and the rate of deliver equals the
> ack.why?


 From what I see, deliver is "put" by broker, get is just "get" from client.

BTW, I just created a rabbitmq chinese discussion group in google, 
welcome to join. Thanks.

-- 
RabbitMQ?????
https://groups.google.com/group/rabbitmq-china

From michael.s.klishin at gmail.com  Thu Jan 31 08:43:25 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 31 Jan 2013 12:43:25 +0400
Subject: [rabbitmq-discuss] what's the meaning of deliver and get ?
In-Reply-To: <1359616100831-24797.post@n5.nabble.com>
References: <1359616100831-24797.post@n5.nabble.com>
Message-ID: <CAE3HoVSFbi7x_re3ve1XQx9yM9skpC01xbKXiRtsuggvF+bD5w@mail.gmail.com>

2013/1/31 andy lin <oldhomelh at gmail.com>

> Could you tell me the reason and the difference between deliver and get?
>
> <http://rabbitmq.1065348.n5.nabble.com/file/n24797/11.jpg>
>

basic.deliver is an AMQP 0.9.1 method RabbitMQ uses to "push" messages to
clients.
Messages then may be acknowledged automatically (immediately) or manually
(when the client sees fit).

basic.get is another operation when a client fetches a message
synchronously,
very similar to HTTP GET. Again, messages may be ack-ed manually in this
case
but it is relatively rare to do so, I believe, so in most cases you will
see automatic acknowledgements
used with basic.get.


>
> In the picture ,there is only one value and the rate of deliver equals the
> ack.why?
>

My guess would be because of the different acknowledgement modes used.

Please take a look at
http://www.rabbitmq.com/tutorials/amqp-concepts.htmlwhich explains
what I've said above in more detail.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130131/64e838b4/attachment.htm>

From streamweaver at gmail.com  Thu Jan 31 08:57:51 2013
From: streamweaver at gmail.com (Scott Turnbull)
Date: Thu, 31 Jan 2013 00:57:51 -0800 (PST)
Subject: [rabbitmq-discuss] Federation Management error
In-Reply-To: <8aebc45b-e67a-49fa-a74f-02a34765b7d5@googlegroups.com>
References: <ce8533f0-44ba-4e23-b88b-4714542bf342@googlegroups.com>
	<8aebc45b-e67a-49fa-a74f-02a34765b7d5@googlegroups.com>
Message-ID: <333e440a-6c9e-424d-947e-44178edc290e@googlegroups.com>

Also I didn't mention it but the rabbitmq_federation plugin is enable, not 
just the management portion.



On Wednesday, January 30, 2013 9:31:50 PM UTC-5, Scott Turnbull wrote:
>
> Sorry I meant RabbitMQ version 3.0.1 and erlang version R14B04
>
> On Wednesday, January 30, 2013 9:15:05 PM UTC-5, Scott Turnbull wrote:
>>
>> I'm a new RabbitMQ admin and having some difficulty setting our server up.
>>
>> I'm running EC2 Ubuntu with RabbitMQ 3.0.0.1 and did a base install of 
>> RabbitMQ itself, The Web UI management interface and the Federation 
>> Management plugin.
>>
>> When in the admin UI as the default guest user I click on any of the 
>> Federation links in the sidebar under Admin and in each case get
>>
>> "The object you clicked on was not found; it may have been deleted on 
>> the server."
>>
>> I've enabled HTTP request logging in the management plugin but don't see 
>> an error.  I'm pasting the two logged events form the latest request for 
>> reference. 
>>
>> I'm somewhat stuck and wondered if anyone has run into this before.
>>
>> ---------- logfile output ------------
>> 76.122.71.107 - - [31/Jan/2013:02:04:37 +0000] "GET /api/federation-links 
>> HTTP/1.1" 200 2 "http://aptrust.duracloud.org:15672/" "Mozilla/5.0 
>> (Macintosh; Intel Mac OS X 10_8_2) AppleWebKit/537.17 (KHTML, like Gecko) 
>> Chrome/24.0.1312.57 Safari/537.17"
>> 76.122.71.107 - - [31/Jan/2013:02:04:37 +0000] "GET /api/vhosts HTTP/1.1" 
>> 200 30 "http://aptrust.duracloud.org:15672/" "Mozilla/5.0 (Macintosh; 
>> Intel Mac OS X 10_8_2) AppleWebKit/537.17 (KHTML, like Gecko) 
>> Chrome/24.0.1312.57 Safari/537.17"
>> 76.122.71.107 - - [31/Jan/2013:02:04:37 +0000] "GET 
>> /api/parameters/federation-upstream HTTP/1.1" 404 193 "
>> http://aptrust.duracloud.org:15672/" "Mozilla/5.0 (Macintosh; Intel Mac 
>> OS X 1
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130131/591c0b32/attachment.htm>

From matthias at rabbitmq.com  Thu Jan 31 09:21:39 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 31 Jan 2013 09:21:39 +0000
Subject: [rabbitmq-discuss] Federation Management error
In-Reply-To: <333e440a-6c9e-424d-947e-44178edc290e@googlegroups.com>
References: <ce8533f0-44ba-4e23-b88b-4714542bf342@googlegroups.com>
	<8aebc45b-e67a-49fa-a74f-02a34765b7d5@googlegroups.com>
	<333e440a-6c9e-424d-947e-44178edc290e@googlegroups.com>
Message-ID: <510A37A3.6000109@rabbitmq.com>

Scott,

On 31/01/13 08:57, Scott Turnbull wrote:
> Also I didn't mention it but the rabbitmq_federation plugin is enable,
> not just the management portion.

Is the rabbitmq_federation plug-in shown when you run 'rabbitmqctl 
status'? (Or, equivalently, on the management UI Overview page click on 
the node and check the list of Applications).

Matthias.

From tacahiroy at yahoo.co.uk  Thu Jan 31 04:07:05 2013
From: tacahiroy at yahoo.co.uk (tacahiroy)
Date: Wed, 30 Jan 2013 20:07:05 -0800 (PST)
Subject: [rabbitmq-discuss] object not found in RabbitMQ admin panel
In-Reply-To: <7df75fda-2977-4a72-9823-b6248a90bb0f@googlegroups.com>
References: <15862270.2641.1320190071390.JavaMail.geo-discussion-forums@yqnv12>
	<4EB112F4.7080403@rabbitmq.com> <4EB125F1.8070401@rabbitmq.com>
	<7df75fda-2977-4a72-9823-b6248a90bb0f@googlegroups.com>
Message-ID: <1359605225892-24793.post@n5.nabble.com>

hmm - it didn't work for me.

    location / {
        proxy_pass              http://localhost:15672;
        proxy_set_header    Host $http_host;
        rewrite ^/(.*)$ /$1 break;
    }

Is this anything wrong?

Thanks,
Takahiro



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/object-not-found-in-RabbitMQ-admin-panel-tp8978p24793.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From qdog86 at gmail.com  Thu Jan 31 08:27:50 2013
From: qdog86 at gmail.com (Konstantin)
Date: Thu, 31 Jan 2013 00:27:50 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ behind a balancer and Flow Control
Message-ID: <1359620870300-24799.post@n5.nabble.com>

Hi,

considering a setup with more than 10 rabbitmq servers behind a balancer.
Does the flow control feature still makes sense here?

My problem is, that producers are blocked even there is another server with
a lot of free ram which he can use. Is there a way to check from outside if
rabbitmq will block new requests so the balancer will notice that this one
server is not available at the moment? Or can I configure this directly on
the rabbitmq server so that the tcp port is closed if the server is "full"?

Thanks,
Konstantin



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-behind-a-balancer-and-Flow-Control-tp24799.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From tim at rabbitmq.com  Thu Jan 31 10:06:28 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 31 Jan 2013 10:06:28 +0000
Subject: [rabbitmq-discuss] Rabbitmq start,restart,status,stop hangs
In-Reply-To: <CAJHL58YrdrSu-Q5Gon1wwr6c2JCRqx_1SSKuig_4v_vB5yxrBQ@mail.gmail.com>
References: <CAJHL58YrdrSu-Q5Gon1wwr6c2JCRqx_1SSKuig_4v_vB5yxrBQ@mail.gmail.com>
Message-ID: <510A4224.6030007@rabbitmq.com>

Hi Deep

On 01/31/2013 05:22 AM, deep desai wrote:
> hi,
>
> I am having rabbitmq version 3.0 and 2.8.6 installed in different 
> setups, one on centos 5 and another on Amazon Linux 2012.09. Many a 
> times the rabbitmq restart,stop,status,start do not respond. I face 
> this issue with both the setups. I have Erlang version : R14B-04.1.el5 
> installed. I have to then kill all the processes and start rabbitmq 
> again and sometimes even that hangs.
>
> Can someone tell me what can be the issues regarding this?
>

If you post the logs and provide an exact sequence on commands that 
you're running. then we can try to help.

Cheers,
Tim

From simon at rabbitmq.com  Thu Jan 31 10:19:08 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 31 Jan 2013 10:19:08 +0000
Subject: [rabbitmq-discuss] what's the  meaning of deliver and get ?
In-Reply-To: <1359616100831-24797.post@n5.nabble.com>
References: <1359616100831-24797.post@n5.nabble.com>
Message-ID: <510A451C.2090506@rabbitmq.com>

On 31/01/13 07:08, andy lin wrote:
> <http://rabbitmq.1065348.n5.nabble.com/file/n24797/2.jpg>
>   In the picture , I find there are two value in the column of deliver/get,so
> I doubt that why it has two values and what  the meaning of them ,also you

For the record, your picture was very small and I couldn't read the 
text. But I know what that screen is supposed to look like.

However, to add to what people have already said:

* "deliver" refers to messages delivered as a result of basic.consume. * 
"get" refers to messages that arrived in response to basic.get.
* "deliver / get" is the sum of both.
* "ack" just shows the ack rate, if messages are delivered with autoack 
then this rate can be lower or zero.

However, the thing that everyone else missed :-) is that under 
"deliver/get" there is the text "(of which redelivered)". That's what 
the second figure in the cell is - it's showing the number of messages 
sent via deliver / get which have the redelivered flag set.

Messages with "redelivered" set may have already been delivered to a 
consumer once. Messages will be redelivered if the consumer dies or 
invokes basic.recover before acknowledging them, or if the consumer 
rejects / nacks them. (Or after HA failover, but I doubt that is what is 
happening.)

High rates of redelivery usually indicate unhealthy consumers - you 
should definitely investigate why so many messages are being redelivered!

> can see that the rate of deliver is 626 but the ack  is only 1.4/s
> so Could you tell me the reason and the difference between deliver and get?
>
> <http://rabbitmq.1065348.n5.nabble.com/file/n24797/11.jpg>
>
> In the picture ,there is only one value and the rate of deliver equals the
> ack.why?

Nothing is being redelivered in that case. If no messages are being 
redelivered the management web UI just hides everything to do with 
redelivery.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Jan 31 10:50:56 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 31 Jan 2013 10:50:56 +0000
Subject: [rabbitmq-discuss] RabbitMQ behind a balancer and Flow Control
In-Reply-To: <1359620870300-24799.post@n5.nabble.com>
References: <1359620870300-24799.post@n5.nabble.com>
Message-ID: <510A4C90.6090703@rabbitmq.com>

On 31/01/13 08:27, Konstantin wrote:
> considering a setup with more than 10 rabbitmq servers behind a balancer.
> Does the flow control feature still makes sense here?

Yes - flow control is there to protect individual servers from 
whatever's upstream of them, even if that's a load balancer.

> My problem is, that producers are blocked even there is another server with
> a lot of free ram which he can use. Is there a way to check from outside if
> rabbitmq will block new requests so the balancer will notice that this one
> server is not available at the moment?

Yes, you can check with rabbitmqctl or management. With rabbitmqctl, 
invoke "rabbitmqctl status" then compare the value for {memory, [{total, 
...}]} against vm_memory_limit, and disk_free against disk_free_limit. 
With management, request something like

$ curl -i -u guest:guest \
  http://localhost:15672/api/nodes?columns=name,mem_alarm,disk_free_alarm

to get the alarm statuses directly.

you can check per-connection flow control as well via ctl or mgmt, but 
you wouldn't really want to - just because one connection is rate 
limited doesn't mean others will be.

> Or can I configure this directly on
> the rabbitmq server so that the tcp port is closed if the server is "full"?

No, you can't.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Thu Jan 31 12:03:14 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 31 Jan 2013 12:03:14 +0000
Subject: [rabbitmq-discuss] Erlang R15B03
In-Reply-To: <847733117.15745.1359570360191.JavaMail.root@0b10.mx>
References: <847733117.15745.1359570360191.JavaMail.root@0b10.mx>
Message-ID: <510A5D82.20505@rabbitmq.com>

Hi,

On 30/01/13 18:26, Kyle O'Donnell wrote:
> Is anyone aware of performance degradation of rabbitmq (tested 2.8.7
> 3.0.1) when compiled with R15B03? 

No, but if you compiled R15B03 yourself then it may be worth checking
which C compiler optimisation flags were in use. Make sure it is not one
of the C compiler versions to avoid listed in
 http://www.erlang.org/doc/installation_guide/INSTALL.html



-Emile









From simon at rabbitmq.com  Thu Jan 31 13:33:14 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 31 Jan 2013 13:33:14 +0000
Subject: [rabbitmq-discuss] RabbitMQ 3.0.2 released
Message-ID: <510A729A.8030400@rabbitmq.com>

The RabbitMQ team is pleased to announce the release of RabbitMQ 3.0.2.

This release fixes a number of bugs in 3.0.1 and earlier versions.

See the release notes at:

http://www.rabbitmq.com/release-notes/README-3.0.2.txt

for more information.

The new release can be downloaded from:

http://www.rabbitmq.com/download.html

As always, we welcome any questions, bug reports, and other feedback on
this release, as well as general suggestions for features and
enhancements in future releases. Mail us via the RabbitMQ discussion
list.

Regards,
                      The RabbitMQ Team
                      (http://www.rabbitmq.com)

From pc88mxer at gmail.com  Thu Jan 31 17:09:54 2013
From: pc88mxer at gmail.com (E R)
Date: Thu, 31 Jan 2013 11:09:54 -0600
Subject: [rabbitmq-discuss] using rabbitmq to rendevous unrelated processes
Message-ID: <CA+QY9tu5+0kWdppXtrZ+N+82Rm9GGNLfb6dpKN7MA-XCejpKXg@mail.gmail.com>

I'm wondering if I can use rabbitmq to solve this problem...

A web client makes a web request which initiates a background server job to
perform some work. The client wants to get the result of the server job,
but the initial connection might timeout or get broken in which case the
web client will re-connect to wait for the result. I want the server job to
be able to put the result of the job some place where it can be picked up
by the web client at its convenience, and I don't want the web client to
have to busy wait for the result.

Note that is it possible that the web client never picks up the result as
well as the job never creating a result, so I need a way to release any
created resources after a certain time limit (ie. the client knows that if
it doesn't get a result after X minutes it should make a fresh request.)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130131/cd3433c1/attachment.htm>

From michael.dyer at digitaleragroup.com  Thu Jan 31 19:43:36 2013
From: michael.dyer at digitaleragroup.com (austinnichols)
Date: Thu, 31 Jan 2013 11:43:36 -0800 (PST)
Subject: [rabbitmq-discuss] Filter Exchange?
Message-ID: <e1675525-99b0-4c65-9f10-52134f086163@googlegroups.com>

I have a couple of cases where I could use a 'Filter' Exchange.  

Given an exchange 'E1" that is receiving messages which routing keys "A", 
"B", "C" the requirement is to create a binding to exchange to "E2" that 
passes all routing keys EXCEPT "B".  If additional routing keys are added 
at a later date the binding should pass anything EXCEPT "B".

I can currently accomplish this by creating bindings for A and C between 
the two exchanges.  However, if an additional routing key "D" is introduced 
I then need to go back and add an additional binding between the exchanges.

In an ideal setup, the exchange would allow me to specify a default routing 
key 'allow' or 'deny' and then list out the exceptions:

- default=allow
- key1="B" (deny)
Results: Exchange would pass anything except "B"

- default=deny
- key1="A" (allow)
- key2="C" (allow)
Results: Exchange only passes "A" and "C"

Any thoughts on an approach using existing exchange types?

Thanks All!




-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130131/e0cf0b41/attachment.htm>

From matthias at rabbitmq.com  Thu Jan 31 22:21:05 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 31 Jan 2013 22:21:05 +0000
Subject: [rabbitmq-discuss] Filter Exchange?
In-Reply-To: <e1675525-99b0-4c65-9f10-52134f086163@googlegroups.com>
References: <e1675525-99b0-4c65-9f10-52134f086163@googlegroups.com>
Message-ID: <510AEE51.4030308@rabbitmq.com>

On 31/01/13 19:43, austinnichols wrote:
> I have a couple of cases where I could use a 'Filter' Exchange.
>
> Given an exchange 'E1" that is receiving messages which routing keys
> "A", "B", "C" the requirement is to create a binding to exchange to "E2"
> that passes all routing keys EXCEPT "B".  [...]
> Any thoughts on an approach using existing exchange types?

Take a look at Alternate Exchanges - http://www.rabbitmq.com/ae.html

Matthias.


