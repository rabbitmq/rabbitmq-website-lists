From aquino.gustavo at gmail.com  Wed Dec  1 01:53:25 2010
From: aquino.gustavo at gmail.com (Gustavo Aquino)
Date: Tue, 30 Nov 2010 23:53:25 -0200
Subject: [rabbitmq-discuss] RabbitMQ clustering
In-Reply-To: <AANLkTi=fGmo734s0Ct4zNO55wWCbuxYS-q_TEamyLu8K@mail.gmail.com>
References: <AANLkTimD+NBrtY9WCA+HwCkm6H2obMn8wKgeUGyBGida@mail.gmail.com>
	<AANLkTi=STEeUigLbDiowk=GKpoxdt_9w56uA6NP4fRz9@mail.gmail.com>
	<AANLkTi=fGmo734s0Ct4zNO55wWCbuxYS-q_TEamyLu8K@mail.gmail.com>
Message-ID: <AANLkTinCQ83KEVaVHSsoQPDOAwnE8va1ZqBtTs_53XTR@mail.gmail.com>

Hi Kshitiz,

Unfortunately until now in my projects using Rabbit we don't found a way to
use Rabbit in HA/HP mode, just HA active/passive and I think that you are
trying to found one HA/HP that represents all nodes active.

Just to understand you are talking about millions of messages, do you really
need 4 nodes to process it?, We process 1kk messages per second with a
single node, messages with ~260bytes.

Talk about your case to us.

Regards.



On Mon, Nov 29, 2010 at 5:18 AM, Kshitiz Garg <stephanion2002 at gmail.com>wrote:

> Hi Gustavo,
>
> Sorry for replying late,
>
> We don't have any figure yet, but on our pub-sub system, millions of of
> publishers will be publishing messages.
>
> Our system is as follows:
>
> 1. A publisher publishes message on our rest APIs.
> 2. From there, we first store those messages in DB.
> 3. After storing, we publish the message on RabbitMQ setup using a load
> balancer.
> 4. Behind the load balancer, we have a cluster of 4 rabbitMQ nodes.
> 5. At the consuming end,  we have perl and java consumers fetching
> messages.
> 7. These internal consumers send messages to the subscribers as per the
> subscription protocol.
>
> Now, if we add 4 RabbitMQ nodes in a cluster, all the credentials,
> exchanges and bindings get copied to each mnesia db. However, since the
> queues are specific to nodes, the message directed to a particular queue
> will be lost (if the node on which that queue was created is down). This
> seems to be a weak link for a scalable and High availability solution we
> need. Will the message be persisted somewhere and delivered to that queue
> after that particular node comes up?
>
> If the message is gonna lost, can we have a workaround that we create
> copies of the queues explicitly on each node. Now since they are copies, the
> exchange will send the message to all the nodes and even if a node is down,
> message will be delivered to all the copies of that queue.
>
> We know that Clustering!=HA, but we do need Clustering with HA. Here since
> even after clustering of 4 rabbitMQ nodes, the active-passive setup for each
> of these 4 nodes becomes the bottleneck because of the complexity of the
> non-replication of "queues". Is there any workaround or any other setup u
> can suggest ?
>
> Regards,
> Kshitiz Garg
>
>
> On Sun, Nov 28, 2010 at 10:01 PM, Gustavo Aquino <aquino.gustavo at gmail.com
> > wrote:
>
>> Hi Garg,
>>
>> Could you give to us more details about what you need? eg.  it's messages
>> throughput is per second? and etc.
>>
>> Regards.
>>
>>
>>
>>
>> On Wed, Nov 24, 2010 at 10:35 AM, Kshitiz Garg <stephanion2002 at gmail.com>wrote:
>>
>>> Hi,
>>>
>>> Can someone present a pictorial representation of 4-5 Rabbit MQ nodes
>>> with Clustering and HA (it can also go on the RabbitMQ site). I wanted to
>>> know about a RabbitMQ setup which is able to handle millions of messages.
>>>
>>> I hope there would be many more users with such a requirement.
>>>
>>> Thanks
>>> Kshitiz Garg
>>>
>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101130/bc87ccef/attachment.htm>

From adamka at dgt.com.pl  Wed Dec  1 09:03:04 2010
From: adamka at dgt.com.pl (Adam Kaminiecki)
Date: Wed, 01 Dec 2010 10:03:04 +0100
Subject: [rabbitmq-discuss] Clustering Serwer Question
Message-ID: <4CF60F48.4070502@dgt.com.pl>

Hi,

My question is how can i change a cluster type from ram to disk? I have 
2 serwers and 1 node in each of them. Need I have 3 servers to do it 
like in tutorial http://www.rabbitmq.com/clustering.html#creating?


Another question is:
If I have persistent queue declared od serwer 1 when serwer 1 is down in 
second serwer this queue dissappear. When I will change cluster typ this 
behavior will change? Is it possible change it behavior about persistent 
queue when serwers are in cluster?



Regards,
Adam

-- 
This message has been scanned for viruses and
dangerous content by MailScanner, and is
believed to be clean.


From alexandru at rabbitmq.com  Wed Dec  1 10:16:25 2010
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Wed, 1 Dec 2010 10:16:25 +0000
Subject: [rabbitmq-discuss] Clustering Serwer Question
In-Reply-To: <4CF60F48.4070502@dgt.com.pl>
References: <4CF60F48.4070502@dgt.com.pl>
Message-ID: <20101201101625.GA9947@dakota.eng.vmware.com>

Hi,

> My question is how can i change a cluster type from ram to disk? I have 
> 2 serwers and 1 node in each of them. Need I have 3 servers to do it 
> like in tutorial http://www.rabbitmq.com/clustering.html#creating?

The nodes are either ram or disc.  When you issue the cluster command,
the nodes passed as arguments are the disc nodes.  From the clustering
guide,

rabbit2$ rabbitmqctl cluster rabbit at rabbit1
Clustering node rabbit at rabbit2 with [rabbit at rabbit1] ...done.

rabbit1$ rabbitmqctl status
Status of node rabbit at rabbit1 ...
[...,
  {nodes,[{disc,[rabbit at rabbit1]},{ram,[rabbit at rabbit2]}]},
  {running_nodes,[rabbit at rabbit2,rabbit at rabbit1]}]
...done.

rabbit2$ rabbitmqctl status
Status of node rabbit at rabbit2 ...
[...,
  {nodes,[{disc,[rabbit at rabbit1]},{ram,[rabbit at rabbit2]}]},
  {running_nodes,[rabbit at rabbit1,rabbit at rabbit2]}]
...done.

In the above example, we create a cluster of two nodes, rabbit1 is disc
(because it's in the arguments to the cluster command), and rabbit2 is
ram.

Two nodes is enough for a cluster.

> If I have persistent queue declared od serwer 1 when serwer 1 is down in 
> second serwer this queue dissappear. When I will change cluster typ this 
> behavior will change? Is it possible change it behavior about persistent 
> queue when serwers are in cluster?

No.

A queue can only exist on one node at a time.  If said node dies, the
queue disappears or becomes unusable: durable queues become unusable
until the node comes back online (they cannot be redeclared on another
node), non-durable queues just disappear (but can be redeclared on
another node).

If you need to not lose messages and have the queue available even after
a node death, you might want to have a look at the HA with Rabbit guide:
  http://www.rabbitmq.com/pacemaker.html

Cheers,
Alex

On Wed, Dec 01, 2010 at 10:03:04AM +0100, Adam Kaminiecki wrote:
> Hi,
> 
> My question is how can i change a cluster type from ram to disk? I have 
> 2 serwers and 1 node in each of them. Need I have 3 servers to do it 
> like in tutorial http://www.rabbitmq.com/clustering.html#creating?
> 
> 
> Another question is:
> If I have persistent queue declared od serwer 1 when serwer 1 is down in 
> second serwer this queue dissappear. When I will change cluster typ this 
> behavior will change? Is it possible change it behavior about persistent 
> queue when serwers are in cluster?
> 
> 
> 
> Regards,
> Adam
> 
> -- 
> This message has been scanned for viruses and
> dangerous content by MailScanner, and is
> believed to be clean.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From adamka at dgt.com.pl  Wed Dec  1 11:02:23 2010
From: adamka at dgt.com.pl (Adam Kaminiecki)
Date: Wed, 01 Dec 2010 12:02:23 +0100
Subject: [rabbitmq-discuss] Clustering Serwer Question
In-Reply-To: <20101201101625.GA9947@dakota.eng.vmware.com>
References: <4CF60F48.4070502@dgt.com.pl>
	<20101201101625.GA9947@dakota.eng.vmware.com>
Message-ID: <4CF62B3F.9090003@dgt.com.pl>

So you mean I need to install and configure external sofware on external 
machine for redundant durable queues and persistent messages?
It's little strange for me ;/

Regards,
Adam


W dniu 2010-12-01 11:16, Alexandru Scvor?ov pisze:
> Hi,
>
>> My question is how can i change a cluster type from ram to disk? I have
>> 2 serwers and 1 node in each of them. Need I have 3 servers to do it
>> like in tutorial http://www.rabbitmq.com/clustering.html#creating?
> The nodes are either ram or disc.  When you issue the cluster command,
> the nodes passed as arguments are the disc nodes.  From the clustering
> guide,
>
> rabbit2$ rabbitmqctl cluster rabbit at rabbit1
> Clustering node rabbit at rabbit2 with [rabbit at rabbit1] ...done.
>
> rabbit1$ rabbitmqctl status
> Status of node rabbit at rabbit1 ...
> [...,
>    {nodes,[{disc,[rabbit at rabbit1]},{ram,[rabbit at rabbit2]}]},
>    {running_nodes,[rabbit at rabbit2,rabbit at rabbit1]}]
> ...done.
>
> rabbit2$ rabbitmqctl status
> Status of node rabbit at rabbit2 ...
> [...,
>    {nodes,[{disc,[rabbit at rabbit1]},{ram,[rabbit at rabbit2]}]},
>    {running_nodes,[rabbit at rabbit1,rabbit at rabbit2]}]
> ...done.
>
> In the above example, we create a cluster of two nodes, rabbit1 is disc
> (because it's in the arguments to the cluster command), and rabbit2 is
> ram.
>
> Two nodes is enough for a cluster.
>
>> If I have persistent queue declared od serwer 1 when serwer 1 is down in
>> second serwer this queue dissappear. When I will change cluster typ this
>> behavior will change? Is it possible change it behavior about persistent
>> queue when serwers are in cluster?
> No.
>
> A queue can only exist on one node at a time.  If said node dies, the
> queue disappears or becomes unusable: durable queues become unusable
> until the node comes back online (they cannot be redeclared on another
> node), non-durable queues just disappear (but can be redeclared on
> another node).
>
> If you need to not lose messages and have the queue available even after
> a node death, you might want to have a look at the HA with Rabbit guide:
>    http://www.rabbitmq.com/pacemaker.html
>
> Cheers,
> Alex
>
> On Wed, Dec 01, 2010 at 10:03:04AM +0100, Adam Kaminiecki wrote:
>> Hi,
>>
>> My question is how can i change a cluster type from ram to disk? I have
>> 2 serwers and 1 node in each of them. Need I have 3 servers to do it
>> like in tutorial http://www.rabbitmq.com/clustering.html#creating?
>>
>>
>> Another question is:
>> If I have persistent queue declared od serwer 1 when serwer 1 is down in
>> second serwer this queue dissappear. When I will change cluster typ this
>> behavior will change? Is it possible change it behavior about persistent
>> queue when serwers are in cluster?
>>
>>
>>
>> Regards,
>> Adam
>>
>> -- 
>> This message has been scanned for viruses and
>> dangerous content by MailScanner, and is
>> believed to be clean.
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-- 
This message has been scanned for viruses and
dangerous content by MailScanner, and is
believed to be clean.


From mixtlispam at gmail.com  Wed Dec  1 14:32:36 2010
From: mixtlispam at gmail.com (mixtli)
Date: Wed, 1 Dec 2010 06:32:36 -0800 (PST)
Subject: [rabbitmq-discuss] queue statistics
Message-ID: <9cb0e771-15dd-476d-9f2a-8950fb665cec@t8g2000prh.googlegroups.com>

Are the queue statistics known to work?  I'm on 2.1.1 from macports,
and all statistics on all queues seem to show 0.

sudo rabbitmqctl -p netatlas list_queues name messages
messages_unacknowledged messages_ready

Listing queues ...
poller_config_44	 0	0	0
poller_config_35	 0	0	0
poller_config_39	 0	0	0
poller_config_28	 0	0	0


This is after I've sent many messages to the queue.  I'm able to pop
them off, but they never show up in stats.

Do I need to upgrade to 2.2.0, and if so, any idea when it might make
it to macports?

Thanks ;)


From riteshrathi at gmail.com  Wed Dec  1 15:41:53 2010
From: riteshrathi at gmail.com (rathi)
Date: Wed, 1 Dec 2010 21:11:53 +0530
Subject: [rabbitmq-discuss] Queue Ordering after restart
Message-ID: <AANLkTinKou=AecLt8kzPEjZSJ58VkyPigwM9j4=WP9Ao@mail.gmail.com>

In the rabbitmq documentation it is said
*
*
*I have read that RabbitMQ preserves the order of messages in queues. Is
this correct?*

*For the most part, yes. Say a publisher publishes messages M1, M2, M3 and
M4 (in that order) on the same channel and with the same routing
information. If these messages are routed to a queue then they will end up
in the same order that they were published. Consuming on the queue will
yield M1, M2, M3 and then M4.*

*However, the order is only guaranteed in the absence of requeuing. A
message will be implicitly requeued if a consumer closes the channel before
ack'ing a message. For example, if a consumer receives M1, fails to ack and
closes the channel then the next consumer will receive messages in the order
M2, M3, M4, M1. Messages can also be explicitly requeued if the consumer
calls basic.recover{requeue=true}. The FAQ on at least once
delivery<http://www.rabbitmq.com/faq.html#at-least-once-delivery>talks
about this in some more detail.
*


I have only one consumer which should process messages in the order they are
published. If my consumer gets M1 and crashes without acknowledging M1, then
when I restart my consumer I want to process messages in the same order as
they were published. Can this be achieved ?


thanks & regards,

ritesh rathi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101201/66a4f3cc/attachment.htm>

From clegnitto at mozilla.com  Wed Dec  1 17:30:11 2010
From: clegnitto at mozilla.com (Christian Legnitto)
Date: Wed, 1 Dec 2010 09:30:11 -0800
Subject: [rabbitmq-discuss] Routing key questions/suggestions
In-Reply-To: <20101130215306.GA31339@wellquite.org>
References: <A8868E70-C391-4118-A1A1-80E8F8D72EC7@mozilla.com>
	<20101130180619.GN21718@rabbitmq.com>
	<20101130215306.GA31339@wellquite.org>
Message-ID: <AE216C80-FA24-45EC-9DA4-CE75DB541A94@mozilla.com>

Ok, thanks for the info guys. I had a long reply but I guess it didn't go through yesterday. I'll send it anyway just for posterity.

Christian


On Nov 30, 2010, at 1:53 PM, Matthew Sackman wrote:

> On Tue, Nov 30, 2010 at 06:06:19PM +0000, Matthew Sackman wrote:
>> On Tue, Nov 30, 2010 at 09:43:49AM -0800, Christian Legnitto wrote:
>>> 1. Why use "." as the routing token separator?
>> 
>> Well, something has to be chosen, and whatever is chosen is going to be
>> inconvenient for someone. I don't know whether there was some reason to
>> choose . over anything else.
> 
> Actually, I reckon any of 0x1C to 0x1F in C0 are designed for this.
> Probably 0x1F being the best idea, given:
> 
> "Can be used as delimiters to mark fields of data structures. If used
> for hierarchical levels, US is the lowest level (dividing plain-text
> data items), while RS, GS, and FS are of increasing level to divide
> groups made up of items of the level beneath it."[0]
> 
> Matthew
> 
> [0] http://en.wikipedia.org/wiki/Group_separator


From clegnitto at mozilla.com  Wed Dec  1 17:32:59 2010
From: clegnitto at mozilla.com (Christian Legnitto)
Date: Wed, 1 Dec 2010 09:32:59 -0800
Subject: [rabbitmq-discuss] Routing key questions/suggestions
In-Reply-To: <20101130180619.GN21718@rabbitmq.com>
References: <A8868E70-C391-4118-A1A1-80E8F8D72EC7@mozilla.com>
	<20101130180619.GN21718@rabbitmq.com>
Message-ID: <7BBB84E4-688D-41C5-AFD7-E7A18313546F@mozilla.com>

(meant to send this yesterday but it didn't go through)

On Nov 30, 2010, at 10:06 AM, Matthew Sackman wrote:

> On Tue, Nov 30, 2010 at 09:43:49AM -0800, Christian Legnitto wrote:
>> 1. Why use "." as the routing token separator?
> 
> Well, something has to be chosen, and whatever is chosen is going to be
> inconvenient for someone. I don't know whether there was some reason to
> choose . over anything else.

Yeah, I guess this was inspiration from jms stuff?

> 
>> Can we make it configurable on the broker?
> 
> Well, it's only code. Having had a quick look through, it seems like the
> splitting is currently only done at the use point. So I reckon maybe the
> only change that's needed is in rabbit_exchange_type_topic.erl, change
> the split_topic_key/1 fun to split on whatever you want.

Ok, this might be a way to go. Of course, it would lock me into one implementation and is getting away from the AMQP standard.

> 
>> Can we support sending a magic X-AMQP-ROUTING-SEPERATOR or something
>> header with the message so it can be anything and vary by message?
> 
> Erm that would be substantially more complex.

Yep, but it seems like an interesting way go. That way the publisher can alter the separator based on data. If any routing key tokens have a ".", pick a character that doesn't exist in any of them. When specifying a binding, perhaps use something ugly like foo[:split:]bar[:split:]baz or foo>>bar>>baz or [foo][bar][baz]...or have a way to escape "." and translate any real "." separator into the message specified one. (Note that Matthew had a better suggestion)

I don't know, just throwing cold medicine infused ideas out there ha.

> 
>> 	* It seems like an odd choice to use a character that will show
>> 	up in data a lot
> 
> True. Maybe , would be a better choice given most programming languages
> use , to separate list elements anyway.

For my data this would definitely have been a better choice, though other data sets would likely have a problem. I think it's best to let people choose (I'd actually probably choose one of >~| if it had to be one character). (Note that Matthew had a better suggestion)

> 
>> Example:
>> 
>> I'm listening to commit messages from GitHub. My binding is
>> github.push.*.mycoolproject, which means I want to listen to all push
>> messages by anyone for a project named mycoolproject. If someone's
>> github username has a period in it though, I won't see the messages
>> (github.push.john.smith.mycoolproject). If I bound with
>> github.push.#.mycoolproject I would see the previous message, but I
>> might also get messages for other projects with GitHub users that have
>> mycoolproject in their username
>> (github.push.this.is.mycoolproject.user.project2). I know this isn't
>> the best example, but I'm sick and my head is a bit murky ha.
> 
> Yeah, I know the feeling :/ As I said, _any_ choice is ultimately going
> to collide with something else so you're always going to have to do some
> sort of encoding / escaping yourself. It looks like AMQP doesn't support
> any sort of escaping to prevent the . being interpreted as a semantic .
> so you really are going to have to do translation to something other
> than .
> 
> If, in your case, there is no character that cannot appear in a github
> username (and I'd hope not - surely the whole web supports every unicode
> code point by now...) then you're just not going to be able to solve
> this. This possibly points to AMQP needing to change to support escaping
> of . with a \

Yeah, I figured that was the case. Unfortunately translation ties binding specification to a particular producer/consumer escape mechanism. That is, if my producer escapes "." by replacing it with "[:dot:]", when I bind to "github.push.jim.bob.mycoolproject" I would have to use "github.push.jim[:dot:]bob.mycoolproject". If later I wanted to change this on the producer side (or say I use a 3rd party producer like gitub that doesn't escape the same way) I'd have to modify all the bindings. This is probably an acceptable tradeoff though.

> 
>> 2. Are there are future plans to publish a message with multiple routing keys?
> 
> Not that I'm aware of.
> 
>> 	* I know I can publish the same message multiple times with different routing keys, seems inefficient
> 
> Indeed.
> 
>> For bugzilla messages, when someone changes a bug I send a
>> bug.changed.[field] message. Many tools want to pivot on specific
>> users though. It'd be nice to publish them also as
>> bzuser at example.com.changed.bug so those tools don't have to listen to
>> all changes and group by user themselves, which seems very
>> inefficient.
> 
> You could put _everything_ in the routing key.
> $USER.$BUG_NUMBER.$FIELD
> and then the different tools just need to choose where to put # and *.
> If you prefix each field value with the field name then it ensures that
> such binding keys can anchor in the right place which is useful when the
> range of fields overlap. Eg QA and Assign fields - if you were trying to
> match changes by me to bugs, you'd be ill-advised to just do #.matthew.#
> given that that would match changes _not_ by me but for bugs where I'm
> the QA or assignee. Thus a key of:
> 
> user.matthew.bug.12345.qa.matthew.assignee.matthew.field.status
> 
> then allows a much more precise match of #.qa.matthew.# for example.

Ah, I never really thought of this as I have been trying to treat the routing keys as hierarchical constructs. This feels a bit hacky but will likely work. Do you see other use cases that would support sending multiple routing keys with a given message?

Looks like what I want is a way for consumers to listen to certain key/value pairs in the message. Of course, AMQP isn't set up for that and the broker would need to know about the message formats to do the routing. Using multiple routing keys is pretty much just approximating k/v lookup w/o the broker needing to know about the message payload:

* user.matthew  -> key = user, value = matthew
* bug.12345 -> key = bug, value = 12345
* status.changed -> key = status, value =changed

 I'll play around with your suggestion. Of course, the more data I put in the key the more I come back to my question #1 above :-)

Thanks for the quick response!

Christian



From benbennett at gmail.com  Wed Dec  1 18:45:20 2010
From: benbennett at gmail.com (Ben Bennett)
Date: Wed, 1 Dec 2010 12:45:20 -0600
Subject: [rabbitmq-discuss] RabbitMQ JSON-RPC test in 2.2.0-1
Message-ID: <AANLkTi=ds96wJ6GFqLUxErAxyPoE4GmSkGSHVc1-0-3D@mail.gmail.com>

Hello,

I am trying to get the sample json rpc tests working on three
different systems in which all do not work.
I downloaded the following from the plugins page.
    * mochiweb
    * rfc4627_jsonrpc
    * rabbitmq-mochiweb
    * rabbitmq-jsonrpc
    * rabbitmq-jsonrpc-channel
    * rabbitmq-jsonrpc-channel-examples
I then drop them in the correct plugins folder. I change the owner and
group of the ez files to be root.
The first two boxes are  running ubuntu 10.10 server i386 and 10.04.1
LTS , when I access the remote
ur(http://IPADDRESS:55672/rpc-examples/test/index.html)l nothing is
displayed.
No errors , nothing, just a blank page with the rabbitmq logo and text
test_main.

The second box is running ubuntu 9.10 x64 the error is displayed below
when I access http://localhost:55672/rpc-examples/test/index.html .

What I am missing? Is there some setup script that must be ran to
setup the queues and exchanges? Is something broken?


{"installGenericProxy":{"name":"open","idempotent":false,"params":[{"name":"username","type":"str"},{"name":"password","type":"str"},{"name":"sessionTimeout","type":"num"},{"name":"virtualHost","type":"str"}]}}
open
JsonRPC error:
Service: "/rpc/rabbitmq"
Method: "open"
Params: ["guest","guest",5,null]
Response: {"version":"1.1","id":2,"error":{"name":"JSONRPCError","code":500,"message":"Internal
error","error":"{{{badmatch,
      {error,
          {undef,
              [{amqp_connection,start,
                   [direct,

{amqp_params,<<\"guest\">>,<<\"guest\">>,<<\"/\">>,\"localhost\",
                        5672,0,0,0,none,[]}]},
               {rabbit_jsonrpc_channel,init,1},
               {gen_server,init_it,6},
               {proc_lib,init_p_do_apply,3}]}}},
  [{rabbit_jsonrpc_channel,open,1},
   {rabbit_jsonrpc_channel_factory,handle_call,3},
   {gen_server,handle_msg,5},
   {proc_lib,init_p_do_apply,3}]},
 {gen_server,call,
     [<0.292.0>,
      {jsonrpc,<<\"open\">>,
          {obj,
              [{\"http_method\",<<\"POST\">>},
               {\"http_query_parameters\",{obj,[]}},
               {\"http_headers\",
                {obj,
                    [{\"accept\",<<\"*/*\">>},

{\"accept-charset\",<<\"ISO-8859-1,utf-8;q=0.7,*;q=0.7\">>},
                     {\"accept-encoding\",<<\"gzip,deflate\">>},
                     {\"accept-language\",<<\"en-us,en;q=0.5\">>},
                     {\"cache-control\",<<\"no-cache\">>},
                     {\"connection\",<<\"keep-alive\">>},
                     {\"content-length\",<<\"74\">>},
                     {\"content-type\",<<\"application/json; charset=UTF-8\">>},
                     {\"host\",<<\"localhost:55672\">>},
                     {\"keep-alive\",<<\"115\">>},
                     {\"pragma\",<<\"no-cache\">>},
                     {\"referer\",

<<\"http://localhost:55672/rpc-examples/test/index.html\">>},
                     {\"user-agent\",
                      <<\"Mozilla/5.0 (X11; U; Linux x86_64; en-US;
rv:1.9.2.12) Gecko/20101027 Ubuntu/9.10 (karmic) Firefox/3.6.12\">>},
                     {\"x-json-rpc-timeout\",<<\"30000\">>},
                     {\"x-requested-with\",<<\"XMLHttpRequest\">>}]}},
               {\"remote_peername\",<<\"127.0.0.1\">>},
               {\"scheme\",<<\"http\">>}]},
          [<<\"guest\">>,<<\"guest\">>,5,null]},
      30000]}}"}}

From adamka at dgt.com.pl  Wed Dec  1 22:51:03 2010
From: adamka at dgt.com.pl (Adam Kaminiecki)
Date: Wed, 01 Dec 2010 23:51:03 +0100
Subject: [rabbitmq-discuss] Possible bug
In-Reply-To: <AANLkTi=ds96wJ6GFqLUxErAxyPoE4GmSkGSHVc1-0-3D@mail.gmail.com>
References: <AANLkTi=ds96wJ6GFqLUxErAxyPoE4GmSkGSHVc1-0-3D@mail.gmail.com>
Message-ID: <4CF6D157.20108@dgt.com.pl>

Hi,

I have 2 serwers in disk cluster 2.1.1

I'm creating durable exchange type direct and bind durable queue then 
send a persistent message. Then Im stopping the serwer where I have send 
the message and start it. After this I'm trying to list queues and both 
nodes not die but its look like deadlock??  When new client is trying to 
connect he's blocked to... it is .net client.


Regards,
Adam

-- 
This message has been scanned for viruses and
dangerous content by MailScanner, and is
believed to be clean.


From jdetreville at vmware.com  Thu Dec  2 00:35:05 2010
From: jdetreville at vmware.com (John DeTreville)
Date: Wed, 1 Dec 2010 16:35:05 -0800
Subject: [rabbitmq-discuss] Queue Ordering after restart
In-Reply-To: <mailman.1457.1291243888.13459.rabbitmq-discuss@lists.rabbitmq.com>
References: <mailman.1457.1291243888.13459.rabbitmq-discuss@lists.rabbitmq.com>
Message-ID: <C0528927-7BF7-4FFF-8BB4-3A80D11C0326@vmware.com>

On Dec 1, 2010, at 2:51 PM, rathi <riteshrathi at gmail.com<mailto:riteshrathi at gmail.com>> wrote:

From: rathi <riteshrathi at gmail.com<mailto:riteshrathi at gmail.com>>
Date: December 1, 2010 7:41:53 AM PST
To: rabbitmq <rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>>
Subject: [rabbitmq-discuss] Queue Ordering after restart

I have only one consumer which should process messages in the order they are published. If my consumer gets M1 and crashes without acknowledging M1, then when I restart my consumer I want to process messages in the same order as they were published. Can this be achieved ?

I should first point out that I work in RabbitMQ's Pacific Rim office, 8 time zones away from London. I answer questions in the middle of their night. I may be trading off accuracy for promptness.

That said, I believe you cannot. I believe that if your application crashes (or closes its connection) without acknowledging a message, and the queue is persistent, then the message may later appear out of order.

More generally, if your application crashes K times without acknowledging messages, then those K messages may later appear out of order.

Cheers,
John


From jdetreville at vmware.com  Thu Dec  2 00:49:42 2010
From: jdetreville at vmware.com (John DeTreville)
Date: Wed, 1 Dec 2010 16:49:42 -0800
Subject: [rabbitmq-discuss] Routing key questions/suggestions
In-Reply-To: <mailman.1457.1291243888.13459.rabbitmq-discuss@lists.rabbitmq.com>
References: <mailman.1457.1291243888.13459.rabbitmq-discuss@lists.rabbitmq.com>
Message-ID: <A4044242-98B3-4E39-AA0E-971CD5F95ED8@vmware.com>

On Dec 1, 2010, at 9:30 AM, Christian Legnitto <clegnitto at mozilla.com<mailto:clegnitto at mozilla.com>> wrote:

From: Christian Legnitto <clegnitto at mozilla.com<mailto:clegnitto at mozilla.com>>
Date: December 1, 2010 9:30:11 AM PST
To: Matthew Sackman <matthew at rabbitmq.com<mailto:matthew at rabbitmq.com>>
Cc: "rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>" <rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>>
Subject: Re: [rabbitmq-discuss] Routing key questions/suggestions

Ok, thanks for the info guys. I had a long reply but I guess it didn't go through yesterday. I'll send it anyway just for posterity.

The following is just opinion, but since it's \my/ opinion, it's \very/ interesting!

It might be best (in some future world) to let routing keys and binding keys be \lists/ of strings, pre-parsed by the client. If RabbitMQ doesn't have to interpret separator characters, it can't get it wrong!

(That said, this would be an extension to the AMQP protocol, but all of these other suggestions would be extensions too.)

Cheers,
John DeTreville
RabbitMQ Pacific Rim office
(8 hours behind London time)
(but just as cold and dark)


From bsellner at seegrid.com  Thu Dec  2 06:05:24 2010
From: bsellner at seegrid.com (Brennan Sellner)
Date: Thu, 2 Dec 2010 01:05:24 -0500
Subject: [rabbitmq-discuss] Routing key questions/suggestions
In-Reply-To: <A8868E70-C391-4118-A1A1-80E8F8D72EC7@mozilla.com>
References: <A8868E70-C391-4118-A1A1-80E8F8D72EC7@mozilla.com>
Message-ID: <1291269924.12642.55.camel@gear>

On Tue, 2010-11-30 at 09:43 -0800, Christian Legnitto wrote:
> Example:
> 
> I'm listening to commit messages from GitHub. My binding is
> github.push.*.mycoolproject, which means I want to listen to all push
> messages by anyone for a project named mycoolproject. If someone's
> github username has a period in it though, I won't see the messages
> (github.push.john.smith.mycoolproject). If I bound with
> github.push.#.mycoolproject I would see the previous message, but I
> might also get messages for other projects with GitHub users that have
> mycoolproject in their username
> (github.push.this.is.mycoolproject.user.project2). I know this isn't
> the best example, but I'm sick and my head is a bit murky ha.

A somewhat hackish solution to this might be to hash (e.g. md5) any
field that can have arbitrary characters in it.  It renders the routing
keys not humanly readable, but does avoid the inserted-special-character
problem, given arbitrary input, at the cost of a (probably unlikely)
hash collision.

This is just a cheap, weak form of separator-escaping, of course.

-Brennan



From s4nchez at gmail.com  Thu Dec  2 09:08:55 2010
From: s4nchez at gmail.com (Ivan Sanchez)
Date: Thu, 2 Dec 2010 01:08:55 -0800 (PST)
Subject: [rabbitmq-discuss] Permission handling changed on 2.2.0?
Message-ID: <90f23013-c0b2-4ec9-86c4-f774a29aec39@j19g2000prh.googlegroups.com>

  Hi all,

  I've upgraded to 2.2.0 and since then I can't get my consumers to
work with our previous permissions. For instance, if I have
permissions like:

  rabbitmqctl set_permissions ping ping ping ping

  Then I get the following error:

   connection <0.4248.0> (running), channel 1 - error:
{amqp_error,access_refused,
            "access to queue 'amq.gen-STvK+LmDNxQrlLAUaVNfSg==' in
vhost '/' refused for user 'ping'",
            'queue.declare'}

  The consumer code has not been changed, and it never had to define
queue names before. Reading the docs it seems like that was wrong, but
since we never had permission problems now I'm confused.

  Am I missing something?

  Thank you for your help,

--
Ivan Sanchez






From matthias at rabbitmq.com  Thu Dec  2 09:23:07 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 02 Dec 2010 09:23:07 +0000
Subject: [rabbitmq-discuss] Routing key questions/suggestions
In-Reply-To: <7BBB84E4-688D-41C5-AFD7-E7A18313546F@mozilla.com>
References: <A8868E70-C391-4118-A1A1-80E8F8D72EC7@mozilla.com>	<20101130180619.GN21718@rabbitmq.com>
	<7BBB84E4-688D-41C5-AFD7-E7A18313546F@mozilla.com>
Message-ID: <4CF7657B.4020406@rabbitmq.com>

Christian,

Christian Legnitto wrote:
> Looks like what I want is a way for consumers to listen to certain
> key/value pairs in the message. Of course, AMQP isn't set up for that

The spec defines a 'headers' exchange type which does exactly that. And 
RabbitMQ implements it (though not particularly efficiently at this stage).


Matthias.

From alexandru at rabbitmq.com  Thu Dec  2 09:52:48 2010
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Thu, 2 Dec 2010 09:52:48 +0000
Subject: [rabbitmq-discuss] Permission handling changed on 2.2.0?
In-Reply-To: <90f23013-c0b2-4ec9-86c4-f774a29aec39@j19g2000prh.googlegroups.com>
References: <90f23013-c0b2-4ec9-86c4-f774a29aec39@j19g2000prh.googlegroups.com>
Message-ID: <20101202095248.GA18858@dakota.Home>

Hi Ivan,

We changed the way permissions work in 2.1.0 and 2.2.0.

In previous releases, every client would implicitly have access to
server-generated names (amq\.gen.*).  This is no longer the case.

The current permissions mechanism is described in our administration
guide:
  http://www.rabbitmq.com/admin-guide.html

You probably want your individual permissions to be
'^amq\.gen.*|ping$' and not just ping.


Cheers,
Alex

On Thu, Dec 02, 2010 at 01:08:55AM -0800, Ivan Sanchez wrote:
>   Hi all,
> 
>   I've upgraded to 2.2.0 and since then I can't get my consumers to
> work with our previous permissions. For instance, if I have
> permissions like:
> 
>   rabbitmqctl set_permissions ping ping ping ping
> 
>   Then I get the following error:
> 
>    connection <0.4248.0> (running), channel 1 - error:
> {amqp_error,access_refused,
>             "access to queue 'amq.gen-STvK+LmDNxQrlLAUaVNfSg==' in
> vhost '/' refused for user 'ping'",
>             'queue.declare'}
> 
>   The consumer code has not been changed, and it never had to define
> queue names before. Reading the docs it seems like that was wrong, but
> since we never had permission problems now I'm confused.
> 
>   Am I missing something?
> 
>   Thank you for your help,
> 
> --
> Ivan Sanchez
> 
> 
> 
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simonthorogood at hotmail.com  Thu Dec  2 10:13:22 2010
From: simonthorogood at hotmail.com (SimonT)
Date: Thu, 2 Dec 2010 02:13:22 -0800 (PST)
Subject: [rabbitmq-discuss] RPC style messaging with a clustered web
	application
Message-ID: <689b9825-1100-4ac7-941c-5b2215240c46@o23g2000prh.googlegroups.com>

Hi - Can anybody suggest how the following scenerio could be
accomplished using RabbitMQ?

There are 2 processes that need to communicate with one another. One
is a web application, the other a long running batch-processing
service (windows service). In the web layer a 'session' is created and
as part of that process, several 'request' messages are sent to the
windows service. On subsequent polling requests to the web
application, the user's session is re-constructed and an attempt is
made to update it from response messages returned by the batch-
processing service (usng a correlation ID to pick the relevant
messages from the queue). Currently this is achieved using a pair of
private MSMQ queues, which ties pairs of web apps and processing
services together on a single node (i.e. using sticky users sessions).

What we'd like to achieve is decoupling of these processes into a
cluster of web app nodes and a separate cluster of processing nodes.
The req part seems simple - the messages can be broadcast to a fan-out
(i think?) exchange and any one of the (identical) processing nodes
can pick up the messages.

What we are struggling with is getting the response routed back to the
session correctly. At this end there is no long-running process (i.e.
the session is re-hydrated with each polling request and could be
requested on any web app node).

I think that we probably need a response queue per session created at
session start and some routing rules for the response messages based
on the session ID. However, I'm not clear on how these queues could be
expired once their purpose is complete? or if this is an issue?
(though I assume it is since we have many 100s sessions a minute).
There is no definitive 'end' to the session - currently it's
serialized state just expires after x amount of idle time.

From majek04 at gmail.com  Thu Dec  2 11:06:59 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Thu, 2 Dec 2010 11:06:59 +0000
Subject: [rabbitmq-discuss] RPC style messaging with a clustered web
	application
In-Reply-To: <689b9825-1100-4ac7-941c-5b2215240c46@o23g2000prh.googlegroups.com>
References: <689b9825-1100-4ac7-941c-5b2215240c46@o23g2000prh.googlegroups.com>
Message-ID: <AANLkTinz3H4yHnkdH+CbEiiBvnArOSVFvMj0nvkgABBG@mail.gmail.com>

On Thu, Dec 2, 2010 at 10:13, SimonT <simonthorogood at hotmail.com> wrote:
> I think that we probably need a response queue per session created at
> session start and some routing rules for the response messages based
> on the session ID. However, I'm not clear on how these queues could be
> expired once their purpose is complete? or if this is an issue?
> (though I assume it is since we have many 100s sessions a minute).
> There is no definitive 'end' to the session - currently it's
> serialized state just expires after x amount of idle time.

You should avoid having too many queues - they always consume
some resources.

Raw AMQP doesn't give any solution for this problem. Fortunately
in RabbitMQ we have queue leases extension:
http://www.rabbitmq.com/extensions.html#queue-leases

What it does, is it tells the broker that the queue should be auto-deleted
after a specified time of idleness.

Cheers,
  Marek

From fdourado at bancofator.com.br  Thu Dec  2 12:51:51 2010
From: fdourado at bancofator.com.br (Fernando Rodrigo Chagas Dourado)
Date: Thu, 2 Dec 2010 10:51:51 -0200
Subject: [rabbitmq-discuss] Install RabbitMQ on RHEL
Message-ID: <6E15CEE6F245AC46B04E0160AAFD88C701201AAA@FSP-SRV-EXCH01.FatorDoria.br>

Guys,

 

Someone know what's a repo to install RabbitMQ?

 

Thanks

 

Fernando Dourado

TI Sistemas

+55 11 3049-6073

 

Banco Fator

R Dr Renato Paes de Barros, 1017 - 12? andar
Itaim Bibi - 04530-001 - S?o Paulo - SP
www.bancofator.com.br <http://www.bancofator.com.br> 

 



Pontos de vista e opini?es inclusos nesta mensagem s?o de responsabilidade do remetente a menos que claramente mencionado como originados pelas Empresas do Conglomerado Fator. Comunica??es pela internet n?o podem ser garantidas quanto ? sua seguran?a ou inexist?ncia de erros e v?rus. As empresas controladas pelo Banco Fator, por esta raz?o, n?o assumem responsabilidade por qualquer erro ou omiss?o no contexto da mensagem, decorrente da transmiss?o via internet. Essa mensagem pode conter informa??o confidencial. Se voc? n?o for o destinat?rio ou a pessoa autorizada a receber esta mensagem, n?o poder? usar, copiar ou divulgar as informa??es nela contidas ou tomar qualquer a??o baseada nessas informa??es. Se voc? recebeu esta mensagem por engano, por favor, avise imediatamente o remetente, respondendo este e-mail e em seguida apagando-o. Agradecemos a sua coopera??o.  
SAC: 0800 770 7229 ou sac at bancofator.com.br 
Ouvidoria Fator: 0800-77-32867 (memorize: 0800-77-FATOR)      
                 email : ouvidoria at bancofator.com.br                                                    
                 carta:   Rua Dr. Renato Paes de Barros, 1017, 12o.andar  Itaim Bibi - S?o Paulo  SP  04530-001.

Points of view and opinions herein expressed are the responsibility of sender unless clearly stated otherwise as having been originated in companies of the Fator Conglomerate. Communications via the Internet cannot be guaranteed with regards to safety or the absence of errors and viruses. For this reason, Banco Fator-controlled companies shall not assume responsibility for errors or omissions in the context of a transmission via the Internet. This e-mail may be confidential. If you are not the intended recipient or the authorized person to receive this message, you may not use, copy or publicize information therein contained or take any action based on such information. If you are not the intended addressee, please advise sender immediately by replying to this e-mail and delete if obtained in error. We appreciate your cooperation. 
Customer Care: 0800 770 7229 or sac at bancofator.com.br Fator 
Ombudsperson: 0800-77-32867 (remember: 800-77-FATOR)              
              or by email: ouvidoria at bancofator.com.br                           
              or by letter: Rua Dr. Renato Paes de Barros, 1017, 12o. andar  Itaim Bibi - S?o Paulo  SP  04530-001 .
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101202/ed75c944/attachment.htm>

From fdourado at bancofator.com.br  Thu Dec  2 13:07:39 2010
From: fdourado at bancofator.com.br (Fernando Rodrigo Chagas Dourado)
Date: Thu, 2 Dec 2010 11:07:39 -0200
Subject: [rabbitmq-discuss] RES:  Install RabbitMQ on RHEL
In-Reply-To: <AANLkTikBvPqxw4mpp8780ro+yMZP2kBoonhx9Rhi0ziu@mail.gmail.com>
References: <6E15CEE6F245AC46B04E0160AAFD88C701201AAA@FSP-SRV-EXCH01.FatorDoria.br>
	<AANLkTikBvPqxw4mpp8780ro+yMZP2kBoonhx9Rhi0ziu@mail.gmail.com>
Message-ID: <6E15CEE6F245AC46B04E0160AAFD88C701201AEB@FSP-SRV-EXCH01.FatorDoria.br>

Thanks Jeff. On official repo I don't find rabbitmq-server

Fernando Dourado
TI Sistemas
+55 11 3049-6073

Banco Fator
R Dr Renato Paes de Barros, 1017 - 12? andar
Itaim Bibi - 04530-001 - S?o Paulo - SP
www.bancofator.com.br

-----Mensagem original-----
De: jeff at ocjtech.us [mailto:jeff at ocjtech.us] 
Enviada em: quinta-feira, 2 de dezembro de 2010 11:03
Para: Fernando Rodrigo Chagas Dourado
Assunto: Re: [rabbitmq-discuss] Install RabbitMQ on RHEL

2010/12/2 Fernando Rodrigo Chagas Dourado <fdourado at bancofator.com.br>:
>
> Someone know what?s a repo to install RabbitMQ?

http://fedoraproject.org/wiki/EPEL

-- 
Jeff Ollie


Pontos de vista e opini?es inclusos nesta mensagem s?o de responsabilidade do remetente a menos que claramente mencionado como originados pelas Empresas do Conglomerado Fator. Comunica??es pela internet n?o podem ser garantidas quanto ? sua seguran?a ou inexist?ncia de erros e v?rus. As empresas controladas pelo Banco Fator, por esta raz?o, n?o assumem responsabilidade por qualquer erro ou omiss?o no contexto da mensagem, decorrente da transmiss?o via internet. Essa mensagem pode conter informa??o confidencial. Se voc? n?o for o destinat?rio ou a pessoa autorizada a receber esta mensagem, n?o poder? usar, copiar ou divulgar as informa??es nela contidas ou tomar qualquer a??o baseada nessas informa??es. Se voc? recebeu esta mensagem por engano, por favor, avise imediatamente o remetente, respondendo este e-mail e em seguida apagando-o. Agradecemos a sua coopera??o.  
SAC: 0800 770 7229 ou sac at bancofator.com.br 
Ouvidoria Fator: 0800-77-32867 (memorize: 0800-77-FATOR)      
                 email : ouvidoria at bancofator.com.br                                                    
                 carta:   Rua Dr. Renato Paes de Barros, 1017, 12o.andar ? Itaim Bibi - S?o Paulo ? SP ? 04530-001.

Points of view and opinions herein expressed are the responsibility of sender unless clearly stated otherwise as having been originated in companies of the Fator Conglomerate. Communications via the Internet cannot be guaranteed with regards to safety or the absence of errors and viruses. For this reason, Banco Fator-controlled companies shall not assume responsibility for errors or omissions in the context of a transmission via the Internet. This e-mail may be confidential. If you are not the intended recipient or the authorized person to receive this message, you may not use, copy or publicize information therein contained or take any action based on such information. If you are not the intended addressee, please advise sender immediately by replying to this e-mail and delete if obtained in error. We appreciate your cooperation. 
Customer Care: 0800 770 7229 or sac at bancofator.com.br Fator 
Ombudsperson: 0800-77-32867 (remember: 800-77-FATOR)              
              or by email: ouvidoria at bancofator.com.br                           
              or by letter: Rua Dr. Renato Paes de Barros, 1017, 12o. andar ? Itaim Bibi - S?o Paulo ? SP ? 04530-001 .

From simon at rabbitmq.com  Thu Dec  2 13:47:49 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 02 Dec 2010 13:47:49 +0000
Subject: [rabbitmq-discuss] RabbitMQ JSON-RPC test in 2.2.0-1
In-Reply-To: <AANLkTi=ds96wJ6GFqLUxErAxyPoE4GmSkGSHVc1-0-3D@mail.gmail.com>
References: <AANLkTi=ds96wJ6GFqLUxErAxyPoE4GmSkGSHVc1-0-3D@mail.gmail.com>
Message-ID: <4CF7A385.1040809@rabbitmq.com>

On 01/12/10 18:45, Ben Bennett wrote:
> Hello,
>
> I am trying to get the sample json rpc tests working on three
> different systems in which all do not work.

Damn, we added a dependency and forgot to document it on the plugins 
page. You also need amqp_client.ez. That's fixed now. Thanks for the bug 
report :)

That certainly accounts for the error you're seeing on the second box. 
The first one sounds more like no Javascript is getting served to the 
browser - can you do the usual clear cache etc dance, and check for 
Javascript errors?

You may also want to investigate 
https://github.com/rabbitmq/rabbit-socks for RabbitMQ-to-the-browser - 
it's newer and a bit cruder ATM but the fundamental approach is mroe 
sound and it probably has more of a future.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From benbennett at gmail.com  Thu Dec  2 14:22:33 2010
From: benbennett at gmail.com (Ben Bennett)
Date: Thu, 2 Dec 2010 08:22:33 -0600
Subject: [rabbitmq-discuss] RabbitMQ JSON-RPC test in 2.2.0-1
In-Reply-To: <4CF7A385.1040809@rabbitmq.com>
References: <AANLkTi=ds96wJ6GFqLUxErAxyPoE4GmSkGSHVc1-0-3D@mail.gmail.com>
	<4CF7A385.1040809@rabbitmq.com>
Message-ID: <AANLkTinaBD2HrnE+0U_DH0ioMm5yUZxR1kCr0UhEjhg8@mail.gmail.com>

Doesn't look like I can use it the  client has dependency on IE 8 , so
were in the endless IE work arounds.

Thanks,
Ben

On Thu, Dec 2, 2010 at 7:47 AM, Simon MacMullen <simon at rabbitmq.com> wrote:
> On 01/12/10 18:45, Ben Bennett wrote:
>>
>> Hello,
>>
>> I am trying to get the sample json rpc tests working on three
>> different systems in which all do not work.
>
> Damn, we added a dependency and forgot to document it on the plugins page.
> You also need amqp_client.ez. That's fixed now. Thanks for the bug report :)
>
> That certainly accounts for the error you're seeing on the second box. The
> first one sounds more like no Javascript is getting served to the browser -
> can you do the usual clear cache etc dance, and check for Javascript errors?
>
> You may also want to investigate https://github.com/rabbitmq/rabbit-socks
> for RabbitMQ-to-the-browser - it's newer and a bit cruder ATM but the
> fundamental approach is mroe sound and it probably has more of a future.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From majek04 at gmail.com  Thu Dec  2 14:33:12 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Thu, 2 Dec 2010 14:33:12 +0000
Subject: [rabbitmq-discuss] queue statistics
In-Reply-To: <9cb0e771-15dd-476d-9f2a-8950fb665cec@t8g2000prh.googlegroups.com>
References: <9cb0e771-15dd-476d-9f2a-8950fb665cec@t8g2000prh.googlegroups.com>
Message-ID: <AANLkTinhmFgYNnaQLg814KCaaXGsFXGk86UChkL1B2ab@mail.gmail.com>

On Wed, Dec 1, 2010 at 14:32, mixtli <mixtlispam at gmail.com> wrote:
> Are the queue statistics known to work? ?I'm on 2.1.1 from macports,
> and all statistics on all queues seem to show 0.
>
> sudo rabbitmqctl -p netatlas list_queues name messages
> messages_unacknowledged messages_ready
>
> Listing queues ...
> poller_config_44 ? ? ? ? 0 ? ? ?0 ? ? ? 0
> poller_config_35 ? ? ? ? 0 ? ? ?0 ? ? ? 0
> poller_config_39 ? ? ? ? 0 ? ? ?0 ? ? ? 0
> poller_config_28 ? ? ? ? 0 ? ? ?0 ? ? ? 0
>
>
> This is after I've sent many messages to the queue. ?I'm able to pop
> them off, but they never show up in stats.

Hi,

rabbitmqctl should just work, I'm pretty sure you're doing something wrong.
Are you using 'acks' or 'no_ack=True'? If the latter, than the message
count=0 is actually a proper value.

Cheers,
  Marek

From benbennett at gmail.com  Thu Dec  2 14:35:04 2010
From: benbennett at gmail.com (Ben Bennett)
Date: Thu, 2 Dec 2010 08:35:04 -0600
Subject: [rabbitmq-discuss] RPC style messaging with a clustered web
	application
In-Reply-To: <AANLkTinz3H4yHnkdH+CbEiiBvnArOSVFvMj0nvkgABBG@mail.gmail.com>
References: <689b9825-1100-4ac7-941c-5b2215240c46@o23g2000prh.googlegroups.com>
	<AANLkTinz3H4yHnkdH+CbEiiBvnArOSVFvMj0nvkgABBG@mail.gmail.com>
Message-ID: <AANLkTik0haRL9g+53Ga63JX2zbtfTDs-p0WHHs9-F6o=@mail.gmail.com>

I am having the same issue. I was thinking each node would have its
own queue and in the message or something a routing key back to the
nodes queue, such that message could send a response back. Kinda like
a return address on letter.

On Thu, Dec 2, 2010 at 5:06 AM, Marek Majkowski <majek04 at gmail.com> wrote:
> On Thu, Dec 2, 2010 at 10:13, SimonT <simonthorogood at hotmail.com> wrote:
>> I think that we probably need a response queue per session created at
>> session start and some routing rules for the response messages based
>> on the session ID. However, I'm not clear on how these queues could be
>> expired once their purpose is complete? or if this is an issue?
>> (though I assume it is since we have many 100s sessions a minute).
>> There is no definitive 'end' to the session - currently it's
>> serialized state just expires after x amount of idle time.
>
> You should avoid having too many queues - they always consume
> some resources.
>
> Raw AMQP doesn't give any solution for this problem. Fortunately
> in RabbitMQ we have queue leases extension:
> http://www.rabbitmq.com/extensions.html#queue-leases
>
> What it does, is it tells the broker that the queue should be auto-deleted
> after a specified time of idleness.
>
> Cheers,
> ?Marek
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From fullergalway at gmail.com  Thu Dec  2 14:43:30 2010
From: fullergalway at gmail.com (Robert Fuller)
Date: Thu, 2 Dec 2010 14:43:30 +0000
Subject: [rabbitmq-discuss] does rabbit eat memory?
In-Reply-To: <AANLkTi=XCypEYr-PkSeB2z2=9DxLeuxncCXyK2qQkppX@mail.gmail.com>
References: <AANLkTin9ywvBBS-A2XdPhoj9nbpnj1SsBo6aRODAq_f0@mail.gmail.com>
	<20101126161915.GF1917@wellquite.org>
	<AANLkTi==5iQc2-Khxe6fApNHSw+1swgkUz64a7URWaTZ@mail.gmail.com>
	<20101126163309.GG1917@wellquite.org>
	<AANLkTimB3DOW=-1c_emewsT5xQR+ddH6CRc9ifhMPCYE@mail.gmail.com>
	<20101126165150.GJ1917@wellquite.org>
	<AANLkTinFNobBXieQhXjSLS8b_UJF__qtg2=wm7u-y3Sw@mail.gmail.com>
	<20101126171517.GM1917@wellquite.org>
	<AANLkTi=XCypEYr-PkSeB2z2=9DxLeuxncCXyK2qQkppX@mail.gmail.com>
Message-ID: <AANLkTi=K80aU74nFrOPZMvabDytZRuhGQ7=36YKVdv9j@mail.gmail.com>

Just an update to let you know we made the following changes:

1. in all cases where we do not sent a basicAck, we now send a
basicReject with requeue=true. (using java client).
2. we upgraded the server to rabbitmq 2.2.0

After these two changes we are seeing very nice use of memory by
rabbitmq on the server.

Beauty!

Thanks,
Rob.

On 26 November 2010 20:34, Robert Fuller <fullergalway at gmail.com> wrote:
> Thanks Mathew for the guidance.
>
> My conclusion at this point is that the memory issues we experienced
> are a consequence of the way we are (mis)using rabbitmq. I will adjust
> implementation of our consumer to take into consideration your
> comments in this thread.
>
> Thanks again,
> Rob.
>

From majek04 at gmail.com  Thu Dec  2 14:51:59 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Thu, 2 Dec 2010 14:51:59 +0000
Subject: [rabbitmq-discuss] RPC style messaging with a clustered web
	application
In-Reply-To: <AANLkTik0haRL9g+53Ga63JX2zbtfTDs-p0WHHs9-F6o=@mail.gmail.com>
References: <689b9825-1100-4ac7-941c-5b2215240c46@o23g2000prh.googlegroups.com>
	<AANLkTinz3H4yHnkdH+CbEiiBvnArOSVFvMj0nvkgABBG@mail.gmail.com>
	<AANLkTik0haRL9g+53Ga63JX2zbtfTDs-p0WHHs9-F6o=@mail.gmail.com>
Message-ID: <AANLkTi=q9S8E7Ec78eWV6mqOdQ6F5fSEGx4QbWudPoKA@mail.gmail.com>

On Thu, Dec 2, 2010 at 14:35, Ben Bennett <benbennett at gmail.com> wrote:
> I am having the same issue. I was thinking each node would have its
> own queue and in the message or something a routing key back to the
> nodes queue, such that message could send a response back. Kinda like
> a return address on letter.

You definitely can send a 'callback' queue name, so that a recipient knows
where to return the message. In AMQP there is even a special 'reply-to' message
property for that.

From benbennett at gmail.com  Thu Dec  2 14:58:25 2010
From: benbennett at gmail.com (Ben Bennett)
Date: Thu, 2 Dec 2010 08:58:25 -0600
Subject: [rabbitmq-discuss] Any gotchas when using rabbitmq?
Message-ID: <AANLkTinoUkUxjZzoRV6uNxRAEkvn-z1XkkZbz3R6KWut@mail.gmail.com>

I am trying to figure out what are some of the do's and don'ts of rabbitmq.
Like Don't use a bunch queues, do use more exchanges.. those two are
probably not correct.
Growth rates of memory usage related to queues,exchanges and bindings.
Big O notation is more important to me if the knowledge exists
already.
Also I seen that direct exchange is O(N) when delivering messages, is
N the number of possible queues.

My current design for my system might have bunch of queues on one box
but it also has 32GB of ram and 16 cores and it is active passive
cluster node.
I am trying to figure out if it is going to be problem. We basically
have clients that are going over http and they will need reply back,
but the reply is based on
the client, so I was going to make queue for each client and have it
expire after a while. There are a limit number of clients, less then
2000 unique clients.

Thanks,
Ben

From clegnitto at mozilla.com  Thu Dec  2 17:21:55 2010
From: clegnitto at mozilla.com (Christian Legnitto)
Date: Thu, 2 Dec 2010 09:21:55 -0800
Subject: [rabbitmq-discuss] Routing key questions/suggestions
In-Reply-To: <4CF7657B.4020406@rabbitmq.com>
References: <A8868E70-C391-4118-A1A1-80E8F8D72EC7@mozilla.com>	<20101130180619.GN21718@rabbitmq.com>
	<7BBB84E4-688D-41C5-AFD7-E7A18313546F@mozilla.com>
	<4CF7657B.4020406@rabbitmq.com>
Message-ID: <57C951E1-70BD-4E49-A415-93FA3C27F12F@mozilla.com>

On Dec 2, 2010, at 1:23 AM, Matthias Radestock wrote:

> Christian,
> 
> Christian Legnitto wrote:
>> Looks like what I want is a way for consumers to listen to certain
>> key/value pairs in the message. Of course, AMQP isn't set up for that
> 
> The spec defines a 'headers' exchange type which does exactly that. And RabbitMQ implements it (though not particularly efficiently at this stage).

But is there a way to route using headers via bindings?

Christian


From clegnitto at mozilla.com  Thu Dec  2 17:26:39 2010
From: clegnitto at mozilla.com (Christian Legnitto)
Date: Thu, 2 Dec 2010 09:26:39 -0800
Subject: [rabbitmq-discuss] Routing key questions/suggestions
In-Reply-To: <57C951E1-70BD-4E49-A415-93FA3C27F12F@mozilla.com>
References: <A8868E70-C391-4118-A1A1-80E8F8D72EC7@mozilla.com>	<20101130180619.GN21718@rabbitmq.com>
	<7BBB84E4-688D-41C5-AFD7-E7A18313546F@mozilla.com>
	<4CF7657B.4020406@rabbitmq.com>
	<57C951E1-70BD-4E49-A415-93FA3C27F12F@mozilla.com>
Message-ID: <1547EDA0-43A5-41C2-AA52-E79E4DEC0D06@mozilla.com>


On Dec 2, 2010, at 9:21 AM, Christian Legnitto wrote:

> On Dec 2, 2010, at 1:23 AM, Matthias Radestock wrote:
> 
>> Christian,
>> 
>> Christian Legnitto wrote:
>>> Looks like what I want is a way for consumers to listen to certain
>>> key/value pairs in the message. Of course, AMQP isn't set up for that
>> 
>> The spec defines a 'headers' exchange type which does exactly that. And RabbitMQ implements it (though not particularly efficiently at this stage).

Ah, apologies, I just RTFM. I'll read up on this some more.

Christian

From matthias at rabbitmq.com  Thu Dec  2 17:26:51 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 02 Dec 2010 17:26:51 +0000
Subject: [rabbitmq-discuss] Routing key questions/suggestions
In-Reply-To: <57C951E1-70BD-4E49-A415-93FA3C27F12F@mozilla.com>
References: <A8868E70-C391-4118-A1A1-80E8F8D72EC7@mozilla.com>	<20101130180619.GN21718@rabbitmq.com>
	<7BBB84E4-688D-41C5-AFD7-E7A18313546F@mozilla.com>
	<4CF7657B.4020406@rabbitmq.com>
	<57C951E1-70BD-4E49-A415-93FA3C27F12F@mozilla.com>
Message-ID: <4CF7D6DB.7060509@rabbitmq.com>

Christian,

Christian Legnitto wrote:
> But is there a way to route using headers via bindings?

Er, that's the whole point of a 'headers' exchange.

See 
http://hg.rabbitmq.com/rabbitmq-java-client/file/default/test/src/com/rabbitmq/client/test/functional/Routing.java#l170 
for some examples.


Regards,

Matthias.

From matthias at rabbitmq.com  Thu Dec  2 23:25:48 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 02 Dec 2010 23:25:48 +0000
Subject: [rabbitmq-discuss] Any gotchas when using rabbitmq?
In-Reply-To: <AANLkTinoUkUxjZzoRV6uNxRAEkvn-z1XkkZbz3R6KWut@mail.gmail.com>
References: <AANLkTinoUkUxjZzoRV6uNxRAEkvn-z1XkkZbz3R6KWut@mail.gmail.com>
Message-ID: <4CF82AFC.20208@rabbitmq.com>

Ben,

Ben Bennett wrote:
> Also I seen that direct exchange is O(N) when delivering messages, is
> N the number of possible queues.

Direct exchanges have near constant matching time.

Perhaps you were thinking of topic exchanges, which are indeed O(N) atm, 
though we are working on improving that.

> My current design for my system might have bunch of queues on one box
> but it also has 32GB of ram and 16 cores and it is active passive
> cluster node.
> I am trying to figure out if it is going to be problem. We basically
> have clients that are going over http and they will need reply back,
> but the reply is based on
> the client, so I was going to make queue for each client and have it
> expire after a while. There are a limit number of clients, less then
> 2000 unique clients.

That should all be fine. I created 300,000 queues on my desktop today. 
Took just over two minutes and rabbit grew to 2.9GB.


Regards,

Matthias.

From fullergalway at gmail.com  Fri Dec  3 12:03:48 2010
From: fullergalway at gmail.com (Robert Fuller)
Date: Fri, 3 Dec 2010 12:03:48 +0000
Subject: [rabbitmq-discuss] client connect problems
Message-ID: <AANLkTi=Kz3fjE2cQw1UyXKiKh5MDFRwZdTRheAs3739a@mail.gmail.com>

Hi,

I had an issue for several hours where clients from many hosts were
not able to connect to a running rabbitmq server (2.2.0). list_queues
showed only a small number of items in the queues. Eventually after
restarting rabbitmq server everything returned immediately to normal.

client stack seems to be sometimes this:
java.net.ConnectException: Connection timed out
	at java.net.PlainSocketImpl.socketConnect(Native Method)
	at java.net.PlainSocketImpl.doConnect(PlainSocketImpl.java:333)
	at java.net.PlainSocketImpl.connectToAddress(PlainSocketImpl.java:195)
	at java.net.PlainSocketImpl.connect(PlainSocketImpl.java:182)
	at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:366)
	at java.net.Socket.connect(Socket.java:529)
	at java.net.Socket.connect(Socket.java:478)
	at com.rabbitmq.client.ConnectionFactory.createFrameHandler(ConnectionFactory.java:338)
	at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:376)


and sometimes this:
java.io.IOException
	at com.rabbitmq.client.impl.AMQChannel.wrap(AMQChannel.java:121)
	at com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:274)
	at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:379)
	at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:399)
...
Caused by: com.rabbitmq.client.ShutdownSignalException: connection
error; reason: java.net.SocketException: Connection reset
	at com.rabbitmq.utility.ValueOrException.getValue(ValueOrException.java:81)
	at com.rabbitmq.utility.BlockingValueOrException.uninterruptibleGetValue(BlockingValueOrException.java:47)
	at com.rabbitmq.client.impl.AMQChannel$BlockingRpcContinuation.getReply(AMQChannel.java:342)
	at com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:258)
	... 39 more
Caused by: java.net.SocketException: Connection reset
	at java.net.SocketInputStream.read(SocketInputStream.java:168)
	at java.io.BufferedInputStream.fill(BufferedInputStream.java:218)
	at java.io.BufferedInputStream.read(BufferedInputStream.java:237)
	at java.io.DataInputStream.readUnsignedByte(DataInputStream.java:271)
	at com.rabbitmq.client.impl.Frame.readFrom(Frame.java:118)
	at com.rabbitmq.client.impl.SocketFrameHandler.readFrame(SocketFrameHandler.java:155)
	at com.rabbitmq.client.impl.AMQConnection.readFrame(AMQConnection.java:393)
	at com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:421)



I could see nothing unusual on the server using top (memory and cpu
usage ok), or in the rabbitmq logs.

What can I do to produce you a log on the server should this situation re-occur?

Thanks,
Rob.

From romary.kremer at gmail.com  Fri Dec  3 14:47:51 2010
From: romary.kremer at gmail.com (romary.kremer at gmail.com)
Date: Fri, 3 Dec 2010 15:47:51 +0100
Subject: [rabbitmq-discuss] Connection managment
Message-ID: <44BA27E0-4C4D-4093-85F9-4C1550311AAD@gmail.com>


Is there a way to configure within rabbitMQ the maximum number of  
authorized connections on a single-node server ?

Let say my message broker is sized to be operational with a number n  
of clients connected simultaneously. I would want
to ensure that not more than n connections can be opened on the server.

I could think of 2 ways to achieve this :

1?) Either there is  a customizable option to limit the number of  
connections the broker can accept ?

2?) Or, since every client has its own user/passwd, is their a way to  
limit the number of connection on a per-user basis ?

by allowing only one connection per user, and creating only the n well- 
known users allowed to connect, this solution would
be enough for our requirements.


Best regards.




From Sumit.Agarwal at ge.com  Fri Dec  3 17:56:32 2010
From: Sumit.Agarwal at ge.com (Agarwal, Sumit (GE Healthcare))
Date: Fri, 3 Dec 2010 12:56:32 -0500
Subject: [rabbitmq-discuss] SQL-92 style selector support
Message-ID: <C5504C24B97DD448ACB994A683F011F60CB7DB8B@ALPMLVEM15.e2k.ad.ge.com>

Hi,

I am just wondering if there is anything similar in RabbitMQ for Message
selector supported in JMS brokers.  I wanted the consumer to 

Provide the "selector" string and based on the message header properties
it will be delivered.

 

Also if AMQP 1.0  removal of exchanges affecting anything in RabbitMQ?

 

Thanks

Sumit

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101203/17446b7a/attachment.htm>

From jerryk at vmware.com  Fri Dec  3 18:11:27 2010
From: jerryk at vmware.com (Jerry Kuch)
Date: Fri, 3 Dec 2010 10:11:27 -0800
Subject: [rabbitmq-discuss] client connect problems
In-Reply-To: <AANLkTi=Kz3fjE2cQw1UyXKiKh5MDFRwZdTRheAs3739a@mail.gmail.com>
References: <AANLkTi=Kz3fjE2cQw1UyXKiKh5MDFRwZdTRheAs3739a@mail.gmail.com>
Message-ID: <DC070EC8-9ABD-4B08-9824-7E91ECD7D846@vmware.com>

Hi, Robert.

With a broker version this new, these things are often either a misbehaving client, or the broker running in an environment where there's a resource limit configuration problem, e.g. running out of file descriptors.

Here are a few things to investigate in such circumstances (derived from a support incident on an older Rabbit version, but most of this remains sensible stuff to check).

Please let us know how it goes.  If none of the above yield meaningful clues, would you feel comfortable sharing some snippets of your client code with which you're encountering the problem?

Jerry

==============

 Here's a quick laundry list of things to investigate when one
 encounters problems of this flavor.

 - check `ulimit -n` as whichever user is being used to run rabbit;
   depending on your system this may be the 'rabbitmq' user.  Be wary
   of raised limits not making it to the user/shell/process one
   wanted them to.  Again, newer Rabbits will announce at startup
   time what sort of file handle limits they think they're working under
   with a log message something like:

           =INFO REPORT==== 2-Dec-2010::14:37:38 ===
        Limiting to approx 156 file handles (138 sockets)
 
  This example is from my desktop machine where by default 'ulimit -n' 
  gives 256, a value that's likely rather too low for a broker that's going
  to be serving a lot of clients.

 - check the logs for memory alarms; severe memory pressure can cause
   Rabbit to start refusing connections.

 - check that Rabbit hasn't run out of sockets; to do this use
   `rabbitmqctl list_connections` and netstat to see if there are
   suspiciously large numbers of existing connections.  Client
   misbehavior may cause this on an otherwise healthy Rabbit.

 - check the rabbit-sasl.log and the main rabbit.log for any sign
   that the tcp listener/acceptor process has crashed or misbehaved.  
   Look for 'CRASH REPORT' entries in the logs and mentions of 
   'tcp_acceptor', 'cannot_accept' , "{error,emfile}" and similar.

 - is Rabbit spinning frantically?  Check 'top' and your preferred
   process monitoring tools to see if you have Rabbit beam.smp
   processes consuming large amounts of CPU while the problem is
   manifesting. [ In your current case it seems you've ruled this out 
   already]

 - generally scour rabbit.log and rabbit-sasl.log for suspicious errors.

 - use 'rabbitmqctl list_WHATEVER' for WHATEVERs including connections,
   channels, exchanges, queues, bindings, etc. to see if there are
   unexpectedly massive quantities of anything.  Also check your
   queues to see if any have absurd numbers of messages languishing
   in them, as this could indicate a misbehaving client application.

On Dec 3, 2010, at 4:03 AM, Robert Fuller wrote:

> Hi,
> 
> I had an issue for several hours where clients from many hosts were
> not able to connect to a running rabbitmq server (2.2.0). list_queues
> showed only a small number of items in the queues. Eventually after
> restarting rabbitmq server everything returned immediately to normal.
> 
> client stack seems to be sometimes this:
> java.net.ConnectException: Connection timed out
> 	at java.net.PlainSocketImpl.socketConnect(Native Method)
> 	at java.net.PlainSocketImpl.doConnect(PlainSocketImpl.java:333)
> 	at java.net.PlainSocketImpl.connectToAddress(PlainSocketImpl.java:195)
> 	at java.net.PlainSocketImpl.connect(PlainSocketImpl.java:182)
> 	at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:366)
> 	at java.net.Socket.connect(Socket.java:529)
> 	at java.net.Socket.connect(Socket.java:478)
> 	at com.rabbitmq.client.ConnectionFactory.createFrameHandler(ConnectionFactory.java:338)
> 	at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:376)
> 
> 
> and sometimes this:
> java.io.IOException
> 	at com.rabbitmq.client.impl.AMQChannel.wrap(AMQChannel.java:121)
> 	at com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:274)
> 	at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:379)
> 	at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:399)
> ...
> Caused by: com.rabbitmq.client.ShutdownSignalException: connection
> error; reason: java.net.SocketException: Connection reset
> 	at com.rabbitmq.utility.ValueOrException.getValue(ValueOrException.java:81)
> 	at com.rabbitmq.utility.BlockingValueOrException.uninterruptibleGetValue(BlockingValueOrException.java:47)
> 	at com.rabbitmq.client.impl.AMQChannel$BlockingRpcContinuation.getReply(AMQChannel.java:342)
> 	at com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:258)
> 	... 39 more
> Caused by: java.net.SocketException: Connection reset
> 	at java.net.SocketInputStream.read(SocketInputStream.java:168)
> 	at java.io.BufferedInputStream.fill(BufferedInputStream.java:218)
> 	at java.io.BufferedInputStream.read(BufferedInputStream.java:237)
> 	at java.io.DataInputStream.readUnsignedByte(DataInputStream.java:271)
> 	at com.rabbitmq.client.impl.Frame.readFrom(Frame.java:118)
> 	at com.rabbitmq.client.impl.SocketFrameHandler.readFrame(SocketFrameHandler.java:155)
> 	at com.rabbitmq.client.impl.AMQConnection.readFrame(AMQConnection.java:393)
> 	at com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:421)
> 
> 
> 
> I could see nothing unusual on the server using top (memory and cpu
> usage ok), or in the rabbitmq logs.
> 
> What can I do to produce you a log on the server should this situation re-occur?
> 
> Thanks,
> Rob.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From fullergalway at gmail.com  Fri Dec  3 18:25:38 2010
From: fullergalway at gmail.com (Robert Fuller)
Date: Fri, 3 Dec 2010 18:25:38 +0000
Subject: [rabbitmq-discuss] client connect problems
In-Reply-To: <DC070EC8-9ABD-4B08-9824-7E91ECD7D846@vmware.com>
References: <AANLkTi=Kz3fjE2cQw1UyXKiKh5MDFRwZdTRheAs3739a@mail.gmail.com>
	<DC070EC8-9ABD-4B08-9824-7E91ECD7D846@vmware.com>
Message-ID: <AANLkTimnT3jeBxEtEBeE1+coPr1AQAkqq6ahcm+GO4kV@mail.gmail.com>

Thanks Jerry,

I used `rabbitmqctl list_connections` to find 436 connections. Hmmn.
More than I expected.

I logged into one of the (hadoop map/reduce) servers, and I can see
that some processes for old hadoop task attempts are hanging around,
so yes it looks like i'm not playing nicely.

I'll look into it further on Monday.

Thanks,
Rob

On 3 December 2010 18:11, Jerry Kuch <jerryk at vmware.com> wrote:
> Hi, Robert.
>
> With a broker version this new, these things are often either a misbehaving client, or the broker running in an environment where there's a resource limit configuration problem, e.g. running out of file descriptors.
>
> Here are a few things to investigate in such circumstances (derived from a support incident on an older Rabbit version, but most of this remains sensible stuff to check).
>
> Please let us know how it goes. ?If none of the above yield meaningful clues, would you feel comfortable sharing some snippets of your client code with which you're encountering the problem?
>
> Jerry
>
> ==============
>
> ?Here's a quick laundry list of things to investigate when one
> ?encounters problems of this flavor.
>
> ?- check `ulimit -n` as whichever user is being used to run rabbit;
> ? depending on your system this may be the 'rabbitmq' user. ?Be wary
> ? of raised limits not making it to the user/shell/process one
> ? wanted them to. ?Again, newer Rabbits will announce at startup
> ? time what sort of file handle limits they think they're working under
> ? with a log message something like:
>
> ? ? ? ? ? =INFO REPORT==== 2-Dec-2010::14:37:38 ===
> ? ? ? ?Limiting to approx 156 file handles (138 sockets)
>
> ?This example is from my desktop machine where by default 'ulimit -n'
> ?gives 256, a value that's likely rather too low for a broker that's going
> ?to be serving a lot of clients.
>
> ?- check the logs for memory alarms; severe memory pressure can cause
> ? Rabbit to start refusing connections.
>
> ?- check that Rabbit hasn't run out of sockets; to do this use
> ? `rabbitmqctl list_connections` and netstat to see if there are
> ? suspiciously large numbers of existing connections. ?Client
> ? misbehavior may cause this on an otherwise healthy Rabbit.
>
> ?- check the rabbit-sasl.log and the main rabbit.log for any sign
> ? that the tcp listener/acceptor process has crashed or misbehaved.
> ? Look for 'CRASH REPORT' entries in the logs and mentions of
> ? 'tcp_acceptor', 'cannot_accept' , "{error,emfile}" and similar.
>
> ?- is Rabbit spinning frantically? ?Check 'top' and your preferred
> ? process monitoring tools to see if you have Rabbit beam.smp
> ? processes consuming large amounts of CPU while the problem is
> ? manifesting. [ In your current case it seems you've ruled this out
> ? already]
>
> ?- generally scour rabbit.log and rabbit-sasl.log for suspicious errors.
>
> ?- use 'rabbitmqctl list_WHATEVER' for WHATEVERs including connections,
> ? channels, exchanges, queues, bindings, etc. to see if there are
> ? unexpectedly massive quantities of anything. ?Also check your
> ? queues to see if any have absurd numbers of messages languishing
> ? in them, as this could indicate a misbehaving client application.
>
> On Dec 3, 2010, at 4:03 AM, Robert Fuller wrote:
>
>> Hi,
>>
>> I had an issue for several hours where clients from many hosts were
>> not able to connect to a running rabbitmq server (2.2.0). list_queues
>> showed only a small number of items in the queues. Eventually after
>> restarting rabbitmq server everything returned immediately to normal.
>>
>> client stack seems to be sometimes this:
>> java.net.ConnectException: Connection timed out
>> ? ? ? at java.net.PlainSocketImpl.socketConnect(Native Method)
>> ? ? ? at java.net.PlainSocketImpl.doConnect(PlainSocketImpl.java:333)
>> ? ? ? at java.net.PlainSocketImpl.connectToAddress(PlainSocketImpl.java:195)
>> ? ? ? at java.net.PlainSocketImpl.connect(PlainSocketImpl.java:182)
>> ? ? ? at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:366)
>> ? ? ? at java.net.Socket.connect(Socket.java:529)
>> ? ? ? at java.net.Socket.connect(Socket.java:478)
>> ? ? ? at com.rabbitmq.client.ConnectionFactory.createFrameHandler(ConnectionFactory.java:338)
>> ? ? ? at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:376)
>>
>>
>> and sometimes this:
>> java.io.IOException
>> ? ? ? at com.rabbitmq.client.impl.AMQChannel.wrap(AMQChannel.java:121)
>> ? ? ? at com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:274)
>> ? ? ? at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:379)
>> ? ? ? at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:399)
>> ...
>> Caused by: com.rabbitmq.client.ShutdownSignalException: connection
>> error; reason: java.net.SocketException: Connection reset
>> ? ? ? at com.rabbitmq.utility.ValueOrException.getValue(ValueOrException.java:81)
>> ? ? ? at com.rabbitmq.utility.BlockingValueOrException.uninterruptibleGetValue(BlockingValueOrException.java:47)
>> ? ? ? at com.rabbitmq.client.impl.AMQChannel$BlockingRpcContinuation.getReply(AMQChannel.java:342)
>> ? ? ? at com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:258)
>> ? ? ? ... 39 more
>> Caused by: java.net.SocketException: Connection reset
>> ? ? ? at java.net.SocketInputStream.read(SocketInputStream.java:168)
>> ? ? ? at java.io.BufferedInputStream.fill(BufferedInputStream.java:218)
>> ? ? ? at java.io.BufferedInputStream.read(BufferedInputStream.java:237)
>> ? ? ? at java.io.DataInputStream.readUnsignedByte(DataInputStream.java:271)
>> ? ? ? at com.rabbitmq.client.impl.Frame.readFrom(Frame.java:118)
>> ? ? ? at com.rabbitmq.client.impl.SocketFrameHandler.readFrame(SocketFrameHandler.java:155)
>> ? ? ? at com.rabbitmq.client.impl.AMQConnection.readFrame(AMQConnection.java:393)
>> ? ? ? at com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:421)
>>
>>
>>
>> I could see nothing unusual on the server using top (memory and cpu
>> usage ok), or in the rabbitmq logs.
>>
>> What can I do to produce you a log on the server should this situation re-occur?
>>
>> Thanks,
>> Rob.
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From alexis at rabbitmq.com  Fri Dec  3 18:33:01 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Fri, 3 Dec 2010 18:33:01 +0000
Subject: [rabbitmq-discuss] SQL-92 style selector support
In-Reply-To: <C5504C24B97DD448ACB994A683F011F60CB7DB8B@ALPMLVEM15.e2k.ad.ge.com>
References: <C5504C24B97DD448ACB994A683F011F60CB7DB8B@ALPMLVEM15.e2k.ad.ge.com>
Message-ID: <AANLkTimyyRKoaam2JQU5U+iNaU4KrcD8iHVvTB5HO9zt@mail.gmail.com>

Sumit

On Fri, Dec 3, 2010 at 5:56 PM, Agarwal, Sumit (GE Healthcare)
<Sumit.Agarwal at ge.com> wrote:
> Hi,
>
> I am just wondering if there is anything similar in RabbitMQ for Message
> selector supported in JMS brokers.? I wanted the consumer to
>
> Provide the ?selector? string and based on the message header properties it
> will be delivered.

It sounds like you might want to use the AMQP "headers exchange".
Have you looked at this?  RabbitMQ supports headers based routing
using this feature.



> Also if AMQP 1.0? removal of exchanges affecting anything in RabbitMQ?

No, it has not.  AMQP 1.0 describes a transport and does not impact
the routing model.

alexis




>
>
>
> Thanks
>
> Sumit
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From mbaffa at opus.com.br  Fri Dec  3 19:42:36 2010
From: mbaffa at opus.com.br (Marcus Vinitius Baffa)
Date: Fri, 3 Dec 2010 17:42:36 -0200
Subject: [rabbitmq-discuss] Best Practices for Async RPC
Message-ID: <5EFADC7B94CAF64BAB113AD9DE1ACD200939E068@srv-opus-02.opus.net>

Hi,

 

I am new to RabbitMQ and I have just downloaded it.  

 

I have a Flex/AIR application that have C# services and I would like to
use RabbitMQ to allow services and Flex client to communicate.  Flex
calls its services in an async manner. I intend to use as3-amqp to talk
to RabbitMQ.

 

The basic workflow would be, I suppose:

 

-          Flex adds a message to a queue that has an id of the service
and its parameters;

-          A .NET server would pick the message, execute the service and
return the response to Flex;

 

I have already developed a small client/server example but the caller is
synchronous, in Flex all must happen in a async way. 

 

I have read some articles and .NET documentation.  I would like to ask
you what could be the best practices to work with RabbitMQ in an
environment like that. 

 

Thanks in advance

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101203/48972e57/attachment.htm>

From jerryk at vmware.com  Fri Dec  3 19:59:18 2010
From: jerryk at vmware.com (Jerry Kuch)
Date: Fri, 3 Dec 2010 11:59:18 -0800
Subject: [rabbitmq-discuss] Best Practices for Async RPC
In-Reply-To: <5EFADC7B94CAF64BAB113AD9DE1ACD200939E068@srv-opus-02.opus.net>
References: <5EFADC7B94CAF64BAB113AD9DE1ACD200939E068@srv-opus-02.opus.net>
Message-ID: <F3587B78-A958-4C07-84AF-21BE31AB4065@vmware.com>

I confess that I am not a Flex sophisticate and have not worked with AMQP from it, but does the rough pattern of the following seem suitable for you:

http://hopper.squarespace.com/blog/2008/1/26/flex-amqp-client-technology-preview.html

i.e. the Flex client publishes to an exchange that routes to a queue that the .NET server application consumes from; the .NET server app then does its work and publishes its result to an exchange that routes to a queue that the Flex client consumes from?

On Dec 3, 2010, at 11:42 AM, Marcus Vinitius Baffa wrote:

Hi,

I am new to RabbitMQ and I have just downloaded it.

I have a Flex/AIR application that have C# services and I would like to use RabbitMQ to allow services and Flex client to communicate.  Flex calls its services in an async manner. I intend to use as3-amqp to talk to RabbitMQ.

The basic workflow would be, I suppose:

-          Flex adds a message to a queue that has an id of the service and its parameters;
-          A .NET server would pick the message, execute the service and return the response to Flex;

I have already developed a small client/server example but the caller is synchronous, in Flex all must happen in a async way.

I have read some articles and .NET documentation.  I would like to ask you what could be the best practices to work with RabbitMQ in an environment like that.

Thanks in advance

<ATT00001..txt>


From dmitry.mishin at gmail.com  Fri Dec  3 23:06:18 2010
From: dmitry.mishin at gmail.com (dmitry.mishin)
Date: Fri, 3 Dec 2010 15:06:18 -0800 (PST)
Subject: [rabbitmq-discuss] Retrieving the queue content with other clients
	waiting for messages
Message-ID: <75b5756f-d825-4a90-8490-d659837933e5@35g2000prb.googlegroups.com>

Hello all,

I'm trying to make an application sending jobs to the queue and
consumers getting jobs from it and processing them.

I also need a UI showing the status of each job: have it been only
submitted, is currently executing or finished.

Can I avoid storing this information outside the rabbitmq?

My idea is to have 3 queues: submited, executing and completed.

The application sends a job to submited queue. The workers wait for
new jobs to appear and move the job from submited to executing queue,
then after processing moves a job from executing to completed.

The worker will have to cycle through all the jobs in a queue and ack
the proper one. Also to get a status of a job, I could cycle for all
the jobs in Submited, Executing and Finished and remember where I
found the needed one.

The problem I'm having now is when there are consumers listening to a
new job, I can't connect another consumer to this queue and make a
basicRecover from it. It receives nothing.

Is there an easier way of doing it? Or do I have to use a database and
store the job state in it, updating when there are changes to the job
state?

Thank you

From vimal.george at logicmanse.com  Mon Dec  6 08:53:59 2010
From: vimal.george at logicmanse.com (Vimal George)
Date: Mon, 6 Dec 2010 14:23:59 +0530
Subject: [rabbitmq-discuss] PHP app needs amqp statistics for reporting
Message-ID: <AANLkTim2odLRO-1=RvoN04Pav8cYMkpDfXZ0vPev4Fux@mail.gmail.com>

My team is working on adapting a PHP cgi-based application for bills and
payments into a distributed application with a multiple frontend nodes and
single transaction processing backend.

What are the recipes available to log the maximum amount of information
flowing over the RabbitMQ server we are deploying?
Is there more than one way to do it? Application-level or broker-level?

The idea is to allow the 'Reporting module' to show some real-time
statistics as well from the queue.

-- 
Regards,
Vimal G George
Tech Team, Logicmanse.
-----------------------------------------
"May the /src be with you, always"
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101206/d56414f5/attachment.html>

From videlalvaro at gmail.com  Mon Dec  6 08:56:39 2010
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Mon, 6 Dec 2010 16:56:39 +0800
Subject: [rabbitmq-discuss] PHP app needs amqp statistics for reporting
In-Reply-To: <AANLkTim2odLRO-1=RvoN04Pav8cYMkpDfXZ0vPev4Fux@mail.gmail.com>
References: <AANLkTim2odLRO-1=RvoN04Pav8cYMkpDfXZ0vPev4Fux@mail.gmail.com>
Message-ID: <FFF1599F-EC1E-4F1D-8415-48E8B2BC06E6@gmail.com>

Hi Vimal,

Have you checked the RabbitMQ Management Plugin? It has a REST API, so you could query that from PHP.

Regards,

Alvaro

On Dec 6, 2010, at 4:53 PM, Vimal George wrote:

> My team is working on adapting a PHP cgi-based application for bills and payments into a distributed application with a multiple frontend nodes and single transaction processing backend.
> 
> What are the recipes available to log the maximum amount of information flowing over the RabbitMQ server we are deploying?
> Is there more than one way to do it? Application-level or broker-level?
> 
> The idea is to allow the 'Reporting module' to show some real-time statistics as well from the queue.
> 
> -- 
> Regards,
> Vimal G George
> Tech Team, Logicmanse.
> -----------------------------------------
> "May the /src be with you, always" 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From dopp at vlingo.com  Mon Dec  6 04:08:57 2010
From: dopp at vlingo.com (Daniel Oppenheimer)
Date: Sun, 5 Dec 2010 23:08:57 -0500
Subject: [rabbitmq-discuss] using a topic exchange to route to multiple
	queues
Message-ID: <DEC3729A6EA40F4D96BA28847EB7C17B023EB386@BE23.exg3.exghost.com>

Hi,

 

I am writing a java rabbitmq client.  And I am trying to write code that
will publish messages to topic exchanges such that they get delivered to
multiple queues.  Following is the code that I am using:

 

Channel channel = conn.createChannel();

channel.exchangeDeclare(my_exchange, "topic", true);

channel.queueDeclare(company.my_queue, true, false, false, null);

channel.queueBind(company.my_queue, my_exchange, "company.#" );

 

...

 

channel.basicPublish(my_exchange, "company.#", null, messageBodyBytes);

 

I would like this code to publish to all queues under company.  That is,
I would like it to publish to company.my_queue and
company.another_queue.  My understanding is that the wild card in the
routing key should route any message published to my_exchange to any
queue prefixed with company.  Is this correct?  If not, what is the
correct way to do what I am trying to accomplish?  Should there be a
wild card in the routing key in both the queueBind and basicPublish
method calls?

 

Thanks,

 

Dan

                                

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101205/5a5b7bdf/attachment.htm>

From fullergalway at gmail.com  Mon Dec  6 17:16:48 2010
From: fullergalway at gmail.com (Robert Fuller)
Date: Mon, 6 Dec 2010 17:16:48 +0000
Subject: [rabbitmq-discuss] what happened to my messages?
Message-ID: <AANLkTi=ptHjk=d76A1yF_W1eT0yp7+ziQ0UGdGU_hZLY@mail.gmail.com>

Hi, I have two questions today, (while still working on my connections issue...)

1. I have two queues named 'pipelines-normal' and 'pipelines-low',
into which I am publishing. On the consuming client side I am
consuming from both queues on different threads within the same java
runtime. I have sometimes noticed items I expected to see on
'pipelines-normal' appear in 'pipelines-low', in fact the item seems
to processed in both queues.  Am currently using sever 1.2.2 and java
client 1.2.1. I have a routing key of "publish".

I am anticipating maybe one of the following answers:
a. The naming of the queues bad, ie. is the dash '-' is causing problems?
b. Having two bound channels in single jvm to same server isn't
supported with java client 1.2.1?
c. It must be a problem with the way I'm publishing?
d. It must be a problem with the way I'm consuming?
e. It is a problem that I am using the same routing key while
publishing on both queues?

2. I was surprised to find my (durable,non-exclusive,not-autodelete)
queues empty after restart - the following commands were run in quick
sequence:
adminrobful at test:~$ sudo rabbitmqctl list_queues
[sudo] password for adminrobful:
Listing queues ...
pipelines-low	1486828
pipelines-normal	1486657
...done.
adminrobful at test:~$ sudo /etc/init.d/rabbitmq-server restart
Restarting rabbitmq-server: SUCCESS
rabbitmq-server.
adminrobful at test:~$ sudo rabbitmqctl list_queues
Listing queues ...
pipelines-low	0
pipelines-normal	0
...done.
adminrobful at test:~$ uname -a
Linux test 2.6.32-25-server #45-Ubuntu SMP Sat Oct 16 20:06:58 UTC
2010 x86_64 GNU/Linux


Thanks,
Rob.

From pdezwart at rubiconproject.com  Mon Dec  6 18:27:54 2010
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Mon, 06 Dec 2010 10:27:54 -0800
Subject: [rabbitmq-discuss] PHP app needs amqp statistics for reporting
In-Reply-To: <FFF1599F-EC1E-4F1D-8415-48E8B2BC06E6@gmail.com>
Message-ID: <C9226B2A.13DEE%pdezwart@rubiconproject.com>

Can this information also be queried via the C client library? If so, it
would also make sense to add this to the PECL extension.
Pieter


On 12/6/10 12:56 AM, "Alvaro Videla" <videlalvaro at gmail.com> wrote:

> Hi Vimal,
> 
> Have you checked the RabbitMQ Management Plugin? It has a REST API, so you
> could query that from PHP.
> 
> Regards,
> 
> Alvaro
> 
> On Dec 6, 2010, at 4:53 PM, Vimal George wrote:
> 
>> My team is working on adapting a PHP cgi-based application for bills and
>> payments into a distributed application with a multiple frontend nodes and
>> single transaction processing backend.
>> 
>> What are the recipes available to log the maximum amount of information
>> flowing over the RabbitMQ server we are deploying?
>> Is there more than one way to do it? Application-level or broker-level?
>> 
>> The idea is to allow the 'Reporting module' to show some real-time statistics
>> as well from the queue.
>> 
>> -- 
>> Regards,
>> Vimal G George
>> Tech Team, Logicmanse.
>> -----------------------------------------
>> "May the /src be with you, always"
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From jerryk at vmware.com  Mon Dec  6 18:33:48 2010
From: jerryk at vmware.com (Jerry Kuch)
Date: Mon, 6 Dec 2010 10:33:48 -0800
Subject: [rabbitmq-discuss] using a topic exchange to route to
	multiple	queues
In-Reply-To: <DEC3729A6EA40F4D96BA28847EB7C17B023EB386@BE23.exg3.exghost.com>
References: <DEC3729A6EA40F4D96BA28847EB7C17B023EB386@BE23.exg3.exghost.com>
Message-ID: <6EBF04E7-D88E-4651-AC63-95C3E32CCF6F@vmware.com>


On Dec 5, 2010, at 8:08 PM, Daniel Oppenheimer wrote:

Hi, Daniel...

I am writing a java rabbitmq client.  And I am trying to write code that will publish messages to topic exchanges such that they get delivered to multiple queues.  Following is the code that I am using:

Channel channel = conn.createChannel();
channel.exchangeDeclare(my_exchange, "topic", true);
channel.queueDeclare(company.my_queue, true, false, false, null);
channel.queueBind(company.my_queue, my_exchange, ?company.#? );

This binding would result in your queue receiving messages, for example, with routing keys "company.MSFT" and "company.VMW" and also "company".

channel.basicPublish(my_exchange, ?company.#?, null, messageBodyBytes);

I would like this code to publish to all queues under company.  That is, I would like it to publish to company.my_queue and company.another_queue.  My understanding is that the wild card in the routing key should route any message published to my_exchange to any queue prefixed with company.  Is this correct?  If not, what is the correct way to do what I am trying to accomplish?  Should there be a wild card in the routing key in both the queueBind and basicPublish method calls?

For topic exchanges, messages published to that exchange will be delivered to all queues whose binding pattern matches the routing key of the message.

You only need the wild card in the routing key for the queueBind.  Any subsequent basicPublish'es that occur with routing keys that match the pattern that you used to bind your queues to the exchange will then receive those messages.  Doing:

channel.basicPublish(my_exchange, ?company?, null, messageBodyBytes);

would suffice to hit all of the queues that you've attached to the exchange using your binding of the form:

channel.queueBind(company.my_queue, my_exchange, ?company.#? );

Here's a transcript of an interactive session done with the Erlang client (it should be fairly easy to pattern match what's going on against the Java equivalent even if Erlang's new to you), along with example invocations of rabbitmqctl (indented with the effects of interest highlighted) to see the effects of what we've done.

Eshell V5.8  (abort with ^G)

1> rr("include/amqp_client.hrl"). %% read headers for record types
['P_access', BLAHBLAHBLAH deleted]

2> {ok, Conn} = amqp_connection:start(network). %% start connection
{ok,<0.48.0>}
3> {ok, Chan} = amqp_connection:open_channel(Conn). %% open channel
{ok,<0.58.0>}

4> ED = #'exchange.declare'{exchange= <<"my_exchange">>,type= <<"topic">>}. %% declare topic exchange
#'exchange.declare'{ticket = 0,exchange = <<"my_exchange">>,
                    type = <<"topic">>,passive = false,durable = false,
                    auto_delete = false,internal = false,nowait = false,
                    arguments = []}
5> amqp_channel:call(Chan,ED).
#'exchange.declare_ok'{}

[jerryk at strongmad .../co/rabbitmq-umbrella/rabbitmq-server]$ ./scripts/rabbitmqctl list_exchanges
Listing exchanges ...
amq.direct
direct
amq.topic
topic
my_exchange
topic
amq.rabbitmq.log
topic
amq.fanout
fanout
amq.headers
headers
direct
amq.match
headers
...done.


6> QD1 = #'queue.declare'{queue = <<"queue_1">>}. %% One queue...
#'queue.declare'{ticket = 0,queue = <<"queue_1">>,
                 passive = false,durable = false,exclusive = false,
                 auto_delete = false,nowait = false,arguments = []}
7> QD2 = #'queue.declare'{queue = <<"queue_2">>}. %% Another queue...
#'queue.declare'{ticket = 0,queue = <<"queue_2">>,
                 passive = false,durable = false,exclusive = false,
                 auto_delete = false,nowait = false,arguments = []}
8> amqp_channel:call(Chan, QD1). %% Create first queue...
#'queue.declare_ok'{queue = <<"queue_1">>,message_count = 0,
                    consumer_count = 0}
9> amqp_channel:call(Chan, QD2). %% Create second queue...
#'queue.declare_ok'{queue = <<"queue_2">>,message_count = 0,
                    consumer_count = 0}

[jerryk at strongmad .../co/rabbitmq-umbrella/rabbitmq-server]$ ./scripts/rabbitmqctl list_queues
Listing queues ...
queue_2 0
queue_1 0
...done.


10> B1 = #'queue.bind'{queue= <<"queue_1">>, exchange = <<"my_exchange">>, routing_key = <<"company.#">>}. %% Bind first queue to exchange...
#'queue.bind'{ticket = 0,queue = <<"queue_1">>,
              exchange = <<"my_exchange">>,routing_key = <<"company.#">>,
              nowait = false,arguments = []}
11> B2 = #'queue.bind'{queue= <<"queue_2">>, exchange = <<"my_exchange">>, routing_key = <<"company.#">>}. %% Bind second queue to exchange...
#'queue.bind'{ticket = 0,queue = <<"queue_2">>,
              exchange = <<"my_exchange">>,routing_key = <<"company.#">>,
              nowait = false,arguments = []}
12> amqp_channel:call(Chan,B1). amqp_channel:call(Chan,B2).
#'queue.bind_ok'{}

[jerryk at strongmad .../co/rabbitmq-umbrella/rabbitmq-server]$ ./scripts/rabbitmqctl list_bindings
Listing bindings ...
exchange queue_1 queue queue_1 []
exchange queue_2 queue queue_2 []
my_exchange exchange queue_1 queue company.# []
my_exchange exchange queue_2 queue company.# []
...done.

[jerryk at strongmad .../co/rabbitmq-umbrella/rabbitmq-server]$ ./scripts/rabbitmqctl list_queuesListing queues ...
queue_2 0  <--  NOTE NO MESSAGES IN THESE QUEUES!
queue_1 0  <--/
...done.


14> Payload = <<"foobar">>. %% Bogus message payload
<<"foobar">>
15> Publish = #'basic.publish'{exchange = <<"my_exchange">>, routing_key = <<"company.MSFT">>}.
#'basic.publish'{ticket = 0,exchange = <<"my_exchange">>,
                 routing_key = <<"company.MSFT">>,mandatory = false,
                 immediate = false}
16> amqp_channel:cast(Chan, Publish, #amqp_msg{payload=Payload}). %% Publish to the exchange, should go to both bound queues...
ok

[jerryk at strongmad .../co/rabbitmq-umbrella/rabbitmq-server]$ ./scripts/rabbitmqctl list_queues
Listing queues ...
queue_2 1  <-- OUR MESSAGE ARRIVED...
queue_1 1  <-- ...IN BOTH QUEUES.
...done.


17> amqp_channel:cast(Chan, Publish, #amqp_msg{payload=Payload}). %% Publish to exchange again, should also go to both bound queues...
ok

[jerryk at strongmad .../co/rabbitmq-umbrella/rabbitmq-server]$ ./scripts/rabbitmqctl list_queuesListing queues ...
queue_2 2  <-- SECOND PUBLISHED MESSAGE ARRIVED...
queue_1 2  <-- ...ALSO IN BOTH QUEUES.
...done.

22> WPZ = #'basic.publish'{exchange = <<"my_exchange">>, routing_key = <<"company">>}.
#'basic.publish'{ticket = 0,exchange = <<"my_exchange">>,
                 routing_key = <<"company">>,mandatory = false,
                 immediate = false}
23> amqp_channel:cast(Chan, WPZ, #amqp_msg{payload = <<"Payload">>}).

[jerryk at strongmad .../co/rabbitmq-umbrella/rabbitmq-server]$ ./scripts/rabbitmqctl list_queuesListing queues ...
queue_2 3  <-- SECOND PUBLISHED MESSAGE ARRIVED...
queue_1 3  <-- ...ALSO IN BOTH QUEUES.
...done.



From clegnitto at mozilla.com  Mon Dec  6 19:50:34 2010
From: clegnitto at mozilla.com (Christian Legnitto)
Date: Mon, 6 Dec 2010 11:50:34 -0800
Subject: [rabbitmq-discuss] using a topic exchange to route to
	multiple	queues
In-Reply-To: <6EBF04E7-D88E-4651-AC63-95C3E32CCF6F@vmware.com>
References: <DEC3729A6EA40F4D96BA28847EB7C17B023EB386@BE23.exg3.exghost.com>
	<6EBF04E7-D88E-4651-AC63-95C3E32CCF6F@vmware.com>
Message-ID: <E4F8BE6E-D74F-40DC-AA74-1226ABCE9A3D@mozilla.com>

I think Daniel was asking if it is possible to create automatic bindings based on queue name. From my reading, it sounds like he wants all messages that match "company.#" to be routed to any queue which has a name that starts with "company." (feel free to correct me Daniel).

I don't think a mechanism like this exists (automatic binding rules) and like Jerry says you likely need to specify the bindings manually for each queue. I would be interested of learning about this functionality if it exists though.

Christian


On Dec 6, 2010, at 10:33 AM, Jerry Kuch wrote:

> 
> On Dec 5, 2010, at 8:08 PM, Daniel Oppenheimer wrote:
> 
> Hi, Daniel...
> 
> I am writing a java rabbitmq client.  And I am trying to write code that will publish messages to topic exchanges such that they get delivered to multiple queues.  Following is the code that I am using:
> 
> Channel channel = conn.createChannel();
> channel.exchangeDeclare(my_exchange, "topic", true);
> channel.queueDeclare(company.my_queue, true, false, false, null);
> channel.queueBind(company.my_queue, my_exchange, ?company.#? );
> 
> This binding would result in your queue receiving messages, for example, with routing keys "company.MSFT" and "company.VMW" and also "company".
> 
> channel.basicPublish(my_exchange, ?company.#?, null, messageBodyBytes);
> 
> I would like this code to publish to all queues under company.  That is, I would like it to publish to company.my_queue and company.another_queue.  My understanding is that the wild card in the routing key should route any message published to my_exchange to any queue prefixed with company.  Is this correct?  If not, what is the correct way to do what I am trying to accomplish?  Should there be a wild card in the routing key in both the queueBind and basicPublish method calls?
> 
> For topic exchanges, messages published to that exchange will be delivered to all queues whose binding pattern matches the routing key of the message.
> 
> You only need the wild card in the routing key for the queueBind.  Any subsequent basicPublish'es that occur with routing keys that match the pattern that you used to bind your queues to the exchange will then receive those messages.  Doing:
> 
> channel.basicPublish(my_exchange, ?company?, null, messageBodyBytes);
> 
> would suffice to hit all of the queues that you've attached to the exchange using your binding of the form:
> 
> channel.queueBind(company.my_queue, my_exchange, ?company.#? );
> 
> Here's a transcript of an interactive session done with the Erlang client (it should be fairly easy to pattern match what's going on against the Java equivalent even if Erlang's new to you), along with example invocations of rabbitmqctl (indented with the effects of interest highlighted) to see the effects of what we've done.
> 
> Eshell V5.8  (abort with ^G)
> 
> 1> rr("include/amqp_client.hrl"). %% read headers for record types
> ['P_access', BLAHBLAHBLAH deleted]
> 
> 2> {ok, Conn} = amqp_connection:start(network). %% start connection
> {ok,<0.48.0>}
> 3> {ok, Chan} = amqp_connection:open_channel(Conn). %% open channel
> {ok,<0.58.0>}
> 
> 4> ED = #'exchange.declare'{exchange= <<"my_exchange">>,type= <<"topic">>}. %% declare topic exchange
> #'exchange.declare'{ticket = 0,exchange = <<"my_exchange">>,
>                    type = <<"topic">>,passive = false,durable = false,
>                    auto_delete = false,internal = false,nowait = false,
>                    arguments = []}
> 5> amqp_channel:call(Chan,ED).
> #'exchange.declare_ok'{}
> 
> [jerryk at strongmad .../co/rabbitmq-umbrella/rabbitmq-server]$ ./scripts/rabbitmqctl list_exchanges
> Listing exchanges ...
> amq.direct
> direct
> amq.topic
> topic
> my_exchange
> topic
> amq.rabbitmq.log
> topic
> amq.fanout
> fanout
> amq.headers
> headers
> direct
> amq.match
> headers
> ...done.
> 
> 
> 6> QD1 = #'queue.declare'{queue = <<"queue_1">>}. %% One queue...
> #'queue.declare'{ticket = 0,queue = <<"queue_1">>,
>                 passive = false,durable = false,exclusive = false,
>                 auto_delete = false,nowait = false,arguments = []}
> 7> QD2 = #'queue.declare'{queue = <<"queue_2">>}. %% Another queue...
> #'queue.declare'{ticket = 0,queue = <<"queue_2">>,
>                 passive = false,durable = false,exclusive = false,
>                 auto_delete = false,nowait = false,arguments = []}
> 8> amqp_channel:call(Chan, QD1). %% Create first queue...
> #'queue.declare_ok'{queue = <<"queue_1">>,message_count = 0,
>                    consumer_count = 0}
> 9> amqp_channel:call(Chan, QD2). %% Create second queue...
> #'queue.declare_ok'{queue = <<"queue_2">>,message_count = 0,
>                    consumer_count = 0}
> 
> [jerryk at strongmad .../co/rabbitmq-umbrella/rabbitmq-server]$ ./scripts/rabbitmqctl list_queues
> Listing queues ...
> queue_2 0
> queue_1 0
> ...done.
> 
> 
> 10> B1 = #'queue.bind'{queue= <<"queue_1">>, exchange = <<"my_exchange">>, routing_key = <<"company.#">>}. %% Bind first queue to exchange...
> #'queue.bind'{ticket = 0,queue = <<"queue_1">>,
>              exchange = <<"my_exchange">>,routing_key = <<"company.#">>,
>              nowait = false,arguments = []}
> 11> B2 = #'queue.bind'{queue= <<"queue_2">>, exchange = <<"my_exchange">>, routing_key = <<"company.#">>}. %% Bind second queue to exchange...
> #'queue.bind'{ticket = 0,queue = <<"queue_2">>,
>              exchange = <<"my_exchange">>,routing_key = <<"company.#">>,
>              nowait = false,arguments = []}
> 12> amqp_channel:call(Chan,B1). amqp_channel:call(Chan,B2).
> #'queue.bind_ok'{}
> 
> [jerryk at strongmad .../co/rabbitmq-umbrella/rabbitmq-server]$ ./scripts/rabbitmqctl list_bindings
> Listing bindings ...
> exchange queue_1 queue queue_1 []
> exchange queue_2 queue queue_2 []
> my_exchange exchange queue_1 queue company.# []
> my_exchange exchange queue_2 queue company.# []
> ...done.
> 
> [jerryk at strongmad .../co/rabbitmq-umbrella/rabbitmq-server]$ ./scripts/rabbitmqctl list_queuesListing queues ...
> queue_2 0  <--  NOTE NO MESSAGES IN THESE QUEUES!
> queue_1 0  <--/
> ...done.
> 
> 
> 14> Payload = <<"foobar">>. %% Bogus message payload
> <<"foobar">>
> 15> Publish = #'basic.publish'{exchange = <<"my_exchange">>, routing_key = <<"company.MSFT">>}.
> #'basic.publish'{ticket = 0,exchange = <<"my_exchange">>,
>                 routing_key = <<"company.MSFT">>,mandatory = false,
>                 immediate = false}
> 16> amqp_channel:cast(Chan, Publish, #amqp_msg{payload=Payload}). %% Publish to the exchange, should go to both bound queues...
> ok
> 
> [jerryk at strongmad .../co/rabbitmq-umbrella/rabbitmq-server]$ ./scripts/rabbitmqctl list_queues
> Listing queues ...
> queue_2 1  <-- OUR MESSAGE ARRIVED...
> queue_1 1  <-- ...IN BOTH QUEUES.
> ...done.
> 
> 
> 17> amqp_channel:cast(Chan, Publish, #amqp_msg{payload=Payload}). %% Publish to exchange again, should also go to both bound queues...
> ok
> 
> [jerryk at strongmad .../co/rabbitmq-umbrella/rabbitmq-server]$ ./scripts/rabbitmqctl list_queuesListing queues ...
> queue_2 2  <-- SECOND PUBLISHED MESSAGE ARRIVED...
> queue_1 2  <-- ...ALSO IN BOTH QUEUES.
> ...done.
> 
> 22> WPZ = #'basic.publish'{exchange = <<"my_exchange">>, routing_key = <<"company">>}.
> #'basic.publish'{ticket = 0,exchange = <<"my_exchange">>,
>                 routing_key = <<"company">>,mandatory = false,
>                 immediate = false}
> 23> amqp_channel:cast(Chan, WPZ, #amqp_msg{payload = <<"Payload">>}).
> 
> [jerryk at strongmad .../co/rabbitmq-umbrella/rabbitmq-server]$ ./scripts/rabbitmqctl list_queuesListing queues ...
> queue_2 3  <-- SECOND PUBLISHED MESSAGE ARRIVED...
> queue_1 3  <-- ...ALSO IN BOTH QUEUES.
> ...done.
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From jdetreville at vmware.com  Mon Dec  6 20:37:10 2010
From: jdetreville at vmware.com (John DeTreville)
Date: Mon, 6 Dec 2010 12:37:10 -0800
Subject: [rabbitmq-discuss] Retrieving the queue content with other
 clients	waiting for messages
In-Reply-To: <75b5756f-d825-4a90-8490-d659837933e5@35g2000prb.googlegroups.com>
References: <75b5756f-d825-4a90-8490-d659837933e5@35g2000prb.googlegroups.com>
Message-ID: <99D6B832-5BF7-446E-978B-98D5A572BF36@vmware.com>

Dmitry,

Unfortunately, I believe that what you are trying to do is impossible.

A queue is a queue, and all a queue can do is receive messages and deliver messages. You cannot ask its current state.

I believe you cannot do what you ask without keeping extra state outside RabbitMQ.

(That said, I'm work in the RabbitMQ Pacific Rim office, and we sometimes get our answers wrong.)

Cheers,
John DeTreville
RabbitMQ Pacific Rim office

On Dec 3, 2010, at 3:06 PM, dmitry.mishin wrote:

> I'm trying to make an application sending jobs to the queue 
> and consumers getting jobs from it and processing them.

> I also need a UI showing the status of each job: have it been only
> submitted, is currently executing or finished.

> Can I avoid storing this information outside the rabbitmq?

> My idea is to have 3 queues: submited, executing and completed....


From fcp at wittykids.com  Mon Dec  6 20:47:40 2010
From: fcp at wittykids.com (Frank Paterra)
Date: Mon, 6 Dec 2010 12:47:40 -0800
Subject: [rabbitmq-discuss] Newbee questions
Message-ID: <AANLkTinAi-3b4G712QraKbrdNmO-N3qPtQQRAMYpPdnL@mail.gmail.com>

Rather than bother the list with details, can you point me to
information resources that will help me debug my installation?
Specifically I can connect and use RabbitMQ if my producer and
consumer are running on the same machine as the RabbitMQ server but I
cannot connect and access the server from a remote machine.

Thank you.

-- 
Frank Paterra
fcp at wittykids.com

From matthias at rabbitmq.com  Mon Dec  6 20:48:17 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 06 Dec 2010 20:48:17 +0000
Subject: [rabbitmq-discuss] using a topic exchange to route to	multiple
 queues
In-Reply-To: <E4F8BE6E-D74F-40DC-AA74-1226ABCE9A3D@mozilla.com>
References: <DEC3729A6EA40F4D96BA28847EB7C17B023EB386@BE23.exg3.exghost.com>	<6EBF04E7-D88E-4651-AC63-95C3E32CCF6F@vmware.com>
	<E4F8BE6E-D74F-40DC-AA74-1226ABCE9A3D@mozilla.com>
Message-ID: <4CFD4C11.9000804@rabbitmq.com>

On 06/12/10 19:50, Christian Legnitto wrote:
> I think Daniel was asking if it is possible to create automatic
> bindings based on queue name. From my reading, it sounds like he
> wants all messages that match "company.#" to be routed to any queue
> which has a name that starts with "company." (feel free to correct me
> Daniel).

Sure, but way to achieve the intended outcome is to publish with a 
routing key of "company" and bind the queues with binding keys
"company" and "company.MSFT".

One doesn't even need a topic exchange for that; a direct exchange will 
work just fine.

More generally, if we have some hierarchical naming scheme for queues 
and want to publish messages to any level in the hierarchy then we'd 
bind a queue named "K_0.K_1....K_N" with bindings "K_0", "K_0.K_1", 
...,"K_0.K_1....K_N".


Matthias.

From jerryk at vmware.com  Mon Dec  6 21:09:02 2010
From: jerryk at vmware.com (Jerry Kuch)
Date: Mon, 6 Dec 2010 13:09:02 -0800
Subject: [rabbitmq-discuss] Newbee questions
In-Reply-To: <AANLkTinAi-3b4G712QraKbrdNmO-N3qPtQQRAMYpPdnL@mail.gmail.com>
References: <AANLkTinAi-3b4G712QraKbrdNmO-N3qPtQQRAMYpPdnL@mail.gmail.com>
Message-ID: <D09230D2-4496-4A44-8E39-7A8D3C4EE43C@vmware.com>

Hi, Frank.

A couple of things to check first.  From your client machine:

Can you ping the machine where your rabbit broker is running?

ping name-of-server-host

If the Rabbit server is pingable, what happens if you try telnetting to Rabbit's port, i.e.

telnet name-of-server-host 5672

and banging out some nonsense on the keyboard?  You ought to see something like the following (here 'strongmad' is the machine running the Rabbit server, and 'bubs' is another host on the same network):

[jerryk at bubs ~]$ telnet strongmad.local 5672
Trying 192.168.3.133...
Connected to StrongMad.local.
Escape character is '^]'.
aksdjf
AMQP Connection closed by foreign host.

If you see this, then the server is alive, is listening on the expected default port, and is answering when clients connect.  If the connection is outright refused, then either Rabbit isn't present and listening at that port, or you may have a firewall standing in the way that needs to be configured to let your Rabbit traffic through.

If neither of those work, check that your server is really up, that you can actually establish connections from client to server machine, and that you don't have a firewall perhaps blocking connections to the port on which Rabbit wants to receive client connections.

If your setup passes the above tests, check to make sure that the host your client is trying to establish a connection to is really the one you want it to be and not something like a leftover hardcoded "localhost" or something from any earlier non-remote experiments you might have performed.

Let's see what we discover with these checks, and dig in further if solutions don't present themselves.

Jerry

On Dec 6, 2010, at 12:47 PM, Frank Paterra wrote:

Rather than bother the list with details, can you point me to
information resources that will help me debug my installation?
Specifically I can connect and use RabbitMQ if my producer and
consumer are running on the same machine as the RabbitMQ server but I
cannot connect and access the server from a remote machine.

Thank you.

--
Frank Paterra
fcp at wittykids.com<mailto:fcp at wittykids.com>
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From jdetreville at vmware.com  Tue Dec  7 00:39:24 2010
From: jdetreville at vmware.com (John DeTreville)
Date: Mon, 6 Dec 2010 16:39:24 -0800
Subject: [rabbitmq-discuss] using a topic exchange to route
	to	multiple	queues
In-Reply-To: <E4F8BE6E-D74F-40DC-AA74-1226ABCE9A3D@mozilla.com>
References: <DEC3729A6EA40F4D96BA28847EB7C17B023EB386@BE23.exg3.exghost.com>
	<6EBF04E7-D88E-4651-AC63-95C3E32CCF6F@vmware.com>
	<E4F8BE6E-D74F-40DC-AA74-1226ABCE9A3D@mozilla.com>
Message-ID: <EBD47A52-6A73-43A9-B128-FDE4BFA68C3A@vmware.com>

Also, to quote the FAQ:

> The routing key must be absolute whilst the binding key can contain
> a wildcard.

This might be an interesting extension, but it's not possible at this time.

Cheers,
John DeTreville
RabbitMQ Pacific Rim office

On Dec 6, 2010, at 11:50 AM, Christian Legnitto wrote:

> I think Daniel was asking if it is possible to create automatic bindings based on queue name. From my reading, it sounds like he wants all messages that match "company.#" to be routed to any queue which has a name that starts with "company." (feel free to correct me Daniel).
> 
> I don't think a mechanism like this exists (automatic binding rules) and like Jerry says you likely need to specify the bindings manually for each queue. I would be interested of learning about this functionality if it exists though.
> 
> Christian
> 
> 
> On Dec 6, 2010, at 10:33 AM, Jerry Kuch wrote:
> 
>> 
>> On Dec 5, 2010, at 8:08 PM, Daniel Oppenheimer wrote:
>> 
>> Hi, Daniel...
>> 
>> I am writing a java rabbitmq client.  And I am trying to write code that will publish messages to topic exchanges such that they get delivered to multiple queues.  Following is the code that I am using:
>> 
>> Channel channel = conn.createChannel();
>> channel.exchangeDeclare(my_exchange, "topic", true);
>> channel.queueDeclare(company.my_queue, true, false, false, null);
>> channel.queueBind(company.my_queue, my_exchange, ?company.#? );
>> 
>> This binding would result in your queue receiving messages, for example, with routing keys "company.MSFT" and "company.VMW" and also "company".
>> 
>> channel.basicPublish(my_exchange, ?company.#?, null, messageBodyBytes);
>> 
>> I would like this code to publish to all queues under company.  That is, I would like it to publish to company.my_queue and company.another_queue.  My understanding is that the wild card in the routing key should route any message published to my_exchange to any queue prefixed with company.  Is this correct?  If not, what is the correct way to do what I am trying to accomplish?  Should there be a wild card in the routing key in both the queueBind and basicPublish method calls?
>> 
>> For topic exchanges, messages published to that exchange will be delivered to all queues whose binding pattern matches the routing key of the message.
>> 
>> You only need the wild card in the routing key for the queueBind.  Any subsequent basicPublish'es that occur with routing keys that match the pattern that you used to bind your queues to the exchange will then receive those messages.  Doing:
>> 
>> channel.basicPublish(my_exchange, ?company?, null, messageBodyBytes);
>> 
>> would suffice to hit all of the queues that you've attached to the exchange using your binding of the form:
>> 
>> channel.queueBind(company.my_queue, my_exchange, ?company.#? );
>> 
>> Here's a transcript of an interactive session done with the Erlang client (it should be fairly easy to pattern match what's going on against the Java equivalent even if Erlang's new to you), along with example invocations of rabbitmqctl (indented with the effects of interest highlighted) to see the effects of what we've done.
>> 
>> Eshell V5.8  (abort with ^G)
>> 
>> 1> rr("include/amqp_client.hrl"). %% read headers for record types
>> ['P_access', BLAHBLAHBLAH deleted]
>> 
>> 2> {ok, Conn} = amqp_connection:start(network). %% start connection
>> {ok,<0.48.0>}
>> 3> {ok, Chan} = amqp_connection:open_channel(Conn). %% open channel
>> {ok,<0.58.0>}
>> 
>> 4> ED = #'exchange.declare'{exchange= <<"my_exchange">>,type= <<"topic">>}. %% declare topic exchange
>> #'exchange.declare'{ticket = 0,exchange = <<"my_exchange">>,
>>                   type = <<"topic">>,passive = false,durable = false,
>>                   auto_delete = false,internal = false,nowait = false,
>>                   arguments = []}
>> 5> amqp_channel:call(Chan,ED).
>> #'exchange.declare_ok'{}
>> 
>> [jerryk at strongmad .../co/rabbitmq-umbrella/rabbitmq-server]$ ./scripts/rabbitmqctl list_exchanges
>> Listing exchanges ...
>> amq.direct
>> direct
>> amq.topic
>> topic
>> my_exchange
>> topic
>> amq.rabbitmq.log
>> topic
>> amq.fanout
>> fanout
>> amq.headers
>> headers
>> direct
>> amq.match
>> headers
>> ...done.
>> 
>> 
>> 6> QD1 = #'queue.declare'{queue = <<"queue_1">>}. %% One queue...
>> #'queue.declare'{ticket = 0,queue = <<"queue_1">>,
>>                passive = false,durable = false,exclusive = false,
>>                auto_delete = false,nowait = false,arguments = []}
>> 7> QD2 = #'queue.declare'{queue = <<"queue_2">>}. %% Another queue...
>> #'queue.declare'{ticket = 0,queue = <<"queue_2">>,
>>                passive = false,durable = false,exclusive = false,
>>                auto_delete = false,nowait = false,arguments = []}
>> 8> amqp_channel:call(Chan, QD1). %% Create first queue...
>> #'queue.declare_ok'{queue = <<"queue_1">>,message_count = 0,
>>                   consumer_count = 0}
>> 9> amqp_channel:call(Chan, QD2). %% Create second queue...
>> #'queue.declare_ok'{queue = <<"queue_2">>,message_count = 0,
>>                   consumer_count = 0}
>> 
>> [jerryk at strongmad .../co/rabbitmq-umbrella/rabbitmq-server]$ ./scripts/rabbitmqctl list_queues
>> Listing queues ...
>> queue_2 0
>> queue_1 0
>> ...done.
>> 
>> 
>> 10> B1 = #'queue.bind'{queue= <<"queue_1">>, exchange = <<"my_exchange">>, routing_key = <<"company.#">>}. %% Bind first queue to exchange...
>> #'queue.bind'{ticket = 0,queue = <<"queue_1">>,
>>             exchange = <<"my_exchange">>,routing_key = <<"company.#">>,
>>             nowait = false,arguments = []}
>> 11> B2 = #'queue.bind'{queue= <<"queue_2">>, exchange = <<"my_exchange">>, routing_key = <<"company.#">>}. %% Bind second queue to exchange...
>> #'queue.bind'{ticket = 0,queue = <<"queue_2">>,
>>             exchange = <<"my_exchange">>,routing_key = <<"company.#">>,
>>             nowait = false,arguments = []}
>> 12> amqp_channel:call(Chan,B1). amqp_channel:call(Chan,B2).
>> #'queue.bind_ok'{}
>> 
>> [jerryk at strongmad .../co/rabbitmq-umbrella/rabbitmq-server]$ ./scripts/rabbitmqctl list_bindings
>> Listing bindings ...
>> exchange queue_1 queue queue_1 []
>> exchange queue_2 queue queue_2 []
>> my_exchange exchange queue_1 queue company.# []
>> my_exchange exchange queue_2 queue company.# []
>> ...done.
>> 
>> [jerryk at strongmad .../co/rabbitmq-umbrella/rabbitmq-server]$ ./scripts/rabbitmqctl list_queuesListing queues ...
>> queue_2 0  <--  NOTE NO MESSAGES IN THESE QUEUES!
>> queue_1 0  <--/
>> ...done.
>> 
>> 
>> 14> Payload = <<"foobar">>. %% Bogus message payload
>> <<"foobar">>
>> 15> Publish = #'basic.publish'{exchange = <<"my_exchange">>, routing_key = <<"company.MSFT">>}.
>> #'basic.publish'{ticket = 0,exchange = <<"my_exchange">>,
>>                routing_key = <<"company.MSFT">>,mandatory = false,
>>                immediate = false}
>> 16> amqp_channel:cast(Chan, Publish, #amqp_msg{payload=Payload}). %% Publish to the exchange, should go to both bound queues...
>> ok
>> 
>> [jerryk at strongmad .../co/rabbitmq-umbrella/rabbitmq-server]$ ./scripts/rabbitmqctl list_queues
>> Listing queues ...
>> queue_2 1  <-- OUR MESSAGE ARRIVED...
>> queue_1 1  <-- ...IN BOTH QUEUES.
>> ...done.
>> 
>> 
>> 17> amqp_channel:cast(Chan, Publish, #amqp_msg{payload=Payload}). %% Publish to exchange again, should also go to both bound queues...
>> ok
>> 
>> [jerryk at strongmad .../co/rabbitmq-umbrella/rabbitmq-server]$ ./scripts/rabbitmqctl list_queuesListing queues ...
>> queue_2 2  <-- SECOND PUBLISHED MESSAGE ARRIVED...
>> queue_1 2  <-- ...ALSO IN BOTH QUEUES.
>> ...done.
>> 
>> 22> WPZ = #'basic.publish'{exchange = <<"my_exchange">>, routing_key = <<"company">>}.
>> #'basic.publish'{ticket = 0,exchange = <<"my_exchange">>,
>>                routing_key = <<"company">>,mandatory = false,
>>                immediate = false}
>> 23> amqp_channel:cast(Chan, WPZ, #amqp_msg{payload = <<"Payload">>}).
>> 
>> [jerryk at strongmad .../co/rabbitmq-umbrella/rabbitmq-server]$ ./scripts/rabbitmqctl list_queuesListing queues ...
>> queue_2 3  <-- SECOND PUBLISHED MESSAGE ARRIVED...
>> queue_1 3  <-- ...ALSO IN BOTH QUEUES.
>> ...done.
>> 
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From jdetreville at vmware.com  Tue Dec  7 01:37:43 2010
From: jdetreville at vmware.com (John DeTreville)
Date: Mon, 6 Dec 2010 17:37:43 -0800
Subject: [rabbitmq-discuss] what happened to my messages?
In-Reply-To: <AANLkTi=ptHjk=d76A1yF_W1eT0yp7+ziQ0UGdGU_hZLY@mail.gmail.com>
References: <AANLkTi=ptHjk=d76A1yF_W1eT0yp7+ziQ0UGdGU_hZLY@mail.gmail.com>
Message-ID: <CE92CC6C-236F-4113-B665-793D5C3199F5@vmware.com>

Robert,

I don't understand this at all.

You have two queues, "pipeline-normal" and "pipeline-low." You publish messages to both with a routing key of "publish." Why wouldn't you expect all of your messages  to go to both queues?

I must be missing something.

Cheers,
John

On Dec 6, 2010, at 9:16 AM, Robert Fuller wrote:

> Hi, I have two questions today, (while still working on my connections issue...)
> 
> 1. I have two queues named 'pipelines-normal' and 'pipelines-low',
> into which I am publishing. On the consuming client side I am
> consuming from both queues on different threads within the same java
> runtime. I have sometimes noticed items I expected to see on
> 'pipelines-normal' appear in 'pipelines-low', in fact the item seems
> to processed in both queues.  Am currently using sever 1.2.2 and java
> client 1.2.1. I have a routing key of "publish".
> 
> I am anticipating maybe one of the following answers:
> a. The naming of the queues bad, ie. is the dash '-' is causing problems?
> b. Having two bound channels in single jvm to same server isn't
> supported with java client 1.2.1?
> c. It must be a problem with the way I'm publishing?
> d. It must be a problem with the way I'm consuming?
> e. It is a problem that I am using the same routing key while
> publishing on both queues?
> 
> 2. I was surprised to find my (durable,non-exclusive,not-autodelete)
> queues empty after restart - the following commands were run in quick
> sequence:
> adminrobful at test:~$ sudo rabbitmqctl list_queues
> [sudo] password for adminrobful:
> Listing queues ...
> pipelines-low	1486828
> pipelines-normal	1486657
> ...done.
> adminrobful at test:~$ sudo /etc/init.d/rabbitmq-server restart
> Restarting rabbitmq-server: SUCCESS
> rabbitmq-server.
> adminrobful at test:~$ sudo rabbitmqctl list_queues
> Listing queues ...
> pipelines-low	0
> pipelines-normal	0
> ...done.
> adminrobful at test:~$ uname -a
> Linux test 2.6.32-25-server #45-Ubuntu SMP Sat Oct 16 20:06:58 UTC
> 2010 x86_64 GNU/Linux
> 
> 
> Thanks,
> Rob.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From fullergalway at gmail.com  Tue Dec  7 06:57:00 2010
From: fullergalway at gmail.com (Robert Fuller)
Date: Tue, 7 Dec 2010 06:57:00 +0000
Subject: [rabbitmq-discuss] what happened to my messages?
In-Reply-To: <CE92CC6C-236F-4113-B665-793D5C3199F5@vmware.com>
References: <AANLkTi=ptHjk=d76A1yF_W1eT0yp7+ziQ0UGdGU_hZLY@mail.gmail.com>
	<CE92CC6C-236F-4113-B665-793D5C3199F5@vmware.com>
Message-ID: <AANLkTi=1w92ZOiK2J-jBzf3UpP=HMbOG9oAUzk6uF=BL@mail.gmail.com>

Hi John,

> I don't understand this at all.

Sorry, I wasn't clear.

> You have two queues, "pipeline-normal" and "pipeline-low." You publish messages to both with a routing key of "publish." Why wouldn't you expect all of your messages ?to go to both queues?

I don't expect the messages to go to both queues. The problem is this:
when consuming from the queues (two consumers in a single jvm), I see,
after a period of time, some messages apparently on the wrong queue.

I will try to replicate this in a unit test...

Rob.

From matthias at rabbitmq.com  Tue Dec  7 08:12:58 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 07 Dec 2010 08:12:58 +0000
Subject: [rabbitmq-discuss] what happened to my messages?
In-Reply-To: <AANLkTi=1w92ZOiK2J-jBzf3UpP=HMbOG9oAUzk6uF=BL@mail.gmail.com>
References: <AANLkTi=ptHjk=d76A1yF_W1eT0yp7+ziQ0UGdGU_hZLY@mail.gmail.com>	<CE92CC6C-236F-4113-B665-793D5C3199F5@vmware.com>
	<AANLkTi=1w92ZOiK2J-jBzf3UpP=HMbOG9oAUzk6uF=BL@mail.gmail.com>
Message-ID: <4CFDEC8A.10908@rabbitmq.com>

Robert,

Robert Fuller wrote:
> I don't expect the messages to go to both queues.

What John was pointing out is that if you publish all the messages with 
the same routing key "publish", then how would they *not* end up in both 
queues? Or, to put it another way, how are you addressing a message to a 
particular queue, given that's normally done via the routing key?

What exchange are you sending the messages to? What bindings have you 
got from the queues to that exchange? (check with 'rabbitmqctl 
list_bindings').

> 2. I was surprised to find my (durable,non-exclusive,not-autodelete)
> queues empty after restart 

See 
http://old.nabble.com/Re:-persistent-messages-can't-survive-restart-with-new-persister-b6324e288cfd-(bug21673)-p26745083.html


Regards,

Matthias.

From thomasbam at gmail.com  Tue Dec  7 10:29:51 2010
From: thomasbam at gmail.com (Bruno Thomas)
Date: Tue, 7 Dec 2010 11:29:51 +0100
Subject: [rabbitmq-discuss] loadbalancing & failover
Message-ID: <AANLkTikGpfLZRVTU_U8RJJBPeSiSsr6q7Z68P0ucXepT@mail.gmail.com>

Hello all,

We have a plateform that uses 2 rabbitmq nodes loadbalanced by a linux
LVS (ipvsadm) in front. We have ipvsadm configured with persistent
connections and clients with heartbeat. So far so good.

After deployment, we generally have half of the clients connected to
the first node and the other half connected to the second node.
We tried to stop one node (rabbitmqctl stop_app and start_app). The
clients are reconnecting rabbitmq cluster, and the LVS sends the
connections to the node up. So all the clients are connected to the
second node.

We have 2 questions :
1) when the first node is up, how do you manage to reconnect the
clients on the two nodes (loadbalancing) ?
2) is it a problem if all the clients are connected to one node ?

Thank you for your anwsers.

Bruno Thomas

From videlalvaro at gmail.com  Tue Dec  7 10:39:37 2010
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Tue, 7 Dec 2010 18:39:37 +0800
Subject: [rabbitmq-discuss] loadbalancing & failover
In-Reply-To: <AANLkTikGpfLZRVTU_U8RJJBPeSiSsr6q7Z68P0ucXepT@mail.gmail.com>
References: <AANLkTikGpfLZRVTU_U8RJJBPeSiSsr6q7Z68P0ucXepT@mail.gmail.com>
Message-ID: <DA5A3E6F-DDF1-416E-BDD4-DC8B6C0BFFEC@gmail.com>

Hi,

We run a similar setup. 

Regarding the question about all the clients connected to one broker: the problem here is that the queues on the other RabbitMQ won't be drained. 

We have our publishers connecting via the LVS but the consumers are told to specifically connect to one RabbbitMQ or the other to avoid such problem.

Regards,

Alvaro



On Dec 7, 2010, at 6:29 PM, Bruno Thomas wrote:

> Hello all,
> 
> We have a plateform that uses 2 rabbitmq nodes loadbalanced by a linux
> LVS (ipvsadm) in front. We have ipvsadm configured with persistent
> connections and clients with heartbeat. So far so good.
> 
> After deployment, we generally have half of the clients connected to
> the first node and the other half connected to the second node.
> We tried to stop one node (rabbitmqctl stop_app and start_app). The
> clients are reconnecting rabbitmq cluster, and the LVS sends the
> connections to the node up. So all the clients are connected to the
> second node.
> 
> We have 2 questions :
> 1) when the first node is up, how do you manage to reconnect the
> clients on the two nodes (loadbalancing) ?
> 2) is it a problem if all the clients are connected to one node ?
> 
> Thank you for your anwsers.
> 
> Bruno Thomas
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From fullergalway at gmail.com  Tue Dec  7 10:42:40 2010
From: fullergalway at gmail.com (Robert Fuller)
Date: Tue, 7 Dec 2010 10:42:40 +0000
Subject: [rabbitmq-discuss] what happened to my messages?
In-Reply-To: <4CFDEC8A.10908@rabbitmq.com>
References: <AANLkTi=ptHjk=d76A1yF_W1eT0yp7+ziQ0UGdGU_hZLY@mail.gmail.com>
	<CE92CC6C-236F-4113-B665-793D5C3199F5@vmware.com>
	<AANLkTi=1w92ZOiK2J-jBzf3UpP=HMbOG9oAUzk6uF=BL@mail.gmail.com>
	<4CFDEC8A.10908@rabbitmq.com>
Message-ID: <AANLkTi==Wh0DL6c=QLh5+wtxGz-OA8-D8X8VZcUODFWg@mail.gmail.com>

On 7 December 2010 08:12, Matthias Radestock <matthias at rabbitmq.com> wrote:
>> I don't expect the messages to go to both queues.
>
> What John was pointing out is that if you publish all the messages with the
> same routing key "publish", then how would they *not* end up in both queues?
> Or, to put it another way, how are you addressing a message to a particular
> queue, given that's normally done via the routing key?

OK, again it comes down to my misunderstanding and misuse. I had
mistakenly believed channel.queueBind(queueName, exchangeName,
routingKey) to be an operation which affected the behaviour of the
client only (I thought I was binding my communications channel
directly to a specific queue). The fog is beginning to lift.

>> 2. I was surprised to find my (durable,non-exclusive,not-autodelete)
>> queues empty after restart
>
> See
> http://old.nabble.com/Re:-persistent-messages-can't-survive-restart-with-new-persister-b6324e288cfd-(bug21673)-p26745083.html

Thanks.

From thomasbam at gmail.com  Tue Dec  7 11:11:15 2010
From: thomasbam at gmail.com (Bruno Thomas)
Date: Tue, 7 Dec 2010 12:11:15 +0100
Subject: [rabbitmq-discuss] loadbalancing & failover
In-Reply-To: <C4975338-3204-48B0-9C21-B7323F487CD4@gmail.com>
References: <AANLkTikGpfLZRVTU_U8RJJBPeSiSsr6q7Z68P0ucXepT@mail.gmail.com>
	<DA5A3E6F-DDF1-416E-BDD4-DC8B6C0BFFEC@gmail.com>
	<AANLkTimSKV1Q3yx9DWzctWYR4QEfqH8h_hWkzugEoE0U@mail.gmail.com>
	<C4975338-3204-48B0-9C21-B7323F487CD4@gmail.com>
Message-ID: <AANLkTi=8inXJ+9ZyvgV+DH8DjDNr+czSxBOx5V_z73Ue@mail.gmail.com>

2010/12/7 Alvaro Videla <videlalvaro at gmail.com>:
> We don't use RabbitMQ's clustering?
>
> With RabbitMQ's clustering you share the queue configuration not the queue data.

Sorry I did not mention that we have a cluster rabbitmq with the 2 nodes.

Maybe I miss somthing but what we have observed is that the datas are
shared. For example if we have 1 consumer connected to one node and
the clients on the other node, then the queue is drained.

Bruno

From videlalvaro at gmail.com  Tue Dec  7 11:14:41 2010
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Tue, 7 Dec 2010 19:14:41 +0800
Subject: [rabbitmq-discuss] loadbalancing & failover
In-Reply-To: <AANLkTi=8inXJ+9ZyvgV+DH8DjDNr+czSxBOx5V_z73Ue@mail.gmail.com>
References: <AANLkTikGpfLZRVTU_U8RJJBPeSiSsr6q7Z68P0ucXepT@mail.gmail.com>
	<DA5A3E6F-DDF1-416E-BDD4-DC8B6C0BFFEC@gmail.com>
	<AANLkTimSKV1Q3yx9DWzctWYR4QEfqH8h_hWkzugEoE0U@mail.gmail.com>
	<C4975338-3204-48B0-9C21-B7323F487CD4@gmail.com>
	<AANLkTi=8inXJ+9ZyvgV+DH8DjDNr+czSxBOx5V_z73Ue@mail.gmail.com>
Message-ID: <E2D94472-E9C6-4A54-8ED0-BC8BD4FAF3FF@gmail.com>

Yup, if your server is using the clustering offered by RabbitMQ, then that is the expected behavior.

On Dec 7, 2010, at 7:11 PM, Bruno Thomas wrote:

> 2010/12/7 Alvaro Videla <videlalvaro at gmail.com>:
>> We don't use RabbitMQ's clustering?
>> 
>> With RabbitMQ's clustering you share the queue configuration not the queue data.
> 
> Sorry I did not mention that we have a cluster rabbitmq with the 2 nodes.
> 
> Maybe I miss somthing but what we have observed is that the datas are
> shared. For example if we have 1 consumer connected to one node and
> the clients on the other node, then the queue is drained.
> 
> Bruno


From david.j.odonnell at hotmail.com  Tue Dec  7 11:18:10 2010
From: david.j.odonnell at hotmail.com (David ODonnell)
Date: Tue, 7 Dec 2010 11:18:10 +0000
Subject: [rabbitmq-discuss] RabbitMQ benchmarks
Message-ID: <DUB103-w38E42D0F6DD2AE636316F4DA2C0@phx.gbl>


Hi

While watching the presentation by Matthias Radestock at
http://www.infoq.com/presentations/Spring-AMQP
it was said the RabbitMQ can process 30K tps will < 1ms latency

Is it possible to get this benchmark code, the hardware spec that these tests were run against.

Looking to use RabbitMQ for point to point messaging, payloads approx 300/400 bytes at 10000/15000 tps. Latency is a key issue for us. 

Any help in providing some background around benchmark tests wouldbe very helpful.
Regards,
David
 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101207/77fa0f5e/attachment.htm>

From majek04 at gmail.com  Tue Dec  7 11:29:05 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Tue, 7 Dec 2010 11:29:05 +0000
Subject: [rabbitmq-discuss] RabbitMQ benchmarks
In-Reply-To: <DUB103-w38E42D0F6DD2AE636316F4DA2C0@phx.gbl>
References: <DUB103-w38E42D0F6DD2AE636316F4DA2C0@phx.gbl>
Message-ID: <AANLkTinEAUXrJJ10j9AmXXdcqMndbZ69jj5EFV5gui5X@mail.gmail.com>

Hi,


Download our java client, and run the MulticastMain tool.
Here's a simple example:

http://www.rabbitmq.com/ec2.html#testing

Options to MulticastMain aren't documented properly, but you should
be able to guess the meainig from the sources:
http://hg.rabbitmq.com/rabbitmq-java-client/file/8412c4f13875/test/src/com/rabbitmq/examples/MulticastMain.java#l78

For example, to emulate  10k msgs/sec with 4000bytes size, with auto-acks:
sh ./runjava.sh com.rabbitmq.examples.MulticastMain -a -s 4000 -r 10000

Cheers,
  Marek


On Tue, Dec 7, 2010 at 11:18, David ODonnell
<david.j.odonnell at hotmail.com> wrote:
> Hi
>
> While watching the presentation by Matthias Radestock at
> http://www.infoq.com/presentations/Spring-AMQP
> it was said the RabbitMQ can process 30K tps will < 1ms latency
>
> Is it possible to get this benchmark code, the hardware spec that these
> tests were run against.
>
> Looking to use RabbitMQ for point to point messaging, payloads approx
> 300/400 bytes at 10000/15000 tps. Latency is a key issue for us.
>
> Any help in providing some background around benchmark tests wouldbe very
> helpful.
> Regards,
> David
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From majek04 at gmail.com  Tue Dec  7 11:31:02 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Tue, 7 Dec 2010 11:31:02 +0000
Subject: [rabbitmq-discuss] RabbitMQ benchmarks
In-Reply-To: <AANLkTinEAUXrJJ10j9AmXXdcqMndbZ69jj5EFV5gui5X@mail.gmail.com>
References: <DUB103-w38E42D0F6DD2AE636316F4DA2C0@phx.gbl>
	<AANLkTinEAUXrJJ10j9AmXXdcqMndbZ69jj5EFV5gui5X@mail.gmail.com>
Message-ID: <AANLkTi=wgix=0Y3rHSqv4Ce6yKBGKBLY9uBq7RuLViFB@mail.gmail.com>

On Tue, Dec 7, 2010 at 11:29, Marek Majkowski <majek04 at gmail.com> wrote:
> Download our java client, and run the MulticastMain tool.
> Here's a simple example:
>
> http://www.rabbitmq.com/ec2.html#testing
>
> Options to MulticastMain aren't documented properly, but you should
> be able to guess the meainig from the sources:
> http://hg.rabbitmq.com/rabbitmq-java-client/file/8412c4f13875/test/src/com/rabbitmq/examples/MulticastMain.java#l78

Oh, wait. They are:
sh ./runjava.sh com.rabbitmq.examples.MulticastMain -help


> For example, to emulate ?10k msgs/sec with 4000bytes size, with auto-acks:
> sh ./runjava.sh com.rabbitmq.examples.MulticastMain -a -s 4000 -r 10000
>
> Cheers,
> ?Marek
>
>
> On Tue, Dec 7, 2010 at 11:18, David ODonnell
> <david.j.odonnell at hotmail.com> wrote:
>> Hi
>>
>> While watching the presentation by Matthias Radestock at
>> http://www.infoq.com/presentations/Spring-AMQP
>> it was said the RabbitMQ can process 30K tps will < 1ms latency
>>
>> Is it possible to get this benchmark code, the hardware spec that these
>> tests were run against.
>>
>> Looking to use RabbitMQ for point to point messaging, payloads approx
>> 300/400 bytes at 10000/15000 tps. Latency is a key issue for us.
>>
>> Any help in providing some background around benchmark tests wouldbe very
>> helpful.
>> Regards,
>> David
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>

From david.j.odonnell at hotmail.com  Tue Dec  7 11:53:32 2010
From: david.j.odonnell at hotmail.com (David ODonnell)
Date: Tue, 7 Dec 2010 11:53:32 +0000
Subject: [rabbitmq-discuss] (no subject)
Message-ID: <DUB103-w34A0155E01F99F91C15DF7DA2C0@phx.gbl>


Hi,
Thanks for the info.
Yeah ran that program previosly but was getting a minimum latency of 7ms.
Has anyone got latencies <1m and if so what was their h/w setup ?
Thanks
David 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101207/6eeabfb1/attachment.htm>

From majek04 at gmail.com  Tue Dec  7 11:57:29 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Tue, 7 Dec 2010 11:57:29 +0000
Subject: [rabbitmq-discuss] (no subject)
In-Reply-To: <DUB103-w34A0155E01F99F91C15DF7DA2C0@phx.gbl>
References: <DUB103-w34A0155E01F99F91C15DF7DA2C0@phx.gbl>
Message-ID: <AANLkTikTBw=xfsYKbd2FAhiV8_=_=X-KpTMSt9Wh-o2Y@mail.gmail.com>

Ubuntu 10.10,
cat /proc/cpuinfo
model name      : Intel(R) Xeon(R) CPU           E5520  @ 2.27GHz

$ sh ./runjava.sh com.rabbitmq.examples.MulticastMain -a -s 4000 -r 10000
recving rate: 10000 msg/s, min/avg/max latency: 214/858/6136 microseconds
sending rate: 10000 msg/s, basic returns: 0 ret/s
recving rate: 10000 msg/s, min/avg/max latency: 207/857/3961 microseconds
sending rate: 9995 msg/s, basic returns: 0 ret/s
recving rate: 9991 msg/s, min/avg/max latency: 182/955/5731 microseconds
sending rate: 10000 msg/s, basic returns: 0 ret/s

So, for localhost. Min: 0.2ms, avg: 0.8-0.9ms

On Tue, Dec 7, 2010 at 11:53, David ODonnell
<david.j.odonnell at hotmail.com> wrote:
> Hi,
> Thanks for the info.
> Yeah ran that program previosly but was getting a minimum latency of 7ms.
> Has anyone got latencies <1m and if so what was their h/w setup ?
> Thanks
> David
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From majek04 at gmail.com  Tue Dec  7 11:59:48 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Tue, 7 Dec 2010 11:59:48 +0000
Subject: [rabbitmq-discuss] (no subject)
In-Reply-To: <AANLkTikTBw=xfsYKbd2FAhiV8_=_=X-KpTMSt9Wh-o2Y@mail.gmail.com>
References: <DUB103-w34A0155E01F99F91C15DF7DA2C0@phx.gbl>
	<AANLkTikTBw=xfsYKbd2FAhiV8_=_=X-KpTMSt9Wh-o2Y@mail.gmail.com>
Message-ID: <AANLkTim+=rCMVsH9u9_rfHZnGHVKr2zfEg4k428OAa=n@mail.gmail.com>

Over the gigabit network:

$ ./runjava.sh com.rabbitmq.examples.MulticastMain -a -s 400 -r 15000
-h thehost
recving rate: 12918 msg/s, min/avg/max latency: 304/21486/66140 microseconds
sending rate: 15000 msg/s, basic returns: 0 ret/s
recving rate: 14990 msg/s, min/avg/max latency: 325/1140/2860 microseconds
sending rate: 14986 msg/s, basic returns: 0 ret/s
recving rate: 14997 msg/s, min/avg/max latency: 318/1237/9002 microseconds
sending rate: 15000 msg/s, basic returns: 0 ret/s
recving rate: 14992 msg/s, min/avg/max latency: 293/1337/10389 microseconds
sending rate: 15000 msg/s, basic returns: 0 ret/s
recving rate: 15002 msg/s, min/avg/max latency: 299/1327/5307 microseconds
sending rate: 15000 msg/s, basic returns: 0 ret/s
recving rate: 15007 msg/s, min/avg/max latency: 314/1193/3290 microseconds
sending rate: 15000 msg/s, basic returns: 0 ret/s

On Tue, Dec 7, 2010 at 11:57, Marek Majkowski <majek04 at gmail.com> wrote:
> Ubuntu 10.10,
> cat /proc/cpuinfo
> model name ? ? ?: Intel(R) Xeon(R) CPU ? ? ? ? ? E5520 ?@ 2.27GHz
>
> $ sh ./runjava.sh com.rabbitmq.examples.MulticastMain -a -s 4000 -r 10000
> recving rate: 10000 msg/s, min/avg/max latency: 214/858/6136 microseconds
> sending rate: 10000 msg/s, basic returns: 0 ret/s
> recving rate: 10000 msg/s, min/avg/max latency: 207/857/3961 microseconds
> sending rate: 9995 msg/s, basic returns: 0 ret/s
> recving rate: 9991 msg/s, min/avg/max latency: 182/955/5731 microseconds
> sending rate: 10000 msg/s, basic returns: 0 ret/s
>
> So, for localhost. Min: 0.2ms, avg: 0.8-0.9ms
>
> On Tue, Dec 7, 2010 at 11:53, David ODonnell
> <david.j.odonnell at hotmail.com> wrote:
>> Hi,
>> Thanks for the info.
>> Yeah ran that program previosly but was getting a minimum latency of 7ms.
>> Has anyone got latencies <1m and if so what was their h/w setup ?
>> Thanks
>> David
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>

From david.j.odonnell at hotmail.com  Tue Dec  7 12:08:40 2010
From: david.j.odonnell at hotmail.com (David ODonnell)
Date: Tue, 7 Dec 2010 12:08:40 +0000
Subject: [rabbitmq-discuss] (no subject)
In-Reply-To: <AANLkTikTBw=xfsYKbd2FAhiV8_=_=X-KpTMSt9Wh-o2Y@mail.gmail.com>
References: <DUB103-w34A0155E01F99F91C15DF7DA2C0@phx.gbl>,
	<AANLkTikTBw=xfsYKbd2FAhiV8_=_=X-KpTMSt9Wh-o2Y@mail.gmail.com>
Message-ID: <DUB103-w235EF3EAEB239BDE2BA0E7DA2C0@phx.gbl>


Thanks for that info
Regards
David

> Date: Tue, 7 Dec 2010 11:57:29 +0000
> Subject: Re: [rabbitmq-discuss] (no subject)
> From: majek04 at gmail.com
> To: david.j.odonnell at hotmail.com
> CC: rabbitmq-discuss at lists.rabbitmq.com
> 
> Ubuntu 10.10,
> cat /proc/cpuinfo
> model name      : Intel(R) Xeon(R) CPU           E5520  @ 2.27GHz
> 
> $ sh ./runjava.sh com.rabbitmq.examples.MulticastMain -a -s 4000 -r 10000
> recving rate: 10000 msg/s, min/avg/max latency: 214/858/6136 microseconds
> sending rate: 10000 msg/s, basic returns: 0 ret/s
> recving rate: 10000 msg/s, min/avg/max latency: 207/857/3961 microseconds
> sending rate: 9995 msg/s, basic returns: 0 ret/s
> recving rate: 9991 msg/s, min/avg/max latency: 182/955/5731 microseconds
> sending rate: 10000 msg/s, basic returns: 0 ret/s
> 
> So, for localhost. Min: 0.2ms, avg: 0.8-0.9ms
> 
> On Tue, Dec 7, 2010 at 11:53, David ODonnell
> <david.j.odonnell at hotmail.com> wrote:
> > Hi,
> > Thanks for the info.
> > Yeah ran that program previosly but was getting a minimum latency of 7ms.
> > Has anyone got latencies <1m and if so what was their h/w setup ?
> > Thanks
> > David
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101207/5421fc1e/attachment.htm>

From david at rabbitmq.com  Tue Dec  7 13:01:42 2010
From: david at rabbitmq.com (David Wragg)
Date: Tue, 07 Dec 2010 13:01:42 +0000
Subject: [rabbitmq-discuss] PHP app needs amqp statistics for reporting
In-Reply-To: <C9226B2A.13DEE%pdezwart@rubiconproject.com> (Pieter de Zwart's
	message of "Mon, 06 Dec 2010 10:27:54 -0800")
References: <C9226B2A.13DEE%pdezwart@rubiconproject.com>
Message-ID: <yrv4cei9tn3d5.fsf@dwragg.eng.vmware.com>

Hi Pieter,

Pieter de Zwart <pdezwart at rubiconproject.com> writes:
> Can this information also be queried via the C client library? If so, it
> would also make sense to add this to the PECL extension.

It's unlikely that we'll incorporate support for querying the management
plugin to the C client (or other client libraries).  But as the
management plugin exposes simple JSON- and HTTP-based APIs, it should
already be quite easy to access them from PHP.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From david.j.odonnell at hotmail.com  Tue Dec  7 13:55:51 2010
From: david.j.odonnell at hotmail.com (David ODonnell)
Date: Tue, 7 Dec 2010 13:55:51 +0000
Subject: [rabbitmq-discuss] (no subject)
In-Reply-To: <AANLkTim+=rCMVsH9u9_rfHZnGHVKr2zfEg4k428OAa=n@mail.gmail.com>
References: <DUB103-w34A0155E01F99F91C15DF7DA2C0@phx.gbl>,
	<AANLkTikTBw=xfsYKbd2FAhiV8_=_=X-KpTMSt9Wh-o2Y@mail.gmail.com>,
	<AANLkTim+=rCMVsH9u9_rfHZnGHVKr2zfEg4k428OAa=n@mail.gmail.com>
Message-ID: <DUB103-w17C3189AB6FFD9729A7E73DA2C0@phx.gbl>


Hi,
The average latency for RabbitMQ seems very high compared to the minimum. Are there any OS settings for Linux which could be set to improve those values?
Latency would be critical for the application I am working on
Regards
David


> Date: Tue, 7 Dec 2010 11:59:48 +0000
> Subject: Re: [rabbitmq-discuss] (no subject)
> From: majek04 at gmail.com
> To: david.j.odonnell at hotmail.com
> CC: rabbitmq-discuss at lists.rabbitmq.com
> 
> Over the gigabit network:
> 
> $ ./runjava.sh com.rabbitmq.examples.MulticastMain -a -s 400 -r 15000
> -h thehost
> recving rate: 12918 msg/s, min/avg/max latency: 304/21486/66140 microseconds
> sending rate: 15000 msg/s, basic returns: 0 ret/s
> recving rate: 14990 msg/s, min/avg/max latency: 325/1140/2860 microseconds
> sending rate: 14986 msg/s, basic returns: 0 ret/s
> recving rate: 14997 msg/s, min/avg/max latency: 318/1237/9002 microseconds
> sending rate: 15000 msg/s, basic returns: 0 ret/s
> recving rate: 14992 msg/s, min/avg/max latency: 293/1337/10389 microseconds
> sending rate: 15000 msg/s, basic returns: 0 ret/s
> recving rate: 15002 msg/s, min/avg/max latency: 299/1327/5307 microseconds
> sending rate: 15000 msg/s, basic returns: 0 ret/s
> recving rate: 15007 msg/s, min/avg/max latency: 314/1193/3290 microseconds
> sending rate: 15000 msg/s, basic returns: 0 ret/s
> 
> On Tue, Dec 7, 2010 at 11:57, Marek Majkowski <majek04 at gmail.com> wrote:
> > Ubuntu 10.10,
> > cat /proc/cpuinfo
> > model name      : Intel(R) Xeon(R) CPU           E5520  @ 2.27GHz
> >
> > $ sh ./runjava.sh com.rabbitmq.examples.MulticastMain -a -s 4000 -r 10000
> > recving rate: 10000 msg/s, min/avg/max latency: 214/858/6136 microseconds
> > sending rate: 10000 msg/s, basic returns: 0 ret/s
> > recving rate: 10000 msg/s, min/avg/max latency: 207/857/3961 microseconds
> > sending rate: 9995 msg/s, basic returns: 0 ret/s
> > recving rate: 9991 msg/s, min/avg/max latency: 182/955/5731 microseconds
> > sending rate: 10000 msg/s, basic returns: 0 ret/s
> >
> > So, for localhost. Min: 0.2ms, avg: 0.8-0.9ms
> >
> > On Tue, Dec 7, 2010 at 11:53, David ODonnell
> > <david.j.odonnell at hotmail.com> wrote:
> >> Hi,
> >> Thanks for the info.
> >> Yeah ran that program previosly but was getting a minimum latency of 7ms.
> >> Has anyone got latencies <1m and if so what was their h/w setup ?
> >> Thanks
> >> David
> >>
> >> _______________________________________________
> >> rabbitmq-discuss mailing list
> >> rabbitmq-discuss at lists.rabbitmq.com
> >> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >>
> >>
> >
 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101207/4411ac19/attachment.htm>

From majek04 at gmail.com  Tue Dec  7 15:07:07 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Tue, 7 Dec 2010 15:07:07 +0000
Subject: [rabbitmq-discuss] (no subject)
In-Reply-To: <DUB103-w17C3189AB6FFD9729A7E73DA2C0@phx.gbl>
References: <DUB103-w34A0155E01F99F91C15DF7DA2C0@phx.gbl>
	<AANLkTikTBw=xfsYKbd2FAhiV8_=_=X-KpTMSt9Wh-o2Y@mail.gmail.com>
	<AANLkTim+=rCMVsH9u9_rfHZnGHVKr2zfEg4k428OAa=n@mail.gmail.com>
	<DUB103-w17C3189AB6FFD9729A7E73DA2C0@phx.gbl>
Message-ID: <AANLkTi=dhe-SkvwN7vEKrdD7+XdR0fdNoeXugN0Y8wpe@mail.gmail.com>

On Tue, Dec 7, 2010 at 13:55, David ODonnell
<david.j.odonnell at hotmail.com> wrote:
> The average latency for RabbitMQ seems very high compared to the minimum.
> Are there any OS settings for Linux which could be set to improve those
> values?
> Latency would be critical for the application I am working on

Frankly speaking I have no idea. It might be JVM timing issues, it might
be bug in MulticastMain, or network latency. Or maybe even RabbitMQ latency.

We don't measure the latency in detail, as it's good enough
for the great majority of our users.

If you really really care about the latency, you should forget
the reliability - and that's not the use case for RabbitMQ.

Good example is 0MQ - you get really good latency,
but you get no reliability whatsoever.

Cheers,
  Marek


> Regards
> David
>
>
>> Date: Tue, 7 Dec 2010 11:59:48 +0000
>> Subject: Re: [rabbitmq-discuss] (no subject)
>> From: majek04 at gmail.com
>> To: david.j.odonnell at hotmail.com
>> CC: rabbitmq-discuss at lists.rabbitmq.com
>>
>> Over the gigabit network:
>>
>> $ ./runjava.sh com.rabbitmq.examples.MulticastMain -a -s 400 -r 15000
>> -h thehost
>> recving rate: 12918 msg/s, min/avg/max latency: 304/21486/66140
>> microseconds
>> sending rate: 15000 msg/s, basic returns: 0 ret/s
>> recving rate: 14990 msg/s, min/avg/max latency: 325/1140/2860 microseconds
>> sending rate: 14986 msg/s, basic returns: 0 ret/s
>> recving rate: 14997 msg/s, min/avg/max latency: 318/1237/9002 microseconds
>> sending rate: 15000 msg/s, basic returns: 0 ret/s
>> recving rate: 14992 msg/s, min/avg/max latency: 293/1337/10389
>> microseconds
>> sending rate: 15000 msg/s, basic returns: 0 ret/s
>> recving rate: 15002 msg/s, min/avg/max latency: 299/1327/5307 microseconds
>> sending rate: 15000 msg/s, basic returns: 0 ret/s
>> recving rate: 15007 msg/s, min/avg/max latency: 314/1193/3290 microseconds
>> sending rate: 15000 msg/s, basic returns: 0 ret/s
>>
>> On Tue, Dec 7, 2010 at 11:57, Marek Majkowski <majek04 at gmail.com> wrote:
>> > Ubuntu 10.10,
>> > cat /proc/cpuinfo
>> > model name ? ? ?: Intel(R) Xeon(R) CPU ? ? ? ? ? E5520 ?@ 2.27GHz
>> >
>> > $ sh ./runjava.sh com.rabbitmq.examples.MulticastMain -a -s 4000 -r
>> > 10000
>> > recving rate: 10000 msg/s, min/avg/max latency: 214/858/6136
>> > microseconds
>> > sending rate: 10000 msg/s, basic returns: 0 ret/s
>> > recving rate: 10000 msg/s, min/avg/max latency: 207/857/3961
>> > microseconds
>> > sending rate: 9995 msg/s, basic returns: 0 ret/s
>> > recving rate: 9991 msg/s, min/avg/max latency: 182/955/5731 microseconds
>> > sending rate: 10000 msg/s, basic returns: 0 ret/s
>> >
>> > So, for localhost. Min: 0.2ms, avg: 0.8-0.9ms
>> >
>> > On Tue, Dec 7, 2010 at 11:53, David ODonnell
>> > <david.j.odonnell at hotmail.com> wrote:
>> >> Hi,
>> >> Thanks for the info.
>> >> Yeah ran that program previosly but was getting a minimum latency of
>> >> 7ms.
>> >> Has anyone got latencies <1m and if so what was their h/w setup ?
>> >> Thanks
>> >> David
>> >>
>> >> _______________________________________________
>> >> rabbitmq-discuss mailing list
>> >> rabbitmq-discuss at lists.rabbitmq.com
>> >> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >>
>> >>
>> >
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From chrisch at ecollege.com  Tue Dec  7 17:11:25 2010
From: chrisch at ecollege.com (Chris Chew)
Date: Tue, 7 Dec 2010 17:11:25 +0000
Subject: [rabbitmq-discuss] (no subject)
In-Reply-To: <AANLkTi=dhe-SkvwN7vEKrdD7+XdR0fdNoeXugN0Y8wpe@mail.gmail.com>
References: <DUB103-w34A0155E01F99F91C15DF7DA2C0@phx.gbl>
	<AANLkTikTBw=xfsYKbd2FAhiV8_=_=X-KpTMSt9Wh-o2Y@mail.gmail.com>
	<AANLkTim+=rCMVsH9u9_rfHZnGHVKr2zfEg4k428OAa=n@mail.gmail.com>
	<DUB103-w17C3189AB6FFD9729A7E73DA2C0@phx.gbl>
	<AANLkTi=dhe-SkvwN7vEKrdD7+XdR0fdNoeXugN0Y8wpe@mail.gmail.com>
Message-ID: <DB266606-FC4D-4458-93D6-6664039857FC@ecollege.com>

Hi folks.

On Dec 7, 2010, at 8:07 AM, Marek Majkowski wrote:

> On Tue, Dec 7, 2010 at 13:55, David ODonnell
> <david.j.odonnell at hotmail.com> wrote:
>> The average latency for RabbitMQ seems very high compared to the minimum.
>> Are there any OS settings for Linux which could be set to improve those
>> values?
>> Latency would be critical for the application I am working on
> 
> Frankly speaking I have no idea. It might be JVM timing issues, it might
> be bug in MulticastMain, or network latency. Or maybe even RabbitMQ latency.
> 

More generally, I'm coming to realize that tuning the test client is one of the most important parts of performance testing and experimentation.

Along those lines I've found that using a combo of the "concurrent mark sweep" and the ergonomic "par new" collectors returned much more predictable results than using the VM defaults.

GC tuning seems to be a more like a black art than anything else.  But this article is what started me down the path:  http://java.sun.com/developer/technicalArticles/Programming/turbo/

Cheers,

Chris


From hedelson at vmware.com  Tue Dec  7 21:22:14 2010
From: hedelson at vmware.com (Helena (Holly) Edelson)
Date: Tue, 07 Dec 2010 14:22:14 -0700
Subject: [rabbitmq-discuss] Does anyone get a build error from GitHub java
	client repo?
Message-ID: <C923F396.1EE9%hedelson@vmware.com>

Hi,

I have a fork from the GitHub repo for the java client
https://github.com/rabbitmq/rabbitmq-java-client. I just updated my upstream
and attempted a build but it is having issues with the amqp_codegen module:

amqp-generate-check:
amqp-generate:
     [exec] Result: 1
BUILD FAILED
/rabbitmq-java-client/build.xml:55: Generation of AMQP.java failed with
message: Traceback (most recent call last):
File "codegen.py", line 39, in <module> from amqp_codegen import *
ImportError: No module named amqp_codegen

To lazily test my sanity and environment dependencies, I downloaded the
latest release client src which indeed builds.
Can anyone replicate a build error from github?

Cheers,
Helena

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101207/37050170/attachment.htm>

From justin at etheredge.us  Tue Dec  7 22:39:58 2010
From: justin at etheredge.us (Justin Etheredge)
Date: Tue, 7 Dec 2010 17:39:58 -0500
Subject: [rabbitmq-discuss] redelivered count
Message-ID: <AANLkTikURCvPhTOhoLpHoP_w7ygCrBO3fLywf70aoz9K@mail.gmail.com>

It would interesting and useful if there was some way to see a redelivered
count on a message. And as a little icing on the cake, it would be useful to
be able to specify how long before a message is redelivered. That way if I
specify that a message can be redelivered at most 10 times, it won't happen
in a thousandth of a second. Any thoughts on this?

Justin Etheredge
Company: http://www.ecstaticlabs.com
Blog: http://www.codethinked.com
Twitter: @JustinEtheredge
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101207/523737f2/attachment.htm>

From jasonjwwilliams at gmail.com  Tue Dec  7 22:46:10 2010
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Tue, 7 Dec 2010 15:46:10 -0700
Subject: [rabbitmq-discuss] redelivered count
In-Reply-To: <AANLkTikURCvPhTOhoLpHoP_w7ygCrBO3fLywf70aoz9K@mail.gmail.com>
References: <AANLkTikURCvPhTOhoLpHoP_w7ygCrBO3fLywf70aoz9K@mail.gmail.com>
Message-ID: <AANLkTi=PWU9cpjcZ6DrVj2XyTaTzyOrqyjxaHXCtR49Q@mail.gmail.com>

I'd like to see the new queue TTLs extended to handle this...specify a
message's lifetime by redeliver count instead of/in addition to age. I
think the redeliver count would still be useful information for a
consumer to know, but it seems to me the broker should be handling the
mechanics of expiration.

-J

On Tue, Dec 7, 2010 at 3:39 PM, Justin Etheredge <justin at etheredge.us> wrote:
> It would interesting and useful if there was some way to see a redelivered
> count on a message. And as a little icing on the cake, it would be useful to
> be able to specify how long before a message is redelivered. That way if I
> specify that a message can be redelivered at most 10 times, it won't happen
> in a thousandth of a second. Any thoughts on this?
> Justin Etheredge
> Company: http://www.ecstaticlabs.com
> Blog: http://www.codethinked.com
> Twitter: @JustinEtheredge
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From jerryk at vmware.com  Tue Dec  7 23:01:33 2010
From: jerryk at vmware.com (Jerry Kuch)
Date: Tue, 7 Dec 2010 15:01:33 -0800
Subject: [rabbitmq-discuss] Does anyone get a build error from GitHub
 java	client repo?
In-Reply-To: <C923F396.1EE9%hedelson@vmware.com>
References: <C923F396.1EE9%hedelson@vmware.com>
Message-ID: <F5590C6D-3AB5-4203-BEA4-04F3E1D4839E@vmware.com>

Hi, Holly...

In your checkout from GitHub, do you have the rqabbitmq-codegen directory as a sibling to your rabbitmq-java-client directory?  I typically check out from rabbitmq-umbrella in Mercurial to get all this stuff at once.  I haven't tried pulling from the GitHub mirror and checking whether rabbitmq-public-umbrella is there or not...

Jerry

On Dec 7, 2010, at 1:22 PM, Helena (Holly) Edelson wrote:

Hi,

I have a fork from the GitHub repo for the java client https://github.com/rabbitmq/rabbitmq-java-client. I just updated my upstream and attempted a build but it is having issues with the amqp_codegen module:

amqp-generate-check:
amqp-generate:
     [exec] Result: 1
BUILD FAILED
/rabbitmq-java-client/build.xml:55: Generation of AMQP.java failed with message: Traceback (most recent call last):
File "codegen.py", line 39, in <module> from amqp_codegen import *
ImportError: No module named amqp_codegen

To lazily test my sanity and environment dependencies, I downloaded the latest release client src which indeed builds.
Can anyone replicate a build error from github?

Cheers,
Helena
<ATT00001..txt>


From hedelson at vmware.com  Tue Dec  7 23:37:26 2010
From: hedelson at vmware.com (Helena (Holly) Edelson)
Date: Tue, 07 Dec 2010 16:37:26 -0700
Subject: [rabbitmq-discuss] Does anyone get a build error from GitHub
 java client repo?
In-Reply-To: <F5590C6D-3AB5-4203-BEA4-04F3E1D4839E@vmware.com>
Message-ID: <C9241346.1EFA%hedelson@vmware.com>

Thanks Jerry, I forgot to pull that from GitHub.

-Helena


On 12/7/10 4:01 PM, "Jerry Kuch" <jerryk at vmware.com> wrote:

> rqabbitmq-codegen

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101207/5ad35cd3/attachment.htm>

From matthias at rabbitmq.com  Tue Dec  7 23:40:18 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 07 Dec 2010 23:40:18 +0000
Subject: [rabbitmq-discuss] redelivered count
In-Reply-To: <AANLkTi=PWU9cpjcZ6DrVj2XyTaTzyOrqyjxaHXCtR49Q@mail.gmail.com>
References: <AANLkTikURCvPhTOhoLpHoP_w7ygCrBO3fLywf70aoz9K@mail.gmail.com>
	<AANLkTi=PWU9cpjcZ6DrVj2XyTaTzyOrqyjxaHXCtR49Q@mail.gmail.com>
Message-ID: <4CFEC5E2.4090205@rabbitmq.com>

Jason J. W. Williams wrote:
> I'd like to see the new queue TTLs extended to handle this...specify a
> message's lifetime by redeliver count instead of/in addition to age. I
> think the redeliver count would still be useful information for a
> consumer to know, but it seems to me the broker should be handling the
> mechanics of expiration.

Before we add yet more ways for messages to disappear from a queue, we 
want to introduce a means by which they can disappear to somewhere other 
than the ether. i.e. dead-letter exchanges. Which we will probably 
implement at some point.

Regards,

Matthias.

From jasonjwwilliams at gmail.com  Wed Dec  8 00:47:21 2010
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Tue, 7 Dec 2010 17:47:21 -0700
Subject: [rabbitmq-discuss] redelivered count
In-Reply-To: <4CFEC5E2.4090205@rabbitmq.com>
References: <AANLkTikURCvPhTOhoLpHoP_w7ygCrBO3fLywf70aoz9K@mail.gmail.com>
	<AANLkTi=PWU9cpjcZ6DrVj2XyTaTzyOrqyjxaHXCtR49Q@mail.gmail.com>
	<4CFEC5E2.4090205@rabbitmq.com>
Message-ID: <AANLkTimVV79Fb6-pWumOJCQ-JUVV-kqMD4o0Njf_HtDW@mail.gmail.com>

With basic.reject now being implemented, I'd definitely like to see
"dead letter" queues get a priority. Agree they fit well the TTLs.

-J

On Tue, Dec 7, 2010 at 4:40 PM, Matthias Radestock
<matthias at rabbitmq.com> wrote:
> Jason J. W. Williams wrote:
>>
>> I'd like to see the new queue TTLs extended to handle this...specify a
>> message's lifetime by redeliver count instead of/in addition to age. I
>> think the redeliver count would still be useful information for a
>> consumer to know, but it seems to me the broker should be handling the
>> mechanics of expiration.
>
> Before we add yet more ways for messages to disappear from a queue, we want
> to introduce a means by which they can disappear to somewhere other than the
> ether. i.e. dead-letter exchanges. Which we will probably implement at some
> point.
>
> Regards,
>
> Matthias.
>

From justin at etheredge.us  Wed Dec  8 01:12:52 2010
From: justin at etheredge.us (Justin Etheredge)
Date: Tue, 7 Dec 2010 20:12:52 -0500
Subject: [rabbitmq-discuss] redelivered count
In-Reply-To: <AANLkTimVV79Fb6-pWumOJCQ-JUVV-kqMD4o0Njf_HtDW@mail.gmail.com>
References: <AANLkTikURCvPhTOhoLpHoP_w7ygCrBO3fLywf70aoz9K@mail.gmail.com>
	<AANLkTi=PWU9cpjcZ6DrVj2XyTaTzyOrqyjxaHXCtR49Q@mail.gmail.com>
	<4CFEC5E2.4090205@rabbitmq.com>
	<AANLkTimVV79Fb6-pWumOJCQ-JUVV-kqMD4o0Njf_HtDW@mail.gmail.com>
Message-ID: <AANLkTi=LhuiDWqLxFTfmZ=jnDUyJjpp_Puom9B_q4tWe@mail.gmail.com>

Agreed that dead letter queues are a big deal. Which is why expiration on
messages doesn't do me much good right now, unless I am missing something. I
can't have a message expire and just disappear, I need to be able to respond
to it.

Justin Etheredge
Company: http://www.ecstaticlabs.com
Blog: http://www.codethinked.com
Twitter: @JustinEtheredge



On Tue, Dec 7, 2010 at 7:47 PM, Jason J. W. Williams <
jasonjwwilliams at gmail.com> wrote:

> With basic.reject now being implemented, I'd definitely like to see
> "dead letter" queues get a priority. Agree they fit well the TTLs.
>
> -J
>
> On Tue, Dec 7, 2010 at 4:40 PM, Matthias Radestock
> <matthias at rabbitmq.com> wrote:
> > Jason J. W. Williams wrote:
> >>
> >> I'd like to see the new queue TTLs extended to handle this...specify a
> >> message's lifetime by redeliver count instead of/in addition to age. I
> >> think the redeliver count would still be useful information for a
> >> consumer to know, but it seems to me the broker should be handling the
> >> mechanics of expiration.
> >
> > Before we add yet more ways for messages to disappear from a queue, we
> want
> > to introduce a means by which they can disappear to somewhere other than
> the
> > ether. i.e. dead-letter exchanges. Which we will probably implement at
> some
> > point.
> >
> > Regards,
> >
> > Matthias.
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101207/2a784422/attachment.htm>

From jdetreville at vmware.com  Wed Dec  8 01:15:44 2010
From: jdetreville at vmware.com (John DeTreville)
Date: Tue, 7 Dec 2010 17:15:44 -0800
Subject: [rabbitmq-discuss] redelivered count
In-Reply-To: <AANLkTikURCvPhTOhoLpHoP_w7ygCrBO3fLywf70aoz9K@mail.gmail.com>
References: <AANLkTikURCvPhTOhoLpHoP_w7ygCrBO3fLywf70aoz9K@mail.gmail.com>
Message-ID: <8AF06B5F-FB1C-4111-A23A-92D9FE8B625C@vmware.com>

I'm a little confused. Would messages be reordered? Is the idea to move from message queues to something else?

Cheers,
John

On Dec 7, 2010, at 2:39 PM, Justin Etheredge wrote:

> It would interesting and useful if there was some way to see a redelivered count on a message. And as a little icing on the cake, it would be useful to be able to specify how long before a message is redelivered. That way if I specify that a message can be redelivered at most 10 times, it won't happen in a thousandth of a second. Any thoughts on this?

From jasonjwwilliams at gmail.com  Wed Dec  8 02:05:17 2010
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Tue, 7 Dec 2010 19:05:17 -0700
Subject: [rabbitmq-discuss] redelivered count
In-Reply-To: <8AF06B5F-FB1C-4111-A23A-92D9FE8B625C@vmware.com>
References: <AANLkTikURCvPhTOhoLpHoP_w7ygCrBO3fLywf70aoz9K@mail.gmail.com>
	<8AF06B5F-FB1C-4111-A23A-92D9FE8B625C@vmware.com>
Message-ID: <AANLkTikbxTD2RDyJc+FjjsLgrecTmPJCypkaJ0RU5TdQ@mail.gmail.com>

Hey John,

I think the intent is to keep a message that's crashing a consumer
from being endlessly retried.

-J

On Tue, Dec 7, 2010 at 6:15 PM, John DeTreville <jdetreville at vmware.com> wrote:
> I'm a little confused. Would messages be reordered? Is the idea to move from message queues to something else?
>
> Cheers,
> John
>
> On Dec 7, 2010, at 2:39 PM, Justin Etheredge wrote:
>
>> It would interesting and useful if there was some way to see a redelivered count on a message. And as a little icing on the cake, it would be useful to be able to specify how long before a message is redelivered. That way if I specify that a message can be redelivered at most 10 times, it won't happen in a thousandth of a second. Any thoughts on this?
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From justin at etheredge.us  Wed Dec  8 15:03:26 2010
From: justin at etheredge.us (Justin Etheredge)
Date: Wed, 8 Dec 2010 10:03:26 -0500
Subject: [rabbitmq-discuss] redelivered count
In-Reply-To: <AANLkTikbxTD2RDyJc+FjjsLgrecTmPJCypkaJ0RU5TdQ@mail.gmail.com>
References: <AANLkTikURCvPhTOhoLpHoP_w7ygCrBO3fLywf70aoz9K@mail.gmail.com>
	<8AF06B5F-FB1C-4111-A23A-92D9FE8B625C@vmware.com>
	<AANLkTikbxTD2RDyJc+FjjsLgrecTmPJCypkaJ0RU5TdQ@mail.gmail.com>
Message-ID: <AANLkTimMFOUrT=JyKO4tksSmAXQxktYNjoL7=d=Zje1y@mail.gmail.com>

Exactly. So we have messages which are about performing a particular action.
If the action is malformed, then it would just keep failing and retrying
forever. But there are valid instances where the message could fail, and it
is because of a temporary issue. Like a web service being down or something.
However, if a message is failing due to something bad in it, we can't just
have it disappear into the ether, we need to know what the issue is and fix
it.

Justin

On Tue, Dec 7, 2010 at 9:05 PM, Jason J. W. Williams <
jasonjwwilliams at gmail.com> wrote:

> Hey John,
>
> I think the intent is to keep a message that's crashing a consumer
> from being endlessly retried.
>
> -J
>
> On Tue, Dec 7, 2010 at 6:15 PM, John DeTreville <jdetreville at vmware.com>
> wrote:
> > I'm a little confused. Would messages be reordered? Is the idea to move
> from message queues to something else?
> >
> > Cheers,
> > John
> >
> > On Dec 7, 2010, at 2:39 PM, Justin Etheredge wrote:
> >
> >> It would interesting and useful if there was some way to see a
> redelivered count on a message. And as a little icing on the cake, it would
> be useful to be able to specify how long before a message is redelivered.
> That way if I specify that a message can be redelivered at most 10 times, it
> won't happen in a thousandth of a second. Any thoughts on this?
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101208/931f5c08/attachment.htm>

From natester at gmail.com  Wed Dec  8 18:03:04 2010
From: natester at gmail.com (Nathaniel Haggard)
Date: Wed, 8 Dec 2010 11:03:04 -0700
Subject: [rabbitmq-discuss] ssl certificate to client lookup
In-Reply-To: <20100625130314.GW14541@rabbitmq.com>
References: <AANLkTimK1NSUevhDMV-62gTSgjKXrl4hMTJNzkkcRIpI@mail.gmail.com>
	<20100625130314.GW14541@rabbitmq.com>
Message-ID: <AANLkTinS44Y9g3vf+ZQYa8Cy5QOCtzPEXvryNb=vVdyH@mail.gmail.com>

>
>> Also, why not make rabbitmqctl show ssl info for each connection.
>
> That's a good idea. I'll file a bug for that.
>
> Matthew

Has showing ssl info for each connection been implemented yet?  If not
is there a patch I could test?

Nate

> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From matthias at rabbitmq.com  Wed Dec  8 18:10:39 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 08 Dec 2010 18:10:39 +0000
Subject: [rabbitmq-discuss] ssl certificate to client lookup
In-Reply-To: <AANLkTinS44Y9g3vf+ZQYa8Cy5QOCtzPEXvryNb=vVdyH@mail.gmail.com>
References: <AANLkTimK1NSUevhDMV-62gTSgjKXrl4hMTJNzkkcRIpI@mail.gmail.com>	<20100625130314.GW14541@rabbitmq.com>
	<AANLkTinS44Y9g3vf+ZQYa8Cy5QOCtzPEXvryNb=vVdyH@mail.gmail.com>
Message-ID: <4CFFCA1F.5000508@rabbitmq.com>

Nate,

On 08/12/10 18:03, Nathaniel Haggard wrote:
 > Has showing ssl info for each connection been implemented yet?

Yes, since RabbitMQ 2.1.1.

 From the release notes 
(http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101019/b2a394f3/attachment.txt):

" - add SSL information for 'rabbitmqctl list_connections'"

And from the docs (http://www.rabbitmq.com/man/rabbitmqctl.1.man.html):

"list_connections
...
  ssl
  peer_cert_subject
  peer_cert_issuer
  peer_cert_validity
...
"

Regards,

Matthias.

From simon at rabbitmq.com  Wed Dec  8 18:11:14 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 08 Dec 2010 18:11:14 +0000
Subject: [rabbitmq-discuss] ssl certificate to client lookup
In-Reply-To: <AANLkTinS44Y9g3vf+ZQYa8Cy5QOCtzPEXvryNb=vVdyH@mail.gmail.com>
References: <AANLkTimK1NSUevhDMV-62gTSgjKXrl4hMTJNzkkcRIpI@mail.gmail.com>	<20100625130314.GW14541@rabbitmq.com>
	<AANLkTinS44Y9g3vf+ZQYa8Cy5QOCtzPEXvryNb=vVdyH@mail.gmail.com>
Message-ID: <4CFFCA42.9030803@rabbitmq.com>

On 08/12/2010 6:03PM, Nathaniel Haggard wrote:
> Has showing ssl info for each connection been implemented yet?  If not
> is there a patch I could test?

RabbitMQ 2.1.1 added the subject and issuer of the client certificate 
(if there is one) as well as its validity period to the info items 
available in rabbitmqctl.

bug23578 (not yet QAed) adds SSL protocol version / algorithm 
information to that.

Also, bug23467 (not yet QAed) allows your clients to use the SASL 
EXTERNAL mechanism to log in using a client certificate, which may be 
interesting to you.

Cheers, Simon

From jdetreville at vmware.com  Wed Dec  8 18:56:10 2010
From: jdetreville at vmware.com (John DeTreville)
Date: Wed, 8 Dec 2010 10:56:10 -0800
Subject: [rabbitmq-discuss] redelivered count
In-Reply-To: <AANLkTikbxTD2RDyJc+FjjsLgrecTmPJCypkaJ0RU5TdQ@mail.gmail.com>
References: <AANLkTikURCvPhTOhoLpHoP_w7ygCrBO3fLywf70aoz9K@mail.gmail.com>
	<8AF06B5F-FB1C-4111-A23A-92D9FE8B625C@vmware.com>
	<AANLkTikbxTD2RDyJc+FjjsLgrecTmPJCypkaJ0RU5TdQ@mail.gmail.com>
Message-ID: <B1E95C0F-54AC-44B4-B695-05BA63934A88@vmware.com>

Well, I understand that part.

But if suspected bad messages are to be delayed for a while, am I right to imagine that other messages would not be delayed? That is, messages would be reordered?

Cheers,
John

On Dec 7, 2010, at 6:05 PM, Jason J. W. Williams wrote:

> Hey John,
> 
> I think the intent is to keep a message that's crashing a consumer
> from being endlessly retried.
> 
> -J
> 
> On Tue, Dec 7, 2010 at 6:15 PM, John DeTreville <jdetreville at vmware.com> wrote:
>> I'm a little confused. Would messages be reordered? Is the idea to move from message queues to something else?
>> 
>> Cheers,
>> John
>> 
>> On Dec 7, 2010, at 2:39 PM, Justin Etheredge wrote:
>> 
>>> It would interesting and useful if there was some way to see a redelivered count on a message. And as a little icing on the cake, it would be useful to be able to specify how long before a message is redelivered. That way if I specify that a message can be redelivered at most 10 times, it won't happen in a thousandth of a second. Any thoughts on this?
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 


From jasonjwwilliams at gmail.com  Wed Dec  8 18:58:16 2010
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Wed, 8 Dec 2010 11:58:16 -0700
Subject: [rabbitmq-discuss] redelivered count
In-Reply-To: <B1E95C0F-54AC-44B4-B695-05BA63934A88@vmware.com>
References: <AANLkTikURCvPhTOhoLpHoP_w7ygCrBO3fLywf70aoz9K@mail.gmail.com>
	<8AF06B5F-FB1C-4111-A23A-92D9FE8B625C@vmware.com>
	<AANLkTikbxTD2RDyJc+FjjsLgrecTmPJCypkaJ0RU5TdQ@mail.gmail.com>
	<B1E95C0F-54AC-44B4-B695-05BA63934A88@vmware.com>
Message-ID: <AANLkTi=3OO9=um6odf2RiQY9qexnEp_8iu8ypNinqw2W@mail.gmail.com>

I would imagine so. But there are no real ordering guarantees anyway,
so I don't think that's a problem.

-J

On Wed, Dec 8, 2010 at 11:56 AM, John DeTreville <jdetreville at vmware.com> wrote:
> Well, I understand that part.
>
> But if suspected bad messages are to be delayed for a while, am I right to imagine that other messages would not be delayed? That is, messages would be reordered?
>
> Cheers,
> John
>
> On Dec 7, 2010, at 6:05 PM, Jason J. W. Williams wrote:
>
>> Hey John,
>>
>> I think the intent is to keep a message that's crashing a consumer
>> from being endlessly retried.
>>
>> -J
>>
>> On Tue, Dec 7, 2010 at 6:15 PM, John DeTreville <jdetreville at vmware.com> wrote:
>>> I'm a little confused. Would messages be reordered? Is the idea to move from message queues to something else?
>>>
>>> Cheers,
>>> John
>>>
>>> On Dec 7, 2010, at 2:39 PM, Justin Etheredge wrote:
>>>
>>>> It would interesting and useful if there was some way to see a redelivered count on a message. And as a little icing on the cake, it would be useful to be able to specify how long before a message is redelivered. That way if I specify that a message can be redelivered at most 10 times, it won't happen in a thousandth of a second. Any thoughts on this?
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>
>

From alexis at rabbitmq.com  Wed Dec  8 20:20:52 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Wed, 8 Dec 2010 20:20:52 +0000
Subject: [rabbitmq-discuss] webinar tomorrow
Message-ID: <AANLkTi=Bi6VrVQamRSCJsrsC5aBWc4tAAoqAcZP0qo=V@mail.gmail.com>

Folks

There is a FREE (as in beer) webinar tomorrow on RabbitMQ from Emile
Joubert from the Rabbit team.

Details are here: http://www.springsource.com/newsevents/webinars

alexis

From pdezwart at rubiconproject.com  Wed Dec  8 22:04:08 2010
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Wed, 08 Dec 2010 14:04:08 -0800
Subject: [rabbitmq-discuss] Weird error
Message-ID: <C92540D8.1413D%pdezwart@rubiconproject.com>

Hey guys,

I am at my wits end. I am getting this error:

=ERROR REPORT==== 8-Dec-2010::13:59:20 ===
exception on TCP connection <0.5020.1> from 10.20.30.110:41033
{bad_header,<<65,77,81,80,0,0,9,1>>}

>From the broker when I try to connect. The client sees:
Expected 0x000A000A method frame on channel 0, got frame type 65

Broker is:
Status of node rabbit at dude002 ...
[{running_applications,[{rabbit,"RabbitMQ","1.7.2"},
                        {mnesia,"MNESIA  CXC 138 12","4.4.7"},
                        {os_mon,"CPO  CXC 138 46","2.1.8"},
                        {sasl,"SASL  CXC 138 11","2.1.5.4"},
                        {stdlib,"ERTS  CXC 138 10","1.15.5"},
                        {kernel,"ERTS  CXC 138 10","2.12.5"}]},
 {nodes,[rabbit at dude002]},
 {running_nodes,[rabbit at dude002]}]
...done.


Rabbitmq-c library is the same one we have been using forever. I would give
you a version if I had one, but it isnt versioned...

What am I doing wrong?

Thanks,
Pieter
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101208/2614eaa8/attachment-0001.htm>

From simon at rabbitmq.com  Wed Dec  8 22:50:08 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 08 Dec 2010 22:50:08 +0000
Subject: [rabbitmq-discuss] Weird error
In-Reply-To: <C92540D8.1413D%pdezwart@rubiconproject.com>
References: <C92540D8.1413D%pdezwart@rubiconproject.com>
Message-ID: <4D000BA0.7070101@rabbitmq.com>

On 08/12/2010 10:04PM, Pieter de Zwart wrote:
 > exception on TCP connection <0.5020.1> from 10.20.30.110:41033
 > {bad_header,<<65,77,81,80,0,0,9,1>>}

That's the broker complaining that it can't understand the AMQP 0-9-1 
handshake.

 > Broker is:
 > Status of node rabbit at dude002 ...
 > [{running_applications,[{rabbit,"RabbitMQ","1.7.2"},

And there's your problem. RabbitMQ 1.7.2 (indeed all 1.x versions) only 
speak 0-8.

Since:

 > Rabbitmq-c library is the same one we have been using forever.

...I assume that you've been using 2.x brokers until now but are now 
using an older broker version?

Cheers, Simon

From pdezwart at rubiconproject.com  Wed Dec  8 22:55:09 2010
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Wed, 08 Dec 2010 14:55:09 -0800
Subject: [rabbitmq-discuss] Weird error
In-Reply-To: <4D000BA0.7070101@rabbitmq.com>
Message-ID: <C9254CCD.1414D%pdezwart@rubiconproject.com>

Actually, we have been using 1.7.2, we just wanted to support the 0-9-1
client for PHP AMQP, so we got the newer rabbitmq-c library. Looks like its
time to upgrade our systems? Or is there a way to force the client to use
0-8?
Pieter


On 12/8/10 2:50 PM, "Simon MacMullen" <simon at rabbitmq.com> wrote:

> On 08/12/2010 10:04PM, Pieter de Zwart wrote:
>> exception on TCP connection <0.5020.1> from 10.20.30.110:41033
>> {bad_header,<<65,77,81,80,0,0,9,1>>}
> 
> That's the broker complaining that it can't understand the AMQP 0-9-1
> handshake.
> 
>> Broker is:
>> Status of node rabbit at dude002 ...
>> [{running_applications,[{rabbit,"RabbitMQ","1.7.2"},
> 
> And there's your problem. RabbitMQ 1.7.2 (indeed all 1.x versions) only
> speak 0-8.
> 
> Since:
> 
>> Rabbitmq-c library is the same one we have been using forever.
> 
> ...I assume that you've been using 2.x brokers until now but are now
> using an older broker version?
> 
> Cheers, Simon
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-- 
the rubicon project

PIETER DE ZWART | LEAD, INTERFACES TEAM
??? P 310 207 0272 | x224
??? C 408 666 4443
??? F 323 466 7119


1925 S. BUNDY DRIVE
LOS ANGELES, CALIFORNIA 90025

WWW.RUBICONPROJECT.COM <http://www.rubiconproject.com/>


?MOST INNOVATIVE COMPANY? - AMERICAN BUSINESS AWARDS ?10
 REVV IS OPTIMIZING 1.4 MILLION ADS PER MINUTE



From jdetreville at vmware.com  Wed Dec  8 23:06:28 2010
From: jdetreville at vmware.com (John DeTreville)
Date: Wed, 8 Dec 2010 15:06:28 -0800
Subject: [rabbitmq-discuss] Weird error
In-Reply-To: <C9254CCD.1414D%pdezwart@rubiconproject.com>
References: <C9254CCD.1414D%pdezwart@rubiconproject.com>
Message-ID: <8549D341-052D-4167-A192-C806D55AA30D@vmware.com>

Alas, I am told that the current C client cannot easily be taught to speak 0-8. I'm afraid it's time to upgrade!

Cheers,
John

On Dec 8, 2010, at 2:55 PM, Pieter de Zwart wrote:

> Actually, we have been using 1.7.2, we just wanted to support the 0-9-1
> client for PHP AMQP, so we got the newer rabbitmq-c library. Looks like its
> time to upgrade our systems? Or is there a way to force the client to use
> 0-8?
> Pieter
> 
> 
> On 12/8/10 2:50 PM, "Simon MacMullen" <simon at rabbitmq.com> wrote:
> 
>> On 08/12/2010 10:04PM, Pieter de Zwart wrote:
>>> exception on TCP connection <0.5020.1> from 10.20.30.110:41033
>>> {bad_header,<<65,77,81,80,0,0,9,1>>}
>> 
>> That's the broker complaining that it can't understand the AMQP 0-9-1
>> handshake.
>> 
>>> Broker is:
>>> Status of node rabbit at dude002 ...
>>> [{running_applications,[{rabbit,"RabbitMQ","1.7.2"},
>> 
>> And there's your problem. RabbitMQ 1.7.2 (indeed all 1.x versions) only
>> speak 0-8.
>> 
>> Since:
>> 
>>> Rabbitmq-c library is the same one we have been using forever.
>> 
>> ...I assume that you've been using 2.x brokers until now but are now
>> using an older broker version?
>> 
>> Cheers, Simon
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> -- 
> the rubicon project
> 
> PIETER DE ZWART | LEAD, INTERFACES TEAM
> ??? P 310 207 0272 | x224
> ??? C 408 666 4443
> ??? F 323 466 7119
> 
> 
> 1925 S. BUNDY DRIVE
> LOS ANGELES, CALIFORNIA 90025
> 
> WWW.RUBICONPROJECT.COM <http://www.rubiconproject.com/>
> 
> 
> ?MOST INNOVATIVE COMPANY? - AMERICAN BUSINESS AWARDS ?10
> REVV IS OPTIMIZING 1.4 MILLION ADS PER MINUTE
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From pdezwart at rubiconproject.com  Wed Dec  8 23:07:34 2010
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Wed, 08 Dec 2010 15:07:34 -0800
Subject: [rabbitmq-discuss] Weird error
In-Reply-To: <C9254CCD.1414D%pdezwart@rubiconproject.com>
Message-ID: <C9254FB6.14151%pdezwart@rubiconproject.com>

So, jumping the gun here... In my checked out codegen directory, which is up
to HEAD, I moved amqp-rabbitmq-0-9-1.json to amqp-rabbitmq-0-9-1.json.bak,
re-ran autoreconf and configure, looked at the guts of confgure and verified
it was pointing to the 0-8 signature file, ran make && sudo make install,
but it still seems to be using the 0-9-1 signature (still seeing same error
message at least.)

I am obviously doing something stupid, but I would love some help to figure
out where I am applying my stupidity this time =)

me  


On 12/8/10 2:55 PM, "Pieter de Zwart" <pdezwart at rubiconproject.com> wrote:

> Actually, we have been using 1.7.2, we just wanted to support the 0-9-1
> client for PHP AMQP, so we got the newer rabbitmq-c library. Looks like its
> time to upgrade our systems? Or is there a way to force the client to use
> 0-8?
> Pieter
> 
> 
> On 12/8/10 2:50 PM, "Simon MacMullen" <simon at rabbitmq.com> wrote:
> 
>> On 08/12/2010 10:04PM, Pieter de Zwart wrote:
>>> exception on TCP connection <0.5020.1> from 10.20.30.110:41033
>>> {bad_header,<<65,77,81,80,0,0,9,1>>}
>> 
>> That's the broker complaining that it can't understand the AMQP 0-9-1
>> handshake.
>> 
>>> Broker is:
>>> Status of node rabbit at dude002 ...
>>> [{running_applications,[{rabbit,"RabbitMQ","1.7.2"},
>> 
>> And there's your problem. RabbitMQ 1.7.2 (indeed all 1.x versions) only
>> speak 0-8.
>> 
>> Since:
>> 
>>> Rabbitmq-c library is the same one we have been using forever.
>> 
>> ...I assume that you've been using 2.x brokers until now but are now
>> using an older broker version?
>> 
>> Cheers, Simon
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-- 
the rubicon project

PIETER DE ZWART | LEAD, INTERFACES TEAM
??? P 310 207 0272 | x224
??? C 408 666 4443
??? F 323 466 7119


1925 S. BUNDY DRIVE
LOS ANGELES, CALIFORNIA 90025

WWW.RUBICONPROJECT.COM <http://www.rubiconproject.com/>


?MOST INNOVATIVE COMPANY? - AMERICAN BUSINESS AWARDS ?10
 REVV IS OPTIMIZING 1.4 MILLION ADS PER MINUTE



From pdezwart at rubiconproject.com  Wed Dec  8 23:11:10 2010
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Wed, 08 Dec 2010 15:11:10 -0800
Subject: [rabbitmq-discuss] Weird error
In-Reply-To: <8549D341-052D-4167-A192-C806D55AA30D@vmware.com>
Message-ID: <C925508E.14154%pdezwart@rubiconproject.com>

The problem we have is that there are consumers written in Perl that use
Net::AMQP, which AFAIK only supports 0-8. Is the spec backwards compatible,
i.e. A 0-8 client can interact with a 0-9-1 broker?
Sorry, I am sure this has probably been hashed before =(

Pieter


On 12/8/10 3:06 PM, "John DeTreville" <jdetreville at vmware.com> wrote:

> Alas, I am told that the current C client cannot easily be taught to speak
> 0-8. I'm afraid it's time to upgrade!
> 
> Cheers,
> John
> 
> On Dec 8, 2010, at 2:55 PM, Pieter de Zwart wrote:
> 
>> Actually, we have been using 1.7.2, we just wanted to support the 0-9-1
>> client for PHP AMQP, so we got the newer rabbitmq-c library. Looks like its
>> time to upgrade our systems? Or is there a way to force the client to use
>> 0-8?
>> Pieter
>> 
>> 
>> On 12/8/10 2:50 PM, "Simon MacMullen" <simon at rabbitmq.com> wrote:
>> 
>>> On 08/12/2010 10:04PM, Pieter de Zwart wrote:
>>>> exception on TCP connection <0.5020.1> from 10.20.30.110:41033
>>>> {bad_header,<<65,77,81,80,0,0,9,1>>}
>>> 
>>> That's the broker complaining that it can't understand the AMQP 0-9-1
>>> handshake.
>>> 
>>>> Broker is:
>>>> Status of node rabbit at dude002 ...
>>>> [{running_applications,[{rabbit,"RabbitMQ","1.7.2"},
>>> 
>>> And there's your problem. RabbitMQ 1.7.2 (indeed all 1.x versions) only
>>> speak 0-8.
>>> 
>>> Since:
>>> 
>>>> Rabbitmq-c library is the same one we have been using forever.
>>> 
>>> ...I assume that you've been using 2.x brokers until now but are now
>>> using an older broker version?
>>> 
>>> Cheers, Simon
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> -- 
>> the rubicon project
>> 
>> PIETER DE ZWART | LEAD, INTERFACES TEAM
>> ??? P 310 207 0272 | x224
>> ??? C 408 666 4443
>> ??? F 323 466 7119
>> 
>> 
>> 1925 S. BUNDY DRIVE
>> LOS ANGELES, CALIFORNIA 90025
>> 
>> WWW.RUBICONPROJECT.COM <http://www.rubiconproject.com/>
>> 
>> 
>> ?MOST INNOVATIVE COMPANY? - AMERICAN BUSINESS AWARDS ?10
>> REVV IS OPTIMIZING 1.4 MILLION ADS PER MINUTE
>> 
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 

-- 
the rubicon project

PIETER DE ZWART | LEAD, INTERFACES TEAM
??? P 310 207 0272 | x224
??? C 408 666 4443
??? F 323 466 7119


1925 S. BUNDY DRIVE
LOS ANGELES, CALIFORNIA 90025

WWW.RUBICONPROJECT.COM <http://www.rubiconproject.com/>


?MOST INNOVATIVE COMPANY? - AMERICAN BUSINESS AWARDS ?10
 REVV IS OPTIMIZING 1.4 MILLION ADS PER MINUTE



From jdetreville at vmware.com  Wed Dec  8 23:14:50 2010
From: jdetreville at vmware.com (John DeTreville)
Date: Wed, 8 Dec 2010 15:14:50 -0800
Subject: [rabbitmq-discuss] redelivered count
In-Reply-To: <AANLkTi=3OO9=um6odf2RiQY9qexnEp_8iu8ypNinqw2W@mail.gmail.com>
References: <AANLkTikURCvPhTOhoLpHoP_w7ygCrBO3fLywf70aoz9K@mail.gmail.com>
	<8AF06B5F-FB1C-4111-A23A-92D9FE8B625C@vmware.com>
	<AANLkTikbxTD2RDyJc+FjjsLgrecTmPJCypkaJ0RU5TdQ@mail.gmail.com>
	<B1E95C0F-54AC-44B4-B695-05BA63934A88@vmware.com>
	<AANLkTi=3OO9=um6odf2RiQY9qexnEp_8iu8ypNinqw2W@mail.gmail.com>
Message-ID: <F2564C42-56A3-4D57-AADB-7EC773C2A40F@vmware.com>

Well, I suppose, but I doubt that all clients would be happy with arbitrarily reordered messages. If the point is just that messages can already get reordered, and so reordering a few more in various corner cases can't hurt, well, maybe, but I'd prefer to be able to set some limits.

That's just my own preference, of course!

Cheers,
John

On Dec 8, 2010, at 10:58 AM, Jason J. W. Williams wrote:

> I would imagine so. But there are no real ordering guarantees anyway,
> so I don't think that's a problem.
> 
> -J
> 
> On Wed, Dec 8, 2010 at 11:56 AM, John DeTreville <jdetreville at vmware.com> wrote:
>> Well, I understand that part.
>> 
>> But if suspected bad messages are to be delayed for a while, am I right to imagine that other messages would not be delayed? That is, messages would be reordered?
>> 
>> Cheers,
>> John
>> 
>> On Dec 7, 2010, at 6:05 PM, Jason J. W. Williams wrote:
>> 
>>> Hey John,
>>> 
>>> I think the intent is to keep a message that's crashing a consumer
>>> from being endlessly retried.
>>> 
>>> -J
>>> 
>>> On Tue, Dec 7, 2010 at 6:15 PM, John DeTreville <jdetreville at vmware.com> wrote:
>>>> I'm a little confused. Would messages be reordered? Is the idea to move from message queues to something else?
>>>> 
>>>> Cheers,
>>>> John
>>>> 
>>>> On Dec 7, 2010, at 2:39 PM, Justin Etheredge wrote:
>>>> 
>>>>> It would interesting and useful if there was some way to see a redelivered count on a message. And as a little icing on the cake, it would be useful to be able to specify how long before a message is redelivered. That way if I specify that a message can be redelivered at most 10 times, it won't happen in a thousandth of a second. Any thoughts on this?
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>> 
>> 
>> 


From pdezwart at rubiconproject.com  Wed Dec  8 23:16:09 2010
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Wed, 08 Dec 2010 15:16:09 -0800
Subject: [rabbitmq-discuss] Weird error
In-Reply-To: <C925508E.14154%pdezwart@rubiconproject.com>
Message-ID: <C92551B9.14158%pdezwart@rubiconproject.com>

Just kidding, the client we rely on is py-amqplib, which is also running
0-8. Brad Rodriguez kindly sent me this:
http://www.rabbitmq.com/blog/2010/08/04/rabbitmq-and-amqp-0-9-1/
So it looks like we can upgrade.

Thanks, and sorry for the monologue.

Pieter


On 12/8/10 3:11 PM, "Pieter de Zwart" <pdezwart at rubiconproject.com> wrote:

> The problem we have is that there are consumers written in Perl that
> use
Net::AMQP, which AFAIK only supports 0-8. Is the spec backwards
> compatible,
i.e. A 0-8 client can interact with a 0-9-1 broker?
Sorry, I am
> sure this has probably been hashed before =(

Pieter


On 12/8/10 3:06 PM,
> "John DeTreville" <jdetreville at vmware.com> wrote:

> Alas, I am told that the
> current C client cannot easily be taught to speak
> 0-8. I'm afraid it's time
> to upgrade!
> 
> Cheers,
> John
> 
> On Dec 8, 2010, at 2:55 PM, Pieter de
> Zwart wrote:
> 
>> Actually, we have been using 1.7.2, we just wanted to
> support the 0-9-1
>> client for PHP AMQP, so we got the newer rabbitmq-c
> library. Looks like its
>> time to upgrade our systems? Or is there a way to
> force the client to use
>> 0-8?
>> Pieter
>> 
>> 
>> On 12/8/10 2:50 PM,
> "Simon MacMullen" <simon at rabbitmq.com> wrote:
>> 
>>> On 08/12/2010 10:04PM,
> Pieter de Zwart wrote:
>>>> exception on TCP connection <0.5020.1> from
> 10.20.30.110:41033
>>>> {bad_header,<<65,77,81,80,0,0,9,1>>}
>>> 
>>> That's
> the broker complaining that it can't understand the AMQP 0-9-1
>>>
> handshake.
>>> 
>>>> Broker is:
>>>> Status of node rabbit at dude002 ...
>>>>
> [{running_applications,[{rabbit,"RabbitMQ","1.7.2"},
>>> 
>>> And there's your
> problem. RabbitMQ 1.7.2 (indeed all 1.x versions) only
>>> speak 0-8.
>>> 
>>>
> Since:
>>> 
>>>> Rabbitmq-c library is the same one we have been using
> forever.
>>> 
>>> ...I assume that you've been using 2.x brokers until now but
> are now
>>> using an older broker version?
>>> 
>>> Cheers, Simon
>>>
> _______________________________________________
>>> rabbitmq-discuss mailing
> list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> --
> 
>> the rubicon project
>> 
>> PIETER DE ZWART | LEAD, INTERFACES TEAM
>> ???
> P 310 207 0272 | x224
>> ??? C 408 666 4443
>> ??? F 323 466 7119
>> 
>> 
>>
> 1925 S. BUNDY DRIVE
>> LOS ANGELES, CALIFORNIA 90025
>> 
>>
> WWW.RUBICONPROJECT.COM <http://www.rubiconproject.com/>
>> 
>> 
>> ?MOST
> INNOVATIVE COMPANY? - AMERICAN BUSINESS AWARDS ?10
>> REVV IS OPTIMIZING 1.4
> MILLION ADS PER MINUTE
>> 
>> 
>>
> _______________________________________________
>> rabbitmq-discuss mailing
> list
>> rabbitmq-discuss at lists.rabbitmq.com
>>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 

--




From pascaldergane at gmail.com  Wed Dec  8 23:48:54 2010
From: pascaldergane at gmail.com (Pascal Dergane)
Date: Thu, 9 Dec 2010 00:48:54 +0100
Subject: [rabbitmq-discuss] Help: how a publisher could know number of
	consumers
Message-ID: <AANLkTiniXmBin1YCWQsN4YJCwdwtYqvb=oANdPLizTp8@mail.gmail.com>

I use rabbitmq java client 1.7 with corresponding server on linux (centOs)
system.
I've got a publisher that post a message to an exchange "myExchange" with
routing Key "myRoutingKey" (direct mode).
My system has a few consumers (say 20), each one connected to the same
exchange "myExchange", binding with routing key "myRoutingKey", each
consumers connected with a specific queue ("queue1" for first consumer,
"queue2" for second, etc...).

I expect that each consumer will process the message, and after will deliver
a response to the publisher on the replyQueue.

How the publisher could know that there's 20 consumers subscribing to the
exchange when it publis the message?
The idea, is that the publisher should know the number of consumers (or
queues ) that bind the routingKey to know how many responses it will expect?
Could you explain to me how to do that or give me a java example ?

Other point, to assume high avaibility, I could have more than one consumer
on the same queue. In these case, all consumers connected to the same queue
have established a "direct" connexion to assume that only one consumer
subscribed to the same queue will process the message. In these case, the
publisher should get only one information (the number of distinct queues,
not the number of consumers on one queue).

Thank you in advance,
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101209/284fc7c7/attachment.htm>

From justin at etheredge.us  Thu Dec  9 01:48:43 2010
From: justin at etheredge.us (Justin Etheredge)
Date: Wed, 8 Dec 2010 20:48:43 -0500
Subject: [rabbitmq-discuss] redelivered count
In-Reply-To: <F2564C42-56A3-4D57-AADB-7EC773C2A40F@vmware.com>
References: <AANLkTikURCvPhTOhoLpHoP_w7ygCrBO3fLywf70aoz9K@mail.gmail.com>
	<8AF06B5F-FB1C-4111-A23A-92D9FE8B625C@vmware.com>
	<AANLkTikbxTD2RDyJc+FjjsLgrecTmPJCypkaJ0RU5TdQ@mail.gmail.com>
	<B1E95C0F-54AC-44B4-B695-05BA63934A88@vmware.com>
	<AANLkTi=3OO9=um6odf2RiQY9qexnEp_8iu8ypNinqw2W@mail.gmail.com>
	<F2564C42-56A3-4D57-AADB-7EC773C2A40F@vmware.com>
Message-ID: <AANLkTikbZBQk9R1yvKNDtPK1n9+JqGiHMG3G7AHF-TsV@mail.gmail.com>

Honestly I wasn't under the impression that the message ordering could be
relied on at all. I mean a basic.reject with a redeliver puts the message to
the end of the queue, right?

On Wed, Dec 8, 2010 at 6:14 PM, John DeTreville <jdetreville at vmware.com>wrote:

> Well, I suppose, but I doubt that all clients would be happy with
> arbitrarily reordered messages. If the point is just that messages can
> already get reordered, and so reordering a few more in various corner cases
> can't hurt, well, maybe, but I'd prefer to be able to set some limits.
>
> That's just my own preference, of course!
>
> Cheers,
> John
>
> On Dec 8, 2010, at 10:58 AM, Jason J. W. Williams wrote:
>
> > I would imagine so. But there are no real ordering guarantees anyway,
> > so I don't think that's a problem.
> >
> > -J
> >
> > On Wed, Dec 8, 2010 at 11:56 AM, John DeTreville <jdetreville at vmware.com>
> wrote:
> >> Well, I understand that part.
> >>
> >> But if suspected bad messages are to be delayed for a while, am I right
> to imagine that other messages would not be delayed? That is, messages would
> be reordered?
> >>
> >> Cheers,
> >> John
> >>
> >> On Dec 7, 2010, at 6:05 PM, Jason J. W. Williams wrote:
> >>
> >>> Hey John,
> >>>
> >>> I think the intent is to keep a message that's crashing a consumer
> >>> from being endlessly retried.
> >>>
> >>> -J
> >>>
> >>> On Tue, Dec 7, 2010 at 6:15 PM, John DeTreville <
> jdetreville at vmware.com> wrote:
> >>>> I'm a little confused. Would messages be reordered? Is the idea to
> move from message queues to something else?
> >>>>
> >>>> Cheers,
> >>>> John
> >>>>
> >>>> On Dec 7, 2010, at 2:39 PM, Justin Etheredge wrote:
> >>>>
> >>>>> It would interesting and useful if there was some way to see a
> redelivered count on a message. And as a little icing on the cake, it would
> be useful to be able to specify how long before a message is redelivered.
> That way if I specify that a message can be redelivered at most 10 times, it
> won't happen in a thousandth of a second. Any thoughts on this?
> >>>> _______________________________________________
> >>>> rabbitmq-discuss mailing list
> >>>> rabbitmq-discuss at lists.rabbitmq.com
> >>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >>>>
> >>
> >>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101208/bc5b8cb4/attachment.htm>

From jiri at krutil.com  Thu Dec  9 07:53:18 2010
From: jiri at krutil.com (jiri at krutil.com)
Date: Thu, 09 Dec 2010 08:53:18 +0100
Subject: [rabbitmq-discuss] ssl certificate to client lookup
In-Reply-To: <4CFFCA42.9030803@rabbitmq.com>
References: <AANLkTimK1NSUevhDMV-62gTSgjKXrl4hMTJNzkkcRIpI@mail.gmail.com>
	<20100625130314.GW14541@rabbitmq.com>
	<AANLkTinS44Y9g3vf+ZQYa8Cy5QOCtzPEXvryNb=vVdyH@mail.gmail.com>
	<4CFFCA42.9030803@rabbitmq.com>
Message-ID: <20101209085318.17064v9djwrjtwys@webmail.active24.cz>

Simon,

> Also, bug23467 (not yet QAed) allows your clients to use the SASL  
> EXTERNAL mechanism to log in using a client certificate, which may  
> be interesting to you.

This sounds very promising for us. Can you explain how will that work?  
Will the client identity be extracted from the client certificate's  
subject? Will the client still need to specify username and password  
for login?

Cheers
Jiri


From simon at rabbitmq.com  Thu Dec  9 11:27:15 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 09 Dec 2010 11:27:15 +0000
Subject: [rabbitmq-discuss] ssl certificate to client lookup
In-Reply-To: <20101209085318.17064v9djwrjtwys@webmail.active24.cz>
References: <AANLkTimK1NSUevhDMV-62gTSgjKXrl4hMTJNzkkcRIpI@mail.gmail.com>
	<20100625130314.GW14541@rabbitmq.com>
	<AANLkTinS44Y9g3vf+ZQYa8Cy5QOCtzPEXvryNb=vVdyH@mail.gmail.com>
	<4CFFCA42.9030803@rabbitmq.com>
	<20101209085318.17064v9djwrjtwys@webmail.active24.cz>
Message-ID: <4D00BD13.4040303@rabbitmq.com>

On 09/12/10 07:53, jiri at krutil.com wrote:
> Simon,
>
>> Also, bug23467 (not yet QAed) allows your clients to use the SASL
>> EXTERNAL mechanism to log in using a client certificate, which may be
>> interesting to you.
>
> This sounds very promising for us. Can you explain how will that work?

In short: the SASL mechanisms used by the server and clients will become 
configurable and plugin-based. We'll be offering an EXTERNAL plugin that 
uses a verified client certificate for login.

> Will the client identity be extracted from the client certificate's
> subject?

Yes, ATM it's just the common name from the subject.

> Will the client still need to specify username and password for
> login?

No.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From majek04 at gmail.com  Thu Dec  9 12:46:41 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Thu, 9 Dec 2010 12:46:41 +0000
Subject: [rabbitmq-discuss] Help: how a publisher could know number of
	consumers
In-Reply-To: <AANLkTiniXmBin1YCWQsN4YJCwdwtYqvb=oANdPLizTp8@mail.gmail.com>
References: <AANLkTiniXmBin1YCWQsN4YJCwdwtYqvb=oANdPLizTp8@mail.gmail.com>
Message-ID: <AANLkTinOyGWPvKUc=nfDFU9wrGxAdxLdf8Ka39dFGD6p@mail.gmail.com>

Hi,

On Wed, Dec 8, 2010 at 23:48, Pascal Dergane <pascaldergane at gmail.com> wrote:
> I use rabbitmq java client 1.7 with corresponding server on linux (centOs)
> system.
> I've got a publisher that post a message to an exchange "myExchange" with
> routing Key "myRoutingKey" (direct mode).
> My system has a few consumers (say 20), each one connected to the same
> exchange "myExchange", binding with routing key "myRoutingKey", each
> consumers connected with a specific queue ("queue1" for first consumer,
> "queue2" for second, etc...).
> I expect that each consumer will process the message, and after will deliver
> a response to the publisher on the replyQueue.
> How the publisher could know that there's 20 consumers subscribing to the
> exchange when it publis the message?

You can't know that. Instead, you can:
 - get number of consumers for the queue (by doing queue.declare)
 - set a "immediate" flag on a message, to make sure it was
   delivered to at least one queue.

Cheers,
  Marek

From taylste at gmail.com  Thu Dec  9 13:17:44 2010
From: taylste at gmail.com (Steven Taylor)
Date: Thu, 9 Dec 2010 13:17:44 +0000
Subject: [rabbitmq-discuss] plugin out of date message after upgrade
Message-ID: <AANLkTimu5B3d74dtRGBeAe2woQ8Dc3_nkT7bguCx3Nn7@mail.gmail.com>

Hi,

 Is this bad?  The broker seems to be running as per normal.

I just upgraded to Rabbit 2.2.0, Erlang 5.8.2 (R14B01) and now during
startup I get a bunch of messages like this:

...
*WARNING* rabbit: Object code (delegate) out of date
*WARNING* rabbit: Object code (delegate_sup) out of date
*WARNING* rabbit: Object code (file_handle_cache) out of date
*WARNING* rabbit: Object code (gatherer) out of date
...
etc/
...

thanks,
-Steven
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101209/68acde20/attachment.htm>

From jerryk at vmware.com  Thu Dec  9 17:40:45 2010
From: jerryk at vmware.com (Jerry Kuch)
Date: Thu, 9 Dec 2010 09:40:45 -0800
Subject: [rabbitmq-discuss] plugin out of date message after upgrade
In-Reply-To: <AANLkTimu5B3d74dtRGBeAe2woQ8Dc3_nkT7bguCx3Nn7@mail.gmail.com>
References: <AANLkTimu5B3d74dtRGBeAe2woQ8Dc3_nkT7bguCx3Nn7@mail.gmail.com>
Message-ID: <70298C4A-1DB9-48E4-8C0F-823104064B21@vmware.com>

Hi, Steven...

Because these files are all regular parts of Rabbit itself, the likely cause is that the 'src' files in your Rabbit distribution have newer datestamps than the 'beam' Erlang compiled object files.  

You could just 'touch' the '.beam' files in ebin about which you're getting warnings.  That will get rid of the alarming noises at startup.  Incidentally, if you were getting complaints about plugins being out of date, you may actually have plugins that need updating, but that's not the case here.

Matthias tells me we have a bug open on the root cause of this:

https://bugzilla.rabbitmq.com/show_bug.cgi?id=23473

In short, the unzipping of the distribution creates files with dates that reflect when and in which order they're extracted from the zip file.  If the end result is src files that are younger than their corresponding beam targets, the broker warns you at startup, with Erlang thinking you might be running out of date object code.

Jerry

On Dec 9, 2010, at 5:17 AM, Steven Taylor wrote:

> Hi,
>  
> Is this bad?  The broker seems to be running as per normal.
>  
> I just upgraded to Rabbit 2.2.0, Erlang 5.8.2 (R14B01) and now during startup I get a bunch of messages like this:
>  
> ...
> *WARNING* rabbit: Object code (delegate) out of date
> *WARNING* rabbit: Object code (delegate_sup) out of date
> *WARNING* rabbit: Object code (file_handle_cache) out of date
> *WARNING* rabbit: Object code (gatherer) out of date
> ...
> etc/
> ...
>  
> thanks,
> -Steven
>  
> <ATT00001..txt>


From jerryk at vmware.com  Thu Dec  9 17:50:58 2010
From: jerryk at vmware.com (Jerry Kuch)
Date: Thu, 9 Dec 2010 09:50:58 -0800
Subject: [rabbitmq-discuss] plugin out of date message after upgrade
In-Reply-To: <70298C4A-1DB9-48E4-8C0F-823104064B21@vmware.com>
References: <AANLkTimu5B3d74dtRGBeAe2woQ8Dc3_nkT7bguCx3Nn7@mail.gmail.com>
	<70298C4A-1DB9-48E4-8C0F-823104064B21@vmware.com>
Message-ID: <D4B90F00-7F44-4EC5-8672-BD5BC4DC6CE7@vmware.com>

Hi, again, Steven...

My apologies.  I just directed you to a bugzilla report that you can't access.  Here's a public mailing list thread from an earlier discovery of this particular problem:

http://old.nabble.com/Warnings-on-server-startup-td29970547.html

My mis-post notwithstanding, we have a bug filed to try and improve this behavior on Windows.  I expect I'll get to it in the relatively near future.  In the meantime, you should be good to go without worries.

Best regards,
Jerry
  
On Dec 9, 2010, at 9:40 AM, Jerry Kuch wrote:

> Hi, Steven...
> 
> Because these files are all regular parts of Rabbit itself, the likely cause is that the 'src' files in your Rabbit distribution have newer datestamps than the 'beam' Erlang compiled object files.  
> 
> You could just 'touch' the '.beam' files in ebin about which you're getting warnings.  That will get rid of the alarming noises at startup.  Incidentally, if you were getting complaints about plugins being out of date, you may actually have plugins that need updating, but that's not the case here.
> 
> Matthias tells me we have a bug open on the root cause of this:
> 
> https://bugzilla.rabbitmq.com/show_bug.cgi?id=23473
> 
> In short, the unzipping of the distribution creates files with dates that reflect when and in which order they're extracted from the zip file.  If the end result is src files that are younger than their corresponding beam targets, the broker warns you at startup, with Erlang thinking you might be running out of date object code.
> 
> Jerry
> 
> On Dec 9, 2010, at 5:17 AM, Steven Taylor wrote:
> 
>> Hi,
>> 
>> Is this bad?  The broker seems to be running as per normal.
>> 
>> I just upgraded to Rabbit 2.2.0, Erlang 5.8.2 (R14B01) and now during startup I get a bunch of messages like this:
>> 
>> ...
>> *WARNING* rabbit: Object code (delegate) out of date
>> *WARNING* rabbit: Object code (delegate_sup) out of date
>> *WARNING* rabbit: Object code (file_handle_cache) out of date
>> *WARNING* rabbit: Object code (gatherer) out of date
>> ...
>> etc/
>> ...
>> 
>> thanks,
>> -Steven
>> 
>> <ATT00001..txt>
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From natester at gmail.com  Thu Dec  9 18:56:20 2010
From: natester at gmail.com (Nathaniel Haggard)
Date: Thu, 9 Dec 2010 11:56:20 -0700
Subject: [rabbitmq-discuss] ssl certificate to client lookup
In-Reply-To: <4D00BD13.4040303@rabbitmq.com>
References: <AANLkTimK1NSUevhDMV-62gTSgjKXrl4hMTJNzkkcRIpI@mail.gmail.com>
	<20100625130314.GW14541@rabbitmq.com>
	<AANLkTinS44Y9g3vf+ZQYa8Cy5QOCtzPEXvryNb=vVdyH@mail.gmail.com>
	<4CFFCA42.9030803@rabbitmq.com>
	<20101209085318.17064v9djwrjtwys@webmail.active24.cz>
	<4D00BD13.4040303@rabbitmq.com>
Message-ID: <AANLkTinWQQ=oStEcHAh+MPXWXBas+HSnMqnjR7CMr7yK@mail.gmail.com>

On Thu, Dec 9, 2010 at 4:27 AM, Simon MacMullen <simon at rabbitmq.com> wrote:
> On 09/12/10 07:53, jiri at krutil.com wrote:
>>
>> Simon,
>>
>>> Also, bug23467 (not yet QAed) allows your clients to use the SASL
>>> EXTERNAL mechanism to log in using a client certificate, which may be
>>> interesting to you.
>>
>> This sounds very promising for us. Can you explain how will that work?
>
> In short: the SASL mechanisms used by the server and clients will become
> configurable and plugin-based. We'll be offering an EXTERNAL plugin that
> uses a verified client certificate for login.
>
>> Will the client identity be extracted from the client certificate's
>> subject?
>
> Yes, ATM it's just the common name from the subject.

What about setting a field in the message header to the common name of
the subject?


>
>> Will the client still need to specify username and password for
>> login?
>
> No.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From mark.geib at echostar.com  Thu Dec  9 20:52:22 2010
From: mark.geib at echostar.com (Mark Geib)
Date: Thu, 09 Dec 2010 13:52:22 -0700
Subject: [rabbitmq-discuss] recommended version of erlang for rabbitmq 2.2.0
Message-ID: <4D014186.4090508@echostar.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

I was unable to find a required/recommended version of erlang for
rabbitmq 2.2.0. I am running debian lenny, which I believe includes R12B3.

Thanks,
Mark.

- -- 
Principal Engineer
Cheyenne Software Engineering
mark.geib at echostar.com / 35-215

PGP fingerprint:6DFC 389D 9796 0188 92E5 58F5 34C5 6B47 D091 76FD
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iEYEARECAAYFAk0BQYYACgkQNMVrR9CRdv1r7QCcD7uZTVLJfbV9MQujyIuFJQgY
daQAniaSu+mxiVJ9WMP0iN+k7XlEuW3H
=0UmW
-----END PGP SIGNATURE-----


From emile at rabbitmq.com  Thu Dec  9 21:45:24 2010
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 09 Dec 2010 21:45:24 +0000
Subject: [rabbitmq-discuss] recommended version of erlang for rabbitmq
 2.2.0
In-Reply-To: <4D014186.4090508@echostar.com>
References: <4D014186.4090508@echostar.com>
Message-ID: <4D014DF4.9030506@rabbitmq.com>

Hi Mark

Op 09/12/2010 20:52, het Mark Geib geskryf:

> I was unable to find a required/recommended version of erlang for
> rabbitmq 2.2.0. I am running debian lenny, which I believe includes R12B3.

In general the latest version of Erlang is recommended. Alpha versions 
(containing an A) have been known to cause problems, so avoid this in a 
production environment immediately after release. At the time of writing 
R14B (R14B01 for Windows) is recommended. This should be considered the 
minimum required version if you intend to use SSL with Java or Erlang 
clients. (See http://www.rabbitmq.com/ssl.html)

The RabbitMQ website currently states that R12B-3 is the minimum 
required version (http://www.rabbitmq.com/server.html), but that will 
change in the future.

Regards

Emile

From mark.geib at echostar.com  Thu Dec  9 21:51:08 2010
From: mark.geib at echostar.com (Mark Geib)
Date: Thu, 09 Dec 2010 14:51:08 -0700
Subject: [rabbitmq-discuss] recommended version of erlang for rabbitmq
 2.2.0
In-Reply-To: <4D014DF4.9030506@rabbitmq.com>
References: <4D014186.4090508@echostar.com> <4D014DF4.9030506@rabbitmq.com>
Message-ID: <4D014F4C.9030808@echostar.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

So, if I don't require ssl then R12B3 is blessed.??

I also plan on using the web management plugins.

Thanks,
Mark.

On 12/09/2010 02:45 PM, Emile Joubert wrote:
> Hi Mark
>
> Op 09/12/2010 20:52, het Mark Geib geskryf:
>
>> I was unable to find a required/recommended version of erlang
>> for rabbitmq 2.2.0. I am running debian lenny, which I believe
>> includes R12B3.
>
> In general the latest version of Erlang is recommended. Alpha
> versions (containing an A) have been known to cause problems, so
> avoid this in a production environment immediately after release.
> At the time of writing R14B (R14B01 for Windows) is recommended.
> This should be considered the minimum required version if you
> intend to use SSL with Java or Erlang clients. (See
> http://www.rabbitmq.com/ssl.html)
>
> The RabbitMQ website currently states that R12B-3 is the minimum
> required version (http://www.rabbitmq.com/server.html), but that
> will change in the future.
>
> Regards
>
> Emile
>

- -- 
Principal Engineer
Cheyenne Software Engineering
mark.geib at echostar.com / 35-215

PGP fingerprint:6DFC 389D 9796 0188 92E5 58F5 34C5 6B47 D091 76FD
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iEYEARECAAYFAk0BT0wACgkQNMVrR9CRdv09MACdH4jBIWd+Zch5MIX80zVDo700
HVAAn1W2/tcCm8h0C7/jtZJNZEx6Ge11
=q0B8
-----END PGP SIGNATURE-----


From matthias at rabbitmq.com  Thu Dec  9 22:09:00 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 09 Dec 2010 22:09:00 +0000
Subject: [rabbitmq-discuss] recommended version of erlang for rabbitmq
 2.2.0
In-Reply-To: <4D014F4C.9030808@echostar.com>
References: <4D014186.4090508@echostar.com> <4D014DF4.9030506@rabbitmq.com>
	<4D014F4C.9030808@echostar.com>
Message-ID: <4D01537C.9060508@rabbitmq.com>

On 09/12/10 21:51, Mark Geib wrote:
> So, if I don't require ssl then R12B3 is blessed.??
>
> I also plan on using the web management plugins.

See http://www.rabbitmq.com/management.html#erlang


Matthias.

From nathan.marz at gmail.com  Thu Dec  9 22:46:58 2010
From: nathan.marz at gmail.com (nathanmarz)
Date: Thu, 9 Dec 2010 14:46:58 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ persistence when clustering
Message-ID: <184d4c1b-3355-46a8-a2bc-d7e6bb6dc125@y19g2000prb.googlegroups.com>

I'm trying to understand the behavior of a clustered RabbitMQ setup.

Specifically:

1. When you cluster, do ram nodes persist messages to their queues? Or
only disk nodes?
2. What's the state that's replicated across all nodes in a cluster?
3. When a Rabbit node goes down, does its queue become unavailable?
4. What are the conditions (if any) for which there will be lost
messages?

Thanks in advance,
Nathan

From alexandru at rabbitmq.com  Thu Dec  9 23:09:10 2010
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Thu, 9 Dec 2010 23:09:10 +0000
Subject: [rabbitmq-discuss] RabbitMQ persistence when clustering
In-Reply-To: <184d4c1b-3355-46a8-a2bc-d7e6bb6dc125@y19g2000prb.googlegroups.com>
References: <184d4c1b-3355-46a8-a2bc-d7e6bb6dc125@y19g2000prb.googlegroups.com>
Message-ID: <20101209230910.GB2284@dakota.Home>

Hi Nathan,

> 1. When you cluster, do ram nodes persist messages to their queues? Or
> only disk nodes?

Ram and disk apply only to whether the cluster configuration is in
memory or also written to disk.  Nodes of any type may persist messages
to disk.  The broker will always try to write persistent messages (on
durable queues) to disk, and may also persist transient messages if it's
running low on memory.

> 2. What's the state that's replicated across all nodes in a cluster?

Queues, bindings and exchanges.

Note that while all three appear the same on every node in the cluster,
queues are tied to the node they were declared on.  If that node goes
down, they'll also go down.

> 3. When a Rabbit node goes down, does its queue become unavailable?

Yes.  If the queue was non-durable, then the queue is deleted and can be
redeclared on any other node.  If the queue was durable, then it becomes
unavailable, and attempting to redeclare it will result in an exception.

> 4. What are the conditions (if any) for which there will be lost
> messages?

If the broker goes down before it's had time to write (persistent) messages
to disk, those messages will be lost.

Cheers,
Alex

On Thu, Dec 09, 2010 at 02:46:58PM -0800, nathanmarz wrote:
> I'm trying to understand the behavior of a clustered RabbitMQ setup.
> 
> Specifically:
> 
> 1. When you cluster, do ram nodes persist messages to their queues? Or
> only disk nodes?
> 2. What's the state that's replicated across all nodes in a cluster?
> 3. When a Rabbit node goes down, does its queue become unavailable?
> 4. What are the conditions (if any) for which there will be lost
> messages?
> 
> Thanks in advance,
> Nathan
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From nathan.marz at gmail.com  Thu Dec  9 23:12:53 2010
From: nathan.marz at gmail.com (nathanmarz)
Date: Thu, 9 Dec 2010 15:12:53 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ persistence when clustering
In-Reply-To: <20101209230910.GB2284@dakota.Home>
References: <184d4c1b-3355-46a8-a2bc-d7e6bb6dc125@y19g2000prb.googlegroups.com>
	<20101209230910.GB2284@dakota.Home>
Message-ID: <309f4eff-7647-446f-91e8-04d1beaadd0c@n2g2000pre.googlegroups.com>

Thanks Alex for the quick reply.

To clarify #3, when a node goes down does any other node temporarily
handle the queues for the down node? Or does the queue just stay
unavailable until the node comes back up? If it stays unavailable, are
there any future plans to ensure high availability of queues?

Thanks,
Nathan


On Dec 9, 3:09?pm, Alexandru Scvor?ov <alexan... at rabbitmq.com> wrote:
> Hi Nathan,
>
> > 1. When you cluster, do ram nodes persist messages to their queues? Or
> > only disk nodes?
>
> Ram and disk apply only to whether the cluster configuration is in
> memory or also written to disk. ?Nodes of any type may persist messages
> to disk. ?The broker will always try to write persistent messages (on
> durable queues) to disk, and may also persist transient messages if it's
> running low on memory.
>
> > 2. What's the state that's replicated across all nodes in a cluster?
>
> Queues, bindings and exchanges.
>
> Note that while all three appear the same on every node in the cluster,
> queues are tied to the node they were declared on. ?If that node goes
> down, they'll also go down.
>
> > 3. When a Rabbit node goes down, does its queue become unavailable?
>
> Yes. ?If the queue was non-durable, then the queue is deleted and can be
> redeclared on any other node. ?If the queue was durable, then it becomes
> unavailable, and attempting to redeclare it will result in an exception.
>
> > 4. What are the conditions (if any) for which there will be lost
> > messages?
>
> If the broker goes down before it's had time to write (persistent) messages
> to disk, those messages will be lost.
>
> Cheers,
> Alex
>
>
>
>
>
>
>
>
>
> On Thu, Dec 09, 2010 at 02:46:58PM -0800, nathanmarz wrote:
> > I'm trying to understand the behavior of a clustered RabbitMQ setup.
>
> > Specifically:
>
> > 1. When you cluster, do ram nodes persist messages to their queues? Or
> > only disk nodes?
> > 2. What's the state that's replicated across all nodes in a cluster?
> > 3. When a Rabbit node goes down, does its queue become unavailable?
> > 4. What are the conditions (if any) for which there will be lost
> > messages?
>
> > Thanks in advance,
> > Nathan
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From alexandru at rabbitmq.com  Thu Dec  9 23:21:51 2010
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Thu, 9 Dec 2010 23:21:51 +0000
Subject: [rabbitmq-discuss] RabbitMQ persistence when clustering
In-Reply-To: <309f4eff-7647-446f-91e8-04d1beaadd0c@n2g2000pre.googlegroups.com>
References: <184d4c1b-3355-46a8-a2bc-d7e6bb6dc125@y19g2000prb.googlegroups.com>
	<20101209230910.GB2284@dakota.Home>
	<309f4eff-7647-446f-91e8-04d1beaadd0c@n2g2000pre.googlegroups.com>
Message-ID: <20101209232151.GC2284@dakota.Home>

> To clarify #3, when a node goes down does any other node temporarily
> handle the queues for the down node?

Nothing's done automatically.  If the queue was non-durable, a
reconnecting client should be able to redeclare the queue.  If the
original node comes back up, the queue doesn't reappear automatically.

> Or does the queue just stay unavailable until the node comes back up? 

If the queue was durable, the queue is unavailable until the node comes
back online.

> If it stays unavailable, are
> there any future plans to ensure high availability of queues?

I can't really comment on that, but if you want high-availability right
now, you might be interested in our HA guide:

  http://www.rabbitmq.com/pacemaker.html


Cheers,
Alex

On Thu, Dec 09, 2010 at 03:12:53PM -0800, nathanmarz wrote:
> Thanks Alex for the quick reply.
> 
> To clarify #3, when a node goes down does any other node temporarily
> handle the queues for the down node? Or does the queue just stay
> unavailable until the node comes back up? If it stays unavailable, are
> there any future plans to ensure high availability of queues?
> 
> Thanks,
> Nathan
> 
> 
> On Dec 9, 3:09?pm, Alexandru Scvor?ov <alexan... at rabbitmq.com> wrote:
> > Hi Nathan,
> >
> > > 1. When you cluster, do ram nodes persist messages to their queues? Or
> > > only disk nodes?
> >
> > Ram and disk apply only to whether the cluster configuration is in
> > memory or also written to disk. ?Nodes of any type may persist messages
> > to disk. ?The broker will always try to write persistent messages (on
> > durable queues) to disk, and may also persist transient messages if it's
> > running low on memory.
> >
> > > 2. What's the state that's replicated across all nodes in a cluster?
> >
> > Queues, bindings and exchanges.
> >
> > Note that while all three appear the same on every node in the cluster,
> > queues are tied to the node they were declared on. ?If that node goes
> > down, they'll also go down.
> >
> > > 3. When a Rabbit node goes down, does its queue become unavailable?
> >
> > Yes. ?If the queue was non-durable, then the queue is deleted and can be
> > redeclared on any other node. ?If the queue was durable, then it becomes
> > unavailable, and attempting to redeclare it will result in an exception.
> >
> > > 4. What are the conditions (if any) for which there will be lost
> > > messages?
> >
> > If the broker goes down before it's had time to write (persistent) messages
> > to disk, those messages will be lost.
> >
> > Cheers,
> > Alex
> >
> >
> >
> >
> >
> >
> >
> >
> >
> > On Thu, Dec 09, 2010 at 02:46:58PM -0800, nathanmarz wrote:
> > > I'm trying to understand the behavior of a clustered RabbitMQ setup.
> >
> > > Specifically:
> >
> > > 1. When you cluster, do ram nodes persist messages to their queues? Or
> > > only disk nodes?
> > > 2. What's the state that's replicated across all nodes in a cluster?
> > > 3. When a Rabbit node goes down, does its queue become unavailable?
> > > 4. What are the conditions (if any) for which there will be lost
> > > messages?
> >
> > > Thanks in advance,
> > > Nathan
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-disc... at lists.rabbitmq.com
> > >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthew at rabbitmq.com  Thu Dec  9 23:33:48 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 9 Dec 2010 23:33:48 +0000
Subject: [rabbitmq-discuss] RabbitMQ persistence when clustering
In-Reply-To: <309f4eff-7647-446f-91e8-04d1beaadd0c@n2g2000pre.googlegroups.com>
References: <184d4c1b-3355-46a8-a2bc-d7e6bb6dc125@y19g2000prb.googlegroups.com>
	<20101209230910.GB2284@dakota.Home>
	<309f4eff-7647-446f-91e8-04d1beaadd0c@n2g2000pre.googlegroups.com>
Message-ID: <20101209233347.GA16011@wellquite.org>

On Thu, Dec 09, 2010 at 03:12:53PM -0800, nathanmarz wrote:
> If it stays unavailable, are
> there any future plans to ensure high availability of queues?

Yes. I'm working on it right now.

Matthew

From nathan.marz at gmail.com  Fri Dec 10 00:47:03 2010
From: nathan.marz at gmail.com (nathanmarz)
Date: Thu, 9 Dec 2010 16:47:03 -0800 (PST)
Subject: [rabbitmq-discuss] Ack by a different machine than consumer
Message-ID: <4b93c01b-f2b4-4690-b49d-b459f8adc402@j32g2000prh.googlegroups.com>

Can a message be ack'd by a different machine than the one that read
it off the queue?

I'm working on a distributed stream processing system where it would
be useful to have a downstream node do the acknowledgement.

Thanks in advance,
Nathan

From jerryk at vmware.com  Fri Dec 10 01:11:48 2010
From: jerryk at vmware.com (Jerry Kuch)
Date: Thu, 9 Dec 2010 17:11:48 -0800
Subject: [rabbitmq-discuss] Ack by a different machine than consumer
In-Reply-To: <4b93c01b-f2b4-4690-b49d-b459f8adc402@j32g2000prh.googlegroups.com>
References: <4b93c01b-f2b4-4690-b49d-b459f8adc402@j32g2000prh.googlegroups.com>
Message-ID: <9D18351F-CCA3-4A09-B367-BCDE0EE6C10D@vmware.com>

Hi, Nathan...

I believe the delivery tag you'd use in ack-ing is only valid within the channel in which the message was received so the scheme you propose wouldn't be viable and you'd have to devise some scheme for signifying done-ness with the message's implied work beyond basic AMQP. 

BTW, Cascalog is a neat piece of work.  Would be interested to know more about the system you're building if it's not confidential...   :-)

Jerry

Sent from my iPhone (Brevity and typos are hopefully the result of 1-fingered typing rather than rudeness or illiteracy).


On Dec 9, 2010, at 4:47 PM, "nathanmarz" <nathan.marz at gmail.com> wrote:

> Can a message be ack'd by a different machine than the one that read
> it off the queue?
> 
> I'm working on a distributed stream processing system where it would
> be useful to have a downstream node do the acknowledgement.
> 
> Thanks in advance,
> Nathan
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From nathan.marz at gmail.com  Fri Dec 10 01:21:52 2010
From: nathan.marz at gmail.com (nathanmarz)
Date: Thu, 9 Dec 2010 17:21:52 -0800 (PST)
Subject: [rabbitmq-discuss] Ack by a different machine than consumer
In-Reply-To: <9D18351F-CCA3-4A09-B367-BCDE0EE6C10D@vmware.com>
References: <4b93c01b-f2b4-4690-b49d-b459f8adc402@j32g2000prh.googlegroups.com>
	<9D18351F-CCA3-4A09-B367-BCDE0EE6C10D@vmware.com>
Message-ID: <c361ce2a-b8d3-43dd-b9e5-ef4827803aa0@z17g2000prz.googlegroups.com>

Let's just say I'm working on the "Cascalog for stream-processing",
although the semantics of the tool will be quite different of course.
The goal is to be able to do distributed stream processing with the
details of fault tolerance and messaging abstracted away. The rest I'm
keeping secret for now :)

Alternatively, is it possible to ack messages out of order from how
you read them off the queue? Also, is it possible to set a timeout on
acking a message, so that if a message isn't acked within X secs it's
automatically considered failed and scheduled for redelivery?

Thanks,
Nathan



On Dec 9, 5:11?pm, Jerry Kuch <jer... at vmware.com> wrote:
> Hi, Nathan...
>
> I believe the delivery tag you'd use in ack-ing is only valid within the channel in which the message was received so the scheme you propose wouldn't be viable and you'd have to devise some scheme for signifying done-ness with the message's implied work beyond basic AMQP.
>
> BTW, Cascalog is a neat piece of work. ?Would be interested to know more about the system you're building if it's not confidential... ? :-)
>
> Jerry
>
> Sent from my iPhone (Brevity and typos are hopefully the result of 1-fingered typing rather than rudeness or illiteracy).
>
> On Dec 9, 2010, at 4:47 PM, "nathanmarz" <nathan.m... at gmail.com> wrote:
>
> > Can a message be ack'd by a different machine than the one that read
> > it off the queue?
>
> > I'm working on a distributed stream processing system where it would
> > be useful to have a downstream node do the acknowledgement.
>
> > Thanks in advance,
> > Nathan
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From akalend at mail.ru  Fri Dec 10 13:01:54 2010
From: akalend at mail.ru (Alexandre Kalendarev)
Date: Fri, 10 Dec 2010 16:01:54 +0300
Subject: [rabbitmq-discuss] the last version librabbitmq-c installation error
Message-ID: <E1PR2bi-0002Rs-00.akalend-mail-ru@f298.mail.ru>

the last version  installation  librabbitmq-c is error:

$:~/src/rabbitmq-c$ sudo autoreconf -i
Can't exec "libtoolize": No such file or directory at /usr/bin/autoreconf2.50 line 189.
Use of uninitialized value in pattern match (m//) at /usr/bin/autoreconf2.50 line 189.
configure.ac:13: warning: macro `AM_PROG_LIBTOOL' not found in library
librabbitmq/Makefile.am:1: Libtool library used but `LIBTOOL' is undefined
librabbitmq/Makefile.am:1:   The usual way to define `LIBTOOL' is to add `AC_PROG_LIBTOOL'
librabbitmq/Makefile.am:1:   to `configure.ac' and run `aclocal' and `autoconf' again.
librabbitmq/Makefile.am:1:   If `AC_PROG_LIBTOOL' is in `configure.ac', make sure
librabbitmq/Makefile.am:1:   its definition is in aclocal's search path.


the /usr/bin includes the files:

autoconf2.13
autoconf2.50
autoconf2.64
autoreconf
autoreconf2.13
autoreconf2.50
autoreconf2.64

What is the problem?

Alexandre

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101210/e710f5f1/attachment.htm>

From stephanion2002 at gmail.com  Fri Dec 10 16:57:03 2010
From: stephanion2002 at gmail.com (Kshitiz Garg)
Date: Fri, 10 Dec 2010 22:27:03 +0530
Subject: [rabbitmq-discuss] RabbitMQ persistence when clustering
In-Reply-To: <20101209233347.GA16011@wellquite.org>
References: <184d4c1b-3355-46a8-a2bc-d7e6bb6dc125@y19g2000prb.googlegroups.com>
	<20101209230910.GB2284@dakota.Home>
	<309f4eff-7647-446f-91e8-04d1beaadd0c@n2g2000pre.googlegroups.com>
	<20101209233347.GA16011@wellquite.org>
Message-ID: <AANLkTikL63JBS5RJg7iCW1sWH_XpVvJyr7kRF3MXXkiT@mail.gmail.com>

Thanks Matt,

Many users are waiting for this feature :)

Kshitiz Garg

On Fri, Dec 10, 2010 at 5:03 AM, Matthew Sackman <matthew at rabbitmq.com>wrote:

> On Thu, Dec 09, 2010 at 03:12:53PM -0800, nathanmarz wrote:
> > If it stays unavailable, are
> > there any future plans to ensure high availability of queues?
>
> Yes. I'm working on it right now.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101210/e7227e20/attachment.htm>

From fullergalway at gmail.com  Fri Dec 10 17:05:03 2010
From: fullergalway at gmail.com (Robert Fuller)
Date: Fri, 10 Dec 2010 17:05:03 +0000
Subject: [rabbitmq-discuss] client connect problems
In-Reply-To: <AANLkTimnT3jeBxEtEBeE1+coPr1AQAkqq6ahcm+GO4kV@mail.gmail.com>
References: <AANLkTi=Kz3fjE2cQw1UyXKiKh5MDFRwZdTRheAs3739a@mail.gmail.com>
	<DC070EC8-9ABD-4B08-9824-7E91ECD7D846@vmware.com>
	<AANLkTimnT3jeBxEtEBeE1+coPr1AQAkqq6ahcm+GO4kV@mail.gmail.com>
Message-ID: <AANLkTi=vmh91uYvuPSHy6wMu0W5_otUpWWL5gOCcpmYg@mail.gmail.com>

Hi,

I found the hadoop task processes hanging around because my code did
not always close the rabbitmq connection. I fixed the bug in my code
and now, voila, no more client connect problems.

Thanks again!
Rob.

On 3 December 2010 18:25, Robert Fuller <fullergalway at gmail.com> wrote:
> Thanks Jerry,
>
> I used `rabbitmqctl list_connections` to find 436 connections. Hmmn.
> More than I expected.
>
> I logged into one of the (hadoop map/reduce) servers, and I can see
> that some processes for old hadoop task attempts are hanging around,
> so yes it looks like i'm not playing nicely.
>
> I'll look into it further on Monday.
>
> Thanks,
> Rob
>
> On 3 December 2010 18:11, Jerry Kuch <jerryk at vmware.com> wrote:
>> Hi, Robert.
>>
>> With a broker version this new, these things are often either a misbehaving client, or the broker running in an environment where there's a resource limit configuration problem, e.g. running out of file descriptors.
>>
>> Here are a few things to investigate in such circumstances (derived from a support incident on an older Rabbit version, but most of this remains sensible stuff to check).
>>
>> Please let us know how it goes. ?If none of the above yield meaningful clues, would you feel comfortable sharing some snippets of your client code with which you're encountering the problem?
>>
>> Jerry
>>
>> ==============
>>
>> ?Here's a quick laundry list of things to investigate when one
>> ?encounters problems of this flavor.
>>
>> ?- check `ulimit -n` as whichever user is being used to run rabbit;
>> ? depending on your system this may be the 'rabbitmq' user. ?Be wary
>> ? of raised limits not making it to the user/shell/process one
>> ? wanted them to. ?Again, newer Rabbits will announce at startup
>> ? time what sort of file handle limits they think they're working under
>> ? with a log message something like:
>>
>> ? ? ? ? ? =INFO REPORT==== 2-Dec-2010::14:37:38 ===
>> ? ? ? ?Limiting to approx 156 file handles (138 sockets)
>>
>> ?This example is from my desktop machine where by default 'ulimit -n'
>> ?gives 256, a value that's likely rather too low for a broker that's going
>> ?to be serving a lot of clients.
>>
>> ?- check the logs for memory alarms; severe memory pressure can cause
>> ? Rabbit to start refusing connections.
>>
>> ?- check that Rabbit hasn't run out of sockets; to do this use
>> ? `rabbitmqctl list_connections` and netstat to see if there are
>> ? suspiciously large numbers of existing connections. ?Client
>> ? misbehavior may cause this on an otherwise healthy Rabbit.
>>
>> ?- check the rabbit-sasl.log and the main rabbit.log for any sign
>> ? that the tcp listener/acceptor process has crashed or misbehaved.
>> ? Look for 'CRASH REPORT' entries in the logs and mentions of
>> ? 'tcp_acceptor', 'cannot_accept' , "{error,emfile}" and similar.
>>
>> ?- is Rabbit spinning frantically? ?Check 'top' and your preferred
>> ? process monitoring tools to see if you have Rabbit beam.smp
>> ? processes consuming large amounts of CPU while the problem is
>> ? manifesting. [ In your current case it seems you've ruled this out
>> ? already]
>>
>> ?- generally scour rabbit.log and rabbit-sasl.log for suspicious errors.
>>
>> ?- use 'rabbitmqctl list_WHATEVER' for WHATEVERs including connections,
>> ? channels, exchanges, queues, bindings, etc. to see if there are
>> ? unexpectedly massive quantities of anything. ?Also check your
>> ? queues to see if any have absurd numbers of messages languishing
>> ? in them, as this could indicate a misbehaving client application.
>>
>> On Dec 3, 2010, at 4:03 AM, Robert Fuller wrote:
>>
>>> Hi,
>>>
>>> I had an issue for several hours where clients from many hosts were
>>> not able to connect to a running rabbitmq server (2.2.0). list_queues
>>> showed only a small number of items in the queues. Eventually after
>>> restarting rabbitmq server everything returned immediately to normal.
>>>
>>> client stack seems to be sometimes this:
>>> java.net.ConnectException: Connection timed out
>>> ? ? ? at java.net.PlainSocketImpl.socketConnect(Native Method)
>>> ? ? ? at java.net.PlainSocketImpl.doConnect(PlainSocketImpl.java:333)
>>> ? ? ? at java.net.PlainSocketImpl.connectToAddress(PlainSocketImpl.java:195)
>>> ? ? ? at java.net.PlainSocketImpl.connect(PlainSocketImpl.java:182)
>>> ? ? ? at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:366)
>>> ? ? ? at java.net.Socket.connect(Socket.java:529)
>>> ? ? ? at java.net.Socket.connect(Socket.java:478)
>>> ? ? ? at com.rabbitmq.client.ConnectionFactory.createFrameHandler(ConnectionFactory.java:338)
>>> ? ? ? at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:376)
>>>
>>>
>>> and sometimes this:
>>> java.io.IOException
>>> ? ? ? at com.rabbitmq.client.impl.AMQChannel.wrap(AMQChannel.java:121)
>>> ? ? ? at com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:274)
>>> ? ? ? at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:379)
>>> ? ? ? at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:399)
>>> ...
>>> Caused by: com.rabbitmq.client.ShutdownSignalException: connection
>>> error; reason: java.net.SocketException: Connection reset
>>> ? ? ? at com.rabbitmq.utility.ValueOrException.getValue(ValueOrException.java:81)
>>> ? ? ? at com.rabbitmq.utility.BlockingValueOrException.uninterruptibleGetValue(BlockingValueOrException.java:47)
>>> ? ? ? at com.rabbitmq.client.impl.AMQChannel$BlockingRpcContinuation.getReply(AMQChannel.java:342)
>>> ? ? ? at com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:258)
>>> ? ? ? ... 39 more
>>> Caused by: java.net.SocketException: Connection reset
>>> ? ? ? at java.net.SocketInputStream.read(SocketInputStream.java:168)
>>> ? ? ? at java.io.BufferedInputStream.fill(BufferedInputStream.java:218)
>>> ? ? ? at java.io.BufferedInputStream.read(BufferedInputStream.java:237)
>>> ? ? ? at java.io.DataInputStream.readUnsignedByte(DataInputStream.java:271)
>>> ? ? ? at com.rabbitmq.client.impl.Frame.readFrom(Frame.java:118)
>>> ? ? ? at com.rabbitmq.client.impl.SocketFrameHandler.readFrame(SocketFrameHandler.java:155)
>>> ? ? ? at com.rabbitmq.client.impl.AMQConnection.readFrame(AMQConnection.java:393)
>>> ? ? ? at com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:421)
>>>
>>>
>>>
>>> I could see nothing unusual on the server using top (memory and cpu
>>> usage ok), or in the rabbitmq logs.
>>>
>>> What can I do to produce you a log on the server should this situation re-occur?
>>>
>>> Thanks,
>>> Rob.
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>

From jerryk at vmware.com  Fri Dec 10 17:06:13 2010
From: jerryk at vmware.com (Jerry Kuch)
Date: Fri, 10 Dec 2010 09:06:13 -0800
Subject: [rabbitmq-discuss] client connect problems
In-Reply-To: <AANLkTi=vmh91uYvuPSHy6wMu0W5_otUpWWL5gOCcpmYg@mail.gmail.com>
References: <AANLkTi=Kz3fjE2cQw1UyXKiKh5MDFRwZdTRheAs3739a@mail.gmail.com>
	<DC070EC8-9ABD-4B08-9824-7E91ECD7D846@vmware.com>
	<AANLkTimnT3jeBxEtEBeE1+coPr1AQAkqq6ahcm+GO4kV@mail.gmail.com>
	<AANLkTi=vmh91uYvuPSHy6wMu0W5_otUpWWL5gOCcpmYg@mail.gmail.com>
Message-ID: <F89764B1-9DD8-4421-B519-1706A6C5CC79@vmware.com>

Hi, Robert...

Glad to hear the problem's resolved.  Please let us know if you need anything else!

Best regards,
Jerry

On Dec 10, 2010, at 9:05 AM, Robert Fuller wrote:

> Hi,
> 
> I found the hadoop task processes hanging around because my code did
> not always close the rabbitmq connection. I fixed the bug in my code
> and now, voila, no more client connect problems.
> 
> Thanks again!
> Rob.
> 
> On 3 December 2010 18:25, Robert Fuller <fullergalway at gmail.com> wrote:
>> Thanks Jerry,
>> 
>> I used `rabbitmqctl list_connections` to find 436 connections. Hmmn.
>> More than I expected.
>> 
>> I logged into one of the (hadoop map/reduce) servers, and I can see
>> that some processes for old hadoop task attempts are hanging around,
>> so yes it looks like i'm not playing nicely.
>> 
>> I'll look into it further on Monday.
>> 
>> Thanks,
>> Rob
>> 
>> On 3 December 2010 18:11, Jerry Kuch <jerryk at vmware.com> wrote:
>>> Hi, Robert.
>>> 
>>> With a broker version this new, these things are often either a misbehaving client, or the broker running in an environment where there's a resource limit configuration problem, e.g. running out of file descriptors.
>>> 
>>> Here are a few things to investigate in such circumstances (derived from a support incident on an older Rabbit version, but most of this remains sensible stuff to check).
>>> 
>>> Please let us know how it goes.  If none of the above yield meaningful clues, would you feel comfortable sharing some snippets of your client code with which you're encountering the problem?
>>> 
>>> Jerry
>>> 
>>> ==============
>>> 
>>>  Here's a quick laundry list of things to investigate when one
>>>  encounters problems of this flavor.
>>> 
>>>  - check `ulimit -n` as whichever user is being used to run rabbit;
>>>   depending on your system this may be the 'rabbitmq' user.  Be wary
>>>   of raised limits not making it to the user/shell/process one
>>>   wanted them to.  Again, newer Rabbits will announce at startup
>>>   time what sort of file handle limits they think they're working under
>>>   with a log message something like:
>>> 
>>>           =INFO REPORT==== 2-Dec-2010::14:37:38 ===
>>>        Limiting to approx 156 file handles (138 sockets)
>>> 
>>>  This example is from my desktop machine where by default 'ulimit -n'
>>>  gives 256, a value that's likely rather too low for a broker that's going
>>>  to be serving a lot of clients.
>>> 
>>>  - check the logs for memory alarms; severe memory pressure can cause
>>>   Rabbit to start refusing connections.
>>> 
>>>  - check that Rabbit hasn't run out of sockets; to do this use
>>>   `rabbitmqctl list_connections` and netstat to see if there are
>>>   suspiciously large numbers of existing connections.  Client
>>>   misbehavior may cause this on an otherwise healthy Rabbit.
>>> 
>>>  - check the rabbit-sasl.log and the main rabbit.log for any sign
>>>   that the tcp listener/acceptor process has crashed or misbehaved.
>>>   Look for 'CRASH REPORT' entries in the logs and mentions of
>>>   'tcp_acceptor', 'cannot_accept' , "{error,emfile}" and similar.
>>> 
>>>  - is Rabbit spinning frantically?  Check 'top' and your preferred
>>>   process monitoring tools to see if you have Rabbit beam.smp
>>>   processes consuming large amounts of CPU while the problem is
>>>   manifesting. [ In your current case it seems you've ruled this out
>>>   already]
>>> 
>>>  - generally scour rabbit.log and rabbit-sasl.log for suspicious errors.
>>> 
>>>  - use 'rabbitmqctl list_WHATEVER' for WHATEVERs including connections,
>>>   channels, exchanges, queues, bindings, etc. to see if there are
>>>   unexpectedly massive quantities of anything.  Also check your
>>>   queues to see if any have absurd numbers of messages languishing
>>>   in them, as this could indicate a misbehaving client application.
>>> 
>>> On Dec 3, 2010, at 4:03 AM, Robert Fuller wrote:
>>> 
>>>> Hi,
>>>> 
>>>> I had an issue for several hours where clients from many hosts were
>>>> not able to connect to a running rabbitmq server (2.2.0). list_queues
>>>> showed only a small number of items in the queues. Eventually after
>>>> restarting rabbitmq server everything returned immediately to normal.
>>>> 
>>>> client stack seems to be sometimes this:
>>>> java.net.ConnectException: Connection timed out
>>>>       at java.net.PlainSocketImpl.socketConnect(Native Method)
>>>>       at java.net.PlainSocketImpl.doConnect(PlainSocketImpl.java:333)
>>>>       at java.net.PlainSocketImpl.connectToAddress(PlainSocketImpl.java:195)
>>>>       at java.net.PlainSocketImpl.connect(PlainSocketImpl.java:182)
>>>>       at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:366)
>>>>       at java.net.Socket.connect(Socket.java:529)
>>>>       at java.net.Socket.connect(Socket.java:478)
>>>>       at com.rabbitmq.client.ConnectionFactory.createFrameHandler(ConnectionFactory.java:338)
>>>>       at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:376)
>>>> 
>>>> 
>>>> and sometimes this:
>>>> java.io.IOException
>>>>       at com.rabbitmq.client.impl.AMQChannel.wrap(AMQChannel.java:121)
>>>>       at com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:274)
>>>>       at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:379)
>>>>       at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:399)
>>>> ...
>>>> Caused by: com.rabbitmq.client.ShutdownSignalException: connection
>>>> error; reason: java.net.SocketException: Connection reset
>>>>       at com.rabbitmq.utility.ValueOrException.getValue(ValueOrException.java:81)
>>>>       at com.rabbitmq.utility.BlockingValueOrException.uninterruptibleGetValue(BlockingValueOrException.java:47)
>>>>       at com.rabbitmq.client.impl.AMQChannel$BlockingRpcContinuation.getReply(AMQChannel.java:342)
>>>>       at com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:258)
>>>>       ... 39 more
>>>> Caused by: java.net.SocketException: Connection reset
>>>>       at java.net.SocketInputStream.read(SocketInputStream.java:168)
>>>>       at java.io.BufferedInputStream.fill(BufferedInputStream.java:218)
>>>>       at java.io.BufferedInputStream.read(BufferedInputStream.java:237)
>>>>       at java.io.DataInputStream.readUnsignedByte(DataInputStream.java:271)
>>>>       at com.rabbitmq.client.impl.Frame.readFrom(Frame.java:118)
>>>>       at com.rabbitmq.client.impl.SocketFrameHandler.readFrame(SocketFrameHandler.java:155)
>>>>       at com.rabbitmq.client.impl.AMQConnection.readFrame(AMQConnection.java:393)
>>>>       at com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:421)
>>>> 
>>>> 
>>>> 
>>>> I could see nothing unusual on the server using top (memory and cpu
>>>> usage ok), or in the rabbitmq logs.
>>>> 
>>>> What can I do to produce you a log on the server should this situation re-occur?
>>>> 
>>>> Thanks,
>>>> Rob.
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> 
>>> 
>> 


From taylste at gmail.com  Fri Dec 10 18:26:02 2010
From: taylste at gmail.com (Steven Taylor)
Date: Fri, 10 Dec 2010 18:26:02 +0000
Subject: [rabbitmq-discuss] routing key advice + QueueBind(...)
Message-ID: <AANLkTik=mWeMp9EWqD3mHcHqjxW-iTOdtXYNgufLyGNK@mail.gmail.com>

Hi,

are there any good RMQ examples, or documentation for routing keys?

Essentially, I'd like to have a control stream that can accept broadcasts
for all nodes, messages for a type of node, or messages intended for a
specific node (or subtype).

all.category1.nodeType.nodeName

potential routing keys:
all.*
*.nodeType.*
 all.category1.nodeType.nodeName   -- full path

On a per node basis, is that three extra channels & 3 extra threads?  OR: I
figure it'd be easier if these three routing keys were attached to one
queue. Is there a secret comma operator for routing keys that I'm not aware
of for use with QueueBind?  If I call QueueBind three times, will the result
be cumulative? Are channels expensive on the RMQ server? How about on the
client side?

I'll be testing this, but if someone could provide a little advice it'd be
appreciated.

thanks,
-Steven
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101210/857b010c/attachment.htm>

From jerryk at vmware.com  Fri Dec 10 18:45:06 2010
From: jerryk at vmware.com (Jerry Kuch)
Date: Fri, 10 Dec 2010 10:45:06 -0800
Subject: [rabbitmq-discuss] routing key advice + QueueBind(...)
In-Reply-To: <AANLkTik=mWeMp9EWqD3mHcHqjxW-iTOdtXYNgufLyGNK@mail.gmail.com>
References: <AANLkTik=mWeMp9EWqD3mHcHqjxW-iTOdtXYNgufLyGNK@mail.gmail.com>
Message-ID: <D04FBDF7-5EAB-4762-9A5E-3A1842D23081@vmware.com>

Hi, Steven...

> are there any good RMQ examples, or documentation for routing keys?

Which client are you using?  The Java API user's guide has some concise examples of the nitty-gritty on creating exchanges, bindings and routing keys:

http://www.rabbitmq.com/api-guide.html

The theory of operation for routing keys is explained in the FAQ around here:

http://www.rabbitmq.com/faq.html#managing-concepts-exchanges

Below I've added some more specific pointers to FAQ sections you might find helpful.

Also, the unit tests for the Java client contain examples you might find useful as starting points and inspiration.  You'd want to download the "source code and tools" distributions of the Java client from:  http://www.rabbitmq.com/java-client.html if you haven't already got it.

> On a per node basis, is that three extra channels & 3 extra threads?  OR: I figure it'd be easier if these three routing keys were attached to one queue. Is there a secret comma operator for routing keys that I'm not aware of for use with QueueBind?  If I call QueueBind three times, will the result be cumulative?

You can declare multiple routing keys for a single queue.  Please, consult the FAQ entries below and certainly drop us another note if those don't help:

See:  http://www.rabbitmq.com/faq.html#declare-multiple-routing-keys-for-single-queue

and its immediate predecessors in the FAQ.  Creating separate bindings for each key you're interested in, as you suggest, is the right thing to do.

> Are channels expensive on the RMQ server? How about on the client side? 

Channels are designed to be pretty cheap, whereas connections aren't because there's an actual TCP connection behind each one.  Multiplexing many channels to one connection lets us avoid duplicating the really heavyweight part.

Best regards,
Jerry


From jerryk at vmware.com  Fri Dec 10 18:59:48 2010
From: jerryk at vmware.com (Jerry Kuch)
Date: Fri, 10 Dec 2010 10:59:48 -0800
Subject: [rabbitmq-discuss] routing key advice + QueueBind(...)
In-Reply-To: <AANLkTik=mWeMp9EWqD3mHcHqjxW-iTOdtXYNgufLyGNK@mail.gmail.com>
References: <AANLkTik=mWeMp9EWqD3mHcHqjxW-iTOdtXYNgufLyGNK@mail.gmail.com>
Message-ID: <CAA0AA8F-AB13-4406-968D-00836639E578@vmware.com>

Also, I neglected to mention the tutorials...

http://www.rabbitmq.com/how.html

The section "Messaging Patterns and Common Scenarios" contains links to a bunch of messaging patterns and idioms that people have found useful in practice and how to realize them on AMQP/Rabbit.

Best regards,
Jerry

On Dec 10, 2010, at 10:26 AM, Steven Taylor wrote:

> Hi,
>  
> are there any good RMQ examples, or documentation for routing keys?
>  
> Essentially, I'd like to have a control stream that can accept broadcasts for all nodes, messages for a type of node, or messages intended for a specific node (or subtype).
>  
> all.category1.nodeType.nodeName
>  
> potential routing keys:
> all.*
> *.nodeType.*
> all.category1.nodeType.nodeName   -- full path
>  
> On a per node basis, is that three extra channels & 3 extra threads?  OR: I figure it'd be easier if these three routing keys were attached to one queue. Is there a secret comma operator for routing keys that I'm not aware of for use with QueueBind?  If I call QueueBind three times, will the result be cumulative? Are channels expensive on the RMQ server? How about on the client side? 
>  
> I'll be testing this, but if someone could provide a little advice it'd be appreciated.
>  
> thanks,
> -Steven
> <ATT00001..txt>


From taylste at gmail.com  Fri Dec 10 19:21:16 2010
From: taylste at gmail.com (Steven Taylor)
Date: Fri, 10 Dec 2010 19:21:16 +0000
Subject: [rabbitmq-discuss] routing key advice + QueueBind(...)
In-Reply-To: <CAA0AA8F-AB13-4406-968D-00836639E578@vmware.com>
References: <AANLkTik=mWeMp9EWqD3mHcHqjxW-iTOdtXYNgufLyGNK@mail.gmail.com>
	<CAA0AA8F-AB13-4406-968D-00836639E578@vmware.com>
Message-ID: <AANLkTi=8=GKnCrRaaqq6n8iWNdz5dvtK3NV8y_GusLFV@mail.gmail.com>

Hi Jerry,

thanks for the reply.  That's good news on the multiple bindings.  The more
that I get to know RabbitMQ, the more I like it.

I'm using the C# .Net client at the moment (might like to add another
language client or two in future).

I had found the api guide, and faq.  I haven't explored the java library
yet. I looked at  + played with the .net examples: declareQueue, perf test,
subscriber, etc.  I also looked at a bunch of the presentations such as the
one that Alexis did at Google. BTW: the getting started guide with the
python/java examples is quite good.

I'm at the stage where I need to solve specific problems / issues + choose
an optimum exchange / routing setups. I'm sure you've been there yourself
i.e. high level pretty good. Low level -- like that example was easy, I can
see how that worked, but still stumbling around a little bit in the code for
my stuff type of thing. Getting there. If you guys can help me put my hands
on some of these specifics I'd appreciate that.

thanks,
-Steven

On 10 December 2010 18:59, Jerry Kuch <jerryk at vmware.com> wrote:

> Also, I neglected to mention the tutorials...
>
> http://www.rabbitmq.com/how.html
>
> The section "Messaging Patterns and Common Scenarios" contains links to a
> bunch of messaging patterns and idioms that people have found useful in
> practice and how to realize them on AMQP/Rabbit.
>
> Best regards,
> Jerry
>
> On Dec 10, 2010, at 10:26 AM, Steven Taylor wrote:
>
> > Hi,
> >
> > are there any good RMQ examples, or documentation for routing keys?
> >
> > Essentially, I'd like to have a control stream that can accept broadcasts
> for all nodes, messages for a type of node, or messages intended for a
> specific node (or subtype).
> >
> > all.category1.nodeType.nodeName
> >
> > potential routing keys:
> > all.*
> > *.nodeType.*
> > all.category1.nodeType.nodeName   -- full path
> >
> > On a per node basis, is that three extra channels & 3 extra threads?  OR:
> I figure it'd be easier if these three routing keys were attached to one
> queue. Is there a secret comma operator for routing keys that I'm not aware
> of for use with QueueBind?  If I call QueueBind three times, will the result
> be cumulative? Are channels expensive on the RMQ server? How about on the
> client side?
> >
> > I'll be testing this, but if someone could provide a little advice it'd
> be appreciated.
> >
> > thanks,
> > -Steven
> > <ATT00001..txt>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101210/afcfb6df/attachment.htm>

From jerryk at vmware.com  Fri Dec 10 19:44:30 2010
From: jerryk at vmware.com (Jerry Kuch)
Date: Fri, 10 Dec 2010 11:44:30 -0800
Subject: [rabbitmq-discuss] routing key advice + QueueBind(...)
In-Reply-To: <AANLkTi=8=GKnCrRaaqq6n8iWNdz5dvtK3NV8y_GusLFV@mail.gmail.com>
References: <AANLkTik=mWeMp9EWqD3mHcHqjxW-iTOdtXYNgufLyGNK@mail.gmail.com>
	<CAA0AA8F-AB13-4406-968D-00836639E578@vmware.com>
	<AANLkTi=8=GKnCrRaaqq6n8iWNdz5dvtK3NV8y_GusLFV@mail.gmail.com>
Message-ID: <EAE05FB1-A98C-407A-80DA-6993CCDF0D4D@vmware.com>


On Dec 10, 2010, at 11:21 AM, Steven Taylor wrote:

> thanks for the reply.  That's good news on the multiple bindings.  The more that I get to know RabbitMQ, the more I like it.
>  
> I'm using the C# .Net client at the moment (might like to add another language client or two in future).

I don't know that client very well myself, but poking around in its source code it has enough similarities to the Java one that the latter might still be somewhat instructive in cases.

>  I had found the api guide, and faq.  I haven't explored the java library yet. I looked at  + played with the .net examples: declareQueue, perf test, subscriber, etc.  I also looked at a bunch of the presentations such as the one that Alexis did at Google. BTW: the getting started guide with the python/java examples is quite good.

I believe more of those are going to be forthcoming, so, as they say, "watch that space."

>  I'm at the stage where I need to solve specific problems / issues + choose an optimum exchange / routing setups. I'm sure you've been there yourself i.e. high level pretty good. Low level -- like that example was easy, I can see how that worked, but still stumbling around a little bit in the code for my stuff type of thing. Getting there. If you guys can help me put my hands on some of these specifics I'd appreciate that.

Absolutely.  We're happy to help.  

Filling in the gap between the high level structure and the details of the implementation with best practices and the locally tasteful idioms takes a bit of time, but, in general Rabbit, its code, and its documentation reward study.  The team and community are generally active and interested in helping out newcomers to the community.

Also there's an upcoming book on Rabbit that you might find useful:

http://www.manning.com/videla/

The first couple of chapters are available from the publisher in an early-access/preview edition.  It looks like it will fill an important niche in the Rabbit ecosystem as it comes together.

Jerry


From brodrigu at gmail.com  Fri Dec 10 20:33:17 2010
From: brodrigu at gmail.com (Brad Rodriguez)
Date: Fri, 10 Dec 2010 12:33:17 -0800
Subject: [rabbitmq-discuss] [ANNOUNCEMENT] amqp-0.2.0 (beta) Released.
Message-ID: <536373C6-2BDB-4CC7-B66F-576A4A760314@gmail.com>


The new PECL package amqp-0.2.0 (beta) has been released at
http://pecl.php.net/.

Release notes
-------------
Works with AMQP 0-8 and 0-9-1 (used by RabbitMQ 2.*)
Modified AMQPConnection object:
   * Requires call to 'connect' method to connect (no longer connects on
instantiation)
   * Added support for disconnect and reconnect
   * Added helper setters for port, host, vhost, login and password
Improved consume method to block for MIN messages, and try to get MAX
messages if available
Fixed zval descoping bugs
Fixed bugs:
   * 17809: Couldn't compile pecl extension under PHP 5.3
   * 17831: Segmentation fault when the exchange doesn't exists
   * 19707: AMQPQueue::get() doesn't return the message
   * 19840: Connection Exception

Package Info
-------------
This extension can communicate with any AMQP spec 0-9-1 compatible server,
such as RabbitMQ, OpenAMQP and Qpid, giving you the ability to create and
delete exchanges and queues, as well as publish to any exchange and consume
from any queue.

Related Links
-------------
Package home: http://pecl.php.net/package/amqp
  Changelog: http://pecl.php.net/package-changelog.php?package=amqp
   Download: http://pecl.php.net/get/amqp-0.2.0.tgz

Authors
-------------
Pieter de Zwart (lead)

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101210/389d9d27/attachment-0001.htm>

From jerryk at vmware.com  Fri Dec 10 21:11:21 2010
From: jerryk at vmware.com (Jerry Kuch)
Date: Fri, 10 Dec 2010 13:11:21 -0800
Subject: [rabbitmq-discuss] routing key advice + QueueBind(...)
In-Reply-To: <AANLkTi=PQJj8wP2UYfi-gnxEJ-JMtg_RkuZiaOx3VF1h@mail.gmail.com>
References: <AANLkTik=mWeMp9EWqD3mHcHqjxW-iTOdtXYNgufLyGNK@mail.gmail.com>
	<CAA0AA8F-AB13-4406-968D-00836639E578@vmware.com>
	<AANLkTi=8=GKnCrRaaqq6n8iWNdz5dvtK3NV8y_GusLFV@mail.gmail.com>
	<EAE05FB1-A98C-407A-80DA-6993CCDF0D4D@vmware.com>
	<AANLkTi=Y0dYk7Hp9ibgPk1cjr32FbAaXUtmM0Tm2vwA1@mail.gmail.com>
	<AANLkTi=PQJj8wP2UYfi-gnxEJ-JMtg_RkuZiaOx3VF1h@mail.gmail.com>
Message-ID: <0D39B66A-6431-4FCC-80B9-2E843E44FDEE@vmware.com>

Hi, Steven:

The doc for the Java client's method is here:

http://www.rabbitmq.com/javadoc/com/rabbitmq/client/impl/AMQImpl.Exchange.Bind.html

The ideas behind it are captured here:

http://www.rabbitmq.com/extensions.html

The 'exchange.bind' method is used to bind one exchange to another exchange, with behavior akin to how an exchange-queue binding works.

Using this you can create more elaborate or hierarchical routing topologies within your broker.

We've also implemented but not yet released "internal exchanges," as per the AMQP spec, which are exchanges that can only be used "on the inside" in these exchange-to-exchange scenarios (i.e. an external client can't publish to them).  Thus, internal exchanges can of codify and protect their role as internal routing plumbing and not let clients leak messages into your routing setup in unexpected ways.  Internal exchanges ought to debut in a relatively soon to come release, but I don't know precisely when.

(In case you've already thought to worry, cycle eliminations and message de-duplications are taken care of by the broker, for both exchange and queue bindings, so you don't have to worry about a topological misstep creating perpetual messaging machines, ending up with unexpected duplicate deliveries, etc.)

Best regards,
Jerry

On Dec 10, 2010, at 12:31 PM, Steven Taylor wrote:

is there any information available on ExchangeBind()?  Looks similar to QueueBind.

-Steven

On 10 December 2010 20:29, Steven Taylor <taylste at gmail.com<mailto:taylste at gmail.com>> wrote:
Just notice an ExchangeBind(...) function.

So is it better to cluster similar ideas by exchange or with routing keys?  Previously I was clustering similar ideas by exchange.

thanks,
-Steven

On 10 December 2010 19:44, Jerry Kuch <jerryk at vmware.com<mailto:jerryk at vmware.com>> wrote:

On Dec 10, 2010, at 11:21 AM, Steven Taylor wrote:

> thanks for the reply.  That's good news on the multiple bindings.  The more that I get to know RabbitMQ, the more I like it.
>
> I'm using the C# .Net client at the moment (might like to add another language client or two in future).

I don't know that client very well myself, but poking around in its source code it has enough similarities to the Java one that the latter might still be somewhat instructive in cases.

>  I had found the api guide, and faq.  I haven't explored the java library yet. I looked at  + played with the .net examples: declareQueue, perf test, subscriber, etc.  I also looked at a bunch of the presentations such as the one that Alexis did at Google. BTW: the getting started guide with the python/java examples is quite good.

I believe more of those are going to be forthcoming, so, as they say, "watch that space."

>  I'm at the stage where I need to solve specific problems / issues + choose an optimum exchange / routing setups. I'm sure you've been there yourself i.e. high level pretty good. Low level -- like that example was easy, I can see how that worked, but still stumbling around a little bit in the code for my stuff type of thing. Getting there. If you guys can help me put my hands on some of these specifics I'd appreciate that.

Absolutely.  We're happy to help.

Filling in the gap between the high level structure and the details of the implementation with best practices and the locally tasteful idioms takes a bit of time, but, in general Rabbit, its code, and its documentation reward study.  The team and community are generally active and interested in helping out newcomers to the community.

Also there's an upcoming book on Rabbit that you might find useful:

http://www.manning.com/videla/

The first couple of chapters are available from the publisher in an early-access/preview edition.  It looks like it will fill an important niche in the Rabbit ecosystem as it comes together.

Jerry





From jerryk at vmware.com  Fri Dec 10 22:45:50 2010
From: jerryk at vmware.com (Jerry Kuch)
Date: Fri, 10 Dec 2010 14:45:50 -0800
Subject: [rabbitmq-discuss] Ack by a different machine than consumer
In-Reply-To: <AANLkTinHj7xj-VOox1=SH0P98E529Zq25RaoXcRpVXvY@mail.gmail.com>
References: <4b93c01b-f2b4-4690-b49d-b459f8adc402@j32g2000prh.googlegroups.com>
	<9D18351F-CCA3-4A09-B367-BCDE0EE6C10D@vmware.com>
	<c361ce2a-b8d3-43dd-b9e5-ef4827803aa0@z17g2000prz.googlegroups.com>
	<9BB883B7-6F2A-41CE-9998-E20122B99DA8@vmware.com>
	<AANLkTinHj7xj-VOox1=SH0P98E529Zq25RaoXcRpVXvY@mail.gmail.com>
Message-ID: <7D2F2C7B-99C2-4470-938A-758416761705@vmware.com>

Hi, Nathan...

(cc-ing rabbitmq-discuss so that other folks who've been around Rabbit longer than I have can chime in as well).

Thanks for the additional motivation...  I think variations on this request have come up in discussion before, so let's keep some other eyes on the topic...

So in this system I'm developing, a message from a persistent queue like RabbitMQ will trigger a computation across the cluster, creating potentially many messages and involving many machines. I don't want to ack the message until all the computations it has triggered has finished.  I have a way of detecting this efficiently and reliably, and it's a different machine than the one that read the message off the queue that will know the message is ready to be acked.

Out of curiosity what are you using as your distributed coordination mechanism over the other machines and processes involved in your cluster?  I wonder if perhaps there's some information available to or through it that your Rabbit-facing processes might be able to use straightforwardly...

If there's a failure at any point (like an exception or machine going down), the system will never detect that the computations for the message has finished. So I want to handle this by putting a time limit on how long the system has to process the message. This is where setting timeouts on acking would come in, and it would be very useful.

Gotcha...  I follow where you're going...

What I'm going to have to do to get RabbitMQ viable as a source for this system is handle acking/timeouts on the node that reads from RabbitMQ. When the downstream node detects that the message is finished, it will have to send a message to the reader node to ack the message. The reader node will also have to cache messages in memory and have a separate thread explicitly reject messages that are in the cache for too long. Not terrible, but would be nice if this was native in RabbitMQ.

Right.  As stated your design sketch sounds totally viable although, as you say, it does put work into your application that one might prefer to have done elsewhere... :-)

You get correctness out of the deal in that your intermediate reader process that owns the channel on which the original do-work message was de-queued will make the message available for later consumption by someone else if it dies, but of course it has to implement its own safekeeping and timeout logic for deciding when to give up on things.  Via basic.reject it also gets the option of throwing the message back to be handled again later or condemning it to oblivion.

Jerry


On Fri, Dec 10, 2010 at 9:55 AM, Jerry Kuch <jerryk at vmware.com<mailto:jerryk at vmware.com>> wrote:
Hi, Nathan...

On Dec 9, 2010, at 5:21 PM, nathanmarz wrote:

> Let's just say I'm working on the "Cascalog for stream-processing",
> although the semantics of the tool will be quite different of course.
> The goal is to be able to do distributed stream processing with the
> details of fault tolerance and messaging abstracted away. The rest I'm
> keeping secret for now :)

Very interesting...  I look forward to seeing it develop!

> Alternatively, is it possible to ack messages out of order from how
> you read them off the queue?

It is indeed.

In AMQP, acking a message tells the broker that you have received it and taken responsibility for its contents, and that the broker no longer has to take any measures to ensure its integrity or existence.

When you take a message off a queue, say with 'basic.get', it still exists on the server, but is unavailable to other consumers until such time as you 'basic.ack' it.  If you basic.ack the message, the message is removed from the server.  If your channel or connection dies, the message is again made available for other consumers.

If you pulled a smattering of messages from a queue and dispatched them to separate workers in your application, and your workers finished and sent acks in some order other than the order in which the messages were enqueued, there's no problem at all.

> Also, is it possible to set a timeout on
> acking a message, so that if a message isn't acked within X secs it's
> automatically considered failed and scheduled for redelivery?

Such a mechanism doesn't currently exist.  In practice, this usually won't be a problem since failure to ack (modulo the case of a consumer that's alive but paralyzed for some reason) is typically the result of network troubles or client death, both of which will result in the connection being closed.  If the connection closes, the un-acked message on the server becomes available for other clients to get or consume.

Are there specific aspects of your desired use case that make such a timeout-waiting-for-ack super important?

Best regards,
Jerry




--
Twitter: @nathanmarz
http://nathanmarz.com<http://nathanmarz.com/>



From nathan.marz at gmail.com  Fri Dec 10 23:09:06 2010
From: nathan.marz at gmail.com (nathanmarz)
Date: Fri, 10 Dec 2010 15:09:06 -0800 (PST)
Subject: [rabbitmq-discuss] Ack by a different machine than consumer
In-Reply-To: <7D2F2C7B-99C2-4470-938A-758416761705@vmware.com>
References: <4b93c01b-f2b4-4690-b49d-b459f8adc402@j32g2000prh.googlegroups.com>
	<9D18351F-CCA3-4A09-B367-BCDE0EE6C10D@vmware.com>
	<c361ce2a-b8d3-43dd-b9e5-ef4827803aa0@z17g2000prz.googlegroups.com>
	<9BB883B7-6F2A-41CE-9998-E20122B99DA8@vmware.com>
	<AANLkTinHj7xj-VOox1=SH0P98E529Zq25RaoXcRpVXvY@mail.gmail.com>
	<7D2F2C7B-99C2-4470-938A-758416761705@vmware.com>
Message-ID: <f1a78fae-d3aa-4f6b-b3b8-85f92fe5c360@i32g2000pri.googlegroups.com>

There will be a master machine assigning processes to machines and
reassigning tasks when necessary in case of failures. It'll play a
similar role as the JobTracker does in Hadoop. Communication of who's
supposed to communicate to who will be done using Zookeeper.


On Dec 10, 2:45?pm, Jerry Kuch <jer... at vmware.com> wrote:
> Hi, Nathan...
>
> (cc-ing rabbitmq-discuss so that other folks who've been around Rabbit longer than I have can chime in as well).
>
> Thanks for the additional motivation... ?I think variations on this request have come up in discussion before, so let's keep some other eyes on the topic...
>
> So in this system I'm developing, a message from a persistent queue like RabbitMQ will trigger a computation across the cluster, creating potentially many messages and involving many machines. I don't want to ack the message until all the computations it has triggered has finished. ?I have a way of detecting this efficiently and reliably, and it's a different machine than the one that read the message off the queue that will know the message is ready to be acked.
>
> Out of curiosity what are you using as your distributed coordination mechanism over the other machines and processes involved in your cluster? ?I wonder if perhaps there's some information available to or through it that your Rabbit-facing processes might be able to use straightforwardly...
>
> If there's a failure at any point (like an exception or machine going down), the system will never detect that the computations for the message has finished. So I want to handle this by putting a time limit on how long the system has to process the message. This is where setting timeouts on acking would come in, and it would be very useful.
>
> Gotcha... ?I follow where you're going...
>
> What I'm going to have to do to get RabbitMQ viable as a source for this system is handle acking/timeouts on the node that reads from RabbitMQ. When the downstream node detects that the message is finished, it will have to send a message to the reader node to ack the message. The reader node will also have to cache messages in memory and have a separate thread explicitly reject messages that are in the cache for too long. Not terrible, but would be nice if this was native in RabbitMQ.
>
> Right. ?As stated your design sketch sounds totally viable although, as you say, it does put work into your application that one might prefer to have done elsewhere... :-)
>
> You get correctness out of the deal in that your intermediate reader process that owns the channel on which the original do-work message was de-queued will make the message available for later consumption by someone else if it dies, but of course it has to implement its own safekeeping and timeout logic for deciding when to give up on things. ?Via basic.reject it also gets the option of throwing the message back to be handled again later or condemning it to oblivion.
>
> Jerry
>
> On Fri, Dec 10, 2010 at 9:55 AM, Jerry Kuch <jer... at vmware.com<mailto:jer... at vmware.com>> wrote:
>
> Hi, Nathan...
>
> On Dec 9, 2010, at 5:21 PM, nathanmarz wrote:
>
> > Let's just say I'm working on the "Cascalog for stream-processing",
> > although the semantics of the tool will be quite different of course.
> > The goal is to be able to do distributed stream processing with the
> > details of fault tolerance and messaging abstracted away. The rest I'm
> > keeping secret for now :)
>
> Very interesting... ?I look forward to seeing it develop!
>
> > Alternatively, is it possible to ack messages out of order from how
> > you read them off the queue?
>
> It is indeed.
>
> In AMQP, acking a message tells the broker that you have received it and taken responsibility for its contents, and that the broker no longer has to take any measures to ensure its integrity or existence.
>
> When you take a message off a queue, say with 'basic.get', it still exists on the server, but is unavailable to other consumers until such time as you 'basic.ack' it. ?If you basic.ack the message, the message is removed from the server. ?If your channel or connection dies, the message is again made available for other consumers.
>
> If you pulled a smattering of messages from a queue and dispatched them to separate workers in your application, and your workers finished and sent acks in some order other than the order in which the messages were enqueued, there's no problem at all.
>
> > Also, is it possible to set a timeout on
> > acking a message, so that if a message isn't acked within X secs it's
> > automatically considered failed and scheduled for redelivery?
>
> Such a mechanism doesn't currently exist. ?In practice, this usually won't be a problem since failure to ack (modulo the case of a consumer that's alive but paralyzed for some reason) is typically the result of network troubles or client death, both of which will result in the connection being closed. ?If the connection closes, the un-acked message on the server becomes available for other clients to get or consume.
>
> Are there specific aspects of your desired use case that make such a timeout-waiting-for-ack super important?
>
> Best regards,
> Jerry
>
> --
> Twitter: @nathanmarzhttp://nathanmarz.com<http://nathanmarz.com/>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From taylste at gmail.com  Sat Dec 11 06:55:52 2010
From: taylste at gmail.com (Steven Taylor)
Date: Sat, 11 Dec 2010 06:55:52 +0000
Subject: [rabbitmq-discuss] routing key advice + QueueBind(...)
In-Reply-To: <0D39B66A-6431-4FCC-80B9-2E843E44FDEE@vmware.com>
References: <AANLkTik=mWeMp9EWqD3mHcHqjxW-iTOdtXYNgufLyGNK@mail.gmail.com>
	<CAA0AA8F-AB13-4406-968D-00836639E578@vmware.com>
	<AANLkTi=8=GKnCrRaaqq6n8iWNdz5dvtK3NV8y_GusLFV@mail.gmail.com>
	<EAE05FB1-A98C-407A-80DA-6993CCDF0D4D@vmware.com>
	<AANLkTi=Y0dYk7Hp9ibgPk1cjr32FbAaXUtmM0Tm2vwA1@mail.gmail.com>
	<AANLkTi=PQJj8wP2UYfi-gnxEJ-JMtg_RkuZiaOx3VF1h@mail.gmail.com>
	<0D39B66A-6431-4FCC-80B9-2E843E44FDEE@vmware.com>
Message-ID: <AANLkTi=Vu3UxqS3LzjHtdhKdK-fRq_hAj13DDEN9C4qT@mail.gmail.com>

Hi Jerry,

thanks fo the links, especially the http://www.rabbitmq.com/extensions.html
 one.

this is what I pre supposed and wondered about with my "-ish" comments:


> "The binding is semantically identical to exchange-to-queue bindings:
> unidirectional, binding keys and exchange types operate as normal, but both
> endpoints (the source and destination) of the binding are exchanges."
>

 This little phrase from you is an important one for me:


> "(In case you've already thought to worry, cycle eliminations and message
> de-duplications are taken care of by the broker, for both exchange and queue
> bindings, so you don't have to worry about a topological misstep creating
> perpetual messaging machines, ending up with unexpected duplicate
> deliveries, etc.)"
>

thanks,
-Steven


On 10 December 2010 21:11, Jerry Kuch <jerryk at vmware.com> wrote:

> Hi, Steven:
>
> The doc for the Java client's method is here:
>
>
> http://www.rabbitmq.com/javadoc/com/rabbitmq/client/impl/AMQImpl.Exchange.Bind.html
>
> The ideas behind it are captured here:
>
> http://www.rabbitmq.com/extensions.html
>
> The 'exchange.bind' method is used to bind one exchange to another
> exchange, with behavior akin to how an exchange-queue binding works.
>
> Using this you can create more elaborate or hierarchical routing topologies
> within your broker.
>
> We've also implemented but not yet released "internal exchanges," as per
> the AMQP spec, which are exchanges that can only be used "on the inside" in
> these exchange-to-exchange scenarios (i.e. an external client can't publish
> to them).  Thus, internal exchanges can of codify and protect their role as
> internal routing plumbing and not let clients leak messages into your
> routing setup in unexpected ways.  Internal exchanges ought to debut in a
> relatively soon to come release, but I don't know precisely when.
>
> (In case you've already thought to worry, cycle eliminations and message
> de-duplications are taken care of by the broker, for both exchange and queue
> bindings, so you don't have to worry about a topological misstep creating
> perpetual messaging machines, ending up with unexpected duplicate
> deliveries, etc.)
>
> Best regards,
> Jerry
>
> On Dec 10, 2010, at 12:31 PM, Steven Taylor wrote:
>
> is there any information available on ExchangeBind()?  Looks similar to
> QueueBind.
>
> -Steven
>
> On 10 December 2010 20:29, Steven Taylor <taylste at gmail.com<mailto:
> taylste at gmail.com>> wrote:
> Just notice an ExchangeBind(...) function.
>
> So is it better to cluster similar ideas by exchange or with routing keys?
>  Previously I was clustering similar ideas by exchange.
>
> thanks,
> -Steven
>
>  On 10 December 2010 19:44, Jerry Kuch <jerryk at vmware.com<mailto:
> jerryk at vmware.com>> wrote:
>
> On Dec 10, 2010, at 11:21 AM, Steven Taylor wrote:
>
> > thanks for the reply.  That's good news on the multiple bindings.  The
> more that I get to know RabbitMQ, the more I like it.
> >
> > I'm using the C# .Net client at the moment (might like to add another
> language client or two in future).
>
> I don't know that client very well myself, but poking around in its source
> code it has enough similarities to the Java one that the latter might still
> be somewhat instructive in cases.
>
> >  I had found the api guide, and faq.  I haven't explored the java library
> yet. I looked at  + played with the .net examples: declareQueue, perf test,
> subscriber, etc.  I also looked at a bunch of the presentations such as the
> one that Alexis did at Google. BTW: the getting started guide with the
> python/java examples is quite good.
>
> I believe more of those are going to be forthcoming, so, as they say,
> "watch that space."
>
> >  I'm at the stage where I need to solve specific problems / issues +
> choose an optimum exchange / routing setups. I'm sure you've been there
> yourself i.e. high level pretty good. Low level -- like that example was
> easy, I can see how that worked, but still stumbling around a little bit in
> the code for my stuff type of thing. Getting there. If you guys can help me
> put my hands on some of these specifics I'd appreciate that.
>
> Absolutely.  We're happy to help.
>
> Filling in the gap between the high level structure and the details of the
> implementation with best practices and the locally tasteful idioms takes a
> bit of time, but, in general Rabbit, its code, and its documentation reward
> study.  The team and community are generally active and interested in
> helping out newcomers to the community.
>
> Also there's an upcoming book on Rabbit that you might find useful:
>
> http://www.manning.com/videla/
>
> The first couple of chapters are available from the publisher in an
> early-access/preview edition.  It looks like it will fill an important niche
> in the Rabbit ecosystem as it comes together.
>
> Jerry
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101211/b48a0fbf/attachment-0001.htm>

From rauan at maemirov.com  Sat Dec 11 16:51:43 2010
From: rauan at maemirov.com (Rauan Maemirov)
Date: Sat, 11 Dec 2010 22:51:43 +0600
Subject: [rabbitmq-discuss] [ANNOUNCEMENT] amqp-0.2.0 (beta) Released.
In-Reply-To: <536373C6-2BDB-4CC7-B66F-576A4A760314@gmail.com>
References: <536373C6-2BDB-4CC7-B66F-576A4A760314@gmail.com>
Message-ID: <AANLkTimg3yDSoZOkOCZHmXcbAT9MaPDsTAGS7BprTg-U@mail.gmail.com>

Does it support modified consume realization (on callbacks) from Alexandre?

2010/12/11 Brad Rodriguez <brodrigu at gmail.com>

>
> The new PECL package amqp-0.2.0 (beta) has been released at
> http://pecl.php.net/.
>
> Release notes
> -------------
> Works with AMQP 0-8 and 0-9-1 (used by RabbitMQ 2.*)
> Modified AMQPConnection object:
>    * Requires call to 'connect' method to connect (no longer connects on
> instantiation)
>    * Added support for disconnect and reconnect
>    * Added helper setters for port, host, vhost, login and password
> Improved consume method to block for MIN messages, and try to get MAX
> messages if available
> Fixed zval descoping bugs
> Fixed bugs:
>    * 17809: Couldn't compile pecl extension under PHP 5.3
>    * 17831: Segmentation fault when the exchange doesn't exists
>    * 19707: AMQPQueue::get() doesn't return the message
>    * 19840: Connection Exception
>
> Package Info
> -------------
> This extension can communicate with any AMQP spec 0-9-1 compatible server,
> such as RabbitMQ, OpenAMQP and Qpid, giving you the ability to create and
> delete exchanges and queues, as well as publish to any exchange and consume
> from any queue.
>
> Related Links
> -------------
> Package home: http://pecl.php.net/package/amqp
>   Changelog: http://pecl.php.net/package-changelog.php?package=amqp
>    Download: http://pecl.php.net/get/amqp-0.2.0.tgz
>
> Authors
> -------------
> Pieter de Zwart (lead)
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101211/e63aafff/attachment.htm>

From taylste at gmail.com  Sat Dec 11 18:05:23 2010
From: taylste at gmail.com (Steven Taylor)
Date: Sat, 11 Dec 2010 18:05:23 +0000
Subject: [rabbitmq-discuss] routing key advice + QueueBind(...)
In-Reply-To: <AANLkTi=Vu3UxqS3LzjHtdhKdK-fRq_hAj13DDEN9C4qT@mail.gmail.com>
References: <AANLkTik=mWeMp9EWqD3mHcHqjxW-iTOdtXYNgufLyGNK@mail.gmail.com>
	<CAA0AA8F-AB13-4406-968D-00836639E578@vmware.com>
	<AANLkTi=8=GKnCrRaaqq6n8iWNdz5dvtK3NV8y_GusLFV@mail.gmail.com>
	<EAE05FB1-A98C-407A-80DA-6993CCDF0D4D@vmware.com>
	<AANLkTi=Y0dYk7Hp9ibgPk1cjr32FbAaXUtmM0Tm2vwA1@mail.gmail.com>
	<AANLkTi=PQJj8wP2UYfi-gnxEJ-JMtg_RkuZiaOx3VF1h@mail.gmail.com>
	<0D39B66A-6431-4FCC-80B9-2E843E44FDEE@vmware.com>
	<AANLkTi=Vu3UxqS3LzjHtdhKdK-fRq_hAj13DDEN9C4qT@mail.gmail.com>
Message-ID: <AANLkTi=b_hnpmqDN7J1T0aJ19CfF43MW7yCRSN5ueFx+@mail.gmail.com>

I notice in the examples for BasicPublish that sometimes for the
IBasicProperties parameter ch.CreateBasicProperties() is used, and sometimes
null is passed in.

What is the benefit in using the ch.CreateBasicProperties() approach?

thanks,
-Steven

On 11 December 2010 06:55, Steven Taylor <taylste at gmail.com> wrote:

> Hi Jerry,
>
> thanks fo the links, especially the
> http://www.rabbitmq.com/extensions.html one.
>
> this is what I pre supposed and wondered about with my "-ish" comments:
>
>
>> "The binding is semantically identical to exchange-to-queue bindings:
>> unidirectional, binding keys and exchange types operate as normal, but both
>> endpoints (the source and destination) of the binding are exchanges."
>>
>
>  This little phrase from you is an important one for me:
>
>
>> "(In case you've already thought to worry, cycle eliminations and message
>> de-duplications are taken care of by the broker, for both exchange and queue
>> bindings, so you don't have to worry about a topological misstep creating
>> perpetual messaging machines, ending up with unexpected duplicate
>> deliveries, etc.)"
>>
>
> thanks,
> -Steven
>
>
> On 10 December 2010 21:11, Jerry Kuch <jerryk at vmware.com> wrote:
>
>> Hi, Steven:
>>
>> The doc for the Java client's method is here:
>>
>>
>> http://www.rabbitmq.com/javadoc/com/rabbitmq/client/impl/AMQImpl.Exchange.Bind.html
>>
>> The ideas behind it are captured here:
>>
>> http://www.rabbitmq.com/extensions.html
>>
>> The 'exchange.bind' method is used to bind one exchange to another
>> exchange, with behavior akin to how an exchange-queue binding works.
>>
>> Using this you can create more elaborate or hierarchical routing
>> topologies within your broker.
>>
>> We've also implemented but not yet released "internal exchanges," as per
>> the AMQP spec, which are exchanges that can only be used "on the inside" in
>> these exchange-to-exchange scenarios (i.e. an external client can't publish
>> to them).  Thus, internal exchanges can of codify and protect their role as
>> internal routing plumbing and not let clients leak messages into your
>> routing setup in unexpected ways.  Internal exchanges ought to debut in a
>> relatively soon to come release, but I don't know precisely when.
>>
>> (In case you've already thought to worry, cycle eliminations and message
>> de-duplications are taken care of by the broker, for both exchange and queue
>> bindings, so you don't have to worry about a topological misstep creating
>> perpetual messaging machines, ending up with unexpected duplicate
>> deliveries, etc.)
>>
>> Best regards,
>> Jerry
>>
>> On Dec 10, 2010, at 12:31 PM, Steven Taylor wrote:
>>
>> is there any information available on ExchangeBind()?  Looks similar to
>> QueueBind.
>>
>> -Steven
>>
>> On 10 December 2010 20:29, Steven Taylor <taylste at gmail.com<mailto:
>> taylste at gmail.com>> wrote:
>> Just notice an ExchangeBind(...) function.
>>
>> So is it better to cluster similar ideas by exchange or with routing keys?
>>  Previously I was clustering similar ideas by exchange.
>>
>> thanks,
>> -Steven
>>
>>  On 10 December 2010 19:44, Jerry Kuch <jerryk at vmware.com<mailto:
>> jerryk at vmware.com>> wrote:
>>
>> On Dec 10, 2010, at 11:21 AM, Steven Taylor wrote:
>>
>> > thanks for the reply.  That's good news on the multiple bindings.  The
>> more that I get to know RabbitMQ, the more I like it.
>> >
>> > I'm using the C# .Net client at the moment (might like to add another
>> language client or two in future).
>>
>> I don't know that client very well myself, but poking around in its source
>> code it has enough similarities to the Java one that the latter might still
>> be somewhat instructive in cases.
>>
>> >  I had found the api guide, and faq.  I haven't explored the java
>> library yet. I looked at  + played with the .net examples: declareQueue,
>> perf test, subscriber, etc.  I also looked at a bunch of the presentations
>> such as the one that Alexis did at Google. BTW: the getting started guide
>> with the python/java examples is quite good.
>>
>> I believe more of those are going to be forthcoming, so, as they say,
>> "watch that space."
>>
>> >  I'm at the stage where I need to solve specific problems / issues +
>> choose an optimum exchange / routing setups. I'm sure you've been there
>> yourself i.e. high level pretty good. Low level -- like that example was
>> easy, I can see how that worked, but still stumbling around a little bit in
>> the code for my stuff type of thing. Getting there. If you guys can help me
>> put my hands on some of these specifics I'd appreciate that.
>>
>> Absolutely.  We're happy to help.
>>
>> Filling in the gap between the high level structure and the details of the
>> implementation with best practices and the locally tasteful idioms takes a
>> bit of time, but, in general Rabbit, its code, and its documentation reward
>> study.  The team and community are generally active and interested in
>> helping out newcomers to the community.
>>
>> Also there's an upcoming book on Rabbit that you might find useful:
>>
>> http://www.manning.com/videla/
>>
>> The first couple of chapters are available from the publisher in an
>> early-access/preview edition.  It looks like it will fill an important niche
>> in the Rabbit ecosystem as it comes together.
>>
>> Jerry
>>
>>
>>
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101211/bb22d995/attachment.htm>

From andrius.norkaitis at oryo.lt  Sun Dec 12 11:21:02 2010
From: andrius.norkaitis at oryo.lt (Andrius Norkaitis)
Date: Sun, 12 Dec 2010 13:21:02 +0200
Subject: [rabbitmq-discuss] rabbit client library for android
Message-ID: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAE0wGRt+AehOvoDEjOecAOUBAAAAAA==@oryo.lt>

Hello,

 

Have anybody managed to use rabbit in Android platform? If yes, what have
you used/done?

Basically I only need my app in Android to subscribe to query and listed for
incoming messages from Rabbit.

 

Best regards,

Andrius

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101212/95473103/attachment.htm>

From david.renz at gmail.com  Sun Dec 12 15:58:12 2010
From: david.renz at gmail.com (drenz)
Date: Sun, 12 Dec 2010 07:58:12 -0800 (PST)
Subject: [rabbitmq-discuss] Rabbitmq Java Client Memory Leak?
Message-ID: <c2846c00-7788-428d-a871-fa9fbbd7c00e@l8g2000yqh.googlegroups.com>

Hello,

I have a pretty simple set up where I use the RabbitMQ client library
to pull objects from a RabbitMQ server.

Unfortunately, there seems to be some memory leak in my program
because it quickly consumes all of the heap memory with byte arrays.
I've increased the max memory for the JVM to 2 GB and it consumes all
of that too.

Here is the code I use to pull data from the queue.  Having used a few
Java profilers, it looks like the leak is associated with they
QueueingConsumer.Delivery object, because each Delivery object has a
member byte[] called _body.

Does anyone have any idea how I can ensure these arrays are garbage
collected / destroyed?

Thanks in advance!!!

Property values:
queue.user=guest
queue.password=guest
queue.virtualHost=/
queue.host=127.0.0.1
queue.hostPort=5672
queue.heartBeat=0
queue.exchange=myExchange
queue.queueName=dtt
queue.routingKey=dttRoute

Code:

	public void consume() throws IOException, ClassNotFoundException {

		ConnectionFactory factory = new ConnectionFactory();
		factory.setUsername(PropertyUtil
				.getProperyFile().getProperty("queue.user"));
		factory.setPassword(PropertyUtil
				.getProperyFile().getProperty("queue.password"));
		factory.setVirtualHost(PropertyUtil
				.getProperyFile().getProperty("queue.virtualHost"));
		factory.setRequestedHeartbeat(Integer.parseInt(PropertyUtil
				.getProperyFile().getProperty("queue.heartBeat")));
		factory.setHost(PropertyUtil
				.getProperyFile().getProperty("queue.host"));
		factory.setPort(Integer.parseInt(PropertyUtil
				.getProperyFile().getProperty("queue.hostPort")));

		boolean durable = true;
		boolean noAck = false;

		Connection conn = factory.newConnection();

		Channel channel = conn.createChannel();

		channel.basicQos(2);
		channel.exchangeDeclare(getExchangeName(), "direct", durable);
		channel.queueDeclare(getQueueName(), durable, false, false, null);
		channel.queueBind(getQueueName(), getExchangeName(),
getRoutingKey());

		QueueingConsumer consumer = new QueueingConsumer(channel);
		channel.basicConsume(getQueueName(), noAck, consumer);

		boolean runInfinite = true;

		java.sql.Connection sqlConn = null;
		sqlConn = DatabaseUtil.getConnection();

		long start = 0;
		long end = 0;

		while (runInfinite) {
			start = System.currentTimeMillis();
			QueueingConsumer.Delivery delivery = null;
			try {
				delivery = consumer.nextDelivery();

			} catch (Exception ie) {
				log.error(ie.getMessage(), ie);
				continue;
			}

			byte[] body = delivery.getBody();

			ObjectInputStream in = new ObjectInputStream(
					new ByteArrayInputStream(body));

			Status s = (Status) in.readObject();
			in.close();
			in = null;

			try {

				try {
					process(s, sqlConn);

				} catch (Exception e) {
					try{
						sqlConn = DatabaseUtil.getConnection();
					} catch (Exception e1){
						log.error(e.getMessage(), e1);
						throw e1;
					}
				}

				// only send an acknowledgement when the processing completed
				// successfully
				channel
						.basicAck(delivery.getEnvelope().getDeliveryTag(),
								false);

			} catch (Exception e) {
				log.error(e.getMessage(), e);
			}


			end = System.currentTimeMillis();
			delivery = null;

			log.debug("Processing time: "+ (end - start) +" ms");

		}
		try {
			sqlConn.close();
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			log.error(e.getMessage(), e);
		}

		channel.close();
		conn.close();

	}



From matt at mydomedia.com  Sun Dec 12 17:42:45 2010
From: matt at mydomedia.com (Matt Miller)
Date: Sun, 12 Dec 2010 12:42:45 -0500 (EST)
Subject: [rabbitmq-discuss] rabbit client library for android
In-Reply-To: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAE0wGRt+AehOvoDEjOecAOUBAAAAAA==@oryo.lt>
Message-ID: <445677327.846.1292175765740.JavaMail.root@zimbra>

Hi Andrius, 

There are plenty of options/clients available for the RabbitMQ/AMQP. What specifically are you trying to accomplish? For instance if you plan to build a web-based application you could use something like a javascript stomp client with Orbited. 

If you are building a Java based application use the java library, python has a python library, ...

For further information see, http://www.rabbitmq.com/api-guide.html

Cheers,
Matt

----- Original Message -----
From: "Andrius Norkaitis" <andrius.norkaitis at oryo.lt>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Sunday, December 12, 2010 6:21:02 AM
Subject: [rabbitmq-discuss] rabbit client library for android





Hello, 



Have anybody managed to use rabbit in Android platform? If yes, what have you used/done? 

Basically I only need my app in Android to subscribe to query and listed for incoming messages from Rabbit. 



Best regards, 

Andrius 


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From benbennett at gmail.com  Sun Dec 12 17:51:48 2010
From: benbennett at gmail.com (Benjamin Bennett)
Date: Sun, 12 Dec 2010 11:51:48 -0600
Subject: [rabbitmq-discuss] Rabbitmq Java Client Memory Leak?
In-Reply-To: <c2846c00-7788-428d-a871-fa9fbbd7c00e@l8g2000yqh.googlegroups.com>
References: <c2846c00-7788-428d-a871-fa9fbbd7c00e@l8g2000yqh.googlegroups.com>
Message-ID: <AANLkTinC1v=7V_VgD43WDWYuWL_pMJ9zrw1-DOzofybj@mail.gmail.com>

Having a quick look at it make sure the line is not holding a
reference , considering you are saying the profiler is saying that a
reference is out there.
 byte[] body = delivery.getBody();
de references the delivery.getBody();


if the body variable is referencing the delivery.getBody() it will
prevent it from being gc'ed .



On Sun, Dec 12, 2010 at 9:58 AM, drenz <david.renz at gmail.com> wrote:
> Hello,
>
> I have a pretty simple set up where I use the RabbitMQ client library
> to pull objects from a RabbitMQ server.
>
> Unfortunately, there seems to be some memory leak in my program
> because it quickly consumes all of the heap memory with byte arrays.
> I've increased the max memory for the JVM to 2 GB and it consumes all
> of that too.
>
> Here is the code I use to pull data from the queue. ?Having used a few
> Java profilers, it looks like the leak is associated with they
> QueueingConsumer.Delivery object, because each Delivery object has a
> member byte[] called _body.
>
> Does anyone have any idea how I can ensure these arrays are garbage
> collected / destroyed?
>
> Thanks in advance!!!
>
> Property values:
> queue.user=guest
> queue.password=guest
> queue.virtualHost=/
> queue.host=127.0.0.1
> queue.hostPort=5672
> queue.heartBeat=0
> queue.exchange=myExchange
> queue.queueName=dtt
> queue.routingKey=dttRoute
>
> Code:
>
> ? ? ? ?public void consume() throws IOException, ClassNotFoundException {
>
> ? ? ? ? ? ? ? ?ConnectionFactory factory = new ConnectionFactory();
> ? ? ? ? ? ? ? ?factory.setUsername(PropertyUtil
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?.getProperyFile().getProperty("queue.user"));
> ? ? ? ? ? ? ? ?factory.setPassword(PropertyUtil
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?.getProperyFile().getProperty("queue.password"));
> ? ? ? ? ? ? ? ?factory.setVirtualHost(PropertyUtil
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?.getProperyFile().getProperty("queue.virtualHost"));
> ? ? ? ? ? ? ? ?factory.setRequestedHeartbeat(Integer.parseInt(PropertyUtil
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?.getProperyFile().getProperty("queue.heartBeat")));
> ? ? ? ? ? ? ? ?factory.setHost(PropertyUtil
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?.getProperyFile().getProperty("queue.host"));
> ? ? ? ? ? ? ? ?factory.setPort(Integer.parseInt(PropertyUtil
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?.getProperyFile().getProperty("queue.hostPort")));
>
> ? ? ? ? ? ? ? ?boolean durable = true;
> ? ? ? ? ? ? ? ?boolean noAck = false;
>
> ? ? ? ? ? ? ? ?Connection conn = factory.newConnection();
>
> ? ? ? ? ? ? ? ?Channel channel = conn.createChannel();
>
> ? ? ? ? ? ? ? ?channel.basicQos(2);
> ? ? ? ? ? ? ? ?channel.exchangeDeclare(getExchangeName(), "direct", durable);
> ? ? ? ? ? ? ? ?channel.queueDeclare(getQueueName(), durable, false, false, null);
> ? ? ? ? ? ? ? ?channel.queueBind(getQueueName(), getExchangeName(),
> getRoutingKey());
>
> ? ? ? ? ? ? ? ?QueueingConsumer consumer = new QueueingConsumer(channel);
> ? ? ? ? ? ? ? ?channel.basicConsume(getQueueName(), noAck, consumer);
>
> ? ? ? ? ? ? ? ?boolean runInfinite = true;
>
> ? ? ? ? ? ? ? ?java.sql.Connection sqlConn = null;
> ? ? ? ? ? ? ? ?sqlConn = DatabaseUtil.getConnection();
>
> ? ? ? ? ? ? ? ?long start = 0;
> ? ? ? ? ? ? ? ?long end = 0;
>
> ? ? ? ? ? ? ? ?while (runInfinite) {
> ? ? ? ? ? ? ? ? ? ? ? ?start = System.currentTimeMillis();
> ? ? ? ? ? ? ? ? ? ? ? ?QueueingConsumer.Delivery delivery = null;
> ? ? ? ? ? ? ? ? ? ? ? ?try {
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?delivery = consumer.nextDelivery();
>
> ? ? ? ? ? ? ? ? ? ? ? ?} catch (Exception ie) {
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?log.error(ie.getMessage(), ie);
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?continue;
> ? ? ? ? ? ? ? ? ? ? ? ?}
>
> ? ? ? ? ? ? ? ? ? ? ? ?byte[] body = delivery.getBody();
>
> ? ? ? ? ? ? ? ? ? ? ? ?ObjectInputStream in = new ObjectInputStream(
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?new ByteArrayInputStream(body));
>
> ? ? ? ? ? ? ? ? ? ? ? ?Status s = (Status) in.readObject();
> ? ? ? ? ? ? ? ? ? ? ? ?in.close();
> ? ? ? ? ? ? ? ? ? ? ? ?in = null;
>
> ? ? ? ? ? ? ? ? ? ? ? ?try {
>
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?try {
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?process(s, sqlConn);
>
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?} catch (Exception e) {
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?try{
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?sqlConn = DatabaseUtil.getConnection();
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?} catch (Exception e1){
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?log.error(e.getMessage(), e1);
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?throw e1;
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?}
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?}
>
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?// only send an acknowledgement when the processing completed
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?// successfully
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?channel
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?.basicAck(delivery.getEnvelope().getDeliveryTag(),
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?false);
>
> ? ? ? ? ? ? ? ? ? ? ? ?} catch (Exception e) {
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?log.error(e.getMessage(), e);
> ? ? ? ? ? ? ? ? ? ? ? ?}
>
>
> ? ? ? ? ? ? ? ? ? ? ? ?end = System.currentTimeMillis();
> ? ? ? ? ? ? ? ? ? ? ? ?delivery = null;
>
> ? ? ? ? ? ? ? ? ? ? ? ?log.debug("Processing time: "+ (end - start) +" ms");
>
> ? ? ? ? ? ? ? ?}
> ? ? ? ? ? ? ? ?try {
> ? ? ? ? ? ? ? ? ? ? ? ?sqlConn.close();
> ? ? ? ? ? ? ? ?} catch (SQLException e) {
> ? ? ? ? ? ? ? ? ? ? ? ?// TODO Auto-generated catch block
> ? ? ? ? ? ? ? ? ? ? ? ?log.error(e.getMessage(), e);
> ? ? ? ? ? ? ? ?}
>
> ? ? ? ? ? ? ? ?channel.close();
> ? ? ? ? ? ? ? ?conn.close();
>
> ? ? ? ?}
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From brodrigu at gmail.com  Sun Dec 12 18:18:24 2010
From: brodrigu at gmail.com (Brad Rodriguez)
Date: Sun, 12 Dec 2010 10:18:24 -0800
Subject: [rabbitmq-discuss] [ANNOUNCEMENT] amqp-0.2.0 (beta) Released.
In-Reply-To: <AANLkTimg3yDSoZOkOCZHmXcbAT9MaPDsTAGS7BprTg-U@mail.gmail.com>
References: <536373C6-2BDB-4CC7-B66F-576A4A760314@gmail.com>
	<AANLkTimg3yDSoZOkOCZHmXcbAT9MaPDsTAGS7BprTg-U@mail.gmail.com>
Message-ID: <AANLkTikH8Y59X5MTmJuS0b51r-+ifm2+q-r7OfgVoo5r@mail.gmail.com>

Not currently,

We are considering adding this as a new function if there was a demand for
it.

-Brad

On Sat, Dec 11, 2010 at 8:51 AM, Rauan Maemirov <rauan at maemirov.com> wrote:

> Does it support modified consume realization (on callbacks) from Alexandre?
>
> 2010/12/11 Brad Rodriguez <brodrigu at gmail.com>
>
>
>> The new PECL package amqp-0.2.0 (beta) has been released at
>> http://pecl.php.net/.
>>
>> Release notes
>> -------------
>> Works with AMQP 0-8 and 0-9-1 (used by RabbitMQ 2.*)
>> Modified AMQPConnection object:
>>    * Requires call to 'connect' method to connect (no longer connects on
>> instantiation)
>>    * Added support for disconnect and reconnect
>>    * Added helper setters for port, host, vhost, login and password
>> Improved consume method to block for MIN messages, and try to get MAX
>> messages if available
>> Fixed zval descoping bugs
>> Fixed bugs:
>>    * 17809: Couldn't compile pecl extension under PHP 5.3
>>    * 17831: Segmentation fault when the exchange doesn't exists
>>    * 19707: AMQPQueue::get() doesn't return the message
>>    * 19840: Connection Exception
>>
>> Package Info
>> -------------
>> This extension can communicate with any AMQP spec 0-9-1 compatible server,
>> such as RabbitMQ, OpenAMQP and Qpid, giving you the ability to create and
>> delete exchanges and queues, as well as publish to any exchange and
>> consume
>> from any queue.
>>
>> Related Links
>> -------------
>> Package home: http://pecl.php.net/package/amqp
>>   Changelog: http://pecl.php.net/package-changelog.php?package=amqp
>>    Download: http://pecl.php.net/get/amqp-0.2.0.tgz
>>
>> Authors
>> -------------
>> Pieter de Zwart (lead)
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101212/16606b22/attachment.htm>

From andrius.norkaitis at oryo.lt  Sun Dec 12 18:40:31 2010
From: andrius.norkaitis at oryo.lt (Andrius Norkaitis)
Date: Sun, 12 Dec 2010 20:40:31 +0200
Subject: [rabbitmq-discuss] rabbit client library for android
In-Reply-To: <445677327.846.1292175765740.JavaMail.root@zimbra>
References: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAE0wGRt+AehOvoDEjOecAOUBAAAAAA==@oryo.lt>
	<445677327.846.1292175765740.JavaMail.root@zimbra>
Message-ID: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAGhP/jIIayhFmdlC/WUGemcBAAAAAA==@oryo.lt>

I'm building application for Android and seeking how to do push message notifications from RabbitMQ.

Regards,
Andrius


-----Original Message-----
From: Matt Miller [mailto:matt at mydomedia.com] 
Sent: Sunday, December 12, 2010 7:43 PM
To: Andrius Norkaitis
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] rabbit client library for android

Hi Andrius, 

There are plenty of options/clients available for the RabbitMQ/AMQP. What specifically are you trying to accomplish? For instance if you plan to build a web-based application you could use something like a javascript stomp client with Orbited. 

If you are building a Java based application use the java library, python has a python library, ...

For further information see, http://www.rabbitmq.com/api-guide.html

Cheers,
Matt

----- Original Message -----
From: "Andrius Norkaitis" <andrius.norkaitis at oryo.lt>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Sunday, December 12, 2010 6:21:02 AM
Subject: [rabbitmq-discuss] rabbit client library for android





Hello, 



Have anybody managed to use rabbit in Android platform? If yes, what have you used/done? 

Basically I only need my app in Android to subscribe to query and listed for incoming messages from Rabbit. 



Best regards, 

Andrius 


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From david.renz at gmail.com  Sun Dec 12 19:36:49 2010
From: david.renz at gmail.com (drenz)
Date: Sun, 12 Dec 2010 11:36:49 -0800 (PST)
Subject: [rabbitmq-discuss] Rabbitmq Java Client Memory Leak?
In-Reply-To: <AANLkTinC1v=7V_VgD43WDWYuWL_pMJ9zrw1-DOzofybj@mail.gmail.com>
References: <c2846c00-7788-428d-a871-fa9fbbd7c00e@l8g2000yqh.googlegroups.com>
	<AANLkTinC1v=7V_VgD43WDWYuWL_pMJ9zrw1-DOzofybj@mail.gmail.com>
Message-ID: <b85eda13-f182-4b62-a8ac-1a4b942f0152@j29g2000yqm.googlegroups.com>

I've updated the code to explicitly set body = null after I am done
using it. See below.

However, the memory continues to build up. This is the only part of
the code that runs, so it has to be something in here.  It almost
looks like the QueueingConsumer object might be keeping these
references around.  Is that possible?

Thanks

byte[] body = delivery.getBody();

ObjectInputStream in = new ObjectInputStream(new
ByteArrayInputStream(body));
Status s = (Status) in.readObject();

body = null;

in.close();

in = null;





On Dec 12, 12:51?pm, Benjamin Bennett <benbenn... at gmail.com> wrote:
> Having a quick look at it make sure the line is not holding a
> reference , considering you are saying the profiler is saying that a
> reference is out there.
> ?byte[] body = delivery.getBody();
> de references the delivery.getBody();
>
> if the body variable is referencing the delivery.getBody() it will
> prevent it from being gc'ed .
>
>
>
>
>
>
>
>
>
> On Sun, Dec 12, 2010 at 9:58 AM, drenz <david.r... at gmail.com> wrote:
> > Hello,
>
> > I have a pretty simple set up where I use the RabbitMQ client library
> > to pull objects from a RabbitMQ server.
>
> > Unfortunately, there seems to be some memory leak in my program
> > because it quickly consumes all of the heap memory with byte arrays.
> > I've increased the max memory for the JVM to 2 GB and it consumes all
> > of that too.
>
> > Here is the code I use to pull data from the queue. ?Having used a few
> > Java profilers, it looks like the leak is associated with they
> > QueueingConsumer.Delivery object, because each Delivery object has a
> > member byte[] called _body.
>
> > Does anyone have any idea how I can ensure these arrays are garbage
> > collected / destroyed?
>
> > Thanks in advance!!!
>
> > Property values:
> > queue.user=guest
> > queue.password=guest
> > queue.virtualHost=/
> > queue.host=127.0.0.1
> > queue.hostPort=5672
> > queue.heartBeat=0
> > queue.exchange=myExchange
> > queue.queueName=dtt
> > queue.routingKey=dttRoute
>
> > Code:
>
> > ? ? ? ?public void consume() throws IOException, ClassNotFoundException {
>
> > ? ? ? ? ? ? ? ?ConnectionFactory factory = new ConnectionFactory();
> > ? ? ? ? ? ? ? ?factory.setUsername(PropertyUtil
> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?.getProperyFile().getProperty("queue.user"));
> > ? ? ? ? ? ? ? ?factory.setPassword(PropertyUtil
> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?.getProperyFile().getProperty("queue.password"));
> > ? ? ? ? ? ? ? ?factory.setVirtualHost(PropertyUtil
> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?.getProperyFile().getProperty("queue.virtualHost"));
> > ? ? ? ? ? ? ? ?factory.setRequestedHeartbeat(Integer.parseInt(PropertyUtil
> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?.getProperyFile().getProperty("queue.heartBeat")));
> > ? ? ? ? ? ? ? ?factory.setHost(PropertyUtil
> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?.getProperyFile().getProperty("queue.host"));
> > ? ? ? ? ? ? ? ?factory.setPort(Integer.parseInt(PropertyUtil
> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?.getProperyFile().getProperty("queue.hostPort")));
>
> > ? ? ? ? ? ? ? ?boolean durable = true;
> > ? ? ? ? ? ? ? ?boolean noAck = false;
>
> > ? ? ? ? ? ? ? ?Connection conn = factory.newConnection();
>
> > ? ? ? ? ? ? ? ?Channel channel = conn.createChannel();
>
> > ? ? ? ? ? ? ? ?channel.basicQos(2);
> > ? ? ? ? ? ? ? ?channel.exchangeDeclare(getExchangeName(), "direct", durable);
> > ? ? ? ? ? ? ? ?channel.queueDeclare(getQueueName(), durable, false, false, null);
> > ? ? ? ? ? ? ? ?channel.queueBind(getQueueName(), getExchangeName(),
> > getRoutingKey());
>
> > ? ? ? ? ? ? ? ?QueueingConsumer consumer = new QueueingConsumer(channel);
> > ? ? ? ? ? ? ? ?channel.basicConsume(getQueueName(), noAck, consumer);
>
> > ? ? ? ? ? ? ? ?boolean runInfinite = true;
>
> > ? ? ? ? ? ? ? ?java.sql.Connection sqlConn = null;
> > ? ? ? ? ? ? ? ?sqlConn = DatabaseUtil.getConnection();
>
> > ? ? ? ? ? ? ? ?long start = 0;
> > ? ? ? ? ? ? ? ?long end = 0;
>
> > ? ? ? ? ? ? ? ?while (runInfinite) {
> > ? ? ? ? ? ? ? ? ? ? ? ?start = System.currentTimeMillis();
> > ? ? ? ? ? ? ? ? ? ? ? ?QueueingConsumer.Delivery delivery = null;
> > ? ? ? ? ? ? ? ? ? ? ? ?try {
> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?delivery = consumer.nextDelivery();
>
> > ? ? ? ? ? ? ? ? ? ? ? ?} catch (Exception ie) {
> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?log.error(ie.getMessage(), ie);
> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?continue;
> > ? ? ? ? ? ? ? ? ? ? ? ?}
>
> > ? ? ? ? ? ? ? ? ? ? ? ?byte[] body = delivery.getBody();
>
> > ? ? ? ? ? ? ? ? ? ? ? ?ObjectInputStream in = new ObjectInputStream(
> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?new ByteArrayInputStream(body));
>
> > ? ? ? ? ? ? ? ? ? ? ? ?Status s = (Status) in.readObject();
> > ? ? ? ? ? ? ? ? ? ? ? ?in.close();
> > ? ? ? ? ? ? ? ? ? ? ? ?in = null;
>
> > ? ? ? ? ? ? ? ? ? ? ? ?try {
>
> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?try {
> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?process(s, sqlConn);
>
> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?} catch (Exception e) {
> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?try{
> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?sqlConn = DatabaseUtil.getConnection();
> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?} catch (Exception e1){
> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?log.error(e.getMessage(), e1);
> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?throw e1;
> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?}
> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?}
>
> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?// only send an acknowledgement when the processing completed
> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?// successfully
> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?channel
> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?.basicAck(delivery.getEnvelope().getDeliveryTag(),
> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?false);
>
> > ? ? ? ? ? ? ? ? ? ? ? ?} catch (Exception e) {
> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?log.error(e.getMessage(), e);
> > ? ? ? ? ? ? ? ? ? ? ? ?}
>
> > ? ? ? ? ? ? ? ? ? ? ? ?end = System.currentTimeMillis();
> > ? ? ? ? ? ? ? ? ? ? ? ?delivery = null;
>
> > ? ? ? ? ? ? ? ? ? ? ? ?log.debug("Processing time: "+ (end - start) +" ms");
>
> > ? ? ? ? ? ? ? ?}
> > ? ? ? ? ? ? ? ?try {
> > ? ? ? ? ? ? ? ? ? ? ? ?sqlConn.close();
> > ? ? ? ? ? ? ? ?} catch (SQLException e) {
> > ? ? ? ? ? ? ? ? ? ? ? ?// TODO Auto-generated catch block
> > ? ? ? ? ? ? ? ? ? ? ? ?log.error(e.getMessage(), e);
> > ? ? ? ? ? ? ? ?}
>
> > ? ? ? ? ? ? ? ?channel.close();
> > ? ? ? ? ? ? ? ?conn.close();
>
> > ? ? ? ?}
>
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthias at rabbitmq.com  Sun Dec 12 19:56:14 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 12 Dec 2010 19:56:14 +0000
Subject: [rabbitmq-discuss] Rabbitmq Java Client Memory Leak?
In-Reply-To: <b85eda13-f182-4b62-a8ac-1a4b942f0152@j29g2000yqm.googlegroups.com>
References: <c2846c00-7788-428d-a871-fa9fbbd7c00e@l8g2000yqh.googlegroups.com>	<AANLkTinC1v=7V_VgD43WDWYuWL_pMJ9zrw1-DOzofybj@mail.gmail.com>
	<b85eda13-f182-4b62-a8ac-1a4b942f0152@j29g2000yqm.googlegroups.com>
Message-ID: <4D0528DE.2040202@rabbitmq.com>

David,

drenz wrote:
> I've updated the code to explicitly set body = null after I am done
> using it. See below.
> 
> However, the memory continues to build up. This is the only part of
> the code that runs, so it has to be something in here.  It almost
> looks like the QueueingConsumer object might be keeping these
> references around.  Is that possible?

I suspect the leak is in the application code rather than the rabbit 
java client libs.

I suggest you try removing *all* application code from the receive loop, 
leaving it looking like this:

while (runInfinite) {
         QueueingConsumer.Delivery delivery = consumer.nextDelivery();
         byte[] body = delivery.getBody();
         channel.basicAck(delivery.getEnvelope().getDeliveryTag(), false);
}

Let us know whether you still see a leak with that.

Regards,

Matthias.

From benbennett at gmail.com  Sun Dec 12 20:02:16 2010
From: benbennett at gmail.com (Benjamin Bennett)
Date: Sun, 12 Dec 2010 14:02:16 -0600
Subject: [rabbitmq-discuss] Rabbitmq Java Client Memory Leak?
In-Reply-To: <b85eda13-f182-4b62-a8ac-1a4b942f0152@j29g2000yqm.googlegroups.com>
References: <c2846c00-7788-428d-a871-fa9fbbd7c00e@l8g2000yqh.googlegroups.com>
	<AANLkTinC1v=7V_VgD43WDWYuWL_pMJ9zrw1-DOzofybj@mail.gmail.com>
	<b85eda13-f182-4b62-a8ac-1a4b942f0152@j29g2000yqm.googlegroups.com>
Message-ID: <AANLkTikMHMk=p8uQLFcmJxERZjV+avFdty-iB_nYyuca@mail.gmail.com>

Don't know if it is possible, I would attach the source to your
debugger.That might give you some idea what is going on.
I had  quick look at the QueueingConsumer code and it looks pretty
strait forward.
 What profiler are you using ? I am yourkit memory inspections would
give you some idea what class is holding the reference.
 Something is holding onto the bytes and it cannot be gc'd.
Other item is the new ByteStreamInputArray() wonder if you can set
that as a variable and set it to null after you read. But looking at
the javadocs that shouldn't be the issue.
I would still try it to 100% that isn't the issue.



On Sun, Dec 12, 2010 at 1:36 PM, drenz <david.renz at gmail.com> wrote:
> I've updated the code to explicitly set body = null after I am done
> using it. See below.
>
> However, the memory continues to build up. This is the only part of
> the code that runs, so it has to be something in here. ?It almost
> looks like the QueueingConsumer object might be keeping these
> references around. ?Is that possible?
>
> Thanks
>
> byte[] body = delivery.getBody();
>
> ObjectInputStream in = new ObjectInputStream(new
> ByteArrayInputStream(body));
> Status s = (Status) in.readObject();
>
> body = null;
>
> in.close();
>
> in = null;
>
>
>
>
>
> On Dec 12, 12:51?pm, Benjamin Bennett <benbenn... at gmail.com> wrote:
>> Having a quick look at it make sure the line is not holding a
>> reference , considering you are saying the profiler is saying that a
>> reference is out there.
>> ?byte[] body = delivery.getBody();
>> de references the delivery.getBody();
>>
>> if the body variable is referencing the delivery.getBody() it will
>> prevent it from being gc'ed .
>>
>>
>>
>>
>>
>>
>>
>>
>>
>> On Sun, Dec 12, 2010 at 9:58 AM, drenz <david.r... at gmail.com> wrote:
>> > Hello,
>>
>> > I have a pretty simple set up where I use the RabbitMQ client library
>> > to pull objects from a RabbitMQ server.
>>
>> > Unfortunately, there seems to be some memory leak in my program
>> > because it quickly consumes all of the heap memory with byte arrays.
>> > I've increased the max memory for the JVM to 2 GB and it consumes all
>> > of that too.
>>
>> > Here is the code I use to pull data from the queue. ?Having used a few
>> > Java profilers, it looks like the leak is associated with they
>> > QueueingConsumer.Delivery object, because each Delivery object has a
>> > member byte[] called _body.
>>
>> > Does anyone have any idea how I can ensure these arrays are garbage
>> > collected / destroyed?
>>
>> > Thanks in advance!!!
>>
>> > Property values:
>> > queue.user=guest
>> > queue.password=guest
>> > queue.virtualHost=/
>> > queue.host=127.0.0.1
>> > queue.hostPort=5672
>> > queue.heartBeat=0
>> > queue.exchange=myExchange
>> > queue.queueName=dtt
>> > queue.routingKey=dttRoute
>>
>> > Code:
>>
>> > ? ? ? ?public void consume() throws IOException, ClassNotFoundException {
>>
>> > ? ? ? ? ? ? ? ?ConnectionFactory factory = new ConnectionFactory();
>> > ? ? ? ? ? ? ? ?factory.setUsername(PropertyUtil
>> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?.getProperyFile().getProperty("queue.user"));
>> > ? ? ? ? ? ? ? ?factory.setPassword(PropertyUtil
>> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?.getProperyFile().getProperty("queue.password"));
>> > ? ? ? ? ? ? ? ?factory.setVirtualHost(PropertyUtil
>> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?.getProperyFile().getProperty("queue.virtualHost"));
>> > ? ? ? ? ? ? ? ?factory.setRequestedHeartbeat(Integer.parseInt(PropertyUtil
>> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?.getProperyFile().getProperty("queue.heartBeat")));
>> > ? ? ? ? ? ? ? ?factory.setHost(PropertyUtil
>> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?.getProperyFile().getProperty("queue.host"));
>> > ? ? ? ? ? ? ? ?factory.setPort(Integer.parseInt(PropertyUtil
>> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?.getProperyFile().getProperty("queue.hostPort")));
>>
>> > ? ? ? ? ? ? ? ?boolean durable = true;
>> > ? ? ? ? ? ? ? ?boolean noAck = false;
>>
>> > ? ? ? ? ? ? ? ?Connection conn = factory.newConnection();
>>
>> > ? ? ? ? ? ? ? ?Channel channel = conn.createChannel();
>>
>> > ? ? ? ? ? ? ? ?channel.basicQos(2);
>> > ? ? ? ? ? ? ? ?channel.exchangeDeclare(getExchangeName(), "direct", durable);
>> > ? ? ? ? ? ? ? ?channel.queueDeclare(getQueueName(), durable, false, false, null);
>> > ? ? ? ? ? ? ? ?channel.queueBind(getQueueName(), getExchangeName(),
>> > getRoutingKey());
>>
>> > ? ? ? ? ? ? ? ?QueueingConsumer consumer = new QueueingConsumer(channel);
>> > ? ? ? ? ? ? ? ?channel.basicConsume(getQueueName(), noAck, consumer);
>>
>> > ? ? ? ? ? ? ? ?boolean runInfinite = true;
>>
>> > ? ? ? ? ? ? ? ?java.sql.Connection sqlConn = null;
>> > ? ? ? ? ? ? ? ?sqlConn = DatabaseUtil.getConnection();
>>
>> > ? ? ? ? ? ? ? ?long start = 0;
>> > ? ? ? ? ? ? ? ?long end = 0;
>>
>> > ? ? ? ? ? ? ? ?while (runInfinite) {
>> > ? ? ? ? ? ? ? ? ? ? ? ?start = System.currentTimeMillis();
>> > ? ? ? ? ? ? ? ? ? ? ? ?QueueingConsumer.Delivery delivery = null;
>> > ? ? ? ? ? ? ? ? ? ? ? ?try {
>> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?delivery = consumer.nextDelivery();
>>
>> > ? ? ? ? ? ? ? ? ? ? ? ?} catch (Exception ie) {
>> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?log.error(ie.getMessage(), ie);
>> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?continue;
>> > ? ? ? ? ? ? ? ? ? ? ? ?}
>>
>> > ? ? ? ? ? ? ? ? ? ? ? ?byte[] body = delivery.getBody();
>>
>> > ? ? ? ? ? ? ? ? ? ? ? ?ObjectInputStream in = new ObjectInputStream(
>> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?new ByteArrayInputStream(body));
>>
>> > ? ? ? ? ? ? ? ? ? ? ? ?Status s = (Status) in.readObject();
>> > ? ? ? ? ? ? ? ? ? ? ? ?in.close();
>> > ? ? ? ? ? ? ? ? ? ? ? ?in = null;
>>
>> > ? ? ? ? ? ? ? ? ? ? ? ?try {
>>
>> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?try {
>> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?process(s, sqlConn);
>>
>> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?} catch (Exception e) {
>> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?try{
>> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?sqlConn = DatabaseUtil.getConnection();
>> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?} catch (Exception e1){
>> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?log.error(e.getMessage(), e1);
>> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?throw e1;
>> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?}
>> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?}
>>
>> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?// only send an acknowledgement when the processing completed
>> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?// successfully
>> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?channel
>> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?.basicAck(delivery.getEnvelope().getDeliveryTag(),
>> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?false);
>>
>> > ? ? ? ? ? ? ? ? ? ? ? ?} catch (Exception e) {
>> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?log.error(e.getMessage(), e);
>> > ? ? ? ? ? ? ? ? ? ? ? ?}
>>
>> > ? ? ? ? ? ? ? ? ? ? ? ?end = System.currentTimeMillis();
>> > ? ? ? ? ? ? ? ? ? ? ? ?delivery = null;
>>
>> > ? ? ? ? ? ? ? ? ? ? ? ?log.debug("Processing time: "+ (end - start) +" ms");
>>
>> > ? ? ? ? ? ? ? ?}
>> > ? ? ? ? ? ? ? ?try {
>> > ? ? ? ? ? ? ? ? ? ? ? ?sqlConn.close();
>> > ? ? ? ? ? ? ? ?} catch (SQLException e) {
>> > ? ? ? ? ? ? ? ? ? ? ? ?// TODO Auto-generated catch block
>> > ? ? ? ? ? ? ? ? ? ? ? ?log.error(e.getMessage(), e);
>> > ? ? ? ? ? ? ? ?}
>>
>> > ? ? ? ? ? ? ? ?channel.close();
>> > ? ? ? ? ? ? ? ?conn.close();
>>
>> > ? ? ? ?}
>>
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-disc... at lists.rabbitmq.com
>> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From matt at mydomedia.com  Sun Dec 12 21:58:46 2010
From: matt at mydomedia.com (Matt Miller)
Date: Sun, 12 Dec 2010 16:58:46 -0500 (EST)
Subject: [rabbitmq-discuss] rabbit client library for android
In-Reply-To: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAGhP/jIIayhFmdlC/WUGemcBAAAAAA==@oryo.lt>
Message-ID: <1137659973.863.1292191126467.JavaMail.root@zimbra>

Checkout http://code.google.com/p/android-json-rpc/

I have never used the json-rpc plugin for rabbitmq, but there are examples which are included. 

Good luck,
Matt

----- Original Message -----
From: "Andrius Norkaitis" <andrius.norkaitis at oryo.lt>
To: rabbitmq-discuss at lists.rabbitmq.com
Cc: "Matt Miller" <matt at mydomedia.com>
Sent: Sunday, December 12, 2010 1:40:31 PM
Subject: Re: [rabbitmq-discuss] rabbit client library for android

I'm building application for Android and seeking how to do push message notifications from RabbitMQ.

Regards,
Andrius


-----Original Message-----
From: Matt Miller [mailto:matt at mydomedia.com] 
Sent: Sunday, December 12, 2010 7:43 PM
To: Andrius Norkaitis
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] rabbit client library for android

Hi Andrius, 

There are plenty of options/clients available for the RabbitMQ/AMQP. What specifically are you trying to accomplish? For instance if you plan to build a web-based application you could use something like a javascript stomp client with Orbited. 

If you are building a Java based application use the java library, python has a python library, ...

For further information see, http://www.rabbitmq.com/api-guide.html

Cheers,
Matt

----- Original Message -----
From: "Andrius Norkaitis" <andrius.norkaitis at oryo.lt>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Sunday, December 12, 2010 6:21:02 AM
Subject: [rabbitmq-discuss] rabbit client library for android





Hello, 



Have anybody managed to use rabbit in Android platform? If yes, what have you used/done? 

Basically I only need my app in Android to subscribe to query and listed for incoming messages from Rabbit. 



Best regards, 

Andrius 


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From david at rabbitmq.com  Mon Dec 13 00:45:47 2010
From: david at rabbitmq.com (David Wragg)
Date: Mon, 13 Dec 2010 00:45:47 +0000
Subject: [rabbitmq-discuss] the last version librabbitmq-c installation
	error
In-Reply-To: <E1PR2bi-0002Rs-00.akalend-mail-ru@f298.mail.ru> (Alexandre
	Kalendarev's message of "Fri, 10 Dec 2010 16:01:54 +0300")
References: <E1PR2bi-0002Rs-00.akalend-mail-ru@f298.mail.ru>
Message-ID: <yrv4c8vzucxfo.fsf@dwragg.eng.vmware.com>

Hi Alexandre,

Alexandre Kalendarev <akalend at mail.ru> writes:
> the last version  installation  librabbitmq-c is error:
>
> $:~/src/rabbitmq-c$ sudo autoreconf -i
> Can't exec "libtoolize": No such file or directory at
> /usr/bin/autoreconf2.50 line 189.
> [...]
>
> the /usr/bin includes the files:
>
> autoconf2.13
> autoconf2.50
> autoconf2.64
> autoreconf
> autoreconf2.13
> autoreconf2.50
> autoreconf2.64

The oldest version of autoreconf that I know works with rabbitmq-c is
2.59, and that is quite an old version.  2.50 must be really old.

Does it work if you run "autoreconf2.64 -i" instead?

By the way, you shouldn't need to use sudo to run autoreconf as root.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From andrius.norkaitis at oryo.lt  Mon Dec 13 00:49:49 2010
From: andrius.norkaitis at oryo.lt (Andrius Norkaitis)
Date: Mon, 13 Dec 2010 02:49:49 +0200
Subject: [rabbitmq-discuss] rabbit client library for android
In-Reply-To: <1137659973.863.1292191126467.JavaMail.root@zimbra>
References: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAGhP/jIIayhFmdlC/WUGemcBAAAAAA==@oryo.lt>
	<1137659973.863.1292191126467.JavaMail.root@zimbra>
Message-ID: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAGvZb663uixAoE0HD0XlH8oBAAAAAA==@oryo.lt>

Matt, thank you very much for link a link. As I see there are several options doing it (xmpp client + xmpp plugin in rabbit, maybe STOMP etc.).
Anyway I have tried to just to use java client and successfully connected and got massages coming. Could you tell me any drawbacks using java client in Android?
Have anybody used already and could tell about their experience? 

Regards,
Andrius

-----Original Message-----
From: Matt Miller [mailto:matt at mydomedia.com] 
Sent: Sunday, December 12, 2010 11:59 PM
To: Andrius Norkaitis
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] rabbit client library for android

Checkout http://code.google.com/p/android-json-rpc/

I have never used the json-rpc plugin for rabbitmq, but there are examples which are included. 

Good luck,
Matt

----- Original Message -----
From: "Andrius Norkaitis" <andrius.norkaitis at oryo.lt>
To: rabbitmq-discuss at lists.rabbitmq.com
Cc: "Matt Miller" <matt at mydomedia.com>
Sent: Sunday, December 12, 2010 1:40:31 PM
Subject: Re: [rabbitmq-discuss] rabbit client library for android

I'm building application for Android and seeking how to do push message notifications from RabbitMQ.

Regards,
Andrius


-----Original Message-----
From: Matt Miller [mailto:matt at mydomedia.com] 
Sent: Sunday, December 12, 2010 7:43 PM
To: Andrius Norkaitis
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] rabbit client library for android

Hi Andrius, 

There are plenty of options/clients available for the RabbitMQ/AMQP. What specifically are you trying to accomplish? For instance if you plan to build a web-based application you could use something like a javascript stomp client with Orbited. 

If you are building a Java based application use the java library, python has a python library, ...

For further information see, http://www.rabbitmq.com/api-guide.html

Cheers,
Matt

----- Original Message -----
From: "Andrius Norkaitis" <andrius.norkaitis at oryo.lt>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Sunday, December 12, 2010 6:21:02 AM
Subject: [rabbitmq-discuss] rabbit client library for android





Hello, 



Have anybody managed to use rabbit in Android platform? If yes, what have you used/done? 

Basically I only need my app in Android to subscribe to query and listed for incoming messages from Rabbit. 



Best regards, 

Andrius 


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From matt at mydomedia.com  Mon Dec 13 01:04:04 2010
From: matt at mydomedia.com (Matt Miller)
Date: Sun, 12 Dec 2010 20:04:04 -0500 (EST)
Subject: [rabbitmq-discuss] rabbit client library for android
In-Reply-To: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAGvZb663uixAoE0HD0XlH8oBAAAAAA==@oryo.lt>
Message-ID: <1776018853.873.1292202244166.JavaMail.root@zimbra>

Andrius, 

Off the top of my head I remember seeing mention of possible memory leaks using the Java clients, but I cannot attest to their actual existence as I typically use the python, javascript and C libraries for RabbitMQ.

The fact you have the Java client working on Android is very cool, one possible drawback that comes to mind is (from what I hear) the JVMs are different and support/implementation can vary amongst the various Android platforms/providers? I may be totally of target here as I have never personally touched android development (yet). 

Also if you had to tweak the rabbitmq java client to get it running on Android keeping these libraries up to date yourself might be a pain. 

As a note, if you are not already aware, the RabbitMQ team has quite a bit of projects on github.com and I find it very useful to stay on top of whats cookin'. The team has also been very helpful for me personally and I always find it a pleasure emailing/speaking with them. 

Most of the work I have done involving RabbitMQ is for the web, and I have had good luck working with Socket.IO/Orbited2/Orbited and the stomp/python/javascript clients. 

webkit support for android works remarkably well.. 

Cheers,
Matt
----- Original Message -----
From: "Andrius Norkaitis" <andrius.norkaitis at oryo.lt>
To: "Matt Miller" <matt at mydomedia.com>
Cc: rabbitmq-discuss at lists.rabbitmq.com
Sent: Sunday, December 12, 2010 7:49:49 PM
Subject: Re: [rabbitmq-discuss] rabbit client library for android

Matt, thank you very much for link a link. As I see there are several options doing it (xmpp client + xmpp plugin in rabbit, maybe STOMP etc.).
Anyway I have tried to just to use java client and successfully connected and got massages coming. Could you tell me any drawbacks using java client in Android?
Have anybody used already and could tell about their experience? 

Regards,
Andrius

-----Original Message-----
From: Matt Miller [mailto:matt at mydomedia.com] 
Sent: Sunday, December 12, 2010 11:59 PM
To: Andrius Norkaitis
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] rabbit client library for android

Checkout http://code.google.com/p/android-json-rpc/

I have never used the json-rpc plugin for rabbitmq, but there are examples which are included. 

Good luck,
Matt

----- Original Message -----
From: "Andrius Norkaitis" <andrius.norkaitis at oryo.lt>
To: rabbitmq-discuss at lists.rabbitmq.com
Cc: "Matt Miller" <matt at mydomedia.com>
Sent: Sunday, December 12, 2010 1:40:31 PM
Subject: Re: [rabbitmq-discuss] rabbit client library for android

I'm building application for Android and seeking how to do push message notifications from RabbitMQ.

Regards,
Andrius


-----Original Message-----
From: Matt Miller [mailto:matt at mydomedia.com] 
Sent: Sunday, December 12, 2010 7:43 PM
To: Andrius Norkaitis
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] rabbit client library for android

Hi Andrius, 

There are plenty of options/clients available for the RabbitMQ/AMQP. What specifically are you trying to accomplish? For instance if you plan to build a web-based application you could use something like a javascript stomp client with Orbited. 

If you are building a Java based application use the java library, python has a python library, ...

For further information see, http://www.rabbitmq.com/api-guide.html

Cheers,
Matt

----- Original Message -----
From: "Andrius Norkaitis" <andrius.norkaitis at oryo.lt>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Sunday, December 12, 2010 6:21:02 AM
Subject: [rabbitmq-discuss] rabbit client library for android





Hello, 



Have anybody managed to use rabbit in Android platform? If yes, what have you used/done? 

Basically I only need my app in Android to subscribe to query and listed for incoming messages from Rabbit. 



Best regards, 

Andrius 


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From dave.smith.to at gmail.com  Mon Dec 13 02:02:07 2010
From: dave.smith.to at gmail.com (Dave Smith)
Date: Sun, 12 Dec 2010 21:02:07 -0500
Subject: [rabbitmq-discuss] Impact of AMQP 1.0
Message-ID: <AANLkTinFvAPnPWOZ7gteiqY3rDmVPds4OJRULf=giGfT@mail.gmail.com>

If I recommend the use of rabbitmq in my company today,  what will be
the impact when AMQP 1.0 is implemented?  Will exchanges continue to
be supported.  Will their use be discouraged.  If we use exchanges
will it impact interoperability with other brokers and clients?

Are there any recommendation related to this topic?



--DS

From therevoltingx at gmail.com  Mon Dec 13 02:42:47 2010
From: therevoltingx at gmail.com (Miguel Morales)
Date: Sun, 12 Dec 2010 18:42:47 -0800
Subject: [rabbitmq-discuss] rabbit client library for android
In-Reply-To: <1776018853.873.1292202244166.JavaMail.root@zimbra>
References: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAGvZb663uixAoE0HD0XlH8oBAAAAAA==@oryo.lt>
	<1776018853.873.1292202244166.JavaMail.root@zimbra>
Message-ID: <AANLkTik75K8HMXqE2pGApPQ9cGDWLm+yELGLB_RR80jf@mail.gmail.com>

Hey Andrius, as I mentioned in my previous private reply I've been
using the RabbitMQ with Android with no apparent issues as far as
messages sending/receiving goes.
(I have noticed that while going/driving around with the phone I lose
messages but I haven't done extensive testing.  It might have to do
with something else.)

Here's a test project I setup to test out the rabbitmq client on
Android: https://github.com/therevoltingx/rabbitmq_android_test
Because I wanted to consume a lot of messages fast the GC runs were a
big problem.  I tried to tweak the library with no success and managed
on moving the high-speed stuff to my own socket/tcp based code and
only use RabbitMQ for things like chat, push notifications, etc.

In the project I posted I even tried to experiment with the rabbitmq-c
client on Android.  I managed to compile it and even publish and
receive messages but passing the messages to Java via JNI proved to be
too much for my low C skills.

Best of luck,
Miguel


On Sun, Dec 12, 2010 at 5:04 PM, Matt Miller <matt at mydomedia.com> wrote:
> Andrius,
>
> Off the top of my head I remember seeing mention of possible memory leaks using the Java clients, but I cannot attest to their actual existence as I typically use the python, javascript and C libraries for RabbitMQ.
>
> The fact you have the Java client working on Android is very cool, one possible drawback that comes to mind is (from what I hear) the JVMs are different and support/implementation can vary amongst the various Android platforms/providers? I may be totally of target here as I have never personally touched android development (yet).
>
> Also if you had to tweak the rabbitmq java client to get it running on Android keeping these libraries up to date yourself might be a pain.
>
> As a note, if you are not already aware, the RabbitMQ team has quite a bit of projects on github.com and I find it very useful to stay on top of whats cookin'. The team has also been very helpful for me personally and I always find it a pleasure emailing/speaking with them.
>
> Most of the work I have done involving RabbitMQ is for the web, and I have had good luck working with Socket.IO/Orbited2/Orbited and the stomp/python/javascript clients.
>
> webkit support for android works remarkably well..
>
> Cheers,
> Matt
> ----- Original Message -----
> From: "Andrius Norkaitis" <andrius.norkaitis at oryo.lt>
> To: "Matt Miller" <matt at mydomedia.com>
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Sent: Sunday, December 12, 2010 7:49:49 PM
> Subject: Re: [rabbitmq-discuss] rabbit client library for android
>
> Matt, thank you very much for link a link. As I see there are several options doing it (xmpp client + xmpp plugin in rabbit, maybe STOMP etc.).
> Anyway I have tried to just to use java client and successfully connected and got massages coming. Could you tell me any drawbacks using java client in Android?
> Have anybody used already and could tell about their experience?
>
> Regards,
> Andrius
>
> -----Original Message-----
> From: Matt Miller [mailto:matt at mydomedia.com]
> Sent: Sunday, December 12, 2010 11:59 PM
> To: Andrius Norkaitis
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] rabbit client library for android
>
> Checkout http://code.google.com/p/android-json-rpc/
>
> I have never used the json-rpc plugin for rabbitmq, but there are examples which are included.
>
> Good luck,
> Matt
>
> ----- Original Message -----
> From: "Andrius Norkaitis" <andrius.norkaitis at oryo.lt>
> To: rabbitmq-discuss at lists.rabbitmq.com
> Cc: "Matt Miller" <matt at mydomedia.com>
> Sent: Sunday, December 12, 2010 1:40:31 PM
> Subject: Re: [rabbitmq-discuss] rabbit client library for android
>
> I'm building application for Android and seeking how to do push message notifications from RabbitMQ.
>
> Regards,
> Andrius
>
>
> -----Original Message-----
> From: Matt Miller [mailto:matt at mydomedia.com]
> Sent: Sunday, December 12, 2010 7:43 PM
> To: Andrius Norkaitis
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] rabbit client library for android
>
> Hi Andrius,
>
> There are plenty of options/clients available for the RabbitMQ/AMQP. What specifically are you trying to accomplish? For instance if you plan to build a web-based application you could use something like a javascript stomp client with Orbited.
>
> If you are building a Java based application use the java library, python has a python library, ...
>
> For further information see, http://www.rabbitmq.com/api-guide.html
>
> Cheers,
> Matt
>
> ----- Original Message -----
> From: "Andrius Norkaitis" <andrius.norkaitis at oryo.lt>
> To: rabbitmq-discuss at lists.rabbitmq.com
> Sent: Sunday, December 12, 2010 6:21:02 AM
> Subject: [rabbitmq-discuss] rabbit client library for android
>
>
>
>
>
> Hello,
>
>
>
> Have anybody managed to use rabbit in Android platform? If yes, what have you used/done?
>
> Basically I only need my app in Android to subscribe to query and listed for incoming messages from Rabbit.
>
>
>
> Best regards,
>
> Andrius
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
~ Jeremiah:9:23-24
Android 2D MMORPG: http://developingthedream.blogspot.com/,
http://www.youtube.com/user/revoltingx

From kathironline at ymail.com  Mon Dec 13 07:31:30 2010
From: kathironline at ymail.com (Kathiravan Neethimani)
Date: Mon, 13 Dec 2010 13:01:30 +0530 (IST)
Subject: [rabbitmq-discuss] How to Show my List_Queues in .net
Message-ID: <196361.68759.qm@web95714.mail.in.yahoo.com>

Hello ,??? ? ? ? ? ?My RabbitMQ Service is running in Server pc . My Connection is established by??? ? ? ? ???? ? ? ? ? ConnectionFactory factory = new ConnectionFactory();?? ? ? ? ? ?factory.Protocol = Protocols.AMQP_0_8_QPID;?? ? ? ? ? ?factory.Address = server;?
?? ? ? ?But how to show ?list_queues and queue count only ?in .net .?

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101213/aa98e234/attachment-0001.htm>

From alexis at rabbitmq.com  Mon Dec 13 08:12:22 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Mon, 13 Dec 2010 08:12:22 +0000
Subject: [rabbitmq-discuss] Impact of AMQP 1.0
In-Reply-To: <AANLkTinFvAPnPWOZ7gteiqY3rDmVPds4OJRULf=giGfT@mail.gmail.com>
References: <AANLkTinFvAPnPWOZ7gteiqY3rDmVPds4OJRULf=giGfT@mail.gmail.com>
Message-ID: <AANLkTikUksyA5Z+VVmwjT5ukmpEfxfjVa-jnF9-_j9uo@mail.gmail.com>

Dave

Exchanges and similar routing constructs will remain in RabbitMQ.  The
goal of the authors of 1.0 is that interoperability will *not* be
affected by different broker internals.  Some more background is here:
http://www.rabbitmq.com/blog/2010/12/01/amqp-10-prototyping/ where you
can find a link to a client-broker protocol for 1-0.

RabbitMQ will also continue to support 0-9-1.

alexis


On Mon, Dec 13, 2010 at 2:02 AM, Dave Smith <dave.smith.to at gmail.com> wrote:
> If I recommend the use of rabbitmq in my company today, ?what will be
> the impact when AMQP 1.0 is implemented? ?Will exchanges continue to
> be supported. ?Will their use be discouraged. ?If we use exchanges
> will it impact interoperability with other brokers and clients?
>
> Are there any recommendation related to this topic?
>
>
>
> --DS
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From davorin.rusevljan at gmail.com  Mon Dec 13 08:12:41 2010
From: davorin.rusevljan at gmail.com (Davorin Rusevljan)
Date: Mon, 13 Dec 2010 09:12:41 +0100
Subject: [rabbitmq-discuss] Impact of AMQP 1.0
In-Reply-To: <AANLkTinFvAPnPWOZ7gteiqY3rDmVPds4OJRULf=giGfT@mail.gmail.com>
References: <AANLkTinFvAPnPWOZ7gteiqY3rDmVPds4OJRULf=giGfT@mail.gmail.com>
Message-ID: <AANLkTinBGkWxz56iZ4OP8RG618w8viNFNbuRFnCpyjFe@mail.gmail.com>

On Mon, Dec 13, 2010 at 3:02 AM, Dave Smith <dave.smith.to at gmail.com> wrote:
> If I recommend the use of rabbitmq in my company today, ?what will be
> the impact when AMQP 1.0 is implemented? ?Will exchanges continue to
> be supported. ?Will their use be discouraged. ?If we use exchanges
> will it impact interoperability with other brokers and clients?

Well there is this page:

http://www.amqp.org/confluence/display/AMQP/0.x+compatibility+for+1.0+brokers

As you can see this is part of the spec is still in the early stage.

It seems to me that 1.0 should be capable of representing 0.x
functionality (but at completely different wire level), so some big
broker vendors could provide old 0.x semantics and client libraries on
top of their new 1.0 product. However, I do not think it would be
possible to connect some old 0.x client library to the 1.x broker. As
for interoperability of 2 products from different vendors that offer
0.x compatibility over 1.x, that seems highly questionable, unless
compatibility part of the spec gets much more specific.

But I might be wrong on that

Davorin Rusevljan
http://www.cloud208.com/

From alexis at rabbitmq.com  Mon Dec 13 08:14:24 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Mon, 13 Dec 2010 08:14:24 +0000
Subject: [rabbitmq-discuss] How to Show my List_Queues in .net
In-Reply-To: <196361.68759.qm@web95714.mail.in.yahoo.com>
References: <196361.68759.qm@web95714.mail.in.yahoo.com>
Message-ID: <AANLkTinN9ns7wb9246vfwL08RyDyQV5VTJiuKm1ibh_V@mail.gmail.com>

Kathiravan

Have you tried this?  http://www.rabbitmq.com/management.html

alexis

On Mon, Dec 13, 2010 at 7:31 AM, Kathiravan Neethimani <
kathironline at ymail.com> wrote:

> Hello ,
>             My RabbitMQ Service is running in Server pc . My Connection is
> established by
>
>            ConnectionFactory factory = new ConnectionFactory();
>             factory.Protocol = Protocols.AMQP_0_8_QPID;
>             factory.Address = server;
>
>         But how to show  list_queues and queue count only  in .net .
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101213/9a4ca43c/attachment.htm>

From simon at rabbitmq.com  Mon Dec 13 11:07:56 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 13 Dec 2010 11:07:56 +0000
Subject: [rabbitmq-discuss] ssl certificate to client lookup
In-Reply-To: <AANLkTinWQQ=oStEcHAh+MPXWXBas+HSnMqnjR7CMr7yK@mail.gmail.com>
References: <AANLkTimK1NSUevhDMV-62gTSgjKXrl4hMTJNzkkcRIpI@mail.gmail.com>	<20100625130314.GW14541@rabbitmq.com>	<AANLkTinS44Y9g3vf+ZQYa8Cy5QOCtzPEXvryNb=vVdyH@mail.gmail.com>	<4CFFCA42.9030803@rabbitmq.com>	<20101209085318.17064v9djwrjtwys@webmail.active24.cz>	<4D00BD13.4040303@rabbitmq.com>
	<AANLkTinWQQ=oStEcHAh+MPXWXBas+HSnMqnjR7CMr7yK@mail.gmail.com>
Message-ID: <4D05FE8C.2070701@rabbitmq.com>

On 09/12/10 18:56, Nathaniel Haggard wrote:
> On Thu, Dec 9, 2010 at 4:27 AM, Simon MacMullen<simon at rabbitmq.com>  wrote:
>> On 09/12/10 07:53, jiri at krutil.com wrote:
>>> Will the client identity be extracted from the client certificate's
>>> subject?
>>
>> Yes, ATM it's just the common name from the subject.
>
> What about setting a field in the message header to the common name of
> the subject?

I consider it to be a bit orthogonal, but we have a bug open for that 
too. It's slightly less trivial than it sounds since we need a way for 
the publisher to indicate that it's happy to have its identity revealed 
- at the moment we're leaning towards having the publisher assert its 
identity and have the broker enforce the truth of that.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From kathironline at ymail.com  Mon Dec 13 13:35:39 2010
From: kathironline at ymail.com (Kathiravan Neethimani)
Date: Mon, 13 Dec 2010 19:05:39 +0530 (IST)
Subject: [rabbitmq-discuss] How to Show my List_Queues in .net
In-Reply-To: <AANLkTinN9ns7wb9246vfwL08RyDyQV5VTJiuKm1ibh_V@mail.gmail.com>
Message-ID: <247666.55862.qm@web95716.mail.in.yahoo.com>





Hello ,??? ? ? ? ? ?My RabbitMQ Service is running in Server pc . My Connection is established by?
?? ? ? ? ???? ? ? ? ? ConnectionFactory factory = new ConnectionFactory();?? ? ? ? ? ?factory.Protocol = Protocols.AMQP_0_8_QPID;?? ? ? ? ? ?factory.Address = server;?
i have tried ???http://www.rabbitmq.com/management.html?.?
?? ? ?But how to show ?list_queues and queue count only ?in .net .?
can u plz send me some sample code in .net .... i m newbie ...
regards ,?kathir



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101213/33078b69/attachment.htm>

From alexis at rabbitmq.com  Mon Dec 13 14:38:04 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Mon, 13 Dec 2010 14:38:04 +0000
Subject: [rabbitmq-discuss] How to Show my List_Queues in .net
In-Reply-To: <247666.55862.qm@web95716.mail.in.yahoo.com>
References: <AANLkTinN9ns7wb9246vfwL08RyDyQV5VTJiuKm1ibh_V@mail.gmail.com>
	<247666.55862.qm@web95716.mail.in.yahoo.com>
Message-ID: <AANLkTik5OBUHJHmr77mV2-5-pYLy1E0_thaBYCf0bkqc@mail.gmail.com>

Kathiravan

It is a web interface.  Have you used HTTP from .NET before?

alexis


On Mon, Dec 13, 2010 at 1:35 PM, Kathiravan Neethimani <
kathironline at ymail.com> wrote:

>
>
>
>
> Hello ,
>             My RabbitMQ Service is running in Server pc . My Connection is
> established by
>
>            ConnectionFactory factory = new ConnectionFactory();
>             factory.Protocol = Protocols.AMQP_0_8_QPID;
>             factory.Address = server;
>
> i have tried    http://www.rabbitmq.com/management.html .
>
>       But how to show  list_queues and queue count only  in .net .
>
> can u plz send me some sample code in .net .... i m newbie ...
>
> regards ,
> kathir
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101213/535f4974/attachment.htm>

From Stefan.Kaes at xing.com  Mon Dec 13 15:17:06 2010
From: Stefan.Kaes at xing.com (Stefan Kaes)
Date: Mon, 13 Dec 2010 16:17:06 +0100
Subject: [rabbitmq-discuss] Handling network reliability problems on the
	publisher side
Message-ID: <C92BF782.1BCCB%stefan.kaes@xing.com>

Hi everyone,

as some of you may know, we?ve aimed at building a highly reliable messaging infrastructure around the idea of publishing messages redundantly to a number of identical rabbitmq instances along with deduplicating messages on the receiver side. (see http://xing.github.com/beetle/, https://github.com/xing/beetle and https://github.com/xing/perl-beetle).

The system has been in use in our production environment since April, and we were quite happy with it.

However, we recently had an incident which points to a weakness of our solution: we experienced a temporary network routing problem, which separated at least one of the rabbitmq servers from the publishing processes (mainly or web application). The separation lasted several minutes and lead to parts of our web application blocking in socket writes. In the end, our administrators restarted the web app.

It turned out that we lost quite a few messages, and here?s why: the publisher blocks only after the TCP buffers have been filled completely (even though TCP_NODELAY and SO_SNDTIMEO are set on the socket).

It looks like no programming cleverness on our side can achieve what we want: have the publisher block as soon as a message cannot be accepted by the intended rabbitmq server, because, as far as we understand the amqp protocol, no protocol level acknowledgements are sent which the publisher could wait for (and optionally timeout), before sending the next message.

This is all fine to achieve high throughput on the publisher side, but doesn?t quite fit our use case. For some messages, we really need to make reasonably sure the message has been received by a rabbitmq server, before we continue. We could then use timeouts to detect network partitioning and buffer messages locally until they can be sent (only if none of our three redundant servers can be reached, of course).

Turning on heartbeats can improve the situation somewhat, in that failures can be detected earlier, but since heartbeats are asynchronous in nature, they don?t fully solve our problem.

It currently seems as if the only way to get what we want is to switch our publishers to use the JSON-RPC plugin for rabbitmq.

I?d be interested to here what you think about the problem:


 *   is the analysis correct?
 *   is the JSON-RPC plugin stable enough to be used in production?
 *   maybe there?s a better solution available?


Regards,

-- stefan



Dr. Stefan Kaes
Principal System Architect

XING AG
Gaensemarkt 43, 20354 Hamburg, Germany
Tel. +49 40 419131-801, Fax +49 40 419131-11

Commercial Reg. (Registergericht): Amtsgericht Hamburg, HRB 98807
Exec. Board (Vorstand): Dr. Stefan Gro?-Selbeck (Vorsitzender), Ingo Chu, Burkhard Blum, Michael Otto, Dr. Helmut Becker
Chairman of the Supervisory Board (Aufsichtsratsvorsitzender): Dr. Neil Sunderland

Please join my network on XING: http://www.xing.com/go/invite/Stefan.Kaes

This email may contain confidential and/or privileged information. If you are not the intended recipient (or have received this email in error) please notify the sender immediately and destroy this email. Any unauthorized copying, disclosure or distribution of the material in this email is strictly forbidden and may be unlawful.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101213/19b030e2/attachment.htm>

From parki at whatevernot.com  Mon Dec 13 15:20:58 2010
From: parki at whatevernot.com (Brian Parkinson)
Date: Mon, 13 Dec 2010 10:20:58 -0500
Subject: [rabbitmq-discuss] Question about management setup
Message-ID: <8D3A3B76-F769-40EC-A979-29C930E55AE0@whatevernot.com>

Hello - complete newb here, getting setup with RabbitMQ for the first time - just kicking the tires, as it were.

Apologies if this has been asked before, but can't find a mention of this issue specifically:

I am working with a stock install on Mac OS X 10.6.5 - it all works fine - very cool. Fast to get up and going, which bodes well. I did a port install of the server:

sudo port install rabbitmq-server

I tried to also install the rabbit-management plugin - I have the downloaded *.ez files in the plugin directory:

~: ls /opt/local/lib/rabbitmq/lib/rabbitmq_server-2.2.0/plugins/
README                             mochiweb-2.2.0.ez                  rabbitmq-management-agent-2.2.0.ez webmachine-2.2.0.ez
amqp_client-2.2.0.ez               rabbitmq-management-2.2.0.ez       rabbitmq-mochiweb-2.2.0.ez

Now, when I try to launch the server, I get:

~: sudo /opt/local/sbin/rabbitmq-server 
Activating RabbitMQ plugins ...
ERROR: failed to load application crypto:
{"no such file or directory","crypto.app"}
~: 

So, an issue with crypto ssl I guess. 

Do I need to recompile Erlang, or is there a config setting I need to twiddle? I'll need SSL anyways, so good to get it sorted now...

Any help appreciated.

Cheers,

Brian...







From simon at rabbitmq.com  Mon Dec 13 15:29:16 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 13 Dec 2010 15:29:16 +0000
Subject: [rabbitmq-discuss] Question about management setup
In-Reply-To: <8D3A3B76-F769-40EC-A979-29C930E55AE0@whatevernot.com>
References: <8D3A3B76-F769-40EC-A979-29C930E55AE0@whatevernot.com>
Message-ID: <4D063BCC.9050306@rabbitmq.com>

On 13/12/10 15:20, Brian Parkinson wrote:
> Now, when I try to launch the server, I get:
>
> ~: sudo /opt/local/sbin/rabbitmq-server Activating RabbitMQ plugins
> ... ERROR: failed to load application crypto: {"no such file or
> directory","crypto.app"} ~:
>
> So, an issue with crypto ssl I guess.
>
> Do I need to recompile Erlang, or is there a config setting I need to
> twiddle? I'll need SSL anyways, so good to get it sorted now...

Yes, you need to make sure the Erlang you end up with has the "crypto" 
app compiled - this is mentioned at:

http://www.rabbitmq.com/management.html#erlang

You'll need to ensure ./configure for Erlang finds OpenSSL. How you do 
that on MacPorts I have no idea I'm afraid...

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From simon at rabbitmq.com  Mon Dec 13 15:42:56 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 13 Dec 2010 15:42:56 +0000
Subject: [rabbitmq-discuss] Handling network reliability problems on the
 publisher side
In-Reply-To: <C92BF782.1BCCB%stefan.kaes@xing.com>
References: <C92BF782.1BCCB%stefan.kaes@xing.com>
Message-ID: <4D063F00.8050300@rabbitmq.com>

On 13/12/10 15:17, Stefan Kaes wrote:
<snip>

> It looks like no programming cleverness on our side can achieve what we
> want: have the publisher block as soon as a message cannot be accepted
> by the intended rabbitmq server, because, as far as we understand the
> amqp protocol, no protocol level acknowledgements are sent which the
> publisher could wait for (and optionally timeout), before sending the
> next message.
>
> This is all fine to achieve high throughput on the publisher side, but
> doesn?t quite fit our use case. For some messages, we really need to
> make reasonably sure the message has been received by a rabbitmq server,
> before we continue. We could then use timeouts to detect network
> partitioning and buffer messages locally until they can be sent (only if
> none of our three redundant servers can be reached, of course).

<snip>

>     * is the analysis correct?

Yes. Publishes are fully async in AMQP.

>     * is the JSON-RPC plugin stable enough to be used in production?

Interesting question. Our official position is that like all the plugins 
it is "unsupported". However it's pretty clear that some plugins are 
more supported than others, and JSON-RPC is pretty low down the pecking 
order.

>     * maybe there?s a better solution available?

The next release will feature publisher acknowledgements, where Rabbit 
will stream basic.acks back at you (if you ask for that). This sounds 
like exactly what you're looking for.

In the meantime, you could get away with publishing inside a 
transaction. When you commit the transaction, and get commit-ok back, 
you know Rabbit has got the message (and persisted it if it's 
persistent). Unfortunately this imposes a cost per commit - tweak the 
number of publishes per commit to tune performance versus maximum number 
of outstanding messages.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From majek04 at gmail.com  Mon Dec 13 17:58:44 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Mon, 13 Dec 2010 17:58:44 +0000
Subject: [rabbitmq-discuss] Introducing PUKA,
	the opinionated RabbitMQ python client
Message-ID: <AANLkTindAeBh9OvMx-ocKM1XaKTb02=X+8wwiAxOP7XX@mail.gmail.com>

Hi,

I'm not a fan of the API's exposed by various RabbitMQ clients
and I've been experimenting on how to fix it.
The result took a form of yet-another Python AMQP library - Puka.

The major features include:
 - channels are completely removed from the public API
 - sane handling of AMQP errors (ie: your whole connection shouldn't
   blow away if you make a mistake in a single place)
 - the API is fully asynchronous (should be easy to plug it into Tornado)
 - the framing is reasonably optimized
 - basic_publish can behave like a 'synchronous' method, ie: it's
   possible to make sure the message wasn't lost when transferring
   over the network.

You can grab the sources here:
    https://github.com/majek/puka

Unfinished API reference here:
    http://majek.github.com/puka/puka.html

Some examples:
1) basic examples
    https://github.com/majek/puka/tree/master/examples

2)  code from tutorials using Puka:
    https://github.com/majek/rabbitmq-tutorials/tree/puka/python-puka

3) some early attempts to integrate Puka with TornadoWeb:
    https://github.com/majek/tornadopuka


Comments are warmly welcomed!

Cheers,
  Marek Majkowski

From jon at jbrisbin.com  Mon Dec 13 20:05:05 2010
From: jon at jbrisbin.com (Jon Brisbin)
Date: Mon, 13 Dec 2010 14:05:05 -0600
Subject: [rabbitmq-discuss] Update rabbitmq_webhooks plugin
Message-ID: <60F92220-EC5F-4B98-AC06-F4BA89DDB917@jbrisbin.com>

I updated the RabbitMQ webhooks plugin to make sure it works with 2.2.0:

https://github.com/jbrisbin/rabbitmq-webhooks

I updated the example config file to POST data into Riak for testing. You can put new messages into Riak by just specifying the bucket into which you want the messages POSTed and retrieve them later by listing the keys in that bucket. This actually works pretty well, IMHO.

I know I had at least one report of weirdness with the plugin in RabbitMQ 2.1. Not sure why that was, but everything seems to work okay in RabbitMQ 2.2.0 so I'd suggest trying that if you were having issues.

Thanks!

Jon Brisbin

        Web: http://jbrisbin.com/
    Twitter: @j_brisbin
      Skype: jon.brisbin

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101213/c25858fc/attachment.htm>

From pascaldergane at gmail.com  Mon Dec 13 23:34:52 2010
From: pascaldergane at gmail.com (Pascal Dergane)
Date: Tue, 14 Dec 2010 00:34:52 +0100
Subject: [rabbitmq-discuss] Why each time the call method
 channel.queueDeclarePassive(queueName) increment number of consumer?
Message-ID: <AANLkTinEXhXAiDO8D7QgBpm7N+xgFMU=HGCr+cQdwPvB@mail.gmail.com>

Hi,
I don't understand something about getConsumerCount() method.

Following an example of my consumer Method according with tutorial. Each
time my loop call queueDeclarePassive, the consumerCounter is incremented. I
don't understand why, cause I re use always (each loop) the same consumer,
so I expect that the  consumerCounter does not increment. Could you explain
these observation and confirm that is not a bug? (I use V2.2.0 of java
client with 2.2.0 rabbitMQ Server).
Thanks,


QueueingConsumer consumer = new QueueingConsumer(channel);
boolean messageHasBeenRecept = false;
while (!messageHasBeenRecept) {
declareOk = channel.queueDeclarePassive(queueName);
 System.out.println("QueueName:" + queueName);
System.out.println("ConsumerCount:" + declareOk.getConsumerCount());
System.out.println("MessageCount:" + declareOk.getMessageCount());
 boolean autoAck = false;

channel.basicConsume(queueName, autoAck, consumer);
QueueingConsumer.Delivery delivery = null;
try {
delivery = consumer.nextDelivery(timeOut);
} catch (InterruptedException ie) {
continue;
}

messageHasBeenRecept = (delivery != null);

if (messageHasBeenRecept) {
System.out.println("Message recept :)"
+ delivery.getBody().toString());
channel.basicAck(delivery.getEnvelope().getDeliveryTag(), false);
} else {
System.err.println("No Message recept :(");
}
}
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101214/b6aa739a/attachment.htm>

From david at rabbitmq.com  Tue Dec 14 01:31:55 2010
From: david at rabbitmq.com (David Wragg)
Date: Tue, 14 Dec 2010 01:31:55 +0000
Subject: [rabbitmq-discuss] the last version librabbitmq-c installation
	error
In-Reply-To: <E1PSFAA-0007vl-00.akalend-mail-ru@f132.mail.ru> (Alexandre
	Kalendarev's message of "Mon, 13 Dec 2010 23:38:26 +0300")
References: <E1PR2bi-0002Rs-00.akalend-mail-ru@f298.mail.ru>
	<yrv4c8vzucxfo.fsf@dwragg.eng.vmware.com>
	<E1PSFAA-0007vl-00.akalend-mail-ru@f132.mail.ru>
Message-ID: <yrv4cvd2xb0ms.fsf@dwragg.eng.vmware.com>

Hi Alexandre,

Alexandre Kalendarev <akalend at mail.ru> writes:
> The using the  "autoreconf2.64 -i" have the errorrs:
>
> configure.ac:13: warning: macro `AM_PROG_LIBTOOL' not found in library
> configure.ac:12: error: possibly undefined macro: AC_LIBTOOL_WIN32_DLL
>       If this token and others are legitimate, please use m4_pattern_allow.
>       See the Autoconf documentation.
> configure.ac:13: error: possibly undefined macro: AM_PROG_LIBTOOL
> autoreconf2.64: /usr/bin/autoconf2.64 failed with exit status: 1

You need to install libtool also.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From pcdinh at gmail.com  Tue Dec 14 04:08:50 2010
From: pcdinh at gmail.com (Dinh)
Date: Tue, 14 Dec 2010 11:08:50 +0700
Subject: [rabbitmq-discuss] Unable to store messages into queue
Message-ID: <AANLkTiknXY6OrS=ztS=OYvixYSyKx+RZAKJSTpoVPBmO@mail.gmail.com>

Hi all,

I got a strange situation with RabbitMQ 2.1.1, Mac OSX 10.6.5, erlang
version : 5.8.1.1 (not sure if it is a bug): I was unable to store message
into queue using Python clients.In fact, it is standard code I took from
RabbitMQ site. So it is supposed to work. It already worked before. For me,
yes.

import pika

import sys

import pickle

import json


connection = pika.AsyncoreConnection(pika.ConnectionParameters(

        host='127.0.0.1',

        credentials=pika.PlainCredentials('guest', 'guest')))

channel = connection.channel()


channel.queue_declare(queue='feeds', durable=True)


message = json.dumps({"import_feed": "http://cnn.com/rss/edition.rss"})

channel.basic_publish(exchange='', routing_key='importer',

                      body=message,

                      properties=pika.BasicProperties(

                         delivery_mode = 2, # make message persistent

                      ))

print " [x] Sent %r" % (message,)

After running these code for several time, I checked with RabbitMQ to see if
those message were stored in the queue

Dinh-Phams-MacBook-Pro:~ dinhpham$ sudo
/Users/dinhpham/dev/rabbitmq_server-2.1.1/sbin/rabbitmqctl list_queues name
messages_ready messages_unacknowledged
Listing queues ...
feeds 0 0
...done.

It meant that "feed" queue is created but no message is stored.

In fact, those code worked in the past. It suddenly refused to work after I
had sent several hundred thousands of messages into the queue and deleted
them all for new tests. After several deletion, RabbitMQ refused to work
with the code. No message was stored or no queue was created at all
(happened with Carrot Python client)

Anybody has experienced this case? Is there any log that I can look into to
see what happened?

Thanks,


Dinh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101214/7602fd20/attachment-0001.htm>

From dave.smith.to at gmail.com  Tue Dec 14 04:11:47 2010
From: dave.smith.to at gmail.com (Dave Smith)
Date: Mon, 13 Dec 2010 23:11:47 -0500
Subject: [rabbitmq-discuss] Impact of AMQP 1.0
In-Reply-To: <AANLkTikUksyA5Z+VVmwjT5ukmpEfxfjVa-jnF9-_j9uo@mail.gmail.com>
References: <AANLkTinFvAPnPWOZ7gteiqY3rDmVPds4OJRULf=giGfT@mail.gmail.com>
	<AANLkTikUksyA5Z+VVmwjT5ukmpEfxfjVa-jnF9-_j9uo@mail.gmail.com>
Message-ID: <AANLkTikR-3rGGahZ=FscPrGT1LTB8mxrisS017t-FzD+@mail.gmail.com>

Thanks for the replies.

I haven't had a change to give 1.0 a thorough read yet, but I was
surprised at how extensive the changes were.  Having played a little
with rabbitmq,  I was impressed with how composable the messaging
model was.  The ability to define routings as part of the model and to
construct the components dynamically really simplifies things for me.

We currently use SonicMQ/ESB for our messaging infrastructure, and the
way we use it, it's essentially just a big message routing system.
It's mostly PtoP with ESB services routing message based on
properties.  I can't express how absurdly complex the configuration is
with thousands of endpoints and services.

I truly hope that the dynamic nature of AMQP is not lost in this
massive rewrite.



--DS



On 13 December 2010 03:12, Alexis Richardson <alexis at rabbitmq.com> wrote:
> Dave
>
> Exchanges and similar routing constructs will remain in RabbitMQ. ?The
> goal of the authors of 1.0 is that interoperability will *not* be
> affected by different broker internals. ?Some more background is here:
> http://www.rabbitmq.com/blog/2010/12/01/amqp-10-prototyping/ where you
> can find a link to a client-broker protocol for 1-0.
>
> RabbitMQ will also continue to support 0-9-1.
>
> alexis
>
>
> On Mon, Dec 13, 2010 at 2:02 AM, Dave Smith <dave.smith.to at gmail.com> wrote:
>> If I recommend the use of rabbitmq in my company today, ?what will be
>> the impact when AMQP 1.0 is implemented? ?Will exchanges continue to
>> be supported. ?Will their use be discouraged. ?If we use exchanges
>> will it impact interoperability with other brokers and clients?
>>
>> Are there any recommendation related to this topic?
>>
>>
>>
>> --DS
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>

From davorin.rusevljan at gmail.com  Tue Dec 14 07:40:31 2010
From: davorin.rusevljan at gmail.com (Davorin Rusevljan)
Date: Tue, 14 Dec 2010 08:40:31 +0100
Subject: [rabbitmq-discuss] Impact of AMQP 1.0
In-Reply-To: <AANLkTikR-3rGGahZ=FscPrGT1LTB8mxrisS017t-FzD+@mail.gmail.com>
References: <AANLkTinFvAPnPWOZ7gteiqY3rDmVPds4OJRULf=giGfT@mail.gmail.com>
	<AANLkTikUksyA5Z+VVmwjT5ukmpEfxfjVa-jnF9-_j9uo@mail.gmail.com>
	<AANLkTikR-3rGGahZ=FscPrGT1LTB8mxrisS017t-FzD+@mail.gmail.com>
Message-ID: <AANLkTik3HSnXtyXb_BZmBnZFXRH+S-1eWC_dpmBajuhT@mail.gmail.com>

On Tue, Dec 14, 2010 at 5:11 AM, Dave Smith <dave.smith.to at gmail.com> wrote:
> I truly hope that the dynamic nature of AMQP is not lost in this
> massive rewrite.

I think there are risks associated with 1.0, but loosing dynamic
nature is not one of them. In fact my feeling is that it will get more
dynamic, and in more regular way. I am more worried when will spec
reach a point where unambiguously defines behavior of system that is
like current 0.x ones. As far as I can see now it covers in great
detail (and flexibility!) basic node to node communication, but the
broker part is I am afraid still very much in ideas and concepts
stage. So in another words, risk as I see them is trying to cover too
much ground, and in the end not covering any part of it well enough to
produce solid _and_ truly interoperable standard for practical use
cases. But I hope those risks would be overcome.

Davorin Rusevljan
http://www.cloud208.com/

From jasonjwwilliams at gmail.com  Tue Dec 14 07:57:34 2010
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Tue, 14 Dec 2010 00:57:34 -0700
Subject: [rabbitmq-discuss] Impact of AMQP 1.0
In-Reply-To: <AANLkTik3HSnXtyXb_BZmBnZFXRH+S-1eWC_dpmBajuhT@mail.gmail.com>
References: <AANLkTinFvAPnPWOZ7gteiqY3rDmVPds4OJRULf=giGfT@mail.gmail.com>
	<AANLkTikUksyA5Z+VVmwjT5ukmpEfxfjVa-jnF9-_j9uo@mail.gmail.com>
	<AANLkTikR-3rGGahZ=FscPrGT1LTB8mxrisS017t-FzD+@mail.gmail.com>
	<AANLkTik3HSnXtyXb_BZmBnZFXRH+S-1eWC_dpmBajuhT@mail.gmail.com>
Message-ID: <A0126A9C-6559-4210-966A-D78F6437F7E1@gmail.com>



Sent via iPhone

Is your e-mail Premiere?

On Dec 14, 2010, at 0:40, Davorin Rusevljan <davorin.rusevljan at gmail.com> wrote:

> So in another words, risk as I see them is trying to cover too
> much ground, and in the end not covering any part of it well enough to
> produce solid _and_ truly interoperable standard for practical use
> cases.

I agree with this sentiment on 1.0. On a wire level I see where 1.0s changes will make gateways and interoperability mechanisms easier by making everyone a node. But the more important part I believe is keeping the current high level semantics the same...queues/exchanges/bindings etc.  It's the simplicity of these semantics that have made AMQP so successful and readily usable. I'd argue there are very few that should have to care or deeply understand the wire level. If you have to in order to relearn the high level semantics, I think that's a loss not a gain. 

-J

From david at rabbitmq.com  Tue Dec 14 08:55:13 2010
From: david at rabbitmq.com (David Wragg)
Date: Tue, 14 Dec 2010 08:55:13 +0000
Subject: [rabbitmq-discuss] Unable to store messages into queue
In-Reply-To: <AANLkTiknXY6OrS=ztS=OYvixYSyKx+RZAKJSTpoVPBmO@mail.gmail.com>
	(Dinh's message of "Tue, 14 Dec 2010 11:08:50 +0700")
References: <AANLkTiknXY6OrS=ztS=OYvixYSyKx+RZAKJSTpoVPBmO@mail.gmail.com>
Message-ID: <yrv4cr5dkbuoe.fsf@dwragg.eng.vmware.com>

Hi,

Dinh <pcdinh at gmail.com> writes:
> I got a strange situation with RabbitMQ 2.1.1, Mac OSX 10.6.5, erlang
> version : 5.8.1.1 (not sure if it is a bug): I was unable to store message
> into queue using Python clients.In fact, it is standard code I took from
> RabbitMQ site. So it is supposed to work. It already worked before. For me,
> yes.
>
> [...]
> channel.queue_declare(queue='feeds', durable=True)
> [...]
> channel.basic_publish(exchange='', routing_key='importer',
> [...]

In the code you provide, you declare a queue called 'feeds', but you are
trying to publish to a queue called 'importer'.  If no such queue
exists, these published messages will simply be discarded.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From Stefan.Kaes at xing.com  Tue Dec 14 09:12:39 2010
From: Stefan.Kaes at xing.com (Stefan Kaes)
Date: Tue, 14 Dec 2010 10:12:39 +0100
Subject: [rabbitmq-discuss] Handling network reliability problems on the
 publisher side
In-Reply-To: <4D063F00.8050300@rabbitmq.com>
Message-ID: <C92CF397.1BCF8%stefan.kaes@xing.com>

Thx for the quick answer.

I think we'll experiment with transactions and how how that works out.

-- stefan


Am 13.12.10 16:42 schrieb "Simon MacMullen" unter <simon at rabbitmq.com>:

> On 13/12/10 15:17, Stefan Kaes wrote:
> <snip>
> 
>> It looks like no programming cleverness on our side can achieve what we
>> want: have the publisher block as soon as a message cannot be accepted
>> by the intended rabbitmq server, because, as far as we understand the
>> amqp protocol, no protocol level acknowledgements are sent which the
>> publisher could wait for (and optionally timeout), before sending the
>> next message.
>> 
>> This is all fine to achieve high throughput on the publisher side, but
>> doesn?t quite fit our use case. For some messages, we really need to
>> make reasonably sure the message has been received by a rabbitmq server,
>> before we continue. We could then use timeouts to detect network
>> partitioning and buffer messages locally until they can be sent (only if
>> none of our three redundant servers can be reached, of course).
> 
> <snip>
> 
>>     * is the analysis correct?
> 
> Yes. Publishes are fully async in AMQP.
> 
>>     * is the JSON-RPC plugin stable enough to be used in production?
> 
> Interesting question. Our official position is that like all the plugins
> it is "unsupported". However it's pretty clear that some plugins are
> more supported than others, and JSON-RPC is pretty low down the pecking
> order.
> 
>>     * maybe there?s a better solution available?
> 
> The next release will feature publisher acknowledgements, where Rabbit
> will stream basic.acks back at you (if you ask for that). This sounds
> like exactly what you're looking for.
> 
> In the meantime, you could get away with publishing inside a
> transaction. When you commit the transaction, and get commit-ok back,
> you know Rabbit has got the message (and persisted it if it's
> persistent). Unfortunately this imposes a cost per commit - tweak the
> number of publishes per commit to tune performance versus maximum number
> of outstanding messages.
> 
> Cheers, Simon

Dr. Stefan Kaes
Principal System Architect
 
XING AG
Gaensemarkt 43, 20354 Hamburg, Germany
Tel. +49 40 419131-801, Fax +49 40 419131-11
 
Commercial Reg. (Registergericht): Amtsgericht Hamburg, HRB 98807
Exec. Board (Vorstand): Dr. Stefan Gro?-Selbeck (Vorsitzender), Ingo Chu,
Burkhard Blum, Michael Otto, Dr. Helmut Becker
Chairman of the Supervisory Board (Aufsichtsratsvorsitzender): Dr. Neil
Sunderland
 
Please join my network on XING: http://www.xing.com/go/invite/Stefan.Kaes

This email may contain confidential and/or privileged information. If you
are not the intended recipient (or have received this email in error) please
notify the sender immediately and destroy this email. Any unauthorized
copying, disclosure or distribution of the material in this email is
strictly forbidden and may be unlawful.


From pcdinh at gmail.com  Tue Dec 14 09:21:22 2010
From: pcdinh at gmail.com (Dinh)
Date: Tue, 14 Dec 2010 16:21:22 +0700
Subject: [rabbitmq-discuss] Unable to store messages into queue
In-Reply-To: <yrv4cr5dkbuoe.fsf@dwragg.eng.vmware.com>
References: <AANLkTiknXY6OrS=ztS=OYvixYSyKx+RZAKJSTpoVPBmO@mail.gmail.com>
	<yrv4cr5dkbuoe.fsf@dwragg.eng.vmware.com>
Message-ID: <AANLkTikdmPZS-68-RVbHtMsjrejoLPM2JgTr66BhW=jb@mail.gmail.com>

Hi David,

I have changed the code

import pika

import sys

import pickle

import json


connection = pika.AsyncoreConnection(pika.ConnectionParameters(

        host='127.0.0.1',

        credentials=pika.PlainCredentials('guest', 'guest')))

channel = connection.channel()


channel.queue_declare(queue='feeds', durable=True)


message = json.dumps({"import_feed": "http://cnn.com/rss/edition.rss"})

channel.basic_publish(exchange='feeds', routing_key='feeds',

                      body=message,

                      properties=pika.BasicProperties(

                         delivery_mode = 2, # make message persistent

                      ))

print " [x] Sent %r" % (message,)

Both exchange and queue are named: feeds. Queue "feeds" does exist as I
check with "rabbitmqctl list_queues"

However it does not work

Dinh-Phams-MacBook-Pro:~ dinhpham$ sudo
/Users/dinhpham/dev/rabbitmq_server-2.2.0/sbin/rabbitmqctl list_queues name
messages_ready messages_unacknowledged
Listing queues ...
feed2 0 0
feeds 0 0
...done.

Still, no message is stored. Nothing special found in the log file.

Is there any special case I need to take into consideration?

Thanks,

Dinh

On Tue, Dec 14, 2010 at 3:55 PM, David Wragg <david at rabbitmq.com> wrote:

> Hi,
>
> Dinh <pcdinh at gmail.com> writes:
> > I got a strange situation with RabbitMQ 2.1.1, Mac OSX 10.6.5, erlang
> > version : 5.8.1.1 (not sure if it is a bug): I was unable to store
> message
> > into queue using Python clients.In fact, it is standard code I took from
> > RabbitMQ site. So it is supposed to work. It already worked before. For
> me,
> > yes.
> >
> > [...]
> > channel.queue_declare(queue='feeds', durable=True)
> > [...]
> > channel.basic_publish(exchange='', routing_key='importer',
> > [...]
>
> In the code you provide, you declare a queue called 'feeds', but you are
> trying to publish to a queue called 'importer'.  If no such queue
> exists, these published messages will simply be discarded.
>
> David
>
> --
> David Wragg
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101214/90adeae5/attachment-0001.htm>

From david at rabbitmq.com  Tue Dec 14 09:48:15 2010
From: david at rabbitmq.com (David Wragg)
Date: Tue, 14 Dec 2010 09:48:15 +0000
Subject: [rabbitmq-discuss] Unable to store messages into queue
In-Reply-To: <AANLkTikdmPZS-68-RVbHtMsjrejoLPM2JgTr66BhW=jb@mail.gmail.com>
	(Dinh's message of "Tue, 14 Dec 2010 16:21:22 +0700")
References: <AANLkTiknXY6OrS=ztS=OYvixYSyKx+RZAKJSTpoVPBmO@mail.gmail.com>
	<yrv4cr5dkbuoe.fsf@dwragg.eng.vmware.com>
	<AANLkTikdmPZS-68-RVbHtMsjrejoLPM2JgTr66BhW=jb@mail.gmail.com>
Message-ID: <yrv4cmxo8bs80.fsf@dwragg.eng.vmware.com>

Hi,

Dinh <pcdinh at gmail.com> writes:
> [...]
> channel.queue_declare(queue='feeds', durable=True)
> [...]
> channel.basic_publish(exchange='feeds', routing_key='feeds',
> [...]

The exchange name should be the empty string '', as in your earlier code
and the example at <http://www.rabbitmq.com/tutorial-one-python.html>.
Only the routing key should contain the queue name.

See
<http://rajith.2rlabs.com/2007/10/13/amqp-in-10-mins-part4-standard-exchange-types-and-supporting-common-messaging-use-cases/>
for an explanation of AMQP exchange types, and how the nameless exchange
fits in.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From simon at rabbitmq.com  Tue Dec 14 10:14:10 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 14 Dec 2010 10:14:10 +0000
Subject: [rabbitmq-discuss] Why each time the call method
 channel.queueDeclarePassive(queueName) increment number of consumer?
In-Reply-To: <AANLkTinEXhXAiDO8D7QgBpm7N+xgFMU=HGCr+cQdwPvB@mail.gmail.com>
References: <AANLkTinEXhXAiDO8D7QgBpm7N+xgFMU=HGCr+cQdwPvB@mail.gmail.com>
Message-ID: <4D074372.1040702@rabbitmq.com>

On 13/12/10 23:34, Pascal Dergane wrote:
> Hi,
> I don't understand something about getConsumerCount() method.
>
> Following an example of my consumer Method according with tutorial. Each
> time my loop call queueDeclarePassive, the consumerCounter is
> incremented. I don't understand why, cause I re use always (each loop)
> the same consumer, so I expect that the  consumerCounter does not
> increment. Could you explain these observation and confirm that is not a
> bug? (I use V2.2.0 of java client with 2.2.0 rabbitMQ Server).
> Thanks,

Hi Pascal. Each time you're going through the while loop you're issuing 
basic.consume - that will set up a new consumer. basic consume means 
"send me messages until further notice", so you don't need to issue it 
more than once per queue.

Cheers, Simon
-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From markrogerhudson at gmail.com  Tue Dec 14 11:04:39 2010
From: markrogerhudson at gmail.com (Mark Hudson)
Date: Tue, 14 Dec 2010 11:04:39 +0000
Subject: [rabbitmq-discuss] Resolving hostnamesfor high availability
Message-ID: <AANLkTikQJuK9DjeWoP3o5yJSdG3o28Grd+3hjV7UxGU9@mail.gmail.com>

Two questions on resolving RabbitMQ broker hostnames

1.I'm able to cluster 2 or more rabbitmq brokers on different machines, but
to send a message I need to specify a hotsname/ipaddress. For redundancy, is
there some way to look up all the hosts within a cluster so I can pick a
running broker ?

2. When a broker is taken down, any connected consumers/producers get an
exception. Do I catch the exception and try to recconect to a live broker -
this relates to question 1 - or is there some other mechanism to handle this
?

Thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101214/7b6b6336/attachment.htm>

From markrogerhudson at gmail.com  Tue Dec 14 11:09:04 2010
From: markrogerhudson at gmail.com (Mark Hudson)
Date: Tue, 14 Dec 2010 11:09:04 +0000
Subject: [rabbitmq-discuss] Multi tenancy
Message-ID: <AANLkTimRAdt-zai0zWTcRn5B+hR-bFOFetx454fpz+Z-@mail.gmail.com>

My client wants to rent their application to multiple customers - multi
tenancy. I'm currently thinking to use a RabbitMQ virtual host per company,
so each company is separated with  their own queues, allowing me to
throttle, turn on/off consumers on a per company basis, and to scale out
a companies brokers if need be. Does this sound ok ?

I also propose to create accounts for the different consumers/producers in
the system, this would have to be multiplied by the number of companies, so
I could imagine the administration of all those users, permissions and nodes
might be a bit time consuming. Has anybody done something like this, or is
there a better approach ?

Thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101214/747fe0a0/attachment.htm>

From jon at jbrisbin.com  Tue Dec 14 12:24:57 2010
From: jon at jbrisbin.com (Jon Brisbin)
Date: Tue, 14 Dec 2010 06:24:57 -0600
Subject: [rabbitmq-discuss] Resolving hostnamesfor high availability
In-Reply-To: <AANLkTikQJuK9DjeWoP3o5yJSdG3o28Grd+3hjV7UxGU9@mail.gmail.com>
References: <AANLkTikQJuK9DjeWoP3o5yJSdG3o28Grd+3hjV7UxGU9@mail.gmail.com>
Message-ID: <FB190E47-2E4B-4506-A06A-CC10F048FA70@jbrisbin.com>


On Dec 14, 2010, at 5:04 AM, Mark Hudson wrote:

> Two questions on resolving RabbitMQ broker hostnames
> 
> 1.I'm able to cluster 2 or more rabbitmq brokers on different machines, but to send a message I need to specify a hotsname/ipaddress. For redundancy, is there some way to look up all the hosts within a cluster so I can pick a running broker ?
> 

You could use HAProxy:

http://haproxy.1wt.eu/

You get round-robin load balancing and failover, though you could skip the load balancing and just use it for failover. Then your clients always point to the proxy and you never have to change them, even if you add 20 brokers on the backend.

> 2. When a broker is taken down, any connected consumers/producers get an exception. Do I catch the exception and try to recconect to a live broker - this relates to question 1 - or is there some other mechanism to handle this ?

Reconnection is not easy. I've found it's best to keep your app aware enough of what consumers it has open at any time such that it can re-establish those consumers when the connection/channel gets re-created.

I know there's been some work recently in Spring AMQP to make this reconnection stuff less painful...

Thanks!

Jon Brisbin

        Web: http://jbrisbin.com/
    Twitter: @j_brisbin
      Skype: jon.brisbin

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101214/438addd2/attachment.htm>

From alexis at rabbitmq.com  Tue Dec 14 12:28:59 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Tue, 14 Dec 2010 12:28:59 +0000
Subject: [rabbitmq-discuss] Impact of AMQP 1.0
In-Reply-To: <A0126A9C-6559-4210-966A-D78F6437F7E1@gmail.com>
References: <AANLkTinFvAPnPWOZ7gteiqY3rDmVPds4OJRULf=giGfT@mail.gmail.com>
	<AANLkTikUksyA5Z+VVmwjT5ukmpEfxfjVa-jnF9-_j9uo@mail.gmail.com>
	<AANLkTikR-3rGGahZ=FscPrGT1LTB8mxrisS017t-FzD+@mail.gmail.com>
	<AANLkTik3HSnXtyXb_BZmBnZFXRH+S-1eWC_dpmBajuhT@mail.gmail.com>
	<A0126A9C-6559-4210-966A-D78F6437F7E1@gmail.com>
Message-ID: <AANLkTi=LX10G4q=VxKqfY33tciME2jRJ5vuijirnfpk+@mail.gmail.com>

Dave, Davorin, Jason,

I think the key question for RabbitMQ users is: will I be able to keep
using what I currently use?  The answer is YES.  RabbitMQ will keep
supporting 0-9-1 for the reasons that Jason lists below.  RabbitMQ has
a plugin for AMQP 1-0.  It also has a plugin for STOMP, and other
protocols.

alexis


On Tue, Dec 14, 2010 at 7:57 AM, Jason J. W. Williams
<jasonjwwilliams at gmail.com> wrote:
>
>
> Sent via iPhone
>
> Is your e-mail Premiere?
>
> On Dec 14, 2010, at 0:40, Davorin Rusevljan <davorin.rusevljan at gmail.com> wrote:
>
>> So in another words, risk as I see them is trying to cover too
>> much ground, and in the end not covering any part of it well enough to
>> produce solid _and_ truly interoperable standard for practical use
>> cases.
>
> I agree with this sentiment on 1.0. On a wire level I see where 1.0s changes will make gateways and interoperability mechanisms easier by making everyone a node. But the more important part I believe is keeping the current high level semantics the same...queues/exchanges/bindings etc. ?It's the simplicity of these semantics that have made AMQP so successful and readily usable. I'd argue there are very few that should have to care or deeply understand the wire level. If you have to in order to relearn the high level semantics, I think that's a loss not a gain.
>
> -J

From hpk.warrier at gmail.com  Tue Dec 14 13:24:42 2010
From: hpk.warrier at gmail.com (pradeep w)
Date: Tue, 14 Dec 2010 18:54:42 +0530
Subject: [rabbitmq-discuss] RabbitMQ not responding or in hung state
Message-ID: <AANLkTikggMY3r_yc_E2yE49nM_Q1i+X9dcOL9wHNPUn8@mail.gmail.com>

Hi
I'm trying performance testing with RabbitMQ for my scenario. And getting
into this state where RabbitMQ is not responding.
My scenario is like this:
a- Trigger process gets some minimal information to process..This gets
almost say a million plus such information.
b- it then puts this on this information in 20queues []. The consumers for
each of these then get the detail for the information passed to them.
c- After the detail fetch and necessary transformation, the content is then
passed on to further queue for processing. there is one processing queue
corresponding to
    each queue in (b).

So in total i'm running 20 + 20= 40 queues.
The situation that i'm running into is like this:
After processing some entries[random count], suddenly there is no activity
in RabbitMQ. If i kill one of the consumer, then some activity happens and
other queues process for some time.Then again it repeats and i kill some
other consumer. Finally killing all the consumers.
If i restart all consumers again things work for some time before showing
the same inaction behavior.

During the whole processing i never noticed CPU usage to go beyond 60% or
memory causing any issues. The Rabbit MQ overview states that it is not even
using 2% of available Erlang processes. And it also states that it is not
even using 20% of available memory.

I also could not relate it to DB level locking for my application. The
reason being when the rabbitmq stopped responding, i launched other process
[not using queues] and do the similar action on DB and that went fine.

To eliminate any issues due to Exchange share among the multiple queues, i
also tried creating 40 different exchanges and binding each to one & one
exchange only :( .
But still facing the same issues.

I'm running it [rabbitmq2.1.1] on windows 2003 server and using java client
to publish and consume message from rabbitmq.

At no time i see any rabbitmq or erlang related error or crash.

Some thing that i noticed for the first time, there are lots of connection
and channels each listening to some port [not specified by the application
code]. Seems to be created by RabbitMQ.

Any suggestion or remedy for my scenario.

thanks
pradeep
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101214/f89e2213/attachment.htm>

From simon at rabbitmq.com  Tue Dec 14 14:05:15 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 14 Dec 2010 14:05:15 +0000
Subject: [rabbitmq-discuss] Multi tenancy
In-Reply-To: <AANLkTimRAdt-zai0zWTcRn5B+hR-bFOFetx454fpz+Z-@mail.gmail.com>
References: <AANLkTimRAdt-zai0zWTcRn5B+hR-bFOFetx454fpz+Z-@mail.gmail.com>
Message-ID: <4D07799B.7020807@rabbitmq.com>

On 14/12/10 11:09, Mark Hudson wrote:
> My client wants to rent their application to multiple customers - multi
> tenancy. I'm currently thinking to use a RabbitMQ virtual host per
> company, so each company is separated with  their own queues, allowing
> me to throttle, turn on/off consumers on a per company basis, and to
> scale out a companies brokers if need be. Does this sound ok ?

That sounds fairly reasonable, but be aware that there's no quotas or 
any similar mechanism to prevent a greedy user from swamping the machine.

> I also propose to create accounts for the different consumers/producers
> in the system, this would have to be multiplied by the number of
> companies, so I could imagine the administration of all those users,
> permissions and nodes might be a bit time consuming. Has anybody done
> something like this, or is there a better approach ?

It shouldn't be too painful as long as you keep each user confined to 
its own vhost. I would write a script that used rabbitmqctl or 
rabbitmqadmin to read a list of companies and make sure all the needed 
users / vhosts / permissions exist (and raise an alarm if extra 
permissions exist).

In the future, pluggable authentication backends might help solve some 
of your problem.

Cheers, Simon
-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From jasonjwwilliams at gmail.com  Tue Dec 14 16:39:22 2010
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Tue, 14 Dec 2010 09:39:22 -0700
Subject: [rabbitmq-discuss] Multi tenancy
In-Reply-To: <4D07799B.7020807@rabbitmq.com>
References: <AANLkTimRAdt-zai0zWTcRn5B+hR-bFOFetx454fpz+Z-@mail.gmail.com>
	<4D07799B.7020807@rabbitmq.com>
Message-ID: <80EFA522-A3DF-493F-BF6D-FD737B7531B8@gmail.com>

This sounds like a situation that would benefit from max-retries on queues and a dead letter bin to help keep bad applications from swamping others. 

-J

Sent via iPhone

Is your e-mail Premiere?

On Dec 14, 2010, at 7:05, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 14/12/10 11:09, Mark Hudson wrote:
>> My client wants to rent their application to multiple customers - multi
>> tenancy. I'm currently thinking to use a RabbitMQ virtual host per
>> company, so each company is separated with  their own queues, allowing
>> me to throttle, turn on/off consumers on a per company basis, and to
>> scale out a companies brokers if need be. Does this sound ok ?
> 
> That sounds fairly reasonable, but be aware that there's no quotas or any similar mechanism to prevent a greedy user from swamping the machine.
> 
>> I also propose to create accounts for the different consumers/producers
>> in the system, this would have to be multiplied by the number of
>> companies, so I could imagine the administration of all those users,
>> permissions and nodes might be a bit time consuming. Has anybody done
>> something like this, or is there a better approach ?
> 
> It shouldn't be too painful as long as you keep each user confined to its own vhost. I would write a script that used rabbitmqctl or rabbitmqadmin to read a list of companies and make sure all the needed users / vhosts / permissions exist (and raise an alarm if extra permissions exist).
> 
> In the future, pluggable authentication backends might help solve some of your problem.
> 
> Cheers, Simon
> -- 
> Simon MacMullen
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matt at mydomedia.com  Tue Dec 14 16:39:33 2010
From: matt at mydomedia.com (Matt Miller)
Date: Tue, 14 Dec 2010 11:39:33 -0500 (EST)
Subject: [rabbitmq-discuss] Multi tenancy
In-Reply-To: <AANLkTimRAdt-zai0zWTcRn5B+hR-bFOFetx454fpz+Z-@mail.gmail.com>
Message-ID: <1753704561.1016.1292344773568.JavaMail.root@zimbra>


I had a similar issue; there exists an experimental ldap authentication/authorization plugin. It sounds promising but I have not got it to run on my system. LDAP also turned out to be a real pain.. slapd works great but the documentation is very confusing and convoluted as the distro specifics and implementation have been volatile.

If interested you might want to try compiling the auth-ldap plugin and use Apache DS.

post back your experience. if you move forward .. 

,
Matt

----- Original Message -----
From: "Mark Hudson" <markrogerhudson at gmail.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Tuesday, December 14, 2010 6:09:04 AM
Subject: [rabbitmq-discuss] Multi tenancy




My client wants to rent their application to multiple customers - multi tenancy. I'm currently thinking to use a RabbitMQ virtual host per company, so each company is separated with their own queues, allowing me to throttle, turn on/off consumers on a per company basis, and to scale out a companies brokers if need be. Does this sound ok ? 


I also propose to create accounts for the different consumers/producers in the system, this would have to be multiplied by the number of companies, so I could imagine the administration of all those users, permissions and nodes might be a bit time consuming. Has anybody done something like this, or is there a better approach ? 


Thanks. 






_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From jasonjwwilliams at gmail.com  Tue Dec 14 16:43:00 2010
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Tue, 14 Dec 2010 09:43:00 -0700
Subject: [rabbitmq-discuss] Multi tenancy
In-Reply-To: <1753704561.1016.1292344773568.JavaMail.root@zimbra>
References: <1753704561.1016.1292344773568.JavaMail.root@zimbra>
Message-ID: <E2E5CDC3-8AB8-4688-B311-582EF6F73032@gmail.com>

OpenDS is also a good option over OpenLDAP. 

-J

Sent via iPhone

Is your e-mail Premiere?

On Dec 14, 2010, at 9:39, Matt Miller <matt at mydomedia.com> wrote:

> 
> I had a similar issue; there exists an experimental ldap authentication/authorization plugin. It sounds promising but I have not got it to run on my system. LDAP also turned out to be a real pain.. slapd works great but the documentation is very confusing and convoluted as the distro specifics and implementation have been volatile.
> 
> If interested you might want to try compiling the auth-ldap plugin and use Apache DS.
> 
> post back your experience. if you move forward .. 
> 
> ,
> Matt
> 
> ----- Original Message -----
> From: "Mark Hudson" <markrogerhudson at gmail.com>
> To: rabbitmq-discuss at lists.rabbitmq.com
> Sent: Tuesday, December 14, 2010 6:09:04 AM
> Subject: [rabbitmq-discuss] Multi tenancy
> 
> 
> 
> 
> My client wants to rent their application to multiple customers - multi tenancy. I'm currently thinking to use a RabbitMQ virtual host per company, so each company is separated with their own queues, allowing me to throttle, turn on/off consumers on a per company basis, and to scale out a companies brokers if need be. Does this sound ok ? 
> 
> 
> I also propose to create accounts for the different consumers/producers in the system, this would have to be multiplied by the number of companies, so I could imagine the administration of all those users, permissions and nodes might be a bit time consuming. Has anybody done something like this, or is there a better approach ? 
> 
> 
> Thanks. 
> 
> 
> 
> 
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simon at rabbitmq.com  Tue Dec 14 16:51:31 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 14 Dec 2010 16:51:31 +0000
Subject: [rabbitmq-discuss] Multi tenancy
In-Reply-To: <1753704561.1016.1292344773568.JavaMail.root@zimbra>
References: <1753704561.1016.1292344773568.JavaMail.root@zimbra>
Message-ID: <4D07A093.1040306@rabbitmq.com>

On 14/12/10 16:39, Matt Miller wrote:
> I had a similar issue; there exists an experimental ldap
> authentication/authorization plugin. It sounds promising but I have
> not got it to run on my system.

I'd describe it as more than experimental :) It's there as much as 
anything to test a plugin mechanism for authentication / authorisation - 
and that mechanism is itself experimental at the moment :)

Hopefully at some point in the future this will all get merged and then 
the LDAP plugin will be a binary download like the others.

> LDAP also turned out to be a real
> pain.. slapd works great but the documentation is very confusing and
> convoluted as the distro specifics and implementation have been
> volatile.

That's quite true, slapd is pretty horrible to get started with.

> If interested you might want to try compiling the auth-ldap plugin
> and use Apache DS.

I think we talked about this before. I'm interested to note that it 
sounds like you're not so concerned about LDAP itself, as in having a 
way to manage large numbers of users / vhosts. Is that fair?

At the moment our plans for authentication / authorisation plugins 
involve virtual hosts still residing inside RabbitMQ - only users and 
permissions would be external. Would that work for your use case?

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From matt at mydomedia.com  Tue Dec 14 17:23:12 2010
From: matt at mydomedia.com (Matt Miller)
Date: Tue, 14 Dec 2010 12:23:12 -0500 (EST)
Subject: [rabbitmq-discuss] Multi tenancy
In-Reply-To: <4D07A093.1040306@rabbitmq.com>
Message-ID: <33958396.1022.1292347392322.JavaMail.root@zimbra>

Hi Simon,

> I think we talked about this before. I'm interested to note that it 
> sounds like you're not so concerned about LDAP itself, as in having a 
> way to manage large numbers of users / vhosts. Is that fair?

Yes the previous statement is true, what I really need ldap/auth backend is for user auth. 
It seems the current state of the plugin would suffice my needs. 

,
Matt
----- Original Message -----
From: "Simon MacMullen" <simon at rabbitmq.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Tuesday, December 14, 2010 11:51:31 AM
Subject: Re: [rabbitmq-discuss] Multi tenancy

On 14/12/10 16:39, Matt Miller wrote:
> I had a similar issue; there exists an experimental ldap
> authentication/authorization plugin. It sounds promising but I have
> not got it to run on my system.

I'd describe it as more than experimental :) It's there as much as 
anything to test a plugin mechanism for authentication / authorisation - 
and that mechanism is itself experimental at the moment :)

Hopefully at some point in the future this will all get merged and then 
the LDAP plugin will be a binary download like the others.

> LDAP also turned out to be a real
> pain.. slapd works great but the documentation is very confusing and
> convoluted as the distro specifics and implementation have been
> volatile.

That's quite true, slapd is pretty horrible to get started with.

> If interested you might want to try compiling the auth-ldap plugin
> and use Apache DS.

I think we talked about this before. I'm interested to note that it 
sounds like you're not so concerned about LDAP itself, as in having a 
way to manage large numbers of users / vhosts. Is that fair?

At the moment our plans for authentication / authorisation plugins 
involve virtual hosts still residing inside RabbitMQ - only users and 
permissions would be external. Would that work for your use case?

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From majek04 at gmail.com  Tue Dec 14 18:00:00 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Tue, 14 Dec 2010 18:00:00 +0000
Subject: [rabbitmq-discuss] RabbitMQ not responding or in hung state
In-Reply-To: <AANLkTikggMY3r_yc_E2yE49nM_Q1i+X9dcOL9wHNPUn8@mail.gmail.com>
References: <AANLkTikggMY3r_yc_E2yE49nM_Q1i+X9dcOL9wHNPUn8@mail.gmail.com>
Message-ID: <AANLkTin9WVEVqk83uGhf=TnA9avFZ+QCmHUxuenHBR6g@mail.gmail.com>

On Tue, Dec 14, 2010 at 13:24, pradeep w <hpk.warrier at gmail.com> wrote:
> The situation that i'm running into is like this:
> After processing some entries[random count], suddenly there is no activity
> in RabbitMQ. If i kill one of the consumer, then some activity happens and
> other queues process for some time.Then again it repeats and i kill some
> other consumer. Finally killing all the consumers.
> If i restart all consumers again things work for some time before?showing
> the same inaction behavior.

Sounds like 'basic.ack' and 'basic.qos' issue.

Are you using 'basic.qos'?
Are you using acks (no_ack=False) and do you always remember to do basic_ack?

http://www.rabbitmq.com/tutorial-two-python.html

Cheers,
  Marek

From jerryk at vmware.com  Tue Dec 14 19:24:58 2010
From: jerryk at vmware.com (Jerry Kuch)
Date: Tue, 14 Dec 2010 11:24:58 -0800
Subject: [rabbitmq-discuss] queues going down
In-Reply-To: <7E33FF227654744AA0DC4379FDD952A201981AC882BA@OTTMEX.ad.cdic.ca>
References: <B262D32CF4B5B74AA16AA2A6DD9D9C5D15D2ABF62A@OTTMEX.ad.cdic.ca>
	<7E33FF227654744AA0DC4379FDD952A201981AC882A9@OTTMEX.ad.cdic.ca>
	<30121F7779BAA84DB5B2C72CD3571FDD0631EEF945@EXCH-MBX-5.vmware.com>
	<7E33FF227654744AA0DC4379FDD952A201981AC882AE@OTTMEX.ad.cdic.ca>
	<30121F7779BAA84DB5B2C72CD3571FDD0631EEF9A7@EXCH-MBX-5.vmware.com>
	<B262D32CF4B5B74AA16AA2A6DD9D9C5D15D2ABF632@OTTMEX.ad.cdic.ca>
	<30121F7779BAA84DB5B2C72CD3571FDD0631EEF9B4@EXCH-MBX-5.vmware.com>
	<AANLkTi=voE=iwSBbA7FFwRbL9fSN7-iEG4PZAVQh2LeV@mail.gmail.com>
	<9909195D-51F8-40C7-BDCC-E8236EE72E03@vmware.com>
	<7E33FF227654744AA0DC4379FDD952A201981AC882AF@OTTMEX.ad.cdic.ca>
	<032A4ABB-25FE-40E5-98F6-30B27663C1D0@vmware.com>
	<7E33FF227654744AA0DC4379FDD952A201981AC882B3@OTTMEX.ad.cdic.ca>
	<000D3C25-3DA9-4201-9F35-E8D383046471@vmware.com>
	<7E33FF227654744AA0DC4379FDD952A201981AC882BA@OTTMEX.ad.cdic.ca>
Message-ID: <545952F5-69A9-42D8-84C1-6A607B0297F4@vmware.com>

Hi, Peter and Steph...

On Dec 14, 2010, at 7:04 AM, C-Peter Ritchie wrote:

> Hi Jerry.  In 64-bit windows with a 32-bit process you're more likely to get a full 2GB memory; but, if IMAGE_FILE_LARGE_ADDRESS_AWARE is set (see http://www.gidhome.com/gid3gb/index.html) then a 32-bit process can get 4GB of RAM.  64-bit Windows doesn't support the /3GB option to give processes more than 2GB of virtual memory.

Good to confirm.

>  As far as I can tell (see http://support.microsoft.com/kb/294418) the application has to tell Windows it's ok addressing a full 4GB (see above link).

Right.... IIRC this is stamped in a field in the PE file, and I think it's still possible for an executable so-stamped to contain code that might do the wrong thing with 32-bit addresses whose high bit is set, so just modifying the headers of one's binaries might produce surprising results.

> The messages we're sending are about 1400 bytes (also looking at shrinking that) and we're set to persistent.  So, my concern is the effect these are having on memory and the resulting crash.  I understand Rabbit/Erlang need to do some special tricks to get any sort of performance with thousands/millions of messages; but, if that results in the queue crashing under load, this has me concerned.

Ideally one wants enough working memory for Rabbit that the amount of data queued in memory isn't going to be such that Rabbit is compelled to start swapping messages to disk.  Obviously if there's enough of an imbalance between producers and consumers, sustained for a long enough period, then no amount of RAM will keep one out of the woods forever.  Similarly disks are finite in size, disk writes take time, etc.

> I also understand Rabbit is a bit of a mash-up of Erlang and Rabbit and a bit at the mercy of varying versions of each; so, maybe this is just a matter of getting a couple of versions of things that work best...

The Rabbit to Erlang relationship is analogous to the relationship of "some version of some Java application" to a JVM/JRE release:  not particularly mashed up, but one can't have total freedom to change arbitrarily without the other staying in touch with it.  Our Windows Rabbit "complete bundle" distributions include their own Erlang to save users a step and the potential headache of running an Erlang woefully mismatched for their Rabbit release.

Is it a complete bundle distribution that you're working with, or did you put things together from separate components?

> We have a dump file that I "created" yesterday.  If you have an ftp server or something I can send it over.  It's about 1.47 MB; so, I doubt it's going to get through email very easily.

It might be very handy for us to get ahold of that.  If an Erlang runtime exists abnormally, the erl_crash.dump file should contain a lot of forensics on it.  I suspect I'll be OK receiving it on this account; failing that I can give you a gmail account that should be able to accommodate it.  So just to confirm, does it seem that you are seeing a bona fide crash, i.e. one where the Erlang VM running Rabbit is ceasing to exist, or just a Rabbit that becomes unresponsive to the outside world?

> This scenario is absent of any consumer; so, yes, more aggressive consumption could likely cause some benefit.  My concern is that in a distributed system, where any one of our components could go offline for any number of reasons, we could get in this situation quite easily.  It seems that data loss is quite possible due to this.

Alas, this will be something to guard against in any event, or at least monitor for.  The memory-based flow control system in Rabbit exists to let Rabbit keep running even when its available memory is overwhelmed by producer-side load, by persisting messages to disk, and then blocking connected producers until it can catch up, if it can't push stuff to disk quickly enough to match their pace.  In any distributed architecture one has to be able to monitor the health of one's subsystems and react accordingly.  Even with the most over-engineered subsystems something has to give at some point.

Jerry


> -----Original Message-----
> From: Jerry Kuch [mailto:jerryk at vmware.com]
> Sent: Monday, December 13, 2010 8:54 PM
> To: C-Peter Ritchie
> Cc: Jim Apperly; Gregory Chorebanian; Steph Swierenga; rabbitmq info; John DeTreville
> Subject: Re: queues going down
>
> Hi, Peter...
>
> My apologies...  I hit send prematurely on an earlier message I wasn't quite finished with yet...  Here's the rest of what I was going to say about your situation.
>
> The vm_memory_high_watermark setting of 0.8 in your rabbitmq.config file expresses a fraction of the amount of memory Rabbit detects in your system to use as its alarm level.  In the 'INFO REPORT' log entries at startup we see a limit of 819MB, which gives:
>
> 819MB/0.8 = 1023MB
>
> So Erlang/Rabbit appears to think your machine has 1GB of RAM for its use.  You can tweak the fraction as you want to goose the limit up to a level you'd like, but there are a couple of things you'll want to keep in mind:
>
> 1. If Erlang is running as a 32-bit process under Windows, it's probably only going to be given 2GB of user address space at best, regardless of how much physical RAM is on the box.  Off the top of my head I don't know the rules 64-bit Windows imposes on 32-bit processes, but I know that natively 32-bit versions of Windows by default split the 32-bit/4GB address space half and half between user and system space, with the option to set it instead to 3GB of user space and 1 GB system space at boot time.  That latter configuration used to be used by folks running things like memory hungry database servers.  Perhaps 64-bit versions of Windows provide some latitude on tweaking the split on a process by process basis?
>
> 2. You shouldn't push the memory limit value that Rabbit announces at startup past half or so of the available RAM on your system.  Ideally you would like to leave some breathing room for the system to experience spikes in memory usage between its garbage collections.  You also don't want it to compete too aggressively with any file caching your OS might be doing, since you could lose throughput as reads that would otherwise be cached are forced to go to disk.
>
> Bottom line, my current working hypothesis on your configuration is that your 32-bit Erlang/Rabbit process is getting at most 2GB of user address space given to it by Windows, Erlang is deciding to only grab half of that for itself, and your vm_memory_high_watermark setting is setting the alarm threshold at 80% of that, to give you the 819MB you see.
>
> Recall that this isn't a limit on how much memory Rabbit will try to use, but rather the threshold at which its memory based flow control will kick in.  With flow control in force the server will pause reads from the sockets of clients, inhibiting their ability to send contentful messages, suspending connection heartbeats, etc.  Normal server behavior resumes when the memory pressure abates with the intent being that when flow control is in force, producers are rate limited while consumers are allowed to operate normally, thereby hopefully allowing the pressure on the system to remit naturally.
>
> Is it possible that your testing scenario could benefit form having more, or more aggressive consumers to better balance the pressure that vigorous producers are putting on the system?  And that a production system based on it could make sure to keep the consumption side of the equation sufficiently balanced?  I don't recall that we ever established for sure that your broker process was actually dying---in the absence of a crash_dump.erl file or log entries indicating crashes or imminent crashes, is it possible that it's just becoming unresponsive to producers due to flow control?
>
> Best regards,
> Jerry
>
> On Dec 13, 2010, at 10:14 AM, C-Peter Ritchie wrote:
>
>> Hi Jerry.
>>
>> I've been trying to bump up the memory limit but I can't seem to get it to change.  Based on the docs the config  file should be located at %APPDATA%\RabbitMQ\rabbitmq.config  There was neither a RabbitMQ directory there, nor a RabbitMQ\rabbitmq.config file; so, I created them and restarted the service (with a line: [{rabbit, [{vm_memory_high_watermark, 0.8}]}] ).  The log still contained "Memory limit set to 819MB." about the time the service restarted.   The %APPDATA% value happened to point to AppData\Roaming, and I noticed that was a RabbitMQ directory in AppData\Local.  I tried also added a rabbitmq.config in AppData\Local\RabbitMQ; but that also did not change the memory limit.
>>
>> Is there a way to find out what RabbitMQ is configured for in terms of the location of the config file?
>>
>> Cheers -- Peter
>>
>> -----Original Message-----
>> From: Jerry Kuch [mailto:jerryk at vmware.com]
>> Sent: Friday, December 10, 2010 4:22 PM
>> To: C-Peter Ritchie
>> Cc: Jim Apperly; Gregory Chorebanian; Steph Swierenga; rabbitmq info;
>> John DeTreville
>> Subject: Re: queues going down
>>
>> Hi, Peter...
>>
>> Thanks for investigating.  That memory limit sounds like it might be a bit on the low side.  You might try bumping it up and seeing if your problem doesn't reproduce.  Does the broker process actually die, or does it just seem to stop reading the content thrown at it by your clients?
>>
>> A broker under memory pressure has a memory alarm mechanism that will stop it from reading from the sockets of connected clients until the alarm condition is resolved either by delivery of the stored messages the shunting of them to disk.
>>
>> There's documentation on memory-based flow control here:
>>
>> http://www.rabbitmq.com/extensions.html
>>
>> You may find it profitable to check your current settings and try some alternatives, although by all means, the standalone repro-example would be great for us to look at...
>>
>> BTW the page above also has a note about older versions of Erlang (pre-R13B) having trouble determining how much memory they're working with on Windows...  I'm not sure if those affect your setup or not.
>>
>> Thanks,
>> Jerry
>>
>> On Dec 10, 2010, at 1:07 PM, C-Peter Ritchie wrote:
>>
>>> Hi Jim.  The computer we're  running Rabbit on has 8GB of RAM
>>>
>>> This is the last entry from the log:
>>> =INFO REPORT==== 10-Dec-2010::12:36:30 === Limiting to approx 412
>>> file handles (368 sockets)
>>>
>>> =INFO REPORT==== 10-Dec-2010::12:36:30 === Memory limit set to 819MB.
>>>
>>> There is no CRASH REPORT text in the log file
>>>
>>> The sasl log seems to always be empty.  Attached are the log files in the log directory immediately post-crash.
>>>
>>> I'll work on getting a smaller example that reproduces the problem.  Right now we're reading data from a database and pumping messages into the queue.  The database is on a different computer.  I'll see if I can come up with an example that  is stand-alone.
>>>
>>> Cheers -- Peter
>>>
>>> -----Original Message-----
>>> From: Jerry Kuch [mailto:jerryk at vmware.com]
>>> Sent: Friday, December 10, 2010 3:12 PM
>>> To: Jim Apperly
>>> Cc: Gregory Chorebanian; Steph Swierenga; C-Peter Ritchie; rabbitmq
>>> info; John DeTreville
>>> Subject: Re: queues going down
>>>
>>> Hi, Steph and Peter...
>>>
>>> To get started hunting down the source of your problem, may I send some questions your way?  In particular:
>>>
>>> 1. How much memory is installed on the machine you're using as your Rabbit server?
>>>
>>> 2. What memory limit does Rabbit report in its logs when it starts up?  To find it check your main rabbit log for lines looking something like the following:
>>>
>>> =INFO REPORT==== 10-Dec-2010::12:04:47 === Memory limit set to 8365MB.
>>>
>>> The file handle limit, which is reported in similar format at startup might also be interesting to see.
>>>
>>> 3. If you scan through the main Rabbit log looking for ERROR REPORT or CRASH REPORT, do you find anything suspicious?
>>>
>>> 4. Are you able to send us the entirety of your main rabbit.log and rabbit-sasl.log?  (To figure out where those are landing, look at the broker's startup messages for lines that look something like:
>>>
>>> log            : /var/folders/HI/HITiCI9qFWSs0nVW3pzyCU+++TI/-Tmp-//rabbit at StrongMad.log<mailto:/var/folders/HI/HITiCI9qFWSs0nVW3pzyCU+++TI/-Tmp-//rabbit at StrongMad.log>
>>> sasl log       : /var/folders/HI/HITiCI9qFWSs0nVW3pzyCU+++TI/-Tmp-//rabbit at StrongMad-sasl.log<mailto:/var/folders/HI/HITiCI9qFWSs0nVW3pzyCU+++TI/-Tmp-//rabbit at StrongMad-sasl.log>
>>>
>>> 5. Can you distill the client code that's driving your Rabbit to failure into a small standalone program that you could pass our way so that we could attempt to locally reproduce the failure?  I could build a Windows box in a virtual machine to chase this down further if so.
>>>
>>> 6. When the crash occurs, has the rabbit server OS process stopped and ceased to exist?  Or does it remain, but in an unusable state?
>>>
>>> Thanks for any additional information you can provide...
>>>
>>> Best regards,
>>> Jerry
>>> RabbitMQ Team
>>>
>>>
>>> On Dec 10, 2010, at 11:58 AM, Jim Apperly wrote:
>>>
>>> Steph, Greg,
>>>
>>> On 10 December 2010 19:55, Gregory Chorebanian <gchorebanian at vmware.com<mailto:gchorebanian at vmware.com>> wrote:
>>> It was my error to assume you were already going down the road of Rabbit.  Jim - I think R&D is looking to the issue correct?  Can you make a guess as to when we will have an answer?
>>>
>>> It's Friday evening here at Rabbit HQ (London) and most of us Rabbits have gone home.  However, I'm cc'ing John and Jerry from our Pacific Rim team who have got a lot more of Friday remaining.
>>>
>>> Guys - over to you.
>>>
>>> Jim
>>>
>>>
>>>
>>> From: Steph Swierenga
>>> [mailto:SSwierenga at cdic.ca<mailto:SSwierenga at cdic.ca>]
>>> Sent: Friday, December 10, 2010 2:51 PM
>>> To: Gregory Chorebanian
>>> Cc: Jim Apperly; C-Peter Ritchie
>>>
>>> Subject: RE: queues going down
>>>
>>>
>>> Hey, so we're not officially in development, or production yet. We're in the process of evaluating RabbitMQ vs MSMQ as our messaging solution going forward. The problem we've encountered below would be a show-stopper for us. Is there any way we can work out a per-incident fee for this?
>>>
>>> Thanks,
>>> Steph.
>>>
>>> From: Gregory Chorebanian
>>> [mailto:gchorebanian at vmware.com<mailto:gchorebanian at vmware.com>]
>>> Sent: December-10-10 2:43 PM
>>> To: C-Peter Ritchie
>>> Cc: Steph Swierenga; Jim Apperly
>>> Subject: RE: queues going down
>>>
>>> No worries...
>>>
>>> We have three options really..
>>>
>>> If you are not yet in production - we have Developer support @ 2k per person.
>>>
>>> Production - is what I described below @ $3k per cpu per year.
>>>
>>> Or we can do a consulting engagement - generally these carry a 4 day minimum @ 3k per day.
>>>
>>> We can also combine the support and consulting together.
>>>
>>> I am on my cell @ 978-973-4688 feel free to give me a call.
>>>
>>> Regards,
>>> Greg
>>>
>>> From: C-Peter Ritchie
>>> [mailto:PRitchie at cdic.ca<mailto:PRitchie at cdic.ca>]
>>> Sent: Friday, December 10, 2010 2:40 PM
>>> To: Gregory Chorebanian
>>> Cc: Steph Swierenga; Jim Apperly
>>> Subject: RE: queues going down
>>>
>>> Hi Greg.  I'll have to defer the decision about the contract to Steph.
>>>
>>> From: Gregory Chorebanian
>>> [mailto:gchorebanian at vmware.com<mailto:gchorebanian at vmware.com>]
>>> Sent: Friday, December 10, 2010 1:00 PM
>>> To: C-Peter Ritchie
>>> Cc: Steph Swierenga; Jim Apperly
>>> Subject: RE: queues going down
>>>
>>> Peter,
>>>
>>> I added Jim back to the thread - he can help a bit on the technical side.  For support we contract it out by CPU - for Rabbit we charge 3k per CPU per year.
>>>
>>> Should I send the contract to you so we can get a proper support ticket open?
>>>
>>> Let me know,
>>> Greg
>>>
>>> From: C-Peter Ritchie
>>> [mailto:PRitchie at cdic.ca<mailto:PRitchie at cdic.ca>]
>>> Sent: Friday, December 10, 2010 11:41 AM
>>> To: Gregory Chorebanian
>>> Cc: Steph Swierenga; Jeff Miller
>>> Subject: RE: queues going down
>>>
>>> Hi Greg.  My name is Peter Ritchie and I'm working with Steph on
>>> integrating RabbitMQ into our system
>>>
>>> We've installed  RabbitMQ on a  Windows 2008 server (VM: 64 bit with 4 cores).  It's setup to run as a Windows service.  We are sending it about 2,000,000 messages where each message is about 1650 bytes.  We're finding that when the queue reaches about 262,000-328,000 queued messages, the Rabbit MQ server crashes.
>>>
>>> We currently don't have a deployment of 32-bit Windows to test this scenario.
>>>
>>> We're using Erlang 5.8.1.1 and RabbitMQ server 2.2.0.  This is in .Net with the RabbitMQ .NET Client 2.2.0.
>>>
>>> If there's any other information you need; please let me know.
>>>
>>> Thanks -- Peter
>>>
>>>
>>>
>>> From: Jeff Miller
>>> [mailto:millerj at vmware.com<mailto:millerj at vmware.com>]
>>> Sent: Friday, December 10, 2010 9:48 AM
>>> To: Jim Apperly; Steph Swierenga
>>> Cc: info at rabbitmq.com<mailto:info at rabbitmq.com>; Jamie Engesser;
>>> Gregory Chorebanian
>>> Subject: RE: queues going down
>>>
>>> Steph,
>>>
>>> Greg Chorebanian will help you with this request.
>>>
>>> Jeff Miller
>>> Vice President of Sales, Americas
>>> vFabric, Cloud Application Platform Division VMware
>>> 770-241-7809
>>>
>>>
>>>
>>> From: jim.apperly at gmail.com<mailto:jim.apperly at gmail.com>
>>> [mailto:jim.apperly at gmail.com<mailto:jim.apperly at gmail.com>] On
>>> Behalf Of Jim Apperly
>>> Sent: Friday, December 10, 2010 9:31 AM
>>> To: Steph Swierenga
>>> Cc: info at rabbitmq.com<mailto:info at rabbitmq.com>; Jamie Engesser; Jeff
>>> Miller
>>> Subject: Re: queues going down
>>>
>>> Hi Steph,
>>>
>>> We offer commercial support for RabbitMQ through the SpringSource division of VMware. I am cc'ing some colleagues who will be able to connect you with the right people to follow up with this.
>>>
>>> So that we can best help you please can you tell us more about your problem? Have you tried reproducing the issue on 32bit Windows?
>>>
>>> Best wishes
>>> Jim
>>>
>>> On 10 December 2010 13:52, Steph Swierenga <SSwierenga at cdic.ca<mailto:SSwierenga at cdic.ca>> wrote:
>>> Hey, looking for some support (commercial?) for the rabbit. We're hosting the server in a windows service running on Windows Server 2008 (64-bit) and seem to be running into a buffering problem.
>>>
>>> Can you hook me up with a call?
>>>
>>> Thanks,
>>> Steph Swierenga,
>>> Ottawa, Canada
>>> 613 850-8898
>>>
>>>
>>>
>>>
>>> <rabbit at PAYSVC-TEST.log><rabbit at PAYSVC-TEST.log.1><rabbit at PAYSVC-TEST
>>> - sasl.log><rabbit at PAYSVC-TEST-sasl.log.1>
>>
>


From eric.l.2046 at gmail.com  Wed Dec 15 03:02:38 2010
From: eric.l.2046 at gmail.com (Eric Liang)
Date: Wed, 15 Dec 2010 11:02:38 +0800
Subject: [rabbitmq-discuss] Rabbitmq-xmpp patches and the future.
Message-ID: <4D082FCE.1050300@gmail.com>

Hi all,

I've done some patches for rabbitmq-xmpp recently, which was released by
Tony Garnock-Jones (
http://www.lshift.net/blog/2008/07/01/rabbitmq-xmpp-gateway-released ).
The patches have been posted to github (
https://github.com/ericliang/rabbitmq-xmpp ). I've contacted Tony and he
has no time to check these patches right now and suggested that
I get in touch with the list ( thanks Tony for your attention and those
enlightening conversations ).  So would anyone here like to test/review
these patches and/or to merge them to the official repository if
valuable? Thanks in advance.

By the way, as Tony suggested and we reach an agreement on the future
version of rabbitmq-xmpp, which the service should be a plugin as
rabbitmq-stomp and communicate with the ejabberd server with the help of
an xmpp client library. And in that case, the Rabbit team should be the
best one to do that I guess. Anyway, if there is no roadmap for it or
the future, this would be a suggestion and I'd like to do more work on
it when necessary.  Would you mind to tell something about this?

Thanks for your attention and any other suggestions are appreciated.
Eric

-- 
-----BEGIN GEEK CODE BLOCK-----
Version: 3.1
GCM/CS/E/MU/P d+(-) s: a- C++ UL$ P+>++ L++ E++ W++ N+ o+>++ K+++ w !O
M-(+) V-- PS+ PE+ Y+ PGP++ t? 5? X? R+>* tv@ b++++ DI-- D G++ e++>+++@ h*
r !y+ 
------END GEEK CODE BLOCK------


From hpk.warrier at gmail.com  Wed Dec 15 08:26:14 2010
From: hpk.warrier at gmail.com (pradeep w)
Date: Wed, 15 Dec 2010 13:56:14 +0530
Subject: [rabbitmq-discuss] RabbitMQ not responding or in hung state
In-Reply-To: <AANLkTin9WVEVqk83uGhf=TnA9avFZ+QCmHUxuenHBR6g@mail.gmail.com>
References: <AANLkTikggMY3r_yc_E2yE49nM_Q1i+X9dcOL9wHNPUn8@mail.gmail.com>
	<AANLkTin9WVEVqk83uGhf=TnA9avFZ+QCmHUxuenHBR6g@mail.gmail.com>
Message-ID: <AANLkTikgyMpQJU6FU=KT4--iw7Fddrkdbr-_GybJ71Wo@mail.gmail.com>

Thanks Marek.
I am using ack. I solved the problem. Actually i was too ambitious with the
performance. Was using threads to queue posting as well. Though not sure
exactly why, but there lot of connections and channels were getting created.
And these i was not able to relate to any relevant consumer processes. Then
i moved these out of thread and did refactoring for passing same connection
object. Now there are no more extra (or i'll say orphan) connections and
channels. Till now i've not faced problem after the code modification.

Will rework the same with threads once the current execution gets over.


On Tue, Dec 14, 2010 at 11:30 PM, Marek Majkowski <majek04 at gmail.com> wrote:

> On Tue, Dec 14, 2010 at 13:24, pradeep w <hpk.warrier at gmail.com> wrote:
> > The situation that i'm running into is like this:
> > After processing some entries[random count], suddenly there is no
> activity
> > in RabbitMQ. If i kill one of the consumer, then some activity happens
> and
> > other queues process for some time.Then again it repeats and i kill some
> > other consumer. Finally killing all the consumers.
> > If i restart all consumers again things work for some time before showing
> > the same inaction behavior.
>
> Sounds like 'basic.ack' and 'basic.qos' issue.
>
> Are you using 'basic.qos'?
> Are you using acks (no_ack=False) and do you always remember to do
> basic_ack?
>
> http://www.rabbitmq.com/tutorial-two-python.html
>
> Cheers,
>   Marek
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101215/a2c38355/attachment.htm>

From alexis at rabbitmq.com  Wed Dec 15 09:38:27 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Wed, 15 Dec 2010 09:38:27 +0000
Subject: [rabbitmq-discuss] Rabbitmq-xmpp patches and the future.
In-Reply-To: <4D082FCE.1050300@gmail.com>
References: <4D082FCE.1050300@gmail.com>
Message-ID: <AANLkTi=9cxpH5gzYDosYMs=HryteSAGq94vEbbdT3bi1@mail.gmail.com>

Eric

Nice work!

Please do tell us more about this.

alexis

On Wed, Dec 15, 2010 at 3:02 AM, Eric Liang <eric.l.2046 at gmail.com> wrote:
> Hi all,
>
> I've done some patches for rabbitmq-xmpp recently, which was released by
> Tony Garnock-Jones (
> http://www.lshift.net/blog/2008/07/01/rabbitmq-xmpp-gateway-released ).
> The patches have been posted to github (
> https://github.com/ericliang/rabbitmq-xmpp ). I've contacted Tony and he
> has no time to check these patches right now and suggested that
> I get in touch with the list ( thanks Tony for your attention and those
> enlightening conversations ). ?So would anyone here like to test/review
> these patches and/or to merge them to the official repository if
> valuable? Thanks in advance.
>
> By the way, as Tony suggested and we reach an agreement on the future
> version of rabbitmq-xmpp, which the service should be a plugin as
> rabbitmq-stomp and communicate with the ejabberd server with the help of
> an xmpp client library. And in that case, the Rabbit team should be the
> best one to do that I guess. Anyway, if there is no roadmap for it or
> the future, this would be a suggestion and I'd like to do more work on
> it when necessary. ?Would you mind to tell something about this?
>
> Thanks for your attention and any other suggestions are appreciated.
> Eric
>
> --
> -----BEGIN GEEK CODE BLOCK-----
> Version: 3.1
> GCM/CS/E/MU/P d+(-) s: a- C++ UL$ P+>++ L++ E++ W++ N+ o+>++ K+++ w !O
> M-(+) V-- PS+ PE+ Y+ PGP++ t? 5? X? R+>* tv@ b++++ DI-- D G++ e++>+++@ h*
> r !y+
> ------END GEEK CODE BLOCK------
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From eric.l.2046 at gmail.com  Wed Dec 15 13:13:09 2010
From: eric.l.2046 at gmail.com (Eric Liang)
Date: Wed, 15 Dec 2010 21:13:09 +0800
Subject: [rabbitmq-discuss] Rabbitmq-xmpp patches and the future.
In-Reply-To: <AANLkTi=9cxpH5gzYDosYMs=HryteSAGq94vEbbdT3bi1@mail.gmail.com>
References: <4D082FCE.1050300@gmail.com>
	<AANLkTi=9cxpH5gzYDosYMs=HryteSAGq94vEbbdT3bi1@mail.gmail.com>
Message-ID: <4D08BEE5.6060102@gmail.com>

On 12/15/2010 05:38 PM, Alexis Richardson wrote:
> Eric
>
> Nice work!
>
> Please do tell us more about this.
Thanks Alexis for your attention.

What I've done to the project have been already added to the text file
in the repository: README.CUSTOMIZED. As it might be too brief for you,
I'd like to explain some details in the following.

I've separated the initial modules to four individual ones, and the main
purpose is to index the codes by module. That is, the initial module (
mod_rabbitmq ) will communicate with the xmpp clients and route the
consume-related requests to the consumer processes, while all the
functions about how to consume are implemented in the consumer module (
mod_rabbitmq_consumer ). As these two modules will directly communicate
with the rabbitmq-node, some utility functions are distilled to an
individual module ( mod_rabbitmq_util ). To reduce the calls in function
like basic_consume, the mod_rabbitmq_util module will load a library to
the rabbitmq-node , and this is why the mod_rabbitmq_util_priv module is
designed.

Meanwhile,  a heartbeat check on the rabbitmq-node is added, which will
print error message when retrying to connect and grab the latest
rabbitmq-node configuration in ejabberd if the retry times overflowed a
default setting (5). The check on the connection is simply a ping
action. And once the rabbitmq-node was updated when retrying, it will
broadcast the change to all of the consumer processes, since the node
configuration is stored in the process data.

That's all I can think of it for now. Please do not hesitate to contact
me if any further information was required.

Thanks,
Eric

> On Wed, Dec 15, 2010 at 3:02 AM, Eric Liang <eric.l.2046 at gmail.com> wrote:
>> Hi all,
>>
>> I've done some patches for rabbitmq-xmpp recently, which was released by
>> Tony Garnock-Jones (
>> http://www.lshift.net/blog/2008/07/01/rabbitmq-xmpp-gateway-released ).
>> The patches have been posted to github (
>> https://github.com/ericliang/rabbitmq-xmpp ). I've contacted Tony and he
>> has no time to check these patches right now and suggested that
>> I get in touch with the list ( thanks Tony for your attention and those
>> enlightening conversations ).  So would anyone here like to test/review
>> these patches and/or to merge them to the official repository if
>> valuable? Thanks in advance.
>>
>> By the way, as Tony suggested and we reach an agreement on the future
>> version of rabbitmq-xmpp, which the service should be a plugin as
>> rabbitmq-stomp and communicate with the ejabberd server with the help of
>> an xmpp client library. And in that case, the Rabbit team should be the
>> best one to do that I guess. Anyway, if there is no roadmap for it or
>> the future, this would be a suggestion and I'd like to do more work on
>> it when necessary.  Would you mind to tell something about this?
>>
>> Thanks for your attention and any other suggestions are appreciated.
>> Eric
>>
>> --
>> -----BEGIN GEEK CODE BLOCK-----
>> Version: 3.1
>> GCM/CS/E/MU/P d+(-) s: a- C++ UL$ P+>++ L++ E++ W++ N+ o+>++ K+++ w !O
>> M-(+) V-- PS+ PE+ Y+ PGP++ t? 5? X? R+>* tv@ b++++ DI-- D G++ e++>+++@ h*
>> r !y+
>> ------END GEEK CODE BLOCK------
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>


-- 
-----BEGIN GEEK CODE BLOCK-----
Version: 3.1
GCM/CS/E/MU/P d+(-) s: a- C++ UL$ P+>++ L++ E++ W++ N+ o+>++ K+++ w !O
M-(+) V-- PS+ PE+ Y+ PGP++ t? 5? X? R+>* tv@ b++++ DI-- D G++ e++>+++@ h*
r !y+
------END GEEK CODE BLOCK------


From matt.oconnell at itaction.co.uk  Wed Dec 15 14:55:22 2010
From: matt.oconnell at itaction.co.uk (Matt Oconnell)
Date: Wed, 15 Dec 2010 14:55:22 GMT
Subject: [rabbitmq-discuss] SNMP Plugin.
Message-ID: <18689133d7.133d718689@it-action.com>

I'm having some issues getting the experimental SNMP plugin to work.
Rabbitmq is new to me, and i'm tasked with providing some monitoring 
tools.

I've installed the 2.2.0 server on Centos OS 5. 
When i follow the build instrutctions in github, using version_1.7 of 
rabbitmq-server, the build fails. When i use an upto date version of 
the rabbitmq-public-umbrella the build runs ok after 
adding "APPNAME=rabbit_snmp" to the Makefile.

However, when i drop the zip file into the plugins directory, and 
update /etc/rabbitmq/rabbitmq.config as detailed. I get the following 
error when starting the server...

Activating RabbitMQ plugins ...
1 plugins activated:
* rabbit_snmp-0.0.1

{"could not start kernel pid",application_controller,"error in config 
file \"/etc/rabbitmq/rabbitmq.config\" (7): bad term"}

Crash dump was written to: erl_crash.dump
could not start kernel pid (application_controller) (error in config 
file "/etc/rabbitmq/rabbitmq.config" (7): bad term)


and here is the contents of said file

{rabbit_snmp,
   [
    % set the desired data update interval in milliseconds
    {update_interval, 10000}
   ]
  },
  {snmp, [
    {agent, [
      % db_dir will be set by the snmp plugin before it starts snmp so 
leave this commented out
      %{db_dir, ""},
      {versions, [v1, v2]},
      % dir will be added by the snmp plugin before it starts snmp, so 
dont add it to the config block below
      {config, [{verbosity, silence}]},
      {net_if, [{verbosity, silence}]}
    ]},
    {verbosity, silence}
  ]}
.

so is this an erlang error regarding the definition of the app?
Any pointers would be appreciated..

Thanks
Mat

From taylste at gmail.com  Wed Dec 15 16:28:30 2010
From: taylste at gmail.com (Steven Taylor)
Date: Wed, 15 Dec 2010 16:28:30 +0000
Subject: [rabbitmq-discuss] error: "Pipelining of requests forbidden" on C#
	client
Message-ID: <AANLkTikKT7eXyD6Ukqx1bNei=84JCbRkZ+XmsJUOP-t2@mail.gmail.com>

Hi,

Got this error: "Pipelining of requests forbidden"

Found a reference in the documentation (see below).  As part of the "I
assert queue exists" logic, I was (re-)declaring the exhange.  Is that
wrong?

 Could it be a threading issue?

http://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v1.5.0/rabbitmq-dotnet-client-1.5.0-user-guide.pdf

 NotSupportedExceptions being thrown from a method in class
> RpcContinuationQueue
>
> complaining about "Pipelining of requests forbidden" (which occurs in
> situations where
>
> more than one AMQP RPC, such as ExchangeDeclare, is run simultaneously).
>
Offending Line:

BasicGetResult msg=ch.BasicGet(QueueNme,false);


thanks,
-Steven
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101215/2f8985a3/attachment.htm>

From taylste at gmail.com  Wed Dec 15 16:29:47 2010
From: taylste at gmail.com (Steven Taylor)
Date: Wed, 15 Dec 2010 16:29:47 +0000
Subject: [rabbitmq-discuss] error: "Pipelining of requests forbidden" on
	C# client
In-Reply-To: <AANLkTikKT7eXyD6Ukqx1bNei=84JCbRkZ+XmsJUOP-t2@mail.gmail.com>
References: <AANLkTikKT7eXyD6Ukqx1bNei=84JCbRkZ+XmsJUOP-t2@mail.gmail.com>
Message-ID: <AANLkTi=QFxP_Rrhw=3JWbLNO+-qA3tX9mRRWvAF4ZtU_@mail.gmail.com>

... it has only hapenned once so far.

On 15 December 2010 16:28, Steven Taylor <taylste at gmail.com> wrote:

> Hi,
>
> Got this error: "Pipelining of requests forbidden"
>
> Found a reference in the documentation (see below).  As part of the "I
> assert queue exists" logic, I was (re-)declaring the exhange.  Is that
> wrong?
>
>  Could it be a threading issue?
>
>
> http://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v1.5.0/rabbitmq-dotnet-client-1.5.0-user-guide.pdf
>
>  NotSupportedException
>> s being thrown from a method in class RpcContinuationQueue
>>
>> complaining about
>> "Pipelining of requests forbidden" (which occurs in situations where
>>
>> more than one AMQP RPC, such as
>> ExchangeDeclare, is run simultaneously).
>>
> Offending Line:
>
> BasicGetResult msg=ch.BasicGet(QueueNme,false);
>
>
> thanks,
> -Steven
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101215/e4827a67/attachment.htm>

From scott at beamdog.com  Wed Dec 15 16:55:46 2010
From: scott at beamdog.com (Scott Brooks)
Date: Wed, 15 Dec 2010 09:55:46 -0700
Subject: [rabbitmq-discuss] SNMP Plugin.
In-Reply-To: <18689133d7.133d718689@it-action.com>
References: <18689133d7.133d718689@it-action.com>
Message-ID: <AANLkTi=9EmNW+ePtBZ-xTJtSzYQtby9hGns3vHcycKqu@mail.gmail.com>

I'm assuming you're using
https://github.com/epicadvertising/rabbitmq_snmp_plugin

I originally wrote it for RabbitMQ 1.7, and as far as I know it has
not been touched/updated since, so I certainly wouldn't try and use it
on 2.2.

It probably wouldn't be a lot of work to get it updated to 2.2, and
either integrate it into the management plugin or re-use the fine
grained statistics, but either of those options would require some
more development work on it which I don't have the time for right now.

When I was originally working on it, my hope was that someone at
RabbitMQ would grab the .mib(the hardest part) and integrate it into
core, but this has not happened yet/I have no clue if they plan on it.

You may want to look at the Management plugin and see if you can pull
the stats you need from that.
Scott

On Wed, Dec 15, 2010 at 7:55 AM, Matt Oconnell
<matt.oconnell at itaction.co.uk> wrote:
> I'm having some issues getting the experimental SNMP plugin to work.
> Rabbitmq is new to me, and i'm tasked with providing some monitoring
> tools.
>
> I've installed the 2.2.0 server on Centos OS 5.
> When i follow the build instrutctions in github, using version_1.7 of
> rabbitmq-server, the build fails. When i use an upto date version of
> the rabbitmq-public-umbrella the build runs ok after
> adding "APPNAME=rabbit_snmp" to the Makefile.
>
> However, when i drop the zip file into the plugins directory, and
> update /etc/rabbitmq/rabbitmq.config as detailed. I get the following
> error when starting the server...
>
> Activating RabbitMQ plugins ...
> 1 plugins activated:
> * rabbit_snmp-0.0.1
>
> {"could not start kernel pid",application_controller,"error in config
> file \"/etc/rabbitmq/rabbitmq.config\" (7): bad term"}
>
> Crash dump was written to: erl_crash.dump
> could not start kernel pid (application_controller) (error in config
> file "/etc/rabbitmq/rabbitmq.config" (7): bad term)
>
>
> and here is the contents of said file
>
> {rabbit_snmp,
> ? [
> ? ?% set the desired data update interval in milliseconds
> ? ?{update_interval, 10000}
> ? ]
> ?},
> ?{snmp, [
> ? ?{agent, [
> ? ? ?% db_dir will be set by the snmp plugin before it starts snmp so
> leave this commented out
> ? ? ?%{db_dir, ""},
> ? ? ?{versions, [v1, v2]},
> ? ? ?% dir will be added by the snmp plugin before it starts snmp, so
> dont add it to the config block below
> ? ? ?{config, [{verbosity, silence}]},
> ? ? ?{net_if, [{verbosity, silence}]}
> ? ?]},
> ? ?{verbosity, silence}
> ?]}
> .
>
> so is this an erlang error regarding the definition of the app?
> Any pointers would be appreciated..
>
> Thanks
> Mat
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From jerryk at vmware.com  Wed Dec 15 16:56:29 2010
From: jerryk at vmware.com (Jerry Kuch)
Date: Wed, 15 Dec 2010 08:56:29 -0800
Subject: [rabbitmq-discuss] error: "Pipelining of requests forbidden" on
 C#	client
In-Reply-To: <AANLkTikKT7eXyD6Ukqx1bNei=84JCbRkZ+XmsJUOP-t2@mail.gmail.com>
References: <AANLkTikKT7eXyD6Ukqx1bNei=84JCbRkZ+XmsJUOP-t2@mail.gmail.com>
Message-ID: <5554523B-5296-4F11-B0CA-BBD45BB1C10E@vmware.com>

Steven:  Is there any chance that the channel instance on which you're doing this work is being used by more than one thread?

In the .NET client one expects this error when something tries to queue up more than one RPC continuation in the internal continuation queue at a time.  The Rabbit .NET client user guide talks about such thread safety issues:

http://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v1.5.0/rabbitmq-dotnet-client-1.5.0-user-guide.pdf

in some detail in a couple of spots.

The Rabbit Java client has similar restrictions.  With both the Java and .NET clients, it makes sense to structure your application so that a unique thread owns a given instance of a non-thread safe Rabbit client resource (e.g. Channels in the Java client, IModel in the .NET).

Best regards,
Jerry

On Dec 15, 2010, at 8:28 AM, Steven Taylor wrote:

Hi,

Got this error: "Pipelining of requests forbidden"

Found a reference in the documentation (see below).  As part of the "I assert queue exists" logic, I was (re-)declaring the exhange.  Is that wrong?

Could it be a threading issue?

http://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v1.5.0/rabbitmq-dotnet-client-1.5.0-user-guide.pdf

NotSupportedException

s being thrown from a method in class RpcContinuationQueue

complaining about

"Pipelining of requests forbidden" (which occurs in situations where

more than one AMQP RPC, such as

ExchangeDeclare, is run simultaneously).

Offending Line:
BasicGetResult msg=ch.BasicGet(QueueNme,false);

thanks,
-Steven
<ATT00001..txt>


From paul.pearcy at wallst.com  Wed Dec 15 18:12:06 2010
From: paul.pearcy at wallst.com (Paul Pearcy)
Date: Wed, 15 Dec 2010 13:12:06 -0500
Subject: [rabbitmq-discuss] Trouble building rabbitmq-c on windows
Message-ID: <5C3F8D74DE0D8344AF4E68E53DAB10DD05EA0A477C@IS-EXCHANGEC101.wsod.local>

Hello,
  I am unfortunately stuck on Windows and C land and am trying to get the rabbitmq-c client built up on windows using the Visual Studio compiler.

First off, this client is marked as experimental. I am curious how experimental this is... for instance, would I be a fool to use this library for production purposes? If so, is there a different recommended library or should I be looking at a different messaging system with better C support?

I am have gone through the README.windows many times and think I understand the steps, but there is some disconnect.

Here are the steps I took:

1)      Grabbed the recommended mingw package using the given install script

2)      Coped rabbitmq-c and rabbitmq-codegen(though I'm not sure what this one does yet) into the mingw directory.

3)      Start up the bash from my new mingw

4)      Verify that python is available and that /bin is in my path for mingw apps (I actually had to add /bin to my PATH)

5)      Ran the mount command as specified: mount 'C:\mingw' /mingw - this succeeds

6)      Enter the rabbitmq-c directory and kick off the build: etc/build-ms.sh


Below are the outputs from the configure run. I have tried this on a Windows7 machine and a WindowsXP machine and in both cases, I got the same results. It looks to me like the command to verify the compiler isn't being run correctly.

Please let me know if there are any ideas.

Thanks,
Paul


Here is the output from this:

Using Visual Studio install at /C/Program Files/Microsoft Visual Studio 8
Using Windows SDK install at /C/Program Files (x86)/Microsoft Visual Studio 8/VC
/PlatformSDK
+ autoreconf -i
C:\mingw\bin\libtoolize: Consider adding `AC_CONFIG_MACRO_DIR([m4])' to configur
e.ac and
C:\mingw\bin\libtoolize: rerunning C:\mingw\bin\libtoolize, to keep the correct
libtool macros in-tree.
C:\mingw\bin\libtoolize: Consider adding `-I m4' to ACLOCAL_AMFLAGS in Makefile.
am.
+ ./configure CC=cl.exe LD=link.exe CFLAGS=-nologo
checking for a BSD-compatible install... /bin//install -c
checking whether build environment is sane... yes
checking for a thread-safe mkdir -p... /bin//mkdir -p
checking for gawk... gawk
checking whether make sets $(MAKE)... yes
checking for style of include used by make... GNU
checking for gcc... cl.exe
checking whether the C compiler works... no
configure: error: in `/rabbitmq-c-fd437100993d':
configure: error: C compiler cannot create executables
See `config.log' for more details.

Here is what I see in the config.log:
configure:3061: checking for C compiler version
configure:3070: cl.exe --version >&5
Microsoft (R) Incremental Linker Version 8.00.50727.42
Copyright (C) Microsoft Corporation.  All rights reserved.


/out:Oy-.exe
C:/mingw/Oy-
LINK : fatal error LNK1181: cannot open input file 'C:/mingw/Oy-.obj'
Microsoft (R) C/C++ Optimizing Compiler Version 14.00.50727.42 for x64
Copyright (C) Microsoft Corporation.  All rights reserved.

cl : Command line warning D9002 : ignoring unknown option '--version'
cl : Command line warning D9024 : unrecognized source file type 'C:/mingw/Oy-', object file assumed
configure:3081: $? = 2
configure:3070: cl.exe -v >&5
Microsoft (R) Incremental Linker Version 8.00.50727.42
Copyright (C) Microsoft Corporation.  All rights reserved.


/out:Oy-.exe
C:/mingw/Oy-
LINK : fatal error LNK1181: cannot open input file 'C:/mingw/Oy-.obj'
Microsoft (R) C/C++ Optimizing Compiler Version 14.00.50727.42 for x64
Copyright (C) Microsoft Corporation.  All rights reserved.

cl : Command line warning D9002 : ignoring unknown option '-v'
cl : Command line warning D9024 : unrecognized source file type 'C:/mingw/Oy-', object file assumed
configure:3081: $? = 2
configure:3070: cl.exe -V >&5
Microsoft (R) C/C++ Optimizing Compiler Version 14.00.50727.42 for x64
Copyright (C) Microsoft Corporation.  All rights reserved.

cl : Command line error D8004 : '/V' requires an argument
configure:3081: $? = 2
configure:3070: cl.exe -qversion >&5
Microsoft (R) Incremental Linker Version 8.00.50727.42
Copyright (C) Microsoft Corporation.  All rights reserved.


/out:Oy-.exe
C:/mingw/Oy-
LINK : fatal error LNK1181: cannot open input file 'C:/mingw/Oy-.obj'
Microsoft (R) C/C++ Optimizing Compiler Version 14.00.50727.42 for x64
Copyright (C) Microsoft Corporation.  All rights reserved.

cl : Command line warning D9002 : ignoring unknown option '-qversion'
cl : Command line warning D9024 : unrecognized source file type 'C:/mingw/Oy-', object file assumed
configure:3081: $? = 2
configure:3101: checking whether the C compiler works
configure:3123: cl.exe -nologo   conftest.c  >&5
cl : Command line warning D9024 : unrecognized source file type 'C:/mingw/Oy-', object file assumed
conftest.c
LINK : fatal error LNK1181: cannot open input file 'C:/mingw/Oy-.obj'
configure:3127: $? = 2
configure:3165: result: no
configure: failed program was:
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101215/7e5a2946/attachment.htm>

From paul.pearcy at wallst.com  Wed Dec 15 20:36:08 2010
From: paul.pearcy at wallst.com (Paul Pearcy)
Date: Wed, 15 Dec 2010 15:36:08 -0500
Subject: [rabbitmq-discuss] Trouble building rabbitmq-c on windows
In-Reply-To: <5C3F8D74DE0D8344AF4E68E53DAB10DD05EA0A477C@IS-EXCHANGEC101.wsod.local>
References: <5C3F8D74DE0D8344AF4E68E53DAB10DD05EA0A477C@IS-EXCHANGEC101.wsod.local>
Message-ID: <5C3F8D74DE0D8344AF4E68E53DAB10DD05EA0A47B7@IS-EXCHANGEC101.wsod.local>

I got past my initial error by adding spaces to the start and end of my $CL env variable. For some reason mingw didn't like them, while cygwin is fine either way.

Now stuck on this error:
configure:3128: cl.exe -nologo   conftest.c  >&5
conftest.c
LINK : error LNK2001: unresolved external symbol _mainCRTStartup
conftest.exe : fatal error LNK1120: 1 unresolved externals
I can run the command outside of the configure script and get it to succeed, so I am a little baffled.

Thanks,
Paul

From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Paul Pearcy
Sent: Wednesday, December 15, 2010 11:12 AM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: [rabbitmq-discuss] Trouble building rabbitmq-c on windows

Hello,
  I am unfortunately stuck on Windows and C land and am trying to get the rabbitmq-c client built up on windows using the Visual Studio compiler.

First off, this client is marked as experimental. I am curious how experimental this is... for instance, would I be a fool to use this library for production purposes? If so, is there a different recommended library or should I be looking at a different messaging system with better C support?

I am have gone through the README.windows many times and think I understand the steps, but there is some disconnect.

Here are the steps I took:

1)      Grabbed the recommended mingw package using the given install script

2)      Coped rabbitmq-c and rabbitmq-codegen(though I'm not sure what this one does yet) into the mingw directory.

3)      Start up the bash from my new mingw

4)      Verify that python is available and that /bin is in my path for mingw apps (I actually had to add /bin to my PATH)

5)      Ran the mount command as specified: mount 'C:\mingw' /mingw - this succeeds

6)      Enter the rabbitmq-c directory and kick off the build: etc/build-ms.sh


Below are the outputs from the configure run. I have tried this on a Windows7 machine and a WindowsXP machine and in both cases, I got the same results. It looks to me like the command to verify the compiler isn't being run correctly.

Please let me know if there are any ideas.

Thanks,
Paul


Here is the output from this:

Using Visual Studio install at /C/Program Files/Microsoft Visual Studio 8
Using Windows SDK install at /C/Program Files (x86)/Microsoft Visual Studio 8/VC
/PlatformSDK
+ autoreconf -i
C:\mingw\bin\libtoolize: Consider adding `AC_CONFIG_MACRO_DIR([m4])' to configur
e.ac and
C:\mingw\bin\libtoolize: rerunning C:\mingw\bin\libtoolize, to keep the correct
libtool macros in-tree.
C:\mingw\bin\libtoolize: Consider adding `-I m4' to ACLOCAL_AMFLAGS in Makefile.
am.
+ ./configure CC=cl.exe LD=link.exe CFLAGS=-nologo
checking for a BSD-compatible install... /bin//install -c
checking whether build environment is sane... yes
checking for a thread-safe mkdir -p... /bin//mkdir -p
checking for gawk... gawk
checking whether make sets $(MAKE)... yes
checking for style of include used by make... GNU
checking for gcc... cl.exe
checking whether the C compiler works... no
configure: error: in `/rabbitmq-c-fd437100993d':
configure: error: C compiler cannot create executables
See `config.log' for more details.

Here is what I see in the config.log:
configure:3061: checking for C compiler version
configure:3070: cl.exe --version >&5
Microsoft (R) Incremental Linker Version 8.00.50727.42

Copyright (C) Microsoft Corporation.  All rights reserved.



/out:Oy-.exe

C:/mingw/Oy-

LINK : fatal error LNK1181: cannot open input file 'C:/mingw/Oy-.obj'

Microsoft (R) C/C++ Optimizing Compiler Version 14.00.50727.42 for x64
Copyright (C) Microsoft Corporation.  All rights reserved.

cl : Command line warning D9002 : ignoring unknown option '--version'
cl : Command line warning D9024 : unrecognized source file type 'C:/mingw/Oy-', object file assumed
configure:3081: $? = 2
configure:3070: cl.exe -v >&5
Microsoft (R) Incremental Linker Version 8.00.50727.42

Copyright (C) Microsoft Corporation.  All rights reserved.



/out:Oy-.exe

C:/mingw/Oy-

LINK : fatal error LNK1181: cannot open input file 'C:/mingw/Oy-.obj'

Microsoft (R) C/C++ Optimizing Compiler Version 14.00.50727.42 for x64
Copyright (C) Microsoft Corporation.  All rights reserved.

cl : Command line warning D9002 : ignoring unknown option '-v'
cl : Command line warning D9024 : unrecognized source file type 'C:/mingw/Oy-', object file assumed
configure:3081: $? = 2
configure:3070: cl.exe -V >&5
Microsoft (R) C/C++ Optimizing Compiler Version 14.00.50727.42 for x64
Copyright (C) Microsoft Corporation.  All rights reserved.

cl : Command line error D8004 : '/V' requires an argument
configure:3081: $? = 2
configure:3070: cl.exe -qversion >&5
Microsoft (R) Incremental Linker Version 8.00.50727.42

Copyright (C) Microsoft Corporation.  All rights reserved.



/out:Oy-.exe

C:/mingw/Oy-

LINK : fatal error LNK1181: cannot open input file 'C:/mingw/Oy-.obj'

Microsoft (R) C/C++ Optimizing Compiler Version 14.00.50727.42 for x64
Copyright (C) Microsoft Corporation.  All rights reserved.

cl : Command line warning D9002 : ignoring unknown option '-qversion'
cl : Command line warning D9024 : unrecognized source file type 'C:/mingw/Oy-', object file assumed
configure:3081: $? = 2
configure:3101: checking whether the C compiler works
configure:3123: cl.exe -nologo   conftest.c  >&5
cl : Command line warning D9024 : unrecognized source file type 'C:/mingw/Oy-', object file assumed

conftest.c

LINK : fatal error LNK1181: cannot open input file 'C:/mingw/Oy-.obj'

configure:3127: $? = 2
configure:3165: result: no
configure: failed program was:
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101215/c0e45a61/attachment-0001.htm>

From paul.pearcy at wallst.com  Wed Dec 15 20:55:23 2010
From: paul.pearcy at wallst.com (Paul Pearcy)
Date: Wed, 15 Dec 2010 15:55:23 -0500
Subject: [rabbitmq-discuss] Trouble building rabbitmq-c on windows
In-Reply-To: <5C3F8D74DE0D8344AF4E68E53DAB10DD05EA0A47B7@IS-EXCHANGEC101.wsod.local>
References: <5C3F8D74DE0D8344AF4E68E53DAB10DD05EA0A477C@IS-EXCHANGEC101.wsod.local>
	<5C3F8D74DE0D8344AF4E68E53DAB10DD05EA0A47B7@IS-EXCHANGEC101.wsod.local>
Message-ID: <5C3F8D74DE0D8344AF4E68E53DAB10DD05EA0A47C3@IS-EXCHANGEC101.wsod.local>

Sorry for the noise, I believe I have gotten to the bottom of this.

By default on our systems, we have the $CL var have a couple of default values that were not playing nice. After clearing this var and restarting everything, things look sane.


From: Paul Pearcy
Sent: Wednesday, December 15, 2010 1:36 PM
To: Paul Pearcy; rabbitmq-discuss at lists.rabbitmq.com
Subject: RE: Trouble building rabbitmq-c on windows

I got past my initial error by adding spaces to the start and end of my $CL env variable. For some reason mingw didn't like them, while cygwin is fine either way.

Now stuck on this error:
configure:3128: cl.exe -nologo   conftest.c  >&5
conftest.c

LINK : error LNK2001: unresolved external symbol _mainCRTStartup

conftest.exe : fatal error LNK1120: 1 unresolved externals

I can run the command outside of the configure script and get it to succeed, so I am a little baffled.

Thanks,
Paul

From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Paul Pearcy
Sent: Wednesday, December 15, 2010 11:12 AM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: [rabbitmq-discuss] Trouble building rabbitmq-c on windows

Hello,
  I am unfortunately stuck on Windows and C land and am trying to get the rabbitmq-c client built up on windows using the Visual Studio compiler.

First off, this client is marked as experimental. I am curious how experimental this is... for instance, would I be a fool to use this library for production purposes? If so, is there a different recommended library or should I be looking at a different messaging system with better C support?

I am have gone through the README.windows many times and think I understand the steps, but there is some disconnect.

Here are the steps I took:

1)      Grabbed the recommended mingw package using the given install script

2)      Coped rabbitmq-c and rabbitmq-codegen(though I'm not sure what this one does yet) into the mingw directory.

3)      Start up the bash from my new mingw

4)      Verify that python is available and that /bin is in my path for mingw apps (I actually had to add /bin to my PATH)

5)      Ran the mount command as specified: mount 'C:\mingw' /mingw - this succeeds

6)      Enter the rabbitmq-c directory and kick off the build: etc/build-ms.sh


Below are the outputs from the configure run. I have tried this on a Windows7 machine and a WindowsXP machine and in both cases, I got the same results. It looks to me like the command to verify the compiler isn't being run correctly.

Please let me know if there are any ideas.

Thanks,
Paul


Here is the output from this:

Using Visual Studio install at /C/Program Files/Microsoft Visual Studio 8
Using Windows SDK install at /C/Program Files (x86)/Microsoft Visual Studio 8/VC
/PlatformSDK
+ autoreconf -i
C:\mingw\bin\libtoolize: Consider adding `AC_CONFIG_MACRO_DIR([m4])' to configur
e.ac and
C:\mingw\bin\libtoolize: rerunning C:\mingw\bin\libtoolize, to keep the correct
libtool macros in-tree.
C:\mingw\bin\libtoolize: Consider adding `-I m4' to ACLOCAL_AMFLAGS in Makefile.
am.
+ ./configure CC=cl.exe LD=link.exe CFLAGS=-nologo
checking for a BSD-compatible install... /bin//install -c
checking whether build environment is sane... yes
checking for a thread-safe mkdir -p... /bin//mkdir -p
checking for gawk... gawk
checking whether make sets $(MAKE)... yes
checking for style of include used by make... GNU
checking for gcc... cl.exe
checking whether the C compiler works... no
configure: error: in `/rabbitmq-c-fd437100993d':
configure: error: C compiler cannot create executables
See `config.log' for more details.

Here is what I see in the config.log:
configure:3061: checking for C compiler version
configure:3070: cl.exe --version >&5
Microsoft (R) Incremental Linker Version 8.00.50727.42

Copyright (C) Microsoft Corporation.  All rights reserved.



/out:Oy-.exe

C:/mingw/Oy-

LINK : fatal error LNK1181: cannot open input file 'C:/mingw/Oy-.obj'

Microsoft (R) C/C++ Optimizing Compiler Version 14.00.50727.42 for x64
Copyright (C) Microsoft Corporation.  All rights reserved.

cl : Command line warning D9002 : ignoring unknown option '--version'
cl : Command line warning D9024 : unrecognized source file type 'C:/mingw/Oy-', object file assumed
configure:3081: $? = 2
configure:3070: cl.exe -v >&5
Microsoft (R) Incremental Linker Version 8.00.50727.42

Copyright (C) Microsoft Corporation.  All rights reserved.



/out:Oy-.exe

C:/mingw/Oy-

LINK : fatal error LNK1181: cannot open input file 'C:/mingw/Oy-.obj'

Microsoft (R) C/C++ Optimizing Compiler Version 14.00.50727.42 for x64
Copyright (C) Microsoft Corporation.  All rights reserved.

cl : Command line warning D9002 : ignoring unknown option '-v'
cl : Command line warning D9024 : unrecognized source file type 'C:/mingw/Oy-', object file assumed
configure:3081: $? = 2
configure:3070: cl.exe -V >&5
Microsoft (R) C/C++ Optimizing Compiler Version 14.00.50727.42 for x64
Copyright (C) Microsoft Corporation.  All rights reserved.

cl : Command line error D8004 : '/V' requires an argument
configure:3081: $? = 2
configure:3070: cl.exe -qversion >&5
Microsoft (R) Incremental Linker Version 8.00.50727.42

Copyright (C) Microsoft Corporation.  All rights reserved.



/out:Oy-.exe

C:/mingw/Oy-

LINK : fatal error LNK1181: cannot open input file 'C:/mingw/Oy-.obj'

Microsoft (R) C/C++ Optimizing Compiler Version 14.00.50727.42 for x64
Copyright (C) Microsoft Corporation.  All rights reserved.

cl : Command line warning D9002 : ignoring unknown option '-qversion'
cl : Command line warning D9024 : unrecognized source file type 'C:/mingw/Oy-', object file assumed
configure:3081: $? = 2
configure:3101: checking whether the C compiler works
configure:3123: cl.exe -nologo   conftest.c  >&5
cl : Command line warning D9024 : unrecognized source file type 'C:/mingw/Oy-', object file assumed

conftest.c

LINK : fatal error LNK1181: cannot open input file 'C:/mingw/Oy-.obj'

configure:3127: $? = 2
configure:3165: result: no
configure: failed program was:
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101215/528f54f9/attachment.htm>

From parki at whatevernot.com  Wed Dec 15 21:01:36 2010
From: parki at whatevernot.com (Brian Parkinson)
Date: Wed, 15 Dec 2010 16:01:36 -0500
Subject: [rabbitmq-discuss] Building rabbit mq server on mac
Message-ID: <2309F18B-69EA-4194-9F5E-40E82B29B096@whatevernot.com>

Hello:

I'm trying to get rabbit installed on a mac (running 10.6.5). I have installed on another machine, no probs - hoping someone can help. Below are the steps - it seems that things blow up with SSL (but open SSL is installed).

Thanks.

b...

--- x8 snip

% sudo port sync

% sudo port install openssl
--->  Computing dependencies for openssl
--->  Cleaning openssl

% sudo port install rabbitmq-server
--->  Computing dependencies for rabbitmq-server
--->  Building rabbitmq-server
Error: Target org.macports.build returned: shell command failed (see log for details)
Log for rabbitmq-server is at: /opt/local/var/macports/logs/_opt_local_var_macports_sources_rsync.macports.org_release_ports_net_rabbitmq-server/main.log
Error: Status 1 encountered during processing.
To report a bug, see <http://guide.macports.org/#project.tickets>

tail -n 30 /opt/local/var/macports/logs/_opt_local_var_macports_sources_rsync.macports.org_release_ports_net_rabbitmq-server/main.log
:debug:main Found Dependency: receipt exists for libxslt
:debug:main Searching for dependency: erlang
:debug:main Found Dependency: receipt exists for erlang
:msg:main 
:debug:main Executing org.macports.main (rabbitmq-server)
:debug:main Skipping completed org.macports.fetch (rabbitmq-server)
:debug:main Skipping completed org.macports.checksum (rabbitmq-server)
:debug:main Skipping completed org.macports.extract (rabbitmq-server)
:debug:main Skipping completed org.macports.patch (rabbitmq-server)
:debug:main Skipping completed org.macports.configure (rabbitmq-server)
:msg:main --->  Building rabbitmq-server
:debug:build build phase started at Wed Dec 15 16:00:00 EST 2010
:debug:build Executing org.macports.build (rabbitmq-server)
:debug:build Environment: CPATH='/opt/local/include' CC_PRINT_OPTIONS_FILE='/opt/local/var/macports/build/_opt_local_var_macports_sources_rsync.macports.org_release_ports_net_rabbitmq-server/work/.CC_PRINT_OPTIONS' LIBRARY_PATH='/opt/local/lib' CC_PRINT_OPTIONS='YES' MACOSX_DEPLOYMENT_TARGET='10.6'
:debug:build Assembled command: 'cd "/opt/local/var/macports/build/_opt_local_var_macports_sources_rsync.macports.org_release_ports_net_rabbitmq-server/work/rabbitmq-server-2.1.1" && /usr/bin/make -j2 all'
:info:build erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_ssl.erl
:info:build erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/tcp_acceptor.erl
:info:build src/rabbit_ssl.erl:37: can't find include lib "ssl/src/ssl_int.hrl"
:info:build make: *** [ebin/rabbit_ssl.beam] Error 1
:info:build make: *** Waiting for unfinished jobs....
:info:build shell command " cd "/opt/local/var/macports/build/_opt_local_var_macports_sources_rsync.macports.org_release_ports_net_rabbitmq-server/work/rabbitmq-server-2.1.1" && /usr/bin/make -j2 all " returned error 2
:error:build Target org.macports.build returned: shell command failed (see log for details)
:debug:build Backtrace: shell command failed (see log for details)
    while executing
"command_exec build"
    (procedure "portbuild::build_main" line 8)
    invoked from within
"$procedure $targetname"
:info:build Warning: the following items did not execute (for rabbitmq-server): org.macports.activate org.macports.build org.macports.destroot org.macports.install
:notice:build Log for rabbitmq-server is at: /opt/local/var/macports/logs/_opt_local_var_macports_sources_rsync.macports.org_release_ports_net_rabbitmq-server/main.log



From alexis at rabbitmq.com  Wed Dec 15 21:15:55 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Wed, 15 Dec 2010 21:15:55 +0000
Subject: [rabbitmq-discuss] Trouble building rabbitmq-c on windows
In-Reply-To: <5C3F8D74DE0D8344AF4E68E53DAB10DD05EA0A47C3@IS-EXCHANGEC101.wsod.local>
References: <5C3F8D74DE0D8344AF4E68E53DAB10DD05EA0A477C@IS-EXCHANGEC101.wsod.local>
	<5C3F8D74DE0D8344AF4E68E53DAB10DD05EA0A47B7@IS-EXCHANGEC101.wsod.local>
	<5C3F8D74DE0D8344AF4E68E53DAB10DD05EA0A47C3@IS-EXCHANGEC101.wsod.local>
Message-ID: <AANLkTikw7O50KyT3MzVCdKdMdXjCXS74MVH=200bFvYL@mail.gmail.com>

Great, let us know if you have any more problems...

alexis

On Wed, Dec 15, 2010 at 8:55 PM, Paul Pearcy <paul.pearcy at wallst.com> wrote:
> Sorry for the noise, I believe I have gotten to the bottom of this.
>
>
>
> By default on our systems, we have the $CL var have a couple of default
> values that were not playing nice. After clearing this var and restarting
> everything, things look sane.
>
>
>
>
>
> From: Paul Pearcy
> Sent: Wednesday, December 15, 2010 1:36 PM
> To: Paul Pearcy; rabbitmq-discuss at lists.rabbitmq.com
> Subject: RE: Trouble building rabbitmq-c on windows
>
>
>
> I got past my initial error by adding spaces to the start and end of my $CL
> env variable. For some reason mingw didn?t like them, while cygwin is fine
> either way.
>
>
>
> Now stuck on this error:
>
> configure:3128: cl.exe -nologo?? conftest.c? >&5
>
> conftest.c
>
>
>
> LINK : error LNK2001: unresolved external symbol _mainCRTStartup
>
>
>
> conftest.exe : fatal error LNK1120: 1 unresolved externals
>
>
>
> I can run the command outside of the configure script and get it to succeed,
> so I am a little baffled.
>
>
>
> Thanks,
>
> Paul
>
>
>
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com
> [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Paul
> Pearcy
> Sent: Wednesday, December 15, 2010 11:12 AM
> To: rabbitmq-discuss at lists.rabbitmq.com
> Subject: [rabbitmq-discuss] Trouble building rabbitmq-c on windows
>
>
>
> Hello,
>
> ??I am unfortunately stuck on Windows and C land and am trying to get the
> rabbitmq-c client built up on windows using the Visual Studio compiler.
>
>
>
> First off, this client is marked as experimental. I am curious how
> experimental this is? for instance, would I be a fool to use this library
> for production purposes? If so, is there a different recommended library or
> should I be looking at a different messaging system with better C support?
>
>
>
> I am have gone through the README.windows many times and think I understand
> the steps, but there is some disconnect.
>
>
>
> Here are the steps I took:
>
> 1)????? Grabbed the recommended mingw package using the given install script
>
> 2)????? Coped rabbitmq-c and rabbitmq-codegen(though I?m not sure what this
> one does yet) into the mingw directory.
>
> 3)????? Start up the bash from my new mingw
>
> 4)????? Verify that python is available and that /bin is in my path for
> mingw apps (I actually had to add /bin to my PATH)
>
> 5)????? Ran the mount command as specified: mount ?C:\mingw? /mingw ? this
> succeeds
>
> 6)????? Enter the rabbitmq-c directory and kick off the build:
> etc/build-ms.sh
>
>
>
>
>
> Below are the outputs from the configure run. I have tried this on a
> Windows7 machine and a WindowsXP machine and in both cases, I got the same
> results. It looks to me like the command to verify the compiler isn?t being
> run correctly.
>
>
>
> Please let me know if there are any ideas.
>
>
>
> Thanks,
>
> Paul
>
>
>
>
>
> Here is the output from this:
>
>
>
> Using Visual Studio install at /C/Program Files/Microsoft Visual Studio 8
>
> Using Windows SDK install at /C/Program Files (x86)/Microsoft Visual Studio
> 8/VC
>
> /PlatformSDK
>
> + autoreconf -i
>
> C:\mingw\bin\libtoolize: Consider adding `AC_CONFIG_MACRO_DIR([m4])' to
> configur
>
> e.ac and
>
> C:\mingw\bin\libtoolize: rerunning C:\mingw\bin\libtoolize, to keep the
> correct
>
> libtool macros in-tree.
>
> C:\mingw\bin\libtoolize: Consider adding `-I m4' to ACLOCAL_AMFLAGS in
> Makefile.
>
> am.
>
> + ./configure CC=cl.exe LD=link.exe CFLAGS=-nologo
>
> checking for a BSD-compatible install... /bin//install -c
>
> checking whether build environment is sane... yes
>
> checking for a thread-safe mkdir -p... /bin//mkdir -p
>
> checking for gawk... gawk
>
> checking whether make sets $(MAKE)... yes
>
> checking for style of include used by make... GNU
>
> checking for gcc... cl.exe
>
> checking whether the C compiler works... no
>
> configure: error: in `/rabbitmq-c-fd437100993d':
>
> configure: error: C compiler cannot create executables
>
> See `config.log' for more details.
>
>
>
> Here is what I see in the config.log:
>
> configure:3061: checking for C compiler version
>
> configure:3070: cl.exe --version >&5
>
> Microsoft (R) Incremental Linker Version 8.00.50727.42
>
>
>
> Copyright (C) Microsoft Corporation.? All rights reserved.
>
>
>
>
>
>
>
> /out:Oy-.exe
>
>
>
> C:/mingw/Oy-
>
>
>
> LINK : fatal error LNK1181: cannot open input file 'C:/mingw/Oy-.obj'
>
>
>
> Microsoft (R) C/C++ Optimizing Compiler Version 14.00.50727.42 for x64
>
> Copyright (C) Microsoft Corporation.? All rights reserved.
>
>
>
> cl : Command line warning D9002 : ignoring unknown option '--version'
>
> cl : Command line warning D9024 : unrecognized source file type
> 'C:/mingw/Oy-', object file assumed
>
> configure:3081: $? = 2
>
> configure:3070: cl.exe -v >&5
>
> Microsoft (R) Incremental Linker Version 8.00.50727.42
>
>
>
> Copyright (C) Microsoft Corporation.? All rights reserved.
>
>
>
>
>
>
>
> /out:Oy-.exe
>
>
>
> C:/mingw/Oy-
>
>
>
> LINK : fatal error LNK1181: cannot open input file 'C:/mingw/Oy-.obj'
>
>
>
> Microsoft (R) C/C++ Optimizing Compiler Version 14.00.50727.42 for x64
>
> Copyright (C) Microsoft Corporation.? All rights reserved.
>
>
>
> cl : Command line warning D9002 : ignoring unknown option '-v'
>
> cl : Command line warning D9024 : unrecognized source file type
> 'C:/mingw/Oy-', object file assumed
>
> configure:3081: $? = 2
>
> configure:3070: cl.exe -V >&5
>
> Microsoft (R) C/C++ Optimizing Compiler Version 14.00.50727.42 for x64
>
> Copyright (C) Microsoft Corporation.? All rights reserved.
>
>
>
> cl : Command line error D8004 : '/V' requires an argument
>
> configure:3081: $? = 2
>
> configure:3070: cl.exe -qversion >&5
>
> Microsoft (R) Incremental Linker Version 8.00.50727.42
>
>
>
> Copyright (C) Microsoft Corporation.? All rights reserved.
>
>
>
>
>
>
>
> /out:Oy-.exe
>
>
>
> C:/mingw/Oy-
>
>
>
> LINK : fatal error LNK1181: cannot open input file 'C:/mingw/Oy-.obj'
>
>
>
> Microsoft (R) C/C++ Optimizing Compiler Version 14.00.50727.42 for x64
>
> Copyright (C) Microsoft Corporation.? All rights reserved.
>
>
>
> cl : Command line warning D9002 : ignoring unknown option '-qversion'
>
> cl : Command line warning D9024 : unrecognized source file type
> 'C:/mingw/Oy-', object file assumed
>
> configure:3081: $? = 2
>
> configure:3101: checking whether the C compiler works
>
> configure:3123: cl.exe -nologo?? conftest.c? >&5
>
> cl : Command line warning D9024 : unrecognized source file type
> 'C:/mingw/Oy-', object file assumed
>
>
>
> conftest.c
>
>
>
> LINK : fatal error LNK1181: cannot open input file 'C:/mingw/Oy-.obj'
>
>
>
> configure:3127: $? = 2
>
> configure:3165: result: no
>
> configure: failed program was:
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From alexis at rabbitmq.com  Wed Dec 15 21:16:39 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Wed, 15 Dec 2010 21:16:39 +0000
Subject: [rabbitmq-discuss] Building rabbit mq server on mac
In-Reply-To: <2309F18B-69EA-4194-9F5E-40E82B29B096@whatevernot.com>
References: <2309F18B-69EA-4194-9F5E-40E82B29B096@whatevernot.com>
Message-ID: <AANLkTikPxW4xxr=bMaeEX5Egja+q1FDPipkAPgHU1Pbp@mail.gmail.com>

Brian

Have you tried homebrew?

alexis

(Brian, apologies for resend, forgot to cc list)



On Wed, Dec 15, 2010 at 9:01 PM, Brian Parkinson <parki at whatevernot.com> wrote:
> Hello:
>
> I'm trying to get rabbit installed on a mac (running 10.6.5). I have installed on another machine, no probs - hoping someone can help. Below are the steps - it seems that things blow up with SSL (but open SSL is installed).
>
> Thanks.
>
> b...
>
> --- x8 snip
>
> % sudo port sync
>
> % sudo port install openssl
> ---> ?Computing dependencies for openssl
> ---> ?Cleaning openssl
>
> % sudo port install rabbitmq-server
> ---> ?Computing dependencies for rabbitmq-server
> ---> ?Building rabbitmq-server
> Error: Target org.macports.build returned: shell command failed (see log for details)
> Log for rabbitmq-server is at: /opt/local/var/macports/logs/_opt_local_var_macports_sources_rsync.macports.org_release_ports_net_rabbitmq-server/main.log
> Error: Status 1 encountered during processing.
> To report a bug, see <http://guide.macports.org/#project.tickets>
>
> tail -n 30 /opt/local/var/macports/logs/_opt_local_var_macports_sources_rsync.macports.org_release_ports_net_rabbitmq-server/main.log
> :debug:main Found Dependency: receipt exists for libxslt
> :debug:main Searching for dependency: erlang
> :debug:main Found Dependency: receipt exists for erlang
> :msg:main
> :debug:main Executing org.macports.main (rabbitmq-server)
> :debug:main Skipping completed org.macports.fetch (rabbitmq-server)
> :debug:main Skipping completed org.macports.checksum (rabbitmq-server)
> :debug:main Skipping completed org.macports.extract (rabbitmq-server)
> :debug:main Skipping completed org.macports.patch (rabbitmq-server)
> :debug:main Skipping completed org.macports.configure (rabbitmq-server)
> :msg:main ---> ?Building rabbitmq-server
> :debug:build build phase started at Wed Dec 15 16:00:00 EST 2010
> :debug:build Executing org.macports.build (rabbitmq-server)
> :debug:build Environment: CPATH='/opt/local/include' CC_PRINT_OPTIONS_FILE='/opt/local/var/macports/build/_opt_local_var_macports_sources_rsync.macports.org_release_ports_net_rabbitmq-server/work/.CC_PRINT_OPTIONS' LIBRARY_PATH='/opt/local/lib' CC_PRINT_OPTIONS='YES' MACOSX_DEPLOYMENT_TARGET='10.6'
> :debug:build Assembled command: 'cd "/opt/local/var/macports/build/_opt_local_var_macports_sources_rsync.macports.org_release_ports_net_rabbitmq-server/work/rabbitmq-server-2.1.1" && /usr/bin/make -j2 all'
> :info:build erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_ssl.erl
> :info:build erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/tcp_acceptor.erl
> :info:build src/rabbit_ssl.erl:37: can't find include lib "ssl/src/ssl_int.hrl"
> :info:build make: *** [ebin/rabbit_ssl.beam] Error 1
> :info:build make: *** Waiting for unfinished jobs....
> :info:build shell command " cd "/opt/local/var/macports/build/_opt_local_var_macports_sources_rsync.macports.org_release_ports_net_rabbitmq-server/work/rabbitmq-server-2.1.1" && /usr/bin/make -j2 all " returned error 2
> :error:build Target org.macports.build returned: shell command failed (see log for details)
> :debug:build Backtrace: shell command failed (see log for details)
> ? ?while executing
> "command_exec build"
> ? ?(procedure "portbuild::build_main" line 8)
> ? ?invoked from within
> "$procedure $targetname"
> :info:build Warning: the following items did not execute (for rabbitmq-server): org.macports.activate org.macports.build org.macports.destroot org.macports.install
> :notice:build Log for rabbitmq-server is at: /opt/local/var/macports/logs/_opt_local_var_macports_sources_rsync.macports.org_release_ports_net_rabbitmq-server/main.log
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From alexis at rabbitmq.com  Wed Dec 15 21:21:17 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Wed, 15 Dec 2010 21:21:17 +0000
Subject: [rabbitmq-discuss] Rabbitmq-xmpp patches and the future.
In-Reply-To: <4D08BEE5.6060102@gmail.com>
References: <4D082FCE.1050300@gmail.com>
	<AANLkTi=9cxpH5gzYDosYMs=HryteSAGq94vEbbdT3bi1@mail.gmail.com>
	<4D08BEE5.6060102@gmail.com>
Message-ID: <AANLkTim+Xtf8_XOSX7g2zKgZKKQd2Occu7VZ0ZjhwfDv@mail.gmail.com>

Eric

Thank-you.  Should we recommend this from the XMPP section of our web site?

alexis

On Wed, Dec 15, 2010 at 1:13 PM, Eric Liang <eric.l.2046 at gmail.com> wrote:
> On 12/15/2010 05:38 PM, Alexis Richardson wrote:
>> Eric
>>
>> Nice work!
>>
>> Please do tell us more about this.
> Thanks Alexis for your attention.
>
> What I've done to the project have been already added to the text file
> in the repository: README.CUSTOMIZED. As it might be too brief for you,
> I'd like to explain some details in the following.
>
> I've separated the initial modules to four individual ones, and the main
> purpose is to index the codes by module. That is, the initial module (
> mod_rabbitmq ) will communicate with the xmpp clients and route the
> consume-related requests to the consumer processes, while all the
> functions about how to consume are implemented in the consumer module (
> mod_rabbitmq_consumer ). As these two modules will directly communicate
> with the rabbitmq-node, some utility functions are distilled to an
> individual module ( mod_rabbitmq_util ). To reduce the calls in function
> like basic_consume, the mod_rabbitmq_util module will load a library to
> the rabbitmq-node , and this is why the mod_rabbitmq_util_priv module is
> designed.
>
> Meanwhile, ?a heartbeat check on the rabbitmq-node is added, which will
> print error message when retrying to connect and grab the latest
> rabbitmq-node configuration in ejabberd if the retry times overflowed a
> default setting (5). The check on the connection is simply a ping
> action. And once the rabbitmq-node was updated when retrying, it will
> broadcast the change to all of the consumer processes, since the node
> configuration is stored in the process data.
>
> That's all I can think of it for now. Please do not hesitate to contact
> me if any further information was required.
>
> Thanks,
> Eric
>
>> On Wed, Dec 15, 2010 at 3:02 AM, Eric Liang <eric.l.2046 at gmail.com> wrote:
>>> Hi all,
>>>
>>> I've done some patches for rabbitmq-xmpp recently, which was released by
>>> Tony Garnock-Jones (
>>> http://www.lshift.net/blog/2008/07/01/rabbitmq-xmpp-gateway-released ).
>>> The patches have been posted to github (
>>> https://github.com/ericliang/rabbitmq-xmpp ). I've contacted Tony and he
>>> has no time to check these patches right now and suggested that
>>> I get in touch with the list ( thanks Tony for your attention and those
>>> enlightening conversations ). ?So would anyone here like to test/review
>>> these patches and/or to merge them to the official repository if
>>> valuable? Thanks in advance.
>>>
>>> By the way, as Tony suggested and we reach an agreement on the future
>>> version of rabbitmq-xmpp, which the service should be a plugin as
>>> rabbitmq-stomp and communicate with the ejabberd server with the help of
>>> an xmpp client library. And in that case, the Rabbit team should be the
>>> best one to do that I guess. Anyway, if there is no roadmap for it or
>>> the future, this would be a suggestion and I'd like to do more work on
>>> it when necessary. ?Would you mind to tell something about this?
>>>
>>> Thanks for your attention and any other suggestions are appreciated.
>>> Eric
>>>
>>> --
>>> -----BEGIN GEEK CODE BLOCK-----
>>> Version: 3.1
>>> GCM/CS/E/MU/P d+(-) s: a- C++ UL$ P+>++ L++ E++ W++ N+ o+>++ K+++ w !O
>>> M-(+) V-- PS+ PE+ Y+ PGP++ t? 5? X? R+>* tv@ b++++ DI-- D G++ e++>+++@ h*
>>> r !y+
>>> ------END GEEK CODE BLOCK------
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>
>
> --
> -----BEGIN GEEK CODE BLOCK-----
> Version: 3.1
> GCM/CS/E/MU/P d+(-) s: a- C++ UL$ P+>++ L++ E++ W++ N+ o+>++ K+++ w !O
> M-(+) V-- PS+ PE+ Y+ PGP++ t? 5? X? R+>* tv@ b++++ DI-- D G++ e++>+++@ h*
> r !y+
> ------END GEEK CODE BLOCK------
>
>

From paul.pearcy at wallst.com  Wed Dec 15 21:28:02 2010
From: paul.pearcy at wallst.com (Paul Pearcy)
Date: Wed, 15 Dec 2010 16:28:02 -0500
Subject: [rabbitmq-discuss] Trouble building rabbitmq-c on windows
In-Reply-To: <AANLkTikw7O50KyT3MzVCdKdMdXjCXS74MVH=200bFvYL@mail.gmail.com>
References: <5C3F8D74DE0D8344AF4E68E53DAB10DD05EA0A477C@IS-EXCHANGEC101.wsod.local>
	<5C3F8D74DE0D8344AF4E68E53DAB10DD05EA0A47B7@IS-EXCHANGEC101.wsod.local>
	<5C3F8D74DE0D8344AF4E68E53DAB10DD05EA0A47C3@IS-EXCHANGEC101.wsod.local>
	<AANLkTikw7O50KyT3MzVCdKdMdXjCXS74MVH=200bFvYL@mail.gmail.com>
Message-ID: <5C3F8D74DE0D8344AF4E68E53DAB10DD05EA0A47D3@IS-EXCHANGEC101.wsod.local>

Was still curious and should have asked in my previous update... 

What is the general consensus of the reliability of the rabbitmq-c client? 
Are there production users of this client? 
Any major known gotchas to look out for? 

Beta doesn't scare me much, but experimental does a little :-) 

Thanks!

-----Original Message-----
From: alexis.richardson at gmail.com [mailto:alexis.richardson at gmail.com] On Behalf Of Alexis Richardson
Sent: Wednesday, December 15, 2010 2:16 PM
To: Paul Pearcy
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Trouble building rabbitmq-c on windows

Great, let us know if you have any more problems...

alexis

On Wed, Dec 15, 2010 at 8:55 PM, Paul Pearcy <paul.pearcy at wallst.com> wrote:
> Sorry for the noise, I believe I have gotten to the bottom of this.
>
>
>
> By default on our systems, we have the $CL var have a couple of default
> values that were not playing nice. After clearing this var and restarting
> everything, things look sane.
>
>
>
>
>
> From: Paul Pearcy
> Sent: Wednesday, December 15, 2010 1:36 PM
> To: Paul Pearcy; rabbitmq-discuss at lists.rabbitmq.com
> Subject: RE: Trouble building rabbitmq-c on windows
>
>
>
> I got past my initial error by adding spaces to the start and end of my $CL
> env variable. For some reason mingw didn't like them, while cygwin is fine
> either way.
>
>
>
> Now stuck on this error:
>
> configure:3128: cl.exe -nologo?? conftest.c? >&5
>
> conftest.c
>
>
>
> LINK : error LNK2001: unresolved external symbol _mainCRTStartup
>
>
>
> conftest.exe : fatal error LNK1120: 1 unresolved externals
>
>
>
> I can run the command outside of the configure script and get it to succeed,
> so I am a little baffled.
>
>
>
> Thanks,
>
> Paul
>
>
>
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com
> [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Paul
> Pearcy
> Sent: Wednesday, December 15, 2010 11:12 AM
> To: rabbitmq-discuss at lists.rabbitmq.com
> Subject: [rabbitmq-discuss] Trouble building rabbitmq-c on windows
>
>
>
> Hello,
>
> ??I am unfortunately stuck on Windows and C land and am trying to get the
> rabbitmq-c client built up on windows using the Visual Studio compiler.
>
>
>
> First off, this client is marked as experimental. I am curious how
> experimental this is. for instance, would I be a fool to use this library
> for production purposes? If so, is there a different recommended library or
> should I be looking at a different messaging system with better C support?
>
>
>
> I am have gone through the README.windows many times and think I understand
> the steps, but there is some disconnect.
>
>
>
> Here are the steps I took:
>
> 1)????? Grabbed the recommended mingw package using the given install script
>
> 2)????? Coped rabbitmq-c and rabbitmq-codegen(though I'm not sure what this
> one does yet) into the mingw directory.
>
> 3)????? Start up the bash from my new mingw
>
> 4)????? Verify that python is available and that /bin is in my path for
> mingw apps (I actually had to add /bin to my PATH)
>
> 5)????? Ran the mount command as specified: mount 'C:\mingw' /mingw - this
> succeeds
>
> 6)????? Enter the rabbitmq-c directory and kick off the build:
> etc/build-ms.sh
>
>
>
>
>
> Below are the outputs from the configure run. I have tried this on a
> Windows7 machine and a WindowsXP machine and in both cases, I got the same
> results. It looks to me like the command to verify the compiler isn't being
> run correctly.
>
>
>
> Please let me know if there are any ideas.
>
>
>
> Thanks,
>
> Paul
>
>
>
>
>
> Here is the output from this:
>
>
>
> Using Visual Studio install at /C/Program Files/Microsoft Visual Studio 8
>
> Using Windows SDK install at /C/Program Files (x86)/Microsoft Visual Studio
> 8/VC
>
> /PlatformSDK
>
> + autoreconf -i
>
> C:\mingw\bin\libtoolize: Consider adding `AC_CONFIG_MACRO_DIR([m4])' to
> configur
>
> e.ac and
>
> C:\mingw\bin\libtoolize: rerunning C:\mingw\bin\libtoolize, to keep the
> correct
>
> libtool macros in-tree.
>
> C:\mingw\bin\libtoolize: Consider adding `-I m4' to ACLOCAL_AMFLAGS in
> Makefile.
>
> am.
>
> + ./configure CC=cl.exe LD=link.exe CFLAGS=-nologo
>
> checking for a BSD-compatible install... /bin//install -c
>
> checking whether build environment is sane... yes
>
> checking for a thread-safe mkdir -p... /bin//mkdir -p
>
> checking for gawk... gawk
>
> checking whether make sets $(MAKE)... yes
>
> checking for style of include used by make... GNU
>
> checking for gcc... cl.exe
>
> checking whether the C compiler works... no
>
> configure: error: in `/rabbitmq-c-fd437100993d':
>
> configure: error: C compiler cannot create executables
>
> See `config.log' for more details.
>
>
>
> Here is what I see in the config.log:
>
> configure:3061: checking for C compiler version
>
> configure:3070: cl.exe --version >&5
>
> Microsoft (R) Incremental Linker Version 8.00.50727.42
>
>
>
> Copyright (C) Microsoft Corporation.? All rights reserved.
>
>
>
>
>
>
>
> /out:Oy-.exe
>
>
>
> C:/mingw/Oy-
>
>
>
> LINK : fatal error LNK1181: cannot open input file 'C:/mingw/Oy-.obj'
>
>
>
> Microsoft (R) C/C++ Optimizing Compiler Version 14.00.50727.42 for x64
>
> Copyright (C) Microsoft Corporation.? All rights reserved.
>
>
>
> cl : Command line warning D9002 : ignoring unknown option '--version'
>
> cl : Command line warning D9024 : unrecognized source file type
> 'C:/mingw/Oy-', object file assumed
>
> configure:3081: $? = 2
>
> configure:3070: cl.exe -v >&5
>
> Microsoft (R) Incremental Linker Version 8.00.50727.42
>
>
>
> Copyright (C) Microsoft Corporation.? All rights reserved.
>
>
>
>
>
>
>
> /out:Oy-.exe
>
>
>
> C:/mingw/Oy-
>
>
>
> LINK : fatal error LNK1181: cannot open input file 'C:/mingw/Oy-.obj'
>
>
>
> Microsoft (R) C/C++ Optimizing Compiler Version 14.00.50727.42 for x64
>
> Copyright (C) Microsoft Corporation.? All rights reserved.
>
>
>
> cl : Command line warning D9002 : ignoring unknown option '-v'
>
> cl : Command line warning D9024 : unrecognized source file type
> 'C:/mingw/Oy-', object file assumed
>
> configure:3081: $? = 2
>
> configure:3070: cl.exe -V >&5
>
> Microsoft (R) C/C++ Optimizing Compiler Version 14.00.50727.42 for x64
>
> Copyright (C) Microsoft Corporation.? All rights reserved.
>
>
>
> cl : Command line error D8004 : '/V' requires an argument
>
> configure:3081: $? = 2
>
> configure:3070: cl.exe -qversion >&5
>
> Microsoft (R) Incremental Linker Version 8.00.50727.42
>
>
>
> Copyright (C) Microsoft Corporation.? All rights reserved.
>
>
>
>
>
>
>
> /out:Oy-.exe
>
>
>
> C:/mingw/Oy-
>
>
>
> LINK : fatal error LNK1181: cannot open input file 'C:/mingw/Oy-.obj'
>
>
>
> Microsoft (R) C/C++ Optimizing Compiler Version 14.00.50727.42 for x64
>
> Copyright (C) Microsoft Corporation.? All rights reserved.
>
>
>
> cl : Command line warning D9002 : ignoring unknown option '-qversion'
>
> cl : Command line warning D9024 : unrecognized source file type
> 'C:/mingw/Oy-', object file assumed
>
> configure:3081: $? = 2
>
> configure:3101: checking whether the C compiler works
>
> configure:3123: cl.exe -nologo?? conftest.c? >&5
>
> cl : Command line warning D9024 : unrecognized source file type
> 'C:/mingw/Oy-', object file assumed
>
>
>
> conftest.c
>
>
>
> LINK : fatal error LNK1181: cannot open input file 'C:/mingw/Oy-.obj'
>
>
>
> configure:3127: $? = 2
>
> configure:3165: result: no
>
> configure: failed program was:
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From alexis at rabbitmq.com  Wed Dec 15 21:30:55 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Wed, 15 Dec 2010 21:30:55 +0000
Subject: [rabbitmq-discuss] Trouble building rabbitmq-c on windows
In-Reply-To: <5C3F8D74DE0D8344AF4E68E53DAB10DD05EA0A47D3@IS-EXCHANGEC101.wsod.local>
References: <5C3F8D74DE0D8344AF4E68E53DAB10DD05EA0A477C@IS-EXCHANGEC101.wsod.local>
	<5C3F8D74DE0D8344AF4E68E53DAB10DD05EA0A47B7@IS-EXCHANGEC101.wsod.local>
	<5C3F8D74DE0D8344AF4E68E53DAB10DD05EA0A47C3@IS-EXCHANGEC101.wsod.local>
	<AANLkTikw7O50KyT3MzVCdKdMdXjCXS74MVH=200bFvYL@mail.gmail.com>
	<5C3F8D74DE0D8344AF4E68E53DAB10DD05EA0A47D3@IS-EXCHANGEC101.wsod.local>
Message-ID: <AANLkTikyhhu1XDad_h0B4kKeP0NzwjwcxqL5G3HupF8c@mail.gmail.com>

On Wed, Dec 15, 2010 at 9:28 PM, Paul Pearcy <paul.pearcy at wallst.com> wrote:
> Was still curious and should have asked in my previous update...
>
> What is the general consensus of the reliability of the rabbitmq-c client?
> Are there production users of this client?

Good, and lots of people use it.  It's embedded in other clients too (eg PHP).


> Any major known gotchas to look out for?

I can't knowledgeably answer this but my impression is that the
engineering team feel the way some things like concurrency are handled
could be better, and indeed the whole client could be improved.


> Beta doesn't scare me much, but experimental does a little :-)

Then think of it as beta ;-)

alexis


> Thanks!
>
> -----Original Message-----
> From: alexis.richardson at gmail.com [mailto:alexis.richardson at gmail.com] On Behalf Of Alexis Richardson
> Sent: Wednesday, December 15, 2010 2:16 PM
> To: Paul Pearcy
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] Trouble building rabbitmq-c on windows
>
> Great, let us know if you have any more problems...
>
> alexis
>
> On Wed, Dec 15, 2010 at 8:55 PM, Paul Pearcy <paul.pearcy at wallst.com> wrote:
>> Sorry for the noise, I believe I have gotten to the bottom of this.
>>
>>
>>
>> By default on our systems, we have the $CL var have a couple of default
>> values that were not playing nice. After clearing this var and restarting
>> everything, things look sane.
>>
>>
>>
>>
>>
>> From: Paul Pearcy
>> Sent: Wednesday, December 15, 2010 1:36 PM
>> To: Paul Pearcy; rabbitmq-discuss at lists.rabbitmq.com
>> Subject: RE: Trouble building rabbitmq-c on windows
>>
>>
>>
>> I got past my initial error by adding spaces to the start and end of my $CL
>> env variable. For some reason mingw didn't like them, while cygwin is fine
>> either way.
>>
>>
>>
>> Now stuck on this error:
>>
>> configure:3128: cl.exe -nologo?? conftest.c? >&5
>>
>> conftest.c
>>
>>
>>
>> LINK : error LNK2001: unresolved external symbol _mainCRTStartup
>>
>>
>>
>> conftest.exe : fatal error LNK1120: 1 unresolved externals
>>
>>
>>
>> I can run the command outside of the configure script and get it to succeed,
>> so I am a little baffled.
>>
>>
>>
>> Thanks,
>>
>> Paul
>>
>>
>>
>> From: rabbitmq-discuss-bounces at lists.rabbitmq.com
>> [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Paul
>> Pearcy
>> Sent: Wednesday, December 15, 2010 11:12 AM
>> To: rabbitmq-discuss at lists.rabbitmq.com
>> Subject: [rabbitmq-discuss] Trouble building rabbitmq-c on windows
>>
>>
>>
>> Hello,
>>
>> ??I am unfortunately stuck on Windows and C land and am trying to get the
>> rabbitmq-c client built up on windows using the Visual Studio compiler.
>>
>>
>>
>> First off, this client is marked as experimental. I am curious how
>> experimental this is. for instance, would I be a fool to use this library
>> for production purposes? If so, is there a different recommended library or
>> should I be looking at a different messaging system with better C support?
>>
>>
>>
>> I am have gone through the README.windows many times and think I understand
>> the steps, but there is some disconnect.
>>
>>
>>
>> Here are the steps I took:
>>
>> 1)????? Grabbed the recommended mingw package using the given install script
>>
>> 2)????? Coped rabbitmq-c and rabbitmq-codegen(though I'm not sure what this
>> one does yet) into the mingw directory.
>>
>> 3)????? Start up the bash from my new mingw
>>
>> 4)????? Verify that python is available and that /bin is in my path for
>> mingw apps (I actually had to add /bin to my PATH)
>>
>> 5)????? Ran the mount command as specified: mount 'C:\mingw' /mingw - this
>> succeeds
>>
>> 6)????? Enter the rabbitmq-c directory and kick off the build:
>> etc/build-ms.sh
>>
>>
>>
>>
>>
>> Below are the outputs from the configure run. I have tried this on a
>> Windows7 machine and a WindowsXP machine and in both cases, I got the same
>> results. It looks to me like the command to verify the compiler isn't being
>> run correctly.
>>
>>
>>
>> Please let me know if there are any ideas.
>>
>>
>>
>> Thanks,
>>
>> Paul
>>
>>
>>
>>
>>
>> Here is the output from this:
>>
>>
>>
>> Using Visual Studio install at /C/Program Files/Microsoft Visual Studio 8
>>
>> Using Windows SDK install at /C/Program Files (x86)/Microsoft Visual Studio
>> 8/VC
>>
>> /PlatformSDK
>>
>> + autoreconf -i
>>
>> C:\mingw\bin\libtoolize: Consider adding `AC_CONFIG_MACRO_DIR([m4])' to
>> configur
>>
>> e.ac and
>>
>> C:\mingw\bin\libtoolize: rerunning C:\mingw\bin\libtoolize, to keep the
>> correct
>>
>> libtool macros in-tree.
>>
>> C:\mingw\bin\libtoolize: Consider adding `-I m4' to ACLOCAL_AMFLAGS in
>> Makefile.
>>
>> am.
>>
>> + ./configure CC=cl.exe LD=link.exe CFLAGS=-nologo
>>
>> checking for a BSD-compatible install... /bin//install -c
>>
>> checking whether build environment is sane... yes
>>
>> checking for a thread-safe mkdir -p... /bin//mkdir -p
>>
>> checking for gawk... gawk
>>
>> checking whether make sets $(MAKE)... yes
>>
>> checking for style of include used by make... GNU
>>
>> checking for gcc... cl.exe
>>
>> checking whether the C compiler works... no
>>
>> configure: error: in `/rabbitmq-c-fd437100993d':
>>
>> configure: error: C compiler cannot create executables
>>
>> See `config.log' for more details.
>>
>>
>>
>> Here is what I see in the config.log:
>>
>> configure:3061: checking for C compiler version
>>
>> configure:3070: cl.exe --version >&5
>>
>> Microsoft (R) Incremental Linker Version 8.00.50727.42
>>
>>
>>
>> Copyright (C) Microsoft Corporation.? All rights reserved.
>>
>>
>>
>>
>>
>>
>>
>> /out:Oy-.exe
>>
>>
>>
>> C:/mingw/Oy-
>>
>>
>>
>> LINK : fatal error LNK1181: cannot open input file 'C:/mingw/Oy-.obj'
>>
>>
>>
>> Microsoft (R) C/C++ Optimizing Compiler Version 14.00.50727.42 for x64
>>
>> Copyright (C) Microsoft Corporation.? All rights reserved.
>>
>>
>>
>> cl : Command line warning D9002 : ignoring unknown option '--version'
>>
>> cl : Command line warning D9024 : unrecognized source file type
>> 'C:/mingw/Oy-', object file assumed
>>
>> configure:3081: $? = 2
>>
>> configure:3070: cl.exe -v >&5
>>
>> Microsoft (R) Incremental Linker Version 8.00.50727.42
>>
>>
>>
>> Copyright (C) Microsoft Corporation.? All rights reserved.
>>
>>
>>
>>
>>
>>
>>
>> /out:Oy-.exe
>>
>>
>>
>> C:/mingw/Oy-
>>
>>
>>
>> LINK : fatal error LNK1181: cannot open input file 'C:/mingw/Oy-.obj'
>>
>>
>>
>> Microsoft (R) C/C++ Optimizing Compiler Version 14.00.50727.42 for x64
>>
>> Copyright (C) Microsoft Corporation.? All rights reserved.
>>
>>
>>
>> cl : Command line warning D9002 : ignoring unknown option '-v'
>>
>> cl : Command line warning D9024 : unrecognized source file type
>> 'C:/mingw/Oy-', object file assumed
>>
>> configure:3081: $? = 2
>>
>> configure:3070: cl.exe -V >&5
>>
>> Microsoft (R) C/C++ Optimizing Compiler Version 14.00.50727.42 for x64
>>
>> Copyright (C) Microsoft Corporation.? All rights reserved.
>>
>>
>>
>> cl : Command line error D8004 : '/V' requires an argument
>>
>> configure:3081: $? = 2
>>
>> configure:3070: cl.exe -qversion >&5
>>
>> Microsoft (R) Incremental Linker Version 8.00.50727.42
>>
>>
>>
>> Copyright (C) Microsoft Corporation.? All rights reserved.
>>
>>
>>
>>
>>
>>
>>
>> /out:Oy-.exe
>>
>>
>>
>> C:/mingw/Oy-
>>
>>
>>
>> LINK : fatal error LNK1181: cannot open input file 'C:/mingw/Oy-.obj'
>>
>>
>>
>> Microsoft (R) C/C++ Optimizing Compiler Version 14.00.50727.42 for x64
>>
>> Copyright (C) Microsoft Corporation.? All rights reserved.
>>
>>
>>
>> cl : Command line warning D9002 : ignoring unknown option '-qversion'
>>
>> cl : Command line warning D9024 : unrecognized source file type
>> 'C:/mingw/Oy-', object file assumed
>>
>> configure:3081: $? = 2
>>
>> configure:3101: checking whether the C compiler works
>>
>> configure:3123: cl.exe -nologo?? conftest.c? >&5
>>
>> cl : Command line warning D9024 : unrecognized source file type
>> 'C:/mingw/Oy-', object file assumed
>>
>>
>>
>> conftest.c
>>
>>
>>
>> LINK : fatal error LNK1181: cannot open input file 'C:/mingw/Oy-.obj'
>>
>>
>>
>> configure:3127: $? = 2
>>
>> configure:3165: result: no
>>
>> configure: failed program was:
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>

From jerryk at vmware.com  Wed Dec 15 23:02:10 2010
From: jerryk at vmware.com (Jerry Kuch)
Date: Wed, 15 Dec 2010 15:02:10 -0800
Subject: [rabbitmq-discuss] Building rabbit mq server on mac
In-Reply-To: <2309F18B-69EA-4194-9F5E-40E82B29B096@whatevernot.com>
References: <2309F18B-69EA-4194-9F5E-40E82B29B096@whatevernot.com>
Message-ID: <8A58327F-DEF8-44C6-AD4D-5DA42FDFCFE8@vmware.com>

Hi, Brian.

I just did a sudo port upgrade rabbitmq-server on my Mac running 10.6.5 and it was able to pull down and build a 2.2.0_0 rabbitmq-server, thereby replacing a 2.0.0_0 that had been there previously.

It's perhaps a grasp but you might want to try a `sudo port selfupdate` and take another try at it.  What's up in ports at the moment appears viable, although ports isn't above developing occasional hiccups.

Jerry

On Dec 15, 2010, at 1:01 PM, Brian Parkinson wrote:

> Hello:
> 
> I'm trying to get rabbit installed on a mac (running 10.6.5). I have installed on another machine, no probs - hoping someone can help. Below are the steps - it seems that things blow up with SSL (but open SSL is installed).
> 
> Thanks.
> 
> b...
> 
> --- x8 snip
> 
> % sudo port sync
> 
> % sudo port install openssl
> --->  Computing dependencies for openssl
> --->  Cleaning openssl
> 
> % sudo port install rabbitmq-server
> --->  Computing dependencies for rabbitmq-server
> --->  Building rabbitmq-server
> Error: Target org.macports.build returned: shell command failed (see log for details)
> Log for rabbitmq-server is at: /opt/local/var/macports/logs/_opt_local_var_macports_sources_rsync.macports.org_release_ports_net_rabbitmq-server/main.log
> Error: Status 1 encountered during processing.
> To report a bug, see <http://guide.macports.org/#project.tickets>
> 
> tail -n 30 /opt/local/var/macports/logs/_opt_local_var_macports_sources_rsync.macports.org_release_ports_net_rabbitmq-server/main.log
> :debug:main Found Dependency: receipt exists for libxslt
> :debug:main Searching for dependency: erlang
> :debug:main Found Dependency: receipt exists for erlang
> :msg:main 
> :debug:main Executing org.macports.main (rabbitmq-server)
> :debug:main Skipping completed org.macports.fetch (rabbitmq-server)
> :debug:main Skipping completed org.macports.checksum (rabbitmq-server)
> :debug:main Skipping completed org.macports.extract (rabbitmq-server)
> :debug:main Skipping completed org.macports.patch (rabbitmq-server)
> :debug:main Skipping completed org.macports.configure (rabbitmq-server)
> :msg:main --->  Building rabbitmq-server
> :debug:build build phase started at Wed Dec 15 16:00:00 EST 2010
> :debug:build Executing org.macports.build (rabbitmq-server)
> :debug:build Environment: CPATH='/opt/local/include' CC_PRINT_OPTIONS_FILE='/opt/local/var/macports/build/_opt_local_var_macports_sources_rsync.macports.org_release_ports_net_rabbitmq-server/work/.CC_PRINT_OPTIONS' LIBRARY_PATH='/opt/local/lib' CC_PRINT_OPTIONS='YES' MACOSX_DEPLOYMENT_TARGET='10.6'
> :debug:build Assembled command: 'cd "/opt/local/var/macports/build/_opt_local_var_macports_sources_rsync.macports.org_release_ports_net_rabbitmq-server/work/rabbitmq-server-2.1.1" && /usr/bin/make -j2 all'
> :info:build erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/rabbit_ssl.erl
> :info:build erlc -I include -o ebin -Wall -v +debug_info -Duse_specs -pa ebin src/tcp_acceptor.erl
> :info:build src/rabbit_ssl.erl:37: can't find include lib "ssl/src/ssl_int.hrl"
> :info:build make: *** [ebin/rabbit_ssl.beam] Error 1
> :info:build make: *** Waiting for unfinished jobs....
> :info:build shell command " cd "/opt/local/var/macports/build/_opt_local_var_macports_sources_rsync.macports.org_release_ports_net_rabbitmq-server/work/rabbitmq-server-2.1.1" && /usr/bin/make -j2 all " returned error 2
> :error:build Target org.macports.build returned: shell command failed (see log for details)
> :debug:build Backtrace: shell command failed (see log for details)
>    while executing
> "command_exec build"
>    (procedure "portbuild::build_main" line 8)
>    invoked from within
> "$procedure $targetname"
> :info:build Warning: the following items did not execute (for rabbitmq-server): org.macports.activate org.macports.build org.macports.destroot org.macports.install
> :notice:build Log for rabbitmq-server is at: /opt/local/var/macports/logs/_opt_local_var_macports_sources_rsync.macports.org_release_ports_net_rabbitmq-server/main.log
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From jerryk at vmware.com  Wed Dec 15 23:23:45 2010
From: jerryk at vmware.com (Jerry Kuch)
Date: Wed, 15 Dec 2010 15:23:45 -0800
Subject: [rabbitmq-discuss] Question about management setup
In-Reply-To: <8D3A3B76-F769-40EC-A979-29C930E55AE0@whatevernot.com>
References: <8D3A3B76-F769-40EC-A979-29C930E55AE0@whatevernot.com>
Message-ID: <1B2B907A-2400-4ABA-96DA-E5C251B072B0@vmware.com>

Hi, Brian.

By coincidence, I hit this problem just this morning when switching to do some management plugin work on a machine I'd not done it on before...

You want to upgrade your Mac Ports provided Erlang with:

sudo port -v upgrade --enforce-variants erlang +ssl 

That should pound in what you need to get going (after the usual downloading and compiling churn).

Best regards,
Jerry

On Dec 13, 2010, at 7:20 AM, Brian Parkinson wrote:

> Hello - complete newb here, getting setup with RabbitMQ for the first time - just kicking the tires, as it were.
> 
> Apologies if this has been asked before, but can't find a mention of this issue specifically:
> 
> I am working with a stock install on Mac OS X 10.6.5 - it all works fine - very cool. Fast to get up and going, which bodes well. I did a port install of the server:
> 
> sudo port install rabbitmq-server
> 
> I tried to also install the rabbit-management plugin - I have the downloaded *.ez files in the plugin directory:
> 
> ~: ls /opt/local/lib/rabbitmq/lib/rabbitmq_server-2.2.0/plugins/
> README                             mochiweb-2.2.0.ez                  rabbitmq-management-agent-2.2.0.ez webmachine-2.2.0.ez
> amqp_client-2.2.0.ez               rabbitmq-management-2.2.0.ez       rabbitmq-mochiweb-2.2.0.ez
> 
> Now, when I try to launch the server, I get:
> 
> ~: sudo /opt/local/sbin/rabbitmq-server 
> Activating RabbitMQ plugins ...
> ERROR: failed to load application crypto:
> {"no such file or directory","crypto.app"}
> ~: 
> 
> So, an issue with crypto ssl I guess. 
> 
> Do I need to recompile Erlang, or is there a config setting I need to twiddle? I'll need SSL anyways, so good to get it sorted now...
> 
> Any help appreciated.
> 
> Cheers,
> 
> Brian...
> 
> 
> 
> 
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From jasonjwwilliams at gmail.com  Wed Dec 15 23:25:01 2010
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Wed, 15 Dec 2010 16:25:01 -0700
Subject: [rabbitmq-discuss] Question about management setup
In-Reply-To: <8D3A3B76-F769-40EC-A979-29C930E55AE0@whatevernot.com>
References: <8D3A3B76-F769-40EC-A979-29C930E55AE0@whatevernot.com>
Message-ID: <AANLkTin0HKGhuqx1424_S2D+bOjkXNwxs1hHRQyt=qNO@mail.gmail.com>

You might check into Homebrew as an alternative to MacPorts too. Their
default Erlang options work with RMQ out of the box.

-J

On Mon, Dec 13, 2010 at 8:20 AM, Brian Parkinson <parki at whatevernot.com>wrote:

> Hello - complete newb here, getting setup with RabbitMQ for the first time
> - just kicking the tires, as it were.
>
> Apologies if this has been asked before, but can't find a mention of this
> issue specifically:
>
> I am working with a stock install on Mac OS X 10.6.5 - it all works fine -
> very cool. Fast to get up and going, which bodes well. I did a port install
> of the server:
>
> sudo port install rabbitmq-server
>
> I tried to also install the rabbit-management plugin - I have the
> downloaded *.ez files in the plugin directory:
>
> ~: ls /opt/local/lib/rabbitmq/lib/rabbitmq_server-2.2.0/plugins/
> README                             mochiweb-2.2.0.ez
>  rabbitmq-management-agent-2.2.0.ez webmachine-2.2.0.ez
> amqp_client-2.2.0.ez               rabbitmq-management-2.2.0.ez
> rabbitmq-mochiweb-2.2.0.ez
>
> Now, when I try to launch the server, I get:
>
> ~: sudo /opt/local/sbin/rabbitmq-server
> Activating RabbitMQ plugins ...
> ERROR: failed to load application crypto:
> {"no such file or directory","crypto.app"}
> ~:
>
> So, an issue with crypto ssl I guess.
>
> Do I need to recompile Erlang, or is there a config setting I need to
> twiddle? I'll need SSL anyways, so good to get it sorted now...
>
> Any help appreciated.
>
> Cheers,
>
> Brian...
>
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101215/ef690069/attachment-0001.htm>

From parki at whatevernot.com  Wed Dec 15 23:40:18 2010
From: parki at whatevernot.com (Brian Parkinson)
Date: Wed, 15 Dec 2010 18:40:18 -0500
Subject: [rabbitmq-discuss] Question about management setup
Message-ID: <A3035F0D-B01A-4AE8-BCC2-E0AA8CE3153A@whatevernot.com>

Hi all:

Thanks to all that responded to my mac install woes. No idea why the usual port install didn't work, but it's a laptop that, ahem, has a couple issues.

On advice, I tried HomeBrew, and it worked like a charm - all working, and fine.

First up, kudos on RabbitMQ (and AMQP in general). I work at a financial risk software company in an architect role, and I can't say how happy I am to be seeing the end of ports and hosts and config and sockets and failures, etc. Still working through some proof of concept issues, but in general, this solves a whole host (ha ha) of issues.

Cheers.

brian...



From eric.l.2046 at gmail.com  Thu Dec 16 02:21:18 2010
From: eric.l.2046 at gmail.com (Eric Liang)
Date: Thu, 16 Dec 2010 10:21:18 +0800
Subject: [rabbitmq-discuss] Rabbitmq-xmpp patches and the future.
In-Reply-To: <AANLkTim+Xtf8_XOSX7g2zKgZKKQd2Occu7VZ0ZjhwfDv@mail.gmail.com>
References: <4D082FCE.1050300@gmail.com>	<AANLkTi=9cxpH5gzYDosYMs=HryteSAGq94vEbbdT3bi1@mail.gmail.com>	<4D08BEE5.6060102@gmail.com>
	<AANLkTim+Xtf8_XOSX7g2zKgZKKQd2Occu7VZ0ZjhwfDv@mail.gmail.com>
Message-ID: <4D09779E.6020401@gmail.com>

On 12/16/2010 05:21 AM, Alexis Richardson wrote:
> Eric
>
> Thank-you.  Should we recommend this from the XMPP section of our web site?
Yes, it's my great honour, thank you.

BTW, would you like to give some advices on the future version? TIA.

Eric
> On Wed, Dec 15, 2010 at 1:13 PM, Eric Liang <eric.l.2046 at gmail.com> wrote:
>> On 12/15/2010 05:38 PM, Alexis Richardson wrote:
>>> Eric
>>>
>>> Nice work!
>>>
>>> Please do tell us more about this.
>> Thanks Alexis for your attention.
>>
>> What I've done to the project have been already added to the text file
>> in the repository: README.CUSTOMIZED. As it might be too brief for you,
>> I'd like to explain some details in the following.
>>
>> I've separated the initial modules to four individual ones, and the main
>> purpose is to index the codes by module. That is, the initial module (
>> mod_rabbitmq ) will communicate with the xmpp clients and route the
>> consume-related requests to the consumer processes, while all the
>> functions about how to consume are implemented in the consumer module (
>> mod_rabbitmq_consumer ). As these two modules will directly communicate
>> with the rabbitmq-node, some utility functions are distilled to an
>> individual module ( mod_rabbitmq_util ). To reduce the calls in function
>> like basic_consume, the mod_rabbitmq_util module will load a library to
>> the rabbitmq-node , and this is why the mod_rabbitmq_util_priv module is
>> designed.
>>
>> Meanwhile,  a heartbeat check on the rabbitmq-node is added, which will
>> print error message when retrying to connect and grab the latest
>> rabbitmq-node configuration in ejabberd if the retry times overflowed a
>> default setting (5). The check on the connection is simply a ping
>> action. And once the rabbitmq-node was updated when retrying, it will
>> broadcast the change to all of the consumer processes, since the node
>> configuration is stored in the process data.
>>
>> That's all I can think of it for now. Please do not hesitate to contact
>> me if any further information was required.
>>
>> Thanks,
>> Eric
>>
>>> On Wed, Dec 15, 2010 at 3:02 AM, Eric Liang <eric.l.2046 at gmail.com> wrote:
>>>> Hi all,
>>>>
>>>> I've done some patches for rabbitmq-xmpp recently, which was released by
>>>> Tony Garnock-Jones (
>>>> http://www.lshift.net/blog/2008/07/01/rabbitmq-xmpp-gateway-released ).
>>>> The patches have been posted to github (
>>>> https://github.com/ericliang/rabbitmq-xmpp ). I've contacted Tony and he
>>>> has no time to check these patches right now and suggested that
>>>> I get in touch with the list ( thanks Tony for your attention and those
>>>> enlightening conversations ).  So would anyone here like to test/review
>>>> these patches and/or to merge them to the official repository if
>>>> valuable? Thanks in advance.
>>>>
>>>> By the way, as Tony suggested and we reach an agreement on the future
>>>> version of rabbitmq-xmpp, which the service should be a plugin as
>>>> rabbitmq-stomp and communicate with the ejabberd server with the help of
>>>> an xmpp client library. And in that case, the Rabbit team should be the
>>>> best one to do that I guess. Anyway, if there is no roadmap for it or
>>>> the future, this would be a suggestion and I'd like to do more work on
>>>> it when necessary.  Would you mind to tell something about this?
>>>>
>>>> Thanks for your attention and any other suggestions are appreciated.
>>>> Eric
>>>>
>>>> --
>>>> -----BEGIN GEEK CODE BLOCK-----
>>>> Version: 3.1
>>>> GCM/CS/E/MU/P d+(-) s: a- C++ UL$ P+>++ L++ E++ W++ N+ o+>++ K+++ w !O
>>>> M-(+) V-- PS+ PE+ Y+ PGP++ t? 5? X? R+>* tv@ b++++ DI-- D G++ e++>+++@ h*
>>>> r !y+
>>>> ------END GEEK CODE BLOCK------
>>>>
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>
>>
>> --
>> -----BEGIN GEEK CODE BLOCK-----
>> Version: 3.1
>> GCM/CS/E/MU/P d+(-) s: a- C++ UL$ P+>++ L++ E++ W++ N+ o+>++ K+++ w !O
>> M-(+) V-- PS+ PE+ Y+ PGP++ t? 5? X? R+>* tv@ b++++ DI-- D G++ e++>+++@ h*
>> r !y+
>> ------END GEEK CODE BLOCK------
>>
>>


-- 
-----BEGIN GEEK CODE BLOCK-----
Version: 3.1
GCM/CS/E/MU/P d+(-) s: a- C++ UL$ P+>++ L++ E++ W++ N+ o+>++ K+++ w !O
M-(+) V-- PS+ PE+ Y+ PGP++ t? 5? X? R+>* tv@ b++++ DI-- D G++ e++>+++@ h*
r !y+
------END GEEK CODE BLOCK------


From taylste at gmail.com  Thu Dec 16 06:02:41 2010
From: taylste at gmail.com (Steven Taylor)
Date: Thu, 16 Dec 2010 06:02:41 +0000
Subject: [rabbitmq-discuss] error: "Pipelining of requests forbidden" on
 C# client
In-Reply-To: <5554523B-5296-4F11-B0CA-BBD45BB1C10E@vmware.com>
References: <AANLkTikKT7eXyD6Ukqx1bNei=84JCbRkZ+XmsJUOP-t2@mail.gmail.com>
	<5554523B-5296-4F11-B0CA-BBD45BB1C10E@vmware.com>
Message-ID: <AANLkTimqu9nqs+P8tV936o0NfyxRhR-4PQ4i7uLc2hcp@mail.gmail.com>

Hi Jerry,

you found the same pdf that I did.

I'm not knowingly using RPC continuation at this stage, unless using the
Subscription pattern falls under this category. Also, I am careful to use a
different channel for each subscription or basic channe that lives on the
same thread.

Would you like me to get in touch if I can repeat the error with a test
case?

-Steven

On 15 December 2010 16:56, Jerry Kuch <jerryk at vmware.com> wrote:

> Steven:  Is there any chance that the channel instance on which you're
> doing this work is being used by more than one thread?
>
> In the .NET client one expects this error when something tries to queue up
> more than one RPC continuation in the internal continuation queue at a time.
>  The Rabbit .NET client user guide talks about such thread safety issues:
>
>
> http://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v1.5.0/rabbitmq-dotnet-client-1.5.0-user-guide.pdf
>
> in some detail in a couple of spots.
>
> The Rabbit Java client has similar restrictions.  With both the Java and
> .NET clients, it makes sense to structure your application so that a unique
> thread owns a given instance of a non-thread safe Rabbit client resource
> (e.g. Channels in the Java client, IModel in the .NET).
>
> Best regards,
> Jerry
>
> On Dec 15, 2010, at 8:28 AM, Steven Taylor wrote:
>
> Hi,
>
> Got this error: "Pipelining of requests forbidden"
>
> Found a reference in the documentation (see below).  As part of the "I
> assert queue exists" logic, I was (re-)declaring the exhange.  Is that
> wrong?
>
> Could it be a threading issue?
>
>
> http://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v1.5.0/rabbitmq-dotnet-client-1.5.0-user-guide.pdf
>
> NotSupportedException
>
> s being thrown from a method in class RpcContinuationQueue
>
> complaining about
>
> "Pipelining of requests forbidden" (which occurs in situations where
>
> more than one AMQP RPC, such as
>
> ExchangeDeclare, is run simultaneously).
>
> Offending Line:
> BasicGetResult msg=ch.BasicGet(QueueNme,false);
>
> thanks,
> -Steven
> <ATT00001..txt>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101216/1a0511c8/attachment.htm>

From taylste at gmail.com  Thu Dec 16 06:26:48 2010
From: taylste at gmail.com (Steven Taylor)
Date: Thu, 16 Dec 2010 06:26:48 +0000
Subject: [rabbitmq-discuss] STOP or XMPP?
Message-ID: <AANLkTin87dUYg0V1m6ZztL=Q2ihg0jH9q=K+pvkN3pib@mail.gmail.com>

Hi,

which one of these is the preferred route with RabbitMQ?

thanks,
-Steven
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101216/4de28be6/attachment.htm>

From alexis at rabbitmq.com  Thu Dec 16 10:21:44 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Thu, 16 Dec 2010 10:21:44 +0000
Subject: [rabbitmq-discuss] STOP or XMPP?
In-Reply-To: <AANLkTin87dUYg0V1m6ZztL=Q2ihg0jH9q=K+pvkN3pib@mail.gmail.com>
References: <AANLkTin87dUYg0V1m6ZztL=Q2ihg0jH9q=K+pvkN3pib@mail.gmail.com>
Message-ID: <AANLkTinpXR321HYVDMP8tuhrbO44S1qS+w-JUem3E-BZ@mail.gmail.com>

Steven

It depends what you are doing.  XMPP is recommended for integration
with IM streams and such like.  STOMP is for business messaging,
topics, queues and such like.

alexis


On Thu, Dec 16, 2010 at 6:26 AM, Steven Taylor <taylste at gmail.com> wrote:
> Hi,
>
> which one of these is the preferred route with RabbitMQ?
>
> thanks,
> -Steven
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From mabrek at gmail.com  Thu Dec 16 16:24:30 2010
From: mabrek at gmail.com (Anton Lebedevich)
Date: Thu, 16 Dec 2010 19:24:30 +0300
Subject: [rabbitmq-discuss] remote startup over ssh hangs
Message-ID: <4D0A3D3E.20604@gmail.com>

Hello.

It seems that rabbitmq startup scripts don't detach from controlling
terminal properly.
When I start rabbitmq on remote host over ssh in such way
# ssh $HOST sudo invoke-rc.d rabbitmq-server start
it starts rabbitmq but then ssh hangs. Workaround is to use ssh -t.

Isn't it better to start rabbitmq-server with "-detached" instead of
"-noinput" in rabbit_multi:run_rabbitmq_server_unix() ?

Regards,
Anton Lebedevich.

From jerryk at vmware.com  Thu Dec 16 17:54:09 2010
From: jerryk at vmware.com (Jerry Kuch)
Date: Thu, 16 Dec 2010 09:54:09 -0800
Subject: [rabbitmq-discuss] error: "Pipelining of requests forbidden" on
 C# client
In-Reply-To: <AANLkTimqu9nqs+P8tV936o0NfyxRhR-4PQ4i7uLc2hcp@mail.gmail.com>
References: <AANLkTikKT7eXyD6Ukqx1bNei=84JCbRkZ+XmsJUOP-t2@mail.gmail.com>
	<5554523B-5296-4F11-B0CA-BBD45BB1C10E@vmware.com>
	<AANLkTimqu9nqs+P8tV936o0NfyxRhR-4PQ4i7uLc2hcp@mail.gmail.com>
Message-ID: <A7A653F0-D8A0-4256-9784-EB987013D6F7@vmware.com>

Hi, Steven:

Absolutely!  A self-contained snippet of code that reproduces a potential problem is always a valuable thing for us to have...  Please pass one on if you have one.

Jerry

On Dec 15, 2010, at 10:02 PM, Steven Taylor wrote:

Hi Jerry,

you found the same pdf that I did.

I'm not knowingly using RPC continuation at this stage, unless using the Subscription pattern falls under this category. Also, I am careful to use a different channel for each subscription or basic channe that lives on the same thread.

Would you like me to get in touch if I can repeat the error with a test case?

-Steven

On 15 December 2010 16:56, Jerry Kuch <jerryk at vmware.com<mailto:jerryk at vmware.com>> wrote:
Steven:  Is there any chance that the channel instance on which you're doing this work is being used by more than one thread?

In the .NET client one expects this error when something tries to queue up more than one RPC continuation in the internal continuation queue at a time.  The Rabbit .NET client user guide talks about such thread safety issues:

http://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v1.5.0/rabbitmq-dotnet-client-1.5.0-user-guide.pdf

in some detail in a couple of spots.

The Rabbit Java client has similar restrictions.  With both the Java and .NET clients, it makes sense to structure your application so that a unique thread owns a given instance of a non-thread safe Rabbit client resource (e.g. Channels in the Java client, IModel in the .NET).

Best regards,
Jerry

On Dec 15, 2010, at 8:28 AM, Steven Taylor wrote:

Hi,

Got this error: "Pipelining of requests forbidden"

Found a reference in the documentation (see below).  As part of the "I assert queue exists" logic, I was (re-)declaring the exhange.  Is that wrong?

Could it be a threading issue?

http://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v1.5.0/rabbitmq-dotnet-client-1.5.0-user-guide.pdf

NotSupportedException

s being thrown from a method in class RpcContinuationQueue

complaining about

"Pipelining of requests forbidden" (which occurs in situations where

more than one AMQP RPC, such as

ExchangeDeclare, is run simultaneously).

Offending Line:
BasicGetResult msg=ch.BasicGet(QueueNme,false);

thanks,
-Steven
<ATT00001..txt>




From matt at mydomedia.com  Thu Dec 16 18:58:12 2010
From: matt at mydomedia.com (Matt Miller)
Date: Thu, 16 Dec 2010 13:58:12 -0500 (EST)
Subject: [rabbitmq-discuss] STOMP plugin, changes, usage example in python
In-Reply-To: <A7A653F0-D8A0-4256-9784-EB987013D6F7@vmware.com>
Message-ID: <1999435382.1606.1292525892922.JavaMail.root@zimbra>

Greetings,

I have been using the STOMP gateway plugin for RabbitMQ 2.1.1 for some time, and it works great. The only hurdles I had in the past was a lack of documentation and usage examples. I believe part of the reason is the volatility of the protocol specification itself..?

That being said, the most recent upgrade I preformed borked my implementation. Of course this was just testing and thank goodness this update was not preformed on my production environment. 

I am currently using the stomp python script from codehaus. My python source for the wrapper is at the bottom of this email.

The code runs as is 2.1.1, and will receive broadcast style messages. The code does not function correctly against the 2.2.0 release, I receive a:

ListenerException: Error received headers:{'message': 'Unknown destination', 'content-type': 'text/plain', 'content-length': '86'}, message:'' is not a valid destination.
Valid exchange types are: /exchange, /topic or /queue.
 
To remedy the error I changed my subscription line to include '/topic' as the destination. 

My only concern is that this may change again in the future. Why did this change? 

Thanks,
Matt 



""" Heleper function for listening to an update via STOMP
"""
import json
import stomp
import logging

from uuid import uuid1

LOG_FILENAME = 'stomp.log'
logging.basicConfig(filename=LOG_FILENAME,level=logging.DEBUG)

stomp_logger = logging.getLogger('stomp')

class ListenerException(Exception):
    pass

class MsgReceiver(stomp.ConnectionListener):
    def __init__(self, callback=None):
        if callback is not None:
            self.callback = callback
    def on_error(self, headers, message):
        raise ListenerException("Error received headers:%s, message:%s " % (headers, message))
    def on_message(self, headers, message):
        #self.callback(headers, message) 
        stomp_logger.info("Message received: (headers:%s) %s" % (headers, message))

class Listener (object):

    host = "localhost"
    port = 61613
    user = "guest"
    passw = "guest"


    def __init__(self, callback=None, *args, **kwargs):
        
        if hasattr(self, 'conn'):
            if self.conn.is_connected():
                self.conn.disconnect()
        if not callback:
            raise Exception("Please specify a callback function")

        self.host = kwargs.get('host') if kwargs.get('host') else self.host
        self.user = kwargs.get('user') if kwargs.get('user') else self.user
        self.passw = kwargs.get('passw') if kwargs.get('passw') else self.passw
        self.port = kwargs.get('port') if kwargs.get('port') else self.port

        # build the stomp connection XXX: Add error handling 
        self.conn = stomp.Connection(
                [(self.host, self.port)], 
                self.user, self.passw
                )

        self.conn.set_listener('callback-%s' % uuid1(), MsgReceiver(callback))
        self.conn.start()
        self.conn.connect()

    def add_thing(self):
        if self.conn.is_connected():
            self.conn.subscribe(
                    destination="",
                    exchange="amq.topic", 
                    routing_key="#")

    def close(self):
        if self.conn.is_connected():
            self.conn.disconnect()

From parki at whatevernot.com  Thu Dec 16 20:03:33 2010
From: parki at whatevernot.com (Brian Parkinson)
Date: Thu, 16 Dec 2010 15:03:33 -0500
Subject: [rabbitmq-discuss] Question/clarification wrt durable messages
Message-ID: <0A7185F0-D81F-4720-B47B-FE4596105498@whatevernot.com>

Hello:

Spending time getting up to speed with RabbitMQ - have things working - very impressed - all's working pretty well, but there are some subtleties I'm trying to figure out, mainly related to durability.

Quick question about durability of messages - I'm missing something, I think.

Let's say that I have a queue set up as durable, non-exclusive, non-auto-delete:

channel.queueDeclare("testQueue", true, false, false, null);

and have this queue bound to an exchange (binding key = routing key).

I would expect that:

channel.basicPublish(exchangeName, routingKey, null, messageString.getBytes());

would result in a message being published in a non-durable fashion (as the properties are null), whereas:

channel.basicPublish(exchangeName, routingKey, MessageProperties.PERSISTENT_TEXT_PLAIN, messageString.getBytes());

would result in a durable publish.

However, as near as I can tell, there is no difference - in both cases, the message remains in the queue until a consumer comes and retrieves it. Is there a difference in this case?

So, I figured that perhaps the second case (PERSISTENT_TEXT_PLAIN) results in the message being available after a server crash (which makes sense). So, I publish a message with PERSISTENT_TEXT_PLAIN and then kill the server and re-launch it; I don't see the message being available - the server comes up without this message in the queue.

Can anyone shed light on what I'm missing?

Perhaps it's more useful to outline what my use case is - I need to have high availability, and so can form a multi-node broker, but since the queues are (currently) tied to a node, if a node goes down, I lose the queue (and all the messages in that queue). How does one design this setup in RabbitMQ/AMQP - I'm guessing there's a pretty standard pattern here (?).

Any help is appreciated - everything else is looking really good - things Just Work.

ps. I'm using the whizzy mgmt web front end; when I launch the server, I see some warnings about undefined functions (see below). Is this something I should worry about?

Thanks.

brian...


rabbit: sudo /opt/local/sbin/rabbitmq-server 
Password:
Activating RabbitMQ plugins ...
*WARNING* Undefined function fdsrv:bind_socket/2
*WARNING* Undefined function fdsrv:start/0
*WARNING* Undefined function fdsrv:stop/0
*WARNING* Undefined function webmachine_resource:start_link/2
6 plugins activated:
* amqp_client-2.2.0
* mochiweb-1.3
* rabbit_management-2.2.0
* rabbit_management_agent-2.2.0
* rabbit_mochiweb-2.2.0
* webmachine-1.7.0
...


From jerryk at vmware.com  Thu Dec 16 20:41:39 2010
From: jerryk at vmware.com (Jerry Kuch)
Date: Thu, 16 Dec 2010 12:41:39 -0800
Subject: [rabbitmq-discuss] error: "Pipelining of requests forbidden" on
 C# client
In-Reply-To: <AANLkTimqu9nqs+P8tV936o0NfyxRhR-4PQ4i7uLc2hcp@mail.gmail.com>
References: <AANLkTikKT7eXyD6Ukqx1bNei=84JCbRkZ+XmsJUOP-t2@mail.gmail.com>
	<5554523B-5296-4F11-B0CA-BBD45BB1C10E@vmware.com>
	<AANLkTimqu9nqs+P8tV936o0NfyxRhR-4PQ4i7uLc2hcp@mail.gmail.com>
Message-ID: <52787795-DF2A-4813-9A05-3F86C91DBDA7@vmware.com>

Hi, Steven...  

One more thing that I didn't quite address in your response, and that I was probably unclear on in my prior message...

> I'm not knowingly using RPC continuation at this stage, unless using the Subscription pattern falls under this category. Also, I am careful to use a different channel for each subscription or basic channe that lives on the same thread.

The Rpc continuation business I mentioned occurs down in the client's internals in an inevitable way for every synchronous command, rather than being something a user intervenes in.  Sorry if my earlier phrasing suggested otherwise, or implied that it was a user-exposed item to be worked with.

We could probably stand to improve the exception that gets thrown in these cases, perhaps including the id of the encountering thread and the command being attempted.  The improvement should probably be made both to the .NET and Java clients.  I'll file a bug requesting that this be made more informative in a future release.

In the meantime, if you find a good, self contained repro-case, please send it on to us to have a look and we'll see what we can do to get you sorted out.

Best regards,
Jerry


From paul.pearcy at wallst.com  Thu Dec 16 22:10:31 2010
From: paul.pearcy at wallst.com (Paul Pearcy)
Date: Thu, 16 Dec 2010 17:10:31 -0500
Subject: [rabbitmq-discuss] QoS prefetch and rabbitmq-c
Message-ID: <5C3F8D74DE0D8344AF4E68E53DAB10DD05EA0A48EC@IS-EXCHANGEC101.wsod.local>

Hey,
  Don't see a direct way via rabbitmq-c to setup QoS prefetch count for a consumer. Searching the lists, I came across this thread, which seemed to have a sample for how to do this:
http://old.nabble.com/problem-with-new-persiter-with-1000-topics-queues-td29434516.html#a29476031

Is rolling your own QoS via amqp_simple_rpc the current recommended (only?) way to do this?

Thanks!
Paul

Here is the chunk of code I am referring to:
/* amqp.h should support this */
static int _amqp_basic_qos(amqp_connection_state_t state,
                                   amqp_channel_t channel,
                                   uint32_t prefetch_size,
                                   uint16_t prefetch_count,
                                   amqp_boolean_t global)
{
  amqp_rpc_reply_t rpc_reply =
    AMQP_SIMPLE_RPC(state, channel, BASIC, QOS, QOS_OK,
                    amqp_basic_qos_t, prefetch_size, prefetch_count, global);

  if (rpc_reply.reply_type != AMQP_RESPONSE_NORMAL)
      return -1;
  return 0;
}



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101216/a99d4934/attachment-0001.htm>

From 176047528 at qq.com  Fri Dec 17 01:35:43 2010
From: 176047528 at qq.com (=?gbk?B?0qa71A==?=)
Date: Fri, 17 Dec 2010 09:35:43 +0800
Subject: [rabbitmq-discuss] error PossibleAuthenticationFailureException
Message-ID: <tencent_2A44E75F0440D4832D9F3E20@qq.com>

When i used java client connect to a broker server, i got a error like this:
  
 Exception in thread "main" com.rabbitmq.client.PossibleAuthenticationFailureException: Possibly caused by authentication failure
        at com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:288)
        at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:379)
        at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:399)
        at java_receive.main(java_receive.java:14)
Caused by: com.rabbitmq.client.ShutdownSignalException: connection error; reason: java.io.EOFException
        at com.rabbitmq.utility.ValueOrException.getValue(ValueOrException.java:81)
        at com.rabbitmq.utility.BlockingValueOrException.uninterruptibleGetValue(BlockingValueOrException.java:47)
        at com.rabbitmq.client.impl.AMQChannel$BlockingRpcContinuation.getReply(AMQChannel.java:342)
        at com.rabbitmq.client.impl.AMQChannel.rpc(AMQChannel.java:215)
        at com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:286)
        ... 3 more
Caused by: java.io.EOFException
        at java.io.DataInputStream.readUnsignedByte(DataInputStream.java:273)
        at com.rabbitmq.client.impl.Frame.readFrom(Frame.java:118)
        at com.rabbitmq.client.impl.SocketFrameHandler.readFrame(SocketFrameHandler.java:155)
        at com.rabbitmq.client.impl.AMQConnection.readFrame(AMQConnection.java:393)
        at com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:421)
  
 the code
   Connection conn = null;
  conn = factory.newConnection();
   factory.setHost("192.168.0.202");  //local ip address
  Channel chan = conn.createChannel(); //error here
  
 if i use setHost("localhost"), it's ok.  someone can tell why?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101217/7fa5959c/attachment.htm>

From max.bridgewater at gmail.com  Fri Dec 17 01:40:17 2010
From: max.bridgewater at gmail.com (Max Bridgewater)
Date: Thu, 16 Dec 2010 20:40:17 -0500
Subject: [rabbitmq-discuss] User and Access Control Management via API
Message-ID: <AANLkTi=g45=b+xEzCiZkdeyVi-vsWvWt8WxNx3wRfj5g@mail.gmail.com>

Howdy,

I'm a RabbitMQ Freshman. So please bear with me. My question is
hopefully pretty simple: is there a way to create users and define
their permissions via an API such as the Java API?

Thanks,
Max.

From kathironline at ymail.com  Fri Dec 17 05:41:33 2010
From: kathironline at ymail.com (Kathiravan Neethimani)
Date: Fri, 17 Dec 2010 11:11:33 +0530 (IST)
Subject: [rabbitmq-discuss] How to Show my List_Queues in .net by API
Message-ID: <913690.80323.qm@web95703.mail.in.yahoo.com>




Hello ,??? ? ? ? ? ?My RabbitMQ Service is running in Server pc . My Connection is established by?
?? ? ? ? ???? ? ? ? ? ConnectionFactory factory = new ConnectionFactory();?? ? ? ? ? ?factory.Protocol = Protocols.AMQP_0_8_QPID;?? ? ? ? ? ?factory.Address = server;

?? ? ?But how to show ?list_queues and queue count only ?in .net . I m in depeche mode

can u plz send me some sample code in .net . How to access by your? API's .?

regards ,?kathir







-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101217/6d0178f2/attachment.htm>

From alexis at rabbitmq.com  Fri Dec 17 06:31:32 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Fri, 17 Dec 2010 06:31:32 +0000
Subject: [rabbitmq-discuss] User and Access Control Management via API
In-Reply-To: <AANLkTi=g45=b+xEzCiZkdeyVi-vsWvWt8WxNx3wRfj5g@mail.gmail.com>
References: <AANLkTi=g45=b+xEzCiZkdeyVi-vsWvWt8WxNx3wRfj5g@mail.gmail.com>
Message-ID: <AANLkTik77hd6e+JrS7+cKtyD62iMSyk6x58x6bfWzt6R@mail.gmail.com>

Max

The management plugin has an HTTP API, as shown here:
http://hg.rabbitmq.com/rabbitmq-management/raw-file/rabbitmq_v2_2_0/priv/www-api/help.html

For the plugin itself, see: http://www.rabbitmq.com/management.html

For the permissions model see:
http://www.rabbitmq.com/admin-guide.html#access-control

alexis


On Fri, Dec 17, 2010 at 1:40 AM, Max Bridgewater
<max.bridgewater at gmail.com> wrote:
> Howdy,
>
> I'm a RabbitMQ Freshman. So please bear with me. My question is
> hopefully pretty simple: is there a way to create users and define
> their permissions via an API such as the Java API?
>
> Thanks,
> Max.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From alexis at rabbitmq.com  Fri Dec 17 06:39:46 2010
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Fri, 17 Dec 2010 06:39:46 +0000
Subject: [rabbitmq-discuss] How to Show my List_Queues in .net by API
In-Reply-To: <913690.80323.qm@web95703.mail.in.yahoo.com>
References: <913690.80323.qm@web95703.mail.in.yahoo.com>
Message-ID: <AANLkTinJvO5x6rs=YZDbEFa5a4JX0wgkMSji+odw2VtE@mail.gmail.com>

If you are running the management plugin, then the following URI should
return a list of queues.

http://*server-name*:55672/api/queues/

More info on using HTTP as a management interface is here:
http://hg.rabbitmq.com/rabbitmq-management/raw-file/rabbitmq_v2_2_0/priv/www-api/help.html

For documentation on calling HTTP from .NET, I suggest MSDN.  The following
link may be a helpful place to begin:
http://msdn.microsoft.com/en-us/library/system.net.httpwebrequest(v=vs.80).aspx


On Fri, Dec 17, 2010 at 5:41 AM, Kathiravan Neethimani <
kathironline at ymail.com> wrote:

>
>
> Hello ,
>             My RabbitMQ Service is running in Server pc . My Connection is
> established by
>
>            ConnectionFactory factory = new ConnectionFactory();
>             factory.Protocol = Protocols.AMQP_0_8_QPID;
>             factory.Address = server;
>
>       But how to show  list_queues and queue count only  in .net . I m in
> depeche mode
>
> can u plz send me some sample code in .net . How to access by your * API's
> . *
>
>
> regards ,
> kathir
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101217/f33b8723/attachment-0001.htm>

From matthias at rabbitmq.com  Fri Dec 17 10:50:36 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 17 Dec 2010 10:50:36 +0000
Subject: [rabbitmq-discuss] remote startup over ssh hangs
In-Reply-To: <4D0A3D3E.20604@gmail.com>
References: <4D0A3D3E.20604@gmail.com>
Message-ID: <4D0B407C.6050506@rabbitmq.com>

Anton,

Anton Lebedevich wrote:
> It seems that rabbitmq startup scripts don't detach from controlling
> terminal properly.
> When I start rabbitmq on remote host over ssh in such way
> # ssh $HOST sudo invoke-rc.d rabbitmq-server start
> it starts rabbitmq but then ssh hangs. Workaround is to use ssh -t.
> 
> Isn't it better to start rabbitmq-server with "-detached" instead of
> "-noinput" in rabbit_multi:run_rabbitmq_server_unix() ?

That would swallows stdout/err, including various diagnostics and error 
messages without which it would be hard to troubleshoot a failing 
startup. I see though that we do exactly that on Windows. Hmmm. Will 
file a bug.


Matthias.

From matthias at rabbitmq.com  Fri Dec 17 11:33:15 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 17 Dec 2010 11:33:15 +0000
Subject: [rabbitmq-discuss] STOMP plugin, changes,
	usage example in python
In-Reply-To: <1999435382.1606.1292525892922.JavaMail.root@zimbra>
References: <1999435382.1606.1292525892922.JavaMail.root@zimbra>
Message-ID: <4D0B4A7B.1080205@rabbitmq.com>

Matt,

Matt Miller wrote:
> I have been using the STOMP gateway plugin for RabbitMQ 2.1.1 for
> some time, and it works great. The only hurdles I had in the past was
> a lack of documentation and usage examples. I believe part of the
> reason is the volatility of the protocol specification itself..?

The changes are not so much due to volatility in the spec but ambiguity 
and underspecification, which means that in order to make STOMP do 
anything useful, implementors have to invent a whole bunch of stuff.

> I receive a:
> 
> ListenerException: Error received headers:{'message': 'Unknown
> destination', 'content-type': 'text/plain', 'content-length': '86'},
> message:'' is not a valid destination. Valid exchange types are:
> /exchange, /topic or /queue.
> 
> To remedy the error I changed my subscription line to include
> '/topic' as the destination.
> 
> My only concern is that this may change again in the future. Why did
> this change?

We are trying to get more in line with what other STOMP server 
implementations do. See 
http://hg.rabbitmq.com/rabbitmq-stomp/file/rabbitmq_v2_2_0/DESIGN.md for 
the design around the particular change which you stumbled across.


Regards,

Matthias.

From emile at rabbitmq.com  Fri Dec 17 11:52:53 2010
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 17 Dec 2010 11:52:53 +0000
Subject: [rabbitmq-discuss] error PossibleAuthenticationFailureException
In-Reply-To: <tencent_2A44E75F0440D4832D9F3E20@qq.com>
References: <tencent_2A44E75F0440D4832D9F3E20@qq.com>
Message-ID: <4D0B4F15.6050509@rabbitmq.com>

Hi ????,

On 17/12/10 01:35, ???? wrote:
> When i used java client connect to a broker server, i got a error like this:
> Exception in thread "main"
> com.rabbitmq.client.PossibleAuthenticationFailureException: Possibly
> caused by authentication failure

[...]

> the code
> Connection conn = null;
> conn = factory.newConnection();
> factory.setHost("192.168.0.202"); //local ip address
> Channel chan = conn.createChannel(); //error here
> if i use setHost("localhost"), it's ok. someone can tell why?

Is it possible that 192.168.0.202 is the IP number of a non-local server 
running a RabbitMQ broker with different credentials?

Check the output of "rabbitmqctl list_users" and double-check that the 
usernames that you expect appear. Also check the output of "rabbitmqctl 
status" and retry the test using the hostname (part after the @) instead 
of the IP number.

Regards

Emile

From frank.goenninger at consequor.de  Fri Dec 17 12:33:13 2010
From: frank.goenninger at consequor.de (=?iso-8859-1?Q?Frank_G=F6nninger?=)
Date: Fri, 17 Dec 2010 13:33:13 +0100
Subject: [rabbitmq-discuss] error PossibleAuthenticationFailureException
In-Reply-To: <4D0B4F15.6050509@rabbitmq.com>
References: <tencent_2A44E75F0440D4832D9F3E20@qq.com>
	<4D0B4F15.6050509@rabbitmq.com>
Message-ID: <9A9AA16E-E84F-445D-9352-7E70E3E59ECD@consequor.de>

Am 17.12.2010 um 12:52 schrieb Emile Joubert:

> Hi ????,
> 
> On 17/12/10 01:35, ???? wrote:
>> When i used java client connect to a broker server, i got a error like this:
>> Exception in thread "main"
>> com.rabbitmq.client.PossibleAuthenticationFailureException: Possibly
>> caused by authentication failure
> 
> [...]
> 
>> the code
>> Connection conn = null;
>> conn = factory.newConnection();
>> factory.setHost("192.168.0.202"); //local ip address
>> Channel chan = conn.createChannel(); //error here
>> if i use setHost("localhost"), it's ok. someone can tell why?
> 
> Is it possible that 192.168.0.202 is the IP number of a non-local server 
> running a RabbitMQ broker with different credentials?


OP says 192.168.0.202 is the network IP address of the local host. This smells like a wrong IP address or insufficient privileges to connect to 192.168.0.202 or RabbitMQ is not listening on this address (but does so on 127.0.0.1 only).

Cheers
  Frank

--
  C o n s e q u o r   C o n s u l t i n g   A G
  Frank Goenninger

  E-Mail: frank.goenninger at consequor.de
  Phone: +49 711 781 181-10
  Fax:   +49 711 781 181-11

  Consequor Consulting AG
  Liebknechstr. 33
  D-70565 Stuttgart

  Vorstand: Frank G?nninger (Vors.), Martin Melcher
  Aufsichtsratsvorsitzender: Dipl.-Kfm. Matthias Filbinger
  Sitz der Gesellschaft: 70565 Stuttgart, Deutschland
  Registergericht Amtsgericht Stuttgart HRB 727446



From matthias at rabbitmq.com  Fri Dec 17 12:39:45 2010
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 17 Dec 2010 12:39:45 +0000
Subject: [rabbitmq-discuss] error PossibleAuthenticationFailureException
In-Reply-To: <9A9AA16E-E84F-445D-9352-7E70E3E59ECD@consequor.de>
References: <tencent_2A44E75F0440D4832D9F3E20@qq.com>	<4D0B4F15.6050509@rabbitmq.com>
	<9A9AA16E-E84F-445D-9352-7E70E3E59ECD@consequor.de>
Message-ID: <4D0B5A11.7020202@rabbitmq.com>

Frank G?nninger wrote:
> OP says 192.168.0.202 is the network IP address of the local host.
> This smells like a wrong IP address or insufficient privileges to
> connect to 192.168.0.202 or RabbitMQ is not listening on this address
> (but does so on 127.0.0.1 only).

If the client wasn't able to connect at all it would report a
"java.net.ConnectException: Connection refused", not a
PossibleAuthenticationFailureException.

Matthias.

From emile at rabbitmq.com  Fri Dec 17 13:43:07 2010
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 17 Dec 2010 13:43:07 +0000
Subject: [rabbitmq-discuss] Question/clarification wrt durable messages
In-Reply-To: <0A7185F0-D81F-4720-B47B-FE4596105498@whatevernot.com>
References: <0A7185F0-D81F-4720-B47B-FE4596105498@whatevernot.com>
Message-ID: <4D0B68EB.6070202@rabbitmq.com>

Hi Brian,

On 16/12/10 20:03, Brian Parkinson wrote:

> However, as near as I can tell, there is no difference - in both
> cases, the message remains in the queue until a consumer comes and
> retrieves it. Is there a difference in this case?

If you are not seeing a difference then you are most likely shutting 
down the broker forcibly without the use of transactions. If you set the 
channel to transaction mode:

channel.txSelect();

and commit after the publish:

channel.txCommit();

then you will see persistent messages in durable queues even after an 
unclean shutdown.

> Perhaps it's more useful to outline what my use case is - I need to
> have high availability, and so can form a multi-node broker, but
> since the queues are (currently) tied to a node, if a node goes down,
> I lose the queue (and all the messages in that queue). How does one
> design this setup in RabbitMQ/AMQP - I'm guessing there's a pretty
> standard pattern here (?).

For high availability you should look at the Pacemaker guide: 
http://www.rabbitmq.com/pacemaker.html . This uses persistent storage 
and a heartbeat mechanism between two brokers.

> ps. I'm using the whizzy mgmt web front end; when I launch the
> server, I see some warnings about undefined functions (see below). Is
> this something I should worry about?

Those warnings are normal. Mochiweb uses some functions in some modules 
we don't distribute.  One of our startup checks catches this and 
complains. Since we never actually use those functions, it shouldn't be 
a problem.


Regards


Emile

From parki at whatevernot.com  Fri Dec 17 15:38:56 2010
From: parki at whatevernot.com (Brian Parkinson)
Date: Fri, 17 Dec 2010 10:38:56 -0500
Subject: [rabbitmq-discuss] Question/clarification wrt durable messages
In-Reply-To: <4D0B68EB.6070202@rabbitmq.com>
References: <0A7185F0-D81F-4720-B47B-FE4596105498@whatevernot.com>
	<4D0B68EB.6070202@rabbitmq.com>
Message-ID: <37D22E80-0E81-4471-821F-DAA72A4E1E7C@whatevernot.com>

Hi Emile:

Ran the tests under a transaction, and the messages certainly survive a server (node) crash.

The throughput I'm getting is approximately 10 messages per second - does this gibe with what you would expect for throughput? I ask, as it seems slow compared to non-tx, even taking into account the time for persistence. I'm wrapping the call to basicPublish with txSelect and txCommit.

Thanks.

b...



On Dec 17, 2010, at 8:43 AM, Emile Joubert wrote:

> Hi Brian,
> 
> On 16/12/10 20:03, Brian Parkinson wrote:
> 
>> However, as near as I can tell, there is no difference - in both
>> cases, the message remains in the queue until a consumer comes and
>> retrieves it. Is there a difference in this case?
> 
> If you are not seeing a difference then you are most likely shutting down the broker forcibly without the use of transactions. If you set the channel to transaction mode:
> 
> channel.txSelect();
> 
> and commit after the publish:
> 
> channel.txCommit();
> 
> then you will see persistent messages in durable queues even after an unclean shutdown.
> 
>> Perhaps it's more useful to outline what my use case is - I need to
>> have high availability, and so can form a multi-node broker, but
>> since the queues are (currently) tied to a node, if a node goes down,
>> I lose the queue (and all the messages in that queue). How does one
>> design this setup in RabbitMQ/AMQP - I'm guessing there's a pretty
>> standard pattern here (?).
> 
> For high availability you should look at the Pacemaker guide: http://www.rabbitmq.com/pacemaker.html . This uses persistent storage and a heartbeat mechanism between two brokers.
> 
>> ps. I'm using the whizzy mgmt web front end; when I launch the
>> server, I see some warnings about undefined functions (see below). Is
>> this something I should worry about?
> 
> Those warnings are normal. Mochiweb uses some functions in some modules we don't distribute.  One of our startup checks catches this and complains. Since we never actually use those functions, it shouldn't be a problem.
> 
> 
> Regards
> 
> 
> Emile


From matthew at rabbitmq.com  Fri Dec 17 16:00:16 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 17 Dec 2010 16:00:16 +0000
Subject: [rabbitmq-discuss] Question/clarification wrt durable messages
In-Reply-To: <37D22E80-0E81-4471-821F-DAA72A4E1E7C@whatevernot.com>
References: <0A7185F0-D81F-4720-B47B-FE4596105498@whatevernot.com>
	<4D0B68EB.6070202@rabbitmq.com>
	<37D22E80-0E81-4471-821F-DAA72A4E1E7C@whatevernot.com>
Message-ID: <20101217160016.GB18077@rabbitmq.com>

Brian,

On Fri, Dec 17, 2010 at 10:38:56AM -0500, Brian Parkinson wrote:
> The throughput I'm getting is approximately 10 messages per second -
> does this gibe with what you would expect for throughput? I ask, as it
> seems slow compared to non-tx, even taking into account the time for
> persistence. I'm wrapping the call to basicPublish with txSelect and
> txCommit.

If you're doing a commit per publish then that amounts to probably about
2 fsyncs per publish. This will have a substantial impact on
performance.

By increasing the window of the txn, you'll be able to increase
performance, but obviously that requires that the client is able to
buffer and retransmit every non-committed message in the current
transaction in the event of failure.

Matthew

From naangilsunder at yahoo.com  Fri Dec 17 18:52:47 2010
From: naangilsunder at yahoo.com (sunder vel)
Date: Fri, 17 Dec 2010 10:52:47 -0800 (PST)
Subject: [rabbitmq-discuss] Issue in accessing RabbitMQ Management UI
Message-ID: <542891.95658.qm@web121809.mail.ne1.yahoo.com>

Hi , 
         This is sunder . I just new with RabbitMQ . I have installed 
successfully in ubuntu10.10 also added Management Plugins as per below link . 

http://www.rabbitmq.com/management.html . 

Problem is i m not able to access management UI 
 (http://192.168.1.40:55672/mgmt) . 


thanks ,
sunder


      
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101217/0c903339/attachment.htm>

From mabrek at gmail.com  Fri Dec 17 20:07:29 2010
From: mabrek at gmail.com (mabrek)
Date: Fri, 17 Dec 2010 23:07:29 +0300
Subject: [rabbitmq-discuss] how to use ez-debian from
	rabbitmq-public-umbrella?
Message-ID: <AANLkTimUuCHbGfC61sh7fv4XHa-RzWu27DRKbmXxdf6c@mail.gmail.com>

Hello.

We need to deploy rabbitmq and several plugins as debian packages.
Currently we grab management plugin and all its deps as binary *.ez
from web and wrap them into .deb. But building plugin as .deb from
sources for in-house developed plugin looks quite different.
Is there "recommended" way to build plugins as .deb from sources?
How to use ez-debian from rabbitmq-public-umbrella and what is it for?

Regards,
Anton Lebedevich.

From majek04 at gmail.com  Fri Dec 17 21:22:12 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 17 Dec 2010 21:22:12 +0000
Subject: [rabbitmq-discuss] Issue in accessing RabbitMQ Management UI
In-Reply-To: <542891.95658.qm@web121809.mail.ne1.yahoo.com>
References: <542891.95658.qm@web121809.mail.ne1.yahoo.com>
Message-ID: <AANLkTi=g8kkVooTRt9WVB-J8AjzhBMGDrweD6tEnH59Y@mail.gmail.com>

Check out your Rabbitmq logs, something like:
/var/lib/rabbitmq/rabbit at xxxxx.log

In this file you should see mgmt plugin info, like:
=INFO REPORT==== 12-Nov-2010::13:14:04 ===
Management plugin started.
HTTP API:       http://emo-vostro:55672/api/
Management UI:  http://emo-vostro:55672/mgmt/

Go to this urls, you also need to use credentials
recognized by Rabbit, usually user:guest pass:guest.

Cheers,
 Marek


On Fri, Dec 17, 2010 at 18:52, sunder vel <naangilsunder at yahoo.com> wrote:
> Hi ,
> ?? ? ? ? This is sunder . I just new with RabbitMQ . I have installed
> successfully in ubuntu10.10 also added Management Plugins as per below link
> .
> http://www.rabbitmq.com/management.html?.
> Problem is i m not able to access management UI
> ?(http://192.168.1.40:55672/mgmt) .
>
> thanks ,
> sunder
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From matt at mydomedia.com  Fri Dec 17 22:19:31 2010
From: matt at mydomedia.com (Matt Miller)
Date: Fri, 17 Dec 2010 17:19:31 -0500 (EST)
Subject: [rabbitmq-discuss] STOMP plugin, changes,
 usage example in python
In-Reply-To: <4D0B4A7B.1080205@rabbitmq.com>
Message-ID: <1044251504.16.1292624371832.JavaMail.root@zimbra>

Matthias, 

Awesome thanks a bunch, I will review the link. 

Regards,

Matt

----- Original Message -----
From: "Matthias Radestock" <matthias at rabbitmq.com>
To: "Matt Miller" <matt at mydomedia.com>
Cc: rabbitmq-discuss at lists.rabbitmq.com
Sent: Friday, December 17, 2010 6:33:15 AM
Subject: Re: [rabbitmq-discuss] STOMP plugin, changes,	usage example in python

Matt,

Matt Miller wrote:
> I have been using the STOMP gateway plugin for RabbitMQ 2.1.1 for
> some time, and it works great. The only hurdles I had in the past was
> a lack of documentation and usage examples. I believe part of the
> reason is the volatility of the protocol specification itself..?

The changes are not so much due to volatility in the spec but ambiguity 
and underspecification, which means that in order to make STOMP do 
anything useful, implementors have to invent a whole bunch of stuff.

> I receive a:
> 
> ListenerException: Error received headers:{'message': 'Unknown
> destination', 'content-type': 'text/plain', 'content-length': '86'},
> message:'' is not a valid destination. Valid exchange types are:
> /exchange, /topic or /queue.
> 
> To remedy the error I changed my subscription line to include
> '/topic' as the destination.
> 
> My only concern is that this may change again in the future. Why did
> this change?

We are trying to get more in line with what other STOMP server 
implementations do. See 
http://hg.rabbitmq.com/rabbitmq-stomp/file/rabbitmq_v2_2_0/DESIGN.md for 
the design around the particular change which you stumbled across.


Regards,

Matthias.
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From brad at brodrigu.net  Sat Dec 18 16:57:50 2010
From: brad at brodrigu.net (Brad Rodriguez)
Date: Sat, 18 Dec 2010 08:57:50 -0800
Subject: [rabbitmq-discuss] [ANNOUNCEMENT] amqp-0.2.0 (beta) Released.
In-Reply-To: <744D59E6-14C0-4844-B41D-20670607DC9E@brodrigu.net>
References: <744D59E6-14C0-4844-B41D-20670607DC9E@brodrigu.net>
Message-ID: <BC3066E2-CDB7-4AFC-B1BD-2747BD555EA1@brodrigu.net>

The updated documentation that corresponds to this release is finally live on php.net

http://docs.php.net/manual/en/book.amqp.php

-Brad

On Dec 10, 2010, at 12:30 PM, Brad Rodriguez wrote:

> 
> The new PECL package amqp-0.2.0 (beta) has been released at
> http://pecl.php.net/.
> 
> Release notes
> -------------
> Works with AMQP 0-8 and 0-9-1 (used by RabbitMQ 2.*)
> Modified AMQPConnection object:
>    * Requires call to 'connect' method to connect (no longer connects on
> instantiation)
>    * Added support for disconnect and reconnect
>    * Added helper setters for port, host, vhost, login and password
> Improved consume method to block for MIN messages, and try to get MAX
> messages if available
> Fixed zval descoping bugs
> Fixed bugs:
>    * 17809: Couldn't compile pecl extension under PHP 5.3
>    * 17831: Segmentation fault when the exchange doesn't exists
>    * 19707: AMQPQueue::get() doesn't return the message
>    * 19840: Connection Exception
> 
> Package Info
> -------------
> This extension can communicate with any AMQP spec 0-9-1 compatible server,
> such as RabbitMQ, OpenAMQP and Qpid, giving you the ability to create and
> delete exchanges and queues, as well as publish to any exchange and consume
> from any queue.
> 
> Related Links
> -------------
> Package home: http://pecl.php.net/package/amqp
>   Changelog: http://pecl.php.net/package-changelog.php?package=amqp
>    Download: http://pecl.php.net/get/amqp-0.2.0.tgz
> 
> Authors
> -------------
> Pieter de Zwart (lead)
> 
> 
> -- 
> PECL development discussion Mailing List (http://pecl.php.net/)
> To unsubscribe, visit: http://www.php.net/unsub.php

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101218/f4178c6b/attachment.htm>

From kenneth at loafman.com  Sat Dec 18 17:47:38 2010
From: kenneth at loafman.com (Kenneth Loafman)
Date: Sat, 18 Dec 2010 11:47:38 -0600
Subject: [rabbitmq-discuss] Upgrade to RabbitMQ 2.2.0 Failed
Message-ID: <AANLkTi=p8Lkp=Rdxpfd6evuoincWVz0d5Cg-fs4O7tZK@mail.gmail.com>

Hi,

I just upgraded from an older version of RabbitMQ to 2.2.0 and it failed
with the following in the startup_log.  Can anyone decrypt this and tell me
what it means in English?

...Thanks,
...Ken

{error_logger,{{2010,12,18},{17,24,58}},"Protocol: ~p: register error:
~p~n",["inet_tcp",{{badmatch,{error,etimedout}},[{inet_tcp_dist,listen,1},{net_kernel,start_protos,4},{net_kernel,start_protos,3},{net_kernel,init_node,2},{net_kernel,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}]}
{error_logger,{{2010,12,18},{17,24,58}},crash_report,[[{initial_call,{net_kernel,init,['Argument__1']}},{pid,<0.21.0>},{registered_name,[]},{error_info,{exit,{error,badarg},[{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{ancestors,[net_sup,kernel_sup,<0.8.0>]},{messages,[]},{links,[#Port<0.84>,<0.18.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,610},{stack_size,24},{reductions,515}],[]]}
{error_logger,{{2010,12,18},{17,24,58}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfa,{net_kernel,start_link,[[rabbitmq_multi2654,shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
{error_logger,{{2010,12,18},{17,24,58}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfa,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
{error_logger,{{2010,12,18},{17,24,58}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
{"Kernel pid
terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101218/3a9f682c/attachment.htm>

From rtrlists at googlemail.com  Sat Dec 18 19:09:40 2010
From: rtrlists at googlemail.com (Robert Raschke)
Date: Sat, 18 Dec 2010 19:09:40 +0000
Subject: [rabbitmq-discuss] Upgrade to RabbitMQ 2.2.0 Failed
In-Reply-To: <AANLkTi=p8Lkp=Rdxpfd6evuoincWVz0d5Cg-fs4O7tZK@mail.gmail.com>
References: <AANLkTi=p8Lkp=Rdxpfd6evuoincWVz0d5Cg-fs4O7tZK@mail.gmail.com>
Message-ID: <AANLkTikX8Or-yWhHxfuAo_8P6vyH9HHUncTCPDHjG0eK@mail.gmail.com>

Is the old one still running perhaps? That needs to be stopped before you
can start the new one.

The error message says that the TCP listen attempt timed out.

Robby

On Sat, Dec 18, 2010 at 5:47 PM, Kenneth Loafman <kenneth at loafman.com>wrote:

> Hi,
>
> I just upgraded from an older version of RabbitMQ to 2.2.0 and it failed
> with the following in the startup_log.  Can anyone decrypt this and tell me
> what it means in English?
>
> ...Thanks,
> ...Ken
>
> {error_logger,{{2010,12,18},{17,24,58}},"Protocol: ~p: register error:
> ~p~n",["inet_tcp",{{badmatch,{error,etimedout}},[{inet_tcp_dist,listen,1},{net_kernel,start_protos,4},{net_kernel,start_protos,3},{net_kernel,init_node,2},{net_kernel,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}]}
>
> {error_logger,{{2010,12,18},{17,24,58}},crash_report,[[{initial_call,{net_kernel,init,['Argument__1']}},{pid,<0.21.0>},{registered_name,[]},{error_info,{exit,{error,badarg},[{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{ancestors,[net_sup,kernel_sup,<0.8.0>]},{messages,[]},{links,[#Port<0.84>,<0.18.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,610},{stack_size,24},{reductions,515}],[]]}
>
> {error_logger,{{2010,12,18},{17,24,58}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfa,{net_kernel,start_link,[[rabbitmq_multi2654,shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
>
> {error_logger,{{2010,12,18},{17,24,58}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfa,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
>
> {error_logger,{{2010,12,18},{17,24,58}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
> {"Kernel pid
> terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101218/61b8480f/attachment.htm>

From kenneth at loafman.com  Sat Dec 18 19:51:50 2010
From: kenneth at loafman.com (Kenneth Loafman)
Date: Sat, 18 Dec 2010 13:51:50 -0600
Subject: [rabbitmq-discuss] Upgrade to RabbitMQ 2.2.0 Failed
In-Reply-To: <AANLkTikX8Or-yWhHxfuAo_8P6vyH9HHUncTCPDHjG0eK@mail.gmail.com>
References: <AANLkTi=p8Lkp=Rdxpfd6evuoincWVz0d5Cg-fs4O7tZK@mail.gmail.com>
	<AANLkTikX8Or-yWhHxfuAo_8P6vyH9HHUncTCPDHjG0eK@mail.gmail.com>
Message-ID: <AANLkTinijp25FLOSfvps65wxHGgLAax-mk79zfLuQsxu@mail.gmail.com>

In theory, the deb install process stopped the old one before starting the
new one.  Maybe it missed something.

I finally ended up purging it, rebooting, and installing it all over again.
Lost the queues, but no problem there.

...Thanks,
...Ken

On Sat, Dec 18, 2010 at 1:09 PM, Robert Raschke <rtrlists at googlemail.com>wrote:

> Is the old one still running perhaps? That needs to be stopped before you
> can start the new one.
>
> The error message says that the TCP listen attempt timed out.
>
> Robby
>
> On Sat, Dec 18, 2010 at 5:47 PM, Kenneth Loafman <kenneth at loafman.com>wrote:
>
>> Hi,
>>
>> I just upgraded from an older version of RabbitMQ to 2.2.0 and it failed
>> with the following in the startup_log.  Can anyone decrypt this and tell me
>> what it means in English?
>>
>> ...Thanks,
>> ...Ken
>>
>> {error_logger,{{2010,12,18},{17,24,58}},"Protocol: ~p: register error:
>> ~p~n",["inet_tcp",{{badmatch,{error,etimedout}},[{inet_tcp_dist,listen,1},{net_kernel,start_protos,4},{net_kernel,start_protos,3},{net_kernel,init_node,2},{net_kernel,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}]}
>>
>> {error_logger,{{2010,12,18},{17,24,58}},crash_report,[[{initial_call,{net_kernel,init,['Argument__1']}},{pid,<0.21.0>},{registered_name,[]},{error_info,{exit,{error,badarg},[{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{ancestors,[net_sup,kernel_sup,<0.8.0>]},{messages,[]},{links,[#Port<0.84>,<0.18.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,610},{stack_size,24},{reductions,515}],[]]}
>>
>> {error_logger,{{2010,12,18},{17,24,58}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfa,{net_kernel,start_link,[[rabbitmq_multi2654,shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
>>
>> {error_logger,{{2010,12,18},{17,24,58}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfa,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
>>
>> {error_logger,{{2010,12,18},{17,24,58}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
>> {"Kernel pid
>> terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101218/319447d1/attachment-0001.htm>

From msteele at beringmedia.com  Sat Dec 18 21:34:45 2010
From: msteele at beringmedia.com (Mark Steele)
Date: Sat, 18 Dec 2010 16:34:45 -0500
Subject: [rabbitmq-discuss] [ANNOUNCEMENT] amqp-0.2.0 (beta) Released.
In-Reply-To: <BC3066E2-CDB7-4AFC-B1BD-2747BD555EA1@brodrigu.net>
References: <744D59E6-14C0-4844-B41D-20670607DC9E@brodrigu.net>
	<BC3066E2-CDB7-4AFC-B1BD-2747BD555EA1@brodrigu.net>
Message-ID: <AANLkTim3XB6tXKX2AHJeyhOLYm7AFFXe0TVcaRYpiQ6x@mail.gmail.com>

Hi,

Out of curiosity, is it possible to use SSL connections? (via php stream
contexts perhaps?)

Cheers,


Mark Steele
Bering Media Inc.
+1 (416) 888-1009



On Sat, Dec 18, 2010 at 11:57 AM, Brad Rodriguez <brad at brodrigu.net> wrote:

> The updated documentation that corresponds to this release is finally live
> on php.net
>
> http://docs.php.net/manual/en/book.amqp.php
>
> <http://docs.php.net/manual/en/book.amqp.php>-Brad
>
> On Dec 10, 2010, at 12:30 PM, Brad Rodriguez wrote:
>
>
> The new PECL package amqp-0.2.0 (beta) has been released at
> http://pecl.php.net/.
>
> Release notes
> -------------
> Works with AMQP 0-8 and 0-9-1 (used by RabbitMQ 2.*)
> Modified AMQPConnection object:
>    * Requires call to 'connect' method to connect (no longer connects on
> instantiation)
>    * Added support for disconnect and reconnect
>    * Added helper setters for port, host, vhost, login and password
> Improved consume method to block for MIN messages, and try to get MAX
> messages if available
> Fixed zval descoping bugs
> Fixed bugs:
>    * 17809: Couldn't compile pecl extension under PHP 5.3
>    * 17831: Segmentation fault when the exchange doesn't exists
>    * 19707: AMQPQueue::get() doesn't return the message
>    * 19840: Connection Exception
>
> Package Info
> -------------
> This extension can communicate with any AMQP spec 0-9-1 compatible server,
> such as RabbitMQ, OpenAMQP and Qpid, giving you the ability to create and
> delete exchanges and queues, as well as publish to any exchange and consume
> from any queue.
>
> Related Links
> -------------
> Package home: http://pecl.php.net/package/amqp
>   Changelog: http://pecl.php.net/package-changelog.php?package=amqp
>    Download: http://pecl.php.net/get/amqp-0.2.0.tgz
>
> Authors
> -------------
> Pieter de Zwart (lead)
>
>
> --
> PECL development discussion Mailing List (http://pecl.php.net/)
> To unsubscribe, visit: http://www.php.net/unsub.php
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101218/18844cb7/attachment.htm>

From thadeurc at gmail.com  Sun Dec 19 13:20:05 2010
From: thadeurc at gmail.com (Thadeu Russo)
Date: Sun, 19 Dec 2010 11:20:05 -0200
Subject: [rabbitmq-discuss] Question about Connections and Channels
Message-ID: <AANLkTik2ghtmtT_hJ-eNb46uEJ6udpopQ6gnmHKFsu7R@mail.gmail.com>

Hi,

I need to architect a Java application using rabbitmq as its message broker.
It is a distributed application and the message broker will play the role of
connect the JVMs. Basically, each JVM has sets of objects (currently they
are grouped by host:port) that can change messages to other objects in other
groups in other virtual machines (there is a 1:1 bi-directional relationship
between groups of objects in different JVMs).
The idea of use the broker is to avoid the number of tcp ports I have to
open and also to take advantage of the message delivery guaranties.

The design is simple: each group of objects will have an exchange and 2
queues (incoming and outcoming) to change messages.

I would like to know if you guys advise the following configuration
regarding rabbitmq:

1- Have 1 connection per JVM
2- Have multiple channels to that connection. Each channel will be
associated with those 2 queues

What is concerning me is: the number of sends/receives per channel is high
(about 5k/second). Should I have multiple connections (like a pool), or it
is ok to use just 1 connection? If I have a pool of connections, I
understand they will share the same tcp port, and I could not see any
difference in using a single Connection.

Thanks in advance,

-- 
Thadeu de Russo e Carmo
http://www.thadeu.com.br/
http://www.caelum.com.br/
http://www.caelumobjects.com/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101219/e1f438b9/attachment.htm>

From 176047528 at qq.com  Mon Dec 20 07:32:18 2010
From: 176047528 at qq.com (=?gbk?B?0qa71A==?=)
Date: Mon, 20 Dec 2010 15:32:18 +0800
Subject: [rabbitmq-discuss] Question: where is the file when the messages
	are saved to disk.
Message-ID: <tencent_078463C33B60E1A658D31D5E@qq.com>

hi guys,
  
 I am a beginner of rabbitmq, when the messages are saved to hard disk, is that a file or use mnesia database. 
  
 thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101220/3ffa1c72/attachment.htm>

From alexandru at rabbitmq.com  Mon Dec 20 09:57:11 2010
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Mon, 20 Dec 2010 11:57:11 +0200
Subject: [rabbitmq-discuss] Question: where is the file when the
 messages are saved to disk.
In-Reply-To: <tencent_078463C33B60E1A658D31D5E@qq.com>
References: <tencent_078463C33B60E1A658D31D5E@qq.com>
Message-ID: <20101220095711.GC2267@dakota>

Hi,

The messages are stored in files in the mnesia directory (but not in a
mnesia database).  They're the files in the msg_store_*/ subdirectories.

Cheers,
Alex

On Mon, Dec 20, 2010 at 03:32:18PM +0800, ?? wrote:
> hi guys,
>   
>  I am a beginner of rabbitmq, when the messages are saved to hard disk, is that a file or use mnesia database. 
>   
>  thanks

> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From emile at rabbitmq.com  Mon Dec 20 12:20:24 2010
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 20 Dec 2010 12:20:24 +0000
Subject: [rabbitmq-discuss] Connection managment
In-Reply-To: <44BA27E0-4C4D-4093-85F9-4C1550311AAD@gmail.com>
References: <44BA27E0-4C4D-4093-85F9-4C1550311AAD@gmail.com>
Message-ID: <4D0F4A08.5080701@rabbitmq.com>

Hi Romary,

Op 03/12/2010 14:47, het romary.kremer at gmail.com geskryf:
> Is there a way to configure within rabbitMQ the maximum number of
> authorized connections on a single-node server ?
>
> Let say my message broker is sized to be operational with a number n of
> clients connected simultaneously. I would want
> to ensure that not more than n connections can be opened on the server.

There's no rabbit configuration option that lets you limit connections, 
but it should be possible to achieve this with a firewall. E.g. the 
iptables connlimit directive will let you limit connections on a 
particular port globally or per host.


Regards

Emile

From scottdupoy at gmail.com  Mon Dec 20 13:28:16 2010
From: scottdupoy at gmail.com (Scott Dupoy)
Date: Mon, 20 Dec 2010 13:28:16 +0000
Subject: [rabbitmq-discuss] RabbitMQ 2.0 broker crashes
Message-ID: <AANLkTi=K62vn+tue35MfHyGzjpbmNxOJrNnkkzP5=nF2@mail.gmail.com>

Hi all,

My broker is crashing in a reproducible way.  I'm running RabbitMQ 2.0 on a
32-bit version of Erlang on a 64-bit Windows Server 2008 R2 installation.

The management and webhooks plugins are installed.  I also have some code
periodically checking the broker internals via OTP.

The broker crashes if a queue builds up to the extent that messages have to
be persisted to msg_store_transient, and then a consumer quickly starts
consuming all the messages from that queue.  It's as if the broker is still
near the limit of its available memory then tries to reload a large chunk of
the cached messages from msg_store_transient.  This pushes it over some hard
limit and down it goes.

I've turned on memory alarms and for the purposes of debugging reduced the
memory high watermark to 0.05 (the system has 2gb).  With these settings a
cache of ~30,000 relatively small messages is sufficient to cause the
problem.

The main log messages are as follows.  I can send the dump log if necessary
too.

I've seen the release notes for 2.2 and wondered if the "fix queue memory
leak when using the management plugin or other consumers of queue
statistics" might be a related issue?

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2010-November/010172.html

Any help would be much appreciated!

Thanks,
Scott



debug log:

Crash dump was written to: c:/rabbit/erl_crash.dump
eheap_alloc: Cannot allocate 583848200 bytes of memory (of type "heap").



node log (rabbit at whatever.log):


=INFO REPORT==== 20-Dec-2010::12:52:13 ===
vm_memory_high_watermark set. Memory used:108708800 allowed:107350835

=INFO REPORT==== 20-Dec-2010::12:52:13 ===
    alarm_handler: {set,{vm_memory_high_watermark,[]}}

=INFO REPORT==== 20-Dec-2010::12:52:14 ===
vm_memory_high_watermark clear. Memory used:94399608 allowed:107350835

=INFO REPORT==== 20-Dec-2010::12:52:14 ===
    alarm_handler: {clear,vm_memory_high_watermark}

=ERROR REPORT==== 20-Dec-2010::12:52:20 ===
** Generic server msg_store_transient terminating
** Last message in was {'$gen_cast',
                           {remove,
                               [<<207,102,51,195,33,4,26,173,150,95,132,22,
                                  186,26,230,252>>]}}
** When Server state == {msstate,
                            "c:/rabbit/db/RabbitMQ at VMRMQ1-mnesia
/msg_store_transient",
                            rabbit_msg_store_ets_index,
                            {state,151612,
                                "c:/rabbit/db/RabbitMQ at VMRMQ1-mnesia
/msg_store_transient"},
                            6,#Ref<0.0.0.7537>,
                            {dict,0,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                            [],undefined,85671623,103928228,[],false,
                            <0.237.0>,159806,147515,155709,163903,
                            {set,2,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},

{{[<<76,144,119,142,103,20,191,166,92,52,177,
                                     137,37,253,53,198>>],
                                  [],[],[],[],[],[],[],[],
                                  [<<97,19,25,60,105,158,160,68,116,178,239,
                                     127,59,191,208,161>>],
                                  [],[],[],[],[],[]}}},
                            false,16777216}
** Reason for termination ==
** {{badmatch,{error,eacces}},
    [{rabbit_msg_store,delete_file_if_empty,2},
     {rabbit_msg_store,remove_message,2},
     {lists,foldl,3},
     {rabbit_msg_store,handle_cast,2},
     {gen_server2,handle_msg,7},
     {proc_lib,wake_up,3}]}

=INFO REPORT==== 20-Dec-2010::12:52:26 ===
stopped TCP Listener on 0.0.0.0:5672

=INFO REPORT==== 20-Dec-2010::12:52:26 ===
closing TCP connection <0.6768.0> from 172.20.5.35:55230

=INFO REPORT==== 20-Dec-2010::12:52:26 ===
closing TCP connection <0.521.0> from 172.20.5.35:55101

=INFO REPORT==== 20-Dec-2010::12:52:26 ===
closing TCP connection <0.309.0> from 172.22.1.5:56205

=INFO REPORT==== 20-Dec-2010::12:52:26 ===
vm_memory_high_watermark set. Memory used:177922856 allowed:107350835

=INFO REPORT==== 20-Dec-2010::12:52:26 ===
    alarm_handler: {set,{vm_memory_high_watermark,[]}}



sasl log:


=CRASH REPORT==== 20-Dec-2010::12:52:23 ===
  crasher:
    initial call: gen:init_it/7
    pid: <0.235.0>
    registered_name: msg_store_transient
    exception exit: {{badmatch,{error,eacces}},
                     [{rabbit_msg_store,delete_file_if_empty,2},
                      {rabbit_msg_store,remove_message,2},
                      {lists,foldl,3},
                      {rabbit_msg_store,handle_cast,2},
                      {gen_server2,handle_msg,7},
                      {proc_lib,wake_up,3}]}
      in function  gen_server2:terminate/6
    ancestors: [rabbit_sup,<0.186.0>]
    messages: [{'$gen_cast',
                      {remove,
                          [<<116,2,44,89,198,13,221,58,18,13,147,52,79,55,
                             101,76>>]}},
                  {'$gen_cast',
                      {remove,
                          [<<93,225,245,186,89,105,207,141,190,8,167,133,
                             251,196,229,169>>]}},
                  {'$gen_cast',
                      {remove,
                          [<<36,45,179,241,82,8,235,59,130,71,81,223,19,89,
                             23,159>>]}},
[...]
                  {'$gen_cast',
                      {remove,

[<<93,226,119,14,115,208,16,0,35,241,8,153,128,173,
                             33,46>>,

<<102,18,229,215,103,192,214,80,241,21,240,138,35,
                             33,210,8>>,

<<144,39,170,218,61,5,23,24,234,156,43,154,63,104,
                             46,233>>,
                           <<201,4,128,74,48,234,192,77,11,64,58,124,146,64,
                             196,108>>,

<<103,56,91,19,0,9,57,136,201,83,73,171,214,48,76,
                             227>>,
[...]
                           <<28,5,2,76,231,115,160,56,192,101,127,47,74,105,
                             103,102>>,

<<49,236,73,20,167,156,137,55,109,184,47,56,116,237,
                             53,9>>,
                           <<"????|???1?%\b4 ,%">>]}}]
    links: [<0.187.0>]
    dictionary: [{fhc_age_tree,{0,nil}}]
    trap_exit: true
    status: running
    heap_size: 121393
    stack_size: 24
    reductions: 19087946
  neighbours:

=SUPERVISOR REPORT==== 20-Dec-2010::12:52:26 ===
     Supervisor: {local,rabbit_sup}
     Context:    child_terminated
     Reason:     {{badmatch,{error,eacces}},
                  [{rabbit_msg_store,delete_file_if_empty,2},
                   {rabbit_msg_store,remove_message,2},
                   {lists,foldl,3},
                   {rabbit_msg_store,handle_cast,2},
                   {gen_server2,handle_msg,7},
                   {proc_lib,wake_up,3}]}
     Offender:   [{pid,<0.235.0>},
                  {name,msg_store_transient},
                  {mfa,
                      {rabbit_msg_store,start_link,
                          [msg_store_transient,
                           "c:/rabbit/db/RabbitMQ at VMRMQ1-mnesia",undefined,
                           {#Fun<rabbit_variable_queue.0.52678393>,ok}]}},
                  {restart_type,transient},
                  {shutdown,4294967295},
                  {child_type,worker}]


=SUPERVISOR REPORT==== 20-Dec-2010::12:52:26 ===
     Supervisor: {local,rabbit_sup}
     Context:    shutdown
     Reason:     reached_max_restart_intensity
     Offender:   [{pid,<0.235.0>},
                  {name,msg_store_transient},
                  {mfa,
                      {rabbit_msg_store,start_link,
                          [msg_store_transient,
                           "c:/rabbit/db/RabbitMQ at VMRMQ1-mnesia",undefined,
                           {#Fun<rabbit_variable_queue.0.52678393>,ok}]}},
                  {restart_type,transient},
                  {shutdown,4294967295},
                  {child_type,worker}]
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101220/c118d218/attachment.htm>

From matthew at rabbitmq.com  Mon Dec 20 13:35:35 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 20 Dec 2010 13:35:35 +0000
Subject: [rabbitmq-discuss] RabbitMQ 2.0 broker crashes
In-Reply-To: <AANLkTi=K62vn+tue35MfHyGzjpbmNxOJrNnkkzP5=nF2@mail.gmail.com>
References: <AANLkTi=K62vn+tue35MfHyGzjpbmNxOJrNnkkzP5=nF2@mail.gmail.com>
Message-ID: <20101220133534.GH18077@rabbitmq.com>

On Mon, Dec 20, 2010 at 01:28:16PM +0000, Scott Dupoy wrote:
> My broker is crashing in a reproducible way.  I'm running RabbitMQ 2.0 on a
> 32-bit version of Erlang on a 64-bit Windows Server 2008 R2 installation.

2.0.0 had a number of bugs in it. Please upgrade to the latest 2.2.0
release.

> I've seen the release notes for 2.2 and wondered if the "fix queue memory
> leak when using the management plugin or other consumers of queue
> statistics" might be a related issue?

Yup, that's exactly the issue. You should find this problem solved with
2.2.0.

Matthew

From jon at jbrisbin.com  Mon Dec 20 14:45:26 2010
From: jon at jbrisbin.com (Jon Brisbin)
Date: Mon, 20 Dec 2010 08:45:26 -0600
Subject: [rabbitmq-discuss] RabbitMQ 2.0 broker crashes
In-Reply-To: <20101220133534.GH18077@rabbitmq.com>
References: <AANLkTi=K62vn+tue35MfHyGzjpbmNxOJrNnkkzP5=nF2@mail.gmail.com>
	<20101220133534.GH18077@rabbitmq.com>
Message-ID: <17C24E87-C4CE-43DA-9B2F-4AD195F750F5@npcinternational.com>

On Dec 20, 2010, at 7:35 AM, Matthew Sackman wrote:

> On Mon, Dec 20, 2010 at 01:28:16PM +0000, Scott Dupoy wrote:
>> My broker is crashing in a reproducible way.  I'm running RabbitMQ 2.0 on a
>> 32-bit version of Erlang on a 64-bit Windows Server 2008 R2 installation.
> 
> 2.0.0 had a number of bugs in it. Please upgrade to the latest 2.2.0
> release.

FYI- I also recently updated the webhooks plugin for 2.2.0. You'll need to download the latest from GitHub (0.11) to run in that version of the broker..

https://github.com/jbrisbin/rabbitmq-webhooks

Jon Brisbin
Portal Webmaster
NPC International, Inc.

Twitter: @j_brisbin
Skype: jon.brisbin

> 
>> I've seen the release notes for 2.2 and wondered if the "fix queue memory
>> leak when using the management plugin or other consumers of queue
>> statistics" might be a related issue?
> 
> Yup, that's exactly the issue. You should find this problem solved with
> 2.2.0.
> 
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



From underattack7 at googlemail.com  Mon Dec 20 15:38:11 2010
From: underattack7 at googlemail.com (underattack7)
Date: Mon, 20 Dec 2010 15:38:11 +0000
Subject: [rabbitmq-discuss] Persistent message in perl
Message-ID: <AANLkTimtnOpBdPhryey6QoZErfq8GksuP_B27M0dsn2v@mail.gmail.com>

Hi,

I am struggling with persistent message in perl.

What I am trying to achieve is :
- publish message to a direct exchange
- the exchange stores the message
- a consumer creates a queue, binds it to the exchange, and get all the
stored messages

I have a durable exchange, and apparently I would need to publish message
using "delivery_mode = 2" for the exchange to store the message until a
queue is bound to it....is that right ?

The problem I have is that when my consumer creates a queue and bind it to
the exchange, it does not get all the message sent.


My publisher code :

#!/usr/bin/perl
use Net::RabbitMQ;

my $myexchange=$ARGV[0];
my $rkey=$ARGV[1];
my $text=$ARGV[2];

my $mq = Net::RabbitMQ->new();
$mq->connect("rabbitmqserver", { vhost=>"chat", user => "guest", password =>
"guest" });
$mq->channel_open(1);
$mq->publish(1, $rkey, $text, {exchange => $myexchange}, { content_type =>
'text/plain', delivery_mode => 2});
mqdisconnect;
exit 0;


I execute it with for example :
./publish.pl "exchangechat" "toto" "hi toto1"
./publish.pl "exchangechat" "toto" "hi toto2"
./publish.pl "exchangechat" "toto" "hi toto3"



The consumer code is :
#!/usr/bin/perl
use Net::RabbitMQ;

my $exchange=$ARGV[0];
my $rkey=$ARGV[1];

my $mq = Net::RabbitMQ->new();
$mq->connect("rabbitmqserver", { vhost => "chat", user => "guest", password
=> "guest" });
$mq->channel_open(1);
my $queuename = $mq->queue_declare(1, '', {exclusive => 1, durable => 0,
auto_delete => 1});
$mq->queue_bind(1, "$queue", "$exchange", "$rkey");

while(1) {
    my $message = $mq->get(1, $queuename);
    if ( defined($message) ) {
        print $message->{'routing_key'} . "\n";
        print $message->{'body'} . "\n";
        print "\n\n";
    }
    sleep(1);
}
exit 0;

And I run it with :
./consume.pl exchangechat "toto"

but I do not get the message "hi toto1"


Any idea what's wrong here ?

Thanks,

Fab
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101220/deec112b/attachment.htm>

From alexandru at rabbitmq.com  Mon Dec 20 16:11:22 2010
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Mon, 20 Dec 2010 18:11:22 +0200
Subject: [rabbitmq-discuss] Persistent message in perl
In-Reply-To: <AANLkTimtnOpBdPhryey6QoZErfq8GksuP_B27M0dsn2v@mail.gmail.com>
References: <AANLkTimtnOpBdPhryey6QoZErfq8GksuP_B27M0dsn2v@mail.gmail.com>
Message-ID: <20101220161122.GK2267@dakota>

Hi,

Queues and exchanges don't work like that.

An exchange is just a router, it doesn't store messages.  That's the
queues' job.

What you want to do is this:
  - publisher declares a durable queue with a known name and binds it to an
    exchange (by default it's bound the default exchange with its name
    as routing key; the default exchange is "amq.default" or "")
  - publisher publishes a persistent message to the exchange, which
    routes it to the queue (the routing key should be the queue's name,
    or whatever you bound the queue with)

  - consumer declares a durable queue with the same name (this is just
    to make sure that it exists; it's effectively a no-op)
  - consumer consumes or gets from the queue.

Hope this helps.

Cheers,
Alex

On Mon, Dec 20, 2010 at 03:38:11PM +0000, underattack7 wrote:
> Hi,
> 
> I am struggling with persistent message in perl.
> 
> What I am trying to achieve is :
> - publish message to a direct exchange
> - the exchange stores the message
> - a consumer creates a queue, binds it to the exchange, and get all the
> stored messages
> 
> I have a durable exchange, and apparently I would need to publish message
> using "delivery_mode = 2" for the exchange to store the message until a
> queue is bound to it....is that right ?
> 
> The problem I have is that when my consumer creates a queue and bind it to
> the exchange, it does not get all the message sent.
> 
> 
> My publisher code :
> 
> #!/usr/bin/perl
> use Net::RabbitMQ;
> 
> my $myexchange=$ARGV[0];
> my $rkey=$ARGV[1];
> my $text=$ARGV[2];
> 
> my $mq = Net::RabbitMQ->new();
> $mq->connect("rabbitmqserver", { vhost=>"chat", user => "guest", password =>
> "guest" });
> $mq->channel_open(1);
> $mq->publish(1, $rkey, $text, {exchange => $myexchange}, { content_type =>
> 'text/plain', delivery_mode => 2});
> mqdisconnect;
> exit 0;
> 
> 
> I execute it with for example :
> ./publish.pl "exchangechat" "toto" "hi toto1"
> ./publish.pl "exchangechat" "toto" "hi toto2"
> ./publish.pl "exchangechat" "toto" "hi toto3"
> 
> 
> 
> The consumer code is :
> #!/usr/bin/perl
> use Net::RabbitMQ;
> 
> my $exchange=$ARGV[0];
> my $rkey=$ARGV[1];
> 
> my $mq = Net::RabbitMQ->new();
> $mq->connect("rabbitmqserver", { vhost => "chat", user => "guest", password
> => "guest" });
> $mq->channel_open(1);
> my $queuename = $mq->queue_declare(1, '', {exclusive => 1, durable => 0,
> auto_delete => 1});
> $mq->queue_bind(1, "$queue", "$exchange", "$rkey");
> 
> while(1) {
>     my $message = $mq->get(1, $queuename);
>     if ( defined($message) ) {
>         print $message->{'routing_key'} . "\n";
>         print $message->{'body'} . "\n";
>         print "\n\n";
>     }
>     sleep(1);
> }
> exit 0;
> 
> And I run it with :
> ./consume.pl exchangechat "toto"
> 
> but I do not get the message "hi toto1"
> 
> 
> Any idea what's wrong here ?
> 
> Thanks,
> 
> Fab

> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From emile at rabbitmq.com  Mon Dec 20 16:42:22 2010
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 20 Dec 2010 16:42:22 +0000
Subject: [rabbitmq-discuss] Persistent message in perl
In-Reply-To: <20101220161122.GK2267@dakota>
References: <AANLkTimtnOpBdPhryey6QoZErfq8GksuP_B27M0dsn2v@mail.gmail.com>
	<20101220161122.GK2267@dakota>
Message-ID: <4D0F876E.1020800@rabbitmq.com>


Hi Fab,

If you ran publish.pl before consume.pl then the messages will be 
discarded, because there is no queue for messages to be delivered to and 
no binding for messages to get there.

As Alexandru explained, the binding and queue have to exist first. You 
could either launch the consumer in the background before starting the 
publisher, or declare the queue and binding in the publisher as well.

Regards

Emile



Op 20/12/2010 16:11, het Alexandru Scvor?ov geskryf:
> Hi,
>
> Queues and exchanges don't work like that.
>
> An exchange is just a router, it doesn't store messages.  That's the
> queues' job.
>
> What you want to do is this:
>    - publisher declares a durable queue with a known name and binds it to an
>      exchange (by default it's bound the default exchange with its name
>      as routing key; the default exchange is "amq.default" or "")
>    - publisher publishes a persistent message to the exchange, which
>      routes it to the queue (the routing key should be the queue's name,
>      or whatever you bound the queue with)
>
>    - consumer declares a durable queue with the same name (this is just
>      to make sure that it exists; it's effectively a no-op)
>    - consumer consumes or gets from the queue.
>
> Hope this helps.
>
> Cheers,
> Alex
>
> On Mon, Dec 20, 2010 at 03:38:11PM +0000, underattack7 wrote:
>> Hi,
>>
>> I am struggling with persistent message in perl.
>>
>> What I am trying to achieve is :
>> - publish message to a direct exchange
>> - the exchange stores the message
>> - a consumer creates a queue, binds it to the exchange, and get all the
>> stored messages
>>
>> I have a durable exchange, and apparently I would need to publish message
>> using "delivery_mode = 2" for the exchange to store the message until a
>> queue is bound to it....is that right ?
>>
>> The problem I have is that when my consumer creates a queue and bind it to
>> the exchange, it does not get all the message sent.
>>
>>
>> My publisher code :
>>
>> #!/usr/bin/perl
>> use Net::RabbitMQ;
>>
>> my $myexchange=$ARGV[0];
>> my $rkey=$ARGV[1];
>> my $text=$ARGV[2];
>>
>> my $mq = Net::RabbitMQ->new();
>> $mq->connect("rabbitmqserver", { vhost=>"chat", user =>  "guest", password =>
>> "guest" });
>> $mq->channel_open(1);
>> $mq->publish(1, $rkey, $text, {exchange =>  $myexchange}, { content_type =>
>> 'text/plain', delivery_mode =>  2});
>> mqdisconnect;
>> exit 0;
>>
>>
>> I execute it with for example :
>> ./publish.pl "exchangechat" "toto" "hi toto1"
>> ./publish.pl "exchangechat" "toto" "hi toto2"
>> ./publish.pl "exchangechat" "toto" "hi toto3"
>>
>>
>>
>> The consumer code is :
>> #!/usr/bin/perl
>> use Net::RabbitMQ;
>>
>> my $exchange=$ARGV[0];
>> my $rkey=$ARGV[1];
>>
>> my $mq = Net::RabbitMQ->new();
>> $mq->connect("rabbitmqserver", { vhost =>  "chat", user =>  "guest", password
>> =>  "guest" });
>> $mq->channel_open(1);
>> my $queuename = $mq->queue_declare(1, '', {exclusive =>  1, durable =>  0,
>> auto_delete =>  1});
>> $mq->queue_bind(1, "$queue", "$exchange", "$rkey");
>>
>> while(1) {
>>      my $message = $mq->get(1, $queuename);
>>      if ( defined($message) ) {
>>          print $message->{'routing_key'} . "\n";
>>          print $message->{'body'} . "\n";
>>          print "\n\n";
>>      }
>>      sleep(1);
>> }
>> exit 0;
>>
>> And I run it with :
>> ./consume.pl exchangechat "toto"
>>
>> but I do not get the message "hi toto1"
>>
>>
>> Any idea what's wrong here ?
>>
>> Thanks,
>>
>> Fab

From scottdupoy at gmail.com  Mon Dec 20 18:15:14 2010
From: scottdupoy at gmail.com (Scott Dupoy)
Date: Mon, 20 Dec 2010 18:15:14 +0000
Subject: [rabbitmq-discuss] RabbitMQ 2.0 broker crashes
In-Reply-To: <17C24E87-C4CE-43DA-9B2F-4AD195F750F5@npcinternational.com>
References: <AANLkTi=K62vn+tue35MfHyGzjpbmNxOJrNnkkzP5=nF2@mail.gmail.com>
	<20101220133534.GH18077@rabbitmq.com>
	<17C24E87-C4CE-43DA-9B2F-4AD195F750F5@npcinternational.com>
Message-ID: <AANLkTik0=cQFX87LmcW0KGARZesD6cD4Rz683q=Ni9U_@mail.gmail.com>

Hi Jon,

That's great!  Thanks for letting me know.

Unfortunately, my broker is still crashing, but not due to a direct out of
memory exception now.  I seem to be having a sharing access violation with
the msg_store_transient files.

I've tried the 2.2.0 binaries as on the website and a build of the umbrella
tag of 2.2.0 (I've changed the CORE_REPOS hg clone to also hg update to the
tag).  Both of these still crash.

I have removed all the plugins and the crash still occurs.

I've narrowed down the scenario when the crash occurs.  As the queue builds
up the msg_store_transient\0.rdq file is populated.  If I start the consumer
at this point everything is fine.  If the broker starts storing data in a
second database file (msg_store_transient\1.rdq) and then I start my
consumer then the crash occurs.  Procmon suggests a sharing violation with
one handle attempting to delete the 0.rdq file.

Has anyone experienced this kind of problem before?

Thanks,

Scott


On 20 December 2010 14:45, Jon Brisbin <jon at jbrisbin.com> wrote:

> On Dec 20, 2010, at 7:35 AM, Matthew Sackman wrote:
>
> > On Mon, Dec 20, 2010 at 01:28:16PM +0000, Scott Dupoy wrote:
> >> My broker is crashing in a reproducible way.  I'm running RabbitMQ 2.0
> on a
> >> 32-bit version of Erlang on a 64-bit Windows Server 2008 R2
> installation.
> >
> > 2.0.0 had a number of bugs in it. Please upgrade to the latest 2.2.0
> > release.
>
> FYI- I also recently updated the webhooks plugin for 2.2.0. You'll need to
> download the latest from GitHub (0.11) to run in that version of the
> broker..
>
> https://github.com/jbrisbin/rabbitmq-webhooks
>
> Jon Brisbin
> Portal Webmaster
> NPC International, Inc.
>
> Twitter: @j_brisbin
> Skype: jon.brisbin
>
> >
> >> I've seen the release notes for 2.2 and wondered if the "fix queue
> memory
> >> leak when using the management plugin or other consumers of queue
> >> statistics" might be a related issue?
> >
> > Yup, that's exactly the issue. You should find this problem solved with
> > 2.2.0.
> >
> > Matthew
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101220/cc33af0e/attachment-0001.htm>

From matthew at rabbitmq.com  Mon Dec 20 18:27:58 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 20 Dec 2010 18:27:58 +0000
Subject: [rabbitmq-discuss] RabbitMQ 2.0 broker crashes
In-Reply-To: <AANLkTik0=cQFX87LmcW0KGARZesD6cD4Rz683q=Ni9U_@mail.gmail.com>
References: <AANLkTi=K62vn+tue35MfHyGzjpbmNxOJrNnkkzP5=nF2@mail.gmail.com>
	<20101220133534.GH18077@rabbitmq.com>
	<17C24E87-C4CE-43DA-9B2F-4AD195F750F5@npcinternational.com>
	<AANLkTik0=cQFX87LmcW0KGARZesD6cD4Rz683q=Ni9U_@mail.gmail.com>
Message-ID: <20101220182758.GO18077@rabbitmq.com>

On Mon, Dec 20, 2010 at 06:15:14PM +0000, Scott Dupoy wrote:
> I've narrowed down the scenario when the crash occurs.  As the queue builds
> up the msg_store_transient\0.rdq file is populated.  If I start the consumer
> at this point everything is fine.  If the broker starts storing data in a
> second database file (msg_store_transient\1.rdq) and then I start my
> consumer then the crash occurs.  Procmon suggests a sharing violation with
> one handle attempting to delete the 0.rdq file.

Right. I think I can guess what's going on here, and it's not pretty.
For various reasons, Rabbit can have the same file open multiple times.
It can then decide to delete that file. Under unices, that's not a
problem. However, apparently in general, on Windows, you can't ask for a
file to be deleted if it's held open.

This is not going to be a simple thing to fix. In all honesty, the best
solution right now is for you not to run Rabbit under Windows. If you
have to use a Windows host, then run a Linux VM within it.

I'm pretty astonished that this hasn't been reported before. I guess
that's likely an indication of the number of people that run RabbitMQ
under Windows.

Matthew

From underattack7 at googlemail.com  Mon Dec 20 19:00:06 2010
From: underattack7 at googlemail.com (underattack7)
Date: Mon, 20 Dec 2010 19:00:06 +0000
Subject: [rabbitmq-discuss] Persistent message in perl
In-Reply-To: <4D0F876E.1020800@rabbitmq.com>
References: <AANLkTimtnOpBdPhryey6QoZErfq8GksuP_B27M0dsn2v@mail.gmail.com>
	<20101220161122.GK2267@dakota> <4D0F876E.1020800@rabbitmq.com>
Message-ID: <AANLkTikva=tpnmpkHkK7qarcN=687kKC5DsRcKEKCy1o@mail.gmail.com>

ok thanks for your help, that makes sense.

On 20 December 2010 16:42, Emile Joubert <emile at rabbitmq.com> wrote:

>
> Hi Fab,
>
> If you ran publish.pl before consume.pl then the messages will be
> discarded, because there is no queue for messages to be delivered to and no
> binding for messages to get there.
>
> As Alexandru explained, the binding and queue have to exist first. You
> could either launch the consumer in the background before starting the
> publisher, or declare the queue and binding in the publisher as well.
>
> Regards
>
> Emile
>
>
>
> Op 20/12/2010 16:11, het Alexandru Scvor?ov geskryf:
>
>  Hi,
>>
>> Queues and exchanges don't work like that.
>>
>> An exchange is just a router, it doesn't store messages.  That's the
>> queues' job.
>>
>> What you want to do is this:
>>   - publisher declares a durable queue with a known name and binds it to
>> an
>>     exchange (by default it's bound the default exchange with its name
>>     as routing key; the default exchange is "amq.default" or "")
>>   - publisher publishes a persistent message to the exchange, which
>>     routes it to the queue (the routing key should be the queue's name,
>>     or whatever you bound the queue with)
>>
>>   - consumer declares a durable queue with the same name (this is just
>>     to make sure that it exists; it's effectively a no-op)
>>   - consumer consumes or gets from the queue.
>>
>> Hope this helps.
>>
>> Cheers,
>> Alex
>>
>> On Mon, Dec 20, 2010 at 03:38:11PM +0000, underattack7 wrote:
>>
>>> Hi,
>>>
>>> I am struggling with persistent message in perl.
>>>
>>> What I am trying to achieve is :
>>> - publish message to a direct exchange
>>> - the exchange stores the message
>>> - a consumer creates a queue, binds it to the exchange, and get all the
>>> stored messages
>>>
>>> I have a durable exchange, and apparently I would need to publish message
>>> using "delivery_mode = 2" for the exchange to store the message until a
>>> queue is bound to it....is that right ?
>>>
>>> The problem I have is that when my consumer creates a queue and bind it
>>> to
>>> the exchange, it does not get all the message sent.
>>>
>>>
>>> My publisher code :
>>>
>>> #!/usr/bin/perl
>>> use Net::RabbitMQ;
>>>
>>> my $myexchange=$ARGV[0];
>>> my $rkey=$ARGV[1];
>>> my $text=$ARGV[2];
>>>
>>> my $mq = Net::RabbitMQ->new();
>>> $mq->connect("rabbitmqserver", { vhost=>"chat", user =>  "guest",
>>> password =>
>>> "guest" });
>>> $mq->channel_open(1);
>>> $mq->publish(1, $rkey, $text, {exchange =>  $myexchange}, { content_type
>>> =>
>>> 'text/plain', delivery_mode =>  2});
>>> mqdisconnect;
>>> exit 0;
>>>
>>>
>>> I execute it with for example :
>>> ./publish.pl "exchangechat" "toto" "hi toto1"
>>> ./publish.pl "exchangechat" "toto" "hi toto2"
>>> ./publish.pl "exchangechat" "toto" "hi toto3"
>>>
>>>
>>>
>>> The consumer code is :
>>> #!/usr/bin/perl
>>> use Net::RabbitMQ;
>>>
>>> my $exchange=$ARGV[0];
>>> my $rkey=$ARGV[1];
>>>
>>> my $mq = Net::RabbitMQ->new();
>>> $mq->connect("rabbitmqserver", { vhost =>  "chat", user =>  "guest",
>>> password
>>> =>  "guest" });
>>> $mq->channel_open(1);
>>> my $queuename = $mq->queue_declare(1, '', {exclusive =>  1, durable =>
>>>  0,
>>> auto_delete =>  1});
>>> $mq->queue_bind(1, "$queue", "$exchange", "$rkey");
>>>
>>> while(1) {
>>>     my $message = $mq->get(1, $queuename);
>>>     if ( defined($message) ) {
>>>         print $message->{'routing_key'} . "\n";
>>>         print $message->{'body'} . "\n";
>>>         print "\n\n";
>>>     }
>>>     sleep(1);
>>> }
>>> exit 0;
>>>
>>> And I run it with :
>>> ./consume.pl exchangechat "toto"
>>>
>>> but I do not get the message "hi toto1"
>>>
>>>
>>> Any idea what's wrong here ?
>>>
>>> Thanks,
>>>
>>> Fab
>>>
>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101220/4df651e8/attachment.htm>

From andrew at glyde.com  Tue Dec 21 00:46:34 2010
From: andrew at glyde.com (andrew chase)
Date: Mon, 20 Dec 2010 16:46:34 -0800
Subject: [rabbitmq-discuss] Problem when hitting /api/queues in rabbitmq
	management API
Message-ID: <AANLkTi=5bhV5s_u-Dyw4uYF_w0E2+h0Gv1OCFMgthw2X@mail.gmail.com>

I'm not sure whether I should be asking this question here, or if
there's a different path for communicating problems with the
rabbitmq-management plugin. I thought about opening an issue via
github, but it looks like the rabbitmq-managment committers are
already using mercurial for ticket tracking.

I have been really impressed with the management plugin, however, I am
having problems with making GET requests to the "/apis/queues" route.
When requesting that path I get back a 500 Internal server error. In
the rabbitmq log file the error is being logged as:

=ERROR REPORT==== 20-Dec-2010::16:21:58 ===
webmachine error: path="/api/queues"
{error,{exit,{json_encode,{bad_term,<0.16116.0>}},
? ? ? ? ? ? [{mochijson2,json_encode,2},
? ? ? ? ? ? ?{mochijson2,'-json_encode_proplist/2-fun-0-',3},
? ? ? ? ? ? ?{lists,foldl,3},
? ? ? ? ? ? ?{mochijson2,json_encode_proplist,2},
? ? ? ? ? ? ?{mochijson2,'-json_encode_array/2-fun-0-',3},
? ? ? ? ? ? ?{lists,foldl,3},
? ? ? ? ? ? ?{mochijson2,json_encode_array,2},
? ? ? ? ? ? ?{rabbit_mgmt_util,reply,3}]}}


I'm running a clean install of rabbitmq 2.2.0 with all the most recent
rabbitmq-management plugins. Here's the configuration details of the
stack:

/usr/sbin/rabbitmqctl status
Status of node 'rabbit at rabbit-server01' ...
[{running_applications,
     [{rabbit_management,"RabbitMQ Management Console","2.2.0"},
      {webmachine,"webmachine","1.7.0"},
      {rabbit_management_agent,"RabbitMQ Management Agent","2.2.0"},
      {amqp_client,"RabbitMQ AMQP Client","2.2.0"},
      {rabbit,"RabbitMQ","2.2.0"},
      {os_mon,"CPO  CXC 138 46","2.2.2"},
      {sasl,"SASL  CXC 138 11","2.1.6"},
      {rabbit_mochiweb,"RabbitMQ Mochiweb Embedding","2.2.0"},
      {mochiweb,"MochiMedia Web Server","1.3"},
      {crypto,"CRYPTO version 1","1.6"},
      {inets,"INETS  CXC 138 49","5.1"},
      {mnesia,"MNESIA  CXC 138 12","4.4.10"},
      {stdlib,"ERTS  CXC 138 10","1.16.2"},
      {kernel,"ERTS  CXC 138 10","2.13.2"}]},
 {nodes,[{disc,['rabbit at rabbit-server01','rabbit at rabbit-server02]}]},
 {running_nodes,['rabbit at rabbit-server01','rabbit at rabbit-server02']}]
...done.

Also, I'm running Erlang R13B01. Could that be the problem?

$ erl
Erlang R13B01 (erts-5.7.2) [source] [64-bit] [smp:8:8] [rq:8]
[async-threads:0] [hipe] [kernel-poll:false]


Thanks,
Andrew

From scottdupoy at gmail.com  Tue Dec 21 09:33:30 2010
From: scottdupoy at gmail.com (Scott Dupoy)
Date: Tue, 21 Dec 2010 09:33:30 +0000
Subject: [rabbitmq-discuss] RabbitMQ 2.0 broker crashes
In-Reply-To: <20101220182758.GO18077@rabbitmq.com>
References: <AANLkTi=K62vn+tue35MfHyGzjpbmNxOJrNnkkzP5=nF2@mail.gmail.com>
	<20101220133534.GH18077@rabbitmq.com>
	<17C24E87-C4CE-43DA-9B2F-4AD195F750F5@npcinternational.com>
	<AANLkTik0=cQFX87LmcW0KGARZesD6cD4Rz683q=Ni9U_@mail.gmail.com>
	<20101220182758.GO18077@rabbitmq.com>
Message-ID: <AANLkTi=vB9PmwZNnfbV85JTY1ioWP1upLOCPrRmYKrHF@mail.gmail.com>

Hi Matthew,

Thank you for your reply.

Making the assumption that we can't switch to a unix/linux distribution, is
it possible to change the size at which the *.rdq file rolls?  If this is
possible then at least we can (further) reduce the risk of a failure.

Cheers,
Scott

On 20 December 2010 18:27, Matthew Sackman <matthew at rabbitmq.com> wrote:

> On Mon, Dec 20, 2010 at 06:15:14PM +0000, Scott Dupoy wrote:
> > I've narrowed down the scenario when the crash occurs.  As the queue
> builds
> > up the msg_store_transient\0.rdq file is populated.  If I start the
> consumer
> > at this point everything is fine.  If the broker starts storing data in a
> > second database file (msg_store_transient\1.rdq) and then I start my
> > consumer then the crash occurs.  Procmon suggests a sharing violation
> with
> > one handle attempting to delete the 0.rdq file.
>
> Right. I think I can guess what's going on here, and it's not pretty.
> For various reasons, Rabbit can have the same file open multiple times.
> It can then decide to delete that file. Under unices, that's not a
> problem. However, apparently in general, on Windows, you can't ask for a
> file to be deleted if it's held open.
>
> This is not going to be a simple thing to fix. In all honesty, the best
> solution right now is for you not to run Rabbit under Windows. If you
> have to use a Windows host, then run a Linux VM within it.
>
> I'm pretty astonished that this hasn't been reported before. I guess
> that's likely an indication of the number of people that run RabbitMQ
> under Windows.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101221/41037318/attachment-0001.htm>

From 176047528 at qq.com  Tue Dec 21 10:13:11 2010
From: 176047528 at qq.com (=?gbk?B?0qa71A==?=)
Date: Tue, 21 Dec 2010 18:13:11 +0800
Subject: [rabbitmq-discuss] |Spam| Question about  the  message rates
Message-ID: <tencent_16AD40026045A0E16391D791@qq.com>

hi guys,
  
 When i do a stress test in my local server,  the server, the productor and the customer run in the same machine.
  
 I found that when the publish is stoped, the rates of message get become very rapid, that i monitor with the website http://localhost:55672/mgmt/.  Someone can tell me the reason about this situation? 
  
  
 thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101221/4aef17a9/attachment.htm>

From adamka at dgt.com.pl  Tue Dec 21 10:18:25 2010
From: adamka at dgt.com.pl (Adam Kaminiecki)
Date: Tue, 21 Dec 2010 11:18:25 +0100
Subject: [rabbitmq-discuss] |Spam| Question about  the  message rates
In-Reply-To: <tencent_16AD40026045A0E16391D791@qq.com>
References: <tencent_16AD40026045A0E16391D791@qq.com>
Message-ID: <4D107EF1.8050400@dgt.com.pl>

I think it can depends from exchange typ which you are using.
Fanout is the fastest all other need to mach key to queues...

I hope this help.

Regards,
Adam

W dniu 2010-12-21 11:13, ???? pisze:
> hi guys,
> When i do a stress test in my local server, the server, the productor 
> and the customer run in the same machine.
> I found that when the publish is stoped, the rates of message get 
> become very rapid, that i monitor with the website 
> http://localhost:55672/mgmt/. Someone can tell me the reason about 
> this situation?
> thanks.
>
> -- 
> This message has been scanned for viruses and
> dangerous content by *MailScanner* <http://www.mailscanner.info/>, and is
> believed to be clean.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-- 
This message has been scanned for viruses and
dangerous content by MailScanner, and is
believed to be clean.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101221/892b04e0/attachment.htm>

From simon at rabbitmq.com  Tue Dec 21 11:45:13 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 21 Dec 2010 11:45:13 +0000
Subject: [rabbitmq-discuss] Problem when hitting /api/queues in rabbitmq
 management API
In-Reply-To: <AANLkTi=5bhV5s_u-Dyw4uYF_w0E2+h0Gv1OCFMgthw2X@mail.gmail.com>
References: <AANLkTi=5bhV5s_u-Dyw4uYF_w0E2+h0Gv1OCFMgthw2X@mail.gmail.com>
Message-ID: <4D109349.6050404@rabbitmq.com>

On 21/12/10 00:46, andrew chase wrote:
> I'm not sure whether I should be asking this question here, or if
> there's a different path for communicating problems with the
> rabbitmq-management plugin. I thought about opening an issue via
> github, but it looks like the rabbitmq-managment committers are
> already using mercurial for ticket tracking.

Hi Andrew. The rabbitmq-management committers are the RabbitMQ 
committers, so here is the right place :)

> I have been really impressed with the management plugin, however, I am
> having problems with making GET requests to the "/apis/queues" route.
> When requesting that path I get back a 500 Internal server error. In
> the rabbitmq log file the error is being logged as:
>
> =ERROR REPORT==== 20-Dec-2010::16:21:58 ===
> webmachine error: path="/api/queues"
> {error,{exit,{json_encode,{bad_term,<0.16116.0>}},

Hmm. Looks like you found a bug. Are you using exclusive consumers by 
any chance?

Could you try replacing your rabbitmq-management-2.2.0.ez with

http://www.rabbitmq.com/releases/plugins/v2.2.0/rabbitmq-management-2.2.0-exclusive-consumer-fix.ez

and see if that fixes the problem?

> Also, I'm running Erlang R13B01. Could that be the problem?

No, R13B01 should be OK.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From matthew at rabbitmq.com  Tue Dec 21 11:56:37 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 21 Dec 2010 11:56:37 +0000
Subject: [rabbitmq-discuss] RabbitMQ 2.0 broker crashes
In-Reply-To: <AANLkTi=vB9PmwZNnfbV85JTY1ioWP1upLOCPrRmYKrHF@mail.gmail.com>
References: <AANLkTi=K62vn+tue35MfHyGzjpbmNxOJrNnkkzP5=nF2@mail.gmail.com>
	<20101220133534.GH18077@rabbitmq.com>
	<17C24E87-C4CE-43DA-9B2F-4AD195F750F5@npcinternational.com>
	<AANLkTik0=cQFX87LmcW0KGARZesD6cD4Rz683q=Ni9U_@mail.gmail.com>
	<20101220182758.GO18077@rabbitmq.com>
	<AANLkTi=vB9PmwZNnfbV85JTY1ioWP1upLOCPrRmYKrHF@mail.gmail.com>
Message-ID: <20101221115637.GP18077@rabbitmq.com>

Hi Scott,

On Tue, Dec 21, 2010 at 09:33:30AM +0000, Scott Dupoy wrote:
> Making the assumption that we can't switch to a unix/linux distribution, is
> it possible to change the size at which the *.rdq file rolls?  If this is
> possible then at least we can (further) reduce the risk of a failure.

Yup, edit your rabbitmq.config file. You want to add a stanza including
{msg_store_file_size_limit, 16777216}. 16777216 is the default and is
16MB. You can reduce this as much as you'd like but if you make it too
small then you'll find performance starts to drop off. The minimum
rabbitmq.config file with this in is:

[{rabbit, [{msg_store_file_size_limit, 16777216}]}].

Note the trailing . is essential. According to
http://www.rabbitmq.com/install.html#configfile, under Windows, the
config file might be found in %APPDATA%\RabbitMQ\rabbitmq.config

Best wishes,

Matthew

From Scott at altispartners.com  Tue Dec 21 12:15:47 2010
From: Scott at altispartners.com (Scott Dupoy)
Date: Tue, 21 Dec 2010 12:15:47 +0000
Subject: [rabbitmq-discuss] RabbitMQ 2.0 broker crashes
In-Reply-To: <20101221115637.GP18077@rabbitmq.com>
References: <AANLkTi=K62vn+tue35MfHyGzjpbmNxOJrNnkkzP5=nF2@mail.gmail.com>
	<20101220133534.GH18077@rabbitmq.com>
	<17C24E87-C4CE-43DA-9B2F-4AD195F750F5@npcinternational.com>
	<AANLkTik0=cQFX87LmcW0KGARZesD6cD4Rz683q=Ni9U_@mail.gmail.com>
	<20101220182758.GO18077@rabbitmq.com>
	<AANLkTi=vB9PmwZNnfbV85JTY1ioWP1upLOCPrRmYKrHF@mail.gmail.com>
	<20101221115637.GP18077@rabbitmq.com>
Message-ID: <341ABE7319A5F14296A322844570DDF705CE7883C0@JYEXC1.ALTISPARTNERS.local>

Hi Matthew,

Thanks for the configuration details - is it possible to increase the file size limit?  Is there an upper limit?

I've just run my tests against a 2.2.0 broker running on an ubuntu server.  It works fine which provides further evidence supporting your hypothesis.

Would you like me to provide some test code reproducing the crash?

Cheers,
Scott


-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Matthew Sackman
Sent: 21 December 2010 11:57
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] RabbitMQ 2.0 broker crashes

Hi Scott,

On Tue, Dec 21, 2010 at 09:33:30AM +0000, Scott Dupoy wrote:
> Making the assumption that we can't switch to a unix/linux distribution, is
> it possible to change the size at which the *.rdq file rolls?  If this is
> possible then at least we can (further) reduce the risk of a failure.

Yup, edit your rabbitmq.config file. You want to add a stanza including
{msg_store_file_size_limit, 16777216}. 16777216 is the default and is
16MB. You can reduce this as much as you'd like but if you make it too
small then you'll find performance starts to drop off. The minimum
rabbitmq.config file with this in is:

[{rabbit, [{msg_store_file_size_limit, 16777216}]}].

Note the trailing . is essential. According to
http://www.rabbitmq.com/install.html#configfile, under Windows, the
config file might be found in %APPDATA%\RabbitMQ\rabbitmq.config

Best wishes,

Matthew
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

Scott Dupoy | Senior Analyst Programmer
Altis Partners (Jersey) Limited
2 Hill Street | St. Helier | Jersey, JE2 4UA 
t. +44 (0)1534 787 744 | f.  | w. 

Altis Partners (Jersey) Limited - registered with the Jersey Financial Services Commission, CFTC and a member of the NFA.

This email and its contents is issued by Altis Partners Jersey Limited ('APJL') and is for private circulation only.  APJL is registered with the Jersey Financial Services Commission for the conduct of investment business.  The information contained in this email is strictly confidential.  The information and opinions contained in this email are for background purposes only, and do not purport to be full or complete.  Nor does this email constitute investment advice.  APJL is not hereby arranging or agreeing to arrange any transaction in any investment or other undertaking requiring regulatory authorisation. This email does not constitute or form part of any offer to issue or sell, or any solicitation of an offer to subscribe or purchase, any investment nor shall it or the fact of its distribution form the basis of, or be relied on in connection with, any contract therefore.  No representation, warranty, or undertaking, express or limited, is given as to the accuracy or completeness of the information or opinions contained  in this email by any of APJL, its partners or employees and no liability is accepted by such persons for the accuracy or completeness of such information or opinions.  As such, no reliance may be placed on the information and opinions in this email.

This email may contain confidential and/or privileged information.  If you are not the intended recipient or have received this email in error please notify the sender immediately and delete immediately.  Any unauthorised copying, disclosure or distribution of this email is strictly forbidden.
ALTIS-JFSC-NFA
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101221/4eb3f8d1/attachment.htm>

From matthew at rabbitmq.com  Tue Dec 21 12:21:04 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 21 Dec 2010 12:21:04 +0000
Subject: [rabbitmq-discuss] RabbitMQ 2.0 broker crashes
In-Reply-To: <341ABE7319A5F14296A322844570DDF705CE7883C0@JYEXC1.ALTISPARTNERS.local>
References: <AANLkTi=K62vn+tue35MfHyGzjpbmNxOJrNnkkzP5=nF2@mail.gmail.com>
	<20101220133534.GH18077@rabbitmq.com>
	<17C24E87-C4CE-43DA-9B2F-4AD195F750F5@npcinternational.com>
	<AANLkTik0=cQFX87LmcW0KGARZesD6cD4Rz683q=Ni9U_@mail.gmail.com>
	<20101220182758.GO18077@rabbitmq.com>
	<AANLkTi=vB9PmwZNnfbV85JTY1ioWP1upLOCPrRmYKrHF@mail.gmail.com>
	<20101221115637.GP18077@rabbitmq.com>
	<341ABE7319A5F14296A322844570DDF705CE7883C0@JYEXC1.ALTISPARTNERS.local>
Message-ID: <20101221122104.GQ18077@rabbitmq.com>

On Tue, Dec 21, 2010 at 12:15:47PM +0000, Scott Dupoy wrote:
> Thanks for the configuration details - is it possible to increase the file size limit?  Is there an upper limit?

Yup and no. In that order. Though I've no idea what the biggest file
that a 32-bit application under Windows can have open. Note that we
don't mmap, so it shouldn't be an address space issue but certainly I'd
not be surprised if you find you can't push it beyond 2GB.

> I've just run my tests against a 2.2.0 broker running on an ubuntu server.  It works fine which provides further evidence supporting your hypothesis.

Yeah. We've also hammered it to death under Debians and Ubuntus. None of
us develop under Windows and we're lacking a Windows soak testing
environment so I'm not too surprised it's been missed, sadly.

> Would you like me to provide some test code reproducing the crash?

If you have it handy, that'd certainly help, but it's not a code path
that's tricky to hit so don't waste any time on it.

Merry wotsits,

Matthew

From csharp4me at gmail.com  Tue Dec 21 18:46:48 2010
From: csharp4me at gmail.com (Dave Gorman)
Date: Tue, 21 Dec 2010 12:46:48 -0600
Subject: [rabbitmq-discuss] RabbitMQ 2.0 broker crashes
In-Reply-To: <20101221122104.GQ18077@rabbitmq.com>
References: <AANLkTi=K62vn+tue35MfHyGzjpbmNxOJrNnkkzP5=nF2@mail.gmail.com>
	<20101220133534.GH18077@rabbitmq.com>
	<17C24E87-C4CE-43DA-9B2F-4AD195F750F5@npcinternational.com>
	<AANLkTik0=cQFX87LmcW0KGARZesD6cD4Rz683q=Ni9U_@mail.gmail.com>
	<20101220182758.GO18077@rabbitmq.com>
	<AANLkTi=vB9PmwZNnfbV85JTY1ioWP1upLOCPrRmYKrHF@mail.gmail.com>
	<20101221115637.GP18077@rabbitmq.com>
	<341ABE7319A5F14296A322844570DDF705CE7883C0@JYEXC1.ALTISPARTNERS.local>
	<20101221122104.GQ18077@rabbitmq.com>
Message-ID: <AANLkTimpYZx2TEQyE4dKu7QjyKyVWTZMDhJLodj4fQR1@mail.gmail.com>

Hi Matthew,
Do you have any visibility into when the bug could be fixed? Just trying to
schedule a release and the plan was to use windows servers.

thanks and Merry Christmas (not sure what a wotsit is).
: )

-dg

On Tue, Dec 21, 2010 at 6:21 AM, Matthew Sackman <matthew at rabbitmq.com>wrote:

> On Tue, Dec 21, 2010 at 12:15:47PM +0000, Scott Dupoy wrote:
> > Thanks for the configuration details - is it possible to increase the
> file size limit?  Is there an upper limit?
>
> Yup and no. In that order. Though I've no idea what the biggest file
> that a 32-bit application under Windows can have open. Note that we
> don't mmap, so it shouldn't be an address space issue but certainly I'd
> not be surprised if you find you can't push it beyond 2GB.
>
> > I've just run my tests against a 2.2.0 broker running on an ubuntu
> server.  It works fine which provides further evidence supporting your
> hypothesis.
>
> Yeah. We've also hammered it to death under Debians and Ubuntus. None of
> us develop under Windows and we're lacking a Windows soak testing
> environment so I'm not too surprised it's been missed, sadly.
>
> > Would you like me to provide some test code reproducing the crash?
>
> If you have it handy, that'd certainly help, but it's not a code path
> that's tricky to hit so don't waste any time on it.
>
> Merry wotsits,
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101221/760f9b98/attachment.htm>

From vickerto at gmail.com  Tue Dec 21 18:48:17 2010
From: vickerto at gmail.com (vickerto)
Date: Tue, 21 Dec 2010 10:48:17 -0800 (PST)
Subject: [rabbitmq-discuss] properties.headers in Perl client
Message-ID: <5e838b25-b894-4b33-999d-3d37cf8daeff@37g2000prx.googlegroups.com>

I have successfully implemented a messaging system using one of the
PHP clients that I found on the web.  I am currently working on a Perl
counterpart that can send and receive messages to/from the same
system.

The problem that I am running into is that I was successfully able to
use the properties.headers to store some key/value information about
my message in the PHP client, but I have yet to find a Perl client
that actually supports or uses these headers.  Am I missing something
or does nobody actually use these headers in Perl?

Thanks,

Tom

From andrew at glyde.com  Tue Dec 21 19:15:29 2010
From: andrew at glyde.com (andrew chase)
Date: Tue, 21 Dec 2010 11:15:29 -0800
Subject: [rabbitmq-discuss] Problem when hitting /api/queues in rabbitmq
 management API
In-Reply-To: <4D109349.6050404@rabbitmq.com>
References: <AANLkTi=5bhV5s_u-Dyw4uYF_w0E2+h0Gv1OCFMgthw2X@mail.gmail.com>
	<4D109349.6050404@rabbitmq.com>
Message-ID: <AANLkTim44rjOWY3AZL4M8wQBESdgtPP+_Vi2zr8F3cn3@mail.gmail.com>

Sweet! That new .ez file you linked me to worked great.

I was seeing that "api/queues" error even when I didn't have any
consumers attached. However, I'm running the management plugin against
a rabbit in our dev environment where the server is a shared resource
for several developers. It is quite possible that at some point in
development we had an exclusive consumer subscribed to queue.

-Andrew


On Tue, Dec 21, 2010 at 3:45 AM, Simon MacMullen <simon at rabbitmq.com> wrote:
> On 21/12/10 00:46, andrew chase wrote:
>>
>> I'm not sure whether I should be asking this question here, or if
>> there's a different path for communicating problems with the
>> rabbitmq-management plugin. I thought about opening an issue via
>> github, but it looks like the rabbitmq-managment committers are
>> already using mercurial for ticket tracking.
>
> Hi Andrew. The rabbitmq-management committers are the RabbitMQ committers,
> so here is the right place :)
>
>> I have been really impressed with the management plugin, however, I am
>> having problems with making GET requests to the "/apis/queues" route.
>> When requesting that path I get back a 500 Internal server error. In
>> the rabbitmq log file the error is being logged as:
>>
>> =ERROR REPORT==== 20-Dec-2010::16:21:58 ===
>> webmachine error: path="/api/queues"
>> {error,{exit,{json_encode,{bad_term,<0.16116.0>}},
>
> Hmm. Looks like you found a bug. Are you using exclusive consumers by any
> chance?
>
> Could you try replacing your rabbitmq-management-2.2.0.ez with
>
> http://www.rabbitmq.com/releases/plugins/v2.2.0/rabbitmq-management-2.2.0-exclusive-consumer-fix.ez
>
> and see if that fixes the problem?
>
>> Also, I'm running Erlang R13B01. Could that be the problem?
>
> No, R13B01 should be OK.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From david at rabbitmq.com  Tue Dec 21 19:41:15 2010
From: david at rabbitmq.com (David Wragg)
Date: Tue, 21 Dec 2010 19:41:15 +0000
Subject: [rabbitmq-discuss] properties.headers in Perl client
In-Reply-To: <5e838b25-b894-4b33-999d-3d37cf8daeff@37g2000prx.googlegroups.com>
	(vickerto@gmail.com's message of "Tue, 21 Dec 2010 10:48:17 -0800
	(PST)")
References: <5e838b25-b894-4b33-999d-3d37cf8daeff@37g2000prx.googlegroups.com>
Message-ID: <yrv4cd3oukj6s.fsf@dwragg.eng.vmware.com>

Hi Tom,

vickerto <vickerto at gmail.com> writes:
> I have successfully implemented a messaging system using one of the
> PHP clients that I found on the web.  I am currently working on a Perl
> counterpart that can send and receive messages to/from the same
> system.
>
> The problem that I am running into is that I was successfully able to
> use the properties.headers to store some key/value information about
> my message in the PHP client, but I have yet to find a Perl client
> that actually supports or uses these headers.  Am I missing something
> or does nobody actually use these headers in Perl?

Not all AMQP applications use the message headers, so it's plausible
that no-one has yet bothered to add support to the Perl clients.  Though
it would be a fairly significant omission, given that the headers are
(potentially) a part of every AMQP message.  I'm not aware of other
clients that take this short cut.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From vickerto at gmail.com  Tue Dec 21 20:11:41 2010
From: vickerto at gmail.com (vickerto)
Date: Tue, 21 Dec 2010 12:11:41 -0800 (PST)
Subject: [rabbitmq-discuss] properties.headers in Perl client
In-Reply-To: <yrv4cd3oukj6s.fsf@dwragg.eng.vmware.com>
References: <5e838b25-b894-4b33-999d-3d37cf8daeff@37g2000prx.googlegroups.com>
	<yrv4cd3oukj6s.fsf@dwragg.eng.vmware.com>
Message-ID: <acc4cf56-680f-4727-8208-8905d4082277@o11g2000prf.googlegroups.com>

>From what I've seen, most of them just set the headers to an empty
AMQP table with no way of setting them.  I'm taking a look at possibly
updating Net::RabbitMQ (which uses librabbitmq) to accept the headers
and process them, but I'm going to have to dust off the part of my
brain that contains my knowledge of Perl and C :)


On Dec 21, 12:41?pm, David Wragg <da... at rabbitmq.com> wrote:
> Hi Tom,
>
> vickerto <vicke... at gmail.com> writes:
> > I have successfully implemented a messaging system using one of the
> > PHP clients that I found on the web. ?I am currently working on a Perl
> > counterpart that can send and receive messages to/from the same
> > system.
>
> > The problem that I am running into is that I was successfully able to
> > use the properties.headers to store some key/value information about
> > my message in the PHP client, but I have yet to find a Perl client
> > that actually supports or uses these headers. ?Am I missing something
> > or does nobody actually use these headers in Perl?
>
> Not all AMQP applications use the message headers, so it's plausible
> that no-one has yet bothered to add support to the Perl clients. ?Though
> it would be a fairly significant omission, given that the headers are
> (potentially) a part of every AMQP message. ?I'm not aware of other
> clients that take this short cut.
>
> David
>
> --
> David Wragg
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthew at rabbitmq.com  Tue Dec 21 20:11:58 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 21 Dec 2010 20:11:58 +0000
Subject: [rabbitmq-discuss] RabbitMQ 2.0 broker crashes
In-Reply-To: <AANLkTimpYZx2TEQyE4dKu7QjyKyVWTZMDhJLodj4fQR1@mail.gmail.com>
References: <AANLkTi=K62vn+tue35MfHyGzjpbmNxOJrNnkkzP5=nF2@mail.gmail.com>
	<20101220133534.GH18077@rabbitmq.com>
	<17C24E87-C4CE-43DA-9B2F-4AD195F750F5@npcinternational.com>
	<AANLkTik0=cQFX87LmcW0KGARZesD6cD4Rz683q=Ni9U_@mail.gmail.com>
	<20101220182758.GO18077@rabbitmq.com>
	<AANLkTi=vB9PmwZNnfbV85JTY1ioWP1upLOCPrRmYKrHF@mail.gmail.com>
	<20101221115637.GP18077@rabbitmq.com>
	<341ABE7319A5F14296A322844570DDF705CE7883C0@JYEXC1.ALTISPARTNERS.local>
	<20101221122104.GQ18077@rabbitmq.com>
	<AANLkTimpYZx2TEQyE4dKu7QjyKyVWTZMDhJLodj4fQR1@mail.gmail.com>
Message-ID: <20101221201156.GA16081@wellquite.org>

On Tue, Dec 21, 2010 at 12:46:48PM -0600, Dave Gorman wrote:
> Do you have any visibility into when the bug could be fixed? Just trying to
> schedule a release and the plan was to use windows servers.

None whatsoever. We're pretty much all on vacation over christmas so
most likely is mid January. Not quite sure at this point when the next
release will be either so I can't say whether I'd expect it to make that
or not - depends how tricky fixing this turns out to be.

Matthew

From emile at rabbitmq.com  Tue Dec 21 20:47:05 2010
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 21 Dec 2010 20:47:05 +0000
Subject: [rabbitmq-discuss] properties.headers in Perl client
In-Reply-To: <acc4cf56-680f-4727-8208-8905d4082277@o11g2000prf.googlegroups.com>
References: <5e838b25-b894-4b33-999d-3d37cf8daeff@37g2000prx.googlegroups.com>	<yrv4cd3oukj6s.fsf@dwragg.eng.vmware.com>
	<acc4cf56-680f-4727-8208-8905d4082277@o11g2000prf.googlegroups.com>
Message-ID: <4D111249.9030209@rabbitmq.com>

Hi vickerto,

I can confirm that POE::Component::Client::AMQP (by Eric Waters) lets 
you set headers. This works for me:

     $queue->publish($msg,
       {
         headers => { 'key' => 'value'}
       }
     );

Regards

Emile


Op 21/12/2010 20:11, het vickerto geskryf:
>  From what I've seen, most of them just set the headers to an empty
> AMQP table with no way of setting them.  I'm taking a look at possibly
> updating Net::RabbitMQ (which uses librabbitmq) to accept the headers
> and process them, but I'm going to have to dust off the part of my
> brain that contains my knowledge of Perl and C :)
>
>
> On Dec 21, 12:41 pm, David Wragg<da... at rabbitmq.com>  wrote:
>> Hi Tom,
>>
>> vickerto<vicke... at gmail.com>  writes:
>>> I have successfully implemented a messaging system using one of the
>>> PHP clients that I found on the web.  I am currently working on a Perl
>>> counterpart that can send and receive messages to/from the same
>>> system.
>>
>>> The problem that I am running into is that I was successfully able to
>>> use the properties.headers to store some key/value information about
>>> my message in the PHP client, but I have yet to find a Perl client
>>> that actually supports or uses these headers.  Am I missing something
>>> or does nobody actually use these headers in Perl?
>>
>> Not all AMQP applications use the message headers, so it's plausible
>> that no-one has yet bothered to add support to the Perl clients.  Though
>> it would be a fairly significant omission, given that the headers are
>> (potentially) a part of every AMQP message.  I'm not aware of other
>> clients that take this short cut.
>>
>> David

From vickerto at gmail.com  Tue Dec 21 20:51:18 2010
From: vickerto at gmail.com (vickerto)
Date: Tue, 21 Dec 2010 12:51:18 -0800 (PST)
Subject: [rabbitmq-discuss] properties.headers in Perl client
In-Reply-To: <4D111249.9030209@rabbitmq.com>
References: <5e838b25-b894-4b33-999d-3d37cf8daeff@37g2000prx.googlegroups.com>
	<yrv4cd3oukj6s.fsf@dwragg.eng.vmware.com>
	<acc4cf56-680f-4727-8208-8905d4082277@o11g2000prf.googlegroups.com>
	<4D111249.9030209@rabbitmq.com>
Message-ID: <2ca8f3dc-2db9-4663-8f15-b9f2785b9163@v17g2000vbo.googlegroups.com>

Awesome, thanks!  I'll take a look.


On Dec 21, 1:47?pm, Emile Joubert <em... at rabbitmq.com> wrote:
> Hi vickerto,
>
> I can confirm that POE::Component::Client::AMQP (by Eric Waters) lets
> you set headers. This works for me:
>
> ? ? ?$queue->publish($msg,
> ? ? ? ?{
> ? ? ? ? ?headers => { 'key' => 'value'}
> ? ? ? ?}
> ? ? ?);
>
> Regards
>
> Emile
>
> Op 21/12/2010 20:11, het vickerto geskryf:
>
> > ?From what I've seen, most of them just set the headers to an empty
> > AMQP table with no way of setting them. ?I'm taking a look at possibly
> > updating Net::RabbitMQ (which uses librabbitmq) to accept the headers
> > and process them, but I'm going to have to dust off the part of my
> > brain that contains my knowledge of Perl and C :)
>
> > On Dec 21, 12:41 pm, David Wragg<da... at rabbitmq.com> ?wrote:
> >> Hi Tom,
>
> >> vickerto<vicke... at gmail.com> ?writes:
> >>> I have successfully implemented a messaging system using one of the
> >>> PHP clients that I found on the web. ?I am currently working on a Perl
> >>> counterpart that can send and receive messages to/from the same
> >>> system.
>
> >>> The problem that I am running into is that I was successfully able to
> >>> use the properties.headers to store some key/value information about
> >>> my message in the PHP client, but I have yet to find a Perl client
> >>> that actually supports or uses these headers. ?Am I missing something
> >>> or does nobody actually use these headers in Perl?
>
> >> Not all AMQP applications use the message headers, so it's plausible
> >> that no-one has yet bothered to add support to the Perl clients. ?Though
> >> it would be a fairly significant omission, given that the headers are
> >> (potentially) a part of every AMQP message. ?I'm not aware of other
> >> clients that take this short cut.
>
> >> David
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From yoavglazner at gmail.com  Tue Dec 21 21:35:19 2010
From: yoavglazner at gmail.com (yoav glazner)
Date: Tue, 21 Dec 2010 23:35:19 +0200
Subject: [rabbitmq-discuss] RabbitMQ for Master worker with monitoring?
Message-ID: <AANLkTinQLatviUi436==_CHSNfeK10L8_iyczqXJ9E4i@mail.gmail.com>

This is my first post to this list, so Hi!
I'm trying to design a Master/Worker implement-ion with RabbitMQ.
I have a few requierments due to lagacy issues:
* works get very long tasks so they should be able to get ABORT messages
while working,
* no task can be lost
* each task has priority and that priority may change when the task is
already in a queue.
* tasks can be removed from the work queue (user wants to pause/cancel an
operation)
* An client of rabbitMQ can fetch the Pending tasks to know what is the
status of the big operation.

After googling I found out that for priorities I'll need a few work queues,
but will I be able to switch a priority of a task in one transaction?

Any input will be very much welcome,

Many Thanks,

Yoav
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101221/e2779e8c/attachment.htm>

From clegnitto at mozilla.com  Wed Dec 22 00:24:33 2010
From: clegnitto at mozilla.com (Christian Legnitto)
Date: Tue, 21 Dec 2010 16:24:33 -0800
Subject: [rabbitmq-discuss] properties.headers in Perl client
In-Reply-To: <2ca8f3dc-2db9-4663-8f15-b9f2785b9163@v17g2000vbo.googlegroups.com>
References: <5e838b25-b894-4b33-999d-3d37cf8daeff@37g2000prx.googlegroups.com>
	<yrv4cd3oukj6s.fsf@dwragg.eng.vmware.com>
	<acc4cf56-680f-4727-8208-8905d4082277@o11g2000prf.googlegroups.com>
	<4D111249.9030209@rabbitmq.com>
	<2ca8f3dc-2db9-4663-8f15-b9f2785b9163@v17g2000vbo.googlegroups.com>
Message-ID: <97122F59-3B2F-49CE-B638-0631747A2285@mozilla.com>

Net::RabbitFoot lets you set the headers as well. Take a look at how I do it @ https://github.com/LegNeato/bugzilla-push/blob/master/Push/lib/Backend/AMQP.pm#L127 (though I am not sure I actually pass any headers anywhere for that backend).

The code in RabbitFoot is @ https://github.com/cooldaemon/RabbitFoot/blob/master/lib/AnyEvent/RabbitMQ/Channel.pm#L275

Thanks,
Christian


On Dec 21, 2010, at 12:51 PM, vickerto wrote:

> Awesome, thanks!  I'll take a look.
> 
> 
> On Dec 21, 1:47 pm, Emile Joubert <em... at rabbitmq.com> wrote:
>> Hi vickerto,
>> 
>> I can confirm that POE::Component::Client::AMQP (by Eric Waters) lets
>> you set headers. This works for me:
>> 
>>      $queue->publish($msg,
>>        {
>>          headers => { 'key' => 'value'}
>>        }
>>      );
>> 
>> Regards
>> 
>> Emile
>> 
>> Op 21/12/2010 20:11, het vickerto geskryf:
>> 
>>>  From what I've seen, most of them just set the headers to an empty
>>> AMQP table with no way of setting them.  I'm taking a look at possibly
>>> updating Net::RabbitMQ (which uses librabbitmq) to accept the headers
>>> and process them, but I'm going to have to dust off the part of my
>>> brain that contains my knowledge of Perl and C :)
>> 
>>> On Dec 21, 12:41 pm, David Wragg<da... at rabbitmq.com>  wrote:
>>>> Hi Tom,
>> 
>>>> vickerto<vicke... at gmail.com>  writes:
>>>>> I have successfully implemented a messaging system using one of the
>>>>> PHP clients that I found on the web.  I am currently working on a Perl
>>>>> counterpart that can send and receive messages to/from the same
>>>>> system.
>> 
>>>>> The problem that I am running into is that I was successfully able to
>>>>> use the properties.headers to store some key/value information about
>>>>> my message in the PHP client, but I have yet to find a Perl client
>>>>> that actually supports or uses these headers.  Am I missing something
>>>>> or does nobody actually use these headers in Perl?
>> 
>>>> Not all AMQP applications use the message headers, so it's plausible
>>>> that no-one has yet bothered to add support to the Perl clients.  Though
>>>> it would be a fairly significant omission, given that the headers are
>>>> (potentially) a part of every AMQP message.  I'm not aware of other
>>>> clients that take this short cut.
>> 
>>>> David
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From emile at rabbitmq.com  Wed Dec 22 12:10:24 2010
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 22 Dec 2010 12:10:24 +0000
Subject: [rabbitmq-discuss] RabbitMQ for Master worker with monitoring?
In-Reply-To: <AANLkTinQLatviUi436==_CHSNfeK10L8_iyczqXJ9E4i@mail.gmail.com>
References: <AANLkTinQLatviUi436==_CHSNfeK10L8_iyczqXJ9E4i@mail.gmail.com>
Message-ID: <4D11EAB0.5000204@rabbitmq.com>

Hi Yoav,

On 21/12/10 21:35, yoav glazner wrote:
> This is my first post to this list, so Hi!
> I'm trying to design a Master/Worker implement-ion with RabbitMQ.
> I have a few requierments due to lagacy issues:
> * works get very long tasks so they should be able to get ABORT messages
> while working,

You could send updated status information about work items to a 
dedicated status exchange that workers subscribe to in order to obtain 
abort messages or changes in priority. This assumes that tasks are 
interruptible and that workers have multiple threads of control.

> * no task can be lost

The use persistence and transactions is indicated.

> * each task has priority and that priority may change when the task is
> already in a queue.

If the task is stuck in a long queue you might be able to send a cancel 
message via the status exchange and requeue the task at the correct 
priority.

> * tasks can be removed from the work queue (user wants to pause/cancel
> an operation)

Depending on exactly what pausing means, this could be accomplished to 
sending an appropriate message to the status exchange.

> * An client of rabbitMQ can fetch the Pending tasks to know what is the
> status of the big operation.

If you explain what a bit more about your problem I might be able to 
make a suggestion here - what is a big operation?

> After googling I found out that for priorities I'll need a few work
> queues, but will I be able to switch a priority of a task in one
> transaction?

No.



Regards

Emile

From taylste at gmail.com  Wed Dec 22 13:32:41 2010
From: taylste at gmail.com (Steven Taylor)
Date: Wed, 22 Dec 2010 13:32:41 +0000
Subject: [rabbitmq-discuss] Queue / Exchange Purge
Message-ID: <AANLkTimdvf7024gQxJUD6y9j9wFCv85w=fPQNEmMEE1+@mail.gmail.com>

Hi,

is there equivilent to purge queue for an exchange?  If we can't already, it
would be nice to be able to purge with a routing key.  I see
an ExchangeDelete. Perhaps I should delete and then redeclare.

Currently I'm using non-durable queues, and taking down the broker +
restarting it. I just wanted something a little simpler to execute. This is
a test phase request.

thanks,
-Steven
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101222/6fe187c3/attachment.htm>

From taylste at gmail.com  Wed Dec 22 14:37:50 2010
From: taylste at gmail.com (Steven Taylor)
Date: Wed, 22 Dec 2010 14:37:50 +0000
Subject: [rabbitmq-discuss] Queue / Exchange Purge
In-Reply-To: <AANLkTimdvf7024gQxJUD6y9j9wFCv85w=fPQNEmMEE1+@mail.gmail.com>
References: <AANLkTimdvf7024gQxJUD6y9j9wFCv85w=fPQNEmMEE1+@mail.gmail.com>
Message-ID: <AANLkTinXziPGJRefO1g5B8_iFwxAdR5AGMsq1x8ZAU_T@mail.gmail.com>

update:


 code: ch.QueuePurge(queueName,false);



The AMQP operation was interrupted: AMQP close-reason, initiated by Peer,
code=404, text="NOT_FOUND - no queue 'm.w' in vhost '/'", classId=50,
methodId=30, cause=

First off, this error relates to an exchange routing key, so slightly
expected. What wasn't expected was the error message should have had the
right queue name 'm.w.ctr'.  'm.w' is the queue (not bound to an exchange)
that failed earlier when I tried to purge it because it wasn't yet created.

let me try something else...

If I first create the queue 'm.w' and then attempted to purge it, I still
get the same error message as above.

Is anybody else seeing this behaviour?

thanks,
-Steven


On 22 December 2010 13:32, Steven Taylor <taylste at gmail.com> wrote:

> Hi,
>
> is there equivilent to purge queue for an exchange?  If we can't already,
> it would be nice to be able to purge with a routing key.  I see
> an ExchangeDelete. Perhaps I should delete and then redeclare.
>
> Currently I'm using non-durable queues, and taking down the broker +
> restarting it. I just wanted something a little simpler to execute. This is
> a test phase request.
>
> thanks,
> -Steven
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101222/a87b9970/attachment.htm>

From alexandru at rabbitmq.com  Wed Dec 22 15:04:50 2010
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Wed, 22 Dec 2010 17:04:50 +0200
Subject: [rabbitmq-discuss] Queue / Exchange Purge
In-Reply-To: <AANLkTinXziPGJRefO1g5B8_iFwxAdR5AGMsq1x8ZAU_T@mail.gmail.com>
References: <AANLkTimdvf7024gQxJUD6y9j9wFCv85w=fPQNEmMEE1+@mail.gmail.com>
	<AANLkTinXziPGJRefO1g5B8_iFwxAdR5AGMsq1x8ZAU_T@mail.gmail.com>
Message-ID: <20101222150450.GB2297@dakota>

Hi,

Using our .NET client, declaring a queue, then immediately purging it
works as expected.

Could you supply the code that's causing the problem?

Cheers,
Alex

On Wed, Dec 22, 2010 at 02:37:50PM +0000, Steven Taylor wrote:
> update:
> 
> 
>  code: ch.QueuePurge(queueName,false);
> 
> 
> 
> The AMQP operation was interrupted: AMQP close-reason, initiated by Peer,
> code=404, text="NOT_FOUND - no queue 'm.w' in vhost '/'", classId=50,
> methodId=30, cause=
> 
> First off, this error relates to an exchange routing key, so slightly
> expected. What wasn't expected was the error message should have had the
> right queue name 'm.w.ctr'.  'm.w' is the queue (not bound to an exchange)
> that failed earlier when I tried to purge it because it wasn't yet created.
> 
> let me try something else...
> 
> If I first create the queue 'm.w' and then attempted to purge it, I still
> get the same error message as above.
> 
> Is anybody else seeing this behaviour?
> 
> thanks,
> -Steven
> 
> 
> On 22 December 2010 13:32, Steven Taylor <taylste at gmail.com> wrote:
> 
> > Hi,
> >
> > is there equivilent to purge queue for an exchange?  If we can't already,
> > it would be nice to be able to purge with a routing key.  I see
> > an ExchangeDelete. Perhaps I should delete and then redeclare.
> >
> > Currently I'm using non-durable queues, and taking down the broker +
> > restarting it. I just wanted something a little simpler to execute. This is
> > a test phase request.
> >
> > thanks,
> > -Steven
> >

> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From alexandru at rabbitmq.com  Wed Dec 22 14:51:31 2010
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Wed, 22 Dec 2010 16:51:31 +0200
Subject: [rabbitmq-discuss] Queue / Exchange Purge
In-Reply-To: <AANLkTimdvf7024gQxJUD6y9j9wFCv85w=fPQNEmMEE1+@mail.gmail.com>
References: <AANLkTimdvf7024gQxJUD6y9j9wFCv85w=fPQNEmMEE1+@mail.gmail.com>
Message-ID: <20101222145131.GA2297@dakota>

Hi Steven,

Exchanges are just message routers.  You publish messages to them, and
they route the messages to queues immediately, based on the routing
keys.  Exchanges *never* hold messages, so purging them doesn't really
make sense.

What are you trying to achieve?

Cheers,
Alex

On Wed, Dec 22, 2010 at 01:32:41PM +0000, Steven Taylor wrote:
> Hi,
> 
> is there equivilent to purge queue for an exchange?  If we can't already, it
> would be nice to be able to purge with a routing key.  I see
> an ExchangeDelete. Perhaps I should delete and then redeclare.
> 
> Currently I'm using non-durable queues, and taking down the broker +
> restarting it. I just wanted something a little simpler to execute. This is
> a test phase request.
> 
> thanks,
> -Steven

> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From vickerto at gmail.com  Wed Dec 22 16:01:43 2010
From: vickerto at gmail.com (vickerto)
Date: Wed, 22 Dec 2010 08:01:43 -0800 (PST)
Subject: [rabbitmq-discuss] properties.headers in Perl client
In-Reply-To: <97122F59-3B2F-49CE-B638-0631747A2285@mozilla.com>
References: <5e838b25-b894-4b33-999d-3d37cf8daeff@37g2000prx.googlegroups.com>
	<yrv4cd3oukj6s.fsf@dwragg.eng.vmware.com>
	<acc4cf56-680f-4727-8208-8905d4082277@o11g2000prf.googlegroups.com>
	<4D111249.9030209@rabbitmq.com>
	<2ca8f3dc-2db9-4663-8f15-b9f2785b9163@v17g2000vbo.googlegroups.com>
	<97122F59-3B2F-49CE-B638-0631747A2285@mozilla.com>
Message-ID: <6019bfef-5e60-4a09-a493-e4bcce66a92c@g26g2000vba.googlegroups.com>

Thanks for the reply.  I started taking a look at Net::RabbitFoot a
couple of days ago.  The only issue with it and with
POE::Component::Client::AMQP is that both have a ton of dependencies.
I'm trying to find something as lightweight as possible.  I'll keep
plugging away.  Thanks!

Tom


On Dec 21, 5:24?pm, Christian Legnitto <clegni... at mozilla.com> wrote:
> Net::RabbitFoot lets you set the headers as well. Take a look at how I do it @https://github.com/LegNeato/bugzilla-push/blob/master/Push/lib/Backen...(though I am not sure I actually pass any headers anywhere for that backend).
>
> The code in RabbitFoot is @https://github.com/cooldaemon/RabbitFoot/blob/master/lib/AnyEvent/Rab...
>
> Thanks,
> Christian
>
> On Dec 21, 2010, at 12:51 PM, vickerto wrote:
>
>
>
> > Awesome, thanks! ?I'll take a look.
>
> > On Dec 21, 1:47 pm, Emile Joubert <em... at rabbitmq.com> wrote:
> >> Hi vickerto,
>
> >> I can confirm that POE::Component::Client::AMQP (by Eric Waters) lets
> >> you set headers. This works for me:
>
> >> ? ? ?$queue->publish($msg,
> >> ? ? ? ?{
> >> ? ? ? ? ?headers => { 'key' => 'value'}
> >> ? ? ? ?}
> >> ? ? ?);
>
> >> Regards
>
> >> Emile
>
> >> Op 21/12/2010 20:11, het vickerto geskryf:
>
> >>> ?From what I've seen, most of them just set the headers to an empty
> >>> AMQP table with no way of setting them. ?I'm taking a look at possibly
> >>> updating Net::RabbitMQ (which uses librabbitmq) to accept the headers
> >>> and process them, but I'm going to have to dust off the part of my
> >>> brain that contains my knowledge of Perl and C :)
>
> >>> On Dec 21, 12:41 pm, David Wragg<da... at rabbitmq.com> ?wrote:
> >>>> Hi Tom,
>
> >>>> vickerto<vicke... at gmail.com> ?writes:
> >>>>> I have successfully implemented a messaging system using one of the
> >>>>> PHP clients that I found on the web. ?I am currently working on a Perl
> >>>>> counterpart that can send and receive messages to/from the same
> >>>>> system.
>
> >>>>> The problem that I am running into is that I was successfully able to
> >>>>> use the properties.headers to store some key/value information about
> >>>>> my message in the PHP client, but I have yet to find a Perl client
> >>>>> that actually supports or uses these headers. ?Am I missing something
> >>>>> or does nobody actually use these headers in Perl?
>
> >>>> Not all AMQP applications use the message headers, so it's plausible
> >>>> that no-one has yet bothered to add support to the Perl clients. ?Though
> >>>> it would be a fairly significant omission, given that the headers are
> >>>> (potentially) a part of every AMQP message. ?I'm not aware of other
> >>>> clients that take this short cut.
>
> >>>> David
>
> >> _______________________________________________
> >> rabbitmq-discuss mailing list
> >> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From henrik at beepsend.se  Wed Dec 22 16:42:12 2010
From: henrik at beepsend.se (Henrik Abrahamsson)
Date: Wed, 22 Dec 2010 17:42:12 +0100
Subject: [rabbitmq-discuss] Execution hangs when redeclaring queue
Message-ID: <AANLkTimz3XKgCrXsd9BORxamawnTkG0_T15KA+JEh0Aw@mail.gmail.com>

Hello,

I have a cluster set up of two disc nodes with a durable exchange e and a
non-durable queue q.

My failover mechanism for my listener works like this: when connection to
node1 goes down, connect to node2 and redeclare the queue q.

But when testing this by restarting the rabbitmq node1, the execution hangs
when redeclaring q on node2. Why does this happen?

I'm using the java client and rabbitmq 2.2.0.

/Henrik
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101222/a87cd0d0/attachment.htm>

From matthew at rabbitmq.com  Wed Dec 22 16:52:56 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 22 Dec 2010 16:52:56 +0000
Subject: [rabbitmq-discuss] Execution hangs when redeclaring queue
In-Reply-To: <AANLkTimz3XKgCrXsd9BORxamawnTkG0_T15KA+JEh0Aw@mail.gmail.com>
References: <AANLkTimz3XKgCrXsd9BORxamawnTkG0_T15KA+JEh0Aw@mail.gmail.com>
Message-ID: <20101222165254.GA22090@wellquite.org>

On Wed, Dec 22, 2010 at 05:42:12PM +0100, Henrik Abrahamsson wrote:
> My failover mechanism for my listener works like this: when connection to
> node1 goes down, connect to node2 and redeclare the queue q.

That cannot be done. It should be returning a 404 error and closing the
channel or maybe even the connection... unless the queue is not durable.
If the queue is not declared durable, you should be ok.

> But when testing this by restarting the rabbitmq node1, the execution hangs
> when redeclaring q on node2. Why does this happen?

It shouldn't do. Is there anything in the logs for Rabbit?

Matthew

From henrik at beepsend.se  Wed Dec 22 17:05:05 2010
From: henrik at beepsend.se (Henrik Abrahamsson)
Date: Wed, 22 Dec 2010 18:05:05 +0100
Subject: [rabbitmq-discuss] Execution hangs when redeclaring queue
In-Reply-To: <20101222165254.GA22090@wellquite.org>
References: <AANLkTimz3XKgCrXsd9BORxamawnTkG0_T15KA+JEh0Aw@mail.gmail.com>
	<20101222165254.GA22090@wellquite.org>
Message-ID: <AANLkTikgMvtCw4FD9Qx_xn-p_9=_Jsp1eG4T6e4xQm6Y@mail.gmail.com>

2010/12/22 Matthew Sackman <matthew at rabbitmq.com>

> On Wed, Dec 22, 2010 at 05:42:12PM +0100, Henrik Abrahamsson wrote:
> > My failover mechanism for my listener works like this: when connection to
> > node1 goes down, connect to node2 and redeclare the queue q.
>
> That cannot be done. It should be returning a 404 error and closing the
> channel or maybe even the connection... unless the queue is not durable.
> If the queue is not declared durable, you should be ok.
>

It is a non-durable queue.

/Henrik
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101222/1cb050c6/attachment.htm>

From emile at rabbitmq.com  Wed Dec 22 17:41:30 2010
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 22 Dec 2010 17:41:30 +0000
Subject: [rabbitmq-discuss] Question about Connections and Channels
In-Reply-To: <AANLkTik2ghtmtT_hJ-eNb46uEJ6udpopQ6gnmHKFsu7R@mail.gmail.com>
References: <AANLkTik2ghtmtT_hJ-eNb46uEJ6udpopQ6gnmHKFsu7R@mail.gmail.com>
Message-ID: <4D12384A.3040103@rabbitmq.com>


Hi Thadeu,

Your project sounds interesting. If I understand your question correctly 
you want to know if you should be using one connection with many 
channels, or many connections each with a single channel.

A possibly relevant consideration is that if the broker needs to apply 
backpressure because of an overactive producer then all the channels 
sharing a connection with that producer will be blocked. Channels that 
can't tolerate this risk should have a connection to themselves. For the 
same reason you may want to separate producers and consumers to use 
different connections.

I would expect it to be more convenient for you to have an AMQP client 
in each JVM and therefore use a connection per JVM. AMQP connections are 
cheap resources and you need not try to conserve them. Brokers with tens 
of thousands of connections are not unheard of.

On 19/12/10 13:20, Thadeu Russo wrote:
> Hi,
>
> I need to architect a Java application using rabbitmq as its message
> broker. It is a distributed application and the message broker will play
> the role of connect the JVMs. Basically, each JVM has sets of objects
> (currently they are grouped by host:port) that can change messages to
> other objects in other groups in other virtual machines (there is a 1:1
> bi-directional relationship between groups of objects in different JVMs).
> The idea of use the broker is to avoid the number of tcp ports I have to
> open and also to take advantage of the message delivery guaranties.
>
> The design is simple: each group of objects will have an exchange and 2
> queues (incoming and outcoming) to change messages.
>
> I would like to know if you guys advise the following configuration
> regarding rabbitmq:
>
> 1- Have 1 connection per JVM
> 2- Have multiple channels to that connection. Each channel will be
> associated with those 2 queues
>
> What is concerning me is: the number of sends/receives per channel is
> high (about 5k/second). Should I have multiple connections (like a
> pool), or it is ok to use just 1 connection? If I have a pool of
> connections, I understand they will share the same tcp port, and I could
> not see any difference in using a single Connection.

The broker port will be same for each of multiple connections, but the 
peer port will typically be random. The difference is that connections 
with a single channel can fail and block without affecting other 
connections.

Regards

Emile

From taylste at gmail.com  Wed Dec 22 18:35:08 2010
From: taylste at gmail.com (Steven Taylor)
Date: Wed, 22 Dec 2010 18:35:08 +0000
Subject: [rabbitmq-discuss] Queue / Exchange Purge
In-Reply-To: <20101222150450.GB2297@dakota>
References: <AANLkTimdvf7024gQxJUD6y9j9wFCv85w=fPQNEmMEE1+@mail.gmail.com>
	<AANLkTinXziPGJRefO1g5B8_iFwxAdR5AGMsq1x8ZAU_T@mail.gmail.com>
	<20101222150450.GB2297@dakota>
Message-ID: <AANLkTinrw1RpGOtRC+csCjrJyphUAxTu+Z2L-p=og3K5@mail.gmail.com>

Hi Alexander,

the situation is where client connects, publishes, and disconnects. 2nd
client comes along to consume message, and fails in some task it tries to do
on the data (i.e. message is returned to the queue). 3rd client intervenes
(i.e. me manually during test phase with a little script), and wants to
clear out all messages that are hanging around on the broker.

Your test sounds like purge works for the 1st client in the above example,
but not for the 3rd.

Probably I'm not understanding what you intended purge for. Could you help
me out with this scenario?

thanks,
-Steven

On 22 December 2010 15:04, Alexandru Scvor?ov <alexandru at rabbitmq.com>wrote:

> Hi,
>
> Using our .NET client, declaring a queue, then immediately purging it
> works as expected.
>
> Could you supply the code that's causing the problem?
>
> Cheers,
> Alex
>
> On Wed, Dec 22, 2010 at 02:37:50PM +0000, Steven Taylor wrote:
> > update:
> >
> >
> >  code: ch.QueuePurge(queueName,false);
> >
> >
> >
> > The AMQP operation was interrupted: AMQP close-reason, initiated by Peer,
> > code=404, text="NOT_FOUND - no queue 'm.w' in vhost '/'", classId=50,
> > methodId=30, cause=
> >
> > First off, this error relates to an exchange routing key, so slightly
> > expected. What wasn't expected was the error message should have had the
> > right queue name 'm.w.ctr'.  'm.w' is the queue (not bound to an
> exchange)
> > that failed earlier when I tried to purge it because it wasn't yet
> created.
> >
> > let me try something else...
> >
> > If I first create the queue 'm.w' and then attempted to purge it, I still
> > get the same error message as above.
> >
> > Is anybody else seeing this behaviour?
> >
> > thanks,
> > -Steven
> >
> >
> > On 22 December 2010 13:32, Steven Taylor <taylste at gmail.com> wrote:
> >
> > > Hi,
> > >
> > > is there equivilent to purge queue for an exchange?  If we can't
> already,
> > > it would be nice to be able to purge with a routing key.  I see
> > > an ExchangeDelete. Perhaps I should delete and then redeclare.
> > >
> > > Currently I'm using non-durable queues, and taking down the broker +
> > > restarting it. I just wanted something a little simpler to execute.
> This is
> > > a test phase request.
> > >
> > > thanks,
> > > -Steven
> > >
>
>  > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101222/a739419d/attachment.htm>

From clegnitto at mozilla.com  Wed Dec 22 19:10:17 2010
From: clegnitto at mozilla.com (Christian Legnitto)
Date: Wed, 22 Dec 2010 11:10:17 -0800
Subject: [rabbitmq-discuss] properties.headers in Perl client
In-Reply-To: <6019bfef-5e60-4a09-a493-e4bcce66a92c@g26g2000vba.googlegroups.com>
References: <5e838b25-b894-4b33-999d-3d37cf8daeff@37g2000prx.googlegroups.com>
	<yrv4cd3oukj6s.fsf@dwragg.eng.vmware.com>
	<acc4cf56-680f-4727-8208-8905d4082277@o11g2000prf.googlegroups.com>
	<4D111249.9030209@rabbitmq.com>
	<2ca8f3dc-2db9-4663-8f15-b9f2785b9163@v17g2000vbo.googlegroups.com>
	<97122F59-3B2F-49CE-B638-0631747A2285@mozilla.com>
	<6019bfef-5e60-4a09-a493-e4bcce66a92c@g26g2000vba.googlegroups.com>
Message-ID: <9C83EB46-5FB3-4ED5-9F2F-0256EF76F92E@mozilla.com>

FWIW Net:RabbitFoot is the lightest one I found (though that may have changed as I think there is a AMQP::Simple or somesuch now). Also, I believe RabbitFoot is in cpan so it's pretty trivial to get all the dependencies afaik.

Christian

On Dec 22, 2010, at 8:01 AM, vickerto wrote:

> Thanks for the reply.  I started taking a look at Net::RabbitFoot a
> couple of days ago.  The only issue with it and with
> POE::Component::Client::AMQP is that both have a ton of dependencies.
> I'm trying to find something as lightweight as possible.  I'll keep
> plugging away.  Thanks!
> 
> Tom
> 
> 
> On Dec 21, 5:24 pm, Christian Legnitto <clegni... at mozilla.com> wrote:
>> Net::RabbitFoot lets you set the headers as well. Take a look at how I do it @https://github.com/LegNeato/bugzilla-push/blob/master/Push/lib/Backen...(though I am not sure I actually pass any headers anywhere for that backend).
>> 
>> The code in RabbitFoot is @https://github.com/cooldaemon/RabbitFoot/blob/master/lib/AnyEvent/Rab...
>> 
>> Thanks,
>> Christian
>> 
>> On Dec 21, 2010, at 12:51 PM, vickerto wrote:
>> 
>> 
>> 
>>> Awesome, thanks!  I'll take a look.
>> 
>>> On Dec 21, 1:47 pm, Emile Joubert <em... at rabbitmq.com> wrote:
>>>> Hi vickerto,
>> 
>>>> I can confirm that POE::Component::Client::AMQP (by Eric Waters) lets
>>>> you set headers. This works for me:
>> 
>>>>      $queue->publish($msg,
>>>>        {
>>>>          headers => { 'key' => 'value'}
>>>>        }
>>>>      );
>> 
>>>> Regards
>> 
>>>> Emile
>> 
>>>> Op 21/12/2010 20:11, het vickerto geskryf:
>> 
>>>>>  From what I've seen, most of them just set the headers to an empty
>>>>> AMQP table with no way of setting them.  I'm taking a look at possibly
>>>>> updating Net::RabbitMQ (which uses librabbitmq) to accept the headers
>>>>> and process them, but I'm going to have to dust off the part of my
>>>>> brain that contains my knowledge of Perl and C :)
>> 
>>>>> On Dec 21, 12:41 pm, David Wragg<da... at rabbitmq.com>  wrote:
>>>>>> Hi Tom,
>> 
>>>>>> vickerto<vicke... at gmail.com>  writes:
>>>>>>> I have successfully implemented a messaging system using one of the
>>>>>>> PHP clients that I found on the web.  I am currently working on a Perl
>>>>>>> counterpart that can send and receive messages to/from the same
>>>>>>> system.
>> 
>>>>>>> The problem that I am running into is that I was successfully able to
>>>>>>> use the properties.headers to store some key/value information about
>>>>>>> my message in the PHP client, but I have yet to find a Perl client
>>>>>>> that actually supports or uses these headers.  Am I missing something
>>>>>>> or does nobody actually use these headers in Perl?
>> 
>>>>>> Not all AMQP applications use the message headers, so it's plausible
>>>>>> that no-one has yet bothered to add support to the Perl clients.  Though
>>>>>> it would be a fairly significant omission, given that the headers are
>>>>>> (potentially) a part of every AMQP message.  I'm not aware of other
>>>>>> clients that take this short cut.
>> 
>>>>>> David
>> 
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-disc... at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From alexandru at rabbitmq.com  Wed Dec 22 19:20:47 2010
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Wed, 22 Dec 2010 21:20:47 +0200
Subject: [rabbitmq-discuss] Queue / Exchange Purge
In-Reply-To: <AANLkTinrw1RpGOtRC+csCjrJyphUAxTu+Z2L-p=og3K5@mail.gmail.com>
References: <AANLkTimdvf7024gQxJUD6y9j9wFCv85w=fPQNEmMEE1+@mail.gmail.com>
	<AANLkTinXziPGJRefO1g5B8_iFwxAdR5AGMsq1x8ZAU_T@mail.gmail.com>
	<20101222150450.GB2297@dakota>
	<AANLkTinrw1RpGOtRC+csCjrJyphUAxTu+Z2L-p=og3K5@mail.gmail.com>
Message-ID: <20101222192047.GC2297@dakota>

Hi Steven,

So, first client connects and publishes, second client connects and
doesn't get any message (fails to ack), third client connects and purges
the queue:

public static int Main(string[] args) {
    ConnectionFactory cf = new ConnectionFactory();
    string QUEUE_NAME = "magic";

    using (IConnection conn = cf.CreateConnection()) {
	using (IModel ch = conn.CreateModel()) {
	    ch.QueueDeclare(QUEUE_NAME, false, true, false, false, false, null);
	    IBasicProperties props = ch.CreateBasicProperties();
	    props.SetPersistent(true);
	    ch.BasicPublish("", QUEUE_NAME, props, Encoding.UTF8.GetBytes("Happy Holidays!"));
	}
    }

    using (IConnection conn = cf.CreateConnection()) {
	using (IModel ch = conn.CreateModel()) {
	    ch.BasicGet(QUEUE_NAME, false);
	    //not ack'ing
	}
    }

    using (IConnection conn = cf.CreateConnection()) {
	using (IModel ch = conn.CreateModel()) {
	    uint n = ch.QueuePurge(QUEUE_NAME, false);
	    Console.Write("" + n + " message(s) lost. ):");
	}
    }

    return 0;
}

This works.

Since you're getting 404 errors, I suspect you either: 1) get the queue
name wrong at some point; or 2) declare it at auto-delete, exclusive or
non-durable and then restart the broker.

Does this help?

Cheers,
Alex


On Wed, Dec 22, 2010 at 06:35:08PM +0000, Steven Taylor wrote:
> Hi Alexander,
> 
> the situation is where client connects, publishes, and disconnects. 2nd
> client comes along to consume message, and fails in some task it tries to do
> on the data (i.e. message is returned to the queue). 3rd client intervenes
> (i.e. me manually during test phase with a little script), and wants to
> clear out all messages that are hanging around on the broker.
> 
> Your test sounds like purge works for the 1st client in the above example,
> but not for the 3rd.
> 
> Probably I'm not understanding what you intended purge for. Could you help
> me out with this scenario?
> 
> thanks,
> -Steven
> 
> On 22 December 2010 15:04, Alexandru Scvor?ov <alexandru at rabbitmq.com>wrote:
> 
> > Hi,
> >
> > Using our .NET client, declaring a queue, then immediately purging it
> > works as expected.
> >
> > Could you supply the code that's causing the problem?
> >
> > Cheers,
> > Alex
> >
> > On Wed, Dec 22, 2010 at 02:37:50PM +0000, Steven Taylor wrote:
> > > update:
> > >
> > >
> > >  code: ch.QueuePurge(queueName,false);
> > >
> > >
> > >
> > > The AMQP operation was interrupted: AMQP close-reason, initiated by Peer,
> > > code=404, text="NOT_FOUND - no queue 'm.w' in vhost '/'", classId=50,
> > > methodId=30, cause=
> > >
> > > First off, this error relates to an exchange routing key, so slightly
> > > expected. What wasn't expected was the error message should have had the
> > > right queue name 'm.w.ctr'.  'm.w' is the queue (not bound to an
> > exchange)
> > > that failed earlier when I tried to purge it because it wasn't yet
> > created.
> > >
> > > let me try something else...
> > >
> > > If I first create the queue 'm.w' and then attempted to purge it, I still
> > > get the same error message as above.
> > >
> > > Is anybody else seeing this behaviour?
> > >
> > > thanks,
> > > -Steven
> > >
> > >
> > > On 22 December 2010 13:32, Steven Taylor <taylste at gmail.com> wrote:
> > >
> > > > Hi,
> > > >
> > > > is there equivilent to purge queue for an exchange?  If we can't
> > already,
> > > > it would be nice to be able to purge with a routing key.  I see
> > > > an ExchangeDelete. Perhaps I should delete and then redeclare.
> > > >
> > > > Currently I'm using non-durable queues, and taking down the broker +
> > > > restarting it. I just wanted something a little simpler to execute.
> > This is
> > > > a test phase request.
> > > >
> > > > thanks,
> > > > -Steven
> > > >
> >
> >  > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-discuss at lists.rabbitmq.com
> > > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >

From vickerto at gmail.com  Wed Dec 22 19:33:39 2010
From: vickerto at gmail.com (vickerto)
Date: Wed, 22 Dec 2010 11:33:39 -0800 (PST)
Subject: [rabbitmq-discuss] properties.headers in Perl client
In-Reply-To: <9C83EB46-5FB3-4ED5-9F2F-0256EF76F92E@mozilla.com>
References: <5e838b25-b894-4b33-999d-3d37cf8daeff@37g2000prx.googlegroups.com>
	<yrv4cd3oukj6s.fsf@dwragg.eng.vmware.com>
	<acc4cf56-680f-4727-8208-8905d4082277@o11g2000prf.googlegroups.com>
	<4D111249.9030209@rabbitmq.com>
	<2ca8f3dc-2db9-4663-8f15-b9f2785b9163@v17g2000vbo.googlegroups.com>
	<97122F59-3B2F-49CE-B638-0631747A2285@mozilla.com>
	<6019bfef-5e60-4a09-a493-e4bcce66a92c@g26g2000vba.googlegroups.com>
	<9C83EB46-5FB3-4ED5-9F2F-0256EF76F92E@mozilla.com>
Message-ID: <7bc28892-08c3-4459-844f-14bc82fa2cbf@k30g2000vbn.googlegroups.com>

I tried getting it from CPAN and there were tons of packages that it
wanted to install.  I'm working on a box that has very few packages
installed on it and we are trying to keep it that way.  I'll look at
it again.  Thanks.



On Dec 22, 12:10?pm, Christian Legnitto <clegni... at mozilla.com> wrote:
> FWIW Net:RabbitFoot is the lightest one I found (though that may have changed as I think there is a AMQP::Simple or somesuch now). Also, I believe RabbitFoot is in cpan so it's pretty trivial to get all the dependencies afaik.
>
> Christian
>
> On Dec 22, 2010, at 8:01 AM, vickerto wrote:
>
>
>
> > Thanks for the reply. ?I started taking a look at Net::RabbitFoot a
> > couple of days ago. ?The only issue with it and with
> > POE::Component::Client::AMQP is that both have a ton of dependencies.
> > I'm trying to find something as lightweight as possible. ?I'll keep
> > plugging away. ?Thanks!
>
> > Tom
>
> > On Dec 21, 5:24 pm, Christian Legnitto <clegni... at mozilla.com> wrote:
> >> Net::RabbitFoot lets you set the headers as well. Take a look at how I do it @https://github.com/LegNeato/bugzilla-push/blob/master/Push/lib/Backen...I am not sure I actually pass any headers anywhere for that backend).
>
> >> The code in RabbitFoot is @https://github.com/cooldaemon/RabbitFoot/blob/master/lib/AnyEvent/Rab...
>
> >> Thanks,
> >> Christian
>
> >> On Dec 21, 2010, at 12:51 PM, vickerto wrote:
>
> >>> Awesome, thanks! ?I'll take a look.
>
> >>> On Dec 21, 1:47 pm, Emile Joubert <em... at rabbitmq.com> wrote:
> >>>> Hi vickerto,
>
> >>>> I can confirm that POE::Component::Client::AMQP (by Eric Waters) lets
> >>>> you set headers. This works for me:
>
> >>>> ? ? ?$queue->publish($msg,
> >>>> ? ? ? ?{
> >>>> ? ? ? ? ?headers => { 'key' => 'value'}
> >>>> ? ? ? ?}
> >>>> ? ? ?);
>
> >>>> Regards
>
> >>>> Emile
>
> >>>> Op 21/12/2010 20:11, het vickerto geskryf:
>
> >>>>> ?From what I've seen, most of them just set the headers to an empty
> >>>>> AMQP table with no way of setting them. ?I'm taking a look at possibly
> >>>>> updating Net::RabbitMQ (which uses librabbitmq) to accept the headers
> >>>>> and process them, but I'm going to have to dust off the part of my
> >>>>> brain that contains my knowledge of Perl and C :)
>
> >>>>> On Dec 21, 12:41 pm, David Wragg<da... at rabbitmq.com> ?wrote:
> >>>>>> Hi Tom,
>
> >>>>>> vickerto<vicke... at gmail.com> ?writes:
> >>>>>>> I have successfully implemented a messaging system using one of the
> >>>>>>> PHP clients that I found on the web. ?I am currently working on a Perl
> >>>>>>> counterpart that can send and receive messages to/from the same
> >>>>>>> system.
>
> >>>>>>> The problem that I am running into is that I was successfully able to
> >>>>>>> use the properties.headers to store some key/value information about
> >>>>>>> my message in the PHP client, but I have yet to find a Perl client
> >>>>>>> that actually supports or uses these headers. ?Am I missing something
> >>>>>>> or does nobody actually use these headers in Perl?
>
> >>>>>> Not all AMQP applications use the message headers, so it's plausible
> >>>>>> that no-one has yet bothered to add support to the Perl clients. ?Though
> >>>>>> it would be a fairly significant omission, given that the headers are
> >>>>>> (potentially) a part of every AMQP message. ?I'm not aware of other
> >>>>>> clients that take this short cut.
>
> >>>>>> David
>
> >>>> _______________________________________________
> >>>> rabbitmq-discuss mailing list
> >>>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >>> _______________________________________________
> >>> rabbitmq-discuss mailing list
> >>> rabbitmq-disc... at lists.rabbitmq.com
> >>>https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> >> _______________________________________________
> >> rabbitmq-discuss mailing list
> >> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From vickerto at gmail.com  Wed Dec 22 19:55:05 2010
From: vickerto at gmail.com (vickerto)
Date: Wed, 22 Dec 2010 11:55:05 -0800 (PST)
Subject: [rabbitmq-discuss] properties.headers in Perl client
In-Reply-To: <97122F59-3B2F-49CE-B638-0631747A2285@mozilla.com>
References: <5e838b25-b894-4b33-999d-3d37cf8daeff@37g2000prx.googlegroups.com>
	<yrv4cd3oukj6s.fsf@dwragg.eng.vmware.com>
	<acc4cf56-680f-4727-8208-8905d4082277@o11g2000prf.googlegroups.com>
	<4D111249.9030209@rabbitmq.com>
	<2ca8f3dc-2db9-4663-8f15-b9f2785b9163@v17g2000vbo.googlegroups.com>
	<97122F59-3B2F-49CE-B638-0631747A2285@mozilla.com>
Message-ID: <fb7e8b20-db8c-46eb-af83-680c1ba5c5de@v23g2000vbi.googlegroups.com>

I just looked through RabbitFoot again and it appears that, just like
Net::RabbitMQ, you can't actually set the 'headers' property of the
message headers.  Looking at the code that it uses to create the
header:

sub _header {
    my ($self, $args, $body,) = @_;

    $self->{connection}->_push_write(
        Net::AMQP::Frame::Header->new(
            weight => $args->{weight} || 0,
            body_size => length($body),
            header_frame => Net::AMQP::Protocol::Basic::ContentHeader-
>new(
                content_type => 'application/octet-stream',
                content_encoding => '',
                headers => {},
                delivery_mode => 1,
                priority => 1,
                correlation_id => '',
                expiration => '',
                message_id => '',
                timestamp => time,
                type => '',
                user_id => '',
                app_id => '',
                cluster_id => '',
                %$args,
            ),
        ),
        $self->{id},
    );

    return $self;
}

The 'headers => {}' is the problem.  I need to be able to set this to
my own key/value array, but none of the clients that I have found
actually allow for this.  I can modify it to accept a new argument,
but I was hoping to find a client that I could use out of the box.



On Dec 21, 5:24?pm, Christian Legnitto <clegni... at mozilla.com> wrote:
> Net::RabbitFoot lets you set the headers as well. Take a look at how I do it @https://github.com/LegNeato/bugzilla-push/blob/master/Push/lib/Backen...(though I am not sure I actually pass any headers anywhere for that backend).
>
> The code in RabbitFoot is @https://github.com/cooldaemon/RabbitFoot/blob/master/lib/AnyEvent/Rab...
>
> Thanks,
> Christian
>
> On Dec 21, 2010, at 12:51 PM, vickerto wrote:
>
>
>
> > Awesome, thanks! ?I'll take a look.
>
> > On Dec 21, 1:47 pm, Emile Joubert <em... at rabbitmq.com> wrote:
> >> Hi vickerto,
>
> >> I can confirm that POE::Component::Client::AMQP (by Eric Waters) lets
> >> you set headers. This works for me:
>
> >> ? ? ?$queue->publish($msg,
> >> ? ? ? ?{
> >> ? ? ? ? ?headers => { 'key' => 'value'}
> >> ? ? ? ?}
> >> ? ? ?);
>
> >> Regards
>
> >> Emile
>
> >> Op 21/12/2010 20:11, het vickerto geskryf:
>
> >>> ?From what I've seen, most of them just set the headers to an empty
> >>> AMQP table with no way of setting them. ?I'm taking a look at possibly
> >>> updating Net::RabbitMQ (which uses librabbitmq) to accept the headers
> >>> and process them, but I'm going to have to dust off the part of my
> >>> brain that contains my knowledge of Perl and C :)
>
> >>> On Dec 21, 12:41 pm, David Wragg<da... at rabbitmq.com> ?wrote:
> >>>> Hi Tom,
>
> >>>> vickerto<vicke... at gmail.com> ?writes:
> >>>>> I have successfully implemented a messaging system using one of the
> >>>>> PHP clients that I found on the web. ?I am currently working on a Perl
> >>>>> counterpart that can send and receive messages to/from the same
> >>>>> system.
>
> >>>>> The problem that I am running into is that I was successfully able to
> >>>>> use the properties.headers to store some key/value information about
> >>>>> my message in the PHP client, but I have yet to find a Perl client
> >>>>> that actually supports or uses these headers. ?Am I missing something
> >>>>> or does nobody actually use these headers in Perl?
>
> >>>> Not all AMQP applications use the message headers, so it's plausible
> >>>> that no-one has yet bothered to add support to the Perl clients. ?Though
> >>>> it would be a fairly significant omission, given that the headers are
> >>>> (potentially) a part of every AMQP message. ?I'm not aware of other
> >>>> clients that take this short cut.
>
> >>>> David
>
> >> _______________________________________________
> >> rabbitmq-discuss mailing list
> >> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From yoavglazner at gmail.com  Wed Dec 22 20:24:33 2010
From: yoavglazner at gmail.com (yoav glazner)
Date: Wed, 22 Dec 2010 22:24:33 +0200
Subject: [rabbitmq-discuss] RabbitMQ for Master worker with monitoring?
In-Reply-To: <AANLkTiniykeUyAV70aE+aYsGCC5M_htbvzhRkzGqSSc9@mail.gmail.com>
References: <AANLkTinQLatviUi436==_CHSNfeK10L8_iyczqXJ9E4i@mail.gmail.com>
	<4D11EAB0.5000204@rabbitmq.com>
	<AANLkTiniykeUyAV70aE+aYsGCC5M_htbvzhRkzGqSSc9@mail.gmail.com>
Message-ID: <AANLkTinyugDYobF12DpSpmg+9eK9ZHskei2484tLP0Wc@mail.gmail.com>

On Wed, Dec 22, 2010 at 2:10 PM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi Yoav,
>
>
> On 21/12/10 21:35, yoav glazner wrote:
>
>> This is my first post to this list, so Hi!
>> I'm trying to design a Master/Worker implement-ion with RabbitMQ.
>> I have a few requierments due to lagacy issues:
>> * works get very long tasks so they should be able to get ABORT messages
>> while working,
>>
>
> You could send updated status information about work items to a dedicated
> status exchange that workers subscribe to in order to obtain abort messages
> or changes in priority. This assumes that tasks are interruptible and that
> workers have multiple threads of control.

that's good

>
>
>  * no task can be lost
>>
>
> The use persistence and transactions is indicated.\

yes, I saw that.

>
>

>  * each task has priority and that priority may change when the task is
>> already in a queue.
>>
>
> If the task is stuck in a long queue you might be able to send a cancel
> message via the status exchange and requeue the task at the correct
> priority.


I have no idea what this means :(

>
>
>  * tasks can be removed from the work queue (user wants to pause/cancel
>> an operation)
>>
>
> Depending on exactly what pausing means, this could be accomplished to
> sending an appropriate message to the status exchange.

again, no clue on this, what is the "status exchange"?

>
>
>  * An client of rabbitMQ can fetch the Pending tasks to know what is the
>> status of the big operation.
>>
>
> If you explain what a bit more about your problem I might be able to make a
> suggestion here - what is a big operation?
>
> This big operation is a crypto-calculation on many number, the operation is
devided to many tasks (each can take a few hours), so I want to be able to
know what is the operation status. (I can have a few big operations in the
same time)

>
>  After googling I found out that for priorities I'll need a few work
>> queues, but will I be able to switch a priority of a task in one
>> transaction?
>>
>
> No.
>
ok, but You said:
"If the task is stuck in a long queue you might be able to send a cancel
message via the status exchange and requeue the task at the correct
priority."
so I guess this will be transaction-less?

>
>
>
> Regards
>
> Emile
>

Thanks!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101222/e91cf392/attachment-0001.htm>

From parki at whatevernot.com  Wed Dec 22 20:40:29 2010
From: parki at whatevernot.com (Brian Parkinson)
Date: Wed, 22 Dec 2010 15:40:29 -0500
Subject: [rabbitmq-discuss] Question about C bindings
Message-ID: <49359D67-7ABE-470A-8CC1-A87FE5670F36@whatevernot.com>

Hello:

I have been evaluating RabbitMQ, and am really stoked by what is there - it's all working fine, and integrating into my Java applications is a snap.

We also have to integrate with some services written in C as well as C++, and so the C bindings are essential.

Can anyone out there comment on the state of the C bindings - are they stable enough for use? Does anyone have real world experience?

Any help is appreciated - this looks to be the last missing piece.

Cheers, and thanks.

brian...



From clegnitto at mozilla.com  Wed Dec 22 20:46:01 2010
From: clegnitto at mozilla.com (Christian Legnitto)
Date: Wed, 22 Dec 2010 12:46:01 -0800
Subject: [rabbitmq-discuss] properties.headers in Perl client
In-Reply-To: <fb7e8b20-db8c-46eb-af83-680c1ba5c5de@v23g2000vbi.googlegroups.com>
References: <5e838b25-b894-4b33-999d-3d37cf8daeff@37g2000prx.googlegroups.com>
	<yrv4cd3oukj6s.fsf@dwragg.eng.vmware.com>
	<acc4cf56-680f-4727-8208-8905d4082277@o11g2000prf.googlegroups.com>
	<4D111249.9030209@rabbitmq.com>
	<2ca8f3dc-2db9-4663-8f15-b9f2785b9163@v17g2000vbo.googlegroups.com>
	<97122F59-3B2F-49CE-B638-0631747A2285@mozilla.com>
	<fb7e8b20-db8c-46eb-af83-680c1ba5c5de@v23g2000vbi.googlegroups.com>
Message-ID: <E8D70944-F138-4402-B348-0F8D06CC23FB@mozilla.com>

Ah yes, I forgot I patched that locally and then realized I only needed to use headers for the STOMP backend so I didn't submit a pull request via GitHub. Sorry for providing misleading info.

On Dec 22, 2010, at 11:55 AM, vickerto wrote:

> I just looked through RabbitFoot again and it appears that, just like
> Net::RabbitMQ, you can't actually set the 'headers' property of the
> message headers.  Looking at the code that it uses to create the
> header:
> 
> sub _header {
>    my ($self, $args, $body,) = @_;
> 
>    $self->{connection}->_push_write(
>        Net::AMQP::Frame::Header->new(
>            weight => $args->{weight} || 0,
>            body_size => length($body),
>            header_frame => Net::AMQP::Protocol::Basic::ContentHeader-
>> new(
>                content_type => 'application/octet-stream',
>                content_encoding => '',
>                headers => {},
>                delivery_mode => 1,
>                priority => 1,
>                correlation_id => '',
>                expiration => '',
>                message_id => '',
>                timestamp => time,
>                type => '',
>                user_id => '',
>                app_id => '',
>                cluster_id => '',
>                %$args,
>            ),
>        ),
>        $self->{id},
>    );
> 
>    return $self;
> }
> 
> The 'headers => {}' is the problem.  I need to be able to set this to
> my own key/value array, but none of the clients that I have found
> actually allow for this.  I can modify it to accept a new argument,
> but I was hoping to find a client that I could use out of the box.
> 
> 
> 
> On Dec 21, 5:24 pm, Christian Legnitto <clegni... at mozilla.com> wrote:
>> Net::RabbitFoot lets you set the headers as well. Take a look at how I do it @https://github.com/LegNeato/bugzilla-push/blob/master/Push/lib/Backen...(though I am not sure I actually pass any headers anywhere for that backend).
>> 
>> The code in RabbitFoot is @https://github.com/cooldaemon/RabbitFoot/blob/master/lib/AnyEvent/Rab...
>> 
>> Thanks,
>> Christian
>> 
>> On Dec 21, 2010, at 12:51 PM, vickerto wrote:
>> 
>> 
>> 
>>> Awesome, thanks!  I'll take a look.
>> 
>>> On Dec 21, 1:47 pm, Emile Joubert <em... at rabbitmq.com> wrote:
>>>> Hi vickerto,
>> 
>>>> I can confirm that POE::Component::Client::AMQP (by Eric Waters) lets
>>>> you set headers. This works for me:
>> 
>>>>      $queue->publish($msg,
>>>>        {
>>>>          headers => { 'key' => 'value'}
>>>>        }
>>>>      );
>> 
>>>> Regards
>> 
>>>> Emile
>> 
>>>> Op 21/12/2010 20:11, het vickerto geskryf:
>> 
>>>>>  From what I've seen, most of them just set the headers to an empty
>>>>> AMQP table with no way of setting them.  I'm taking a look at possibly
>>>>> updating Net::RabbitMQ (which uses librabbitmq) to accept the headers
>>>>> and process them, but I'm going to have to dust off the part of my
>>>>> brain that contains my knowledge of Perl and C :)
>> 
>>>>> On Dec 21, 12:41 pm, David Wragg<da... at rabbitmq.com>  wrote:
>>>>>> Hi Tom,
>> 
>>>>>> vickerto<vicke... at gmail.com>  writes:
>>>>>>> I have successfully implemented a messaging system using one of the
>>>>>>> PHP clients that I found on the web.  I am currently working on a Perl
>>>>>>> counterpart that can send and receive messages to/from the same
>>>>>>> system.
>> 
>>>>>>> The problem that I am running into is that I was successfully able to
>>>>>>> use the properties.headers to store some key/value information about
>>>>>>> my message in the PHP client, but I have yet to find a Perl client
>>>>>>> that actually supports or uses these headers.  Am I missing something
>>>>>>> or does nobody actually use these headers in Perl?
>> 
>>>>>> Not all AMQP applications use the message headers, so it's plausible
>>>>>> that no-one has yet bothered to add support to the Perl clients.  Though
>>>>>> it would be a fairly significant omission, given that the headers are
>>>>>> (potentially) a part of every AMQP message.  I'm not aware of other
>>>>>> clients that take this short cut.
>> 
>>>>>> David
>> 
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-disc... at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From clegnitto at mozilla.com  Wed Dec 22 20:50:00 2010
From: clegnitto at mozilla.com (Christian Legnitto)
Date: Wed, 22 Dec 2010 12:50:00 -0800
Subject: [rabbitmq-discuss] RabbitMQ for Master worker with monitoring?
In-Reply-To: <AANLkTinyugDYobF12DpSpmg+9eK9ZHskei2484tLP0Wc@mail.gmail.com>
References: <AANLkTinQLatviUi436==_CHSNfeK10L8_iyczqXJ9E4i@mail.gmail.com>
	<4D11EAB0.5000204@rabbitmq.com>
	<AANLkTiniykeUyAV70aE+aYsGCC5M_htbvzhRkzGqSSc9@mail.gmail.com>
	<AANLkTinyugDYobF12DpSpmg+9eK9ZHskei2484tLP0Wc@mail.gmail.com>
Message-ID: <F4438360-6727-42E8-931A-B31F2BCEAE0A@mozilla.com>

Have you looked into celery? http://celeryproject.org/. You might be able to bolt the additional features you need on top or use it as-is with creative segmenting / driver scripts.


On Dec 22, 2010, at 12:24 PM, yoav glazner wrote:

> 
> On Wed, Dec 22, 2010 at 2:10 PM, Emile Joubert <emile at rabbitmq.com> wrote:
> Hi Yoav,
> 
> 
> On 21/12/10 21:35, yoav glazner wrote:
> This is my first post to this list, so Hi!
> I'm trying to design a Master/Worker implement-ion with RabbitMQ.
> I have a few requierments due to lagacy issues:
> * works get very long tasks so they should be able to get ABORT messages
> while working,
> 
> You could send updated status information about work items to a dedicated status exchange that workers subscribe to in order to obtain abort messages or changes in priority. This assumes that tasks are interruptible and that workers have multiple threads of control.
> that's good 
> 
> 
> * no task can be lost
> 
> The use persistence and transactions is indicated.\
> yes, I saw that. 
>  
> 
> * each task has priority and that priority may change when the task is
> already in a queue.
> 
> If the task is stuck in a long queue you might be able to send a cancel message via the status exchange and requeue the task at the correct priority.
>  
> I have no idea what this means :( 
> 
> 
> * tasks can be removed from the work queue (user wants to pause/cancel
> an operation)
> 
> Depending on exactly what pausing means, this could be accomplished to sending an appropriate message to the status exchange.
> again, no clue on this, what is the "status exchange"? 
> 
> 
> * An client of rabbitMQ can fetch the Pending tasks to know what is the
> status of the big operation.
> 
> If you explain what a bit more about your problem I might be able to make a suggestion here - what is a big operation?
> 
> This big operation is a crypto-calculation on many number, the operation is devided to many tasks (each can take a few hours), so I want to be able to know what is the operation status. (I can have a few big operations in the same time)
> 
> After googling I found out that for priorities I'll need a few work
> queues, but will I be able to switch a priority of a task in one
> transaction?
> 
> No.
> ok, but You said:
> "If the task is stuck in a long queue you might be able to send a cancel message via the status exchange and requeue the task at the correct priority." 
> so I guess this will be transaction-less?
> 
> 
> 
> Regards
> 
> Emile
> 
> Thanks!
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101222/db677851/attachment.htm>

From paul.pearcy at wallst.com  Wed Dec 22 20:59:08 2010
From: paul.pearcy at wallst.com (Paul Pearcy)
Date: Wed, 22 Dec 2010 15:59:08 -0500
Subject: [rabbitmq-discuss] Question about C bindings
In-Reply-To: <49359D67-7ABE-470A-8CC1-A87FE5670F36@whatevernot.com>
References: <49359D67-7ABE-470A-8CC1-A87FE5670F36@whatevernot.com>
Message-ID: <5C3F8D74DE0D8344AF4E68E53DAB10DD05EA0A4C7B@IS-EXCHANGEC101.wsod.local>

I just asked the same question last week. The last message in the thread has details from Alexis.

http://old.nabble.com/Trouble-building-rabbitmq-c-on-windows-to30466433.html

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Brian Parkinson
Sent: Wednesday, December 22, 2010 1:40 PM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: [rabbitmq-discuss] Question about C bindings

Hello:

I have been evaluating RabbitMQ, and am really stoked by what is there - it's all working fine, and integrating into my Java applications is a snap.

We also have to integrate with some services written in C as well as C++, and so the C bindings are essential.

Can anyone out there comment on the state of the C bindings - are they stable enough for use? Does anyone have real world experience?

Any help is appreciated - this looks to be the last missing piece.

Cheers, and thanks.

brian...


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From jesdisciple at gmail.com  Thu Dec 23 02:03:07 2010
From: jesdisciple at gmail.com (Chris)
Date: Wed, 22 Dec 2010 20:03:07 -0600
Subject: [rabbitmq-discuss] Installing RabbitMQ STOMP for PyGoWave
Message-ID: <AANLkTimw95aUFLxPYQ8qG63wYDuXVxOtjKevjgD-yC_=@mail.gmail.com>

Hi there.  I'm following https://wiki.ubuntu.com/PyGoWave-Server (section
"Orbit") and need to know how I can get the RabbitMQ 1.6.0 includes for
STOMP.  In case you have anything else to tell me about my problem, here it
is.  (/usr/lib/erlang/lib exists, but subdirectory rabbitmq_server-1.6.0
does not.)

Thanks,
Chris

$ sudo make
RABBIT_SERVER_INCLUDE_DIR=/usr/lib/erlang/lib/rabbitmq_server-1.6.0/include
erlc -I /usr/lib/erlang/lib/rabbitmq_server-1.6.0/include -I include -o ebin
-Wall +debug_info  src/rabbit_stomp.erl
src/rabbit_stomp.erl:42: can't find include file "rabbit.hrl"
src/rabbit_stomp.erl:43: can't find include file "rabbit_framing.hrl"
src/rabbit_stomp.erl:207: record 'channel.close_ok' undefined
src/rabbit_stomp.erl:222: record 'basic.deliver' undefined
src/rabbit_stomp.erl:226: record content undefined
src/rabbit_stomp.erl:238: variable 'RoutingKey' is unbound
src/rabbit_stomp.erl:239: variable 'Exchange' is unbound
src/rabbit_stomp.erl:243: variable 'DeliveryTag' is unbound
src/rabbit_stomp.erl:244: variable 'ContentType' is unbound
src/rabbit_stomp.erl:245: variable 'ContentEncoding' is unbound
src/rabbit_stomp.erl:246: variable 'ConsumerTag' is unbound
src/rabbit_stomp.erl:250: variable 'Headers' is unbound
src/rabbit_stomp.erl:254: variable 'DeliveryMode' is unbound
src/rabbit_stomp.erl:255: variable 'Priority' is unbound
src/rabbit_stomp.erl:256: variable 'CorrelationId' is unbound
src/rabbit_stomp.erl:257: variable 'ReplyTo' is unbound
src/rabbit_stomp.erl:258: variable 'MessageId' is unbound
src/rabbit_stomp.erl:260: variable 'BodyFragmentsRev' is unbound
src/rabbit_stomp.erl:315: record 'basic.qos_ok' undefined
src/rabbit_stomp.erl:317: record 'basic.qos' undefined
src/rabbit_stomp.erl:353: record content undefined
src/rabbit_stomp.erl:366: record user undefined
src/rabbit_stomp.erl:367: record 'channel.open_ok' undefined
src/rabbit_stomp.erl:368: record 'channel.open' undefined
src/rabbit_stomp.erl:457: record 'P_basic' undefined
src/rabbit_stomp.erl:467: record 'basic.publish' undefined
src/rabbit_stomp.erl:493: record 'basic.ack' undefined
src/rabbit_stomp.erl:532: record 'queue.declare' undefined
src/rabbit_stomp.erl:542: record 'basic.consume' undefined
src/rabbit_stomp.erl:556: record 'queue.bind' undefined
src/rabbit_stomp.erl:591: record 'basic.cancel' undefined
src/rabbit_stomp.erl:596: record 'channel.close' undefined
src/rabbit_stomp.erl:314: Warning: variable 'PrefetchCount' is unused
src/rabbit_stomp.erl:349: Warning: variable 'Body' is unused
src/rabbit_stomp.erl:349: Warning: variable 'Properties' is unused
src/rabbit_stomp.erl:379: Warning: function longstr_field/2 is unused
src/rabbit_stomp.erl:450: Warning: variable 'Headers' is unused
src/rabbit_stomp.erl:452: Warning: variable 'BinH' is unused
src/rabbit_stomp.erl:453: Warning: variable 'IntH' is unused
src/rabbit_stomp.erl:455: Warning: variable 'RoutingKeyStr' is unused
src/rabbit_stomp.erl:456: Warning: variable 'ExchangeStr' is unused
src/rabbit_stomp.erl:491: Warning: variable 'DeliveryTag' is unused
src/rabbit_stomp.erl:515: Warning: variable 'Headers' is unused
src/rabbit_stomp.erl:517: Warning: variable 'AckMode' is unused
src/rabbit_stomp.erl:523: Warning: variable 'ConsumerTag' is unused
src/rabbit_stomp.erl:529: Warning: variable 'Queue' is unused
src/rabbit_stomp.erl:530: Warning: variable 'BoolH' is unused
src/rabbit_stomp.erl:551: Warning: variable 'Exchange' is unused
src/rabbit_stomp.erl:552: Warning: variable 'RoutingKey' is unused
make: *** [ebin/rabbit_stomp.beam] Error 1
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101222/386b1d33/attachment-0001.htm>

From jesdisciple at gmail.com  Thu Dec 23 02:14:39 2010
From: jesdisciple at gmail.com (Chris)
Date: Wed, 22 Dec 2010 20:14:39 -0600
Subject: [rabbitmq-discuss] Installing RabbitMQ STOMP for PyGoWave
In-Reply-To: <AANLkTimw95aUFLxPYQ8qG63wYDuXVxOtjKevjgD-yC_=@mail.gmail.com>
References: <AANLkTimw95aUFLxPYQ8qG63wYDuXVxOtjKevjgD-yC_=@mail.gmail.com>
Message-ID: <AANLkTikqFUyw23kQi1MqvbibtW8FRt1i46akEjwxaOE-@mail.gmail.com>

Follow-up: I should note that I have the rabbitmq-server package, version
1.6.0, installed from the Ubuntu Karmic repos:
http://packages.ubuntu.com/karmic/rabbitmq-server  However I don't see
anywhere to get the includes.

On Wed, Dec 22, 2010 at 8:03 PM, Chris <jesdisciple at gmail.com> wrote:

> Hi there.  I'm following https://wiki.ubuntu.com/PyGoWave-Server (section
> "Orbit") and need to know how I can get the RabbitMQ 1.6.0 includes for
> STOMP.  In case you have anything else to tell me about my problem, here it
> is.  (/usr/lib/erlang/lib exists, but subdirectory rabbitmq_server-1.6.0
> does not.)
>
> Thanks,
> Chris
>
> $ sudo make
> RABBIT_SERVER_INCLUDE_DIR=/usr/lib/erlang/lib/rabbitmq_server-1.6.0/include
> erlc -I /usr/lib/erlang/lib/rabbitmq_server-1.6.0/include -I include -o
> ebin -Wall +debug_info  src/rabbit_stomp.erl
> src/rabbit_stomp.erl:42: can't find include file "rabbit.hrl"
> src/rabbit_stomp.erl:43: can't find include file "rabbit_framing.hrl"
> src/rabbit_stomp.erl:207: record 'channel.close_ok' undefined
> src/rabbit_stomp.erl:222: record 'basic.deliver' undefined
> src/rabbit_stomp.erl:226: record content undefined
> src/rabbit_stomp.erl:238: variable 'RoutingKey' is unbound
> src/rabbit_stomp.erl:239: variable 'Exchange' is unbound
> src/rabbit_stomp.erl:243: variable 'DeliveryTag' is unbound
> src/rabbit_stomp.erl:244: variable 'ContentType' is unbound
> src/rabbit_stomp.erl:245: variable 'ContentEncoding' is unbound
> src/rabbit_stomp.erl:246: variable 'ConsumerTag' is unbound
> src/rabbit_stomp.erl:250: variable 'Headers' is unbound
> src/rabbit_stomp.erl:254: variable 'DeliveryMode' is unbound
> src/rabbit_stomp.erl:255: variable 'Priority' is unbound
> src/rabbit_stomp.erl:256: variable 'CorrelationId' is unbound
> src/rabbit_stomp.erl:257: variable 'ReplyTo' is unbound
> src/rabbit_stomp.erl:258: variable 'MessageId' is unbound
> src/rabbit_stomp.erl:260: variable 'BodyFragmentsRev' is unbound
> src/rabbit_stomp.erl:315: record 'basic.qos_ok' undefined
> src/rabbit_stomp.erl:317: record 'basic.qos' undefined
> src/rabbit_stomp.erl:353: record content undefined
> src/rabbit_stomp.erl:366: record user undefined
> src/rabbit_stomp.erl:367: record 'channel.open_ok' undefined
> src/rabbit_stomp.erl:368: record 'channel.open' undefined
> src/rabbit_stomp.erl:457: record 'P_basic' undefined
> src/rabbit_stomp.erl:467: record 'basic.publish' undefined
> src/rabbit_stomp.erl:493: record 'basic.ack' undefined
> src/rabbit_stomp.erl:532: record 'queue.declare' undefined
> src/rabbit_stomp.erl:542: record 'basic.consume' undefined
> src/rabbit_stomp.erl:556: record 'queue.bind' undefined
> src/rabbit_stomp.erl:591: record 'basic.cancel' undefined
> src/rabbit_stomp.erl:596: record 'channel.close' undefined
> src/rabbit_stomp.erl:314: Warning: variable 'PrefetchCount' is unused
> src/rabbit_stomp.erl:349: Warning: variable 'Body' is unused
> src/rabbit_stomp.erl:349: Warning: variable 'Properties' is unused
> src/rabbit_stomp.erl:379: Warning: function longstr_field/2 is unused
> src/rabbit_stomp.erl:450: Warning: variable 'Headers' is unused
> src/rabbit_stomp.erl:452: Warning: variable 'BinH' is unused
> src/rabbit_stomp.erl:453: Warning: variable 'IntH' is unused
> src/rabbit_stomp.erl:455: Warning: variable 'RoutingKeyStr' is unused
> src/rabbit_stomp.erl:456: Warning: variable 'ExchangeStr' is unused
> src/rabbit_stomp.erl:491: Warning: variable 'DeliveryTag' is unused
> src/rabbit_stomp.erl:515: Warning: variable 'Headers' is unused
> src/rabbit_stomp.erl:517: Warning: variable 'AckMode' is unused
> src/rabbit_stomp.erl:523: Warning: variable 'ConsumerTag' is unused
> src/rabbit_stomp.erl:529: Warning: variable 'Queue' is unused
> src/rabbit_stomp.erl:530: Warning: variable 'BoolH' is unused
> src/rabbit_stomp.erl:551: Warning: variable 'Exchange' is unused
> src/rabbit_stomp.erl:552: Warning: variable 'RoutingKey' is unused
> make: *** [ebin/rabbit_stomp.beam] Error 1
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101222/238bf0cd/attachment.htm>

From jesdisciple at gmail.com  Thu Dec 23 06:14:42 2010
From: jesdisciple at gmail.com (Chris)
Date: Thu, 23 Dec 2010 00:14:42 -0600
Subject: [rabbitmq-discuss] Installing RabbitMQ STOMP for PyGoWave
In-Reply-To: <AANLkTikqFUyw23kQi1MqvbibtW8FRt1i46akEjwxaOE-@mail.gmail.com>
References: <AANLkTimw95aUFLxPYQ8qG63wYDuXVxOtjKevjgD-yC_=@mail.gmail.com>
	<AANLkTikqFUyw23kQi1MqvbibtW8FRt1i46akEjwxaOE-@mail.gmail.com>
Message-ID: <AANLkTimp8bg13WTrPkO0HqCY_9ByjAEuYf+k-2Y+3nXq@mail.gmail.com>

Per http://code.google.com/p/typhoonae/issues/detail?id=39 I installed
erlang-dev and that fixed it.  Now I'm tying to get plugins working, but
startup fails; here's my /var/log/rabbitmq/startup_log

Starting all nodes...
Starting node rabbit at Jesdisciple-laptop...
Activating RabbitMQ plugins ...
ERROR: generation of boot script file
/var/lib/rabbitmq/mnesia/rabbit at Jesdisciple-laptop-plugins-expand/rabbit.script
failed:
{{module_not_found,rfc4627_jsonrpc,rfc4627_jsonrpc_sup},
 {rfc4627_jsonrpc_sup,'$$ignore$$',rfc4627_jsonrpc,"0.01",

"/usr/lib/rabbitmq/lib/rabbitmq_server-2.2.0/sbin/../plugins/erlang-rfc4627/ebin"}}
{{module_not_found,rfc4627_jsonrpc,rfc4627_jsonrpc_inets},
 {rfc4627_jsonrpc_inets,'$$ignore$$',rfc4627_jsonrpc,"0.01",

"/usr/lib/rabbitmq/lib/rabbitmq_server-2.2.0/sbin/../plugins/erlang-rfc4627/ebin"}}
{{module_not_found,rfc4627_jsonrpc,rfc4627_jsonrpc_mochiweb},
 {rfc4627_jsonrpc_mochiweb,'$$ignore$$',rfc4627_jsonrpc,"0.01",

"/usr/lib/rabbitmq/lib/rabbitmq_server-2.2.0/sbin/../plugins/erlang-rfc4627/ebin"}}
{{module_not_found,rfc4627_jsonrpc,rfc4627_jsonrpc_registry},
 {rfc4627_jsonrpc_registry,'$$ignore$$',rfc4627_jsonrpc,"0.01",

"/usr/lib/rabbitmq/lib/rabbitmq_server-2.2.0/sbin/../plugins/erlang-rfc4627/ebin"}}



On Wed, Dec 22, 2010 at 8:14 PM, Chris <jesdisciple at gmail.com> wrote:

> Follow-up: I should note that I have the rabbitmq-server package, version
> 1.6.0, installed from the Ubuntu Karmic repos:
> http://packages.ubuntu.com/karmic/rabbitmq-server  However I don't see
> anywhere to get the includes.
>
>
> On Wed, Dec 22, 2010 at 8:03 PM, Chris <jesdisciple at gmail.com> wrote:
>
>> Hi there.  I'm following https://wiki.ubuntu.com/PyGoWave-Server (section
>> "Orbit") and need to know how I can get the RabbitMQ 1.6.0 includes for
>> STOMP.  In case you have anything else to tell me about my problem, here it
>> is.  (/usr/lib/erlang/lib exists, but subdirectory rabbitmq_server-1.6.0
>> does not.)
>>
>> Thanks,
>> Chris
>>
>> $ sudo make
>> RABBIT_SERVER_INCLUDE_DIR=/usr/lib/erlang/lib/rabbitmq_server-1.6.0/include
>> erlc -I /usr/lib/erlang/lib/rabbitmq_server-1.6.0/include -I include -o
>> ebin -Wall +debug_info  src/rabbit_stomp.erl
>> src/rabbit_stomp.erl:42: can't find include file "rabbit.hrl"
>> src/rabbit_stomp.erl:43: can't find include file "rabbit_framing.hrl"
>> src/rabbit_stomp.erl:207: record 'channel.close_ok' undefined
>> src/rabbit_stomp.erl:222: record 'basic.deliver' undefined
>> src/rabbit_stomp.erl:226: record content undefined
>> src/rabbit_stomp.erl:238: variable 'RoutingKey' is unbound
>> src/rabbit_stomp.erl:239: variable 'Exchange' is unbound
>> src/rabbit_stomp.erl:243: variable 'DeliveryTag' is unbound
>> src/rabbit_stomp.erl:244: variable 'ContentType' is unbound
>> src/rabbit_stomp.erl:245: variable 'ContentEncoding' is unbound
>> src/rabbit_stomp.erl:246: variable 'ConsumerTag' is unbound
>> src/rabbit_stomp.erl:250: variable 'Headers' is unbound
>> src/rabbit_stomp.erl:254: variable 'DeliveryMode' is unbound
>> src/rabbit_stomp.erl:255: variable 'Priority' is unbound
>> src/rabbit_stomp.erl:256: variable 'CorrelationId' is unbound
>> src/rabbit_stomp.erl:257: variable 'ReplyTo' is unbound
>> src/rabbit_stomp.erl:258: variable 'MessageId' is unbound
>> src/rabbit_stomp.erl:260: variable 'BodyFragmentsRev' is unbound
>> src/rabbit_stomp.erl:315: record 'basic.qos_ok' undefined
>> src/rabbit_stomp.erl:317: record 'basic.qos' undefined
>> src/rabbit_stomp.erl:353: record content undefined
>> src/rabbit_stomp.erl:366: record user undefined
>> src/rabbit_stomp.erl:367: record 'channel.open_ok' undefined
>> src/rabbit_stomp.erl:368: record 'channel.open' undefined
>> src/rabbit_stomp.erl:457: record 'P_basic' undefined
>> src/rabbit_stomp.erl:467: record 'basic.publish' undefined
>> src/rabbit_stomp.erl:493: record 'basic.ack' undefined
>> src/rabbit_stomp.erl:532: record 'queue.declare' undefined
>> src/rabbit_stomp.erl:542: record 'basic.consume' undefined
>> src/rabbit_stomp.erl:556: record 'queue.bind' undefined
>> src/rabbit_stomp.erl:591: record 'basic.cancel' undefined
>> src/rabbit_stomp.erl:596: record 'channel.close' undefined
>> src/rabbit_stomp.erl:314: Warning: variable 'PrefetchCount' is unused
>> src/rabbit_stomp.erl:349: Warning: variable 'Body' is unused
>> src/rabbit_stomp.erl:349: Warning: variable 'Properties' is unused
>> src/rabbit_stomp.erl:379: Warning: function longstr_field/2 is unused
>> src/rabbit_stomp.erl:450: Warning: variable 'Headers' is unused
>> src/rabbit_stomp.erl:452: Warning: variable 'BinH' is unused
>> src/rabbit_stomp.erl:453: Warning: variable 'IntH' is unused
>> src/rabbit_stomp.erl:455: Warning: variable 'RoutingKeyStr' is unused
>> src/rabbit_stomp.erl:456: Warning: variable 'ExchangeStr' is unused
>> src/rabbit_stomp.erl:491: Warning: variable 'DeliveryTag' is unused
>> src/rabbit_stomp.erl:515: Warning: variable 'Headers' is unused
>> src/rabbit_stomp.erl:517: Warning: variable 'AckMode' is unused
>> src/rabbit_stomp.erl:523: Warning: variable 'ConsumerTag' is unused
>> src/rabbit_stomp.erl:529: Warning: variable 'Queue' is unused
>> src/rabbit_stomp.erl:530: Warning: variable 'BoolH' is unused
>> src/rabbit_stomp.erl:551: Warning: variable 'Exchange' is unused
>> src/rabbit_stomp.erl:552: Warning: variable 'RoutingKey' is unused
>> make: *** [ebin/rabbit_stomp.beam] Error 1
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101223/175a4df5/attachment.htm>

From jesdisciple at gmail.com  Thu Dec 23 06:16:03 2010
From: jesdisciple at gmail.com (Chris)
Date: Thu, 23 Dec 2010 00:16:03 -0600
Subject: [rabbitmq-discuss] Installing RabbitMQ STOMP for PyGoWave
In-Reply-To: <AANLkTimp8bg13WTrPkO0HqCY_9ByjAEuYf+k-2Y+3nXq@mail.gmail.com>
References: <AANLkTimw95aUFLxPYQ8qG63wYDuXVxOtjKevjgD-yC_=@mail.gmail.com>
	<AANLkTikqFUyw23kQi1MqvbibtW8FRt1i46akEjwxaOE-@mail.gmail.com>
	<AANLkTimp8bg13WTrPkO0HqCY_9ByjAEuYf+k-2Y+3nXq@mail.gmail.com>
Message-ID: <AANLkTinDesNahzrCY0DK9EQuARArSVeb_iMz5dcSuh9W@mail.gmail.com>

Also, I forgot to mention that I've upgraded to RabbitMQ 2.2.0.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101223/43babe8d/attachment-0001.htm>

From yoavglazner at gmail.com  Thu Dec 23 07:12:34 2010
From: yoavglazner at gmail.com (yoav glazner)
Date: Thu, 23 Dec 2010 09:12:34 +0200
Subject: [rabbitmq-discuss] RabbitMQ for Master worker with monitoring?
In-Reply-To: <AANLkTikRiX8yDM0=TK+i6wyuO62fm3rzXFEPLYHg-f7h@mail.gmail.com>
References: <AANLkTinQLatviUi436==_CHSNfeK10L8_iyczqXJ9E4i@mail.gmail.com>
	<4D11EAB0.5000204@rabbitmq.com>
	<AANLkTiniykeUyAV70aE+aYsGCC5M_htbvzhRkzGqSSc9@mail.gmail.com>
	<AANLkTinyugDYobF12DpSpmg+9eK9ZHskei2484tLP0Wc@mail.gmail.com>
	<F4438360-6727-42E8-931A-B31F2BCEAE0A@mozilla.com>
	<AANLkTikRiX8yDM0=TK+i6wyuO62fm3rzXFEPLYHg-f7h@mail.gmail.com>
Message-ID: <AANLkTim4YSbgE9Ytt+FxGU+A=see_Aa7XUn7_gPRqJQV@mail.gmail.com>

On Thu, Dec 23, 2010 at 9:12 AM, yoav glazner <yoavglazner at gmail.com> wrote:

>
>
> On Wed, Dec 22, 2010 at 10:50 PM, Christian Legnitto <
> clegnitto at mozilla.com> wrote:
>
>> Have you looked into celery? http://celeryproject.org/. You might be able
>> to bolt the additional features you need on top or use it as-is with
>> creative segmenting / driver scripts.
>>
>
looked at celery and it is not flexible enough for my legacy needs.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101223/4415e2fd/attachment.htm>

From akalend at mail.ru  Thu Dec 23 07:16:18 2010
From: akalend at mail.ru (Alexandre Kalendarev)
Date: Thu, 23 Dec 2010 10:16:18 +0300
Subject: [rabbitmq-discuss] =?windows-1251?q?Question_about_C_bindings?=
In-Reply-To: <5C3F8D74DE0D8344AF4E68E53DAB10DD05EA0A4C7B@IS-EXCHANGEC101.wsod.local>
References: <49359D67-7ABE-470A-8CC1-A87FE5670F36@whatevernot.com>
	<5C3F8D74DE0D8344AF4E68E53DAB10DD05EA0A4C7B@IS-EXCHANGEC101.wsod.local>
Message-ID: <E1PVfPO-0001DO-00.akalend-mail-ru@f16.mail.ru>


Hi Everebody,

The C++ wrapper for rabbitmq-c is https://github.com/akalend/amqpcpp
It is experimental but stable code. I use the amqpcpp in the amqp-rest project.


Alexandre


Wed, 22 Dec 2010 15:59:08 -0500 ?????? ?? Paul Pearcy <paul.pearcy at wallst.com>:

> I just asked the same question last week. The last message in the thread has
> details from Alexis.
> 
> http://old.nabble.com/Trouble-building-rabbitmq-c-on-windows-to30466433.html
> 
> -----Original Message-----
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com
> [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Brian
> Parkinson
> Sent: Wednesday, December 22, 2010 1:40 PM
> To: rabbitmq-discuss at lists.rabbitmq.com
> Subject: [rabbitmq-discuss] Question about C bindings
> 
> Hello:
> 
> I have been evaluating RabbitMQ, and am really stoked by what is there -
> it's all working fine, and integrating into my Java applications is a
> snap.
> 
> We also have to integrate with some services written in C as well as C++, and
> so the C bindings are essential.
> 
> Can anyone out there comment on the state of the C bindings - are they stable
> enough for use? Does anyone have real world experience?
> 
> Any help is appreciated - this looks to be the last missing piece.
> 
> Cheers, and thanks.
> 
> brian...
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From emile at rabbitmq.com  Thu Dec 23 10:26:23 2010
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 23 Dec 2010 10:26:23 +0000
Subject: [rabbitmq-discuss] RabbitMQ for Master worker with monitoring?
In-Reply-To: <AANLkTinyugDYobF12DpSpmg+9eK9ZHskei2484tLP0Wc@mail.gmail.com>
References: <AANLkTinQLatviUi436==_CHSNfeK10L8_iyczqXJ9E4i@mail.gmail.com>	<4D11EAB0.5000204@rabbitmq.com>	<AANLkTiniykeUyAV70aE+aYsGCC5M_htbvzhRkzGqSSc9@mail.gmail.com>
	<AANLkTinyugDYobF12DpSpmg+9eK9ZHskei2484tLP0Wc@mail.gmail.com>
Message-ID: <4D1323CF.30607@rabbitmq.com>


Hi Yoav

On 22/12/10 20:24, yoav glazner wrote:
>
> On Wed, Dec 22, 2010 at 2:10 PM, Emile Joubert <emile at rabbitmq.com
> <mailto:emile at rabbitmq.com>> wrote:
>
>     Hi Yoav,
>
>
>     On 21/12/10 21:35, yoav glazner wrote:
>
>         This is my first post to this list, so Hi!
>         I'm trying to design a Master/Worker implement-ion with RabbitMQ.
>         I have a few requierments due to lagacy issues:
>         * works get very long tasks so they should be able to get ABORT
>         messages
>         while working,
>
>
>     You could send updated status information about work items to a
>     dedicated status exchange that workers subscribe to in order to
>     obtain abort messages or changes in priority. This assumes that
>     tasks are interruptible and that workers have multiple threads of
>     control.
>
> that's good

It sounds like you want to be able to communicate two different things 
to workers:

1. tasks
2. task status updates

The updates (abort, reprioritise, pause) to tasks are the difficult part 
and the reason why frameworks like Celery won't work. I suggest you 
communicate task status updates to workers via a different route from 
the way you submit tasks. Translating that to AMQP means using using a 
separate exchange and queues, so workers accept tasks via a relatively 
slow-moving queue and obtain updates about task status via a different 
queue. This assumes that workers have more than one thread of control 
for listening on multiple queues and know how to interrupt running 
tasks. There may be lots of other ways of accomplishing your goal.

Regards

Emile


From simon at rabbitmq.com  Thu Dec 23 12:52:30 2010
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 23 Dec 2010 12:52:30 +0000
Subject: [rabbitmq-discuss] Installing RabbitMQ STOMP for PyGoWave
In-Reply-To: <AANLkTinDesNahzrCY0DK9EQuARArSVeb_iMz5dcSuh9W@mail.gmail.com>
References: <AANLkTimw95aUFLxPYQ8qG63wYDuXVxOtjKevjgD-yC_=@mail.gmail.com>	<AANLkTikqFUyw23kQi1MqvbibtW8FRt1i46akEjwxaOE-@mail.gmail.com>	<AANLkTimp8bg13WTrPkO0HqCY_9ByjAEuYf+k-2Y+3nXq@mail.gmail.com>
	<AANLkTinDesNahzrCY0DK9EQuARArSVeb_iMz5dcSuh9W@mail.gmail.com>
Message-ID: <4D13460E.30706@rabbitmq.com>

On 23/12/2010 6:16AM, Chris wrote:
> Also, I forgot to mention that I've upgraded to RabbitMQ 2.2.0.

In that case it will almost certainly be simplest to download the plugin 
as a binary from http://www.rabbitmq.com/plugins.html

(NB: plugins tend to be very version-specific, and do not work at all 
with 1.6.0.)

Cheers, Simon

From yoavglazner at gmail.com  Thu Dec 23 13:25:42 2010
From: yoavglazner at gmail.com (yoav glazner)
Date: Thu, 23 Dec 2010 15:25:42 +0200
Subject: [rabbitmq-discuss] RabbitMQ for Master worker with monitoring?
In-Reply-To: <4D1323CF.30607@rabbitmq.com>
References: <AANLkTinQLatviUi436==_CHSNfeK10L8_iyczqXJ9E4i@mail.gmail.com>
	<4D11EAB0.5000204@rabbitmq.com>
	<AANLkTiniykeUyAV70aE+aYsGCC5M_htbvzhRkzGqSSc9@mail.gmail.com>
	<AANLkTinyugDYobF12DpSpmg+9eK9ZHskei2484tLP0Wc@mail.gmail.com>
	<4D1323CF.30607@rabbitmq.com>
Message-ID: <AANLkTimn9Fb2jvKszKORiEL-1j2OebohXgCZoLAhO-QF@mail.gmail.com>

On Thu, Dec 23, 2010 at 12:26 PM, Emile Joubert <emile at rabbitmq.com> wrote:

>
> Hi Yoav
>
>
> On 22/12/10 20:24, yoav glazner wrote:
>
>>
>> On Wed, Dec 22, 2010 at 2:10 PM, Emile Joubert <emile at rabbitmq.com
>> <mailto:emile at rabbitmq.com>> wrote:
>>
>>    Hi Yoav,
>>
>>
>>    On 21/12/10 21:35, yoav glazner wrote:
>>
>>        This is my first post to this list, so Hi!
>>        I'm trying to design a Master/Worker implement-ion with RabbitMQ.
>>        I have a few requierments due to lagacy issues:
>>        * works get very long tasks so they should be able to get ABORT
>>        messages
>>        while working,
>>
>>
>>    You could send updated status information about work items to a
>>    dedicated status exchange that workers subscribe to in order to
>>    obtain abort messages or changes in priority. This assumes that
>>    tasks are interruptible and that workers have multiple threads of
>>    control.
>>
>> that's good
>>
>
> It sounds like you want to be able to communicate two different things to
> workers:
>
> 1. tasks
> 2. task status updates
>
> The updates (abort, reprioritise, pause) to tasks are the difficult part
> and the reason why frameworks like Celery won't work. I suggest you
> communicate task status updates to workers via a different route from the
> way you submit tasks. Translating that to AMQP means using using a separate
> exchange and queues, so workers accept tasks via a relatively slow-moving
> queue and obtain updates about task status via a different queue. This
> assumes that workers have more than one thread of control for listening on
> multiple queues and know how to interrupt running tasks. There may be lots
> of other ways of accomplishing your goal.


But then I'll lose messages when a worker die, no?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101223/e36507ce/attachment.htm>

From emile at rabbitmq.com  Thu Dec 23 13:35:09 2010
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 23 Dec 2010 13:35:09 +0000
Subject: [rabbitmq-discuss] RabbitMQ for Master worker with monitoring?
In-Reply-To: <AANLkTimn9Fb2jvKszKORiEL-1j2OebohXgCZoLAhO-QF@mail.gmail.com>
References: <AANLkTinQLatviUi436==_CHSNfeK10L8_iyczqXJ9E4i@mail.gmail.com>	<4D11EAB0.5000204@rabbitmq.com>	<AANLkTiniykeUyAV70aE+aYsGCC5M_htbvzhRkzGqSSc9@mail.gmail.com>	<AANLkTinyugDYobF12DpSpmg+9eK9ZHskei2484tLP0Wc@mail.gmail.com>	<4D1323CF.30607@rabbitmq.com>
	<AANLkTimn9Fb2jvKszKORiEL-1j2OebohXgCZoLAhO-QF@mail.gmail.com>
Message-ID: <4D13500D.5080807@rabbitmq.com>

Hi Yoav

On 23/12/10 13:25, yoav glazner wrote:
>
> But then I'll lose messages when a worker die, no?

Acknowledging messages only after successful processing will prevent 
them from being lost in case the consumer dies. If a consumer dies 
unacknowledged messages will be requeued.

Regards

Emile

From thadeurc at gmail.com  Thu Dec 23 13:51:29 2010
From: thadeurc at gmail.com (Thadeu Russo)
Date: Thu, 23 Dec 2010 11:51:29 -0200
Subject: [rabbitmq-discuss] Question about Connections and Channels
In-Reply-To: <4D12384A.3040103@rabbitmq.com>
References: <AANLkTik2ghtmtT_hJ-eNb46uEJ6udpopQ6gnmHKFsu7R@mail.gmail.com>
	<4D12384A.3040103@rabbitmq.com>
Message-ID: <AANLkTikOoXywKt8SGGNkZSDeMPRQucHAinNhr9U1e1m1@mail.gmail.com>

Hi Emilie,

thanks a lot for your comments.

One thing you pointed out called my attention:

"I would expect it to be more convenient for you to have an AMQP client in
each JVM and therefore use a connection per JVM. AMQP connections are cheap
resources and you need not try to conserve them. Brokers with tens of
thousands of connections are not unheard of."

This is the way I started implementing, and in each JVM I can have multiple
consumers and producer, so I was thinking about have 1 connection per JVM
with one channel per producer/consumer. I like the idea of separate
producers and consumers.

As the project goes, I will update the list with question/comments.

Best Regards,

On Wed, Dec 22, 2010 at 3:41 PM, Emile Joubert <emile at rabbitmq.com> wrote:

>
> Hi Thadeu,
>
> Your project sounds interesting. If I understand your question correctly
> you want to know if you should be using one connection with many channels,
> or many connections each with a single channel.
>
> A possibly relevant consideration is that if the broker needs to apply
> backpressure because of an overactive producer then all the channels sharing
> a connection with that producer will be blocked. Channels that can't
> tolerate this risk should have a connection to themselves. For the same
> reason you may want to separate producers and consumers to use different
> connections.
>
> I would expect it to be more convenient for you to have an AMQP client in
> each JVM and therefore use a connection per JVM. AMQP connections are cheap
> resources and you need not try to conserve them. Brokers with tens of
> thousands of connections are not unheard of.
>
>
> On 19/12/10 13:20, Thadeu Russo wrote:
>
>> Hi,
>>
>> I need to architect a Java application using rabbitmq as its message
>> broker. It is a distributed application and the message broker will play
>> the role of connect the JVMs. Basically, each JVM has sets of objects
>> (currently they are grouped by host:port) that can change messages to
>> other objects in other groups in other virtual machines (there is a 1:1
>> bi-directional relationship between groups of objects in different JVMs).
>> The idea of use the broker is to avoid the number of tcp ports I have to
>> open and also to take advantage of the message delivery guaranties.
>>
>> The design is simple: each group of objects will have an exchange and 2
>> queues (incoming and outcoming) to change messages.
>>
>> I would like to know if you guys advise the following configuration
>> regarding rabbitmq:
>>
>> 1- Have 1 connection per JVM
>> 2- Have multiple channels to that connection. Each channel will be
>> associated with those 2 queues
>>
>> What is concerning me is: the number of sends/receives per channel is
>> high (about 5k/second). Should I have multiple connections (like a
>> pool), or it is ok to use just 1 connection? If I have a pool of
>> connections, I understand they will share the same tcp port, and I could
>> not see any difference in using a single Connection.
>>
>
> The broker port will be same for each of multiple connections, but the peer
> port will typically be random. The difference is that connections with a
> single channel can fail and block without affecting other connections.
>
> Regards
>
> Emile
>



-- 
Thadeu de Russo e Carmo
http://www.thadeu.com.br/
http://www.caelum.com.br/
http://www.caelumobjects.com/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101223/78c8d840/attachment.htm>

From jesdisciple at gmail.com  Thu Dec 23 15:07:35 2010
From: jesdisciple at gmail.com (Chris)
Date: Thu, 23 Dec 2010 09:07:35 -0600
Subject: [rabbitmq-discuss] Installing RabbitMQ STOMP for PyGoWave
In-Reply-To: <AANLkTinDesNahzrCY0DK9EQuARArSVeb_iMz5dcSuh9W@mail.gmail.com>
References: <AANLkTimw95aUFLxPYQ8qG63wYDuXVxOtjKevjgD-yC_=@mail.gmail.com>
	<AANLkTikqFUyw23kQi1MqvbibtW8FRt1i46akEjwxaOE-@mail.gmail.com>
	<AANLkTimp8bg13WTrPkO0HqCY_9ByjAEuYf+k-2Y+3nXq@mail.gmail.com>
	<AANLkTinDesNahzrCY0DK9EQuARArSVeb_iMz5dcSuh9W@mail.gmail.com>
Message-ID: <AANLkTimsfciPxxXn8CQjhAJqfqKisMm0cEP7c4Oh80PU@mail.gmail.com>

Disregard my preious post; the plugins were only from a guide and I don't
need the same ones.

In ALL things, strive for ><>,
Chris


On Thu, Dec 23, 2010 at 12:16 AM, Chris <jesdisciple at gmail.com> wrote:

> Also, I forgot to mention that I've upgraded to RabbitMQ 2.2.0.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101223/90180af6/attachment.htm>

From yoavglazner at gmail.com  Thu Dec 23 15:59:15 2010
From: yoavglazner at gmail.com (yoav glazner)
Date: Thu, 23 Dec 2010 17:59:15 +0200
Subject: [rabbitmq-discuss] RabbitMQ for Master worker with monitoring?
In-Reply-To: <AANLkTi=NTbhNf_O-bL_k59a2_u389M0nhBUddXy=sygO@mail.gmail.com>
References: <AANLkTinQLatviUi436==_CHSNfeK10L8_iyczqXJ9E4i@mail.gmail.com>
	<4D11EAB0.5000204@rabbitmq.com>
	<AANLkTiniykeUyAV70aE+aYsGCC5M_htbvzhRkzGqSSc9@mail.gmail.com>
	<AANLkTinyugDYobF12DpSpmg+9eK9ZHskei2484tLP0Wc@mail.gmail.com>
	<4D1323CF.30607@rabbitmq.com>
	<AANLkTimn9Fb2jvKszKORiEL-1j2OebohXgCZoLAhO-QF@mail.gmail.com>
	<4D13500D.5080807@rabbitmq.com>
	<AANLkTi=NTbhNf_O-bL_k59a2_u389M0nhBUddXy=sygO@mail.gmail.com>
Message-ID: <AANLkTikMzXgntxT7+YHqm3rQ9oUGMc5SgvwZFvpS1pbS@mail.gmail.com>

On Thu, Dec 23, 2010 at 3:35 PM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi Yoav
>
>
> On 23/12/10 13:25, yoav glazner wrote:
>
>>
>> But then I'll lose messages when a worker die, no?
>>
>
> Acknowledging messages only after successful processing will prevent them
> from being lost in case the consumer dies. If a consumer dies unacknowledged
> messages will be requeued.
>
> Regards


Thanks a lot for the input, I guess I'll have to dive in it now.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101223/32dd9681/attachment-0001.htm>

From chirag.vadhavana at nokia.com  Thu Dec 23 16:17:16 2010
From: chirag.vadhavana at nokia.com (chirag.vadhavana at nokia.com)
Date: Thu, 23 Dec 2010 16:17:16 +0000
Subject: [rabbitmq-discuss] rabbitmq-discuss Digest, Vol 43, Issue 64
Message-ID: <1293121036.2405.5.camel@Nokia-N900>

Mj----- Original message -----
> Send rabbitmq-discuss mailing list submissions to
>                rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
>
> To subscribe or unsubscribe via the World Wide Web, visit
>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> or, via email, send a message with subject or body 'help' to
>                rabbitmq-discuss-request at lists.rabbitmq.com<mailto:rabbitmq-discuss-request at lists.rabbitmq.com>
>
> You can reach the person managing the list at
>                rabbitmq-discuss-owner at lists.rabbitmq.com<mailto:rabbitmq-discuss-owner at lists.rabbitmq.com>
>
> When replying, please edit your Subject line so it is more specific
> than "Re: Contents of rabbitmq-discuss digest..."
>
>
> Today's Topics:
>
>      1. Re: Installing RabbitMQ STOMP for PyGoWave (Simon MacMullen)
>      2. Re: RabbitMQ for Master worker with monitoring? (yoav glazner)
>      3. Re: RabbitMQ for Master worker with monitoring? (Emile Joubert)
>      4. Re: Question about Connections and Channels (Thadeu Russo)
>      5. Re: Installing RabbitMQ STOMP for PyGoWave (Chris)
>      6. Re: RabbitMQ for Master worker with monitoring? (yoav glazner)
>
>
> ----------------------------------------------------------------------
>
> Message: 1
> Date: Thu, 23 Dec 2010 12:52:30 +0000
> From: Simon MacMullen <simon at rabbitmq.com<mailto:simon at rabbitmq.com>>
> Subject: Re: [rabbitmq-discuss] Installing RabbitMQ STOMP for PyGoWave
> To: rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
> Message-ID: <4D13460E.30706 at rabbitmq.com<mailto:4D13460E.30706 at rabbitmq.com>>
> Content-Type: text/plain; charset=ISO-8859-1; format=flowed
>
> On 23/12/2010 6:16AM, Chris wrote:
> > Also, I forgot to mention that I've upgraded to RabbitMQ 2.2.0.
>
> In that case it will almost certainly be simplest to download the
> plugin
> as a binary from http://www.rabbitmq.com/plugins.html
>
> (NB: plugins tend to be very version-specific, and do not work at all
> with 1.6.0.)
>
> Cheers, Simon
>
>
> ------------------------------
>
> Message: 2
> Date: Thu, 23 Dec 2010 15:25:42 +0200
> From: yoav glazner <yoavglazner at gmail.com<mailto:yoavglazner at gmail.com>>
> Subject: Re: [rabbitmq-discuss] RabbitMQ for Master worker with
>                monitoring?
> To: rabbitmq-discuss <rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>>
> Message-ID:
>                <AANLkTimn9Fb2jvKszKORiEL-1j2OebohXgCZoLAhO-QF at mail.gmail.com<mailto:AANLkTimn9Fb2jvKszKORiEL-1j2OebohXgCZoLAhO-QF at mail.gmail.com>>
> Content-Type: text/plain; charset="iso-8859-1"
>
> On Thu, Dec 23, 2010 at 12:26 PM, Emile Joubert <emile at rabbitmq.com<mailto:emile at rabbitmq.com>>
> wrote:
>
> >
> > Hi Yoav
> >
> >
> > On 22/12/10 20:24, yoav glazner wrote:
> >
> > >
> > > On Wed, Dec 22, 2010 at 2:10 PM, Emile Joubert <emile at rabbitmq.com<mailto:emile at rabbitmq.com>
> > > <mailto:emile at rabbitmq.com>> wrote:
> > >
> > > Hi Yoav,
> > >
> > >
> > > On 21/12/10 21:35, yoav glazner wrote:
> > >
> > > This is my first post to this list, so Hi!
> > > I'm trying to design a Master/Worker implement-ion with
> RabbitMQ.
> > > I have a few requierments due to lagacy issues:
> > > * works get very long tasks so they should be able to get
> ABORT
> > > messages
> > > while working,
> > >
> > >
> > > You could send updated status information about work items to a
> > > dedicated status exchange that workers subscribe to in order to
> > > obtain abort messages or changes in priority. This assumes that
> > > tasks are interruptible and that workers have multiple threads of
> > > control.
> > >
> > > that's good
> > >
> >
> > It sounds like you want to be able to communicate two different things
> to
> > workers:
> >
> > 1. tasks
> > 2. task status updates
> >
> > The updates (abort, reprioritise, pause) to tasks are the difficult
> part
> > and the reason why frameworks like Celery won't work. I suggest you
> > communicate task status updates to workers via a different route from
> the
> > way you submit tasks. Translating that to AMQP means using using a
> separate
> > exchange and queues, so workers accept tasks via a relatively
> slow-moving
> > queue and obtain updates about task status via a different queue. This
> > assumes that workers have more than one thread of control for
> listening on
> > multiple queues and know how to interrupt running tasks. There may be
> lots
> > of other ways of accomplishing your goal.
>
>
> But then I'll lose messages when a worker die, no?
> -------------- next part --------------
> An HTML attachment was scrubbed...
> URL:
> <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101223/e36507ce/attachment-0001.htm>;
>
> ------------------------------
>
> Message: 3
> Date: Thu, 23 Dec 2010 13:35:09 +0000
> From: Emile Joubert <emile at rabbitmq.com<mailto:emile at rabbitmq.com>>
> Subject: Re: [rabbitmq-discuss] RabbitMQ for Master worker with
>                monitoring?
> To: yoav glazner <yoavglazner at gmail.com<mailto:yoavglazner at gmail.com>>
> Cc: rabbitmq-discuss <rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>>
> Message-ID: <4D13500D.5080807 at rabbitmq.com<mailto:4D13500D.5080807 at rabbitmq.com>>
> Content-Type: text/plain; charset=ISO-8859-1; format=flowed
>
> Hi Yoav
>
> On 23/12/10 13:25, yoav glazner wrote:
> >
> > But then I'll lose messages when a worker die, no?
>
> Acknowledging messages only after successful processing will prevent
> them from being lost in case the consumer dies. If a consumer dies
> unacknowledged messages will be requeued.
>
> Regards
>
> Emile
>
>
> ------------------------------
>
> Message: 4
> Date: Thu, 23 Dec 2010 11:51:29 -0200
> From: Thadeu Russo <thadeurc at gmail.com<mailto:thadeurc at gmail.com>>
> Subject: Re: [rabbitmq-discuss] Question about Connections and
>                Channels
> To: Emile Joubert <emile at rabbitmq.com<mailto:emile at rabbitmq.com>>
> Cc: rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
> Message-ID:
>                <AANLkTikOoXywKt8SGGNkZSDeMPRQucHAinNhr9U1e1m1 at mail.gmail.com<mailto:AANLkTikOoXywKt8SGGNkZSDeMPRQucHAinNhr9U1e1m1 at mail.gmail.com>>
> Content-Type: text/plain; charset="iso-8859-1"
>
> Hi Emilie,
>
> thanks a lot for your comments.
>
> One thing you pointed out called my attention:
>
> "I would expect it to be more convenient for you to have an AMQP client
> in
> each JVM and therefore use a connection per JVM. AMQP connections are
> cheap
> resources and you need not try to conserve them. Brokers with tens of
> thousands of connections are not unheard of."
>
> This is the way I started implementing, and in each JVM I can have
> multiple
> consumers and producer, so I was thinking about have 1 connection per
> JVM
> with one channel per producer/consumer. I like the idea of separate
> producers and consumers.
>
> As the project goes, I will update the list with question/comments.
>
> Best Regards,
>
> On Wed, Dec 22, 2010 at 3:41 PM, Emile Joubert <emile at rabbitmq.com<mailto:emile at rabbitmq.com>>
> wrote:
>
> >
> > Hi Thadeu,
> >
> > Your project sounds interesting. If I understand your question
> correctly
> > you want to know if you should be using one connection with many
> channels,
> > or many connections each with a single channel.
> >
> > A possibly relevant consideration is that if the broker needs to apply
> > backpressure because of an overactive producer then all the channels
> sharing
> > a connection with that producer will be blocked. Channels that can't
> > tolerate this risk should have a connection to themselves. For the
> same
> > reason you may want to separate producers and consumers to use
> different
> > connections.
> >
> > I would expect it to be more convenient for you to have an AMQP client
> in
> > each JVM and therefore use a connection per JVM. AMQP connections are
> cheap
> > resources and you need not try to conserve them. Brokers with tens of
> > thousands of connections are not unheard of.
> >
> >
> > On 19/12/10 13:20, Thadeu Russo wrote:
> >
> > > Hi,
> > >
> > > I need to architect a Java application using rabbitmq as its message
> > > broker. It is a distributed application and the message broker will
> play
> > > the role of connect the JVMs. Basically, each JVM has sets of objects
> > > (currently they are grouped by host:port) that can change messages to
> > > other objects in other groups in other virtual machines (there is a
> 1:1
> > > bi-directional relationship between groups of objects in different
> JVMs).
> > > The idea of use the broker is to avoid the number of tcp ports I have
> to
> > > open and also to take advantage of the message delivery guaranties.
> > >
> > > The design is simple: each group of objects will have an exchange and
> 2
> > > queues (incoming and outcoming) to change messages.
> > >
> > > I would like to know if you guys advise the following configuration
> > > regarding rabbitmq:
> > >
> > > 1- Have 1 connection per JVM
> > > 2- Have multiple channels to that connection. Each channel will be
> > > associated with those 2 queues
> > >
> > > What is concerning me is: the number of sends/receives per channel is
> > > high (about 5k/second). Should I have multiple connections (like a
> > > pool), or it is ok to use just 1 connection? If I have a pool of
> > > connections, I understand they will share the same tcp port, and I
> could
> > > not see any difference in using a single Connection.
> > >
> >
> > The broker port will be same for each of multiple connections, but the
> peer
> > port will typically be random. The difference is that connections with
> a
> > single channel can fail and block without affecting other connections.
> >
> > Regards
> >
> > Emile
> >
>
>
>
> --
> Thadeu de Russo e Carmo
> http://www.thadeu.com.br/
> http://www.caelum.com.br/
> http://www.caelumobjects.com/
> -------------- next part --------------
> An HTML attachment was scrubbed...
> URL:
> <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101223/78c8d840/attachment-0001.htm>;
>
> ------------------------------
>
> Message: 5
> Date: Thu, 23 Dec 2010 09:07:35 -0600
> From: Chris <jesdisciple at gmail.com<mailto:jesdisciple at gmail.com>>
> Subject: Re: [rabbitmq-discuss] Installing RabbitMQ STOMP for PyGoWave
> To: rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
> Message-ID:
>                <AANLkTimsfciPxxXn8CQjhAJqfqKisMm0cEP7c4Oh80PU at mail.gmail.com<mailto:AANLkTimsfciPxxXn8CQjhAJqfqKisMm0cEP7c4Oh80PU at mail.gmail.com>>
> Content-Type: text/plain; charset="iso-8859-1"
>
> Disregard my preious post; the plugins were only from a guide and I
> don't
> need the same ones.
>
> In ALL things, strive for ><>,
> Chris
>
>
> On Thu, Dec 23, 2010 at 12:16 AM, Chris <jesdisciple at gmail.com<mailto:jesdisciple at gmail.com>> wrote:
>
> > Also, I forgot to mention that I've upgraded to RabbitMQ 2.2.0.
> >
> -------------- next part --------------
> An HTML attachment was scrubbed...
> URL:
> <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101223/90180af6/attachment-0001.htm>;
>
> ------------------------------
>
> Message: 6
> Date: Thu, 23 Dec 2010 17:59:15 +0200
> From: yoav glazner <yoavglazner at gmail.com<mailto:yoavglazner at gmail.com>>
> Subject: Re: [rabbitmq-discuss] RabbitMQ for Master worker with
>                monitoring?
> To: rabbitmq-discuss <rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>>
> Message-ID:
>                <AANLkTikMzXgntxT7+YHqm3rQ9oUGMc5SgvwZFvpS1pbS at mail.gmail.com<mailto:AANLkTikMzXgntxT7+YHqm3rQ9oUGMc5SgvwZFvpS1pbS at mail.gmail.com>>
> Content-Type: text/plain; charset="iso-8859-1"
>
> On Thu, Dec 23, 2010 at 3:35 PM, Emile Joubert <emile at rabbitmq.com<mailto:emile at rabbitmq.com>>
> wrote:
>
> > Hi Yoav
> >
> >
> > On 23/12/10 13:25, yoav glazner wrote:
> >
> > >
> > > But then I'll lose messages when a worker die, no?
> > >
> >
> > Acknowledging messages only after successful processing will prevent
> them
> > from being lost in case the consumer dies. If a consumer dies
> unacknowledged
> > messages will be requeued.
> >
> > Regards
>
>
> Thanks a lot for the input, I guess I'll have to dive in it now.
> -------------- next part --------------
> An HTML attachment was scrubbed...
> URL:
> <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101223/32dd9681/attachment.htm>;
>
> ------------------------------
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> End of rabbitmq-discuss Digest, Vol 43, Issue 64
> ************************************************
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101223/3e626c34/attachment-0001.htm>

From paul.pearcy at wallst.com  Thu Dec 23 17:21:16 2010
From: paul.pearcy at wallst.com (Paul Pearcy)
Date: Thu, 23 Dec 2010 12:21:16 -0500
Subject: [rabbitmq-discuss] Question about C bindings
In-Reply-To: <E1PVfPO-0001DO-00.akalend-mail-ru@f16.mail.ru>
References: <49359D67-7ABE-470A-8CC1-A87FE5670F36@whatevernot.com>
	<5C3F8D74DE0D8344AF4E68E53DAB10DD05EA0A4C7B@IS-EXCHANGEC101.wsod.local>
	<E1PVfPO-0001DO-00.akalend-mail-ru@f16.mail.ru>
Message-ID: <5C3F8D74DE0D8344AF4E68E53DAB10DD05EA0A4CFC@IS-EXCHANGEC101.wsod.local>

Thanks Alexandre! Seems very useful and more concise than the raw C API.

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Alexandre Kalendarev
Sent: Thursday, December 23, 2010 12:16 AM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Question about C bindings


Hi Everebody,

The C++ wrapper for rabbitmq-c is https://github.com/akalend/amqpcpp
It is experimental but stable code. I use the amqpcpp in the amqp-rest project.


Alexandre


Wed, 22 Dec 2010 15:59:08 -0500 ?????? ?? Paul Pearcy <paul.pearcy at wallst.com>:

> I just asked the same question last week. The last message in the thread has
> details from Alexis.
> 
> http://old.nabble.com/Trouble-building-rabbitmq-c-on-windows-to30466433.html
> 
> -----Original Message-----
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com
> [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Brian
> Parkinson
> Sent: Wednesday, December 22, 2010 1:40 PM
> To: rabbitmq-discuss at lists.rabbitmq.com
> Subject: [rabbitmq-discuss] Question about C bindings
> 
> Hello:
> 
> I have been evaluating RabbitMQ, and am really stoked by what is there -
> it's all working fine, and integrating into my Java applications is a
> snap.
> 
> We also have to integrate with some services written in C as well as C++, and
> so the C bindings are essential.
> 
> Can anyone out there comment on the state of the C bindings - are they stable
> enough for use? Does anyone have real world experience?
> 
> Any help is appreciated - this looks to be the last missing piece.
> 
> Cheers, and thanks.
> 
> brian...
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From vfilby at gmail.com  Thu Dec 23 19:53:50 2010
From: vfilby at gmail.com (Filbar)
Date: Thu, 23 Dec 2010 11:53:50 -0800 (PST)
Subject: [rabbitmq-discuss] Best practices for setting up exchanges & queues
	for multi-tenancy.
Message-ID: <c2fc996e-3f9b-45e2-b2f2-c4cfe5211c0b@u3g2000vbj.googlegroups.com>

Hello,

I have been unable to find information on the best way to layout
virtual machines and exchanges for multi-tenant web apps.  If I have
missed something obvious please direct me to the docs.  I am building
a multi-tenant web app that needs to talk to computers/devices on the
client's LAN.  Each client will have 4-20 devices and there will be
about 100,000 clients and needs to scale to 1,000,000.

My understanding is that different clients should be on different
virtual machines in order to protect exchanges and queues, but this
seems overkill for 4-20 exchanges/queues per VM.  The next best
solution seems to use one exchange per client and each of the
applications can have it's own queue.  What is the best way to handle
this so that the application can scale as the number of users grows?

I greatly your appreciate guidance.

Regards,
V


From 176047528 at qq.com  Fri Dec 24 01:51:50 2010
From: 176047528 at qq.com (=?gbk?B?0qa71A==?=)
Date: Fri, 24 Dec 2010 09:51:50 +0800
Subject: [rabbitmq-discuss] Question : CPU usage of rabbitmq?
Message-ID: <tencent_39DBF08B78F7AE4663267D9B@qq.com>

hi,
  
 I do a performence test of rabbitmq, when the message rate of publish and deliver all are 20000/s, the cpu usage is very high (360%) , it almost takes up my cpu. Is it normal?   zeromq and rabbitmq, which is better (costs fewer ressource)?
  
 thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101224/5db3ae11/attachment.htm>

From matthew at rabbitmq.com  Fri Dec 24 09:39:44 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 24 Dec 2010 09:39:44 +0000
Subject: [rabbitmq-discuss] Question : CPU usage of rabbitmq?
In-Reply-To: <tencent_39DBF08B78F7AE4663267D9B@qq.com>
References: <tencent_39DBF08B78F7AE4663267D9B@qq.com>
Message-ID: <20101224093943.GA9576@rabbitmq.com>

Hi,

On Fri, Dec 24, 2010 at 09:51:50AM +0800, ?? wrote:
>  I do a performence test of rabbitmq, when the message rate of publish
>  and deliver all are 20000/s, the cpu usage is very high (360%) , it
>  almost takes up my cpu. Is it normal?

Yup. That's excellent - demonstrates good parallelism and pipelining
within Rabbit.

>   zeromq and rabbitmq, which is better (costs fewer ressource)?

Horses for courses - use whichever suits your exact needs better.

Matthew

From emile at rabbitmq.com  Fri Dec 24 09:43:01 2010
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 24 Dec 2010 09:43:01 +0000
Subject: [rabbitmq-discuss] Best practices for setting up exchanges &
 queues	for multi-tenancy.
In-Reply-To: <c2fc996e-3f9b-45e2-b2f2-c4cfe5211c0b@u3g2000vbj.googlegroups.com>
References: <c2fc996e-3f9b-45e2-b2f2-c4cfe5211c0b@u3g2000vbj.googlegroups.com>
Message-ID: <4D146B25.100@rabbitmq.com>

Hi Filbar,

Op 23/12/2010 19:53, het Filbar geskryf:
> Hello,
>
> I have been unable to find information on the best way to layout
> virtual machines and exchanges for multi-tenant web apps.  If I have
> missed something obvious please direct me to the docs.  I am building
> a multi-tenant web app that needs to talk to computers/devices on the
> client's LAN.  Each client will have 4-20 devices and there will be
> about 100,000 clients and needs to scale to 1,000,000.
>
> My understanding is that different clients should be on different
> virtual machines in order to protect exchanges and queues, but this
> seems overkill for 4-20 exchanges/queues per VM.  The next best
> solution seems to use one exchange per client and each of the
> applications can have it's own queue.  What is the best way to handle
> this so that the application can scale as the number of users grows?

There are a few ways you can isolate clients. Assigning a virtual 
machine to each client incurs alot of overhead, but gives you 
flexibility in resource allocation.

You could also run multiple separate RabbitMQ brokers on the same OS and 
use a different port for each of them. This still involves alot of 
overhead because each client has its own Erlang node, but you still have 
some resource allocation flexibility, e.g. using ulimits.

Probably the most suitable option is to set up a single broker and 
assign an AMQP vhost to each client. This offers the least overhead and 
the least resource isolation. You can use clustering to add capacity in 
line with user growth.

Regards

Emile

From zerthurd at gmail.com  Sat Dec 25 23:14:33 2010
From: zerthurd at gmail.com (Maxim Treskin)
Date: Sun, 26 Dec 2010 05:14:33 +0600
Subject: [rabbitmq-discuss]  How to unsubscribe in erlang-client?
Message-ID: <AANLkTinkQDQnvvYXd3oODv++HR8oAbg3iDhLU93e8gAQ@mail.gmail.com>

Hello

Is this any method to unsubscribe (cancel subscription) from queue in
rabbitmq-erlang-client?
It seems that only channel closing stops receiving messages.

Thank you

-- 
Maxim Treskin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101226/fbff6375/attachment.htm>

From aleksey at yeschenko.com  Sun Dec 26 12:16:27 2010
From: aleksey at yeschenko.com (Aleksey Yeschenko)
Date: Sun, 26 Dec 2010 14:16:27 +0200
Subject: [rabbitmq-discuss] How to unsubscribe in erlang-client?
In-Reply-To: <AANLkTinkQDQnvvYXd3oODv++HR8oAbg3iDhLU93e8gAQ@mail.gmail.com>
References: <AANLkTinkQDQnvvYXd3oODv++HR8oAbg3iDhLU93e8gAQ@mail.gmail.com>
Message-ID: <AANLkTi=Gu7ywYhnP7jSeHJ3-u7AKR6LWeCg1Ny_EUXhR@mail.gmail.com>

Method = #'basic.cancel'{consumer_tag = ConsumerTag},
amqp_channel:call(Channel, Method)

The subscribed process should receive #'basic.cancel_ok'{} after the call.

--
Aleksey Yeschenko


2010/12/26 Maxim Treskin <zerthurd at gmail.com>:
> Hello
>
> Is this any method to unsubscribe (cancel subscription) from queue in
> rabbitmq-erlang-client?
> It seems that only channel closing stops receiving messages.
>
> Thank you
>
> --
> Maxim Treskin
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From zerthurd at gmail.com  Sun Dec 26 16:13:39 2010
From: zerthurd at gmail.com (Maxim Treskin)
Date: Sun, 26 Dec 2010 22:13:39 +0600
Subject: [rabbitmq-discuss] How to unsubscribe in erlang-client?
In-Reply-To: <AANLkTi=Gu7ywYhnP7jSeHJ3-u7AKR6LWeCg1Ny_EUXhR@mail.gmail.com>
References: <AANLkTinkQDQnvvYXd3oODv++HR8oAbg3iDhLU93e8gAQ@mail.gmail.com>
	<AANLkTi=Gu7ywYhnP7jSeHJ3-u7AKR6LWeCg1Ny_EUXhR@mail.gmail.com>
Message-ID: <AANLkTikmcOy175cb2SGH7nsA7qefxFXddCyLAdPO=TLL@mail.gmail.com>

Thank you, Aleksey!

On 26 December 2010 18:16, Aleksey Yeschenko <aleksey at yeschenko.com> wrote:

> Method = #'basic.cancel'{consumer_tag = ConsumerTag},
> amqp_channel:call(Channel, Method)
>
> The subscribed process should receive #'basic.cancel_ok'{} after the call.
>
> --
> Aleksey Yeschenko
>
>
> 2010/12/26 Maxim Treskin <zerthurd at gmail.com>:
> > Hello
> >
> > Is this any method to unsubscribe (cancel subscription) from queue in
> > rabbitmq-erlang-client?
> > It seems that only channel closing stops receiving messages.
> >
> > Thank you
> >
> > --
> > Maxim Treskin
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
>



-- 
Maxim Treskin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101226/b65516a0/attachment.htm>

From moshima at advent.com  Mon Dec 27 15:41:49 2010
From: moshima at advent.com (Michi Oshima)
Date: Mon, 27 Dec 2010 07:41:49 -0800 (PST)
Subject: [rabbitmq-discuss]  Private messages
Message-ID: <30539657.post@talk.nabble.com>


Hi,

A little while ago in this mailing list I asked how I should implement
message privacy:

? 
http://old.nabble.com/Passing-null-for-%27arguments%27-to-queueBind%28%29-to30162963.html#a30162963
Passing null for 'arguments' to queueBind() 

I believe I came up with a solution that works without the use of a custom
exchange type.  I would like your feedback on my design.

I loosely define message privacy as follows:

1. Message is addressed to a subset of consumers
2. Only group members receive the message
3. It must be sufficiently hard for non-group members to receive the message
4. Group membership may change over time

Here's my design.

1. One producer,  many consumers.
2. Producer authenticates consumers (using means external to RabbitMQ), so
Producer knows the identity of each consumer.
3. We use a headers exchange.  We name it: "ex.privacy".
4. All consumers use a single user account (say, "consumer") with
permissions like this: 
	1. Configure: "q\\..*" 
	2. Write: "" 
	3. read: "q\\..*"
(Intention here is to give the consumers "configure" and "read" rights to
queues.  We name all queues with the prefix "q.")
5. Producer can do anything: that is, ".*", ".*",  ".*".
6. Consumers declare their own queues, with auto-delete set to true.
7. Producer binds queues on behalf of consumers.  Note, because of their
permission setting, consumers are prevented from binding their queues.  
8. Producer binds a queue with two items in the header: 1) constant flag for
public message, say "PUBLIC", 2) ID for the particular consumer.  We use
"any" matching algorithm.
9. Public messages are sent with the constant flag "PUBLIC" in the header.
10. Private messages are sent with the list of IDs (of the target consumers)
in the header.

Note: I let consumer declare their queues (Step #6 above).  When auto-delete
is correctly set, this ensures queue deletion upon connection termination.

-- 
View this message in context: http://old.nabble.com/Private-messages-tp30539657p30539657.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From mkeen.atl at gmail.com  Tue Dec 28 02:26:04 2010
From: mkeen.atl at gmail.com (Mike Keen)
Date: Mon, 27 Dec 2010 21:26:04 -0500
Subject: [rabbitmq-discuss] Forcing headers on incoming commands
Message-ID: <AANLkTinzfjZ-VCQ-06pDNTxAwyMep+C1xz0QJOLE=+UB@mail.gmail.com>

Hello,

I'm part of a small group working on a realtime social game powered by
RabbitMQ/STOMP and run on Flash clients in the browser.

We've run into some security concerns related to exposing our STOMP port to
the public. Specifically, we've noticed that without the "exclusive: true"
header in an initial subscription (even to an anonymous queue), and the
socket is dropped before the client sends a clean disconnect, the queues
remain open for a pretty long time (at least a few minutes). This has lead
to the concern that an attacker might be able to create any number of queues
that could hang around and waste memory, or even lead to memory being
exhausted.

Two questions considering the above:

1) Is it possible to set, through the config file, to force queue.exclusive
= true on every new queue creation on the server?

2) Is this a legitimate security concern? Or would a massive number of
queues (all bound to a topic exchange) not be enough to cause performance
issues?

Thanks in advance for your help.

Mike
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101227/1f2c0c21/attachment.htm>

From chenhouwu at gmail.com  Mon Dec 27 11:22:40 2010
From: chenhouwu at gmail.com (Chen Houwu)
Date: Mon, 27 Dec 2010 03:22:40 -0800 (PST)
Subject: [rabbitmq-discuss] how to send a message including a array via .net
	client?
Message-ID: <afdb5cda-2531-4703-aa87-077f067a2102@o4g2000yqd.googlegroups.com>

   I am a newbie to rabbitmq, I want to send a message object as
following via .net client:

   public class Message
    {
        public int ID { get; set; }
        public string Name { get; set; }
        public byte[] Binary { get; set; }
        public string[] Infos{get;set;}
        public Dictionary<string,int> CountMap { get; set; }
    }

Here is my code:
-------------------------------------------
var builder = new
RabbitMQ.Client.Content.StreamMessageBuilder(_channel);
builder.writeObject(msg.ID);
builder.writeObject(msg.Name);
/*----------How to deal with msg.Infos and CountMap here?------------/

/*shoud it be written by myself such as: */
builder.writeObject(infos.count)
foreach(var info in infos)
{
   builder.writerObject(info)
}
/* or the suporting to array and dictionary already exists?*/

/* I have found in"src/client/impl/WireFormatting.cs"? there are
methods like "WriteArray", and "WriteTable"*/

 IBasicProperties props = _channel.CreateBasicProperties();
props.DeliveryMode = 2;
 _channel.BasicPublish(_exchangeName, "some key", props,
builder.GetContentBody());
-----------------



From chenhouwu at gmail.com  Mon Dec 27 12:49:40 2010
From: chenhouwu at gmail.com (Chen Houwu)
Date: Mon, 27 Dec 2010 04:49:40 -0800 (PST)
Subject: [rabbitmq-discuss] how to send a message including a array via .net
	client?
Message-ID: <c08f2931-d1f3-4ec7-8bb6-ebfb376da243@f8g2000yqd.googlegroups.com>

   I am a newbie to rabbitmq, I want to send a message object as
following via .net client:

   public class Message
    {
        public int ID { get; set; }
        public string Name { get; set; }
        public byte[] Binary { get; set; }
        public string[] Infos{get;set;}
        public Dictionary<string,int> CountMap { get; set; }
    }

Here is my code:
-------------------------------------------
var builder = new
RabbitMQ.Client.Content.StreamMessageBuilder(_channel);
builder.writeObject(msg.ID);
builder.writeObject(msg.Name);
/*----------How to deal with msg.Infos and CountMap here?------------/

/*shoud it be written by myself such as: */
builder.writeObject(infos.count)
foreach(var info in infos)
{
   builder.writerObject(info)
}
/* or the suporting to array and dictionary already exists?*/

/* I have found in"src/client/impl/WireFormatting.cs"? there are
methods like "WriteArray", and "WriteTable"*/

 IBasicProperties props = _channel.CreateBasicProperties();
props.DeliveryMode = 2;
 _channel.BasicPublish(_exchangeName, "some key", props,
builder.GetContentBody());
-----------------

From majek04 at gmail.com  Wed Dec 29 10:47:44 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 29 Dec 2010 10:47:44 +0000
Subject: [rabbitmq-discuss] how to send a message including a array via
 .net client?
In-Reply-To: <afdb5cda-2531-4703-aa87-077f067a2102@o4g2000yqd.googlegroups.com>
References: <afdb5cda-2531-4703-aa87-077f067a2102@o4g2000yqd.googlegroups.com>
Message-ID: <AANLkTin_k9FcSRgnBm2=bvdj+3qJFV6cdgu1sCGj+ief@mail.gmail.com>

Hi,

I think you should be using some standardized encoding,
like for example json.

Take a look at this library:
http://james.newtonking.com/pages/json-net.aspx
http://stackoverflow.com/questions/571168/what-json-library-works-well-for-you-in-net/571178#571178

Cheers,
  Marek

On Mon, Dec 27, 2010 at 11:22, Chen Houwu <chenhouwu at gmail.com> wrote:
> ? I am a newbie to rabbitmq, I want to send a message object as
> following via .net client:
>
> ? public class Message
> ? ?{
> ? ? ? ?public int ID { get; set; }
> ? ? ? ?public string Name { get; set; }
> ? ? ? ?public byte[] Binary { get; set; }
> ? ? ? ?public string[] Infos{get;set;}
> ? ? ? ?public Dictionary<string,int> CountMap { get; set; }
> ? ?}
>
> Here is my code:
> -------------------------------------------
> var builder = new
> RabbitMQ.Client.Content.StreamMessageBuilder(_channel);
> builder.writeObject(msg.ID);
> builder.writeObject(msg.Name);
> /*----------How to deal with msg.Infos and CountMap here?------------/
>
> /*shoud it be written by myself such as: */
> builder.writeObject(infos.count)
> foreach(var info in infos)
> {
> ? builder.writerObject(info)
> }
> /* or the suporting to array and dictionary already exists?*/
>
> /* I have found in"src/client/impl/WireFormatting.cs"? there are
> methods like "WriteArray", and "WriteTable"*/
>
> ?IBasicProperties props = _channel.CreateBasicProperties();
> props.DeliveryMode = 2;
> ?_channel.BasicPublish(_exchangeName, "some key", props,
> builder.GetContentBody());
> -----------------
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From emile at rabbitmq.com  Wed Dec 29 12:37:03 2010
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 29 Dec 2010 12:37:03 +0000
Subject: [rabbitmq-discuss] Private messages
In-Reply-To: <30539657.post@talk.nabble.com>
References: <30539657.post@talk.nabble.com>
Message-ID: <4D1B2B6F.2030604@rabbitmq.com>


Hi Michi,

Thanks for message. Your proposal fills an important gap in the AMQP 
specification. Any related extensions will appear in a mercurial source 
repository branch named bug23483.

Op 27/12/2010 15:41, het Michi Oshima geskryf:
>
> Hi,
>
> A little while ago in this mailing list I asked how I should implement
> message privacy:
>
> http://old.nabble.com/Passing-null-for-%27arguments%27-to-queueBind%28%29-to30162963.html#a30162963
> Passing null for 'arguments' to queueBind()
>
> I believe I came up with a solution that works without the use of a custom
> exchange type.  I would like your feedback on my design.

 > 7. Producer binds queues on behalf of consumers.

This is very restrictive and demands too much cooperation between 
producers and consumers.

 > 8. Producer binds a queue with two items in the header

This has consequences in the broker beyond the immediate problem and 
makes it impossible to specify recipients on a per-message basis.


This design may be sufficient for your use-case, but  and could be more 
general.


Regards

Emile

From abhishek.kona at gmail.com  Wed Dec 29 15:32:37 2010
From: abhishek.kona at gmail.com (Abhishek Kona)
Date: Wed, 29 Dec 2010 21:02:37 +0530
Subject: [rabbitmq-discuss] Custom rabbitMQ Debian package
Message-ID: <4D1B5495.5080704@gmail.com>

Hi

I need to make custom RabbitMQ debian package with default queues and 
exchanges.
Has anyone done it before and also is there a way to create those 
exchanges and queues from a shell script.

-Abhishek Kona

From jerry at earthkicks.com  Wed Dec 29 15:47:41 2010
From: jerry at earthkicks.com (Jerry Seiler)
Date: Wed, 29 Dec 2010 10:47:41 -0500
Subject: [rabbitmq-discuss] =?iso-8859-1?q?Best_Practice_-_Implementing_a_?=
	=?iso-8859-1?q?Consumer_=28subscriber=29?=
References: <30539657.post@talk.nabble.com> <4D1B2B6F.2030604@rabbitmq.com>
Message-ID: <60A3F006DEDE453287756C7E12E67ED8@ET.LOCAL>

I'm looking for some best practices for implementing a high level consumer, 
say a notification broker.

Say, for instance -

The notification broker is subscribed to a queue, reads messages off of the 
queue and does work to determine how the message content is formatted (based 
on message type), who the message should be routed to (a person) and by what 
means the message is routed (email, sms, tweet, etc).

Ideally, to provide some scalability, several instances of the broker would 
be running in parallel in some sort of load balanced manner, all reading off 
of the same queue.

The broker would be running on a pool of application servers or IIS servers. 
either or, but not both.

What is the recommend implementation of the broker? A window's service, an 
application running under IIS, some other WCF/WAS implementation?

Thoughts? Thanks in advance!


From majek04 at gmail.com  Wed Dec 29 15:50:25 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 29 Dec 2010 15:50:25 +0000
Subject: [rabbitmq-discuss] Custom rabbitMQ Debian package
In-Reply-To: <4D1B5495.5080704@gmail.com>
References: <4D1B5495.5080704@gmail.com>
Message-ID: <AANLkTimYeX0xb0C9-io_Fd1K5S4qN9bJCWQJn3ucD1-w@mail.gmail.com>

On Wed, Dec 29, 2010 at 15:32, Abhishek Kona <abhishek.kona at gmail.com> wrote:
> I need to make custom RabbitMQ debian package

That should be possible. I haven't done it myself, but all the packaging stuff
is in the 'packaging' subdirectory. I think you should be able to create
the debian package.

> with default queues and exchanges.
> Has anyone done it before and also is there a way to create those exchanges
> and queues from a shell script.

No. By default we don't ship any such tools.

But there are many other options:
 - check out the tools in librabbitmq (our C bindings). Using those
   tools you should be able to create basic queues/exchanges.
 - Using rabbitmq-management plugin you should be able to
   restore configuration (from a json file). That can be used
   to get the initial config. That's also probably the simplest option.
   BTW, there is a python tool released with mgmt plugin.
 - Look at the shovel plugin. Using shovel config you can configure
   queues/exchanges.

Cheers,
  Marek

From kot.begemot at gmail.com  Wed Dec 29 19:30:48 2010
From: kot.begemot at gmail.com (Vadim Chekan)
Date: Wed, 29 Dec 2010 11:30:48 -0800
Subject: [rabbitmq-discuss] [Patch] .NET client: ignored params in QueueBind
Message-ID: <AANLkTinxy87jptnB1MnBG9iYyRN6UbuNgx7iEe6KJTmR@mail.gmail.com>

When you bind a queue to "fanout" exchange, routing key can be skipped
(not provided) according to the spec. In C# client it is implemented
by providing empty value:
model.QueueBind(queue, Program.COST_QUEUE, ->""<-, false, null);
But intuitively we tend to pass "null" for parameters that are not
used. In current implementation it causes a null exception on attempt
to convert null string into array.

So either parameters must be checked for non-null constraint, or (my
preference) null should be interpreted as empty parameter.

Vadim.

==========================================================
diff -r 982a0b810bcb
projects/client/RabbitMQ.Client/src/client/impl/WireFormatting.cs
--- a/projects/client/RabbitMQ.Client/src/client/impl/WireFormatting.cs
Thu Oct 28 14:49:55 2010 +0100
+++ b/projects/client/RabbitMQ.Client/src/client/impl/WireFormatting.cs
Wed Dec 29 11:29:24 2010 -0800
@@ -236,7 +236,13 @@
         }

         public static void WriteShortstr(NetworkBinaryWriter writer,
string val)
-        {
+        {
+            if (string.IsNullOrEmpty(val))
+            {
+                writer.Write((byte)0);
+                return;
+            }
+
             byte[] bytes = Encoding.UTF8.GetBytes(val);
             int len = bytes.Length;
             if (len > 255)
==========================================================

-- 
>From RFC 2631: In ASN.1, EXPLICIT tagging is implicit unless IMPLICIT
is explicitly specified

From matthew at rabbitmq.com  Wed Dec 29 20:46:17 2010
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 29 Dec 2010 20:46:17 +0000
Subject: [rabbitmq-discuss] [Patch] .NET client: ignored params in
 QueueBind
In-Reply-To: <AANLkTinxy87jptnB1MnBG9iYyRN6UbuNgx7iEe6KJTmR@mail.gmail.com>
References: <AANLkTinxy87jptnB1MnBG9iYyRN6UbuNgx7iEe6KJTmR@mail.gmail.com>
Message-ID: <20101229204616.GA2762@wellquite.org>

On Wed, Dec 29, 2010 at 11:30:48AM -0800, Vadim Chekan wrote:
> So either parameters must be checked for non-null constraint, or (my
> preference) null should be interpreted as empty parameter.

Yeah, sadly there are many such cases in both the C# and Java clients of
this kinda thing. The one that annoys me the most is in the Java client
in queueDeclare - the queue name must be "" rather than null, but the
arguments map can be null. Grrrr.

All of these need fixing - there are many such odd idiosyncratic aspects
to the Java and .Net clients but I've no idea whether these are
scheduled to be fixed in the short, medium or long term.

Thanks for the patch though.

Matthew

From 176047528 at qq.com  Thu Dec 30 11:56:47 2010
From: 176047528 at qq.com (=?ISO-8859-1?B?eWFvaHVp?=)
Date: Thu, 30 Dec 2010 19:56:47 +0800
Subject: [rabbitmq-discuss] |Spam| Memory usage about java client?
Message-ID: <tencent_27E29974704106537F5DB1EA@qq.com>

hi,
  
    My java client would use memory of JVM that i defined  by -Xms512m -Xmm512m. Is that normal?
 someon tell me the reason. There exist another methode of client not using loop while(true)?
  
 thx.
  
 my code is like this:
   Connection conn = null;
  ConnectionFactory factory = new ConnectionFactory();
   factory.setHost("localhost");
   conn = factory.newConnection();
  Channel chan = conn.createChannel();
  
   chan.queueDeclare("your_queue" , false, false, false, null);
  QueueingConsumer consumer = new QueueingConsumer(chan);
  chan.basicConsume("your_queue", true, consumer);
  
   while (true) {
    try {
       delivery = consumer.nextDelivery();
       byte msg[] = delivery.getBody();
 
     } catch (InterruptedException ie) {
       System.out.println("Error: " + ie);
       continue;
    }
 }
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101230/f67de7d6/attachment.htm>

From majek04 at gmail.com  Thu Dec 30 16:59:12 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Thu, 30 Dec 2010 16:59:12 +0000
Subject: [rabbitmq-discuss] how to use ez-debian from
	rabbitmq-public-umbrella?
In-Reply-To: <AANLkTimUuCHbGfC61sh7fv4XHa-RzWu27DRKbmXxdf6c@mail.gmail.com>
References: <AANLkTimUuCHbGfC61sh7fv4XHa-RzWu27DRKbmXxdf6c@mail.gmail.com>
Message-ID: <AANLkTi=j2Q6qZ2rLwNSTN4p5-JkzcPxv+3GGXPJp1hNn@mail.gmail.com>

Hi,

As far as I know this directory is not used and awaits deletion.

Cheers,
  Marek


On Fri, Dec 17, 2010 at 20:07, mabrek <mabrek at gmail.com> wrote:
> Hello.
>
> We need to deploy rabbitmq and several plugins as debian packages.
> Currently we grab management plugin and all its deps as binary *.ez
> from web and wrap them into .deb. But building plugin as .deb from
> sources for in-house developed plugin looks quite different.
> Is there "recommended" way to build plugins as .deb from sources?
> How to use ez-debian from rabbitmq-public-umbrella and what is it for?
>
> Regards,
> Anton Lebedevich.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From kot.begemot at gmail.com  Fri Dec 31 00:01:44 2010
From: kot.begemot at gmail.com (Vadim Chekan)
Date: Thu, 30 Dec 2010 16:01:44 -0800
Subject: [rabbitmq-discuss] [Patch] Wcf client exception
Message-ID: <AANLkTikroVCOkSXxKGZ=oNKpsGrfKR_5fWxQBhM+dNQG@mail.gmail.com>

When I'm trying to use Wcf I get "ACCESS_REFUSED - operation not
permitted on the default exchange".
It seems you can not bind a queue to default exchange. Here is a patch
skipping default exchange binding.

Vadim.

==================================================================
diff -r 982a0b810bcb
projects/wcf/RabbitMQ.ServiceModel/src/serviceModel/RabbitMQInputChannel.cs
--- a/projects/wcf/RabbitMQ.ServiceModel/src/serviceModel/RabbitMQInputChannel.cs
      Thu Oct 28 14:49:55 2010 +0100
+++ b/projects/wcf/RabbitMQ.ServiceModel/src/serviceModel/RabbitMQInputChannel.cs
      Thu Dec 30 15:57:53 2010 -0800
@@ -169,7 +169,8 @@
 #endif
             //Create a queue for messages destined to this service,
bind it to the service URI routing key
             string queue = m_model.QueueDeclare();
-            m_model.QueueBind(queue, base.LocalAddress.Uri.Host,
base.LocalAddress.Uri.PathAndQuery, false, null);
+            if(!string.IsNullOrEmpty(base.LocalAddress.Uri.Host))
+                m_model.QueueBind(queue, base.LocalAddress.Uri.Host,
base.LocalAddress.Uri.PathAndQuery, false, null);

             //Listen to the queue
             m_messageQueue = new QueueingBasicConsumer(m_model);
==================================================================

-- 
>From RFC 2631: In ASN.1, EXPLICIT tagging is implicit unless IMPLICIT
is explicitly specified

From majek04 at gmail.com  Fri Dec 31 00:36:50 2010
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 31 Dec 2010 00:36:50 +0000
Subject: [rabbitmq-discuss] [Patch] Wcf client exception
In-Reply-To: <AANLkTikroVCOkSXxKGZ=oNKpsGrfKR_5fWxQBhM+dNQG@mail.gmail.com>
References: <AANLkTikroVCOkSXxKGZ=oNKpsGrfKR_5fWxQBhM+dNQG@mail.gmail.com>
Message-ID: <AANLkTimigHa5ESs2CXjiUmqKkgBFGcs2+ZJtVxb383JZ@mail.gmail.com>

On Fri, Dec 31, 2010 at 00:01, Vadim Chekan <kot.begemot at gmail.com> wrote:
> When I'm trying to use Wcf I get "ACCESS_REFUSED - operation not
> permitted on the default exchange".

Are you using the latest release of dotnet client?

I'm pretty sure this bug was already fixed:
http://hg.rabbitmq.com/rabbitmq-dotnet-client/rev/14f00a39d0c7

Cheers,
   Marek



> It seems you can not bind a queue to default exchange. Here is a patch
> skipping default exchange binding.
>
> Vadim.
>
> ==================================================================
> diff -r 982a0b810bcb
> projects/wcf/RabbitMQ.ServiceModel/src/serviceModel/RabbitMQInputChannel.cs
> --- a/projects/wcf/RabbitMQ.ServiceModel/src/serviceModel/RabbitMQInputChannel.cs
> ? ? ?Thu Oct 28 14:49:55 2010 +0100
> +++ b/projects/wcf/RabbitMQ.ServiceModel/src/serviceModel/RabbitMQInputChannel.cs
> ? ? ?Thu Dec 30 15:57:53 2010 -0800
> @@ -169,7 +169,8 @@
> ?#endif
> ? ? ? ? ? ? //Create a queue for messages destined to this service,
> bind it to the service URI routing key
> ? ? ? ? ? ? string queue = m_model.QueueDeclare();
> - ? ? ? ? ? ?m_model.QueueBind(queue, base.LocalAddress.Uri.Host,
> base.LocalAddress.Uri.PathAndQuery, false, null);
> + ? ? ? ? ? ?if(!string.IsNullOrEmpty(base.LocalAddress.Uri.Host))
> + ? ? ? ? ? ? ? ?m_model.QueueBind(queue, base.LocalAddress.Uri.Host,
> base.LocalAddress.Uri.PathAndQuery, false, null);
>
> ? ? ? ? ? ? //Listen to the queue
> ? ? ? ? ? ? m_messageQueue = new QueueingBasicConsumer(m_model);
> ==================================================================
>
> --
> From RFC 2631: In ASN.1, EXPLICIT tagging is implicit unless IMPLICIT
> is explicitly specified
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From kot.begemot at gmail.com  Fri Dec 31 04:23:08 2010
From: kot.begemot at gmail.com (Vadim Chekan)
Date: Thu, 30 Dec 2010 20:23:08 -0800
Subject: [rabbitmq-discuss] [Patch] Wcf client exception
In-Reply-To: <AANLkTimigHa5ESs2CXjiUmqKkgBFGcs2+ZJtVxb383JZ@mail.gmail.com>
References: <AANLkTikroVCOkSXxKGZ=oNKpsGrfKR_5fWxQBhM+dNQG@mail.gmail.com>
	<AANLkTimigHa5ESs2CXjiUmqKkgBFGcs2+ZJtVxb383JZ@mail.gmail.com>
Message-ID: <AANLkTinM+u95WW4+rv0GdnegspYMVjyOqQK1sPf5hdJo@mail.gmail.com>

Ah, you are right. Somehow I thought I was up to date.

protocolversion in wcf .config files could be set to:
-                protocolversion="AMQP_0_9_1"
+                protocolversion="DefaultProtocol"

This will save you  from forgetting to update it to the latest version.
Vadim.

On Thu, Dec 30, 2010 at 4:36 PM, Marek Majkowski <majek04 at gmail.com> wrote:
> On Fri, Dec 31, 2010 at 00:01, Vadim Chekan <kot.begemot at gmail.com> wrote:
>> When I'm trying to use Wcf I get "ACCESS_REFUSED - operation not
>> permitted on the default exchange".
>
> Are you using the latest release of dotnet client?
>
> I'm pretty sure this bug was already fixed:
> http://hg.rabbitmq.com/rabbitmq-dotnet-client/rev/14f00a39d0c7
>
> Cheers,
> ? Marek
>
>
>
>> It seems you can not bind a queue to default exchange. Here is a patch
>> skipping default exchange binding.
>>
>> Vadim.
>>
>> ==================================================================
>> diff -r 982a0b810bcb
>> projects/wcf/RabbitMQ.ServiceModel/src/serviceModel/RabbitMQInputChannel.cs
>> --- a/projects/wcf/RabbitMQ.ServiceModel/src/serviceModel/RabbitMQInputChannel.cs
>> ? ? ?Thu Oct 28 14:49:55 2010 +0100
>> +++ b/projects/wcf/RabbitMQ.ServiceModel/src/serviceModel/RabbitMQInputChannel.cs
>> ? ? ?Thu Dec 30 15:57:53 2010 -0800
>> @@ -169,7 +169,8 @@
>> ?#endif
>> ? ? ? ? ? ? //Create a queue for messages destined to this service,
>> bind it to the service URI routing key
>> ? ? ? ? ? ? string queue = m_model.QueueDeclare();
>> - ? ? ? ? ? ?m_model.QueueBind(queue, base.LocalAddress.Uri.Host,
>> base.LocalAddress.Uri.PathAndQuery, false, null);
>> + ? ? ? ? ? ?if(!string.IsNullOrEmpty(base.LocalAddress.Uri.Host))
>> + ? ? ? ? ? ? ? ?m_model.QueueBind(queue, base.LocalAddress.Uri.Host,
>> base.LocalAddress.Uri.PathAndQuery, false, null);
>>
>> ? ? ? ? ? ? //Listen to the queue
>> ? ? ? ? ? ? m_messageQueue = new QueueingBasicConsumer(m_model);
>> ==================================================================
>>
>> --
>> From RFC 2631: In ASN.1, EXPLICIT tagging is implicit unless IMPLICIT
>> is explicitly specified
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>



-- 
>From RFC 2631: In ASN.1, EXPLICIT tagging is implicit unless IMPLICIT
is explicitly specified

