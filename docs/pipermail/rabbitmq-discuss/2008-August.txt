From lahiru at apache.org  Fri Aug  1 04:08:34 2008
From: lahiru at apache.org (lahiru gunathilake)
Date: Fri, 1 Aug 2008 08:38:34 +0530
Subject: [rabbitmq-discuss] Information about EndlessSummerOfCode
Message-ID: <72b4c7110807312008p17510e64vb45da9a3c7a96ec@mail.gmail.com>

Hi devs,

I'm a Google Summer of Code student who's implementing management console
for Apache Qpid. I'm interested on having some more information about
EndlessSummerOfCode and I'm more than happy to work on the first project
(Implement a management facility for RabbitMQ).


Thanks in advance

Regards
Lahiru
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080801/64fd0aeb/attachment.htm 

From nathan at comvine.com  Fri Aug  1 05:17:06 2008
From: nathan at comvine.com (Nathan Oorloff)
Date: Fri, 1 Aug 2008 14:17:06 +1000
Subject: [rabbitmq-discuss] Load balancing with multiple consumers on a
	single queue
In-Reply-To: <OFB6A00138.536BBD2C-ON80257497.002EF08F-80257497.002FB0E4@Edftrading.com>
References: <489178B0.2000106@redhat.com>
	<OFB6A00138.536BBD2C-ON80257497.002EF08F-80257497.002FB0E4@Edftrading.com>
Message-ID: <b307b5520807312117v2c66f62br9d8371eb1fcec808@mail.gmail.com>

Hi all,

Alexis: although your solution isn't ideal, the amount of processing a task
requires is roughly related to the size so that might be a good option.
Where can I find the options for doing the advanced routing rules? So far
I've only seen routing based on the routing_key property.

Re: Basic reject, it appears to be implemented in the library I'm using and
I've done some initial tests in which the reject seems to work right up
until the last message where I get the following back from the server: (503,
u'COMMAND_INVALID', (60, 90), 'Channel.basic_reject'). I'll have to
test/look into this more, it could just be a library issue. However, we
would then have to make our clients multi-threaded, one thread to reject the
new messages as they come in and another to deal with the current job. This
is a viable solution but not a great one, hoping to use the cancel instead.

Finally, after my initial tests the consume, ack message, cancel, deal with
message, send response, re-consume system worked perfectly, until I upped
the message throughput and the client library gets a basic_deliver instead
of the basic_cancel_ok it expected. I edited the library to not error in
this instance and to ignore messages after the cancel had been sent however
when I start the consume again I have a client waiting for a message to
finish getting delivered it seems which never happens. Tonyg (on irc) said
for the cancel to work properly I'd probably have to cancel the
channel/connection rather than just doing a basic_cancel. Which I've tried
with limited success (it appears to work, however I'm running into the
unexpected response issue again so I'll have to check the client code).

I might give "recover" a test. At first glance it looks like I should run it
after I've ack'd the message I'm about to process and issued the cancel?

Nathan.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080801/daf493ce/attachment.htm 

From alexis.richardson at cohesiveft.com  Fri Aug  1 06:13:26 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Fri, 1 Aug 2008 06:13:26 +0100
Subject: [rabbitmq-discuss] introductory slides for RabbitMQ and AMQP
Message-ID: <167204d20807312213j2a8bb079nb0e501b6e45774ff@mail.gmail.com>

Hi

Some of you may find these slides useful if you are introducing AMQP
and RabbitMQ to a colleague or a friend:

http://somic-org.homelinux.org/blog/2008/07/31/slides-for-my-amqprabbitmq-talk/

Many thanks to Dmitriy for this.

alexis



From alexis.richardson at cohesiveft.com  Fri Aug  1 06:29:09 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Fri, 1 Aug 2008 06:29:09 +0100
Subject: [rabbitmq-discuss] Load balancing with multiple consumers on a
	single queue
In-Reply-To: <b307b5520807312117v2c66f62br9d8371eb1fcec808@mail.gmail.com>
References: <489178B0.2000106@redhat.com>
	<OFB6A00138.536BBD2C-ON80257497.002EF08F-80257497.002FB0E4@Edftrading.com>
	<b307b5520807312117v2c66f62br9d8371eb1fcec808@mail.gmail.com>
Message-ID: <167204d20807312229h76a184e1y2ccb779502bfe570@mail.gmail.com>

Nathan

Let me take a chunk of this - but not the Basic.reject part.

On Fri, Aug 1, 2008 at 5:17 AM, Nathan Oorloff <nathan at comvine.com> wrote:
>
> Alexis: although your solution isn't ideal, the amount of processing a task
> requires is roughly related to the size so that might be a good option.
> Where can I find the options for doing the advanced routing rules? So far
> I've only seen routing based on the routing_key property.

The question is whether the existing routing rules are advanced
enough.  I argue that, with Topic Exchanges, they are.

It would not be hard to write a custom exchange which routed messages
based on their size.  The thing is that you would still need a
routing_key as well.  Or rather: if the custom exchange only *ever*
routed based on size, and ignored keys, your solution could be hard to
maintain as you sent more and more messages.  On the other hand you
could perform the size check at the application layer, ie on the
sender, and include size information in the routing keys.  That would
make it easier to treat all routing logic in a uniform way even in a
large scale app.

For example:

accounts.london.largetask.100
accounts.paris.smalltask.2

... could be routed with a Topic Exchange.

My point is that if you use keys at all for this, then you may as well
use them for all of it, and send size info as a key.  Then you do not
need to write a new exchange and can reuse existing application level
tools to maintain your routing logic over time.

Do others agree?  Share your thoughts ;-)

alexis



From tonyg at lshift.net  Fri Aug  1 08:52:22 2008
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Fri, 01 Aug 2008 08:52:22 +0100
Subject: [rabbitmq-discuss] Load balancing with multiple consumers on
 a	single queue
In-Reply-To: <b307b5520807312117v2c66f62br9d8371eb1fcec808@mail.gmail.com>
References: <489178B0.2000106@redhat.com>	<OFB6A00138.536BBD2C-ON80257497.002EF08F-80257497.002FB0E4@Edftrading.com>
	<b307b5520807312117v2c66f62br9d8371eb1fcec808@mail.gmail.com>
Message-ID: <4892C0B6.3030603@lshift.net>

Hi Nathan,

Nathan Oorloff wrote:
> the client library gets a basic_deliver 
> instead of the basic_cancel_ok it expected.

Yep: this is because until you hear the cancel-ok from the server, you 
can't assume the server has heard the cancel request yet. The delivery 
could have already been in flight at the time the cancel was sent by the 
client.

There are only a very few kinds of "method" than can appear unsolicited 
from the server on a fully-established channel: channel.close, 
basic.return and basic.deliver. A client library has to be prepared to 
receive these at any time, even when it's waiting for a reply to a 
synchronous method request it sent earlier.

> I edited the library to not 
> error in this instance and to ignore messages after the cancel had been 
> sent

Better would be to deliver messages to the application until the 
cancel-ok is received. The server does consider these to be legitimate 
deliveries, and it is waiting (if noack wasn't enabled) for your 
acknowledgement of them.

> however when I start the consume again I have a client waiting for 
> a message to finish getting delivered it seems which never happens. 

I don't understand what you mean here.

> Tonyg (on irc) said for the cancel to work properly I'd probably have to 
> cancel the channel/connection rather than just doing a basic_cancel. 

If by "properly", you mean requeueing any unacknowledged deliveries on 
the channel, so that they can be redelivered to the same or a different 
channel, yes (another options is to use basic.recover).

Cancelling a consumer does not affect any of the deliveries that were 
sent your way during the lifetime of the consumer: in order to let the 
server know that you don't want them, you need to reject, recover, or 
close the channel.

> I might give "recover" a test. At first glance it looks like I should 
> run it after I've ack'd the message I'm about to process and issued the 
> cancel?

"recover" is not very well defined in 0-8, because it lacks a 
corresponding "recover-ok" which would tell the issuing client where the 
boundary between deliveries pre-recover and deliveries post-recover 
sits. To work around this problem, I would

  - acknowledge any of the deliveries I've heard about that I want
    to keep (this step can be done at any time prior to the sending of
    the basic.recover command)

  - cancel ALL consumers on the channel concerned, and wait for the
    corresponding cancel-ok messages to arrive. This gives a guarantee
    that no more basic.delivers will appear before you issue the recover,
    so you know exactly what's going on.

  - in the client, discard any record of any outstanding unprocessed,
    unacknowledged deliveries: essentially, give yourself a clean slate

  - issue the basic.recover

  - start consumers at your leisure

Painful. Then again, basic.recover does seem like kind of an unusual 
thing to want to do -- perhaps those cases where its use is required are 
"bad code smells" indicating weaknesses in the main part of the AMQP 
protocol?

By the way, thanks to all the participants in this thread so far. It's 
exactly these kinds of use-cases and discussions that will help make 
AMQP (and its implementations) rock-solid.

Regards,
   Tony




From 0x6e6562 at gmail.com  Fri Aug  1 09:56:14 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Fri, 1 Aug 2008 09:56:14 +0100
Subject: [rabbitmq-discuss] Information about EndlessSummerOfCode
In-Reply-To: <72b4c7110807312008p17510e64vb45da9a3c7a96ec@mail.gmail.com>
References: <72b4c7110807312008p17510e64vb45da9a3c7a96ec@mail.gmail.com>
Message-ID: <269388e30808010156g1bb5f554x94fcc6a1508b49e3@mail.gmail.com>

Hi Lahiru,

On Fri, Aug 1, 2008 at 4:08 AM, lahiru gunathilake <lahiru at apache.org> wrote:
> I'm a Google Summer of Code student who's implementing management console
> for Apache Qpid. I'm interested on having some more information about
> EndlessSummerOfCode and I'm more than happy to work on the first project
> (Implement a management facility for RabbitMQ).

Great!

The intention behind the Endless Summer Of Code (apart from
shamelessly ripping off two well known concepts) was to give the
Rabbit community some kind of indication of the types of mini-projects
that individuals could undertake if they felt like contributing to the
project and the community in general.

We are constantly hearing about feature requests and things that would
be cool if only Rabbit could do it.

A lot of this stuff is potentially low hanging fruit.

Unfortunately, the core dev team does not have the resources to do all
of these things themselves.

And a lot of time, we also don't fully know what feature X should like
exactly, which is why we need community involvement.

So that's why I've started to maintain a publicly visible list of
things that one could get involved with.

The modus operandi would be to

- take up contact via the list to signal your intention,
- start a discussion,
- get some background from us,
- maybe get some input from other like-minded people from the list,
- and then do it.

And this does not have to be code, either. It could be

- writing some documentation,
- writing an article,
- drawing some explanatory diagrams,
- collating extrernal resources,
- helping out with the wiki
- or anything that you feel that was missing when you were new to Rabbit.

I'll answer the question about the management in a separate post.

HTH,

Ben



From 0x6e6562 at gmail.com  Fri Aug  1 10:12:59 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Fri, 1 Aug 2008 10:12:59 +0100
Subject: [rabbitmq-discuss] Round Robin, again
Message-ID: <269388e30808010212k5208159g61d6b2c2d43ee1f0@mail.gmail.com>

Paul,

First of all, sorry about the delay in answering this, because it
didn't go through the list it fell into the wrong message queue in my
mail account.

On Wed, Jul 23, 2008 at 8:41 AM, Paul Jones <pauljones23 at gmail.com> wrote:

> One question we had was whether there was any way to get around the bit
> where the specification states that messages are delivered to multiple
> consumers in a round-robin fashion. The scenario I'm thinking of is
> something like:
>
> Message 1 goes to Consumer A, and takes a long time.
> Message 2 goes to Consumer B, and is done very quickly.
> Message 3 goes to Consumer A (round-robin), and is delayed because it is
> waiting for Consumer A to be ready (even though Consumer B is idle).
>
> I assume the behaviour happens because the consumer part of the amqp library
> is buffering messages. Apparently people have asked similar sorts of
> questions on the mailing lists, and have ended up implementing queues within
> their own applications - which works fine up until you want to scale across
> multiple machines.
>
> I was wondering if it would be possible to reduce the buffer length to 0 or
> something like that? Obviously that would impact the time it takes a message
> to be delivered, but it would certainly result in the time spent in queue
> going down for messages in the above scenario.
>

I don't know if you have been following the discussion on this list
lately about round robin deliveries.

This is an issue for a number of people and we think we have a
straight forward solution for this.

Tony has been discussing various options surrounding the qos command
which would allow the user to set the pre-fetch window size of a
consumer.

Please stay tuned for the resolution.

Ben



From 0x6e6562 at gmail.com  Fri Aug  1 10:22:11 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Fri, 1 Aug 2008 10:22:11 +0100
Subject: [rabbitmq-discuss] Routing algorithm in RabbitMQ
In-Reply-To: <488DA4F9.6040703@lshift.net>
References: <488DA4F9.6040703@lshift.net>
Message-ID: <269388e30808010222j5ecebc43xeec90a450bd8ae88@mail.gmail.com>

Abhishek,

On Mon, Jul 28, 2008 at 11:52 AM, Ben Hood <ben at lshift.net> wrote:

> Can you please let me know what kind of routing algorithm is being used in
> the server, to match the incoming events with the corresponding queues. I
> think Mnesia is used as the distributed DBMS, but I was just curious to know
> about the routing algorithm and its performance.

I'm answering this by way of the rabbitmq-discuss mailing list,
because you might get some input from the community.

The routing semantics are defined the AMQP spec.

If you have a look inside it, you will find the notion of exchanges,
to which queues can be bound using routing keys.

There are several types of exchanges:

- Direct, i.e. 1:1 or quasi-P2P messaging
- Fanout, i.e. 1:N messaging
- Topic, i.e. hierarchical matching
- Headers, i.e. content based routing
- Custom, i.e. implementation specific exchanges, not defined in the spec

As for the concrete routing algorithm, there's nothing funky about it
I wouldn't say.

As it turns out, I am currently working on a patch to the routing
mechanism, bug 18776 in hg refers, although I haven't done much on it
yet.

I can't much about performance yet, but I think that the routing table
will be tree based, so expect something in the order of O(nlogn)

HTH,

Ben



From rgl at ruilopes.com  Fri Aug  1 12:09:07 2008
From: rgl at ruilopes.com (Rui Lopes)
Date: Fri, 01 Aug 2008 12:09:07 +0100
Subject: [rabbitmq-discuss] introductory slides for RabbitMQ and AMQP
In-Reply-To: <167204d20807312213j2a8bb079nb0e501b6e45774ff@mail.gmail.com>
References: <167204d20807312213j2a8bb079nb0e501b6e45774ff@mail.gmail.com>
Message-ID: <4892EED3.20302@ruilopes.com>

Hello,

Alexis Richardson wrote:
> Some of you may find these slides useful if you are introducing AMQP
> and RabbitMQ to a colleague or a friend:
>
> http://somic-org.homelinux.org/blog/2008/07/31/slides-for-my-amqprabbitmq-talk/
>
> Many thanks to Dmitriy for this.
>   
Nice, thanks guys!

Best regards,
Rui Lopes



From alexis.richardson at cohesiveft.com  Fri Aug  1 12:29:50 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Fri, 1 Aug 2008 12:29:50 +0100
Subject: [rabbitmq-discuss] another intro article
Message-ID: <167204d20808010429g4cd6985cw105886dbd9b1ff3d@mail.gmail.com>

Hi

Here is another recent article plus two follow up interviews; one with
Carl from Red Hat, and one with yours truly.

http://www1.interopsystems.com/analysis/can-amqp-break-ibms-mom-monopoly-part-1.html

This is good for people wanting business context ie. 'something you
can show to the boss'.

alexis



From 0x6e6562 at gmail.com  Fri Aug  1 13:06:11 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Fri, 1 Aug 2008 13:06:11 +0100
Subject: [rabbitmq-discuss] Unbind patch
Message-ID: <269388e30808010506v7d48cbebjb72a1ba7b6936361@mail.gmail.com>

Aman,

Here is patch to allow the queue unbind command in the current Rabbit
source tree:

http://www.bitbucket.org/0x6e6562/unbind-patch/changeset/65d57a7d9a28

I put it into bitbucket so that

a) it doesn't exist as confusing branch in our tree,
b) also it's quick and dirty and is not factored out properly, but
there is a test case :-)
c) I can see if we can work in github style fashion but with hg

To get it rock and roll, in the same parent directory,

1. hg clone https://www.bitbucket.org/0x6e6562/codegen-unbind-patch/
2. hg clone https://www.bitbucket.org/0x6e6562/unbind-patch/
3. cd unbind-patch
4. make SIBLING_CODEGEN_DIR=../codegen-unbind-patch/
5. Boot Rabbit: erl -pa ebin -mnesia dir foobar -boot start_sasl -s rabbit
6. Run test:

$ erl -pa ebin/ PATH_TO_RABBIT_ERLANG_CLIENT/ebin/
Erlang (BEAM) emulator version 5.6.3 [source] [smp:2]
[async-threads:0] [hipe] [kernel-poll:false]

Eshell V5.6.3  (abort with ^G)
1> unbind_test:test().
ok

Done.

HTH,

Ben



From 0x6e6562 at gmail.com  Fri Aug  1 13:08:18 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Fri, 1 Aug 2008 13:08:18 +0100
Subject: [rabbitmq-discuss] Unbind patch
In-Reply-To: <269388e30808010506v7d48cbebjb72a1ba7b6936361@mail.gmail.com>
References: <269388e30808010506v7d48cbebjb72a1ba7b6936361@mail.gmail.com>
Message-ID: <269388e30808010508s2dc9984bo161d30dabbac4ead@mail.gmail.com>

Aman,

BTW I didn't know that you'd talked to Tony about getting him to do
the same thing. Luckily we decided to talk to each other today and
avoided duplication of work :-)

Ben



From matthias at lshift.net  Fri Aug  1 15:11:12 2008
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 01 Aug 2008 15:11:12 +0100
Subject: [rabbitmq-discuss] Replay order
In-Reply-To: <73b10e5b0807301309o200c254aj12965a4f46690842@mail.gmail.com>
References: <73b10e5b0807301309o200c254aj12965a4f46690842@mail.gmail.com>
Message-ID: <48931980.7070805@lshift.net>

Petr,

Petr Sturc wrote:
> the 1.4.0 "Release highlights" is mentioning that there is bugfix for
> "maintain message order on persister replay".
> Does it mean the messages are replayed in the same order there way sent?

Following the bugfix, the ordering guarantees provided by AMQP are 
preserved in the event of a replay of persisted messages after a broker 
restart.

AMQP's ordering guarantees are fairly straightforward at first glance 
but turn out to be surprisingly tricky to pin down precisely. Here's an 
attempt at doing the latter, courtesy of my colleague Tony 
Garnock-Jones. Take a deep breath ...

BEGIN

AMQP's transports MUST preserve the order of AMQP commands issued on a 
single channel, meaning that one command (such as a basic.publish, or a 
basic.deliver) can be seen to arrive before or after another carried on 
the same channel.

Let M1 and M2 be two messages, published
  - at the same message priority
  - via the same channel
  - to the same exchange.

Let us examine the case where M1 arrives at the server before M2.

If a particular queue should wind up with copies of both M1 and M2, and 
further if both M1 and M2 are to be sent from that queue
  - down the same channel
  - using basic.deliver
  - with the same consumer-tag,
then the basic.deliver carrying M1 MUST be sent before the basic.deliver 
carrying M2, unless the "redelivered" flag happens to be set on one or 
both of the basic.deliver commands.

If two basic.get operations are issued in sequence
  - on the same channel
  - reading from the same queue, and
  - those two basic.get operations happen to retrieve M1 and M2,
then M1 MUST be returned by the first basic.get-ok, and M2 MUST be 
returned by the second basic.get-ok, unless the "redelivered" flag 
happens to be set on one or both of the basic.get-ok commands.

In all situations not covered by the text above, the server is under no 
obligation to preserve ordering between M1 and M2, but MAY do so.

END

Simple, isn't it? ;)

  > I am playing with single producer and two consumers taking messages
> from the same queue without ACK. I am receiving them in round-robin
> order as expected. When I stop the consumers and connect another one
> WITH ACK, the messages are redelivered, but with no particular order.
> Is it correcect behavour? How does it correspond to the claim about
> maintaining message order?

As noted above, order may not be preserved for redelivered messages.


Regards,

Matthias.



From 0x6e6562 at gmail.com  Fri Aug  1 21:56:52 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Fri, 1 Aug 2008 21:56:52 +0100
Subject: [rabbitmq-discuss]  Information about EndlessSummerOfCode
In-Reply-To: <269388e30808011356g5106ec3byb2b2aece1a29a841@mail.gmail.com>
References: <72b4c7110807312008p17510e64vb45da9a3c7a96ec@mail.gmail.com>
	<269388e30808010156g1bb5f554x94fcc6a1508b49e3@mail.gmail.com>
	<73b10e5b0808011256v6d448486he944d8650dc07a51@mail.gmail.com>
	<269388e30808011356g5106ec3byb2b2aece1a29a841@mail.gmail.com>
Message-ID: <269388e30808011356i6f8fe6a2k1cc7f05201f84e9d@mail.gmail.com>

Petr,

On Fri, Aug 1, 2008 at 8:56 PM, Petr Sturc <petr.sturc at gmail.com> wrote:
> where is available the list you have mentioned?

https://dev.rabbitmq.com/wiki/EndlessSummerOfCode

Ben



From manuel+rabbitmq at aguete.org  Mon Aug  4 07:16:48 2008
From: manuel+rabbitmq at aguete.org (Manuel Duran Aguete)
Date: Mon, 4 Aug 2008 08:16:48 +0200
Subject: [rabbitmq-discuss] RabbitMQ server to server connection
Message-ID: <8bb2c19f0808032316q213e5821had2d36ebbee8e608@mail.gmail.com>

Hello,

I'm testing rabbitmq to use with an application that currently work with
MQSeries from IBM.

Is there any method to interconnect two rabbitmq servers like two MQSeries
servers ?


Thanks. Regards.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080804/2b7f4457/attachment.htm 

From rgl at ruilopes.com  Mon Aug  4 07:20:23 2008
From: rgl at ruilopes.com (Rui Lopes)
Date: Mon, 04 Aug 2008 07:20:23 +0100
Subject: [rabbitmq-discuss] RabbitMQ server to server connection
In-Reply-To: <8bb2c19f0808032316q213e5821had2d36ebbee8e608@mail.gmail.com>
References: <8bb2c19f0808032316q213e5821had2d36ebbee8e608@mail.gmail.com>
Message-ID: <48969FA7.7070709@ruilopes.com>

Hi,

Manuel Duran Aguete wrote:
> I'm testing rabbitmq to use with an application that currently work 
> with MQSeries from IBM.
>
> Is there any method to interconnect two rabbitmq servers like two 
> MQSeries servers ?
I don't known how MQSeries works, but if you didn't already, read the 
clustering documentation at:

    http://www.rabbitmq.com/clustering.html

(you access it through the Documentation link in RMQ home page).

Best regards,
Rui Lopes



From 0x6e6562 at gmail.com  Mon Aug  4 19:41:18 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Mon, 4 Aug 2008 19:41:18 +0100
Subject: [rabbitmq-discuss] RabbitMQ server to server connection
In-Reply-To: <8bb2c19f0808032316q213e5821had2d36ebbee8e608@mail.gmail.com>
References: <8bb2c19f0808032316q213e5821had2d36ebbee8e608@mail.gmail.com>
Message-ID: <269388e30808041141j30a13898rd554c7cb52e2d663@mail.gmail.com>

Manuel,

On Mon, Aug 4, 2008 at 7:16 AM, Manuel Duran Aguete
<manuel+rabbitmq at aguete.org> wrote:
> I'm testing rabbitmq to use with an application that currently work with
> MQSeries from IBM.
>
> Is there any method to interconnect two rabbitmq servers like two MQSeries
> servers ?

Are you talking about setting up transmission queues on your local QM
to forward messages to a remote queue on another QM?

Ben



From 0x6e6562 at gmail.com  Tue Aug  5 09:44:25 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Tue, 5 Aug 2008 09:44:25 +0100
Subject: [rabbitmq-discuss] RabbitMQ server to server connection
In-Reply-To: <8bb2c19f0808050001q2788fcd8o208072931b5cb26b@mail.gmail.com>
References: <8bb2c19f0808032316q213e5821had2d36ebbee8e608@mail.gmail.com>
	<269388e30808041141j30a13898rd554c7cb52e2d663@mail.gmail.com>
	<8bb2c19f0808050001q2788fcd8o208072931b5cb26b@mail.gmail.com>
Message-ID: <269388e30808050144u40cbed2bwfe63118cbf82903f@mail.gmail.com>

Manuel,

On Tue, Aug 5, 2008 at 8:01 AM, Manuel Duran Aguete
<manuel+rabbitmq at aguete.org> wrote:
> Enterprise A has a mq installed, Enterprise B has another mq installed, an
> application in A want to request some information and send a message to a
> queue in B. The mq in A routes the message to B usign some criteria.
> Application in B responds to A, by sending the response throught B.

One option to do the same things as transmission queues is described
here: http://hopper.squarespace.com/blog/2008/6/22/introducing-shovel-an-amqp-relay.html

Having said that, you may want to ask yourself whether you need to do
things in the same as MQ series.

An alternative to this, which may or may not suit is B to be a plain
consumer on the broker inside A.

This would be a simple asynchronous RPC pattern.

Although I'm not pretending to be an expert on MQ series, some of the
reason why different enterprises use transmission queues is because
the MQ series client doesn't work over a WAN very well, so people tend
to notice a lot more reliability and efficiency letting a two QMs
forward messages to each each. I think encryption, authentication and
demarcation of responsibility play a role as well.

AMQP, on the other hand, has been designed partly with remote
connections in mind so as a plain jane AMQP client, you can consume
directly from a "remote" queue and publish directly to a "remote"
exchange.

On the other hand, one advantage of relay queues (or transmission
queues in MQ parlance) is that do allow you to buffer and compress
messages going across a WAN, which may be an efficiency gain.

HTH,

Ben



From David.Corcoran at edftrading.com  Tue Aug  5 14:15:29 2008
From: David.Corcoran at edftrading.com (David.Corcoran at edftrading.com)
Date: Tue, 5 Aug 2008 14:15:29 +0100
Subject: [rabbitmq-discuss] RabbitMQ logs, ticket check
Message-ID: <OF3C09A3E6.D9429920-ON8025749C.00486377-8025749C.0048D473@Edftrading.com>


Hey,

The followings warnings have just started appearing in our RabbitMQ logs:
"=WARNING REPORT==== 5-Aug-2008::14:06:15 ===
Lax ticket check mode: ignoring cross-realm access for ticket 101"

Any idea what that is usually a sign of? I thought it might be sharing a
ticket between different channels but I don't do that. The only thing I've
really changed is that I've started listening on a topic. Before I used to
just use queues.

Thanks,

Dave


*********************************************************************
This communication contains confidential information, some or all of which may be privileged. It is for the intended recipient only and others must not disclose, distribute, copy, print or rely on this communication. If an addressing or transmission error has misdirected this communication, please notify the sender by replying to this e-mail and then delete the e-mail. E-mail sent to EDF Trading may be monitored by the company. Thank you. 
EDF Trading Limited
80 Victoria Street, 3rd Floor, Cardinal Place, London, SW1E 5JL
A Company registered in England No. 4255974. 
Switchboard: 020 7061 4000
EDF Trading Markets Limited is a member of the EDF Trading Limited Group and is authorised and regulated by the Financial Services Authority.
VAT number: GB 735 5479 07
*********************************************************************



From David.Corcoran at edftrading.com  Tue Aug  5 15:03:05 2008
From: David.Corcoran at edftrading.com (David.Corcoran at edftrading.com)
Date: Tue, 5 Aug 2008 15:03:05 +0100
Subject: [rabbitmq-discuss] RabbitMQ logs, ticket check
In-Reply-To: <OF3C09A3E6.D9429920-ON8025749C.00486377-8025749C.0048D473@Edftrading.com>
Message-ID: <OF66053B8E.2B224A02-ON8025749C.004BD2D5-8025749C.004D2FD6@Edftrading.com>

Hi,

Never mind. I figured out what was happening. We're doing something
slightly odd in that we're sharing a single connection between several
threads that are running in different classloaders. The connections are
thread safe but something strange happens when you run code that creates a
channel, ticket and connects to a queue in different classloaders. By
making that part of the code synchronized it works fine.

Regards,

Dave



                                                                           
             David.Corcoran at ed                                             
             ftrading.com                                                  
             Sent by:                                                   To 
             rabbitmq-discuss-         rabbitmq                            
             bounces at lists.rab         <rabbitmq-discuss at lists.rabbitmq.co 
             bitmq.com                 m>                                  
                                                                        cc 
                                                                           
             05/08/2008 14:15                                      Subject 
                                       [rabbitmq-discuss] RabbitMQ logs,   
                                       ticket check                        
                                                                           
                                                                           
                                                                           
                                                                           
                                                                           
                                                                           






Hey,

The followings warnings have just started appearing in our RabbitMQ logs:
"=WARNING REPORT==== 5-Aug-2008::14:06:15 ===
Lax ticket check mode: ignoring cross-realm access for ticket 101"

Any idea what that is usually a sign of? I thought it might be sharing a
ticket between different channels but I don't do that. The only thing I've
really changed is that I've started listening on a topic. Before I used to
just use queues.

Thanks,

Dave


*********************************************************************
This communication contains confidential information, some or all of which
may be privileged. It is for the intended recipient only and others must
not disclose, distribute, copy, print or rely on this communication. If an
addressing or transmission error has misdirected this communication, please
notify the sender by replying to this e-mail and then delete the e-mail.
E-mail sent to EDF Trading may be monitored by the company. Thank you.
EDF Trading Limited
80 Victoria Street, 3rd Floor, Cardinal Place, London, SW1E 5JL
A Company registered in England No. 4255974.
Switchboard: 020 7061 4000
EDF Trading Markets Limited is a member of the EDF Trading Limited Group
and is authorised and regulated by the Financial Services Authority.
VAT number: GB 735 5479 07
*********************************************************************

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



*********************************************************************
This communication contains confidential information, some or all of which may be privileged. It is for the intended recipient only and others must not disclose, distribute, copy, print or rely on this communication. If an addressing or transmission error has misdirected this communication, please notify the sender by replying to this e-mail and then delete the e-mail. E-mail sent to EDF Trading may be monitored by the company. Thank you. 
EDF Trading Limited
80 Victoria Street, 3rd Floor, Cardinal Place, London, SW1E 5JL
A Company registered in England No. 4255974. 
Switchboard: 020 7061 4000
EDF Trading Markets Limited is a member of the EDF Trading Limited Group and is authorised and regulated by the Financial Services Authority.
VAT number: GB 735 5479 07
*********************************************************************



From rabbitmq-discuss_efine at usa.net  Tue Aug  5 15:20:17 2008
From: rabbitmq-discuss_efine at usa.net (Edwin Fine)
Date: Tue, 5 Aug 2008 10:20:17 -0400
Subject: [rabbitmq-discuss] RabbitMQ logs, ticket check
In-Reply-To: <6c2563b20808050718u751307c4k6f738909bfa7365e@mail.gmail.com>
References: <OF3C09A3E6.D9429920-ON8025749C.00486377-8025749C.0048D473@Edftrading.com>
	<OF66053B8E.2B224A02-ON8025749C.004BD2D5-8025749C.004D2FD6@Edftrading.com>
	<6c2563b20808050718u751307c4k6f738909bfa7365e@mail.gmail.com>
Message-ID: <6c2563b20808050720p3bba067ftc62fb6ce6cd2f30f@mail.gmail.com>

I get the same issue (for the same reason) using the Erlang client, namely
"Lax ticket check mode: ignoring cross-realm access for ticket 101"
 I'd appreciate an explanation as to what changed between 1.3.0 and 1.4.0 to
make this happen, and a suggestion on what I need to do to get rid of the
warning.

Edwin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080805/cb6dc7df/attachment.htm 

From David.Corcoran at edftrading.com  Tue Aug  5 15:41:13 2008
From: David.Corcoran at edftrading.com (David.Corcoran at edftrading.com)
Date: Tue, 5 Aug 2008 15:41:13 +0100
Subject: [rabbitmq-discuss] RabbitMQ logs, ticket check
In-Reply-To: <6c2563b20808050720p3bba067ftc62fb6ce6cd2f30f@mail.gmail.com>
Message-ID: <OF8844880F.66ECE908-ON8025749C.00506CEF-8025749C.0050ADD9@Edftrading.com>

Actually I spoke too soon about fixing the problem. Making the code
synchronized seemed to help at one point but with more threads I'm getting
more errors.

I agree with Edwin about the versions. Testing it against RabbitMQ 1.3.0
shows no errors in the logs.

Dave



                                                                           
             "Edwin Fine"                                                  
             <rabbitmq-discuss                                             
             _efine at usa.net>                                            To 
             Sent by:                  rabbitmq                            
             rabbitmq-discuss-         <rabbitmq-discuss at lists.rabbitmq.co 
             bounces at lists.rab         m>                                  
             bitmq.com                                                  cc 
                                                                           
                                                                   Subject 
             05/08/2008 15:20          Re: [rabbitmq-discuss] RabbitMQ     
                                       logs, ticket check                  
                                                                           
                                                                           
                                                                           
                                                                           
                                                                           
                                                                           





I get the same issue (for the same reason) using the Erlang client, namely
"Lax ticket check mode: ignoring cross-realm access for ticket 101"
 I'd appreciate an explanation as to what changed between 1.3.0 and 1.4.0
to make this happen, and a suggestion on what I need to do to get rid of
the warning.

Edwin_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



*********************************************************************
This communication contains confidential information, some or all of which may be privileged. It is for the intended recipient only and others must not disclose, distribute, copy, print or rely on this communication. If an addressing or transmission error has misdirected this communication, please notify the sender by replying to this e-mail and then delete the e-mail. E-mail sent to EDF Trading may be monitored by the company. Thank you. 
EDF Trading Limited
80 Victoria Street, 3rd Floor, Cardinal Place, London, SW1E 5JL
A Company registered in England No. 4255974. 
Switchboard: 020 7061 4000
EDF Trading Markets Limited is a member of the EDF Trading Limited Group and is authorised and regulated by the Financial Services Authority.
VAT number: GB 735 5479 07
*********************************************************************



From 0x6e6562 at gmail.com  Tue Aug  5 15:57:20 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Tue, 5 Aug 2008 15:57:20 +0100
Subject: [rabbitmq-discuss] RabbitMQ logs, ticket check
In-Reply-To: <269388e30808050756g58177fc4wc8257085c8f98650@mail.gmail.com>
References: <OF3C09A3E6.D9429920-ON8025749C.00486377-8025749C.0048D473@Edftrading.com>
	<OF66053B8E.2B224A02-ON8025749C.004BD2D5-8025749C.004D2FD6@Edftrading.com>
	<6c2563b20808050718u751307c4k6f738909bfa7365e@mail.gmail.com>
	<6c2563b20808050720p3bba067ftc62fb6ce6cd2f30f@mail.gmail.com>
	<269388e30808050756g58177fc4wc8257085c8f98650@mail.gmail.com>
Message-ID: <269388e30808050757p67a75082yea8ed5d3d389c1d6@mail.gmail.com>

Edwin, David,

On Tue, Aug 5, 2008 at 3:20 PM, Edwin Fine
<rabbitmq-discuss_efine at usa.net> wrote:
> I get the same issue (for the same reason) using the Erlang client, namely
> "Lax ticket check mode: ignoring cross-realm access for ticket 101"
>  I'd appreciate an explanation as to what changed between 1.3.0 and 1.4.0 to
> make this happen, and a suggestion on what I need to do to get rid of the
> warning.

By default, strict ticket checking is turned off, which means that
Rabbit will not enforce strict realm based ACL.

When this is turned off, and a client sends down an invalid ticket,
this will be treated as a NOOP and merely logged.

This is useful for development scenarios.

Usually you would turn this on in production, in which you actually
cared about this type of ACL.

Having said all of this, the whole topic of realm based access control
is going to disappear very soon.

We have decided that because although realms are in the spec, no other
AMQP broker has bothered to implement them, and hence we should follow
suit.

Furthermore, realms are confusing, too fine grained as an ACL concept
and the cost of their maintenance is not really justified by the
minimal benefits they offer.

For example, in Rabbit 1.3.0, 12% of the entire code base was
dedicated to realm handling.

Having said all of this, and for the record, what has changed between
1.3 and 1.4 is that a bug has been introduced, which we have already
noted in our internal bug system.

But instead of fixing this bug, because we are deleting realms anyway,
we have decided to push through the realm deletion patch first
(bug18994 in hg refers).

We are in the late stages of QA'ing this, it will be merged into the
default branch soon and upon which a new release will be made.

HTH,

Ben



From rabbitmq-discuss_efine at usa.net  Tue Aug  5 16:12:55 2008
From: rabbitmq-discuss_efine at usa.net (Edwin Fine)
Date: Tue, 5 Aug 2008 11:12:55 -0400
Subject: [rabbitmq-discuss] RabbitMQ logs, ticket check
In-Reply-To: <269388e30808050756g58177fc4wc8257085c8f98650@mail.gmail.com>
References: <OF3C09A3E6.D9429920-ON8025749C.00486377-8025749C.0048D473@Edftrading.com>
	<OF66053B8E.2B224A02-ON8025749C.004BD2D5-8025749C.004D2FD6@Edftrading.com>
	<6c2563b20808050718u751307c4k6f738909bfa7365e@mail.gmail.com>
	<6c2563b20808050720p3bba067ftc62fb6ce6cd2f30f@mail.gmail.com>
	<269388e30808050756g58177fc4wc8257085c8f98650@mail.gmail.com>
Message-ID: <6c2563b20808050812j13fb476apc4d8c9b2ebb98e36@mail.gmail.com>

Ben,

Um, does this mean that:

In rabbitmqctl,

  add_realm    <VHostPath> <RealmName>
  delete_realm <VHostPath> <RealmName>
  list_realms  <VHostPath>
  set_permissions  <UserName> <VHostPath> <RealmName> [<Permission> ...]

will disappear?

Furthermore, does this mean that our code will have to remove all references
to realms? Or are you leaving all that syntax in place but just making it a
NOOP?

Regards,
Edwin

On Tue, Aug 5, 2008 at 10:56 AM, Ben Hood <0x6e6562 at gmail.com> wrote:

> Edwin, David,
>
> On Tue, Aug 5, 2008 at 3:20 PM, Edwin Fine
> <rabbitmq-discuss_efine at usa.net> wrote:
> > I get the same issue (for the same reason) using the Erlang client,
> namely
> > "Lax ticket check mode: ignoring cross-realm access for ticket 101"
> >  I'd appreciate an explanation as to what changed between 1.3.0 and 1.4.0
> to
> > make this happen, and a suggestion on what I need to do to get rid of the
> > warning.
>
> By default, strict ticket checking is turned off, which means that
> Rabbit will not enforce strict realm based ACL.
>
> When this is turned off, and a client sends down an invalid ticket,
> this will be treated as a NOOP and merely logged.
>
> This is useful for development scenarios.
>
> Usually you would turn this on in production, in which you actually
> cared about this type of ACL.
>
> Having said all of this, the whole topic of realm based access control
> is going to disappear very soon.
>
> We have decided that because although realms are in the spec, no other
> AMQP broker has bothered to implement them, and hence we should follow
> suit.
>
> Furthermore, realms are confusing, too fine grained as an ACL concept
> and the cost of their maintenance is not really justified by the
> minimal benefits they offer.
>
> For example, in Rabbit 1.3.0, 12% of the entire code base was
> dedicated to realm handling.
>
> Having said all of this, and for the record, what has changed between
> 1.3 and 1.4 is that a bug has been introduced, which we have already
> noted in our internal bug system.
>
> But instead of fixing this bug, because we are deleting realms anyway,
> we have decided to push through the realm deletion patch first
> (bug18994 in hg refers).
>
> We are in the late stages of QA'ing this, it will be merged into the
> default branch soon and upon which a new release will be made.
>
> HTH,
>
> Ben
>
>


-- 
For every expert there is an equal and opposite expert - Arthur C. Clarke
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080805/3ad37602/attachment.htm 

From 0x6e6562 at gmail.com  Tue Aug  5 16:58:25 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Tue, 5 Aug 2008 16:58:25 +0100
Subject: [rabbitmq-discuss] RabbitMQ logs, ticket check
In-Reply-To: <6c2563b20808050812j13fb476apc4d8c9b2ebb98e36@mail.gmail.com>
References: <OF3C09A3E6.D9429920-ON8025749C.00486377-8025749C.0048D473@Edftrading.com>
	<OF66053B8E.2B224A02-ON8025749C.004BD2D5-8025749C.004D2FD6@Edftrading.com>
	<6c2563b20808050718u751307c4k6f738909bfa7365e@mail.gmail.com>
	<6c2563b20808050720p3bba067ftc62fb6ce6cd2f30f@mail.gmail.com>
	<269388e30808050756g58177fc4wc8257085c8f98650@mail.gmail.com>
	<6c2563b20808050812j13fb476apc4d8c9b2ebb98e36@mail.gmail.com>
Message-ID: <269388e30808050858l1bb0bafay2814b82928de78be@mail.gmail.com>

Edwin,

On Tue, Aug 5, 2008 at 4:12 PM, Edwin Fine
<rabbitmq-discuss_efine at usa.net> wrote:
> Ben,
>
> Um, does this mean that:
>
> In rabbitmqctl,
>
>   add_realm    <VHostPath> <RealmName>
>   delete_realm <VHostPath> <RealmName>
>   list_realms  <VHostPath>
>   set_permissions  <UserName> <VHostPath> <RealmName> [<Permission> ...]
>
> will disappear?

Yes.

> Furthermore, does this mean that our code will have to remove all references
> to realms? Or are you leaving all that syntax in place but just making it a
> NOOP?

If you using an internal API, e.g. rabbitmqctl, then yes, we are
removing all references to it.

Internal APIs are always subject to change.

If you are using the wire protocol, the access.request command and
usage of tickets will become NOOPs.

Also, although I can't say with any certainty, because it is pending a
vote by the working group on 0-9 SP1, the fields *may* also be removed
from the wire format.

However, if you are using the Erlang client, this will be transparent to you.

Just out of interest's sake, what functionality are you actually using
wrt to realms?

HTH,

Ben



From rabbitmq-discuss_efine at usa.net  Tue Aug  5 17:33:04 2008
From: rabbitmq-discuss_efine at usa.net (Edwin Fine)
Date: Tue, 5 Aug 2008 12:33:04 -0400
Subject: [rabbitmq-discuss] RabbitMQ logs, ticket check
In-Reply-To: <269388e30808050858l1bb0bafay2814b82928de78be@mail.gmail.com>
References: <OF3C09A3E6.D9429920-ON8025749C.00486377-8025749C.0048D473@Edftrading.com>
	<OF66053B8E.2B224A02-ON8025749C.004BD2D5-8025749C.004D2FD6@Edftrading.com>
	<6c2563b20808050718u751307c4k6f738909bfa7365e@mail.gmail.com>
	<6c2563b20808050720p3bba067ftc62fb6ce6cd2f30f@mail.gmail.com>
	<269388e30808050756g58177fc4wc8257085c8f98650@mail.gmail.com>
	<6c2563b20808050812j13fb476apc4d8c9b2ebb98e36@mail.gmail.com>
	<269388e30808050858l1bb0bafay2814b82928de78be@mail.gmail.com>
Message-ID: <6c2563b20808050933x537c29b2j50b0a774218ec66e@mail.gmail.com>

Ben,

setup_channel(Connection, Realm) ->
    Channel = amqp_connection:open_channel(Connection),
    Access = #'access.request'{realm = Realm,
                               exclusive = false,
                               passive = true,
                               active = true,
                               write = true,
                               read = true},
    #'access.request_ok'{ticket = Ticket} = amqp_channel:call(Channel,
Access),
    {Channel, Ticket}.

This is used in a few places, which pass Realm around, so they will have to
be changed. I also use it with the internal API to create realms using
Erlang, but of course I am not complaining about that changing.

Regards,
Edwin

On Tue, Aug 5, 2008 at 11:58 AM, Ben Hood <0x6e6562 at gmail.com> wrote:

> Edwin,
>
> On Tue, Aug 5, 2008 at 4:12 PM, Edwin Fine
> <rabbitmq-discuss_efine at usa.net> wrote:
> > Ben,
> >
> > Um, does this mean that:
> >
> > In rabbitmqctl,
> >
> >   add_realm    <VHostPath> <RealmName>
> >   delete_realm <VHostPath> <RealmName>
> >   list_realms  <VHostPath>
> >   set_permissions  <UserName> <VHostPath> <RealmName> [<Permission> ...]
> >
> > will disappear?
>
> Yes.
>
> > Furthermore, does this mean that our code will have to remove all
> references
> > to realms? Or are you leaving all that syntax in place but just making it
> a
> > NOOP?
>
> If you using an internal API, e.g. rabbitmqctl, then yes, we are
> removing all references to it.
>
> Internal APIs are always subject to change.
>
> If you are using the wire protocol, the access.request command and
> usage of tickets will become NOOPs.
>
> Also, although I can't say with any certainty, because it is pending a
> vote by the working group on 0-9 SP1, the fields *may* also be removed
> from the wire format.
>
> However, if you are using the Erlang client, this will be transparent to
> you.
>
> Just out of interest's sake, what functionality are you actually using
> wrt to realms?
>
> HTH,
>
> Ben
>
>


-- 
For every expert there is an equal and opposite expert - Arthur C. Clarke
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080805/2311eded/attachment.htm 

From matthias at lshift.net  Tue Aug  5 18:20:22 2008
From: matthias at lshift.net (Matthias Radestock)
Date: Tue, 05 Aug 2008 18:20:22 +0100
Subject: [rabbitmq-discuss] RabbitMQ logs, ticket check
In-Reply-To: <6c2563b20808050933x537c29b2j50b0a774218ec66e@mail.gmail.com>
References: <OF3C09A3E6.D9429920-ON8025749C.00486377-8025749C.0048D473@Edftrading.com>	<OF66053B8E.2B224A02-ON8025749C.004BD2D5-8025749C.004D2FD6@Edftrading.com>	<6c2563b20808050718u751307c4k6f738909bfa7365e@mail.gmail.com>	<6c2563b20808050720p3bba067ftc62fb6ce6cd2f30f@mail.gmail.com>	<269388e30808050756g58177fc4wc8257085c8f98650@mail.gmail.com>	<6c2563b20808050812j13fb476apc4d8c9b2ebb98e36@mail.gmail.com>	<269388e30808050858l1bb0bafay2814b82928de78be@mail.gmail.com>
	<6c2563b20808050933x537c29b2j50b0a774218ec66e@mail.gmail.com>
Message-ID: <48988BD6.3000202@lshift.net>

Edwin,

Edwin Fine wrote:
> setup_channel(Connection, Realm) ->
>     Channel = amqp_connection:open_channel(Connection),
>     Access = #'access.request'{realm = Realm,
>                                exclusive = false,
>                                passive = true,
>                                active = true,
>                                write = true,
>                                read = true},
>     #'access.request_ok'{ticket = Ticket} = amqp_channel:call(Channel, 
> Access),
>     {Channel, Ticket}.
> 
> This is used in a few places, which pass Realm around, so they will have 
> to be changed.

The above will continue to work until realms & tickets are removed from 
the protocol.

We are going to be removing realms & tickets in the following stages:

1) Removal from the server internals and admin interface. Application 
code using the APIs of the various clients, and code that uses the AMQ 
protocol directly, will largely be unaffected since the protocol methods 
haven't changed and the server continues to respond to access.request 
method. Only code that that actively relies on the access control 
provided by realms will break with this change. I don't think there is 
much of that about.

2) Removal from the high-level client APIs. This will require some 
changes to application code, but these should all be very 
straightforward. Also note that there is nothing forcing you to upgrade 
to the new versions of the client; the old clients will continue to 
function. And code that uses the AMQP protocol more directly, such as 
the code above, will remain unaffected.

3) Removal from the protocol. At this point all application code must 
use the new client APIs and code that uses the AMQP protocol more 
directly will need to be changed. Again, the changes should be 
straightforward.


We are about to carry out step 1. Step 2 is still a few weeks off. And 
step 3 won't happen until after the AMQP Working Group has published a 
spec which removes realms & tickets.


Hope the above is ok with everybody; if, otoh, you are really fond of 
tickets and realms and don't want to live without them then please let 
us know :)


Matthias.



From rabbitmq-discuss_efine at usa.net  Tue Aug  5 20:28:05 2008
From: rabbitmq-discuss_efine at usa.net (Edwin Fine)
Date: Tue, 5 Aug 2008 15:28:05 -0400
Subject: [rabbitmq-discuss] RabbitMQ logs, ticket check
In-Reply-To: <48988BD6.3000202@lshift.net>
References: <OF3C09A3E6.D9429920-ON8025749C.00486377-8025749C.0048D473@Edftrading.com>
	<OF66053B8E.2B224A02-ON8025749C.004BD2D5-8025749C.004D2FD6@Edftrading.com>
	<6c2563b20808050718u751307c4k6f738909bfa7365e@mail.gmail.com>
	<6c2563b20808050720p3bba067ftc62fb6ce6cd2f30f@mail.gmail.com>
	<269388e30808050756g58177fc4wc8257085c8f98650@mail.gmail.com>
	<6c2563b20808050812j13fb476apc4d8c9b2ebb98e36@mail.gmail.com>
	<269388e30808050858l1bb0bafay2814b82928de78be@mail.gmail.com>
	<6c2563b20808050933x537c29b2j50b0a774218ec66e@mail.gmail.com>
	<48988BD6.3000202@lshift.net>
Message-ID: <6c2563b20808051228u18ad34dbw1c263d7840d5a95f@mail.gmail.com>

Matthias, thanks for the very clear answer.

I don't have any attachment to or need for realms, so as far as I am
concerned, they can disappear and won't be missed. I will definitely remove
realm-related items from my code once they become NOOPs.

Regards,
Edwin

On Tue, Aug 5, 2008 at 1:20 PM, Matthias Radestock <matthias at lshift.net>wrote:

> Edwin,
>
> Edwin Fine wrote:
>
>> setup_channel(Connection, Realm) ->
>>    Channel = amqp_connection:open_channel(Connection),
>>    Access = #'access.request'{realm = Realm,
>>                               exclusive = false,
>>                               passive = true,
>>                               active = true,
>>                               write = true,
>>                               read = true},
>>    #'access.request_ok'{ticket = Ticket} = amqp_channel:call(Channel,
>> Access),
>>    {Channel, Ticket}.
>>
>> This is used in a few places, which pass Realm around, so they will have
>> to be changed.
>>
>
> The above will continue to work until realms & tickets are removed from the
> protocol.
>
> We are going to be removing realms & tickets in the following stages:
>
> 1) Removal from the server internals and admin interface. Application code
> using the APIs of the various clients, and code that uses the AMQ protocol
> directly, will largely be unaffected since the protocol methods haven't
> changed and the server continues to respond to access.request method. Only
> code that that actively relies on the access control provided by realms will
> break with this change. I don't think there is much of that about.
>
> 2) Removal from the high-level client APIs. This will require some changes
> to application code, but these should all be very straightforward. Also note
> that there is nothing forcing you to upgrade to the new versions of the
> client; the old clients will continue to function. And code that uses the
> AMQP protocol more directly, such as the code above, will remain unaffected.
>
> 3) Removal from the protocol. At this point all application code must use
> the new client APIs and code that uses the AMQP protocol more directly will
> need to be changed. Again, the changes should be straightforward.
>
>
> We are about to carry out step 1. Step 2 is still a few weeks off. And step
> 3 won't happen until after the AMQP Working Group has published a spec which
> removes realms & tickets.
>
>
> Hope the above is ok with everybody; if, otoh, you are really fond of
> tickets and realms and don't want to live without them then please let us
> know :)
>
>
> Matthias.
>
>


-- 
For every expert there is an equal and opposite expert - Arthur C. Clarke
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080805/b9919b79/attachment.htm 

From mrcoder at yahoo.com  Thu Aug  7 19:24:26 2008
From: mrcoder at yahoo.com (Geoffrey Anderson)
Date: Thu, 7 Aug 2008 11:24:26 -0700 (PDT)
Subject: [rabbitmq-discuss] difficulty closing connections in Windows Forms
	apps
Message-ID: <633272.79733.qm@web30005.mail.mud.yahoo.com>

I am writing a Windows application (Windows form / executable) on Windows XP OS. I
am using rabbitmq-dotnet-client-1.4.0-net-2.0 to interface to RabbitMQ.

It's cool so far but my connection object seems to be stuck between 'a rock and hard
place' when I try to shut down my app.

These are really just the ABC's of making any app with a RabbitMQ server.  I seem to
be stuck on 'A'.  hahah

I have a crazy question.  Is it possible that I the first person to have written a
Windows Form application, you know, on Windows (not Mono), using the dotnet client
library for Rabbit MQ?  Careful, I'm not talking about console applications on
Mono....

I feel like I might be the first one here....   I've seen the example code, of
course, it's console code not a Windows GUI (for Windows, not Linux/Mono).

To Cut to the chase, here is what seems to be the problem:

1. My app is a long running app by its nature, & needs a long running connection. 
Why? Because the connection must be held open for a long time to allow a camera to
feed bitmaps continuously at a high rate of speed to my RabbitMQ.  The connection
needs to close, or be closed, when the app shuts down but no earlier.  OK fine I
know its possible b/c your nice "CAMCAPTURE" demo app works great on my computer. 
Excellent.  Now, in C# terms, this means the 'using' clause is not useful here.  In
other words the design of the app necessarily disallows imitation of the example
code which uses the 'using' style of connection creation and near-term destruction.
In other words I won't be disposing this connection right away.

I tried to solve it two different ways.

2. Scenario A (the Rock):  It hangs the app on shutdown, as if a thread inside the
library "didnt get the memo" that I am shutting down, when the code uses the
technique of setting the connection.AutoClose = True, and therefore the code does
not even try to call connection.Close() since the connection closure is taking care
of itself now.  But it hangs the app, like I said.  ( Please notice I am well aware
that you have to set up at least one channel before setting .AutoClose = true.  Dont
be distracted with that concept, as it's not the problem here.  I am writing my
camera bitmaps into the queue just fine during the applicaton's lifetime. )

3. Scenario B (the Hard place):  When I use connection.AutoClose = False style of
connection management, I added a line of code which executes at FormClose event
which simply does connection.Close().   In this case your .net library throws a
socket error saying that the connection was already destructed and is not a viable
object to be calling Close() on.  (I am paraphrasing, it's not exactly the text.) 
Hmmm...  OK I try one more thing:   I do this to make sure it's open before I close
it, that should prevent some problems, right?  No.  

 If (conn.IsOpen)
    conn.Close()

Well here's the funny thing.  The conn.IsOpen returns true, code execution moves to
the next line, and the conn.Close() doesn't even run.... it throws the error
indicating the connection object was already destructed.   Which is quite odd
because just a moment ago, one line of code earlier, the object was not destructed.

If anyone would like to show me a real Windows app in C# that has a working
connection management pattern, I would love to see it and copy your technique and
move on with my application.  The only requirement, should you choose to accept this
mission, is that you keep the connection open for the entire duration of the Windows
Form application's execution (but no longer than that!).

Am I supposed to avoid calling connection.Close() and just call Dispose()???  I
would think Close is there for a reason....  and that I should be able to call
Close() in some scenarios.  I know that the 'using' statement calls Dispose
implicitly in C#....

I am a beginner and I may be overlookign something, and I sure hope that's the case
actually.  If you can tell me something simple that I can fix in my application code
then I've accmomplished something useful today.

I've written multithreaded code before.  It sure feels like the connection.AutoClose
= True is not actually stopping a library thread like we want it to, when I shut
down my app.  Just a guess.  Could be wrong.


Thanks for reading.

Geoffrey



From smokinn at gmail.com  Fri Aug  8 19:52:15 2008
From: smokinn at gmail.com (Guillaume Theoret)
Date: Fri, 8 Aug 2008 14:52:15 -0400
Subject: [rabbitmq-discuss] Our fight against scammers
Message-ID: <7acec0a40808081152v13d6806s2af594f3e669042c@mail.gmail.com>

First off, I'd like to thank you for this wonderful tool, it's being
put to good use!

I thought you might be interested in knowing how we're using it at my
company as part of a system to identify and rid ourselves of scammers.

It used to be that scammers were easy to spot. An account is created
and immediately mass messages a huge number of others. Suspicious.
Those accounts were flagged and banned.

Also, before I even started working here they'd taken a sort of
scorched earth approach to scam prevention. Scammers usually came from
ips in places like nigeria, south africa, etc so thanks to the wonders
of geoip location entire countries were banned. So the scammers got
smarter. Instead they created multiple accounts that waited a bit and
sent a small number of messages. Harder to spot but not impossible.
Multiple accounts created from the same ip aren't always scammers
(could simply be a nat) but they often are so they were flagged for
review. They also used proxies to create the accounts which finally
putting them under the radar entirely.

Here's where RabbitMQ comes in. I've just finished a new filtering
system where, each time a message is sent, the web server queues up
the sender's message history into RabbitMQ. At the other end I have a
consumer that takes the message, feeds it into crm114 and gets a
result. If it looked scammy I write a log entry in the database for a
moderator to later review. If it turns out to be a false positive it
puts the message history back into the queue, the consumer gets it
back and updates the "good" file. Whenever we have a human report or
other algorithmic matches (I also check message similarity for
possible template spam) that are confirmed by a moderator it puts the
message history into the queue and the consumer takes it out and
updates the "bad" file.

I tried out both the python py-amqplib and RabbitMQ java clients but
I'm currently using the java client because it's a whole lot faster.
Normally I would have much preferred to write my producer and consumer
in python but the speed increase was worth writing a little java code.
With the java client I'm getting incredibly good throughput, so much
so that I imagine we'll be able to stay with a single consumer for a
while. This system isn't live yet so the only throughput numbers I
have is running everything (the server, producer and consumer) on my
average-horsepower laptop but even if it were deployed to my laptop it
would probably be enough for now. (It won't be though we're getting it
a beefy server of course and I'll have a better idea of the real
numbers once the machine arrives.) On my laptop I can send ~8800
messages/sec and I can consume & process ~300 messages/sec.

The way I'm running everything right now is basically like this:

The producer is installed on the web servers and listens on a local
socket. It blindly forwards everything it gets to a RabbitMQ queue.
Basically I did it this way just because there aren't any php
libraries available.

When the php messaging module is hit, it delivers the message as
usual, but it also forwards the message history to the producer on a
local socket. (This step is most probably going to be changed to a
cron job before deployment but for now on the dev platform it's
running like this)

The consumer has its own box with crm114 installed. (The RabbitMQ
server will probably be installed on this box as well.) It waits on
the queue and processes the histories based on crm114 output.

Of course, using RabbitMQ for such a simple scenario is probably
incredible overkill (though not really when seen from an effort
perspective since it was actually reasonably easy to learn, set up and
get going) when I could've easily used something like beanstalkd given
that guaranteed delivery isn't all that important but this was really
just a proof-of-concept for a (probably sooner rather than) later
project of writing our own financial transaction processing that of
course needs to be much more rigorous.

Also, this many-producer (we have a bunch of web servers) one-listener
scenario is fine for now but later on we're most probably going to
need more than one box for message analysis. This is where I run into
a distribution problem and where crm114 will shine. For now what I
feed into the queue is an xml message with an action to be performed
(pick, learnbad, learngood), an optional member id and a message
history. Why this won't scale to many consumers is that crm114 keeps
its "good" and "bad" database as a statistics file on disk. Later,
when I need more consumer boxes I can easily refactor this to one box
that listens on a learn queue and, whenever it updates a file (these
are rare since it's human moderators that generate these updates),
drops the modified file into the queue that all pick consumers are
listening on and they can all replace the right statistics file by the
new one.

So all this to say that I am pleased to report that RabbitMQ is what
I'm going to highly recommend we build the financial processing
project around. Thanks a lot for the amazing work.



From bb at joyent.com  Fri Aug  8 22:48:15 2008
From: bb at joyent.com (Benjamin Black)
Date: Fri, 8 Aug 2008 14:48:15 -0700
Subject: [rabbitmq-discuss] access to vhost '/'?
Message-ID: <F6A556D5-FD42-4137-8975-575389FB7611@joyent.com>

i'm rather new to rabbitmq, having previously only used activemq.  i'm  
running into a problem with the permissions system and i'm hoping  
someone on the list can point out my obvious error.  i'm using 1.4.0  
with the latest stomp adapter on osx 10.5 and the client is in ruby  
using the stomp gem.

i've created a vhost called /metrics and a realm in /metrics called  
collection.  i've created a user called collector, mapped it to / 
metrics, and granted all permissions on /metrics/collection.  when i  
attempt to send messages i get the following error:

=INFO REPORT==== 8-Aug-2008::14:39:35 ===
starting STOMP connection <0.1195.0> from 127.0.0.1:61605

=ERROR REPORT==== 8-Aug-2008::14:39:35 ===
STOMP error frame sent:
Message: "Processing error"
Detail: "{amqp,access_refused,\n      \"access to vhost '/' refused  
for user 'collector'\",none}\n"

=INFO REPORT==== 8-Aug-2008::14:39:35 ===
ending STOMP connection <0.1195.0> from 127.0.0.1:61605

granting all permissions to collector on / allows the messages to go  
through correctly, but gives this error:

=WARNING REPORT==== 8-Aug-2008::12:25:52 ===
Lax ticket check mode: ignoring cross-realm access for ticket 101

any ideas?



thanks,
bb





From bb at joyent.com  Sat Aug  9 06:32:19 2008
From: bb at joyent.com (Benjamin Black)
Date: Fri, 8 Aug 2008 22:32:19 -0700
Subject: [rabbitmq-discuss] access to vhost '/'?
In-Reply-To: <F6A556D5-FD42-4137-8975-575389FB7611@joyent.com>
References: <F6A556D5-FD42-4137-8975-575389FB7611@joyent.com>
Message-ID: <F2E24F89-104F-459D-8128-53892A2BD7BE@joyent.com>

responding to my own email is top form, but...

is this simply stomp being stomp rather than a bug in client or stomp  
adapter?


bb

On Aug 8, 2008, at 2:48 PM, Benjamin Black wrote:

> i'm rather new to rabbitmq, having previously only used activemq.  i'm
> running into a problem with the permissions system and i'm hoping
> someone on the list can point out my obvious error.  i'm using 1.4.0
> with the latest stomp adapter on osx 10.5 and the client is in ruby
> using the stomp gem.
>
> i've created a vhost called /metrics and a realm in /metrics called
> collection.  i've created a user called collector, mapped it to /
> metrics, and granted all permissions on /metrics/collection.  when i
> attempt to send messages i get the following error:
>
> =INFO REPORT==== 8-Aug-2008::14:39:35 ===
> starting STOMP connection <0.1195.0> from 127.0.0.1:61605
>
> =ERROR REPORT==== 8-Aug-2008::14:39:35 ===
> STOMP error frame sent:
> Message: "Processing error"
> Detail: "{amqp,access_refused,\n      \"access to vhost '/' refused
> for user 'collector'\",none}\n"
>
> =INFO REPORT==== 8-Aug-2008::14:39:35 ===
> ending STOMP connection <0.1195.0> from 127.0.0.1:61605
>
> granting all permissions to collector on / allows the messages to go
> through correctly, but gives this error:
>
> =WARNING REPORT==== 8-Aug-2008::12:25:52 ===
> Lax ticket check mode: ignoring cross-realm access for ticket 101
>
> any ideas?
>
>
>
> thanks,
> bb
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080808/0d4279a5/attachment.htm 

From matthias at lshift.net  Sat Aug  9 07:31:49 2008
From: matthias at lshift.net (Matthias Radestock)
Date: Sat, 09 Aug 2008 07:31:49 +0100
Subject: [rabbitmq-discuss] access to vhost '/'?
In-Reply-To: <F6A556D5-FD42-4137-8975-575389FB7611@joyent.com>
References: <F6A556D5-FD42-4137-8975-575389FB7611@joyent.com>
Message-ID: <489D39D5.6080804@lshift.net>

Benjamin,

Benjamin Black wrote:

> granting all permissions to collector on / allows the messages to go  
> through correctly, but gives this error:
> 
> =WARNING REPORT==== 8-Aug-2008::12:25:52 ===
> Lax ticket check mode: ignoring cross-realm access for ticket 101

It's a warning, not an error. You can safely ignore it. The cause is a 
bug we introduced in the last release. We will fix that soon.


Matthias.



From tonyg at lshift.net  Sat Aug  9 09:59:00 2008
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Sat, 09 Aug 2008 09:59:00 +0100
Subject: [rabbitmq-discuss] access to vhost '/'?
In-Reply-To: <F2E24F89-104F-459D-8128-53892A2BD7BE@joyent.com>
References: <F6A556D5-FD42-4137-8975-575389FB7611@joyent.com>
	<F2E24F89-104F-459D-8128-53892A2BD7BE@joyent.com>
Message-ID: <489D5C54.90305@lshift.net>

Hi,

Benjamin Black wrote:
> is this simply stomp being stomp rather than a bug in client or stomp 
> adapter?

Aside from the cross-realm-ticket-warning-bug that Matthias mentioned, 
yes, you've got it. STOMP has no notion of vhost, so by default the 
adapter chooses "/" for you.

I did implement support for a (non-standard) "virtual-host" header to 
the "CONNECT" frame, though: you could try setting that, if you like. 
(There's also a "realm" header.)

Regards,
   Tony



From rgl at ruilopes.com  Sat Aug  9 23:18:08 2008
From: rgl at ruilopes.com (Rui Lopes)
Date: Sat, 09 Aug 2008 23:18:08 +0100
Subject: [rabbitmq-discuss] Patch for letting the STOMP consumers receive
	the content-type header
Message-ID: <489E17A0.6060507@ruilopes.com>

Hello,

Currently the SOMP consumers do not receive the "content-type" header 
that is set by a STOMP or AMQP producer; the attached patch contains a 
partial fix for this; Its a partial because I'm not sure how to map the 
AMQP "content_type" and "content_encoding" to the STOMP "content-type" 
header.

As a note, the ruby stomp client is using "content-type" as a MIME 
content-type header where the type and charset are bundled together as 
in "content-type= text/plain; charset=utf-8".

What do you think should be done?

We should also consider the use of ActiveMQ "type" header instead of 
using "content-type", or maybe translate between the two?  take a look 
at http://activemq.apache.org/stomp.html (do a search for JMSType).

Best regards,
Rui Lopes
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: stomp-deliver-content-type-header-to-consumers.patch
Url: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080809/7cdee9ae/attachment.txt 

From alexis.richardson at cohesiveft.com  Mon Aug 11 15:24:02 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Mon, 11 Aug 2008 15:24:02 +0100
Subject: [rabbitmq-discuss] Our fight against scammers
In-Reply-To: <7acec0a40808081152v13d6806s2af594f3e669042c@mail.gmail.com>
References: <7acec0a40808081152v13d6806s2af594f3e669042c@mail.gmail.com>
Message-ID: <167204d20808110724x645d87dfmf0f9a92202f0e8a0@mail.gmail.com>

Guillaume

What can I say .. other than Thanks Very Much :-)

I don't think any use case is 'overkill' if it has a business benefit.
 Let us all know how you get on or if you take this further.

Cheers

alexis


On Fri, Aug 8, 2008 at 7:52 PM, Guillaume Theoret <smokinn at gmail.com> wrote:
> First off, I'd like to thank you for this wonderful tool, it's being
> put to good use!
>
> I thought you might be interested in knowing how we're using it at my
> company as part of a system to identify and rid ourselves of scammers.
>
> It used to be that scammers were easy to spot. An account is created
> and immediately mass messages a huge number of others. Suspicious.
> Those accounts were flagged and banned.
>
> Also, before I even started working here they'd taken a sort of
> scorched earth approach to scam prevention. Scammers usually came from
> ips in places like nigeria, south africa, etc so thanks to the wonders
> of geoip location entire countries were banned. So the scammers got
> smarter. Instead they created multiple accounts that waited a bit and
> sent a small number of messages. Harder to spot but not impossible.
> Multiple accounts created from the same ip aren't always scammers
> (could simply be a nat) but they often are so they were flagged for
> review. They also used proxies to create the accounts which finally
> putting them under the radar entirely.
>
> Here's where RabbitMQ comes in. I've just finished a new filtering
> system where, each time a message is sent, the web server queues up
> the sender's message history into RabbitMQ. At the other end I have a
> consumer that takes the message, feeds it into crm114 and gets a
> result. If it looked scammy I write a log entry in the database for a
> moderator to later review. If it turns out to be a false positive it
> puts the message history back into the queue, the consumer gets it
> back and updates the "good" file. Whenever we have a human report or
> other algorithmic matches (I also check message similarity for
> possible template spam) that are confirmed by a moderator it puts the
> message history into the queue and the consumer takes it out and
> updates the "bad" file.
>
> I tried out both the python py-amqplib and RabbitMQ java clients but
> I'm currently using the java client because it's a whole lot faster.
> Normally I would have much preferred to write my producer and consumer
> in python but the speed increase was worth writing a little java code.
> With the java client I'm getting incredibly good throughput, so much
> so that I imagine we'll be able to stay with a single consumer for a
> while. This system isn't live yet so the only throughput numbers I
> have is running everything (the server, producer and consumer) on my
> average-horsepower laptop but even if it were deployed to my laptop it
> would probably be enough for now. (It won't be though we're getting it
> a beefy server of course and I'll have a better idea of the real
> numbers once the machine arrives.) On my laptop I can send ~8800
> messages/sec and I can consume & process ~300 messages/sec.
>
> The way I'm running everything right now is basically like this:
>
> The producer is installed on the web servers and listens on a local
> socket. It blindly forwards everything it gets to a RabbitMQ queue.
> Basically I did it this way just because there aren't any php
> libraries available.
>
> When the php messaging module is hit, it delivers the message as
> usual, but it also forwards the message history to the producer on a
> local socket. (This step is most probably going to be changed to a
> cron job before deployment but for now on the dev platform it's
> running like this)
>
> The consumer has its own box with crm114 installed. (The RabbitMQ
> server will probably be installed on this box as well.) It waits on
> the queue and processes the histories based on crm114 output.
>
> Of course, using RabbitMQ for such a simple scenario is probably
> incredible overkill (though not really when seen from an effort
> perspective since it was actually reasonably easy to learn, set up and
> get going) when I could've easily used something like beanstalkd given
> that guaranteed delivery isn't all that important but this was really
> just a proof-of-concept for a (probably sooner rather than) later
> project of writing our own financial transaction processing that of
> course needs to be much more rigorous.
>
> Also, this many-producer (we have a bunch of web servers) one-listener
> scenario is fine for now but later on we're most probably going to
> need more than one box for message analysis. This is where I run into
> a distribution problem and where crm114 will shine. For now what I
> feed into the queue is an xml message with an action to be performed
> (pick, learnbad, learngood), an optional member id and a message
> history. Why this won't scale to many consumers is that crm114 keeps
> its "good" and "bad" database as a statistics file on disk. Later,
> when I need more consumer boxes I can easily refactor this to one box
> that listens on a learn queue and, whenever it updates a file (these
> are rare since it's human moderators that generate these updates),
> drops the modified file into the queue that all pick consumers are
> listening on and they can all replace the right statistics file by the
> new one.
>
> So all this to say that I am pleased to report that RabbitMQ is what
> I'm going to highly recommend we build the financial processing
> project around. Thanks a lot for the amazing work.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From tonyg at lshift.net  Mon Aug 11 17:41:17 2008
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Mon, 11 Aug 2008 17:41:17 +0100
Subject: [rabbitmq-discuss] Patch for letting the STOMP consumers
 receive the content-type header
In-Reply-To: <489E17A0.6060507@ruilopes.com>
References: <489E17A0.6060507@ruilopes.com>
Message-ID: <48A06BAD.1010907@lshift.net>

Hi Rui,

Thanks for your patch. It looks good. I'll apply it now.

Rui Lopes wrote:
> Currently the SOMP consumers do not receive the "content-type" header 
> that is set by a STOMP or AMQP producer; the attached patch contains a 
> partial fix for this; Its a partial because I'm not sure how to map the 
> AMQP "content_type" and "content_encoding" to the STOMP "content-type" 
> header.

Neither are we :-) but I've been treating content_type as if it were a 
MIME type in other situations, so we may as well do the same here.

> As a note, the ruby stomp client is using "content-type" as a MIME 
> content-type header where the type and charset are bundled together as 
> in "content-type= text/plain; charset=utf-8".

This seems reasonable. I don't like the idea of doing any parsing of 
this header, yet, though, until the formats are more precisely defined 
in the various standards.

> We should also consider the use of ActiveMQ "type" header instead of 
> using "content-type", or maybe translate between the two?  take a look 
> at http://activemq.apache.org/stomp.html (do a search for JMSType).

I think they're different - does JMSType always line up exactly with 
MIME content-type? Certainly in AMQP, there's an equivalent of the 
JMSType field which is otherwise undocumented, and is distinct from the 
content-type header. (The JMS mappings in 0-8 and 0-9 are a bit of a mess.)

Regards,
   Tony



From tonyg at lshift.net  Mon Aug 11 17:49:43 2008
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Mon, 11 Aug 2008 17:49:43 +0100
Subject: [rabbitmq-discuss] Patch for letting the STOMP consumers
 receive the content-type header
In-Reply-To: <48A06BAD.1010907@lshift.net>
References: <489E17A0.6060507@ruilopes.com> <48A06BAD.1010907@lshift.net>
Message-ID: <48A06DA7.7010303@lshift.net>

Tony Garnock-Jones wrote:
> Thanks for your patch. It looks good. I'll apply it now.

I've applied it in slightly modified form. Please try it out, and let me 
know how it works for you!

Thanks,
   Tony




From 0x6e6562 at gmail.com  Mon Aug 11 18:04:38 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Mon, 11 Aug 2008 18:04:38 +0100
Subject: [rabbitmq-discuss] Our fight against scammers
In-Reply-To: <7acec0a40808081152v13d6806s2af594f3e669042c@mail.gmail.com>
References: <7acec0a40808081152v13d6806s2af594f3e669042c@mail.gmail.com>
Message-ID: <269388e30808111004j6e8e09c4ha7fb7f6bb64e852a@mail.gmail.com>

Guillaume,

On Fri, Aug 8, 2008 at 7:52 PM, Guillaume Theoret <smokinn at gmail.com> wrote:
> The producer is installed on the web servers and listens on a local
> socket. It blindly forwards everything it gets to a RabbitMQ queue.
> Basically I did it this way just because there aren't any php
> libraries available.

Would you be interested in writing an AMQP library for PHP at all?

It's not really that hard to do and we could can give you some
pointers to start off.

Ben



From rgl at ruilopes.com  Mon Aug 11 18:11:33 2008
From: rgl at ruilopes.com (Rui Lopes)
Date: Mon, 11 Aug 2008 18:11:33 +0100
Subject: [rabbitmq-discuss] Patch for letting the STOMP consumers
 receive the content-type header
In-Reply-To: <48A06BAD.1010907@lshift.net>
References: <489E17A0.6060507@ruilopes.com> <48A06BAD.1010907@lshift.net>
Message-ID: <48A072C5.1090000@ruilopes.com>

Hello Tony,

Tony Garnock-Jones wrote:
[...]
>> We should also consider the use of ActiveMQ "type" header instead of 
>> using "content-type", or maybe translate between the two?  take a 
>> look at http://activemq.apache.org/stomp.html (do a search for JMSType).
>
> I think they're different - does JMSType always line up exactly with 
> MIME content-type? Certainly in AMQP, there's an equivalent of the 
> JMSType field which is otherwise undocumented, and is distinct from 
> the content-type header. (The JMS mappings in 0-8 and 0-9 are a bit of 
> a mess.)
I never used JMS, so I'm afraid I don't known the answer; but having 
seen the "type" header in AMQP specs (even though, like you said, they 
are not really defined), I'm OK with just having an "content-type" 
header as a MIME type.

Best regards,
Rui Lopes



From smokinn at gmail.com  Mon Aug 11 18:52:48 2008
From: smokinn at gmail.com (Guillaume Theoret)
Date: Mon, 11 Aug 2008 13:52:48 -0400
Subject: [rabbitmq-discuss] Our fight against scammers
In-Reply-To: <269388e30808111004j6e8e09c4ha7fb7f6bb64e852a@mail.gmail.com>
References: <7acec0a40808081152v13d6806s2af594f3e669042c@mail.gmail.com>
	<269388e30808111004j6e8e09c4ha7fb7f6bb64e852a@mail.gmail.com>
Message-ID: <7acec0a40808111052l7c66546bv8ea9cb3fb880d4fc@mail.gmail.com>

I'd be doing it on my own time I imagine (at least at first) because I
have serious concerns about the feasibility of writing it in php. We
have a lot of stuff to get done so I don't want to spend a week at
work working on something unnecessary that has a high likelihood of
failure.

I did plan on looking into possible ways of implementing it in php
though so if you have any links (other than
http://hopper.squarespace.com/blog/2008/6/21/build-your-own-amqp-client.html
which I've already read) that would be useful I'd like to see them.

Don't expect something soon though because I'll first have to
familiarize myself with the protocol (though py-amqplib is so
amazingly well commented that it will be a great help here and there
are the other client implementations I can go though) and then look
into how to implement it. php is pretty good for quick processing of
web requests but implementing anything substantial in it tends to
bring incredible pain.

On Mon, Aug 11, 2008 at 1:04 PM, Ben Hood <0x6e6562 at gmail.com> wrote:
> Guillaume,
>
> On Fri, Aug 8, 2008 at 7:52 PM, Guillaume Theoret <smokinn at gmail.com> wrote:
>> The producer is installed on the web servers and listens on a local
>> socket. It blindly forwards everything it gets to a RabbitMQ queue.
>> Basically I did it this way just because there aren't any php
>> libraries available.
>
> Would you be interested in writing an AMQP library for PHP at all?
>
> It's not really that hard to do and we could can give you some
> pointers to start off.
>
> Ben
>



From mrcoder at yahoo.com  Mon Aug 11 23:51:54 2008
From: mrcoder at yahoo.com (Geoffrey Anderson)
Date: Mon, 11 Aug 2008 15:51:54 -0700 (PDT)
Subject: [rabbitmq-discuss] how to close a connection in dotnet?
Message-ID: <688268.10620.qm@web30008.mail.mud.yahoo.com>

Just a basic question on opening and closing the connection...

When I call this line of C# code using the .net library 1.4.0 :

mqConnection.Close();

I quickly get this exception:

System.ObjectDisposedException was unhandled
  Message="Cannot access a disposed object.\r\nObject name:
'System.Net.Sockets.Socket'."
  Source="System"
  ObjectName="System.Net.Sockets.Socket"
  StackTrace:
       at System.Net.Sockets.TcpClient.set_ReceiveTimeout(Int32 value)
       at RabbitMQ.Client.Impl.SocketFrameHandler_0_9.set_Timeout(Int32 value)
       at RabbitMQ.Client.Impl.ConnectionBase.ClosingLoop()
       at RabbitMQ.Client.Impl.ConnectionBase.MainLoop()
       at System.Threading.ThreadHelper.ThreadStart_Context(Object state)
       at System.Threading.ExecutionContext.Run(ExecutionContext executionContext,
ContextCallback callback, Object state)
       at System.Threading.ThreadHelper.ThreadStart()
       
       
       
Here is the code which established my connection before I called the Close method.
 
Is there a mistake in the way I set up the connection which might cause this socket
error?  It seems to run fine and there are no exceptions except for the later Close
statement.


        void OpenOutputQueue()
        {
            mqFactory = new ConnectionFactory();
            mqFactory.Parameters.UserName = Cfg("MessageQueueUserName");
            mqFactory.Parameters.Password = Cfg("MessageQueuePassword");
            mqFactory.Parameters.VirtualHost = Cfg("MessageQueueVirtualHost", "/");
            mqFactory.Parameters.RequestedHeartbeat = 0;
            //mqFactory.Parameters.RequestedHeartbeat = 20;
            IProtocol mqProtocol = Protocols.FromEnvironment();
            mqHost = Cfg("MessageQueueHost", "localhost");
            mqConnection = mqFactory.CreateConnection(mqProtocol, mqHost);
            mqModel = mqConnection.CreateModel();
            mqTicket = mqModel.AccessRequest(Cfg("MessageQueueRealm"));
            mqExchange = Cfg("MessageQueueExchange");
            mqModel.ExchangeDeclare(mqTicket, mqExchange, ExchangeType.Direct);
            mqQueueName = Cfg("MessageQueueName");
            mqModel.QueueDeclare(mqTicket, mqQueueName, false);
            mqRoutingKey = Cfg("MessageQueueRoutingKey");
            mqModel.QueueBind(mqTicket, mqQueueName, mqExchange, mqRoutingKey,
false, null);
            mqConnection.AutoClose = false;
        }



Sorry to waste time if I missed something in the manuals.

Thanks for reading.

Geoffrey Anderson



From 0x6e6562 at gmail.com  Tue Aug 12 01:34:11 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Tue, 12 Aug 2008 01:34:11 +0100
Subject: [rabbitmq-discuss] Endless Summer of Code: Go Forth And Multiply
Message-ID: <269388e30808111734vecbc469wf69f9529ab90aa93@mail.gmail.com>

All,

As discussed earlier in a previous post, we are trying to encourage
greater community participation in the RabbitMQ project via the
Endless Summer of Code.

Part of that may include writing clients in their own favourite
language, developing adapters and extensions, creating test cases,
questioning the specification or contributing documentation.

To encourage greater participation, we have decided to reward
significant contributions by sending them out their very own "Go Forth
And Multiply" RabbitMQ T-Shirt, as modeled by the RabbitMQ dev team
here: https://dev.rabbitmq.com/wiki/EndlessSummerOfCode

Please note the terms and conditions :-)

Ben



From 0x6e6562 at gmail.com  Tue Aug 12 01:43:14 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Tue, 12 Aug 2008 01:43:14 +0100
Subject: [rabbitmq-discuss] Our fight against scammers
In-Reply-To: <7acec0a40808111052l7c66546bv8ea9cb3fb880d4fc@mail.gmail.com>
References: <7acec0a40808081152v13d6806s2af594f3e669042c@mail.gmail.com>
	<269388e30808111004j6e8e09c4ha7fb7f6bb64e852a@mail.gmail.com>
	<7acec0a40808111052l7c66546bv8ea9cb3fb880d4fc@mail.gmail.com>
Message-ID: <269388e30808111743t5329ab60yb8d90a4203524673@mail.gmail.com>

Hi Guillaume,

On Mon, Aug 11, 2008 at 6:52 PM, Guillaume Theoret <smokinn at gmail.com> wrote:
> I'd be doing it on my own time I imagine (at least at first) because I
> have serious concerns about the feasibility of writing it in php. We
> have a lot of stuff to get done so I don't want to spend a week at
> work working on something unnecessary that has a high likelihood of
> failure.

Thanks for bringing the need of a PHP library to my attention. This
reminds me that this been requested in the past as well.

I can understand your apprehension in taking on this task.

So I have added this to the list of things can be tackled by members
of the community in the Endless Summer of Code
(https://dev.rabbitmq.com/wiki/EndlessSummerOfCode), maybe this will
get picked up by somebody.


> I did plan on looking into possible ways of implementing it in php
> though so if you have any links (other than
> http://hopper.squarespace.com/blog/2008/6/21/build-your-own-amqp-client.html
> which I've already read) that would be useful I'd like to see them.

Unfortunately there is not that much further documentation on this
particular subject that I know of, which is why the article was
written in the first place. However, if anybody else knows of any
other articles on this topic, I wish to stand corrected.

The best advice I could give is not to be too daunted by the
immenseness of the task - after you have grasped the central concepts,
it is fairly straight forward.

The second best advice I can give is not be too shy to publish code
that is still in it's infancy - everybody out there knows that
software is not a perfectly formed work of art from the very first
line of code onwards :-)

>
> Don't expect something soon though because I'll first have to
> familiarize myself with the protocol (though py-amqplib is so
> amazingly well commented that it will be a great help here and there
> are the other client implementations I can go though)

Another great pointer would be Aman's Ruby client for AMQP:
http://github.com/tmm1/amqp/tree/master

> into how to implement it. php is pretty good for quick processing of
> web requests but implementing anything substantial in it tends to
> bring incredible pain.

HTH,

Ben



From hubert at lshift.net  Tue Aug 12 11:46:25 2008
From: hubert at lshift.net (Hubert Plociniczak)
Date: Tue, 12 Aug 2008 11:46:25 +0100
Subject: [rabbitmq-discuss] how to close a connection in dotnet?
In-Reply-To: <688268.10620.qm@web30008.mail.mud.yahoo.com>
References: <688268.10620.qm@web30008.mail.mud.yahoo.com>
Message-ID: <48A16A01.4050107@lshift.net>

Hi Geoffrey,

I tried to reproduce your bug on Mono and everything was working
as expected.

Then I switched to .Net (native) and actually noticed your problem.
I guess there is something different with .Net environment (again)
and it does not behave as expected.

Thanks for reporting that!
I will fix that as soon as possible.

Hubert

Geoffrey Anderson wrote:
> Just a basic question on opening and closing the connection...
>
> When I call this line of C# code using the .net library 1.4.0 :
>
> mqConnection.Close();
>
> I quickly get this exception:
>
> System.ObjectDisposedException was unhandled
>   Message="Cannot access a disposed object.\r\nObject name:
> 'System.Net.Sockets.Socket'."
>   Source="System"
>   ObjectName="System.Net.Sockets.Socket"
>   StackTrace:
>        at System.Net.Sockets.TcpClient.set_ReceiveTimeout(Int32 value)
>        at RabbitMQ.Client.Impl.SocketFrameHandler_0_9.set_Timeout(Int32 value)
>        at RabbitMQ.Client.Impl.ConnectionBase.ClosingLoop()
>        at RabbitMQ.Client.Impl.ConnectionBase.MainLoop()
>        at System.Threading.ThreadHelper.ThreadStart_Context(Object state)
>        at System.Threading.ExecutionContext.Run(ExecutionContext executionContext,
> ContextCallback callback, Object state)
>        at System.Threading.ThreadHelper.ThreadStart()
>        
>        
>        
> Here is the code which established my connection before I called the Close method.
>  
> Is there a mistake in the way I set up the connection which might cause this socket
> error?  It seems to run fine and there are no exceptions except for the later Close
> statement.
>
>
>         void OpenOutputQueue()
>         {
>             mqFactory = new ConnectionFactory();
>             mqFactory.Parameters.UserName = Cfg("MessageQueueUserName");
>             mqFactory.Parameters.Password = Cfg("MessageQueuePassword");
>             mqFactory.Parameters.VirtualHost = Cfg("MessageQueueVirtualHost", "/");
>             mqFactory.Parameters.RequestedHeartbeat = 0;
>             //mqFactory.Parameters.RequestedHeartbeat = 20;
>             IProtocol mqProtocol = Protocols.FromEnvironment();
>             mqHost = Cfg("MessageQueueHost", "localhost");
>             mqConnection = mqFactory.CreateConnection(mqProtocol, mqHost);
>             mqModel = mqConnection.CreateModel();
>             mqTicket = mqModel.AccessRequest(Cfg("MessageQueueRealm"));
>             mqExchange = Cfg("MessageQueueExchange");
>             mqModel.ExchangeDeclare(mqTicket, mqExchange, ExchangeType.Direct);
>             mqQueueName = Cfg("MessageQueueName");
>             mqModel.QueueDeclare(mqTicket, mqQueueName, false);
>             mqRoutingKey = Cfg("MessageQueueRoutingKey");
>             mqModel.QueueBind(mqTicket, mqQueueName, mqExchange, mqRoutingKey,
> false, null);
>             mqConnection.AutoClose = false;
>         }
>
>
>
> Sorry to waste time if I missed something in the manuals.
>
> Thanks for reading.
>
> Geoffrey Anderson
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>   

-- 
 [][][] Hubert Plociniczak
   [][] LShift Ltd
 []  [] www.lshift.net




From hubert at lshift.net  Tue Aug 12 14:39:08 2008
From: hubert at lshift.net (Hubert Plociniczak)
Date: Tue, 12 Aug 2008 14:39:08 +0100
Subject: [rabbitmq-discuss] difficulty closing connections in Windows
 Forms	apps
In-Reply-To: <633272.79733.qm@web30005.mail.mud.yahoo.com>
References: <633272.79733.qm@web30005.mail.mud.yahoo.com>
Message-ID: <48A1927C.10303@lshift.net>

Hi Geoffrey,


there is a high probability that your problem was caused by the problem

described in:

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2008-August/001548.html

Using  Windows Forms application shouldn't really matter.


Geoffrey Anderson wrote:
> 3. Scenario B (the Hard place):  When I use connection.AutoClose = False style of
> connection management, I added a line of code which executes at FormClose event
> which simply does connection.Close().   In this case your .net library throws a
> socket error saying that the connection was already destructed and is not a viable
> object to be calling Close() on.  (I am paraphrasing, it's not exactly the text.) 
> Hmmm...  OK I try one more thing:   I do this to make sure it's open before I close
> it, that should prevent some problems, right?  No.  
>
>  If (conn.IsOpen)
>     conn.Close()
>   
Actually, the above pattern should not normally be used because of possible race
conditions (see documentation on more info).
So generally you should only perform the operation without checking if the connection
is closed. This will work correctly when the problem mentioned at the beginning is
addressed. 

> Well here's the funny thing.  The conn.IsOpen returns true, code execution moves to
> the next line, and the conn.Close() doesn't even run.... it throws the error
> indicating the connection object was already destructed.   Which is quite odd
> because just a moment ago, one line of code earlier, the object was not destructed.
>   
It appears that the bug itself was during performing Close operation, hence the
connection was 'correctly' in open state before you tried to close it.

> Am I supposed to avoid calling connection.Close() and just call Dispose()???  I
> would think Close is there for a reason....  and that I should be able to call
> Close() in some scenarios.  I know that the 'using' statement calls Dispose
> implicitly in C#....
>   
You were right. Calling connection.Close() is the right way.

Thanks for reporting the problem!

Hubert

-- 
 [][][] Hubert Plociniczak
   [][] LShift Ltd
 []  [] www.lshift.net




From alexis.richardson at cohesiveft.com  Wed Aug 13 11:24:12 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Wed, 13 Aug 2008 11:24:12 +0100
Subject: [rabbitmq-discuss] RabbitMQ presentation and video
Message-ID: <167204d20808130324y5e36ddbcxe4bffcfe36da9a4a@mail.gmail.com>

Hi,

An introduction to RabbitMQ with an emphasis on its erlang
architecture, is here:

http://skillsmatter.com/podcast/erlang/presenting-rabbitmq-an-erlang-based-implementatio-nof-amqp

alexis



From alexis.richardson at cohesiveft.com  Thu Aug 14 07:59:05 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Thu, 14 Aug 2008 07:59:05 +0100
Subject: [rabbitmq-discuss] Reia interesting new scripting language for
	erlang
Message-ID: <167204d20808132359t798b461enc4a28697d0246d8f@mail.gmail.com>

Hi,

This may be of interest to folks looking at RabbitMQ management and
general tooling.

"Reia (pronounced RAY-uh) is a Python/Ruby-like scripting language for
the Erlang virtual machine (BEAM). Reia aims to expose all the
features and functionality of Erlang in a language more familiar to
programmers of scripting languages, while improving string handling,
regular expressions, linking with external libraries, and other tasks
which are generally considered outside the scope of Erlang."

http://wiki.reia-lang.org/wiki/Main_Page

I found this via http://blog.antarestrader.com/?p=77 which is also
worth a quick glance as it has some links to prior art.

alexis



From opendev at gmail.com  Thu Aug 14 16:40:13 2008
From: opendev at gmail.com (opendev at gmail.com)
Date: Thu, 14 Aug 2008 17:40:13 +0200
Subject: [rabbitmq-discuss] RabbitMQ / Spring integration
Message-ID: <b93bbdbc0808140840k134999bcxebdeea7b4ab8669f@mail.gmail.com>

Hi list,

I finally had some time to commit a bit of code[1]. Things like
pre-Tiger compatibility and templates for common usage patterns (the
interesting part of the integration) need more discussions (is
declaring an exchange + queue for sending or consuming common enough?
RPC?). The two factory beans are using Tiger features but do not
depend on them.

An application context which illustrates how to use a TargetSource
(pooling channels, threadlocal channels etc.) to proxy access to the
Channel FactoryBean.

Best regards,


Joern

[1]: http://github.com/yawn/rabbitmq-spring-tools/tree/master
--



From alexis.richardson at cohesiveft.com  Thu Aug 14 16:53:17 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Thu, 14 Aug 2008 16:53:17 +0100
Subject: [rabbitmq-discuss] RabbitMQ / Spring integration
In-Reply-To: <b93bbdbc0808140840k134999bcxebdeea7b4ab8669f@mail.gmail.com>
References: <b93bbdbc0808140840k134999bcxebdeea7b4ab8669f@mail.gmail.com>
Message-ID: <167204d20808140853s82637a5j7ee701ba1b152c12@mail.gmail.com>

Joern

That is excellent!  We are building a list of clients that work with
RabbitMQ, or are working towards that.

https://dev.rabbitmq.com/wiki/ClientsKnownToWorkWithRabbit

I have added your link to it.

alexis



On Thu, Aug 14, 2008 at 4:40 PM,  <opendev at gmail.com> wrote:
> Hi list,
>
> I finally had some time to commit a bit of code[1]. Things like
> pre-Tiger compatibility and templates for common usage patterns (the
> interesting part of the integration) need more discussions (is
> declaring an exchange + queue for sending or consuming common enough?
> RPC?). The two factory beans are using Tiger features but do not
> depend on them.
>
> An application context which illustrates how to use a TargetSource
> (pooling channels, threadlocal channels etc.) to proxy access to the
> Channel FactoryBean.
>
> Best regards,
>
>
> Joern
>
> [1]: http://github.com/yawn/rabbitmq-spring-tools/tree/master
> --
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From carlos.quiroz-castro at nokia.com  Thu Aug 14 17:01:42 2008
From: carlos.quiroz-castro at nokia.com (carlos.quiroz-castro at nokia.com)
Date: Thu, 14 Aug 2008 19:01:42 +0300
Subject: [rabbitmq-discuss] RabbitMQ / Spring integration
In-Reply-To: <167204d20808140853s82637a5j7ee701ba1b152c12@mail.gmail.com>
References: <b93bbdbc0808140840k134999bcxebdeea7b4ab8669f@mail.gmail.com>
	<167204d20808140853s82637a5j7ee701ba1b152c12@mail.gmail.com>
Message-ID: <DF438A8AE379E843A08DA47D7667EEBB9D28A7@vaebe104.NOE.Nokia.com>

Hi all

This is my first post and I'm just exploring rabbitmq but now that you
mention spring integration support, having camel support would be
superb, I imagine it would be something not so hard to accomplish

Anybody interested?

Regards
Carlos Quiroz

>-----Original Message-----
>From: rabbitmq-discuss-bounces at lists.rabbitmq.com 
>[mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf 
>Of ext Alexis Richardson
>Sent: 14 August, 2008 18:53
>To: opendev at gmail.com
>Cc: rabbitmq-discuss at lists.rabbitmq.com
>Subject: Re: [rabbitmq-discuss] RabbitMQ / Spring integration
>
>Joern
>
>That is excellent!  We are building a list of clients that 
>work with RabbitMQ, or are working towards that.
>
>https://dev.rabbitmq.com/wiki/ClientsKnownToWorkWithRabbit
>
>I have added your link to it.
>
>alexis
>
>
>
>On Thu, Aug 14, 2008 at 4:40 PM,  <opendev at gmail.com> wrote:
>> Hi list,
>>
>> I finally had some time to commit a bit of code[1]. Things like 
>> pre-Tiger compatibility and templates for common usage patterns (the 
>> interesting part of the integration) need more discussions (is 
>> declaring an exchange + queue for sending or consuming common enough?
>> RPC?). The two factory beans are using Tiger features but do not 
>> depend on them.
>>
>> An application context which illustrates how to use a TargetSource 
>> (pooling channels, threadlocal channels etc.) to proxy access to the 
>> Channel FactoryBean.
>>
>> Best regards,
>>
>>
>> Joern
>>
>> [1]: http://github.com/yawn/rabbitmq-spring-tools/tree/master
>> --
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>_______________________________________________
>rabbitmq-discuss mailing list
>rabbitmq-discuss at lists.rabbitmq.com
>http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From holger at wizards.de  Fri Aug 15 14:07:31 2008
From: holger at wizards.de (=?ISO-8859-1?Q?Holger_Hoffst=E4tte?=)
Date: Fri, 15 Aug 2008 15:07:31 +0200
Subject: [rabbitmq-discuss] RabbitMQ for Gentoo available
Message-ID: <48A57F93.5080908@wizards.de>

Hi,

I finally got around to create an automated installer aka ebuild for the
awesomeness that is Gentoo. The bugzilla entry can be found here for
feedback and tracking progress: https://bugs.gentoo.org/show_bug.cgi?id=192278

At the moment the ebuild is not yet attached to the bug, but needs to be
pulled from my public hg overlay which can be found at
http://hoho.dyndns.org/hg/ where rabbit is hiding in the net-misc category.

As the bug mentions there are still some things missing (see the TODOs in
the ebuild) but so far it cleanly installs and runs out of the box. :)

Feedback & patches welcome.

Holger



From alexis.richardson at cohesiveft.com  Fri Aug 15 15:06:39 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Fri, 15 Aug 2008 15:06:39 +0100
Subject: [rabbitmq-discuss] RabbitMQ / Spring integration
In-Reply-To: <DF438A8AE379E843A08DA47D7667EEBB9D28A7@vaebe104.NOE.Nokia.com>
References: <b93bbdbc0808140840k134999bcxebdeea7b4ab8669f@mail.gmail.com>
	<167204d20808140853s82637a5j7ee701ba1b152c12@mail.gmail.com>
	<DF438A8AE379E843A08DA47D7667EEBB9D28A7@vaebe104.NOE.Nokia.com>
Message-ID: <167204d20808150706i4a84d6e1u2adca5b8cc1f0782@mail.gmail.com>

Carlos

We would welcome that.  What is your proposed approach?  I can think of several:

- Use Spring as an interface
- Use the RabbitMQ Java libs directly
- Use the STOMP bridge

I am not a Camel expert - the latter two maybe obviously inferior to
the first one.

alexis


On Thu, Aug 14, 2008 at 5:01 PM,  <carlos.quiroz-castro at nokia.com> wrote:
> Hi all
>
> This is my first post and I'm just exploring rabbitmq but now that you
> mention spring integration support, having camel support would be
> superb, I imagine it would be something not so hard to accomplish
>
> Anybody interested?
>
> Regards
> Carlos Quiroz
>
>>-----Original Message-----
>>From: rabbitmq-discuss-bounces at lists.rabbitmq.com
>>[mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf
>>Of ext Alexis Richardson
>>Sent: 14 August, 2008 18:53
>>To: opendev at gmail.com
>>Cc: rabbitmq-discuss at lists.rabbitmq.com
>>Subject: Re: [rabbitmq-discuss] RabbitMQ / Spring integration
>>
>>Joern
>>
>>That is excellent!  We are building a list of clients that
>>work with RabbitMQ, or are working towards that.
>>
>>https://dev.rabbitmq.com/wiki/ClientsKnownToWorkWithRabbit
>>
>>I have added your link to it.
>>
>>alexis
>>
>>
>>
>>On Thu, Aug 14, 2008 at 4:40 PM,  <opendev at gmail.com> wrote:
>>> Hi list,
>>>
>>> I finally had some time to commit a bit of code[1]. Things like
>>> pre-Tiger compatibility and templates for common usage patterns (the
>>> interesting part of the integration) need more discussions (is
>>> declaring an exchange + queue for sending or consuming common enough?
>>> RPC?). The two factory beans are using Tiger features but do not
>>> depend on them.
>>>
>>> An application context which illustrates how to use a TargetSource
>>> (pooling channels, threadlocal channels etc.) to proxy access to the
>>> Channel FactoryBean.
>>>
>>> Best regards,
>>>
>>>
>>> Joern
>>>
>>> [1]: http://github.com/yawn/rabbitmq-spring-tools/tree/master
>>> --
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>
>>_______________________________________________
>>rabbitmq-discuss mailing list
>>rabbitmq-discuss at lists.rabbitmq.com
>>http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From dimitar.bakardzhiev at rexintegra.com  Mon Aug 18 07:48:17 2008
From: dimitar.bakardzhiev at rexintegra.com (Dimitar Bakardzhiev)
Date: Mon, 18 Aug 2008 09:48:17 +0300
Subject: [rabbitmq-discuss] Queued file transfer with many writers and many
 readers using the Java client
Message-ID: <48A91B31.1080206@rexintegra.com>

We would like to use RabbitMQ for a Queued file transfer with many 
writers and many readers using the Java client.
We are not that familiar with AMQP yet and try to use the examples part 
of the Java client binary distribution for a start.

Unfortunately there is no example showing how to use all methods from 
File class especially such very nice sounding methods such as Cancel, 
Return, QoS.
Both FileProducer and FileConsumer examples make no use of File class 
methods but only Basic class Publish.

Here is the code we think will work for reliable file transfer, but the 
usage of transmit(AMQPChannel ) methods is not right and we are 
wondering waht the proper usage should be:

    public void filePublish(int ticket, String exchange, String routingKey,
            boolean mandatory, boolean immediate, FileProperties props,
            byte[] body,String identifier,Channel channel) throws 
IOException {
        FileProperties useProps = props;
        if (props == null) {
            useProps = new FileProperties();
        }
        File.Publish publish = new File.Publish(ticket, exchange, 
routingKey,
                mandatory, immediate,identifier);
        AMQCommand command = new AMQCommand(publish, useProps, body);

        command.transmit(channel);??????????????????????????
    }
   
It will help us start using RabitMQ sooner if we can get some examples 
of how to use File class methods in Java client.
   
Can somebody help?
-- 

Dimitar Bakardzhiev

Managing Partner
RexIntegra Ltd.
Phone: +359 2 9711324
Mobile: +359 899 126 315
View Dimitar Bakardzhiev's profile on LinkedIn 
<http://www.linkedin.com/in/dimitarbakardzhiev>
www.rexintegra.com <http://www.rexintegra.com>

------------------------------------------------------------------------

This e-mail and its attachments may contain RexIntegra Ltd. proprietary 
information, which is PRIVILEGED, CONFIDENTIAL, or subject to COPYRIGHT 
belonging to RexIntegra Ltd. This e-mail is intended solely for the use 
of the individual or entity to which it is addressed. If you are not the 
intended recipient of this e-mail, or the employee or agent responsible 
for delivering this e-mail to the intended recipient, you are hereby 
notified that any dissemination, distribution, copying, or action taken 
in relation to the contents of and attachments to this e-mail is 
STRICTLY PROHIBITED and may be UNLAWFUL. If you have received this 
e-mail in error, please notify the sender immediately and permanently 
delete the original and any copy of this e-mail and any printout. Thank 
you.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080818/ee51bf72/attachment.htm 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: btn_profile_greytxt_80x15.gif
Type: image/gif
Size: 384 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080818/ee51bf72/attachment.gif 

From matthias at lshift.net  Mon Aug 18 08:33:44 2008
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 18 Aug 2008 08:33:44 +0100
Subject: [rabbitmq-discuss] Queued file transfer with many writers and
 many	readers using the Java client
In-Reply-To: <48A91B31.1080206@rexintegra.com>
References: <48A91B31.1080206@rexintegra.com>
Message-ID: <48A925D8.3070200@lshift.net>

Dimitar,

Dimitar Bakardzhiev wrote:
> there is no example showing how to use all methods from 
> File class

The File class is deprecated; RabbitMQ (and other AMQP brokers) do not 
implement it and it will likely be removed in a future version of the spec.

> Both FileProducer and FileConsumer examples make no use of File class 
> methods but only Basic class Publish.

The Basic class should be sufficient, and hence the 
File{Producer,Consumer} examples should be a good starting point for 
your own code.

If you run into any problems adapting the examples to your use case 
please let us know.


Regards,

Matthias.



From CLW at ridgecrestfinancial.com  Mon Aug 18 10:39:07 2008
From: CLW at ridgecrestfinancial.com (Lakmali Weeraratne)
Date: Mon, 18 Aug 2008 15:09:07 +0530
Subject: [rabbitmq-discuss] RabbitMQ C# .net client
Message-ID: <73DE98796DEF7648900B97A9EA9222B435C14D@RCAPLDC4.rcapl.com>

Hi Hubert,

 

I was successful in creating a connection to the OpenAMQ Server.

 

But when I'm closing the connection, it gives me an exception.

 

Please be kind enough to point out the cause of the issue.

 

Code Reference is attached.

 

Regards,

/Lakmali

 

------------------------------------------------------------------------
----

 

Private void closeConnection(object sender, EventArgs e)

        {

            try

            {               

                channel.Close(200, "Goodbye");

                //conn.Close();

 

            }

            catch
(RabbitMQ.Client.Exceptions.OperationInterruptedException)

            {

                MessageBox.Show ("Error");

            }

            

        }

 

 

------Error Description ------------------------------------------------

On   SimpleBlockingRpcContinuation class

 

 

public virtual Command GetReply()

    {

     Either result = (Either)cell.Value;

     switch (result.Alternative)       {

       case EitherAlternative.Left:

          return (Command)result.Value;

       case EitherAlternative.Right:

   throw new
OperationInterruptedException((ShutdownEventArgs)result.Value);

                default:

                    Trace.Fail("Illegal EitherAlternative " +
result.Alternative);

                    return null;

            }

        }

 

Error at:

throw new
OperationInterruptedException((ShutdownEventArgs)result.Value);

 

As

 

" the AMQP operation was interrupted: AMQP close-reason, initiated by
Application, code=200, text="Goodbye", classId=0, methodId=0, cause= "

 

------Error Description ------------------------------------------------

 

 

 

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080818/3669b36b/attachment.htm 

From petr.sturc at gmail.com  Mon Aug 18 18:06:35 2008
From: petr.sturc at gmail.com (Petr Sturc)
Date: Mon, 18 Aug 2008 19:06:35 +0200
Subject: [rabbitmq-discuss] Load balancing exchange
Message-ID: <73b10e5b0808181006t4fc3505n670806f86547ad83@mail.gmail.com>

Hi,

I would like to implement kind of "true load balancing" between
consumers. The idea is to implement a new type of exchange,
which routes a message to the shortest queue among all queues bound to
it with the correct routing key.

Implementation of a new exchange type seems to be quite easy - I am
just adding two new methods to rabbit_exchange.erl
- check_type(<<"loadbalance">>)  and  route(#exchange{name = Name,
type = loadbalance}, RoutingKey). But the problem I have
is the "shortest queue". I am trying following (in the route function)
in order to get queue length

 {ok,_,QLen,_} = rabbit_amqqueue:stat( #amqqueue{pid = QPid}

, but QLen is always zero for all bound queues.

Any idea what I am doing wrong?

Regards,
Petr



From matthias at lshift.net  Mon Aug 18 18:26:26 2008
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 18 Aug 2008 18:26:26 +0100
Subject: [rabbitmq-discuss] Load balancing exchange
In-Reply-To: <73b10e5b0808181006t4fc3505n670806f86547ad83@mail.gmail.com>
References: <73b10e5b0808181006t4fc3505n670806f86547ad83@mail.gmail.com>
Message-ID: <48A9B0C2.1050503@lshift.net>

Petr,

Petr Sturc wrote:
> I am trying following (in the route function)
> in order to get queue length
> 
>  {ok,_,QLen,_} = rabbit_amqqueue:stat( #amqqueue{pid = QPid}
> 
> , but QLen is always zero for all bound queues.
> 
> Any idea what I am doing wrong?

The above looks fine, and if you look at the code behind it you will see 
that there really isn't much that can go wrong here.

Note however that delivered-but-unacknowledged messages are not included 
in the message count - could that explain why you see a zero count when 
you don't expect to?


Matthias.



From carlos.quiroz-castro at nokia.com  Tue Aug 19 07:05:24 2008
From: carlos.quiroz-castro at nokia.com (carlos.quiroz-castro at nokia.com)
Date: Tue, 19 Aug 2008 09:05:24 +0300
Subject: [rabbitmq-discuss] RabbitMQ / Spring integration
In-Reply-To: <167204d20808150706i4a84d6e1u2adca5b8cc1f0782@mail.gmail.com>
References: <b93bbdbc0808140840k134999bcxebdeea7b4ab8669f@mail.gmail.com>
	<167204d20808140853s82637a5j7ee701ba1b152c12@mail.gmail.com>
	<DF438A8AE379E843A08DA47D7667EEBB9D28A7@vaebe104.NOE.Nokia.com>
	<167204d20808150706i4a84d6e1u2adca5b8cc1f0782@mail.gmail.com>
Message-ID: <DF438A8AE379E843A08DA47D7667EEBBA0E853@vaebe104.NOE.Nokia.com>

Hi

I can see two ways of implementing this. One is to use the existing AMQP
component which uses qpid in turn. I haven't used it and I don't know
its maturity. The other one is to implement directly using the RabbitMQ
library

I'd say that one is the best where you could produce camel uris like
rabbitmq:queue/myqueue.
You can probably start with the JMS component as a template and replace
the relevant parts using the rabbitmq library.

I guess some experimentation is needed but it would make a great
middleware component

Regards
Carlos Quiroz

>-----Original Message-----
>From: alexis.richardson at gmail.com 
>[mailto:alexis.richardson at gmail.com] On Behalf Of ext Alexis Richardson
>Sent: 15 August, 2008 17:07
>To: Quiroz-Castro Carlos (Nokia-NRC/Helsinki)
>Cc: rabbitmq-discuss at lists.rabbitmq.com
>Subject: Re: [rabbitmq-discuss] RabbitMQ / Spring integration
>
>Carlos
>
>We would welcome that.  What is your proposed approach?  I can 
>think of several:
>
>- Use Spring as an interface
>- Use the RabbitMQ Java libs directly
>- Use the STOMP bridge
>
>I am not a Camel expert - the latter two maybe obviously 
>inferior to the first one.
>
>alexis
>
>
>On Thu, Aug 14, 2008 at 5:01 PM,  
><carlos.quiroz-castro at nokia.com> wrote:
>> Hi all
>>
>> This is my first post and I'm just exploring rabbitmq but 
>now that you 
>> mention spring integration support, having camel support would be 
>> superb, I imagine it would be something not so hard to accomplish
>>
>> Anybody interested?
>>
>> Regards
>> Carlos Quiroz
>>
>>>-----Original Message-----
>>>From: rabbitmq-discuss-bounces at lists.rabbitmq.com
>>>[mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On 
>Behalf Of ext 
>>>Alexis Richardson
>>>Sent: 14 August, 2008 18:53
>>>To: opendev at gmail.com
>>>Cc: rabbitmq-discuss at lists.rabbitmq.com
>>>Subject: Re: [rabbitmq-discuss] RabbitMQ / Spring integration
>>>
>>>Joern
>>>
>>>That is excellent!  We are building a list of clients that work with 
>>>RabbitMQ, or are working towards that.
>>>
>>>https://dev.rabbitmq.com/wiki/ClientsKnownToWorkWithRabbit
>>>
>>>I have added your link to it.
>>>
>>>alexis
>>>
>>>
>>>
>>>On Thu, Aug 14, 2008 at 4:40 PM,  <opendev at gmail.com> wrote:
>>>> Hi list,
>>>>
>>>> I finally had some time to commit a bit of code[1]. Things like 
>>>> pre-Tiger compatibility and templates for common usage 
>patterns (the 
>>>> interesting part of the integration) need more discussions (is 
>>>> declaring an exchange + queue for sending or consuming 
>common enough?
>>>> RPC?). The two factory beans are using Tiger features but do not 
>>>> depend on them.
>>>>
>>>> An application context which illustrates how to use a TargetSource 
>>>> (pooling channels, threadlocal channels etc.) to proxy 
>access to the 
>>>> Channel FactoryBean.
>>>>
>>>> Best regards,
>>>>
>>>>
>>>> Joern
>>>>
>>>> [1]: http://github.com/yawn/rabbitmq-spring-tools/tree/master
>>>> --
>>>>
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>
>>>
>>>_______________________________________________
>>>rabbitmq-discuss mailing list
>>>rabbitmq-discuss at lists.rabbitmq.com
>>>http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>



From dimitar.bakardzhiev at rexintegra.com  Tue Aug 19 08:57:39 2008
From: dimitar.bakardzhiev at rexintegra.com (Dimitar Bakardzhiev)
Date: Tue, 19 Aug 2008 10:57:39 +0300
Subject: [rabbitmq-discuss] Secure file transfer
Message-ID: <48AA7CF3.10903@rexintegra.com>

Our use case is to provide secure file transfer.

Reading AMQP 0.8 spec it is stated that the protocol itself is secure, 
but since there is no encryption mention in the spec we will encrypt the 
files we are sending to RabbitMQ.

So I have two questions:
1) is our approach of encrypting the files correct to the spirit of 
RabbitMQ or there is some security built in?
2) how we have to use Java client in order to restart sending of a file 
if some transient network issue occurs?

Thanks,
Dimitar




From 0x6e6562 at gmail.com  Tue Aug 19 09:06:53 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Tue, 19 Aug 2008 09:06:53 +0100
Subject: [rabbitmq-discuss] RabbitMQ / Spring integration
In-Reply-To: <DF438A8AE379E843A08DA47D7667EEBBA0E853@vaebe104.NOE.Nokia.com>
References: <b93bbdbc0808140840k134999bcxebdeea7b4ab8669f@mail.gmail.com>
	<167204d20808140853s82637a5j7ee701ba1b152c12@mail.gmail.com>
	<DF438A8AE379E843A08DA47D7667EEBB9D28A7@vaebe104.NOE.Nokia.com>
	<167204d20808150706i4a84d6e1u2adca5b8cc1f0782@mail.gmail.com>
	<DF438A8AE379E843A08DA47D7667EEBBA0E853@vaebe104.NOE.Nokia.com>
Message-ID: <269388e30808190106n392bb998va0e011595054417e@mail.gmail.com>

Hi Carlos,

On Tue, Aug 19, 2008 at 7:05 AM,  <carlos.quiroz-castro at nokia.com> wrote:
> Hi
>
> I can see two ways of implementing this. One is to use the existing AMQP
> component which uses qpid in turn. I haven't used it and I don't know
> its maturity. The other one is to implement directly using the RabbitMQ
> library

I think it would be most useful for users if the semantics of the AMQP
model were exposed via a Spring template, rather than just confining
users to the semantics of JMS. This could make functionality available
such configuring message routing that isn't available via JMS, for
example.

An alternative route would be to say I want to keep the JMS template
semantics and then back the interface with the RabbitMQ java lib. Your
use case may be to provide migration without having to change client
code. Some concepts might be mappable between JMS and AMQP, e.g.
Connection(Factories), Sessions (Channels?) and Destinations (Queues),
but if you would have to bear in mind that this would probably not
pass a TCK, especially wrt transactions.

As for Camel, although I'm not an expert, isn't part of the value-add
of Camel be able to abstract away different message passing paradigms
and so therefore AMQP would be just another transport?

Ben



From 0x6e6562 at gmail.com  Tue Aug 19 09:21:49 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Tue, 19 Aug 2008 09:21:49 +0100
Subject: [rabbitmq-discuss] Secure file transfer
In-Reply-To: <48AA7CF3.10903@rexintegra.com>
References: <48AA7CF3.10903@rexintegra.com>
Message-ID: <269388e30808190121g106c8c0dw1192beef2ff083a3@mail.gmail.com>

Dimitar,

On Tue, Aug 19, 2008 at 8:57 AM, Dimitar Bakardzhiev
<dimitar.bakardzhiev at rexintegra.com> wrote:
> Our use case is to provide secure file transfer.
>
> Reading AMQP 0.8 spec it is stated that the protocol itself is secure,
> but since there is no encryption mention in the spec we will encrypt the
> files we are sending to RabbitMQ.

Please be aware that the file streaming class specified in 0-8 is not
implemented and probably will be removed from a revised version of the
specification.

>
> So I have two questions:
> 1) is our approach of encrypting the files correct to the spirit of
> RabbitMQ or there is some security built in?

Have you looked at the SSL guide http://www.rabbitmq.com/api-guide.html#ssl ?

> 2) how we have to use Java client in order to restart sending of a file
> if some transient network issue occurs?

If the issue causes the underlying connection to close, you may want
to want to use the ShutdownListener interface to perform some kind of
recovery, but one what you actually do may depend on how your
application handles resends. Have you implemented any chunking,
streaming or partial acknowledgments? Is this transactional at all?

Ben



From dimitar.bakardzhiev at rexintegra.com  Tue Aug 19 09:53:23 2008
From: dimitar.bakardzhiev at rexintegra.com (Dimitar Bakardzhiev)
Date: Tue, 19 Aug 2008 11:53:23 +0300
Subject: [rabbitmq-discuss] Secure file transfer
In-Reply-To: <269388e30808190121g106c8c0dw1192beef2ff083a3@mail.gmail.com>
References: <48AA7CF3.10903@rexintegra.com>
	<269388e30808190121g106c8c0dw1192beef2ff083a3@mail.gmail.com>
Message-ID: <48AA8A03.9060701@rexintegra.com>

Hi Ben,

We have to send file not stream them, because we will transfer documents 
no video.
So I am not interested in the Stream class.

Regarding using SSL  -I looked atthe SSL guide 
http://www.rabbitmq.com/api-guide.html#ssl but since we'll encrypt I'd 
prefer to encrypt the document.


> If the issue causes the underlying connection to close, you may want
> to want to use the ShutdownListener interface to perform some kind of
> recovery, but one what you actually do may depend on how your
> application handles resends. Have you implemented any chunking,
> streaming or partial acknowledgments? Is this transactional at all?
>   
Yes, we will implement chunking but there will be no transactions. The 
use case is as such :
1)The Producer sends a file to The Server.
2) The server stores the file somewhere...
3) The Consumer checks if there any new files for him and if there are 
gets it.

So I need a way to :
1) restart both the sending and the receiving
2) store the files somewhere on the server.

Reading the 0.8 spec it seems to me that RabbitMQ must provide both.

Am I wrong?


Thanks,
Dimitar


Ben Hood wrote:
> Dimitar,
>
> On Tue, Aug 19, 2008 at 8:57 AM, Dimitar Bakardzhiev
> <dimitar.bakardzhiev at rexintegra.com> wrote:
>   
>> Our use case is to provide secure file transfer.
>>
>> Reading AMQP 0.8 spec it is stated that the protocol itself is secure,
>> but since there is no encryption mention in the spec we will encrypt the
>> files we are sending to RabbitMQ.
>>     
>
> Please be aware that the file streaming class specified in 0-8 is not
> implemented and probably will be removed from a revised version of the
> specification.
>
>   
>> So I have two questions:
>> 1) is our approach of encrypting the files correct to the spirit of
>> RabbitMQ or there is some security built in?
>>     
>
> Have you looked at the SSL guide http://www.rabbitmq.com/api-guide.html#ssl ?
>
>   
>> 2) how we have to use Java client in order to restart sending of a file
>> if some transient network issue occurs?
>>     
>
> If the issue causes the underlying connection to close, you may want
> to want to use the ShutdownListener interface to perform some kind of
> recovery, but one what you actually do may depend on how your
> application handles resends. Have you implemented any chunking,
> streaming or partial acknowledgments? Is this transactional at all?
>
> Ben
>
>   
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080819/d76b3302/attachment.htm 

From alexis.richardson at cohesiveft.com  Tue Aug 19 12:20:08 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Tue, 19 Aug 2008 12:20:08 +0100
Subject: [rabbitmq-discuss] RabbitMQ / Spring integration
In-Reply-To: <269388e30808190106n392bb998va0e011595054417e@mail.gmail.com>
References: <b93bbdbc0808140840k134999bcxebdeea7b4ab8669f@mail.gmail.com>
	<167204d20808140853s82637a5j7ee701ba1b152c12@mail.gmail.com>
	<DF438A8AE379E843A08DA47D7667EEBB9D28A7@vaebe104.NOE.Nokia.com>
	<167204d20808150706i4a84d6e1u2adca5b8cc1f0782@mail.gmail.com>
	<DF438A8AE379E843A08DA47D7667EEBBA0E853@vaebe104.NOE.Nokia.com>
	<269388e30808190106n392bb998va0e011595054417e@mail.gmail.com>
Message-ID: <167204d20808190420q8369ba2i9e937f7bcd02f4db@mail.gmail.com>

Carlos, Ben,

I am cc'ing folks from SpringSource who have discussed these concepts
with me in the past.


On Tue, Aug 19, 2008 at 9:06 AM, Ben Hood <0x6e6562 at gmail.com> wrote:
> Hi Carlos,
>
> On Tue, Aug 19, 2008 at 7:05 AM,  <carlos.quiroz-castro at nokia.com> wrote:
>> Hi
>>
>> I can see two ways of implementing this. One is to use the existing AMQP
>> component which uses qpid in turn. I haven't used it and I don't know
>> its maturity. The other one is to implement directly using the RabbitMQ
>> library
>
> I think it would be most useful for users if the semantics of the AMQP
> model were exposed via a Spring template, rather than just confining
> users to the semantics of JMS. This could make functionality available
> such configuring message routing that isn't available via JMS, for
> example.
>
> An alternative route would be to say I want to keep the JMS template
> semantics and then back the interface with the RabbitMQ java lib. Your
> use case may be to provide migration without having to change client
> code. Some concepts might be mappable between JMS and AMQP, e.g.
> Connection(Factories), Sessions (Channels?) and Destinations (Queues),
> but if you would have to bear in mind that this would probably not
> pass a TCK, especially wrt transactions.

At least initially, this second approach is strongly preferable in
being far easier to implement and manage IMO.  The creation of an
AMQPTemplate and suitable factories using the RabbitMQ Java client
would deliver the required integration.  These should follow the
example of the corresponding JMS tooling classes.  With this done then
other more generic integration could be thought about and then
achieved.


> As for Camel, although I'm not an expert, isn't part of the value-add
> of Camel be able to abstract away different message passing paradigms
> and so therefore AMQP would be just another transport?

I am not an expert either but I agree with this and suspect the
pattern would be similar to that for other message based integration
toolkits such as Mule, which used the RabbitMQ Java client directly
without needing to go via JMS or Spring.  It was not much work at all.

alexis

> Ben
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From petr.sturc at gmail.com  Tue Aug 19 16:15:47 2008
From: petr.sturc at gmail.com (Petr Sturc)
Date: Tue, 19 Aug 2008 17:15:47 +0200
Subject: [rabbitmq-discuss] Load balancing exchange
In-Reply-To: <48A9B0C2.1050503@lshift.net>
References: <73b10e5b0808181006t4fc3505n670806f86547ad83@mail.gmail.com>
	<48A9B0C2.1050503@lshift.net>
Message-ID: <73b10e5b0808190815s313d0c18p258c4b7ee9d0461@mail.gmail.com>

Matthias,

this could be a clue, thanks. I also changed the consumer to do
basicGet instead of basicConsume and seems to work better,
the queue size is different from zero. I will need to try to
understand how the basicConsume works. I was throttling the consumer
doing a pause in the callback handler. This gave me feeling of slow
reception, but probably from the rabbit point of view, the messages
are delivered, just not acknowledged. I'll will look at it.

Thanks,
Petr

On Mon, Aug 18, 2008 at 7:26 PM, Matthias Radestock <matthias at lshift.net> wrote:
> Petr,
>
> Petr Sturc wrote:
>>
>> I am trying following (in the route function)
>> in order to get queue length
>>
>>  {ok,_,QLen,_} = rabbit_amqqueue:stat( #amqqueue{pid = QPid}
>>
>> , but QLen is always zero for all bound queues.
>>
>> Any idea what I am doing wrong?
>
> The above looks fine, and if you look at the code behind it you will see
> that there really isn't much that can go wrong here.
>
> Note however that delivered-but-unacknowledged messages are not included in
> the message count - could that explain why you see a zero count when you
> don't expect to?
>
>
> Matthias.
>



From hubert at lshift.net  Tue Aug 19 18:34:24 2008
From: hubert at lshift.net (Hubert Plociniczak)
Date: Tue, 19 Aug 2008 18:34:24 +0100
Subject: [rabbitmq-discuss] RabbitMQ C# .net client
In-Reply-To: <73DE98796DEF7648900B97A9EA9222B435C14D@RCAPLDC4.rcapl.com>
References: <73DE98796DEF7648900B97A9EA9222B435C14D@RCAPLDC4.rcapl.com>
Message-ID: <48AB0420.7050202@lshift.net>

Hi Lakmali,

There is nothing special in the code.
Could it be the case that you set AutoClose property in connection to true ?

In that case when closing the channel with 'channel.Close(200, "Goodbye");'
this will automatically close the whole connection, because I assume that there are no
other channels left. Hence when you try to close the connection manually after it, 
you get this exception.

Does this help?

Thanks,
Hubert

Lakmali Weeraratne wrote:
>
> Hi Hubert,
>
> I was successful in creating a connection to the OpenAMQ Server.
>
> But when I?m closing the connection, it gives me an exception.
>
> Please be kind enough to point out the cause of the issue.
>
> Code Reference is attached.
>
> Regards,
>
> /Lakmali
>
> ----------------------------------------------------------------------------
>
> Private void closeConnection(object sender, EventArgs e)
>
> {
>
> try
>
> {
>
> channel.Close(200, "Goodbye");
>
> //conn.Close();
>
> }
>
> catch (RabbitMQ.Client.Exceptions.OperationInterruptedException)
>
> {
>
> MessageBox.Show ("Error");
>
> }
>
> }
>
> ------Error Description ------------------------------------------------
>
> On SimpleBlockingRpcContinuation class
>
> public virtual Command GetReply()
>
> {
>
> Either result = (Either)cell.Value;
>
> switch (result.Alternative) {
>
> case EitherAlternative.Left:
>
> return (Command)result.Value;
>
> case EitherAlternative.Right:
>
> throw new OperationInterruptedException((ShutdownEventArgs)result.Value);
>
> default:
>
> Trace.Fail("Illegal EitherAlternative " + result.Alternative);
>
> return null;
>
> }
>
> }
>
>
> Error at:
>
> throw new OperationInterruptedException((ShutdownEventArgs)result.Value);
>
> As
>
> " the AMQP operation was interrupted: AMQP close-reason, initiated by 
> Application, code=200, text="Goodbye", classId=0, methodId=0, cause= "
>
> ------Error Description ------------------------------------------------
>
> ------------------------------------------------------------------------
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>   


-- 
 [][][] Hubert Plociniczak
   [][] LShift Ltd
 []  [] www.lshift.net




From carlos.quiroz-castro at nokia.com  Wed Aug 20 08:16:55 2008
From: carlos.quiroz-castro at nokia.com (carlos.quiroz-castro at nokia.com)
Date: Wed, 20 Aug 2008 10:16:55 +0300
Subject: [rabbitmq-discuss] RabbitMQ / Spring integration
In-Reply-To: <269388e30808190106n392bb998va0e011595054417e@mail.gmail.com>
References: <b93bbdbc0808140840k134999bcxebdeea7b4ab8669f@mail.gmail.com>
	<167204d20808140853s82637a5j7ee701ba1b152c12@mail.gmail.com>
	<DF438A8AE379E843A08DA47D7667EEBB9D28A7@vaebe104.NOE.Nokia.com>
	<167204d20808150706i4a84d6e1u2adca5b8cc1f0782@mail.gmail.com>
	<DF438A8AE379E843A08DA47D7667EEBBA0E853@vaebe104.NOE.Nokia.com>
	<269388e30808190106n392bb998va0e011595054417e@mail.gmail.com>
Message-ID: <DF438A8AE379E843A08DA47D7667EEBBA0EFD6@vaebe104.NOE.Nokia.com>

Hi

I have to say that I'm no expert on AMQP but I have used quite a bit
camel with both STOMP and OpenWire (ActiveMQ own messaging protocol).
I'd think that an ideal component should try to preserve as much as
possible the semantics of AMQP and for that a generic AMQP adapter could
be quite useful. Camel already has one here:

http://activemq.apache.org/camel/amqp.html

Now, the scenario which interest me more is a very simple one where you
really care very little about the protocol itself and basically care
about destinations, payload and perhaps headers and that is an area
where camel is very good since it allows you to connect to different
messaging entities using different protocols.

For the latter case a rabbitmq direct connection using the java client
would probably suffice and be possibly easier to implement. In any case
you can give your rabbitmq component any configuration file you need for
the specifics of the protocol.

Regards
Carlos Quiroz

>-----Original Message-----
>From: ext Ben Hood [mailto:0x6e6562 at gmail.com] 
>Sent: 19 August, 2008 11:07
>To: Quiroz-Castro Carlos (Nokia-NRC/Helsinki)
>Cc: rabbitmq
>Subject: Re: [rabbitmq-discuss] RabbitMQ / Spring integration
>
>Hi Carlos,
>
>On Tue, Aug 19, 2008 at 7:05 AM,  
><carlos.quiroz-castro at nokia.com> wrote:
>> Hi
>>
>> I can see two ways of implementing this. One is to use the existing 
>> AMQP component which uses qpid in turn. I haven't used it 
>and I don't 
>> know its maturity. The other one is to implement directly using the 
>> RabbitMQ library
>
>I think it would be most useful for users if the semantics of 
>the AMQP model were exposed via a Spring template, rather than 
>just confining users to the semantics of JMS. This could make 
>functionality available such configuring message routing that 
>isn't available via JMS, for example.
>
>An alternative route would be to say I want to keep the JMS 
>template semantics and then back the interface with the 
>RabbitMQ java lib. Your use case may be to provide migration 
>without having to change client code. Some concepts might be 
>mappable between JMS and AMQP, e.g.
>Connection(Factories), Sessions (Channels?) and Destinations 
>(Queues), but if you would have to bear in mind that this 
>would probably not pass a TCK, especially wrt transactions.
>
>As for Camel, although I'm not an expert, isn't part of the 
>value-add of Camel be able to abstract away different message 
>passing paradigms and so therefore AMQP would be just another 
>transport?
>
>Ben
>



From carlos.quiroz-castro at nokia.com  Wed Aug 20 08:20:31 2008
From: carlos.quiroz-castro at nokia.com (carlos.quiroz-castro at nokia.com)
Date: Wed, 20 Aug 2008 10:20:31 +0300
Subject: [rabbitmq-discuss] RabbitMQ / Spring integration
In-Reply-To: <167204d20808190420q8369ba2i9e937f7bcd02f4db@mail.gmail.com>
References: <b93bbdbc0808140840k134999bcxebdeea7b4ab8669f@mail.gmail.com>
	<167204d20808140853s82637a5j7ee701ba1b152c12@mail.gmail.com>
	<DF438A8AE379E843A08DA47D7667EEBB9D28A7@vaebe104.NOE.Nokia.com>
	<167204d20808150706i4a84d6e1u2adca5b8cc1f0782@mail.gmail.com>
	<DF438A8AE379E843A08DA47D7667EEBBA0E853@vaebe104.NOE.Nokia.com>
	<269388e30808190106n392bb998va0e011595054417e@mail.gmail.com>
	<167204d20808190420q8369ba2i9e937f7bcd02f4db@mail.gmail.com>
Message-ID: <DF438A8AE379E843A08DA47D7667EEBBA0EFDE@vaebe104.NOE.Nokia.com>

Hi 

>-----Original Message-----
>From: alexis.richardson at gmail.com 
>[mailto:alexis.richardson at gmail.com] On Behalf Of ext Alexis Richardson
>Sent: 19 August, 2008 14:20
>To: Ben Hood
>Cc: Quiroz-Castro Carlos (Nokia-NRC/Helsinki); rabbitmq; Ben 
>Hale; mark.pollack at springsource.com
>Subject: Re: [rabbitmq-discuss] RabbitMQ / Spring integration
>
>Carlos, Ben,
>
>I am cc'ing folks from SpringSource who have discussed these 
>concepts with me in the past.
>
>
>On Tue, Aug 19, 2008 at 9:06 AM, Ben Hood <0x6e6562 at gmail.com> wrote:
>> Hi Carlos,
>>
>> On Tue, Aug 19, 2008 at 7:05 AM,  
><carlos.quiroz-castro at nokia.com> wrote:
>>> Hi
>>>
>>> I can see two ways of implementing this. One is to use the existing 
>>> AMQP component which uses qpid in turn. I haven't used it 
>and I don't 
>>> know its maturity. The other one is to implement directly using the 
>>> RabbitMQ library
>>
>> I think it would be most useful for users if the semantics 
>of the AMQP 
>> model were exposed via a Spring template, rather than just confining 
>> users to the semantics of JMS. This could make functionality 
>available 
>> such configuring message routing that isn't available via JMS, for 
>> example.
>>
>> An alternative route would be to say I want to keep the JMS template 
>> semantics and then back the interface with the RabbitMQ java 
>lib. Your 
>> use case may be to provide migration without having to change client 
>> code. Some concepts might be mappable between JMS and AMQP, e.g.
>> Connection(Factories), Sessions (Channels?) and Destinations 
>(Queues), 
>> but if you would have to bear in mind that this would probably not 
>> pass a TCK, especially wrt transactions.
>
>At least initially, this second approach is strongly 
>preferable in being far easier to implement and manage IMO.  
>The creation of an AMQPTemplate and suitable factories using 
>the RabbitMQ Java client would deliver the required 
>integration.  These should follow the example of the 
>corresponding JMS tooling classes.  With this done then other 
>more generic integration could be thought about and then achieved.

I'd also see that as a way to go for a lightweitght style integration. A
simple component with a set of configuration options that you could use
in the form rabbitmq:queue:myqueue or something along those lines

I'd certainly be quite interested to contribute. My interest is on an
application that uses messaging and that is currently limited on the
amount of clients the messaging queue can support (Not throughput so
much). For that the rabbitmq/erlang concurrentcy architecture should, at
least in theory provide a solid advantage.

Regards
Carlos Quiroz

>
>
>> As for Camel, although I'm not an expert, isn't part of the 
>value-add 
>> of Camel be able to abstract away different message passing 
>paradigms 
>> and so therefore AMQP would be just another transport?
>
>I am not an expert either but I agree with this and suspect 
>the pattern would be similar to that for other message based 
>integration toolkits such as Mule, which used the RabbitMQ 
>Java client directly without needing to go via JMS or Spring.  
>It was not much work at all.
>
>alexis
>
>> Ben
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>



From CLW at ridgecrestfinancial.com  Wed Aug 20 09:37:10 2008
From: CLW at ridgecrestfinancial.com (Lakmali Weeraratne)
Date: Wed, 20 Aug 2008 14:07:10 +0530
Subject: [rabbitmq-discuss] RabbitMQ C# .net client
Message-ID: <73DE98796DEF7648900B97A9EA9222B435C197@RCAPLDC4.rcapl.com>

Hi Hubert,

Yes. It did work. Thanks a lot!

Regards,
/Lakmali



-----Original Message-----
From: Hubert Plociniczak [mailto:hubert at lshift.net] 
Sent: Tuesday, August 19, 2008 11:04 PM
To: Lakmali Weeraratne
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] RabbitMQ C# .net client

Hi Lakmali,

There is nothing special in the code.
Could it be the case that you set AutoClose property in connection to
true ?

In that case when closing the channel with 'channel.Close(200,
"Goodbye");'
this will automatically close the whole connection, because I assume
that there are no
other channels left. Hence when you try to close the connection manually
after it, 
you get this exception.

Does this help?

Thanks,
Hubert



From alexis.richardson at cohesiveft.com  Wed Aug 20 10:25:10 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Wed, 20 Aug 2008 10:25:10 +0100
Subject: [rabbitmq-discuss] RabbitMQ / Spring integration
In-Reply-To: <DF438A8AE379E843A08DA47D7667EEBBA0EFDE@vaebe104.NOE.Nokia.com>
References: <b93bbdbc0808140840k134999bcxebdeea7b4ab8669f@mail.gmail.com>
	<167204d20808140853s82637a5j7ee701ba1b152c12@mail.gmail.com>
	<DF438A8AE379E843A08DA47D7667EEBB9D28A7@vaebe104.NOE.Nokia.com>
	<167204d20808150706i4a84d6e1u2adca5b8cc1f0782@mail.gmail.com>
	<DF438A8AE379E843A08DA47D7667EEBBA0E853@vaebe104.NOE.Nokia.com>
	<269388e30808190106n392bb998va0e011595054417e@mail.gmail.com>
	<167204d20808190420q8369ba2i9e937f7bcd02f4db@mail.gmail.com>
	<DF438A8AE379E843A08DA47D7667EEBBA0EFDE@vaebe104.NOE.Nokia.com>
Message-ID: <167204d20808200225r70112562h296a0d14e47c0a3b@mail.gmail.com>

Carlos

I am going to combine your two emails into one.

> I have to say that I'm no expert on AMQP but I have used quite a bit
> camel with both STOMP and OpenWire (ActiveMQ own messaging protocol).

Good.  You'll find AMQP a bit richer in its behaviour but RabbitMQ's
Java client and docs should provide enough guidance to make the core
use cases obvious.


> I'd think that an ideal component should try to preserve as much as
> possible the semantics of AMQP and for that a generic AMQP adapter could
> be quite useful. Camel already has one here:
>
> http://activemq.apache.org/camel/amqp.html

Right.  So this adaptor assumes Qpid whose Java API is more JMS-like
than RabbitMQ's which is more plain ole Java.  Refactoring the Camel
adaptor to simple Java oughtn't to be a problem for you but it might
be useful to discuss a few cases on this list.  Do you want to have a
go with one or two methods and we can talk through them with you?




> Now, the scenario which interest me more is a very simple one where you
> really care very little about the protocol itself and basically care
> about destinations, payload and perhaps headers and that is an area
> where camel is very good since it allows you to connect to different
> messaging entities using different protocols.

Yes, this is a good goal.


> For the latter case a rabbitmq direct connection using the java client
> would probably suffice and be possibly easier to implement. In any case
> you can give your rabbitmq component any configuration file you need for
> the specifics of the protocol.

One would hope so :-)


On Wed, Aug 20, 2008 at 8:20 AM,  <carlos.quiroz-castro at nokia.com> wrote:
>
>>At least initially, this second approach is strongly
>>preferable in being far easier to implement and manage IMO.
>>The creation of an AMQPTemplate and suitable factories using
>>the RabbitMQ Java client would deliver the required
>>integration.  These should follow the example of the
>>corresponding JMS tooling classes.  With this done then other
>>more generic integration could be thought about and then achieved.
>
> I'd also see that as a way to go for a lightweitght style integration. A
> simple component with a set of configuration options that you could use
> in the form rabbitmq:queue:myqueue or something along those lines
>
> I'd certainly be quite interested to contribute. My interest is on an
> application that uses messaging and that is currently limited on the
> amount of clients the messaging queue can support (Not throughput so
> much). For that the rabbitmq/erlang concurrentcy architecture should, at
> least in theory provide a solid advantage.

Excellent - do you have enough to get started?  Again, feel free to
show your working on the list.  Not only will people help, but the use
cases will be helpful in understanding how the Java client can be
improved.

alexis



From 0x6e6562 at gmail.com  Wed Aug 20 10:53:18 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 20 Aug 2008 10:53:18 +0100
Subject: [rabbitmq-discuss] Secure file transfer
In-Reply-To: <48AA8A03.9060701@rexintegra.com>
References: <48AA7CF3.10903@rexintegra.com>
	<269388e30808190121g106c8c0dw1192beef2ff083a3@mail.gmail.com>
	<48AA8A03.9060701@rexintegra.com>
Message-ID: <269388e30808200253l2a6166efk45c4f1790ee174c2@mail.gmail.com>

Dimitar,

On Tue, Aug 19, 2008 at 9:53 AM, Dimitar Bakardzhiev <dimitar.bakardzhi
> Yes, we will implement chunking but there will be no transactions. The use
> case is as such :
> 1)The Producer sends a file to The Server.
> 2) The server stores the file somewhere...
> 3) The Consumer checks if there any new files for him and if there are gets
> it.
>
> So I need a way to :
> 1) restart both the sending and the receiving
> 2) store the files somewhere on the server.

You can use the persistent option when sending messages to the broker,
so those files will be stored on the server until the consumer
dequeues them.

As for restarting the Java client in an automated fashion, as I said
beforehand, the closing of a connection is a client lifecycle event
that application code can register itself to receive notifications.
This done using the ShutdownListener callback definition. Having said
that, I'm not 100% sure what is the cleanest way to automate restarts,
because I think that there would be a number of things that you would
want to consider before just blindly restarting a dead connection.
This is because the shutdown handler executes in the context of the
connection that has been closed, so whether it is appropriate to start
a new connection "on the back" of a dead connection is a question that
Hubert (who maintains the Java client) may be able to answer.

HTH,

Ben



From carlos.quiroz-castro at nokia.com  Thu Aug 21 10:51:00 2008
From: carlos.quiroz-castro at nokia.com (carlos.quiroz-castro at nokia.com)
Date: Thu, 21 Aug 2008 12:51:00 +0300
Subject: [rabbitmq-discuss] RabbitMQ / Spring integration
In-Reply-To: <167204d20808200225r70112562h296a0d14e47c0a3b@mail.gmail.com>
References: <b93bbdbc0808140840k134999bcxebdeea7b4ab8669f@mail.gmail.com>
	<167204d20808140853s82637a5j7ee701ba1b152c12@mail.gmail.com>
	<DF438A8AE379E843A08DA47D7667EEBB9D28A7@vaebe104.NOE.Nokia.com>
	<167204d20808150706i4a84d6e1u2adca5b8cc1f0782@mail.gmail.com>
	<DF438A8AE379E843A08DA47D7667EEBBA0E853@vaebe104.NOE.Nokia.com>
	<269388e30808190106n392bb998va0e011595054417e@mail.gmail.com>
	<167204d20808190420q8369ba2i9e937f7bcd02f4db@mail.gmail.com>
	<DF438A8AE379E843A08DA47D7667EEBBA0EFDE@vaebe104.NOE.Nokia.com>
	<167204d20808200225r70112562h296a0d14e47c0a3b@mail.gmail.com>
Message-ID: <DF438A8AE379E843A08DA47D7667EEBBA0F676@vaebe104.NOE.Nokia.com>

Hi Alex

I'll have a got at first at sending messages over camel to rabbitmq,
that should be enough to see if the concept makes sense. Receiving
messages often requires some extra work.

I'll share my findings with the list 

Regards
Carlos Quiroz

>-----Original Message-----
>From: alexis.richardson at gmail.com 
>[mailto:alexis.richardson at gmail.com] On Behalf Of ext Alexis Richardson
>Sent: 20 August, 2008 12:25
>To: Quiroz-Castro Carlos (Nokia-NRC/Helsinki)
>Cc: rabbitmq-discuss at lists.rabbitmq.com
>Subject: Re: [rabbitmq-discuss] RabbitMQ / Spring integration
>
>Carlos
>
>I am going to combine your two emails into one.
>
>> I have to say that I'm no expert on AMQP but I have used quite a bit 
>> camel with both STOMP and OpenWire (ActiveMQ own messaging protocol).
>
>Good.  You'll find AMQP a bit richer in its behaviour but 
>RabbitMQ's Java client and docs should provide enough guidance 
>to make the core use cases obvious.
>
>
>> I'd think that an ideal component should try to preserve as much as 
>> possible the semantics of AMQP and for that a generic AMQP adapter 
>> could be quite useful. Camel already has one here:
>>
>> http://activemq.apache.org/camel/amqp.html
>
>Right.  So this adaptor assumes Qpid whose Java API is more 
>JMS-like than RabbitMQ's which is more plain ole Java.  
>Refactoring the Camel adaptor to simple Java oughtn't to be a 
>problem for you but it might be useful to discuss a few cases 
>on this list.  Do you want to have a go with one or two 
>methods and we can talk through them with you?
>
>
>
>
>> Now, the scenario which interest me more is a very simple one where 
>> you really care very little about the protocol itself and basically 
>> care about destinations, payload and perhaps headers and that is an 
>> area where camel is very good since it allows you to connect to 
>> different messaging entities using different protocols.
>
>Yes, this is a good goal.
>
>
>> For the latter case a rabbitmq direct connection using the 
>java client 
>> would probably suffice and be possibly easier to implement. In any 
>> case you can give your rabbitmq component any configuration file you 
>> need for the specifics of the protocol.
>
>One would hope so :-)
>
>
>On Wed, Aug 20, 2008 at 8:20 AM,  
><carlos.quiroz-castro at nokia.com> wrote:
>>
>>>At least initially, this second approach is strongly preferable in 
>>>being far easier to implement and manage IMO.
>>>The creation of an AMQPTemplate and suitable factories using the 
>>>RabbitMQ Java client would deliver the required integration.  These 
>>>should follow the example of the corresponding JMS tooling classes.  
>>>With this done then other more generic integration could be thought 
>>>about and then achieved.
>>
>> I'd also see that as a way to go for a lightweitght style 
>integration. 
>> A simple component with a set of configuration options that 
>you could 
>> use in the form rabbitmq:queue:myqueue or something along those lines
>>
>> I'd certainly be quite interested to contribute. My interest 
>is on an 
>> application that uses messaging and that is currently limited on the 
>> amount of clients the messaging queue can support (Not throughput so 
>> much). For that the rabbitmq/erlang concurrentcy 
>architecture should, 
>> at least in theory provide a solid advantage.
>
>Excellent - do you have enough to get started?  Again, feel 
>free to show your working on the list.  Not only will people 
>help, but the use cases will be helpful in understanding how 
>the Java client can be improved.
>
>alexis
>



From opendev at gmail.com  Thu Aug 21 11:14:36 2008
From: opendev at gmail.com (Joern)
Date: Thu, 21 Aug 2008 12:14:36 +0200
Subject: [rabbitmq-discuss] RabbitMQ / Spring integration
In-Reply-To: <DF438A8AE379E843A08DA47D7667EEBBA0E853@vaebe104.NOE.Nokia.com>
References: <b93bbdbc0808140840k134999bcxebdeea7b4ab8669f@mail.gmail.com>
	<167204d20808140853s82637a5j7ee701ba1b152c12@mail.gmail.com>
	<DF438A8AE379E843A08DA47D7667EEBB9D28A7@vaebe104.NOE.Nokia.com>
	<167204d20808150706i4a84d6e1u2adca5b8cc1f0782@mail.gmail.com>
	<DF438A8AE379E843A08DA47D7667EEBBA0E853@vaebe104.NOE.Nokia.com>
Message-ID: <9e009ad0808210314t7bc3a254l26c4710e719ae91c@mail.gmail.com>

Hi Carlos,

I have no idea at all about Camel (never heard about it before) - it
looks like quite a big abstraction step at first glance.

If we'd focus on abstracting commons usage patterns into templates we
could get the (simple) Spring integration out of the door pretty
quick. My knowledge of AMQP is rather limited though: in my Rabbit
project we always used a single template which declared (one) exchange
and (one) queue and bound them together. This is (obviously) very easy
to abstract. What are the other common patterns? RPC was mentioned
before but I never used (and therefore implemented) it.

Best regards from Berlin,


Joern
--



From alexis.richardson at cohesiveft.com  Thu Aug 21 16:32:17 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Thu, 21 Aug 2008 16:32:17 +0100
Subject: [rabbitmq-discuss] anyone using Twisted?
Message-ID: <167204d20808210832j6a98e8c1vc45131692c6ef4c0@mail.gmail.com>

Hi

One of the OpenAMQ team kindly alerted me to this: https://launchpad.net/txamqp

"Python library for communicating with AMQP peers and brokers using
Twisted.  This project contains all the necessary code to connect,
send and receive messages to/from an AMQP-compliant peer or broker
(Qpid, OpenAMQ, RabbitMQ) using Twisted."

Is anyone using this, or using Twisted?

Let us know - I'd be delighted to understand the use cases better.

alexis



From holger at wizards.de  Thu Aug 21 17:43:18 2008
From: holger at wizards.de (=?ISO-8859-1?Q?Holger_Hoffst=E4tte?=)
Date: Thu, 21 Aug 2008 18:43:18 +0200
Subject: [rabbitmq-discuss] anyone using Twisted?
In-Reply-To: <167204d20808210832j6a98e8c1vc45131692c6ef4c0@mail.gmail.com>
References: <167204d20808210832j6a98e8c1vc45131692c6ef4c0@mail.gmail.com>
Message-ID: <48AD9B26.1080506@wizards.de>

Alexis Richardson wrote:
> One of the OpenAMQ team kindly alerted me to this: https://launchpad.net/txamqp

kewl!

> Is anyone using this, or using Twisted?
> 
> Let us know - I'd be delighted to understand the use cases better.

You mean use cases for Twisted? It's a very nifty Python framework (in the
good sense) with many transports for easily building nonblocking/async
clients & servers, kind of like Java's NIO. This is more important for
python than Java because of its threading.
As far as AMQP is concerned I planned to play with Twisted (while trying
to improve my python at the same time) and had thought about basing a
python AMQP client on Twisted, but with the shared connection for multiple
channels it turned out to be not so useful after all. The easy framework
integration might still be very valuable though.

As an aside, does anybody know whether the AMQP spec mandates the m:1
channel:connection relationship, or is that just what's implemented right
now in Rabbit? IMHO clients in general could also benefit greatly from
bonding multiple connections together; the Java client might be able to
use NIO for that. This could cut down connection contention with many
channels and allow for better network utilization, though it would need to
be handled by the broker as well. Just curious.

Holger



From ellisonbg.net at gmail.com  Thu Aug 21 18:14:43 2008
From: ellisonbg.net at gmail.com (Brian Granger)
Date: Thu, 21 Aug 2008 10:14:43 -0700
Subject: [rabbitmq-discuss] anyone using Twisted?
In-Reply-To: <167204d20808210832j6a98e8c1vc45131692c6ef4c0@mail.gmail.com>
References: <167204d20808210832j6a98e8c1vc45131692c6ef4c0@mail.gmail.com>
Message-ID: <6ce0ac130808211014j72436a55qaa8b8ddff9c3943c@mail.gmail.com>

> Hi
>
> One of the OpenAMQ team kindly alerted me to this: https://launchpad.net/txamqp
>
> "Python library for communicating with AMQP peers and brokers using
> Twisted.  This project contains all the necessary code to connect,
> send and receive messages to/from an AMQP-compliant peer or broker
> (Qpid, OpenAMQ, RabbitMQ) using Twisted."
>
> Is anyone using this, or using Twisted?

I have used Twisted extensively (an asynchronous networking library
for Python), and saw the announcement for txamqp, but I have not
looked at it.  But, I do think that having a really good Twisted+AMQP
library would make AMQP much more usable from python.

> Let us know - I'd be delighted to understand the use cases better.

I think the most important point about Twisted is that is has become
_the way_ in Python for handling asynchronous networking.  From this
standpoint, I would consider a Twisted+AMQP library to be to most
natural approach for having Python bindings to AMQP.

I have used the Qpid Python bindings and while they work OK, I found
them lacking in how asynchronous things are handled.

I am more than willing to discuss this more if people want.

Brian

> alexis
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From jpellerin at leapfrogonline.com  Thu Aug 21 18:11:54 2008
From: jpellerin at leapfrogonline.com (Jason Pellerin)
Date: Thu, 21 Aug 2008 13:11:54 -0400
Subject: [rabbitmq-discuss] mod_rabbitmq loses messages on server restart?
Message-ID: <1219338714.12695.27.camel@localhost>

Hi,

I'm experimenting, successfully so far, with mod_rabbitmq for ejabberd.
One thing doesn't seem right: If I send some messages to an exchange
whose subscriber is not present, then restart ejabberd, then log in with
the subscriber, those messages are not delivered. They are delivered in
all of the normal cases of the subscriber being online, or being offline
and coming online later, so long as the ejabberd server stays up in the
meantime.

To make things more clear, here's the sequence of events:

a at localhost subcribes to foo at rabbitmq.localhost/message.* (a durable
topic exchange)
a at localhost logs out
b at localhost sends message to foo at rabbit@rabbitmq.localhost/message.a

Now, if ejabberd is restarted and a at localhost logs in, no message is
delivered. However, if a at localhost logs in without restarting ejabberd,
the message delivers.

Is this a known issue with ejabberd or mod_rabbitmq? Or am I just doing
something wrong? Can anyone suggest a workaround, or where I might start
looking to try to fix it?

Thanks,

JP


CONFIDENTIALITY NOTE
The document(s) accompanying this e-mail transmission, if any, and the e-mail transmittal message containing information from Leapfrog Online Customer Acquisition, LLC is confidential or privileged. The information is intended to be for the use of the individual(s) or entity(ies) named on this e-mail transmission message. If you are not the intended recipient, be aware that any disclosure, copying, distribution or use of the contents of this e-mail is prohibited. If you have received this e-mail in error, please immediately delete this e-mail and notify us by telephone of the error.



From drew.smathers at gmail.com  Thu Aug 21 18:57:08 2008
From: drew.smathers at gmail.com (Drew Smathers)
Date: Thu, 21 Aug 2008 13:57:08 -0400
Subject: [rabbitmq-discuss] anyone using Twisted?
In-Reply-To: <6ce0ac130808211014j72436a55qaa8b8ddff9c3943c@mail.gmail.com>
References: <167204d20808210832j6a98e8c1vc45131692c6ef4c0@mail.gmail.com>
	<6ce0ac130808211014j72436a55qaa8b8ddff9c3943c@mail.gmail.com>
Message-ID: <368574aa0808211057r74b4d135u844c2cce4673fc22@mail.gmail.com>

On Thu, Aug 21, 2008 at 1:14 PM, Brian Granger <ellisonbg.net at gmail.com> wrote:
> I think the most important point about Twisted is that is has become
> _the way_ in Python for handling asynchronous networking.  From this
> standpoint, I would consider a Twisted+AMQP library to be to most
> natural approach for having Python bindings to AMQP.
>
> I have used the Qpid Python bindings and while they work OK, I found
> them lacking in how asynchronous things are handled.
>
> I am more than willing to discuss this more if people want.
>

Some interesting implications are that by using Twisted, some pretty
useful adapters could be build between clients speaking protocols
specific to Twisted or implemented in Twisted (AMP and experimental
Protocol Buffers impl come to mind).  I need to put
evaluating/exercising txamqp on my TODO list as well.  Having a robust
twisted AMQP implementation would benefit both projects.


-- 
\\\\\/\"/\\\\\\\\\\\
\\\\/ // //\/\\\\\\\
\\\/ \\// /\ \/\\\\
\\/ /\/ / /\/ /\ \\\
\/ / /\/ /\ /\\\ \\
/ /\\\ /\\\ \\\\\/\
\/\\\\\/\\\\\/\\\\\\
 d.p.s



From paul.nendick at gmail.com  Thu Aug 21 19:10:57 2008
From: paul.nendick at gmail.com (Paul C. Nendick)
Date: Thu, 21 Aug 2008 19:10:57 +0100
Subject: [rabbitmq-discuss] anyone using Twisted?
Message-ID: <d437de8f0808211110g7e751abv5dfebf5f5543d78d@mail.gmail.com>

Afternoon from London All,

Yes, there are those of us using RabbitMQ with Twisted. Actually, on
my present project, we're using it very heavily - it's great - and
we've made a proper, working twisted protocol implementation for AMQP.
I'm working with my employer on open sourcing this bit of code but
it's unlikely to happen soon. If and when it does, I'll release it as
either a patch to txamqp or as part of this project:
  http://www.peloton-grid.net/

Some observations about txamqp:
* it's very alpha and clearly incomplete
* it's fundamentally misunderstood the way AMQP  routes of messages
over separate channels. Deferred calls often don't fire since txamqp
is waiting for the response on the wrong channel. Oops!
* txamqp is multi-threaded. Tsk tsk, this is a no-no for twisted
protocol handlers
* QPID sucks. Badly, just look at the code.
* QPID's autogeneration from the XML spec however is very cool
* the txamqp unit tests are very good and quite easy to adapt to be
made asynchronous

We've resolved these and other issues. In the end, it will help me
open source the code to know the level of your interest in it. I'll
announce any news on this list.

regards,

/p

PS: anyone else going to PyCon UK?



From ellisonbg.net at gmail.com  Thu Aug 21 19:51:39 2008
From: ellisonbg.net at gmail.com (Brian Granger)
Date: Thu, 21 Aug 2008 11:51:39 -0700
Subject: [rabbitmq-discuss] anyone using Twisted?
In-Reply-To: <d437de8f0808211110g7e751abv5dfebf5f5543d78d@mail.gmail.com>
References: <d437de8f0808211110g7e751abv5dfebf5f5543d78d@mail.gmail.com>
Message-ID: <6ce0ac130808211151wc5d87c9t49c57f239be4fcf3@mail.gmail.com>

> Yes, there are those of us using RabbitMQ with Twisted. Actually, on
> my present project, we're using it very heavily - it's great - and
> we've made a proper, working twisted protocol implementation for AMQP.
> I'm working with my employer on open sourcing this bit of code but
> it's unlikely to happen soon. If and when it does, I'll release it as
> either a patch to txamqp or as part of this project:
>  http://www.peloton-grid.net/

Fantastic.

> Some observations about txamqp:
> * it's very alpha and clearly incomplete
> * it's fundamentally misunderstood the way AMQP  routes of messages
> over separate channels. Deferred calls often don't fire since txamqp
> is waiting for the response on the wrong channel. Oops!
> * txamqp is multi-threaded. Tsk tsk, this is a no-no for twisted
> protocol handlers
> * QPID sucks. Badly, just look at the code.
> * QPID's autogeneration from the XML spec however is very cool
> * the txamqp unit tests are very good and quite easy to adapt to be
> made asynchronous

I haven't looked at txamqp enough to see these issues.  But yes,
because qpid uses threads, it won't mix well with Twisted.

> We've resolved these and other issues. In the end, it will help me
> open source the code to know the level of your interest in it. I'll
> announce any news on this list.

I would be very interested in see a robust Twisted+AMQP library.

Cheers,

Brian

> regards,
>
> /p
>
> PS: anyone else going to PyCon UK?
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From 0x6e6562 at gmail.com  Thu Aug 21 20:47:01 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Thu, 21 Aug 2008 20:47:01 +0100
Subject: [rabbitmq-discuss] anyone using Twisted?
In-Reply-To: <d437de8f0808211110g7e751abv5dfebf5f5543d78d@mail.gmail.com>
References: <d437de8f0808211110g7e751abv5dfebf5f5543d78d@mail.gmail.com>
Message-ID: <269388e30808211247j77def2d5td63e2ec43278592e@mail.gmail.com>

Paul

On Thu, Aug 21, 2008 at 7:10 PM, Paul C. Nendick <paul.nendick at gmail.com> wrote:
> * txamqp is multi-threaded. Tsk tsk, this is a no-no for twisted
> protocol handlers

You might then be interested in Barry Pedersen's library that doesn't thread:
http://barryp.org/software/py-amqplib/

> * QPID's autogeneration from the XML spec however is very cool

Barry's lib generates this from the XML spec as well, but does it
statically. In fact, this is the approach that RabbitMQ takes, see the
(Python-based) codegen module:
http://hg.rabbitmq.com/rabbitmq-codegen/

Also, several other libraries take this compile time approach to codec
handling as well.

HTH,

Ben



From jpellerin at leapfrogonline.com  Thu Aug 21 22:54:05 2008
From: jpellerin at leapfrogonline.com (Jason Pellerin)
Date: Thu, 21 Aug 2008 17:54:05 -0400
Subject: [rabbitmq-discuss] another mod_rabbitmq issue: delivery stops after
	100 messages
Message-ID: <1219355645.12695.37.camel@localhost>

I've run into another issue with mod_rabbitmq -- it only appears to
deliver 100 messages at a time. This isn't due to ejabberd rate settings
-- I've tried with no shapers configured, and verified that I can send
more than 100 messages at at time directly between user accounts.
However, when sending through a mod_rabbitmq topic exchange (haven't
tried the other types), only 100 messages can be consumed until the
account logs off and back in.

Say you send 1000 messages to the exchange. After 100 messages, the
subscribed consumer stops consuming and delivering messages. But if the
client logs off and back in, another 100 messages are delivered.

I don't see anything obvious in the mod_rabbitmq source that would be
causing this. I'm using rabbit 1.4.0 beta, mod_rabbitmq from hg, and
ejabberd 2.0.2 beta.

Any ideas? If this isn't the right forum for mod_rabbitmq questions, can
someone point me to a more appropriate one?

Thanks,

JP


CONFIDENTIALITY NOTE
The document(s) accompanying this e-mail transmission, if any, and the e-mail transmittal message containing information from Leapfrog Online Customer Acquisition, LLC is confidential or privileged. The information is intended to be for the use of the individual(s) or entity(ies) named on this e-mail transmission message. If you are not the intended recipient, be aware that any disclosure, copying, distribution or use of the contents of this e-mail is prohibited. If you have received this e-mail in error, please immediately delete this e-mail and notify us by telephone of the error.



From ksalasko at gmail.com  Fri Aug 22 00:22:38 2008
From: ksalasko at gmail.com (Kyle)
Date: Thu, 21 Aug 2008 19:22:38 -0400
Subject: [rabbitmq-discuss] anyone using Twisted?
In-Reply-To: <269388e30808211247j77def2d5td63e2ec43278592e@mail.gmail.com>
References: <d437de8f0808211110g7e751abv5dfebf5f5543d78d@mail.gmail.com>
	<269388e30808211247j77def2d5td63e2ec43278592e@mail.gmail.com>
Message-ID: <ffa3c1da0808211622g77c0fe99ud899ed9aafeb287c@mail.gmail.com>

On Thu, Aug 21, 2008 at 3:47 PM, Ben Hood <0x6e6562 at gmail.com> wrote:
>
> You might then be interested in Barry Pedersen's library that doesn't
> thread:
> http://barryp.org/software/py-amqplib/
>

I've been trying to find a good solution to using amqp within a Twisted
framework for a while now. Barry's library was the first thing we tried, but
unfortunately found that it caused errors within the Twisted reactor that
were very hard to track down, and using wait() in a loop doesn't work well
when the rest of the code is asynchronous. Eventually we settled on using
RabbitMQ's Java bindings through JPype <http://jpype.sourceforge.net/>,
which has its own problems, not the least of which is bringing a JVM into
the process, which I'd love to get rid of.

> We've resolved these and other issues. In the end, it will help me
> open source the code to know the level of your interest in it. I'll
> announce any news on this list.

A solid Twisted AMQP library would be great, we've been thinking about
working on one for a while now, but it got lost in the background after we
ran with the Java client with no issues. Definitely a lot of interest here.

Thanks,
Kyle
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080821/c8367534/attachment.htm 

From alexis.richardson at cohesiveft.com  Fri Aug 22 09:56:32 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Fri, 22 Aug 2008 09:56:32 +0100
Subject: [rabbitmq-discuss] anyone using Twisted?
In-Reply-To: <ffa3c1da0808211622g77c0fe99ud899ed9aafeb287c@mail.gmail.com>
References: <d437de8f0808211110g7e751abv5dfebf5f5543d78d@mail.gmail.com>
	<269388e30808211247j77def2d5td63e2ec43278592e@mail.gmail.com>
	<ffa3c1da0808211622g77c0fe99ud899ed9aafeb287c@mail.gmail.com>
Message-ID: <167204d20808220156k6f8428dfkdc65d176a209811d@mail.gmail.com>

Kyle, Paul, Brian, et al.

Thanks very much indeed for the rapid fire responses.

On Fri, Aug 22, 2008 at 12:22 AM, Kyle <ksalasko at gmail.com> wrote:

>> We've resolved these and other issues. In the end, it will help me
>> open source the code to know the level of your interest in it. I'll
>> announce any news on this list.
>
> A solid Twisted AMQP library would be great, we've been thinking about
> working on one for a while now, but it got lost in the background after we
> ran with the Java client with no issues. Definitely a lot of interest here.

I have as they say 'reached out to' Terry from Fluidinfo - the authors
of txAMQP - to let him know there is interest.

He's terrycojones on twitter.

alexis



From rgl at ruilopes.com  Fri Aug 22 10:33:39 2008
From: rgl at ruilopes.com (Rui Lopes)
Date: Fri, 22 Aug 2008 10:33:39 +0100
Subject: [rabbitmq-discuss] anyone using Twisted?
In-Reply-To: <167204d20808220156k6f8428dfkdc65d176a209811d@mail.gmail.com>
References: <d437de8f0808211110g7e751abv5dfebf5f5543d78d@mail.gmail.com>	<269388e30808211247j77def2d5td63e2ec43278592e@mail.gmail.com>	<ffa3c1da0808211622g77c0fe99ud899ed9aafeb287c@mail.gmail.com>
	<167204d20808220156k6f8428dfkdc65d176a209811d@mail.gmail.com>
Message-ID: <48AE87F3.6020601@ruilopes.com>

Alexis Richardson wrote:
>>> We've resolved these and other issues. In the end, it will help me
>>> open source the code to know the level of your interest in it. I'll
>>> announce any news on this list.
>>>       
>> A solid Twisted AMQP library would be great, we've been thinking about
>> working on one for a while now, but it got lost in the background after we
>> ran with the Java client with no issues. Definitely a lot of interest here.
>>     
>
> I have as they say 'reached out to' Terry from Fluidinfo - the authors
> of txAMQP - to let him know there is interest.
>
> He's terrycojones on twitter.
>   
Just want to wave my hand!

Thanks for reaching him out, and hope to see then release it :-)

Best regards,
Rui Lopes



From torben.lehoff at googlemail.com  Fri Aug 22 13:57:23 2008
From: torben.lehoff at googlemail.com (Torben Hoffmann)
Date: Fri, 22 Aug 2008 14:57:23 +0200
Subject: [rabbitmq-discuss] RabbitMQ/AMQP understanding
Message-ID: <ecfbfea90808220557m2fb4c1b1n56c1cf75990ea6c9@mail.gmail.com>

Hi,

After having read the AMQP standard and revisited the RabbitMQ slides from
the Erlang Exchange (
http://www.lshift.net/blog/2008/07/01/slides-from-our-erlang-exchange-talk)
I still have a bit of understanding to get in place, which I hope some of
you can help me with.

Here is the basic problem I need to solve - see attached picture:
A, B and C are all members of the same group G and when they send messages
to each other in the group the group ID is used as the target address in the
message.

(In case the attached picture does not arrive: A is located at machine M1, B
@ M2 and C @ M3.)

So when A sends Msg to the group G it has to be routed to B and C where ever
they may be. As you can see A sends Msg to M1 which notices that it is
targeted to the group G and M1 then finds out that there are group members
of G at the machines M2 and M3, hence it sends Msg to M2 and M3. At the
receiving machines - M2 and M3 - the message is then delivered to the
members of the group attached to the machine.

The na?ve approach would be to create a queue for the group G and have all
group members subscribe to that queue.
Questions:

   1. Does the sender receives its own message though the queue?
   2. Is there a way to notify clients like B and C that there is a message
for them in one of their queues? Or do you have to poll the queue to find
out if there is something for you? (Basically this is a question of using a
interrupt like thing vs polling.)

Now for the deployment: I cannot use a single AMQP server to handle all of
this since the load would be too high to meet the strict performance
requirements in place so some sort of distribution of the work must be done.

My initial understanding leads me to say that for the attached problem I
should create a cluster consisting of M1, M2 and M3 and then just let
RabbitMQ deal with all the nitty gritty details.
Is that a correct understanding of how to use RabbitMQ to address the basic
problem?

Cheers,
Torben
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080822/9f2cd365/attachment.htm 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: BasicProblem.png
Type: image/png
Size: 38869 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080822/9f2cd365/attachment.png 

From 0x6e6562 at gmail.com  Fri Aug 22 14:05:40 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Fri, 22 Aug 2008 14:05:40 +0100
Subject: [rabbitmq-discuss] RabbitMQ/AMQP understanding
In-Reply-To: <ecfbfea90808220557m2fb4c1b1n56c1cf75990ea6c9@mail.gmail.com>
References: <ecfbfea90808220557m2fb4c1b1n56c1cf75990ea6c9@mail.gmail.com>
Message-ID: <269388e30808220605q3406b1cfjd3bd703434d71a09@mail.gmail.com>

Torben,

On Fri, Aug 22, 2008 at 1:57 PM, Torben Hoffmann
<torben.lehoff at googlemail.com> wrote:

> Here is the basic problem I need to solve - see attached picture:
> A, B and C are all members of the same group G and when they send messages
> to each other in the group the group ID is used as the target address in the
> message.
>
> (In case the attached picture does not arrive: A is located at machine M1, B
> @ M2 and C @ M3.)
>
> So when A sends Msg to the group G it has to be routed to B and C where ever
> they may be. As you can see A sends Msg to M1 which notices that it is
> targeted to the group G and M1 then finds out that there are group members
> of G at the machines M2 and M3, hence it sends Msg to M2 and M3. At the
> receiving machines - M2 and M3 - the message is then delivered to the
> members of the group attached to the machine.


This *sounds* like a simple fanout exchange scenario. Fanout exchanges
are one of the basic exchange types in AMQP. It could also be achieved
using other exchange types, depending on what the specific
requirements are.

>
> The na?ve approach would be to create a queue for the group G and have all
> group members subscribe to that queue.
> Questions:
>
>    1. Does the sender receives its own message though the queue?

Not quite sure what you mean with this. Are you asking whether a
producer gets an echo of each message it sends by default? In general
nobody will receive a message unless it is consuming from a queue that
messages are routed to.

>    2. Is there a way to notify clients like B and C that there is a message
> for them in one of their queues? Or do you have to poll the queue to find
> out if there is something for you? (Basically this is a question of using a
> interrupt like thing vs polling.)

If a client subscribes to a queue, the channel will deliver messages
to it as and when they are routed, so there is no need to poll
explicitly. If for some reason you need to poll, there is a method
called basic.get which allows you to poll a queue.

BTW, are you asking this question in the context of the API of a MOM
system that you have used in the past?


>
> Now for the deployment: I cannot use a single AMQP server to handle all of
> this since the load would be too high to meet the strict performance
> requirements in place so some sort of distribution of the work must be done.
>
> My initial understanding leads me to say that for the attached problem I
> should create a cluster consisting of M1, M2 and M3 and then just let
> RabbitMQ deal with all the nitty gritty details.

You can set up a cluster of Rabbit broker instances. This is explained
in more detail in the clustering guide:
http://www.rabbitmq.com/clustering.html

> Is that a correct understanding of how to use RabbitMQ to address the basic
> problem?

Without wanting to assume anything from the attachment, the impression
arises that you are thinking of an MQ-Series topology with
transmission queues.

You don't necessarily need to do that with AMQP. You could treat a
broker or cluster of brokers as a single logical instance that clients
connect to in order to subscribe to queues.

Please let me know if this answers your question.

HTH,

Ben



From alexis.richardson at cohesiveft.com  Fri Aug 22 14:16:02 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Fri, 22 Aug 2008 14:16:02 +0100
Subject: [rabbitmq-discuss] RabbitMQ/AMQP understanding
In-Reply-To: <269388e30808220605q3406b1cfjd3bd703434d71a09@mail.gmail.com>
References: <ecfbfea90808220557m2fb4c1b1n56c1cf75990ea6c9@mail.gmail.com>
	<269388e30808220605q3406b1cfjd3bd703434d71a09@mail.gmail.com>
Message-ID: <167204d20808220616p7b1236d6p9715997816f79408@mail.gmail.com>

Ben, thanks!

Torben, just a couple of 'adds' to Ben's comments..  Please let us
know if this is helping / going in the right direction for you.

On Fri, Aug 22, 2008 at 2:05 PM, Ben Hood <0x6e6562 at gmail.com> wrote:
>>    1. Does the sender receives its own message though the queue?
>
> Not quite sure what you mean with this. Are you asking whether a
> producer gets an echo of each message it sends by default? In general
> nobody will receive a message unless it is consuming from a queue that
> messages are routed to.

Torben, were you thinking of the JMS 'no local' behaviour where IF a
client that is both sending messages and consuming messages from the
same single topic, which usually is shared with other clients, THEN it
only sees messages that it did not send - ie it only sees those
messages produced by other clients?

alexis



From torben.lehoff at googlemail.com  Fri Aug 22 14:31:11 2008
From: torben.lehoff at googlemail.com (Torben Hoffmann)
Date: Fri, 22 Aug 2008 15:31:11 +0200
Subject: [rabbitmq-discuss] RabbitMQ/AMQP understanding
In-Reply-To: <269388e30808220605q3406b1cfjd3bd703434d71a09@mail.gmail.com>
References: <ecfbfea90808220557m2fb4c1b1n56c1cf75990ea6c9@mail.gmail.com>
	<269388e30808220605q3406b1cfjd3bd703434d71a09@mail.gmail.com>
Message-ID: <ecfbfea90808220631i7934e7eas33630b92a4fe1411@mail.gmail.com>

On Fri, Aug 22, 2008 at 3:05 PM, Ben Hood <0x6e6562 at gmail.com> wrote:

> Torben,
>
> On Fri, Aug 22, 2008 at 1:57 PM, Torben Hoffmann
> <torben.lehoff at googlemail.com> wrote:
>
> > Here is the basic problem I need to solve - see attached picture:
> > A, B and C are all members of the same group G and when they send
> messages
> > to each other in the group the group ID is used as the target address in
> the
> > message.
> >
> > (In case the attached picture does not arrive: A is located at machine
> M1, B
> > @ M2 and C @ M3.)
> >
> > So when A sends Msg to the group G it has to be routed to B and C where
> ever
> > they may be. As you can see A sends Msg to M1 which notices that it is
> > targeted to the group G and M1 then finds out that there are group
> members
> > of G at the machines M2 and M3, hence it sends Msg to M2 and M3. At the
> > receiving machines - M2 and M3 - the message is then delivered to the
> > members of the group attached to the machine.
>
>
> This *sounds* like a simple fanout exchange scenario. Fanout exchanges
> are one of the basic exchange types in AMQP. It could also be achieved
> using other exchange types, depending on what the specific
> requirements are.
>
> >
> > The na?ve approach would be to create a queue for the group G and have
> all
> > group members subscribe to that queue.
> > Questions:
> >
> >    1. Does the sender receives its own message though the queue?
>
> Not quite sure what you mean with this. Are you asking whether a
> producer gets an echo of each message it sends by default? In general
> nobody will receive a message unless it is consuming from a queue that
> messages are routed to.


Alexis added the last bit of explanation so now I know that I can send to a
queue where I am a consumer without getting my own messages.


> >    2. Is there a way to notify clients like B and C that there is a
> message
> > for them in one of their queues? Or do you have to poll the queue to find
> > out if there is something for you? (Basically this is a question of using
> a
> > interrupt like thing vs polling.)
>
>
> If a client subscribes to a queue, the channel will deliver messages
> to it as and when they are routed, so there is no need to poll
> explicitly. If for some reason you need to poll, there is a method
> called basic.get which allows you to poll a queue.


This is brilliant - for sanity I would really like to avoid polling the
queue since the non-polling setup makes my architecture a lot nicer.


>
>
> BTW, are you asking this question in the context of the API of a MOM
> system that you have used in the past?


Not sure what a MOM system is, but I am trying to map the functionality of a
legacy system to AMQP since I think it could save a lot of effort and money.


> >
> > Now for the deployment: I cannot use a single AMQP server to handle all
> of
> > this since the load would be too high to meet the strict performance
> > requirements in place so some sort of distribution of the work must be
> done.
> >
> > My initial understanding leads me to say that for the attached problem I
> > should create a cluster consisting of M1, M2 and M3 and then just let
> > RabbitMQ deal with all the nitty gritty details.
>
>
>
> You can set up a cluster of Rabbit broker instances. This is explained
> in more detail in the clustering guide:
> http://www.rabbitmq.com/clustering.html
>
> > Is that a correct understanding of how to use RabbitMQ to address the
> basic
> > problem?
>
> Without wanting to assume anything from the attachment, the impression
> arises that you are thinking of an MQ-Series topology with
> transmission queues.
>
> You don't necessarily need to do that with AMQP. You could treat a
> broker or cluster of brokers as a single logical instance that clients
> connect to in order to subscribe to queues.


For my basic problem I would like to have a queue for the group G that I can
send to and then all members of the queue (bar the sender) will receive that
message.
It does not matter if I have one or more logical instances, but from a
architectural perspective I think that it would be best to have a single
logical instance so that I could utilise the distribution mechanisms of
RabbitMQ without knowing about the topology at the application level.

If I have more than one server how would the messages be distributed?
If I have a AMQP server at each of my machines and user A sends a message to
the group G how would that message be routed to  B and C? How should the
servers be connected/configured to allow that routing?

Note that I could have hundreds of machines but I will send the message to
the few of them that has a member of the group registered at the machine.

Cheers,
Torben
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080822/985e2c74/attachment.htm 

From tonyg at lshift.net  Fri Aug 22 15:17:43 2008
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Fri, 22 Aug 2008 15:17:43 +0100
Subject: [rabbitmq-discuss] another mod_rabbitmq issue: delivery stops
 after	100 messages
In-Reply-To: <1219355645.12695.37.camel@localhost>
References: <1219355645.12695.37.camel@localhost>
Message-ID: <48AECA87.1060205@lshift.net>

Hi Jason,

Jason Pellerin wrote:
> I've run into another issue with mod_rabbitmq -- it only appears to
> deliver 100 messages at a time.

Ah -- that's my mistake, I think. The number 100 was a giveaway -- it
lines up with the constant UNSENT_MESSAGE_LIMIT in
rabbit_amqqueue_process.erl :-)

http://hg.rabbitmq.com/rabbitmq-xmpp/rev/0bf6a7623de0 contains a
tentative fix. Please try it out and let me know if it resolves the issue.

Regards,
  Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From 0x6e6562 at gmail.com  Fri Aug 22 15:25:51 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Fri, 22 Aug 2008 15:25:51 +0100
Subject: [rabbitmq-discuss] RabbitMQ/AMQP understanding
In-Reply-To: <ecfbfea90808220631i7934e7eas33630b92a4fe1411@mail.gmail.com>
References: <ecfbfea90808220557m2fb4c1b1n56c1cf75990ea6c9@mail.gmail.com>
	<269388e30808220605q3406b1cfjd3bd703434d71a09@mail.gmail.com>
	<ecfbfea90808220631i7934e7eas33630b92a4fe1411@mail.gmail.com>
Message-ID: <269388e30808220725o157501ffua477768b194e90d6@mail.gmail.com>

Torben,

On Fri, Aug 22, 2008 at 2:31 PM, Torben Hoffmann
<torben.lehoff at googlemail.com> wrote:

> Not sure what a MOM system is, but I am trying to map the functionality of a
> legacy system to AMQP since I think it could save a lot of effort and money.

MOM = Message-oriented middleware

> For my basic problem I would like to have a queue for the group G that I can
> send to and then all members of the queue (bar the sender) will receive that
> message.

As indicated in my previous mail, one way this can be achieved is
using a fanout exchange.

[Taken from the spec] The fanout exchange type works as follows:

1. A message queue binds to the exchange with no arguments.
2. A publisher sends the exchange a message.
3. The message is passed to the message queue unconditionally.

Here is a simple example using the Ruby client for AMQP:

http://github.com/tmm1/amqp/tree/master/examples/mq/clock.rb

Although this is a Ruby example, the basic principle of a creating a
queue, binding it to an exchange and subscribing a consumer to it hold
true of any client language. I just used this as an example because it
is a quick link.

> It does not matter if I have one or more logical instances, but from a
> architectural perspective I think that it would be best to have a single
> logical instance so that I could utilise the distribution mechanisms of
> RabbitMQ without knowing about the topology at the application level.
>
> If I have more than one server how would the messages be distributed?

This is achieved using OTP distribution mechanisms with some
AMQP/Rabbit-specific optimizations between nodes.

In *very* loose terms, a client opens a channel on a particular node
and this broker-side channel creates a communication link between
itself and the underlying queue *instance*, wherever that may
physically reside. If it declares a queue that doesn't already exist,
the queue will be created locally, if it already exists it *may*
already reside on another node, but OTP message passing keeps this
transparent.

> If I have a AMQP server at each of my machines and user A sends a message to
> the group G how would that message be routed to  B and C? How should the
> servers be connected/configured to allow that routing?

G would be the name an exchange and B & C create queues and bind them
to the exchange G.

As indicated above this could be a simple fanout, but a direct
exchange with multiple bindings would work as well.

Note that you do not necessarily need an AMQP instance on machine that
clients run on. Multiple remote clients can connect to a single broker
instance.

> Note that I could have hundreds of machines but I will send the message to
> the few of them that has a member of the group registered at the machine.

When you say you have hundreds of machines, do you mean machines that
you will use to run consumer processes on?

The size of your broker cluster will depend (amongst other factors) on
the amount of messages you need the system to be able to handle.

HTH,

Ben



From holger at wizards.de  Fri Aug 22 16:39:36 2008
From: holger at wizards.de (=?ISO-8859-1?Q?Holger_Hoffst=E4tte?=)
Date: Fri, 22 Aug 2008 17:39:36 +0200
Subject: [rabbitmq-discuss] RabbitMQ/AMQP understanding
In-Reply-To: <269388e30808220605q3406b1cfjd3bd703434d71a09@mail.gmail.com>
References: <ecfbfea90808220557m2fb4c1b1n56c1cf75990ea6c9@mail.gmail.com>
	<269388e30808220605q3406b1cfjd3bd703434d71a09@mail.gmail.com>
Message-ID: <5ad109e90808220839lc73d2d8mbbf4231926f8d44f@mail.gmail.com>

On 8/22/08, Ben Hood <0x6e6562 at gmail.com> wrote:
>  >    2. Is there a way to notify clients like B and C that there is a message
>  > for them in one of their queues? Or do you have to poll the queue to find
>  > out if there is something for you? (Basically this is a question of using a
>  > interrupt like thing vs polling.)
>
> If a client subscribes to a queue, the channel will deliver messages
>  to it as and when they are routed, so there is no need to poll
>  explicitly. If for some reason you need to poll, there is a method
>  called basic.get which allows you to poll a queue.
>
>  BTW, are you asking this question in the context of the API of a MOM
>  system that you have used in the past?

I was wondering the same - to me it sounds like he might be looking
for the equivalent of a JMS MessageListener (with delivery in a thread
pool etc.) and I don't think that's something the Java client lib can
do right now.
Torben, can you clarify what language you are planning to use and
whether this is what you meant with "polling vs. interrupt"?

Holger



From smokinn at gmail.com  Fri Aug 22 17:24:16 2008
From: smokinn at gmail.com (Guillaume Theoret)
Date: Fri, 22 Aug 2008 12:24:16 -0400
Subject: [rabbitmq-discuss] anyone using Twisted?
In-Reply-To: <ffa3c1da0808211622g77c0fe99ud899ed9aafeb287c@mail.gmail.com>
References: <d437de8f0808211110g7e751abv5dfebf5f5543d78d@mail.gmail.com>
	<269388e30808211247j77def2d5td63e2ec43278592e@mail.gmail.com>
	<ffa3c1da0808211622g77c0fe99ud899ed9aafeb287c@mail.gmail.com>
Message-ID: <7acec0a40808220924y6686c1abhf9831e65ea5f53e4@mail.gmail.com>

On Thu, Aug 21, 2008 at 7:22 PM, Kyle <ksalasko at gmail.com> wrote:
> On Thu, Aug 21, 2008 at 3:47 PM, Ben Hood <0x6e6562 at gmail.com> wrote:
>>
>> You might then be interested in Barry Pedersen's library that doesn't
>> thread:
>> http://barryp.org/software/py-amqplib/
>
> I've been trying to find a good solution to using amqp within a Twisted
> framework for a while now. Barry's library was the first thing we tried, but
> unfortunately found that it caused errors within the Twisted reactor that
> were very hard to track down, and using wait() in a loop doesn't work well
> when the rest of the code is asynchronous. Eventually we settled on using
> RabbitMQ's Java bindings through JPype, which has its own problems, not the
> least of which is bringing a JVM into the process, which I'd love to get rid
> of.
>
>> We've resolved these and other issues. In the end, it will help me
>> open source the code to know the level of your interest in it. I'll
>> announce any news on this list.
>
> A solid Twisted AMQP library would be great, we've been thinking about
> working on one for a while now, but it got lost in the background after we
> ran with the Java client with no issues. Definitely a lot of interest here.

Same here. I tried for a while with Barry's library but couldn't
figure out a couple of things (probably my fault though not his, still
very new at AMQP and don't fully understand how a lot of the stuff is
supposed to be done yet) and since I got the Java client going so well
and easily we went with that.

Here we (and I) definitely prefer coding in python =)

>
> Thanks,
> Kyle
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From torben.lehoff at googlemail.com  Fri Aug 22 21:05:03 2008
From: torben.lehoff at googlemail.com (Torben Hoffmann)
Date: Fri, 22 Aug 2008 22:05:03 +0200
Subject: [rabbitmq-discuss] RabbitMQ/AMQP understanding
In-Reply-To: <269388e30808220725o157501ffua477768b194e90d6@mail.gmail.com>
References: <ecfbfea90808220557m2fb4c1b1n56c1cf75990ea6c9@mail.gmail.com>
	<269388e30808220605q3406b1cfjd3bd703434d71a09@mail.gmail.com>
	<ecfbfea90808220631i7934e7eas33630b92a4fe1411@mail.gmail.com>
	<269388e30808220725o157501ffua477768b194e90d6@mail.gmail.com>
Message-ID: <ecfbfea90808221305qcd75621j3a39bf01625c7904@mail.gmail.com>

On Fri, Aug 22, 2008 at 4:25 PM, Ben Hood <0x6e6562 at gmail.com> wrote:

> Torben,
>
> On Fri, Aug 22, 2008 at 2:31 PM, Torben Hoffmann
> <torben.lehoff at googlemail.com> wrote:
>
> > Not sure what a MOM system is, but I am trying to map the functionality
> of a
> > legacy system to AMQP since I think it could save a lot of effort and
> money.
>
> MOM = Message-oriented middleware
>
> > For my basic problem I would like to have a queue for the group G that I
> can
> > send to and then all members of the queue (bar the sender) will receive
> that
> > message.
>
> As indicated in my previous mail, one way this can be achieved is
> using a fanout exchange.
>
> [Taken from the spec] The fanout exchange type works as follows:
>
> 1. A message queue binds to the exchange with no arguments.
> 2. A publisher sends the exchange a message.
> 3. The message is passed to the message queue unconditionally.
>
> Here is a simple example using the Ruby client for AMQP:
>
> http://github.com/tmm1/amqp/tree/master/examples/mq/clock.rb
>
> Although this is a Ruby example, the basic principle of a creating a
> queue, binding it to an exchange and subscribing a consumer to it hold
> true of any client language. I just used this as an example because it
> is a quick link.


Good example - that part is now under control for me.


>
>
> > It does not matter if I have one or more logical instances, but from a
> > architectural perspective I think that it would be best to have a single
> > logical instance so that I could utilise the distribution mechanisms of
> > RabbitMQ without knowing about the topology at the application level.
> >
> > If I have more than one server how would the messages be distributed?
>
> This is achieved using OTP distribution mechanisms with some
> AMQP/Rabbit-specific optimizations between nodes.
>
> In *very* loose terms, a client opens a channel on a particular node
> and this broker-side channel creates a communication link between
> itself and the underlying queue *instance*, wherever that may
> physically reside. If it declares a queue that doesn't already exist,
> the queue will be created locally, if it already exists it *may*
> already reside on another node, but OTP message passing keeps this
> transparent.


Good - this is what I gather from the documentation. It fits my needs rather
well.


>
>
> > If I have a AMQP server at each of my machines and user A sends a message
> to
> > the group G how would that message be routed to  B and C? How should the
> > servers be connected/configured to allow that routing?
>
> G would be the name an exchange and B & C create queues and bind them
> to the exchange G.
>
> As indicated above this could be a simple fanout, but a direct
> exchange with multiple bindings would work as well.


Okay, I did not think of this type of solution, but I think this would work
just as fine. So either I get a lot of queues or a lot of exchanges
depending on how I choose to represent the groups. I will let that be up to
a practical test on a couple of machines.


>
> Note that you do not necessarily need an AMQP instance on machine that
> clients run on. Multiple remote clients can connect to a single broker
> instance.


Yes, but for the sake of performance I think that the more I can distribute
the work load the better.


>
>
> > Note that I could have hundreds of machines but I will send the message
> to
> > the few of them that has a member of the group registered at the machine.
>
> When you say you have hundreds of machines, do you mean machines that
> you will use to run consumer processes on?


Indeed! The machines are already there and cannot be removed, but with AMQP
I think that I can let them do more of the work in my system and remove all
the machines that connect the machines where the consumer processes run.


>
> The size of your broker cluster will depend (amongst other factors) on
> the amount of messages you need the system to be able to handle.


A system today consisting of 100 "consumer" machines plus some inner
machines handles in the neighbourhood of 3,000 message per second.
So when I aim to remove the inner machines that does the most of the
intelligence regarding routing of the messages I expect to get rid of the
inner bottleneck and thus get a higher performance... or at least one that
is closer to the limits of the "consumer" machines which I think is a better
constraint.

Sorry if I sound a bit vague at times but I have only just read about AMQP
and are now trying to get the concepts for a new AMQP based architecture in
place.

Cheers,
Torben
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080822/20ca0184/attachment.htm 

From torben.lehoff at googlemail.com  Fri Aug 22 21:17:38 2008
From: torben.lehoff at googlemail.com (Torben Hoffmann)
Date: Fri, 22 Aug 2008 22:17:38 +0200
Subject: [rabbitmq-discuss] RabbitMQ/AMQP understanding
In-Reply-To: <5ad109e90808220839lc73d2d8mbbf4231926f8d44f@mail.gmail.com>
References: <ecfbfea90808220557m2fb4c1b1n56c1cf75990ea6c9@mail.gmail.com>
	<269388e30808220605q3406b1cfjd3bd703434d71a09@mail.gmail.com>
	<5ad109e90808220839lc73d2d8mbbf4231926f8d44f@mail.gmail.com>
Message-ID: <ecfbfea90808221317t61428ed6t58ca42db4ac90622@mail.gmail.com>

On Fri, Aug 22, 2008 at 5:39 PM, Holger Hoffst?tte <holger at wizards.de>wrote:

> On 8/22/08, Ben Hood <0x6e6562 at gmail.com> wrote:
> >  >    2. Is there a way to notify clients like B and C that there is a
> message
> >  > for them in one of their queues? Or do you have to poll the queue to
> find
> >  > out if there is something for you? (Basically this is a question of
> using a
> >  > interrupt like thing vs polling.)
> >
> > If a client subscribes to a queue, the channel will deliver messages
> >  to it as and when they are routed, so there is no need to poll
> >  explicitly. If for some reason you need to poll, there is a method
> >  called basic.get which allows you to poll a queue.
> >
> >  BTW, are you asking this question in the context of the API of a MOM
> >  system that you have used in the past?
>
> I was wondering the same - to me it sounds like he might be looking
> for the equivalent of a JMS MessageListener (with delivery in a thread
> pool etc.) and I don't think that's something the Java client lib can
> do right now.
> Torben, can you clarify what language you are planning to use and
> whether this is what you meant with "polling vs. interrupt"?
>
> Holger
>

My plan is to use Erlang for the consumers since they have to deal with a
very concise protocol so pattern matching and bit strings is just what the
doctor ordered!

The specific behaviour I am looking for is that when a message arrives in a
queue that a consumer is tied to that message will be sent to the consumer
directly (this is what I meant by interrupt-like) instead of having to
program the consumer to look in the queue for a message ever so often to see
if there is something for it (this is what I meant by polling).

The reason I am asking this is two-fold:

   1. Polling with most likely slow down the system if I have a lot of
   consumers looking for a message ever so often. This will be bad since some
   of the message scenarios has the contraint that all members in a group must
   be able to receive data on a separate medium within 500 ms. This constraint
   applies to all sizes of our system - even nationwide systems - so time
   should not be wasted anywhere.
   2. I have just completed a project in Erlang where I was forced to set up
   a polling mechanism to get messages from an embedded server running on a
   communications card we had to use. I hated and still hate that solution
   since the polling is a fix to a problem that fits a more interrupt-like
   behaviour a lot better.

Hope this makes my constraints and desired solution a bit clearer.

Cheers,
Torben
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080822/ad6ad103/attachment.htm 

From holger at wizards.de  Fri Aug 22 21:43:59 2008
From: holger at wizards.de (=?ISO-8859-1?Q?Holger_Hoffst=E4tte?=)
Date: Fri, 22 Aug 2008 22:43:59 +0200
Subject: [rabbitmq-discuss] RabbitMQ/AMQP understanding
In-Reply-To: <ecfbfea90808221317t61428ed6t58ca42db4ac90622@mail.gmail.com>
References: <ecfbfea90808220557m2fb4c1b1n56c1cf75990ea6c9@mail.gmail.com>	
	<269388e30808220605q3406b1cfjd3bd703434d71a09@mail.gmail.com>	
	<5ad109e90808220839lc73d2d8mbbf4231926f8d44f@mail.gmail.com>
	<ecfbfea90808221317t61428ed6t58ca42db4ac90622@mail.gmail.com>
Message-ID: <48AF250F.7020605@wizards.de>

Torben Hoffmann wrote:
> My plan is to use Erlang for the consumers since they have to deal with
> a very concise protocol so pattern matching and bit strings is just what
> the doctor ordered!

Aha! That changes things. Well, not really, but enough to be even more
interesting. :)

> The specific behaviour I am looking for is that when a message arrives
> in a queue that a consumer is tied to that message will be sent to the
> consumer directly (this is what I meant by interrupt-like) instead of
> having to program the consumer to look in the queue for a message ever
> so often to see if there is something for it (this is what I meant by
> polling).

OK so I guessed correctly what you meant. I haven't worked with the
erlang-rabbit client yet but it seems easy enough and logical to set up a
local process (or register a fun) that chews on the queue (or blocks) and
then hands stuff over to the actual worker. This will give you your
"notification".
This is exactly what the example in Ben's blog demonstrates:
http://hopper.squarespace.com/blog/2008/1/12/introducing-the-erlang-amqp-client.html

regards
Holger




From 0x6e6562 at gmail.com  Fri Aug 22 21:49:23 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Fri, 22 Aug 2008 21:49:23 +0100
Subject: [rabbitmq-discuss] RabbitMQ/AMQP understanding
In-Reply-To: <ecfbfea90808221305qcd75621j3a39bf01625c7904@mail.gmail.com>
References: <ecfbfea90808220557m2fb4c1b1n56c1cf75990ea6c9@mail.gmail.com>
	<269388e30808220605q3406b1cfjd3bd703434d71a09@mail.gmail.com>
	<ecfbfea90808220631i7934e7eas33630b92a4fe1411@mail.gmail.com>
	<269388e30808220725o157501ffua477768b194e90d6@mail.gmail.com>
	<ecfbfea90808221305qcd75621j3a39bf01625c7904@mail.gmail.com>
Message-ID: <269388e30808221349g7e6c8c7fq9d40c6d79be882b7@mail.gmail.com>

Torben,

On Fri, Aug 22, 2008 at 9:05 PM, Torben Hoffmann
<torben.lehoff at googlemail.com> wrote:
> Okay, I did not think of this type of solution, but I think this would work
> just as fine. So either I get a lot of queues or a lot of exchanges
> depending on how I choose to represent the groups. I will let that be up to
> a practical test on a couple of machines.

Usually you would go for a queue per client, but this is not a rule,
since queues can be shared. YMMV.

>> Note that you do not necessarily need an AMQP instance on machine that
>> clients run on. Multiple remote clients can connect to a single broker
>> instance.
>
> Yes, but for the sake of performance I think that the more I can distribute
> the work load the better.

Sure, but wouldn't you want the main load to be with the consumers,
i.e. where the real work is being done? The broker is just an
intermdiary that routes messages in an efficient fashion. Under normal
circumstances I would want to be allocating a lot more resources to be
doing the real work rather than distributing it.

Ideally you should be using a small (relative to the workload) number
of Rabbit instances to farm out work to a large number of workers.

This is not to say that you can't have large Rabbit clusters, it's
just that Rabbit, as a communication fabric, shouldn't consume the
lion share of your resources.

> Indeed! The machines are already there and cannot be removed, but with AMQP
> I think that I can let them do more of the work in my system and remove all
> the machines that connect the machines where the consumer processes run.

You might be interested in a feature of the AMQP spec called basic.qos
which allows for better load balancing. We have not implemented it yet
in Rabbit because of two reasons:

1. It is tricky to get right and verify it's correctness;
2. Few people have asked for it yet.

But we do have a plan of how we'd like to implement it.

>> The size of your broker cluster will depend (amongst other factors) on
>> the amount of messages you need the system to be able to handle.
>
> A system today consisting of 100 "consumer" machines plus some inner
> machines handles in the neighbourhood of 3,000 message per second.
> So when I aim to remove the inner machines that does the most of the
> intelligence regarding routing of the messages I expect to get rid of the
> inner bottleneck and thus get a higher performance... or at least one that
> is closer to the limits of the "consumer" machines which I think is a better
> constraint.

You may want to check out the performance metrics of a single broker
with a single producer and a single consumer using the ProducerMain
and ConsumerMain test classes from the RabbitMQ Java library, just to
calibrate your expectations for yourself.

> Sorry if I sound a bit vague at times but I have only just read about AMQP
> and are now trying to get the concepts for a new AMQP based architecture in
> place.

Not a problem. There are various sources of information about the
concepts of AMQP, not least to mention the specification :-)

HTH,

Ben



From 0x6e6562 at gmail.com  Fri Aug 22 22:11:26 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Fri, 22 Aug 2008 22:11:26 +0100
Subject: [rabbitmq-discuss] RabbitMQ/AMQP understanding
In-Reply-To: <269388e30808221410w5b3d11f9q6a87071b9523b0c4@mail.gmail.com>
References: <ecfbfea90808220557m2fb4c1b1n56c1cf75990ea6c9@mail.gmail.com>
	<269388e30808220605q3406b1cfjd3bd703434d71a09@mail.gmail.com>
	<5ad109e90808220839lc73d2d8mbbf4231926f8d44f@mail.gmail.com>
	<ecfbfea90808221317t61428ed6t58ca42db4ac90622@mail.gmail.com>
	<269388e30808221410w5b3d11f9q6a87071b9523b0c4@mail.gmail.com>
Message-ID: <269388e30808221411v3b157fe7rb0a8592e7fd87763@mail.gmail.com>

Torben,

On Fri, Aug 22, 2008 at 9:17 PM, Torben Hoffmann
<torben.lehoff at googlemail.com> wrote:
> My plan is to use Erlang for the consumers since they have to deal with a
> very concise protocol so pattern matching and bit strings is just what the
> doctor ordered!
>
> The specific behaviour I am looking for is that when a message arrives in a
> queue that a consumer is tied to that message will be sent to the consumer
> directly (this is what I meant by interrupt-like) instead of having to
> program the consumer to look in the queue for a message ever so often to see
> if there is something for it (this is what I meant by polling).
>
> The reason I am asking this is two-fold:
>
> Polling with most likely slow down the system if I have a lot of consumers
> looking for a message ever so often. This will be bad since some of the
> message scenarios has the contraint that all members in a group must be able
> to receive data on a separate medium within 500 ms. This constraint applies
> to all sizes of our system - even nationwide systems - so time should not be
> wasted anywhere.
> I have just completed a project in Erlang where I was forced to set up a
> polling mechanism to get messages from an embedded server running on a
> communications card we had to use. I hated and still hate that solution
> since the polling is a fix to a problem that fits a more interrupt-like
> behaviour a lot better.

The Erlang client for AMQP, as any other spec compliant client, is
capable of subscribing to a queue in order to be notified of the
delivery of new messages.

If you do intend to use RabbitMQ as your AMQP broker, you will be able
to benefit from the direct Erlang client.

This has the exact same API as the TCP client, the difference is that
it can co-located in the same Erlang VM, thus saving marshalling and
network overhead.

So application code can use the Erlang client in a location
transparent fashion - either remote via TCP or embedded in the same
address space.

HTH,

Ben



From torben.lehoff at googlemail.com  Fri Aug 22 23:10:35 2008
From: torben.lehoff at googlemail.com (Torben Hoffmann)
Date: Sat, 23 Aug 2008 00:10:35 +0200
Subject: [rabbitmq-discuss] RabbitMQ/AMQP understanding
In-Reply-To: <269388e30808221349g7e6c8c7fq9d40c6d79be882b7@mail.gmail.com>
References: <ecfbfea90808220557m2fb4c1b1n56c1cf75990ea6c9@mail.gmail.com>
	<269388e30808220605q3406b1cfjd3bd703434d71a09@mail.gmail.com>
	<ecfbfea90808220631i7934e7eas33630b92a4fe1411@mail.gmail.com>
	<269388e30808220725o157501ffua477768b194e90d6@mail.gmail.com>
	<ecfbfea90808221305qcd75621j3a39bf01625c7904@mail.gmail.com>
	<269388e30808221349g7e6c8c7fq9d40c6d79be882b7@mail.gmail.com>
Message-ID: <ecfbfea90808221510g35ccebe0ha3adb2128d28e4a5@mail.gmail.com>

On Fri, Aug 22, 2008 at 10:49 PM, Ben Hood <0x6e6562 at gmail.com> wrote:

> Torben,
>
> On Fri, Aug 22, 2008 at 9:05 PM, Torben Hoffmann
> <torben.lehoff at googlemail.com> wrote:
> > Okay, I did not think of this type of solution, but I think this would
> work
> > just as fine. So either I get a lot of queues or a lot of exchanges
> > depending on how I choose to represent the groups. I will let that be up
> to
> > a practical test on a couple of machines.
>
> Usually you would go for a queue per client, but this is not a rule,
> since queues can be shared. YMMV.


I will need queues for the individuals themselves plus for all the groups -
communication can be both 1:1 and 1:many.


>
>
> >> Note that you do not necessarily need an AMQP instance on machine that
> >> clients run on. Multiple remote clients can connect to a single broker
> >> instance.
> >
> > Yes, but for the sake of performance I think that the more I can
> distribute
> > the work load the better.
>
> Sure, but wouldn't you want the main load to be with the consumers,
> i.e. where the real work is being done? The broker is just an
> intermdiary that routes messages in an efficient fashion. Under normal
> circumstances I would want to be allocating a lot more resources to be
> doing the real work rather than distributing it.


I wasn't clear earlier: I want to avoid having a bottleneck in the middle as
today. But I am not sure what the best option is right now, but I will try
some scenarios to see what fits the best.

>
> Ideally you should be using a small (relative to the workload) number
> of Rabbit instances to farm out work to a large number of workers.
>
> This is not to say that you can't have large Rabbit clusters, it's
> just that Rabbit, as a communication fabric, shouldn't consume the
> lion share of your resources.


Having the workers and Rabbit share machines will allow me to make a very
elegant architecture that scales very well since adding a new machine does
not require more than adding it to the cluster. But you are right that there
could be some side effects in play here that I need to iron out before I get
a good solution.


>
>
> > Indeed! The machines are already there and cannot be removed, but with
> AMQP
> > I think that I can let them do more of the work in my system and remove
> all
> > the machines that connect the machines where the consumer processes run.
>
> You might be interested in a feature of the AMQP spec called basic.qos
> which allows for better load balancing. We have not implemented it yet
> in Rabbit because of two reasons:
>
> 1. It is tricky to get right and verify it's correctness;
> 2. Few people have asked for it yet.
>
> But we do have a plan of how we'd like to implement it.


That does sound interesting, but for my application I think that the current
Rabbit implementation will be fast enough since the task is to get a control
plane in place and let an underlying IP network carry the heavy duty traffic
between users.


>
>
> >> The size of your broker cluster will depend (amongst other factors) on
> >> the amount of messages you need the system to be able to handle.
> >
> > A system today consisting of 100 "consumer" machines plus some inner
> > machines handles in the neighbourhood of 3,000 message per second.
> > So when I aim to remove the inner machines that does the most of the
> > intelligence regarding routing of the messages I expect to get rid of the
> > inner bottleneck and thus get a higher performance... or at least one
> that
> > is closer to the limits of the "consumer" machines which I think is a
> better
> > constraint.
>
> You may want to check out the performance metrics of a single broker
> with a single producer and a single consumer using the ProducerMain
> and ConsumerMain test classes from the RabbitMQ Java library, just to
> calibrate your expectations for yourself.
>
> > Sorry if I sound a bit vague at times but I have only just read about
> AMQP
> > and are now trying to get the concepts for a new AMQP based architecture
> in
> > place.
>
> Not a problem. There are various sources of information about the
> concepts of AMQP, not least to mention the specification :-)
>
> I like the standard - way easier to read than others I have had to deal
with in the past...

Cheers,
Torben
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080823/4f1cb1c4/attachment.htm 

From ryan.pratt at gmail.com  Sat Aug 23 00:44:38 2008
From: ryan.pratt at gmail.com (Ryan Pratt)
Date: Fri, 22 Aug 2008 18:44:38 -0500
Subject: [rabbitmq-discuss] queue message count
Message-ID: <f9d1f3560808221644q30e16ad4h2580004e0073de3e@mail.gmail.com>

I am interested in getting total messsage counts for each queue. I want to
be able to write a script that monitors the messages per second on the
system as a whole and per queue. The stat_all() function gives me a current
depth count, but no the total number of messages processed on that queue. Is
there a way to get at this value? If not, could you give me a pointer on
where to start looking for adding it in myself? Thanks!

Ryan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080822/8ec4c633/attachment.htm 

From matthias at lshift.net  Sat Aug 23 09:23:15 2008
From: matthias at lshift.net (Matthias Radestock)
Date: Sat, 23 Aug 2008 09:23:15 +0100
Subject: [rabbitmq-discuss] anyone using Twisted?
In-Reply-To: <48AD9B26.1080506@wizards.de>
References: <167204d20808210832j6a98e8c1vc45131692c6ef4c0@mail.gmail.com>
	<48AD9B26.1080506@wizards.de>
Message-ID: <48AFC8F3.1030304@lshift.net>

Holger,

Holger Hoffst?tte wrote:
> As an aside, does anybody know whether the AMQP spec mandates the m:1
> channel:connection relationship, or is that just what's implemented right
> now in Rabbit?

The spec allows for multiple channels per connection, and multiple 
connections per client.

> IMHO clients in general could also benefit greatly from
> bonding multiple connections together; the Java client might be able to
> use NIO for that. This could cut down connection contention with many
> channels and allow for better network utilization, though it would need to
> be handled by the broker as well. Just curious.

Are you referring to ethernet bonding? Please elaborate.


Matthias.



From petedao at gmail.com  Sat Aug 23 12:31:30 2008
From: petedao at gmail.com (Pete Kay)
Date: Sat, 23 Aug 2008 19:31:30 +0800
Subject: [rabbitmq-discuss] Using RabbitMQ as Messaging Exchange
In-Reply-To: <7aa8bd9d0808230431p21724614l41f213ca5fa90920@mail.gmail.com>
References: <7aa8bd9d0808230431p21724614l41f213ca5fa90920@mail.gmail.com>
Message-ID: <7aa8bd9d0808230431x68209bbfi7b928381ebc7b45d@mail.gmail.com>

Hi,

I have a requirement and I would like to find out if RabbitMQ is the right
tool that I should use.

I have a series of load-balanced clustered servers and they all publish
events in the form of text messages.  I am looking for using RabbitMQ to
listen on event messages from all the clustered servers and then publish it
out to subscribed clients.

Is this something that RabbitMQ good at doing?

I am new to RabbitMQ.  Any suggestion will be greatly appreciated.

Best Regards,
Pete
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080823/6ff60062/attachment.htm 

From 0x6e6562 at gmail.com  Sat Aug 23 16:44:09 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Sat, 23 Aug 2008 16:44:09 +0100
Subject: [rabbitmq-discuss] Using RabbitMQ as Messaging Exchange
In-Reply-To: <7aa8bd9d0808230431x68209bbfi7b928381ebc7b45d@mail.gmail.com>
References: <7aa8bd9d0808230431p21724614l41f213ca5fa90920@mail.gmail.com>
	<7aa8bd9d0808230431x68209bbfi7b928381ebc7b45d@mail.gmail.com>
Message-ID: <269388e30808230844y630db5edg26c0d1daed5890fc@mail.gmail.com>

Pete,

On Sat, Aug 23, 2008 at 12:31 PM, Pete Kay <petedao at gmail.com> wrote:
> I have a series of load-balanced clustered servers and they all publish
> events in the form of text messages.  I am looking for using RabbitMQ to
> listen on event messages from all the clustered servers and then publish it
> out to subscribed clients.

Rabbit is a message broker, which means that one client publishes
messages to an exchange in Rabbit and another client consumes this
message from a queue that they are subscribed to. The way in which the
message goes into a particular queue is configured using routing
rules. So if I understand you correctly, you could use Rabbit to solve
your use case. Let me know if you need more detail.

HTH,

Ben



From alexis.richardson at cohesiveft.com  Sat Aug 23 17:05:40 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Sat, 23 Aug 2008 17:05:40 +0100
Subject: [rabbitmq-discuss] Using RabbitMQ as Messaging Exchange
In-Reply-To: <7aa8bd9d0808230431x68209bbfi7b928381ebc7b45d@mail.gmail.com>
References: <7aa8bd9d0808230431p21724614l41f213ca5fa90920@mail.gmail.com>
	<7aa8bd9d0808230431x68209bbfi7b928381ebc7b45d@mail.gmail.com>
Message-ID: <167204d20808230905r45f9140dk9805c6641175751e@mail.gmail.com>

Pete

On Sat, Aug 23, 2008 at 12:31 PM, Pete Kay <petedao at gmail.com> wrote:
>
> I have a series of load-balanced clustered servers and they all publish
> events in the form of text messages.  I am looking for using RabbitMQ to
> listen on event messages from all the clustered servers and then publish it
> out to subscribed clients.
>
> Is this something that RabbitMQ good at doing?

Absolutely - yes.

RabbitMQ has a model based on queues, which buffer (and optionally
persist) messages on behalf of subscribers.  So when you publish a
message to a RabbitMQ broker, it will be placed on one or more queues
based on really simple filtering rules:

- In the simplest case you can copy a message to *every* queue in the
broker.  This is called 'fan out'.
- Or, you can give each message a 'routing key', and then the broker
will use this key to determine which queues to place the message on
- You can also enable richer routing patterns

We're here to help so please can you tell us a bit more about what
kind of 'subscribed clients' you plan to use.  Also - what language
are you writing your code in?  There are plenty of clients but it
would be good to know which one you wish to use.



> I am new to RabbitMQ.  Any suggestion will be greatly appreciated.

There is some documentation here: http://www.rabbitmq.com/documentation.html

Here is an introduction that may help:
http://www.slideshare.net/somic/introduction-to-amqp-messaging-with-rabbitmq/

alexis


>
> Best Regards,
> Pete
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From matthias at lshift.net  Sat Aug 23 18:44:04 2008
From: matthias at lshift.net (Matthias Radestock)
Date: Sat, 23 Aug 2008 18:44:04 +0100
Subject: [rabbitmq-discuss] queue message count
In-Reply-To: <f9d1f3560808221644q30e16ad4h2580004e0073de3e@mail.gmail.com>
References: <f9d1f3560808221644q30e16ad4h2580004e0073de3e@mail.gmail.com>
Message-ID: <48B04C64.5060008@lshift.net>

Ryan,

Ryan Pratt wrote:
> I am interested in getting total messsage counts for each queue. I want 
> to be able to write a script that monitors the messages per second on 
> the system as a whole and per queue. The stat_all() function gives me a 
> current depth count, but no the total number of messages processed on 
> that queue. Is there a way to get at this value?

There currently isn't.

>If not, could you give 
> me a pointer on where to start looking for adding it in myself? Thanks!

It should be fairly easy to maintain a counter of the total number of 
messages handled by a queue. The code for that would have to go into 
rabbit_amqqueue_process.

You'll need to decide on whether you want to count messages on ingress, 
egress or both - the two are different because messages may get redelivered.

You'll also need to decide what the API should look like. You could 
either extend the rabbit_amqqueue:stat/1 function to return the 
additional information, or introduce a new function.

You may also want to think about what other statistics we may want 
queues to gather. That will help in getting the API right. I reckon 
erlang:process_info/{1,2}, mnesia:system_info/1, and mnesia:table_info/2 
are good examples here w.r.t. overall structure.


Regards,

Matthias



From petedao at gmail.com  Sun Aug 24 15:35:30 2008
From: petedao at gmail.com (Pete Kay)
Date: Sun, 24 Aug 2008 22:35:30 +0800
Subject: [rabbitmq-discuss] Using RabbitMQ as Messaging Exchange
In-Reply-To: <167204d20808230905r45f9140dk9805c6641175751e@mail.gmail.com>
References: <7aa8bd9d0808230431p21724614l41f213ca5fa90920@mail.gmail.com>
	<7aa8bd9d0808230431x68209bbfi7b928381ebc7b45d@mail.gmail.com>
	<167204d20808230905r45f9140dk9805c6641175751e@mail.gmail.com>
Message-ID: <7aa8bd9d0808240735s3f7ddadfhb9db45e922bd0db9@mail.gmail.com>

Hi Ben and Alexis,

Thank you very much for your helpful reply.

What I am planning to do is to have C clients publishing some events ( as
text message ) to RabbitMQ and on the other side, I would have Jave clients
that need to listen on the messages.

The tricky part is that I need something in between Java clients and
RabbitMQ to do the brokering based on an ID.  For example, the C clients
will associate each event with an ID.  Each Java client may listen to events
of one or more IDs.  I am not sure if I can program that brokering rule
within RabbitMQ or I need a singleton client to listen on all messages
coming out of RabbitMQ and then do the brokering to the end-clients.

Any suggestion will be greatly appreciated.

Thanks alot for all your help.

Best Regards,
Pete



On Sun, Aug 24, 2008 at 12:05 AM, Alexis Richardson <
alexis.richardson at cohesiveft.com> wrote:

> Pete
>
> On Sat, Aug 23, 2008 at 12:31 PM, Pete Kay <petedao at gmail.com> wrote:
> >
> > I have a series of load-balanced clustered servers and they all publish
> > events in the form of text messages.  I am looking for using RabbitMQ to
> > listen on event messages from all the clustered servers and then publish
> it
> > out to subscribed clients.
> >
> > Is this something that RabbitMQ good at doing?
>
> Absolutely - yes.
>
> RabbitMQ has a model based on queues, which buffer (and optionally
> persist) messages on behalf of subscribers.  So when you publish a
> message to a RabbitMQ broker, it will be placed on one or more queues
> based on really simple filtering rules:
>
> - In the simplest case you can copy a message to *every* queue in the
> broker.  This is called 'fan out'.
> - Or, you can give each message a 'routing key', and then the broker
> will use this key to determine which queues to place the message on
> - You can also enable richer routing patterns
>
> We're here to help so please can you tell us a bit more about what
> kind of 'subscribed clients' you plan to use.  Also - what language
> are you writing your code in?  There are plenty of clients but it
> would be good to know which one you wish to use.
>
>
>
> > I am new to RabbitMQ.  Any suggestion will be greatly appreciated.
>
> There is some documentation here:
> http://www.rabbitmq.com/documentation.html
>
> Here is an introduction that may help:
>
> http://www.slideshare.net/somic/introduction-to-amqp-messaging-with-rabbitmq/
>
> alexis
>
>
> >
> > Best Regards,
> > Pete
> >
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080824/ea8f7038/attachment.htm 

From petedao at gmail.com  Sun Aug 24 16:23:12 2008
From: petedao at gmail.com (Pete Kay)
Date: Sun, 24 Aug 2008 23:23:12 +0800
Subject: [rabbitmq-discuss] Need help installing Rabbit-Server
Message-ID: <7aa8bd9d0808240823l79442fbdyed4deaba92ae1f67@mail.gmail.com>

Hi,

I am trying to get Rabbit installed on Debian without success using both the
tarball and .deb.    I think the problem may have to do with lack of certain
library in my Debian box.  Here is what I get:

With the tarball:
debian:/usr/src/rabbitmq/rabbitmq-server-1.4.0# ls
BUILD    codegen.py  include  LICENSE               Makefile  src
codegen  ebin        INSTALL  LICENSE-MPL-RabbitMQ  scripts
debian:/usr/src/rabbitmq/rabbitmq-server-1.4.0# make
python codegen.py header codegen/amqp-0.8.json > include/rabbit_framing.hrl
python codegen.py body   codegen/amqp-0.8.json > src/rabbit_framing.erl
erlc -I include -o ebin -Wall -v +debug_info  src/rabbit_framing.erl
erlc -I include -o ebin -Wall -v +debug_info  src/buffering_proxy.erl
erlc -I include -o ebin -Wall -v +debug_info  src/rabbit_access_control.erl
src/rabbit_access_control.erl:27: can't find include lib
"stdlib/include/qlc.hrl "
make: *** [ebin/rabbit_access_control.beam] Error 1


With apt-get:

debian:/usr/src/rabbitmq/rabbitmq-server-1.4.0# apt-get install erlang-base
Reading package lists... Done
Building dependency tree... Done
erlang-base is already the newest version.
0 upgraded, 0 newly installed, 0 to remove and 7 not upgraded.
1 not fully installed or removed.
Need to get 0B of archives.
After unpacking 0B of additional disk space will be used.
Setting up rabbitmq-server (1.4.0-1) ...
Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/startup.log, .err
invoke-rc.d: initscript rabbitmq-server, action "start" failed.
dpkg: error processing rabbitmq-server (--configure):
 subprocess post-installation script returned error exit status 1
Errors were encountered while processing:
 rabbitmq-server
E: Sub-process /usr/bin/dpkg returned an error code (1)
debian:/usr/src/rabbitmq/rabbitmq-server-1.4.0#



Any idea?

Thanks,
Pete
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080824/9759a62e/attachment.htm 

From matthias at lshift.net  Sun Aug 24 16:34:04 2008
From: matthias at lshift.net (Matthias Radestock)
Date: Sun, 24 Aug 2008 16:34:04 +0100
Subject: [rabbitmq-discuss] Need help installing Rabbit-Server
In-Reply-To: <7aa8bd9d0808240823l79442fbdyed4deaba92ae1f67@mail.gmail.com>
References: <7aa8bd9d0808240823l79442fbdyed4deaba92ae1f67@mail.gmail.com>
Message-ID: <48B17F6C.20703@lshift.net>

Pete,

Pete Kay wrote:
> I am trying to get Rabbit installed on Debian without success using both 
> the tarball and .deb.    I think the problem may have to do with lack of 
> certain library in my Debian box.  Here is what I get:
> 
> With the tarball:
> debian:/usr/src/rabbitmq/rabbitmq-server-1.4.0# ls
> BUILD    codegen.py  include  LICENSE               Makefile  src
> codegen  ebin        INSTALL  LICENSE-MPL-RabbitMQ  scripts
> debian:/usr/src/rabbitmq/rabbitmq-server-1.4.0# make
> python codegen.py header codegen/amqp-0.8.json > include/rabbit_framing.hrl
> python codegen.py body   codegen/amqp-0.8.json > src/rabbit_framing.erl
> erlc -I include -o ebin -Wall -v +debug_info  src/rabbit_framing.erl
> erlc -I include -o ebin -Wall -v +debug_info  src/buffering_proxy.erl
> erlc -I include -o ebin -Wall -v +debug_info  src/rabbit_access_control.erl
> src/rabbit_access_control.erl:27: can't find include lib 
> "stdlib/include/qlc.hrl "
> make: *** [ebin/rabbit_access_control.beam] Error 1

In order to *build* rabbitmq, rather than just running it, your system 
needs to satisfy the following dependencies (taken from the debian 
control file):

cdbs, debhelper (>= 5), erlang-base | erlang-base-hipe, erlang-nox, 
erlang-dev, erlang-src, make, python

> With apt-get:
> 
> debian:/usr/src/rabbitmq/rabbitmq-server-1.4.0# apt-get install erlang-base

(I am assuming this was meant to read "install rabbitmq-server")

> Reading package lists... Done
> Building dependency tree... Done
> erlang-base is already the newest version.
> 0 upgraded, 0 newly installed, 0 to remove and 7 not upgraded.
> 1 not fully installed or removed.
> Need to get 0B of archives.
> After unpacking 0B of additional disk space will be used.
> Setting up rabbitmq-server (1.4.0-1) ...
> Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/startup.log, .err
> invoke-rc.d: initscript rabbitmq-server, action "start" failed.
> dpkg: error processing rabbitmq-server (--configure):
>  subprocess post-installation script returned error exit status 1
> Errors were encountered while processing:
>  rabbitmq-server
> E: Sub-process /usr/bin/dpkg returned an error code (1)
> debian:/usr/src/rabbitmq/rabbitmq-server-1.4.0#

That's strange. Is there anything in the log files under /var/log/rabbitmq?


Matthias.



From 0x6e6562 at gmail.com  Sun Aug 24 17:42:10 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Sun, 24 Aug 2008 17:42:10 +0100
Subject: [rabbitmq-discuss] Using RabbitMQ as Messaging Exchange
In-Reply-To: <7aa8bd9d0808240735s3f7ddadfhb9db45e922bd0db9@mail.gmail.com>
References: <7aa8bd9d0808230431p21724614l41f213ca5fa90920@mail.gmail.com>
	<7aa8bd9d0808230431x68209bbfi7b928381ebc7b45d@mail.gmail.com>
	<167204d20808230905r45f9140dk9805c6641175751e@mail.gmail.com>
	<7aa8bd9d0808240735s3f7ddadfhb9db45e922bd0db9@mail.gmail.com>
Message-ID: <269388e30808240942n7d7879b3i4ddaed605771e86c@mail.gmail.com>

Pete,

On Sun, Aug 24, 2008 at 3:35 PM, Pete Kay <petedao at gmail.com> wrote:
> What I am planning to do is to have C clients publishing some events ( as
> text message ) to RabbitMQ and on the other side, I would have Jave clients
> that need to listen on the messages.
>
> The tricky part is that I need something in between Java clients and
> RabbitMQ to do the brokering based on an ID.  For example, the C clients
> will associate each event with an ID.  Each Java client may listen to events
> of one or more IDs.  I am not sure if I can program that brokering rule
> within RabbitMQ or I need a singleton client to listen on all messages
> coming out of RabbitMQ and then do the brokering to the end-clients.

This could be handled quite simply with plain jane AMQP, for example
using a direct exchange.

Without wanting to be boring, the spec explains how you would do this
quite well:

The direct exchange type works as follows:

 1. A message queue binds to the exchange using a routing key, K.
 2. A publisher sends the exchange a message with the routing key R.
 3. The message is passed to the message queue if K = R

So you don't need to do this yourself, because this is the type of
thing that the broker will do for you.

BTW, we don't have a C client ATM that you can use out of the box :-(

This is, amongst many other things, on our todo list, but being an
open source outfit, we don't have unlimited resources.

So for anybody interested in a C client, I can only re-iterate how
easy (and rewarding, because you would get a Rabbit T-Shirt) it would
be to write an AMQP client in C  -  see this guide about how to do it
: http://hopper.squarespace.com/blog/2008/6/21/build-your-own-amqp-client.html

We do of course, have a Java client that we maintain.

HTH,

Ben



From holger at wizards.de  Sun Aug 24 18:29:32 2008
From: holger at wizards.de (=?ISO-8859-1?Q?Holger_Hoffst=E4tte?=)
Date: Sun, 24 Aug 2008 19:29:32 +0200
Subject: [rabbitmq-discuss] anyone using Twisted?
In-Reply-To: <48AFC8F3.1030304@lshift.net>
References: <167204d20808210832j6a98e8c1vc45131692c6ef4c0@mail.gmail.com>
	<48AD9B26.1080506@wizards.de> <48AFC8F3.1030304@lshift.net>
Message-ID: <48B19A7C.5000603@wizards.de>

Matthias Radestock wrote:
> Holger Hoffst?tte wrote:
>> As an aside, does anybody know whether the AMQP spec mandates the m:1
>> channel:connection relationship, or is that just what's implemented right
>> now in Rabbit?
> 
> The spec allows for multiple channels per connection, and multiple
> connections per client.

I'm afraid your answer is completely correct and yet not what I wanted to
know. ;-)
I'll admit the question was ambiguous.

>> IMHO clients in general could also benefit greatly from
>> bonding multiple connections together; the Java client might be able to
>> use NIO for that. This could cut down connection contention with many
>> channels and allow for better network utilization, though it would
>> need to
>> be handled by the broker as well. Just curious.
> 
> Are you referring to ethernet bonding? Please elaborate.

More like "socket bonding" if that makes sense - the question (and
half-baked idea) was whether a logical connection could be implemented in
terms of multiple sockets (when using TCP), without the client app doing
this manually/explicitly. Allowing multiple sockets could prevent channel
starvation and therefore also better QoS schemes, but on second thought it
is not clear whether just delegating to the OS is such a good idea after all.

A typical scenario would be a couple of channels that send/receive mostly
small messages at varying rates but with low latency requirement, yet the
one oddball sends huge messages but doesn't care about the transfer speed.
Without some kind of fairness on the framing level (e.g. by dividing up
the one shared socket among all channels with some kind of quota, channel
priority or deadline), the one big sender could starve the other small
messages.

I'm not sure if this is important at this point, or even whether doing
this kind of QoS on the frame level (ala a packet scheduler) or on a
per-socket level would be better. I dind't find any useful QoS information
in the spec except for the note on the Channel class and the per-message
credit-based "flow control" concept, but to me that seems of little use
for starvation control on the transport level. From what I can tell that
(and session ordering) is what the frame "Tracks" in 0.10 are about, I
didn't see that in 0.8/0.9.

Enough elaborated, I guess. :)

regards
Holger



From matthias at lshift.net  Sun Aug 24 19:29:22 2008
From: matthias at lshift.net (Matthias Radestock)
Date: Sun, 24 Aug 2008 19:29:22 +0100
Subject: [rabbitmq-discuss] anyone using Twisted?
In-Reply-To: <48B19A7C.5000603@wizards.de>
References: <167204d20808210832j6a98e8c1vc45131692c6ef4c0@mail.gmail.com>	<48AD9B26.1080506@wizards.de>
	<48AFC8F3.1030304@lshift.net> <48B19A7C.5000603@wizards.de>
Message-ID: <48B1A882.9060209@lshift.net>

Holger,

Holger Hoffst?tte wrote:
> Matthias Radestock wrote:
>> Are you referring to ethernet bonding? Please elaborate.
> 
> More like "socket bonding" if that makes sense - the question (and
> half-baked idea) was whether a logical connection could be implemented in
> terms of multiple sockets (when using TCP), without the client app doing
> this manually/explicitly. Allowing multiple sockets could prevent channel
> starvation and therefore also better QoS schemes, but on second thought it
> is not clear whether just delegating to the OS is such a good idea after all.

What's wrong with having multiple logical (and thus TCP) connections? 
Does your application depend on having a single logical connection? I'd 
find that surprising given that the connection doesn't feature as a 
logical entity in most AMQP operations; most things happen at the 
granularity of channels.

> A typical scenario would be a couple of channels that send/receive mostly
> small messages at varying rates but with low latency requirement, yet the
> one oddball sends huge messages but doesn't care about the transfer speed.
> Without some kind of fairness on the framing level (e.g. by dividing up
> the one shared socket among all channels with some kind of quota, channel
> priority or deadline), the one big sender could starve the other small
> messages.

The broker does a reasonably good job of treating channels fairly. Large 
messages will be split across multiple frames, allowing smaller messages 
from other channels to be interleaved.

As you say, sending the messages across different TCP connections just 
delegates the problem to the OS. That's probably a good thing, but 
whether it actually gives you any better fairness only testing will reveal.


Matthias.



From holger at wizards.de  Sun Aug 24 20:19:38 2008
From: holger at wizards.de (=?ISO-8859-1?Q?Holger_Hoffst=E4tte?=)
Date: Sun, 24 Aug 2008 21:19:38 +0200
Subject: [rabbitmq-discuss] anyone using Twisted?
In-Reply-To: <48B1A882.9060209@lshift.net>
References: <167204d20808210832j6a98e8c1vc45131692c6ef4c0@mail.gmail.com>	<48AD9B26.1080506@wizards.de>
	<48AFC8F3.1030304@lshift.net> <48B19A7C.5000603@wizards.de>
	<48B1A882.9060209@lshift.net>
Message-ID: <48B1B44A.7090802@wizards.de>

Matthias Radestock wrote:
> What's wrong with having multiple logical (and thus TCP) connections?

Nothing, except that each app would have to write this over and over
again, so I was wondering if something like a MultiSocketConnectionFactory
could return a connection that uses multiple sockets under the hood (I'm
looking at this purely with an eye on the Java client since that is what I
use for experiments). Then channels could be "bound" to one of the
internal sockets depending on their "priority class" or whatever we call it.

However after spending some time with the 0.10 spec this afternoon I think
all this will be better solved on the framing level.

> Does your application depend on having a single logical connection? I'd

No, I was just thinking out loud.

> The broker does a reasonably good job of treating channels fairly. Large
> messages will be split across multiple frames, allowing smaller messages
> from other channels to be interleaved.

Yes, that dawned on me just as your mail arrived..probably because each
channel has its own process and gets a fair share for writing. That solves
the problem for the broker, which is good..but leaves the client libs,
which is complicated but probably also not very important for now.

thanks!
Holger




From petedao at gmail.com  Mon Aug 25 01:21:02 2008
From: petedao at gmail.com (Pete Kay)
Date: Mon, 25 Aug 2008 08:21:02 +0800
Subject: [rabbitmq-discuss]  Need help installing Rabbit-Server
In-Reply-To: <7aa8bd9d0808241720q528a0897i7d8269b0a42f4586@mail.gmail.com>
References: <7aa8bd9d0808240823l79442fbdyed4deaba92ae1f67@mail.gmail.com>
	<48B17F6C.20703@lshift.net>
	<7aa8bd9d0808241720q528a0897i7d8269b0a42f4586@mail.gmail.com>
Message-ID: <7aa8bd9d0808241721u6487897ap1652e44bb4416a6b@mail.gmail.com>

Hi Matthias:

In my startup.log, I am getting:

debian:/var/log/rabbitmq# cat startup.log
Starting all nodes...
Starting node rabbit at debian...
{error_logger,{{2008,8,25},{7,9,14}},"Protocol: ~p: register error:
~p~n",["inet_tcp",{{badmatch,{error,duplicate_name}},[{inet_tcp_dist,listen,1},{net_kernel,start_protos,4},{net_kernel,start_protos,3},{net_kernel,init_node,2},{net_kernel,init,1},{gen_server,init_it,6},{proc_lib,init_p,5}]}]}
{error_logger,{{2008,8,25},{7,9,14}},crash_report,[[{pid,<0.21.0>},{registered_name,net_kernel},{error_info,{error,badarg}},{initial_call,{gen,init_it,[gen_server,<0.18.0>,<0.18.0>,{local,net_kernel},net_kernel,{rabbit,shortnames,15000},[]]}},{ancestors,[net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[#Port<0.9>,<0.18.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,610},{stack_size,21},{reductions,412}],[]]}
{error_logger,{{2008,8,25},{7,9,14}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfa,{net_kernel,start_link,[[rabbit,shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
{error_logger,{{2008,8,25},{7,9,14}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfa,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
{error_logger,{{2008,8,25},{7,9,14}},crash_report,[[{pid,<0.8.0>},{registered_name,[]},{error_info,{shutdown,{kernel,start,[normal,[]]}}},{initial_call,{application_master,init,[<0.6.0>,<0.7.0>,{appl_data,kernel,[application_controller,erl_reply,auth,boot_server,code_server,disk_log_server,disk_log_sup,erl_prim_loader,error_logger,file_server_2,fixtable_server,global_group,global_name_server,heart,init,kernel_config,kernel_sup,net_kernel,net_sup,rex,user,os_server,ddll_server,erl_epmd,inet_db,pg2],undefined,{kernel,[]},[application,application_controller,application_master,application_starter,auth,code,code_aux,packages,code_server,dist_util,erl_boot_server,erl_distribution,erl_prim_loader,erl_reply,erlang,error_handler,error_logger,file,file_server,file_io_server,prim_file,global,global_group,global_search,group,heart,hipe_unified_loader,inet6_tcp,inet6_tcp_dist,inet6_udp,inet_config,inet_hosts,inet_gethost_native,inet_tcp_dist,init,kernel,kernel_config,net,net_adm,net_kernel,os,ram_file,rpc,user,user_drv,user_sup,disk_log,disk_log_1,disk_log_server,disk_log_sup,dist_ac,erl_ddll,erl_epmd,erts_debug,gen_tcp,gen_udp,prim_inet,inet,inet_db,inet_dns,inet_parse,inet_res,inet_tcp,inet_udp,pg2,seq_trace,wrap_log_reader,zlib,otp_ring0],[],infinity,infinity},normal]}},{ancestors,[<0.7.0>]},{messages,[{'EXIT',<0.9.0>,normal}]},{links,[<0.7.0>,<0.6.0>]},{dictionary,[]},{trap_exit,true},{status,running},{heap_size,610},{stack_size,21},{reductions,2079}],[]]}
{error_logger,{{2008,8,25},{7,9,14}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
{"Kernel pid
terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}

rabbit_multi action start_all failed:
{node_start_failed,normal}


Any idea?

Thanks,
Pete

On Sun, Aug 24, 2008 at 11:34 PM, Matthias Radestock <matthias at lshift.net>wrote:

> That's strange. Is there anything in the log files under /var/log/rabbitmq?
>
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080825/137c2423/attachment.htm 

From petedao at gmail.com  Mon Aug 25 01:40:36 2008
From: petedao at gmail.com (Pete Kay)
Date: Mon, 25 Aug 2008 08:40:36 +0800
Subject: [rabbitmq-discuss] Rabbit Crash on Startup
In-Reply-To: <7aa8bd9d0808241734j1752ffa7x4d73f732c2c53494@mail.gmail.com>
References: <7aa8bd9d0808241734j1752ffa7x4d73f732c2c53494@mail.gmail.com>
Message-ID: <7aa8bd9d0808241740g63425b4mb6a981fafb6a79e2@mail.gmail.com>

Hi,

I am very sorry to email multiple times to this list for my problem.  I am
just starting out to learn to use RabbitMQ.  Hopefully, things will get
better when I get more experience with this excellent tools.

I was not able to use Debian install, but I managed to install the tarball,
so that is what I am using.  When I attempted to start the server with  the
rabbitmq-server, I am getting the following error:

debian:/usr/src/rabbitmq/rabbitmq-server-1.4.0/scripts# ./rabbitmq-server
RabbitMQ 1.4.0 (AMQP 8-0)
Copyright (C) 2007-2008 LShift Ltd., Cohesive Financial Technologies LLC.,
and Rabbit Technologies Ltd.
Licensed under the MPL.  See http://www.rabbitmq.com/

Logging to "/var/log/rabbitmq/rabbit.log"
SASL logging to "/var/log/rabbitmq/rabbit-sasl.log"

starting database             ...done
starting core processes       ...done
starting recovery             ...done
starting persister            ...done
starting builtin applications ...done
starting TCP listeners        ...{"init terminating in
do_boot",{{nocatch,{error,{cannot_start_application,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{{badmatch,{error,{shutdown,{child,undefined,'rabbit_tcp_listener_sup_0.0.0.0:5672',{tcp_listener_sup,start_link,[{0,0,0,0},5672,[binary,{packet,raw},{reuseaddr,true},{exit_on_close,false}],{rabbit_networking,tcp_listener_started,[]},{rabbit_networking,tcp_listener_stopped,[]},{rabbit_networking,start_client,[]}]},transient,infinity,supervisor,[tcp_listener_sup]}}}},[{rabbit_networking,start_tcp_listener,2},{rabbit,'-start/2-fun-6-',1},{lists,foreach,2},{rabbit,'-start/2-fun-0-',1},{lists,foreach,2},{rabbit,start,2},{application_master,start_it_old,4}]}}}}}}},[{init,start_it,1},{init,start_em,1}]}}

Crash dump was written to: erl_crash.dump
init terminating in do_boot ()
debian:/usr/src/rabbitmq/rabbitmq-server-1.4.0/scripts#


Any help will be greatly appreciated.

Best Regards,
Pete
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080825/6b38b2dc/attachment.htm 

From rabbitmq-discuss_efine at usa.net  Mon Aug 25 02:04:42 2008
From: rabbitmq-discuss_efine at usa.net (Edwin Fine)
Date: Sun, 24 Aug 2008 21:04:42 -0400
Subject: [rabbitmq-discuss] Rabbit Crash on Startup
In-Reply-To: <7aa8bd9d0808241740g63425b4mb6a981fafb6a79e2@mail.gmail.com>
References: <7aa8bd9d0808241734j1752ffa7x4d73f732c2c53494@mail.gmail.com>
	<7aa8bd9d0808241740g63425b4mb6a981fafb6a79e2@mail.gmail.com>
Message-ID: <6c2563b20808241804v8f05fd9kdf5aa196d98dcc45@mail.gmail.com>

Pete,

This is the procedure I use to install RabbitMQ on Ubuntu, which is Debian
based. You don't necessarily have to do it all, but if you do, I am sure it
will work.

   1. Ensure Erlang is installed. I recommend the latest R12 release.
   2. Download rabbitmq-server-1.4.0.tar.gz from the www.rabbitmq.com site.
   The current link is
   http://www.rabbitmq.com/releases/binary/rabbitmq-server-1.4.0.tar.gz, but
   this may change in future. Then type in the following command lines.
   $ sudo bash; cd /usr/local/lib/erlang/lib
   $ tar xfz $SOME_DIR/rabbitmq-server-1.4.0.tar.gz
   $ groupadd rabbitmq
   $ useradd -c 'RabbitMQ Control Account' -m -d /home/rabbitmq -G
   erts,rabbitmq -s /bin/bash rabbitmq
   $ passwd rabbitmq # Add some suitable password
   $ chown -R rabbitmq:rabbitmq
   /usr/local/lib/erlang/lib/rabbitmq_server-1.4.0
   $ cd /usr/local/sbin
   $ ln -s /usr/local/lib/erlang/lib/rabbitmq_server-1.4.0/sbin/rabbitmqctl
   .
   $ ln -s
   /usr/local/lib/erlang/lib/rabbitmq_server-1.4.0/sbin/rabbitmq-multi .
   $ ln -s
   /usr/local/lib/erlang/lib/rabbitmq_server-1.4.0/sbin/rabbitmq-server .
   $ mkdir -p /var/log/rabbitmq; chown -R rabbitmq:rabbitmq
   /var/log/rabbitmq
   $ mkdir -p /var/lib/rabbitmq/mnesia; chown -R rabbitmq:rabbitmq
   /var/lib/rabbitmq
   3. Ensure that port 5672 is in /etc/services for both tcp and udp. It may
   already be there, named amqp (RabbitMQ is an AMQP implementer). If not, add
   it to /etc/services:
   4. amqp            5672/tcp   # AMQP
   amqp            5672/udp   # AMQP
   5. Start RabbitMQ

Hope this helps.

Regards,
Edwin Fine

On Sun, Aug 24, 2008 at 8:40 PM, Pete Kay <petedao at gmail.com> wrote:

>
>
> Hi,
>
> I am very sorry to email multiple times to this list for my problem.  I am
> just starting out to learn to use RabbitMQ.  Hopefully, things will get
> better when I get more experience with this excellent tools.
>
> I was not able to use Debian install, but I managed to install the tarball,
> so that is what I am using.  When I attempted to start the server with  the
> rabbitmq-server, I am getting the following error:
>
> debian:/usr/src/rabbitmq/rabbitmq-server-1.4.0/scripts# ./rabbitmq-server
> RabbitMQ 1.4.0 (AMQP 8-0)
> Copyright (C) 2007-2008 LShift Ltd., Cohesive Financial Technologies LLC.,
> and Rabbit Technologies Ltd.
> Licensed under the MPL.  See http://www.rabbitmq.com/
>
> Logging to "/var/log/rabbitmq/rabbit.log"
> SASL logging to "/var/log/rabbitmq/rabbit-sasl.log"
>
> starting database             ...done
> starting core processes       ...done
> starting recovery             ...done
> starting persister            ...done
> starting builtin applications ...done
> starting TCP listeners        ...{"init terminating in
> do_boot",{{nocatch,{error,{cannot_start_application,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{{badmatch,{error,{shutdown,{child,undefined,'rabbit_tcp_listener_sup_0.0.0.0:5672',{tcp_listener_sup,start_link,[{0,0,0,0},5672,[binary,{packet,raw},{reuseaddr,true},{exit_on_close,false}],{rabbit_networking,tcp_listener_started,[]},{rabbit_networking,tcp_listener_stopped,[]},{rabbit_networking,start_client,[]}]},transient,infinity,supervisor,[tcp_listener_sup]}}}},[{rabbit_networking,start_tcp_listener,2},{rabbit,'-start/2-fun-6-',1},{lists,foreach,2},{rabbit,'-start/2-fun-0-',1},{lists,foreach,2},{rabbit,start,2},{application_master,start_it_old,4}]}}}}}}},[{init,start_it,1},{init,start_em,1}]}}
>
> Crash dump was written to: erl_crash.dump
> init terminating in do_boot ()
> debian:/usr/src/rabbitmq/rabbitmq-server-1.4.0/scripts#
>
>
> Any help will be greatly appreciated.
>
> Best Regards,
> Pete
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
For every expert there is an equal and opposite expert - Arthur C. Clarke
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080824/80f9bf4f/attachment.htm 

From rabbitmq-discuss_efine at usa.net  Mon Aug 25 02:06:21 2008
From: rabbitmq-discuss_efine at usa.net (Edwin Fine)
Date: Sun, 24 Aug 2008 21:06:21 -0400
Subject: [rabbitmq-discuss] Rabbit Crash on Startup
In-Reply-To: <6c2563b20808241804v8f05fd9kdf5aa196d98dcc45@mail.gmail.com>
References: <7aa8bd9d0808241734j1752ffa7x4d73f732c2c53494@mail.gmail.com>
	<7aa8bd9d0808241740g63425b4mb6a981fafb6a79e2@mail.gmail.com>
	<6c2563b20808241804v8f05fd9kdf5aa196d98dcc45@mail.gmail.com>
Message-ID: <6c2563b20808241806j75acb54ewcd0f0404f5253d2b@mail.gmail.com>

Oh, I just noticed, to do all that you'll have to add an erts group, or use
a group of your choice that Erlang is installed under.
E.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080824/f5e098f3/attachment.htm 

From petedao at gmail.com  Mon Aug 25 02:19:34 2008
From: petedao at gmail.com (Pete Kay)
Date: Mon, 25 Aug 2008 09:19:34 +0800
Subject: [rabbitmq-discuss] Rabbit Crash on Startup
In-Reply-To: <6c2563b20808241806j75acb54ewcd0f0404f5253d2b@mail.gmail.com>
References: <7aa8bd9d0808241734j1752ffa7x4d73f732c2c53494@mail.gmail.com>
	<7aa8bd9d0808241740g63425b4mb6a981fafb6a79e2@mail.gmail.com>
	<6c2563b20808241804v8f05fd9kdf5aa196d98dcc45@mail.gmail.com>
	<6c2563b20808241806j75acb54ewcd0f0404f5253d2b@mail.gmail.com>
Message-ID: <7aa8bd9d0808241819p4da35d56tb60d075453ca687f@mail.gmail.com>

Hi Edwin,

Thanks alot for your great help.  I checked that the group 'RabbitMQ' and
the user 'rabbitmq' are created in my system.  I su to the 'rabbitmq' user
to start rabbitmq-server, but it still fails;

debian:/usr/src/rabbitmq/rabbitmq-server-1.4.0/scripts# groupadd rabbitmq
groupadd: group rabbitmq exists
debian:/usr/src/rabbitmq/rabbitmq-server-1.4.0/scripts# useradd -c 'RabbitMQ
Control Account' -m -d /home/rabbitmq -G erts,rabbitmq -s /bin/bash rabbitmq
useradd: unknown group erts
debian:/usr/src/rabbitmq/rabbitmq-server-1.4.0/scripts# useradd -c 'RabbitMQ
Control Account' -m -d /home/rabbitmq -G rabbitmq -s /bin/bash rabbitmq
useradd: user rabbitmq exists
debian:/usr/src/rabbitmq/rabbitmq-server-1.4.0/scripts# passwd rabbitmq
Enter new UNIX password:
Retype new UNIX password:
passwd: password updated successfully
debian:/usr/src/rabbitmq/rabbitmq-server-1.4.0/scripts# su rabbitmq
debian:/usr/src/rabbitmq/rabbitmq-server-1.4.0/scripts# ./rabbitmq-server
RabbitMQ 1.4.0 (AMQP 8-0)
Copyright (C) 2007-2008 LShift Ltd., Cohesive Financial Technologies LLC.,
and Rabbit Technologies Ltd.
Licensed under the MPL.  See http://www.rabbitmq.com/

Logging to "/var/log/rabbitmq/rabbit.log"
SASL logging to "/var/log/rabbitmq/rabbit-sasl.log"

starting database             ...done
starting core processes       ...done
starting recovery             ...done
starting persister            ...done
starting builtin applications ...done
starting TCP listeners        ...{"init terminating in
do_boot",{{nocatch,{error,{cannot_start_application,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{{badmatch,{error,{shutdown,{child,undefined,'rabbit_tcp_listener_sup_0.0.0.0:5672',{tcp_listener_sup,start_link,[{0,0,0,0},5672,[binary,{packet,raw},{reuseaddr,true},{exit_on_close,false}],{rabbit_networking,tcp_listener_started,[]},{rabbit_networking,tcp_listener_stopped,[]},{rabbit_networking,start_client,[]}]},transient,infinity,supervisor,[tcp_listener_sup]}}}},[{rabbit_networking,start_tcp_listener,2},{rabbit,'-start/2-fun-6-',1},{lists,foreach,2},{rabbit,'-start/2-fun-0-',1},{lists,foreach,2},{rabbit,start,2},{application_master,start_it_old,4}]}}}}}}},[{init,start_it,1},{init,start_em,1}]}}

Crash dump was written to: erl_crash.dump
init terminating in do_boot ()
debian:/usr/src/rabbitmq/rabbitmq-server-1.4.0/scripts#


Any idea?

Thanks,
Pete
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080825/19f3e721/attachment.htm 

From petedao at gmail.com  Mon Aug 25 02:53:11 2008
From: petedao at gmail.com (Pete Kay)
Date: Mon, 25 Aug 2008 09:53:11 +0800
Subject: [rabbitmq-discuss] Rabbit Crash on Startup
In-Reply-To: <6c2563b20808241840i7c24d04o6cefb119488eb8cc@mail.gmail.com>
References: <7aa8bd9d0808241734j1752ffa7x4d73f732c2c53494@mail.gmail.com>
	<7aa8bd9d0808241740g63425b4mb6a981fafb6a79e2@mail.gmail.com>
	<6c2563b20808241804v8f05fd9kdf5aa196d98dcc45@mail.gmail.com>
	<6c2563b20808241806j75acb54ewcd0f0404f5253d2b@mail.gmail.com>
	<7aa8bd9d0808241819p4da35d56tb60d075453ca687f@mail.gmail.com>
	<6c2563b20808241840i7c24d04o6cefb119488eb8cc@mail.gmail.com>
Message-ID: <7aa8bd9d0808241853x3be64049s92d3efbcaf100157@mail.gmail.com>

It is running now.  Thank you so much.

Pete
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080825/55f99395/attachment.htm 

From petedao at gmail.com  Mon Aug 25 06:54:32 2008
From: petedao at gmail.com (Pete Kay)
Date: Mon, 25 Aug 2008 13:54:32 +0800
Subject: [rabbitmq-discuss] Need help with Rabbit STOMP client
Message-ID: <7aa8bd9d0808242254l39941e76l9c494dd98bbedf34@mail.gmail.com>

Hi,

I am working on using a Java client to publish message to Rabbit and using a
Flex client to subscribe to messages.

I have tried both Java client -> Flex client and Flex client -> Flex client,
but both don't work.

With Flex-> Flex, I am using the ImageSender.mxml and Image Receiver.mxml.
When running the example, I am getting:

Error: Error #2002: Operation attempted on invalid socket.
 at flash.net::Socket/writeBytes()
 at
org.codehaus.stomp::Stomp/transmit()[C:\Users\wischusen\Documents\FlexBuilderProjects\Stomp\org\codehaus\stomp\Stomp.as:263]
 at
org.codehaus.stomp::Stomp/send()[C:\Users\wischusen\Documents\FlexBuilderProjects\Stomp\org\codehaus\stomp\Stomp.as:192]
 at ImageSender/sendImage()[C:\Users\anne\Documents\Flex Builder
3\WebUI\src\ImageSender.mxml:50]
 at ImageSender/___ImageSender_Button2_click()[C:\Users\anne\Documents\Flex
Builder 3\WebUI\src\ImageSender.mxml:134]
The configure I am using is :

  private function init () : void
  {
   var ch: ConnectHeaders = new ConnectHeaders();
   ch.login = "rabbitmq";
   ch.passcode = "rabbitmq"
   stomp.connect("192.168.1.104", 5672, ch);
  }


It looks like I may have some fundamental errors in my STOMP client.  I can
send and receive messages between two Java client using the routing key with
no problem.

With the STOMP client, how can I speciy the ticket, routingKey and
exchange?  The onlything available to identiy the queue is destination -
stomp.subscribe( destination );

Any help and suggestion on getting it to work will be greatly appreciated.

Best Regards,
Pete
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080825/ba131513/attachment.htm 

From 0x6e6562 at gmail.com  Mon Aug 25 10:22:39 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Mon, 25 Aug 2008 10:22:39 +0100
Subject: [rabbitmq-discuss] Need help with Rabbit STOMP client
In-Reply-To: <7aa8bd9d0808242254l39941e76l9c494dd98bbedf34@mail.gmail.com>
References: <7aa8bd9d0808242254l39941e76l9c494dd98bbedf34@mail.gmail.com>
Message-ID: <269388e30808250222q4c655aaeoebcd90d0b7ebeb05@mail.gmail.com>

Pete,

On Mon, Aug 25, 2008 at 6:54 AM, Pete Kay <petedao at gmail.com> wrote:
> I have tried both Java client -> Flex client and Flex client -> Flex client,
> but both don't work.

I'm assuming that you're using Derek's example, which is known to work :-)

> With Flex-> Flex, I am using the ImageSender.mxml and Image Receiver.mxml.
> When running the example, I am getting:
>
> Error: Error #2002: Operation attempted on invalid socket.
>  at flash.net::Socket/writeBytes()
....
> The configure I am using is :
>
>   private function init () : void
>   {
>    var ch: ConnectHeaders = new ConnectHeaders();
>    ch.login = "rabbitmq";
>    ch.passcode = "rabbitmq"
>    stomp.connect("192.168.1.104", 5672, ch);
>   }

IIRC the STOMP adapter listens on 61613, whereas the AMQP adapter
listens on 5672.

> It looks like I may have some fundamental errors in my STOMP client.  I can
> send and receive messages between two Java client using the routing key with
> no problem.

Do you mean to say that you've sucessfully tested the Java AMQP client
or the Java STOMP client?

> With the STOMP client, how can I speciy the ticket, routingKey and
> exchange?  The onlything available to identiy the queue is destination -
> stomp.subscribe( destination );

The STOMP protocol is slightly different to AMQP. Routing keys and
exchanges are concepts from the AMQP model, which are in part mappable
to STOMP.

However I think it would be a good idea to specify clearly what
problem you are trying to solve.

For example, do you want to integrate a Java STOMP client with an AS3
STOMP client or a Java AMQP client with an AS3 AMQP client or a
mixture of both?

Ben



From 0x6e6562 at gmail.com  Mon Aug 25 10:32:37 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Mon, 25 Aug 2008 10:32:37 +0100
Subject: [rabbitmq-discuss] Need help installing Rabbit-Server
In-Reply-To: <7aa8bd9d0808241721u6487897ap1652e44bb4416a6b@mail.gmail.com>
References: <7aa8bd9d0808240823l79442fbdyed4deaba92ae1f67@mail.gmail.com>
	<48B17F6C.20703@lshift.net>
	<7aa8bd9d0808241720q528a0897i7d8269b0a42f4586@mail.gmail.com>
	<7aa8bd9d0808241721u6487897ap1652e44bb4416a6b@mail.gmail.com>
Message-ID: <269388e30808250232k1ffb9b7flb2b94019d6c7b361@mail.gmail.com>

Pete,

On Mon, Aug 25, 2008 at 1:21 AM, Pete Kay <petedao at gmail.com> wrote:
> Starting node rabbit at debian...
> {error_logger,{{2008,8,25},{7,9,14}},"Protocol: ~p: register error:
> ~p~n",["inet_tcp",{{badmatch,{error,duplicate_name}},[{inet_tcp_dist,listen,1},{net_kernel,start_protos,4},{net_kernel,start_protos,3},{net_kernel,init_node,2},{net_kernel,init,1},{gen_server,init_it,6},{proc_lib,init_p,5}]}]}

That looks like an Erlang node called rabbit at debian... is already
running on your machine. Look for a process called beam and kill it.
Then try to restart Rabbit. If that doesn't help, look for a process
called epmd and kill that as well. Then restart.

HTH,

Ben



From petedao at gmail.com  Mon Aug 25 10:48:47 2008
From: petedao at gmail.com (Pete Kay)
Date: Mon, 25 Aug 2008 17:48:47 +0800
Subject: [rabbitmq-discuss] Need help with Rabbit STOMP client
In-Reply-To: <269388e30808250222q4c655aaeoebcd90d0b7ebeb05@mail.gmail.com>
References: <7aa8bd9d0808242254l39941e76l9c494dd98bbedf34@mail.gmail.com>
	<269388e30808250222q4c655aaeoebcd90d0b7ebeb05@mail.gmail.com>
Message-ID: <7aa8bd9d0808250248t716bd9ecq174d667df6bd0ad7@mail.gmail.com>

Hi Ben,

Thank you very much for your kind reply.    Let me explain my scenario.

I am going to write a Java Client that listens on messages from multiple
clustered servers using socket, filters the messages, and publishes the
useful ones to RabbitMQ.  Previously, I have this written in C but since
there is no C client for RabbitMQ, I am going to rewirte it in Java.  Then,
on the subscribe side, I am going to have Flex client (AS3) that wait for
messages of its specific ID and display it.

For the Flex side, I guess I have to use STOMP, but for the publishing side,
I am thinking to use AMQP as there seems to be more examples available for
reference.  Will that work?

What I still don't understand is how the routingkey, ticket, and exchange
concepts map to the destination in STOMP.

Would you please give me some guidance?

Thanks alot for all your help.

Regards,
Pete
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080825/a6d884e2/attachment.htm 

From petedao at gmail.com  Mon Aug 25 11:06:03 2008
From: petedao at gmail.com (Pete Kay)
Date: Mon, 25 Aug 2008 18:06:03 +0800
Subject: [rabbitmq-discuss] Need help with Rabbit STOMP client
In-Reply-To: <7aa8bd9d0808250248t716bd9ecq174d667df6bd0ad7@mail.gmail.com>
References: <7aa8bd9d0808242254l39941e76l9c494dd98bbedf34@mail.gmail.com>
	<269388e30808250222q4c655aaeoebcd90d0b7ebeb05@mail.gmail.com>
	<7aa8bd9d0808250248t716bd9ecq174d667df6bd0ad7@mail.gmail.com>
Message-ID: <7aa8bd9d0808250306x1f88d15bj1e3ea9013fdab75f@mail.gmail.com>

Hi Ben,

By the way, I realize that you also have written a AS3 client for AMQP.
Could you send me that?  If I can use that, then  maybe I don't need to use
the STOMP client.  In that case, I can use the JAVA AMQP client as the
publisher and the AS3 AMQP client as the subscriber.

The problem is that I am having difficulty accessing this site:

http://hopper.squarespace.com/blog/2008/1/26/flex-amqp-client-technology-preview.html

I am not sure if the site is temporarily down or access is blogged from my
country.  The country I am located in is known for blocking blog sites that
it does not like.

Would you please kindly send me the sample code you hve for the AMQP AS3
client?

Thanks alot for all your kind help.

Best Regards,
Pete
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080825/b67d5e2d/attachment.htm 

From 0x6e6562 at gmail.com  Mon Aug 25 11:18:04 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Mon, 25 Aug 2008 11:18:04 +0100
Subject: [rabbitmq-discuss] Need help with Rabbit STOMP client
In-Reply-To: <7aa8bd9d0808250248t716bd9ecq174d667df6bd0ad7@mail.gmail.com>
References: <7aa8bd9d0808242254l39941e76l9c494dd98bbedf34@mail.gmail.com>
	<269388e30808250222q4c655aaeoebcd90d0b7ebeb05@mail.gmail.com>
	<7aa8bd9d0808250248t716bd9ecq174d667df6bd0ad7@mail.gmail.com>
Message-ID: <269388e30808250318p57950f42s65b4d40f8a292fa5@mail.gmail.com>

Pete,

On Mon, Aug 25, 2008 at 10:48 AM, Pete Kay <petedao at gmail.com> wrote:
> I am going to write a Java Client that listens on messages from multiple
> clustered servers using socket, filters the messages, and publishes the
> useful ones to RabbitMQ.  Previously, I have this written in C but since
> there is no C client for RabbitMQ, I am going to rewirte it in Java.

The alternative to this would be to write a AMQP client in C :-) Once
you have understood the AMQP model, this is not a hard thing to do,
and we have a guide about how to develop AMQP clients for the language
of your choice. So if you're keen, you will learn a lot about the AMQP
in general, which will be very valueable for any message based
application development. Just a thought.

> For the Flex side, I guess I have to use STOMP, but for the publishing side,
> I am thinking to use AMQP as there seems to be more examples available for
> reference.  Will that work?

Have you looked at the AS3 client for AMQP as opposed to STOMP?

http://github.com/0x6e6562/as3-amqp/tree/master

Here is one example usage:
http://hopper.squarespace.com/blog/2008/7/4/server-side-as3.html

If you look in the AS3 category on that blog, you will see more examples.

>
> What I still don't understand is how the routingkey, ticket, and exchange
> concepts map to the destination in STOMP.

If you don't really need to use STOMP, you can use plain jane AMQP
with the AS3 library I mentioned above, so the semantics are identical
to those of the Java AMQP client.

HTH,

Ben



From petedao at gmail.com  Mon Aug 25 11:27:53 2008
From: petedao at gmail.com (Pete Kay)
Date: Mon, 25 Aug 2008 18:27:53 +0800
Subject: [rabbitmq-discuss] Need help with Rabbit STOMP client
In-Reply-To: <269388e30808250318p57950f42s65b4d40f8a292fa5@mail.gmail.com>
References: <7aa8bd9d0808242254l39941e76l9c494dd98bbedf34@mail.gmail.com>
	<269388e30808250222q4c655aaeoebcd90d0b7ebeb05@mail.gmail.com>
	<7aa8bd9d0808250248t716bd9ecq174d667df6bd0ad7@mail.gmail.com>
	<269388e30808250318p57950f42s65b4d40f8a292fa5@mail.gmail.com>
Message-ID: <7aa8bd9d0808250327t44ac1ef4ofb22a79b0ea523dd@mail.gmail.com>

Hi Ben,

Thanks alot for your suggestion.  I think writing a AMQP client would be
kind of a fun thing to do.  I am going to spend some times learning more
about the AMQP model.   Is it based on socket as well?

I also found those links from Google but I am not able to access those sites
from the country where I am at.  It is blocked for some reaons.  Would you
mind to send me the source and blog in email ( petedao at gmail.com )?

Thanks a million for all your help.

Best Regards,
Pete




The alternative to this would be to write a AMQP client in C :-) Once
> you have understood the AMQP model, this is not a hard thing to do,
> and we have a guide about how to develop AMQP clients for the language
> of your choice. So if you're keen, you will learn a lot about the AMQP
> in general, which will be very valueable for any message based
> application development. Just a thought.
>
> > For the Flex side, I guess I have to use STOMP, but for the publishing
> side,
> > I am thinking to use AMQP as there seems to be more examples available
> for
> > reference.  Will that work?
>
> Have you looked at the AS3 client for AMQP as opposed to STOMP?
>
> http://github.com/0x6e6562/as3-amqp/tree/master
>
> Here is one example usage:
> http://hopper.squarespace.com/blog/2008/7/4/server-side-as3.html
>
> If you look in the AS3 category on that blog, you will see more examples.
>
> >
> > What I still don't understand is how the routingkey, ticket, and exchange
> > concepts map to the destination in STOMP.
>
> If you don't really need to use STOMP, you can use plain jane AMQP
> with the AS3 library I mentioned above, so the semantics are identical
> to those of the Java AMQP client.
>
> HTH,
>
> Ben
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080825/a25b56d7/attachment.htm 

From 0x6e6562 at gmail.com  Mon Aug 25 11:46:53 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Mon, 25 Aug 2008 11:46:53 +0100
Subject: [rabbitmq-discuss] Need help with Rabbit STOMP client
In-Reply-To: <7aa8bd9d0808250306x1f88d15bj1e3ea9013fdab75f@mail.gmail.com>
References: <7aa8bd9d0808242254l39941e76l9c494dd98bbedf34@mail.gmail.com>
	<269388e30808250222q4c655aaeoebcd90d0b7ebeb05@mail.gmail.com>
	<7aa8bd9d0808250248t716bd9ecq174d667df6bd0ad7@mail.gmail.com>
	<7aa8bd9d0808250306x1f88d15bj1e3ea9013fdab75f@mail.gmail.com>
Message-ID: <269388e30808250346h3ffc8c10sb61f30a6fa11ee01@mail.gmail.com>

Pete,

On Mon, Aug 25, 2008 at 11:06 AM, Pete Kay <petedao at gmail.com> wrote:
> The problem is that I am having difficulty accessing this site:
>
> http://hopper.squarespace.com/blog/2008/1/26/flex-amqp-client-technology-preview.html

I've just tested it, and it seems to work for me. I've also just
looked at the usage stats for the last 24 hours and there seems to
have been quite a few people creating page views.

Can you access the main URL, i.e. http://hopper.squarespace.com?

BTW, you can just get the code and examples from github (if that's not
blocked :-)

http://github.com/0x6e6562/as3-amqp/tree/master

>
> I am not sure if the site is temporarily down or access is blogged from my
> country.  The country I am located in is known for blocking blog sites that
> it does not like.

Are you at liberty to say which one that is?

Ben



From petedao at gmail.com  Mon Aug 25 11:52:52 2008
From: petedao at gmail.com (Pete Kay)
Date: Mon, 25 Aug 2008 18:52:52 +0800
Subject: [rabbitmq-discuss] Need help with Rabbit STOMP client
In-Reply-To: <269388e30808250346h3ffc8c10sb61f30a6fa11ee01@mail.gmail.com>
References: <7aa8bd9d0808242254l39941e76l9c494dd98bbedf34@mail.gmail.com>
	<269388e30808250222q4c655aaeoebcd90d0b7ebeb05@mail.gmail.com>
	<7aa8bd9d0808250248t716bd9ecq174d667df6bd0ad7@mail.gmail.com>
	<7aa8bd9d0808250306x1f88d15bj1e3ea9013fdab75f@mail.gmail.com>
	<269388e30808250346h3ffc8c10sb61f30a6fa11ee01@mail.gmail.com>
Message-ID: <7aa8bd9d0808250352y2b7bad56re14261a63ad0c734@mail.gmail.com>

Hi Ben,

Unfortunately, both sites you gave me are inaccessible from my end.  It is
an anonying problem that I have to live with all the times.

If you don't mind, would it be possible for you to send me those files in
zip?

Sorry for the inconvenience.

Best Regards,
Anne

On Mon, Aug 25, 2008 at 6:46 PM, Ben Hood <0x6e6562 at gmail.com> wrote:

> Pete,
>
> On Mon, Aug 25, 2008 at 11:06 AM, Pete Kay <petedao at gmail.com> wrote:
> > The problem is that I am having difficulty accessing this site:
> >
> >
> http://hopper.squarespace.com/blog/2008/1/26/flex-amqp-client-technology-preview.html
>
> I've just tested it, and it seems to work for me. I've also just
> looked at the usage stats for the last 24 hours and there seems to
> have been quite a few people creating page views.
>
> Can you access the main URL, i.e. http://hopper.squarespace.com?
>
> BTW, you can just get the code and examples from github (if that's not
> blocked :-)
>
> http://github.com/0x6e6562/as3-amqp/tree/master
>
> >
> > I am not sure if the site is temporarily down or access is blogged from
> my
> > country.  The country I am located in is known for blocking blog sites
> that
> > it does not like.
>
> Are you at liberty to say which one that is?
>
> Ben
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080825/03f76259/attachment.htm 

From 0x6e6562 at gmail.com  Mon Aug 25 16:08:28 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Mon, 25 Aug 2008 16:08:28 +0100
Subject: [rabbitmq-discuss] JSON version of the AMQP wire format
In-Reply-To: <7aa8bd9d0808250710q8a0e67fjd9142db26327dd42@mail.gmail.com>
References: <269388e30808250527i4a3bc105x88c49c47418892bc@mail.gmail.com>
	<7aa8bd9d0808250710q8a0e67fjd9142db26327dd42@mail.gmail.com>
Message-ID: <269388e30808250808u790bbd8du56368923427053ea@mail.gmail.com>

Anne,

On Mon, Aug 25, 2008 at 3:10 PM, Pete Kay <petedao at gmail.com> wrote:
> Hi Ben,
>
> Sorry for having to bother you again.   I am having trouble running the
> sample.  I can't find the ampq.swc from the zip file and the other .swc
> files includes don't seem to have the correct source.  Would you email me
> the ampq.swc?  I tried to use the source file directly, but it looks like a
> few classes are missing such as
> org.amqp.methods.basic.Consume,org.amqp.methods.basic.Deliver, and
> org.amqp.headers.BasicProperties
>
> Would you please help me out?

Since that is the source distro, you need to build the swc from that
source first. To do this, run the ant script that ships with the
distro. The first thing it does is to generate AS3 source code from
the AMQP specification which is then compiled as normal AS3 source.
The result is a amqp.swc file. The generated source code includes the
classes you mention above.

HTH,

Ben



From petedao at gmail.com  Wed Aug 27 01:17:45 2008
From: petedao at gmail.com (Pete Kay)
Date: Wed, 27 Aug 2008 08:17:45 +0800
Subject: [rabbitmq-discuss] Can RabbitMQ actively subscribe to another server
Message-ID: <7aa8bd9d0808261717o6b8c3aa1j967f227bfcdea98@mail.gmail.com>

Hi,

Currenly, I can have RabbitMQ to with for events to be recevied and then
published it out to its subscribers.  Is it possible to have RabbitMQ to
actively subscribe to an external server and listen for the received events,
via socket?  What that may mean is for me to write some code that RabbitMQ
can call to subscribe to an external service and wait for the messages
received from the open socket.

Also, is it possible to wite some filtering module that RabbitMQ can execute
when the event is received?

Thanks alot for your help.

Anne
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080827/dca04387/attachment.htm 

From petedao at gmail.com  Wed Aug 27 07:24:24 2008
From: petedao at gmail.com (Pete Kay)
Date: Wed, 27 Aug 2008 14:24:24 +0800
Subject: [rabbitmq-discuss] RabbitMQ Flex subscriber
Message-ID: <7aa8bd9d0808262324i4b115d8dvbbdf6b90ecb8fb5e@mail.gmail.com>

Hi,

I think I am close to getting my Flex code to subscribe to RabbitMQ, but I
am a bit stuck on just one thing.

When connecting using AMPQ Flex lib, I am getting:

Calling handleForcedShutdown from connection
forceClose called

Is there any way I can turn on some kind of logging to see all the messages
going in and out of RabbitMQ to debug this problem?

Could someone please kindly help me out?

Here is my simple Flex code for getting the published messages from the Java
client:

       public class Subscriber implements BasicConsumer {
      protected var x:String = "";
          protected var q:String = "";
         protected var x_type:String = "topic";
         protected var bind_key:String = "*"
         protected var routing_key:String = "SimpleQueue"
         protected var connection:Connection;
         protected var baseSession:Session;
         protected var sessionManager:SessionManager;
         protected var sessionHandler:SessionStateHandler;

         public function Subscriber() {
           init();
   }

   private function init () : void
   {
    trace("init()");
    var state:ConnectionState = new ConnectionState();

        state.username = "guest";
       state.password = "gutes";
       state.vhostpath = "/";
       state.serverhost = "192.168.1.104";
       var connection:Connection = new Connection(state);
       var baseSession:Session = connection.baseSession;
       var sessionManager:SessionManager = connection.sessionManager;
    connection.start();
    baseSession.addEventListener(new OpenOk(), onOpenOk);
   }

   public function onOpenOk(event:ProtocolEvent):void {
    trace("OpenOK");
    sessionHandler = sessionManager.create();
    var open:Open = new Open();
    var accessRequest:Request = new Request();
    accessRequest.realm = "/data";
    accessRequest.passive = true;
    accessRequest.active = true;
    accessRequest.read = true;
    accessRequest.write = true;
    var exchange:org.amqp.methods.exchange.Declare
     = new org.amqp.methods.exchange.Declare();
    exchange.exchange = x;
    exchange.type =x_type;
    var queue:org.amqp.methods.queue.Declare
     = new org.amqp.methods.queue.Declare();
    queue.queue = q;
    var bind:Bind = new Bind();
    bind.exchange = x;
    bind.queue = q;
    bind.routingkey = bind_key;

   sessionHandler.dispatch(new Command(open));
   sessionHandler.dispatch(new Command(accessRequest));
   sessionHandler.dispatch(new Command(exchange));
   sessionHandler.dispatch(new Command(queue));
   sessionHandler.dispatch(new Command(bind));
   sessionHandler.addEventListener(new BindOk(), onBindOk);

  }
  public function onBindOk(event:ProtocolEvent):void{
    trace("onBindOk called");
     var consume:Consume = new Consume();
             consume.queue = q;
             consume.noack = true;
             sessionHandler.register(consume, this);
   };

  public function onConsumeOk(tag:String):void {
            //consumerTag = tag;
            trace("onConsumeOk");
        }

       public function onCancelOk(tag:String):void {
            trace("onCancelOk");
        }
        public function onDeliver(method:Deliver,
                                  properties:BasicProperties,
                                  body:ByteArray):void {
            trace("onDeliver --> " + body.readUTF());
        }


Thank you very much for all your kind help.

Anne
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080827/0facf3d2/attachment.htm 

From 0x6e6562 at gmail.com  Wed Aug 27 08:26:41 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 27 Aug 2008 08:26:41 +0100
Subject: [rabbitmq-discuss] RabbitMQ Flex subscriber
In-Reply-To: <7aa8bd9d0808262324i4b115d8dvbbdf6b90ecb8fb5e@mail.gmail.com>
References: <7aa8bd9d0808262324i4b115d8dvbbdf6b90ecb8fb5e@mail.gmail.com>
Message-ID: <269388e30808270026j7527aa49w2b0085a2e8f4902f@mail.gmail.com>

Anne,

On Wed, Aug 27, 2008 at 7:24 AM, Pete Kay <petedao at gmail.com> wrote:

>    private function init () : void
>    {
>     trace("init()");
>     var state:ConnectionState = new ConnectionState();
>
>         state.username = "guest";
>        state.password = "gutes";
>        state.vhostpath = "/";
>        state.serverhost = "192.168.1.104";
>        var connection:Connection = new Connection(state);
>        var baseSession:Session = connection.baseSession;
>        var sessionManager:SessionManager = connection.sessionManager;
>     connection.start();
>     baseSession.addEventListener(new OpenOk(), onOpenOk);
>    }

Try using "guest" instead of "gutes" as the pasword.

>
>    public function onOpenOk(event:ProtocolEvent):void {
>     trace("OpenOK");
>     sessionHandler = sessionManager.create();
>     var open:Open = new Open();
>     var accessRequest:Request = new Request();
>     accessRequest.realm = "/data";
>     accessRequest.passive = true;
>     accessRequest.active = true;
>     accessRequest.read = true;
>     accessRequest.write = true;
>     var exchange:org.amqp.methods.exchange.Declare
>      = new org.amqp.methods.exchange.Declare();
>     exchange.exchange = x;
>     exchange.type =x_type;
>     var queue:org.amqp.methods.queue.Declare
>      = new org.amqp.methods.queue.Declare();
>     queue.queue = q;
>     var bind:Bind = new Bind();
>     bind.exchange = x;
>     bind.queue = q;
>     bind.routingkey = bind_key;
>    sessionHandler.dispatch(new Command(open));
>    sessionHandler.dispatch(new Command(accessRequest));
>    sessionHandler.dispatch(new Command(exchange));
>    sessionHandler.dispatch(new Command(queue));
>    sessionHandler.dispatch(new Command(bind));
>    sessionHandler.addEventListener(new BindOk(), onBindOk);
>
>   }


The access.request command is now deprecated, so you don't need to send it.

BTW, there is a SubscribeClient template in the AS3 library which does
all of this for you, so you don't need to re-invent the wheel.

HTH,

Ben



From petedao at gmail.com  Wed Aug 27 09:09:22 2008
From: petedao at gmail.com (Pete Kay)
Date: Wed, 27 Aug 2008 16:09:22 +0800
Subject: [rabbitmq-discuss] RabbitMQ Flex subscriber
In-Reply-To: <269388e30808270026j7527aa49w2b0085a2e8f4902f@mail.gmail.com>
References: <7aa8bd9d0808262324i4b115d8dvbbdf6b90ecb8fb5e@mail.gmail.com>
	<269388e30808270026j7527aa49w2b0085a2e8f4902f@mail.gmail.com>
Message-ID: <7aa8bd9d0808270109v7b37649i251ffd38274e9b44@mail.gmail.com>

Hi Ben,

I simplified my code significantly by using SubscribeClient class.  Thanks
for the great help.

However, I am still getting "Calling handleForcedShutdown from connection
forceClose called".

Here is the code I am using.  By the way, I am assuming the first argument
for .subscribe() refers to the routing key.

        public function init():void {
   trace("test sub init");
            connection = new Connection(buildConnectionState());
    subClient = new SubscribeClientImpl(connection);
    //         subClient.serializer = serializer;
            subClient.exchange = "";
            subClient.exchangeType = "topic";
         subClient.subscribe("SimpleQueue", onMessageArrive);
            subClient.subscribe("SimpleQueue", onMessageArrive);
         }
         public function buildConnectionState():ConnectionState {
             var state:ConnectionState = new ConnectionState();
             state.username = "guest";
             state.password = "guest";
             state.vhostpath = "/";
             state.serverhost = "192.168.1.104";
             return state;
         }
         public function onMessageArrive(event:CorrelatedMessageEvent):void
{
               trace("Consumed message from ABC");
               var o:* = event.result;
              trace("message = " + o.msg);
         }

Any idea why I can't connect?

Thanks alot for your help.

Best Regards,
Anne
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080827/55e4dc65/attachment.htm 

From 0x6e6562 at gmail.com  Wed Aug 27 13:25:22 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 27 Aug 2008 13:25:22 +0100
Subject: [rabbitmq-discuss] RabbitMQ Flex subscriber
In-Reply-To: <7aa8bd9d0808270109v7b37649i251ffd38274e9b44@mail.gmail.com>
References: <7aa8bd9d0808262324i4b115d8dvbbdf6b90ecb8fb5e@mail.gmail.com>
	<269388e30808270026j7527aa49w2b0085a2e8f4902f@mail.gmail.com>
	<7aa8bd9d0808270109v7b37649i251ffd38274e9b44@mail.gmail.com>
Message-ID: <269388e30808270525m52039b7by160240d52e38fea8@mail.gmail.com>

Pete,

On Wed, Aug 27, 2008 at 9:09 AM, Pete Kay <petedao at gmail.com> wrote:
> Hi Ben,
>
> I simplified my code significantly by using SubscribeClient class.  Thanks
> for the great help.
>
> However, I am still getting "Calling handleForcedShutdown from connection
> forceClose called".
>
> Here is the code I am using.  By the way, I am assuming the first argument
> for .subscribe() refers to the routing key.
>
>         public function init():void {
>    trace("test sub init");
>             connection = new Connection(buildConnectionState());
>     subClient = new SubscribeClientImpl(connection);
>     //         subClient.serializer = serializer;
>             subClient.exchange = "";
>             subClient.exchangeType = "topic";
>          subClient.subscribe("SimpleQueue", onMessageArrive);
>             subClient.subscribe("SimpleQueue", onMessageArrive);
>          }
>          public function buildConnectionState():ConnectionState {
>              var state:ConnectionState = new ConnectionState();
>              state.username = "guest";
>              state.password = "guest";
>              state.vhostpath = "/";
>              state.serverhost = "192.168.1.104";
>              return state;
>          }
>          public function onMessageArrive(event:CorrelatedMessageEvent):void
> {
>                trace("Consumed message from ABC");
>                var o:* = event.result;
>               trace("message = " + o.msg);
>          }

This looks like an adaptation of the PublishSubscribeClientTest. Have
you run that test out of the box?

HTH,

Ben



From 0x6e6562 at gmail.com  Wed Aug 27 13:33:55 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 27 Aug 2008 13:33:55 +0100
Subject: [rabbitmq-discuss] Can RabbitMQ actively subscribe to another
	server
In-Reply-To: <7aa8bd9d0808261717o6b8c3aa1j967f227bfcdea98@mail.gmail.com>
References: <7aa8bd9d0808261717o6b8c3aa1j967f227bfcdea98@mail.gmail.com>
Message-ID: <269388e30808270533i5571342brf68078c870cc02b7@mail.gmail.com>

Anne,

On Wed, Aug 27, 2008 at 1:17 AM, Pete Kay <petedao at gmail.com> wrote:
> Currenly, I can have RabbitMQ to with for events to be recevied and then
> published it out to its subscribers.  Is it possible to have RabbitMQ to
> actively subscribe to an external server and listen for the received events,
> via socket?

No. Rabbit brokers messages, which means that it itself is not an
active client of anything. You can only use AMQP clients to publish or
subscribe to queues and exchanges that are located in Rabbit. In this
scenario you would have to have an external client listen on the
socket and then publish the data to Rabbit.

> Also, is it possible to wite some filtering module that RabbitMQ can execute
> when the event is received?

This depends on what you need to filter. If the filter can be
expressed using routing rules, then maybe you've got a simple
solution.

HTH,

Ben



From petedao at gmail.com  Thu Aug 28 00:30:06 2008
From: petedao at gmail.com (Pete Kay)
Date: Thu, 28 Aug 2008 07:30:06 +0800
Subject: [rabbitmq-discuss] Unable to connect Flex with RabbitMQ
Message-ID: <7aa8bd9d0808271630h6592ecb4m8d2fa6ce2b1cd74a@mail.gmail.com>

Hi,

I have Flex on one machine and RabbitMQ on another machine.  When trying to
establish connection, RabbitMQ.log says:


error on TCP connection <0.8716.0> from 192.168.1.100:50021
{handshake_timeout,frame_header}


Does anyone know how to resolve this problem?

I am using the ampq.swc library.

Any help will be greatly appreciated.

Best Regards,
Anne
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080828/9b0a3dc0/attachment.htm 

From 0x6e6562 at gmail.com  Thu Aug 28 18:47:23 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Thu, 28 Aug 2008 18:47:23 +0100
Subject: [rabbitmq-discuss] Unable to connect Flex with RabbitMQ
In-Reply-To: <7aa8bd9d0808271630h6592ecb4m8d2fa6ce2b1cd74a@mail.gmail.com>
References: <7aa8bd9d0808271630h6592ecb4m8d2fa6ce2b1cd74a@mail.gmail.com>
Message-ID: <269388e30808281047g5d01f38bk579976f3a70719fb@mail.gmail.com>

Anne,

On Thu, Aug 28, 2008 at 12:30 AM, Pete Kay <petedao at gmail.com> wrote:
>
> I have Flex on one machine and RabbitMQ on another machine.  When trying to
> establish connection, RabbitMQ.log says:
>
>
> error on TCP connection <0.8716.0> from 192.168.1.100:50021
> {handshake_timeout,frame_header}

It's a bit hard to tell what is going on here from the information you
have given.

Can you zip up your code and send it to me so that I can see if there
is anything wrong with it?

Thx,

Ben



From petedao at gmail.com  Fri Aug 29 00:20:29 2008
From: petedao at gmail.com (Pete Kay)
Date: Fri, 29 Aug 2008 07:20:29 +0800
Subject: [rabbitmq-discuss] Unable to connect Flex with RabbitMQ
In-Reply-To: <269388e30808281047g5d01f38bk579976f3a70719fb@mail.gmail.com>
References: <7aa8bd9d0808271630h6592ecb4m8d2fa6ce2b1cd74a@mail.gmail.com>
	<269388e30808281047g5d01f38bk579976f3a70719fb@mail.gmail.com>
Message-ID: <7aa8bd9d0808281620n4db24059p65745930544b3311@mail.gmail.com>

Hi Ben,

Thank you very much for your kind help.  Here is my code:

<?xml version="1.0" encoding="utf-8"?>
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml"
    layout="absolute" styleName="plain"  creationComplete="init()">
  <mx:Script>
        <![CDATA[
     import org.amqp.patterns.impl.SubscribeClientImpl;
        import org.amqp.patterns.SubscribeClient;
       import org.amqp.Connection;
      import org.amqp.ConnectionState;
     import org.amqp.patterns.CorrelatedMessageEvent;
  import org.amqp.ProtocolEvent;
     import org.amqp.Session;
     import org.amqp.SessionManager;
        import org.amqp.impl.SessionStateHandler;
        private var subClient:SubscribeClientImpl;
        protected var connection:Connection;

   private var serializer:JSONSerializer = new JSONSerializer();
        public function init():void {
   trace("test sub init");
            connection = new Connection(buildConnectionState());
            subClient = new SubscribeClientImpl(connection);
   subClient.serializer = serializer;
//   subClient.realm = "/data";
   subClient.exchange = "gamex";
   subClient.exchangeType = "topic";
   //sub.subscribe(...);
        }
    public function buildConnectionState():ConnectionState {
            var state:ConnectionState = new ConnectionState();
            state.username = "guest";
            state.password = "guest";
            state.vhostpath = "/";
            state.serverhost = "192.168.1.104";
            return state;
        }

        public function onMessageArrive(event:CorrelatedMessageEvent):void {
            var o:* = event.result;
        }
     ]]>
    </mx:Script>
</mx:Application>



Best Regards,
Anne
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080829/a83bfe48/attachment.htm 

From 0x6e6562 at gmail.com  Fri Aug 29 01:02:15 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Fri, 29 Aug 2008 01:02:15 +0100
Subject: [rabbitmq-discuss] Unable to connect Flex with RabbitMQ
In-Reply-To: <7aa8bd9d0808281620n4db24059p65745930544b3311@mail.gmail.com>
References: <7aa8bd9d0808271630h6592ecb4m8d2fa6ce2b1cd74a@mail.gmail.com>
	<269388e30808281047g5d01f38bk579976f3a70719fb@mail.gmail.com>
	<7aa8bd9d0808281620n4db24059p65745930544b3311@mail.gmail.com>
Message-ID: <269388e30808281702r7583f576y52e3b548a9cc73f6@mail.gmail.com>

Anne,

On Fri, Aug 29, 2008 at 12:20 AM, Pete Kay <petedao at gmail.com> wrote:

>    //sub.subscribe(...);

Why did you comment this line out?

Ben



From petedao at gmail.com  Fri Aug 29 01:46:22 2008
From: petedao at gmail.com (Pete Kay)
Date: Fri, 29 Aug 2008 08:46:22 +0800
Subject: [rabbitmq-discuss] Unable to connect Flex with RabbitMQ
In-Reply-To: <269388e30808281702r7583f576y52e3b548a9cc73f6@mail.gmail.com>
References: <7aa8bd9d0808271630h6592ecb4m8d2fa6ce2b1cd74a@mail.gmail.com>
	<269388e30808281047g5d01f38bk579976f3a70719fb@mail.gmail.com>
	<7aa8bd9d0808281620n4db24059p65745930544b3311@mail.gmail.com>
	<269388e30808281702r7583f576y52e3b548a9cc73f6@mail.gmail.com>
Message-ID: <7aa8bd9d0808281746v2d002adcuc31d769f950c016b@mail.gmail.com>

Hi Ben,

I commented it out just to see if it could run without the forceClose error,
but I still get that error even after I commenting out that line.   I tried
the following, that the subscribe line back on, but it still does not work
for me.
<?xml version="1.0" encoding="utf-8"?>
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml"
    layout="absolute" styleName="plain"  creationComplete="init()">
  <mx:Script>
        <![CDATA[
     import org.amqp.patterns.impl.SubscribeClientImpl;
        import org.amqp.patterns.SubscribeClient;
       import org.amqp.Connection;
      import org.amqp.ConnectionState;
     import org.amqp.patterns.CorrelatedMessageEvent;
  import org.amqp.ProtocolEvent;
     import org.amqp.Session;
     import org.amqp.SessionManager;
        import org.amqp.impl.SessionStateHandler;
        private var subClient:SubscribeClientImpl;
        protected var connection:Connection;

   private var serializer:JSONSerializer = new JSONSerializer();
        public function init():void {
   trace("test sub init");
            connection = new Connection(buildConnectionState());
            subClient = new SubscribeClientImpl(connection);
   subClient.serializer = serializer;
//   subClient.realm = "/data";
   subClient.exchange = "gamex";
   subClient.exchangeType = "topic";
            subClient.subscribe("utest.topic-abc", onMessageArrive);
        }
    public function buildConnectionState():ConnectionState {
            var state:ConnectionState = new ConnectionState();
            state.username = "guest";
            state.password = "guest";
            state.vhostpath = "/";
            state.serverhost = "192.168.1.104";
            return state;
        }

        public function onMessageArrive(event:CorrelatedMessageEvent):void {
            var o:* = event.result;
        }
     ]]>
    </mx:Script>
</mx:Application>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080829/0a9b583d/attachment.htm 

From rabbitmq at tmm1.net  Fri Aug 29 02:10:22 2008
From: rabbitmq at tmm1.net (Aman Gupta)
Date: Thu, 28 Aug 2008 18:10:22 -0700
Subject: [rabbitmq-discuss] Gracefully shutting down rabbitmq
Message-ID: <e1c05edd0808281810t158a2cawb043a44c57a86e54@mail.gmail.com>

I'm getting errors whenever I try to shut down rabbitmq gracefully:

 =INFO REPORT==== 28-Aug-2008::17:20:13 ===
 node 'control_rabbitmq-9980 at localhost' up
 =INFO REPORT==== 28-Aug-2008::17:20:13 ===
 Stop-and-halt request received; halting in 1000 milliseconds

 =INFO REPORT==== 28-Aug-2008::17:20:13 ===
 stopped TCP listener on 127.0.0.1:9980

 =INFO REPORT==== 28-Aug-2008::17:20:13 ===
 closing TCP connection <0.3408.0> from 127.0.0.1:39084

 =INFO REPORT==== 28-Aug-2008::17:20:13 ===
 closing TCP connection <0.3407.0> from 127.0.0.1:39083

 =INFO REPORT==== 28-Aug-2008::17:20:13 ===
     application: rabbit
     exited: stopped
     type: temporary

 =INFO REPORT==== 28-Aug-2008::17:20:13 ===
     application: mnesia
     exited: stopped
     type: temporary

 =INFO REPORT==== 28-Aug-2008::17:20:13 ===
     application: os_mon
     exited: stopped
     type: temporary
 {error_logger,{{2008,8,28},{17,20,14}},"Protocol: ~p: register
error: ~p~n",["inet_tcp",{{badmatch,{error,duplicate_name}},[{inet_tcp_dist,listen,1},{net_kernel,start_protos,4},{net_kernel,start_protos,3},{net_kernel,init_node,2},{net_kernel,init,1},{gen_server,init_it,6},{proc_lib,init_p,5}]}]}

 {error_logger,{{2008,8,28},{17,20,14}},crash_report,[[{pid,<0.22.0>},{registered_name,net_kernel},{error_info,{exit,{error,badarg},[{gen_server,init_it,6},{proc_lib,init_p,5}]}},{initial_call,{gen,init_it,[gen_server,<0.19.0>,<0.19.0>,{local,net_kernel},net_kernel,{'rabbitmq-9980',shortnames,15000},[]]}},{ancestors,[net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[#Port<0.6>,<0.19.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,377},{stack_size,23},{reductions,521}],[]]}

 {error_logger,{{2008,8,28},{17,20,14}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfa,{net_kernel,start_link,[['rabbitmq-9980',shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}

 {error_logger,{{2008,8,28},{17,20,14}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfa,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}

 {error_logger,{{2008,8,28},{17,20,14}},crash_report,[[{pid,<0.8.0>},{registered_name,[]},{error_info,{exit,{shutdown,{kernel,start,[normal,[]]}},[{application_master,init,4},{proc_lib,init_p,5}]}},{initial_call,{application_master,init,[<0.6.0>,<0.7.0>,{appl_data,kernel,[application_controller,erl_reply,auth,boot_server,code_server,disk_log_server,disk_log_sup,erl_prim_loader,error_logger,file_server_2,fixtable_server,global_group,global_name_server,heart,init,kernel_config,kernel_sup,net_kernel,net_sup,rex,user,os_server,ddll_server,erl_epmd,inet_db,pg2],undefined,{kernel,[]},[application,application_controller,application_master,application_starter,auth,code,code_aux,packages,code_server,dist_util,erl_boot_server,erl_distribution,erl_prim_loader,erl_reply,erlang,error_handler,error_logger,file,file_server,file_io_server,prim_file,global,global_group,global_search,group,heart,hipe_unified_loader,inet6_tcp,inet6_tcp_dist,inet6_udp,inet_config,inet_hosts,inet_gethost_native,inet_tcp_dist,init,kernel,kernel_config,net,net_adm,net_kernel,os,ram_file,rpc,user,user_drv,user_sup,disk_log,disk_log_1,disk_log_server,disk_log_sup,dist_ac,erl_ddll,erl_epmd,erts_debug,gen_tcp,gen_udp,gen_sctp,prim_inet,inet,inet_db,inet_dns,inet_parse,inet_res,inet_tcp,inet_udp,inet_sctp,pg2,seq_trace,wrap_log_reader,zlib,otp_ring0],[],infinity,infinity},normal]}},{ancestors,[<0.7.0>]},{messages,[{'EXIT',<0.9.0>,normal}]},{links,[<0.7.0>,<0.6.0>]},{dictionary,[]},{trap_exit,true},{status,running},{heap_size,610},{stack_size,23},{reductions,127}],[]]}

 {error_logger,{{2008,8,28},{17,20,14}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
 {"Kernel pid terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}

 Crash dump was written to: erl_crash.dump
 Kernel pid terminated (application_controller)
({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})

I'm using the following command to stop the daemon:

 erl -sname rabbitmq_controller -noinput -s rabbit_control -extra -n
rabbitmq-9980 stop

 Aman



From rabbitmq at tmm1.net  Fri Aug 29 07:07:15 2008
From: rabbitmq at tmm1.net (Aman Gupta)
Date: Thu, 28 Aug 2008 23:07:15 -0700
Subject: [rabbitmq-discuss] Gracefully shutting down rabbitmq
In-Reply-To: <e1c05edd0808281810t158a2cawb043a44c57a86e54@mail.gmail.com>
References: <e1c05edd0808281810t158a2cawb043a44c57a86e54@mail.gmail.com>
Message-ID: <e1c05edd0808282307nd4f9754r11833f7f48a497ea@mail.gmail.com>

When I start rabbitmq up afterwards, it takes forever to restore the
mnesia databases:

Logging to "logs/rabbitmq-9580.log"
SASL logging to "rabbitmq-9580-sasl.log"

starting database             ...done
starting core processes       ...done
starting recovery             ...

This can take almost 20 minutes.

  Aman

On Thu, Aug 28, 2008 at 6:10 PM, Aman Gupta <rabbitmq at tmm1.net> wrote:
> I'm getting errors whenever I try to shut down rabbitmq gracefully:
>
>  =INFO REPORT==== 28-Aug-2008::17:20:13 ===
>  node 'control_rabbitmq-9980 at localhost' up
>  =INFO REPORT==== 28-Aug-2008::17:20:13 ===
>  Stop-and-halt request received; halting in 1000 milliseconds
>
>  =INFO REPORT==== 28-Aug-2008::17:20:13 ===
>  stopped TCP listener on 127.0.0.1:9980
>
>  =INFO REPORT==== 28-Aug-2008::17:20:13 ===
>  closing TCP connection <0.3408.0> from 127.0.0.1:39084
>
>  =INFO REPORT==== 28-Aug-2008::17:20:13 ===
>  closing TCP connection <0.3407.0> from 127.0.0.1:39083
>
>  =INFO REPORT==== 28-Aug-2008::17:20:13 ===
>     application: rabbit
>     exited: stopped
>     type: temporary
>
>  =INFO REPORT==== 28-Aug-2008::17:20:13 ===
>     application: mnesia
>     exited: stopped
>     type: temporary
>
>  =INFO REPORT==== 28-Aug-2008::17:20:13 ===
>     application: os_mon
>     exited: stopped
>     type: temporary
>  {error_logger,{{2008,8,28},{17,20,14}},"Protocol: ~p: register
> error: ~p~n",["inet_tcp",{{badmatch,{error,duplicate_name}},[{inet_tcp_dist,listen,1},{net_kernel,start_protos,4},{net_kernel,start_protos,3},{net_kernel,init_node,2},{net_kernel,init,1},{gen_server,init_it,6},{proc_lib,init_p,5}]}]}
>
>  {error_logger,{{2008,8,28},{17,20,14}},crash_report,[[{pid,<0.22.0>},{registered_name,net_kernel},{error_info,{exit,{error,badarg},[{gen_server,init_it,6},{proc_lib,init_p,5}]}},{initial_call,{gen,init_it,[gen_server,<0.19.0>,<0.19.0>,{local,net_kernel},net_kernel,{'rabbitmq-9980',shortnames,15000},[]]}},{ancestors,[net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[#Port<0.6>,<0.19.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,377},{stack_size,23},{reductions,521}],[]]}
>
>  {error_logger,{{2008,8,28},{17,20,14}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfa,{net_kernel,start_link,[['rabbitmq-9980',shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
>
>  {error_logger,{{2008,8,28},{17,20,14}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfa,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
>
>  {error_logger,{{2008,8,28},{17,20,14}},crash_report,[[{pid,<0.8.0>},{registered_name,[]},{error_info,{exit,{shutdown,{kernel,start,[normal,[]]}},[{application_master,init,4},{proc_lib,init_p,5}]}},{initial_call,{application_master,init,[<0.6.0>,<0.7.0>,{appl_data,kernel,[application_controller,erl_reply,auth,boot_server,code_server,disk_log_server,disk_log_sup,erl_prim_loader,error_logger,file_server_2,fixtable_server,global_group,global_name_server,heart,init,kernel_config,kernel_sup,net_kernel,net_sup,rex,user,os_server,ddll_server,erl_epmd,inet_db,pg2],undefined,{kernel,[]},[application,application_controller,application_master,application_starter,auth,code,code_aux,packages,code_server,dist_util,erl_boot_server,erl_distribution,erl_prim_loader,erl_reply,erlang,error_handler,error_logger,file,file_server,file_io_server,prim_file,global,global_group,global_search,group,heart,hipe_unified_loader,inet6_tcp,inet6_tcp_dist,inet6_udp,inet_config,inet_hosts,inet_gethost_native,inet_tcp_dist,init,kernel,kernel_config,net,net_adm,net_kernel,os,ram_file,rpc,user,user_drv,user_sup,disk_log,disk_log_1,disk_log_server,disk_log_sup,dist_ac,erl_ddll,erl_epmd,erts_debug,gen_tcp,gen_udp,gen_sctp,prim_inet,inet,inet_db,inet_dns,inet_parse,inet_res,inet_tcp,inet_udp,inet_sctp,pg2,seq_trace,wrap_log_reader,zlib,otp_ring0],[],infinity,infinity},normal]}},{ancestors,[<0.7.0>]},{messages,[{'EXIT',<0.9.0>,normal}]},{links,[<0.7.0>,<0.6.0>]},{dictionary,[]},{trap_exit,true},{status,running},{heap_size,610},{stack_size,23},{reductions,127}],[]]}
>
>  {error_logger,{{2008,8,28},{17,20,14}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
>  {"Kernel pid terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}
>
>  Crash dump was written to: erl_crash.dump
>  Kernel pid terminated (application_controller)
> ({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})
>
> I'm using the following command to stop the daemon:
>
>  erl -sname rabbitmq_controller -noinput -s rabbit_control -extra -n
> rabbitmq-9980 stop
>
>  Aman
>



From 0x6e6562 at gmail.com  Fri Aug 29 09:02:43 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Fri, 29 Aug 2008 09:02:43 +0100
Subject: [rabbitmq-discuss] Gracefully shutting down rabbitmq
In-Reply-To: <e1c05edd0808281810t158a2cawb043a44c57a86e54@mail.gmail.com>
References: <e1c05edd0808281810t158a2cawb043a44c57a86e54@mail.gmail.com>
Message-ID: <269388e30808290102l568673c2t22d0057ed7ff4c8c@mail.gmail.com>

Hey Aman,

On Fri, Aug 29, 2008 at 2:10 AM, Aman Gupta <rabbitmq at tmm1.net> wrote:
>  {error_logger,{{2008,8,28},{17,20,14}},"Protocol: ~p: register
> error: ~p~n",["inet_tcp",{{badmatch,{error,duplicate_name}},[{inet_tcp_dist,listen,1},{net_kernel,start_protos,4},{net_kernel,start_protos,3},{net_kernel,init_node,2},{net_kernel,init,1},{gen_server,init_it,6},{proc_lib,init_p,5}]}]}

On initial perusal you would think that there are two Erlang nodes
with the same name.

Having said that, and given your setup, I'm wondering how this is possible.

Are you able to reproduce this reliably by re-running the shutdown command?

Cheers,

Ben



From rabbitmq at tmm1.net  Fri Aug 29 09:04:56 2008
From: rabbitmq at tmm1.net (Aman Gupta)
Date: Fri, 29 Aug 2008 01:04:56 -0700
Subject: [rabbitmq-discuss] Gracefully shutting down rabbitmq
In-Reply-To: <269388e30808290102l568673c2t22d0057ed7ff4c8c@mail.gmail.com>
References: <e1c05edd0808281810t158a2cawb043a44c57a86e54@mail.gmail.com>
	<269388e30808290102l568673c2t22d0057ed7ff4c8c@mail.gmail.com>
Message-ID: <e1c05edd0808290104m1275719dv8f90920423453d96@mail.gmail.com>

I am only running one rabbitmq node. When I want to shutdown, I run
another node named rabbitmq_controller to send rabbitmq the shutdown
command. Rabbit gets the command, starts the shutdown process and then
fails with that error.

This happens everytime I try to shutdown.

  Aman

On Fri, Aug 29, 2008 at 1:02 AM, Ben Hood <0x6e6562 at gmail.com> wrote:
> Hey Aman,
>
> On Fri, Aug 29, 2008 at 2:10 AM, Aman Gupta <rabbitmq at tmm1.net> wrote:
>>  {error_logger,{{2008,8,28},{17,20,14}},"Protocol: ~p: register
>> error: ~p~n",["inet_tcp",{{badmatch,{error,duplicate_name}},[{inet_tcp_dist,listen,1},{net_kernel,start_protos,4},{net_kernel,start_protos,3},{net_kernel,init_node,2},{net_kernel,init,1},{gen_server,init_it,6},{proc_lib,init_p,5}]}]}
>
> On initial perusal you would think that there are two Erlang nodes
> with the same name.
>
> Having said that, and given your setup, I'm wondering how this is possible.
>
> Are you able to reproduce this reliably by re-running the shutdown command?
>
> Cheers,
>
> Ben
>



From james at reasonablysmart.com  Fri Aug 29 14:16:59 2008
From: james at reasonablysmart.com (James A. Duncan)
Date: Fri, 29 Aug 2008 09:16:59 -0400
Subject: [rabbitmq-discuss] Stomp
Message-ID: <EDD8F125-FF98-4482-B78D-455E05004B90@reasonablysmart.com>

Hello list,

Is there any concise documentation anywhere on how to configure the  
queue through Stomp? Particularly I'm looking to set up exchanges and  
topics...

I've seen veiled references to various configuration bits and pieces  
all over the place, but I'm trying to use RabbitMQ in a situation  
where primarily I'm going to be using Leon Brocard's excellent  
Net::Stomp Perl module, and I'm struggling to find any solid  
references as to how to do this.

Any pointers as to where to look appreciated.

Regards,
James.




From 0x6e6562 at gmail.com  Fri Aug 29 14:20:29 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Fri, 29 Aug 2008 14:20:29 +0100
Subject: [rabbitmq-discuss] Gracefully shutting down rabbitmq
In-Reply-To: <e1c05edd0808290104m1275719dv8f90920423453d96@mail.gmail.com>
References: <e1c05edd0808281810t158a2cawb043a44c57a86e54@mail.gmail.com>
	<269388e30808290102l568673c2t22d0057ed7ff4c8c@mail.gmail.com>
	<e1c05edd0808290104m1275719dv8f90920423453d96@mail.gmail.com>
Message-ID: <269388e30808290620k7d04542ah5218dd5a02a50e26@mail.gmail.com>

Aman,

On Fri, Aug 29, 2008 at 9:04 AM, Aman Gupta <rabbitmq at tmm1.net> wrote:
> I am only running one rabbitmq node. When I want to shutdown, I run
> another node named rabbitmq_controller to send rabbitmq the shutdown
> command. Rabbit gets the command, starts the shutdown process and then
> fails with that error.
>
> This happens everytime I try to shutdown.

OK, I'll have a look into that.

As side issue, can you be more specific about what part of the process
is actually taking 20 mins?

You wrote:

>Logging to "logs/rabbitmq-9580.log"
>SASL logging to "rabbitmq-9580-sasl.log"
>
>starting database             ...done
>starting core processes       ...done
>starting recovery             ...
>
>This can take almost 20 minutes.

I assume from your output that the 20 min wait is for the recovery
phase. During this phase, all of the durable exchanges and queues are
recovered. Do you know how many of each do you have? Also, did you
intend to have so many durable objects, bearing in mind the cost of
maintaining them?

HTH,

Ben



From sky at crucially.net  Fri Aug 29 15:39:34 2008
From: sky at crucially.net (Artur Bergman)
Date: Fri, 29 Aug 2008 07:39:34 -0700
Subject: [rabbitmq-discuss] Stomp
In-Reply-To: <EDD8F125-FF98-4482-B78D-455E05004B90@reasonablysmart.com>
References: <EDD8F125-FF98-4482-B78D-455E05004B90@reasonablysmart.com>
Message-ID: <41C0F452-452C-4465-91CE-0038AF510264@crucially.net>

There is a patch to the stomp gateway that implements topic selectors


Sent from my iPhone

On Aug 29, 2008, at 6:16 AM, "James A. Duncan" <james at reasonablysmart.com 
 > wrote:

> Hello list,
>
> Is there any concise documentation anywhere on how to configure the
> queue through Stomp? Particularly I'm looking to set up exchanges and
> topics...
>
> I've seen veiled references to various configuration bits and pieces
> all over the place, but I'm trying to use RabbitMQ in a situation
> where primarily I'm going to be using Leon Brocard's excellent
> Net::Stomp Perl module, and I'm struggling to find any solid
> references as to how to do this.
>
> Any pointers as to where to look appreciated.
>
> Regards,
> James.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



From ryan.pratt at gmail.com  Fri Aug 29 23:17:20 2008
From: ryan.pratt at gmail.com (Ryan Pratt)
Date: Fri, 29 Aug 2008 17:17:20 -0500
Subject: [rabbitmq-discuss] performance
Message-ID: <f9d1f3560808291517x41ab377cq3a8d82b0577496d5@mail.gmail.com>

I have been running some small performance tests and have not seen the
throughput I was expecting. I want to see if my numbers are similar to what
others have seen, or if something else (setup, etc) is causing my
performance to be not so good.

I have a single broker running with a sender and receiver all on the same
machine. The machine is a dual quad core 2.66 GHz Xeon with 8 gigs of
memory. I have to throttle the sender to keep the queue from backing way up,
which then causes the broker to basically go to a crawl. The sender sends 40
messages then sleeps for 5 millseconds, and loops doing this continually. If
a run a receiver that continuously calls basicGet I am seeing a max of about
4000 messages per second. The message I am sending is "Hello, World!"
If I add a second Receiver on the same queue I end up getting it up to about
6000 messages per second. 3 Receivers is about the same as 2. Maybe my
expectations are off but I was hoping to see at least 20000 messages per
second going through. The sender and receiver code is attached. Is there
anything obviously wrong with my setup, or is this throughput what I should
expect to see? Thanks

package com.optionshouse.test;

import java.io.IOException;
import com.rabbitmq.client.*;
import com.rabbitmq.client.Channel;
import com.rabbitmq.client.AMQP;
import java.util.*;

public class TestSender {

    public static boolean doStop = false;

    public static void main(String[] args) {

        try {
                ConnectionParameters params = new ConnectionParameters();
                params.setUsername("guest");
                params.setPassword("guest");
                params.setVirtualHost("/");
                params.setRequestedHeartbeat(0);
                ConnectionFactory factory = new ConnectionFactory(params);
                Connection conn = factory.newConnection("localhost", 5672);

                Channel channel = conn.createChannel();
                int ticket = channel.accessRequest("/data");
                channel.exchangeDeclare(ticket, "TEST", "direct");
                channel.queueDeclare(ticket, "action.test");
                channel.queueBind(ticket, "action.test", "TEST",
"action.test");

                byte[] messageBodyBytes = "Hello, world!".getBytes();
int counter = 0;
                while (!doStop) {
                    channel.basicPublish(ticket, "TEST", "action.test",
null, messageBodyBytes);
                    counter++;

                    if (counter == 30) {
                    try {
                        counter = 0;
                        Thread.sleep(5);
                    }
                    catch (InterruptedException ex) {
                        ex.printStackTrace();
                    }
                    }
                }

        }
        catch (IOException ex) {
            ex.printStackTrace();
        }
    }

}
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080829/29198ebe/attachment.htm 

From ryan.pratt at gmail.com  Fri Aug 29 23:20:03 2008
From: ryan.pratt at gmail.com (Ryan Pratt)
Date: Fri, 29 Aug 2008 17:20:03 -0500
Subject: [rabbitmq-discuss] performance
In-Reply-To: <f9d1f3560808291517x41ab377cq3a8d82b0577496d5@mail.gmail.com>
References: <f9d1f3560808291517x41ab377cq3a8d82b0577496d5@mail.gmail.com>
Message-ID: <f9d1f3560808291520m6a8aff82y24ce0cae6d209659@mail.gmail.com>

...and the receiver code is:

package com.optionshouse.test;

import java.io.IOException;

import com.rabbitmq.client.*;
import com.rabbitmq.client.Channel;
import com.rabbitmq.client.AMQP;


public class TestReceiver {

    public static boolean doStop = false;

    public static void main(String[] args) {

        try {
            ConnectionParameters params = new ConnectionParameters();
            params.setUsername("guest");
            params.setPassword("guest");
            params.setVirtualHost("/");
            params.setRequestedHeartbeat(0);
            ConnectionFactory factory = new ConnectionFactory(params);
            Connection conn = factory.newConnection("localhost", 5672);

            Channel channel = conn.createChannel();
            int ticket = channel.accessRequest("/data");

            channel.exchangeDeclare(ticket, "TEST", "direct");
            channel.queueDeclare(ticket, "action.test");
            long count = 0;
            long start = 0;
            while (!doStop) {
                boolean noAck = false;
                GetResponse response = channel.basicGet(ticket,
"action.test", true);
                if (response == null) {

                } else {
                    if (start == 0)
                        start = System.currentTimeMillis();
                    else{
                        count++;
                        if (count % 1000 == 0) {
                            long now = System.currentTimeMillis();
                            double tis = (now-start)/1000d;
                            System.out.println("count:"+count+", tis:
"+tis+", MPS: "+(count/tis));
                        }
                    }
                    AMQP.BasicProperties props = response.getProps();
                    byte[] body = response.getBody();
                    long deliveryTag =
response.getEnvelope().getDeliveryTag();
                    //channel.basicAck(deliveryTag, false);
                }
            }
        }
        catch (IOException ex) {
            ex.printStackTrace();
        }
    }

}

On Fri, Aug 29, 2008 at 5:17 PM, Ryan Pratt <ryan.pratt at gmail.com> wrote:

> I have been running some small performance tests and have not seen the
> throughput I was expecting. I want to see if my numbers are similar to what
> others have seen, or if something else (setup, etc) is causing my
> performance to be not so good.
>
> I have a single broker running with a sender and receiver all on the same
> machine. The machine is a dual quad core 2.66 GHz Xeon with 8 gigs of
> memory. I have to throttle the sender to keep the queue from backing way up,
> which then causes the broker to basically go to a crawl. The sender sends 40
> messages then sleeps for 5 millseconds, and loops doing this continually. If
> a run a receiver that continuously calls basicGet I am seeing a max of about
> 4000 messages per second. The message I am sending is "Hello, World!"
> If I add a second Receiver on the same queue I end up getting it up to
> about 6000 messages per second. 3 Receivers is about the same as 2. Maybe my
> expectations are off but I was hoping to see at least 20000 messages per
> second going through. The sender and receiver code is attached. Is there
> anything obviously wrong with my setup, or is this throughput what I should
> expect to see? Thanks
>
> package com.optionshouse.test;
>
> import java.io.IOException;
> import com.rabbitmq.client.*;
> import com.rabbitmq.client.Channel;
> import com.rabbitmq.client.AMQP;
> import java.util.*;
>
> public class TestSender {
>
>     public static boolean doStop = false;
>
>     public static void main(String[] args) {
>
>         try {
>                 ConnectionParameters params = new ConnectionParameters();
>                 params.setUsername("guest");
>                 params.setPassword("guest");
>                 params.setVirtualHost("/");
>                 params.setRequestedHeartbeat(0);
>                 ConnectionFactory factory = new ConnectionFactory(params);
>                 Connection conn = factory.newConnection("localhost", 5672);
>
>                 Channel channel = conn.createChannel();
>                 int ticket = channel.accessRequest("/data");
>                 channel.exchangeDeclare(ticket, "TEST", "direct");
>                 channel.queueDeclare(ticket, "action.test");
>                 channel.queueBind(ticket, "action.test", "TEST",
> "action.test");
>
>                 byte[] messageBodyBytes = "Hello, world!".getBytes();
> int counter = 0;
>                 while (!doStop) {
>                     channel.basicPublish(ticket, "TEST", "action.test",
> null, messageBodyBytes);
>                     counter++;
>
>                     if (counter == 30) {
>                     try {
>                         counter = 0;
>                         Thread.sleep(5);
>                     }
>                     catch (InterruptedException ex) {
>                         ex.printStackTrace();
>                     }
>                     }
>                 }
>
>         }
>         catch (IOException ex) {
>             ex.printStackTrace();
>         }
>     }
>
> }
>
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080829/8ca3b38b/attachment.htm 

From matthias at lshift.net  Fri Aug 29 23:29:06 2008
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 29 Aug 2008 23:29:06 +0100
Subject: [rabbitmq-discuss] performance
In-Reply-To: <f9d1f3560808291517x41ab377cq3a8d82b0577496d5@mail.gmail.com>
References: <f9d1f3560808291517x41ab377cq3a8d82b0577496d5@mail.gmail.com>
Message-ID: <48B87832.90903@lshift.net>

Ryan,

Ryan Pratt wrote:
> If a run a receiver that continuously calls basicGet I am seeing a
> max of about 4000 messages per second. [...] I was hoping to see at
> least 20000 messages per second going through.

Instead of pulling messages one-by-one using basicGet, create a 
subscription with basicConsume. That will give better results.

 > The machine is a dual quad core 2.66 GHz Xeon

What CPU utilisation are you seeing?

Also, what OS are you on and what version of Erlang/OTP are you running?


Matthias.



From petedao at gmail.com  Sat Aug 30 03:34:47 2008
From: petedao at gmail.com (Pete Kay)
Date: Sat, 30 Aug 2008 10:34:47 +0800
Subject: [rabbitmq-discuss] Urgently Need help to get RabbitMQ publishing to
	Flex-based subscriber
Message-ID: <7aa8bd9d0808291934l19d9c70atd7822677f904d1da@mail.gmail.com>

Hi,

I am sorry for emailing my question a few times.  I need to get Flex to
successful establish connection with RabbitMQ inside my Flex application in
order to position the use of RabbitMQ in our application.  I can establish a
AMPQ to AMPQ connection using Java client for both publisher and subscriber,
but I am not able to use Flex as the subscriber.  I know I may try using FM3
to act as the subscriber, but I still think the best and most straight
forward solution is to have Flex client to subscribe directly to RabbitMQ.

RabbitMQ.log says:

*error on TCP connection <0.8716.0> from 192.168.1.100:50021*
*{handshake_timeout,frame_**header}*


Here is my code, could someone help me to find out what is wrong?


<?xml version="1.0" encoding="utf-8"?>
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml"
    layout="absolute" styleName="plain"  creationComplete="init()">
  <mx:Script>
        <![CDATA[
     import org.amqp.patterns.impl.SubscribeClientImpl;
        import org.amqp.patterns.SubscribeClient;
       import org.amqp.Connection;
      import org.amqp.ConnectionState;
     import org.amqp.patterns.CorrelatedMessageEvent;
  import org.amqp.ProtocolEvent;
     import org.amqp.Session;
     import org.amqp.SessionManager;
        import org.amqp.impl.SessionStateHandler;
        private var subClient:SubscribeClientImpl;
        protected var connection:Connection;

   private var serializer:JSONSerializer = new JSONSerializer();
        public function init():void {
   trace("test sub init");
            connection = new Connection(buildConnectionState());
            subClient = new SubscribeClientImpl(connection);
*   subClient.serializer = serializer;
//   subClient.realm = "/data";
   subClient.exchange = "gamex";
   subClient.exchangeType = "topic";
   sub.subscribe("SimpleQueue",onMessageArrive);*
        }
    public function buildConnectionState():ConnectionState {
            var state:ConnectionState = new ConnectionState();
            state.username = "guest";
            state.password = "guest";
            state.vhostpath = "/";
            state.serverhost = "192.168.1.104";
            return state;
        }

        public function onMessageArrive(event:CorrelatedMessageEvent):void {
            var o:* = event.result;
        }
     ]]>
    </mx:Script>
</mx:Application>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080830/d8d99c74/attachment.htm 

From matthias at lshift.net  Sat Aug 30 10:13:07 2008
From: matthias at lshift.net (Matthias Radestock)
Date: Sat, 30 Aug 2008 10:13:07 +0100
Subject: [rabbitmq-discuss] performance
In-Reply-To: <f9d1f3560808291551m584053cbqd92ca3788f38a01d@mail.gmail.com>
References: <f9d1f3560808291517x41ab377cq3a8d82b0577496d5@mail.gmail.com>	<48B87832.90903@lshift.net>
	<f9d1f3560808291551m584053cbqd92ca3788f38a01d@mail.gmail.com>
Message-ID: <48B90F23.8060609@lshift.net>

Ryan,

Ryan Pratt wrote:
> On Fri, Aug 29, 2008 at 5:29 PM, Matthias Radestock <matthias at lshift.net 
> <mailto:matthias at lshift.net>> wrote:
>     Instead of pulling messages one-by-one using basicGet, create a
>     subscription with basicConsume. That will give better results.
> 
> I can't for the use case I am testing for. The case is multiple servers 
> receiving on the same queues. I want less active servers to receive more 
> messages than the active ones for load balancing. My understanding is 
> that consumers are simply round robin, even if some of the servers in 
> the mix are having trouble keeping up.

The server does in fact detects slower consumers and sends them fewer 
messages. This throttling logic is quite crude though and probably too 
coarse-grained for your requirements.

Finer-grained flow control for subscriptions will be possible once we 
implement basic.qos. TBH though I doubt it's going to perform any better 
than basicGet.

>      > The machine is a dual quad core 2.66 GHz Xeon
> 
>     What CPU utilisation are you seeing?
> 
> About  60-70%

How is that distributed between your Java clients and the RabbitMQ broker?

> I have tried adding more processes to the mix (more queues as well as 
> same queue) but get basically the same results.

How many connections and channels are your tests using?

Try running the MulticastMain example that ships with the Java client. 
By default, i.e. w/o setting any of the command line flags/options, this 
will create one producer and one consumer in non-auto-ack mode, send 
messages as fast as it can and report on throughput and latency. You can 
use the "-r" flag to limit the sending rate and prevent messages from 
backing up at the broker.

While this test uses basicConsume rather than basicGet, it will 
nevertheless give you a good idea about the performance and, more 
importantly, I can compare the results against what we are seeing on 
some of our test machines.

>     Also, what OS are you on and what version of Erlang/OTP are you running?
> 
> I am on CentOS 5 running erlang 5.6.3

Some testing we did in the past indicates that generally a clustered 
broker - with one node per core and smp disabled for the Erlang VM - 
performs significantly better than a single smp-enabled node.


Matthias.



From 0x6e6562 at gmail.com  Sat Aug 30 11:33:46 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Sat, 30 Aug 2008 11:33:46 +0100
Subject: [rabbitmq-discuss] Urgently Need help to get RabbitMQ
	publishing to Flex-based subscriber
In-Reply-To: <7aa8bd9d0808291934l19d9c70atd7822677f904d1da@mail.gmail.com>
References: <7aa8bd9d0808291934l19d9c70atd7822677f904d1da@mail.gmail.com>
Message-ID: <269388e30808300333s7e99ab7y78f6ed771862ba2a@mail.gmail.com>

Hi Anne,

On Sat, Aug 30, 2008 at 3:34 AM, Pete Kay <petedao at gmail.com> wrote:
> I am sorry for emailing my question a few times.  I need to get Flex to

You question from yesterday hasn't been forgotten :-)

> successful establish connection with RabbitMQ inside my Flex application in
> order to position the use of RabbitMQ in our application.  I can establish a
> AMPQ to AMPQ connection using Java client for both publisher and subscriber,
> but I am not able to use Flex as the subscriber.  I know I may try using FM3
> to act as the subscriber, but I still think the best and most straight
> forward solution is to have Flex client to subscribe directly to RabbitMQ.

Off the top of my head I don't know what is going wrong in your setup,
so I will investigate this, but I also have lots of other Rabbit
questions to follow up on as well, so being a limited resource, I'm
trying to spread things around fairly.

Thanks for your patience,

Ben



From rabbitmq-discuss_efine at usa.net  Sat Aug 30 22:31:39 2008
From: rabbitmq-discuss_efine at usa.net (Edwin Fine)
Date: Sat, 30 Aug 2008 17:31:39 -0400
Subject: [rabbitmq-discuss] performance
In-Reply-To: <48B90F23.8060609@lshift.net>
References: <f9d1f3560808291517x41ab377cq3a8d82b0577496d5@mail.gmail.com>
	<48B87832.90903@lshift.net>
	<f9d1f3560808291551m584053cbqd92ca3788f38a01d@mail.gmail.com>
	<48B90F23.8060609@lshift.net>
Message-ID: <6c2563b20808301431qcc1c63cp8c36c790ed539ec9@mail.gmail.com>

>
>
> Some testing we did in the past indicates that generally a clustered
> broker - with one node per core and smp disabled for the Erlang VM -
> performs significantly better than a single smp-enabled node.
>

Now *that* is very interesting. I have seen the same kind of thing in some
ad-hoc (non-RabbitMQ related) experiments I did some time back (better
performance from multiple VMs, each in single-cpu configuration, on a
multi-core system) and thought it was my imagination because SMP was
supposed to be the way to go. I haven't seen much discussion on this on the
erlang-questions mailing lists, and quite frankly, I'm not going to start
one without some solid, repeatable evidence. If you have seen this behavior,
have you brought it up with the Erlang gurus, and if so, have they said
anything enlightening about it?

Some products, like Informix, allow the pinning of virtual processors to
individual CPUs (processor affinity) for fine-grained performance control.
Informix supports this on Linux. I don't believe Erlang supports this on any
platform. It may be advantageous to add this feature to Erlang's VM. What's
your take on this?

BTW, this link made for interesting reading:

http://www.erlang.org/pipermail/erlang-questions/2008-January/032273.html

Regards,
Edwin Fine
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080830/83e5c7fa/attachment.htm 

From rabbitmq-discuss_efine at usa.net  Sun Aug 31 00:26:01 2008
From: rabbitmq-discuss_efine at usa.net (Edwin Fine)
Date: Sat, 30 Aug 2008 19:26:01 -0400
Subject: [rabbitmq-discuss] Linux processor affinity and C code
In-Reply-To: <6c2563b20808301624u60385da6n5777ea911d6b0eaf@mail.gmail.com>
References: <6c2563b20808301624u60385da6n5777ea911d6b0eaf@mail.gmail.com>
Message-ID: <6c2563b20808301626v7114b8a8t8ebb9c8f719b9260@mail.gmail.com>

With regards to RabbitMQ performance and my previous post, I found some C
code from Linux Journal that sets the processor affinity mask for an already
running Linux OS process from the command line. I modified the code a bit to
work with the most recent Linux APIs and to have a slightly more intuitive
user interface.

Link to unmodified code:
http://www.linuxjournal.com/files/linuxjournal.com/linuxjournal/articles/067/6799/6799l1.html

Example:

efine at ender:~/linux$ ./bindcpu 6609 1000
New mask to be applied: 1000
pid 6609's old affinity: 1111
pid 6609's new affinity: 1000

In the above example, I modified the affinity of an Erlang process that was
started with +S 1. The old affinity allowed it to run on any of the 4 CPUs
on my system. The new one allows it to run only on CPU 3. The mask is a bit
string that lets you specify the affinity for up to 1024 processors by
specifying a '1' in the corresponding bit position. Bit 0 is the rightmost
position in the string. I verified using 'top' that I could change the CPU
on which the beam VM ran, even while it was executing code.

On an 8-core system, one could conceivably leave processor 0 for the OS, and
perhaps reserve processors 1 through 4 for clustered RabbitMQ Erlang VMs and
the rest for other apps. One additional trick that one can use (disclaimer:
VERY carefully! I haven't tried it with Erlang and one could really mess up
one's system) is to raise the priority of the Erlang VM Linux (OS) processes
so that they preempt less important processes and therefore effectively
"reserve" the affinitied CPUs for themselves. I've seen this approach used
in a major US telecomms IT department to maximize database performance, but
the database processes were designed to be used like that, hence my caution.

Anyone interested in seeing if there are RabbitMQ performance improvements
by doing this? I'd be happy to post the code (which is very short, 125 lines
of C). Otherwise I will play around with it on non-RabbitMQ code as time
permits.

Regards,
Edwin Fine
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080830/72b797b6/attachment.htm 

From petedao at gmail.com  Sun Aug 31 11:06:38 2008
From: petedao at gmail.com (Pete Kay)
Date: Sun, 31 Aug 2008 18:06:38 +0800
Subject: [rabbitmq-discuss] Urgently Need help to get RabbitMQ
	publishing to Flex-based subscriber
In-Reply-To: <269388e30808300333s7e99ab7y78f6ed771862ba2a@mail.gmail.com>
References: <7aa8bd9d0808291934l19d9c70atd7822677f904d1da@mail.gmail.com>
	<269388e30808300333s7e99ab7y78f6ed771862ba2a@mail.gmail.com>
Message-ID: <7aa8bd9d0808310306w44e2bbabk3f9c25a6e34e8261@mail.gmail.com>

Dear Ben,

Thank you so much for helping out.

I will wait for your reply.

Best Regards,
Anne
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080831/cc12f415/attachment.htm 

From fingermark at gmail.com  Sun Aug 31 20:34:56 2008
From: fingermark at gmail.com (bradford)
Date: Sun, 31 Aug 2008 15:34:56 -0400
Subject: [rabbitmq-discuss] EOFException when messages in queue
Message-ID: <7fa430270808311234q24956417p66124eeea161a9d0@mail.gmail.com>

I'm running the AMQPExampleFunPack.actorExample scala example from:
http://github.com/dpp/liftweb/tree/master/lift-amqp/src/main/scala/net/liftweb/amqp/AMQPSender.scala

It was working great until I shutdown the client listeners and
RabbitMQ queued up 2 messages.  Now when I run the
AMQPExampleFunPack.actorExample scala example I get an EOFException.
My questions are 1) is it possible to clear a queue ("routeroute") in
RabbitMQ w/o writing code for it?  2) Is there anything obvious I need
to do to fix the exception, in the event that messages queue up in the
future?

[WARNING] Consumer com.newpers.amqp.SerializedConsumer at 337d0f method
handleDelivery for channel
AMQChannel(amqp://guest at 192.168.2.1:5672/,1) threw an exception:
[WARNING] java.io.EOFException
[WARNING]       at
java.io.ObjectInputStream$PeekInputStream.readFully(ObjectInputStream.java:2281)
[WARNING]       at
java.io.ObjectInputStream$BlockDataInputStream.readShort(ObjectInputStream.java:2750)
[WARNING]       at
java.io.ObjectInputStream.readStreamHeader(ObjectInputStream.java:780)
[WARNING]       at java.io.ObjectInputStream.<init>(ObjectInputStream.java:280)
[WARNING]       at
com.newpers.amqp.SerializedConsumer.handleDelivery(AMQPDispatcher.scala:105)
[WARNING]       at
com.rabbitmq.client.impl.ChannelN.processAsync(ChannelN.java:189)
[WARNING]       at
com.rabbitmq.client.impl.AMQChannel.handleCompleteInboundCommand(AMQChannel.java:146)
[WARNING]       at
com.rabbitmq.client.impl.AMQChannel.handleFrame(AMQChannel.java:101)
[WARNING]       at
com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:440)



From eran.sandler at gmail.com  Sun Aug 31 20:48:24 2008
From: eran.sandler at gmail.com (Eran Sandler)
Date: Sun, 31 Aug 2008 22:48:24 +0300
Subject: [rabbitmq-discuss] Running RabbitMQ as a Windows Service - Having
	some problems
Message-ID: <48BAF588.2030802@gmail.com>

Hello all,


First time on the mailing list :-) I think RabbitMQ is great but I have
a small problem running it as a Windows service.


I've tried numerous ways of running RabbitMQ as a Windows service on
Windows 2003.


I've used erlsrv.exe with the following command:

erlsrv add rabbitmq_messagequeue -sname rabbit -args "-mnesia dir
'\"C:/RabbitMQ/db/rabbit-mnesia\"' -boot start_sasl -s rabbit -sasl
errlog_type error"


The service runs but rabbitmq isn't running if I run "rabbitmqctrl.bat
status". I tried passing the rest of the arguments such as the log file
location etc but that makes the service not run.


Any ideas?


Thanks in advance,

Eran
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080831/28c64d26/attachment.htm 

