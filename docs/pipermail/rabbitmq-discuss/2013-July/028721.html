<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] blocked producers
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20blocked%20producers&In-Reply-To=%3CCABz1xsUiWuwYvzgXxJE2wqCRVpF1R10gLZ6%3DhVU0aE0nfeW4tA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="028688.html">
   <LINK REL="Next"  HREF="028757.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] blocked producers</H1>
    <B>Thierry Thelliez</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20blocked%20producers&In-Reply-To=%3CCABz1xsUiWuwYvzgXxJE2wqCRVpF1R10gLZ6%3DhVU0aE0nfeW4tA%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] blocked producers">thierry.thelliez.tech at gmail.com
       </A><BR>
    <I>Sat Jul 20 00:12:40 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="028688.html">[rabbitmq-discuss] blocked producers
</A></li>
        <LI>Next message: <A HREF="028757.html">[rabbitmq-discuss] blocked producers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28721">[ date ]</a>
              <a href="thread.html#28721">[ thread ]</a>
              <a href="subject.html#28721">[ subject ]</a>
              <a href="author.html#28721">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Interesting discussion.   I am new to RabbitMQ and I am trying to
understand the coding and architecture requirements on the Producer side.

What happens if the Producer cannot push to a queue?  Does that mean that
the Producer system should plan for its own local queue until the broker is
back?  What do you do in production when you do not want to loose these
messages?


Thanks,
Thierry



On Thu, Jul 18, 2013 at 4:19 PM, Michael Klishin &lt;
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">michael.s.klishin at gmail.com</A>&gt; wrote:

&gt;<i> 2013/7/19 Kobi Biton &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">kbiton at outbrain.com</A>&gt;
</I>&gt;<i>
</I>&gt;&gt;<i>  this is to our understanding
</I>&gt;&gt;<i> in order to protect the broker and the consumer as the producers are
</I>&gt;&gt;<i> faster then the consumer ?
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Yes, because messages have certain RAM cost.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> The problem is that at some point (when the READY messages count is high
</I>&gt;&gt;<i> ~ 1M)  rabbitmq blocks most of our producers and does not seem to release
</I>&gt;&gt;<i> them , until we restart them (logstash daemon) on every one of them , we
</I>&gt;&gt;<i> tried purging the queue / restarting rabbitmq , only restarting the
</I>&gt;&gt;<i> producers seems to bring things to normal state.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> It's driven by memory watermark and/or available disk space. See
</I>&gt;<i>
</I>&gt;<i> <A HREF="http://www.rabbitmq.com/memory.html">http://www.rabbitmq.com/memory.html</A>
</I>&gt;<i>
</I>&gt;<i> RabbitMQ log should make it clear what limit (RAM or disk) was reached.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I guess my questions are:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  - Is my problem on the consumer side ? I am unable to debug the consumer
</I>&gt;&gt;<i> speed or state
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Yes, consumers do not keep up. Try with a larger number of them.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i>  - Can I tune rabbitmq for lots of connections and high message rate?
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> It's not really about the number of connections or message rates. See
</I>&gt;<i> <A HREF="http://www.rabbitmq.com/memory.html">http://www.rabbitmq.com/memory.html</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i>  - We use fanout exchange , when a consumer creates a new queue under
</I>&gt;&gt;<i> this exchange and does not consume fast enough can he effect the producers
</I>&gt;&gt;<i> from the other queue (i.e cause them to be blocked?)
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> All connections that attempt to publish anything when one of the limits is
</I>&gt;<i> hit
</I>&gt;<i> will be throttled.
</I>&gt;<i>
</I>&gt;<i> You can reduce RAM footprint of individual messages by using
</I>&gt;<i> <A HREF="https://github.com/rabbitmq/rabbitmq-toke">https://github.com/rabbitmq/rabbitmq-toke</A>
</I>&gt;<i> which stores message index in Tokyo Cabinet. Yes, it does not even have a
</I>&gt;<i> README :(
</I>&gt;<i> --
</I>&gt;<i> MK
</I>&gt;<i>
</I>&gt;<i> <A HREF="http://github.com/michaelklishin">http://github.com/michaelklishin</A>
</I>&gt;<i> <A HREF="http://twitter.com/michaelklishin">http://twitter.com/michaelklishin</A>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130719/980f4b31/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130719/980f4b31/attachment.htm</A>&gt;
</PRE>




















































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="028688.html">[rabbitmq-discuss] blocked producers
</A></li>
	<LI>Next message: <A HREF="028757.html">[rabbitmq-discuss] blocked producers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28721">[ date ]</a>
              <a href="thread.html#28721">[ thread ]</a>
              <a href="subject.html#28721">[ subject ]</a>
              <a href="author.html#28721">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
