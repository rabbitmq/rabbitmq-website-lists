<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ scalability design question
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20scalability%20design%20question&In-Reply-To=%3CCAELUF_CJS5QwxmvM1xDb9DKa%3DX3vNbiez0Nc55t8tAyWwnpVng%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="028843.html">
   <LINK REL="Next"  HREF="028852.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ scalability design question</H1>
    <B>Flavio Pompermaier</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20scalability%20design%20question&In-Reply-To=%3CCAELUF_CJS5QwxmvM1xDb9DKa%3DX3vNbiez0Nc55t8tAyWwnpVng%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ scalability design question">pompermaier at okkam.it
       </A><BR>
    <I>Wed Jul 24 15:00:40 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="028843.html">[rabbitmq-discuss] RabbitMQ scalability design question
</A></li>
        <LI>Next message: <A HREF="028852.html">[rabbitmq-discuss] RabbitMQ scalability design question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28847">[ date ]</a>
              <a href="thread.html#28847">[ thread ]</a>
              <a href="subject.html#28847">[ subject ]</a>
              <a href="author.html#28847">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I don't know why I don't receive your reply anymore..I saw them on
news.gname.org..
However, about the point you answered:

This is a good question. Add to this that consumers can crash or become
unavailable because of
network failures. Coordination over RabbitMQ alone will probably be more
difficult than using
Redis for this purpose (as a &quot;presence service&quot;, more or less), e.g. using
its set data structures.
Any consumer would add itself to a set on start and any consumer can read
the set and see
who is online. I'm not very up-to-date with Redis but ideally you'd use its
features to detect
consumers leaving.

I think that here Zookeeper could fit very well in this case but I don't
have idea on how to configure it...
In one of the first emails you mentioned it..could you help me in setting
it up and use it to control
active consumers and query how many are them?

Best,
Flavio

On Wed, Jul 24, 2013 at 1:57 PM, Flavio Pompermaier &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">pompermaier at okkam.it</A>&gt;wrote:

&gt;<i> Actually the Consumer that receive the first stop message should receive
</I>&gt;<i> also N-1 &quot;I finished my stuff&quot; messages from the other N -1 consumers..
</I>&gt;<i> But I think it could be quite easily feasible..summarizing, tell me if
</I>&gt;<i> this could be a good workflow:
</I>&gt;<i>
</I>&gt;<i> 1) One of the N consumers receive the end-message
</I>&gt;<i> 2) This consumer opens a new temporary feedback-queue to receive feedbacks
</I>&gt;<i> from other consumers and post to a fanout control queue a &quot;wait for end of
</I>&gt;<i> processing&quot; to all other consumers (containing also the id of the
</I>&gt;<i> feedback-queue)
</I>&gt;<i> 3) Sender ignores such message, other consumers sends a &quot;I finished my
</I>&gt;<i> stuff&quot; message once finished their work to the feedback-queue (whose id is
</I>&gt;<i> indicated in the &quot;wait for end of processing&quot; message)
</I>&gt;<i> 4) Once that the Consumer who initiated the &quot;stop phase&quot; receive all the
</I>&gt;<i> N-1 feedbacks (or after a certain timeout) it can delete the temporary
</I>&gt;<i> feedback queue and start the map reduce job
</I>&gt;<i>
</I>&gt;<i> What is missing in this scenario is how consumers can be informed of the
</I>&gt;<i> number of active consumers (i.e. N)..any help about this? Do you think this
</I>&gt;<i> steps could be reasonable?
</I>&gt;<i>
</I>&gt;<i> On Wed, Jul 24, 2013 at 1:10 PM, Michael Klishin &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">mklishin at gopivotal.com</A>&gt;wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Flavio Pompermaier:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &gt; If not, could you please give me some more reference or hint about
</I>&gt;&gt;<i> implementing the solution you proposed?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> just make the consumer that receives the first &quot;stop&quot; message publish a
</I>&gt;&gt;<i> message that all
</I>&gt;&gt;<i> consumers will get (via a separate queue).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Note that to avoid an infinite loop of messages, you need to mark such
</I>&gt;&gt;<i> control messages
</I>&gt;&gt;<i> and make sure other consumers don't publish anything, just stop.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Then the consumer that's got the first &quot;stop&quot; message can start a
</I>&gt;&gt;<i> map/reduce job.
</I>&gt;&gt;<i> --
</I>&gt;&gt;<i> MK
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130724/a1581238/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130724/a1581238/attachment.htm</A>&gt;
</PRE>

























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="028843.html">[rabbitmq-discuss] RabbitMQ scalability design question
</A></li>
	<LI>Next message: <A HREF="028852.html">[rabbitmq-discuss] RabbitMQ scalability design question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28847">[ date ]</a>
              <a href="thread.html#28847">[ thread ]</a>
              <a href="subject.html#28847">[ subject ]</a>
              <a href="author.html#28847">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
