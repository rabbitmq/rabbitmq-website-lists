<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Ghost consumers problem
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Ghost%20consumers%20problem&In-Reply-To=%3CDC4E694A-598C-431D-A253-698E231C68BE%40alertme.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="028335.html">
   <LINK REL="Next"  HREF="028332.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Ghost consumers problem</H1>
    <B>Dmitry Andrianov</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Ghost%20consumers%20problem&In-Reply-To=%3CDC4E694A-598C-431D-A253-698E231C68BE%40alertme.com%3E"
       TITLE="[rabbitmq-discuss] Ghost consumers problem">dmitry.andrianov at alertme.com
       </A><BR>
    <I>Fri Jul  5 23:10:50 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="028335.html">[rabbitmq-discuss] Ghost consumers problem
</A></li>
        <LI>Next message: <A HREF="028332.html">[rabbitmq-discuss] ANN New RabbitMQ Logstash plugin is ready for	the final review
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28363">[ date ]</a>
              <a href="thread.html#28363">[ thread ]</a>
              <a href="subject.html#28363">[ subject ]</a>
              <a href="author.html#28363">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>But what is your problem exactly? Yes, for some time that &quot;ghost&quot; connection may be present until server realises the client has gone but I do not see how it prevents your service from successfully restarting.
If you declare queue as auto-delete, non-durable, non-exclusive and your user is permitted to do it the first time, then later when your service restarts and the queue already exists, you will still be able to declare it again with the same parameters. It won't cause error. So your second service will be able to start consuming from the same queue.

However, I have a strong feeling that what you really need instead is exclusive queue which you declare without providing a name so the server chooses a random name for you. So each time your service starts - a new queue is created and it ceases to exist when connection disappears. (Which can still take long but it should not be a problem as when new service starts - a new queue is created for it)

What is wrong with this approach?


On 4 Jul 2013, at 17:27, Jose Ramon Palanco &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">jpalanco at gmail.com</A>&gt; wrote:

&gt;<i> Michael,
</I>&gt;<i> 
</I>&gt;<i> Thank you for your quick reponse. We only need one consumer per queue. We already have AD (autodelete) and durable is setted to false. We tried exclusive and non-exclusive. We still have ghost connections and consumers even when the computers running the clients are powered off.
</I>&gt;<i> 
</I>&gt;<i> Console:
</I>&gt;<i> <A HREF="http://img827.imageshack.us/img827/9159/pce2.png">http://img827.imageshack.us/img827/9159/pce2.png</A>
</I>&gt;<i> 
</I>&gt;<i> I read that it could be due the NAT, but I have reproduced the same issue connected directly.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Regards
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 2013/7/4 Michael Klishin &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">michael.s.klishin at gmail.com</A>&gt;
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 2013/7/4 Jose Ramon Palanco &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">jpalanco at gmail.com</A>&gt;
</I>&gt;&gt;&gt;<i> After reboot, the service starts and when trying to create the queue, it conflicts with the former queue. We tried to create the queue as exclusive, but it doesn't allow us to connect because we haven't permission.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Is it because you have multiple connections using the queue?
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> If you consumer from the queue, you can declare it as auto-delete and non-durable instead of exclusive. Then as soon as the last consumer (registered with basic.consume, not using basic.get) is gone, it will be deleted.
</I>&gt;&gt;<i> -- 
</I>&gt;&gt;<i> MK
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> <A HREF="http://github.com/michaelklishin">http://github.com/michaelklishin</A>
</I>&gt;&gt;<i> <A HREF="http://twitter.com/michaelklishin">http://twitter.com/michaelklishin</A>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>

This email is for the use of the intended recipient(s) only.
If you have received this email in error, please notify the sender immediately and then delete it.
If you are not the intended recipient, you must not use, disclose or distribute this email without the
author's prior permission. AlertMe.com Ltd. is not responsible for any personal views expressed
in this message or any attachments that are those of the individual sender.

AlertMe.com Ltd, 30 Station Road, Cambridge, CB1 2RE, UK.
Registered in England, Company number 578 2908, VAT registration number GB 895 9914 42.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130705/5f76ceee/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130705/5f76ceee/attachment.htm</A>&gt;
</PRE>















































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="028335.html">[rabbitmq-discuss] Ghost consumers problem
</A></li>
	<LI>Next message: <A HREF="028332.html">[rabbitmq-discuss] ANN New RabbitMQ Logstash plugin is ready for	the final review
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28363">[ date ]</a>
              <a href="thread.html#28363">[ thread ]</a>
              <a href="subject.html#28363">[ subject ]</a>
              <a href="author.html#28363">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
