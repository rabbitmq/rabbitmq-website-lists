<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Question about erlang cookie
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Question%20about%20erlang%20cookie&In-Reply-To=%3CCA%2B0nT8BNVrso9yzmYx5aE2KMKbFRKbuqWUrqmSd6ao5mEis3Qg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="028774.html">
   <LINK REL="Next"  HREF="028256.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Question about erlang cookie</H1>
    <B>Priyanki Vashi</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Question%20about%20erlang%20cookie&In-Reply-To=%3CCA%2B0nT8BNVrso9yzmYx5aE2KMKbFRKbuqWUrqmSd6ao5mEis3Qg%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Question about erlang cookie">vashi.priyanki at gmail.com
       </A><BR>
    <I>Tue Jul 23 10:01:08 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="028774.html">[rabbitmq-discuss] Question about erlang cookie
</A></li>
        <LI>Next message: <A HREF="028256.html">[rabbitmq-discuss] IOS Library
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28778">[ date ]</a>
              <a href="thread.html#28778">[ thread ]</a>
              <a href="subject.html#28778">[ subject ]</a>
              <a href="author.html#28778">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi there ,

Thank you for answer on this.

I was away for few days so could not reply immediately. I had managed to
solve the problem.
It was on the similar lines as replied by Anton.

1) First I copied the single cookie in all the nodes. It was
/var/lib/rabbitmq path.
2) Another problem was that the nodes were able to identify each other only
by IP address and not by hostname and since in one of the post, I read its
necessary that nodes identify each other by hostname as well since when we
start nodes it picks node name. So edited /etc/hosts file on all the nodes
and added IP address and hostname.

Best Regards,
Priyanki.


On Tue, Jul 23, 2013 at 10:23 AM, Anton Sizov &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">a.sysoff at gmail.com</A>&gt; wrote:

&gt;<i> hi
</I>&gt;<i>
</I>&gt;<i> 1) Probably installation created files with rabbitmq user ownes. It is not
</I>&gt;<i> good practice to run rabbitmq server with root privileges. RabbitMQ need
</I>&gt;<i> rights to read/write to mnesia and log dirs only. You can run RMQ with non
</I>&gt;<i> root user.
</I>&gt;<i>
</I>&gt;<i> 2) Default place for .erlang.cookie file is user home directory. Probably
</I>&gt;<i> at the installation RMQ places cookie in its installation dir
</I>&gt;<i> (/var/lib/rabbitmq). Read
</I>&gt;<i> <A HREF="http://www.erlang.org/doc/reference_manual/distributed.html">http://www.erlang.org/doc/reference_manual/distributed.html</A> and
</I>&gt;<i> <A HREF="http://www.rabbitmq.com/clustering.html">http://www.rabbitmq.com/clustering.html</A> for more info about erlang cookie.
</I>&gt;<i>
</I>&gt;<i> 3) Your understanding is correct. RMQ uses only one cookie file. To be
</I>&gt;<i> consistent you can delete one of them. Start with that placed in user home
</I>&gt;<i> dir. Probably RMQ creates cookie in home dir when started not with rabbitmq
</I>&gt;<i> user or not with init script (service rabbitmq strarted). I use precompiled
</I>&gt;<i> RMQ package that place in /opt dir.
</I>&gt;<i>
</I>&gt;<i> 4) You doesn't I think. Different cookies can be the reason of such
</I>&gt;<i> problems. To help you, it necessary to know
</I>&gt;<i> - how you start rabbitmq node (1 and 2)
</I>&gt;<i> - try to start nodes not in cluster on different servers with the same
</I>&gt;<i> cookie and with the full name resolving (-name flag instead of -sname).
</I>&gt;<i> Then try to get status of each node from it server and from another.
</I>&gt;<i>
</I>&gt;<i> [server1]# rabbitmq -n <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbtimq at server1</A> status
</I>&gt;<i> [server1]# rabbitmq -n <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbtimq at server2</A> status
</I>&gt;<i> [server2]# rabbitmq -n <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbtimq at server1</A> status
</I>&gt;<i> [server2]# rabbitmq -n <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbtimq at server2</A> status
</I>&gt;<i>
</I>&gt;<i> It is minimum of actions to start resolve your problem.
</I>&gt;<i>
</I>&gt;<i> On Tuesday, July 2, 2013 1:42:37 PM UTC+3, Priyanki Vashi wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Hi there ,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I had a question about erlang cookie, which gets generated when we start
</I>&gt;&gt;<i> rabbitmq server. The situation is as follows.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 1) Even if I did not created any user named 'rabbitmq', there are files,
</I>&gt;&gt;<i> which are owned by this user. Does the installation or startup of
</I>&gt;&gt;<i> rabbitmq-server does this ? Also is it OK to use root user to do server
</I>&gt;&gt;<i> administration operation or will it be considered not so good practice ?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 2) I use root user to start and stop rabbitmq server and when I start the
</I>&gt;&gt;<i> server, I see that a file .erlang.cookie gets generated in root home dir.
</I>&gt;&gt;<i> That is correct as per my understanding but I also see that there is
</I>&gt;&gt;<i> another file with the same .erlang.cookie gets generated in
</I>&gt;&gt;<i> /var/lib/rabbitmq
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 3) Also these two erlang cookies are different from each other. Why there
</I>&gt;&gt;<i> are two erlang cookie files gets generated ? What is the importance ?
</I>&gt;&gt;<i> My theoretical understanding is there should be only one erlang cookie
</I>&gt;&gt;<i> should get generated and that one should be in home dir of user, which
</I>&gt;&gt;<i> starts the rabbitmq-server.
</I>&gt;&gt;<i> Is this correct understanding or ?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 4) Also do I need to configure different values of epmd ports when I want
</I>&gt;&gt;<i> to run cluster with two physical nodes or it's OK to keep it as default ?
</I>&gt;&gt;<i>     I thought NO need to change but then since I am running into these
</I>&gt;&gt;<i> problems thought of asking.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I would like to understand this bcoz, I tried to setup a cluster on two
</I>&gt;&gt;<i> different physical machines and as per the guidelines gives in 'rabbitmq in
</I>&gt;&gt;<i> action', before joining nodes running on different physical machines in the
</I>&gt;&gt;<i> cluster, the erlang cookie should be sync meaning that both the nodes
</I>&gt;&gt;<i> should have same erlang cookie so I tried to copy cookie from first node to
</I>&gt;&gt;<i> second and tried to restart second node but then I had problems with
</I>&gt;&gt;<i> restarting the node or even stopping the node and I get error. I also
</I>&gt;&gt;<i> checked the latest log file and it says
</I>&gt;&gt;<i> &quot;=ERROR REPORT==== 2-Jul-2013::19:48:28 ===
</I>&gt;&gt;<i> ** Connection attempt from disallowed node <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmqctl40424 at nazgul</A> **&quot; ,
</I>&gt;&gt;<i> which I believe is due to the fact that erlang cookie, which it had
</I>&gt;&gt;<i> originally when I started the node has changed now and hence it does not
</I>&gt;&gt;<i> allow me to stop the node. Is my understanding correct here or ?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Error mesaage while stopping or restarting the node after copying erlang
</I>&gt;&gt;<i> cookie from first node to second one.
</I>&gt;&gt;<i> Error: unable to connect to node <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit_2 at nazgul</A>: nodedown
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> DIAGNOSTICS
</I>&gt;&gt;<i> ===========
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> nodes in question: [<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit_2 at nazgul</A>]
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> hosts, their running nodes and ports:
</I>&gt;&gt;<i> - nazgul: [{rabbit_2,58454},{rabbit,**38771},{rabbitmqctl40424,**60952}]
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> current node details:
</I>&gt;&gt;<i> - node name: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmqctl40424 at nazgul</A>
</I>&gt;&gt;<i> - home dir: /var/lib/rabbitmq
</I>&gt;&gt;<i> - cookie hash: ad/NgkXjjR95x3cMejxwqg==
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thank you in advance and please guide me so that I understand what had
</I>&gt;&gt;<i> gone wrong here.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Best Regards,
</I>&gt;&gt;<i> Priyanki.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130723/138877b5/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130723/138877b5/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="028774.html">[rabbitmq-discuss] Question about erlang cookie
</A></li>
	<LI>Next message: <A HREF="028256.html">[rabbitmq-discuss] IOS Library
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28778">[ date ]</a>
              <a href="thread.html#28778">[ thread ]</a>
              <a href="subject.html#28778">[ subject ]</a>
              <a href="author.html#28778">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
