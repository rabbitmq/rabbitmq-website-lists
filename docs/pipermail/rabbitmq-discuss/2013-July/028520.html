<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Queue Replication over WAN
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Queue%20Replication%20over%20WAN&In-Reply-To=%3CCAKgmDnE4o815D%3DsG8Z7wtQjiwGiDi7M9f61Ho%2BaVR_0%2BRaAs9g%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="028519.html">
   <LINK REL="Next"  HREF="028475.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Queue Replication over WAN</H1>
    <B>Laing, Michael</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Queue%20Replication%20over%20WAN&In-Reply-To=%3CCAKgmDnE4o815D%3DsG8Z7wtQjiwGiDi7M9f61Ho%2BaVR_0%2BRaAs9g%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Queue Replication over WAN">michael.laing at nytimes.com
       </A><BR>
    <I>Fri Jul 12 03:14:02 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="028519.html">[rabbitmq-discuss] Queue Replication over WAN
</A></li>
        <LI>Next message: <A HREF="028475.html">[rabbitmq-discuss] Rabbitmq managment console crashes after install	Tsung
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28520">[ date ]</a>
              <a href="thread.html#28520">[ thread ]</a>
              <a href="subject.html#28520">[ subject ]</a>
              <a href="author.html#28520">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Guillaume,

Wiser heads will no doubt correct me, but:

1. Durable queues != durable messages: for your messages to (possibly)
still be there after a crash you must indicate that they are persistent
(delivery_mode=2).

2. You can cross-link your exchanges/queues using shovels such that
messages appear in both servers in a symmetric manner. I have personally
found this easier to: understand, configure, implement, and operate than
federation, but don't let me discourage you from trying federation as well!

3. We do health checks and automated failover using AWS Route 53: a smart
DNS service - works fine, so you are good there.

4. Bonus: we actually exchange messages twice between servers (actually
clusters), once before they are 'processed' and once after they are
'processed'. We do this because our own processing steps are the least
reliable and most time consuming portion of each message pipeline, hence
failures tend to occur there. This results in duplicate messages after
processing (actually triplicate in our case). We have a 'resolver' layer
that de-duplicates and continuously reports on paths and latencies, as well
as the successful processing of each message.

Michael Laing
NYTimes


On Thu, Jul 11, 2013 at 9:19 PM, Guillaume Ouellet &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">gui.ouellet at gmail.com</A>&gt;wrote:

&gt;<i> Ok, I think I have found a way to solve this issue.
</I>&gt;<i>
</I>&gt;<i> My queues will be durable, so if the server crashes, the queues will be
</I>&gt;<i> reloaded on boot up. The servers RAID configuration will make sure we don't
</I>&gt;<i> loose any items from our queue.
</I>&gt;<i>
</I>&gt;<i> The producer client code will implement  a logic where if the primary
</I>&gt;<i> hostname can't be reached, we will send the items to the secondary
</I>&gt;<i> hostname. The consumers will listen to both hostname.
</I>&gt;<i>
</I>&gt;<i> 2 questions:
</I>&gt;<i>
</I>&gt;<i> 1. Is this approach flawed ?
</I>&gt;<i> 2. I am using c# client, and I can't find in the doc any scheme for
</I>&gt;<i> alternate nodes in case the primare fails? Is there any implementation
</I>&gt;<i> similar to this, or I'll have to do my own ?
</I>&gt;<i>
</I>&gt;<i> Thanks
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Wednesday, 10 July 2013 15:27:43 UTC-4, Guillaume Ouellet wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Hi all,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I am trying to use RabbitMq so that I have one instance of RabbitMQ on
</I>&gt;&gt;<i> each of my 2 servers that are separated by a WAN. One server would be
</I>&gt;&gt;<i> active, the other &quot;inactive&quot;, but the inactive would actually have the
</I>&gt;&gt;<i> queue from the active replicated real-time. This way, if the active server
</I>&gt;&gt;<i> goes down, the inactive server kicks in, and continues where the active
</I>&gt;&gt;<i> left off.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> It seemed like the clustering option does exactly this, but as I said
</I>&gt;&gt;<i> previously, I am over a WAN, and a WAN configuration is not recommended.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> My question is how would I implement the previous logic via shovels or
</I>&gt;&gt;<i> federations ? I can't seem to get my head around this looking at the
</I>&gt;&gt;<i> documentation.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thank you
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130711/b668effb/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130711/b668effb/attachment.htm</A>&gt;
</PRE>


















































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="028519.html">[rabbitmq-discuss] Queue Replication over WAN
</A></li>
	<LI>Next message: <A HREF="028475.html">[rabbitmq-discuss] Rabbitmq managment console crashes after install	Tsung
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28520">[ date ]</a>
              <a href="thread.html#28520">[ thread ]</a>
              <a href="subject.html#28520">[ subject ]</a>
              <a href="author.html#28520">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
