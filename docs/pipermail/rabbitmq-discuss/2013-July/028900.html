<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ hanging during 'rabbitmqctl stop' -	please help
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20hanging%20during%20%27rabbitmqctl%20stop%27%20-%0A%09please%20help&In-Reply-To=%3C51F19F78.4000603%40gazzang.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="028800.html">
   <LINK REL="Next"  HREF="028915.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ hanging during 'rabbitmqctl stop' -	please help</H1>
    <B>Casey Marshall</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20hanging%20during%20%27rabbitmqctl%20stop%27%20-%0A%09please%20help&In-Reply-To=%3C51F19F78.4000603%40gazzang.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ hanging during 'rabbitmqctl stop' -	please help">casey.marshall at gazzang.com
       </A><BR>
    <I>Thu Jul 25 22:58:16 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="028800.html">[rabbitmq-discuss] RabbitMQ hanging during 'rabbitmqctl stop' -	please help
</A></li>
        <LI>Next message: <A HREF="028915.html">[rabbitmq-discuss] RabbitMQ hanging during 'rabbitmqctl stop' - please help
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28900">[ date ]</a>
              <a href="thread.html#28900">[ thread ]</a>
              <a href="subject.html#28900">[ subject ]</a>
              <a href="author.html#28900">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Is there more information I can give you about my problem? Some way to
prevent the rabbit hang on service restart, or get it unstuck? So far,
the only way to get past it is to kill the beam process. I can't imagine
that is good for the integrity of the service.

I'm relatively new to working with RabbitMQ. I've been developing with
it for a couple months now, but I've been diligently researching this
problem and making trial-and-error attempts at black-box solutions for
the last two weeks to no avail. I'm really stuck and getting desperate
to find a solution.

This problem is persistent enough that I don't think we'll be able to
deploy into production without some understanding of the root cause and
a workaround.

I know this an open-source project, and I don't feel entitled to any
sort of timely response, but if this isn't the place to get help, where
else I should I look?

-Casey

On 07/23/2013 09:39 AM, Casey Marshall wrote:
&gt;<i> I'm using RabbitMQ federated exchanges among a number of servers. Each
</I>&gt;<i> server has upstream exchanges on each of the others. I don't want to
</I>&gt;<i> call it a cluster, since that has another meaning in RabbitMQ altogether
</I>&gt;<i> ... let's call it a &quot;federated group&quot;.
</I>&gt;<i> 
</I>&gt;<i> This worked fine over AMQP, both in my own local KVM-virtualized testing
</I>&gt;<i> environment, and it seemed to as well in Amazon EC2 with unencrypted
</I>&gt;<i> AMQP. However, I need to secure the connections in EC2 with AMQPS before
</I>&gt;<i> we go into production.
</I>&gt;<i> 
</I>&gt;<i> I was able to automate creation and distribution of certificates among
</I>&gt;<i> the servers, and the setup works fine in a local KVM-virtualized
</I>&gt;<i> environment. However, when I started testing it in EC2 across regions, I
</I>&gt;<i> started having problems. RabbitMQ hangs on some of the servers in EC2
</I>&gt;<i> during 'service rabbitmq-server restart'.
</I>&gt;<i> 
</I>&gt;<i> I have scripts to automate updating the federated exchanges, to effect
</I>&gt;<i> topology changes on the &quot;federated group&quot; -- adding or removing a
</I>&gt;<i> server, or changing its role (different roles have different exchange
</I>&gt;<i> upstreams). After this script updates the federation config, the
</I>&gt;<i> subsequent restart hangs on some of the servers.
</I>&gt;<i> 
</I>&gt;<i> What should I do to make my RabbitMQ &quot;federated group&quot; more robust?
</I>&gt;<i> 
</I>&gt;<i> I've attached:
</I>&gt;<i> 
</I>&gt;<i> 1. rabbitmq.log and rabbitmq-sasl.log excerpt from one of the hosts that
</I>&gt;<i> persistently gets stuck during a RabbitMQ 'stop', near the time of the hang.
</I>&gt;<i> 2. 'rabbitmqctl status' from that host.
</I>&gt;<i> 
</I>&gt;<i> Installed on the system:
</I>&gt;<i> 
</I>&gt;<i> ii  esl-erlang                       1:16.b.1-1~ubuntu~precise       Erlang
</I>&gt;<i> ii  rabbitmq-server                  3.1.3-1
</I>&gt;<i> AMQP server written in Erlang
</I>&gt;<i> 
</I>&gt;<i> Much thanks,
</I>&gt;<i> Casey
</I>&gt;<i> 
</I>
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="028800.html">[rabbitmq-discuss] RabbitMQ hanging during 'rabbitmqctl stop' -	please help
</A></li>
	<LI>Next message: <A HREF="028915.html">[rabbitmq-discuss] RabbitMQ hanging during 'rabbitmqctl stop' - please help
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28900">[ date ]</a>
              <a href="thread.html#28900">[ thread ]</a>
              <a href="subject.html#28900">[ subject ]</a>
              <a href="author.html#28900">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
