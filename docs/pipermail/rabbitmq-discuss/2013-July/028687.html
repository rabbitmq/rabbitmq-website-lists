<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] blocked producers
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20blocked%20producers&In-Reply-To=%3C15c40c58-a27b-4c66-beac-7b92fb1f6c87%40googlegroups.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="028686.html">
   <LINK REL="Next"  HREF="028688.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] blocked producers</H1>
    <B>Kobi Biton</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20blocked%20producers&In-Reply-To=%3C15c40c58-a27b-4c66-beac-7b92fb1f6c87%40googlegroups.com%3E"
       TITLE="[rabbitmq-discuss] blocked producers">kbiton at outbrain.com
       </A><BR>
    <I>Thu Jul 18 22:11:35 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="028686.html">[rabbitmq-discuss] High binary memory usage?
</A></li>
        <LI>Next message: <A HREF="028688.html">[rabbitmq-discuss] blocked producers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28687">[ date ]</a>
              <a href="thread.html#28687">[ thread ]</a>
              <a href="subject.html#28687">[ subject ]</a>
              <a href="author.html#28687">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Folks,

 We are running a high scale setup with rabbitmq 3.0.1 , flow:

logstash 1.1.12 producer --&gt; exchange --&gt;   fanout queue 
                                                              |         |
                                                              |         |
                                                         consumer Consumer
                                                              A             
B

Consumers as logstash , consuming to graphite as output , our message rate 
us ~ 12000 messages/s , FanOut Exchange , Durable: False , Persistent: 
False , No Memory problems

We are facing a problem where at random times rabbitmq starts to block 
producers due to flow control (rabbitmqctl list_connections) , this is to 
our understanding 
in order to protect the broker and the consumer as the producers are faster 
then the consumer ?

The problem is that at some point (when the READY messages count is high ~ 
1M)  rabbitmq blocks most of our producers and does not seem to release 
them , until we restart them (logstash daemon) on every one of them , we 
tried purging the queue / restarting rabbitmq , only restarting the 
producers seems to bring things to normal state.

I guess my questions are:

 - Is my problem on the consumer side ? I am unable to debug the consumer 
speed or state 
 - Can I force flow control to release blocked producers?
 - Can I tune rabbitmq for lots of connections and high message rate?
 - We use fanout exchange , when a consumer creates a new queue under this 
exchange and does not consume fast enough can he effect the producers from 
the other queue (i.e cause them to be blocked?)

Thanks
Kobi 

 

-- 
The above terms reflect a potential business arrangement, are provided solely 
as a basis for further discussion, and are not intended to be and do not 
constitute a legally binding obligation. No legally binding obligations will 
be created, implied, or inferred until an agreement in final form is executed 
in writing by all parties involved.

This email and any attachments hereto may be confidential or privileged. 
 If you received this communication by mistake, please don't forward it to 
anyone else, please erase all copies and attachments, and please let me 
know that it has gone to the wrong person. Thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130718/09e46f90/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130718/09e46f90/attachment.htm</A>&gt;
</PRE>




































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="028686.html">[rabbitmq-discuss] High binary memory usage?
</A></li>
	<LI>Next message: <A HREF="028688.html">[rabbitmq-discuss] blocked producers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28687">[ date ]</a>
              <a href="thread.html#28687">[ thread ]</a>
              <a href="subject.html#28687">[ subject ]</a>
              <a href="author.html#28687">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
