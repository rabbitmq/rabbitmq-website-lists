<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Recipe for corrupting mnesia in a cluster
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Recipe%20for%20corrupting%20mnesia%20in%20a%20cluster&In-Reply-To=%3C51EFEA0C.1010500%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="028799.html">
   <LINK REL="Next"  HREF="028850.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Recipe for corrupting mnesia in a cluster</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Recipe%20for%20corrupting%20mnesia%20in%20a%20cluster&In-Reply-To=%3C51EFEA0C.1010500%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Recipe for corrupting mnesia in a cluster">matthias at rabbitmq.com
       </A><BR>
    <I>Wed Jul 24 15:51:56 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="028799.html">[rabbitmq-discuss] Recipe for corrupting mnesia in a cluster
</A></li>
        <LI>Next message: <A HREF="028850.html">[rabbitmq-discuss] Recipe for corrupting mnesia in a cluster
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28849">[ date ]</a>
              <a href="thread.html#28849">[ thread ]</a>
              <a href="subject.html#28849">[ subject ]</a>
              <a href="author.html#28849">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Chris,

On 23/07/13 15:39, Chris wrote:
&gt;<i> We are using RabbitMQ 3.1.1 / Erlang R16B on Redhat EL 6.2.  We've
</I>&gt;<i> discovered a scenario that can corrupt the RabbitMQ databases pretty
</I>&gt;<i> consistently, and are wondering if you might have some suggestions for
</I>&gt;<i> prevention (or might want to consider a fix if possible).
</I>&gt;<i>
</I>&gt;<i> In short, if you are running two nodes in a cluster, and there are
</I>&gt;<i> active connections, cutting the power to both nodes in short succession
</I>&gt;<i> can corrupt both databases.
</I>&gt;<i> [...]
</I>&gt;<i>     =INFO REPORT==== 23-Jul-2013::09:44:26 ===
</I>&gt;<i>     Timeout contacting cluster nodes: ['<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at node2</A>'].
</I>
The issue here is that the 2nd node did not come back up within 30s of 
the first. If it had everything would have been fine.

No db corruption has occurred. This is simply a case of both nodes 
thinking they weren't the last to shut down and waiting for the other to 
come up.

&gt;<i> The only way I've been able to fix this is by deleting the contents of
</I>&gt;<i> mnesia on both nodes and re-clustering them.
</I>
Starting rabbit on both nodes inside 30 seconds should resolve the problem.

Regards,

Matthias.
</PRE>















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="028799.html">[rabbitmq-discuss] Recipe for corrupting mnesia in a cluster
</A></li>
	<LI>Next message: <A HREF="028850.html">[rabbitmq-discuss] Recipe for corrupting mnesia in a cluster
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28849">[ date ]</a>
              <a href="thread.html#28849">[ thread ]</a>
              <a href="subject.html#28849">[ subject ]</a>
              <a href="author.html#28849">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
