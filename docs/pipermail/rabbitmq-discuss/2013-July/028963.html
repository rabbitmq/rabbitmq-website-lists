<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] forking and getting or consuming messages
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20forking%20and%20getting%20or%20consuming%20messages&In-Reply-To=%3C51F6E585.4080409%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="028905.html">
   <LINK REL="Next"  HREF="028967.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] forking and getting or consuming messages</H1>
    <B>Chris</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20forking%20and%20getting%20or%20consuming%20messages&In-Reply-To=%3C51F6E585.4080409%40gmail.com%3E"
       TITLE="[rabbitmq-discuss] forking and getting or consuming messages">dmagick at gmail.com
       </A><BR>
    <I>Mon Jul 29 22:58:29 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="028905.html">[rabbitmq-discuss] forking and getting or consuming messages
</A></li>
        <LI>Next message: <A HREF="028967.html">[rabbitmq-discuss] forking and getting or consuming messages
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28963">[ date ]</a>
              <a href="thread.html#28963">[ thread ]</a>
              <a href="subject.html#28963">[ subject ]</a>
              <a href="author.html#28963">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 26/07/13 15:35, Michael Klishin wrote:
&gt;<i> Chris:
</I>&gt;<i>
</I>&gt;&gt;<i> The second problem is that once all the messages are off the stack, the script exits. I'd like it to stay open and wait for more messages to come in. Is that possible using the queue-&gt;get() approach?
</I>&gt;<i>
</I>&gt;<i> Child processes of fork(2) need to reopen all network connections
</I>&gt;<i> (not just to RabbitMQ).
</I>
Yep, I understand that.

The structure looks like this:

Parent:
  - connects to the main queue.
  - get() a message
  -- forks
  -- Fires up a separate script to deal with queue 'X'
  -- repeat for other tasks for queues 'Y' and 'Z'
  - waits for all child scripts to finish
  - exits nicely

Child (deals with its own connection to rabbit, it's a separate 
self-contained script):
  - connects to queue 'X' (this is hardcoded - separate scripts deal 
with different queues for different reasons).
  - get() a message
  -- do work
  - repeat until get() returns nothing
  - exits nicely

If I put more tasks on queue 'X' while child is already running, they 
aren't seen. Not a big deal but ideally I'd like them to be picked up 
rather than having to run the child process again. Do I need to do 
something here to make this work?

I'd also like parent to keep listening for more incoming tasks (rather 
than exiting and having to run it again). I changed this to be a 
consumer rather than using get() to fetch the messages, but then the 
forking would wait for the child to finish rather than immediately going 
to the next task. Am I missing something (should I be ack'ing the 
message straight after getting it for it to immediately go to the next?)

Thanks again.
-- 
Postgresql &amp; php tutorials
<A HREF="http://www.designmagick.com/">http://www.designmagick.com/</A>

</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="028905.html">[rabbitmq-discuss] forking and getting or consuming messages
</A></li>
	<LI>Next message: <A HREF="028967.html">[rabbitmq-discuss] forking and getting or consuming messages
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28963">[ date ]</a>
              <a href="thread.html#28963">[ thread ]</a>
              <a href="subject.html#28963">[ subject ]</a>
              <a href="author.html#28963">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
