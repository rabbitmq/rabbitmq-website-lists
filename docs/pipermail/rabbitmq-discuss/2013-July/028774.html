<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Question about erlang cookie
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Question%20about%20erlang%20cookie&In-Reply-To=%3Cb61f392c-7fc7-4e05-a94f-4f6d247b4b8d%40googlegroups.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="028227.html">
   <LINK REL="Next"  HREF="028778.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Question about erlang cookie</H1>
    <B>Anton Sizov</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Question%20about%20erlang%20cookie&In-Reply-To=%3Cb61f392c-7fc7-4e05-a94f-4f6d247b4b8d%40googlegroups.com%3E"
       TITLE="[rabbitmq-discuss] Question about erlang cookie">a.sysoff at gmail.com
       </A><BR>
    <I>Tue Jul 23 09:23:28 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="028227.html">[rabbitmq-discuss] Question about erlang cookie
</A></li>
        <LI>Next message: <A HREF="028778.html">[rabbitmq-discuss] Question about erlang cookie
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28774">[ date ]</a>
              <a href="thread.html#28774">[ thread ]</a>
              <a href="subject.html#28774">[ subject ]</a>
              <a href="author.html#28774">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>hi

1) Probably installation created files with rabbitmq user ownes. It is not 
good practice to run rabbitmq server with root privileges. RabbitMQ need 
rights to read/write to mnesia and log dirs only. You can run RMQ with non 
root user.

2) Default place for .erlang.cookie file is user home directory. Probably 
at the installation RMQ places cookie in its installation dir 
(/var/lib/rabbitmq). Read 
<A HREF="http://www.erlang.org/doc/reference_manual/distributed.html">http://www.erlang.org/doc/reference_manual/distributed.html</A> and 
<A HREF="http://www.rabbitmq.com/clustering.html">http://www.rabbitmq.com/clustering.html</A> for more info about erlang cookie.

3) Your understanding is correct. RMQ uses only one cookie file. To be 
consistent you can delete one of them. Start with that placed in user home 
dir. Probably RMQ creates cookie in home dir when started not with rabbitmq 
user or not with init script (service rabbitmq strarted). I use precompiled 
RMQ package that place in /opt dir. 

4) You doesn't I think. Different cookies can be the reason of such 
problems. To help you, it necessary to know
- how you start rabbitmq node (1 and 2)
- try to start nodes not in cluster on different servers with the same 
cookie and with the full name resolving (-name flag instead of -sname). 
Then try to get status of each node from it server and from another.

[server1]# rabbitmq -n <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbtimq at server1</A> status
[server1]# rabbitmq -n <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbtimq at server2</A> status
[server2]# rabbitmq -n <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbtimq at server1</A> status
[server2]# rabbitmq -n <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbtimq at server2</A> status

It is minimum of actions to start resolve your problem.

On Tuesday, July 2, 2013 1:42:37 PM UTC+3, Priyanki Vashi wrote:
&gt;<i>
</I>&gt;<i> Hi there ,
</I>&gt;<i>
</I>&gt;<i> I had a question about erlang cookie, which gets generated when we start 
</I>&gt;<i> rabbitmq server. The situation is as follows.
</I>&gt;<i>
</I>&gt;<i> 1) Even if I did not created any user named 'rabbitmq', there are files, 
</I>&gt;<i> which are owned by this user. Does the installation or startup of 
</I>&gt;<i> rabbitmq-server does this ? Also is it OK to use root user to do server 
</I>&gt;<i> administration operation or will it be considered not so good practice ? 
</I>&gt;<i>
</I>&gt;<i> 2) I use root user to start and stop rabbitmq server and when I start the 
</I>&gt;<i> server, I see that a file .erlang.cookie gets generated in root home dir. 
</I>&gt;<i> That is correct as per my understanding but I also see that there is 
</I>&gt;<i> another file with the same .erlang.cookie gets generated in 
</I>&gt;<i> /var/lib/rabbitmq
</I>&gt;<i>
</I>&gt;<i> 3) Also these two erlang cookies are different from each other. Why there 
</I>&gt;<i> are two erlang cookie files gets generated ? What is the importance ?
</I>&gt;<i> My theoretical understanding is there should be only one erlang cookie 
</I>&gt;<i> should get generated and that one should be in home dir of user, which 
</I>&gt;<i> starts the rabbitmq-server.
</I>&gt;<i> Is this correct understanding or ? 
</I>&gt;<i>
</I>&gt;<i> 4) Also do I need to configure different values of epmd ports when I want 
</I>&gt;<i> to run cluster with two physical nodes or it's OK to keep it as default ? 
</I>&gt;<i>     I thought NO need to change but then since I am running into these 
</I>&gt;<i> problems thought of asking. 
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I would like to understand this bcoz, I tried to setup a cluster on two 
</I>&gt;<i> different physical machines and as per the guidelines gives in 'rabbitmq in 
</I>&gt;<i> action', before joining nodes running on different physical machines in the 
</I>&gt;<i> cluster, the erlang cookie should be sync meaning that both the nodes 
</I>&gt;<i> should have same erlang cookie so I tried to copy cookie from first node to 
</I>&gt;<i> second and tried to restart second node but then I had problems with 
</I>&gt;<i> restarting the node or even stopping the node and I get error. I also 
</I>&gt;<i> checked the latest log file and it says 
</I>&gt;<i> &quot;=ERROR REPORT==== 2-Jul-2013::19:48:28 ===
</I>&gt;<i> ** Connection attempt from disallowed node <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmqctl40424 at nazgul</A> **&quot; , 
</I>&gt;<i> which I believe is due to the fact that erlang cookie, which it had 
</I>&gt;<i> originally when I started the node has changed now and hence it does not 
</I>&gt;<i> allow me to stop the node. Is my understanding correct here or ?
</I>&gt;<i>
</I>&gt;<i> Error mesaage while stopping or restarting the node after copying erlang 
</I>&gt;<i> cookie from first node to second one.
</I>&gt;<i> Error: unable to connect to node <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit_2 at nazgul</A>: nodedown
</I>&gt;<i>
</I>&gt;<i> DIAGNOSTICS
</I>&gt;<i> ===========
</I>&gt;<i>
</I>&gt;<i> nodes in question: [<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit_2 at nazgul</A>]
</I>&gt;<i>
</I>&gt;<i> hosts, their running nodes and ports:
</I>&gt;<i> - nazgul: [{rabbit_2,58454},{rabbit,38771},{rabbitmqctl40424,60952}]
</I>&gt;<i>
</I>&gt;<i> current node details:
</I>&gt;<i> - node name: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmqctl40424 at nazgul</A>
</I>&gt;<i> - home dir: /var/lib/rabbitmq
</I>&gt;<i> - cookie hash: ad/NgkXjjR95x3cMejxwqg==
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Thank you in advance and please guide me so that I understand what had 
</I>&gt;<i> gone wrong here.
</I>&gt;<i>
</I>&gt;<i> Best Regards,
</I>&gt;<i> Priyanki.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130723/d4137dcc/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130723/d4137dcc/attachment.htm</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="028227.html">[rabbitmq-discuss] Question about erlang cookie
</A></li>
	<LI>Next message: <A HREF="028778.html">[rabbitmq-discuss] Question about erlang cookie
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28774">[ date ]</a>
              <a href="thread.html#28774">[ thread ]</a>
              <a href="subject.html#28774">[ subject ]</a>
              <a href="author.html#28774">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
