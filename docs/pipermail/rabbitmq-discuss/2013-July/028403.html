<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] DOS protection
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20DOS%20protection&In-Reply-To=%3C1A35AFAA9DF64CDAB0DA22BBD52B5715%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="028401.html">
   <LINK REL="Next"  HREF="028372.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] DOS protection</H1>
    <B>carlhoerberg</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20DOS%20protection&In-Reply-To=%3C1A35AFAA9DF64CDAB0DA22BBD52B5715%40gmail.com%3E"
       TITLE="[rabbitmq-discuss] DOS protection">carl.hoerberg at gmail.com
       </A><BR>
    <I>Mon Jul  8 20:29:11 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="028401.html">[rabbitmq-discuss] DOS protection
</A></li>
        <LI>Next message: <A HREF="028372.html">[rabbitmq-discuss] cluster memory alarm blocks producer too long
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28403">[ date ]</a>
              <a href="thread.html#28403">[ thread ]</a>
              <a href="subject.html#28403">[ subject ]</a>
              <a href="author.html#28403">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>

On Monday 8 July 2013 at 17:49, Matthias Radestock-3 [via RabbitMQ] wrote:

&gt;<i> Carl,  
</I>&gt;<i>  
</I>&gt;<i> thanks for the answers. A few follow-up questions...  
</I>&gt;<i>  
</I>&gt;<i> On 08/07/13 16:23, Carl H&#246;rberg wrote:  
</I>&gt;<i> &gt; On Monday 8 July 2013 at 12:19, Matthias Radestock wrote:  
</I>&gt;<i> &gt; &gt; - what entities do you want to monitor? You mention channels,  
</I>&gt;<i> &gt; &gt; consumers and declarations (presumably by that you mean exchanges,  
</I>&gt;<i> &gt; &gt; queues, and bindings). Any others?  
</I>&gt;<i> &gt;  
</I>&gt;<i> &gt;  
</I>&gt;<i> &gt; That, plus connection count.  
</I>&gt;<i>  
</I>&gt;<i> Connection count is bounded by the available file descriptors, for which  
</I>&gt;<i> you can tune the limit in the O/S. I would have thought that is sufficient.
</I>
You're right, the global limit, but we monitor and limit individual vhost connections too. The only problem is if a user creates a lot of connections within 5 seconds, then we can't block new connections fast enough.  

And the way we block is suboptimal too, today we remove the password (or remove the vhost permission), but then they can't access the mgmt interface either, which confuses a lot of users.  
&gt;<i>  
</I>&gt;<i>  
</I>&gt;<i> &gt; A global limit would be sufficient for the time being, just for  
</I>&gt;<i> &gt; protection, so that the cluster doesn't dies before we can see who  
</I>&gt;<i> &gt; has done what.  
</I>&gt;<i>  
</I>&gt;<i>  
</I>&gt;<i> So say rabbit enforced global limits for the numbers of channels,  
</I>&gt;<i> consumers, exchanges, queues and bindings. How would you go about  
</I>&gt;<i> picking the limits?  
</I>&gt;<i>  
</I>&gt;<i> There is nothing wrong with having lots of channels, or lots of  
</I>&gt;<i> consumers, or lots of exchanges, etc, etc. But if you set upper bounds  
</I>&gt;<i> on what rabbit can sustain for each one of them, then a rabbit which  
</I>&gt;<i> encounters mixed usage could still run out of memory.
</I>
True.. Most often it's not that complicated though. Often we can see that user uses a lot of resources, and then we contact that user and make sure that he's doing the right thing. Again, the problem we have is when customers by bugs or by other means creates a lot of something very very fast, faster than we can monitor.  
&gt;<i>  
</I>&gt;<i>  
</I>&gt;<i> Furthermore, as you know, in the default configuration messages take up  
</I>&gt;<i> some residual memory even when paged to disk, which means there is less  
</I>&gt;<i> memory available for everything. This too makes it hard to choose any  
</I>&gt;<i> bounds which have a reasonable chance of working w/o being silly low.  
</I>&gt;<i>  
</I>True, i've seen the message index grow to many gigabytes, which is way we now monitor queue length too, but &quot;fortunately&quot; message queues can only grow with a couple of thousands messages per second, not millions, which is required to build a huge index.  
&gt;<i>  
</I>&gt;<i>  
</I>&gt;<i> Since your main concern is memory exhaustion - and by that presumably  
</I>&gt;<i> you mean rabbit crashing because it cannot allocate any more memory,  
</I>&gt;<i> rather than just hitting the memory alarm and blocking publisher -  
</I>&gt;<i> perhaps a better - simpler and more versatile - behaviour would be for  
</I>&gt;<i> rabbit to block all channel, consumer and resource declarations when  
</I>&gt;<i> memory gets *really* tight.
</I>
That would be a great solution! Or somehow &quot;slow things down&quot;, so we have the chance to use the mgmt api and read the values before it's too late.    
&gt;<i>  
</I>&gt;<i>  
</I>&gt;<i>  
</I>&gt;<i> Regards,  
</I>&gt;<i>  
</I>&gt;<i> Matthias.  
</I>&gt;<i> _______________________________________________  
</I>&gt;<i> rabbitmq-discuss mailing list  
</I>&gt;<i> [hidden email] (/user/SendEmail.jtp?type=node&amp;node=27904&amp;i=0)  
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>  
</I>&gt;<i>  
</I>&gt;<i> If you reply to this email, your message will be added to the discussion below: <A HREF="http://rabbitmq.1065348.n5.nabble.com/DOS-protection-tp27876p27904.html">http://rabbitmq.1065348.n5.nabble.com/DOS-protection-tp27876p27904.html</A>  
</I>&gt;<i> To unsubscribe from DOS protection, click here (<A HREF="http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&amp;node=27876&amp;code=Y2FybC5ob2VyYmVyZ0BnbWFpbC5jb218Mjc4NzZ8LTEyNDcxMDc4NjM=">http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&amp;node=27876&amp;code=Y2FybC5ob2VyYmVyZ0BnbWFpbC5jb218Mjc4NzZ8LTEyNDcxMDc4NjM=</A>).
</I>&gt;<i> NAML (<A HREF="http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&amp;id=instant_html%21nabble%3Aemail.naml&amp;base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&amp;breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml">http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&amp;id=instant_html%21nabble%3Aemail.naml&amp;base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&amp;breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml</A>)  
</I>






--
View this message in context: <A HREF="http://rabbitmq.1065348.n5.nabble.com/DOS-protection-tp27876p27906.html">http://rabbitmq.1065348.n5.nabble.com/DOS-protection-tp27876p27906.html</A>
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130708/dd017519/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130708/dd017519/attachment.htm</A>&gt;
</PRE>





















































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="028401.html">[rabbitmq-discuss] DOS protection
</A></li>
	<LI>Next message: <A HREF="028372.html">[rabbitmq-discuss] cluster memory alarm blocks producer too long
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28403">[ date ]</a>
              <a href="thread.html#28403">[ thread ]</a>
              <a href="subject.html#28403">[ subject ]</a>
              <a href="author.html#28403">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
