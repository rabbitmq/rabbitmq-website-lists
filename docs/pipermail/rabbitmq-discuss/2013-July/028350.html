<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ Consumer timeout (Alan Antonuk)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20Consumer%20timeout%20%28Alan%20Antonuk%29&In-Reply-To=%3CDD7729D61B083D48A2CDCB66A27AD4C98C5B2F%40BSDMSATMBX001.mahindrasatyam.ad%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="028346.html">
   <LINK REL="Next"  HREF="028353.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ Consumer timeout (Alan Antonuk)</H1>
    <B>Lothe_Shashank</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20Consumer%20timeout%20%28Alan%20Antonuk%29&In-Reply-To=%3CDD7729D61B083D48A2CDCB66A27AD4C98C5B2F%40BSDMSATMBX001.mahindrasatyam.ad%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ Consumer timeout (Alan Antonuk)">Lothe_Shashank at mahindrasatyam.com
       </A><BR>
    <I>Fri Jul  5 14:52:36 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="028346.html">[rabbitmq-discuss] [Bug] Memory leak in 3.1.3 (Ubuntu)
</A></li>
        <LI>Next message: <A HREF="028353.html">[rabbitmq-discuss] RabbitMQ Consumer timeout (Alan Antonuk)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28350">[ date ]</a>
              <a href="thread.html#28350">[ thread ]</a>
              <a href="subject.html#28350">[ subject ]</a>
              <a href="author.html#28350">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Dear Alan,

I download rabbitmq-c master package from and tried newly added amqp_simple_wait_frame_noblock API. I modified amqp_listen.c example and instead of amqp_simple_wait_frame I used amqp_simple_wait_frame_noblock with different timeout values. However this API is failing immediately with return value as -13. What this return value means? Is there any other way of using timeout so that if I don't receive a frame within say 10ms I can reject that message.

Another problem I am facing with amqp_basic_reject API. In amqp_listen.c example I called this API (with requeue=1) and I got following console output. After that it is not able to receive any message sent by amqp_send_string example.

00000000: 48 65 6C 6C 6F 20 57 6F : 72 6C 64                 Hello World
0000000B:
Result 0
Frame type 1, channel 1
Method AMQP_CHANNEL_CLOSE_METHOD

One more problem I would like to report. I have created a client 7 different queues with 7 different channels and bound with 7 different binding keys on the same connection with direct exchange. The listening part of these 7 queues are with 7 different threads listening for server input. When I am sending message from server with corresponding routing keys the messages are delivered to different queue than the expected queue. (I believe it is called Shunting messages from one queue to another). What could be the problem? Do I have to do something from rabbitmq server to targeted delivery? I tried by making queues exclusive but got the same result.

Please help.

Thanks and regards,
Shashank

---------- Forwarded message ----------
From: &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss-request at lists.rabbitmq.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss-request at lists.rabbitmq.com</A>&gt;&gt;
Date: Wed, Jun 26, 2013 at 4:30 PM
Subject: rabbitmq-discuss Digest, Vol 73, Issue 27
To: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;


Send rabbitmq-discuss mailing list submissions to
        <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;

To subscribe or unsubscribe via the World Wide Web, visit
        <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
or, via email, send a message with subject or body 'help' to
        <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss-request at lists.rabbitmq.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss-request at lists.rabbitmq.com</A>&gt;

You can reach the person managing the list at
        <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss-owner at lists.rabbitmq.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss-owner at lists.rabbitmq.com</A>&gt;

When replying, please edit your Subject line so it is more specific
than &quot;Re: Contents of rabbitmq-discuss digest...&quot;


Today's Topics:

   1. Determining Required Erlang Version for Upgrade (Richard Raseley)
   2. Re: RabbitMQ Consumer timeout (Alan Antonuk)
   3. Re: RabbitMQ's Mirroring results in weird behavior when slave
      goes down (thomas)
   4. Re: Determining Required Erlang Version for       Upgrade
      (Michael Klishin)
   5. Re: rabbitmq Error:{cannot_discover_cluster, &quot;the nodes
      provided are either offline or not running&quot;} (Emile Joubert)
   6. Re: Determining Required Erlang Version for       Upgrade
      (Emile Joubert)
   7. Re: RabbitMQ won't start after the disk went full (Emile Joubert)
   8. Re: RabbitMQ's Mirroring results in weird behavior when slave
      goes down (Tim Watson)


----------------------------------------------------------------------

Message: 1
Date: Tue, 25 Jun 2013 12:39:15 -0700
From: Richard Raseley &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">richard at raseley.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">richard at raseley.com</A>&gt;&gt;
Subject: [rabbitmq-discuss] Determining Required Erlang Version for
        Upgrade
To: RabbitMQ-Discuss Mailing List
        &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;&gt;
Message-ID:
        &lt;CAO=<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">6ox_tTVUHNnd4VwPr2zO+iGnjb1Kr5fYT0OEadj-urYRiAA at mail.gmail.com</A>&lt;mailto:6ox_tTVUHNnd4VwPr2zO%<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">2BiGnjb1Kr5fYT0OEadj-urYRiAA at mail.gmail.com</A>&gt;&gt;
Content-Type: text/plain; charset=&quot;iso-8859-1&quot;

I am in the process of drafting a plan to upgrade several 3.0.x instances
to 3.1.2. I cannot seem to find in the release notes the specific version
of Erlang that is required for the new versions.

Would someone please direct me to a version requirement matrix (assuming
one exists)?

Regards,

Richard
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130625/196f9e67/attachment.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130625/196f9e67/attachment.html</A>&gt;

------------------------------

Message: 2
Date: Tue, 25 Jun 2013 17:36:48 -0700
From: Alan Antonuk &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">alan.antonuk at gmail.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">alan.antonuk at gmail.com</A>&gt;&gt;
Subject: Re: [rabbitmq-discuss] RabbitMQ Consumer timeout
To: Discussions about RabbitMQ &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;&gt;
Message-ID:
        &lt;CAAt2poJAP5z0-gsdNFaNaH0qzR_FLcxwK_tQEA_tmb=<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">d2CoZiA at mail.gmail.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">d2CoZiA at mail.gmail.com</A>&gt;&gt;
Content-Type: text/plain; charset=&quot;iso-8859-1&quot;

Antony;

rabbitmq-c has very recently added an API that allows for specifying a
timeout when waiting for frames from the broker (see
<A HREF="https://github.com/alanxz/rabbitmq-c/blob/master/librabbitmq/amqp.h#L495">https://github.com/alanxz/rabbitmq-c/blob/master/librabbitmq/amqp.h#L495</A> ).
 With this API is possible to implement something with a similar effect.

I will warn you that this is only in the development branch and thus hasn't
received the same amount of testing that tagged versions have, but I would
encourage you to try it out and report back any issues that come up.

-Alan


On Tue, Jun 25, 2013 at 4:56 AM, antony &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">antony.pulicken at gmail.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">antony.pulicken at gmail.com</A>&gt;&gt; wrote:

&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> This is my scenario:
</I>&gt;<i>
</I>&gt;<i> I have multiple instances of listeners waiting on different temp queues. In
</I>&gt;<i> some of the cases, there won't be any messages published to these temp
</I>&gt;<i> queues and I want these listeners to timeout so that it can free up the
</I>&gt;<i> connections.
</I>&gt;<i>
</I>&gt;<i> I guess in Java, we can achieve this by using the overloaded method in the
</I>&gt;<i> QueueingConsumer class that takes timeout as a parameter as shown below:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> /QueueingConsumer.Delivery delivery = null;
</I>&gt;<i> long timeout = 2 * 60 * 1000; // 2 minutes in milliseconds
</I>&gt;<i> delivery = queuingConsumer.nextDelivery(*timeout*);
</I>&gt;<i> if (delivery == null) {
</I>&gt;<i>   // shut down your consumer here - no events arrived
</I>&gt;<i>   // before the timeout was reached
</I>&gt;<i> }
</I>&gt;<i> else {
</I>&gt;<i>   // process the delivered message here
</I>&gt;<i> }/
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> 1) Does RabbitMQ C client also has a similar feature ?
</I>&gt;<i>
</I>&gt;<i> 2) Are there better approaches to handle this timeouts ?
</I>&gt;<i>
</I>&gt;<i> Please let me know.
</I>&gt;<i>
</I>&gt;<i> Thanks and Regards,
</I>&gt;<i> Antony.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> View this message in context:
</I>&gt;<i> <A HREF="http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-Consumer-timeout-tp27590.html">http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-Consumer-timeout-tp27590.html</A>
</I>&gt;<i> Sent from the RabbitMQ mailing list archive at Nabble.com.
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130625/3468600c/attachment-0001.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130625/3468600c/attachment-0001.htm</A>&gt;

------------------------------

Message: 3
Date: Tue, 25 Jun 2013 22:24:26 -0700 (PDT)
From: thomas &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">taihock at gmail.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">taihock at gmail.com</A>&gt;&gt;
Subject: Re: [rabbitmq-discuss] RabbitMQ's Mirroring results in weird
        behavior when slave goes down
To: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;
Message-ID: &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">1372224266044-27611.post at n5.nabble.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">1372224266044-27611.post at n5.nabble.com</A>&gt;&gt;
Content-Type: text/plain; charset=us-ascii

Hi Tim,

Thanks for the reply. I am using rabbitmq 3.1.1 with autoheal for
cluster_partition_handling.

My test is just to find out the behavior of rabbitmq master should its slave
goes down. For my case, initially I will have <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at A</A>, <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at B</A> and
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at C</A> running. Then I will send out messages from client to <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at A</A>
which is the master throughout the test. Soon after the client started to
send out messages, I will bring down a slave which in my case is <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at B</A> by
closing its network connection.

I have changed the net_ticktime to 60 and carry out the same test using the
same code but this time round i increases the number of messages to 500,000
so as to better observe the behavior of sending messages for more than a
minute.

My observation is still similar to that of my previous test where
net_ticktime is 2.
Approximately 10 seconds after I shut down the network connection of
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at B</A>, the sending of messages to <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at A</A> comes to a pause for close to
a minute and then continues as per normal.

Trying the same test but with no mirroring does not have any disruption.

By the way, I have try out the same test for rabbitmq mirroring except that
there will be a delay of 10ms between sending every message and there was no
disruption.

&gt;<i>From my observation it can be seen that RabbitMQ server will exhibit weird
</I>behavior under stress condition when a slave goes down. I presume this weird
behavior will only surface under stress condition.

Is there a rough estimate for the maximum load that a RabbitMQ server can
take per second for mirroring? Thanks.



--
View this message in context: <A HREF="http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-s-Mirroring-results-in-weird-behavior-when-slave-goes-down-tp27572p27611.html">http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-s-Mirroring-results-in-weird-behavior-when-slave-goes-down-tp27572p27611.html</A>
Sent from the RabbitMQ mailing list archive at Nabble.com.


------------------------------

Message: 4
Date: Wed, 26 Jun 2013 12:19:53 +0400
From: Michael Klishin &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">michael.s.klishin at gmail.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">michael.s.klishin at gmail.com</A>&gt;&gt;
Subject: Re: [rabbitmq-discuss] Determining Required Erlang Version
        for     Upgrade
To: Discussions about RabbitMQ &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;&gt;
Message-ID:
        &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">CAE3HoVQG8o6uiMGCU2RmasAv3qVObSF9EdN-+YKqe6-Scjd+-w at mail.gmail.com</A>&lt;mailto:CAE3HoVQG8o6uiMGCU2RmasAv3qVObSF9EdN-%2BYKqe6-Scjd%<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">2B-w at mail.gmail.com</A>&gt;&gt;
Content-Type: text/plain; charset=&quot;utf-8&quot;

2013/6/25 Richard Raseley &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">richard at raseley.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">richard at raseley.com</A>&gt;&gt;

&gt;<i> I am in the process of drafting a plan to upgrade several 3.0.x instances
</I>&gt;<i> to 3.1.2. I cannot seem to find in the release notes the specific version
</I>&gt;<i> of Erlang that is required for the new versions.
</I>

Richard,

I don't think the version requirement changed between 3.0.x and 3.1.x.
--
MK

<A HREF="http://github.com/michaelklishin">http://github.com/michaelklishin</A>
<A HREF="http://twitter.com/michaelklishin">http://twitter.com/michaelklishin</A>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130626/45de3926/attachment-0001.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130626/45de3926/attachment-0001.htm</A>&gt;

------------------------------

Message: 5
Date: Wed, 26 Jun 2013 10:22:40 +0100
From: Emile Joubert &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">emile at rabbitmq.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">emile at rabbitmq.com</A>&gt;&gt;
Subject: Re: [rabbitmq-discuss] rabbitmq
        Error:{cannot_discover_cluster, &quot;the nodes provided are either offline
        or not running&quot;}
To: Luis Rodriguez &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">lrodriguez1995 at yahoo.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">lrodriguez1995 at yahoo.com</A>&gt;&gt;,  Discussions about
        RabbitMQ &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;&gt;
Message-ID: &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">51CAB2E0.9010805 at rabbitmq.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">51CAB2E0.9010805 at rabbitmq.com</A>&gt;&gt;
Content-Type: text/plain; charset=ISO-8859-1


Hi

On 25/06/13 18:38, Luis Rodriguez wrote:
&gt;<i> I am running a windows host machine along with three vm's with centos
</I>&gt;<i> 5.9 , rabbitmq-server-3.0.3, and erlang installed on all three nodes.
</I>
Make sure all nodes are using the same version of Erlang.

&gt;<i> (I am able to ping between nodes fine)
</I>
A number of TCP ports need to be open between cluster nodes, which ping
doesn't guarantee. See

 <A HREF="http://www.rabbitmq.com/clustering.html#firewall">http://www.rabbitmq.com/clustering.html#firewall</A>

&gt;<i> the cookie hash however, doesn't change regardless of how many times
</I>&gt;<i> I stop (rabbitmqctl stop) and start.. I don't really know what I'm
</I>&gt;<i> missing.
</I>
If you change the .erlang.cookie and the cookie hash doesn't change then
you are probably copying to the wrong directory. You can discover a
running node's own idea of where its home directory is by executing

rabbitmqctl eval 'init:get_argument(home).'

Also take note that the cookie and the cookie hash will not be the same.
The hash is displayed in diagnostic output instead of the cookie as a
security precaution. If you have all the cookies synchronised correctly
then the hashes will also be the same.

&gt;<i> when I do rabbitctl join_cluster I get: rabbitmq
</I>&gt;<i> Error:{cannot_discover_cluster,&quot;the nodes provided are either offline
</I>&gt;<i> or not running&quot;}
</I>
As per the troubleshooting guide

 <A HREF="http://www.rabbitmq.com/troubleshooting.html">http://www.rabbitmq.com/troubleshooting.html</A>

if that message is accompanied by a broker logfile entry &quot;Connection
attempt from disallowed node&quot; then the erlang cookies are not set up
correctly. Otherwise the problem is network related.



-Emile








------------------------------

Message: 6
Date: Wed, 26 Jun 2013 10:25:52 +0100
From: Emile Joubert &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">emile at rabbitmq.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">emile at rabbitmq.com</A>&gt;&gt;
Subject: Re: [rabbitmq-discuss] Determining Required Erlang Version
        for     Upgrade
To: Discussions about RabbitMQ &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;&gt;
Message-ID: &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">51CAB3A0.8070707 at rabbitmq.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">51CAB3A0.8070707 at rabbitmq.com</A>&gt;&gt;
Content-Type: text/plain; charset=ISO-8859-1


Hi Richard,

On 25/06/13 20:39, Richard Raseley wrote:

&gt;<i> Would someone please direct me to a version requirement matrix (assuming
</I>&gt;<i> one exists)?
</I>
See <A HREF="http://www.rabbitmq.com/which-erlang.html">http://www.rabbitmq.com/which-erlang.html</A>



-Emile








------------------------------

Message: 7
Date: Wed, 26 Jun 2013 10:35:45 +0100
From: Emile Joubert &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">emile at rabbitmq.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">emile at rabbitmq.com</A>&gt;&gt;
Subject: Re: [rabbitmq-discuss] RabbitMQ won't start after the disk
        went full
To: Discussions about RabbitMQ &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;&gt;
Cc: photon &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">faycal.noushi at gmail.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">faycal.noushi at gmail.com</A>&gt;&gt;
Message-ID: &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">51CAB5F1.20202 at rabbitmq.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">51CAB5F1.20202 at rabbitmq.com</A>&gt;&gt;
Content-Type: text/plain; charset=ISO-8859-1


Hi,

On 25/06/13 14:38, photon wrote:

&gt;<i>  I have an issue concerning RabbitMQ. Once my disk got full, RabbitMQ became
</I>&gt;<i> unusable. This didn't change even after i made the disk usage drop
</I>&gt;<i> dramatically.
</I>
You either need to free up more space or lower the disk_free_limit. See
the configuration guide:

 <A HREF="http://www.rabbitmq.com/configure.html">http://www.rabbitmq.com/configure.html</A>

&gt;<i> Error description:
</I>&gt;<i>    {error,corrupt_cluster_status_files,[]}
</I>
This is a separate problem and can be solved either by removing the
entire Mnesia directory or by removing the cluster_nodes.config file in
the Mnesia directory and reclustering if necessary.

&gt;<i> =INFO REPORT==== 25-Jun-2013::09:10:49 ===
</I>&gt;<i> Disk free space insufficient. Free bytes:645095424 Limit:1000000000
</I>

This shows that there is insufficient free disk space. The broker will
not accept any messages until there is enough free disk space. See

 <A HREF="http://www.rabbitmq.com/memory.html#diskfreesup">http://www.rabbitmq.com/memory.html#diskfreesup</A>



-Emile











------------------------------

Message: 8
Date: Wed, 26 Jun 2013 11:38:36 +0100
From: Tim Watson &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">tim at rabbitmq.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">tim at rabbitmq.com</A>&gt;&gt;
Subject: Re: [rabbitmq-discuss] RabbitMQ's Mirroring results in weird
        behavior when slave goes down
To: Discussions about RabbitMQ &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;&gt;
Message-ID: &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">2F050250-E7F1-4543-B3C3-239885F7C9CB at rabbitmq.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">2F050250-E7F1-4543-B3C3-239885F7C9CB at rabbitmq.com</A>&gt;&gt;
Content-Type: text/plain; charset=us-ascii

Hi Thomas,

Here are my thoughts (inline below). I'm not the greatest clustering/HA expert, but from what I can gather, I think what you're seeing might be a result of the combination of a network partition and the `autoheal' mode.

On 26 Jun 2013, at 06:24, thomas wrote:

&gt;<i> Hi Tim,
</I>&gt;<i>
</I>&gt;<i> Thanks for the reply. I am using rabbitmq 3.1.1 with autoheal for
</I>&gt;<i> cluster_partition_handling.
</I>&gt;<i>
</I>&gt;<i> My test is just to find out the behavior of rabbitmq master should its slave
</I>&gt;<i> goes down.
</I>
This is clearly documented on the website - RabbitMQ clusters /do not/ handle network partitions well. Things will probably go wrong. If the only issue you're running into is a busy producer getting blocked then that's great - the worst cases could have involved lost messages and all sorts.

Now, the intention with HA is *not* to go belly up in the face of disappearing slaves - quite the opposite. Quite why the master is suddenly blocking the producer I'm not sure - I'll discuss this with the rest of the team but it doesn't sound quite right to me.

&gt;<i> Approximately 10 seconds after I shut down the network connection of
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at B</A>, the sending of messages to <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at A</A> comes to a pause for close to
</I>&gt;<i> a minute and then continues as per normal.
</I>&gt;<i>
</I>
Just to be clear, in a RabbitMQ cluster there is no concept of a master node - only mirror queues introduce the master/slave concept, and then only for queues that are mirrored. Each mirrored queue's master can end up on different nodes, depending on which you were connect to when it was declared.

&gt;<i> Trying the same test but with no mirroring does not have any disruption.
</I>&gt;<i>
</I>
That is not surprising, since the queue you're connected to isn't trying to replicate to any other nodes.

&gt;<i> By the way, I have try out the same test for rabbitmq mirroring except that
</I>&gt;<i> there will be a delay of 10ms between sending every message and there was no
</I>&gt;<i> disruption.
</I>&gt;<i>
</I>
Can you share your test code? I'm surprised there is such a big difference, but still... If you've got a decent automated test that consistently replicates this failure mode and you're able to share it, we might be able to use it to make improvements to partition handling in the future. If not code, a test script (and description of how you're disabling the network link) with precise steps would do.

&gt;<i> From my observation it can be seen that RabbitMQ server will exhibit weird
</I>&gt;<i> behavior under stress condition when a slave goes down. I presume this weird
</I>&gt;<i> behavior will only surface under stress condition.
</I>&gt;<i>
</I>
As I've stated before, clustering is not designed to handle network partitions. In previous versions of rabbit, when a partition occurred it was up to a system administrator to handle it. This usually involved stopping some (or all) of the nodes and restarting them. The 'autoheal' feature simply attempts to replicate what a sysadmin might do, and therefore (whilst cluster nodes are restarting) there can be delays. The intention is not to block the master (or producers), but depending on how the cluster partition is handled, that might be one of the potential side effects.

We will certainly take a look to see if this is avoidable - I can't comment on that right now - and being able to repeat the tests could help with that too.

&gt;<i> Is there a rough estimate for the maximum load that a RabbitMQ server can
</I>&gt;<i> take per second for mirroring? Thanks.
</I>&gt;<i>
</I>
I'm not sure whether mirroring is really the problem here. Mirrored queues can handle plenty of load, although there /is/ some performance slow down due to replication (and esp. so if you're using publisher confirms) but there is a not a specific limit - this is hardware/resource and use-case dependent. I suspect the problem /you/ have could be a combination of network partition and cluster partition resolution (i.e., autoheal) mode.

Based on <A HREF="http://www.rabbitmq.com/partitions.html,">http://www.rabbitmq.com/partitions.html,</A> what I'd suggest is that you change 'autoheal' to 'ignore' and try your test again. That will either confirm or eliminate my suspicion quickly enough.

Cheers,
Tim



------------------------------

_______________________________________________
rabbitmq-discuss mailing list
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>


End of rabbitmq-discuss Digest, Vol 73, Issue 27
************************************************


________________________________

DISCLAIMER:
This email (including any attachments) is intended for the sole use of the intended recipient/s and may contain material that is CONFIDENTIAL AND PRIVATE COMPANY INFORMATION. Any review or reliance by others or copying or distribution or forwarding of any or all of the contents in this message is STRICTLY PROHIBITED. If you are not the intended recipient, please contact the sender by email and delete all copies; your cooperation in this regard is appreciated.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130705/7063923c/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130705/7063923c/attachment.htm</A>&gt;
</PRE>































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="028346.html">[rabbitmq-discuss] [Bug] Memory leak in 3.1.3 (Ubuntu)
</A></li>
	<LI>Next message: <A HREF="028353.html">[rabbitmq-discuss] RabbitMQ Consumer timeout (Alan Antonuk)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28350">[ date ]</a>
              <a href="thread.html#28350">[ thread ]</a>
              <a href="subject.html#28350">[ subject ]</a>
              <a href="author.html#28350">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
