<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ RPC in Tomcat container
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20RPC%20in%20Tomcat%20container&In-Reply-To=%3C1E524918-1C4A-4BDA-A9C0-2C39873C7D20%40gopivotal.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="028859.html">
   <LINK REL="Next"  HREF="028902.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ RPC in Tomcat container</H1>
    <B>Michael Klishin</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20RPC%20in%20Tomcat%20container&In-Reply-To=%3C1E524918-1C4A-4BDA-A9C0-2C39873C7D20%40gopivotal.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ RPC in Tomcat container">mklishin at gopivotal.com
       </A><BR>
    <I>Thu Jul 25 05:30:14 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="028859.html">[rabbitmq-discuss] RabbitMQ RPC in Tomcat container
</A></li>
        <LI>Next message: <A HREF="028902.html">[rabbitmq-discuss] RabbitMQ RPC in Tomcat container
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28864">[ date ]</a>
              <a href="thread.html#28864">[ thread ]</a>
              <a href="subject.html#28864">[ subject ]</a>
              <a href="author.html#28864">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">steven.willems at i-develop.be</A>:

&gt;<i> I find that a bit odd.. I would expect that when I call stub.channel.basicCancel(consumer.getConsumerTag()); the runnable for the consumer is removed. 
</I>&gt;<i> 
</I>&gt;<i> Or am I completely wrong about my findings and is something else going on?
</I>
You are right, RabbitMQ Java client does start new threads (which in theory apps deployed
to app containers should not do):

 * Network activity loop (one per connection)
 * Consumer work pool (one per channel)

Work pools cannot be cancelled after basicCancel because there can be more than
one consumer on the channel.

Some clients [1] solve this by tracking how many consumers are registered on the
channel and when the last one is gone, shut down any threads that were created
to handle deliveries.

It may be a good idea for to the Java client to do the same. In the meantime, closing
channels and then connection on shutdown should help.

1. <A HREF="http://rubybunny.info">http://rubybunny.info</A>
--
MK

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130725/295208a5/attachment.pgp">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130725/295208a5/attachment.pgp</A>&gt;
</PRE>




































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="028859.html">[rabbitmq-discuss] RabbitMQ RPC in Tomcat container
</A></li>
	<LI>Next message: <A HREF="028902.html">[rabbitmq-discuss] RabbitMQ RPC in Tomcat container
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28864">[ date ]</a>
              <a href="thread.html#28864">[ thread ]</a>
              <a href="subject.html#28864">[ subject ]</a>
              <a href="author.html#28864">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
