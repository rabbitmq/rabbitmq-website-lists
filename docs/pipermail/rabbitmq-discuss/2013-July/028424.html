<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Program crashes in amqp_abort() on HP-UX	11.31
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Program%20crashes%20in%20amqp_abort%28%29%20on%20HP-UX%0A%0911.31&In-Reply-To=%3CCAM8fPiRSfhCDCpHdUnxHxG%2BfjJ4q-aoV9reMUEzd9fZAGaBeWQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="028423.html">
   <LINK REL="Next"  HREF="028425.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Program crashes in amqp_abort() on HP-UX	11.31</H1>
    <B>Tony Garnock-Jones</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Program%20crashes%20in%20amqp_abort%28%29%20on%20HP-UX%0A%0911.31&In-Reply-To=%3CCAM8fPiRSfhCDCpHdUnxHxG%2BfjJ4q-aoV9reMUEzd9fZAGaBeWQ%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Program crashes in amqp_abort() on HP-UX	11.31">tonygarnockjones+rabbitmq at gmail.com
       </A><BR>
    <I>Tue Jul  9 13:35:38 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="028423.html">[rabbitmq-discuss] Program crashes in amqp_abort() on HP-UX	11.31
</A></li>
        <LI>Next message: <A HREF="028425.html">[rabbitmq-discuss] Program crashes in amqp_abort() on HP-UX	11.31
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28424">[ date ]</a>
              <a href="thread.html#28424">[ thread ]</a>
              <a href="subject.html#28424">[ subject ]</a>
              <a href="author.html#28424">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 9 July 2013 07:30, Haster &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">haster2004 at yandex.ru</A>&gt; wrote:

&gt;<i> first thread creates all things (connection, channels to queue and
</I>&gt;<i> exchanges), call basic.consume and start new thread that reads messages
</I>&gt;<i> from
</I>&gt;<i> queue and processes them...
</I>&gt;<i>
</I>
In principle, this is fine. I would still not do it, myself: instead, I
would never let a connection &quot;cross over&quot; between threads. But that's
probably just superstitious of me :-)


&gt;<i> But first thread can call one method, that add some binds and maybe declare
</I>&gt;<i> new exchanges
</I>&gt;<i>
</I>
Aha! OK. Yes, that is probably the cause of the problem.

Try making sure that each thread has its own private connection to the
broker. Perhaps the thread that only occasionally needs to use a connection
could create it when needed, and destroy it when it is finished.

Connections *must* not be shared between threads[1].


&gt;<i> But can it be the root of problem?
</I>&gt;<i> I use separate channel for each used exchange and queue.
</I>&gt;<i>
</I>
There is *no* locking in librabbitmq, so *any* use of a connection across
threads requires you to do the locking manually.


&gt;<i> And one thing for thinking. My program crashes only on HP-UX 11.31, on
</I>&gt;<i> windows, Solaris and Linux Red Hat it works well
</I>&gt;<i>
</I>
My guess is that this is just chance. If two threads are sharing a single
librabbitmq connection without any mutexing, then the bug exists on all
platforms, even if it doesn't manifest deterministically.

Regards,
  Tony

[1] Unless you do some locking yourself, which is difficult and
error-prone, and not something I'd recommend.
-- 
Tony Garnock-Jones
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">tonygarnockjones at gmail.com</A>
<A HREF="http://homepages.kcbbs.gen.nz/tonyg/">http://homepages.kcbbs.gen.nz/tonyg/</A>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130709/21393eb7/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130709/21393eb7/attachment.htm</A>&gt;
</PRE>




















































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="028423.html">[rabbitmq-discuss] Program crashes in amqp_abort() on HP-UX	11.31
</A></li>
	<LI>Next message: <A HREF="028425.html">[rabbitmq-discuss] Program crashes in amqp_abort() on HP-UX	11.31
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28424">[ date ]</a>
              <a href="thread.html#28424">[ thread ]</a>
              <a href="subject.html#28424">[ subject ]</a>
              <a href="author.html#28424">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
