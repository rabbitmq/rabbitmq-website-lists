<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] why rabbit eating so much memory?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20why%20rabbit%20eating%20so%20much%20memory%3F&In-Reply-To=%3C51E67978.9060206%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="028614.html">
   <LINK REL="Next"  HREF="028433.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] why rabbit eating so much memory?</H1>
    <B>Emile Joubert</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20why%20rabbit%20eating%20so%20much%20memory%3F&In-Reply-To=%3C51E67978.9060206%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] why rabbit eating so much memory?">emile at rabbitmq.com
       </A><BR>
    <I>Wed Jul 17 12:01:12 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="028614.html">[rabbitmq-discuss] why rabbit eating so much memory?
</A></li>
        <LI>Next message: <A HREF="028433.html">[rabbitmq-discuss] Possible RabbitMQ 3.0.4 Management Plug-in (Mochiweb) Directory Traversal Vulnerability?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28621">[ date ]</a>
              <a href="thread.html#28621">[ thread ]</a>
              <a href="subject.html#28621">[ subject ]</a>
              <a href="author.html#28621">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Hi,

On 17/07/13 03:18, Rubo Liang wrote:
&gt;<i> Meet this problem again today.
</I>&gt;<i> 
</I>&gt;<i> see 'rabbitmqctl report' output
</I>&gt;<i> at: <A HREF="https://gist.github.com/liangrubo/6017129">https://gist.github.com/liangrubo/6017129</A>
</I>
Thanks for sending this information. The report shows that queues use
less that 3Mb of RAM. It also shows ~500 connections and channels. If
your application needs that many channels then that is nothing to worry
about. There is nothing there that would explain why 23Gb of RAM is
being used though.

The memory appears to grow only on the slave nodes. I see that
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at in16-011</A> is the master node for all queues and does not suffer
from excessive memory use. In order to pinpoint the source of the leak,
could you please execute another command on both slave nodes, one after
the other? For each slave node do the following:

If you are able to bring more swapspace online then please do so. If
there are any other non-critical processes on the machine then please
stop them, as this command has the potential to impose heavy load.
Please be aware that this command could cause the node to crash. If you
are not comfortable with this prospect then don't proceed.

Otherwise please run this command:

rabbitmqctl eval 'io:put_chars(standard_error, &quot;this should appear in
startup_err\n&quot;).'

and check that the expected text appeared in startup_err (normally in
/var/log/rabbitmq). If the text did not appear then do not proceed.

Otherwise please run this command:

rabbitmqctl eval 'erlang:process_display(element(2,
hd(lists:reverse(lists:sort([{process_info(P, memory), P} || P &lt;-
erlang:processes()])))), backtrace).'

The command will return and the startup_err file should start growing
soon afterwards. It could take a long time until it stops growing. When
it stops growing then repeat the process for the other slave node.
Please compress and send both startup_err files to me.



-Emile



</PRE>


































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="028614.html">[rabbitmq-discuss] why rabbit eating so much memory?
</A></li>
	<LI>Next message: <A HREF="028433.html">[rabbitmq-discuss] Possible RabbitMQ 3.0.4 Management Plug-in (Mochiweb) Directory Traversal Vulnerability?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28621">[ date ]</a>
              <a href="thread.html#28621">[ thread ]</a>
              <a href="subject.html#28621">[ subject ]</a>
              <a href="author.html#28621">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
