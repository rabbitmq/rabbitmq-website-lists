<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Trouble with confirms
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Trouble%20with%20confirms&In-Reply-To=%3C51F69780.6080602%40timgroup.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="028948.html">
   <LINK REL="Next"  HREF="028962.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Trouble with confirms</H1>
    <B>Tom Anderson</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Trouble%20with%20confirms&In-Reply-To=%3C51F69780.6080602%40timgroup.com%3E"
       TITLE="[rabbitmq-discuss] Trouble with confirms">tom.anderson at timgroup.com
       </A><BR>
    <I>Mon Jul 29 17:25:36 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="028948.html">[rabbitmq-discuss] Trouble with confirms
</A></li>
        <LI>Next message: <A HREF="028962.html">[rabbitmq-discuss] Trouble with confirms
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28960">[ date ]</a>
              <a href="thread.html#28960">[ thread ]</a>
              <a href="subject.html#28960">[ subject ]</a>
              <a href="author.html#28960">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 29/07/13 13:40, Matthias Radestock wrote:
&gt;<i> On 29/07/13 13:30, Tom Anderson wrote:
</I>&gt;&gt;<i> On 26/07/13 23:32, Matthias Radestock wrote:
</I>&gt;&gt;&gt;<i> On 26/07/13 18:29, Tom Anderson wrote:
</I>&gt;&gt;&gt;&gt;<i> &quot;The broker will confirm messages once:
</I>&gt;&gt;&gt;&gt;<i> [...]
</I>&gt;&gt;&gt;&gt;<i> * a transient message has reached all its queues
</I>&gt;&gt;&gt;&gt;<i> [...]
</I>&gt;&gt;&gt;&gt;<i> So, if i send a persistent message (delivery mode = 2) to a 
</I>&gt;&gt;&gt;&gt;<i> non-durable
</I>&gt;&gt;&gt;&gt;<i> exchange which routes to a non-durable queue, then i will only get a
</I>&gt;&gt;&gt;&gt;<i> confirmation once the message has been consumed from that queue, 
</I>&gt;&gt;&gt;&gt;<i> right?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Wrong. The behaviour is described in the snippet you quoted above,
</I>&gt;&gt;&gt;<i> i.e. the message gets confirmed once it has reached all the queues it
</I>&gt;&gt;&gt;<i> was routed to.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Okay. Just to clarify: the bit of the snippet i quoted that you quoted
</I>&gt;&gt;<i> says &quot;a transient message&quot;. I understood that as specifically referring
</I>&gt;&gt;<i> to transient messages, not persistent ones, ie those sent with delivery
</I>&gt;&gt;<i> mode 1 rather than 2. I was asking about persistent messages. Are you
</I>&gt;&gt;<i> telling me that the behaviour for persistent messages is actually the
</I>&gt;&gt;<i> same as that specified for transient messages?
</I>&gt;<i>
</I>&gt;<i> Messages persistence requires the combination of
</I>&gt;<i> 1) delivery_mode = 2
</I>&gt;<i> 2) routing to a durable queue
</I>&gt;<i>
</I>&gt;<i> Condition #2 is not met in your case, so the message is not persisted, 
</I>&gt;<i> i.e. it is treated as a transient message.
</I>
Aha. I didn't realise, that, thanks.

What i'm looking for is a way to get some sort of feedback at the sender 
when a message has been acknowledged by the consumer. Given that 
transient messages are confirmed as soon as the message has reached the 
queue, and persistent messages are confirmed as soon as they are written 
to disk, am i right in concluding that there is no way to do this with 
confirms? Is there any other mechanism in RabbitMQ that might let me do 
this?

My real goal here is to write a test for an application of ours, to 
assert that it is only acknowledging messages after it has successfully 
processed them, and not immediately on receipt. If anyone has any 
thoughts on how i might be able to do that, i would be very excited to 
hear them!

Thanks,
tom

-- 

Tom Anderson | Developer | +44 20 7826 4312 | timgroup.com 
&lt;<A HREF="http://timgroup.com/">http://timgroup.com/</A>&gt;

STATEMENT OF CONFIDENTIALITY: The information contained in this 
electronic message and any attachments to this message are intended for 
the exclusive use of the addressee(s) and may contain confidential or 
privileged information. If you are not the intended recipient, please 
notify Tom Anderson at TIM Group at <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">tom.anderson at timgroup.com</A> and 
destroy all copies of this message and any attachments.

TIM Group is the trading name for YouDevise Limited. YouDevise Limited 
is registered in England, No. 3331176. Registered office: 3 Copthall 
Avenue, London, EC2R 7BH.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130729/7965ed17/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130729/7965ed17/attachment.htm</A>&gt;
</PRE>










<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="028948.html">[rabbitmq-discuss] Trouble with confirms
</A></li>
	<LI>Next message: <A HREF="028962.html">[rabbitmq-discuss] Trouble with confirms
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28960">[ date ]</a>
              <a href="thread.html#28960">[ thread ]</a>
              <a href="subject.html#28960">[ subject ]</a>
              <a href="author.html#28960">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
