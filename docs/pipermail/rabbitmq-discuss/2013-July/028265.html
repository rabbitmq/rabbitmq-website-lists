<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ's Mirroring results in weird	behavior when slave goes down
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%27s%20Mirroring%20results%20in%20weird%0A%09behavior%20when%20slave%20goes%20down&In-Reply-To=%3C19EF4FB2-2ABE-42A4-8A81-F64BB52C8D69%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="028773.html">
   <LINK REL="Next"  HREF="028266.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ's Mirroring results in weird	behavior when slave goes down</H1>
    <B>Tim Watson</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%27s%20Mirroring%20results%20in%20weird%0A%09behavior%20when%20slave%20goes%20down&In-Reply-To=%3C19EF4FB2-2ABE-42A4-8A81-F64BB52C8D69%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ's Mirroring results in weird	behavior when slave goes down">tim at rabbitmq.com
       </A><BR>
    <I>Wed Jul  3 10:46:34 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="028773.html">[rabbitmq-discuss] Error in declaring a queue.
</A></li>
        <LI>Next message: <A HREF="028266.html">[rabbitmq-discuss] Shunting messages from one queue to another
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28265">[ date ]</a>
              <a href="thread.html#28265">[ thread ]</a>
              <a href="subject.html#28265">[ subject ]</a>
              <a href="author.html#28265">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Thomas,

On 27 Jun 2013, at 02:18, thomas wrote:

&gt;<i> I have tried using ignore instead of autoheal for cluster_partition_handling
</I>&gt;<i> but the pause still persist, but the pause begins approximately 20 seconds
</I>&gt;<i> after bringing down the mirror node. 
</I>&gt;<i> 
</I>
That won't help you I'm afraid.

&gt;<i> Please kindly let me know if you experience the same problem as I can't be
</I>&gt;<i> sure if there could be any problem on my side which I doubt so. Thanks.
</I>&gt;<i> 
</I>
There's nothing wrong with your sending code. The issue appears to be that the channel is expecting to receive credit (during normal flow control) from not just the master queue process, but from all the slaves too. This can cause a delay of up to (and even exceeding) net_ticktime, basically until the node notices that its peer has gone away. The reason why introducing a delay to the publishing rate stops the pause, is that when publishing slows down, we don't end up hitting flow control and the logic that's waiting for slaves therefore doesn't kick in.

Lowering the net_ticktime can alleviate this to some extent, but will not solve the problem consistently as there's always going to be a possibility of delay (depending on the current load, network characteristics, etc). You should also bear in mind that lowering the net_ticktime too much can be quite dangerous if the network is already under considerable load, since ticks might get lost behind other traffic, leading to false (unwanted) net-splits occurring.

I have filed a bug to try and improve this behaviour (in the face of slave deaths) and will try to get the fix into the next patch release. Thanks for reporting this behaviour, and for sticking with the conversation while we worked through the possible causes.

Cheers,
Tim

</PRE>




















































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="028773.html">[rabbitmq-discuss] Error in declaring a queue.
</A></li>
	<LI>Next message: <A HREF="028266.html">[rabbitmq-discuss] Shunting messages from one queue to another
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28265">[ date ]</a>
              <a href="thread.html#28265">[ thread ]</a>
              <a href="subject.html#28265">[ subject ]</a>
              <a href="author.html#28265">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
