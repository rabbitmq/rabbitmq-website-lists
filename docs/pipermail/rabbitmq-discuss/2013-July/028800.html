<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ hanging during 'rabbitmqctl stop' -	please help
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20hanging%20during%20%27rabbitmqctl%20stop%27%20-%0A%09please%20help&In-Reply-To=%3C51EE959D.1040200%40gazzang.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="028885.html">
   <LINK REL="Next"  HREF="028900.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ hanging during 'rabbitmqctl stop' -	please help</H1>
    <B>Casey Marshall</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20hanging%20during%20%27rabbitmqctl%20stop%27%20-%0A%09please%20help&In-Reply-To=%3C51EE959D.1040200%40gazzang.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ hanging during 'rabbitmqctl stop' -	please help">casey.marshall at gazzang.com
       </A><BR>
    <I>Tue Jul 23 15:39:25 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="028885.html">[rabbitmq-discuss] Recipe for corrupting mnesia in a cluster
</A></li>
        <LI>Next message: <A HREF="028900.html">[rabbitmq-discuss] RabbitMQ hanging during 'rabbitmqctl stop' -	please help
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28800">[ date ]</a>
              <a href="thread.html#28800">[ thread ]</a>
              <a href="subject.html#28800">[ subject ]</a>
              <a href="author.html#28800">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'm using RabbitMQ federated exchanges among a number of servers. Each
server has upstream exchanges on each of the others. I don't want to
call it a cluster, since that has another meaning in RabbitMQ altogether
... let's call it a &quot;federated group&quot;.

This worked fine over AMQP, both in my own local KVM-virtualized testing
environment, and it seemed to as well in Amazon EC2 with unencrypted
AMQP. However, I need to secure the connections in EC2 with AMQPS before
we go into production.

I was able to automate creation and distribution of certificates among
the servers, and the setup works fine in a local KVM-virtualized
environment. However, when I started testing it in EC2 across regions, I
started having problems. RabbitMQ hangs on some of the servers in EC2
during 'service rabbitmq-server restart'.

I have scripts to automate updating the federated exchanges, to effect
topology changes on the &quot;federated group&quot; -- adding or removing a
server, or changing its role (different roles have different exchange
upstreams). After this script updates the federation config, the
subsequent restart hangs on some of the servers.

What should I do to make my RabbitMQ &quot;federated group&quot; more robust?

I've attached:

1. rabbitmq.log and rabbitmq-sasl.log excerpt from one of the hosts that
persistently gets stuck during a RabbitMQ 'stop', near the time of the hang.
2. 'rabbitmqctl status' from that host.

Installed on the system:

ii  esl-erlang                       1:16.b.1-1~ubuntu~precise       Erlang
ii  rabbitmq-server                  3.1.3-1
AMQP server written in Erlang

Much thanks,
Casey
-------------- next part --------------
A non-text attachment was scrubbed...
Name: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at ip-10-234-134-253.log</A>
Type: text/x-log
Size: 23477 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130723/e5bd98be/attachment.bin">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130723/e5bd98be/attachment.bin</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at ip-10-234-134-253-sasl.log</A>
Type: text/x-log
Size: 7398 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130723/e5bd98be/attachment-0001.bin">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130723/e5bd98be/attachment-0001.bin</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: report.log
Type: text/x-log
Size: 16517 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130723/e5bd98be/attachment-0002.bin">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130723/e5bd98be/attachment-0002.bin</A>&gt;
</PRE>































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="028885.html">[rabbitmq-discuss] Recipe for corrupting mnesia in a cluster
</A></li>
	<LI>Next message: <A HREF="028900.html">[rabbitmq-discuss] RabbitMQ hanging during 'rabbitmqctl stop' -	please help
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28800">[ date ]</a>
              <a href="thread.html#28800">[ thread ]</a>
              <a href="subject.html#28800">[ subject ]</a>
              <a href="author.html#28800">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
