<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Push to back of Queue on NAck
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Push%20to%20back%20of%20Queue%20on%20NAck&In-Reply-To=%3C51F29A82.8040302%40timgroup.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="028922.html">
   <LINK REL="Next"  HREF="028924.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Push to back of Queue on NAck</H1>
    <B>Tom Anderson</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Push%20to%20back%20of%20Queue%20on%20NAck&In-Reply-To=%3C51F29A82.8040302%40timgroup.com%3E"
       TITLE="[rabbitmq-discuss] Push to back of Queue on NAck">tom.anderson at timgroup.com
       </A><BR>
    <I>Fri Jul 26 16:49:22 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="028922.html">[rabbitmq-discuss] Push to back of Queue on NAck
</A></li>
        <LI>Next message: <A HREF="028924.html">[rabbitmq-discuss] Push to back of Queue on NAck
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28923">[ date ]</a>
              <a href="thread.html#28923">[ thread ]</a>
              <a href="subject.html#28923">[ subject ]</a>
              <a href="author.html#28923">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 26/07/13 14:18, Matthias Radestock wrote:
&gt;<i> On 26/07/13 13:25, Will Hughes wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Another option I was thinking of to enforce more a delay was to see if I
</I>&gt;&gt;<i> could chain together two queues using dead-letter-exchange settings:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Queue A, no TTL, DLX=Exchange B (with Queue B bound to it).
</I>&gt;&gt;<i> Queue B, ttl of (x) seconds, DLX= Exchange A (with Queue A bound to it).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> When we NAck the mesage from Queue A, we set requeue=false.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I've not seen much discussion so far on whether it's sane to hook up two
</I>&gt;&gt;<i> queues/exchanges in a loop like this.
</I>&gt;<i>
</I>&gt;<i> Yep, that makes perfect sense and should work well.
</I>
Implemented exactly as described there, it yields an infinite loop for 
unprocessable messages. You might therefore also want to keep a count of 
the number of processing attempts in a header on the message, and more 
thoroughly reject messages which reach some maximum number of attempts. 
I think you could do the final rejection by setting a routing key on the 
message when you reject it for the last time, and having exchange B be a 
direct exchange which routes to either queue B or some final deadletter 
queue.

If you want exponential backoff in the retries, then life gets more 
complicated (multiple timeout queues, selected between by a routing key 
set by the consumer of A?). We are currently pussyfooting around this 
issue at my company. I will report back here if we ever implement a good 
solution!

tom

-- 

Tom Anderson | Developer | +44 20 7826 4312 | timgroup.com 
&lt;<A HREF="http://timgroup.com/">http://timgroup.com/</A>&gt;

STATEMENT OF CONFIDENTIALITY: The information contained in this 
electronic message and any attachments to this message are intended for 
the exclusive use of the addressee(s) and may contain confidential or 
privileged information. If you are not the intended recipient, please 
notify Tom Anderson at TIM Group at <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">tom.anderson at timgroup.com</A> and 
destroy all copies of this message and any attachments.

TIM Group is the trading name for YouDevise Limited. YouDevise Limited 
is registered in England, No. 3331176. Registered office: 3 Copthall 
Avenue, London, EC2R 7BH.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130726/d8ddf1c3/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130726/d8ddf1c3/attachment.htm</A>&gt;
</PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="028922.html">[rabbitmq-discuss] Push to back of Queue on NAck
</A></li>
	<LI>Next message: <A HREF="028924.html">[rabbitmq-discuss] Push to back of Queue on NAck
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28923">[ date ]</a>
              <a href="thread.html#28923">[ thread ]</a>
              <a href="subject.html#28923">[ subject ]</a>
              <a href="author.html#28923">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
