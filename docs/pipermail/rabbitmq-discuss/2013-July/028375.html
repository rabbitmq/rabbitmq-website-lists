<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] cluster memory alarm blocks producer too long
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20cluster%20memory%20alarm%20blocks%20producer%20too%20long&In-Reply-To=%3C51DA6A45.4020504%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="028372.html">
   <LINK REL="Next"  HREF="028373.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] cluster memory alarm blocks producer too long</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20cluster%20memory%20alarm%20blocks%20producer%20too%20long&In-Reply-To=%3C51DA6A45.4020504%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] cluster memory alarm blocks producer too long">matthias at rabbitmq.com
       </A><BR>
    <I>Mon Jul  8 08:29:09 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="028372.html">[rabbitmq-discuss] cluster memory alarm blocks producer too long
</A></li>
        <LI>Next message: <A HREF="028373.html">[rabbitmq-discuss] Program crashes in amqp_abort() on HP-UX 11.31
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28375">[ date ]</a>
              <a href="thread.html#28375">[ thread ]</a>
              <a href="subject.html#28375">[ subject ]</a>
              <a href="author.html#28375">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 08/07/13 06:07, richmonkey wrote:
&gt;<i> I have decided not to use rabbitmq mirror queue.
</I>&gt;<i> The testing working is stopped.
</I>
Just to be clear, are you saying that the problem went away when using 
ordinary, non-mirrored queues?

&gt;<i> To reproduce the problem, just start a little of very simple producer and a
</I>&gt;<i> little of very simple consumer followed the step that I mentioned.
</I>
I tried that and cannot reproduce the problem.

I don't have the exact same environment - I'm on Ubuntu rather than 
centos and ran the two nodes on a single machine with 12GB of RAM, 
dropping the vm_memory_highwatermark to 0.2 to compensate for the 
sharing - but that shouldn't make a difference.

I set the ha policy with

   rabbitmqctl set_policy ha-all &quot;^ha\.&quot; '{&quot;ha-mode&quot;:&quot;all&quot;}'

and then ran our universal MulticastMain test program that ships with 
the Java client, as follows...

1) sh ./runjava.sh com.rabbitmq.examples.MulticastMain -u ha.q -x 4 -n 2 
-q 1 -f persistent

This creates a durable queue named 'ha.q' to which the above mirroring 
policy applies, and starts four producers that publish tiny (tens of 
bytes) persistent messages to it

I then watched the queue length with 'rabbitmqctl list_queues' and when 
it hit ~1M (after about 3 minutes) I ran a second instance of 
MulticastMain with

2) sh ./runjava.sh com.rabbitmq.examples/MulticastMain -u ha.q -x 0 -f 
persistent -y 4

This starts four consumers that consume from the above queue in 'ack' mode.


I can run the above forever without hitting the memory alarm on either 
the node with the queue master or slave.


So I am guessing your test is not quite as straightforward as you 
describe. Or our test environments are too different. To rule out the 
latter, please run the above test against your setup and report whether 
you are seeing memory alarms, and pro-longed memory alarms at the slave, 
which you encounter in your own tests.


Regards,

Matthias.
</PRE>


































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="028372.html">[rabbitmq-discuss] cluster memory alarm blocks producer too long
</A></li>
	<LI>Next message: <A HREF="028373.html">[rabbitmq-discuss] Program crashes in amqp_abort() on HP-UX 11.31
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28375">[ date ]</a>
              <a href="thread.html#28375">[ thread ]</a>
              <a href="subject.html#28375">[ subject ]</a>
              <a href="author.html#28375">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
