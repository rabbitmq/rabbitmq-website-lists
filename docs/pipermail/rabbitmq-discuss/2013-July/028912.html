<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Queue disappear from nodes in clusters
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Queue%20disappear%20from%20nodes%20in%20clusters&In-Reply-To=%3C51F244AC.5080000%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="028903.html">
   <LINK REL="Next"  HREF="028904.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Queue disappear from nodes in clusters</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Queue%20disappear%20from%20nodes%20in%20clusters&In-Reply-To=%3C51F244AC.5080000%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Queue disappear from nodes in clusters">simon at rabbitmq.com
       </A><BR>
    <I>Fri Jul 26 10:43:08 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="028903.html">[rabbitmq-discuss] Queue disappear from nodes in clusters
</A></li>
        <LI>Next message: <A HREF="028904.html">[rabbitmq-discuss] forking and getting or consuming messages
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28912">[ date ]</a>
              <a href="thread.html#28912">[ thread ]</a>
              <a href="subject.html#28912">[ subject ]</a>
              <a href="author.html#28912">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 26/07/2013 12:54AM, vantheshark wrote:
&gt;<i> Hi Simon,
</I>&gt;<i>
</I>&gt;<i> I think the log files are too big (2Gb) to upload here, even after I
</I>&gt;<i> compress it.
</I>
Hmm; what about the -sasl.log files? Those should contain the crashes in 
question.

&gt;<i> However, these are some lines like this in node2
</I>&gt;<i> /
</I>&gt;<i> Mirrored-queue (queue 'MyQueue_Priority3' in vhost '/'): Master
</I>&gt;<i> &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at queue2.2.2114.1</A>&gt; saw deaths of mirrors &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at queue3.1.365.1</A>&gt;
</I>&gt;<i> /
</I>&gt;<i>
</I>&gt;<i> &quot;MyQueue_Priority3&quot; was the one vanished.
</I>
That's just a normal message from queue mirroring - we log whenever a 
mirror dies.

&gt;<i> I assume all exchanges and queues are mirrored across nodes in
</I>&gt;<i> this cluster so even 1 node down, the data should not be lost?
</I>
Exchanges are always mirrored. Queues are if you turn on queue mirroring 
(which it sounds like you have).

But there is evidence of something crashing in the logs you posted, so I 
want to see what's going on there. I suspect that's why the queue 
vanished. Certainly it shouldn't just do that.

&gt;<i> I also used wan IPs and put the IPs in the host file before clustering, is
</I>&gt;<i> it the problem.
</I>
Well, be aware that clustering is in general not partition tolerant. If 
you've experienced network partitions then you can expect things not to 
work flawlessly. Not that I would expect to see queues crash, but in 
general the behaviour is less well defined when partitioned.

&lt;snip&gt;

&gt;<i> I may choose *pause_minority* then.
</I>
Sure, but make sure you understand what pause_minority does. None of the 
cluster_partition_handling options are magic, you will always experience 
problems when a partition occurs - you just get a choice of what sort of 
problems.

&gt;<i> I will change to use the private IPs
</I>&gt;<i> (provided by the host provider), hopefully will be better.
</I>
Private IPs are unlikely to make a difference.

&gt;<i> By the way, do
</I>&gt;<i> you recommend a clustering of 3 nodes or 2 nodes?
</I>
Depends what you're trying to do. If you want to use pause_minority mode 
then you need at least three nodes.

Cheers, Simon
</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="028903.html">[rabbitmq-discuss] Queue disappear from nodes in clusters
</A></li>
	<LI>Next message: <A HREF="028904.html">[rabbitmq-discuss] forking and getting or consuming messages
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28912">[ date ]</a>
              <a href="thread.html#28912">[ thread ]</a>
              <a href="subject.html#28912">[ subject ]</a>
              <a href="author.html#28912">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
