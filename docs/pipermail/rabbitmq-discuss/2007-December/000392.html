<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Persisting Data
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Persisting%20Data&In-Reply-To=476692E2.60703%40lshift.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000387.html">
   <LINK REL="Next"  HREF="000393.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Persisting Data</H1>
    <B>Varun Samuel</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Persisting%20Data&In-Reply-To=476692E2.60703%40lshift.net"
       TITLE="[rabbitmq-discuss] Persisting Data">vis2 at cornell.edu
       </A><BR>
    <I>Tue Dec 25 05:24:47 GMT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000387.html">[rabbitmq-discuss] Persisting Data
</A></li>
        <LI>Next message: <A HREF="000393.html">[rabbitmq-discuss] Persisting Data
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#392">[ date ]</a>
              <a href="thread.html#392">[ thread ]</a>
              <a href="subject.html#392">[ subject ]</a>
              <a href="author.html#392">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Tony,

I posted a little while back about persisting data with durable  
queues, which was giving me some problems.
I've got it working now, and I think the basic problem lay in my  
approach.

I wrote a small program to create and send persistent messages to a  
durable queue. Once it had sent the
messages it would try to read them immediately using basicGet. This  
seems to be the problem. Once I had a separate
client try to read the messages, everything was fine. But one program  
sending messages to the queue then
immediately trying to read them doesn't work. Just thought I'd post  
in case anyone else was trying the same thing.
Thanks very much for your offer to read over my code though. If you'd  
still like to see it, I can send it. Sorry it took a while
to post the resolution of my problem- me and my partner had to change  
direction a bit for our project.

With regards to the other issue- reading the last n messages in a  
queue, you wrote:

---

I see - it looks like you're interested in something more like a &quot;last
value cache&quot; than a queue.

The way durable queues are designed in AMQP is simply that the messages
in the queues are stored to disk, and so survive server restarts. They
are still consumed in the same way as non-persistent/non-durable
messages: that is, for each *queue*, a single message is delivered to a
single consumer, and if that consumer acknowledges the message, it will
not be delivered to other consumers.

To simulate a last-value cache, you could write a simple &quot;replay&quot;
service that keeps a log of recent chat messages, and sends them out
when asked by a new chat participant.

---

I wasn't sure if you meant this was done inside rabbitmq. I just  
settled on sticking every sent message in a LIFO data
structure, outside of rabbitmq. Any client connecting to rabbitmq  
would first get the messages from that

This is a very basic way to do it. I read a bit of the AMQP spec and  
didn't see anything about doing it in there. Does the
method you describe make use of rabbitmq to log recent chat messages?

Thanks, and Happy Holidays!
Varun





&gt;<i> Hi Varun,
</I>&gt;<i>
</I>&gt;<i> Varun Samuel wrote:
</I>&gt;&gt;<i> Sorry, I'm a little new to this mailing list thing. I posted
</I>&gt;&gt;<i> previously about durable queues, and I will
</I>&gt;&gt;<i> try to make my problem more precise.
</I>&gt;<i>
</I>&gt;<i> Sorry for the delay in responding. I got half-way through replying to
</I>&gt;<i> your other mail on Friday and arrived this morning to find an open,
</I>&gt;<i> half-full mail composition window :-)
</I>&gt;<i>
</I>&gt;&gt;<i> I create a durable exchange/queue and send the queue persistent
</I>&gt;&gt;<i> messages. Then I restart my broker. How would I retrieve
</I>&gt;&gt;<i> those messages? I am trying to read the messages with
</I>&gt;&gt;<i> channel.basicGet, but they aren't in the queue.
</I>&gt;<i>
</I>&gt;<i> This is very strange - strange enough for me to double-check that the
</I>&gt;<i> scenario works for me.
</I>&gt;<i>
</I>&gt;<i>  1. create &quot;durable&quot; queue
</I>&gt;<i>  2. post messages to it with deliveryMode = 2
</I>&gt;<i>  3. restart broker
</I>&gt;<i>  4. consume or basicGet from queue
</I>&gt;<i>  5. messages (should, and do for me) arrive
</I>&gt;<i>
</I>&gt;<i> If that basic scenario isn't working for you, there's something  
</I>&gt;<i> wrong -
</I>&gt;<i> perhaps you could email your code to me privately? I'd be happy to  
</I>&gt;<i> cast
</I>&gt;<i> an eye over it.
</I>&gt;<i>
</I>&gt;<i> I'll reply to your other email separately - please do feel free to
</I>&gt;<i> forward my reply to the mailing list if you feel that's appropriate.
</I>&gt;<i>
</I>&gt;<i> Regards,
</I>&gt;<i>   Tony
</I>&gt;<i> -- 
</I>&gt;<i>  [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
</I>&gt;<i>    [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
</I>&gt;<i>  []  [] <A HREF="http://www.lshift.net/">http://www.lshift.net/</A> | Email: <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">tonyg at lshift.net</A>
</I>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000387.html">[rabbitmq-discuss] Persisting Data
</A></li>
	<LI>Next message: <A HREF="000393.html">[rabbitmq-discuss] Persisting Data
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#392">[ date ]</a>
              <a href="thread.html#392">[ thread ]</a>
              <a href="subject.html#392">[ subject ]</a>
              <a href="author.html#392">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
