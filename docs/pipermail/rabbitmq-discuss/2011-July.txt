From jim at rabbitmq.com  Fri Jul  1 11:13:12 2011
From: jim at rabbitmq.com (Jim Apperly)
Date: Fri, 1 Jul 2011 11:13:12 +0100
Subject: [rabbitmq-discuss] How to add libraries to GAC
In-Reply-To: <BANLkTinSearwo7G+gJYeEQzeBP5d2r1TqQ@mail.gmail.com>
References: <BANLkTinSearwo7G+gJYeEQzeBP5d2r1TqQ@mail.gmail.com>
Message-ID: <BANLkTinhmdC3yUuGs_gihEnSuh8BfHVDZw@mail.gmail.com>

Demi,

If you cannot use gacutil there is a control panel you can use.  Control
Panel, Administrative Tools, Microsoft .NET 2.0 Configuration (yes, this
should work for .Net 4.0 aswell), My Computer, Assembly Cache.  Choose Add
an Assembly.

If you really want GACUTIL, you can get it as part of the free Windows SDK
(it's a pretty hefty download mind you).
http://www.microsoft.com/download/en/details.aspx?displaylang=en&id=8279

Jim


On 30 June 2011 19:43, Demiss Zike <habtdemis at gmail.com> wrote:

> My .NET 4.0 doesn't have gacutil. How can I include my RabbitMQ.Client.dll
> so that I don't have to append it to the command every time I compile?
>
> Demi
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110701/9b4c8e77/attachment.htm>

From simon at rabbitmq.com  Fri Jul  1 11:19:48 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 01 Jul 2011 11:19:48 +0100
Subject: [rabbitmq-discuss] Management Plugins Not Activated
In-Reply-To: <CAL5L6UhOH8FWsA4rBWbK-nWtc4pYaJfqn=nZWCicJey7cbVSQw@mail.gmail.com>
References: <CAL5L6UhOH8FWsA4rBWbK-nWtc4pYaJfqn=nZWCicJey7cbVSQw@mail.gmail.com>
Message-ID: <4E0D9F44.2040503@rabbitmq.com>

On 30/06/11 15:17, Abeming Sf wrote:
> I'm not able to activate management plugins. All required files copied
> to plugins directory but after a restart only amqp_client plugin activated.
>
> Activating RabbitMQ plugins ...
> 1 plugins activated:
> * amqp_client-2.3.1
>
> What am I missing here?Using default rabbitmq from ubuntu (11.04) apt-get.

If you see that, it implies that Rabbit really isn't seeing the plugins 
at all - could this be a permissions problem? Have the files been 
truncated during download?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From majek04 at gmail.com  Fri Jul  1 11:22:08 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 1 Jul 2011 11:22:08 +0100
Subject: [rabbitmq-discuss] First Python sample (send.py) gives error:
 AttributeError: 'ProtocolHeader' object has no attribute 'channel_number'
In-Reply-To: <CA324306.80D7%mpietrek@skytap.com>
References: <CA324306.80D7%mpietrek@skytap.com>
Message-ID: <BANLkTine-cAJs5RLjxB2AVXPNYz4WLPNVw@mail.gmail.com>

Matt,

Looks like you have a wrong version of pika.

Are you sure you have pika 0.9.5 exactly?

Have you installed it as suggested on the tutorial page, using pip:
   pip install -e git+http://github.com/pika/pika.git at v0.9.5#egg=pika-v0.9.5

Cheers!
  Marek

On Thu, Jun 30, 2011 at 23:13, Matt Pietrek <mpietrek at skytap.com> wrote:
> I've just now followed the directions verbatim from
> here:?http://www.rabbitmq.com/tutorials/tutorial-one-python.html
> I've copied/pasted the sample code for send.py and receive.py directly from
> the web page so as to eliminate errors.?Unfortunately, I'm getting the
> following error:
>
> foo at foo-desktop:~/rabbitmq-test$ python send.py
>
> Traceback (most recent call last):
>
> ? File "send.py", line 4, in <module>
>
> ??? connection =
> pika.BlockingConnection(pika.ConnectionParameters(host='localhost'))
>
> ? File "/home/foo/src/pika-v0.9.5/pika/adapters/blocking_connection.py",
> line 32, in __init__
>
> ??? BaseConnection.__init__(self, parameters, None, reconnection_strategy)
>
> ? File "/home/foo/src/pika-v0.9.5/pika/adapters/base_connection.py", line
> 50, in __init__
>
> ??? reconnection_strategy)
>
> ? File "/home/foo/src/pika-v0.9.5/pika/connection.py", line 170, in __init__
>
> ??? self._connect()
>
> ? File "/home/foo/src/pika-v0.9.5/pika/connection.py", line 228, in _connect
>
> ??? self.parameters.port or? spec.PORT)
>
> ? File "/home/foo/src/pika-v0.9.5/pika/adapters/blocking_connection.py",
> line 44, in _adapter_connect
>
> ??? self._handle_read()
>
> ? File "/home/foo/src/pika-v0.9.5/pika/adapters/base_connection.py", line
> 162, in _handle_read
>
> ??? self._on_data_available(data)
>
> ? File "/home/foo/src/pika-v0.9.5/pika/connection.py", line 597, in
> _on_data_available
>
> ??? elif frame.channel_number > 0:
>
> AttributeError: 'ProtocolHeader' object has no attribute 'channel_number'
>
> Python version is 2.6.5. I'm running this on an ubuntu 10.4 system. Pip and
> Pika were downloaded today per the web site instructions.
>
> I've searched everywhere and can't see the error referenced.
>
> Many thanks to anybody that can help me.
>
> Matt Pietrek.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From matthias at rabbitmq.com  Fri Jul  1 11:32:39 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 01 Jul 2011 11:32:39 +0100
Subject: [rabbitmq-discuss] Java client QueueingConsumer question about
 nextDelivery(long timeout)
In-Reply-To: <4E0C0EC8.8020406@gmail.com>
References: <4E0C0EC8.8020406@gmail.com>
Message-ID: <4E0DA247.4070307@rabbitmq.com>

Guy,

On 30/06/11 06:51, Guy Boertje wrote:
> My testing using the Java client via jruby shows that using, for
> example, nextDelivery(500) will always take at least 500 milliseconds
> and not return early if a delivery could be take from the queue
> immediately.

That shouldn't happen, and looking at the code I can't see how it would. 
Can you post some code to reproduce this?

Regards,

Matthias.

From david_syer at hotmail.com  Fri Jul  1 11:48:27 2011
From: david_syer at hotmail.com (Dave Syer)
Date: Fri, 1 Jul 2011 03:48:27 -0700 (PDT)
Subject: [rabbitmq-discuss] Moving ActiveMQ to RabbitMQ
In-Reply-To: <6850ec10-f790-44fe-9190-59c91a9c039b@v11g2000prk.googlegroups.com>
References: <6850ec10-f790-44fe-9190-59c91a9c039b@v11g2000prk.googlegroups.com>
Message-ID: <58a932d3-2ae3-4eb7-81e6-ce9d1b60da21@gv8g2000vbb.googlegroups.com>

On Jun 27, 6:23?pm, scorpiovn <thomas.k... at gmail.com> wrote:
> I want to migrate a project using ActiveMq to RabbitMQ.
> Any one could help me out this problem?

Are you using JMS?  Why are you thinking of migrating?  If you are
using JMS, then I can recommend Spring AMQP (whether or not you are
using Spring JMS) because it tries to capture some of the high-level
messaging patterns like async consumers, transactions, batching, re-
connect and retry without hiding the low-level features of AMQP.  AMQP
has some features and concepts that do not appear in JMS, so it is
probably a good idea to think about the patterns you use ahead of time
and try and map them onto AMQP. Some more information might be useful.

From guyboertje at gmail.com  Fri Jul  1 12:33:43 2011
From: guyboertje at gmail.com (Guy Boertje)
Date: Fri, 01 Jul 2011 12:33:43 +0100
Subject: [rabbitmq-discuss] Java client QueueingConsumer question about
 nextDelivery(long timeout)
In-Reply-To: <4E0DA247.4070307@rabbitmq.com>
References: <4E0C0EC8.8020406@gmail.com>  <4E0DA247.4070307@rabbitmq.com>
Message-ID: <1309520023.1745.15.camel@poly>

Thanks for your reply,

Humble apologies, this morning I refactored my investigative code and
found that the method call does return early with a delivery.

I had tried to look for any confirmation of this in the
LinkedBlockingQueue javadocs but it was not explicit.

Rgds,
Guy

On Fri, 2011-07-01 at 11:32 +0100, Matthias Radestock wrote:
> Guy,
> 
> On 30/06/11 06:51, Guy Boertje wrote:
> > My testing using the Java client via jruby shows that using, for
> > example, nextDelivery(500) will always take at least 500 milliseconds
> > and not return early if a delivery could be take from the queue
> > immediately.
> 
> That shouldn't happen, and looking at the code I can't see how it would. 
> Can you post some code to reproduce this?
> 
> Regards,
> 
> Matthias.



From matthias at rabbitmq.com  Fri Jul  1 13:07:51 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 01 Jul 2011 13:07:51 +0100
Subject: [rabbitmq-discuss] Issue with rabbit starting up every time
In-Reply-To: <068C0966A93143AA93D90B5720231FA4@gmail.com>
References: <068C0966A93143AA93D90B5720231FA4@gmail.com>
Message-ID: <4E0DB897.2050500@rabbitmq.com>

Chris,

On 30/06/11 20:47, Chris Madden wrote:
> I have 2 nodes in a cluster, both are disc nodes. Occasionally,
> following a reboot, rabbit will not start. [...]
 > Interestingly, it seems to correct itself if I continue to restart
> rabbit. Sometimes it can take 15-20 attempts to get it to start
> correctly.

Are you restarting both nodes or just one? And when you are "restarting 
rabbit", are you just restarting the rabbitmq server process or 
rebooting the entire machine?

> I'm suspicious of
> http://hg.rabbitmq.com/rabbitmq-server/file/5f84b55205fd/src/rabbit_mnesia.erl#l610,
> with a hard coded timeout a heavily loaded system (which this is
> definitely at boot time) may take more than 30 seconds (assuming I'm
> reading that correctly).

We filed a bug back in 2009 to come up with something better than the 30 
second timeout. But until now we've had no evidence that it is actually 
causing problems. Yes, users have been reporting rabbit failing to start 
with a timeout_waiting_for_tables error, but in all cases I recall the 
underlying problem wasn't the timeout duration, i.e. increasing the 
timeout would simply have led to waiting for longer and then still failing.

So another thing to try would be to increase the timeout in the code and 
see whether that changes the behaviour you are seeing or merely delays 
the failure.


Regards,

Matthias.

From matthias at rabbitmq.com  Fri Jul  1 13:13:35 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 01 Jul 2011 13:13:35 +0100
Subject: [rabbitmq-discuss] rabbitmq_mnesia:wait_for_tables() - make
 timeout of 30 sec configurable?
In-Reply-To: <BANLkTi=ETsxUWbLZWvj-Hevapj4y5xLSQA@mail.gmail.com>
References: <BANLkTi=ETsxUWbLZWvj-Hevapj4y5xLSQA@mail.gmail.com>
Message-ID: <4E0DB9EF.4090604@rabbitmq.com>

Eugene,

On 30/06/11 15:07, Eugene Kirpichov wrote:
> I'm facing an issue where upon restart of a whole rabbitmq cluster, it
> is sometimes the case that the current "main" node of the cluster (if
> I'm understanding correctly, there exists a notion of leadership in a
> RabbitMQ cluster?) takes longer to restart (e.g. the machine takes
> longer to reboot) and all other nodes fail to start up with an error
> like the one described below.
>
> I looked into the source and found this:
> [...]
> So, there's a hard-coded value of 30 seconds.

See my reply to Chris Madden a few moments ago. Are you in a position to 
modify the code and increase the timeout value?

I want to make sure that the timeout is really the cause of the problem 
rather than the symptom of something going wrong that would cause 
wait_for_tables to wait indefinitely in the absence of a timeout.


Regards,

Matthias.

From chris.madden at gmail.com  Fri Jul  1 13:17:30 2011
From: chris.madden at gmail.com (Chris Madden)
Date: Fri, 1 Jul 2011 08:17:30 -0400
Subject: [rabbitmq-discuss] Issue with rabbit starting up every time
In-Reply-To: <4E0DB897.2050500@rabbitmq.com>
References: <068C0966A93143AA93D90B5720231FA4@gmail.com>
	<4E0DB897.2050500@rabbitmq.com>
Message-ID: <FAFE8DA9B9DC4D6392F28331F434F788@gmail.com>


On Friday, July 1, 2011 at 8:07 AM, Matthias Radestock wrote:

> Chris,
> 
> On 30/06/11 20:47, Chris Madden wrote:
> > I have 2 nodes in a cluster, both are disc nodes. Occasionally,
> > following a reboot, rabbit will not start. [...]
> > Interestingly, it seems to correct itself if I continue to restart
> > rabbit. Sometimes it can take 15-20 attempts to get it to start
> > correctly.
> 
> Are you restarting both nodes or just one? And when you are "restarting 
> rabbit", are you just restarting the rabbitmq server process or 
> rebooting the entire machine?
> 
The problem usually manifests after one of the machines reboots. I have a baby sitter that does 2 things: 1) make sure rabbit is up and 2) make sure the cluster is fully formed. In either test fails, it will issue an '/etc/init.d/rabbitmq-server restart'

When we get into this state, it is usually our watchdog that gets things back up and running.

Perhaps our watchdogs are running too frequently (once a minute). I'll back off their aggressiveness to see if that doesn't help things.

Further, the machines involved here are virtual machines. I see the problem more when I have a single CPU than when I have multiple.

> > I'm suspicious of
> > http://hg.rabbitmq.com/rabbitmq-server/file/5f84b55205fd/src/rabbit_mnesia.erl#l610,
> > with a hard coded timeout a heavily loaded system (which this is
> > definitely at boot time) may take more than 30 seconds (assuming I'm
> > reading that correctly).
> 
> We filed a bug back in 2009 to come up with something better than the 30 
> second timeout. But until now we've had no evidence that it is actually 
> causing problems. Yes, users have been reporting rabbit failing to start 
> with a timeout_waiting_for_tables error, but in all cases I recall the 
> underlying problem wasn't the timeout duration, i.e. increasing the 
> timeout would simply have led to waiting for longer and then still failing.
> 
> So another thing to try would be to increase the timeout in the code and 
> see whether that changes the behaviour you are seeing or merely delays 
> the failure.

I will try this, thanks! 

From simon at rabbitmq.com  Fri Jul  1 13:27:30 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 01 Jul 2011 13:27:30 +0100
Subject: [rabbitmq-discuss] rabbitmq fails on start
In-Reply-To: <BANLkTi=-Sa-E1ujB8tf3XMP=Sj2Mt4=cgA@mail.gmail.com>
References: <BANLkTimECqbwf6G7_S+L6JnGMbwfFkdD3Q@mail.gmail.com>	<4E0B5A33.3080109@rabbitmq.com>
	<BANLkTi=-Sa-E1ujB8tf3XMP=Sj2Mt4=cgA@mail.gmail.com>
Message-ID: <4E0DBD32.60202@rabbitmq.com>

On 29/06/11 19:10, Jeff Hinrichs wrote:
> [jlh at hydra ~]$ erl -noinput  -eval 'io:format("~p~n",
> [inet:listen_options([{port,10000}, inet6, {ip, {0,0,0,0,0,0,0,0}}],
> inet6)]), halt().'
> {ok,{listen_opts,{0,0,0,0,0,0,0,0},10000,5,-1,[{active,true}]}}
> [jlh at hydra ~]$

Weird. That is, unfortunately, exactly what I'm seeing.

I don't know how much appetite you have for trying to get to the bottom 
of this, but would you be able to give me access to this machine for a 
short while? I'd like to figure out what's actually going on but I 
suspect asking you to act as an ssh server would get tiresome quickly...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From jim at rabbitmq.com  Fri Jul  1 13:32:52 2011
From: jim at rabbitmq.com (Jim Apperly)
Date: Fri, 1 Jul 2011 13:32:52 +0100
Subject: [rabbitmq-discuss] How to add libraries to GAC
In-Reply-To: <BANLkTikm5tjQQccqxtNrtN_X88hLzckptQ@mail.gmail.com>
References: <BANLkTinSearwo7G+gJYeEQzeBP5d2r1TqQ@mail.gmail.com>
	<BANLkTinhmdC3yUuGs_gihEnSuh8BfHVDZw@mail.gmail.com>
	<BANLkTikm5tjQQccqxtNrtN_X88hLzckptQ@mail.gmail.com>
Message-ID: <BANLkTik0t=uJGArsOs47VA2wmWKte6TSKQ@mail.gmail.com>

I'm on 7 too - please see the screenshot attached.  Does that help?

Jim

On 1 July 2011 13:26, Demiss Zike <habtdemis at gmail.com> wrote:

> I have Windows 7. I was following the folder sequence but I couldn't find
> Assembly Cache.
>
> Demi
>
>
> On Fri, Jul 1, 2011 at 5:13 AM, Jim Apperly <jim at rabbitmq.com> wrote:
>
>> Demi,
>>
>> If you cannot use gacutil there is a control panel you can use.  Control
>> Panel, Administrative Tools, Microsoft .NET 2.0 Configuration (yes, this
>> should work for .Net 4.0 aswell), My Computer, Assembly Cache.  Choose Add
>> an Assembly.
>>
>> If you really want GACUTIL, you can get it as part of the free Windows SDK
>> (it's a pretty hefty download mind you).
>> http://www.microsoft.com/download/en/details.aspx?displaylang=en&id=8279
>>
>> Jim
>>
>>
>> On 30 June 2011 19:43, Demiss Zike <habtdemis at gmail.com> wrote:
>>
>>> My .NET 4.0 doesn't have gacutil. How can I include my
>>> RabbitMQ.Client.dll so that I don't have to append it to the command every
>>> time I compile?
>>>
>>> Demi
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110701/24da3971/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Clipboard01.png
Type: image/png
Size: 87060 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110701/24da3971/attachment.png>

From Lowell.Boggs at emc.com  Fri Jul  1 14:56:29 2011
From: Lowell.Boggs at emc.com (Lowell.Boggs at emc.com)
Date: Fri, 1 Jul 2011 09:56:29 -0400
Subject: [rabbitmq-discuss] rabbitmq-c -- multiple exectables receiving
 same message
In-Reply-To: <BANLkTin7FmyKm3m5OxESkAZKVbp5HXs0sA@mail.gmail.com>
References: <BANLkTin7FmyKm3m5OxESkAZKVbp5HXs0sA@mail.gmail.com>
Message-ID: <8A1A883E3F171B42A81817DEC138352C1DB3305B51@MX06A.corp.emc.com>

HI Simon -- thanks for trying to help!

The two executables are not in fact receiving the messages in a round-robin fashion.  They are both receiving all of the messages.

I send 4000 messages and both executables receive all 4000 in sequence.  It was my understanding that the point of the tutorial was to demonstrate a round robin delivery of 1/2 of the messages to each consumer so as to accomplish load balancing.  The examples in the tutorial page show that of the 5 messages sent as a test, 3 went to one python consumer task and the 2 going to the other.

Our use of the rabbit-mq entirely depends on this load balancing feature.  If I can't get this to work like the tutorial, we need to pursue a different messaging solution.  I guess I'll have to copy the python examples out of the tutorial and see if the tutorial actually works -- maybe the actual python source will tell me what I' might be doing wrong.

Thanks,
   Lowell

________________________________
From: Simone Busoli [mailto:simone.busoli at gmail.com]
Sent: Thursday, June 30, 2011 5:06 PM
To: Boggs Jr., Lowell
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] rabbitmq-c -- multiple exectables receiving same message


Hi Lowell,

The second tutorial does not use a topic exchange, but even with a topic exchange the situation would be the same. The key point here is that your workers are reading messages from the same queue. The exchange, topic or anything else, as soon as it has delivered a message to a queue is out of the game. The queue receives the message because it's bound to the exchange. Then you have two or more workers reading from the same queue, thereby receiving each one message in a round-robin fashion.

On Jun 30, 2011 11:29 PM, <Lowell.Boggs at emc.com<mailto:Lowell.Boggs at emc.com>> wrote:
> I am confused by my experiments with rabbitmq-c.
>
> I was trying to follow the task worker tutorial:
>
> http://www.rabbitmq.com/tutorials/tutorial-two-python.html
>
> Of course, I'm using C interfaces not the python or Java interfaces.
>
> Being a newbie it is probable that I'm doing something wrong, but:
>
> The tutorial implies to me that if I have:
>
> * one exchange+topic
> * two worker executables that read from it
>
> then
>
> * due to round-robin processing, some messages will go to one executable
> * other messages will go to the other
>
> However, I am seeing that both exectuables receive all the messages -- which is not at all what I want.
>
> Is this supposed to work with the default version of rabbitmq-c?
>
> Immediately upon logging into the channel, in the consumers, I am setting
>
> basic_qos(conn, 1, 0, 1, 0);
>
> Also, I am calling basic_consume like this:
>
> amqp_basic_consume(conn,
> 1,
> amqp_cstring_bytes(queuename),
> amqp_empty_bytes,
> 0,
> 0,
> 0,
> amqp_empty_table
> );
>
>
> The exchange that i am using is amq.direct. I have tried an empty string queue name as well as "hello".
>
> I am calling basic_ack() as soon as I receive the messages in both worker executables -- well, after I log their reception.
>
> Any ideas?
>
> Thanks,
> Lowell
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110701/12a90d0e/attachment.htm>

From Lowell.Boggs at emc.com  Fri Jul  1 15:02:21 2011
From: Lowell.Boggs at emc.com (Lowell.Boggs at emc.com)
Date: Fri, 1 Jul 2011 10:02:21 -0400
Subject: [rabbitmq-discuss] rabbitmq-c -- multiple exectables receiving
 same message
In-Reply-To: <BANLkTin7FmyKm3m5OxESkAZKVbp5HXs0sA@mail.gmail.com>
References: <BANLkTin7FmyKm3m5OxESkAZKVbp5HXs0sA@mail.gmail.com>
Message-ID: <8A1A883E3F171B42A81817DEC138352C1DB3305B56@MX06A.corp.emc.com>

Also,
The one piece of the tutorial I have not actually duplicated in my experiments is the use of the durable flag on queue creation and the use use of persistent in the message creation.  Would that have anything to do with the round robin distribution of messages to queues?

Thanks,
   Lowell

________________________________
From: Simone Busoli [mailto:simone.busoli at gmail.com]
Sent: Thursday, June 30, 2011 5:06 PM
To: Boggs Jr., Lowell
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] rabbitmq-c -- multiple exectables receiving same message


Hi Lowell,

The second tutorial does not use a topic exchange, but even with a topic exchange the situation would be the same. The key point here is that your workers are reading messages from the same queue. The exchange, topic or anything else, as soon as it has delivered a message to a queue is out of the game. The queue receives the message because it's bound to the exchange. Then you have two or more workers reading from the same queue, thereby receiving each one message in a round-robin fashion.

On Jun 30, 2011 11:29 PM, <Lowell.Boggs at emc.com<mailto:Lowell.Boggs at emc.com>> wrote:
> I am confused by my experiments with rabbitmq-c.
>
> I was trying to follow the task worker tutorial:
>
> http://www.rabbitmq.com/tutorials/tutorial-two-python.html
>
> Of course, I'm using C interfaces not the python or Java interfaces.
>
> Being a newbie it is probable that I'm doing something wrong, but:
>
> The tutorial implies to me that if I have:
>
> * one exchange+topic
> * two worker executables that read from it
>
> then
>
> * due to round-robin processing, some messages will go to one executable
> * other messages will go to the other
>
> However, I am seeing that both exectuables receive all the messages -- which is not at all what I want.
>
> Is this supposed to work with the default version of rabbitmq-c?
>
> Immediately upon logging into the channel, in the consumers, I am setting
>
> basic_qos(conn, 1, 0, 1, 0);
>
> Also, I am calling basic_consume like this:
>
> amqp_basic_consume(conn,
> 1,
> amqp_cstring_bytes(queuename),
> amqp_empty_bytes,
> 0,
> 0,
> 0,
> amqp_empty_table
> );
>
>
> The exchange that i am using is amq.direct. I have tried an empty string queue name as well as "hello".
>
> I am calling basic_ack() as soon as I receive the messages in both worker executables -- well, after I log their reception.
>
> Any ideas?
>
> Thanks,
> Lowell
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110701/da7ed72c/attachment.htm>

From simon at rabbitmq.com  Fri Jul  1 15:05:18 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 01 Jul 2011 15:05:18 +0100
Subject: [rabbitmq-discuss] rabbitmq-c -- multiple exectables receiving
 same message
In-Reply-To: <8A1A883E3F171B42A81817DEC138352C1DB3305B51@MX06A.corp.emc.com>
References: <BANLkTin7FmyKm3m5OxESkAZKVbp5HXs0sA@mail.gmail.com>
	<8A1A883E3F171B42A81817DEC138352C1DB3305B51@MX06A.corp.emc.com>
Message-ID: <4E0DD41E.5030604@rabbitmq.com>

On 01/07/11 14:56, Lowell.Boggs at emc.com wrote:
> The two executables are not in fact receiving the messages in a
> /round-robin/ fashion. They are both receiving _all_ of the messages.

This really, really should work. It's very basic functionality.

Are you *absolutely* sure that you have a single queue with two 
consumers? Look at rabbitmqctl list_queues, or rabbitmq-management.

 > The one piece of the tutorial I have not actually duplicated in my
 > experiments is the use of the durable flag on queue creation and the use
 > use of persistent in the message creation. Would that have anything to
 > do with the round robin distribution of messages to queues?

No, it won't.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From alexis at rabbitmq.com  Fri Jul  1 15:08:03 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Fri, 1 Jul 2011 15:08:03 +0100
Subject: [rabbitmq-discuss] rabbitmq-c -- multiple exectables receiving
 same message
In-Reply-To: <8A1A883E3F171B42A81817DEC138352C1DB3305B51@MX06A.corp.emc.com>
References: <BANLkTin7FmyKm3m5OxESkAZKVbp5HXs0sA@mail.gmail.com>
	<8A1A883E3F171B42A81817DEC138352C1DB3305B51@MX06A.corp.emc.com>
Message-ID: <CACOPnve_-ooPzxMDyJ7Y=yX-ffTWuz_qKUR0+9L6+CRnqqvHjw@mail.gmail.com>

Lowell

How many queues do you have bound to the exchange?  You should have
one queue.  Then, connect both executables to that queue.

alexis


On Fri, Jul 1, 2011 at 2:56 PM,  <Lowell.Boggs at emc.com> wrote:
> HI Simon -- thanks for trying to help!
>
> The two executables?are not in fact receiving the messages in a round-robin
> fashion.? They are both receiving all of the messages.
>
> I send 4000 messages and both executables receive all 4000 in sequence.? It
> was my understanding that the point of the tutorial was to demonstrate a
> round robin delivery of 1/2 of the messages to each consumer so as to
> accomplish load balancing.? The examples in the tutorial page show that of
> the 5 messages sent as a test, 3 went to one python consumer task and the 2
> going to the other.
>
> Our use of the rabbit-mq entirely depends on this load balancing feature.
> If I can't get this to work like the tutorial, we need to pursue a different
> messaging solution.? I guess I'll have to copy the python examples out of
> the tutorial and see if the tutorial actually works -- maybe the actual
> python source will tell me what I' might be doing wrong.
>
> Thanks,
> ?? Lowell
>
> ________________________________
> From: Simone Busoli [mailto:simone.busoli at gmail.com]
> Sent: Thursday, June 30, 2011 5:06 PM
> To: Boggs Jr., Lowell
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] rabbitmq-c -- multiple exectables receiving
> same message
>
> Hi Lowell,
>
> The second tutorial does not use a topic exchange, but even with a topic
> exchange the situation would be the same. The key point here is that your
> workers are reading messages from the same queue. The exchange, topic or
> anything else, as soon as it has delivered a message to a queue is out of
> the game. The queue receives the message because it's bound to the exchange.
> Then you have two or more workers reading from the same queue, thereby
> receiving each one message in a round-robin fashion.
>
> On Jun 30, 2011 11:29 PM, <Lowell.Boggs at emc.com> wrote:
>> I am confused by my experiments with rabbitmq-c.
>>
>> I was trying to follow the task worker tutorial:
>>
>> http://www.rabbitmq.com/tutorials/tutorial-two-python.html
>>
>> Of course, I'm using C interfaces not the python or Java interfaces.
>>
>> Being a newbie it is probable that I'm doing something wrong, but:
>>
>> The tutorial implies to me that if I have:
>>
>> * one exchange+topic
>> * two worker executables that read from it
>>
>> then
>>
>> * due to round-robin processing, some messages will go to one executable
>> * other messages will go to the other
>>
>> However, I am seeing that both exectuables receive all the messages --
>> which is not at all what I want.
>>
>> Is this supposed to work with the default version of rabbitmq-c?
>>
>> Immediately upon logging into the channel, in the consumers, I am setting
>>
>> basic_qos(conn, 1, 0, 1, 0);
>>
>> Also, I am calling basic_consume like this:
>>
>> amqp_basic_consume(conn,
>> 1,
>> amqp_cstring_bytes(queuename),
>> amqp_empty_bytes,
>> 0,
>> 0,
>> 0,
>> amqp_empty_table
>> );
>>
>>
>> The exchange that i am using is amq.direct. I have tried an empty string
>> queue name as well as "hello".
>>
>> I am calling basic_ack() as soon as I receive the messages in both worker
>> executables -- well, after I log their reception.
>>
>> Any ideas?
>>
>> Thanks,
>> Lowell
>>
>>
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From Lowell.Boggs at emc.com  Fri Jul  1 15:44:22 2011
From: Lowell.Boggs at emc.com (Lowell.Boggs at emc.com)
Date: Fri, 1 Jul 2011 10:44:22 -0400
Subject: [rabbitmq-discuss] rabbitmq-c -- multiple exectables receiving
 same message
In-Reply-To: <CACOPnve_-ooPzxMDyJ7Y=yX-ffTWuz_qKUR0+9L6+CRnqqvHjw@mail.gmail.com>
References: <BANLkTin7FmyKm3m5OxESkAZKVbp5HXs0sA@mail.gmail.com>
	<8A1A883E3F171B42A81817DEC138352C1DB3305B51@MX06A.corp.emc.com>
	<CACOPnve_-ooPzxMDyJ7Y=yX-ffTWuz_qKUR0+9L6+CRnqqvHjw@mail.gmail.com>
Message-ID: <8A1A883E3F171B42A81817DEC138352C1DB3305B83@MX06A.corp.emc.com>

That's it!  

I was using "" as the queue name.

Now that I am sharing a queue, they load balancing magically works.

Whew, that sure saved me a lot of debug time.

Thanks!

Lowell 

-----Original Message-----
From: alexis.richardson at gmail.com [mailto:alexis.richardson at gmail.com] On Behalf Of Alexis Richardson
Sent: Friday, July 01, 2011 9:08 AM
To: Boggs Jr., Lowell
Cc: simone.busoli at gmail.com; rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] rabbitmq-c -- multiple exectables receiving same message

Lowell

How many queues do you have bound to the exchange?  You should have
one queue.  Then, connect both executables to that queue.

alexis


On Fri, Jul 1, 2011 at 2:56 PM,  <Lowell.Boggs at emc.com> wrote:
> HI Simon -- thanks for trying to help!
>
> The two executables?are not in fact receiving the messages in a round-robin
> fashion.? They are both receiving all of the messages.
>
> I send 4000 messages and both executables receive all 4000 in sequence.? It
> was my understanding that the point of the tutorial was to demonstrate a
> round robin delivery of 1/2 of the messages to each consumer so as to
> accomplish load balancing.? The examples in the tutorial page show that of
> the 5 messages sent as a test, 3 went to one python consumer task and the 2
> going to the other.
>
> Our use of the rabbit-mq entirely depends on this load balancing feature.
> If I can't get this to work like the tutorial, we need to pursue a different
> messaging solution.? I guess I'll have to copy the python examples out of
> the tutorial and see if the tutorial actually works -- maybe the actual
> python source will tell me what I' might be doing wrong.
>
> Thanks,
> ?? Lowell
>
> ________________________________
> From: Simone Busoli [mailto:simone.busoli at gmail.com]
> Sent: Thursday, June 30, 2011 5:06 PM
> To: Boggs Jr., Lowell
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] rabbitmq-c -- multiple exectables receiving
> same message
>
> Hi Lowell,
>
> The second tutorial does not use a topic exchange, but even with a topic
> exchange the situation would be the same. The key point here is that your
> workers are reading messages from the same queue. The exchange, topic or
> anything else, as soon as it has delivered a message to a queue is out of
> the game. The queue receives the message because it's bound to the exchange.
> Then you have two or more workers reading from the same queue, thereby
> receiving each one message in a round-robin fashion.
>
> On Jun 30, 2011 11:29 PM, <Lowell.Boggs at emc.com> wrote:
>> I am confused by my experiments with rabbitmq-c.
>>
>> I was trying to follow the task worker tutorial:
>>
>> http://www.rabbitmq.com/tutorials/tutorial-two-python.html
>>
>> Of course, I'm using C interfaces not the python or Java interfaces.
>>
>> Being a newbie it is probable that I'm doing something wrong, but:
>>
>> The tutorial implies to me that if I have:
>>
>> * one exchange+topic
>> * two worker executables that read from it
>>
>> then
>>
>> * due to round-robin processing, some messages will go to one executable
>> * other messages will go to the other
>>
>> However, I am seeing that both exectuables receive all the messages --
>> which is not at all what I want.
>>
>> Is this supposed to work with the default version of rabbitmq-c?
>>
>> Immediately upon logging into the channel, in the consumers, I am setting
>>
>> basic_qos(conn, 1, 0, 1, 0);
>>
>> Also, I am calling basic_consume like this:
>>
>> amqp_basic_consume(conn,
>> 1,
>> amqp_cstring_bytes(queuename),
>> amqp_empty_bytes,
>> 0,
>> 0,
>> 0,
>> amqp_empty_table
>> );
>>
>>
>> The exchange that i am using is amq.direct. I have tried an empty string
>> queue name as well as "hello".
>>
>> I am calling basic_ack() as soon as I receive the messages in both worker
>> executables -- well, after I log their reception.
>>
>> Any ideas?
>>
>> Thanks,
>> Lowell
>>
>>
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


From arno.puschmann at acodeas.de  Fri Jul  1 15:54:08 2011
From: arno.puschmann at acodeas.de (Arno Puschmann)
Date: Fri, 1 Jul 2011 16:54:08 +0200
Subject: [rabbitmq-discuss] reading time extending on persistent messages
In-Reply-To: <20110630125847.GD18064@rabbitmq.com>
References: <27D6B27DB616654BBEF4DDB8B31EAF916B590E951E@vs-msx01.IT-NG.local>,
	<20110630125847.GD18064@rabbitmq.com>
Message-ID: <27D6B27DB616654BBEF4DDB8B31EAF916B590E9520@vs-msx01.IT-NG.local>

Hi Matthew,

thanks for response.

Today I tried RabbitMQ 2.5.1 out and get the same results as with RabbitMQ 2.4.1.

Here is a picture from my systemmonitoring on my german Ubuntu.
http://img405.imageshack.us/img405/4730/rabbitmqreceiving.png

I monitored also my disk drive and saw that rabbitmq starts with 500KB/s reading than after a while slow down and change always between 244 KB/s and 122 KB/s and at least it reads nothing or only with 122 KB/s. The systemmonitoring have always the same output.

I looked into all edited logfiles on the path /var/log/rabbitmq/ but I found no error.

Then I tried the same thing on a other system with Ubuntu 9.10 on a Single Core 2,3GHZ and only 512MB RAM and RabbitMQ 2.5.1. With this system I get almost the same results as you.

So what's the different between these machines?
The only thing I have found was that on my first machine with a slow reading I have the new erlang version of all erlang packages 1:13.b.3-dfsg-2ubuntu2.1 and on my fast reading machine I have the old erlang package version 1:13.b.1-dfsg-2ubuntu1.1. 

Could this be the problem?


Heres my output from my slow reading machine.

The last 3000 Messages needed 914
The last 3000 Messages needed 1466
The last 3000 Messages needed 1249
The last 3000 Messages needed 2564
The last 3000 Messages needed 3621
The last 3000 Messages needed 4506
The last 3000 Messages needed 5351
The last 3000 Messages needed 6027
The last 3000 Messages needed 7063
The last 3000 Messages needed 6809
The last 3000 Messages needed 7624
The last 3000 Messages needed 7886
The last 3000 Messages needed 8881
The last 3000 Messages needed 9712
The last 3000 Messages needed 10641
The last 3000 Messages needed 11635
The last 3000 Messages needed 10726
The last 3000 Messages needed 11339
The last 3000 Messages needed 12146
The last 3000 Messages needed 13149
The last 3000 Messages needed 14087
The last 3000 Messages needed 14049
The last 3000 Messages needed 13640
The last 3000 Messages needed 14688
The last 3000 Messages needed 15729
The last 3000 Messages needed 16540
The last 3000 Messages needed 17639
The last 3000 Messages needed 6200
The last 3000 Messages needed 16503
The last 3000 Messages needed 17880
The last 3000 Messages needed 18972
The last 3000 Messages needed 19816
The last 3000 Messages needed 20342
The last 3000 Messages needed 19970
The last 3000 Messages needed 21067
The last 3000 Messages needed 22279
The last 3000 Messages needed 22468
The last 3000 Messages needed 23510
The last 3000 Messages needed 24441
The last 3000 Messages needed 25701
The last 3000 Messages needed 26766
The last 3000 Messages needed 29099
The last 3000 Messages needed 25323
The last 3000 Messages needed 23663
The last 3000 Messages needed 22400
The last 3000 Messages needed 23353
The last 3000 Messages needed 24372
The last 3000 Messages needed 25267
The last 3000 Messages needed 26440
The last 3000 Messages needed 25486
The last 3000 Messages needed 25698
The last 3000 Messages needed 27725
The last 3000 Messages needed 28518
The last 3000 Messages needed 29462
The last 3000 Messages needed 29866
The last 3000 Messages needed 31868
The last 3000 Messages needed 32597
The last 3000 Messages needed 33528
The last 3000 Messages needed 35098
The last 3000 Messages needed 33956
The last 3000 Messages needed 26621
The last 3000 Messages needed 32605
The last 3000 Messages needed 34035
The last 3000 Messages needed 34754
The last 3000 Messages needed 35799
The last 3000 Messages needed 35499
The last 3000 Messages needed 35755
The last 3000 Messages needed 36829
The last 3000 Messages needed 37611
The last 3000 Messages needed 38507
The last 3000 Messages needed 39548
The last 3000 Messages needed 32433
The last 3000 Messages needed 41676
The last 3000 Messages needed 42586
The last 3000 Messages needed 41508
The last 3000 Messages needed 41379
The last 3000 Messages needed 37894
The last 3000 Messages needed 43723
The last 3000 Messages needed 44153
The last 3000 Messages needed 44836
The last 3000 Messages needed 45985
The last 3000 Messages needed 43398
The last 3000 Messages needed 43834
The last 3000 Messages needed 46645
...and so on

-----Original Message-----________________________________________
Von: rabbitmq-discuss-bounces at lists.rabbitmq.com [rabbitmq-discuss-bounces at lists.rabbitmq.com] im Auftrag von Matthew Sackman [matthew at rabbitmq.com]
Gesendet: Donnerstag, 30. Juni 2011 14:58
An: rabbitmq-discuss at lists.rabbitmq.com
Betreff: Re: [rabbitmq-discuss] reading time extending on persistent messages

Hi Arno,

On Wed, Jun 29, 2011 at 03:34:08PM +0200, Arno Puschmann wrote:
> I'm using rabbitmq 2.4.1 on a Ubuntu 10.04. I tested to write  a large
> number (300k) of messages to an persistent queue. Alle messages are
> the same and have a size of 1KB. After this I restartet my system and
> rabbitmq, to go save that nothing is on the memory but all on disk.
> After restarting all, I startet a consumer to readout the messages.
> Now I noticed that reading out the persistent messages took always
> longer. I measured the time for reading out every interval of 3k
> messages. For example, to readout the first 3k messages it took under
> 1sec. After 45k messages it took over 10sec. to readout the next 3k
> messages. After reading 165k messages it took about 30sec. to read the
> next 3000 messages. I have repeat these test several times always with
> a similar result.

I've used your consuming code that you supplied and repeated your test.
I did not reboot, but I did shut down rabbit and cleared out the caches.
I checked and Rabbit does sit there reading at 20MB/s off disk on
consuming.

I sent in 300,000 1KB persistent messages to a durable queue, then
safely shutdown Rabbit and restarted it, after clearing caches. I used
the Erlang client to publish and the Java client (with your code) to
consume the messages. The output I see is below.

Note that this is with the latest from default which will pretty much be
the same as 2.5.1. There haven't been any performance impacting changes
to the persistence layer for a little while. That said, there was quite
a gap between 2.4.1 and 2.5.0 so it may be something came in there.
Checking the release notes for 2.5.0 -
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-June/013249.html
- there are a number of performance related items but nothing that
strikes as relevant to your test.

Are there any indicators in your RabbitMQ logs that suggest Rabbit's
under memory pressure? Is there contention for the disk drive? Maybe try
upgrading to 2.5.1 and see if that helps?

Best wishes,

Matthew

The last 3000 Messages needed 332
The last 3000 Messages needed 314
The last 3000 Messages needed 310
The last 3000 Messages needed 383
The last 3000 Messages needed 449
The last 3000 Messages needed 436
The last 3000 Messages needed 309
The last 3000 Messages needed 320
The last 3000 Messages needed 363
The last 3000 Messages needed 340
The last 3000 Messages needed 377
The last 3000 Messages needed 369
The last 3000 Messages needed 404
The last 3000 Messages needed 379
The last 3000 Messages needed 408
The last 3000 Messages needed 445
The last 3000 Messages needed 379
The last 3000 Messages needed 357
The last 3000 Messages needed 434
The last 3000 Messages needed 325
The last 3000 Messages needed 327
The last 3000 Messages needed 508
The last 3000 Messages needed 334
The last 3000 Messages needed 360
The last 3000 Messages needed 326
The last 3000 Messages needed 339
The last 3000 Messages needed 313
The last 3000 Messages needed 458
The last 3000 Messages needed 355
The last 3000 Messages needed 341
The last 3000 Messages needed 358
The last 3000 Messages needed 331
The last 3000 Messages needed 514
The last 3000 Messages needed 339
The last 3000 Messages needed 363
The last 3000 Messages needed 355
The last 3000 Messages needed 353
The last 3000 Messages needed 372
The last 3000 Messages needed 417
The last 3000 Messages needed 375
The last 3000 Messages needed 350
The last 3000 Messages needed 438
The last 3000 Messages needed 339
The last 3000 Messages needed 554
The last 3000 Messages needed 342
The last 3000 Messages needed 340
The last 3000 Messages needed 368
The last 3000 Messages needed 372
The last 3000 Messages needed 372
The last 3000 Messages needed 420
The last 3000 Messages needed 392
The last 3000 Messages needed 358
The last 3000 Messages needed 362
The last 3000 Messages needed 347
The last 3000 Messages needed 509
The last 3000 Messages needed 402
The last 3000 Messages needed 441
The last 3000 Messages needed 437
The last 3000 Messages needed 373
The last 3000 Messages needed 359
The last 3000 Messages needed 657
The last 3000 Messages needed 345
The last 3000 Messages needed 461
The last 3000 Messages needed 384
The last 3000 Messages needed 459
The last 3000 Messages needed 648
The last 3000 Messages needed 361
The last 3000 Messages needed 369
The last 3000 Messages needed 396
The last 3000 Messages needed 407
The last 3000 Messages needed 436
The last 3000 Messages needed 376
The last 3000 Messages needed 369
The last 3000 Messages needed 409
The last 3000 Messages needed 407
The last 3000 Messages needed 378
The last 3000 Messages needed 542
The last 3000 Messages needed 391
The last 3000 Messages needed 430
The last 3000 Messages needed 389
The last 3000 Messages needed 384
The last 3000 Messages needed 480
The last 3000 Messages needed 391
The last 3000 Messages needed 434
The last 3000 Messages needed 417
The last 3000 Messages needed 387
The last 3000 Messages needed 409
The last 3000 Messages needed 609
The last 3000 Messages needed 411
The last 3000 Messages needed 472
The last 3000 Messages needed 388
The last 3000 Messages needed 399
The last 3000 Messages needed 456
The last 3000 Messages needed 430
The last 3000 Messages needed 400
The last 3000 Messages needed 420
The last 3000 Messages needed 394
The last 3000 Messages needed 426
The last 3000 Messages needed 434
The last 3000 Messages needed 416

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthias at rabbitmq.com  Fri Jul  1 16:53:49 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 01 Jul 2011 16:53:49 +0100
Subject: [rabbitmq-discuss] reading time extending on persistent messages
In-Reply-To: <27D6B27DB616654BBEF4DDB8B31EAF916B590E9520@vs-msx01.IT-NG.local>
References: <27D6B27DB616654BBEF4DDB8B31EAF916B590E951E@vs-msx01.IT-NG.local>,
	<20110630125847.GD18064@rabbitmq.com>
	<27D6B27DB616654BBEF4DDB8B31EAF916B590E9520@vs-msx01.IT-NG.local>
Message-ID: <4E0DED8D.8020200@rabbitmq.com>

Arno,

On 01/07/11 15:54, Arno Puschmann wrote:
> Then I tried the same thing on a other system with Ubuntu 9.10 on a
> Single Core 2,3GHZ and only 512MB RAM and RabbitMQ 2.5.1. With this
> system I get almost the same results as you.
>
> So what's the different between these machines? The only thing I have
> found was that on my first machine with a slow reading I have the new
> erlang version of all erlang packages 1:13.b.3-dfsg-2ubuntu2.1 and on
> my fast reading machine I have the old erlang package version
> 1:13.b.1-dfsg-2ubuntu1.1.
>
> Could this be the problem?

That's certainly a possibility. To rule out any other differences, could 
you upgrade Erlang to R13B3 on the second machine, or downgrade Erlang 
to R13B1 on the first?

Regards,

Matthias.

From matthew at rabbitmq.com  Fri Jul  1 17:25:53 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 1 Jul 2011 17:25:53 +0100
Subject: [rabbitmq-discuss] Experimental RabbitMQ Topology Visualiser
Message-ID: <20110701162552.GB16713@rabbitmq.com>

Howdy,

So, seeing as it's Friday, I thought you'd all like something to play
with over the weekend.

If you happen to be running 2.5.1, and you happen to be have the
management plugin installed (or if not, see
http://www.rabbitmq.com/plugins.html#rabbitmq-management), then you
might be interested in removing
plugins/rabbitmq_management-2.5.1.ez and instead dropping into plugins/
http://www.rabbitmq.com/releases/plugins/v2.5.1-visualiser-wip/rabbitmq_management-2.5.1-visualiser-20110701.ez

Then, if you happen to be using Firefox 4 or Firefox 5, or Google
Chrome, then you should then be able to click on the "Visualiser" tab
from the management page, and you will then get an HTML5 Canvas which
displays the routing topology.

This is very much a work in progress. Best results are with the latest
Google Chrome. Whilst none of Opera, IE9 or Safari show any errors, I'm
clearly doing something wrong as they fail to render more than one
frame. If someone can figure out what I'm doing wrong, please say so!

o) Try dragging things around!

o) Try shift-clicking on things!

o) Enjoy that you currently can only see the vhost "/"!

Lots of features are planned, and any and all feedback is very welcome.

Enjoy!

Matthew

From joseph.a.marlin at gmail.com  Fri Jul  1 17:54:03 2011
From: joseph.a.marlin at gmail.com (Joseph Marlin)
Date: Fri, 1 Jul 2011 09:54:03 -0700 (PDT)
Subject: [rabbitmq-discuss] Experimental RabbitMQ Topology Visualiser
In-Reply-To: <20110701162552.GB16713@rabbitmq.com>
Message-ID: <18997152.2701.1309539243729.JavaMail.geo-discussion-forums@vbjb24>

Sounds awesome! But it's not working for me... Ubuntu, RabbitMQ 2.5.1 as 
required. Let me know locations of any log files if they would help...


sudo rabbitmq-server -detached
Activating RabbitMQ plugins ...

********************************************************************************
*WARNING* Undefined function rabbit_auth_backend_internal:set_tags/2
*WARNING* Undefined function rabbit_mgmt_external_stats:info/2
********************************************************************************

6 plugins activated:
* amqp_client-2.5.1
* mochiweb-1.3-rmq2.5.1-git9a53dbd
* rabbitmq_management-2.5.1-visualiser-20110701
* rabbitmq_management_agent-2.5.1
* rabbitmq_mochiweb-2.5.1
* webmachine-1.7.0-rmq2.5.1-hg0c4b60a



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110701/a246cf96/attachment.htm>

From mpietrek at skytap.com  Fri Jul  1 18:14:00 2011
From: mpietrek at skytap.com (Matt Pietrek)
Date: Fri, 01 Jul 2011 10:14:00 -0700
Subject: [rabbitmq-discuss] First Python sample (send.py) gives error:
 AttributeError: 'ProtocolHeader' object has no attribute 'channel_number'
In-Reply-To: <BANLkTine-cAJs5RLjxB2AVXPNYz4WLPNVw@mail.gmail.com>
Message-ID: <CA334782.8112%mpietrek@skytap.com>

Mark,

Thanks for getting back to me.

Yes, I installed it exactly as specified on the tutorial page. I
copied/pasted the command line.

Just to be sure, I ran it again and got this output:

foo at foo:~$ sudo pip install -e
git+http://github.com/pika/pika.git at v0.9.5#egg=pika-v0.9.5
Checking out pika-v0.9.5 from
git+http://github.com/pika/pika.git at v0.9.5#egg=pika-v0.9.5 checkout from
git+http://github.com/pika/pika.git at v0.9.5#egg=pika-v0.9.5
  Cloning http://github.com/pika/pika.git (to revision v0.9.5) to
./src/pika-v0.9.5
  Running setup.py egg_info for package pika-v0.9.5
Installing collected packages: pika-v0.9.5
  Running setup.py develop for pika-v0.9.5
    Creating /usr/local/lib/python2.6/dist-packages/pika.egg-link (link to
.)
    Adding pika 0.9.5 to easy-install.pth file
    
    Installed /home/highland/src/pika-v0.9.5
Successfully installed pika-v0.9.5


On 7/1/11 3:22 AM, "Marek Majkowski" <majek04 at gmail.com> wrote:

>Matt,
>
>Looks like you have a wrong version of pika.
>
>Are you sure you have pika 0.9.5 exactly?
>
>Have you installed it as suggested on the tutorial page, using pip:
>   pip install -e 
>git+http://github.com/pika/pika.git at v0.9.5#egg=pika-v0.9.5
>
>Cheers!
>  Marek
>
>On Thu, Jun 30, 2011 at 23:13, Matt Pietrek <mpietrek at skytap.com> wrote:
>> I've just now followed the directions verbatim from
>> here: http://www.rabbitmq.com/tutorials/tutorial-one-python.html
>> I've copied/pasted the sample code for send.py and receive.py directly
>>from
>> the web page so as to eliminate errors. Unfortunately, I'm getting the
>> following error:
>>
>> foo at foo-desktop:~/rabbitmq-test$ python send.py
>>
>> Traceback (most recent call last):
>>
>>   File "send.py", line 4, in <module>
>>
>>     connection =
>> pika.BlockingConnection(pika.ConnectionParameters(host='localhost'))
>>
>>   File "/home/foo/src/pika-v0.9.5/pika/adapters/blocking_connection.py",
>> line 32, in __init__
>>
>>     BaseConnection.__init__(self, parameters, None,
>>reconnection_strategy)
>>
>>   File "/home/foo/src/pika-v0.9.5/pika/adapters/base_connection.py",
>>line
>> 50, in __init__
>>
>>     reconnection_strategy)
>>
>>   File "/home/foo/src/pika-v0.9.5/pika/connection.py", line 170, in
>>__init__
>>
>>     self._connect()
>>
>>   File "/home/foo/src/pika-v0.9.5/pika/connection.py", line 228, in
>>_connect
>>
>>     self.parameters.port or  spec.PORT)
>>
>>   File "/home/foo/src/pika-v0.9.5/pika/adapters/blocking_connection.py",
>> line 44, in _adapter_connect
>>
>>     self._handle_read()
>>
>>   File "/home/foo/src/pika-v0.9.5/pika/adapters/base_connection.py",
>>line
>> 162, in _handle_read
>>
>>     self._on_data_available(data)
>>
>>   File "/home/foo/src/pika-v0.9.5/pika/connection.py", line 597, in
>> _on_data_available
>>
>>     elif frame.channel_number > 0:
>>
>> AttributeError: 'ProtocolHeader' object has no attribute
>>'channel_number'
>>
>> Python version is 2.6.5. I'm running this on an ubuntu 10.4 system. Pip
>>and
>> Pika were downloaded today per the web site instructions.
>>
>> I've searched everywhere and can't see the error referenced.
>>
>> Many thanks to anybody that can help me.
>>
>> Matt Pietrek.
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>



From matthew at rabbitmq.com  Fri Jul  1 18:20:20 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 1 Jul 2011 18:20:20 +0100
Subject: [rabbitmq-discuss] Experimental RabbitMQ Topology Visualiser
In-Reply-To: <18997152.2701.1309539243729.JavaMail.geo-discussion-forums@vbjb24>
References: <20110701162552.GB16713@rabbitmq.com>
	<18997152.2701.1309539243729.JavaMail.geo-discussion-forums@vbjb24>
Message-ID: <20110701172020.GA32239@rabbitmq.com>

On Fri, Jul 01, 2011 at 09:54:03AM -0700, Joseph Marlin wrote:
> Sounds awesome! But it's not working for me... Ubuntu, RabbitMQ 2.5.1 as 
> required. Let me know locations of any log files if they would help...

Gah, I messed up and failed to realise the non-standard way the 2.5.1
release had been done would cause problems.

I've updated the ez and you should have better luck.

For some reason which I don't have time to track down, the visualiser
tab in the mgmt page has the correct link to "/mgmt/visualiser" but
clicking on it seems to take me to /visualiser which then doesn't work.
But if you manually put in /mgmt/visualiser then it works just fine for
me now on a 2.5.1.

Best wishes,

Matthew

From joseph.a.marlin at gmail.com  Fri Jul  1 18:36:17 2011
From: joseph.a.marlin at gmail.com (Joseph Marlin)
Date: Fri, 1 Jul 2011 10:36:17 -0700 (PDT)
Subject: [rabbitmq-discuss] Experimental RabbitMQ Topology Visualiser
In-Reply-To: <20110701172020.GA32239@rabbitmq.com>
Message-ID: <22816101.2657.1309541777390.JavaMail.geo-discussion-forums@vbze22>

Ok, that fixed it. Thanks, and great work too!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110701/a8a5b68b/attachment.htm>

From joseph.a.marlin at gmail.com  Fri Jul  1 18:41:34 2011
From: joseph.a.marlin at gmail.com (Joseph Marlin)
Date: Fri, 1 Jul 2011 10:41:34 -0700 (PDT)
Subject: [rabbitmq-discuss] Experimental RabbitMQ Topology Visualiser
In-Reply-To: <22816101.2657.1309541777390.JavaMail.geo-discussion-forums@vbze22>
Message-ID: <16404198.2767.1309542094906.JavaMail.geo-discussion-forums@vbjb24>

Also, if you were to change the link to <a href="#/visualiser">, instead of 
<a href="mgmt/visualiser">, I think it would work.



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110701/423b804a/attachment.htm>

From majek04 at gmail.com  Fri Jul  1 18:48:40 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 1 Jul 2011 18:48:40 +0100
Subject: [rabbitmq-discuss] First Python sample (send.py) gives error:
 AttributeError: 'ProtocolHeader' object has no attribute 'channel_number'
In-Reply-To: <CA334782.8112%mpietrek@skytap.com>
References: <BANLkTine-cAJs5RLjxB2AVXPNYz4WLPNVw@mail.gmail.com>
	<CA334782.8112%mpietrek@skytap.com>
Message-ID: <BANLkTimKtgbG8BmzUUz3FzjYmp2J+2TA3Q@mail.gmail.com>

Right,

Google says it may be due to an outdated version of RabbitMQ.

Can you make sure you're using RabbitMQ > 2.0 ?

Explanation: rabbitmq < 2.0 spoke AMQP 0-8,
recent pika and recent RabbitMQ speak AMQP 0-9-1.

Cheers,
  Marek

On Fri, Jul 1, 2011 at 18:14, Matt Pietrek <mpietrek at skytap.com> wrote:
> Mark,
>
> Thanks for getting back to me.
>
> Yes, I installed it exactly as specified on the tutorial page. I
> copied/pasted the command line.
>
> Just to be sure, I ran it again and got this output:
>
> foo at foo:~$ sudo pip install -e
> git+http://github.com/pika/pika.git at v0.9.5#egg=pika-v0.9.5
> Checking out pika-v0.9.5 from
> git+http://github.com/pika/pika.git at v0.9.5#egg=pika-v0.9.5 checkout from
> git+http://github.com/pika/pika.git at v0.9.5#egg=pika-v0.9.5
> ?Cloning http://github.com/pika/pika.git (to revision v0.9.5) to
> ./src/pika-v0.9.5
> ?Running setup.py egg_info for package pika-v0.9.5
> Installing collected packages: pika-v0.9.5
> ?Running setup.py develop for pika-v0.9.5
> ? ?Creating /usr/local/lib/python2.6/dist-packages/pika.egg-link (link to
> .)
> ? ?Adding pika 0.9.5 to easy-install.pth file
>
> ? ?Installed /home/highland/src/pika-v0.9.5
> Successfully installed pika-v0.9.5
>
>
> On 7/1/11 3:22 AM, "Marek Majkowski" <majek04 at gmail.com> wrote:
>
>>Matt,
>>
>>Looks like you have a wrong version of pika.
>>
>>Are you sure you have pika 0.9.5 exactly?
>>
>>Have you installed it as suggested on the tutorial page, using pip:
>> ? pip install -e
>>git+http://github.com/pika/pika.git at v0.9.5#egg=pika-v0.9.5
>>
>>Cheers!
>> ?Marek
>>
>>On Thu, Jun 30, 2011 at 23:13, Matt Pietrek <mpietrek at skytap.com> wrote:
>>> I've just now followed the directions verbatim from
>>> here: http://www.rabbitmq.com/tutorials/tutorial-one-python.html
>>> I've copied/pasted the sample code for send.py and receive.py directly
>>>from
>>> the web page so as to eliminate errors. Unfortunately, I'm getting the
>>> following error:
>>>
>>> foo at foo-desktop:~/rabbitmq-test$ python send.py
>>>
>>> Traceback (most recent call last):
>>>
>>> ? File "send.py", line 4, in <module>
>>>
>>> ? ? connection =
>>> pika.BlockingConnection(pika.ConnectionParameters(host='localhost'))
>>>
>>> ? File "/home/foo/src/pika-v0.9.5/pika/adapters/blocking_connection.py",
>>> line 32, in __init__
>>>
>>> ? ? BaseConnection.__init__(self, parameters, None,
>>>reconnection_strategy)
>>>
>>> ? File "/home/foo/src/pika-v0.9.5/pika/adapters/base_connection.py",
>>>line
>>> 50, in __init__
>>>
>>> ? ? reconnection_strategy)
>>>
>>> ? File "/home/foo/src/pika-v0.9.5/pika/connection.py", line 170, in
>>>__init__
>>>
>>> ? ? self._connect()
>>>
>>> ? File "/home/foo/src/pika-v0.9.5/pika/connection.py", line 228, in
>>>_connect
>>>
>>> ? ? self.parameters.port or ?spec.PORT)
>>>
>>> ? File "/home/foo/src/pika-v0.9.5/pika/adapters/blocking_connection.py",
>>> line 44, in _adapter_connect
>>>
>>> ? ? self._handle_read()
>>>
>>> ? File "/home/foo/src/pika-v0.9.5/pika/adapters/base_connection.py",
>>>line
>>> 162, in _handle_read
>>>
>>> ? ? self._on_data_available(data)
>>>
>>> ? File "/home/foo/src/pika-v0.9.5/pika/connection.py", line 597, in
>>> _on_data_available
>>>
>>> ? ? elif frame.channel_number > 0:
>>>
>>> AttributeError: 'ProtocolHeader' object has no attribute
>>>'channel_number'
>>>
>>> Python version is 2.6.5. I'm running this on an ubuntu 10.4 system. Pip
>>>and
>>> Pika were downloaded today per the web site instructions.
>>>
>>> I've searched everywhere and can't see the error referenced.
>>>
>>> Many thanks to anybody that can help me.
>>>
>>> Matt Pietrek.
>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>
>
>

From maxjwarnock at gmail.com  Fri Jul  1 18:51:10 2011
From: maxjwarnock at gmail.com (Max Warnock)
Date: Fri, 1 Jul 2011 13:51:10 -0400
Subject: [rabbitmq-discuss] precondition_failed error with amqp_client
	for erlang
In-Reply-To: <BANLkTi=feh3MPQxQ6vfBnwiaN1TqYsHAkg@mail.gmail.com>
References: <BANLkTimEPWwHhza=v_6bP98a2JPuo64j9Q@mail.gmail.com>
	<20110630114821.GB18064@rabbitmq.com>
	<BANLkTi=feh3MPQxQ6vfBnwiaN1TqYsHAkg@mail.gmail.com>
Message-ID: <BANLkTikioatpncH7r9otPHdLJ8n60wEnJw@mail.gmail.com>

Problem found.  Thanks for your help.  The problem is a strange one and has
to do with me not shutting my amqp_client listener down properly if my
server dies.  Here is how it manifests:

1.) Server starts up and starts up a amqp client connection and channel
2.) The server binds to that channel and starts the subscription using a
registered name name as the process to which messages will be sent
3.) Messages start coming in and are ack-ing fine
4.) Poor error handling in farming out processes brings the server down
5.) The server does no close the amqp_client connection
6.) The server supervisor restarts the server which creates a new listener,
but the old listener is still hanging around trying to send the the
registered name
7.) The older listener sends a message to the server
8.) The server tries to ack to the new listener which did not send the
message
9.) The new server pukes because it never sent a message with that tag

So my question then is how should I kill the amqp_client? If I send it an
exit its supervisor will restart it.  This is what I was getting at with my
tangential questions in the last email.  How should I shut down the
amqp_client without shutting down all the other servers' amqp client
listeners?

Thanks for all the help,
-Max

On Thu, Jun 30, 2011 at 9:23 AM, Max Warnock <maxjwarnock at gmail.com> wrote:

> Thanks, that's very helpful from both the possible issues to chase and
> sanity check perspectives.
>
> I'm using erlang R13B04 with a rabbitmq server installed via gentoo's
> portage at version 2.4.1. I pulled the client library from github (tag
> 2.3.0, commit: 844738f9b56d34104c1ea2ac5700d0898126c5b4).
>
> I'm going to write some debug code to store all the tags I try to ack on
> and see if I can get this error to where it's easily reproducible. Thanks
> for narrowing my search, it's very helpful.  I'll keep you updated. I must
> be doing something wrong somewhere.  I have a hard time believing such a
> widely used library could fail so hard myself.
>
> One thing that would be extremely helpful is if you could point me to some
> documentation which I haven't been able to find:  I'm looking for a listing
> of all the events/messages that are sent out by the amqp client to a
> subscriber.  What does it send when it goes down, what other soft errors
> will it send out, etc.  Additionally, is there a doc somewhere for best
> practices in connecting a listener to another server/long-running process?
>  Not having either of those there has been some struggle to know how to
> restart the subscription/listening process if my server dies.  The
> amqp_client tutorial has been a great help, but when it comes to error
> handling from the listening module perspective it doesn't tell me what the
> library is expecting me to do.  I don't want to have to do a bunch of
> engineering because I'm square peg, round hole-ing the library.  The primary
> issues I'm concerned with are when my server dies hard and is destined to be
> restarted by its supervisor what should I send to the amqp client process?
> Should I send it close messages and then start a new one? Or should I
> reconnect to the client library.  This wouldn't be as big of an issue but I
> need to use durable/persistent queues and if I still have a listener hanging
> around with the same bindings on the same queue it will eat all my messages
> and send them nowhere.
>
> Thanks,
> -Max
>
> On Thu, Jun 30, 2011 at 7:48 AM, Matthew Sackman <matthew at rabbitmq.com>wrote:
>
>> Hi Max,
>>
>> On Wed, Jun 29, 2011 at 06:28:59PM -0400, Max Warnock wrote:
>> > I've built a behavior in erlang to subscribe to a given topic exchange
>> and
>> > farm out message handling.  I'm using the rabbitmq amqp_client library
>> for
>> > erlang and when I put the system under heavy load I get, on occasion,
>> the
>> > following error:
>>
>> Could you let us know which version of Rabbit, Erlang and the Erlang
>> client you're using?
>>
>> > =ERROR REPORT==== 29-Jun-2011::18:02:18 ===
>> > ** Generic server <0.1117.0> terminating
>> > ** Last message in was {'$gen_cast',
>> >                            {method,
>> >                                {'channel.close',406,
>> >                                    <<"PRECONDITION_FAILED - unknown
>> delivery
>> > tag 856">>,
>> >                                    60,80},
>>
>> That's a double-ack (probably). Sadly, the AMQP 0-9-1 spec says that
>> acking is not idempotent, thus it's a fault to ack the same message
>> multiple times...
>>
>> > The server receive loop where the ack happens looks like this:
>> > receive
>> > ...
>> > {#'basic.deliver'{delivery_tag = Tag, routing_key = RoutingKey},
>> > #amqp_msg{payload = Payload}} ->
>> >     amqp_channel:cast(get(amqp_channel_pid), #'basic.ack'{delivery_tag =
>> > Tag}),
>> >     spawn_and_queue(spawn_handle_message, Module, RoutingKey, Payload),
>> >     loop(Module);
>> > ...
>> > end
>>
>> ...hmmm, which is so simple that I can't see how it could go wrong: if
>> you're not double acking then something else must be going on to make
>> the broker think that it's not expecting an ack for that message, hence
>> the error. If you're doing some sort of reject operation - either
>> basic.nack or basic.reject on messages and you then subsequently ack one
>> of those messages then that would also cause this error. There may be
>> other cases as well.
>>
>> > The amqp_client_sup can't seem to bring back the the client either and
>> dies
>> > from the retry intensity being reached.  I've done a hefty amount of
>> > googling and can't seem to find where things could be going wrong.
>>  Before
>> > jumping into the amqp_client code I thought I'd ask the mailing list if
>> they
>> > have any ideas.  The only thing I can think is that there is a race
>> > condition within the client library.  I will be double checking my code
>> to
>> > be sure it isn't sending the ack twice, but given the simplicity of the
>> ack
>> > the only way it could is if it receives the same message (with identical
>> > delivery tag) from the amqp_client library twice.
>>
>> It could be a bug in the client library, but I'd be a little surprised
>> if we're managing to duplicate messages somehow - that would be a new
>> level of fail for us. ;) However, the fact that the entire connection
>> dies is alarming and almost certainly a bug: PRECONDITION_FAILED is a
>> soft error and should only tear down the channel, not the whole
>> connection. After that, all you should have to do is create a new
>> channel and everything else should be ok. If that's not the case please
>> let us know.
>>
>> Best wishes,
>>
>> Matthew
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110701/a9893c7f/attachment.htm>

From videlalvaro at gmail.com  Fri Jul  1 19:04:59 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 1 Jul 2011 20:04:59 +0200
Subject: [rabbitmq-discuss] Experimental RabbitMQ Topology Visualiser
In-Reply-To: <20110701162552.GB16713@rabbitmq.com>
References: <20110701162552.GB16713@rabbitmq.com>
Message-ID: <508A20A6-E335-4D6B-AF54-1032575305FC@gmail.com>

Hi Matthew,

I've just testing, is looking pretty awesome.

I think if you add a feature were using Drag&Drop one could design a routing topology will make this a kick ass app.

Cheers,

Alvaro

On Jul 1, 2011, at 6:25 PM, Matthew Sackman wrote:

> Howdy,
> 
> So, seeing as it's Friday, I thought you'd all like something to play
> with over the weekend.
> 
> If you happen to be running 2.5.1, and you happen to be have the
> management plugin installed (or if not, see
> http://www.rabbitmq.com/plugins.html#rabbitmq-management), then you
> might be interested in removing
> plugins/rabbitmq_management-2.5.1.ez and instead dropping into plugins/
> http://www.rabbitmq.com/releases/plugins/v2.5.1-visualiser-wip/rabbitmq_management-2.5.1-visualiser-20110701.ez
> 
> Then, if you happen to be using Firefox 4 or Firefox 5, or Google
> Chrome, then you should then be able to click on the "Visualiser" tab
> from the management page, and you will then get an HTML5 Canvas which
> displays the routing topology.
> 
> This is very much a work in progress. Best results are with the latest
> Google Chrome. Whilst none of Opera, IE9 or Safari show any errors, I'm
> clearly doing something wrong as they fail to render more than one
> frame. If someone can figure out what I'm doing wrong, please say so!
> 
> o) Try dragging things around!
> 
> o) Try shift-clicking on things!
> 
> o) Enjoy that you currently can only see the vhost "/"!
> 
> Lots of features are planned, and any and all feedback is very welcome.
> 
> Enjoy!
> 
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

Sent form my Nokia 1100




From mpietrek at skytap.com  Fri Jul  1 19:26:46 2011
From: mpietrek at skytap.com (Matt Pietrek)
Date: Fri, 01 Jul 2011 11:26:46 -0700
Subject: [rabbitmq-discuss] First Python sample (send.py) gives error:
 AttributeError: 'ProtocolHeader' object has no attribute 'channel_number'
In-Reply-To: <BANLkTimKtgbG8BmzUUz3FzjYmp2J+2TA3Q@mail.gmail.com>
Message-ID: <CA335EA0.8171%mpietrek@skytap.com>

Hmm.. Perhaps it is an old version (1.7.2?). However, not sure how I got
it, given that I installed just yesterday. To be sure, I ran the
following, which does not seem to get me the latest:

foo at foo:~$ sudo apt-get update
Hit http://security.ubuntu.com lucid-security Release.gpg
Ign http://security.ubuntu.com/ubuntu/ lucid-security/main
Translation-en_US
Ign http://security.ubuntu.com/ubuntu/ lucid-security/restricted
Translation-en_US
Hit http://us.archive.ubuntu.com lucid Release.gpg
Ign http://us.archive.ubuntu.com/ubuntu/ lucid/main Translation-en_US
Ign http://us.archive.ubuntu.com/ubuntu/ lucid/restricted Translation-en_US
Ign http://security.ubuntu.com/ubuntu/ lucid-security/universe
Translation-en_US
Ign http://security.ubuntu.com/ubuntu/ lucid-security/multiverse
Translation-en_US
Hit http://security.ubuntu.com lucid-security Release
Ign http://us.archive.ubuntu.com/ubuntu/ lucid/universe Translation-en_US
Ign http://us.archive.ubuntu.com/ubuntu/ lucid/multiverse Translation-en_US
Hit http://us.archive.ubuntu.com lucid-updates Release.gpg
Ign http://us.archive.ubuntu.com/ubuntu/ lucid-updates/main
Translation-en_US
Ign http://us.archive.ubuntu.com/ubuntu/ lucid-updates/restricted
Translation-en_US
Ign http://us.archive.ubuntu.com/ubuntu/ lucid-updates/universe
Translation-en_US
Ign http://us.archive.ubuntu.com/ubuntu/ lucid-updates/multiverse
Translation-en_US
Hit http://us.archive.ubuntu.com lucid Release
Hit http://us.archive.ubuntu.com lucid-updates Release
Hit http://security.ubuntu.com lucid-security/main Packages
Hit http://us.archive.ubuntu.com lucid/main Packages
Hit http://us.archive.ubuntu.com lucid/restricted Packages
Hit http://us.archive.ubuntu.com lucid/main Sources
Hit http://us.archive.ubuntu.com lucid/restricted Sources
Hit http://us.archive.ubuntu.com lucid/universe Packages
Hit http://us.archive.ubuntu.com lucid/universe Sources
Hit http://security.ubuntu.com lucid-security/restricted Packages
Hit http://security.ubuntu.com lucid-security/main Sources
Hit http://security.ubuntu.com lucid-security/restricted Sources
Hit http://security.ubuntu.com lucid-security/universe Packages
Hit http://security.ubuntu.com lucid-security/universe Sources
Hit http://security.ubuntu.com lucid-security/multiverse Packages
Hit http://us.archive.ubuntu.com lucid/multiverse Packages
Hit http://us.archive.ubuntu.com lucid/multiverse Sources
Hit http://security.ubuntu.com lucid-security/multiverse Sources
Hit http://us.archive.ubuntu.com lucid-updates/main Packages
Hit http://us.archive.ubuntu.com lucid-updates/restricted Packages
Hit http://us.archive.ubuntu.com lucid-updates/main Sources
Hit http://us.archive.ubuntu.com lucid-updates/restricted Sources
Hit http://us.archive.ubuntu.com lucid-updates/universe Packages
Hit http://us.archive.ubuntu.com lucid-updates/universe Sources
Hit http://us.archive.ubuntu.com lucid-updates/multiverse Packages
Hit http://us.archive.ubuntu.com lucid-updates/multiverse Sources
Reading package lists... Done

highland at highland-desktop:~$ apt-show-versions | grep rabbitmq
rabbitmq-server/lucid uptodate 1.7.2-1ubuntu1

highland at highland-desktop:~$ sudo apt-get install rabbitmq-server
Reading package lists... Done
Building dependency tree
Reading state information... Done
rabbitmq-server is already the newest version.
0 upgraded, 0 newly installed, 0 to remove and 278 not upgraded.
highland at highland-desktop:~$


I'm going to try explicitly attaching to the RabbitMQ APT, per the
directions, but I'd think the standard Ubuntu repositories would be up to
date. Either that, or I'm overlooking something beyond my current Linux
skills.



On 7/1/11 10:48 AM, "Marek Majkowski" <majek04 at gmail.com> wrote:

>Right,
>
>Google says it may be due to an outdated version of RabbitMQ.
>
>Can you make sure you're using RabbitMQ > 2.0 ?
>
>Explanation: rabbitmq < 2.0 spoke AMQP 0-8,
>recent pika and recent RabbitMQ speak AMQP 0-9-1.
>
>Cheers,
>  Marek
>
>On Fri, Jul 1, 2011 at 18:14, Matt Pietrek <mpietrek at skytap.com> wrote:
>> Mark,
>>
>> Thanks for getting back to me.
>>
>> Yes, I installed it exactly as specified on the tutorial page. I
>> copied/pasted the command line.
>>
>> Just to be sure, I ran it again and got this output:
>>
>> foo at foo:~$ sudo pip install -e
>> git+http://github.com/pika/pika.git at v0.9.5#egg=pika-v0.9.5
>> Checking out pika-v0.9.5 from
>> git+http://github.com/pika/pika.git at v0.9.5#egg=pika-v0.9.5 checkout from
>> git+http://github.com/pika/pika.git at v0.9.5#egg=pika-v0.9.5
>>  Cloning http://github.com/pika/pika.git (to revision v0.9.5) to
>> ./src/pika-v0.9.5
>>  Running setup.py egg_info for package pika-v0.9.5
>> Installing collected packages: pika-v0.9.5
>>  Running setup.py develop for pika-v0.9.5
>>    Creating /usr/local/lib/python2.6/dist-packages/pika.egg-link (link
>>to
>> .)
>>    Adding pika 0.9.5 to easy-install.pth file
>>
>>    Installed /home/highland/src/pika-v0.9.5
>> Successfully installed pika-v0.9.5
>>
>>
>> On 7/1/11 3:22 AM, "Marek Majkowski" <majek04 at gmail.com> wrote:
>>
>>>Matt,
>>>
>>>Looks like you have a wrong version of pika.
>>>
>>>Are you sure you have pika 0.9.5 exactly?
>>>
>>>Have you installed it as suggested on the tutorial page, using pip:
>>>   pip install -e
>>>git+http://github.com/pika/pika.git at v0.9.5#egg=pika-v0.9.5
>>>
>>>Cheers!
>>>  Marek
>>>
>>>On Thu, Jun 30, 2011 at 23:13, Matt Pietrek <mpietrek at skytap.com> wrote:
>>>> I've just now followed the directions verbatim from
>>>> here: http://www.rabbitmq.com/tutorials/tutorial-one-python.html
>>>> I've copied/pasted the sample code for send.py and receive.py directly
>>>>from
>>>> the web page so as to eliminate errors. Unfortunately, I'm getting the
>>>> following error:
>>>>
>>>> foo at foo-desktop:~/rabbitmq-test$ python send.py
>>>>
>>>> Traceback (most recent call last):
>>>>
>>>>   File "send.py", line 4, in <module>
>>>>
>>>>     connection =
>>>> pika.BlockingConnection(pika.ConnectionParameters(host='localhost'))
>>>>
>>>>   File 
>>>>"/home/foo/src/pika-v0.9.5/pika/adapters/blocking_connection.py",
>>>> line 32, in __init__
>>>>
>>>>     BaseConnection.__init__(self, parameters, None,
>>>>reconnection_strategy)
>>>>
>>>>   File "/home/foo/src/pika-v0.9.5/pika/adapters/base_connection.py",
>>>>line
>>>> 50, in __init__
>>>>
>>>>     reconnection_strategy)
>>>>
>>>>   File "/home/foo/src/pika-v0.9.5/pika/connection.py", line 170, in
>>>>__init__
>>>>
>>>>     self._connect()
>>>>
>>>>   File "/home/foo/src/pika-v0.9.5/pika/connection.py", line 228, in
>>>>_connect
>>>>
>>>>     self.parameters.port or  spec.PORT)
>>>>
>>>>   File 
>>>>"/home/foo/src/pika-v0.9.5/pika/adapters/blocking_connection.py",
>>>> line 44, in _adapter_connect
>>>>
>>>>     self._handle_read()
>>>>
>>>>   File "/home/foo/src/pika-v0.9.5/pika/adapters/base_connection.py",
>>>>line
>>>> 162, in _handle_read
>>>>
>>>>     self._on_data_available(data)
>>>>
>>>>   File "/home/foo/src/pika-v0.9.5/pika/connection.py", line 597, in
>>>> _on_data_available
>>>>
>>>>     elif frame.channel_number > 0:
>>>>
>>>> AttributeError: 'ProtocolHeader' object has no attribute
>>>>'channel_number'
>>>>
>>>> Python version is 2.6.5. I'm running this on an ubuntu 10.4 system.
>>>>Pip
>>>>and
>>>> Pika were downloaded today per the web site instructions.
>>>>
>>>> I've searched everywhere and can't see the error referenced.
>>>>
>>>> Many thanks to anybody that can help me.
>>>>
>>>> Matt Pietrek.
>>>>
>>>>
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>
>>>>
>>
>>
>>



From michael.s.klishin at gmail.com  Fri Jul  1 20:02:41 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 1 Jul 2011 23:02:41 +0400
Subject: [rabbitmq-discuss] First Python sample (send.py) gives error:
 AttributeError: 'ProtocolHeader' object has no attribute 'channel_number'
In-Reply-To: <CA335EA0.8171%mpietrek@skytap.com>
References: <CA335EA0.8171%mpietrek@skytap.com>
Message-ID: <6FAF49FAB4B44CED824F5CF6CB575181@gmail.com>

Matt Pietrek escribi?:
> I'm going to try explicitly attaching to the RabbitMQ APT, per the
> directions, but I'd think the standard Ubuntu repositories would be up to
> date. Either that, or I'm overlooking something beyond my current Linux
> skills.
Matt,

They aren't. Ubuntu packages in 10.04 and 10.10 are ancient. So please use
rabbitmq.com apt repository:

http://www.rabbitmq.com/debian.html#apt 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin



From mpietrek at skytap.com  Fri Jul  1 20:05:17 2011
From: mpietrek at skytap.com (Matt Pietrek)
Date: Fri, 01 Jul 2011 12:05:17 -0700
Subject: [rabbitmq-discuss] First Python sample (send.py) gives error:
 AttributeError: 'ProtocolHeader' object has no attribute 'channel_number'
In-Reply-To: <6FAF49FAB4B44CED824F5CF6CB575181@gmail.com>
Message-ID: <CA336841.817D%mpietrek@skytap.com>

Indeed. Lesson learned for me.

With the newer version (2.5.1), the sample app works as expected.

Thanks much to both of your for your replies,

Matt

On 7/1/11 12:02 PM, "Michael Klishin" <michael.s.klishin at gmail.com> wrote:

>Matt Pietrek escribi?:
>> I'm going to try explicitly attaching to the RabbitMQ APT, per the
>> directions, but I'd think the standard Ubuntu repositories would be up
>>to
>> date. Either that, or I'm overlooking something beyond my current Linux
>> skills.
>Matt,
>
>They aren't. Ubuntu packages in 10.04 and 10.10 are ancient. So please use
>rabbitmq.com apt repository:
>
>http://www.rabbitmq.com/debian.html#apt
>MK
>
>http://github.com/michaelklishin
>http://twitter.com/michaelklishin
>
>



From majek04 at gmail.com  Fri Jul  1 21:02:05 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 1 Jul 2011 21:02:05 +0100
Subject: [rabbitmq-discuss] First Python sample (send.py) gives error:
 AttributeError: 'ProtocolHeader' object has no attribute 'channel_number'
In-Reply-To: <CA336841.817D%mpietrek@skytap.com>
References: <6FAF49FAB4B44CED824F5CF6CB575181@gmail.com>
	<CA336841.817D%mpietrek@skytap.com>
Message-ID: <BANLkTimuwJwDvdS_3xBQ8SpgyQZm=omQ5w@mail.gmail.com>

On Fri, Jul 1, 2011 at 20:05, Matt Pietrek <mpietrek at skytap.com> wrote:
> Indeed. Lesson learned for me.
>
> With the newer version (2.5.1), the sample app works as expected.
>
> Thanks much to both of your for your replies,

Yeah, sorry for that. RabbitMQ moves a bit faster than linux distributions :)

(although, that's a lesson for us - client packages should support
"old" releases!)

I'm glad you were able to get it working.

Cheers,
   Marek

From matthew at rabbitmq.com  Fri Jul  1 23:56:40 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 1 Jul 2011 23:56:40 +0100
Subject: [rabbitmq-discuss] Experimental RabbitMQ Topology Visualiser
In-Reply-To: <16404198.2767.1309542094906.JavaMail.geo-discussion-forums@vbjb24>
References: <22816101.2657.1309541777390.JavaMail.geo-discussion-forums@vbze22>
	<16404198.2767.1309542094906.JavaMail.geo-discussion-forums@vbjb24>
Message-ID: <20110701225640.GA2916@rabbitmq.com>

On Fri, Jul 01, 2011 at 10:41:34AM -0700, Joseph Marlin wrote:
> Also, if you were to change the link to <a href="#/visualiser">, instead of 
> <a href="mgmt/visualiser">, I think it would work.

Ok, I'll try that. The whole thing is losing its mgmt prefix in the
future anyway so this will undoubtedly change. Glad you got it working.

Matthew

From matthew at rabbitmq.com  Fri Jul  1 23:58:36 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 1 Jul 2011 23:58:36 +0100
Subject: [rabbitmq-discuss] Experimental RabbitMQ Topology Visualiser
In-Reply-To: <508A20A6-E335-4D6B-AF54-1032575305FC@gmail.com>
References: <20110701162552.GB16713@rabbitmq.com>
	<508A20A6-E335-4D6B-AF54-1032575305FC@gmail.com>
Message-ID: <20110701225835.GB2916@rabbitmq.com>

Hi Alvaro,

On Fri, Jul 01, 2011 at 08:04:59PM +0200, Alvaro Videla wrote:
> I've just testing, is looking pretty awesome.

Thanks :D

> I think if you add a feature were using Drag&Drop one could design a routing topology will make this a kick ass app.

Now that's a good idea; which I've not thought of. I have a long list of
additional bits of information it needs to be able to display in
sensible forms but I'd not considered using it to construct things
rather than just display things. Neat idea - and some obvious
applications - e.g. just drag between an exchange and a queue to create
a binding, etc etc.

Thanks for the suggestion!

Matthew

From videlalvaro at gmail.com  Sat Jul  2 00:45:46 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Sat, 2 Jul 2011 01:45:46 +0200
Subject: [rabbitmq-discuss] Experimental RabbitMQ Topology Visualiser
In-Reply-To: <20110701225835.GB2916@rabbitmq.com>
References: <20110701162552.GB16713@rabbitmq.com>
	<508A20A6-E335-4D6B-AF54-1032575305FC@gmail.com>
	<20110701225835.GB2916@rabbitmq.com>
Message-ID: <98447903-9CDB-4C33-856D-9E33CEFA7BB9@gmail.com>

Hi Matthew,

> Now that's a good idea; which I've not thought of. I have a long list of
> additional bits of information it needs to be able to display in
> sensible forms but I'd not considered using it to construct things
> rather than just display things. Neat idea - and some obvious
> applications - e.g. just drag between an exchange and a queue to create
> a binding, etc etc.

I've started playing with that idea a while ago as shown in this short video: http://vimeo.com/22722581

There's a live demo of that web application running here: http://tryrabbitmq.github.com/ using Canvas too.

You can add queues and exchanges, bind them, create consumers, publish messages, add callbacks to messages and so on.

Note: 

a) It's an early prototype, code needs clean up, design needs UX improvements, etc.
b) There's a fake implementation of RabbitMQ in Javascript? basically to simulate how things work and prototype on top of that. (I've could have used Websocktes with a real RabbitMQ).
c) There's a silly bug now where messages get fanout'ed to consumers instead of being "round robin" to them. 

And most important, by no means this plans to compete with your tool. Perhaps it can be useful for inspiration. 

Cheers,

Alvaro
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110702/e7abbacf/attachment.htm>

From bryanalves at gmail.com  Sat Jul  2 02:56:49 2011
From: bryanalves at gmail.com (Bryan Alves)
Date: Fri, 1 Jul 2011 21:56:49 -0400
Subject: [rabbitmq-discuss] RabbitMQ crash in production - help diagnose
	from log
Message-ID: <BANLkTi=qQ-wYE5LYRk-0oV1vhiCyTR_40g@mail.gmail.com>

A production instance of RabbitMQ crashed on us yesterday, and we have no
idea why.  RabbitMQ 2.3.1 & Erlang R14B01

Attached is the SASL log and erl_crash.dump file.  After noticing the crash,
we restarted the daemon and it came back up with no complications.  Hardware
is a virtual machine with 8GB of ram, which leaves plenty of headroom most
of the time.

Any advice about what could  have caused the crashed and how to avoid it in
the future would be appreciated.

-- 
Bryan Alves
Software Engineer
Blue State Digital
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110701/33b63f26/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit at rabbitmq1-sasl.log.1
Type: application/octet-stream
Size: 50357 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110701/33b63f26/attachment-0002.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: erl_crash.dump
Type: application/octet-stream
Size: 964382 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110701/33b63f26/attachment-0003.obj>

From matthias at rabbitmq.com  Sat Jul  2 13:13:27 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 02 Jul 2011 13:13:27 +0100
Subject: [rabbitmq-discuss] RabbitMQ crash in production - help diagnose
 from log
In-Reply-To: <BANLkTi=qQ-wYE5LYRk-0oV1vhiCyTR_40g@mail.gmail.com>
References: <BANLkTi=qQ-wYE5LYRk-0oV1vhiCyTR_40g@mail.gmail.com>
Message-ID: <4E0F0B67.3020408@rabbitmq.com>

Bryan,

On 02/07/11 02:56, Bryan Alves wrote:
> A production instance of RabbitMQ crashed on us yesterday, and we have
> no idea why.  RabbitMQ 2.3.1 & Erlang R14B01

Is that the first time it happened? And for how long had that rabbit 
been running when it perished?

> Attached is the SASL log and erl_crash.dump file.

Thanks. It looks like the crash might be triggered by a rare race 
condition. The message store gc is trying to combine two files, one of 
which appears to have vanished from its index. It should be impossible 
to end up in that situation. Nothing obvious jumps out at me from the 
code, so this may take a while to track down.

> Any advice about what could  have caused the crashed and how to avoid it
> in the future would be appreciated.

I suggest you upgrade to 2.5.1. There have been some changes in that 
area of the code, though nothing specifically related to the above. So I 
doubt the problem will go away with 2.5.1, but it would help to find out 
for sure.

Thanks for bringing this problem to our attention.

Regards,

Matthias.

From michael.justin at gmx.net  Sat Jul  2 14:20:01 2011
From: michael.justin at gmx.net (Michael Justin)
Date: Sat, 02 Jul 2011 15:20:01 +0200
Subject: [rabbitmq-discuss] Feedback on STOMP changes
In-Reply-To: <4E04923C.4090307@rabbitmq.com>
References: <4E04923C.4090307@rabbitmq.com>
Message-ID: <iun5u2$p2r$1@dough.gmane.org>

Am 24.06.2011 15:33, Rob Harrop wrote:

> We'll add support for durable, exclusive, auto-delete and everything

Would this include creation of "temporary queues", which exist only for 
the duration of the connection?

If yes, does the client have to ensure that the temporary queue name is 
unique?

In Stomp implementations for ActiveMQ and OpenMQ, the server creates the 
queue name and adds it as "reply-to" header to the messages (see 
https://issues.jboss.org/browse/HORNETQ-381)

Regards
-- 
Michael Justin
habarisoft - Enterprise Messaging Software for Delphi?
http://www.habarisoft.com/


From bryanalves at gmail.com  Sat Jul  2 16:05:20 2011
From: bryanalves at gmail.com (Bryan Alves)
Date: Sat, 2 Jul 2011 11:05:20 -0400
Subject: [rabbitmq-discuss] RabbitMQ crash in production - help diagnose
 from log
Message-ID: <BANLkTimdfr73m9r+EcfZFX_J05QbBiuZ8A@mail.gmail.com>

This is the first time it happened, and the system had been in production
for a few months. The load (in messages/sec) had maybe been up a bit
recently, and become a little spikey, but still on the order of dozens to
low hundreds per second.

If upgrading is likely to fix the situation we can try setting that up. I'd
like to avoid that effort if its not going to solve this specific problem
(not a huge fan of upgrading "just because")

Also, it's probably obvious from the report, we can't reproduce the problem.

Thanks for taking a look at this. If there is anything else you need from
me, let me know.

On Jul 2, 2011 8:13 AM, "Matthias Radestock" <matthias at rabbitmq.com> wrote:
>
> Bryan,
>
>
> On 02/07/11 02:56, Bryan Alves wrote:
>>
>> A production instance of RabbitMQ crashed on us yesterday, and we have
>> no idea why.  RabbitMQ 2.3.1 & Erlang R14B01
>
>
> Is that the first time it happened? And for how long had that rabbit been
running when it perished?
>
>
>> Attached is the SASL log and erl_crash.dump file.
>
>
> Thanks. It looks like the crash might be triggered by a rare race
condition. The message store gc is trying to combine two files, one of which
appears to have vanished from its index. It should be impossible to end up
in that situation. Nothing obvious jumps out at me from the code, so this
may take a while to track down.
>
>
>> Any advice about what could  have caused the crashed and how to avoid it
>> in the future would be appreciated.
>
>
> I suggest you upgrade to 2.5.1. There have been some changes in that area
of the code, though nothing specifically related to the above. So I doubt
the problem will go away with 2.5.1, but it would help to find out for sure.
>
> Thanks for bringing this problem to our attention.
>
> Regards,
>
> Matthias.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110702/a2c4352b/attachment.htm>

From matthew at rabbitmq.com  Sat Jul  2 18:30:01 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Sat, 2 Jul 2011 18:30:01 +0100
Subject: [rabbitmq-discuss] Experimental RabbitMQ Topology Visualiser
In-Reply-To: <20110701162552.GB16713@rabbitmq.com>
References: <20110701162552.GB16713@rabbitmq.com>
Message-ID: <20110702173000.GA15232@rabbitmq.com>

On Fri, Jul 01, 2011 at 05:25:53PM +0100, Matthew Sackman wrote:
> If you happen to be running 2.5.1, and you happen to be have the
> management plugin installed (or if not, see
> http://www.rabbitmq.com/plugins.html#rabbitmq-management), then you
> might be interested in removing
> plugins/rabbitmq_management-2.5.1.ez and instead dropping into plugins/
> http://www.rabbitmq.com/releases/plugins/v2.5.1-visualiser-wip/rabbitmq_management-2.5.1-visualiser-20110701.ez

So, 31 unique IP downloads within 24 hours - I guess people like the
idea of being able to see what the topologies are within their brokers.
My plans are generally along the following lines:

0. allow the selection of different vhosts.

1. hovering over a queue or channel should link the queue to its
consuming channels, and vice versa.

2. hovering over any item should produce a tool-tip-style box with all
the other essential stats and details about the item. So for exchanges,
type, arguments; for queues, durable, auto-delete, exclusive, plus the
other stats about the nature of their content; channels, similarly, the
usual suspects.

3. optionally display connections above channels. This is only really
useful if you have multiple channels per connection.

4. the entries in the "disabled" select boxes on the left should be
alphabetically sorted.

5. channels should be grouped by connection.

6. it seems wrong to me somehow that disabling an entire class (say,
queues) does not add the queues that were being displayed to the select
box. It does suggest that those items have just vanished.

7. The bindings, and other links that may be being displayed should be
coloured by their relative activity. Much information about the health
of the system can be conveyed very quickly this way.

Any requests? I liked Alvaro's idea of being able to construct things
through this, but it'll take me quite some time to get that far.

Are there any IE9 or Safari or Opera canvas gurus out there who can
point out what I'm doing wrong to result in those browsers being able to
render exactly one frame, then continue to work (CPU use shows it), but
not actually render subsequent frames? (and no js error is reported)

I have spent quite a lot of time trying to make sure it doesn't eat too
much CPU, but both my desktop and laptop are quite recent machines and
thus rather meaty. Does it work ok on slightly older machines without
bringing them to their knees? Certainly even my desktop starts to
struggle once I have a couple hundred items being drawn - I guess js
interpreters still have quite a way to go in their optimisations.

Matthew


From matthias at rabbitmq.com  Sat Jul  2 18:49:10 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 02 Jul 2011 18:49:10 +0100
Subject: [rabbitmq-discuss] RabbitMQ crash in production - help diagnose
 from log
In-Reply-To: <BANLkTimdfr73m9r+EcfZFX_J05QbBiuZ8A@mail.gmail.com>
References: <BANLkTimdfr73m9r+EcfZFX_J05QbBiuZ8A@mail.gmail.com>
Message-ID: <4E0F5A16.8060706@rabbitmq.com>

Bryan,

On 02/07/11 16:05, Bryan Alves wrote:
> If upgrading is likely to fix the situation we can try setting that up.
> I'd like to avoid that effort if its not going to solve this specific
> problem (not a huge fan of upgrading "just because")

Understood. Upgrading probably won't solve the problem. And in any case 
we'd have to wait many months to be reasonably confident it did. So 
scratch that idea - though obviously I'd still encourage you to upgrade 
anyway, so you can discover more recent bugs ;)


Regards,

Matthias.

From gmr at myyearbook.com  Sun Jul  3 00:10:24 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Sat, 2 Jul 2011 19:10:24 -0400
Subject: [rabbitmq-discuss] Broken link for rfc4627_jsonrpc plugins page
Message-ID: <CAL_e=0oh+b9ry4SmUgWoN1sZMfRcYnkuYTDufg4gji1YsvO0jg@mail.gmail.com>

The link for rfc4627_jsonrpc on the plugins page is currently:

  http://www.rabbitmq.com/releases/plugins/v2.5.1/rfc4627_jsonrpc-2.5.1-git00caae5.ez

should be:

  http://www.rabbitmq.com/releases/plugins/v2.5.1/rfc4627_jsonrpc-2.5.1-git30c8498.ez

Regards,

Gavin

From gmr at myyearbook.com  Sun Jul  3 00:50:33 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Sat, 2 Jul 2011 19:50:33 -0400
Subject: [rabbitmq-discuss] rabbitmq_jsonrpc_channel broken on 2.5.1
Message-ID: <CAL_e=0qnuO4ghEA6-xW0CfaZV+cn04rC3GiGLJjUGKY_LC34Og@mail.gmail.com>

Even with downloading the proper file for rfc4627_jsonrpc-2.5.1-git30c8498,
when I try and run RabbitMQ 2.5.1 with only the base requirements for
rabbitmq_jsonrpc_channel I receive the following error and find that
RabbitMQ is not listening on 55672:

Activating RabbitMQ plugins ...
********************************************************************************
*WARNING* Undefined function webmachine:new_request/2
*WARNING* Undefined function webmachine_decision_core:handle_request/2
*WARNING* Undefined function webmachine_dispatcher:dispatch/2
*WARNING* Undefined function webmachine_error_handler:render_error/3
*WARNING* Undefined function webmachine_resource:new/4
********************************************************************************
6 plugins activated:
* amqp_client-2.5.1
* mochiweb-1.3-rmq2.5.1-git9a53dbd
* rabbitmq_jsonrpc-2.5.1
* rabbitmq_jsonrpc_channel-2.5.1
* rabbitmq_mochiweb-2.5.1
* rfc4627_jsonrpc-2.5.1-git30c8498

gmr-0x15:~ gmr$ telnet localhost 55672
Trying fe80::1...
telnet: connect to address fe80::1: Connection refused
Trying ::1...
telnet: connect to address ::1: Connection refused
Trying 127.0.0.1...
telnet: connect to address 127.0.0.1: Connection refused
telnet: Unable to connect to remote host


When the management plugin related plugins are added, Rabbit will now listen
on 55672, but unlike previous versions, it doesn't appear that /rpc/ is
registered, nor are the examples:

Activating RabbitMQ plugins ...
12 plugins activated:
* amqp_client-2.5.1
* mochiweb-1.3-rmq2.5.1-git9a53dbd
* rabbitmq_jsonrpc-2.5.1
* rabbitmq_jsonrpc_channel-2.5.1
* rabbitmq_jsonrpc_channel_examples-2.5.1
* rabbitmq_management-2.5.1
* rabbitmq_management_agent-2.5.1
* rabbitmq_mochiweb-2.5.1
* rabbitmq_shovel-2.5.1
* rabbitmq_stomp-2.5.1
* rfc4627_jsonrpc-2.5.1-git30c8498
* webmachine-1.7.0-rmq2.5.1-hg0c4b60a


http://localhost:55672 output (html stripped):

RabbitMQ Web Server

Contexts available:

Management: Web UI
Management: HTTP API
Management: Command Line Tool


Let me know if I can provide any other information to help track it down.
Erlang version is R14B03 on OSX (Lion).

Gavin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110702/16562ade/attachment.htm>

From gmr at myyearbook.com  Sun Jul  3 01:03:18 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Sat, 2 Jul 2011 20:03:18 -0400
Subject: [rabbitmq-discuss] Experimental RabbitMQ Topology Visualiser
In-Reply-To: <20110702173000.GA15232@rabbitmq.com>
References: <20110701162552.GB16713@rabbitmq.com>
	<20110702173000.GA15232@rabbitmq.com>
Message-ID: <CAL_e=0qdNGA9UQ5Pc2zpv8uvD4n6QF--KeLQP51+Ahj56v31jQ@mail.gmail.com>

On Sat, Jul 2, 2011 at 1:30 PM, Matthew Sackman <matthew at rabbitmq.com>wrote:

>
> So, 31 unique IP downloads within 24 hours - I guess people like the
> idea of being able to see what the topologies are within their brokers.
>

Love it, looks good, will love to see how it develops.


> My plans are generally along the following lines:
>
> 0. allow the selection of different vhosts.
>
> 1. hovering over a queue or channel should link the queue to its
> consuming channels, and vice versa.
>
> 2. hovering over any item should produce a tool-tip-style box with all
> the other essential stats and details about the item. So for exchanges,
> type, arguments; for queues, durable, auto-delete, exclusive, plus the
> other stats about the nature of their content; channels, similarly, the
> usual suspects.
>
> 3. optionally display connections above channels. This is only really
> useful if you have multiple channels per connection.
>
> 4. the entries in the "disabled" select boxes on the left should be
> alphabetically sorted.
>
> 5. channels should be grouped by connection.
>
> 6. it seems wrong to me somehow that disabling an entire class (say,
> queues) does not add the queues that were being displayed to the select
> box. It does suggest that those items have just vanished.
>
> 7. The bindings, and other links that may be being displayed should be
> coloured by their relative activity. Much information about the health
> of the system can be conveyed very quickly this way.
>
> Any requests? I liked Alvaro's idea of being able to construct things
> through this, but it'll take me quite some time to get that far.
>

Perhaps using the management plugin velocity rates you could use thicker
lines or annotate lines with message velocities?

Also visualization of cluster mechanics would be cool, though I'm not quite
sure how one would represent it yet other than having it as part of the
tooltips for the queues and connections.

Also I think it would be interesting instead of showing hovering over the
queue to see the channels to instead represent the consumer tag as an object
and link the channel to the consumer tag and the queue to the consumer tag.
It could get quite big but to show the topology of:

connection -> channel -> consumer_tag <- queue <- exchange

Would be interesting. It's too bad there's not as exact of a topology for
publishers, with regard to visualization like this.

Great work and cool idea,

Gavin







Looking forward to see how this develops.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110702/85138f59/attachment.htm>

From jiri at krutil.com  Sun Jul  3 16:19:31 2011
From: jiri at krutil.com (Jiri Krutil)
Date: Sun, 03 Jul 2011 17:19:31 +0200
Subject: [rabbitmq-discuss] Reordering on requeue
Message-ID: <1309706371.26787.8.camel@holba>

Hi

I would like to know if and when does rabbit change the order of
messages on a queue in case of reject with requeue.

Will a requeued message be pushed back onto the queue tail or will it
stay at the head? What about messages consumed within a transaction that
was rolled back?

Cheers
Jiri


From matthias at rabbitmq.com  Sun Jul  3 20:54:27 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 03 Jul 2011 20:54:27 +0100
Subject: [rabbitmq-discuss] Reordering on requeue
In-Reply-To: <1309706371.26787.8.camel@holba>
References: <1309706371.26787.8.camel@holba>
Message-ID: <4E10C8F3.1060908@rabbitmq.com>

Jiri,

On 03/07/11 16:19, Jiri Krutil wrote:
> I would like to know if and when does rabbit change the order of
> messages on a queue in case of reject with requeue.
>
> Will a requeued message be pushed back onto the queue tail or will it
> stay at the head?

It will go to the tail. We are considering changing that behaviour for 
channel/connection closure and basic.recover{requeue=true}, but 
basic.reject/nack will likely stay as they are.

> What about messages consumed within a transaction that
> was rolled back?

Message consumption is not transactional. Acks are. When a transaction 
is rolled back all the acks submitted in it are forgotten, as if they 
had never happened. At that point the client still logically owns the 
messages - no message is requeued until it has been basic.reject/nack'ed 
or the consuming channel closes.


Matthias.

From thomas.kant at gmail.com  Sun Jul  3 23:09:26 2011
From: thomas.kant at gmail.com (scorpiovn)
Date: Sun, 3 Jul 2011 15:09:26 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq-activate-plugins
Message-ID: <3ef6d12f-a41a-40bb-bb10-fce88555a333@p30g2000prp.googlegroups.com>

Hi All,

After I installed rabiitmq-server on ubuntu 10.04, I run rabbitmq-
activate-plugins.
I got this notify 'sudo: rabbitmq-activate-plugins: command not
found'.

Could you help me out this problem?

Thanks,
+++
thomas.kant




From matthew at rabbitmq.com  Sun Jul  3 23:17:01 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Sun, 3 Jul 2011 23:17:01 +0100
Subject: [rabbitmq-discuss] rabbitmq-activate-plugins
In-Reply-To: <3ef6d12f-a41a-40bb-bb10-fce88555a333@p30g2000prp.googlegroups.com>
References: <3ef6d12f-a41a-40bb-bb10-fce88555a333@p30g2000prp.googlegroups.com>
Message-ID: <20110703221700.GA3566@rabbitmq.com>

Hi,

On Sun, Jul 03, 2011 at 03:09:26PM -0700, scorpiovn wrote:
> After I installed rabiitmq-server on ubuntu 10.04, I run rabbitmq-
> activate-plugins.
> I got this notify 'sudo: rabbitmq-activate-plugins: command not
> found'.

activate-plugins disappeared a long time ago. If you're using a recent
version of RabbitMQ, it will just activate all the plugins it can find
as it starts up.

Matthew

From jiri at krutil.com  Mon Jul  4 07:35:15 2011
From: jiri at krutil.com (Jiri Krutil)
Date: Mon, 04 Jul 2011 08:35:15 +0200
Subject: [rabbitmq-discuss] Reordering on requeue
In-Reply-To: <4E10C8F3.1060908@rabbitmq.com>
References: <1309706371.26787.8.camel@holba> <4E10C8F3.1060908@rabbitmq.com>
Message-ID: <1309761315.30111.20.camel@holba>

> > Will a requeued message be pushed back onto the queue tail or will it
> > stay at the head?
> 
> It will go to the tail. We are considering changing that behaviour for 
> channel/connection closure and basic.recover{requeue=true}, but 
> basic.reject/nack will likely stay as they are.

I asked because I was wondering if there is a way in rabbit how to
emulate read-only queue browsing, as supported by Qpid. (I think they
support it because they are so JMS-like.)

I guess currently this can only be done in rabbit using the management
plugin? And should not be used for regular processing, but only for
ad-hoc monitoring?

I understand queue browsing is not in AMQP standard, but a Qpid
extension, correct?

What about the message ordering on reject - I assume the specs does not
say where should a requeued message appear on the queue?

Cheers
Jiri


From simon at rabbitmq.com  Mon Jul  4 11:30:44 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 04 Jul 2011 11:30:44 +0100
Subject: [rabbitmq-discuss] Broken link for rfc4627_jsonrpc plugins page
In-Reply-To: <CAL_e=0oh+b9ry4SmUgWoN1sZMfRcYnkuYTDufg4gji1YsvO0jg@mail.gmail.com>
References: <CAL_e=0oh+b9ry4SmUgWoN1sZMfRcYnkuYTDufg4gji1YsvO0jg@mail.gmail.com>
Message-ID: <4E119654.3090301@rabbitmq.com>

On 03/07/11 00:10, Gavin M. Roy wrote:
> The link for rfc4627_jsonrpc on the plugins page is currently:
>
>    http://www.rabbitmq.com/releases/plugins/v2.5.1/rfc4627_jsonrpc-2.5.1-git00caae5.ez
>
> should be:
>
>    http://www.rabbitmq.com/releases/plugins/v2.5.1/rfc4627_jsonrpc-2.5.1-git30c8498.ez

Damn it. Thanks. Will get this fixed.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Mon Jul  4 11:38:51 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 04 Jul 2011 11:38:51 +0100
Subject: [rabbitmq-discuss] rabbitmq_jsonrpc_channel broken on 2.5.1
In-Reply-To: <CAL_e=0qnuO4ghEA6-xW0CfaZV+cn04rC3GiGLJjUGKY_LC34Og@mail.gmail.com>
References: <CAL_e=0qnuO4ghEA6-xW0CfaZV+cn04rC3GiGLJjUGKY_LC34Og@mail.gmail.com>
Message-ID: <4E11983B.8090307@rabbitmq.com>

On 03/07/11 00:50, Gavin M. Roy wrote:
> Even with downloading the proper file for
> rfc4627_jsonrpc-2.5.1-git30c8498, when I try and run RabbitMQ 2.5.1 with
> only the base requirements for rabbitmq_jsonrpc_channel I receive the
> following error and find that RabbitMQ is not listening on 55672:

There are a couple of changes in 2.5.0 that are interacting here.

One is that rabbitmq-mochiweb now allows you to run separate apps on 
separate ports, and *in the default configuration* will run management 
on 55672 and any other HTTP plugins, including JSON-RPC, on 55670. Look 
at http://www.rabbitmq.com/mochiweb.html for instructions on how to 
change this (although our guess is that most people using JSON-RPC and 
mgmt would rather have them on separate ports).

This was mentioned in the release notes, but I guess not very prominently.

The next release will include a list of all the open HTTP ports and 
what's running on them in the management plugin, so this should be more 
discoverable.

>     Activating RabbitMQ plugins ...
>     ********************************************************************************
>     *WARNING* Undefined function webmachine:new_request/2
>     *WARNING* Undefined function webmachine_decision_core:handle_request/2
>     *WARNING* Undefined function webmachine_dispatcher:dispatch/2
>     *WARNING* Undefined function webmachine_error_handler:render_error/3
>     *WARNING* Undefined function webmachine_resource:new/4
>     ********************************************************************************

Yeah, this is a bit unfortunate. rabbitmq-mochiweb now contains some 
utility functions for webmachine. They're not used if you don't have a 
webmachine-using plugin installed, but the xref check still complains. I 
suppose we could have rabbitmq-webmachine, but we already have too many 
dependency plugins :(

Cheers, Simon
-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Mon Jul  4 11:41:02 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 04 Jul 2011 11:41:02 +0100
Subject: [rabbitmq-discuss] Reordering on requeue
In-Reply-To: <1309761315.30111.20.camel@holba>
References: <1309706371.26787.8.camel@holba> <4E10C8F3.1060908@rabbitmq.com>
	<1309761315.30111.20.camel@holba>
Message-ID: <4E1198BE.8050307@rabbitmq.com>

Hi Jiri,

On 04/07/11 07:35, Jiri Krutil wrote:
>>> Will a requeued message be pushed back onto the queue tail or will it
>>> stay at the head?
>>
>> It will go to the tail. We are considering changing that behaviour for 
>> channel/connection closure and basic.recover{requeue=true}, but 
>> basic.reject/nack will likely stay as they are.
> 
> I asked because I was wondering if there is a way in rabbit how to
> emulate read-only queue browsing, as supported by Qpid. (I think they
> support it because they are so JMS-like.)

If you are attempting to scan all the messages in a queue without
removing them then this is not currently possible. The closest
alternative is to fetch and recover messages with the requeue flag
turned on, but this is not guaranteed to preserve message order. We are
currently working on preserving message order of queues with a single
consumer issuing basic.recover{requeue=true}.

> I guess currently this can only be done in rabbit using the management
> plugin? And should not be used for regular processing, but only for
> ad-hoc monitoring?

The management plugin does not have privileged access to queue messages.
Viewing a message with the requeue option has the same effect as using
basic.get and basic.recover with any client library that supports those
operations.

> I understand queue browsing is not in AMQP standard, but a Qpid
> extension, correct?

javax.jms.QueueBrowser appears in JMS, so you should see an
implementations of that interface in many providers.

> What about the message ordering on reject - I assume the specs does not
> say where should a requeued message appear on the queue?

Messages that are returned to the queue due to
basic.recover{requeue=true} as well as basis.reject go to the tail of
the queue.


-Emile

From gsim at redhat.com  Mon Jul  4 13:43:20 2011
From: gsim at redhat.com (Gordon Sim)
Date: Mon, 04 Jul 2011 13:43:20 +0100
Subject: [rabbitmq-discuss] Reordering on requeue
In-Reply-To: <1309761315.30111.20.camel@holba>
References: <1309706371.26787.8.camel@holba> <4E10C8F3.1060908@rabbitmq.com>
	<1309761315.30111.20.camel@holba>
Message-ID: <4E11B568.8020506@redhat.com>

On 07/04/2011 07:35 AM, Jiri Krutil wrote:
> I understand queue browsing is not in AMQP standard, but a Qpid
> extension, correct?

It is a standard feature of the AMQP 0-10 specification.

From maxence.cordier at gmail.com  Mon Jul  4 13:53:40 2011
From: maxence.cordier at gmail.com (Max C)
Date: Mon, 4 Jul 2011 05:53:40 -0700 (PDT)
Subject: [rabbitmq-discuss] Message management in a cluster
Message-ID: <af670dd5-cf3c-42c3-a515-196b14d4533d@m10g2000yqd.googlegroups.com>

Hello,

I have a question regarding message transmission in a cluster.

Let's assume that I have a RabbitMQ cluster made up of 3 nodes : N1,
N2, N3.
A sensor is connected to N1 and publish messages to an exchange E.
A client wanting to get the messages published by the the sensors is
connected to N3 and is subscribed to E exchange.

I would like to know how the messages are transmitted in the cluster.
I mean, is the cluster going to use only the N1-N3 link to send the
messages to the client, that is to say, the shortest path between the
two nodes ?  Or, is it going to use different paths to not overload a
specific one (N1-N2 -> N2-N3) ?


Cheers, Max.

From simon at rabbitmq.com  Mon Jul  4 14:16:54 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 04 Jul 2011 14:16:54 +0100
Subject: [rabbitmq-discuss] Message management in a cluster
In-Reply-To: <af670dd5-cf3c-42c3-a515-196b14d4533d@m10g2000yqd.googlegroups.com>
References: <af670dd5-cf3c-42c3-a515-196b14d4533d@m10g2000yqd.googlegroups.com>
Message-ID: <4E11BD46.1050202@rabbitmq.com>

On 04/07/11 13:53, Max C wrote:
> I would like to know how the messages are transmitted in the cluster.
> I mean, is the cluster going to use only the N1-N3 link to send the
> messages to the client, that is to say, the shortest path between the
> two nodes ?

Yes. In a cluster every node is connected to every other node, and 
messages are never sent "via" a third node.

There's a bit of optimisation in that if you publish on N1 and there are 
10,000 queues on N3 that would receive the message, the message is only 
sent across the network once. But that's it.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From alexandru at rabbitmq.com  Mon Jul  4 17:16:43 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Mon, 4 Jul 2011 17:16:43 +0100
Subject: [rabbitmq-discuss] precondition_failed error with amqp_client
 for erlang
In-Reply-To: <BANLkTikioatpncH7r9otPHdLJ8n60wEnJw@mail.gmail.com>
References: <BANLkTimEPWwHhza=v_6bP98a2JPuo64j9Q@mail.gmail.com>
	<20110630114821.GB18064@rabbitmq.com>
	<BANLkTi=feh3MPQxQ6vfBnwiaN1TqYsHAkg@mail.gmail.com>
	<BANLkTikioatpncH7r9otPHdLJ8n60wEnJw@mail.gmail.com>
Message-ID: <20110704161643.GF6403@dakota.eng.vmware.com>

Hi Max,

I'm trying to run through the steps you provided, but I'm having a bit
of trouble following.

Are you using a network or a direct connection? (I assume network, but
it probably doesn't matter)

By server, do you mean the actual RabbitMQ server, or you application?
(I'm guessing your long-running application)

By subscribe, do you mean calling amqp_channel:subscribe/3?  If so, do
you still need a list of the messages the channel may send its
subscriber?

Or do you mean that your application is sending messages to its
subscribers?

> 6.) The server supervisor restarts the server which creates a new listener,
> but the old listener is still hanging around trying to send the the
> registered name

What's a listener?  Is it a process that receives messages from the
erlang client because it's the endpoint of a subscription to a queue?

Can't you link listeners to the server so that when the server goes
down, it takes the listeners with it?

> So my question then is how should I kill the amqp_client?

What do you mean by amqp_client?  If it's an amqp_connection process,
you can just send it an shutdown exit.

Thanks for the information.

Cheers,
Alex

On Fri, Jul 01, 2011 at 01:51:10PM -0400, Max Warnock wrote:
> Problem found.  Thanks for your help.  The problem is a strange one and has
> to do with me not shutting my amqp_client listener down properly if my
> server dies.  Here is how it manifests:
> 
> 1.) Server starts up and starts up a amqp client connection and channel
> 2.) The server binds to that channel and starts the subscription using a
> registered name name as the process to which messages will be sent
> 3.) Messages start coming in and are ack-ing fine
> 4.) Poor error handling in farming out processes brings the server down
> 5.) The server does no close the amqp_client connection
> 6.) The server supervisor restarts the server which creates a new listener,
> but the old listener is still hanging around trying to send the the
> registered name
> 7.) The older listener sends a message to the server
> 8.) The server tries to ack to the new listener which did not send the
> message
> 9.) The new server pukes because it never sent a message with that tag
> 
> So my question then is how should I kill the amqp_client? If I send it an
> exit its supervisor will restart it.  This is what I was getting at with my
> tangential questions in the last email.  How should I shut down the
> amqp_client without shutting down all the other servers' amqp client
> listeners?
> 
> Thanks for all the help,
> -Max
> 
> On Thu, Jun 30, 2011 at 9:23 AM, Max Warnock <maxjwarnock at gmail.com> wrote:
> 
> > Thanks, that's very helpful from both the possible issues to chase and
> > sanity check perspectives.
> >
> > I'm using erlang R13B04 with a rabbitmq server installed via gentoo's
> > portage at version 2.4.1. I pulled the client library from github (tag
> > 2.3.0, commit: 844738f9b56d34104c1ea2ac5700d0898126c5b4).
> >
> > I'm going to write some debug code to store all the tags I try to ack on
> > and see if I can get this error to where it's easily reproducible. Thanks
> > for narrowing my search, it's very helpful.  I'll keep you updated. I must
> > be doing something wrong somewhere.  I have a hard time believing such a
> > widely used library could fail so hard myself.
> >
> > One thing that would be extremely helpful is if you could point me to some
> > documentation which I haven't been able to find:  I'm looking for a listing
> > of all the events/messages that are sent out by the amqp client to a
> > subscriber.  What does it send when it goes down, what other soft errors
> > will it send out, etc.  Additionally, is there a doc somewhere for best
> > practices in connecting a listener to another server/long-running process?
> >  Not having either of those there has been some struggle to know how to
> > restart the subscription/listening process if my server dies.  The
> > amqp_client tutorial has been a great help, but when it comes to error
> > handling from the listening module perspective it doesn't tell me what the
> > library is expecting me to do.  I don't want to have to do a bunch of
> > engineering because I'm square peg, round hole-ing the library.  The primary
> > issues I'm concerned with are when my server dies hard and is destined to be
> > restarted by its supervisor what should I send to the amqp client process?
> > Should I send it close messages and then start a new one? Or should I
> > reconnect to the client library.  This wouldn't be as big of an issue but I
> > need to use durable/persistent queues and if I still have a listener hanging
> > around with the same bindings on the same queue it will eat all my messages
> > and send them nowhere.
> >
> > Thanks,
> > -Max
> >
> > On Thu, Jun 30, 2011 at 7:48 AM, Matthew Sackman <matthew at rabbitmq.com>wrote:
> >
> >> Hi Max,
> >>
> >> On Wed, Jun 29, 2011 at 06:28:59PM -0400, Max Warnock wrote:
> >> > I've built a behavior in erlang to subscribe to a given topic exchange
> >> and
> >> > farm out message handling.  I'm using the rabbitmq amqp_client library
> >> for
> >> > erlang and when I put the system under heavy load I get, on occasion,
> >> the
> >> > following error:
> >>
> >> Could you let us know which version of Rabbit, Erlang and the Erlang
> >> client you're using?
> >>
> >> > =ERROR REPORT==== 29-Jun-2011::18:02:18 ===
> >> > ** Generic server <0.1117.0> terminating
> >> > ** Last message in was {'$gen_cast',
> >> >                            {method,
> >> >                                {'channel.close',406,
> >> >                                    <<"PRECONDITION_FAILED - unknown
> >> delivery
> >> > tag 856">>,
> >> >                                    60,80},
> >>
> >> That's a double-ack (probably). Sadly, the AMQP 0-9-1 spec says that
> >> acking is not idempotent, thus it's a fault to ack the same message
> >> multiple times...
> >>
> >> > The server receive loop where the ack happens looks like this:
> >> > receive
> >> > ...
> >> > {#'basic.deliver'{delivery_tag = Tag, routing_key = RoutingKey},
> >> > #amqp_msg{payload = Payload}} ->
> >> >     amqp_channel:cast(get(amqp_channel_pid), #'basic.ack'{delivery_tag =
> >> > Tag}),
> >> >     spawn_and_queue(spawn_handle_message, Module, RoutingKey, Payload),
> >> >     loop(Module);
> >> > ...
> >> > end
> >>
> >> ...hmmm, which is so simple that I can't see how it could go wrong: if
> >> you're not double acking then something else must be going on to make
> >> the broker think that it's not expecting an ack for that message, hence
> >> the error. If you're doing some sort of reject operation - either
> >> basic.nack or basic.reject on messages and you then subsequently ack one
> >> of those messages then that would also cause this error. There may be
> >> other cases as well.
> >>
> >> > The amqp_client_sup can't seem to bring back the the client either and
> >> dies
> >> > from the retry intensity being reached.  I've done a hefty amount of
> >> > googling and can't seem to find where things could be going wrong.
> >>  Before
> >> > jumping into the amqp_client code I thought I'd ask the mailing list if
> >> they
> >> > have any ideas.  The only thing I can think is that there is a race
> >> > condition within the client library.  I will be double checking my code
> >> to
> >> > be sure it isn't sending the ack twice, but given the simplicity of the
> >> ack
> >> > the only way it could is if it receives the same message (with identical
> >> > delivery tag) from the amqp_client library twice.
> >>
> >> It could be a bug in the client library, but I'd be a little surprised
> >> if we're managing to duplicate messages somehow - that would be a new
> >> level of fail for us. ;) However, the fact that the entire connection
> >> dies is alarming and almost certainly a bug: PRECONDITION_FAILED is a
> >> soft error and should only tear down the channel, not the whole
> >> connection. After that, all you should have to do is create a new
> >> channel and everything else should be ok. If that's not the case please
> >> let us know.
> >>
> >> Best wishes,
> >>
> >> Matthew
> >> _______________________________________________
> >> rabbitmq-discuss mailing list
> >> rabbitmq-discuss at lists.rabbitmq.com
> >> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >>
> >
> >

> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From Jason.Klassen at protegra.com  Mon Jul  4 18:21:27 2011
From: Jason.Klassen at protegra.com (Jason Klassen)
Date: Mon, 4 Jul 2011 17:21:27 +0000
Subject: [rabbitmq-discuss] management plugin 2.5.1 - using
 RABBITMQ_SERVER_START_ARGS to control port in batch file
In-Reply-To: <4E0C54D3.70601@rabbitmq.com>
References: <676E1597FDBED54694CBA16B69DE71C30337FE@PTGMAIL02v.protegra.com>
	<4E0C54D3.70601@rabbitmq.com>
Message-ID: <676E1597FDBED54694CBA16B69DE71C303BE10@PTGMAIL02v.protegra.com>

Hi Simon, 

That did the trick quite nicely, thank you.

I was going by the parameters listed on the "clustering: A cluster on a single machine" page,  http://www.rabbitmq.com/clustering.html.  Probably not a huge priority but it may be helpful to others if the info was updated to include your tip.

Thanks,
Jason

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Simon MacMullen
Sent: June-30-11 5:50 AM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] management plugin 2.5.1 - using RABBITMQ_SERVER_START_ARGS to control port in batch file

On 29/06/11 20:48, Jason Klassen wrote:
> How can I modify rabbitmq-server.bat to launch the management plugin 
> on a specific port that is not 55672? I want to accomplish this in the 
> batch file and not in a config file.

Hi Jason. The config for 2.5.1 is more verbose (but more flexible). I just added this to the .bat file and it worked for me:

-rabbitmq_mochiweb listeners [{mgmt,[{port,55673}]},{'*',[{port,55670}]}]

(The 55670 part is needed but unless you're running a web plugin that isn't management it won't actually open that port.)

Cheer, Simon

--
Simon MacMullen
RabbitMQ, VMware
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From m.nacos at gmail.com  Mon Jul  4 21:24:53 2011
From: m.nacos at gmail.com (Michael Nacos)
Date: Mon, 4 Jul 2011 21:24:53 +0100
Subject: [rabbitmq-discuss] Published message not queued after
 publish-ok received when connection quickly closed
In-Reply-To: <yrv4coc3gt7bt.fsf@dwragg.eng.vmware.com>
References: <BANLkTi=G-sMFmrr_-srSqmo_bSfyw8-w8Q@mail.gmail.com>
	<4DC3C2B7.701@rabbitmq.com>
	<yrv4coc3gt7bt.fsf@dwragg.eng.vmware.com>
Message-ID: <CA+JR6zMSpkSdsptApw0Mwy1f8hpz2vmxYq_0oT0RgOkcs8WL4g@mail.gmail.com>

there seems to be some support for tx_select, tx_commit, tx_rollback in the
master branch of the amqp gem, but not in the 0.7.x-stable branch, which is
what most people are using

2011/5/6 David Wragg <david at rabbitmq.com>

> Simon MacMullen <simon at rabbitmq.com> writes:
> > On 05/05/11 22:33, Elias Levy wrote:
> >> While writing some code using the Ruby AMQP gem against RabbitMQ, I've
> >> noticed that if I publish a message and quickly close the connection,
> >> even though I've received a publish-ok response from the server, the
> >> message fails to be queued by the broker.
> >
> > I'm not at all familiar with the Ruby client, but I should point out
> > that unlike many of the other AMQP methods, basic.publish does not
> > have a corresponding basic.publish-ok method; it's always
> > asynchronous. So I imagine the post-publish callback fires
> > immediately.
> >
> > In order to be able to know when the broker has taken responsibility
> > for a message you can either wrap the publish in a transaction (when
> > you see tx.commit-ok you know the server has the message) or use the
> > rather more lightweight publish confirms:
> o>
> > http://www.rabbitmq.com/blog/2011/02/10/introducing-publisher-confirms/
>
> Another way to solve the problem is to do a synchronous AMQP method
> rather than abruptly closing the connection.  If this the sync method
> completes successfully, you can be sure that your published messages
> have reached the broker (it doesn't give you all the guarantees of
> transactions, but it is much lighter weight).
>
> An easy way to do this with all versions of the AMQP gem (even 0.6.7) is
> to use the AMQP#close callback.  E.g., add something like this to your
> code:
>
>  client.close { puts "Closed ok" ; EM.stop }
>
> David
>
> --
> David Wragg
> Staff Engineer, RabbitMQ
> VMware, Inc.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110704/54f42baf/attachment.htm>

From stastny at 101ideas.cz  Mon Jul  4 21:30:41 2011
From: stastny at 101ideas.cz (=?UTF-8?B?SmFrdWIgxaDFpWFzdG7DvQ==?=)
Date: Mon, 4 Jul 2011 22:30:41 +0200
Subject: [rabbitmq-discuss] Published message not queued after
 publish-ok received when connection quickly closed
In-Reply-To: <CA+JR6zMSpkSdsptApw0Mwy1f8hpz2vmxYq_0oT0RgOkcs8WL4g@mail.gmail.com>
References: <BANLkTi=G-sMFmrr_-srSqmo_bSfyw8-w8Q@mail.gmail.com>
	<4DC3C2B7.701@rabbitmq.com> <yrv4coc3gt7bt.fsf@dwragg.eng.vmware.com>
	<CA+JR6zMSpkSdsptApw0Mwy1f8hpz2vmxYq_0oT0RgOkcs8WL4g@mail.gmail.com>
Message-ID: <CA+1R4g7ERx+36NX=9Kas1nyfY70_9ZV8SNokHEHrW+nEBFMgKA@mail.gmail.com>

AMQP 0.8 is available as RC, it's way more stable than 0.7, so I would
recommend to just use the RC.

Jakub

http://www.flickr.com/photos/jakub-stastny
http://twitter.com/botanicus



2011/7/4 Michael Nacos <m.nacos at gmail.com>

> there seems to be some support for tx_select, tx_commit, tx_rollback in the
> master branch of the amqp gem, but not in the 0.7.x-stable branch, which is
> what most people are using
>
> 2011/5/6 David Wragg <david at rabbitmq.com>
>
>> Simon MacMullen <simon at rabbitmq.com> writes:
>> > On 05/05/11 22:33, Elias Levy wrote:
>> >> While writing some code using the Ruby AMQP gem against RabbitMQ, I've
>> >> noticed that if I publish a message and quickly close the connection,
>> >> even though I've received a publish-ok response from the server, the
>> >> message fails to be queued by the broker.
>> >
>> > I'm not at all familiar with the Ruby client, but I should point out
>> > that unlike many of the other AMQP methods, basic.publish does not
>> > have a corresponding basic.publish-ok method; it's always
>> > asynchronous. So I imagine the post-publish callback fires
>> > immediately.
>> >
>> > In order to be able to know when the broker has taken responsibility
>> > for a message you can either wrap the publish in a transaction (when
>> > you see tx.commit-ok you know the server has the message) or use the
>> > rather more lightweight publish confirms:
>> o>
>> > http://www.rabbitmq.com/blog/2011/02/10/introducing-publisher-confirms/
>>
>> Another way to solve the problem is to do a synchronous AMQP method
>> rather than abruptly closing the connection.  If this the sync method
>> completes successfully, you can be sure that your published messages
>> have reached the broker (it doesn't give you all the guarantees of
>> transactions, but it is much lighter weight).
>>
>> An easy way to do this with all versions of the AMQP gem (even 0.6.7) is
>> to use the AMQP#close callback.  E.g., add something like this to your
>> code:
>>
>>  client.close { puts "Closed ok" ; EM.stop }
>>
>> David
>>
>> --
>> David Wragg
>> Staff Engineer, RabbitMQ
>> VMware, Inc.
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110704/cb31aafd/attachment.htm>

From kuleshovmail at gmail.com  Tue Jul  5 09:01:06 2011
From: kuleshovmail at gmail.com (Alexander Kuleshov)
Date: Tue, 5 Jul 2011 08:01:06 +0000
Subject: [rabbitmq-discuss] Ubuntu server and rabbitmq-erlang-client
Message-ID: <CANCZXo6JJO3zO_u-d8snfCeV5BnR8+C_yQaNfczfv4A9PD5JkQ@mail.gmail.com>

Hello,

I try to install rabbitmq-erlang-client in Ubuntu server. I downloaded
rabbitmq-public-umbrella. Make it.

I have amqp_client directory in /usr/lib/erlang/lib with ebin dir and
include dir.

But when i try compile my app i see error:

can't find include lib "amqp_client/include/amqp_client.hrl"

But i have: /usr/lib/erlang/lib/amqp_client/include/amqp_client.hrl

How can i fix it?

Thank you.

From jiri at krutil.com  Tue Jul  5 09:42:00 2011
From: jiri at krutil.com (Jiri Krutil)
Date: Tue, 05 Jul 2011 10:42:00 +0200
Subject: [rabbitmq-discuss] Channel thread safety in Java client
Message-ID: <1309855320.3929.25.camel@holba>

Hi

I'm trying to understand the limitations of using a Channel in a
multi-threaded application using the Java client. Sorry for this longish
post...

I have read http://www.rabbitmq.com/api-guide.html#channel-threads but
did not find any other, more detailed info.

I want to receive messages by subscription. I create a Channel and
invoke basicConsume() on it, passing a QueueingConsumer.

The moment I call basicConsume(), I would imagine the Channel becomes
"owned" by the client lib's connection thread, which feeds messages to
QueueingConsumer.

My app is retrieving those messages from the QueueingConsumer in the
main thread. I would like to know to which extent can I keep using the
Channel passed to basicConsume() from the main thread.

I guess I can use it to ack messages, because ack would not work on
another channel, correct? Can I also use the channel for other things,
such as sending messages, using transactions, or starting another
subscription?

JMS specs seem to be quite explicit on this. It says a session with an
active subscription is owned by the connection thread and client app
threads cannot use the session; they can only shut it down. That's why
if I want multiple subscriptiopns on one session, I must set them all up
before I call Connection.start(), which passes the session ownership to
the client library. Afterwards I can no longer use the session from my
threads except closing it.

Could you please elaborate on how exactly this works in the rabbit Java
client?

Cheers
Jiri


From taylste at gmail.com  Tue Jul  5 12:06:56 2011
From: taylste at gmail.com (Steven Taylor)
Date: Tue, 5 Jul 2011 12:06:56 +0100
Subject: [rabbitmq-discuss] Experimental RabbitMQ Topology Visualiser
In-Reply-To: <CAL_e=0qdNGA9UQ5Pc2zpv8uvD4n6QF--KeLQP51+Ahj56v31jQ@mail.gmail.com>
References: <20110701162552.GB16713@rabbitmq.com>
	<20110702173000.GA15232@rabbitmq.com>
	<CAL_e=0qdNGA9UQ5Pc2zpv8uvD4n6QF--KeLQP51+Ahj56v31jQ@mail.gmail.com>
Message-ID: <CA+zYriT-KrLJLiuPdQQuo9SnWya-gsyv3Ue4BfwGtLM3Z_Pf6g@mail.gmail.com>

Hi Matthew,

On the visualizer tab, should I be seeing something other than:


Contexts available:

   - Management: Web UI <http://localhost:55672/visualiser/mgmt>
   - Management: HTTP API <http://localhost:55672/visualiser/api>
   - Management: Command Line Tool <http://localhost:55672/visualiser/cli>

thanks,
-Steven
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110705/102a7963/attachment.htm>

From steve at rabbitmq.com  Tue Jul  5 12:06:57 2011
From: steve at rabbitmq.com (Steve Powell)
Date: Tue, 5 Jul 2011 12:06:57 +0100
Subject: [rabbitmq-discuss] Channel thread safety in Java client
In-Reply-To: <1309855320.3929.25.camel@holba>
References: <1309855320.3929.25.camel@holba>
Message-ID: <A7F601B8-1674-4AF2-BA08-4EAEBF0D4E01@rabbitmq.com>

Jiri,
The current implementation of the Java Client calls the Consumer interface on the same thread that the Channel work is done on.  This means that anything done in the Consumer callbacks is synchronised with all the other channel stuff going on, and could potentially block it.  There are notes on the api-guide pages to warn you about this.

The QueueingConsumer class basically makes sure that the Consumer callbacks do not cause any problems, putting the messages on the (dedicated) queue for any (usually the main) thread to access them.

This means that, even though there may be many consumers defined for a Channel, ownership of the Channel is not passed to the 'lib's connection thread', and you can continue to use the Channel from the main thread, or whatever thread you have allocated to run it from.  You can ack messages, and anything else you want, too.

The thing you shouldn't do is to call Channel methods (for the same channel) from more than one thread at a time.  This is because the threading model in the channel is 'challenged'.

We are currently working on the Consumer and Channel threading restrictions -- we want to run all the Consumer callbacks on a thread which is distinct from the Connection thread; and allow channels to be driven from multiple threads.  This would mean it is feasible to do most Channel operations from the Consumer callback itself, and from any other thread.

Incidentally, the way our changes are going at the moment, we will expose the execution thread pool for Consumer callbacks; and allow the user to have control over how many threads are allocated.  For example, it might be thought sensible to have a single thread per channel allocated for Consumer callbacks; but this could mean a large penalty for a large number of channels that may be doing very little work.  Instead we pass work to an Executor (managed so that all the work required by a single channel is serialised) which runs it on a thread from a pool.  The default Executor will use a (fixed) pool of 16 threads, but the interface will allow passing in any Executor implementation for the Connection.

I hope this helps.  Feedback is welcome.
Steve Powell  (a happy bunny)
----------some definitions from the SPD----------
Rigatoni n. A prime-ministerial grin.
Nigella n. The next bottle-size up from a Nebuchadnezzar.
Homily adv. Rather like a frenchman.

On 5 Jul 2011, at 09:42, Jiri Krutil wrote:

> Hi
> 
> I'm trying to understand the limitations of using a Channel in a
> multi-threaded application using the Java client. Sorry for this longish
> post...
> 
> I have read http://www.rabbitmq.com/api-guide.html#channel-threads but
> did not find any other, more detailed info.
> 
> I want to receive messages by subscription. I create a Channel and
> invoke basicConsume() on it, passing a QueueingConsumer.
> 
> The moment I call basicConsume(), I would imagine the Channel becomes
> "owned" by the client lib's connection thread, which feeds messages to
> QueueingConsumer.
> 
> My app is retrieving those messages from the QueueingConsumer in the
> main thread. I would like to know to which extent can I keep using the
> Channel passed to basicConsume() from the main thread.
> 
> I guess I can use it to ack messages, because ack would not work on
> another channel, correct? Can I also use the channel for other things,
> such as sending messages, using transactions, or starting another
> subscription?
> 
> JMS specs seem to be quite explicit on this. It says a session with an
> active subscription is owned by the connection thread and client app
> threads cannot use the session; they can only shut it down. That's why
> if I want multiple subscriptiopns on one session, I must set them all up
> before I call Connection.start(), which passes the session ownership to
> the client library. Afterwards I can no longer use the session from my
> threads except closing it.
> 
> Could you please elaborate on how exactly this works in the rabbit Java
> client?
> 
> Cheers
> Jiri
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110705/bb23716b/attachment.htm>

From matthew at rabbitmq.com  Tue Jul  5 12:16:59 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 5 Jul 2011 12:16:59 +0100
Subject: [rabbitmq-discuss] Experimental RabbitMQ Topology Visualiser
In-Reply-To: <CA+zYriT-KrLJLiuPdQQuo9SnWya-gsyv3Ue4BfwGtLM3Z_Pf6g@mail.gmail.com>
References: <20110701162552.GB16713@rabbitmq.com>
	<20110702173000.GA15232@rabbitmq.com>
	<CAL_e=0qdNGA9UQ5Pc2zpv8uvD4n6QF--KeLQP51+Ahj56v31jQ@mail.gmail.com>
	<CA+zYriT-KrLJLiuPdQQuo9SnWya-gsyv3Ue4BfwGtLM3Z_Pf6g@mail.gmail.com>
Message-ID: <20110705111658.GA30077@rabbitmq.com>

On Tue, Jul 05, 2011 at 12:06:56PM +0100, Steven Taylor wrote:
> On the visualizer tab, should I be seeing something other than:

Yes. I still don't quite understand what's going on there, but, you
should see that the link is actually to /mgmt/visualiser. If you go
there then you should reach the visualiser proper.

I hope to do another WIP release later this week in which I'll actually
get this sorted out so the link works!

Matthew

From simon at rabbitmq.com  Tue Jul  5 12:22:38 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 05 Jul 2011 12:22:38 +0100
Subject: [rabbitmq-discuss] management plugin 2.5.1 - using
 RABBITMQ_SERVER_START_ARGS to control port in batch file
In-Reply-To: <676E1597FDBED54694CBA16B69DE71C303BE10@PTGMAIL02v.protegra.com>
References: <676E1597FDBED54694CBA16B69DE71C30337FE@PTGMAIL02v.protegra.com>
	<4E0C54D3.70601@rabbitmq.com>
	<676E1597FDBED54694CBA16B69DE71C303BE10@PTGMAIL02v.protegra.com>
Message-ID: <4E12F3FE.6090905@rabbitmq.com>

On 04/07/11 18:21, Jason Klassen wrote:
> I was going by the parameters listed on the "clustering: A cluster on
> a single machine" page,  http://www.rabbitmq.com/clustering.html.

Fixed, thanks for the spot.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From taylste at gmail.com  Tue Jul  5 12:28:50 2011
From: taylste at gmail.com (Steven Taylor)
Date: Tue, 5 Jul 2011 12:28:50 +0100
Subject: [rabbitmq-discuss] Experimental RabbitMQ Topology Visualiser
In-Reply-To: <20110705111658.GA30077@rabbitmq.com>
References: <20110701162552.GB16713@rabbitmq.com>
	<20110702173000.GA15232@rabbitmq.com>
	<CAL_e=0qdNGA9UQ5Pc2zpv8uvD4n6QF--KeLQP51+Ahj56v31jQ@mail.gmail.com>
	<CA+zYriT-KrLJLiuPdQQuo9SnWya-gsyv3Ue4BfwGtLM3Z_Pf6g@mail.gmail.com>
	<20110705111658.GA30077@rabbitmq.com>
Message-ID: <CA+zYriT83L+p+irOXL8ThOdWg4_d+EVnVgGm5aehsAW6R8h-9g@mail.gmail.com>

http://localhost:55672/mgmt/visualiser/ works.  Thanks.  Looks promissing.

On IE9, MS are aiming at implementing maturing HTML5 features, whereas
Chrome is aiming at more leading/experimental HTML5 features.  Maybe that's
part of the issue for you.

-Steven


On 5 July 2011 12:16, Matthew Sackman <matthew at rabbitmq.com> wrote:

> On Tue, Jul 05, 2011 at 12:06:56PM +0100, Steven Taylor wrote:
> > On the visualizer tab, should I be seeing something other than:
>
> Yes. I still don't quite understand what's going on there, but, you
> should see that the link is actually to /mgmt/visualiser. If you go
> there then you should reach the visualiser proper.
>
> I hope to do another WIP release later this week in which I'll actually
> get this sorted out so the link works!
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110705/4dcb5d49/attachment.htm>

From matthew at rabbitmq.com  Tue Jul  5 12:38:56 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 5 Jul 2011 12:38:56 +0100
Subject: [rabbitmq-discuss] Experimental RabbitMQ Topology Visualiser
In-Reply-To: <CA+zYriT83L+p+irOXL8ThOdWg4_d+EVnVgGm5aehsAW6R8h-9g@mail.gmail.com>
References: <20110701162552.GB16713@rabbitmq.com>
	<20110702173000.GA15232@rabbitmq.com>
	<CAL_e=0qdNGA9UQ5Pc2zpv8uvD4n6QF--KeLQP51+Ahj56v31jQ@mail.gmail.com>
	<CA+zYriT-KrLJLiuPdQQuo9SnWya-gsyv3Ue4BfwGtLM3Z_Pf6g@mail.gmail.com>
	<20110705111658.GA30077@rabbitmq.com>
	<CA+zYriT83L+p+irOXL8ThOdWg4_d+EVnVgGm5aehsAW6R8h-9g@mail.gmail.com>
Message-ID: <20110705113855.GB30077@rabbitmq.com>

On Tue, Jul 05, 2011 at 12:28:50PM +0100, Steven Taylor wrote:
> http://localhost:55672/mgmt/visualiser/ works.  Thanks.  Looks promissing.
> 
> On IE9, MS are aiming at implementing maturing HTML5 features, whereas
> Chrome is aiming at more leading/experimental HTML5 features.  Maybe that's
> part of the issue for you.

Could well be. That said, I would expect IE9 to give me some errors. It
doesn't. Also, CPU usage and the fact that it often manages to render
the first frame suggests that it is continuing to work. The fact that I
get the same behaviour in IE9, Safari and Opera definitely suggests I'm
doing something wrong. I just wish I knew what!

Matthew

From jiri at krutil.com  Tue Jul  5 13:24:08 2011
From: jiri at krutil.com (Jiri Krutil)
Date: Tue, 05 Jul 2011 14:24:08 +0200
Subject: [rabbitmq-discuss] Channel thread safety in Java client
In-Reply-To: <A7F601B8-1674-4AF2-BA08-4EAEBF0D4E01@rabbitmq.com>
References: <1309855320.3929.25.camel@holba>
	<A7F601B8-1674-4AF2-BA08-4EAEBF0D4E01@rabbitmq.com>
Message-ID: <1309868648.7709.12.camel@holba>

Steve,

thanks for that detailed explanation, it definitely helps.

The concept of customizable thread pool and executor you describe sounds
nice. I guess it will be easier and more natural to program against such
API.

The reason I'm interested in how this works is that I'm trying to put
together a vendor-neutral AMQP C++ API with support for async
consumption and I find a lot of inspiration for that in the Java client.

My initial goal is to find a feature set and semantics that can be
mapped to RabbitMQ and Qpid. The API should expose features common for
0-9-1 and 0-10 specs; I'm kind of ignoring AMQP 1.0 for now.

I already have a draft implementation of this API for Qpid 0.7 C++
client. Still not sure if rabbitmq-c has everything I need...

Cheers
Jiri


> Jiri,
> The current implementation of the Java Client calls the Consumer
> interface on the same thread that the Channel work is done on.  This
> means that anything done in the Consumer callbacks is synchronised
> with all the other channel stuff going on, and could potentially block
> it.  There are notes on the api-guide pages to warn you about this.
> 
> 
> The QueueingConsumer class basically makes sure that the Consumer
> callbacks do not cause any problems, putting the messages on the
> (dedicated) queue for any (usually the main) thread to access them.
> 
> 
> This means that, even though there may be many consumers defined for a
> Channel, ownership of the Channel is not passed to the 'lib's
> connection thread', and you can continue to use the Channel from the
> main thread, or whatever thread you have allocated to run it from.
>  You can ack messages, and anything else you want, too.
> 
> 
> The thing you shouldn't do is to call Channel methods (for the same
> channel) from more than one thread at a time.  This is because the
> threading model in the channel is 'challenged'.
> 
> 
> We are currently working on the Consumer and Channel threading
> restrictions -- we want to run all the Consumer callbacks on a thread
> which is distinct from the Connection thread; and allow channels to be
> driven from multiple threads.  This would mean it is feasible to do
> most Channel operations from the Consumer callback itself, and from
> any other thread.
> 
> 
> Incidentally, the way our changes are going at the moment, we will
> expose the execution thread pool for Consumer callbacks; and allow the
> user to have control over how many threads are allocated.  For
> example, it might be thought sensible to have a single thread per
> channel allocated for Consumer callbacks; but this could mean a large
> penalty for a large number of channels that may be doing very little
> work.  Instead we pass work to an Executor (managed so that all the
> work required by a single channel is serialised) which runs it on a
> thread from a pool.  The default Executor will use a (fixed) pool of
> 16 threads, but the interface will allow passing in any Executor
> implementation for the Connection.
> 
> 
> I hope this helps.  Feedback is welcome.
> Steve Powell  (a happy bunny)



From narkisr at gmail.com  Tue Jul  5 13:33:02 2011
From: narkisr at gmail.com (Ronen)
Date: Tue, 5 Jul 2011 05:33:02 -0700 (PDT)
Subject: [rabbitmq-discuss] /var/lib/rabbitmq/pids
Message-ID: <553d261d-bcac-4aac-bdfe-b3332a63612a@x41g2000yqd.googlegroups.com>

Hey fellow rabbitmq users, Im setting up a rabbitmq server on Redhat
using version 2.5.0,

Id like to monitor the rabbitmq process using monit which requires a
pid file, looking trough web posts they mention the  /var/lib/rabbitmq/
pids as the source for the pid file however this folder doesn't
exits.

Any idea how to provide a pid file for monit without the pids folder?

Thanks
Ronen

From joseph.a.marlin at gmail.com  Tue Jul  5 13:42:08 2011
From: joseph.a.marlin at gmail.com (Joseph Marlin)
Date: Tue, 5 Jul 2011 05:42:08 -0700 (PDT)
Subject: [rabbitmq-discuss] Experimental RabbitMQ Topology Visualiser
In-Reply-To: <20110705113855.GB30077@rabbitmq.com>
Message-ID: <17979245.92.1309869728368.JavaMail.geo-discussion-forums@vbqb20>

Speaking of CPU usage, I'm getting a *lot* of it when I have the tab with 
this visualizer visible in Chrome on Ubuntu: http://i.imgur.com/uhU2m.png

Is that normal? The dip in the beginning was when I switched to a different 
tab for a few seconds.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110705/89db24b1/attachment.htm>

From david at rabbitmq.com  Tue Jul  5 13:44:06 2011
From: david at rabbitmq.com (David Wragg)
Date: Tue, 05 Jul 2011 13:44:06 +0100
Subject: [rabbitmq-discuss] /var/lib/rabbitmq/pids
In-Reply-To: <553d261d-bcac-4aac-bdfe-b3332a63612a@x41g2000yqd.googlegroups.com>
	(Ronen's message of "Tue, 5 Jul 2011 05:33:02 -0700 (PDT)")
References: <553d261d-bcac-4aac-bdfe-b3332a63612a@x41g2000yqd.googlegroups.com>
Message-ID: <yrv4cmxgs3njd.fsf@dwragg.eng.vmware.com>

Ronen <narkisr at gmail.com> writes:
> Hey fellow rabbitmq users, Im setting up a rabbitmq server on Redhat
> using version 2.5.0,
>
> Id like to monitor the rabbitmq process using monit which requires a
> pid file, looking trough web posts they mention the  /var/lib/rabbitmq/
> pids as the source for the pid file however this folder doesn't
> exits.
>
> Any idea how to provide a pid file for monit without the pids folder?

Do something like:

    setsid sh -c 'echo $$ >$PIDFILE ; exec rabbitmq-server </dev/null >$RABBITMQ_LOG_BASE/rabbitmq_startup_log 2>&1' &
    rabbitmqctl wait >/dev/null 2>&1

David

-- 
David Wragg
Staff Engineer, RabbitMQ
VMware, Inc.

From joseph.a.marlin at gmail.com  Tue Jul  5 13:44:48 2011
From: joseph.a.marlin at gmail.com (Joseph Marlin)
Date: Tue, 5 Jul 2011 05:44:48 -0700 (PDT)
Subject: [rabbitmq-discuss] Ubuntu server and rabbitmq-erlang-client
In-Reply-To: <CANCZXo6JJO3zO_u-d8snfCeV5BnR8+C_yQaNfczfv4A9PD5JkQ@mail.gmail.com>
Message-ID: <31242176.44.1309869888563.JavaMail.geo-discussion-forums@vbiv41>

I think you can download the amqp_client plugin here, 
http://www.rabbitmq.com/plugins.html#rabbitmq-management, although I'm not 
sure that is quite what you are looking for.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110705/8d62b858/attachment.htm>

From matthew at rabbitmq.com  Tue Jul  5 13:44:55 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 5 Jul 2011 13:44:55 +0100
Subject: [rabbitmq-discuss] /var/lib/rabbitmq/pids
In-Reply-To: <553d261d-bcac-4aac-bdfe-b3332a63612a@x41g2000yqd.googlegroups.com>
References: <553d261d-bcac-4aac-bdfe-b3332a63612a@x41g2000yqd.googlegroups.com>
Message-ID: <20110705124454.GD30077@rabbitmq.com>

On Tue, Jul 05, 2011 at 05:33:02AM -0700, Ronen wrote:
> Any idea how to provide a pid file for monit without the pids folder?

$ rabbitmqctl status
Status of node rabbit at hazel ...
[{pid,30451},
 ...]

Yes, that will require some parsing to safely get that out (the order of
items in that list could potentially change), but a regex of
/{pid,\s*(\d+)/ (or some such) should be sufficient.

Matthew

From matthew at rabbitmq.com  Tue Jul  5 13:49:05 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 5 Jul 2011 13:49:05 +0100
Subject: [rabbitmq-discuss] Experimental RabbitMQ Topology Visualiser
In-Reply-To: <17979245.92.1309869728368.JavaMail.geo-discussion-forums@vbqb20>
References: <20110705113855.GB30077@rabbitmq.com>
	<17979245.92.1309869728368.JavaMail.geo-discussion-forums@vbqb20>
Message-ID: <20110705124905.GE30077@rabbitmq.com>

On Tue, Jul 05, 2011 at 05:42:08AM -0700, Joseph Marlin wrote:
> Speaking of CPU usage, I'm getting a *lot* of it when I have the tab with 
> this visualizer visible in Chrome on Ubuntu: http://i.imgur.com/uhU2m.png

Yup. n-body simulations are CPU intensive, especially when you're
crippled by a language like javascript. That said, firstly, since the
release at the end of last week, I've done further optimisations such as
frustum culling, and secondly, profiling in chrome (it's built-in
profiler is very very good!) shows that actually the CPU cost is not in
the physics, but in the canvas drawing operations - the general state of
canvas implementations seems to be fairly unoptimised, especially when
it comes to things like drawing text. This could be because most of the
shiny shiny demos don't spent a lot of time drawing text or doing much
other than moving balls attractively around a screen ;)

> Is that normal? The dip in the beginning was when I switched to a different 
> tab for a few seconds.

Alas so. I'm doing what I can to minimise this, but it's been fairly
well demonstrated that implementing something in flash still leads to
better performance than an HTML canvas on modern browsers - they still
have some way to go yet to close the performance gap.

Matthew

From Massimo.Paladin at cern.ch  Tue Jul  5 14:01:30 2011
From: Massimo.Paladin at cern.ch (Massimo Paladin)
Date: Tue, 5 Jul 2011 15:01:30 +0200
Subject: [rabbitmq-discuss] rabbitmq_auth_mechanism_ssl limitations
Message-ID: <CAMOXM29jANOoR9t6v82E-ftoj3Y6xNbyShPMFsF8VNXgrWrx0w@mail.gmail.com>

Hello,

looking at rabbitmq_auth_mechanism_ssl I can see that the CN is used as
username.

- What happens if the certificate has more than one CN?

- In an environment where there could be more than one CA there could be two
different certificates with the same CN!

This looks like limiting to certificates with only one and unique CN. Am I
wrong?

Cheers,
---
Massimo Paladin

email: massimo.paladin at gmail.com
website: http://www.mpaladin.com
flickr's page: http://flickr.com/photos/massimop
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110705/2586416d/attachment.htm>

From simon at rabbitmq.com  Tue Jul  5 14:18:18 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 05 Jul 2011 14:18:18 +0100
Subject: [rabbitmq-discuss] rabbitmq_auth_mechanism_ssl limitations
In-Reply-To: <CAMOXM29jANOoR9t6v82E-ftoj3Y6xNbyShPMFsF8VNXgrWrx0w@mail.gmail.com>
References: <CAMOXM29jANOoR9t6v82E-ftoj3Y6xNbyShPMFsF8VNXgrWrx0w@mail.gmail.com>
Message-ID: <4E130F1A.8050505@rabbitmq.com>

On 05/07/11 14:01, Massimo Paladin wrote:
> This looks like limiting to certificates with only one and unique CN. Am
> I wrong?

Yes, that's correct.

A future enhancement could be to allow rabbitmq_auth_mechanism_ssl to 
use the DN instead - after all, that's really what it's for.

However, the (substantial) speedbump here is that RabbitMQ requires each 
user to have a user name, and each user name to be a string (I really 
wouldn't want to change that, implications would be far-reaching). But a 
DN isn't a string, it's an ASN.1 mess. And while there are a bunch of 
ways to convert that to a string, there's no good *canonical* way of 
doing it that I'm aware of.

But I'm not a great expert in x509 / ASN.1. I don't know if you are or 
not :) but what would you do?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From narkisr at gmail.com  Tue Jul  5 14:22:53 2011
From: narkisr at gmail.com (Ronen)
Date: Tue, 5 Jul 2011 06:22:53 -0700 (PDT)
Subject: [rabbitmq-discuss] /var/lib/rabbitmq/pids
In-Reply-To: <20110705124454.GD30077@rabbitmq.com>
References: <553d261d-bcac-4aac-bdfe-b3332a63612a@x41g2000yqd.googlegroups.com>
	<20110705124454.GD30077@rabbitmq.com>
Message-ID: <a32d8d33-586b-46cf-a142-8c954eb82ece@o13g2000yqj.googlegroups.com>

David did you mean to use:

"setsid sh -c 'echo $$ >$PIDFILE ; exec rabbitmq-server </dev/null >
$RABBITMQ_LOG_BASE/rabbitmq_startup_log 2>&1' &
    rabbitmqctl wait >/dev/null 2>&1"

As the monit command entry or to use it within the init file itself?

Matthew, I did see the pid entry under the status, I was hopping to
skip the need of parsing it but I guess ill have to try it also

Thanks
Ronen

On Jul 5, 3:44?pm, Matthew Sackman <matt... at rabbitmq.com> wrote:
> On Tue, Jul 05, 2011 at 05:33:02AM -0700, Ronen wrote:
> > Any idea how to provide a pid file for monit without the pids folder?
>
> $ rabbitmqctl status
> Status of node rabbit at hazel ...
> [{pid,30451},
> ?...]
>
> Yes, that will require some parsing to safely get that out (the order of
> items in that list could potentially change), but a regex of
> /{pid,\s*(\d+)/ (or some such) should be sufficient.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthew at rabbitmq.com  Tue Jul  5 14:28:20 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 5 Jul 2011 14:28:20 +0100
Subject: [rabbitmq-discuss] /var/lib/rabbitmq/pids
In-Reply-To: <a32d8d33-586b-46cf-a142-8c954eb82ece@o13g2000yqj.googlegroups.com>
References: <553d261d-bcac-4aac-bdfe-b3332a63612a@x41g2000yqd.googlegroups.com>
	<20110705124454.GD30077@rabbitmq.com>
	<a32d8d33-586b-46cf-a142-8c954eb82ece@o13g2000yqj.googlegroups.com>
Message-ID: <20110705132819.GG30077@rabbitmq.com>

On Tue, Jul 05, 2011 at 06:22:53AM -0700, Ronen wrote:
> Matthew, I did see the pid entry under the status, I was hopping to
> skip the need of parsing it but I guess ill have to try it also

I think either approach would work ok, though both have drawbacks.

Editing the init file is a drawback from a maintanence pov, though the
solution there is more robust.

Using rabbitmqctl means you'll have a potential race - you'll think
you've started rabbit, but it can be a while before rabbitmqctl status
thinks rabbit's managed to start up. You could use rabbitmqctl wait in
this case, but that adds further complexity, and is buggy anyway!

Matthew

From arno.puschmann at acodeas.de  Tue Jul  5 14:35:35 2011
From: arno.puschmann at acodeas.de (Arno Puschmann)
Date: Tue, 5 Jul 2011 15:35:35 +0200
Subject: [rabbitmq-discuss] reading time extending on persistent messages
In-Reply-To: <4E0DED8D.8020200@rabbitmq.com>
References: <27D6B27DB616654BBEF4DDB8B31EAF916B590E951E@vs-msx01.IT-NG.local>, 
	<20110630125847.GD18064@rabbitmq.com>
	<27D6B27DB616654BBEF4DDB8B31EAF916B590E9520@vs-msx01.IT-NG.local>,
	<4E0DED8D.8020200@rabbitmq.com>
Message-ID: <27D6B27DB616654BBEF4DDB8B31EAF916B590E9523@vs-msx01.IT-NG.local>

For everybody who is interested in this issue.

I re-installed the following packages from the version 1:13.b.3-dfsg-2ubuntu2.1 to version 1:13.b.1-dfsg-2ubuntu1.1

erlang-base
erlang-crypto
erlang-inets
erlang-mnesia
erlang-os-mon
erlang-public-key
erlang-runtime-tools
erlang-snmp
erlang-ssl
erlang-syntax-tools
erlang-xmerl
erlang-nox (version 1:13.b.1-dfsg-2ubuntu1)

Getting the packages from here http://de.archive.ubuntu.com/ubuntu/pool/main/e/erlang/

After this it worked for me fine on Ubuntu 10.04 (using RabbitMQ 2.4.1). I don't know exactly on which package it depends. After this the RabbitMQ Web-Console said that the Erlang Version R13B01 is installed. Maybe it works also with the new packages with the version 1:13.b.3-dfsg-2ubuntu3 or 1:14.b.2-dfsg-3ubuntu2. However Ubuntu 10.04 comes with a version which doesn't worked for me for persistent messages.

Thanks for your responds.

-----Original Message-----
Von: Matthias Radestock [matthias at rabbitmq.com]
Gesendet: Freitag, 1. Juli 2011 17:53
An: Arno Puschmann
Cc: rabbitmq-discuss at lists.rabbitmq.com
Betreff: Re: [rabbitmq-discuss] reading time extending on persistent messages

Arno,

On 01/07/11 15:54, Arno Puschmann wrote:
> Then I tried the same thing on a other system with Ubuntu 9.10 on a
> Single Core 2,3GHZ and only 512MB RAM and RabbitMQ 2.5.1. With this
> system I get almost the same results as you.
>
> So what's the different between these machines? The only thing I have
> found was that on my first machine with a slow reading I have the new
> erlang version of all erlang packages 1:13.b.3-dfsg-2ubuntu2.1 and on
> my fast reading machine I have the old erlang package version
> 1:13.b.1-dfsg-2ubuntu1.1.
>
> Could this be the problem?

That's certainly a possibility. To rule out any other differences, could
you upgrade Erlang to R13B3 on the second machine, or downgrade Erlang
to R13B1 on the first?

Regards,

Matthias.

From wsmith at tacc.utexas.edu  Tue Jul  5 14:40:32 2011
From: wsmith at tacc.utexas.edu (Warren Smith)
Date: Tue, 5 Jul 2011 08:40:32 -0500
Subject: [rabbitmq-discuss] rabbitmq_auth_mechanism_ssl limitations
In-Reply-To: <4E130F1A.8050505@rabbitmq.com>
References: <CAMOXM29jANOoR9t6v82E-ftoj3Y6xNbyShPMFsF8VNXgrWrx0w@mail.gmail.com>
	<4E130F1A.8050505@rabbitmq.com>
Message-ID: <083D5377F8EC294D884D590409EFE70D71E79CCBCD@MAIL02.austin.utexas.edu>


I actually ended up tweaking the rabbitmq_auth_mechanism_ssl to do exactly this. In my situation, there are 100s of users of our overall infrastructure and they get their certificates from multiple certificate authorities, so it is quite possible for 2 different users to have the same CN.

All I ended up doing to the DN is removing the quotes and calling the result the RabbitMQ username. I can handle escaping the spaces in the DN, but Erlang seems to put quotes in different places than openssl and that would have made it difficult to automate things.

This has been working fine so far, but I'm still in the prototype stage so I only have a handful of users added. The usernames are quite long, but I don't think this will be a big deal for me since I can script a lot of the user management.


Warren


-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Simon MacMullen
Sent: Tuesday, July 05, 2011 8:18 AM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] rabbitmq_auth_mechanism_ssl limitations

On 05/07/11 14:01, Massimo Paladin wrote:
> This looks like limiting to certificates with only one and unique CN. Am
> I wrong?

Yes, that's correct.

A future enhancement could be to allow rabbitmq_auth_mechanism_ssl to 
use the DN instead - after all, that's really what it's for.

However, the (substantial) speedbump here is that RabbitMQ requires each 
user to have a user name, and each user name to be a string (I really 
wouldn't want to change that, implications would be far-reaching). But a 
DN isn't a string, it's an ASN.1 mess. And while there are a bunch of 
ways to convert that to a string, there's no good *canonical* way of 
doing it that I'm aware of.

But I'm not a great expert in x509 / ASN.1. I don't know if you are or 
not :) but what would you do?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From david at rabbitmq.com  Tue Jul  5 14:46:42 2011
From: david at rabbitmq.com (David Wragg)
Date: Tue, 05 Jul 2011 14:46:42 +0100
Subject: [rabbitmq-discuss] /var/lib/rabbitmq/pids
In-Reply-To: <a32d8d33-586b-46cf-a142-8c954eb82ece@o13g2000yqj.googlegroups.com>
	(Ronen's message of "Tue, 5 Jul 2011 06:22:53 -0700 (PDT)")
References: <553d261d-bcac-4aac-bdfe-b3332a63612a@x41g2000yqd.googlegroups.com>
	<20110705124454.GD30077@rabbitmq.com>
	<a32d8d33-586b-46cf-a142-8c954eb82ece@o13g2000yqj.googlegroups.com>
Message-ID: <yrv4cfwmk3kn1.fsf@dwragg.eng.vmware.com>

Ronen <narkisr at gmail.com> writes:
> David did you mean to use:
>
> "setsid sh -c 'echo $$ >$PIDFILE ; exec rabbitmq-server </dev/null >
> $RABBITMQ_LOG_BASE/rabbitmq_startup_log 2>&1' &
>     rabbitmqctl wait >/dev/null 2>&1"
>
> As the monit command entry or to use it within the init file itself?

You'll need to incorporate that into a script that monit runs.  It
should be easy to incorporate into the rabbitmq-server init script,
which already contains commands very like those.

-- 
David Wragg
Staff Engineer, RabbitMQ
VMware, Inc.

From Massimo.Paladin at cern.ch  Tue Jul  5 15:05:01 2011
From: Massimo.Paladin at cern.ch (Massimo Paladin)
Date: Tue, 5 Jul 2011 16:05:01 +0200
Subject: [rabbitmq-discuss] rabbitmq_auth_mechanism_ssl limitations
In-Reply-To: <4E130F1A.8050505@rabbitmq.com>
References: <CAMOXM29jANOoR9t6v82E-ftoj3Y6xNbyShPMFsF8VNXgrWrx0w@mail.gmail.com>
	<4E130F1A.8050505@rabbitmq.com>
Message-ID: <CAMOXM28Mg5h0Ysr0fzK_s-z+RzrzAJBL25E8VoZQXx7KLp2wnA@mail.gmail.com>

Looking at openssl there is an rfc which tells how to convert from asn.1 to
string: http://www.ietf.org/rfc/rfc2253.txt

Cheers,
---
Massimo Paladin

email: massimo.paladin at gmail.com
website: http://www.mpaladin.com
flickr's page: http://flickr.com/photos/massimop


On Tue, Jul 5, 2011 at 3:18 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 05/07/11 14:01, Massimo Paladin wrote:
>
>> This looks like limiting to certificates with only one and unique CN. Am
>> I wrong?
>>
>
> Yes, that's correct.
>
> A future enhancement could be to allow rabbitmq_auth_mechanism_ssl to use
> the DN instead - after all, that's really what it's for.
>
> However, the (substantial) speedbump here is that RabbitMQ requires each
> user to have a user name, and each user name to be a string (I really
> wouldn't want to change that, implications would be far-reaching). But a DN
> isn't a string, it's an ASN.1 mess. And while there are a bunch of ways to
> convert that to a string, there's no good *canonical* way of doing it that
> I'm aware of.
>
> But I'm not a great expert in x509 / ASN.1. I don't know if you are or not
> :) but what would you do?
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110705/52da6000/attachment.htm>

From matthias at rabbitmq.com  Tue Jul  5 15:21:07 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 05 Jul 2011 15:21:07 +0100
Subject: [rabbitmq-discuss] rabbitmq_auth_mechanism_ssl limitations
In-Reply-To: <CAMOXM28Mg5h0Ysr0fzK_s-z+RzrzAJBL25E8VoZQXx7KLp2wnA@mail.gmail.com>
References: <CAMOXM29jANOoR9t6v82E-ftoj3Y6xNbyShPMFsF8VNXgrWrx0w@mail.gmail.com>	<4E130F1A.8050505@rabbitmq.com>
	<CAMOXM28Mg5h0Ysr0fzK_s-z+RzrzAJBL25E8VoZQXx7KLp2wnA@mail.gmail.com>
Message-ID: <4E131DD3.40909@rabbitmq.com>

Massimo,

On 05/07/11 15:05, Massimo Paladin wrote:
> Looking at openssl there is an rfc which tells how to convert from asn.1
> to string: http://www.ietf.org/rfc/rfc2253.txt

It wouldn't be ASN.1 if there wasn't a more recent version of any given 
spec, in this case http://www.ietf.org/rfc/rfc4514.txt

Anyway, the conversion specified therein is not isomorphic w.r.t. 
equivalence, i.e. two DNs which are considered equal (there are bunch of 
RFCs which define what that means) are not necessarily represented by 
the same string.


Matthias.

From narkisr at gmail.com  Tue Jul  5 15:51:40 2011
From: narkisr at gmail.com (Ronen)
Date: Tue, 5 Jul 2011 07:51:40 -0700 (PDT)
Subject: [rabbitmq-discuss] /var/lib/rabbitmq/pids
In-Reply-To: <yrv4cfwmk3kn1.fsf@dwragg.eng.vmware.com>
References: <553d261d-bcac-4aac-bdfe-b3332a63612a@x41g2000yqd.googlegroups.com>
	<20110705124454.GD30077@rabbitmq.com>
	<a32d8d33-586b-46cf-a142-8c954eb82ece@o13g2000yqj.googlegroups.com>
	<yrv4cfwmk3kn1.fsf@dwragg.eng.vmware.com>
Message-ID: <36a00f2b-d50f-4c66-be8a-25e4cb1d86c4@r18g2000vbs.googlegroups.com>

Ok this is how iv solved this, iv patched the rabbitmq-server init
file and added the following:

The following are added to the start function:

  pid=`/usr/sbin/rabbitmqctl status | perl -n -e'/{pid,(\d+)/ && print
$1'`
  echo $pid > /var/run/rabbitmq.pid

Right before:

  echo SUCCESS

The pid file is deleted within the stop function:

         rm /var/run/rabbitmq.pid

right after,

         if [ $RETVAL = 0 ] ; then

Thanks David and Matthew
Ronen


On Jul 5, 4:46?pm, David Wragg <da... at rabbitmq.com> wrote:
> Ronen <nark... at gmail.com> writes:
> > David did you mean to use:
>
> > "setsid sh -c 'echo $$ >$PIDFILE ; exec rabbitmq-server </dev/null >
> > $RABBITMQ_LOG_BASE/rabbitmq_startup_log 2>&1' &
> > ? ? rabbitmqctl wait >/dev/null 2>&1"
>
> > As the monit command entry or to use it within the init file itself?
>
> You'll need to incorporate that into a script that monit runs. ?It
> should be easy to incorporate into the rabbitmq-server init script,
> which already contains commands very like those.
>
> --
> David Wragg
> Staff Engineer, RabbitMQ
> VMware, Inc.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From maxjwarnock at gmail.com  Tue Jul  5 16:28:46 2011
From: maxjwarnock at gmail.com (Max Warnock)
Date: Tue, 5 Jul 2011 11:28:46 -0400
Subject: [rabbitmq-discuss] precondition_failed error with amqp_client
	for erlang
In-Reply-To: <20110704161643.GF6403@dakota.eng.vmware.com>
References: <BANLkTimEPWwHhza=v_6bP98a2JPuo64j9Q@mail.gmail.com>
	<20110630114821.GB18064@rabbitmq.com>
	<BANLkTi=feh3MPQxQ6vfBnwiaN1TqYsHAkg@mail.gmail.com>
	<BANLkTikioatpncH7r9otPHdLJ8n60wEnJw@mail.gmail.com>
	<20110704161643.GF6403@dakota.eng.vmware.com>
Message-ID: <CAApCF45mYRGXzz1BcpTxd0cLC7EQrZ+pMui+=5Giq6QZxfzVaw@mail.gmail.com>

Sorry about the ambiguity,

For the sake of clarity here is the glossary of terms I used in my last
email (which probably clashes with the erlang/amqp_client context you're
coming from):

Server - I'm referring to my long running process in erlang that I have
given a registered name and passed as the 3rd argument to
amqp_client:subscribe/3.
Listener - the process created by the amqp_client library when a connection
and channel are opened
Subscribe - calling of amqp_client:subscribe/3
My - I'm using this pronoun to distinguish code written by me from code
written by you cats at rabbitmq (client library, rabbitmq server, etc)

I've attached a diagram (approximation/abstraction) of how I'm interacting
with the amqp_client library. (sorry to the mailing list if attaching a 40K
diagram breaks etiquette).

I'm using the amqp_client library in network mode, i.e.,
amqp_client:start(network, #amqp_params{host = Host, heartbeat=60000})

Yes a list of messages that the amqp_client process sends to a subscriber,
particularly pertaining to errors in amqp_client land, would be very
helpful.  I'd like to be able to handle all {'DOWN',Etc} messages with my
long running process (server).  I'm hoping to handle all hard errors so that
a restart from either supervisor (my long running process or the
amqp_client's) won't break the communication between the two.

But I get the impression that I'm missing something about how I'm supposed
to treat the amqp_client library with regard to amqp_client:start/2.  Should
I be treating the amqp_client connection like mnesia (an application
entirely independent of mine), add it to my existing supervision tree and
share one connection throughout my application, or, what I'm currently
doing, let each part of my application that needs to talk to amqp spin up
and close their own connection/channel?

Thanks,
-Max

On Mon, Jul 4, 2011 at 12:16 PM, Alexandru Scvor?ov
<alexandru at rabbitmq.com>wrote:

> Hi Max,
>
> I'm trying to run through the steps you provided, but I'm having a bit
> of trouble following.
>
> Are you using a network or a direct connection? (I assume network, but
> it probably doesn't matter)
>
> By server, do you mean the actual RabbitMQ server, or you application?
> (I'm guessing your long-running application)
>
> By subscribe, do you mean calling amqp_channel:subscribe/3?  If so, do
> you still need a list of the messages the channel may send its
> subscriber?
>
> Or do you mean that your application is sending messages to its
> subscribers?
>
> > 6.) The server supervisor restarts the server which creates a new
> listener,
> > but the old listener is still hanging around trying to send the the
> > registered name
>
> What's a listener?  Is it a process that receives messages from the
> erlang client because it's the endpoint of a subscription to a queue?
>
> Can't you link listeners to the server so that when the server goes
> down, it takes the listeners with it?
>
> > So my question then is how should I kill the amqp_client?
>
> What do you mean by amqp_client?  If it's an amqp_connection process,
> you can just send it an shutdown exit.
>
> Thanks for the information.
>
> Cheers,
> Alex
>
> On Fri, Jul 01, 2011 at 01:51:10PM -0400, Max Warnock wrote:
> > Problem found.  Thanks for your help.  The problem is a strange one and
> has
> > to do with me not shutting my amqp_client listener down properly if my
> > server dies.  Here is how it manifests:
> >
> > 1.) Server starts up and starts up a amqp client connection and channel
> > 2.) The server binds to that channel and starts the subscription using a
> > registered name name as the process to which messages will be sent
> > 3.) Messages start coming in and are ack-ing fine
> > 4.) Poor error handling in farming out processes brings the server down
> > 5.) The server does no close the amqp_client connection
> > 6.) The server supervisor restarts the server which creates a new
> listener,
> > but the old listener is still hanging around trying to send the the
> > registered name
> > 7.) The older listener sends a message to the server
> > 8.) The server tries to ack to the new listener which did not send the
> > message
> > 9.) The new server pukes because it never sent a message with that tag
> >
> > So my question then is how should I kill the amqp_client? If I send it an
> > exit its supervisor will restart it.  This is what I was getting at with
> my
> > tangential questions in the last email.  How should I shut down the
> > amqp_client without shutting down all the other servers' amqp client
> > listeners?
> >
> > Thanks for all the help,
> > -Max
> >
> > On Thu, Jun 30, 2011 at 9:23 AM, Max Warnock <maxjwarnock at gmail.com>
> wrote:
> >
> > > Thanks, that's very helpful from both the possible issues to chase and
> > > sanity check perspectives.
> > >
> > > I'm using erlang R13B04 with a rabbitmq server installed via gentoo's
> > > portage at version 2.4.1. I pulled the client library from github (tag
> > > 2.3.0, commit: 844738f9b56d34104c1ea2ac5700d0898126c5b4).
> > >
> > > I'm going to write some debug code to store all the tags I try to ack
> on
> > > and see if I can get this error to where it's easily reproducible.
> Thanks
> > > for narrowing my search, it's very helpful.  I'll keep you updated. I
> must
> > > be doing something wrong somewhere.  I have a hard time believing such
> a
> > > widely used library could fail so hard myself.
> > >
> > > One thing that would be extremely helpful is if you could point me to
> some
> > > documentation which I haven't been able to find:  I'm looking for a
> listing
> > > of all the events/messages that are sent out by the amqp client to a
> > > subscriber.  What does it send when it goes down, what other soft
> errors
> > > will it send out, etc.  Additionally, is there a doc somewhere for best
> > > practices in connecting a listener to another server/long-running
> process?
> > >  Not having either of those there has been some struggle to know how to
> > > restart the subscription/listening process if my server dies.  The
> > > amqp_client tutorial has been a great help, but when it comes to error
> > > handling from the listening module perspective it doesn't tell me what
> the
> > > library is expecting me to do.  I don't want to have to do a bunch of
> > > engineering because I'm square peg, round hole-ing the library.  The
> primary
> > > issues I'm concerned with are when my server dies hard and is destined
> to be
> > > restarted by its supervisor what should I send to the amqp client
> process?
> > > Should I send it close messages and then start a new one? Or should I
> > > reconnect to the client library.  This wouldn't be as big of an issue
> but I
> > > need to use durable/persistent queues and if I still have a listener
> hanging
> > > around with the same bindings on the same queue it will eat all my
> messages
> > > and send them nowhere.
> > >
> > > Thanks,
> > > -Max
> > >
> > > On Thu, Jun 30, 2011 at 7:48 AM, Matthew Sackman <matthew at rabbitmq.com
> >wrote:
> > >
> > >> Hi Max,
> > >>
> > >> On Wed, Jun 29, 2011 at 06:28:59PM -0400, Max Warnock wrote:
> > >> > I've built a behavior in erlang to subscribe to a given topic
> exchange
> > >> and
> > >> > farm out message handling.  I'm using the rabbitmq amqp_client
> library
> > >> for
> > >> > erlang and when I put the system under heavy load I get, on
> occasion,
> > >> the
> > >> > following error:
> > >>
> > >> Could you let us know which version of Rabbit, Erlang and the Erlang
> > >> client you're using?
> > >>
> > >> > =ERROR REPORT==== 29-Jun-2011::18:02:18 ===
> > >> > ** Generic server <0.1117.0> terminating
> > >> > ** Last message in was {'$gen_cast',
> > >> >                            {method,
> > >> >                                {'channel.close',406,
> > >> >                                    <<"PRECONDITION_FAILED - unknown
> > >> delivery
> > >> > tag 856">>,
> > >> >                                    60,80},
> > >>
> > >> That's a double-ack (probably). Sadly, the AMQP 0-9-1 spec says that
> > >> acking is not idempotent, thus it's a fault to ack the same message
> > >> multiple times...
> > >>
> > >> > The server receive loop where the ack happens looks like this:
> > >> > receive
> > >> > ...
> > >> > {#'basic.deliver'{delivery_tag = Tag, routing_key = RoutingKey},
> > >> > #amqp_msg{payload = Payload}} ->
> > >> >     amqp_channel:cast(get(amqp_channel_pid),
> #'basic.ack'{delivery_tag =
> > >> > Tag}),
> > >> >     spawn_and_queue(spawn_handle_message, Module, RoutingKey,
> Payload),
> > >> >     loop(Module);
> > >> > ...
> > >> > end
> > >>
> > >> ...hmmm, which is so simple that I can't see how it could go wrong: if
> > >> you're not double acking then something else must be going on to make
> > >> the broker think that it's not expecting an ack for that message,
> hence
> > >> the error. If you're doing some sort of reject operation - either
> > >> basic.nack or basic.reject on messages and you then subsequently ack
> one
> > >> of those messages then that would also cause this error. There may be
> > >> other cases as well.
> > >>
> > >> > The amqp_client_sup can't seem to bring back the the client either
> and
> > >> dies
> > >> > from the retry intensity being reached.  I've done a hefty amount of
> > >> > googling and can't seem to find where things could be going wrong.
> > >>  Before
> > >> > jumping into the amqp_client code I thought I'd ask the mailing list
> if
> > >> they
> > >> > have any ideas.  The only thing I can think is that there is a race
> > >> > condition within the client library.  I will be double checking my
> code
> > >> to
> > >> > be sure it isn't sending the ack twice, but given the simplicity of
> the
> > >> ack
> > >> > the only way it could is if it receives the same message (with
> identical
> > >> > delivery tag) from the amqp_client library twice.
> > >>
> > >> It could be a bug in the client library, but I'd be a little surprised
> > >> if we're managing to duplicate messages somehow - that would be a new
> > >> level of fail for us. ;) However, the fact that the entire connection
> > >> dies is alarming and almost certainly a bug: PRECONDITION_FAILED is a
> > >> soft error and should only tear down the channel, not the whole
> > >> connection. After that, all you should have to do is create a new
> > >> channel and everything else should be ok. If that's not the case
> please
> > >> let us know.
> > >>
> > >> Best wishes,
> > >>
> > >> Matthew
> > >> _______________________________________________
> > >> rabbitmq-discuss mailing list
> > >> rabbitmq-discuss at lists.rabbitmq.com
> > >> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > >>
> > >
> > >
>
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110705/2da3e2ee/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: gen_amqp_subscriberinteractionwithamqp_client.png
Type: image/png
Size: 40314 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110705/2da3e2ee/attachment.png>

From iksanhariji at gmail.com  Tue Jul  5 15:58:08 2011
From: iksanhariji at gmail.com (Iksan Hariji)
Date: Tue, 5 Jul 2011 07:58:08 -0700 (PDT)
Subject: [rabbitmq-discuss] Dear all
Message-ID: <3d8765f3-38f9-407f-96a7-0c57cbeaadde@j14g2000prn.googlegroups.com>

can you help
i have install rabbitmq-server on ubuntu lucid lynks  and  i have a
error report after that, the error report like this

Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/
startup_log, _err
rabbitmq-server.
invoke-rc.d: initscript rabbitmq-server, action "start" failed.
dpkg: error processing rabbitmq-server (--configure):
 subprocess installed post-installation script returned error exit
status 1
Errors were encountered while processing:
 rabbitmq-server
E: Sub-process /usr/bin/dpkg returned an error code (1)



please help me

rgrds.

iksan h

From blp330 at msn.com  Tue Jul  5 17:13:45 2011
From: blp330 at msn.com (blp330)
Date: Tue, 5 Jul 2011 09:13:45 -0700 (PDT)
Subject: [rabbitmq-discuss]  How can I use RabbitMQ with monit
Message-ID: <31998195.post@talk.nabble.com>


Hi,

I tried to follow this instruction:
http://blog.joeygeiger.com/2009/02/25/rabbitmq-and-monit/

but rabbitmq-multi is unavailable for my rabbitmq version 2.5.1.

I try to use rabbitmq-server, but no any pid file created, so I do have any
idea to do it with monit.

So, how can I use RabbitMQ with monit?

or no one did this because this is unnecessary?

Thanks.
-- 
View this message in context: http://old.nabble.com/How-can-I-use-RabbitMQ-with-monit-tp31998195p31998195.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From blp330 at msn.com  Tue Jul  5 17:14:20 2011
From: blp330 at msn.com (blp330)
Date: Tue, 5 Jul 2011 09:14:20 -0700 (PDT)
Subject: [rabbitmq-discuss]  How can I use RabbitMQ with monit
Message-ID: <31998195.post@talk.nabble.com>


Hi,

I tried to follow this instruction:
http://blog.joeygeiger.com/2009/02/25/rabbitmq-and-monit/

but rabbitmq-multi is unavailable for my rabbitmq version 2.5.1.

I try to use rabbitmq-server, but no any pid file created, so I do not have
any idea to do it with monit.

So, how can I use RabbitMQ with monit?

or no one did this because this is unnecessary?

Thanks.
-- 
View this message in context: http://old.nabble.com/How-can-I-use-RabbitMQ-with-monit-tp31998195p31998195.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From emile at rabbitmq.com  Tue Jul  5 18:01:20 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 05 Jul 2011 18:01:20 +0100
Subject: [rabbitmq-discuss] Dear all
In-Reply-To: <3d8765f3-38f9-407f-96a7-0c57cbeaadde@j14g2000prn.googlegroups.com>
References: <3d8765f3-38f9-407f-96a7-0c57cbeaadde@j14g2000prn.googlegroups.com>
Message-ID: <4E134360.90206@rabbitmq.com>

Hi Iksan,

On 05/07/11 15:58, Iksan Hariji wrote:
> can you help
> i have install rabbitmq-server on ubuntu lucid lynks  and  i have a
> error report after that, the error report like this
> 
> Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/
> startup_log, _err

Was there any useful information in /var/log/rabbitmq, as suggested by
the error message?


-Emile

From narkisr at gmail.com  Tue Jul  5 18:01:25 2011
From: narkisr at gmail.com (Ronen)
Date: Tue, 5 Jul 2011 10:01:25 -0700 (PDT)
Subject: [rabbitmq-discuss] How can I use RabbitMQ with monit
In-Reply-To: <31998195.post@talk.nabble.com>
References: <31998195.post@talk.nabble.com>
Message-ID: <cdc827b8-1268-47a0-9189-399c73576ac8@m18g2000vbl.googlegroups.com>

Im not sure what rabbitmq-multi is but this is how iv solved it for
rabbitmq-server:

http://groups.google.com/group/rabbitmq-discuss/browse_thread/thread/b6bd0f50e962e43

Ronen

On Jul 5, 7:13?pm, blp330 <blp... at msn.com> wrote:
> Hi,
>
> I tried to follow this instruction:http://blog.joeygeiger.com/2009/02/25/rabbitmq-and-monit/
>
> but rabbitmq-multi is unavailable for my rabbitmq version 2.5.1.
>
> I try to use rabbitmq-server, but no any pid file created, so I do not have
> any idea to do it with monit.
>
> So, how can I use RabbitMQ with monit?
>
> or no one did this because this is unnecessary?
>
> Thanks.
> --
> View this message in context:http://old.nabble.com/How-can-I-use-RabbitMQ-with-monit-tp31998195p31...
> Sent from the RabbitMQ mailing list archive at Nabble.com.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From lgreg.meredith at gmail.com  Tue Jul  5 18:10:38 2011
From: lgreg.meredith at gmail.com (Meredith Gregory)
Date: Tue, 5 Jul 2011 10:10:38 -0700
Subject: [rabbitmq-discuss] Distributed queue setup
Message-ID: <CAG7cANQYaq5ODOrPjvJ=AtWLrXngwxN6k1kKwhug5_oOJLisMg@mail.gmail.com>

Dear Rabbitters,

We've got a situation -- it must be quite common -- where, in the simplest
case, we have two application nodes, call them A and B. RabbitMQ server is
running on the machines for both A and B. The B node has established it's
connection to exchange and queue, but does not know whether A has. In the
case that A has, all is well in the world. When B sends a message to A over
RabbitMQ, A happily processes it and returns a response message. However, if
A has not established it's connection to exchange and queue, then if B has
sent a message to A on this exchange and queue, then when A establishes it's
connection -- not only does it not see the pending message, the next message
B sends causes a Java exception to be thrown (see below). Now, we can
arrange a bit of a handshake to work around this, and have done so. However,
we'd like to know if there's a better or Rabbitier way of doing this.

Best wishes,

--greg

com.rabbitmq.client.AlreadyClosedException: clean connection shutdown;
reason: Attempt to use closed channelscala>
        at com.rabbitmq.client.impl.AMQChannel.ensureIsOpen(AMQChannel.java:181)
        at com.rabbitmq.client.impl.AMQChannel.transmit(AMQChannel.java:276)
        at com.rabbitmq.client.impl.ChannelN.basicPublish(ChannelN.java:521)
        at com.rabbitmq.client.impl.ChannelN.basicPublish(ChannelN.java:507)
        at net.liftweb.amqp.AMQPSender.send(AMQPSender.scala:25)
        at net.liftweb.amqp.AMQPSender$$anonfun$loop$1.apply(AMQPSender.scala:32)
        at net.liftweb.amqp.AMQPSender$$anonfun$loop$1.apply(AMQPSender.scala:31)
        at scala.actors.ReactorTask.run(ReactorTask.scala:31)
        at scala.actors.Reactor$class.resumeReceiver(Reactor.scala:129)
        at net.liftweb.amqp.AMQPSender.scala$actors$ReplyReactor$$super$resumeReceiver(AMQPSender.scala:15)
        at scala.actors.ReplyReactor$class.resumeReceiver(ReplyReactor.scala:68)
        at net.liftweb.amqp.AMQPSender.resumeReceiver(AMQPSender.scala:15)
        at scala.actors.Actor$class.searchMailbox(Actor.scala:500)
        at net.liftweb.amqp.AMQPSender.searchMailbox(AMQPSender.scala:15)
        at scala.actors.Reactor$$anonfun$startSearch$1$$anonfun$apply$mcV$sp$1.apply$mcV$sp(Reactor.scala:117)
        at scala.actors.Reactor$$anonfun$startSearch$1$$anonfun$apply$mcV$sp$1.apply(Reactor.scala:114)
        at scala.actors.Reactor$$anonfun$startSearch$1$$anonfun$apply$mcV$sp$1.apply(Reactor.scala:114)
        at scala.actors.ReactorTask.run(ReactorTask.scala:33)
        at scala.concurrent.forkjoin.ForkJoinPool$AdaptedRunnable.exec(ForkJoinPool.java:611)
        at scala.concurrent.forkjoin.ForkJoinTask.quietlyExec(ForkJoinTask.java:422)
        at scala.concurrent.forkjoin.ForkJoinWorkerThread.mainLoop(ForkJoinWorkerThread.java:340)
        at scala.concurrent.forkjoin.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:325)



-- 
L.G. Meredith
Managing Partner
Biosimilarity LLC
7329 39th Ave SW
Seattle, WA 98136

+1 206.650.3740

http://biosimilarity.blogspot.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110705/3c753451/attachment.htm>

From thomas.kant at gmail.com  Tue Jul  5 19:05:39 2011
From: thomas.kant at gmail.com (scorpiovn)
Date: Tue, 5 Jul 2011 11:05:39 -0700 (PDT)
Subject: [rabbitmq-discuss] How can I use RabbitMQ with Eureka Streams
Message-ID: <c8b16489-103b-422e-965d-1a9a1cc8db72@e17g2000prj.googlegroups.com>

I want to use RabbitMQ with Eureka Streams.
Could you help me this problem?

thanks
+++
thomas.kant

From mikeb at rabbitmq.com  Tue Jul  5 20:14:25 2011
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Tue, 05 Jul 2011 20:14:25 +0100
Subject: [rabbitmq-discuss] How can I use RabbitMQ with Eureka Streams
In-Reply-To: <c8b16489-103b-422e-965d-1a9a1cc8db72@e17g2000prj.googlegroups.com>
References: <c8b16489-103b-422e-965d-1a9a1cc8db72@e17g2000prj.googlegroups.com>
Message-ID: <4E136291.5090002@rabbitmq.com>

On 05/07/2011 19:05, scorpiovn wrote:
> I want to use RabbitMQ with Eureka Streams.
> Could you help me this problem?

Do you mean you want to replace a piece of Eureka Streams with RabbitMQ 
-- I presume the ActiveMQ piece?  In order to do that, you would have to 
(at the least) replace the ActiveMQ JMS client with the RabbitMQ Java 
AMQP client.  These are not radically different APIs but not a straight 
swap either.

If you don't mean that, what do you mean, more specifically?

Regards,
Michael

From rckclmbr at gmail.com  Tue Jul  5 21:50:23 2011
From: rckclmbr at gmail.com (Joshua Braegger)
Date: Tue, 5 Jul 2011 14:50:23 -0600
Subject: [rabbitmq-discuss] Using BlockingConnection in Pika
In-Reply-To: <624fb51a-56ed-4e31-af58-408e24fffccf@q14g2000prh.googlegroups.com>
References: <624fb51a-56ed-4e31-af58-408e24fffccf@q14g2000prh.googlegroups.com>
Message-ID: <CAEDqXPH46iC9vareHV75pyxnDUkk6=G9QMfhZQtzPujpZg67mw@mail.gmail.com>

Howdy,

I'm looking at the Pika documentation, and it's mentioning that using
BlockingConnection is deprecated.  The alternative is to use an
asynchronous model like SelectConnection.  This works fairly well for
consumers, but producing one-off messages leaves more to be desired.
BlockingConnection satisfies the case fairly well -- Create a global
connection, send many messages, close the connection.  It gets hairy
when attempting to work asynchronously within a synchronous
application.  Especially given the fact I want to use the "mandatory"
flag, and know when any message fails to be enqueued in a synchronous
manner.

Are there any best practices to doing this?  Is the answer to just use
BlockingConnection?

Thanks,
-Josh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110705/4597f65f/attachment.htm>

From jasonjwwilliams at gmail.com  Tue Jul  5 21:52:39 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Tue, 5 Jul 2011 14:52:39 -0600
Subject: [rabbitmq-discuss] Using BlockingConnection in Pika
In-Reply-To: <CAEDqXPH46iC9vareHV75pyxnDUkk6=G9QMfhZQtzPujpZg67mw@mail.gmail.com>
References: <624fb51a-56ed-4e31-af58-408e24fffccf@q14g2000prh.googlegroups.com>
	<CAEDqXPH46iC9vareHV75pyxnDUkk6=G9QMfhZQtzPujpZg67mw@mail.gmail.com>
Message-ID: <CAHZAEpfkvzUq44wcy-Q0F9FM9gAXVr09HueZ1HiqH_9Sb64nAA@mail.gmail.com>

Hi Josh,

I think BlockingConnection has found new life in the latest Pikas. At least
Gavin has put a lot of effort in for those of us that have requested it for
teaching etc.

https://github.com/rabbitinaction/sourcecode/blob/master/python/chapter-2/hello_world_producer.py

-J

On Tue, Jul 5, 2011 at 2:50 PM, Joshua Braegger <rckclmbr at gmail.com> wrote:

> Howdy,
>
> I'm looking at the Pika documentation, and it's mentioning that using
> BlockingConnection is deprecated.  The alternative is to use an
> asynchronous model like SelectConnection.  This works fairly well for
> consumers, but producing one-off messages leaves more to be desired.
> BlockingConnection satisfies the case fairly well -- Create a global
> connection, send many messages, close the connection.  It gets hairy
> when attempting to work asynchronously within a synchronous
> application.  Especially given the fact I want to use the "mandatory"
> flag, and know when any message fails to be enqueued in a synchronous
> manner.
>
> Are there any best practices to doing this?  Is the answer to just use
> BlockingConnection?
>
> Thanks,
> -Josh
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110705/f5749556/attachment.htm>

From rckclmbr at gmail.com  Tue Jul  5 22:04:53 2011
From: rckclmbr at gmail.com (Joshua Braegger)
Date: Tue, 5 Jul 2011 15:04:53 -0600
Subject: [rabbitmq-discuss] Using BlockingConnection in Pika
In-Reply-To: <CAHZAEpfkvzUq44wcy-Q0F9FM9gAXVr09HueZ1HiqH_9Sb64nAA@mail.gmail.com>
References: <624fb51a-56ed-4e31-af58-408e24fffccf@q14g2000prh.googlegroups.com>
	<CAEDqXPH46iC9vareHV75pyxnDUkk6=G9QMfhZQtzPujpZg67mw@mail.gmail.com>
	<CAHZAEpfkvzUq44wcy-Q0F9FM9gAXVr09HueZ1HiqH_9Sb64nAA@mail.gmail.com>
Message-ID: <CAEDqXPGDDNfLXfL4OL7RUeM63PCFwt4KLCuOM1hOvV=zPv4_qw@mail.gmail.com>

Thanks, Jason.

I bring this up because of this comment --
http://tonyg.github.com/pika/connecting.html#adapters-blocking-connection-blockingconnection

"*Warning* BlockingConnection is provided for legacy and learning purposes
only and it is not recommended that you use it for a production
application."

The latest git documentation also still has this warning (
https://github.com/pika/pika/blob/master/pika/adapters/base_connection.py)

"adapters.blocking_connection.BlockingConnection: Enables blocking,

  synchronous operation on top of library for simple uses. This is not
  recommended and is included for legacy reasons only."


So my question is, why isn't this recommended for production use?

-Josh


On Tue, Jul 5, 2011 at 2:52 PM, Jason J. W. Williams <
jasonjwwilliams at gmail.com> wrote:

> Hi Josh,
>
> I think BlockingConnection has found new life in the latest Pikas. At least
> Gavin has put a lot of effort in for those of us that have requested it for
> teaching etc.
>
>
> https://github.com/rabbitinaction/sourcecode/blob/master/python/chapter-2/hello_world_producer.py
>
> -J
>
> On Tue, Jul 5, 2011 at 2:50 PM, Joshua Braegger <rckclmbr at gmail.com>wrote:
>
>> Howdy,
>>
>> I'm looking at the Pika documentation, and it's mentioning that using
>> BlockingConnection is deprecated.  The alternative is to use an
>> asynchronous model like SelectConnection.  This works fairly well for
>> consumers, but producing one-off messages leaves more to be desired.
>> BlockingConnection satisfies the case fairly well -- Create a global
>> connection, send many messages, close the connection.  It gets hairy
>> when attempting to work asynchronously within a synchronous
>> application.  Especially given the fact I want to use the "mandatory"
>> flag, and know when any message fails to be enqueued in a synchronous
>> manner.
>>
>> Are there any best practices to doing this?  Is the answer to just use
>> BlockingConnection?
>>
>> Thanks,
>> -Josh
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110705/3bafc34b/attachment.htm>

From habtdemis at gmail.com  Tue Jul  5 22:15:23 2011
From: habtdemis at gmail.com (Demiss Zike)
Date: Tue, 5 Jul 2011 16:15:23 -0500
Subject: [rabbitmq-discuss] Messaging and Serialization in RabbitMQ?
Message-ID: <CAJE2eFGmpqj7Jd3wqsV=-nvf6oZ6H2UyKXH0zTzcuQwCBzuzvA@mail.gmail.com>

Hello,

I'm using c#. I have a serializable class called Measurement and want to
send an object of it. I serialized an object of Measurement and captured the
serialized object as byte[] and published it. My question is how can I
capture the published message (so that I can deserialize and use it)?

I've included codes on both ends:

public void publish(byte[] _serializedMsg)
{
// publisher code
    ConnectionFactory factory = new ConnectionFactory();
            factory.HostName = "localhost";
            using (IConnection connection = factory.CreateConnection())
            using (IModel channel = connection.CreateModel()) {
            channel.ExchangeDeclare("logs", "fanout");
            channel.BasicPublish("logs", queue, null, _serializedMsg);
            Console.WriteLine(" Message sent ");
        }
}



public void subscribe(string queue)
{
// subscriber code
ConnectionFactory factory = new ConnectionFactory();
            factory.HostName = "localhost";
            using (IConnection connection = factory.CreateConnection())
            using (IModel channel = connection.CreateModel()) {
            channel.ExchangeDeclare("logs", "fanout");

    string queue1 = channel.QueueDeclare();
            channel.QueueBind(queue1, "logs", "");
            QueueingBasicConsumer consumer = new
QueueingBasicConsumer(channel);
            channel.BasicConsume(queue1, true, consumer);

            Console.WriteLine(" Waiting for messages. To exit press
CTRL+C");
            while(true) {
                BasicDeliverEventArgs ea =
                    (BasicDeliverEventArgs)consumer.Queue.Dequeue();
                byte[] body = ea.Body;
 Measurement m2 = new Measurement(20, 23323, 3.3);
m2 = BinarySerialization.BinaryDeSerialize( body );

                Console.WriteLine(" Message received: ");
Console.WriteLine("\nMeasurement ID: {0}", m2.id);
Console.WriteLine("Measurement Time: {0}", m2.time);
Console.WriteLine("Measurement Value: {0}", m2.value);
            }
        }
}


Thanks!
Demi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110705/8a5220dc/attachment.htm>

From simone.busoli at gmail.com  Tue Jul  5 22:18:09 2011
From: simone.busoli at gmail.com (Simone Busoli)
Date: Tue, 5 Jul 2011 23:18:09 +0200
Subject: [rabbitmq-discuss] Messaging and Serialization in RabbitMQ?
In-Reply-To: <CAJE2eFGmpqj7Jd3wqsV=-nvf6oZ6H2UyKXH0zTzcuQwCBzuzvA@mail.gmail.com>
References: <CAJE2eFGmpqj7Jd3wqsV=-nvf6oZ6H2UyKXH0zTzcuQwCBzuzvA@mail.gmail.com>
Message-ID: <CAOn7oW-ZGD+eyvRZBPBtMS2nOpUEVFCtWC5+-x=perqFM8iuDA@mail.gmail.com>

Doesn't m2 in your code below contain the deserialized message?

On Tue, Jul 5, 2011 at 23:15, Demiss Zike <habtdemis at gmail.com> wrote:

> Hello,
>
> I'm using c#. I have a serializable class called Measurement and want to
> send an object of it. I serialized an object of Measurement and captured the
> serialized object as byte[] and published it. My question is how can I
> capture the published message (so that I can deserialize and use it)?
>
> I've included codes on both ends:
>
> public void publish(byte[] _serializedMsg)
> {
> // publisher code
>      ConnectionFactory factory = new ConnectionFactory();
>             factory.HostName = "localhost";
>              using (IConnection connection = factory.CreateConnection())
>             using (IModel channel = connection.CreateModel()) {
>             channel.ExchangeDeclare("logs", "fanout");
>             channel.BasicPublish("logs", queue, null, _serializedMsg);
>             Console.WriteLine(" Message sent ");
>         }
> }
>
>
>
> public void subscribe(string queue)
> {
>  // subscriber code
> ConnectionFactory factory = new ConnectionFactory();
>             factory.HostName = "localhost";
>             using (IConnection connection = factory.CreateConnection())
>             using (IModel channel = connection.CreateModel()) {
>             channel.ExchangeDeclare("logs", "fanout");
>
>     string queue1 = channel.QueueDeclare();
>             channel.QueueBind(queue1, "logs", "");
>             QueueingBasicConsumer consumer = new
> QueueingBasicConsumer(channel);
>             channel.BasicConsume(queue1, true, consumer);
>
>             Console.WriteLine(" Waiting for messages. To exit press
> CTRL+C");
>             while(true) {
>                 BasicDeliverEventArgs ea =
>                     (BasicDeliverEventArgs)consumer.Queue.Dequeue();
>                  byte[] body = ea.Body;
>  Measurement m2 = new Measurement(20, 23323, 3.3);
>  m2 = BinarySerialization.BinaryDeSerialize( body );
>
>                 Console.WriteLine(" Message received: ");
>  Console.WriteLine("\nMeasurement ID: {0}", m2.id);
> Console.WriteLine("Measurement Time: {0}", m2.time);
>  Console.WriteLine("Measurement Value: {0}", m2.value);
>             }
>         }
> }
>
>
> Thanks!
> Demi
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110705/88034333/attachment.htm>

From gmr at myyearbook.com  Tue Jul  5 22:19:20 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Tue, 5 Jul 2011 17:19:20 -0400
Subject: [rabbitmq-discuss] Using BlockingConnection in Pika
In-Reply-To: <CAEDqXPGDDNfLXfL4OL7RUeM63PCFwt4KLCuOM1hOvV=zPv4_qw@mail.gmail.com>
References: <624fb51a-56ed-4e31-af58-408e24fffccf@q14g2000prh.googlegroups.com>
	<CAEDqXPH46iC9vareHV75pyxnDUkk6=G9QMfhZQtzPujpZg67mw@mail.gmail.com>
	<CAHZAEpfkvzUq44wcy-Q0F9FM9gAXVr09HueZ1HiqH_9Sb64nAA@mail.gmail.com>
	<CAEDqXPGDDNfLXfL4OL7RUeM63PCFwt4KLCuOM1hOvV=zPv4_qw@mail.gmail.com>
Message-ID: <CAL_e=0pJupDOMnikLWEb4cDO64oVVpmsDRMSHpxBgJLcuBUANQ@mail.gmail.com>

On Tue, Jul 5, 2011 at 5:04 PM, Joshua Braegger <rckclmbr at gmail.com> wrote:
> Thanks, Jason.
> I bring this up because of this comment
> --?http://tonyg.github.com/pika/connecting.html#adapters-blocking-connection-blockingconnection
> "Warning BlockingConnection is provided for legacy and learning purposes
> only and it is not recommended that you use it for a production
> application."
> The latest git documentation also still has this warning
> (https://github.com/pika/pika/blob/master/pika/adapters/base_connection.py)
> "adapters.blocking_connection.BlockingConnection: Enables blocking,
>
>   synchronous operation on top of library for simple uses. This is not
>   recommended and is included for legacy reasons only."
>
> So my question is, why isn't this recommended for production use?

In essence, you can but the main issue is it's a synchronous "hack" on
top of an asynchronous stack using an asynchronous protocol. I am
working on a revamped method of handling the blocking but it's taking
a bit longer than I'd like.

The best way to think of the BlockingConnection adapter is as a layer
on top of the existing client that implements blocking behaviors.
Every other adapter plugs into the driver.

At the time I wrote that it was deprecated, I wasn't planning on
keeping it long term. My impression of it and how to handle it has
changed over time. Here's where I was in March:
http://gavinroy.com/the-future-of-pika.

I'd say you're fine using it if it works for you. I find that it's
good for publishing a lot of messages quickly. If you're going to use
it as a consumer, you're better off just doing the minimal work of
using the asynchronous methods because you'll be working with the
asynchronous callback in the blocking connection anyway. I'll be
supporting bug fixes in the 0.9 tree but my focus on Pika and heart is
in a cleaner implementation.

From matthias at rabbitmq.com  Tue Jul  5 22:26:04 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 05 Jul 2011 22:26:04 +0100
Subject: [rabbitmq-discuss] RabbitMQ crash in production - help diagnose
 from log
In-Reply-To: <4E0F0B67.3020408@rabbitmq.com>
References: <BANLkTi=qQ-wYE5LYRk-0oV1vhiCyTR_40g@mail.gmail.com>
	<4E0F0B67.3020408@rabbitmq.com>
Message-ID: <4E13816C.7040905@rabbitmq.com>

Bryan,

On 02/07/11 13:13, Matthias Radestock wrote:
> It looks like the crash might be triggered by a rare race
> condition. [...] Nothing obvious jumps out at me from the
> code, so this may take a while to track down.

As feared, a few hours of poking the code hasn't thrown up any dirt.

Do you still have the rabbit.log file from around the time of the crash? 
If so, please send it to us.

Also, it would be useful to get some more details on how you are using 
rabbit...

How many queues are there? How much queue churn is there (i.e. queues 
being created and deleted)?

Do published messages only ever get routed to a single queue or can they 
get routed to multiple queues?

How big are the messages?

How long (#messages) are the queues, and how does that figure change 
over time?


Regards,

Matthias.

From simone.busoli at gmail.com  Tue Jul  5 22:51:24 2011
From: simone.busoli at gmail.com (Simone Busoli)
Date: Tue, 5 Jul 2011 23:51:24 +0200
Subject: [rabbitmq-discuss] Messaging and Serialization in RabbitMQ?
In-Reply-To: <CAJE2eFFD3QiVU0r0QxNaqbkOV4yVzGF_ojZSW4KE7cewFYpGhw@mail.gmail.com>
References: <CAJE2eFGmpqj7Jd3wqsV=-nvf6oZ6H2UyKXH0zTzcuQwCBzuzvA@mail.gmail.com>
	<CAOn7oW-ZGD+eyvRZBPBtMS2nOpUEVFCtWC5+-x=perqFM8iuDA@mail.gmail.com>
	<CAJE2eFHbheNdAoSebnB3W+nyzDfP8fYgdMiL+4o1cA3Ks67yTQ@mail.gmail.com>
	<CAJE2eFFD3QiVU0r0QxNaqbkOV4yVzGF_ojZSW4KE7cewFYpGhw@mail.gmail.com>
Message-ID: <CAOn7oW_rLD6MDafhGrr3og4R=d9QA_B2otjri7W0n1_OrH7W+A@mail.gmail.com>

Putting back the list.

Any chance to have a proper stack trace of the exception?

On Tue, Jul 5, 2011 at 23:46, Demiss Zike <habtdemis at gmail.com> wrote:

> My bad, please ignore my last response. It compiles well but gives me the
> following run time error:
>
> Unhandled Exception: System.InvalidCastException: Unable to cast object of
> type 'RabbitMQ.Events.BasicDeliverEventArgs' to type 'System[]'.
>
>
>
>
> On Tue, Jul 5, 2011 at 4:35 PM, Demiss Zike <habtdemis at gmail.com> wrote:
>
>> It does and take in a byte[] and initializes a Measurement object.
>>
>>
>> On Tue, Jul 5, 2011 at 4:18 PM, Simone Busoli <simone.busoli at gmail.com>wrote:
>>
>>> Doesn't m2 in your code below contain the deserialized message?
>>>
>>> On Tue, Jul 5, 2011 at 23:15, Demiss Zike <habtdemis at gmail.com> wrote:
>>>
>>>> Hello,
>>>>
>>>> I'm using c#. I have a serializable class called Measurement and want to
>>>> send an object of it. I serialized an object of Measurement and captured the
>>>> serialized object as byte[] and published it. My question is how can I
>>>> capture the published message (so that I can deserialize and use it)?
>>>>
>>>> I've included codes on both ends:
>>>>
>>>> public void publish(byte[] _serializedMsg)
>>>> {
>>>> // publisher code
>>>>      ConnectionFactory factory = new ConnectionFactory();
>>>>             factory.HostName = "localhost";
>>>>              using (IConnection connection =
>>>> factory.CreateConnection())
>>>>             using (IModel channel = connection.CreateModel()) {
>>>>             channel.ExchangeDeclare("logs", "fanout");
>>>>             channel.BasicPublish("logs", queue, null, _serializedMsg);
>>>>             Console.WriteLine(" Message sent ");
>>>>         }
>>>> }
>>>>
>>>>
>>>>
>>>> public void subscribe(string queue)
>>>> {
>>>>  // subscriber code
>>>> ConnectionFactory factory = new ConnectionFactory();
>>>>             factory.HostName = "localhost";
>>>>             using (IConnection connection = factory.CreateConnection())
>>>>             using (IModel channel = connection.CreateModel()) {
>>>>             channel.ExchangeDeclare("logs", "fanout");
>>>>
>>>>     string queue1 = channel.QueueDeclare();
>>>>             channel.QueueBind(queue1, "logs", "");
>>>>             QueueingBasicConsumer consumer = new
>>>> QueueingBasicConsumer(channel);
>>>>             channel.BasicConsume(queue1, true, consumer);
>>>>
>>>>             Console.WriteLine(" Waiting for messages. To exit press
>>>> CTRL+C");
>>>>             while(true) {
>>>>                 BasicDeliverEventArgs ea =
>>>>                     (BasicDeliverEventArgs)consumer.Queue.Dequeue();
>>>>                  byte[] body = ea.Body;
>>>>  Measurement m2 = new Measurement(20, 23323, 3.3);
>>>>  m2 = BinarySerialization.BinaryDeSerialize( body );
>>>>
>>>>                 Console.WriteLine(" Message received: ");
>>>>  Console.WriteLine("\nMeasurement ID: {0}", m2.id);
>>>> Console.WriteLine("Measurement Time: {0}", m2.time);
>>>>  Console.WriteLine("Measurement Value: {0}", m2.value);
>>>>             }
>>>>         }
>>>> }
>>>>
>>>>
>>>> Thanks!
>>>> Demi
>>>>
>>>>
>>>>
>>>>
>>>>
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>
>>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110705/41bd3cc1/attachment.htm>

From simone.busoli at gmail.com  Tue Jul  5 23:07:35 2011
From: simone.busoli at gmail.com (Simone Busoli)
Date: Wed, 6 Jul 2011 00:07:35 +0200
Subject: [rabbitmq-discuss] Messaging and Serialization in RabbitMQ?
In-Reply-To: <CAJE2eFHh=Pvio7dUwPgU-dPDrTnkhLxfnv72q+tZov8A=9DkJQ@mail.gmail.com>
References: <CAJE2eFGmpqj7Jd3wqsV=-nvf6oZ6H2UyKXH0zTzcuQwCBzuzvA@mail.gmail.com>
	<CAOn7oW-ZGD+eyvRZBPBtMS2nOpUEVFCtWC5+-x=perqFM8iuDA@mail.gmail.com>
	<CAJE2eFHbheNdAoSebnB3W+nyzDfP8fYgdMiL+4o1cA3Ks67yTQ@mail.gmail.com>
	<CAJE2eFFD3QiVU0r0QxNaqbkOV4yVzGF_ojZSW4KE7cewFYpGhw@mail.gmail.com>
	<CAOn7oW_rLD6MDafhGrr3og4R=d9QA_B2otjri7W0n1_OrH7W+A@mail.gmail.com>
	<CAJE2eFHh=Pvio7dUwPgU-dPDrTnkhLxfnv72q+tZov8A=9DkJQ@mail.gmail.com>
Message-ID: <CAOn7oW85FKyMMyyzWpjzfxmfNSOaioc=ZmS7vBYu099FJvbEWw@mail.gmail.com>

Putting back the list (please Reply All).

the code you posted is unlikely generating that exception. It's complaining
about an invalid cast from BasicDeliverEventArgs to byte[], and you don't
have such a cast in your code.

On Wed, Jul 6, 2011 at 00:00, Demiss Zike <habtdemis at gmail.com> wrote:

> Sure, I've attached the screen shot of the error.
>
>
> On Tue, Jul 5, 2011 at 4:51 PM, Simone Busoli <simone.busoli at gmail.com>wrote:
>
>> Putting back the list.
>>
>> Any chance to have a proper stack trace of the exception?
>>
>> On Tue, Jul 5, 2011 at 23:46, Demiss Zike <habtdemis at gmail.com> wrote:
>>
>>> My bad, please ignore my last response. It compiles well but gives me the
>>> following run time error:
>>>
>>> Unhandled Exception: System.InvalidCastException: Unable to cast object
>>> of type 'RabbitMQ.Events.BasicDeliverEventArgs' to type 'System[]'.
>>>
>>>
>>>
>>>
>>> On Tue, Jul 5, 2011 at 4:35 PM, Demiss Zike <habtdemis at gmail.com> wrote:
>>>
>>>> It does and take in a byte[] and initializes a Measurement object.
>>>>
>>>>
>>>> On Tue, Jul 5, 2011 at 4:18 PM, Simone Busoli <simone.busoli at gmail.com>wrote:
>>>>
>>>>> Doesn't m2 in your code below contain the deserialized message?
>>>>>
>>>>> On Tue, Jul 5, 2011 at 23:15, Demiss Zike <habtdemis at gmail.com> wrote:
>>>>>
>>>>>> Hello,
>>>>>>
>>>>>> I'm using c#. I have a serializable class called Measurement and want
>>>>>> to send an object of it. I serialized an object of Measurement and captured
>>>>>> the serialized object as byte[] and published it. My question is how can I
>>>>>> capture the published message (so that I can deserialize and use it)?
>>>>>>
>>>>>> I've included codes on both ends:
>>>>>>
>>>>>> public void publish(byte[] _serializedMsg)
>>>>>> {
>>>>>> // publisher code
>>>>>>      ConnectionFactory factory = new ConnectionFactory();
>>>>>>             factory.HostName = "localhost";
>>>>>>              using (IConnection connection =
>>>>>> factory.CreateConnection())
>>>>>>             using (IModel channel = connection.CreateModel()) {
>>>>>>             channel.ExchangeDeclare("logs", "fanout");
>>>>>>             channel.BasicPublish("logs", queue, null, _serializedMsg);
>>>>>>             Console.WriteLine(" Message sent ");
>>>>>>         }
>>>>>> }
>>>>>>
>>>>>>
>>>>>>
>>>>>> public void subscribe(string queue)
>>>>>> {
>>>>>>  // subscriber code
>>>>>> ConnectionFactory factory = new ConnectionFactory();
>>>>>>             factory.HostName = "localhost";
>>>>>>             using (IConnection connection =
>>>>>> factory.CreateConnection())
>>>>>>             using (IModel channel = connection.CreateModel()) {
>>>>>>             channel.ExchangeDeclare("logs", "fanout");
>>>>>>
>>>>>>     string queue1 = channel.QueueDeclare();
>>>>>>             channel.QueueBind(queue1, "logs", "");
>>>>>>             QueueingBasicConsumer consumer = new
>>>>>> QueueingBasicConsumer(channel);
>>>>>>             channel.BasicConsume(queue1, true, consumer);
>>>>>>
>>>>>>             Console.WriteLine(" Waiting for messages. To exit press
>>>>>> CTRL+C");
>>>>>>             while(true) {
>>>>>>                 BasicDeliverEventArgs ea =
>>>>>>                     (BasicDeliverEventArgs)consumer.Queue.Dequeue();
>>>>>>                  byte[] body = ea.Body;
>>>>>>  Measurement m2 = new Measurement(20, 23323, 3.3);
>>>>>>  m2 = BinarySerialization.BinaryDeSerialize( body );
>>>>>>
>>>>>>                 Console.WriteLine(" Message received: ");
>>>>>>  Console.WriteLine("\nMeasurement ID: {0}", m2.id);
>>>>>> Console.WriteLine("Measurement Time: {0}", m2.time);
>>>>>>  Console.WriteLine("Measurement Value: {0}", m2.value);
>>>>>>             }
>>>>>>         }
>>>>>> }
>>>>>>
>>>>>>
>>>>>> Thanks!
>>>>>> Demi
>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>> _______________________________________________
>>>>>> rabbitmq-discuss mailing list
>>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>>>
>>>>>>
>>>>>
>>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110706/5568ae4b/attachment.htm>

From habtdemis at gmail.com  Tue Jul  5 23:14:58 2011
From: habtdemis at gmail.com (Demiss Zike)
Date: Tue, 5 Jul 2011 17:14:58 -0500
Subject: [rabbitmq-discuss] Messaging and Serialization in RabbitMQ?
In-Reply-To: <CAOn7oW85FKyMMyyzWpjzfxmfNSOaioc=ZmS7vBYu099FJvbEWw@mail.gmail.com>
References: <CAJE2eFGmpqj7Jd3wqsV=-nvf6oZ6H2UyKXH0zTzcuQwCBzuzvA@mail.gmail.com>
	<CAOn7oW-ZGD+eyvRZBPBtMS2nOpUEVFCtWC5+-x=perqFM8iuDA@mail.gmail.com>
	<CAJE2eFHbheNdAoSebnB3W+nyzDfP8fYgdMiL+4o1cA3Ks67yTQ@mail.gmail.com>
	<CAJE2eFFD3QiVU0r0QxNaqbkOV4yVzGF_ojZSW4KE7cewFYpGhw@mail.gmail.com>
	<CAOn7oW_rLD6MDafhGrr3og4R=d9QA_B2otjri7W0n1_OrH7W+A@mail.gmail.com>
	<CAJE2eFHh=Pvio7dUwPgU-dPDrTnkhLxfnv72q+tZov8A=9DkJQ@mail.gmail.com>
	<CAOn7oW85FKyMMyyzWpjzfxmfNSOaioc=ZmS7vBYu099FJvbEWw@mail.gmail.com>
Message-ID: <CAJE2eFFzCaeHAxXGNEz0eNOyQyLw+qWE22nkan4juEGqq85sLw@mail.gmail.com>

Could, byte[] body = ea.Body; generate it? Because that is the only line the
error seems to relate with. I believe ea is of  BasicDeliverEventArgs type?



On Tue, Jul 5, 2011 at 5:07 PM, Simone Busoli <simone.busoli at gmail.com>wrote:

> Putting back the list (please Reply All).
>
> the code you posted is unlikely generating that exception. It's complaining
> about an invalid cast from BasicDeliverEventArgs to byte[], and you don't
> have such a cast in your code.
>
> On Wed, Jul 6, 2011 at 00:00, Demiss Zike <habtdemis at gmail.com> wrote:
>
>> Sure, I've attached the screen shot of the error.
>>
>>
>> On Tue, Jul 5, 2011 at 4:51 PM, Simone Busoli <simone.busoli at gmail.com>wrote:
>>
>>> Putting back the list.
>>>
>>> Any chance to have a proper stack trace of the exception?
>>>
>>> On Tue, Jul 5, 2011 at 23:46, Demiss Zike <habtdemis at gmail.com> wrote:
>>>
>>>> My bad, please ignore my last response. It compiles well but gives me
>>>> the following run time error:
>>>>
>>>> Unhandled Exception: System.InvalidCastException: Unable to cast object
>>>> of type 'RabbitMQ.Events.BasicDeliverEventArgs' to type 'System[]'.
>>>>
>>>>
>>>>
>>>>
>>>> On Tue, Jul 5, 2011 at 4:35 PM, Demiss Zike <habtdemis at gmail.com>wrote:
>>>>
>>>>> It does and take in a byte[] and initializes a Measurement object.
>>>>>
>>>>>
>>>>> On Tue, Jul 5, 2011 at 4:18 PM, Simone Busoli <simone.busoli at gmail.com
>>>>> > wrote:
>>>>>
>>>>>> Doesn't m2 in your code below contain the deserialized message?
>>>>>>
>>>>>> On Tue, Jul 5, 2011 at 23:15, Demiss Zike <habtdemis at gmail.com>wrote:
>>>>>>
>>>>>>> Hello,
>>>>>>>
>>>>>>> I'm using c#. I have a serializable class called Measurement and want
>>>>>>> to send an object of it. I serialized an object of Measurement and captured
>>>>>>> the serialized object as byte[] and published it. My question is how can I
>>>>>>> capture the published message (so that I can deserialize and use it)?
>>>>>>>
>>>>>>> I've included codes on both ends:
>>>>>>>
>>>>>>> public void publish(byte[] _serializedMsg)
>>>>>>> {
>>>>>>> // publisher code
>>>>>>>      ConnectionFactory factory = new ConnectionFactory();
>>>>>>>             factory.HostName = "localhost";
>>>>>>>              using (IConnection connection =
>>>>>>> factory.CreateConnection())
>>>>>>>             using (IModel channel = connection.CreateModel()) {
>>>>>>>             channel.ExchangeDeclare("logs", "fanout");
>>>>>>>             channel.BasicPublish("logs", queue, null,
>>>>>>> _serializedMsg);
>>>>>>>             Console.WriteLine(" Message sent ");
>>>>>>>         }
>>>>>>> }
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>> public void subscribe(string queue)
>>>>>>> {
>>>>>>>  // subscriber code
>>>>>>> ConnectionFactory factory = new ConnectionFactory();
>>>>>>>             factory.HostName = "localhost";
>>>>>>>             using (IConnection connection =
>>>>>>> factory.CreateConnection())
>>>>>>>             using (IModel channel = connection.CreateModel()) {
>>>>>>>             channel.ExchangeDeclare("logs", "fanout");
>>>>>>>
>>>>>>>     string queue1 = channel.QueueDeclare();
>>>>>>>             channel.QueueBind(queue1, "logs", "");
>>>>>>>             QueueingBasicConsumer consumer = new
>>>>>>> QueueingBasicConsumer(channel);
>>>>>>>             channel.BasicConsume(queue1, true, consumer);
>>>>>>>
>>>>>>>             Console.WriteLine(" Waiting for messages. To exit press
>>>>>>> CTRL+C");
>>>>>>>             while(true) {
>>>>>>>                 BasicDeliverEventArgs ea =
>>>>>>>                     (BasicDeliverEventArgs)consumer.Queue.Dequeue();
>>>>>>>                  byte[] body = ea.Body;
>>>>>>>  Measurement m2 = new Measurement(20, 23323, 3.3);
>>>>>>>  m2 = BinarySerialization.BinaryDeSerialize( body );
>>>>>>>
>>>>>>>                 Console.WriteLine(" Message received: ");
>>>>>>>  Console.WriteLine("\nMeasurement ID: {0}", m2.id);
>>>>>>> Console.WriteLine("Measurement Time: {0}", m2.time);
>>>>>>>  Console.WriteLine("Measurement Value: {0}", m2.value);
>>>>>>>             }
>>>>>>>         }
>>>>>>> }
>>>>>>>
>>>>>>>
>>>>>>> Thanks!
>>>>>>> Demi
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>> _______________________________________________
>>>>>>> rabbitmq-discuss mailing list
>>>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>>>>
>>>>>>>
>>>>>>
>>>>>
>>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110705/17663cde/attachment.htm>

From jasonjwwilliams at gmail.com  Tue Jul  5 23:16:42 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Tue, 5 Jul 2011 16:16:42 -0600
Subject: [rabbitmq-discuss] Using BlockingConnection in Pika
In-Reply-To: <CAL_e=0pJupDOMnikLWEb4cDO64oVVpmsDRMSHpxBgJLcuBUANQ@mail.gmail.com>
References: <624fb51a-56ed-4e31-af58-408e24fffccf@q14g2000prh.googlegroups.com>
	<CAEDqXPH46iC9vareHV75pyxnDUkk6=G9QMfhZQtzPujpZg67mw@mail.gmail.com>
	<CAHZAEpfkvzUq44wcy-Q0F9FM9gAXVr09HueZ1HiqH_9Sb64nAA@mail.gmail.com>
	<CAEDqXPGDDNfLXfL4OL7RUeM63PCFwt4KLCuOM1hOvV=zPv4_qw@mail.gmail.com>
	<CAL_e=0pJupDOMnikLWEb4cDO64oVVpmsDRMSHpxBgJLcuBUANQ@mail.gmail.com>
Message-ID: <CAHZAEpetifVrgOGC49GpOq+u2M0AydCRRd53T31c1TtFvrXRPw@mail.gmail.com>

Hey Gavin,


> I'd say you're fine using it if it works for you. I find that it's
> good for publishing a lot of messages quickly. If you're going to use
> it as a consumer, you're better off just doing the minimal work of
> using the asynchronous methods because you'll be working with the
> asynchronous callback in the blocking connection anyway. I'll be
> supporting bug fixes in the 0.9 tree but my focus on Pika and heart is
> in a cleaner implementation.
>

Is the future going to break API compatibility again?

-J
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110705/7720672e/attachment.htm>

From simone.busoli at gmail.com  Tue Jul  5 23:16:42 2011
From: simone.busoli at gmail.com (Simone Busoli)
Date: Wed, 6 Jul 2011 00:16:42 +0200
Subject: [rabbitmq-discuss] Messaging and Serialization in RabbitMQ?
In-Reply-To: <CAJE2eFFzCaeHAxXGNEz0eNOyQyLw+qWE22nkan4juEGqq85sLw@mail.gmail.com>
References: <CAJE2eFGmpqj7Jd3wqsV=-nvf6oZ6H2UyKXH0zTzcuQwCBzuzvA@mail.gmail.com>
	<CAOn7oW-ZGD+eyvRZBPBtMS2nOpUEVFCtWC5+-x=perqFM8iuDA@mail.gmail.com>
	<CAJE2eFHbheNdAoSebnB3W+nyzDfP8fYgdMiL+4o1cA3Ks67yTQ@mail.gmail.com>
	<CAJE2eFFD3QiVU0r0QxNaqbkOV4yVzGF_ojZSW4KE7cewFYpGhw@mail.gmail.com>
	<CAOn7oW_rLD6MDafhGrr3og4R=d9QA_B2otjri7W0n1_OrH7W+A@mail.gmail.com>
	<CAJE2eFHh=Pvio7dUwPgU-dPDrTnkhLxfnv72q+tZov8A=9DkJQ@mail.gmail.com>
	<CAOn7oW85FKyMMyyzWpjzfxmfNSOaioc=ZmS7vBYu099FJvbEWw@mail.gmail.com>
	<CAJE2eFFzCaeHAxXGNEz0eNOyQyLw+qWE22nkan4juEGqq85sLw@mail.gmail.com>
Message-ID: <CAOn7oW_P2YnTdEiaZk3=QOatFa6ZBQUswxZynomZdDdyQtvpsA@mail.gmail.com>

It is, and BasicDeliverEventArgs.Body is of type byte[].

On Wed, Jul 6, 2011 at 00:14, Demiss Zike <habtdemis at gmail.com> wrote:

> Could, byte[] body = ea.Body; generate it? Because that is the only line
> the error seems to relate with. I believe ea is of  BasicDeliverEventArgs
> type?
>
>
>
> On Tue, Jul 5, 2011 at 5:07 PM, Simone Busoli <simone.busoli at gmail.com>wrote:
>
>> Putting back the list (please Reply All).
>>
>> the code you posted is unlikely generating that exception. It's
>> complaining about an invalid cast from BasicDeliverEventArgs to byte[], and
>> you don't have such a cast in your code.
>>
>> On Wed, Jul 6, 2011 at 00:00, Demiss Zike <habtdemis at gmail.com> wrote:
>>
>>> Sure, I've attached the screen shot of the error.
>>>
>>>
>>> On Tue, Jul 5, 2011 at 4:51 PM, Simone Busoli <simone.busoli at gmail.com>wrote:
>>>
>>>> Putting back the list.
>>>>
>>>> Any chance to have a proper stack trace of the exception?
>>>>
>>>> On Tue, Jul 5, 2011 at 23:46, Demiss Zike <habtdemis at gmail.com> wrote:
>>>>
>>>>> My bad, please ignore my last response. It compiles well but gives me
>>>>> the following run time error:
>>>>>
>>>>> Unhandled Exception: System.InvalidCastException: Unable to cast object
>>>>> of type 'RabbitMQ.Events.BasicDeliverEventArgs' to type 'System[]'.
>>>>>
>>>>>
>>>>>
>>>>>
>>>>> On Tue, Jul 5, 2011 at 4:35 PM, Demiss Zike <habtdemis at gmail.com>wrote:
>>>>>
>>>>>> It does and take in a byte[] and initializes a Measurement object.
>>>>>>
>>>>>>
>>>>>> On Tue, Jul 5, 2011 at 4:18 PM, Simone Busoli <
>>>>>> simone.busoli at gmail.com> wrote:
>>>>>>
>>>>>>> Doesn't m2 in your code below contain the deserialized message?
>>>>>>>
>>>>>>> On Tue, Jul 5, 2011 at 23:15, Demiss Zike <habtdemis at gmail.com>wrote:
>>>>>>>
>>>>>>>> Hello,
>>>>>>>>
>>>>>>>> I'm using c#. I have a serializable class called Measurement and
>>>>>>>> want to send an object of it. I serialized an object of Measurement and
>>>>>>>> captured the serialized object as byte[] and published it. My question is
>>>>>>>> how can I capture the published message (so that I can deserialize and use
>>>>>>>> it)?
>>>>>>>>
>>>>>>>> I've included codes on both ends:
>>>>>>>>
>>>>>>>> public void publish(byte[] _serializedMsg)
>>>>>>>> {
>>>>>>>> // publisher code
>>>>>>>>      ConnectionFactory factory = new ConnectionFactory();
>>>>>>>>             factory.HostName = "localhost";
>>>>>>>>              using (IConnection connection =
>>>>>>>> factory.CreateConnection())
>>>>>>>>             using (IModel channel = connection.CreateModel()) {
>>>>>>>>             channel.ExchangeDeclare("logs", "fanout");
>>>>>>>>             channel.BasicPublish("logs", queue, null,
>>>>>>>> _serializedMsg);
>>>>>>>>             Console.WriteLine(" Message sent ");
>>>>>>>>         }
>>>>>>>> }
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>> public void subscribe(string queue)
>>>>>>>> {
>>>>>>>>  // subscriber code
>>>>>>>> ConnectionFactory factory = new ConnectionFactory();
>>>>>>>>             factory.HostName = "localhost";
>>>>>>>>             using (IConnection connection =
>>>>>>>> factory.CreateConnection())
>>>>>>>>             using (IModel channel = connection.CreateModel()) {
>>>>>>>>             channel.ExchangeDeclare("logs", "fanout");
>>>>>>>>
>>>>>>>>     string queue1 = channel.QueueDeclare();
>>>>>>>>             channel.QueueBind(queue1, "logs", "");
>>>>>>>>             QueueingBasicConsumer consumer = new
>>>>>>>> QueueingBasicConsumer(channel);
>>>>>>>>             channel.BasicConsume(queue1, true, consumer);
>>>>>>>>
>>>>>>>>             Console.WriteLine(" Waiting for messages. To exit press
>>>>>>>> CTRL+C");
>>>>>>>>             while(true) {
>>>>>>>>                 BasicDeliverEventArgs ea =
>>>>>>>>                     (BasicDeliverEventArgs)consumer.Queue.Dequeue();
>>>>>>>>                  byte[] body = ea.Body;
>>>>>>>>  Measurement m2 = new Measurement(20, 23323, 3.3);
>>>>>>>>  m2 = BinarySerialization.BinaryDeSerialize( body );
>>>>>>>>
>>>>>>>>                 Console.WriteLine(" Message received: ");
>>>>>>>>  Console.WriteLine("\nMeasurement ID: {0}", m2.id);
>>>>>>>> Console.WriteLine("Measurement Time: {0}", m2.time);
>>>>>>>>  Console.WriteLine("Measurement Value: {0}", m2.value);
>>>>>>>>             }
>>>>>>>>         }
>>>>>>>> }
>>>>>>>>
>>>>>>>>
>>>>>>>> Thanks!
>>>>>>>> Demi
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>> _______________________________________________
>>>>>>>> rabbitmq-discuss mailing list
>>>>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>>>>>
>>>>>>>>
>>>>>>>
>>>>>>
>>>>>
>>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110706/7d56a5d7/attachment.htm>

From gmr at myyearbook.com  Tue Jul  5 23:21:51 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Tue, 5 Jul 2011 18:21:51 -0400
Subject: [rabbitmq-discuss] Using BlockingConnection in Pika
In-Reply-To: <CAHZAEpetifVrgOGC49GpOq+u2M0AydCRRd53T31c1TtFvrXRPw@mail.gmail.com>
References: <624fb51a-56ed-4e31-af58-408e24fffccf@q14g2000prh.googlegroups.com>
	<CAEDqXPH46iC9vareHV75pyxnDUkk6=G9QMfhZQtzPujpZg67mw@mail.gmail.com>
	<CAHZAEpfkvzUq44wcy-Q0F9FM9gAXVr09HueZ1HiqH_9Sb64nAA@mail.gmail.com>
	<CAEDqXPGDDNfLXfL4OL7RUeM63PCFwt4KLCuOM1hOvV=zPv4_qw@mail.gmail.com>
	<CAL_e=0pJupDOMnikLWEb4cDO64oVVpmsDRMSHpxBgJLcuBUANQ@mail.gmail.com>
	<CAHZAEpetifVrgOGC49GpOq+u2M0AydCRRd53T31c1TtFvrXRPw@mail.gmail.com>
Message-ID: <2277CB99-2B3E-4D89-90F0-910A12C8A90B@myyearbook.com>



On Jul 5, 2011, at 6:16 PM, "Jason J. W. Williams" <jasonjwwilliams at gmail.com> wrote:

> Hey Gavin,
>  
> I'd say you're fine using it if it works for you. I find that it's
> good for publishing a lot of messages quickly. If you're going to use
> it as a consumer, you're better off just doing the minimal work of
> using the asynchronous methods because you'll be working with the
> asynchronous callback in the blocking connection anyway. I'll be
> supporting bug fixes in the 0.9 tree but my focus on Pika and heart is
> in a cleaner implementation.
> 
> Is the future going to break API compatibility again?
> 
> -J

Goal is 100% compatibility with a class overlay.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110705/9b71a858/attachment.htm>

From jasonjwwilliams at gmail.com  Tue Jul  5 23:41:45 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Tue, 5 Jul 2011 16:41:45 -0600
Subject: [rabbitmq-discuss] Using BlockingConnection in Pika
In-Reply-To: <2277CB99-2B3E-4D89-90F0-910A12C8A90B@myyearbook.com>
References: <624fb51a-56ed-4e31-af58-408e24fffccf@q14g2000prh.googlegroups.com>
	<CAEDqXPH46iC9vareHV75pyxnDUkk6=G9QMfhZQtzPujpZg67mw@mail.gmail.com>
	<CAHZAEpfkvzUq44wcy-Q0F9FM9gAXVr09HueZ1HiqH_9Sb64nAA@mail.gmail.com>
	<CAEDqXPGDDNfLXfL4OL7RUeM63PCFwt4KLCuOM1hOvV=zPv4_qw@mail.gmail.com>
	<CAL_e=0pJupDOMnikLWEb4cDO64oVVpmsDRMSHpxBgJLcuBUANQ@mail.gmail.com>
	<CAHZAEpetifVrgOGC49GpOq+u2M0AydCRRd53T31c1TtFvrXRPw@mail.gmail.com>
	<2277CB99-2B3E-4D89-90F0-910A12C8A90B@myyearbook.com>
Message-ID: <CAHZAEpf-s7NGefMgbyrWW2Kis=T33yJe1GxXUMJF2b4=V03r+Q@mail.gmail.com>

>
> Goal is 100% compatibility with a class overlay.
>

That's terrific. Thank you.

-J
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110705/1b578e6a/attachment.htm>

From rckclmbr at gmail.com  Tue Jul  5 23:54:17 2011
From: rckclmbr at gmail.com (Joshua Braegger)
Date: Tue, 5 Jul 2011 16:54:17 -0600
Subject: [rabbitmq-discuss] Using BlockingConnection in Pika
In-Reply-To: <CAL_e=0pJupDOMnikLWEb4cDO64oVVpmsDRMSHpxBgJLcuBUANQ@mail.gmail.com>
References: <624fb51a-56ed-4e31-af58-408e24fffccf@q14g2000prh.googlegroups.com>
	<CAEDqXPH46iC9vareHV75pyxnDUkk6=G9QMfhZQtzPujpZg67mw@mail.gmail.com>
	<CAHZAEpfkvzUq44wcy-Q0F9FM9gAXVr09HueZ1HiqH_9Sb64nAA@mail.gmail.com>
	<CAEDqXPGDDNfLXfL4OL7RUeM63PCFwt4KLCuOM1hOvV=zPv4_qw@mail.gmail.com>
	<CAL_e=0pJupDOMnikLWEb4cDO64oVVpmsDRMSHpxBgJLcuBUANQ@mail.gmail.com>
Message-ID: <CAEDqXPF35MsXPTMWuNVpj3=+-PFMVf1bFKOozF1srSHhjVuXsQ@mail.gmail.com>

Perfect, that will work great.  Thanks a lot Gavin and Jason.

-Josh



On Tue, Jul 5, 2011 at 3:19 PM, Gavin M. Roy <gmr at myyearbook.com> wrote:

> On Tue, Jul 5, 2011 at 5:04 PM, Joshua Braegger <rckclmbr at gmail.com>
> wrote:
> > Thanks, Jason.
> > I bring this up because of this comment
> > --
> http://tonyg.github.com/pika/connecting.html#adapters-blocking-connection-blockingconnection
> > "Warning BlockingConnection is provided for legacy and learning purposes
> > only and it is not recommended that you use it for a production
> > application."
> > The latest git documentation also still has this warning
> > (
> https://github.com/pika/pika/blob/master/pika/adapters/base_connection.py)
> > "adapters.blocking_connection.BlockingConnection: Enables blocking,
> >
> >   synchronous operation on top of library for simple uses. This is not
> >   recommended and is included for legacy reasons only."
> >
> > So my question is, why isn't this recommended for production use?
>
> In essence, you can but the main issue is it's a synchronous "hack" on
> top of an asynchronous stack using an asynchronous protocol. I am
> working on a revamped method of handling the blocking but it's taking
> a bit longer than I'd like.
>
> The best way to think of the BlockingConnection adapter is as a layer
> on top of the existing client that implements blocking behaviors.
> Every other adapter plugs into the driver.
>
> At the time I wrote that it was deprecated, I wasn't planning on
> keeping it long term. My impression of it and how to handle it has
> changed over time. Here's where I was in March:
> http://gavinroy.com/the-future-of-pika.
>
> I'd say you're fine using it if it works for you. I find that it's
> good for publishing a lot of messages quickly. If you're going to use
> it as a consumer, you're better off just doing the minimal work of
> using the asynchronous methods because you'll be working with the
> asynchronous callback in the blocking connection anyway. I'll be
> supporting bug fixes in the 0.9 tree but my focus on Pika and heart is
> in a cleaner implementation.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110705/2e036e62/attachment.htm>

From jasonjwwilliams at gmail.com  Wed Jul  6 01:28:11 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Tue, 5 Jul 2011 18:28:11 -0600
Subject: [rabbitmq-discuss] RabbitMQ ACL suggestions?
In-Reply-To: <4E0BA730.7020608@rabbitmq.com>
References: <BANLkTinkdVGOvbk0LkOHUvu8navTQuNi8Q@mail.gmail.com>
	<4E0BA730.7020608@rabbitmq.com>
Message-ID: <CAHZAEpcCyop26WSGimFaaj5=DfY+kGX8s0TYR+kCeDCK+xzcSA@mail.gmail.com>

Hi Matthias,


> In addition, we are currently doing all of our monitoring via the
>> Management Plugin's API. Unfortunately to get any data, the user calling
>> the API to list information requires administration access. I'd love to
>> be able to let Nagios/Your_Monitoring_**Solution_Here poll the Rabbit
>> node
>> and get data without giving it access to change all of the configuration
>> state and remove users.
>>
>
> Again, that should change in the next release. The code for it is going
> through qa atm.



What form will this take? Is it going to be a new flag, or will API access
no longer required the "admin" flag? Also, any idea on the rev #?

-J
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110705/a2346e21/attachment.htm>

From vinodsharma.mimit at gmail.com  Wed Jul  6 02:05:58 2011
From: vinodsharma.mimit at gmail.com (Vinod Sharma)
Date: Tue, 5 Jul 2011 18:05:58 -0700 (PDT)
Subject: [rabbitmq-discuss] check if queue is empty?
Message-ID: <215fb2b7-6276-49d6-bcb1-4cb1dd876641@35g2000prp.googlegroups.com>

Hi,
I am new to rabbitMQ. I am using python pika module to communicate
with rabbitMQ server.
is there a function in pika to tell if the message queue is empty or
not??

Thanks,
Vinod

From gmr at myyearbook.com  Wed Jul  6 03:34:05 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Tue, 5 Jul 2011 22:34:05 -0400
Subject: [rabbitmq-discuss] check if queue is empty?
In-Reply-To: <215fb2b7-6276-49d6-bcb1-4cb1dd876641@35g2000prp.googlegroups.com>
References: <215fb2b7-6276-49d6-bcb1-4cb1dd876641@35g2000prp.googlegroups.com>
Message-ID: <A3CDF983836444E3915A3C0EE62E42D8@myyearbook.com>

You can do a queue.declare('queue_name', passive=True) and get the results of that which will have the queue depth.

On Tuesday, July 5, 2011 at 9:05 PM, Vinod Sharma wrote:

> Hi,
> I am new to rabbitMQ. I am using python pika module to communicate
> with rabbitMQ server.
> is there a function in pika to tell if the message queue is empty or
> not??
> 
> Thanks,
> Vinod
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



From vinodsharma.mimit at gmail.com  Wed Jul  6 03:38:26 2011
From: vinodsharma.mimit at gmail.com (vinod sharma)
Date: Tue, 5 Jul 2011 19:38:26 -0700
Subject: [rabbitmq-discuss] check if queue is empty?
In-Reply-To: <A3CDF983836444E3915A3C0EE62E42D8@myyearbook.com>
References: <215fb2b7-6276-49d6-bcb1-4cb1dd876641@35g2000prp.googlegroups.com>
	<A3CDF983836444E3915A3C0EE62E42D8@myyearbook.com>
Message-ID: <CAKcwZx4KkdjXW_w1waatkXX+vZk0NzaPNXa+DW5jbXai2xBxdg@mail.gmail.com>

Thanks Gavin for the response. I already got the answer but was not able to
post the message.
Here is what i did:Similar to what you have suggested.

status = channel.queue_declare(queue=msgqueue)
if status.method.message_count == 0:
    print "queue empty"


On Tue, Jul 5, 2011 at 7:34 PM, Gavin M. Roy <gmr at myyearbook.com> wrote:

> You can do a queue.declare('queue_name', passive=True) and get the results
> of that which will have the queue depth.
>
> On Tuesday, July 5, 2011 at 9:05 PM, Vinod Sharma wrote:
>
> > Hi,
> > I am new to rabbitMQ. I am using python pika module to communicate
> > with rabbitMQ server.
> > is there a function in pika to tell if the message queue is empty or
> > not??
> >
> > Thanks,
> > Vinod
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com (mailto:
> rabbitmq-discuss at lists.rabbitmq.com)
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>


-- 
Regards,
--------------------------------
Vinod Sharma
http://securitygyan.com
McAfee Inc
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110705/6b967551/attachment.htm>

From thomas.kant at gmail.com  Wed Jul  6 04:08:34 2011
From: thomas.kant at gmail.com (scorpiovn)
Date: Tue, 5 Jul 2011 20:08:34 -0700 (PDT)
Subject: [rabbitmq-discuss] How can I use RabbitMQ with Eureka Streams
In-Reply-To: <4E136291.5090002@rabbitmq.com>
References: <c8b16489-103b-422e-965d-1a9a1cc8db72@e17g2000prj.googlegroups.com>
	<4E136291.5090002@rabbitmq.com>
Message-ID: <db7e1043-66ad-471a-98fb-cb26b23eb4a4@h25g2000prf.googlegroups.com>

I git it.
Thanks Micheal.

On Jul 6, 2:14?am, Michael Bridgen <mi... at rabbitmq.com> wrote:
> On 05/07/2011 19:05, scorpiovn wrote:
>
> > I want to use RabbitMQ with Eureka Streams.
> > Could you help me this problem?
>
> Do you mean you want to replace a piece of Eureka Streams with RabbitMQ
> -- I presume the ActiveMQ piece? ?In order to do that, you would have to
> (at the least) replace the ActiveMQ JMS client with the RabbitMQ Java
> AMQP client. ?These are not radically different APIs but not a straight
> swap either.
>
> If you don't mean that, what do you mean, more specifically?
>
> Regards,
> Michael
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From kuleshovmail at gmail.com  Wed Jul  6 08:50:46 2011
From: kuleshovmail at gmail.com (Alexander Kuleshov)
Date: Wed, 6 Jul 2011 07:50:46 +0000
Subject: [rabbitmq-discuss] Message receive error
Message-ID: <CANCZXo7GD-Fd_okxCCJbQyh0yg_XNHr06nZJHSRSTvOuYBnQGA@mail.gmail.com>

Hello,

I have code

-module(send).
-export([main/0]).

-include_lib("amqp_client/include/amqp_client.hrl").

main() ->
    io:format("Connect \n"),
    {ok, Connection} =
        amqp_connection:start(#amqp_params_network{host = "localhost",
						   password = <<"password">>}),

    io:format("Open channel \n"),
    {ok, Channel} = amqp_connection:open_channel(Connection),
    amqp_channel:call(Channel, #'queue.declare'{queue = <<"test1">>}),
    amqp_channel:subscribe(Channel, #'basic.consume'{queue =
<<"test2">>}, self()),

   io:format("send message \n"),

    Message = <<"test message">>,
    amqp_channel:cast(Channel, #'basic.publish'{exchange = <<"">>,
routing_key = <<"test1">>},
		      #amqp_msg{payload = Message}),

    io:format("message sended \n"),

    receive
        #'basic.consume_ok'{} -> ok
    end,
    loop(Channel).

loop(Channel) ->
    io:format("Loop start"),
    receive
	{#'basic.deliver'{delivery_tag = Tag}, Content} ->
	    io:format("Message receive"),
	    amqp_channel:cast(Channel, #'basic.ack'{delivery_tag = Tag}),
	    loop(Channel);
	_ ->
	    loop(Channel)
    end.


I get error when run it:

Eshell V5.8.1  (abort with ^G)
1> send:main().
Connect
Open channel
** exception exit: {{shutdown,{server_initiated_close,404,
                                                      <<"NOT_FOUND -
no queue 'test2' in vhost '/'">>}},
                    {gen_server,call,
                                [<0.48.0>,

{subscribe,{'basic.consume',0,<<"test2">>,<<>>,false,

false,false,false,[]},
                                            <0.32.0>},
                                 infinity]}}
     in function  gen_server:call/3
     in call from send:main/0

How can i send and receive message?

Thank you.

From dmaher at milestonelab.com  Wed Jul  6 08:54:19 2011
From: dmaher at milestonelab.com (Daniel Maher)
Date: Wed, 06 Jul 2011 09:54:19 +0200
Subject: [rabbitmq-discuss] How can I use RabbitMQ with monit
In-Reply-To: <cdc827b8-1268-47a0-9189-399c73576ac8@m18g2000vbl.googlegroups.com>
References: <31998195.post@talk.nabble.com>
	<cdc827b8-1268-47a0-9189-399c73576ac8@m18g2000vbl.googlegroups.com>
Message-ID: <4E1414AB.9070804@milestonelab.com>

On 07/05/2011 07:01 PM, Ronen wrote:
> Im not sure what rabbitmq-multi is but this is how iv solved it for
> rabbitmq-server:
>
> http://groups.google.com/group/rabbitmq-discuss/browse_thread/thread/b6bd0f50e962e43
>
> Ronen
>
> On Jul 5, 7:13 pm, blp330<blp... at msn.com>  wrote:
>> Hi,
>>
>> I tried to follow this instruction:http://blog.joeygeiger.com/2009/02/25/rabbitmq-and-monit/
>>
>> but rabbitmq-multi is unavailable for my rabbitmq version 2.5.1.
>>
>> I try to use rabbitmq-server, but no any pid file created, so I do not have
>> any idea to do it with monit.
>>
>> So, how can I use RabbitMQ with monit?
>>
>> or no one did this because this is unnecessary?

This is what I have in my monitrc, and it works :

### rabbitmq-server
check process rabbitmq-server with pidfile /var/run/rabbitmq
     start program "/etc/init.d/rabbitmq-server start"
     stop program "/etc/init.d/rabbitmq-server stop"
     if failed port 6163 type tcp then restart
     if 3 restarts within 3 cycles then timeout

Afaik, responsibility for the creation of the pidfile rests with the 
control script (ex. init.d), so you should look there for the location 
of the pidfile on your platform.

-- 
Daniel Maher
? makin' plans now to live on Mars 'cuz I got Earth on lock. ?

From emile at rabbitmq.com  Wed Jul  6 09:18:25 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 06 Jul 2011 09:18:25 +0100
Subject: [rabbitmq-discuss] Message receive error
In-Reply-To: <CANCZXo7GD-Fd_okxCCJbQyh0yg_XNHr06nZJHSRSTvOuYBnQGA@mail.gmail.com>
References: <CANCZXo7GD-Fd_okxCCJbQyh0yg_XNHr06nZJHSRSTvOuYBnQGA@mail.gmail.com>
Message-ID: <4E141A51.6010908@rabbitmq.com>

Hi Alexander,

On 06/07/11 08:50, Alexander Kuleshov wrote:

>     amqp_channel:call(Channel, #'queue.declare'{queue = <<"test1">>}),
>     amqp_channel:subscribe(Channel, #'basic.consume'{queue =
> <<"test2">>}, self()),

You are declaring and subscribing to queues with different names. That's
why the subscription is failing.


-Emile

From simon at rabbitmq.com  Wed Jul  6 10:51:06 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 06 Jul 2011 10:51:06 +0100
Subject: [rabbitmq-discuss] RabbitMQ ACL suggestions?
In-Reply-To: <CAHZAEpcCyop26WSGimFaaj5=DfY+kGX8s0TYR+kCeDCK+xzcSA@mail.gmail.com>
References: <BANLkTinkdVGOvbk0LkOHUvu8navTQuNi8Q@mail.gmail.com>	<4E0BA730.7020608@rabbitmq.com>
	<CAHZAEpcCyop26WSGimFaaj5=DfY+kGX8s0TYR+kCeDCK+xzcSA@mail.gmail.com>
Message-ID: <4E14300A.3030901@rabbitmq.com>

On 06/07/11 01:28, Jason J. W. Williams wrote:
> What form will this take? Is it going to be a new flag, or will API
> access no longer required the "admin" flag?

API access never required the admin flag in =< 2.5.1, just that 
non-admins can only see their own stuff, and can't see broker-wide info 
at all.

The admin flag has been replaced by a "tags" field for users. Users can 
be given arbitrary tags within rabbitmq-server. rabbitmq-management then 
checks for the following tags:

"administrator" (do everything, same as admin before)
"monitoring" (look at everything, but only touch your own stuff)
"management" (limited access to mgmt, same as non-admin before)

Note also that by giving a user no tags you can lock them out of mgmt 
completely. This would be useful if (for example) you use secret queue 
names as capabilities.

> Also, any idea on the rev #?

Well, it's landed on default now, but you'll need default of everything. 
Not sure what all the revision numbers are.

Cheers, Simon
-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Wed Jul  6 12:17:46 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 06 Jul 2011 12:17:46 +0100
Subject: [rabbitmq-discuss] Message receive error
In-Reply-To: <CANCZXo52ejqGpUYVaxgny-vOD3Y+2F9funH0pZDruoRVMpsj0g@mail.gmail.com>
References: <CANCZXo7GD-Fd_okxCCJbQyh0yg_XNHr06nZJHSRSTvOuYBnQGA@mail.gmail.com>	<4E141A51.6010908@rabbitmq.com>
	<CANCZXo52ejqGpUYVaxgny-vOD3Y+2F9funH0pZDruoRVMpsj0g@mail.gmail.com>
Message-ID: <4E14445A.40905@rabbitmq.com>

Hi Alexander,

On 06/07/11 11:54, Alexander Kuleshov wrote:
> Hello,
> 
> I want to write in one queue and get data from another.
> 
> Thank you.

You can only publish to an exchange, not to a queue directly. The
bindings that are present on a broker and the message routing key
determine which queues a message go to. The 4th tutorial on
http://www.rabbitmq.com/getstarted.html has more details about routing.

The queue that you consume from must have been declared previously. If
you replace <<"test2">> with <<"test1">> in your code then the
subscription will succeed.



-Emile

From matt at miterdale.net  Wed Jul  6 11:36:06 2011
From: matt at miterdale.net (Matt Jones)
Date: Wed, 6 Jul 2011 03:36:06 -0700 (PDT)
Subject: [rabbitmq-discuss]  Use of RabbitMQ Client on Windows Phone 7
Message-ID: <32003856.post@talk.nabble.com>


Hi,

I'm keen on using RabbitMQ services on my Windows Phone 7 application. I'm
wondering what the best plan is - neither the .NET Client nor the WCF
binding compile against the WP7 framework.


From thomas.kant at gmail.com  Wed Jul  6 12:40:45 2011
From: thomas.kant at gmail.com (scorpiovn)
Date: Wed, 6 Jul 2011 04:40:45 -0700 (PDT)
Subject: [rabbitmq-discuss] Eureka Streams and RabbitMQ
Message-ID: <3d7ce03e-8288-4d8b-8ec5-73d8ad736771@17g2000prr.googlegroups.com>

I want to replace RabbitMQ to ActiveMQ in Eureka Streams.
I have to upgrade ES to spring 3.0.5.RELEASE?

+++
thomas.kant

From emile at rabbitmq.com  Wed Jul  6 12:56:39 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 06 Jul 2011 12:56:39 +0100
Subject: [rabbitmq-discuss] Use of RabbitMQ Client on Windows Phone 7
In-Reply-To: <32003856.post@talk.nabble.com>
References: <32003856.post@talk.nabble.com>
Message-ID: <4E144D77.8030200@rabbitmq.com>

Hi Matt,

On 06/07/11 11:36, Matt Jones wrote:
> 
> Hi,
> 
> I'm keen on using RabbitMQ services on my Windows Phone 7 application. I'm
> wondering what the best plan is - neither the .NET Client nor the WCF
> binding compile against the WP7 framework.
> 
> From where I'm standing the Client seems like it might be easier to make
> work. If nobody's done it already I will probably have a go at it and
> publish my work, but I wanted to ask here first to see if it was already in
> progress anywhere.
> 
> I'd be really interested in comments and experiences relating to this.

I made an attempt to compile the RabbitMQ .NET client on compact
framework last year, but didn't get very far:

http://markmail.org/message/q7kgadi25a72dhkd

Depending on your use case it might be possible to make use of the STOMP
adapter on the broker. STOMP is a simpler protocol and suited to clients
with resource constraints.


-Emile

From yaohui1984 at qq.com  Wed Jul  6 14:02:36 2011
From: yaohui1984 at qq.com (=?gbk?B?eWFvaHVp?=)
Date: Wed, 6 Jul 2011 21:02:36 +0800
Subject: [rabbitmq-discuss] =?gbk?q?Can_client_consume_a_number_of_message?=
 =?gbk?q?s_once=A3=BF?=
Message-ID: <tencent_33FDAB6210A08EEA1312EE9F@qq.com>

hi ,


Is there a mehod ( ex, in java client) that can consume a number of messages once , but ont one by one ?


thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110706/34dac9ea/attachment.htm>

From alexandru at rabbitmq.com  Wed Jul  6 14:17:52 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Wed, 6 Jul 2011 14:17:52 +0100
Subject: [rabbitmq-discuss]
 =?utf-8?q?Can_client_consume_a_number_of_messa?=
 =?utf-8?b?Z2VzIG9uY2XvvJ8=?=
In-Reply-To: <tencent_33FDAB6210A08EEA1312EE9F@qq.com>
References: <tencent_33FDAB6210A08EEA1312EE9F@qq.com>
Message-ID: <20110706131752.GA2899@dakota.eng.vmware.com>

Hi,

You probably want to consume (rather than get) messages and set
basic.qos.

Have a look at QueueingConsumer which handles getting multiple messages
from the server nicely and at basicQos which allows you to set how many
messages to get in advance.

Cheers,
Alex

On Wed, Jul 06, 2011 at 09:02:36PM +0800, yaohui wrote:
> hi ,
> 
> 
> Is there a mehod ( ex, in java client) that can consume a number of messages once , but ont one by one ?
> 
> 
> thanks.

> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From Lowell.Boggs at emc.com  Wed Jul  6 16:47:46 2011
From: Lowell.Boggs at emc.com (Lowell.Boggs at emc.com)
Date: Wed, 6 Jul 2011 11:47:46 -0400
Subject: [rabbitmq-discuss] rabbitmq-c amqp_exchange_declare missing
	parameter?
Message-ID: <8A1A883E3F171B42A81817DEC138352C1DB5209CD9@MX06A.corp.emc.com>

Hi,  I want to create an exchange in a program that is specific to each executable instance.  I assumed that there would be an "autoDelete" parameter to the amqp_exchange_declare function but there doesn't seem to be one.  Yet in the amqp_framing.h file there seems like there should be.   Near the top of the framing.h file, I see this:

#define AMQP_EXCHANGE_DECLARE_METHOD ((amqp_method_number_t) 0x0028000A) /* 40, 10; 2621450 */
typedef struct amqp_exchange_declare_t_ {
  uint16_t ticket;
  amqp_bytes_t exchange;
  amqp_bytes_t type;
  amqp_boolean_t passive;
  amqp_boolean_t durable;
  amqp_boolean_t auto_delete;   // <<=================
  amqp_boolean_t internal;
  amqp_boolean_t nowait;
  amqp_table_t arguments;
} amqp_exchange_declare_t;

But lower in the file when the function is actually defined, I see this:

RABBITMQ_EXPORT amqp_exchange_declare_ok_t *
amqp_exchange_declare(amqp_connection_state_t state,
                     amqp_channel_t channel,
                     amqp_bytes_t exchange,
                     amqp_bytes_t type,
                     amqp_boolean_t passive,
                     amqp_boolean_t durable,
                     amqp_table_t arguments);


Is this an oversite?  Is there an alternative way to declare an exchange that lets me pass the amqp_exchange_declare_t struct to some other function such that I can set the auto_delete flag?

Thanks,
   Lowell

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110706/4c8bc127/attachment.htm>

From harvey.robin at gmail.com  Wed Jul  6 19:24:15 2011
From: harvey.robin at gmail.com (Robin Harvey)
Date: Wed, 6 Jul 2011 19:24:15 +0100
Subject: [rabbitmq-discuss] Persistent connections with Amqphp
Message-ID: <CAOvN6FC-tC+gV_ysT54RaZR-3P5zeXHNNDE=mwOMNTnc1enMTw@mail.gmail.com>

Hi,

A couple of people recently asked about support for persistent connections,
after a bit of hacking around I've uploaded an update which has basic
persistent connection support:
https://github.com/BraveSirRobin/amqphp(check the 0.9.1 tag)


The implementation turned out to be fairly straightforward, I only had to
add the STREAM_CLIENT_PERSIST flag to the existing stream_socket_client()
call, so the changes weren't too invasive.  I've created a new "Connection"
object called PConnection, and set up a simple framework to persist amqp
connection parameters between web requests.  The amqp connection setup
process is only run the first time the PConnection is opened, so both the
Amqp "session" and TCP connection remain after the web request and are
re-used by subsequent requests to that process.  My plan is to add support
for persisting Channels as well, possibly by having API calls use
channel.flow to inform the broker during the web request wakeup / sleep
routines.

I'd be interested to hear what the RabbitMQ people think about the likely
behavior of PHP "persistent connections", which may include:

 * If the web server is restarted, all open client connections are dropped
without going through the amqp shutdown sequence, so you get lots of "closed
abruptly" errors in the log.
 * If a web server has no web requests to process then the persistent client
can't respond to any messages the broker sends; the client will "go quiet".

In case you don't know what PHP persistent connections are, they're
basically a socket re-use method for web servers, the idea is that the
socket remains open between web requests in order to avoid TCP setup /
teardown overheads on busy sites.

If you'd like to test this then check out the demo-multi-producer.php
script, I've run this inside a PHP-FPM / Nginx setup and it seems to work
fine.

Thanks,
--Robin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110706/2bd318c5/attachment.htm>

From jasonjwwilliams at gmail.com  Wed Jul  6 20:39:13 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Wed, 6 Jul 2011 13:39:13 -0600
Subject: [rabbitmq-discuss] RabbitMQ ACL suggestions?
In-Reply-To: <4E14300A.3030901@rabbitmq.com>
References: <BANLkTinkdVGOvbk0LkOHUvu8navTQuNi8Q@mail.gmail.com>
	<4E0BA730.7020608@rabbitmq.com>
	<CAHZAEpcCyop26WSGimFaaj5=DfY+kGX8s0TYR+kCeDCK+xzcSA@mail.gmail.com>
	<4E14300A.3030901@rabbitmq.com>
Message-ID: <CAHZAEpdUzxyB1SfqjB9Fhk4=BkLfzB9uYzNjYJqaH=nRNWA=6w@mail.gmail.com>

On Wed, Jul 6, 2011 at 3:51 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 06/07/11 01:28, Jason J. W. Williams wrote:
>
>> What form will this take? Is it going to be a new flag, or will API
>> access no longer required the "admin" flag?
>>
>
> API access never required the admin flag in =< 2.5.1, just that non-admins
> can only see their own stuff, and can't see broker-wide info at all.
>

Ah OK. Thanks for the clarification.


>
> The admin flag has been replaced by a "tags" field for users. Users can be
> given arbitrary tags within rabbitmq-server. rabbitmq-management then checks
> for the following tags:
>
> "administrator" (do everything, same as admin before)
> "monitoring" (look at everything, but only touch your own stuff)
> "management" (limited access to mgmt, same as non-admin before)
>
> Note also that by giving a user no tags you can lock them out of mgmt
> completely. This would be useful if (for example) you use secret queue names
> as capabilities.
>
>
This is very cool.


>
>  Also, any idea on the rev #?
>>
>  <https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>

OK, I'll keep an eye out for it in the next release. Updating the book's
chapter about the API. Thank you very much for your help.

-J
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110706/d3311cd8/attachment.htm>

From Lowell.Boggs at emc.com  Wed Jul  6 21:47:45 2011
From: Lowell.Boggs at emc.com (Lowell.Boggs at emc.com)
Date: Wed, 6 Jul 2011 16:47:45 -0400
Subject: [rabbitmq-discuss] rabbitmq-c: amqp_exchange_declare() always sets
	auto-delete to no
Message-ID: <8A1A883E3F171B42A81817DEC138352C1DB514B858@MX06A.corp.emc.com>

In rabbitmq-c:


Is there a reason that you cannot create an exchange with the auto_delete property == true?

Here is the source code for the amqp_exchange_declare function:

amqp_exchange_declare_ok_t *
amqp_exchange_declare(amqp_connection_state_t state, amqp_channel_t channel,
                      amqp_bytes_t exchange, amqp_bytes_t type,
                      amqp_boolean_t durable, amqp_table_t arguments)
{
  amqp_exchange_declare_t req;
  req.ticket = 0;
  req.exchange = exchange;
  req.type = type;
  req.passive = passive;
  req.durable = durable;
  req.auto_delete = 0;   // Why always no?
  req.internal = 0;
  req.nowait = 0;
  req.arguments = arguments;

  return amqp_simple_rpc_decoded(state, channel,
                                 AMQP_EXCHANGE_DECLARE_METHOD,
                                 AMQP_EXCHANGE_DECLARE_OK_METHOD,
                                 &req);
}
Is it safe for me as an application devloper to create a clone of this function that has the auto_delete property passed in?  Does the rabbitmq team have plans to change the way the underlying functions work?

Is a temporary exchange even a good idea?

I am trying to simplify the shutdown logic of a multi-threaded application.  I don't want to have to invent a way of signaling my worker threads to shut down.  Instead, I want to send them a message that they can read like normal but have a quick way of identifying that this is a shutdown command.  I am currently writing code for my threads that work like this:

void Thread()
{

    // create the connection
    // declare the primary command exchange
    // declare the qrimary queue
    // declare a "stop command" exchange
    // declare a "stop command" queue
    // bind everyone up and call basic_consume on the queues


    for(;;)
     {
        string exchangeName;
        string topicName;
        string messageBody;

         int error = readMessage(exchangeName, topicName, messageBody);

         if(error) break;

        if(exchangeName == "stop")
           break;

       processMesage(messageBody);

    }
}
Note that I am having multiple threads in multiple executables on multiple machines all reading from the same primary command exchange for performance and redundancy reasons -- so I can't really use the topic to indicate shutdown.  I might want to shutdown a given executable on a given host, not the entire system.

The above logic is working fine, but when I kill a process, I have to remember to delete the exchanges because they don't have an autoDelete flag.

Is there a better way to handle this shutdown logic?

Thanks,
Lowell


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110706/2d2621b3/attachment.htm>

From david at rabbitmq.com  Wed Jul  6 23:34:55 2011
From: david at rabbitmq.com (David Wragg)
Date: Wed, 06 Jul 2011 23:34:55 +0100
Subject: [rabbitmq-discuss] rabbitmq-c: amqp_exchange_declare() always
	sets auto-delete to no
In-Reply-To: <8A1A883E3F171B42A81817DEC138352C1DB514B858@MX06A.corp.emc.com>
	(Lowell Boggs's message of "Wed, 6 Jul 2011 16:47:45 -0400")
References: <8A1A883E3F171B42A81817DEC138352C1DB514B858@MX06A.corp.emc.com>
Message-ID: <yrv4cmxgrf374.fsf@dwragg.eng.vmware.com>

Hi Lowell,

<Lowell.Boggs at emc.com> writes:
> Is there a reason that you cannot create an exchange with the
> auto_delete property == true?

Auto-delete on exchanges is a AMQP 0-8 feature that is deprecated in
AMQP 0-9-1.  This is why the amqp_exchange_declare function does not
expose it (ever since it was converted to AMQP 0-9-1).

> Is it safe for me as an application devloper to create a clone of this
> function that has the auto_delete property passed in?  Does the
> rabbitmq team have plans to change the way the underlying functions
> work?

It is safe, but not a good idea.

rabbitmq-server still supports AMQP 0-8, including the auto-delete
property on exchanges.  So if you copy amqp_exchange_declare and add
that parameter, it will work today.  But at some point, rabbitmq-server
may drop AMQP 0-8 compatibility, and then it would stop working.

> Is a temporary exchange even a good idea?

Not really.

> I am trying to simplify the shutdown logic of a multi-threaded
> application.  I don't want to have to invent a way of signaling my
> worker threads to shut down.  Instead, I want to send them a message
> that they can read like normal but have a quick way of identifying
> that this is a shutdown command. I am currently writing code for my
> threads that work like this:
>
> void Thread()
> {
>
>     // create the connection
>     // declare the primary command exchange
>     // declare the qrimary queue
>     // declare a "stop command" exchange
>     // declare a "stop command" queue
>     // bind everyone up and call basic_consume on the queues
>
>
>     for(;;)
>      {
>         string exchangeName;
>         string topicName;
>         string messageBody;
>
>          int error = readMessage(exchangeName, topicName, messageBody);
>
>          if(error) break;
>
>         if(exchangeName == "stop")
>            break;
>
>        processMesage(messageBody);
>
>     }
> }
>
> Note that I am having multiple threads in multiple executables on
> multiple machines all reading from the same primary command exchange
> for performance and redundancy reasons -- so I can't really use the
> topic to indicate shutdown.  I might want to shutdown a given
> executable on a given host, not the entire system.
>
> The above logic is working fine, but when I kill a process, I have to
> remember to delete the exchanges because they don't have an autoDelete
> flag.
>
> Is there a better way to handle this shutdown logic?

It sounds like you have a hierarchy of threads, processes, and machines.
And you want to send command messages (including shutdown messages) to
the various levels in that hierarchy: To a thread, to all the threads
in a process, to all the threads in all processes on a host, and to all
threads everywhere.

You can accomplish this by declaring four exchanges. Let's call them
"per-thread", "per-process", "per-host" and "everything".

Each thread declares an auto-delete queue for itself, and binds this
queue to all four exchanges, but with different binding keys.

"per-thread" should be a direct exchange.  A thread binds its queue to
this exchange  with a binding key of the form "<host_id>.<process_id>.<thread_id>".

"per-process" should be a direct exchange.  A thread binds its queue to
this exchange with with a binding key of the form
"<host_id>.<process_id>".

"per-host" should be a direct exchange.  A thread binds its queue to
this exchange with with a binding key of the form "<host_id>"

Finally, "everything" can just be a fanout exchange (and so the binding
key is not used).

In order to send a command, use the exchange for the appropriate level
in the hierarchy, and the corresponding routing key.

Because all four exchanges are long lived, your code should not need to
delete any of them.

-- 
David Wragg
Staff Engineer, RabbitMQ
VMware, Inc.

From matthew at rabbitmq.com  Wed Jul  6 23:48:55 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 6 Jul 2011 23:48:55 +0100
Subject: [rabbitmq-discuss] rabbitmq-c: amqp_exchange_declare() always
 sets auto-delete to no
In-Reply-To: <yrv4cmxgrf374.fsf@dwragg.eng.vmware.com>
References: <8A1A883E3F171B42A81817DEC138352C1DB514B858@MX06A.corp.emc.com>
	<yrv4cmxgrf374.fsf@dwragg.eng.vmware.com>
Message-ID: <20110706224854.GA31761@rabbitmq.com>

On Wed, Jul 06, 2011 at 11:34:55PM +0100, David Wragg wrote:
> <Lowell.Boggs at emc.com> writes:
> > Is there a reason that you cannot create an exchange with the
> > auto_delete property == true?
> 
> Auto-delete on exchanges is a AMQP 0-8 feature that is deprecated in
> AMQP 0-9-1.  This is why the amqp_exchange_declare function does not
> expose it (ever since it was converted to AMQP 0-9-1).

We undeprecated it. RabbitMQ server supports auto-delete on exchanges
for 0-9-1 clients.

http://www.rabbitmq.com/releases/rabbitmq-java-client/v2.5.1/rabbitmq-java-client-javadoc-2.5.1/com/rabbitmq/client/Channel.html#exchangeDeclare(java.lang.String, java.lang.String, boolean, boolean, boolean, java.util.Map)

However, our 0-9-1 reference guide still leaves it as just a "reserved"
bit - http://www.rabbitmq.com/amqp-0-9-1-reference.html#class.exchange

I thought there was a bug about fixing this, but I can't find it. Our
json version fully undeprecates it:

http://hg.rabbitmq.com/rabbitmq-codegen/file/dfff9832e2d7/amqp-rabbitmq-0.9.1.json#l208

Whilst our xml version suggests it's still deprecated:

http://hg.rabbitmq.com/rabbitmq-dotnet-client/file/c3e4a852f309/docs/specs/amqp0-9-1.xml#l1270

What a mess!

Matthew

From mike.hadlow at 15below.com  Thu Jul  7 08:57:50 2011
From: mike.hadlow at 15below.com (Mike Hadlow)
Date: Thu, 7 Jul 2011 02:57:50 -0500
Subject: [rabbitmq-discuss] RabbitMQ .NET Client. Questions about
	QueueingBasicConsumer
Message-ID: <3095E7BFC8C0664E97D71288189F19C6177F26A673@AUSP01VMBX29.collaborationhost.net>

Hi All,

I'm writing a high-level "opinionated" .NET API on top of the supplied RabbitMQ .NET client that I've named EasyNetQ. It's on GitHub here:

https://github.com/mikehadlow/EasyNetQ

Currently I'm using the QueueingBasicConsumer and spinning up a single thread that sits in a loop doing SharedQueue.Dequeue(), see the code here:

https://github.com/mikehadlow/EasyNetQ/blob/master/EasyNetQ/QueueingConsumerFactory.cs

My question is about the scenario where messages are being pushed onto the queue by QueueingBasicConsumer faster than my client callbacks can handle them. Surely messages will build up in the SharedQueue until we run out of memory, crash, and lose all the queued messages? It would be much better if messages were pulled from RabbitMQ only as fast as the consumers can process them.

Does anyone have any experience with this scenario? What is the recommended subscription pattern? Should I be using BasicGet instead?

Many thanks
Mike

15below Limited: Company registered in England and Wales No 3945289
Registered Office: Lyndean House, 43-46 Queens Road, Brighton BN1 3XB, United Kingdom

15below Australia Pty Limited: ABN 25 132 716 379
Level 50, 120 Collins Street, Melbourne, Victoria 3000, Australia

Please think about the environment before printing this email.

************************************************************************
This email and any attachments may be confidential and/or legally privileged and are solely for the use of the intended recipient. If you have received this email in error please contact the sender. Any views or opinions expressed within this e-mail are solely those of the sender, and do not necessarily represent those of 15below unless otherwise specifically stated. Although 15below has taken every reasonable precaution to ensure that any attachment to this e-mail has been checked for viruses, it is strongly recommended that you carry out your own virus check before opening any attachment, as we cannot accept liability for any damage sustained as a result of software virus infection.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110707/80f5273d/attachment.htm>

From simone.busoli at gmail.com  Thu Jul  7 09:10:28 2011
From: simone.busoli at gmail.com (Simone Busoli)
Date: Thu, 7 Jul 2011 10:10:28 +0200
Subject: [rabbitmq-discuss] RabbitMQ .NET Client. Questions about
	QueueingBasicConsumer
In-Reply-To: <3095E7BFC8C0664E97D71288189F19C6177F26A673@AUSP01VMBX29.collaborationhost.net>
References: <3095E7BFC8C0664E97D71288189F19C6177F26A673@AUSP01VMBX29.collaborationhost.net>
Message-ID: <CAOn7oW_K-4+9dDdP56BbMCKW_B19ANTiyfPSDmL-K1TWPJAPqA@mail.gmail.com>

Hi Mike, I'm quite new to RabbitMQ but I think there are at least a couple
of things you can look into. One is QoS, which regulates how many messages a
consumer is being pushed in advance, setting it to 1 should mean that no
messages are sent to it before it can consume the one it has on its queue.
Second, you can look at ACKs, which let you cope with the scenario you are
describing, since failing to ack messages implies that they stay on the
queue and can be recovered later.
On Jul 7, 2011 9:58 AM, "Mike Hadlow" <mike.hadlow at 15below.com> wrote:
> Hi All,
>
> I'm writing a high-level "opinionated" .NET API on top of the supplied
RabbitMQ .NET client that I've named EasyNetQ. It's on GitHub here:
>
> https://github.com/mikehadlow/EasyNetQ
>
> Currently I'm using the QueueingBasicConsumer and spinning up a single
thread that sits in a loop doing SharedQueue.Dequeue(), see the code here:
>
>
https://github.com/mikehadlow/EasyNetQ/blob/master/EasyNetQ/QueueingConsumerFactory.cs
>
> My question is about the scenario where messages are being pushed onto the
queue by QueueingBasicConsumer faster than my client callbacks can handle
them. Surely messages will build up in the SharedQueue until we run out of
memory, crash, and lose all the queued messages? It would be much better if
messages were pulled from RabbitMQ only as fast as the consumers can process
them.
>
> Does anyone have any experience with this scenario? What is the
recommended subscription pattern? Should I be using BasicGet instead?
>
> Many thanks
> Mike
>
> 15below Limited: Company registered in England and Wales No 3945289
> Registered Office: Lyndean House, 43-46 Queens Road, Brighton BN1 3XB,
United Kingdom
>
> 15below Australia Pty Limited: ABN 25 132 716 379
> Level 50, 120 Collins Street, Melbourne, Victoria 3000, Australia
>
> Please think about the environment before printing this email.
>
> ************************************************************************
> This email and any attachments may be confidential and/or legally
privileged and are solely for the use of the intended recipient. If you have
received this email in error please contact the sender. Any views or
opinions expressed within this e-mail are solely those of the sender, and do
not necessarily represent those of 15below unless otherwise specifically
stated. Although 15below has taken every reasonable precaution to ensure
that any attachment to this e-mail has been checked for viruses, it is
strongly recommended that you carry out your own virus check before opening
any attachment, as we cannot accept liability for any damage sustained as a
result of software virus infection.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110707/1e6c32a3/attachment.htm>

From emile at rabbitmq.com  Thu Jul  7 09:54:26 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 07 Jul 2011 09:54:26 +0100
Subject: [rabbitmq-discuss] RabbitMQ .NET Client. Questions
	about	QueueingBasicConsumer
In-Reply-To: <CAOn7oW_K-4+9dDdP56BbMCKW_B19ANTiyfPSDmL-K1TWPJAPqA@mail.gmail.com>
References: <3095E7BFC8C0664E97D71288189F19C6177F26A673@AUSP01VMBX29.collaborationhost.net>
	<CAOn7oW_K-4+9dDdP56BbMCKW_B19ANTiyfPSDmL-K1TWPJAPqA@mail.gmail.com>
Message-ID: <4E157442.6080205@rabbitmq.com>


Hi Mike,

On 07/07/11 09:10, Simone Busoli wrote:
> Hi Mike, I'm quite new to RabbitMQ but I think there are at least a
> couple of things you can look into. One is QoS, which regulates how many
> messages a consumer is being pushed in advance, setting it to 1 should

As Simone says, setting QoS on the channel will prevent a consumer from
being flooded by messages.

You may also want to look at the Subscription class, another wrapper
around QueueingBasicConsumer:

http://hg.rabbitmq.com/rabbitmq-dotnet-client/file/default/projects/client/RabbitMQ.Client/src/client/messagepatterns/Subscription.cs


-Emile

From shrikant.hanagodimath at tecnotree.com  Thu Jul  7 05:56:43 2011
From: shrikant.hanagodimath at tecnotree.com (Shrikant Hanagodimath S)
Date: Thu, 7 Jul 2011 04:56:43 +0000
Subject: [rabbitmq-discuss] No response to basic.consume
Message-ID: <1B75B7BC57681140BA811D959ACC7A7202FC4D9F@BAMAIL2.nova.local>

Hi,

I am using RabbitMQ 2.2.0 and developing a C++ client to send and retrieve the messaged from Server.

The negotiated protocol version is 0.9.0, currently server is not responding to my basic.consume frame.

Could you please help me to get basic.consumeOK response from the server.

Regards
Shrikant
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110707/b6244b20/attachment.htm>

From emile at rabbitmq.com  Thu Jul  7 10:08:46 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 07 Jul 2011 10:08:46 +0100
Subject: [rabbitmq-discuss] No response to basic.consume
In-Reply-To: <1B75B7BC57681140BA811D959ACC7A7202FC4D9F@BAMAIL2.nova.local>
References: <1B75B7BC57681140BA811D959ACC7A7202FC4D9F@BAMAIL2.nova.local>
Message-ID: <4E15779E.9090804@rabbitmq.com>

Hi Shrikant,


On 07/07/11 05:56, Shrikant Hanagodimath S wrote:
> Hi,
> 
>  
> 
> I am using RabbitMQ 2.2.0 and developing a C++ client to send and
> retrieve the messaged from Server.

You should consider using the RabbitMQ extended XML, linked from here:

http://www.rabbitmq.com/amqp-0-9-1-quickref.html

> The negotiated protocol version is 0.9.0, currently server is not
> responding to my basic.consume frame.
> 
>  
> 
> Could you please help me to get basic.consumeOK response from the server.

Is there any relevant information in the logfile around the time when
you expect the basic.consume-ok?

Does the channel / connection remain active after you send basic.consume ?

If you are dealing with a potential framing problem then connecting via
the tracer tool will yield useful information:

http://www.rabbitmq.com/javadoc/com/rabbitmq/tools/Tracer.html



-Emile

From michael.s.klishin at gmail.com  Thu Jul  7 10:11:34 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 7 Jul 2011 13:11:34 +0400
Subject: [rabbitmq-discuss] No response to basic.consume
In-Reply-To: <1B75B7BC57681140BA811D959ACC7A7202FC4D9F@BAMAIL2.nova.local>
References: <1B75B7BC57681140BA811D959ACC7A7202FC4D9F@BAMAIL2.nova.local>
Message-ID: <062C0811B6924D7F8CBFEB6864F1AEA7@gmail.com>

Shrikant Hanagodimath S escribi?:
> The negotiated protocol version is 0.9.0, currently server is not responding to my basic.consume frame.
> 
> Could you please help me to get basic.consumeOK response from the server.
First thing to check is if you are setting noack to true. If you do, you are telling broker to not send you basic.consume-ok back.


MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin








From matthias at rabbitmq.com  Thu Jul  7 10:14:20 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 07 Jul 2011 10:14:20 +0100
Subject: [rabbitmq-discuss] No response to basic.consume
In-Reply-To: <062C0811B6924D7F8CBFEB6864F1AEA7@gmail.com>
References: <1B75B7BC57681140BA811D959ACC7A7202FC4D9F@BAMAIL2.nova.local>
	<062C0811B6924D7F8CBFEB6864F1AEA7@gmail.com>
Message-ID: <4E1578EC.5030904@rabbitmq.com>

On 07/07/11 10:11, Michael Klishin wrote:
> Shrikant Hanagodimath S escribi?:
>> The negotiated protocol version is 0.9.0, currently server is not
>> responding to my basic.consume frame.
>>
>> Could you please help me to get basic.consumeOK response from the
>> server.
> First thing to check is if you are setting noack to true. If you do,
> you are telling broker to not send you basic.consume-ok back.

You mean 'nowait'.

Matthias.

From michael.justin at gmx.net  Thu Jul  7 10:14:30 2011
From: michael.justin at gmx.net (Michael Justin)
Date: Thu, 07 Jul 2011 11:14:30 +0200
Subject: [rabbitmq-discuss] STOMP: can a client subscribe to non-existing
 destination and immediately send a message
Message-ID: <iv3tdp$im2$1@dough.gmane.org>

Hello,

I have read somewhere (but forgot where) that clients using the RabbitMQ 
Stomp plugin could experience message loss if the client immediately 
sends a message after subscribing to a non-existent destination. Is this 
correct or was it valid for older versions only?

Many thanks in advance
Michael Justin


From mike.hadlow at 15below.com  Thu Jul  7 10:18:38 2011
From: mike.hadlow at 15below.com (Mike Hadlow)
Date: Thu, 7 Jul 2011 04:18:38 -0500
Subject: [rabbitmq-discuss] RabbitMQ .NET Client. Questions
	about	QueueingBasicConsumer
In-Reply-To: <4E157442.6080205@rabbitmq.com>
References: <3095E7BFC8C0664E97D71288189F19C6177F26A673@AUSP01VMBX29.collaborationhost.net>
	<CAOn7oW_K-4+9dDdP56BbMCKW_B19ANTiyfPSDmL-K1TWPJAPqA@mail.gmail.com>
	<4E157442.6080205@rabbitmq.com>
Message-ID: <3095E7BFC8C0664E97D71288189F19C6177F26A67C@AUSP01VMBX29.collaborationhost.net>

Thanks Emile, Simone.

I'll check out the channel QoS. The main reason I'm writing my own wrapper around QueueingBasicConsumer is because I'm multiplexing multiple subscriptions on a single consumer loop. I want the user of the API to simply call:

Subscribe<MyMessage>(MsgHandler);

And then have the API handle all the details :)

Mike

-----Original Message-----
From: Emile Joubert [mailto:emile at rabbitmq.com]
Sent: 07 July 2011 09:54
To: Mike Hadlow
Cc: Simone Busoli; rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] RabbitMQ .NET Client. Questions about QueueingBasicConsumer


Hi Mike,

On 07/07/11 09:10, Simone Busoli wrote:
> Hi Mike, I'm quite new to RabbitMQ but I think there are at least a
> couple of things you can look into. One is QoS, which regulates how
> many messages a consumer is being pushed in advance, setting it to 1
> should

As Simone says, setting QoS on the channel will prevent a consumer from being flooded by messages.

You may also want to look at the Subscription class, another wrapper around QueueingBasicConsumer:

http://hg.rabbitmq.com/rabbitmq-dotnet-client/file/default/projects/client/RabbitMQ.Client/src/client/messagepatterns/Subscription.cs


-Emile

 15below Limited: Company registered in England and Wales No 3945289
Registered Office: Lyndean House, 43-46 Queens Road, Brighton BN1 3XB, United Kingdom

15below Australia Pty Limited: ABN 25 132 716 379
Level 50, 120 Collins Street, Melbourne, Victoria 3000, Australia

Please think about the environment before printing this email.

************************************************************************
This email and any attachments may be confidential and/or legally privileged and are solely for the use of the intended recipient.  If you have received this email in error please contact the sender.  Any views or opinions expressed within this e-mail are solely those of the sender, and do not necessarily represent those of 15below unless otherwise specifically stated.  Although 15below has taken every reasonable precaution to ensure that any attachment to this e-mail has been checked for viruses, it is strongly recommended that you carry out your own virus check before opening any attachment, as we cannot accept liability for any damage sustained as a result of software virus infection.

From shrikant.hanagodimath at tecnotree.com  Thu Jul  7 10:18:37 2011
From: shrikant.hanagodimath at tecnotree.com (Shrikant Hanagodimath S)
Date: Thu, 7 Jul 2011 09:18:37 +0000
Subject: [rabbitmq-discuss] No response to basic.consume
In-Reply-To: <4E1578EC.5030904@rabbitmq.com>
References: <1B75B7BC57681140BA811D959ACC7A7202FC4D9F@BAMAIL2.nova.local>
	<062C0811B6924D7F8CBFEB6864F1AEA7@gmail.com>
	<4E1578EC.5030904@rabbitmq.com>
Message-ID: <1B75B7BC57681140BA811D959ACC7A7202FC6E47@BAMAIL2.nova.local>

Hi,

I had made a mistake while forming the basic.consume frame.
After careful debugging I've fixed it. :)

Thanks for your replies and support.

Regards
Shrikant 

-----Original Message-----
From: Matthias Radestock [mailto:matthias at rabbitmq.com] 
Sent: Thursday, July 07, 2011 2:44 PM
To: Michael Klishin
Cc: Shrikant Hanagodimath S; rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] No response to basic.consume

On 07/07/11 10:11, Michael Klishin wrote:
> Shrikant Hanagodimath S escribi?:
>> The negotiated protocol version is 0.9.0, currently server is not
>> responding to my basic.consume frame.
>>
>> Could you please help me to get basic.consumeOK response from the
>> server.
> First thing to check is if you are setting noack to true. If you do,
> you are telling broker to not send you basic.consume-ok back.

You mean 'nowait'.

Matthias.

From michael.s.klishin at gmail.com  Thu Jul  7 10:51:48 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 7 Jul 2011 13:51:48 +0400
Subject: [rabbitmq-discuss] No response to basic.consume
In-Reply-To: <4E1578EC.5030904@rabbitmq.com>
References: <1B75B7BC57681140BA811D959ACC7A7202FC4D9F@BAMAIL2.nova.local>
	<062C0811B6924D7F8CBFEB6864F1AEA7@gmail.com>
	<4E1578EC.5030904@rabbitmq.com>
Message-ID: <E9CC3960B57947A3AFD5CD52C3503E5F@gmail.com>

Matthias Radestock escribi?:
> You mean 'nowait'.
Exactly. Thanks for the correction.


MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin



From Simone.Busoli at ferrari.com  Thu Jul  7 10:57:56 2011
From: Simone.Busoli at ferrari.com (Busoli, Simone)
Date: Thu, 7 Jul 2011 09:57:56 +0000
Subject: [rabbitmq-discuss] RabbitMQ .NET Client.
	Questions	aboutQueueingBasicConsumer
In-Reply-To: <3095E7BFC8C0664E97D71288189F19C6177F26A67C@AUSP01VMBX29.collaborationhost.net>
References: <3095E7BFC8C0664E97D71288189F19C6177F26A673@AUSP01VMBX29.collaborationhost.net><CAOn7oW_K-4+9dDdP56BbMCKW_B19ANTiyfPSDmL-K1TWPJAPqA@mail.gmail.com><4E157442.6080205@rabbitmq.com>
	<3095E7BFC8C0664E97D71288189F19C6177F26A67C@AUSP01VMBX29.collaborationhost.net>
Message-ID: <88E590DC4586974D825FC82AE798294E52015630@GSVCLU03.ges.ferlan.it>

Hi Mike, building a high level API on top of RabbitMQ is something I've been thinking about as well, and I looked at your OS project too. The issue I've been facing with every abstraction I could think of is that somewhere you have to make some assumptions - for example about durability, exchange types, how you handle errors and so on - therefore I think it's quite hard to come up with something which works in most scenarios. The same consideration applies to the supplied WCF bindings as well.

_______________________________________________________________ 
Simone Busoli
Direzione risorse umane e segreteria generale - Sistemi informativi gestione sportiva 
Collaboratore
Ferrari S.p.A.???? Via Ascari 55/57, 41053, Maranello (MO); Italy
T?(+39) 0536-949.850
E simone.busoli at ferrari.com  www.ferrari.com 

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Mike Hadlow
Sent: Thursday, July 07, 2011 11:19 AM
To: Emile Joubert
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] RabbitMQ .NET Client. Questions about QueueingBasicConsumer

Thanks Emile, Simone.

I'll check out the channel QoS. The main reason I'm writing my own wrapper around QueueingBasicConsumer is because I'm multiplexing multiple subscriptions on a single consumer loop. I want the user of the API to simply call:

Subscribe<MyMessage>(MsgHandler);

And then have the API handle all the details :)

Mike

-----Original Message-----
From: Emile Joubert [mailto:emile at rabbitmq.com]
Sent: 07 July 2011 09:54
To: Mike Hadlow
Cc: Simone Busoli; rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] RabbitMQ .NET Client. Questions about QueueingBasicConsumer


Hi Mike,

On 07/07/11 09:10, Simone Busoli wrote:
> Hi Mike, I'm quite new to RabbitMQ but I think there are at least a 
> couple of things you can look into. One is QoS, which regulates how 
> many messages a consumer is being pushed in advance, setting it to 1 
> should

As Simone says, setting QoS on the channel will prevent a consumer from being flooded by messages.

You may also want to look at the Subscription class, another wrapper around QueueingBasicConsumer:

http://hg.rabbitmq.com/rabbitmq-dotnet-client/file/default/projects/client/RabbitMQ.Client/src/client/messagepatterns/Subscription.cs


-Emile

 15below Limited: Company registered in England and Wales No 3945289 Registered Office: Lyndean House, 43-46 Queens Road, Brighton BN1 3XB, United Kingdom

15below Australia Pty Limited: ABN 25 132 716 379 Level 50, 120 Collins Street, Melbourne, Victoria 3000, Australia

Please think about the environment before printing this email.

************************************************************************
This email and any attachments may be confidential and/or legally privileged and are solely for the use of the intended recipient.  If you have received this email in error please contact the sender.  Any views or opinions expressed within this e-mail are solely those of the sender, and do not necessarily represent those of 15below unless otherwise specifically stated.  Although 15below has taken every reasonable precaution to ensure that any attachment to this e-mail has been checked for viruses, it is strongly recommended that you carry out your own virus check before opening any attachment, as we cannot accept liability for any damage sustained as a result of software virus infection.
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

_________________________________________________________________________________________________________________
Questo messaggio ? da intendersi esclusivamente ad uso del destinatario e pu? contenere informazioni che sono di natura privilegiata, confidenziale
o non divulgabile secondo le leggi vigenti. Se il lettore del presente messaggio non ? il destinatario designato, o il dipendente/agente responsabile
per la consegna del messaggio al destinatario designato, si informa che ogni disseminazione, distribuzione o copiatura di questa comunicazione ? 
strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
immediatamente a mezzo e-mail di risposta e successivamente di procedere alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
_________________________________________________________________________________________________________________
This message is intended only for the use of the addressee and may contain information that is privileged, confidential and exempt from 
disclosure under applicable law. If the reader of this message is not the intended recipient, or the employee or agent responsible for delivering the 
message to the intended recipient, you are hereby notified that any dissemination, distribution or copying of this communication is strictly 
prohibited. If you have received this e-mail in error, please notify us immediately by return e-mail and delete this e-mail and all attachments from 
your system.
_________________________________________________________________________________________________________________


From rob at rabbitmq.com  Thu Jul  7 11:31:29 2011
From: rob at rabbitmq.com (Rob Harrop)
Date: Thu, 7 Jul 2011 11:31:29 +0100
Subject: [rabbitmq-discuss] STOMP: can a client subscribe to
	non-existing destination and immediately send a message
In-Reply-To: <iv3tdp$im2$1@dough.gmane.org>
References: <iv3tdp$im2$1@dough.gmane.org>
Message-ID: <CA826398-36FB-445F-886B-32A8504D67FB@rabbitmq.com>

Michael,

In this case, you are advised to use receipts if you want guarantees of the ordering across subscribe and send.

You can send your SUBSCRIBE frame, wait for it's receipt and then issue the SEND.

Rob



On 7 Jul 2011, at 10:14, Michael Justin <michael.justin at gmx.net> wrote:

> Hello,
> 
> I have read somewhere (but forgot where) that clients using the RabbitMQ Stomp plugin could experience message loss if the client immediately sends a message after subscribing to a non-existent destination. Is this correct or was it valid for older versions only?
> 
> Many thanks in advance
> Michael Justin
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From michael.justin at gmx.net  Thu Jul  7 11:54:31 2011
From: michael.justin at gmx.net (Michael Justin)
Date: Thu, 07 Jul 2011 12:54:31 +0200
Subject: [rabbitmq-discuss] STOMP: can a client subscribe to
 non-existing destination and immediately send a message
In-Reply-To: <CA826398-36FB-445F-886B-32A8504D67FB@rabbitmq.com>
References: <iv3tdp$im2$1@dough.gmane.org>
	<CA826398-36FB-445F-886B-32A8504D67FB@rabbitmq.com>
Message-ID: <iv4399$ndv$1@dough.gmane.org>

Am 07.07.2011 12:31, Rob Harrop wrote:

> In this case, you are advised to use receipts if you want guarantees of the ordering across subscribe and send.
>
> You can send your SUBSCRIBE frame, wait for it's receipt and then issue the SEND.
>

Hi Rob,

Thanks for confirming! Is it guaranteed that the server will send the 
receipt first before sending any pending messages to a subscribed 
client? Or is this frame sequence possible:

client: SUBSCRIBE
server: MESSAGE
server: RECEIPT

Michael






From mike.hadlow at 15below.com  Thu Jul  7 12:00:58 2011
From: mike.hadlow at 15below.com (Mike Hadlow)
Date: Thu, 7 Jul 2011 06:00:58 -0500
Subject: [rabbitmq-discuss] RabbitMQ .NET Client.
	Questions	aboutQueueingBasicConsumer
In-Reply-To: <88E590DC4586974D825FC82AE798294E52015630@GSVCLU03.ges.ferlan.it>
References: <3095E7BFC8C0664E97D71288189F19C6177F26A673@AUSP01VMBX29.collaborationhost.net><CAOn7oW_K-4+9dDdP56BbMCKW_B19ANTiyfPSDmL-K1TWPJAPqA@mail.gmail.com><4E157442.6080205@rabbitmq.com>
	<3095E7BFC8C0664E97D71288189F19C6177F26A67C@AUSP01VMBX29.collaborationhost.net>
	<88E590DC4586974D825FC82AE798294E52015630@GSVCLU03.ges.ferlan.it>
Message-ID: <3095E7BFC8C0664E97D71288189F19C6177F26A685@AUSP01VMBX29.collaborationhost.net>

Hi Simone,

I agree. You can either have flexibility or you can have simplicity. My aim is to provide an 'opinionated' API that forces you to use RabbitMQ in a very specific way. Of course this won't be for everyone, but for a large number of people it will give them a pre-built toolkit that they can just start using with a couple of lines of code.

Having said that I don't see a problem with providing pluggable strategies for things like durability and error handling. EasyNetQ could provide sensible defaults out-of-the-box that would allow a user to get up and running fast, but then have some configuration that allows you to choose throughput over durability and different error handling options.

Mike


-----Original Message-----
From: Busoli, Simone [mailto:Simone.Busoli at ferrari.com]
Sent: 07 July 2011 10:58
To: Mike Hadlow; Emile Joubert
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: RE: [rabbitmq-discuss] RabbitMQ .NET Client. Questions aboutQueueingBasicConsumer

Hi Mike, building a high level API on top of RabbitMQ is something I've been thinking about as well, and I looked at your OS project too. The issue I've been facing with every abstraction I could think of is that somewhere you have to make some assumptions - for example about durability, exchange types, how you handle errors and so on - therefore I think it's quite hard to come up with something which works in most scenarios. The same consideration applies to the supplied WCF bindings as well.

_______________________________________________________________
Simone Busoli
Direzione risorse umane e segreteria generale - Sistemi informativi gestione sportiva Collaboratore Ferrari S.p.A.     Via Ascari 55/57, 41053, Maranello (MO); Italy T (+39) 0536-949.850 E simone.busoli at ferrari.com  www.ferrari.com

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Mike Hadlow
Sent: Thursday, July 07, 2011 11:19 AM
To: Emile Joubert
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] RabbitMQ .NET Client. Questions about QueueingBasicConsumer

Thanks Emile, Simone.

I'll check out the channel QoS. The main reason I'm writing my own wrapper around QueueingBasicConsumer is because I'm multiplexing multiple subscriptions on a single consumer loop. I want the user of the API to simply call:

Subscribe<MyMessage>(MsgHandler);

And then have the API handle all the details :)

Mike

-----Original Message-----
From: Emile Joubert [mailto:emile at rabbitmq.com]
Sent: 07 July 2011 09:54
To: Mike Hadlow
Cc: Simone Busoli; rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] RabbitMQ .NET Client. Questions about QueueingBasicConsumer


Hi Mike,

On 07/07/11 09:10, Simone Busoli wrote:
> Hi Mike, I'm quite new to RabbitMQ but I think there are at least a
> couple of things you can look into. One is QoS, which regulates how
> many messages a consumer is being pushed in advance, setting it to 1
> should

As Simone says, setting QoS on the channel will prevent a consumer from being flooded by messages.

You may also want to look at the Subscription class, another wrapper around QueueingBasicConsumer:

http://hg.rabbitmq.com/rabbitmq-dotnet-client/file/default/projects/client/RabbitMQ.Client/src/client/messagepatterns/Subscription.cs


-Emile

 15below Limited: Company registered in England and Wales No 3945289 Registered Office: Lyndean House, 43-46 Queens Road, Brighton BN1 3XB, United Kingdom

15below Australia Pty Limited: ABN 25 132 716 379 Level 50, 120 Collins Street, Melbourne, Victoria 3000, Australia

Please think about the environment before printing this email.

************************************************************************
This email and any attachments may be confidential and/or legally privileged and are solely for the use of the intended recipient.  If you have received this email in error please contact the sender.  Any views or opinions expressed within this e-mail are solely those of the sender, and do not necessarily represent those of 15below unless otherwise specifically stated.  Although 15below has taken every reasonable precaution to ensure that any attachment to this e-mail has been checked for viruses, it is strongly recommended that you carry out your own virus check before opening any attachment, as we cannot accept liability for any damage sustained as a result of software virus infection.
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

_________________________________________________________________________________________________________________
Questo messaggio ? da intendersi esclusivamente ad uso del destinatario e pu? contenere informazioni che sono di natura privilegiata, confidenziale o non divulgabile secondo le leggi vigenti. Se il lettore del presente messaggio non ? il destinatario designato, o il dipendente/agente responsabile per la consegna del messaggio al destinatario designato, si informa che ogni disseminazione, distribuzione o copiatura di questa comunicazione ? strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo immediatamente a mezzo e-mail di risposta e successivamente di procedere alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
_________________________________________________________________________________________________________________
This message is intended only for the use of the addressee and may contain information that is privileged, confidential and exempt from disclosure under applicable law. If the reader of this message is not the intended recipient, or the employee or agent responsible for delivering the message to the intended recipient, you are hereby notified that any dissemination, distribution or copying of this communication is strictly prohibited. If you have received this e-mail in error, please notify us immediately by return e-mail and delete this e-mail and all attachments from your system.
_________________________________________________________________________________________________________________


 15below Limited: Company registered in England and Wales No 3945289
Registered Office: Lyndean House, 43-46 Queens Road, Brighton BN1 3XB, United Kingdom

15below Australia Pty Limited: ABN 25 132 716 379
Level 50, 120 Collins Street, Melbourne, Victoria 3000, Australia

Please think about the environment before printing this email.

************************************************************************
This email and any attachments may be confidential and/or legally privileged and are solely for the use of the intended recipient.  If you have received this email in error please contact the sender.  Any views or opinions expressed within this e-mail are solely those of the sender, and do not necessarily represent those of 15below unless otherwise specifically stated.  Although 15below has taken every reasonable precaution to ensure that any attachment to this e-mail has been checked for viruses, it is strongly recommended that you carry out your own virus check before opening any attachment, as we cannot accept liability for any damage sustained as a result of software virus infection.

From dbecker at cpicorp.com  Thu Jul  7 12:54:18 2011
From: dbecker at cpicorp.com (Derek Chen-Becker)
Date: Thu, 07 Jul 2011 06:54:18 -0500
Subject: [rabbitmq-discuss] FW: rabbit upgrade - liftweb amqp problems
In-Reply-To: <CACOPnvdHK5onyqk9Bh1YSHnaR=6cjNfhnVE4_B+BzCxAdaBq=Q@mail.gmail.com>
References: <676E1597FDBED54694CBA16B69DE71C30336AD@PTGMAIL02v.protegra.com>
	<CACOPnvdHK5onyqk9Bh1YSHnaR=6cjNfhnVE4_B+BzCxAdaBq=Q@mail.gmail.com>
Message-ID: <4E159E6A.8080806@cpicorp.com>

On 06/29/2011 10:47 AM, Alexis Richardson wrote:
> Jason
> 
> I suggest you also ask the Lift folks to update...

Jason,
    I'm one of the Lift maintainers. Please open a ticket and I'll work
on updating the module to use the latest RabbitMQ Java client.

Derek

From mike.hadlow at 15below.com  Thu Jul  7 13:11:10 2011
From: mike.hadlow at 15below.com (Mike Hadlow)
Date: Thu, 7 Jul 2011 07:11:10 -0500
Subject: [rabbitmq-discuss] RabbitMQ .NET
	Client.	Questions	aboutQueueingBasicConsumer
In-Reply-To: <3095E7BFC8C0664E97D71288189F19C6177F26A685@AUSP01VMBX29.collaborationhost.net>
References: <3095E7BFC8C0664E97D71288189F19C6177F26A673@AUSP01VMBX29.collaborationhost.net><CAOn7oW_K-4+9dDdP56BbMCKW_B19ANTiyfPSDmL-K1TWPJAPqA@mail.gmail.com><4E157442.6080205@rabbitmq.com>
	<3095E7BFC8C0664E97D71288189F19C6177F26A67C@AUSP01VMBX29.collaborationhost.net>
	<88E590DC4586974D825FC82AE798294E52015630@GSVCLU03.ges.ferlan.it>
	<3095E7BFC8C0664E97D71288189F19C6177F26A685@AUSP01VMBX29.collaborationhost.net>
Message-ID: <3095E7BFC8C0664E97D71288189F19C6177F26A69B@AUSP01VMBX29.collaborationhost.net>

A little investigation into the relationship with BasicQoS prefetchCount, QueueingBasicConsumer and BasicAck shows the following behaviour:

1. The number of messages in the SharedQueue (the queue maintained by the .NET client) can be controlled by BasicQoS prefetchCount. This solves my concerns about the in-memory client side queue causing an OOM exception.
2. Messages delivered, but not BasicAck'd remain on the queue (although some re-ordering happens). This solves my concern about losing messages if my client application suddenly dies.

I guess it's simply a performance tuning issue to determine the best size for prefetchCount.

The code I've been playing with to test this is here:
https://github.com/mikehadlow/EasyNetQ/blob/master/Mike.AmqpSpike/AckNackSpike.cs

Mike

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Mike Hadlow
Sent: 07 July 2011 12:01
To: Busoli, Simone; Emile Joubert
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] RabbitMQ .NET Client. Questions aboutQueueingBasicConsumer

Hi Simone,

I agree. You can either have flexibility or you can have simplicity. My aim is to provide an 'opinionated' API that forces you to use RabbitMQ in a very specific way. Of course this won't be for everyone, but for a large number of people it will give them a pre-built toolkit that they can just start using with a couple of lines of code.

Having said that I don't see a problem with providing pluggable strategies for things like durability and error handling. EasyNetQ could provide sensible defaults out-of-the-box that would allow a user to get up and running fast, but then have some configuration that allows you to choose throughput over durability and different error handling options.

Mike


-----Original Message-----
From: Busoli, Simone [mailto:Simone.Busoli at ferrari.com]
Sent: 07 July 2011 10:58
To: Mike Hadlow; Emile Joubert
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: RE: [rabbitmq-discuss] RabbitMQ .NET Client. Questions aboutQueueingBasicConsumer

Hi Mike, building a high level API on top of RabbitMQ is something I've been thinking about as well, and I looked at your OS project too. The issue I've been facing with every abstraction I could think of is that somewhere you have to make some assumptions - for example about durability, exchange types, how you handle errors and so on - therefore I think it's quite hard to come up with something which works in most scenarios. The same consideration applies to the supplied WCF bindings as well.

_______________________________________________________________
Simone Busoli
Direzione risorse umane e segreteria generale - Sistemi informativi gestione sportiva Collaboratore Ferrari S.p.A.     Via Ascari 55/57, 41053, Maranello (MO); Italy T (+39) 0536-949.850 E simone.busoli at ferrari.com  www.ferrari.com

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Mike Hadlow
Sent: Thursday, July 07, 2011 11:19 AM
To: Emile Joubert
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] RabbitMQ .NET Client. Questions about QueueingBasicConsumer

Thanks Emile, Simone.

I'll check out the channel QoS. The main reason I'm writing my own wrapper around QueueingBasicConsumer is because I'm multiplexing multiple subscriptions on a single consumer loop. I want the user of the API to simply call:

Subscribe<MyMessage>(MsgHandler);

And then have the API handle all the details :)

Mike

-----Original Message-----
From: Emile Joubert [mailto:emile at rabbitmq.com]
Sent: 07 July 2011 09:54
To: Mike Hadlow
Cc: Simone Busoli; rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] RabbitMQ .NET Client. Questions about QueueingBasicConsumer


Hi Mike,

On 07/07/11 09:10, Simone Busoli wrote:
> Hi Mike, I'm quite new to RabbitMQ but I think there are at least a
> couple of things you can look into. One is QoS, which regulates how
> many messages a consumer is being pushed in advance, setting it to 1
> should

As Simone says, setting QoS on the channel will prevent a consumer from being flooded by messages.

You may also want to look at the Subscription class, another wrapper around QueueingBasicConsumer:

http://hg.rabbitmq.com/rabbitmq-dotnet-client/file/default/projects/client/RabbitMQ.Client/src/client/messagepatterns/Subscription.cs


-Emile

 15below Limited: Company registered in England and Wales No 3945289 Registered Office: Lyndean House, 43-46 Queens Road, Brighton BN1 3XB, United Kingdom

15below Australia Pty Limited: ABN 25 132 716 379 Level 50, 120 Collins Street, Melbourne, Victoria 3000, Australia

Please think about the environment before printing this email.

************************************************************************
This email and any attachments may be confidential and/or legally privileged and are solely for the use of the intended recipient.  If you have received this email in error please contact the sender.  Any views or opinions expressed within this e-mail are solely those of the sender, and do not necessarily represent those of 15below unless otherwise specifically stated.  Although 15below has taken every reasonable precaution to ensure that any attachment to this e-mail has been checked for viruses, it is strongly recommended that you carry out your own virus check before opening any attachment, as we cannot accept liability for any damage sustained as a result of software virus infection.
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

_________________________________________________________________________________________________________________
Questo messaggio ? da intendersi esclusivamente ad uso del destinatario e pu? contenere informazioni che sono di natura privilegiata, confidenziale o non divulgabile secondo le leggi vigenti. Se il lettore del presente messaggio non ? il destinatario designato, o il dipendente/agente responsabile per la consegna del messaggio al destinatario designato, si informa che ogni disseminazione, distribuzione o copiatura di questa comunicazione ? strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo immediatamente a mezzo e-mail di risposta e successivamente di procedere alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
_________________________________________________________________________________________________________________
This message is intended only for the use of the addressee and may contain information that is privileged, confidential and exempt from disclosure under applicable law. If the reader of this message is not the intended recipient, or the employee or agent responsible for delivering the message to the intended recipient, you are hereby notified that any dissemination, distribution or copying of this communication is strictly prohibited. If you have received this e-mail in error, please notify us immediately by return e-mail and delete this e-mail and all attachments from your system.
_________________________________________________________________________________________________________________


 15below Limited: Company registered in England and Wales No 3945289 Registered Office: Lyndean House, 43-46 Queens Road, Brighton BN1 3XB, United Kingdom

15below Australia Pty Limited: ABN 25 132 716 379 Level 50, 120 Collins Street, Melbourne, Victoria 3000, Australia

Please think about the environment before printing this email.

************************************************************************
This email and any attachments may be confidential and/or legally privileged and are solely for the use of the intended recipient.  If you have received this email in error please contact the sender.  Any views or opinions expressed within this e-mail are solely those of the sender, and do not necessarily represent those of 15below unless otherwise specifically stated.  Although 15below has taken every reasonable precaution to ensure that any attachment to this e-mail has been checked for viruses, it is strongly recommended that you carry out your own virus check before opening any attachment, as we cannot accept liability for any damage sustained as a result of software virus infection.
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

 15below Limited: Company registered in England and Wales No 3945289
Registered Office: Lyndean House, 43-46 Queens Road, Brighton BN1 3XB, United Kingdom

15below Australia Pty Limited: ABN 25 132 716 379
Level 50, 120 Collins Street, Melbourne, Victoria 3000, Australia

Please think about the environment before printing this email.

************************************************************************
This email and any attachments may be confidential and/or legally privileged and are solely for the use of the intended recipient.  If you have received this email in error please contact the sender.  Any views or opinions expressed within this e-mail are solely those of the sender, and do not necessarily represent those of 15below unless otherwise specifically stated.  Although 15below has taken every reasonable precaution to ensure that any attachment to this e-mail has been checked for viruses, it is strongly recommended that you carry out your own virus check before opening any attachment, as we cannot accept liability for any damage sustained as a result of software virus infection.

From rob at rabbitmq.com  Thu Jul  7 13:23:31 2011
From: rob at rabbitmq.com (Rob Harrop)
Date: Thu, 7 Jul 2011 13:23:31 +0100
Subject: [rabbitmq-discuss] STOMP: can a client subscribe to
	non-existing destination and immediately send a message
In-Reply-To: <iv4399$ndv$1@dough.gmane.org>
References: <iv3tdp$im2$1@dough.gmane.org>
	<CA826398-36FB-445F-886B-32A8504D67FB@rabbitmq.com>
	<iv4399$ndv$1@dough.gmane.org>
Message-ID: <A7FD38B4-1BFA-45CF-BAD4-4176457E69AE@rabbitmq.com>

It is guaranteed that you'll see the RECEIPT before the MESSAGE frame


On 7 Jul 2011, at 11:54, Michael Justin <michael.justin at gmx.net> wrote:

> Am 07.07.2011 12:31, Rob Harrop wrote:
> 
>> In this case, you are advised to use receipts if you want guarantees of the ordering across subscribe and send.
>> 
>> You can send your SUBSCRIBE frame, wait for it's receipt and then issue the SEND.
>> 
> 
> Hi Rob,
> 
> Thanks for confirming! Is it guaranteed that the server will send the receipt first before sending any pending messages to a subscribed client? Or is this frame sequence possible:
> 
> client: SUBSCRIBE
> server: MESSAGE
> server: RECEIPT
> 
> Michael
> 
> 
> 
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From majek04 at gmail.com  Thu Jul  7 13:46:54 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Thu, 7 Jul 2011 13:46:54 +0100
Subject: [rabbitmq-discuss] Persistent connections with Amqphp
In-Reply-To: <CAOvN6FC-tC+gV_ysT54RaZR-3P5zeXHNNDE=mwOMNTnc1enMTw@mail.gmail.com>
References: <CAOvN6FC-tC+gV_ysT54RaZR-3P5zeXHNNDE=mwOMNTnc1enMTw@mail.gmail.com>
Message-ID: <CABzX+qzyFJSQb3EKxCxX33OR79oExLr=7fefsdvMk4NCRcFuNg@mail.gmail.com>

On Wed, Jul 6, 2011 at 19:24, Robin Harvey <harvey.robin at gmail.com> wrote:
> A couple of people recently asked about support for persistent connections,
> after a bit of hacking around I've uploaded an update which has basic
> persistent connection support: https://github.com/BraveSirRobin/amqphp
> (check the 0.9.1 tag)

Nice!

> I'd be interested to hear what the RabbitMQ people think about the likely
> behavior of PHP "persistent connections", which may include:
>
> ?* If the web server is restarted, all open client connections are dropped
> without going through the amqp shutdown sequence, so you get lots of "closed
> abruptly" errors in the log.

I don't think there is a workaround. Maybe there is a atexit(3)
equivalent in php?

> ?* If a web server has no web requests to process then the persistent client
> can't respond to any messages the broker sends; the client will "go quiet".

It should be fine as far as the TCP/IP connection is intact.  But don't use
AMQP heartbeats :)

Cheers,
  Marek

From rob at rabbitmq.com  Thu Jul  7 14:34:38 2011
From: rob at rabbitmq.com (Rob Harrop)
Date: Thu, 7 Jul 2011 14:34:38 +0100
Subject: [rabbitmq-discuss] Persistent messages and durable queue
	questions
In-Reply-To: <BANLkTikBasN97dpS2XaPxh-Mr9rz4Ft-Xg@mail.gmail.com>
References: <BANLkTinehFtF17CT6koQ-W_kUV-7fdJWSw@mail.gmail.com>
	<4E01A49C.9010402@rabbitmq.com>
	<BANLkTikBasN97dpS2XaPxh-Mr9rz4Ft-Xg@mail.gmail.com>
Message-ID: <0F51CD98-3C30-4029-855A-228B79C3FD71@rabbitmq.com>





On 24 Jun 2011, at 18:33, Elias Levy <fearsome.lucidity at gmail.com> wrote:

> On Wed, Jun 22, 2011 at 1:15 AM, Rob Harrop <rob at rabbitmq.com> wrote:
> 
> When there is a consumer ready to receive the message, the message will only be written to disk if:
> 
> 1. The queue is durable
> 2. The message is peristent
> 3. Automatic ack is disabled
> 
> Rob,
> 
> Thanks for your response.  I was afraid that might be the case.  That said, I've read with interest the discussion on the upcoming HA queue feature.  It's exactly what we are looking for.  Hopefully it will be release in not too long a time.

HA queues will be in the next major release.

>  
> You can use publisher confirms to allow your application code to know when a message has successfully been routed or when it has been lost.
> 
> See: http://www.rabbitmq.com/extensions.html#confirms
> 
> Alas, I believe, publisher confirms do not solve the problem. As I stated, I expect only a subset of the messages published to the topic exchange to have matching bindings.  Most messages will not be routed anywhere.  Publisher confirms will return basic.ack for such messages.  That is all well and good under normal conditions.  
> 
> But if there is a node with a queue with a binding that matches the message, and that node goes down, then it is my understanding that the rest of the cluster will discard the binding since the queue is no longer reachable.  If that is the case, then publisher confirms will return a basic.ack rather than a basic.nack.  Thus the publisher will not know that there was a queue with a binding that matched the message, but its just not available at this time.
> 
> Is my understanding incorrect?

Well, it's quite subtle. If the message was routed when the queue was up, a back is sent if the queue goes down before the message can be written to disk.

If the binding has been removed due to queue down then no nack will be sent.

Are you trying to ensure that a given message reaches a known set of queues?
> 
> This becomes less of an issue once the HA queues feature is shipped, as I configure the cluster the deliver the message to a queue even in the face a configurable number of nodes being down.
> 
> Elias Levy
> 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110707/fc02c034/attachment.htm>

From Lowell.Boggs at emc.com  Thu Jul  7 15:30:19 2011
From: Lowell.Boggs at emc.com (Lowell.Boggs at emc.com)
Date: Thu, 7 Jul 2011 10:30:19 -0400
Subject: [rabbitmq-discuss] rabbitmq-c: amqp_exchange_declare() always
 sets auto-delete to no
In-Reply-To: <yrv4cmxgrf374.fsf@dwragg.eng.vmware.com>
References: <8A1A883E3F171B42A81817DEC138352C1DB514B858@MX06A.corp.emc.com>
	<yrv4cmxgrf374.fsf@dwragg.eng.vmware.com>
Message-ID: <8A1A883E3F171B42A81817DEC138352C1DB514B8CE@MX06A.corp.emc.com>

Thanks,

Your description of what I am trying to do is exactly right and your suggestion seems reasonable.  I'll adjust my design accordingly.

Thanks for taking the time to help.

Lowell
 

-----Original Message-----
From: David Wragg [mailto:david at rabbitmq.com] 
Sent: Wednesday, July 06, 2011 5:35 PM
To: Boggs Jr., Lowell
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] rabbitmq-c: amqp_exchange_declare() always sets auto-delete to no

Hi Lowell,

<Lowell.Boggs at emc.com> writes:
> Is there a reason that you cannot create an exchange with the
> auto_delete property == true?

Auto-delete on exchanges is a AMQP 0-8 feature that is deprecated in
AMQP 0-9-1.  This is why the amqp_exchange_declare function does not
expose it (ever since it was converted to AMQP 0-9-1).

> Is it safe for me as an application devloper to create a clone of this
> function that has the auto_delete property passed in?  Does the
> rabbitmq team have plans to change the way the underlying functions
> work?

It is safe, but not a good idea.

rabbitmq-server still supports AMQP 0-8, including the auto-delete
property on exchanges.  So if you copy amqp_exchange_declare and add
that parameter, it will work today.  But at some point, rabbitmq-server
may drop AMQP 0-8 compatibility, and then it would stop working.

> Is a temporary exchange even a good idea?

Not really.

> I am trying to simplify the shutdown logic of a multi-threaded
> application.  I don't want to have to invent a way of signaling my
> worker threads to shut down.  Instead, I want to send them a message
> that they can read like normal but have a quick way of identifying
> that this is a shutdown command. I am currently writing code for my
> threads that work like this:
>
> void Thread()
> {
>
>     // create the connection
>     // declare the primary command exchange
>     // declare the qrimary queue
>     // declare a "stop command" exchange
>     // declare a "stop command" queue
>     // bind everyone up and call basic_consume on the queues
>
>
>     for(;;)
>      {
>         string exchangeName;
>         string topicName;
>         string messageBody;
>
>          int error = readMessage(exchangeName, topicName, messageBody);
>
>          if(error) break;
>
>         if(exchangeName == "stop")
>            break;
>
>        processMesage(messageBody);
>
>     }
> }
>
> Note that I am having multiple threads in multiple executables on
> multiple machines all reading from the same primary command exchange
> for performance and redundancy reasons -- so I can't really use the
> topic to indicate shutdown.  I might want to shutdown a given
> executable on a given host, not the entire system.
>
> The above logic is working fine, but when I kill a process, I have to
> remember to delete the exchanges because they don't have an autoDelete
> flag.
>
> Is there a better way to handle this shutdown logic?

It sounds like you have a hierarchy of threads, processes, and machines.
And you want to send command messages (including shutdown messages) to
the various levels in that hierarchy: To a thread, to all the threads
in a process, to all the threads in all processes on a host, and to all
threads everywhere.

You can accomplish this by declaring four exchanges. Let's call them
"per-thread", "per-process", "per-host" and "everything".

Each thread declares an auto-delete queue for itself, and binds this
queue to all four exchanges, but with different binding keys.

"per-thread" should be a direct exchange.  A thread binds its queue to
this exchange  with a binding key of the form "<host_id>.<process_id>.<thread_id>".

"per-process" should be a direct exchange.  A thread binds its queue to
this exchange with with a binding key of the form
"<host_id>.<process_id>".

"per-host" should be a direct exchange.  A thread binds its queue to
this exchange with with a binding key of the form "<host_id>"

Finally, "everything" can just be a fanout exchange (and so the binding
key is not used).

In order to send a command, use the exchange for the appropriate level
in the hierarchy, and the corresponding routing key.

Because all four exchanges are long lived, your code should not need to
delete any of them.

-- 
David Wragg
Staff Engineer, RabbitMQ
VMware, Inc.

From tarno6 at gmail.com  Thu Jul  7 15:11:04 2011
From: tarno6 at gmail.com (Tom Arnold)
Date: Thu, 7 Jul 2011 07:11:04 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ JMS client
Message-ID: <28108671.3343.1310047864306.JavaMail.geo-discussion-forums@yqcj24>

Hi all,

I'm interested in talking to a RabbitMQ broker through a JMS client.

It looks like Rabbit's interop page (
http://www.rabbitmq.com/interoperability.html) is a bit out of date (Rabbit 
2.0.0). I've tried using Qpid's JMS client without much success (it doesn't 
seem to want to negotiate protocol version), and OpenAMQ's JMS client seems 
to have disappeared.

Does anyone have Qpid (or any other JMS client) working with Rabbit?

Thanks!
-Tom
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110707/004cd9f8/attachment.htm>

From cctrieloff at redhat.com  Thu Jul  7 15:50:59 2011
From: cctrieloff at redhat.com (Carl Trieloff)
Date: Thu, 07 Jul 2011 10:50:59 -0400
Subject: [rabbitmq-discuss] RabbitMQ JMS client
In-Reply-To: <28108671.3343.1310047864306.JavaMail.geo-discussion-forums@yqcj24>
References: <28108671.3343.1310047864306.JavaMail.geo-discussion-forums@yqcj24>
Message-ID: <4E15C7D3.5050509@redhat.com>



Forward/copy this to the users at qpid.apache.org ,I know a few people do
this and someone should be able to help you.

Carl.



On 07/07/2011 10:11 AM, Tom Arnold wrote:
> Hi all,
>
> I'm interested in talking to a RabbitMQ broker through a JMS client.
>
> It looks like Rabbit's interop page
> (http://www.rabbitmq.com/interoperability.html) is a bit out of date
> (Rabbit 2.0.0). I've tried using Qpid's JMS client without much
> success (it doesn't seem to want to negotiate protocol version), and
> OpenAMQ's JMS client seems to have disappeared.
>
> Does anyone have Qpid (or any other JMS client) working with Rabbit?
>
> Thanks!
> -Tom
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110707/973def2f/attachment.htm>

From Lowell.Boggs at emc.com  Thu Jul  7 16:00:47 2011
From: Lowell.Boggs at emc.com (Lowell.Boggs at emc.com)
Date: Thu, 7 Jul 2011 11:00:47 -0400
Subject: [rabbitmq-discuss] Tutorial example suggestion: work queues
 tutorial could have a description of hierarchical shutdown logic
In-Reply-To: <yrv4cmxgrf374.fsf@dwragg.eng.vmware.com>
References: <8A1A883E3F171B42A81817DEC138352C1DB514B858@MX06A.corp.emc.com>
	<yrv4cmxgrf374.fsf@dwragg.eng.vmware.com>
Message-ID: <8A1A883E3F171B42A81817DEC138352C1DB514B8E3@MX06A.corp.emc.com>

Thanks for this great advice.  

I looked for an example of how to handle shutdown and other system commands in this tutorial:

   http://www.rabbitmq.com/tutorials/tutorial-two-python.html

But not finding any advice there, I tried to come up with my own idea based on concepts that I gleaned from the rabbitmq-c interfaces themselves and the tutorial examples.  I see the benefits of your suggestion below.

I would like to suggest that the work queues tutorial is a great place to insert the important information you provided in the attached email about exchange hierarchies.

Note that it would not be necessary to provide example code for this to be a helpful addition.  If you understand the work queues logic, you can understand a description of the shutdown logic without seeing it worked out.  

Also, I have not found (maybe I just haven't looked hard enough) a good explanation of why I should prefer one exchange type over the other.  Direct seems to be doing everything I need.  I am a bit concerned about the performance impact of of using topic name patterns.  The shutdown example you give below would be a nice place in the tutorials to comment on which exchange type is best suited for what.

Thanks again!

Lowell


-----Original Message-----
From: David Wragg [mailto:david at rabbitmq.com] 
Sent: Wednesday, July 06, 2011 5:35 PM
To: Boggs Jr., Lowell
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] rabbitmq-c: amqp_exchange_declare() always sets auto-delete to no

Hi Lowell,

<Lowell.Boggs at emc.com> writes:
> Is there a reason that you cannot create an exchange with the
> auto_delete property == true?

Auto-delete on exchanges is a AMQP 0-8 feature that is deprecated in
AMQP 0-9-1.  This is why the amqp_exchange_declare function does not
expose it (ever since it was converted to AMQP 0-9-1).

> Is it safe for me as an application devloper to create a clone of this
> function that has the auto_delete property passed in?  Does the
> rabbitmq team have plans to change the way the underlying functions
> work?

It is safe, but not a good idea.

rabbitmq-server still supports AMQP 0-8, including the auto-delete
property on exchanges.  So if you copy amqp_exchange_declare and add
that parameter, it will work today.  But at some point, rabbitmq-server
may drop AMQP 0-8 compatibility, and then it would stop working.

> Is a temporary exchange even a good idea?

Not really.

> I am trying to simplify the shutdown logic of a multi-threaded
> application.  I don't want to have to invent a way of signaling my
> worker threads to shut down.  Instead, I want to send them a message
> that they can read like normal but have a quick way of identifying
> that this is a shutdown command. I am currently writing code for my
> threads that work like this:
>
> void Thread()
> {
>
>     // create the connection
>     // declare the primary command exchange
>     // declare the qrimary queue
>     // declare a "stop command" exchange
>     // declare a "stop command" queue
>     // bind everyone up and call basic_consume on the queues
>
>
>     for(;;)
>      {
>         string exchangeName;
>         string topicName;
>         string messageBody;
>
>          int error = readMessage(exchangeName, topicName, messageBody);
>
>          if(error) break;
>
>         if(exchangeName == "stop")
>            break;
>
>        processMesage(messageBody);
>
>     }
> }
>
> Note that I am having multiple threads in multiple executables on
> multiple machines all reading from the same primary command exchange
> for performance and redundancy reasons -- so I can't really use the
> topic to indicate shutdown.  I might want to shutdown a given
> executable on a given host, not the entire system.
>
> The above logic is working fine, but when I kill a process, I have to
> remember to delete the exchanges because they don't have an autoDelete
> flag.
>
> Is there a better way to handle this shutdown logic?

It sounds like you have a hierarchy of threads, processes, and machines.
And you want to send command messages (including shutdown messages) to
the various levels in that hierarchy: To a thread, to all the threads
in a process, to all the threads in all processes on a host, and to all
threads everywhere.

You can accomplish this by declaring four exchanges. Let's call them
"per-thread", "per-process", "per-host" and "everything".

Each thread declares an auto-delete queue for itself, and binds this
queue to all four exchanges, but with different binding keys.

"per-thread" should be a direct exchange.  A thread binds its queue to
this exchange  with a binding key of the form "<host_id>.<process_id>.<thread_id>".

"per-process" should be a direct exchange.  A thread binds its queue to
this exchange with with a binding key of the form
"<host_id>.<process_id>".

"per-host" should be a direct exchange.  A thread binds its queue to
this exchange with with a binding key of the form "<host_id>"

Finally, "everything" can just be a fanout exchange (and so the binding
key is not used).

In order to send a command, use the exchange for the appropriate level
in the hierarchy, and the corresponding routing key.

Because all four exchanges are long lived, your code should not need to
delete any of them.

-- 
David Wragg
Staff Engineer, RabbitMQ
VMware, Inc.

From jiri at krutil.com  Thu Jul  7 17:16:06 2011
From: jiri at krutil.com (Jiri Krutil)
Date: Thu, 07 Jul 2011 18:16:06 +0200
Subject: [rabbitmq-discuss] Channel thread safety in Java client
In-Reply-To: <A7F601B8-1674-4AF2-BA08-4EAEBF0D4E01@rabbitmq.com>
References: <1309855320.3929.25.camel@holba>
	<A7F601B8-1674-4AF2-BA08-4EAEBF0D4E01@rabbitmq.com>
Message-ID: <20110707181606.79062zhagtf0cag4@webmail.active24.cz>

Steve,

Can you please clarify your post a bit for me:

You say that a client application may continue to use a Channel from  
its main thread even if the RabbitMQ client library uses the same  
Channel for async receiving.

How is the use of a Channel from the RabbitMQ client library  
connection thread sychronized with the use of the same Channel from  
the client application thread?

Is such concurrent Channel access different from a situation when two  
client application threads access the same Channel concurrently?

Cheers
Jiri


> Jiri,
> The current implementation of the Java Client calls the Consumer  
> interface on the same thread that the Channel work is done on.  This  
> means that anything done in the Consumer callbacks is synchronised  
> with all the other channel stuff going on, and could potentially  
> block it.  There are notes on the api-guide pages to warn you about  
> this.
>
> The QueueingConsumer class basically makes sure that the Consumer  
> callbacks do not cause any problems, putting the messages on the  
> (dedicated) queue for any (usually the main) thread to access them.
>
> This means that, even though there may be many consumers defined for  
> a Channel, ownership of the Channel is not passed to the 'lib's  
> connection thread', and you can continue to use the Channel from the  
> main thread, or whatever thread you have allocated to run it from.   
> You can ack messages, and anything else you want, too.
>
> The thing you shouldn't do is to call Channel methods (for the same  
> channel) from more than one thread at a time.  This is because the  
> threading model in the channel is 'challenged'.
>
> We are currently working on the Consumer and Channel threading  
> restrictions -- we want to run all the Consumer callbacks on a  
> thread which is distinct from the Connection thread; and allow  
> channels to be driven from multiple threads.  This would mean it is  
> feasible to do most Channel operations from the Consumer callback  
> itself, and from any other thread.
>
> Incidentally, the way our changes are going at the moment, we will  
> expose the execution thread pool for Consumer callbacks; and allow  
> the user to have control over how many threads are allocated.  For  
> example, it might be thought sensible to have a single thread per  
> channel allocated for Consumer callbacks; but this could mean a  
> large penalty for a large number of channels that may be doing very  
> little work.  Instead we pass work to an Executor (managed so that  
> all the work required by a single channel is serialised) which runs  
> it on a thread from a pool.  The default Executor will use a (fixed)  
> pool of 16 threads, but the interface will allow passing in any  
> Executor implementation for the Connection.
>
> I hope this helps.  Feedback is welcome.
> Steve Powell  (a happy bunny)
> ----------some definitions from the SPD----------
> Rigatoni n. A prime-ministerial grin.
> Nigella n. The next bottle-size up from a Nebuchadnezzar.
> Homily adv. Rather like a frenchman.
>
> On 5 Jul 2011, at 09:42, Jiri Krutil wrote:
>
>> Hi
>>
>> I'm trying to understand the limitations of using a Channel in a
>> multi-threaded application using the Java client. Sorry for this longish
>> post...
>>
>> I have read http://www.rabbitmq.com/api-guide.html#channel-threads but
>> did not find any other, more detailed info.
>>
>> I want to receive messages by subscription. I create a Channel and
>> invoke basicConsume() on it, passing a QueueingConsumer.
>>
>> The moment I call basicConsume(), I would imagine the Channel becomes
>> "owned" by the client lib's connection thread, which feeds messages to
>> QueueingConsumer.
>>
>> My app is retrieving those messages from the QueueingConsumer in the
>> main thread. I would like to know to which extent can I keep using the
>> Channel passed to basicConsume() from the main thread.
>>
>> I guess I can use it to ack messages, because ack would not work on
>> another channel, correct? Can I also use the channel for other things,
>> such as sending messages, using transactions, or starting another
>> subscription?
>>
>> JMS specs seem to be quite explicit on this. It says a session with an
>> active subscription is owned by the connection thread and client app
>> threads cannot use the session; they can only shut it down. That's why
>> if I want multiple subscriptiopns on one session, I must set them all up
>> before I call Connection.start(), which passes the session ownership to
>> the client library. Afterwards I can no longer use the session from my
>> threads except closing it.
>>
>> Could you please elaborate on how exactly this works in the rabbit Java
>> client?
>>
>> Cheers
>> Jiri
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>




From Massimo.Paladin at cern.ch  Thu Jul  7 17:17:24 2011
From: Massimo.Paladin at cern.ch (Massimo Paladin)
Date: Thu, 7 Jul 2011 18:17:24 +0200
Subject: [rabbitmq-discuss] rabbitmq_auth_mechanism_ssl limitations
In-Reply-To: <4E131DD3.40909@rabbitmq.com>
References: <CAMOXM29jANOoR9t6v82E-ftoj3Y6xNbyShPMFsF8VNXgrWrx0w@mail.gmail.com>
	<4E130F1A.8050505@rabbitmq.com>
	<CAMOXM28Mg5h0Ysr0fzK_s-z+RzrzAJBL25E8VoZQXx7KLp2wnA@mail.gmail.com>
	<4E131DD3.40909@rabbitmq.com>
Message-ID: <CAMOXM2-tqc9tjwnyrsyyBc1TabfegKhw08edHXEEm5XgwADKZQ@mail.gmail.com>

Matthias, would you say there is no way to get this right?

In any case I think this implementation is not very useful since it takes
one CN (which one if multiple?) as username and limit to only one CA
signed certificates.

Cheers,
---
Massimo Paladin

email:?massimo.paladin at gmail.com
website:?http://www.mpaladin.com
flickr's page:?http://flickr.com/photos/massimop



On Tue, Jul 5, 2011 at 4:21 PM, Matthias Radestock
<matthias at rabbitmq.com> wrote:
> Massimo,
>
> On 05/07/11 15:05, Massimo Paladin wrote:
>>
>> Looking at openssl there is an rfc which tells how to convert from asn.1
>> to string: http://www.ietf.org/rfc/rfc2253.txt
>
> It wouldn't be ASN.1 if there wasn't a more recent version of any given
> spec, in this case http://www.ietf.org/rfc/rfc4514.txt
>
> Anyway, the conversion specified therein is not isomorphic w.r.t.
> equivalence, i.e. two DNs which are considered equal (there are bunch of
> RFCs which define what that means) are not necessarily represented by the
> same string.
>
>
> Matthias.
>

From deldotdr at gmail.com  Thu Jul  7 18:22:09 2011
From: deldotdr at gmail.com (Dorian Raymer)
Date: Thu, 7 Jul 2011 10:22:09 -0700
Subject: [rabbitmq-discuss] Heartbeat timeout
Message-ID: <CALUPC+F9n96f1ca_d1oabxOCQb-=Ss3nw3Erserj43vimapaKw@mail.gmail.com>

Hi,
Is it possible to configure the broker such that it tolerates missing N
heartbeats from the client before timing out? (It currently times out after
2*heartbeat_period, if I'm not mistaken.)

Thanks,
-Dorian
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110707/a79225ed/attachment.htm>

From matthias at rabbitmq.com  Thu Jul  7 18:26:14 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 07 Jul 2011 18:26:14 +0100
Subject: [rabbitmq-discuss] rabbitmq_auth_mechanism_ssl limitations
In-Reply-To: <CAMOXM2-tqc9tjwnyrsyyBc1TabfegKhw08edHXEEm5XgwADKZQ@mail.gmail.com>
References: <CAMOXM29jANOoR9t6v82E-ftoj3Y6xNbyShPMFsF8VNXgrWrx0w@mail.gmail.com>
	<4E130F1A.8050505@rabbitmq.com>
	<CAMOXM28Mg5h0Ysr0fzK_s-z+RzrzAJBL25E8VoZQXx7KLp2wnA@mail.gmail.com>
	<4E131DD3.40909@rabbitmq.com>
	<CAMOXM2-tqc9tjwnyrsyyBc1TabfegKhw08edHXEEm5XgwADKZQ@mail.gmail.com>
Message-ID: <4E15EC36.9090302@rabbitmq.com>

Massimo,

On 07/07/11 17:17, Massimo Paladin wrote:
> Matthias, would you say there is no way to get this right?

I don't know. It's a tricky problem.

> In any case I think this implementation is not very useful since it
> takes one CN (which one if multiple?) as username and limit to only
> one CA signed certificates.

The current implementation does not permit multi-valued CNs. I don't 
remember whether the x509 RFCs permit them.

We could just forget about ASN.1/x509's obscure notions of equivalence 
and convert the DNs to strings according to RFC 4514. That will be ok as 
long as users always present exactly the same certificate and whoever 
provisions the rabbit auth db can get hold of the certificates or the 
RFC 4514 presentations of their subject DNs.

In practice that would probably also work in many cases where users 
present multiple certs containing the same logical subject DN. But there 
is no guarantee of that since it is possible for, say, two CAs to issue 
certs for the same subject DN but construct the underlying ASN.1 
differently such that an RFC4514 conversion to string produces different 
results. Or even for the same CA to do that when a cert is renewed.


Regards,

Matthias.

From 11mdlow at gmail.com  Thu Jul  7 19:03:46 2011
From: 11mdlow at gmail.com (Matthew Low)
Date: Thu, 7 Jul 2011 11:03:46 -0700
Subject: [rabbitmq-discuss] Problem with Installing RabbitMQ Server 2.5.1
Message-ID: <CADE4k+67+G5fieqWSZnGg+b70JvANQtcr3pz=Q3tcHFr0sw6JQ@mail.gmail.com>

Hello,

I am trying to get a working version of RabbitMQ up and running on my Mac
OSX with the generic Unix version. However, I get the following error when I
try to start up the server:

Archon:rabbitmq_server-2.5.0 matthew$ sbin/rabbitmq-server
Activating RabbitMQ plugins ...
ERROR: Could not create dir
/var/lib/rabbitmq/mnesia/rabbit at Archon-plugins-expand (enoent)

I have the most recent version of Erlang installed on my machine. I think
this may be some sort of read/write permissions problem, but I don't quite
know how to fix it. Please help!

Thanks,
Matt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110707/c0f5c85b/attachment.htm>

From 11mdlow at gmail.com  Thu Jul  7 19:08:54 2011
From: 11mdlow at gmail.com (Matt)
Date: Thu, 7 Jul 2011 11:08:54 -0700 (PDT)
Subject: [rabbitmq-discuss] Problem installing RabbitMQ Server 2.5.1
Message-ID: <6cb25a12-664c-4a3d-bfd7-68a1f18ed99d@h38g2000pro.googlegroups.com>

Hello,

I think there was a problem with my previous post. Here is is again.

I am trying to get a working version of RabbitMQ up and running on my
Mac OSX with the generic Unix version. However, I get the following
error when I try to start up the server:

Archon:rabbitmq_server-2.5.0 matthew$ sbin/rabbitmq-server
Activating RabbitMQ plugins ...
ERROR: Could not create dir /var/lib/rabbitmq/mnesia/rabbit at Archon-
plugins-expand (enoent)

I have the most recent version of Erlang installed on my machine. I
think this may be some sort of read/write permissions problem, but I
don't quite know how to fix it. Please help!

Thanks,
Matt

From matthias at rabbitmq.com  Thu Jul  7 19:19:04 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 07 Jul 2011 19:19:04 +0100
Subject: [rabbitmq-discuss] Problem installing RabbitMQ Server 2.5.1
In-Reply-To: <6cb25a12-664c-4a3d-bfd7-68a1f18ed99d@h38g2000pro.googlegroups.com>
References: <6cb25a12-664c-4a3d-bfd7-68a1f18ed99d@h38g2000pro.googlegroups.com>
Message-ID: <4E15F898.2050201@rabbitmq.com>

Matt,

On 07/07/11 19:08, Matt wrote:
> I am trying to get a working version of RabbitMQ up and running on my
> Mac OSX with the generic Unix version.

Would using homebrew or macports be an option?

> However, I get the following error when I try to start up the server:
>
> Archon:rabbitmq_server-2.5.0 matthew$ sbin/rabbitmq-server
> Activating RabbitMQ plugins ...
> ERROR: Could not create dir /var/lib/rabbitmq/mnesia/rabbit at Archon-
> plugins-expand (enoent)
>
> I have the most recent version of Erlang installed on my machine. I
> think this may be some sort of read/write permissions problem, but I
> don't quite know how to fix it. Please help!

 From http://www.rabbitmq.com/install.html#generic-unix
<quote>
If the directories RABBITMQ_MNESIA_BASE and RABBITMQ_LOG_BASE do not 
exist the server will attempt to create them. The server needs write 
permission at the configured locations.
</quote>

So just point those env vars to some writeable location.


Regards,

Matthias.

From harvey.robin at gmail.com  Thu Jul  7 19:55:10 2011
From: harvey.robin at gmail.com (Robin Harvey)
Date: Thu, 7 Jul 2011 19:55:10 +0100
Subject: [rabbitmq-discuss] Persistent connections with Amqphp
In-Reply-To: <CABzX+qzyFJSQb3EKxCxX33OR79oExLr=7fefsdvMk4NCRcFuNg@mail.gmail.com>
References: <CAOvN6FC-tC+gV_ysT54RaZR-3P5zeXHNNDE=mwOMNTnc1enMTw@mail.gmail.com>
	<CABzX+qzyFJSQb3EKxCxX33OR79oExLr=7fefsdvMk4NCRcFuNg@mail.gmail.com>
Message-ID: <CAOvN6FAgUR7mpBroCAhRM9KnHwhqTV5Kaz_2kLu0rzBTwyvT6Q@mail.gmail.com>

>
> I don't think there is a workaround. Maybe there is a atexit(3)
> equivalent in php?
>
Not that I know of.


It should be fine as far as the TCP/IP connection is intact.  But don't use
> AMQP heartbeats :)
>
Yes, heartbeats do screw things up!  I'll have to remember to note that in
the docs.

Thanks,
--Robin




On Thu, Jul 7, 2011 at 1:46 PM, Marek Majkowski <majek04 at gmail.com> wrote:

> On Wed, Jul 6, 2011 at 19:24, Robin Harvey <harvey.robin at gmail.com> wrote:
> > A couple of people recently asked about support for persistent
> connections,
> > after a bit of hacking around I've uploaded an update which has basic
> > persistent connection support: https://github.com/BraveSirRobin/amqphp
> > (check the 0.9.1 tag)
>
> Nice!
>
> > I'd be interested to hear what the RabbitMQ people think about the likely
> > behavior of PHP "persistent connections", which may include:
> >
> >  * If the web server is restarted, all open client connections are
> dropped
> > without going through the amqp shutdown sequence, so you get lots of
> "closed
> > abruptly" errors in the log.
>
> I don't think there is a workaround. Maybe there is a atexit(3)
> equivalent in php?
>
> >  * If a web server has no web requests to process then the persistent
> client
> > can't respond to any messages the broker sends; the client will "go
> quiet".
>
> It should be fine as far as the TCP/IP connection is intact.  But don't use
> AMQP heartbeats :)
>
> Cheers,
>   Marek
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110707/4d405f92/attachment.htm>

From 11mdlow at gmail.com  Thu Jul  7 21:21:09 2011
From: 11mdlow at gmail.com (Matthew Low)
Date: Thu, 7 Jul 2011 13:21:09 -0700
Subject: [rabbitmq-discuss] Problem with hello world example: Connection
	Refused
Message-ID: <CADE4k+7k3izCmVqnScf0sM6TnCjCi7i_4_jtSPEopm_UkjB+=w@mail.gmail.com>

Hello,

So I am just trying to establish a basic connection with my server (by going
through the hello world example) and I got the following error. I realize
this is probably more of a pika issue than RabbitMQ, but maybe someone has
seen this error before?

Archon:hello matthew$ python send.py
Traceback (most recent call last):
  File "send.py", line 4, in <module>
    connection = pika.BlockingConnection(parameters)
  File
"build/bdist.macosx-10.6-universal/egg/pika/adapters/blocking_connection.py",
line 32, in __init__
  File
"build/bdist.macosx-10.6-universal/egg/pika/adapters/base_connection.py",
line 50, in __init__
  File "build/bdist.macosx-10.6-universal/egg/pika/connection.py", line 170,
in __init__
  File "build/bdist.macosx-10.6-universal/egg/pika/connection.py", line 228,
in _connect
  File
"build/bdist.macosx-10.6-universal/egg/pika/adapters/blocking_connection.py",
line 36, in _adapter_connect
  File
"build/bdist.macosx-10.6-universal/egg/pika/adapters/base_connection.py",
line 58, in _adapter_connect
  File "<string>", line 1, in connect
socket.error: [Errno 61] Connection refused

Thanks,
Matt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110707/e78433d5/attachment.htm>

From gmr at myyearbook.com  Thu Jul  7 23:20:07 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Thu, 7 Jul 2011 18:20:07 -0400
Subject: [rabbitmq-discuss] Problem with hello world example: Connection
	Refused
In-Reply-To: <CADE4k+7k3izCmVqnScf0sM6TnCjCi7i_4_jtSPEopm_UkjB+=w@mail.gmail.com>
References: <CADE4k+7k3izCmVqnScf0sM6TnCjCi7i_4_jtSPEopm_UkjB+=w@mail.gmail.com>
Message-ID: <CAL_e=0rz2m2=4DCXckOFoD=2gvMszvzM-Wji-dZr8DuLfMcNWQ@mail.gmail.com>

It means you provided Pika with incorrect information about how to connect
to a running RabbitMQ server.

Make sure you're passing in the correct host and port to the connection and
that your RabbitMQ server is running.

On Thu, Jul 7, 2011 at 4:21 PM, Matthew Low <11mdlow at gmail.com> wrote:

> Hello,
>
> So I am just trying to establish a basic connection with my server (by
> going through the hello world example) and I got the following error. I
> realize this is probably more of a pika issue than RabbitMQ, but maybe
> someone has seen this error before?
>
> Archon:hello matthew$ python send.py
> Traceback (most recent call last):
>   File "send.py", line 4, in <module>
>     connection = pika.BlockingConnection(parameters)
>   File
> "build/bdist.macosx-10.6-universal/egg/pika/adapters/blocking_connection.py",
> line 32, in __init__
>   File
> "build/bdist.macosx-10.6-universal/egg/pika/adapters/base_connection.py",
> line 50, in __init__
>   File "build/bdist.macosx-10.6-universal/egg/pika/connection.py", line
> 170, in __init__
>   File "build/bdist.macosx-10.6-universal/egg/pika/connection.py", line
> 228, in _connect
>   File
> "build/bdist.macosx-10.6-universal/egg/pika/adapters/blocking_connection.py",
> line 36, in _adapter_connect
>   File
> "build/bdist.macosx-10.6-universal/egg/pika/adapters/base_connection.py",
> line 58, in _adapter_connect
>   File "<string>", line 1, in connect
> socket.error: [Errno 61] Connection refused
>
> Thanks,
> Matt
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110707/ad0489c8/attachment.htm>

From matthew at rabbitmq.com  Thu Jul  7 23:21:55 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 7 Jul 2011 23:21:55 +0100
Subject: [rabbitmq-discuss] Heartbeat timeout
In-Reply-To: <CALUPC+F9n96f1ca_d1oabxOCQb-=Ss3nw3Erserj43vimapaKw@mail.gmail.com>
References: <CALUPC+F9n96f1ca_d1oabxOCQb-=Ss3nw3Erserj43vimapaKw@mail.gmail.com>
Message-ID: <20110707222154.GB2554@rabbitmq.com>

On Thu, Jul 07, 2011 at 10:22:09AM -0700, Dorian Raymer wrote:
> Is it possible to configure the broker such that it tolerates missing N
> heartbeats from the client before timing out? (It currently times out after
> 2*heartbeat_period, if I'm not mistaken.)

You are not mistaken, and no, there is no way of altering that without a
recompile.

Matthew

From simone.busoli at gmail.com  Thu Jul  7 23:34:18 2011
From: simone.busoli at gmail.com (Simone Busoli)
Date: Fri, 8 Jul 2011 00:34:18 +0200
Subject: [rabbitmq-discuss] How do heartbeats work? (was Heartbeat timeout)
Message-ID: <CAOn7oW9ZY5nUHm1WJRL0am80vvTP7hKgDG6QoEtvoux91=7-mA@mail.gmail.com>

This is something I was unaware of, although I knew heartbeats were in
place. Does that mean that whatever client library I'm using, if for any
reason the client does not respond to two consecutive server heartbeats then
the server will close the connection and the client has to create a new one
to set-up the communication once again?

On Fri, Jul 8, 2011 at 00:21, Matthew Sackman <matthew at rabbitmq.com> wrote:

> On Thu, Jul 07, 2011 at 10:22:09AM -0700, Dorian Raymer wrote:
> > Is it possible to configure the broker such that it tolerates missing N
> > heartbeats from the client before timing out? (It currently times out
> after
> > 2*heartbeat_period, if I'm not mistaken.)
>
> You are not mistaken, and no, there is no way of altering that without a
> recompile.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110708/a0026c41/attachment.htm>

From matthew at rabbitmq.com  Thu Jul  7 23:37:20 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 7 Jul 2011 23:37:20 +0100
Subject: [rabbitmq-discuss] How do heartbeats work? (was Heartbeat
 timeout)
In-Reply-To: <CAOn7oW9ZY5nUHm1WJRL0am80vvTP7hKgDG6QoEtvoux91=7-mA@mail.gmail.com>
References: <CAOn7oW9ZY5nUHm1WJRL0am80vvTP7hKgDG6QoEtvoux91=7-mA@mail.gmail.com>
Message-ID: <20110707223720.GC2554@rabbitmq.com>

On Fri, Jul 08, 2011 at 12:34:18AM +0200, Simone Busoli wrote:
> This is something I was unaware of, although I knew heartbeats were in
> place. Does that mean that whatever client library I'm using, if for any
> reason the client does not respond to two consecutive server heartbeats then
> the server will close the connection and the client has to create a new one
> to set-up the communication once again?

Yes. Note though that the client specifies the interval between the
heartbeats in the connection parameters.

Matthew

From matthias at rabbitmq.com  Thu Jul  7 23:50:23 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 07 Jul 2011 23:50:23 +0100
Subject: [rabbitmq-discuss] How do heartbeats work? (was Heartbeat
	timeout)
In-Reply-To: <20110707223720.GC2554@rabbitmq.com>
References: <CAOn7oW9ZY5nUHm1WJRL0am80vvTP7hKgDG6QoEtvoux91=7-mA@mail.gmail.com>
	<20110707223720.GC2554@rabbitmq.com>
Message-ID: <4E16382F.7060300@rabbitmq.com>

On 07/07/11 23:37, Matthew Sackman wrote:
> On Fri, Jul 08, 2011 at 12:34:18AM +0200, Simone Busoli wrote:
>> This is something I was unaware of, although I knew heartbeats were in
>> place. Does that mean that whatever client library I'm using, if for any
>> reason the client does not respond to two consecutive server heartbeats then
>> the server will close the connection and the client has to create a new one
>> to set-up the communication once again?
>
> Yes. Note though that the client specifies the interval between the
> heartbeats in the connection parameters.

Also note that peers aren't "responding" to heartbeats. Heartbeats only 
need to be sent by a peer when it is not sending anything else. The 
other side just monitors the timing of the arrival of data, and when 
there is a significant gap it drops the connection.

Matthias.

From deldotdr at gmail.com  Thu Jul  7 23:51:33 2011
From: deldotdr at gmail.com (Dorian Raymer)
Date: Thu, 7 Jul 2011 15:51:33 -0700
Subject: [rabbitmq-discuss] Heartbeat timeout
In-Reply-To: <20110707222154.GB2554@rabbitmq.com>
References: <CALUPC+F9n96f1ca_d1oabxOCQb-=Ss3nw3Erserj43vimapaKw@mail.gmail.com>
	<20110707222154.GB2554@rabbitmq.com>
Message-ID: <CALUPC+GJFyy8A+-7Eqa5sB2Knu=__ovotph+UcRrzKCau4mudw@mail.gmail.com>

On Thu, Jul 7, 2011 at 3:21 PM, Matthew Sackman <matthew at rabbitmq.com>wrote:

> On Thu, Jul 07, 2011 at 10:22:09AM -0700, Dorian Raymer wrote:
> > Is it possible to configure the broker such that it tolerates missing N
> > heartbeats from the client before timing out? (It currently times out
> after
> > 2*heartbeat_period, if I'm not mistaken.)
>
> You are not mistaken, and no, there is no way of altering that without a
> recompile.
>
>
Alright, Thank you for info!

-Dorian


> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110707/9ebe7887/attachment.htm>

From tcurdt at vafer.org  Fri Jul  8 00:03:24 2011
From: tcurdt at vafer.org (Torsten Curdt)
Date: Fri, 8 Jul 2011 01:03:24 +0200
Subject: [rabbitmq-discuss] producer/consumer and every n-th message
Message-ID: <CABTa2P5ioqjj5J8RtSg6ag2uNVVUZ4o40qsvQx1mxT6=NRk+VA@mail.gmail.com>

Hey,

Let's say I have n producers sending messages to an exchange and m
consumers consuming from a single queue bound to that exchange. When a
consumer does not acknowledges a message (and dies), the message
should go back into the queue for another consumer to pick it up.

That should be easy to implement I assume?
I also assume for this scenario a direct exchange would do?
How bad would be the contention n and m are fairly large?
...or do I just need to have enough broker?

I would also like to be able to "tap into" the stream of messages
flowing through the exchange. I assume I could use a fanout exchange
instead. Have the normal queue with the m consumers and a second queue
with a single consumer "tapping in".

As the throughput of message can potentially be very high (which is
why there are so many consumers) of course a single consumer cannot
drain the second queue. So my idea was to only care about every n-th
message.

Is there a away to tell the fanout consumer to deliver every message
to Q1 but only every 10th message to Q2?
How else could one do this?

cheers,
Torsten

From matthias at rabbitmq.com  Fri Jul  8 00:11:41 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 08 Jul 2011 00:11:41 +0100
Subject: [rabbitmq-discuss] How do heartbeats work? (was Heartbeat
	timeout)
In-Reply-To: <CAOn7oW9kR1KT+osrjaBybM4yN40CLhiGQcO6sqw_Ow-9U1=2gg@mail.gmail.com>
References: <CAOn7oW9ZY5nUHm1WJRL0am80vvTP7hKgDG6QoEtvoux91=7-mA@mail.gmail.com>
	<20110707223720.GC2554@rabbitmq.com>
	<4E16382F.7060300@rabbitmq.com>
	<CAOn7oW9kR1KT+osrjaBybM4yN40CLhiGQcO6sqw_Ow-9U1=2gg@mail.gmail.com>
Message-ID: <4E163D2D.5010100@rabbitmq.com>

Simone,

(adding the list back on cc)

On 07/07/11 23:56, Simone Busoli wrote:
> Looking at the source of the .NET api I notice the default value is
> 0, which would mean no heartbeats at all,

Correct. The default in all our clients and the server is zero, i.e. no
heartbeats.

> although later in the code I can see it is somehow negotiated with
> the server,

Indeed. The server tells the client what heartbeat interval it wants and
the client then tells the server what the heartbeat interval really
should be. In our clients we pick the min of the client setting and the
server setting.

> I can't see when this negotiation is supposed to happen (the code is
> not called anywhere, that is)

The heartbeat setting negotiation code is definitely called.


Matthias.

From simone.busoli at gmail.com  Fri Jul  8 00:24:41 2011
From: simone.busoli at gmail.com (Simone Busoli)
Date: Fri, 8 Jul 2011 01:24:41 +0200
Subject: [rabbitmq-discuss] How do heartbeats work? (was Heartbeat
	timeout)
In-Reply-To: <4E163D2D.5010100@rabbitmq.com>
References: <CAOn7oW9ZY5nUHm1WJRL0am80vvTP7hKgDG6QoEtvoux91=7-mA@mail.gmail.com>
	<20110707223720.GC2554@rabbitmq.com>
	<4E16382F.7060300@rabbitmq.com>
	<CAOn7oW9kR1KT+osrjaBybM4yN40CLhiGQcO6sqw_Ow-9U1=2gg@mail.gmail.com>
	<4E163D2D.5010100@rabbitmq.com>
Message-ID: <CAOn7oW_5cYZpbQGRJqomsOFRnpWYLo4eWT3cqXOSyi1UnwmCAA@mail.gmail.com>

I gave it a quick look honestly, I must have missed the caller. Thanks for
the clarification.
On Jul 8, 2011 1:11 AM, "Matthias Radestock" <matthias at rabbitmq.com> wrote:
> Simone,
>
> (adding the list back on cc)
>
> On 07/07/11 23:56, Simone Busoli wrote:
>> Looking at the source of the .NET api I notice the default value is
>> 0, which would mean no heartbeats at all,
>
> Correct. The default in all our clients and the server is zero, i.e. no
> heartbeats.
>
>> although later in the code I can see it is somehow negotiated with
>> the server,
>
> Indeed. The server tells the client what heartbeat interval it wants and
> the client then tells the server what the heartbeat interval really
> should be. In our clients we pick the min of the client setting and the
> server setting.
>
>> I can't see when this negotiation is supposed to happen (the code is
>> not called anywhere, that is)
>
> The heartbeat setting negotiation code is definitely called.
>
>
> Matthias.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110708/58436797/attachment.htm>

From lgreg.meredith at gmail.com  Fri Jul  8 02:17:33 2011
From: lgreg.meredith at gmail.com (Meredith Gregory)
Date: Thu, 7 Jul 2011 18:17:33 -0700
Subject: [rabbitmq-discuss] Reproducible error for remote client -- was Re:
	Distributed queue setup
Message-ID: <CAG7cANS=rfOfuRbvSGJ0ez3Kchd=2aqqzmbUWrQJss5RNvBQKA@mail.gmail.com>

Dear Rabbitters,

It turns out our problem is even simpler. If we have a client from machine B
connect to the RabbitMQ broker on machine A and then begin sending messages,
the broker closes the connection unless we fire up a client to connect to
the broker on machine A to begin reading the messages. The number of
messages before closure depends on the size of the message. i have a trace
below. i will endeavor to get you a much smaller piece of code for repro.

We have been able to reproduce this error with virtually every java client
version from 1.4 to the current 2.5.1. All tests are conducted on Mac OS X
Snow Leopard.

Best wishes,

--greg

Welcome to Scala version 2.9.0.1 (Java HotSpot(TM) 64-Bit Server VM, Java
1.6.0_24).
Type in expressions to have them evaluated.
Type :help for more information.

scala> :load
/Users/lgm/work/src/projex/stellar/mdp4tw/SpecialK.moniker/scripts/rabbit-connectivity.scala
rabbit-connectivity.scala
Loading
/Users/lgm/work/src/projex/stellar/mdp4tw/SpecialK.moniker/scripts/rabbit-connectivity.scala...
import com.biosimilarity.lift.model.store._
import com.biosimilarity.lift.model.store.usage._
import com.biosimilarity.lift.lib._
import com.biosimilarity.lift.lib.usage._
import scala.util.continuations._
defined module RabbitMQConnectivityTest

scala> import RabbitMQConnectivityTest._
import RabbitMQConnectivityTest._
import RabbitMQConnectivityTest._

scala> import AMQPDefaults._
import AMQPDefaults._
import AMQPDefaults._

scala> import MonadicAMQPUnitTest._
import MonadicAMQPUnitTest._
import MonadicAMQPUnitTest._

scala> import scala.collection.mutable.HashMap
import scala.collection.mutable.HashMap
import scala.collection.mutable.HashMap

scala> val fqn1 = freshQueueName
val fqn1 = freshQueueName
fqn1: String = amqp_db6b2925-23cb-46d3-af1a-8b1ffdc0639b

scala> val ( sma1, jsdnr, jsdsp, msgs ) = setupConnectionApparatus( fqn1,
"10.0.1.9", "10.0.1.5", 100, new HashMap[String,List[Msg]]() )
1.9", "10.0.1.5", 100, new HashMap[String,List[Msg]]() )
sma1:
com.biosimilarity.lift.lib.SMJATwistedPair[com.biosimilarity.lift.lib.usage.MonadicAMQPUnitTest.Msg]
= com.biosimilarity.lift.lib.SMJATwistedPair at 4c900608
jsdnr: net.liftweb.amqp.JSONAMQPSender =
net.liftweb.amqp.JSONAMQPSender at 37c1e7d
jsdsp:
com.biosimilarity.lift.lib.StdMonadicJSONAMQPDispatcher[com.biosimilarity.lift.lib.usage.MonadicAMQPUnitTest.Msg]
= com.biosimilarity.lift.lib.StdMonadicJSONAMQPDispatcher at 49b5a254
msgs:
scala.collection.immutable.Stream[com.biosimilarity.lift.lib.usage.MonadicAMQPUnitTest.Msg]
= Stream(Msg(msg0,0,true,None), ?)

scala> sma1.send( msgs( 89 ) )
sma1.send( msgs( 89 ) )

scala> sma1.send( msgs( 88 ) )
sma1.send( msgs( 88 ) )

scala> net.liftweb.amqp.JSONAMQPSender at 37c1e7d: caught
com.rabbitmq.client.AlreadyClosedException: clean connection shutdown;
reason: Attempt to use closed channel
com.rabbitmq.client.AlreadyClosedException: clean connection shutdown;
reason: Attempt to use closed channel
at com.rabbitmq.client.impl.AMQChannel.ensureIsOpen(AMQChannel.java:181)
at com.rabbitmq.client.impl.AMQChannel.transmit(AMQChannel.java:276)
at com.rabbitmq.client.impl.ChannelN.basicPublish(ChannelN.java:521)
at com.rabbitmq.client.impl.ChannelN.basicPublish(ChannelN.java:507)
at net.liftweb.amqp.AMQPSender.send(AMQPSender.scala:30)
at net.liftweb.amqp.AMQPSender$$anonfun$loop$1.apply(AMQPSender.scala:37)
at net.liftweb.amqp.AMQPSender$$anonfun$loop$1.apply(AMQPSender.scala:36)
at scala.actors.ReactorTask.run(ReactorTask.scala:31)
at scala.actors.Reactor$class.resumeReceiver(Reactor.scala:129)
at
net.liftweb.amqp.AMQPSender.scala$actors$ReplyReactor$$super$resumeReceiver(AMQPSender.scala:15)
at scala.actors.ReplyReactor$class.resumeReceiver(ReplyReactor.scala:68)
at net.liftweb.amqp.AMQPSender.resumeReceiver(AMQPSender.scala:15)
at scala.actors.Actor$class.searchMailbox(Actor.scala:500)
at net.liftweb.amqp.AMQPSender.searchMailbox(AMQPSender.scala:15)
at
scala.actors.Reactor$$anonfun$startSearch$1$$anonfun$apply$mcV$sp$1.apply$mcV$sp(Reactor.scala:117)
at
scala.actors.Reactor$$anonfun$startSearch$1$$anonfun$apply$mcV$sp$1.apply(Reactor.scala:114)
at
scala.actors.Reactor$$anonfun$startSearch$1$$anonfun$apply$mcV$sp$1.apply(Reactor.scala:114)
at scala.actors.ReactorTask.run(ReactorTask.scala:33)
at
scala.concurrent.forkjoin.ForkJoinPool$AdaptedRunnable.exec(ForkJoinPool.java:611)
at scala.concurrent.forkjoin.ForkJoinTask.quietlyExec(ForkJoinTask.java:422)
at
scala.concurrent.forkjoin.ForkJoinWorkerThread.mainLoop(ForkJoinWorkerThread.java:340)
at
scala.concurrent.forkjoin.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:325)


On Tue, Jul 5, 2011 at 10:10 AM, Meredith Gregory
<lgreg.meredith at gmail.com>wrote:

> Dear Rabbitters,
>
> We've got a situation -- it must be quite common -- where, in the simplest
> case, we have two application nodes, call them A and B. RabbitMQ server is
> running on the machines for both A and B. The B node has established it's
> connection to exchange and queue, but does not know whether A has. In the
> case that A has, all is well in the world. When B sends a message to A over
> RabbitMQ, A happily processes it and returns a response message. However, if
> A has not established it's connection to exchange and queue, then if B has
> sent a message to A on this exchange and queue, then when A establishes it's
> connection -- not only does it not see the pending message, the next message
> B sends causes a Java exception to be thrown (see below). Now, we can
> arrange a bit of a handshake to work around this, and have done so. However,
> we'd like to know if there's a better or Rabbitier way of doing this.
>
> Best wishes,
>
> --greg
>
> com.rabbitmq.client.AlreadyClosedException: clean connection shutdown; reason: Attempt to use closed channelscala>
>         at com.rabbitmq.client.impl.AMQChannel.ensureIsOpen(AMQChannel.java:181)
>         at com.rabbitmq.client.impl.AMQChannel.transmit(AMQChannel.java:276)
>         at com.rabbitmq.client.impl.ChannelN.basicPublish(ChannelN.java:521)
>         at com.rabbitmq.client.impl.ChannelN.basicPublish(ChannelN.java:507)
>         at net.liftweb.amqp.AMQPSender.send(AMQPSender.scala:25)
>         at net.liftweb.amqp.AMQPSender$$anonfun$loop$1.apply(AMQPSender.scala:32)
>         at net.liftweb.amqp.AMQPSender$$anonfun$loop$1.apply(AMQPSender.scala:31)
>         at scala.actors.ReactorTask.run(ReactorTask.scala:31)
>         at scala.actors.Reactor$class.resumeReceiver(Reactor.scala:129)
>         at net.liftweb.amqp.AMQPSender.scala$actors$ReplyReactor$$super$resumeReceiver(AMQPSender.scala:15)
>         at scala.actors.ReplyReactor$class.resumeReceiver(ReplyReactor.scala:68)
>         at net.liftweb.amqp.AMQPSender.resumeReceiver(AMQPSender.scala:15)
>         at scala.actors.Actor$class.searchMailbox(Actor.scala:500)
>         at net.liftweb.amqp.AMQPSender.searchMailbox(AMQPSender.scala:15)
>         at scala.actors.Reactor$$anonfun$startSearch$1$$anonfun$apply$mcV$sp$1.apply$mcV$sp(Reactor.scala:117)
>         at scala.actors.Reactor$$anonfun$startSearch$1$$anonfun$apply$mcV$sp$1.apply(Reactor.scala:114)
>         at scala.actors.Reactor$$anonfun$startSearch$1$$anonfun$apply$mcV$sp$1.apply(Reactor.scala:114)
>         at scala.actors.ReactorTask.run(ReactorTask.scala:33)
>         at scala.concurrent.forkjoin.ForkJoinPool$AdaptedRunnable.exec(ForkJoinPool.java:611)
>         at scala.concurrent.forkjoin.ForkJoinTask.quietlyExec(ForkJoinTask.java:422)
>         at scala.concurrent.forkjoin.ForkJoinWorkerThread.mainLoop(ForkJoinWorkerThread.java:340)
>         at scala.concurrent.forkjoin.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:325)
>
>
>
> --
> L.G. Meredith
> Managing Partner
> Biosimilarity LLC
> 7329 39th Ave SW
> Seattle, WA 98136
>
> +1 206.650.3740
>
> http://biosimilarity.blogspot.com
>
>


-- 
L.G. Meredith
Managing Partner
Biosimilarity LLC
7329 39th Ave SW
Seattle, WA 98136

+1 206.650.3740

http://biosimilarity.blogspot.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110707/8cbc5655/attachment.htm>

From michael.s.klishin at gmail.com  Fri Jul  8 08:19:58 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 8 Jul 2011 11:19:58 +0400
Subject: [rabbitmq-discuss] producer/consumer and every n-th message
In-Reply-To: <CABTa2P5ioqjj5J8RtSg6ag2uNVVUZ4o40qsvQx1mxT6=NRk+VA@mail.gmail.com>
References: <CABTa2P5ioqjj5J8RtSg6ag2uNVVUZ4o40qsvQx1mxT6=NRk+VA@mail.gmail.com>
Message-ID: <CAE3HoVSJ0jGjJccwBbt=CoM9yiMA2XAFLV3ou6Dm+tnGBTcSKg@mail.gmail.com>

2011/7/8 Torsten Curdt <tcurdt at vafer.org>

> Hey,
>
> Let's say I have n producers sending messages to an exchange and m
> consumers consuming from a single queue bound to that exchange. When a
> consumer does not acknowledges a message (and dies), the message
> should go back into the queue for another consumer to pick it up.
>
> That should be easy to implement I assume?
>

Yes, AMQP 0.9.1 has this feature built-in. See tutorial 2:

http://www.rabbitmq.com/getstarted.html

and a longer example with multiple consumers in the Ruby amqp gem guide:

http://rubydoc.info/github/ruby-amqp/amqp/master/file/docs/Queues.textile#Message_acknowledgements


> I also assume for this scenario a direct exchange would do?
> How bad would be the contention n and m are fairly large?
> ...or do I just need to have enough broker?
>
>
Sorry, what are n and m? Message acknowledgements have very low overhead and
redeliveries typically do not happen
often enough to create any contention.


> I would also like to be able to "tap into" the stream of messages
> flowing through the exchange. I assume I could use a fanout exchange
> instead. Have the normal queue with the m consumers and a second queue
> with a single consumer "tapping in".
>
> As the throughput of message can potentially be very high (which is
> why there are so many consumers) of course a single consumer cannot
> drain the second queue. So my idea was to only care about every n-th
> message.
>
> Is there a away to tell the fanout consumer to deliver every message
> to Q1 but only every 10th message to Q2?
> How else could one do this?
>
>
Every solution I can think of will require producers to keep track of
message sequences. Take a look at
http://www.rabbitmq.com/extensions.html#sender-selected-distribution.

-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110708/1abc7cc5/attachment.htm>

From tcurdt at vafer.org  Fri Jul  8 09:05:49 2011
From: tcurdt at vafer.org (Torsten Curdt)
Date: Fri, 8 Jul 2011 10:05:49 +0200
Subject: [rabbitmq-discuss] producer/consumer and every n-th message
In-Reply-To: <CAE3HoVSJ0jGjJccwBbt=CoM9yiMA2XAFLV3ou6Dm+tnGBTcSKg@mail.gmail.com>
References: <CABTa2P5ioqjj5J8RtSg6ag2uNVVUZ4o40qsvQx1mxT6=NRk+VA@mail.gmail.com>
	<CAE3HoVSJ0jGjJccwBbt=CoM9yiMA2XAFLV3ou6Dm+tnGBTcSKg@mail.gmail.com>
Message-ID: <CABTa2P7vZzJ9H9RfdcV+zP+gTu4oNNFSTKvheWt5e9yhBy13Kg@mail.gmail.com>

>> That should be easy to implement I assume?
>
> Yes, AMQP 0.9.1 has this feature built-in. See tutorial 2:
>
> http://www.rabbitmq.com/getstarted.html
>
> and a longer example with multiple consumers in the Ruby amqp gem guide:
>
> http://rubydoc.info/github/ruby-amqp/amqp/master/file/docs/Queues.textile#Message_acknowledgements

Great, thanks!

>> I also assume for this scenario a direct exchange would do?
>> How bad would be the contention n and m are fairly large?
>> ...or do I just need to have enough broker?
>>
>
> Sorry, what are n and m?

See above ... the number of producers and consumers.

> Message acknowledgements have very low overhead and
> redeliveries typically do not happen
> often enough to create any contention.

This is more about the fact that many producers and consumers all
share just a single queue.

> Every solution I can think of will require producers to keep track of
> message sequences.

Hm. Is this so uncommon what I am trying to do here? ...consuming only
every n-th message

Another idea could be to create a hash code per message, then use the
modulo of that as the routing key. Not ideal though. And has the
pre-condition that the hashing algorithm produces a good distribution.

One could write his own exchange I assume.
A modified Fanout would probably do the trick.
Just would like to avoid custom code in this area if possible.

> Take a look at http://www.rabbitmq.com/extensions.html#sender-selected-distribution.

Interesting. Thanks for the pointer.

cheers,
Torsten
-- 
http://www.yourdailygeekery.com
http://www.torstencurdt.com

From matthias at rabbitmq.com  Fri Jul  8 09:11:40 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 08 Jul 2011 09:11:40 +0100
Subject: [rabbitmq-discuss] producer/consumer and every n-th message
In-Reply-To: <CABTa2P5ioqjj5J8RtSg6ag2uNVVUZ4o40qsvQx1mxT6=NRk+VA@mail.gmail.com>
References: <CABTa2P5ioqjj5J8RtSg6ag2uNVVUZ4o40qsvQx1mxT6=NRk+VA@mail.gmail.com>
Message-ID: <4E16BBBC.4020805@rabbitmq.com>

Torsten,

On 08/07/11 00:03, Torsten Curdt wrote:
> Let's say I have n producers sending messages to an exchange and m
> consumers consuming from a single queue bound to that exchange. When a
> consumer does not acknowledges a message (and dies), the message
> should go back into the queue for another consumer to pick it up.
>
> That should be easy to implement I assume?

As Michael said, yes, that's easy.

> I also assume for this scenario a direct exchange would do?

Yes.

> How bad would be the contention n and m are fairly large?
> ...or do I just need to have enough broker?

If it's just the *numbers* of producers/consumers that are large, rather 
than the message rates, then you can scale beyond a single broker by 
adding nodes. That does work for coping with increased message rates too 
to a degree, but the single queue will become a bottle neck at some 
point and clustering won't help to overcome that.

> I would also like to be able to "tap into" the stream of messages
> flowing through the exchange. I assume I could use a fanout exchange
> instead. Have the normal queue with the m consumers and a second queue
> with a single consumer "tapping in".

Yep, that would work.


> Is there a away to tell the fanout consumer to deliver every message
> to Q1 but only every 10th message to Q2?

No.

> How else could one do this?

Are you just concerned about the 2nd queue filling up? Then perhaps set 
a message ttl on the queue 
(http://www.rabbitmq.com/extensions.html#queue-ttl). Or use the 
'immediate' flag on publish - though I'd discourage that.


Regards,

Matthias.

From tcurdt at vafer.org  Fri Jul  8 09:31:34 2011
From: tcurdt at vafer.org (Torsten Curdt)
Date: Fri, 8 Jul 2011 10:31:34 +0200
Subject: [rabbitmq-discuss] producer/consumer and every n-th message
In-Reply-To: <4E16BBBC.4020805@rabbitmq.com>
References: <CABTa2P5ioqjj5J8RtSg6ag2uNVVUZ4o40qsvQx1mxT6=NRk+VA@mail.gmail.com>
	<4E16BBBC.4020805@rabbitmq.com>
Message-ID: <CABTa2P7uwwgzk_X-mEa+Zgg-fXtKfPuPZh-VtEGg-C=bLy8=GA@mail.gmail.com>

>> How bad would be the contention n and m are fairly large?
>> ...or do I just need to have enough broker?
>
> If it's just the *numbers* of producers/consumers that are large, rather
> than the message rates, then you can scale beyond a single broker by adding
> nodes. That does work for coping with increased message rates too to a
> degree, but the single queue will become a bottle neck at some point and
> clustering won't help to overcome that.

That's what I thought. But I guess when that happens one could just
create separate "pools" of producers and consumers and just replicate
the setup. Each would have a single queue and that would be fine.

>> Is there a away to tell the fanout consumer to deliver every message
>> to Q1 but only every 10th message to Q2?
>
> No.
>
>> How else could one do this?
>
> Are you just concerned about the 2nd queue filling up? Then perhaps set a
> message ttl on the queue

I am just not sure even just consuming the messages on a single
consumer (and only processing every n-th) will be fast enough. At some
stage one consumer could be just too slow just consuming. Not sure
when that would happen and if that is really is problem - but I would
assume it could become one.

This is about getting a smaller sample of the messages going through
the producer consumer chain. Setting a ttl would probably do the wrong
thing as it would drop the message not uniformly.

cheers,
Torsten
-- 
http://www.yourdailygeekery.com
http://www.torstencurdt.com

From michael.s.klishin at gmail.com  Fri Jul  8 09:36:15 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 8 Jul 2011 12:36:15 +0400
Subject: [rabbitmq-discuss] 406 precondition-failed vs 530 not-allowed on
	exchange declaration
Message-ID: <CAE3HoVS8RzHW6nfJGHKgFKcK5uKA6__jpOcO93H+qhmtQpGDag@mail.gmail.com>

Hi,

An amqp gem user reported seeing 530 not-allowed connection exception when
declaring an exchange. The error message is

?NOT_ALLOWED - cannot redeclare exchange 'jobs' in vhost '/' with different
type, durable or autodelete value?

Do I understand it correctly that this is a permissions issue? We have
plenty of examples of faulty exchange declaration in the amqp gem test
suite,
but they all result in 406 precondition-failed.

The only Java client test that tests 530 exception (according to IntelliJ
IDEA) is this:

https://gist.github.com/1071372

which has nothing to do with permissions or exchanges.

Can someone from the RabbitMQ team please help me understand what is going
on and what scenarios I should be testing in the amqp gem test suite?
Thanks!
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110708/4de0201b/attachment.htm>

From matthias at rabbitmq.com  Fri Jul  8 09:45:08 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 08 Jul 2011 09:45:08 +0100
Subject: [rabbitmq-discuss] 406 precondition-failed vs 530 not-allowed
 on	exchange declaration
In-Reply-To: <CAE3HoVS8RzHW6nfJGHKgFKcK5uKA6__jpOcO93H+qhmtQpGDag@mail.gmail.com>
References: <CAE3HoVS8RzHW6nfJGHKgFKcK5uKA6__jpOcO93H+qhmtQpGDag@mail.gmail.com>
Message-ID: <4E16C394.6030009@rabbitmq.com>

Michael,

On 08/07/11 09:36, Michael Klishin wrote:
> An amqp gem user reported seeing 530 not-allowed connection exception
> when declaring an exchange. The error message is
>
> ?NOT_ALLOWED - cannot redeclare exchange 'jobs' in vhost '/' with
> different type, durable or autodelete value?
>
> Do I understand it correctly that this is a permissions issue? We have
> plenty of examples of faulty exchange declaration in the amqp gem test
> suite,
> but they all result in 406 precondition-failed.

That user must be running an ancient broker, probably pre-2.0.0. The 
error is likely exactly what it says, and not a permission issue. the 
spec was unclear on some of the error codes, so older rabbits returned 
not_allowed in some of these cases. Recent rabbits will return 
precondition_failed.

Matthias.

From matthias at rabbitmq.com  Fri Jul  8 10:30:44 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 08 Jul 2011 10:30:44 +0100
Subject: [rabbitmq-discuss] Reproducible error for remote client -- was
 Re:	Distributed queue setup
In-Reply-To: <CAG7cANS=rfOfuRbvSGJ0ez3Kchd=2aqqzmbUWrQJss5RNvBQKA@mail.gmail.com>
References: <CAG7cANS=rfOfuRbvSGJ0ez3Kchd=2aqqzmbUWrQJss5RNvBQKA@mail.gmail.com>
Message-ID: <4E16CE44.7090107@rabbitmq.com>

Greg,

On 08/07/11 02:17, Meredith Gregory wrote:
> If we have a client from machine B connect to the RabbitMQ broker on
> machine A and then begin sending messages, the broker closes the
> connection unless we fire up a client to connect to the broker on
> machine A to begin reading the messages. The number of messages
> before closure depends on the size of the message. i have a trace
> below.
> [...]
> scala> net.liftweb.amqp.JSONAMQPSender at 37c1e7d: caught
> com.rabbitmq.client.AlreadyClosedException: clean connection shutdown;
> reason: Attempt to use closed channel
> com.rabbitmq.client.AlreadyClosedException: clean connection shutdown;
> reason: Attempt to use closed channel
> at com.rabbitmq.client.impl.AMQChannel.ensureIsOpen(AMQChannel.java:181)
> at com.rabbitmq.client.impl.AMQChannel.transmit(AMQChannel.java:276)
> at com.rabbitmq.client.impl.ChannelN.basicPublish(ChannelN.java:521)
> at com.rabbitmq.client.impl.ChannelN.basicPublish(ChannelN.java:507)
> at net.liftweb.amqp.AMQPSender.send(AMQPSender.scala:30)

When that happens, look at channel.getCloseReason() to get an 
explanation for why the channel was closed. Alternatively, look at the 
broker logs.


Matthias.

From gurpreet.singh.cse08 at itbhu.ac.in  Fri Jul  8 11:42:54 2011
From: gurpreet.singh.cse08 at itbhu.ac.in (GURPREET SINGH)
Date: Fri, 8 Jul 2011 16:12:54 +0530
Subject: [rabbitmq-discuss] RabbitMQ: Implementing "Topic" feature of
	ActiveMQ via RabbitMQ.
Message-ID: <CAHGiV9KE-9sD4P6Caau56qUKHyz2_1JcTWsmwm3cCeZpJ+3jOg@mail.gmail.com>

What I require from usage of RabbitMQ is:
The producer produces messages and receiver receives *all* the messages,
which are published after the time it has first connected to the queue.

Since a consumer wants to consume all the messages published. Since, if more
than one consumer is connected to same queue, then consumers will not
receive all the messages.(Also, see
here<http://stackoverflow.com/questions/1831705/multiple-consumer-one-queue>).
Hence, the consumer must create an *'exclusive'* queue and get connected to
the desired exchange. Also, it wants to receive all the messages which were
published even when it is down ( in the future). Hence the queue is *
'durable'*. Now, the scenario looks like :

A consumer C1 creates a queue Q1 which is exclusive and durable. Now it is
down for some time and in the meantime another user C2 tries to connect to
queue Q1. C2 will be successfull since, Q1 has now no subscriber connected
to it. So, C2 gets connected to the exclusive and durable queue. Now, if C1
tries to connect to queue Q1 it cannot do so, since already a consumer C2 is
subscribed to the queue Q1.

How one can prevent such scenario ?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110708/cf1a7bee/attachment.htm>

From awitbrock at vmware.com  Fri Jul  8 12:23:49 2011
From: awitbrock at vmware.com (Ann Witbrock (c))
Date: Fri, 8 Jul 2011 04:23:49 -0700 (PDT)
Subject: [rabbitmq-discuss] Tutorial example suggestion: work queues
 tutorial could have a description of hierarchical shutdown logic
In-Reply-To: <8A1A883E3F171B42A81817DEC138352C1DB514B8E3@MX06A.corp.emc.com>
Message-ID: <1650896577.11295.1310124229773.JavaMail.root@zimbra-prod-mbox-4.vmware.com>

Hi Lowell,
thanks for the suggestion.
I agree that a tutorial on this (shutdown, auto-delete and similar parameters, and related matters) would be useful, but I don't agree that tutorial is the right place for it. I already have that in as a proposed work item. This example could well be helpful in it.

Ann

----- Original Message -----
From: "Lowell Boggs" <Lowell.Boggs at emc.com>
To: david at rabbitmq.com
Cc: rabbitmq-discuss at lists.rabbitmq.com
Sent: Thursday, 7 July, 2011 4:00:47 PM
Subject: [rabbitmq-discuss] Tutorial example suggestion: work queues tutorial could have a description of hierarchical shutdown logic

Thanks for this great advice.  

I looked for an example of how to handle shutdown and other system commands in this tutorial:

   http://www.rabbitmq.com/tutorials/tutorial-two-python.html

But not finding any advice there, I tried to come up with my own idea based on concepts that I gleaned from the rabbitmq-c interfaces themselves and the tutorial examples.  I see the benefits of your suggestion below.

I would like to suggest that the work queues tutorial is a great place to insert the important information you provided in the attached email about exchange hierarchies.

Note that it would not be necessary to provide example code for this to be a helpful addition.  If you understand the work queues logic, you can understand a description of the shutdown logic without seeing it worked out.  

Also, I have not found (maybe I just haven't looked hard enough) a good explanation of why I should prefer one exchange type over the other.  Direct seems to be doing everything I need.  I am a bit concerned about the performance impact of of using topic name patterns.  The shutdown example you give below would be a nice place in the tutorials to comment on which exchange type is best suited for what.

Thanks again!

Lowell


-----Original Message-----
From: David Wragg [mailto:david at rabbitmq.com] 
Sent: Wednesday, July 06, 2011 5:35 PM
To: Boggs Jr., Lowell
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] rabbitmq-c: amqp_exchange_declare() always sets auto-delete to no

Hi Lowell,

<Lowell.Boggs at emc.com> writes:
> Is there a reason that you cannot create an exchange with the
> auto_delete property == true?

Auto-delete on exchanges is a AMQP 0-8 feature that is deprecated in
AMQP 0-9-1.  This is why the amqp_exchange_declare function does not
expose it (ever since it was converted to AMQP 0-9-1).

> Is it safe for me as an application devloper to create a clone of this
> function that has the auto_delete property passed in?  Does the
> rabbitmq team have plans to change the way the underlying functions
> work?

It is safe, but not a good idea.

rabbitmq-server still supports AMQP 0-8, including the auto-delete
property on exchanges.  So if you copy amqp_exchange_declare and add
that parameter, it will work today.  But at some point, rabbitmq-server
may drop AMQP 0-8 compatibility, and then it would stop working.

> Is a temporary exchange even a good idea?

Not really.

> I am trying to simplify the shutdown logic of a multi-threaded
> application.  I don't want to have to invent a way of signaling my
> worker threads to shut down.  Instead, I want to send them a message
> that they can read like normal but have a quick way of identifying
> that this is a shutdown command. I am currently writing code for my
> threads that work like this:
>
> void Thread()
> {
>
>     // create the connection
>     // declare the primary command exchange
>     // declare the qrimary queue
>     // declare a "stop command" exchange
>     // declare a "stop command" queue
>     // bind everyone up and call basic_consume on the queues
>
>
>     for(;;)
>      {
>         string exchangeName;
>         string topicName;
>         string messageBody;
>
>          int error = readMessage(exchangeName, topicName, messageBody);
>
>          if(error) break;
>
>         if(exchangeName == "stop")
>            break;
>
>        processMesage(messageBody);
>
>     }
> }
>
> Note that I am having multiple threads in multiple executables on
> multiple machines all reading from the same primary command exchange
> for performance and redundancy reasons -- so I can't really use the
> topic to indicate shutdown.  I might want to shutdown a given
> executable on a given host, not the entire system.
>
> The above logic is working fine, but when I kill a process, I have to
> remember to delete the exchanges because they don't have an autoDelete
> flag.
>
> Is there a better way to handle this shutdown logic?

It sounds like you have a hierarchy of threads, processes, and machines.
And you want to send command messages (including shutdown messages) to
the various levels in that hierarchy: To a thread, to all the threads
in a process, to all the threads in all processes on a host, and to all
threads everywhere.

You can accomplish this by declaring four exchanges. Let's call them
"per-thread", "per-process", "per-host" and "everything".

Each thread declares an auto-delete queue for itself, and binds this
queue to all four exchanges, but with different binding keys.

"per-thread" should be a direct exchange.  A thread binds its queue to
this exchange  with a binding key of the form "<host_id>.<process_id>.<thread_id>".

"per-process" should be a direct exchange.  A thread binds its queue to
this exchange with with a binding key of the form
"<host_id>.<process_id>".

"per-host" should be a direct exchange.  A thread binds its queue to
this exchange with with a binding key of the form "<host_id>"

Finally, "everything" can just be a fanout exchange (and so the binding
key is not used).

In order to send a command, use the exchange for the appropriate level
in the hierarchy, and the corresponding routing key.

Because all four exchanges are long lived, your code should not need to
delete any of them.

-- 
David Wragg
Staff Engineer, RabbitMQ
VMware, Inc.
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From m.nacos at gmail.com  Fri Jul  8 14:58:23 2011
From: m.nacos at gmail.com (Michael Nacos)
Date: Fri, 8 Jul 2011 14:58:23 +0100
Subject: [rabbitmq-discuss] Published message not queued after
 publish-ok received when connection quickly closed
In-Reply-To: <CA+1R4g7ERx+36NX=9Kas1nyfY70_9ZV8SNokHEHrW+nEBFMgKA@mail.gmail.com>
References: <BANLkTi=G-sMFmrr_-srSqmo_bSfyw8-w8Q@mail.gmail.com>
	<4DC3C2B7.701@rabbitmq.com>
	<yrv4coc3gt7bt.fsf@dwragg.eng.vmware.com>
	<CA+JR6zMSpkSdsptApw0Mwy1f8hpz2vmxYq_0oT0RgOkcs8WL4g@mail.gmail.com>
	<CA+1R4g7ERx+36NX=9Kas1nyfY70_9ZV8SNokHEHrW+nEBFMgKA@mail.gmail.com>
Message-ID: <CA+JR6zMXTAZOhfE8L5n5D6G__4rzJqpqyXstz+Pr8+aqLFf4PQ@mail.gmail.com>

so, what's currently the best way to publish messages consumed from one
queue into another with the amqp gem? This is quite important in processing
scenaria when no messages may be lost. In particular, is the following code
safe? Will the pseudo-synchronous *publish* call return only after the
message has been accepted in the second queue (:nowait => false)? otherwise,
what would be the point of wrapping the publish call with @channel.tx_select
/ @channel.tx_commit ?

# consumer which publishes each message to another queue
# ------------------------------------------------------

@consume_from = 'first'
@deliver_to = 'second'

EM.run do
  AMQP.connect do |connection|
    @channel = MQ.new(connection)
    # making sure the relevant queues exist
    @queue1 = @channel.queue(@consume_from, :passive => false, :durable =>
true)
    @queue2 = @channel.queue(@deliver_to, :passive => false, :durable =>
true)
    # setting up the consumer loop
    @queue1.subscribe(:ack => true) do |metadata, data|
      @channel.default_exchange.publish(data, \
        :routing_key => @deliver_to, \
        :persistent => true, \
        :nowait => false)
      puts '.'
      metadata.ack
    end
  end
end


2011/7/4 Jakub ??astn? <stastny at 101ideas.cz>

> AMQP 0.8 is available as RC, it's way more stable than 0.7, so I would
> recommend to just use the RC.
>
> Jakub
>
> http://www.flickr.com/photos/jakub-stastny
> http://twitter.com/botanicus
>
>
>
> 2011/7/4 Michael Nacos <m.nacos at gmail.com>
>
>> there seems to be some support for tx_select, tx_commit, tx_rollback in
>> the master branch of the amqp gem, but not in the 0.7.x-stable branch, which
>> is what most people are using
>>
>> 2011/5/6 David Wragg <david at rabbitmq.com>
>>
>>> Simon MacMullen <simon at rabbitmq.com> writes:
>>> > On 05/05/11 22:33, Elias Levy wrote:
>>> >> While writing some code using the Ruby AMQP gem against RabbitMQ, I've
>>> >> noticed that if I publish a message and quickly close the connection,
>>> >> even though I've received a publish-ok response from the server, the
>>> >> message fails to be queued by the broker.
>>> >
>>> > I'm not at all familiar with the Ruby client, but I should point out
>>> > that unlike many of the other AMQP methods, basic.publish does not
>>> > have a corresponding basic.publish-ok method; it's always
>>> > asynchronous. So I imagine the post-publish callback fires
>>> > immediately.
>>> >
>>> > In order to be able to know when the broker has taken responsibility
>>> > for a message you can either wrap the publish in a transaction (when
>>> > you see tx.commit-ok you know the server has the message) or use the
>>> > rather more lightweight publish confirms:
>>> o>
>>> >
>>> http://www.rabbitmq.com/blog/2011/02/10/introducing-publisher-confirms/
>>>
>>> Another way to solve the problem is to do a synchronous AMQP method
>>> rather than abruptly closing the connection.  If this the sync method
>>> completes successfully, you can be sure that your published messages
>>> have reached the broker (it doesn't give you all the guarantees of
>>> transactions, but it is much lighter weight).
>>>
>>> An easy way to do this with all versions of the AMQP gem (even 0.6.7) is
>>> to use the AMQP#close callback.  E.g., add something like this to your
>>> code:
>>>
>>>  client.close { puts "Closed ok" ; EM.stop }
>>>
>>> David
>>>
>>> --
>>> David Wragg
>>> Staff Engineer, RabbitMQ
>>> VMware, Inc.
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110708/7d65315d/attachment.htm>

From Lowell.Boggs at emc.com  Fri Jul  8 15:17:56 2011
From: Lowell.Boggs at emc.com (Lowell.Boggs at emc.com)
Date: Fri, 8 Jul 2011 10:17:56 -0400
Subject: [rabbitmq-discuss] Tutorial example suggestion: work queues
 tutorial could have a description of hierarchical shutdown logic
In-Reply-To: <1650896577.11295.1310124229773.JavaMail.root@zimbra-prod-mbox-4.vmware.com>
References: <8A1A883E3F171B42A81817DEC138352C1DB514B8E3@MX06A.corp.emc.com>
	<1650896577.11295.1310124229773.JavaMail.root@zimbra-prod-mbox-4.vmware.com>
Message-ID: <8A1A883E3F171B42A81817DEC138352C1DB514BA63@MX06A.corp.emc.com>

Thanks Ann,

I understand that you folks have a plan for your tutorials and I respect that.  I am really delighted with the quality of the tutorials and wish to thank you very much for the hard work that you have put in to make them useful.  Even though you don't have a C language tutorial, I was able to quickly and easily create test programs using the C language interfaces based on the contents of the python and java tutorials as examples.

I like the way that the tutorials were activity oriented -- that is, rather than putting in a lot of theory up front, the tutorials jump right in with real world examples and build on top of one another.  This is sort of the Stephen King novel version of tutorials.  He always starts with some sort interesting event and then later goes back fills in the details.  

To carry this metaphor forward, I think that the existing tutorials are great but would benefit from the addition of web links at strategic places in the tutorials to "big picture" theory pages.  For example, one such page might be titled "Exchanges vs Queues".   That page could be structured not as a tutorial but as a reference and practical advice on designing applications to take advantage of the contrasting features of exchanges and queues.  Links to these pages could appear as "see also" links in the other tutorials or as highlighted words, linked to the theory pages, within the existing text (my preference).

Thanks for listening and thanks again for doing such a great job on the tutorials.

Lowell

 

-----Original Message-----
From: Ann Witbrock (c) [mailto:awitbrock at vmware.com] 
Sent: Friday, July 08, 2011 6:24 AM
To: Boggs Jr., Lowell
Cc: rabbitmq-discuss at lists.rabbitmq.com; david at rabbitmq.com
Subject: Re: [rabbitmq-discuss] Tutorial example suggestion: work queues tutorial could have a description of hierarchical shutdown logic

Hi Lowell,
thanks for the suggestion.
I agree that a tutorial on this (shutdown, auto-delete and similar parameters, and related matters) would be useful, but I don't agree that tutorial is the right place for it. I already have that in as a proposed work item. This example could well be helpful in it.

Ann

----- Original Message -----
From: "Lowell Boggs" <Lowell.Boggs at emc.com>
To: david at rabbitmq.com
Cc: rabbitmq-discuss at lists.rabbitmq.com
Sent: Thursday, 7 July, 2011 4:00:47 PM
Subject: [rabbitmq-discuss] Tutorial example suggestion: work queues tutorial could have a description of hierarchical shutdown logic

Thanks for this great advice.  

I looked for an example of how to handle shutdown and other system commands in this tutorial:

   http://www.rabbitmq.com/tutorials/tutorial-two-python.html

But not finding any advice there, I tried to come up with my own idea based on concepts that I gleaned from the rabbitmq-c interfaces themselves and the tutorial examples.  I see the benefits of your suggestion below.

I would like to suggest that the work queues tutorial is a great place to insert the important information you provided in the attached email about exchange hierarchies.

Note that it would not be necessary to provide example code for this to be a helpful addition.  If you understand the work queues logic, you can understand a description of the shutdown logic without seeing it worked out.  

Also, I have not found (maybe I just haven't looked hard enough) a good explanation of why I should prefer one exchange type over the other.  Direct seems to be doing everything I need.  I am a bit concerned about the performance impact of of using topic name patterns.  The shutdown example you give below would be a nice place in the tutorials to comment on which exchange type is best suited for what.

Thanks again!

Lowell


-----Original Message-----
From: David Wragg [mailto:david at rabbitmq.com] 
Sent: Wednesday, July 06, 2011 5:35 PM
To: Boggs Jr., Lowell
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] rabbitmq-c: amqp_exchange_declare() always sets auto-delete to no

Hi Lowell,

<Lowell.Boggs at emc.com> writes:
> Is there a reason that you cannot create an exchange with the
> auto_delete property == true?

Auto-delete on exchanges is a AMQP 0-8 feature that is deprecated in
AMQP 0-9-1.  This is why the amqp_exchange_declare function does not
expose it (ever since it was converted to AMQP 0-9-1).

> Is it safe for me as an application devloper to create a clone of this
> function that has the auto_delete property passed in?  Does the
> rabbitmq team have plans to change the way the underlying functions
> work?

It is safe, but not a good idea.

rabbitmq-server still supports AMQP 0-8, including the auto-delete
property on exchanges.  So if you copy amqp_exchange_declare and add
that parameter, it will work today.  But at some point, rabbitmq-server
may drop AMQP 0-8 compatibility, and then it would stop working.

> Is a temporary exchange even a good idea?

Not really.

> I am trying to simplify the shutdown logic of a multi-threaded
> application.  I don't want to have to invent a way of signaling my
> worker threads to shut down.  Instead, I want to send them a message
> that they can read like normal but have a quick way of identifying
> that this is a shutdown command. I am currently writing code for my
> threads that work like this:
>
> void Thread()
> {
>
>     // create the connection
>     // declare the primary command exchange
>     // declare the qrimary queue
>     // declare a "stop command" exchange
>     // declare a "stop command" queue
>     // bind everyone up and call basic_consume on the queues
>
>
>     for(;;)
>      {
>         string exchangeName;
>         string topicName;
>         string messageBody;
>
>          int error = readMessage(exchangeName, topicName, messageBody);
>
>          if(error) break;
>
>         if(exchangeName == "stop")
>            break;
>
>        processMesage(messageBody);
>
>     }
> }
>
> Note that I am having multiple threads in multiple executables on
> multiple machines all reading from the same primary command exchange
> for performance and redundancy reasons -- so I can't really use the
> topic to indicate shutdown.  I might want to shutdown a given
> executable on a given host, not the entire system.
>
> The above logic is working fine, but when I kill a process, I have to
> remember to delete the exchanges because they don't have an autoDelete
> flag.
>
> Is there a better way to handle this shutdown logic?

It sounds like you have a hierarchy of threads, processes, and machines.
And you want to send command messages (including shutdown messages) to
the various levels in that hierarchy: To a thread, to all the threads
in a process, to all the threads in all processes on a host, and to all
threads everywhere.

You can accomplish this by declaring four exchanges. Let's call them
"per-thread", "per-process", "per-host" and "everything".

Each thread declares an auto-delete queue for itself, and binds this
queue to all four exchanges, but with different binding keys.

"per-thread" should be a direct exchange.  A thread binds its queue to
this exchange  with a binding key of the form "<host_id>.<process_id>.<thread_id>".

"per-process" should be a direct exchange.  A thread binds its queue to
this exchange with with a binding key of the form
"<host_id>.<process_id>".

"per-host" should be a direct exchange.  A thread binds its queue to
this exchange with with a binding key of the form "<host_id>"

Finally, "everything" can just be a fanout exchange (and so the binding
key is not used).

In order to send a command, use the exchange for the appropriate level
in the hierarchy, and the corresponding routing key.

Because all four exchanges are long lived, your code should not need to
delete any of them.

-- 
David Wragg
Staff Engineer, RabbitMQ
VMware, Inc.
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From michael.s.klishin at gmail.com  Fri Jul  8 15:19:07 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 8 Jul 2011 18:19:07 +0400
Subject: [rabbitmq-discuss] Published message not queued after
 publish-ok received when connection quickly closed
In-Reply-To: <CA+JR6zMXTAZOhfE8L5n5D6G__4rzJqpqyXstz+Pr8+aqLFf4PQ@mail.gmail.com>
References: <BANLkTi=G-sMFmrr_-srSqmo_bSfyw8-w8Q@mail.gmail.com>
	<4DC3C2B7.701@rabbitmq.com> <yrv4coc3gt7bt.fsf@dwragg.eng.vmware.com>
	<CA+JR6zMSpkSdsptApw0Mwy1f8hpz2vmxYq_0oT0RgOkcs8WL4g@mail.gmail.com>
	<CA+1R4g7ERx+36NX=9Kas1nyfY70_9ZV8SNokHEHrW+nEBFMgKA@mail.gmail.com>
	<CA+JR6zMXTAZOhfE8L5n5D6G__4rzJqpqyXstz+Pr8+aqLFf4PQ@mail.gmail.com>
Message-ID: <CAE3HoVRt3V_jhNKW5cHCM1eE_KCZ-d5ioJxTjfFo6M4fcxmTEg@mail.gmail.com>

2011/7/8 Michael Nacos <m.nacos at gmail.com>

> so, what's currently the best way to publish messages consumed from one
> queue into another with the amqp gem?
>

Just republish them or take


> This is quite important in processing scenaria when no messages may be
> lost. In particular, is the following code safe? Will the pseudo-synchronous
> *publish* call return only after the message has been accepted in the
> second queue (:nowait => false)? otherwise, what would be the point of
> wrapping the publish call with @channel.tx_select / @channel.tx_commit ?
>

Exchange#publish returns as soon as your data was placed into an outgoing
data buffer. This is documented in detail (including why knowing that you
message was received is impossible without receiving an acknowledgement for
it):

http://rubydoc.info/github/ruby-amqp/amqp/master/file/docs/Exchanges.textile#Publishing_callback__Reliable_delivery_in_distributed_environments

An examples of publishing confirmations extension in action:
https://github.com/ruby-amqp/amqp/blob/master/examples/extensions/rabbitmq/publisher_confirmations_with_transient_messages.rb

I am not sure what "(:nowait => false)" is referring to, can you please
explain?
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110708/993ee5f8/attachment.htm>

From stastny at 101ideas.cz  Fri Jul  8 15:28:40 2011
From: stastny at 101ideas.cz (=?UTF-8?B?SmFrdWIgxaDFpWFzdG7DvQ==?=)
Date: Fri, 8 Jul 2011 16:28:40 +0200
Subject: [rabbitmq-discuss] Published message not queued after
 publish-ok received when connection quickly closed
In-Reply-To: <CA+JR6zMXTAZOhfE8L5n5D6G__4rzJqpqyXstz+Pr8+aqLFf4PQ@mail.gmail.com>
References: <BANLkTi=G-sMFmrr_-srSqmo_bSfyw8-w8Q@mail.gmail.com>
	<4DC3C2B7.701@rabbitmq.com> <yrv4coc3gt7bt.fsf@dwragg.eng.vmware.com>
	<CA+JR6zMSpkSdsptApw0Mwy1f8hpz2vmxYq_0oT0RgOkcs8WL4g@mail.gmail.com>
	<CA+1R4g7ERx+36NX=9Kas1nyfY70_9ZV8SNokHEHrW+nEBFMgKA@mail.gmail.com>
	<CA+JR6zMXTAZOhfE8L5n5D6G__4rzJqpqyXstz+Pr8+aqLFf4PQ@mail.gmail.com>
Message-ID: <CA+1R4g4DLq2bEVg8qoMrfXKObhS4bCmwx6WA3RM_YyO=bxPKow@mail.gmail.com>

Basic.Publish isn't pseudo-synchronous, it's really
asynchronous. Exchange#publish doesn't take nowait option (so no, your code
isn't safe), it simply send the data and that's it. Then you have no idea
whether everything went OK or not. That's why you can use either
transactions (yes, you'd have to wrap the code in it as you've mentioned) or
publisher confirms (which I'd personally prefer as transactions are really
slow and fairly tricky). The documentation for publisher confirms in AMQP
gem is here:
http://rdoc.info/github/ruby-amqp/amqp/master/file/docs/Durability.textile

Jakub

http://www.flickr.com/photos/jakub-stastny
http://twitter.com/botanicus



2011/7/8 Michael Nacos <m.nacos at gmail.com>

> so, what's currently the best way to publish messages consumed from one
> queue into another with the amqp gem? This is quite important in processing
> scenaria when no messages may be lost. In particular, is the following code
> safe? Will the pseudo-synchronous *publish* call return only after the
> message has been accepted in the second queue (:nowait => false)? otherwise,
> what would be the point of wrapping the publish call with @channel.tx_select
> / @channel.tx_commit ?
>
> # consumer which publishes each message to another queue
> # ------------------------------------------------------
>
> @consume_from = 'first'
> @deliver_to = 'second'
>
> EM.run do
>   AMQP.connect do |connection|
>     @channel = MQ.new(connection)
>     # making sure the relevant queues exist
>     @queue1 = @channel.queue(@consume_from, :passive => false, :durable =>
> true)
>     @queue2 = @channel.queue(@deliver_to, :passive => false, :durable =>
> true)
>     # setting up the consumer loop
>     @queue1.subscribe(:ack => true) do |metadata, data|
>       @channel.default_exchange.publish(data, \
>         :routing_key => @deliver_to, \
>         :persistent => true, \
>         :nowait => false)
>       puts '.'
>       metadata.ack
>     end
>   end
> end
>
>
> 2011/7/4 Jakub ??astn? <stastny at 101ideas.cz>
>
>> AMQP 0.8 is available as RC, it's way more stable than 0.7, so I would
>> recommend to just use the RC.
>>
>> Jakub
>>
>> http://www.flickr.com/photos/jakub-stastny
>> http://twitter.com/botanicus
>>
>>
>>
>> 2011/7/4 Michael Nacos <m.nacos at gmail.com>
>>
>>> there seems to be some support for tx_select, tx_commit, tx_rollback in
>>> the master branch of the amqp gem, but not in the 0.7.x-stable branch, which
>>> is what most people are using
>>>
>>> 2011/5/6 David Wragg <david at rabbitmq.com>
>>>
>>>> Simon MacMullen <simon at rabbitmq.com> writes:
>>>> > On 05/05/11 22:33, Elias Levy wrote:
>>>> >> While writing some code using the Ruby AMQP gem against RabbitMQ,
>>>> I've
>>>> >> noticed that if I publish a message and quickly close the connection,
>>>> >> even though I've received a publish-ok response from the server, the
>>>> >> message fails to be queued by the broker.
>>>> >
>>>> > I'm not at all familiar with the Ruby client, but I should point out
>>>> > that unlike many of the other AMQP methods, basic.publish does not
>>>> > have a corresponding basic.publish-ok method; it's always
>>>> > asynchronous. So I imagine the post-publish callback fires
>>>> > immediately.
>>>> >
>>>> > In order to be able to know when the broker has taken responsibility
>>>> > for a message you can either wrap the publish in a transaction (when
>>>> > you see tx.commit-ok you know the server has the message) or use the
>>>> > rather more lightweight publish confirms:
>>>> o>
>>>> >
>>>> http://www.rabbitmq.com/blog/2011/02/10/introducing-publisher-confirms/
>>>>
>>>> Another way to solve the problem is to do a synchronous AMQP method
>>>> rather than abruptly closing the connection.  If this the sync method
>>>> completes successfully, you can be sure that your published messages
>>>> have reached the broker (it doesn't give you all the guarantees of
>>>> transactions, but it is much lighter weight).
>>>>
>>>> An easy way to do this with all versions of the AMQP gem (even 0.6.7) is
>>>> to use the AMQP#close callback.  E.g., add something like this to your
>>>> code:
>>>>
>>>>  client.close { puts "Closed ok" ; EM.stop }
>>>>
>>>> David
>>>>
>>>> --
>>>> David Wragg
>>>> Staff Engineer, RabbitMQ
>>>> VMware, Inc.
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>
>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110708/bb0c4788/attachment.htm>

From michael.s.klishin at gmail.com  Fri Jul  8 15:30:27 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 8 Jul 2011 18:30:27 +0400
Subject: [rabbitmq-discuss] Published message not queued after
 publish-ok received when connection quickly closed
In-Reply-To: <CAE3HoVRt3V_jhNKW5cHCM1eE_KCZ-d5ioJxTjfFo6M4fcxmTEg@mail.gmail.com>
References: <BANLkTi=G-sMFmrr_-srSqmo_bSfyw8-w8Q@mail.gmail.com>
	<4DC3C2B7.701@rabbitmq.com> <yrv4coc3gt7bt.fsf@dwragg.eng.vmware.com>
	<CA+JR6zMSpkSdsptApw0Mwy1f8hpz2vmxYq_0oT0RgOkcs8WL4g@mail.gmail.com>
	<CA+1R4g7ERx+36NX=9Kas1nyfY70_9ZV8SNokHEHrW+nEBFMgKA@mail.gmail.com>
	<CA+JR6zMXTAZOhfE8L5n5D6G__4rzJqpqyXstz+Pr8+aqLFf4PQ@mail.gmail.com>
	<CAE3HoVRt3V_jhNKW5cHCM1eE_KCZ-d5ioJxTjfFo6M4fcxmTEg@mail.gmail.com>
Message-ID: <CAE3HoVQkGNUpaFAbLTe_BZCbdN96wrycprDJjBnFUd=_rNah6Q@mail.gmail.com>

2011/7/8 Michael Klishin <michael.s.klishin at gmail.com>

> 2011/7/8 Michael Nacos <m.nacos at gmail.com>
>
>> so, what's currently the best way to publish messages consumed from one
>> queue into another with the amqp gem?
>>
>
> Just republish them or take
>

Disregard this part. I now understand the question better. With a multi-step
workflow, when one application (A1) consumes messages from one queue,
processes them and publishes the original message or a different one to
another queue, you need to use a combination of features:

1. Explicit message acknowledgements

http://rubydoc.info/github/ruby-amqp/amqp/master/file/docs/Queues.textile#Message_acknowledgements


2. Publisher confirmations

The only way to know that your re-published message is received by the
broker is to receive an acknowledgement from it.
I now realize that documentation section does not provide any code examples.
I will put something together later today.

http://rubydoc.info/github/ruby-amqp/amqp/master/file/docs/Exchanges.textile#Using_Publisher_Confirms_extension_to_AMQP_0_9_1


So A1 would consume a message, process it, republish it and as soon as
publishing confirmation arrives, A1 acknowledges the original one.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110708/b41e7b0e/attachment.htm>

From irrer at umich.edu  Fri Jul  8 15:36:16 2011
From: irrer at umich.edu (Jim Irrer)
Date: Fri, 8 Jul 2011 10:36:16 -0400
Subject: [rabbitmq-discuss] are multiple threads per connection ok for java
	api?
Message-ID: <CAK27CLrGceC4K-tXMkFNCH7ERmuXLSAFkDU74E=PDf=8OP-9Mg@mail.gmail.com>

Hi -

For the Java client API, the RabbitMQ documentation says that
a single channel should not be used by more than one thread, but
it does not explicitly say anything about connections.

Is it ok to have multiple threads (each with their own channel)
sharing the same connection?  Is there some advantage (performance
or otherwise) to using a single connection verses multiple ones?
BTW - I'm assuming that each connection corresponds to a
socket, and so opening lots of them consumes a somewhat limited
system resource.

Thanks,

- Jim

Jim Irrer     irrer at umich.edu       (734) 647-4409
University of Michigan Hospital Radiation Oncology
519 W. William St.             Ann Arbor, MI 48103
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110708/ac9e309c/attachment.htm>

From michael.s.klishin at gmail.com  Fri Jul  8 15:41:58 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 8 Jul 2011 18:41:58 +0400
Subject: [rabbitmq-discuss] Published message not queued after
 publish-ok received when connection quickly closed
In-Reply-To: <CA+JR6zMXTAZOhfE8L5n5D6G__4rzJqpqyXstz+Pr8+aqLFf4PQ@mail.gmail.com>
References: <BANLkTi=G-sMFmrr_-srSqmo_bSfyw8-w8Q@mail.gmail.com>
	<4DC3C2B7.701@rabbitmq.com> <yrv4coc3gt7bt.fsf@dwragg.eng.vmware.com>
	<CA+JR6zMSpkSdsptApw0Mwy1f8hpz2vmxYq_0oT0RgOkcs8WL4g@mail.gmail.com>
	<CA+1R4g7ERx+36NX=9Kas1nyfY70_9ZV8SNokHEHrW+nEBFMgKA@mail.gmail.com>
	<CA+JR6zMXTAZOhfE8L5n5D6G__4rzJqpqyXstz+Pr8+aqLFf4PQ@mail.gmail.com>
Message-ID: <CAE3HoVTi56q3qTTbkHfOvjSK8=tY=KZankHZp5R9eXPiavk6YA@mail.gmail.com>

2011/7/8 Michael Nacos <m.nacos at gmail.com>

> so, what's currently the best way to publish messages consumed from one
> queue into another with the amqp gem? This is quite important in processing
> scenaria when no messages may be lost.


Michael,

Does this piece of code look like what you would like to have? An entity
that consumes messages from one queue and republishes them safely into
another queue, with a way to transform the message?

https://gist.github.com/1071983

This imaginary AMQP::Rebroadcaster is not that difficult to design and add
to the amqp gem for RC14 (will be out in a few weeks after
some more testing with real world apps).
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110708/c5d21733/attachment.htm>

From awitbrock at vmware.com  Fri Jul  8 15:45:08 2011
From: awitbrock at vmware.com (Ann Witbrock (c))
Date: Fri, 8 Jul 2011 07:45:08 -0700 (PDT)
Subject: [rabbitmq-discuss] Tutorial example suggestion: work queues
 tutorial could have a description of hierarchical shutdown logic
In-Reply-To: <8A1A883E3F171B42A81817DEC138352C1DB514BA63@MX06A.corp.emc.com>
Message-ID: <124792446.16843.1310136308331.JavaMail.root@zimbra-prod-mbox-4.vmware.com>

Totally agree. That is exactly what I have in mind for the next two phases of improving the tutorials.
We need a slight restructure of the content flow and uniformity to make it easier to create new tutorials without duplication, meanwhile we have to (drastically) improve our knowledge base (or 'theory') and then we need to tie that in, not just to the tutorials, but across the site. Work on that will start in a month or two.

It's good to know the users have the same hopes for the site ;-)

Thanks for the input.

----- Original Message -----
From: "Boggs Jr., Lowell" <Lowell.Boggs at emc.com>
To: "Ann Witbrock (VMWare)" <awitbrock at vmware.com>
Cc: rabbitmq-discuss at lists.rabbitmq.com, david at rabbitmq.com
Sent: Friday, 8 July, 2011 3:17:56 PM
Subject: RE: [rabbitmq-discuss] Tutorial example suggestion: work queues tutorial could have a description of hierarchical shutdown logic

Thanks Ann,

I understand that you folks have a plan for your tutorials and I respect that.  I am really delighted with the quality of the tutorials and wish to thank you very much for the hard work that you have put in to make them useful.  Even though you don't have a C language tutorial, I was able to quickly and easily create test programs using the C language interfaces based on the contents of the python and java tutorials as examples.

I like the way that the tutorials were activity oriented -- that is, rather than putting in a lot of theory up front, the tutorials jump right in with real world examples and build on top of one another.  This is sort of the Stephen King novel version of tutorials.  He always starts with some sort interesting event and then later goes back fills in the details.  

To carry this metaphor forward, I think that the existing tutorials are great but would benefit from the addition of web links at strategic places in the tutorials to "big picture" theory pages.  For example, one such page might be titled "Exchanges vs Queues".   That page could be structured not as a tutorial but as a reference and practical advice on designing applications to take advantage of the contrasting features of exchanges and queues.  Links to these pages could appear as "see also" links in the other tutorials or as highlighted words, linked to the theory pages, within the existing text (my preference).

Thanks for listening and thanks again for doing such a great job on the tutorials.

Lowell

 

-----Original Message-----
From: Ann Witbrock (c) [mailto:awitbrock at vmware.com] 
Sent: Friday, July 08, 2011 6:24 AM
To: Boggs Jr., Lowell
Cc: rabbitmq-discuss at lists.rabbitmq.com; david at rabbitmq.com
Subject: Re: [rabbitmq-discuss] Tutorial example suggestion: work queues tutorial could have a description of hierarchical shutdown logic

Hi Lowell,
thanks for the suggestion.
I agree that a tutorial on this (shutdown, auto-delete and similar parameters, and related matters) would be useful, but I don't agree that tutorial is the right place for it. I already have that in as a proposed work item. This example could well be helpful in it.

Ann

----- Original Message -----
From: "Lowell Boggs" <Lowell.Boggs at emc.com>
To: david at rabbitmq.com
Cc: rabbitmq-discuss at lists.rabbitmq.com
Sent: Thursday, 7 July, 2011 4:00:47 PM
Subject: [rabbitmq-discuss] Tutorial example suggestion: work queues tutorial could have a description of hierarchical shutdown logic

Thanks for this great advice.  

I looked for an example of how to handle shutdown and other system commands in this tutorial:

   http://www.rabbitmq.com/tutorials/tutorial-two-python.html

But not finding any advice there, I tried to come up with my own idea based on concepts that I gleaned from the rabbitmq-c interfaces themselves and the tutorial examples.  I see the benefits of your suggestion below.

I would like to suggest that the work queues tutorial is a great place to insert the important information you provided in the attached email about exchange hierarchies.

Note that it would not be necessary to provide example code for this to be a helpful addition.  If you understand the work queues logic, you can understand a description of the shutdown logic without seeing it worked out.  

Also, I have not found (maybe I just haven't looked hard enough) a good explanation of why I should prefer one exchange type over the other.  Direct seems to be doing everything I need.  I am a bit concerned about the performance impact of of using topic name patterns.  The shutdown example you give below would be a nice place in the tutorials to comment on which exchange type is best suited for what.

Thanks again!

Lowell


-----Original Message-----
From: David Wragg [mailto:david at rabbitmq.com] 
Sent: Wednesday, July 06, 2011 5:35 PM
To: Boggs Jr., Lowell
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] rabbitmq-c: amqp_exchange_declare() always sets auto-delete to no

Hi Lowell,

<Lowell.Boggs at emc.com> writes:
> Is there a reason that you cannot create an exchange with the
> auto_delete property == true?

Auto-delete on exchanges is a AMQP 0-8 feature that is deprecated in
AMQP 0-9-1.  This is why the amqp_exchange_declare function does not
expose it (ever since it was converted to AMQP 0-9-1).

> Is it safe for me as an application devloper to create a clone of this
> function that has the auto_delete property passed in?  Does the
> rabbitmq team have plans to change the way the underlying functions
> work?

It is safe, but not a good idea.

rabbitmq-server still supports AMQP 0-8, including the auto-delete
property on exchanges.  So if you copy amqp_exchange_declare and add
that parameter, it will work today.  But at some point, rabbitmq-server
may drop AMQP 0-8 compatibility, and then it would stop working.

> Is a temporary exchange even a good idea?

Not really.

> I am trying to simplify the shutdown logic of a multi-threaded
> application.  I don't want to have to invent a way of signaling my
> worker threads to shut down.  Instead, I want to send them a message
> that they can read like normal but have a quick way of identifying
> that this is a shutdown command. I am currently writing code for my
> threads that work like this:
>
> void Thread()
> {
>
>     // create the connection
>     // declare the primary command exchange
>     // declare the qrimary queue
>     // declare a "stop command" exchange
>     // declare a "stop command" queue
>     // bind everyone up and call basic_consume on the queues
>
>
>     for(;;)
>      {
>         string exchangeName;
>         string topicName;
>         string messageBody;
>
>          int error = readMessage(exchangeName, topicName, messageBody);
>
>          if(error) break;
>
>         if(exchangeName == "stop")
>            break;
>
>        processMesage(messageBody);
>
>     }
> }
>
> Note that I am having multiple threads in multiple executables on
> multiple machines all reading from the same primary command exchange
> for performance and redundancy reasons -- so I can't really use the
> topic to indicate shutdown.  I might want to shutdown a given
> executable on a given host, not the entire system.
>
> The above logic is working fine, but when I kill a process, I have to
> remember to delete the exchanges because they don't have an autoDelete
> flag.
>
> Is there a better way to handle this shutdown logic?

It sounds like you have a hierarchy of threads, processes, and machines.
And you want to send command messages (including shutdown messages) to
the various levels in that hierarchy: To a thread, to all the threads
in a process, to all the threads in all processes on a host, and to all
threads everywhere.

You can accomplish this by declaring four exchanges. Let's call them
"per-thread", "per-process", "per-host" and "everything".

Each thread declares an auto-delete queue for itself, and binds this
queue to all four exchanges, but with different binding keys.

"per-thread" should be a direct exchange.  A thread binds its queue to
this exchange  with a binding key of the form "<host_id>.<process_id>.<thread_id>".

"per-process" should be a direct exchange.  A thread binds its queue to
this exchange with with a binding key of the form
"<host_id>.<process_id>".

"per-host" should be a direct exchange.  A thread binds its queue to
this exchange with with a binding key of the form "<host_id>"

Finally, "everything" can just be a fanout exchange (and so the binding
key is not used).

In order to send a command, use the exchange for the appropriate level
in the hierarchy, and the corresponding routing key.

Because all four exchanges are long lived, your code should not need to
delete any of them.

-- 
David Wragg
Staff Engineer, RabbitMQ
VMware, Inc.
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From m.nacos at gmail.com  Fri Jul  8 16:16:38 2011
From: m.nacos at gmail.com (Michael Nacos)
Date: Fri, 8 Jul 2011 16:16:38 +0100
Subject: [rabbitmq-discuss] Published message not queued after
 publish-ok received when connection quickly closed
In-Reply-To: <CA+1R4g4DLq2bEVg8qoMrfXKObhS4bCmwx6WA3RM_YyO=bxPKow@mail.gmail.com>
References: <BANLkTi=G-sMFmrr_-srSqmo_bSfyw8-w8Q@mail.gmail.com>
	<4DC3C2B7.701@rabbitmq.com>
	<yrv4coc3gt7bt.fsf@dwragg.eng.vmware.com>
	<CA+JR6zMSpkSdsptApw0Mwy1f8hpz2vmxYq_0oT0RgOkcs8WL4g@mail.gmail.com>
	<CA+1R4g7ERx+36NX=9Kas1nyfY70_9ZV8SNokHEHrW+nEBFMgKA@mail.gmail.com>
	<CA+JR6zMXTAZOhfE8L5n5D6G__4rzJqpqyXstz+Pr8+aqLFf4PQ@mail.gmail.com>
	<CA+1R4g4DLq2bEVg8qoMrfXKObhS4bCmwx6WA3RM_YyO=bxPKow@mail.gmail.com>
Message-ID: <CA+JR6zMAtcQrEXqCH+pXb3+HGQ3gV=sFHxZO=C_=Tpo1JYhoMQ@mail.gmail.com>

so if the publish call returns immediately with no guarantees, what's the
point of adding a @channel.tx_commit right after it? the question becomes
how do I get a reliable publish ack to base the tx_commit/metadata.ack on

I saw this in the docs for publisher confirms:

# define a callback that will be executed when message is
acknowledgedchannel.on_ack do |basic_ack|
  puts "Received an acknowledgement: delivery_tag =
#{basic_ack.delivery_tag}, multiple = #{basic_ack.multiple}"end

which is great, but how does it fit within the consume loop? I need
execution to block until it's safe to issue the metadata.ack call. Is this
something I can achieve with eventmachine?

2011/7/8 Jakub ??astn? <stastny at 101ideas.cz>

> Basic.Publish isn't pseudo-synchronous, it's really
> asynchronous. Exchange#publish doesn't take nowait option (so no, your code
> isn't safe), it simply send the data and that's it. Then you have no idea
> whether everything went OK or not. That's why you can use either
> transactions (yes, you'd have to wrap the code in it as you've mentioned) or
> publisher confirms (which I'd personally prefer as transactions are really
> slow and fairly tricky). The documentation for publisher confirms in AMQP
> gem is here:
> http://rdoc.info/github/ruby-amqp/amqp/master/file/docs/Durability.textile
>
> Jakub
>
> http://www.flickr.com/photos/jakub-stastny
> http://twitter.com/botanicus
>
>
>
> 2011/7/8 Michael Nacos <m.nacos at gmail.com>
>
>> so, what's currently the best way to publish messages consumed from one
>> queue into another with the amqp gem? This is quite important in processing
>> scenaria when no messages may be lost. In particular, is the following code
>> safe? Will the pseudo-synchronous *publish* call return only after the
>> message has been accepted in the second queue (:nowait => false)? otherwise,
>> what would be the point of wrapping the publish call with @channel.tx_select
>> / @channel.tx_commit ?
>>
>> # consumer which publishes each message to another queue
>> # ------------------------------------------------------
>>
>> @consume_from = 'first'
>> @deliver_to = 'second'
>>
>> EM.run do
>>   AMQP.connect do |connection|
>>     @channel = MQ.new(connection)
>>     # making sure the relevant queues exist
>>     @queue1 = @channel.queue(@consume_from, :passive => false, :durable =>
>> true)
>>     @queue2 = @channel.queue(@deliver_to, :passive => false, :durable =>
>> true)
>>     # setting up the consumer loop
>>     @queue1.subscribe(:ack => true) do |metadata, data|
>>       @channel.default_exchange.publish(data, \
>>         :routing_key => @deliver_to, \
>>         :persistent => true, \
>>         :nowait => false)
>>       puts '.'
>>       metadata.ack
>>     end
>>   end
>> end
>>
>>
>> 2011/7/4 Jakub ??astn? <stastny at 101ideas.cz>
>>
>>> AMQP 0.8 is available as RC, it's way more stable than 0.7, so I would
>>> recommend to just use the RC.
>>>
>>> Jakub
>>>
>>> http://www.flickr.com/photos/jakub-stastny
>>> http://twitter.com/botanicus
>>>
>>>
>>>
>>> 2011/7/4 Michael Nacos <m.nacos at gmail.com>
>>>
>>>> there seems to be some support for tx_select, tx_commit, tx_rollback in
>>>> the master branch of the amqp gem, but not in the 0.7.x-stable branch, which
>>>> is what most people are using
>>>>
>>>> 2011/5/6 David Wragg <david at rabbitmq.com>
>>>>
>>>>> Simon MacMullen <simon at rabbitmq.com> writes:
>>>>> > On 05/05/11 22:33, Elias Levy wrote:
>>>>> >> While writing some code using the Ruby AMQP gem against RabbitMQ,
>>>>> I've
>>>>> >> noticed that if I publish a message and quickly close the
>>>>> connection,
>>>>> >> even though I've received a publish-ok response from the server, the
>>>>> >> message fails to be queued by the broker.
>>>>> >
>>>>> > I'm not at all familiar with the Ruby client, but I should point out
>>>>> > that unlike many of the other AMQP methods, basic.publish does not
>>>>> > have a corresponding basic.publish-ok method; it's always
>>>>> > asynchronous. So I imagine the post-publish callback fires
>>>>> > immediately.
>>>>> >
>>>>> > In order to be able to know when the broker has taken responsibility
>>>>> > for a message you can either wrap the publish in a transaction (when
>>>>> > you see tx.commit-ok you know the server has the message) or use the
>>>>> > rather more lightweight publish confirms:
>>>>> o>
>>>>> >
>>>>> http://www.rabbitmq.com/blog/2011/02/10/introducing-publisher-confirms/
>>>>>
>>>>> Another way to solve the problem is to do a synchronous AMQP method
>>>>> rather than abruptly closing the connection.  If this the sync method
>>>>> completes successfully, you can be sure that your published messages
>>>>> have reached the broker (it doesn't give you all the guarantees of
>>>>> transactions, but it is much lighter weight).
>>>>>
>>>>> An easy way to do this with all versions of the AMQP gem (even 0.6.7)
>>>>> is
>>>>> to use the AMQP#close callback.  E.g., add something like this to your
>>>>> code:
>>>>>
>>>>>  client.close { puts "Closed ok" ; EM.stop }
>>>>>
>>>>> David
>>>>>
>>>>> --
>>>>> David Wragg
>>>>> Staff Engineer, RabbitMQ
>>>>> VMware, Inc.
>>>>> _______________________________________________
>>>>> rabbitmq-discuss mailing list
>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>>
>>>>
>>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110708/9d885563/attachment.htm>

From michael.s.klishin at gmail.com  Fri Jul  8 16:16:29 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 8 Jul 2011 19:16:29 +0400
Subject: [rabbitmq-discuss] are multiple threads per connection ok for
 java api?
In-Reply-To: <CAK27CLrGceC4K-tXMkFNCH7ERmuXLSAFkDU74E=PDf=8OP-9Mg@mail.gmail.com>
References: <CAK27CLrGceC4K-tXMkFNCH7ERmuXLSAFkDU74E=PDf=8OP-9Mg@mail.gmail.com>
Message-ID: <CAE3HoVRjLf5gE=FpjCoWiqR4ASsgKK9OOURuC=t9mEXa6AOOgw@mail.gmail.com>

2011/7/8 Jim Irrer <irrer at umich.edu>

> For the Java client API, the RabbitMQ documentation says that
> a single channel should not be used by more than one thread, but
> it does not explicitly say anything about connections.
>
>
AMQP assumes that one connection is typically used by more than one channel.
So


> Is it ok to have multiple threads (each with their own channel)
> sharing the same connection?
>

if channels are not shared between threads, then yes.


> Is there some advantage (performance
> or otherwise) to using a single connection verses multiple ones?
>

If all connections use the same credentials and connect to the same
broker/vhost, then no
(this should read: in vast majority of cases, no).


>  BTW - I'm assuming that each connection corresponds to a
> socket, and so opening lots of them consumes a somewhat limited
> system resource.
>

Long story short, this is true. Each connection has a frame handler that
opens a new socket.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110708/a5323b43/attachment.htm>

From gswallow at exacttarget.com  Fri Jul  8 16:17:10 2011
From: gswallow at exacttarget.com (Greg Swallow)
Date: Fri, 8 Jul 2011 11:17:10 -0400
Subject: [rabbitmq-discuss] Plugin filenames
In-Reply-To: <20110629151905.GA5894@rabbitmq.com>
References: <567A8770-35D1-4B31-9DC2-C0D01B32F576@exacttarget.com>
	<20110629151905.GA5894@rabbitmq.com>
Message-ID: <5662914C-0D52-45E5-AD6A-39307AA87EF6@exacttarget.com>

Hrm. Well, there's always the almighty symlink.

On Jun 29, 2011, at 11:19 AM, Matthew Sackman wrote:

On Wed, Jun 29, 2011 at 10:28:35AM -0400, Greg Swallow wrote:
The first plugin I try to install is mochiweb.  It fails because the
mochiweb plugin is named
mochiweb-1.3-rmq2.5.0-git9a53dbd.ez<http://www.rabbitmq.com/releases/plugins/v2.5.0/mochiweb-1.3-rmq2.5.0-git9a53dbd.ez>.

I can modify my cookbook to store plugins and their filenames as a
hash.  However, could you guys consider creating predictable plugin
filenames in the future?

Ahh, but they are entirely predictable.

Things like mochiweb present a problem because to give them just the
Rabbit version is misleading. Equally we can't just use the upstream
version because in some cases we patch some upstream code. So as a
result we do -$upstream_ver-rmq$rabbit_ver-$hg_or_git$short_hash where
the hash is grabbed from hg or git, as per:

ifdef UPSTREAM_GIT
echo UPSTREAM_SHORT_HASH:=`git --git-dir=$(CLONE_DIR)/.git log -n 1 HEAD | grep commit | cut -b 8-14` >$$@
endif
ifdef UPSTREAM_HG
echo UPSTREAM_SHORT_HASH:=`hg id -R $(CLONE_DIR) -i | cut -c -7` >$$@
endif

This allows us to make it clear which versions of upstream projects
we're shipping, which is important for many reasons, not least of which
is the ability to identify the status of bugs uncovered and so forth.

Really, I wonder whether you might be better off trying to semantically
understand http://www.rabbitmq.com/plugins.html such that by scraping
that, you can figure out what plugins are available, and what their
dependencies are. Utterly gross, I know, but I can't think of a better
solution atm.

Matthew

ExactTarget
Greg Swallow
System Administrator
Phone | 317 524-5250
Yahoo IM | gswallow01
Email  | gswallow at exacttarget.com<mailto:gswallow at exacttarget.com>



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110708/7ea04819/attachment.htm>

From m.nacos at gmail.com  Fri Jul  8 16:17:47 2011
From: m.nacos at gmail.com (Michael Nacos)
Date: Fri, 8 Jul 2011 16:17:47 +0100
Subject: [rabbitmq-discuss] Published message not queued after
 publish-ok received when connection quickly closed
In-Reply-To: <CAE3HoVTi56q3qTTbkHfOvjSK8=tY=KZankHZp5R9eXPiavk6YA@mail.gmail.com>
References: <BANLkTi=G-sMFmrr_-srSqmo_bSfyw8-w8Q@mail.gmail.com>
	<4DC3C2B7.701@rabbitmq.com>
	<yrv4coc3gt7bt.fsf@dwragg.eng.vmware.com>
	<CA+JR6zMSpkSdsptApw0Mwy1f8hpz2vmxYq_0oT0RgOkcs8WL4g@mail.gmail.com>
	<CA+1R4g7ERx+36NX=9Kas1nyfY70_9ZV8SNokHEHrW+nEBFMgKA@mail.gmail.com>
	<CA+JR6zMXTAZOhfE8L5n5D6G__4rzJqpqyXstz+Pr8+aqLFf4PQ@mail.gmail.com>
	<CAE3HoVTi56q3qTTbkHfOvjSK8=tY=KZankHZp5R9eXPiavk6YA@mail.gmail.com>
Message-ID: <CA+JR6zNfOv_PTT3EcJAJ+tN=1TCDOrqadP341VLqCx0Gdu4s4Q@mail.gmail.com>

Michael, something like this would be fantastic (and less code to maintain
on my part). any chance of it getting into the RC14?

On 8 July 2011 15:41, Michael Klishin <michael.s.klishin at gmail.com> wrote:

> 2011/7/8 Michael Nacos <m.nacos at gmail.com>
>
>> so, what's currently the best way to publish messages consumed from one
>> queue into another with the amqp gem? This is quite important in processing
>> scenaria when no messages may be lost.
>
>
> Michael,
>
> Does this piece of code look like what you would like to have? An entity
> that consumes messages from one queue and republishes them safely into
> another queue, with a way to transform the message?
>
> https://gist.github.com/1071983
>
> This imaginary AMQP::Rebroadcaster is not that difficult to design and add
> to the amqp gem for RC14 (will be out in a few weeks after
> some more testing with real world apps).
>
> --
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110708/a1a5e46a/attachment.htm>

From stastny at 101ideas.cz  Fri Jul  8 16:32:10 2011
From: stastny at 101ideas.cz (Stastny Jakub)
Date: Fri, 8 Jul 2011 16:32:10 +0100
Subject: [rabbitmq-discuss] Published message not queued after
	publish-ok received when connection quickly closed
In-Reply-To: <CA+JR6zMAtcQrEXqCH+pXb3+HGQ3gV=sFHxZO=C_=Tpo1JYhoMQ@mail.gmail.com>
References: <BANLkTi=G-sMFmrr_-srSqmo_bSfyw8-w8Q@mail.gmail.com>
	<4DC3C2B7.701@rabbitmq.com>
	<yrv4coc3gt7bt.fsf@dwragg.eng.vmware.com>
	<CA+JR6zMSpkSdsptApw0Mwy1f8hpz2vmxYq_0oT0RgOkcs8WL4g@mail.gmail.com>
	<CA+1R4g7ERx+36NX=9Kas1nyfY70_9ZV8SNokHEHrW+nEBFMgKA@mail.gmail.com>
	<CA+JR6zMXTAZOhfE8L5n5D6G__4rzJqpqyXstz+Pr8+aqLFf4PQ@mail.gmail.com>
	<CA+1R4g4DLq2bEVg8qoMrfXKObhS4bCmwx6WA3RM_YyO=bxPKow@mail.gmail.com>
	<CA+JR6zMAtcQrEXqCH+pXb3+HGQ3gV=sFHxZO=C_=Tpo1JYhoMQ@mail.gmail.com>
Message-ID: <314D419E-FDDC-4AA9-84C5-3E8EA4230D62@101ideas.cz>

El 8 Jul 2011, a las 16:16, Michael Nacos escribi?:

> so if the publish call returns immediately with no guarantees, what's the point of adding a @channel.tx_commit right after it?

Transactions are mainly atomicity, so if you publish more messages, then running it in a transactions will result in saving all or nothing (and getting an error back). Using it for one item will result in getting the error back, so you'll know if it went wrong (I think, I don't have much experience with them).

The docs:

"The Tx class allows publish and ack operations to be batched into atomic units of work. The intention is that all publish and ack requests issued within a transaction will complete successfully or none of them will. Servers SHOULD implement atomic transactions at least where all publish or ack requests affect a single queue. Transactions that cover multiple queues may be non atomic, given that queues can be created and destroyed asynchronously, and such events do not form part of any transaction."

> the question becomes how do I get a reliable publish ack to base the tx_commit/metadata.ack on
> 
> I saw this in the docs for publisher confirms:
> 
> # define a callback that will be executed when message is acknowledged
> channel.on_ack do |basic_ack|
>   puts "Received an acknowledgement: delivery_tag = #{basic_ack.delivery_tag}, multiple = #{basic_ack.multiple}"
> end
> which is great, but how does it fit within the consume loop? I need execution to block until it's safe to issue the metadata.ack call. Is this something I can achieve with eventmachine?

I'm not sure if I understand ... this is a callback, it doesn't block as well as #subscribe, it's a callback called when a message is delivered to the client. EventMachine is an implementation of reactor pattern (it means it's async). So it works based on events (when I get this, do that ... ). BTW just to make sure, do you know that this on_ack is for ack which the *broker* sends? So you don't call metadata.ack for this (you ack messages when they're actually processed on the consumer).

Cheers,

Jakub

> 2011/7/8 Jakub ??astn? <stastny at 101ideas.cz>
> Basic.Publish isn't pseudo-synchronous, it's really asynchronous. Exchange#publish doesn't take nowait option (so no, your code isn't safe), it simply send the data and that's it. Then you have no idea whether everything went OK or not. That's why you can use either transactions (yes, you'd have to wrap the code in it as you've mentioned) or publisher confirms (which I'd personally prefer as transactions are really slow and fairly tricky). The documentation for publisher confirms in AMQP gem is here: http://rdoc.info/github/ruby-amqp/amqp/master/file/docs/Durability.textile
> 
> Jakub
> 
> http://www.flickr.com/photos/jakub-stastny
> http://twitter.com/botanicus
> 
> 
> 
> 2011/7/8 Michael Nacos <m.nacos at gmail.com>
> so, what's currently the best way to publish messages consumed from one queue into another with the amqp gem? This is quite important in processing scenaria when no messages may be lost. In particular, is the following code safe? Will the pseudo-synchronous publish call return only after the message has been accepted in the second queue (:nowait => false)? otherwise, what would be the point of wrapping the publish call with @channel.tx_select / @channel.tx_commit ?
> 
> # consumer which publishes each message to another queue
> # ------------------------------------------------------
> 
> @consume_from = 'first'
> @deliver_to = 'second'
> 
> EM.run do
>   AMQP.connect do |connection|
>     @channel = MQ.new(connection)
>     # making sure the relevant queues exist
>     @queue1 = @channel.queue(@consume_from, :passive => false, :durable => true)
>     @queue2 = @channel.queue(@deliver_to, :passive => false, :durable => true)
>     # setting up the consumer loop
>     @queue1.subscribe(:ack => true) do |metadata, data|
>       @channel.default_exchange.publish(data, \
>         :routing_key => @deliver_to, \
>         :persistent => true, \
>         :nowait => false)
>       puts '.'
>       metadata.ack
>     end
>   end
> end
> 
> 2011/7/4 Jakub ??astn? <stastny at 101ideas.cz>
> AMQP 0.8 is available as RC, it's way more stable than 0.7, so I would recommend to just use the RC.
> 
> Jakub
> 
> http://www.flickr.com/photos/jakub-stastny
> http://twitter.com/botanicus
> 
> 
> 
> 2011/7/4 Michael Nacos <m.nacos at gmail.com>
> there seems to be some support for tx_select, tx_commit, tx_rollback in the master branch of the amqp gem, but not in the 0.7.x-stable branch, which is what most people are using
> 
> 2011/5/6 David Wragg <david at rabbitmq.com>
> Simon MacMullen <simon at rabbitmq.com> writes:
> > On 05/05/11 22:33, Elias Levy wrote:
> >> While writing some code using the Ruby AMQP gem against RabbitMQ, I've
> >> noticed that if I publish a message and quickly close the connection,
> >> even though I've received a publish-ok response from the server, the
> >> message fails to be queued by the broker.
> >
> > I'm not at all familiar with the Ruby client, but I should point out
> > that unlike many of the other AMQP methods, basic.publish does not
> > have a corresponding basic.publish-ok method; it's always
> > asynchronous. So I imagine the post-publish callback fires
> > immediately.
> >
> > In order to be able to know when the broker has taken responsibility
> > for a message you can either wrap the publish in a transaction (when
> > you see tx.commit-ok you know the server has the message) or use the
> > rather more lightweight publish confirms:
> o>
> > http://www.rabbitmq.com/blog/2011/02/10/introducing-publisher-confirms/
> 
> Another way to solve the problem is to do a synchronous AMQP method
> rather than abruptly closing the connection.  If this the sync method
> completes successfully, you can be sure that your published messages
> have reached the broker (it doesn't give you all the guarantees of
> transactions, but it is much lighter weight).
> 
> An easy way to do this with all versions of the AMQP gem (even 0.6.7) is
> to use the AMQP#close callback.  E.g., add something like this to your
> code:
> 
>  client.close { puts "Closed ok" ; EM.stop }
> 
> David
> 
> --
> David Wragg
> Staff Engineer, RabbitMQ
> VMware, Inc.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> 
> 
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110708/5e5d69a8/attachment.htm>

From michael.s.klishin at gmail.com  Fri Jul  8 16:33:59 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 8 Jul 2011 19:33:59 +0400
Subject: [rabbitmq-discuss] Tutorial example suggestion: work queues
 tutorial could have a description of hierarchical shutdown logic
In-Reply-To: <124792446.16843.1310136308331.JavaMail.root@zimbra-prod-mbox-4.vmware.com>
References: <8A1A883E3F171B42A81817DEC138352C1DB514BA63@MX06A.corp.emc.com>
	<124792446.16843.1310136308331.JavaMail.root@zimbra-prod-mbox-4.vmware.com>
Message-ID: <CAE3HoVR8d86zgOMwWbGThj5z9ezo_2TrJbbvT9oMphKpYmj3cQ@mail.gmail.com>

2011/7/8 Ann Witbrock (c) <awitbrock at vmware.com>

> We need a slight restructure of the content flow and uniformity to make it
> easier to create new tutorials without duplication, meanwhile we have to
> (drastically) improve our knowledge base (or 'theory') and then we need to
> tie that in, not just to the tutorials, but across the site. Work on that
> will start in a month or two.
>
> It's good to know the users have the same hopes for the site ;-)
>

Ann,

I have plenty of suggestions about the docs (mostly based on what does and
doesn't work for me in amqp gem documentation and kind of questions I have
to answer over and over in #rabbitmq on IRC). Do I send them as soon as I
compile them in one specific enough list or in a month or two? :) and where?
just post them here?

-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110708/8ecb2e00/attachment.htm>

From irrer at umich.edu  Fri Jul  8 16:42:28 2011
From: irrer at umich.edu (Jim Irrer)
Date: Fri, 8 Jul 2011 11:42:28 -0400
Subject: [rabbitmq-discuss] are multiple threads per connection ok for
 java api?
In-Reply-To: <CAE3HoVRjLf5gE=FpjCoWiqR4ASsgKK9OOURuC=t9mEXa6AOOgw@mail.gmail.com>
References: <CAK27CLrGceC4K-tXMkFNCH7ERmuXLSAFkDU74E=PDf=8OP-9Mg@mail.gmail.com>
	<CAE3HoVRjLf5gE=FpjCoWiqR4ASsgKK9OOURuC=t9mEXa6AOOgw@mail.gmail.com>
Message-ID: <CAK27CLraSjSqXzpoC7=3wJD_q3ti6J=tOfEx9cGKFs+QfjAT-w@mail.gmail.com>

Excellent - thanks for the response.

- Jim

Jim Irrer     irrer at umich.edu       (734) 647-4409
University of Michigan Hospital Radiation Oncology
519 W. William St.             Ann Arbor, MI 48103


On Fri, Jul 8, 2011 at 11:16 AM, Michael Klishin <
michael.s.klishin at gmail.com> wrote:

>
>
> 2011/7/8 Jim Irrer <irrer at umich.edu>
>
>> For the Java client API, the RabbitMQ documentation says that
>> a single channel should not be used by more than one thread, but
>> it does not explicitly say anything about connections.
>>
>>
> AMQP assumes that one connection is typically used by more than one
> channel. So
>
>
>> Is it ok to have multiple threads (each with their own channel)
>> sharing the same connection?
>>
>
> if channels are not shared between threads, then yes.
>
>
>> Is there some advantage (performance
>> or otherwise) to using a single connection verses multiple ones?
>>
>
> If all connections use the same credentials and connect to the same
> broker/vhost, then no
> (this should read: in vast majority of cases, no).
>
>
>>  BTW - I'm assuming that each connection corresponds to a
>> socket, and so opening lots of them consumes a somewhat limited
>> system resource.
>>
>
> Long story short, this is true. Each connection has a frame handler that
> opens a new socket.
>  --
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110708/93a240bd/attachment.htm>

From michael.s.klishin at gmail.com  Fri Jul  8 16:56:22 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 8 Jul 2011 19:56:22 +0400
Subject: [rabbitmq-discuss] Published message not queued after
 publish-ok received when connection quickly closed
In-Reply-To: <CA+JR6zMAtcQrEXqCH+pXb3+HGQ3gV=sFHxZO=C_=Tpo1JYhoMQ@mail.gmail.com>
References: <BANLkTi=G-sMFmrr_-srSqmo_bSfyw8-w8Q@mail.gmail.com>
	<4DC3C2B7.701@rabbitmq.com> <yrv4coc3gt7bt.fsf@dwragg.eng.vmware.com>
	<CA+JR6zMSpkSdsptApw0Mwy1f8hpz2vmxYq_0oT0RgOkcs8WL4g@mail.gmail.com>
	<CA+1R4g7ERx+36NX=9Kas1nyfY70_9ZV8SNokHEHrW+nEBFMgKA@mail.gmail.com>
	<CA+JR6zMXTAZOhfE8L5n5D6G__4rzJqpqyXstz+Pr8+aqLFf4PQ@mail.gmail.com>
	<CA+1R4g4DLq2bEVg8qoMrfXKObhS4bCmwx6WA3RM_YyO=bxPKow@mail.gmail.com>
	<CA+JR6zMAtcQrEXqCH+pXb3+HGQ3gV=sFHxZO=C_=Tpo1JYhoMQ@mail.gmail.com>
Message-ID: <CAE3HoVQs43FkiXHJhNQGP8D2sq8E2CDsPSvvkbr9vBn9=fDoAg@mail.gmail.com>

2011/7/8 Michael Nacos <m.nacos at gmail.com>

> which is great, but how does it fit within the consume loop? I need
> execution to block until it's safe to issue the metadata.ack call. Is this
> something I can achieve with eventmachine?



Yes. You can use EventMachine::Deferrable for that. I can't explain how
without sitting down to write a full example.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110708/8bcf46d9/attachment.htm>

From m.nacos at gmail.com  Fri Jul  8 17:01:16 2011
From: m.nacos at gmail.com (Michael Nacos)
Date: Fri, 8 Jul 2011 17:01:16 +0100
Subject: [rabbitmq-discuss] Published message not queued after
 publish-ok received when connection quickly closed
In-Reply-To: <314D419E-FDDC-4AA9-84C5-3E8EA4230D62@101ideas.cz>
References: <BANLkTi=G-sMFmrr_-srSqmo_bSfyw8-w8Q@mail.gmail.com>
	<4DC3C2B7.701@rabbitmq.com>
	<yrv4coc3gt7bt.fsf@dwragg.eng.vmware.com>
	<CA+JR6zMSpkSdsptApw0Mwy1f8hpz2vmxYq_0oT0RgOkcs8WL4g@mail.gmail.com>
	<CA+1R4g7ERx+36NX=9Kas1nyfY70_9ZV8SNokHEHrW+nEBFMgKA@mail.gmail.com>
	<CA+JR6zMXTAZOhfE8L5n5D6G__4rzJqpqyXstz+Pr8+aqLFf4PQ@mail.gmail.com>
	<CA+1R4g4DLq2bEVg8qoMrfXKObhS4bCmwx6WA3RM_YyO=bxPKow@mail.gmail.com>
	<CA+JR6zMAtcQrEXqCH+pXb3+HGQ3gV=sFHxZO=C_=Tpo1JYhoMQ@mail.gmail.com>
	<314D419E-FDDC-4AA9-84C5-3E8EA4230D62@101ideas.cz>
Message-ID: <CA+JR6zNM+jD540A8YaTs11H+azFHV6zqnC_OCXhnLFa6DMTFFg@mail.gmail.com>

I forgot to mention my example code hangs if I introduce @channel.tx_select
and @channel.tx_commit around the publish call. I'm using amqp 0.8.0rc13 +
rabbit 2.4.1 & 2.5.1 -- perhaps this related to how transactions work and
the fact I'm re-using the same channel -- should I even be doing this?

I've got plenty of experience with transactions and atomicity, but in a
database context, not amqp/rabbit. I think there is considerable complexity
(made worse by my lack of familiarity with eventmachine and the amqp
protocol): in this 'rebroadcaster' scenario is it better:

   - to use the same connection for 'consume' and 'publish' or different
   ones?
   - to use the same channel or different ones? (do amqp transactions
   operate on a per-channel basis?)

Jakub, I understand eventmachine is event-driven, this is how the subscribe
call works. But within its asynchronous consume loop, I need to defer the
queue1 ack until messages have been published in queue2. Sorry, this is
probably lack of familiarity with eventmachine. Do you mean I could have two
handlers within the same EM.run block, a 'subscribe'  one and a 'on_ack' one
handling the publish confirms within which the queue1 ack is done? How do I
know which queue1 message I'm getting the on_ack notification for?

Michael

On 8 July 2011 16:32, Stastny Jakub <stastny at 101ideas.cz> wrote:

> El 8 Jul 2011, a las 16:16, Michael Nacos escribi?:
>
> so if the publish call returns immediately with no guarantees, what's the
> point of adding a @channel.tx_commit right after it?
>
>
> Transactions are mainly atomicity, so if you publish more messages, then
> running it in a transactions will result in saving all or nothing (and
> getting an error back). Using it for one item will result in getting the
> error back, so you'll know if it went wrong (I think, I don't have much
> experience with them).
>
> The docs:
>
> "The Tx class allows publish and ack operations to be batched into atomic
> units of work. The intention is that all publish and ack requests issued
> within a transaction will complete successfully or none of them will.
> Servers SHOULD implement atomic transactions at least where all publish or
> ack requests affect a single queue. Transactions that cover multiple queues
> may be non?atomic, given that queues can be created and destroyed
> asynchronously, and such events do not form part of any transaction."
>
> the question becomes how do I get a reliable publish ack to base the
> tx_commit/metadata.ack on
>
> I saw this in the docs for publisher confirms:
>
> # define a callback that will be executed when message is acknowledgedchannel.on_ack do |basic_ack|
>   puts "Received an acknowledgement: delivery_tag = #{basic_ack.delivery_tag}, multiple = #{basic_ack.multiple}"end
>
> which is great, but how does it fit within the consume loop? I need
> execution to block until it's safe to issue the metadata.ack call. Is this
> something I can achieve with eventmachine?
>
>
> I'm not sure if I understand ... this is a callback, it doesn't block as
> well as #subscribe, it's a callback called when a message is delivered to
> the client. EventMachine is an implementation of reactor pattern (it means
> it's async). So it works based on events (when I get this, do that ... ).
> BTW just to make sure, do you know that this on_ack is for ack which the
> *broker* sends? So you don't call metadata.ack for this (you ack messages
> when they're actually processed on the consumer).
>
> Cheers,
>
> Jakub
>
> 2011/7/8 Jakub ??astn? <stastny at 101ideas.cz>
>
>> Basic.Publish isn't pseudo-synchronous, it's really
>> asynchronous. Exchange#publish doesn't take nowait option (so no, your code
>> isn't safe), it simply send the data and that's it. Then you have no idea
>> whether everything went OK or not. That's why you can use either
>> transactions (yes, you'd have to wrap the code in it as you've mentioned) or
>> publisher confirms (which I'd personally prefer as transactions are really
>> slow and fairly tricky). The documentation for publisher confirms in AMQP
>> gem is here:
>> http://rdoc.info/github/ruby-amqp/amqp/master/file/docs/Durability.textile
>>
>> Jakub
>>
>> http://www.flickr.com/photos/jakub-stastny
>> http://twitter.com/botanicus
>>
>>
>>
>> 2011/7/8 Michael Nacos <m.nacos at gmail.com>
>>
>>> so, what's currently the best way to publish messages consumed from one
>>> queue into another with the amqp gem? This is quite important in processing
>>> scenaria when no messages may be lost. In particular, is the following code
>>> safe? Will the pseudo-synchronous *publish* call return only after the
>>> message has been accepted in the second queue (:nowait => false)? otherwise,
>>> what would be the point of wrapping the publish call with @channel.tx_select
>>> / @channel.tx_commit ?
>>>
>>> # consumer which publishes each message to another queue
>>> # ------------------------------------------------------
>>>
>>> @consume_from = 'first'
>>> @deliver_to = 'second'
>>>
>>> EM.run do
>>>   AMQP.connect do |connection|
>>>     @channel = MQ.new(connection)
>>>     # making sure the relevant queues exist
>>>     @queue1 = @channel.queue(@consume_from, :passive => false, :durable
>>> => true)
>>>     @queue2 = @channel.queue(@deliver_to, :passive => false, :durable =>
>>> true)
>>>     # setting up the consumer loop
>>>     @queue1.subscribe(:ack => true) do |metadata, data|
>>>       @channel.default_exchange.publish(data, \
>>>         :routing_key => @deliver_to, \
>>>         :persistent => true, \
>>>         :nowait => false)
>>>       puts '.'
>>>       metadata.ack
>>>     end
>>>   end
>>> end
>>>
>>>
>>> 2011/7/4 Jakub ??astn? <stastny at 101ideas.cz>
>>>
>>>> AMQP 0.8 is available as RC, it's way more stable than 0.7, so I would
>>>> recommend to just use the RC.
>>>>
>>>> Jakub
>>>>
>>>> http://www.flickr.com/photos/jakub-stastny
>>>> http://twitter.com/botanicus
>>>>
>>>>
>>>>
>>>> 2011/7/4 Michael Nacos <m.nacos at gmail.com>
>>>>
>>>>> there seems to be some support for tx_select, tx_commit, tx_rollback in
>>>>> the master branch of the amqp gem, but not in the 0.7.x-stable branch, which
>>>>> is what most people are using
>>>>>
>>>>> 2011/5/6 David Wragg <david at rabbitmq.com>
>>>>>
>>>>>> Simon MacMullen <simon at rabbitmq.com> writes:
>>>>>> > On 05/05/11 22:33, Elias Levy wrote:
>>>>>> >> While writing some code using the Ruby AMQP gem against RabbitMQ,
>>>>>> I've
>>>>>> >> noticed that if I publish a message and quickly close the
>>>>>> connection,
>>>>>> >> even though I've received a publish-ok response from the server,
>>>>>> the
>>>>>> >> message fails to be queued by the broker.
>>>>>> >
>>>>>> > I'm not at all familiar with the Ruby client, but I should point out
>>>>>> > that unlike many of the other AMQP methods, basic.publish does not
>>>>>> > have a corresponding basic.publish-ok method; it's always
>>>>>> > asynchronous. So I imagine the post-publish callback fires
>>>>>> > immediately.
>>>>>> >
>>>>>> > In order to be able to know when the broker has taken responsibility
>>>>>> > for a message you can either wrap the publish in a transaction (when
>>>>>> > you see tx.commit-ok you know the server has the message) or use the
>>>>>> > rather more lightweight publish confirms:
>>>>>> o>
>>>>>> >
>>>>>> http://www.rabbitmq.com/blog/2011/02/10/introducing-publisher-confirms/
>>>>>>
>>>>>> Another way to solve the problem is to do a synchronous AMQP method
>>>>>> rather than abruptly closing the connection.  If this the sync method
>>>>>> completes successfully, you can be sure that your published messages
>>>>>> have reached the broker (it doesn't give you all the guarantees of
>>>>>> transactions, but it is much lighter weight).
>>>>>>
>>>>>> An easy way to do this with all versions of the AMQP gem (even 0.6.7)
>>>>>> is
>>>>>> to use the AMQP#close callback.  E.g., add something like this to your
>>>>>> code:
>>>>>>
>>>>>>  client.close { puts "Closed ok" ; EM.stop }
>>>>>>
>>>>>> David
>>>>>>
>>>>>> --
>>>>>> David Wragg
>>>>>> Staff Engineer, RabbitMQ
>>>>>> VMware, Inc.
>>>>>> _______________________________________________
>>>>>> rabbitmq-discuss mailing list
>>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>>>
>>>>>
>>>>>
>>>>
>>>
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110708/e4a67a31/attachment.htm>

From m.nacos at gmail.com  Fri Jul  8 17:02:26 2011
From: m.nacos at gmail.com (Michael Nacos)
Date: Fri, 8 Jul 2011 17:02:26 +0100
Subject: [rabbitmq-discuss] Published message not queued after
 publish-ok received when connection quickly closed
In-Reply-To: <CAE3HoVQs43FkiXHJhNQGP8D2sq8E2CDsPSvvkbr9vBn9=fDoAg@mail.gmail.com>
References: <BANLkTi=G-sMFmrr_-srSqmo_bSfyw8-w8Q@mail.gmail.com>
	<4DC3C2B7.701@rabbitmq.com>
	<yrv4coc3gt7bt.fsf@dwragg.eng.vmware.com>
	<CA+JR6zMSpkSdsptApw0Mwy1f8hpz2vmxYq_0oT0RgOkcs8WL4g@mail.gmail.com>
	<CA+1R4g7ERx+36NX=9Kas1nyfY70_9ZV8SNokHEHrW+nEBFMgKA@mail.gmail.com>
	<CA+JR6zMXTAZOhfE8L5n5D6G__4rzJqpqyXstz+Pr8+aqLFf4PQ@mail.gmail.com>
	<CA+1R4g4DLq2bEVg8qoMrfXKObhS4bCmwx6WA3RM_YyO=bxPKow@mail.gmail.com>
	<CA+JR6zMAtcQrEXqCH+pXb3+HGQ3gV=sFHxZO=C_=Tpo1JYhoMQ@mail.gmail.com>
	<CAE3HoVQs43FkiXHJhNQGP8D2sq8E2CDsPSvvkbr9vBn9=fDoAg@mail.gmail.com>
Message-ID: <CA+JR6zPyizRbqOQaJzDzos5QOijw55UTvuRp7t8u1Dsjg=HWzg@mail.gmail.com>

btw, thanks everybody for taking the time... excellent response times. I'll
look into EventMachine::Deferrable, too

2011/7/8 Michael Klishin <michael.s.klishin at gmail.com>

> 2011/7/8 Michael Nacos <m.nacos at gmail.com>
>
>> which is great, but how does it fit within the consume loop? I need
>> execution to block until it's safe to issue the metadata.ack call. Is this
>> something I can achieve with eventmachine?
>
>
>
> Yes. You can use EventMachine::Deferrable for that. I can't explain how
> without sitting down to write a full example.
>
> --
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110708/c779a748/attachment.htm>

From michael.s.klishin at gmail.com  Fri Jul  8 17:12:43 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 8 Jul 2011 20:12:43 +0400
Subject: [rabbitmq-discuss] Published message not queued after
 publish-ok received when connection quickly closed
In-Reply-To: <CA+JR6zNfOv_PTT3EcJAJ+tN=1TCDOrqadP341VLqCx0Gdu4s4Q@mail.gmail.com>
References: <BANLkTi=G-sMFmrr_-srSqmo_bSfyw8-w8Q@mail.gmail.com>
	<4DC3C2B7.701@rabbitmq.com> <yrv4coc3gt7bt.fsf@dwragg.eng.vmware.com>
	<CA+JR6zMSpkSdsptApw0Mwy1f8hpz2vmxYq_0oT0RgOkcs8WL4g@mail.gmail.com>
	<CA+1R4g7ERx+36NX=9Kas1nyfY70_9ZV8SNokHEHrW+nEBFMgKA@mail.gmail.com>
	<CA+JR6zMXTAZOhfE8L5n5D6G__4rzJqpqyXstz+Pr8+aqLFf4PQ@mail.gmail.com>
	<CAE3HoVTi56q3qTTbkHfOvjSK8=tY=KZankHZp5R9eXPiavk6YA@mail.gmail.com>
	<CA+JR6zNfOv_PTT3EcJAJ+tN=1TCDOrqadP341VLqCx0Gdu4s4Q@mail.gmail.com>
Message-ID: <CAE3HoVT+Gi=0VgwJnbWunuNU-iTwt0KsLtq77fsDY6axa2TFqA@mail.gmail.com>

2011/7/8 Michael Nacos <m.nacos at gmail.com>

> Michael, something like this would be fantastic (and less code to maintain
> on my part). any chance of it getting into the RC14?


Yes.

-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110708/9f14ddf9/attachment.htm>

From michael.s.klishin at gmail.com  Fri Jul  8 17:13:52 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 8 Jul 2011 20:13:52 +0400
Subject: [rabbitmq-discuss] Published message not queued after
 publish-ok received when connection quickly closed
In-Reply-To: <CA+JR6zNM+jD540A8YaTs11H+azFHV6zqnC_OCXhnLFa6DMTFFg@mail.gmail.com>
References: <BANLkTi=G-sMFmrr_-srSqmo_bSfyw8-w8Q@mail.gmail.com>
	<4DC3C2B7.701@rabbitmq.com> <yrv4coc3gt7bt.fsf@dwragg.eng.vmware.com>
	<CA+JR6zMSpkSdsptApw0Mwy1f8hpz2vmxYq_0oT0RgOkcs8WL4g@mail.gmail.com>
	<CA+1R4g7ERx+36NX=9Kas1nyfY70_9ZV8SNokHEHrW+nEBFMgKA@mail.gmail.com>
	<CA+JR6zMXTAZOhfE8L5n5D6G__4rzJqpqyXstz+Pr8+aqLFf4PQ@mail.gmail.com>
	<CA+1R4g4DLq2bEVg8qoMrfXKObhS4bCmwx6WA3RM_YyO=bxPKow@mail.gmail.com>
	<CA+JR6zMAtcQrEXqCH+pXb3+HGQ3gV=sFHxZO=C_=Tpo1JYhoMQ@mail.gmail.com>
	<314D419E-FDDC-4AA9-84C5-3E8EA4230D62@101ideas.cz>
	<CA+JR6zNM+jD540A8YaTs11H+azFHV6zqnC_OCXhnLFa6DMTFFg@mail.gmail.com>
Message-ID: <CAE3HoVSgTHzo8MTC1L84ccJ2q-vSesxhW6=cTyXEd2nxd_-M6w@mail.gmail.com>

2011/7/8 Michael Nacos <m.nacos at gmail.com>

> I forgot to mention my example code hangs if I introduce @channel.tx_select
> and @channel.tx_commit around the publish call. I'm using amqp 0.8.0rc13 +
> rabbit 2.4.1 & 2.5.1 -- perhaps this related to how transactions work and
> the fact I'm re-using the same channel -- should I even be doing this?



No, it sounds like a bug. Can you post a small snippet of code that
reproduces the issue?
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110708/fe3105b7/attachment.htm>

From michael.s.klishin at gmail.com  Fri Jul  8 17:17:00 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 8 Jul 2011 20:17:00 +0400
Subject: [rabbitmq-discuss] Published message not queued after
 publish-ok received when connection quickly closed
In-Reply-To: <CA+JR6zNM+jD540A8YaTs11H+azFHV6zqnC_OCXhnLFa6DMTFFg@mail.gmail.com>
References: <BANLkTi=G-sMFmrr_-srSqmo_bSfyw8-w8Q@mail.gmail.com>
	<4DC3C2B7.701@rabbitmq.com> <yrv4coc3gt7bt.fsf@dwragg.eng.vmware.com>
	<CA+JR6zMSpkSdsptApw0Mwy1f8hpz2vmxYq_0oT0RgOkcs8WL4g@mail.gmail.com>
	<CA+1R4g7ERx+36NX=9Kas1nyfY70_9ZV8SNokHEHrW+nEBFMgKA@mail.gmail.com>
	<CA+JR6zMXTAZOhfE8L5n5D6G__4rzJqpqyXstz+Pr8+aqLFf4PQ@mail.gmail.com>
	<CA+1R4g4DLq2bEVg8qoMrfXKObhS4bCmwx6WA3RM_YyO=bxPKow@mail.gmail.com>
	<CA+JR6zMAtcQrEXqCH+pXb3+HGQ3gV=sFHxZO=C_=Tpo1JYhoMQ@mail.gmail.com>
	<314D419E-FDDC-4AA9-84C5-3E8EA4230D62@101ideas.cz>
	<CA+JR6zNM+jD540A8YaTs11H+azFHV6zqnC_OCXhnLFa6DMTFFg@mail.gmail.com>
Message-ID: <CAE3HoVSki8MqLtmbg-gOJL_M9pWseodb7OzPK5jG8PcWTNoozA@mail.gmail.com>

2011/7/8 Michael Nacos <m.nacos at gmail.com>

> Do you mean I could have two handlers within the same EM.run block, a
> 'subscribe'  one and a 'on_ack' one handling the publish confirms within
> which the queue1 ack is done? How do I know which queue1 message I'm getting
> the on_ack notification for?


You need to integrate both consumer and publishing confirms code into an
object that can keep track of any additional state you need. An example of
such integration:

http://rdoc.info/github/ruby-amqp/amqp/master/file/docs/GettingStarted.textile#Integration_with_objects

(this example does not keep track of any state but demonstrates
Object#method and Method#to_proc combination technique)
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110708/768966ac/attachment.htm>

From michael.s.klishin at gmail.com  Fri Jul  8 17:18:57 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 8 Jul 2011 20:18:57 +0400
Subject: [rabbitmq-discuss] Published message not queued after
 publish-ok received when connection quickly closed
In-Reply-To: <CA+JR6zNM+jD540A8YaTs11H+azFHV6zqnC_OCXhnLFa6DMTFFg@mail.gmail.com>
References: <BANLkTi=G-sMFmrr_-srSqmo_bSfyw8-w8Q@mail.gmail.com>
	<4DC3C2B7.701@rabbitmq.com> <yrv4coc3gt7bt.fsf@dwragg.eng.vmware.com>
	<CA+JR6zMSpkSdsptApw0Mwy1f8hpz2vmxYq_0oT0RgOkcs8WL4g@mail.gmail.com>
	<CA+1R4g7ERx+36NX=9Kas1nyfY70_9ZV8SNokHEHrW+nEBFMgKA@mail.gmail.com>
	<CA+JR6zMXTAZOhfE8L5n5D6G__4rzJqpqyXstz+Pr8+aqLFf4PQ@mail.gmail.com>
	<CA+1R4g4DLq2bEVg8qoMrfXKObhS4bCmwx6WA3RM_YyO=bxPKow@mail.gmail.com>
	<CA+JR6zMAtcQrEXqCH+pXb3+HGQ3gV=sFHxZO=C_=Tpo1JYhoMQ@mail.gmail.com>
	<314D419E-FDDC-4AA9-84C5-3E8EA4230D62@101ideas.cz>
	<CA+JR6zNM+jD540A8YaTs11H+azFHV6zqnC_OCXhnLFa6DMTFFg@mail.gmail.com>
Message-ID: <CAE3HoVQYq47R5oJfg4r37bpPwcqEem5taWcc4e8HPxmxDzZX-A@mail.gmail.com>

2011/7/8 Michael Nacos <m.nacos at gmail.com>

> (do amqp transactions operate on a per-channel basis?)


They do.

-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110708/cc38576f/attachment.htm>

From m.nacos at gmail.com  Fri Jul  8 17:37:38 2011
From: m.nacos at gmail.com (Michael Nacos)
Date: Fri, 8 Jul 2011 17:37:38 +0100
Subject: [rabbitmq-discuss] Published message not queued after
 publish-ok received when connection quickly closed
In-Reply-To: <CAE3HoVSgTHzo8MTC1L84ccJ2q-vSesxhW6=cTyXEd2nxd_-M6w@mail.gmail.com>
References: <BANLkTi=G-sMFmrr_-srSqmo_bSfyw8-w8Q@mail.gmail.com>
	<4DC3C2B7.701@rabbitmq.com>
	<yrv4coc3gt7bt.fsf@dwragg.eng.vmware.com>
	<CA+JR6zMSpkSdsptApw0Mwy1f8hpz2vmxYq_0oT0RgOkcs8WL4g@mail.gmail.com>
	<CA+1R4g7ERx+36NX=9Kas1nyfY70_9ZV8SNokHEHrW+nEBFMgKA@mail.gmail.com>
	<CA+JR6zMXTAZOhfE8L5n5D6G__4rzJqpqyXstz+Pr8+aqLFf4PQ@mail.gmail.com>
	<CA+1R4g4DLq2bEVg8qoMrfXKObhS4bCmwx6WA3RM_YyO=bxPKow@mail.gmail.com>
	<CA+JR6zMAtcQrEXqCH+pXb3+HGQ3gV=sFHxZO=C_=Tpo1JYhoMQ@mail.gmail.com>
	<314D419E-FDDC-4AA9-84C5-3E8EA4230D62@101ideas.cz>
	<CA+JR6zNM+jD540A8YaTs11H+azFHV6zqnC_OCXhnLFa6DMTFFg@mail.gmail.com>
	<CAE3HoVSgTHzo8MTC1L84ccJ2q-vSesxhW6=cTyXEd2nxd_-M6w@mail.gmail.com>
Message-ID: <CA+JR6zNqufispyo+Je-nuCCAzAwsczkSOw2FzKP549UFA3P2Sw@mail.gmail.com>

the code is similar to the one I originally posted

    @queue1.subscribe(:ack => true) do |metadata, data|
      @channel.tx_select
      @channel.default_exchange.publish(data, \
        :routing_key => @deliver_to, \
        :persistent => true, \
        :nowait => false)
      puts '.'
      @channel.tx_commit
      metadata.ack
      @channel.tx_commit # <-- if not present, there is always one unacked
msg in @queue1
    end

it wasn't hanging, but because of the tx_select, the ack didn't happen until
the next time the consume callback was run, which I fixed by introducing
another tx_commit right after the ack. mind you, with one tx_commit right
after metadata.ack I lost messages.

On 8 July 2011 17:13, Michael Klishin <michael.s.klishin at gmail.com> wrote:

> 2011/7/8 Michael Nacos <m.nacos at gmail.com>
>
>> I forgot to mention my example code hangs if I introduce
>> @channel.tx_select and @channel.tx_commit around the publish call. I'm using
>> amqp 0.8.0rc13 + rabbit 2.4.1 & 2.5.1 -- perhaps this related to how
>> transactions work and the fact I'm re-using the same channel -- should I
>> even be doing this?
>
>
>
> No, it sounds like a bug. Can you post a small snippet of code that
> reproduces the issue?
>
> --
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110708/79d318a0/attachment.htm>

From awitbrock at vmware.com  Fri Jul  8 17:55:56 2011
From: awitbrock at vmware.com (Ann Witbrock (c))
Date: Fri, 8 Jul 2011 09:55:56 -0700 (PDT)
Subject: [rabbitmq-discuss] Tutorial example suggestion: work queues
 tutorial could have a description of hierarchical shutdown logic
In-Reply-To: <CAE3HoVR8d86zgOMwWbGThj5z9ezo_2TrJbbvT9oMphKpYmj3cQ@mail.gmail.com>
Message-ID: <233484346.21851.1310144156550.JavaMail.root@zimbra-prod-mbox-4.vmware.com>


Hi Michael, 
I'm not quite ready to be bombarded with the whole world's wish list (cos then I'd never get anything done ;-) ), 
however if you?(Michael) want to email me a concise summary of the most important topics to cover clearly, 
based on that experience, that would be useful guidance. 

Please bear in mind I have no control over amqp gem, but I can do something to shape resources provided on rabbitmq website. 
wrt any gem doc niggles,?a link to something else that solves the problem effectively would be of interest. 

I'll try to remember to?post my intentions?on the discuss list?at some point closer to the time. 
Thanks, 
Ann 


----- Original Message -----

From: "Michael Klishin" <michael.s.klishin at gmail.com> 
To: "Ann Witbrock (c)" <awitbrock at vmware.com> 
Cc: "Boggs Jr., Lowell" <Lowell.Boggs at emc.com>, rabbitmq-discuss at lists.rabbitmq.com 
Sent: Friday, 8 July, 2011 4:33:59 PM 
Subject: Re: [rabbitmq-discuss] Tutorial example suggestion: work queues tutorial could have a description of hierarchical shutdown logic 

2011/7/8 Ann Witbrock (c) < awitbrock at vmware.com > 




We need a slight restructure of the content flow and uniformity to make it easier to create new tutorials without duplication, meanwhile we have to (drastically) improve our knowledge base (or 'theory') and then we need to tie that in, not just to the tutorials, but across the site. Work on that will start in a month or two. 

It's good to know the users have the same hopes for the site ;-) 


Ann, 

I have plenty of suggestions about the docs (mostly based on what does and doesn't work for me in amqp gem documentation and kind of questions I have to answer over and over in #rabbitmq on IRC). Do I send them as soon as I compile them in one specific enough list or in a month or two? :) and where? just post them here? 

-- 
MK 

http://github.com/michaelklishin 
http://twitter.com/michaelklishin 


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110708/e51f25ef/attachment.htm>

From habtdemis at gmail.com  Fri Jul  8 17:58:33 2011
From: habtdemis at gmail.com (Demiss Zike)
Date: Fri, 8 Jul 2011 11:58:33 -0500
Subject: [rabbitmq-discuss] Publish/subscribe in RabbitMQ
Message-ID: <CAJE2eFETiCOuz5e-6cDon5y52OxcF5H0o9UkdYBquFMZ5fOcRA@mail.gmail.com>

I am using RabbitMQ to publish/subscribe. I have a class (in C#) that has
the following methods to do this job:

    void write (Measurement m);
    Measurement read();
    void publish(string queue);
    Measurement subscribe(string queue);

I am having difficulty separating writing a message from publishing the
message to a queue (or reading a message from subscribing to a queue for
that message). What would be the best method of design/implementation?

Regards,
Demi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110708/8e79891d/attachment.htm>

From michael.s.klishin at gmail.com  Fri Jul  8 18:03:10 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 8 Jul 2011 21:03:10 +0400
Subject: [rabbitmq-discuss] Tutorial example suggestion: work queues
 tutorial could have a description of hierarchical shutdown logic
In-Reply-To: <233484346.21851.1310144156550.JavaMail.root@zimbra-prod-mbox-4.vmware.com>
References: <CAE3HoVR8d86zgOMwWbGThj5z9ezo_2TrJbbvT9oMphKpYmj3cQ@mail.gmail.com>
	<233484346.21851.1310144156550.JavaMail.root@zimbra-prod-mbox-4.vmware.com>
Message-ID: <CAE3HoVRXmPHhbSavT_k5boP0wru0NTxAA0odnDuM7OjZoiwXZA@mail.gmail.com>

2011/7/8 Ann Witbrock (c) <awitbrock at vmware.com>

> I'm not quite ready to be bombarded with the whole world's wish list (cos
> then I'd never get anything done ;-) ),
>
> however if you (Michael) want to email me a concise summary of the most
> important topics to cover clearly,
>
> based on that experience, that would be useful guidance.
>
> ack, I will compile something concise.

>
>
> Please bear in mind I have no control over amqp gem, but I can do something
> to shape resources provided on rabbitmq website.
>
> wrt any gem doc niggles, a link to something else that solves the problem
> effectively would be of interest.
>

I was referring to the experience I have after writing all the amqp gem
documentation guides and seeing what people have questions with after
reading them all.

Anyway, I see what you are saying. Most of my suggestions are for the
rabbitmq.com content.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110708/bd29ca1d/attachment.htm>

From fearsome.lucidity at gmail.com  Fri Jul  8 18:23:18 2011
From: fearsome.lucidity at gmail.com (Elias Levy)
Date: Fri, 8 Jul 2011 10:23:18 -0700
Subject: [rabbitmq-discuss] Persistent messages and durable queue
	questions
In-Reply-To: <0F51CD98-3C30-4029-855A-228B79C3FD71@rabbitmq.com>
References: <BANLkTinehFtF17CT6koQ-W_kUV-7fdJWSw@mail.gmail.com>
	<4E01A49C.9010402@rabbitmq.com>
	<BANLkTikBasN97dpS2XaPxh-Mr9rz4Ft-Xg@mail.gmail.com>
	<0F51CD98-3C30-4029-855A-228B79C3FD71@rabbitmq.com>
Message-ID: <CAFDmHdOw__CWb3W0VLLD5LH8J_9G+HKNorrZJ_Sn64T=a_7zTg@mail.gmail.com>

On Thu, Jul 7, 2011 at 6:34 AM, Rob Harrop <rob at rabbitmq.com> wrote:

>
> Well, it's quite subtle. If the message was routed when the queue was up, a
> back is sent if the queue goes down before the message can be written to
> disk.
>
> If the binding has been removed due to queue down then no nack will be
> sent.
>
> Are you trying to ensure that a given message reaches a known set of
> queues?
>

Yes and no.  As I said, for any one message there may or may not be binding
matching the message to the durable queue.

The problem is as follows:  We have a system that generates events.  We have
a set of users that may be interested in some subset of those events.  What
events the users are interested in changes dynamically.  We have an agent
subscribed to a durable queue that will receive the events of interest and
process them on behalf of the users.  The bindings on the topic exchange
that match the events to the queue change dynamically with the user's
interests.  I need to know that if there is a binding for the event, that it
was successfully persisted to the queue.

We want to ensure that, if the queue is reachable and there is a binding
that matches the message to the queue, or the queue is reachable and there
is no binding that matches the message to the queue, (i.e. that the cluster
is working properly) that the producer will get an ack.  Publisher confirm
gives us this.

We want to ensure that, if the queue is not reachable and there is a binding
that matches the message to the queue, or the queue is not reachable and
there is no binding that matches the message to the queue, (i.e. that the
cluster has lost the node to which the queue is attached or the queue was
deleted), that the producer will get a nack.  Publisher confirm fails here.

Publisher confirm fails the second requirement because if the cluster is
partitioned, it will forget the bindings to the queue on the other node.  It
will response with an ack, rather than a nack.

What is needed is a way to define a binding as durable, so that it won't be
forgotten if the queue is references goes away because of a cluster
partition or the queue is deleted.  It gives the system a hint that the
queue in question should exist, but does not.  Alternatively, the system
should not forget a durable queue just because the node it was attached goes
away.  A durable queue should only be forgotten if it is actively deleted.

HA queue alleviate the problem, as the queue will exist in more nodes and
more nodes would have to disappear for it to be forgotten, but it does not
solve the problem, unless the queue is configured to exist on all nodes.

Savvy?

Elias Levy
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110708/3dce17a9/attachment.htm>

From jerryk at vmware.com  Fri Jul  8 19:57:39 2011
From: jerryk at vmware.com (Jerry Kuch)
Date: Fri, 8 Jul 2011 11:57:39 -0700 (PDT)
Subject: [rabbitmq-discuss] Problem with Installing RabbitMQ Server 2.5.1
In-Reply-To: <CADE4k+67+G5fieqWSZnGg+b70JvANQtcr3pz=Q3tcHFr0sw6JQ@mail.gmail.com>
Message-ID: <1553800556.26886.1310151459829.JavaMail.root@zimbra-prod-mbox-4.vmware.com>

Hi, Matthew: 


On OS X, /var/lib is probably owned by root so if you're firing up sbin/rabbitmq-server as your own user account you'll probably get stiff-armed in this way. Try again with 'sudo' and you should be in fine shape. 


Best regards, 
Jerry 

----- Original Message -----

From: "Matthew Low" <11mdlow at gmail.com> 
To: rabbitmq-discuss at lists.rabbitmq.com 
Sent: Thursday, July 7, 2011 11:03:46 AM 
Subject: [rabbitmq-discuss] Problem with Installing RabbitMQ Server 2.5.1 

Hello, 


I am trying to get a working version of RabbitMQ up and running on my Mac OSX with the generic Unix version. However, I get the following error when I try to start up the server: 



Archon:rabbitmq_server-2.5.0 matthew$ sbin/rabbitmq-server 
Activating RabbitMQ plugins ... 
ERROR: Could not create dir /var/lib/rabbitmq/mnesia/rabbit at Archon-plugins-expand (enoent) 


I have the most recent version of Erlang installed on my machine. I think this may be some sort of read/write permissions problem, but I don't quite know how to fix it. Please help! 


Thanks, 
Matt 







_______________________________________________ 
rabbitmq-discuss mailing list 
rabbitmq-discuss at lists.rabbitmq.com 
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110708/f4924be1/attachment.htm>

From gmr at myyearbook.com  Fri Jul  8 20:03:51 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Fri, 8 Jul 2011 15:03:51 -0400
Subject: [rabbitmq-discuss] Problem with Installing RabbitMQ Server 2.5.1
In-Reply-To: <1553800556.26886.1310151459829.JavaMail.root@zimbra-prod-mbox-4.vmware.com>
References: <CADE4k+67+G5fieqWSZnGg+b70JvANQtcr3pz=Q3tcHFr0sw6JQ@mail.gmail.com>
	<1553800556.26886.1310151459829.JavaMail.root@zimbra-prod-mbox-4.vmware.com>
Message-ID: <CAL_e=0qWO56CJ+KcOQ-mrejH7ZuGB_tXu3ESEjJaqm8yOtJL7w@mail.gmail.com>

I'd be less included to run as rabbitmq root using sudo than change the
permissions on the requisite /var/lib/rabbitmq and /var/log/rabbitmq
directories.

sudo mkdir /var/lib/rabbitmq
sudo mkdir /var/log/rabbimq
sudo chgrp staff /var/log/rabbitmq
sudo chmod g+w /var/log/rabbitmq
sudo chgrp staff /var/lib/rabbitmq
sudo chmod g+w /var/lib/rabbitmq

Cheers,

Gavin

On Fri, Jul 8, 2011 at 2:57 PM, Jerry Kuch <jerryk at vmware.com> wrote:

> Hi, Matthew:
>
> On OS X, /var/lib is probably owned by root so if you're firing up
> sbin/rabbitmq-server as your own user account you'll probably get
> stiff-armed in this way.  Try again with 'sudo' and you should be in fine
> shape.
>
> Best regards,
> Jerry
>
> ------------------------------
> *From: *"Matthew Low" <11mdlow at gmail.com>
> *To: *rabbitmq-discuss at lists.rabbitmq.com
> *Sent: *Thursday, July 7, 2011 11:03:46 AM
> *Subject: *[rabbitmq-discuss] Problem with Installing RabbitMQ Server
> 2.5.1
>
>
> Hello,
>
> I am trying to get a working version of RabbitMQ up and running on my Mac
> OSX with the generic Unix version. However, I get the following error when I
> try to start up the server:
>
> Archon:rabbitmq_server-2.5.0 matthew$ sbin/rabbitmq-server
> Activating RabbitMQ plugins ...
> ERROR: Could not create dir
> /var/lib/rabbitmq/mnesia/rabbit at Archon-plugins-expand (enoent)
>
> I have the most recent version of Erlang installed on my machine. I think
> this may be some sort of read/write permissions problem, but I don't quite
> know how to fix it. Please help!
>
> Thanks,
> Matt
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110708/b923e52b/attachment.htm>

From jerryk at vmware.com  Fri Jul  8 20:31:16 2011
From: jerryk at vmware.com (Jerry Kuch)
Date: Fri, 8 Jul 2011 12:31:16 -0700 (PDT)
Subject: [rabbitmq-discuss] Problem with Installing RabbitMQ Server 2.5.1
In-Reply-To: <CAL_e=0qWO56CJ+KcOQ-mrejH7ZuGB_tXu3ESEjJaqm8yOtJL7w@mail.gmail.com>
Message-ID: <1273528993.28234.1310153476985.JavaMail.root@zimbra-prod-mbox-4.vmware.com>

And of course there are also environment variables letting one specify alternate locations Mnesia data, etc. Then one can set the ownerships and permissions of those as desired for whatever user one runs as: 


http://www.rabbitmq.com/configure.html#define-environment-variables 

----- Original Message -----

From: "Gavin M. Roy" <gmr at myyearbook.com> 
To: "Jerry Kuch" <jerryk at vmware.com> 
Cc: "Matthew Low" <11mdlow at gmail.com>, rabbitmq-discuss at lists.rabbitmq.com 
Sent: Friday, July 8, 2011 12:03:51 PM 
Subject: Re: [rabbitmq-discuss] Problem with Installing RabbitMQ Server 2.5.1 

I'd be less included to run as rabbitmq root using sudo than change the permissions on the requisite /var/lib/rabbitmq and /var/log/rabbitmq directories. 


sudo mkdir /var/lib/rabbitmq 
sudo mkdir /var/log/rabbimq 
sudo chgrp staff /var/log/rabbitmq 
sudo chmod g+w /var/log/rabbitmq 
sudo chgrp staff /var/lib/rabbitmq 
sudo chmod g+w /var/lib/rabbitmq 


Cheers, 

Gavin 


On Fri, Jul 8, 2011 at 2:57 PM, Jerry Kuch < jerryk at vmware.com > wrote: 




Hi, Matthew: 


On OS X, /var/lib is probably owned by root so if you're firing up sbin/rabbitmq-server as your own user account you'll probably get stiff-armed in this way. Try again with 'sudo' and you should be in fine shape. 


Best regards, 
Jerry 



From: "Matthew Low" < 11mdlow at gmail.com > 
To: rabbitmq-discuss at lists.rabbitmq.com 
Sent: Thursday, July 7, 2011 11:03:46 AM 
Subject: [rabbitmq-discuss] Problem with Installing RabbitMQ Server 2.5.1 




Hello, 


I am trying to get a working version of RabbitMQ up and running on my Mac OSX with the generic Unix version. However, I get the following error when I try to start up the server: 



Archon:rabbitmq_server-2.5.0 matthew$ sbin/rabbitmq-server 
Activating RabbitMQ plugins ... 
ERROR: Could not create dir /var/lib/rabbitmq/mnesia/rabbit at Archon-plugins-expand (enoent) 


I have the most recent version of Erlang installed on my machine. I think this may be some sort of read/write permissions problem, but I don't quite know how to fix it. Please help! 


Thanks, 
Matt 







_______________________________________________ 
rabbitmq-discuss mailing list 
rabbitmq-discuss at lists.rabbitmq.com 
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss 


_______________________________________________ 
rabbitmq-discuss mailing list 
rabbitmq-discuss at lists.rabbitmq.com 
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss 





-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110708/921f085c/attachment.htm>

From rishdev at gmail.com  Fri Jul  8 20:36:23 2011
From: rishdev at gmail.com (RishiDev)
Date: Fri, 8 Jul 2011 12:36:23 -0700 (PDT)
Subject: [rabbitmq-discuss] Integration of SAP XI with RabbitMQ
Message-ID: <ce1093a7-7fb3-4797-8c39-c3457581ebcf@w4g2000yqm.googlegroups.com>

Hi,

Our organization has SAP XI 7.0 systems which sends various messages
to other systems across the enterprise.
For better performance, reliability and message compression etc
abilities we are trying to move from ActiveMQ to RabbitMQ. Having SAP
XI talk to ActiveMQ was easy by using JMS type communication channel
configured in XI. I want to learn from the group, what is best &
recommended approach for SAPXI to Rabbit integration.

I know that we can use QPID (I haven't tried yet though) and get a JMS
kind of integration between SAPXI and Rabbit, but I would love it, if
we can have a pure AMQP base communication and avoid JMS.

I will appreciate any help for what approach and how (to follow) to
integrate SAPXI with Rabbit.

Thank you.
Rishi

From rishdev at gmail.com  Fri Jul  8 21:21:36 2011
From: rishdev at gmail.com (RishiDev)
Date: Fri, 8 Jul 2011 13:21:36 -0700 (PDT)
Subject: [rabbitmq-discuss] Integration of SAP XI with RabbitMQ
In-Reply-To: <ce1093a7-7fb3-4797-8c39-c3457581ebcf@w4g2000yqm.googlegroups.com>
References: <ce1093a7-7fb3-4797-8c39-c3457581ebcf@w4g2000yqm.googlegroups.com>
Message-ID: <4db977ae-8bad-44c8-b204-13c6f2aa4c40@c41g2000yqm.googlegroups.com>

To certain extent I believe the question should go to SAPXI community.
And we have already raised a ticket with them, but still I wanted to
quickly check if someone from our RabbitMQ community has some tips to
share.

On Jul 8, 1:36?pm, RishiDev <rish... at gmail.com> wrote:
> Hi,
>
> Our organization has SAP XI 7.0 systems which sends various messages
> to other systems across the enterprise.
> For better performance, reliability and message compression etc
> abilities we are trying to move from ActiveMQ to RabbitMQ. Having SAP
> XI talk to ActiveMQ was easy by using JMS type communication channel
> configured in XI. I want to learn from the group, what is best &
> recommended approach for SAPXI to Rabbit integration.
>
> I know that we can use QPID (I haven't tried yet though) and get a JMS
> kind of integration between SAPXI and Rabbit, but I would love it, if
> we can have a pure AMQP base communication and avoid JMS.
>
> I will appreciate any help for what approach and how (to follow) to
> integrate SAPXI with Rabbit.
>
> Thank you.
> Rishi
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From habtdemis at gmail.com  Sat Jul  9 17:11:24 2011
From: habtdemis at gmail.com (Demiss Zike)
Date: Sat, 9 Jul 2011 11:11:24 -0500
Subject: [rabbitmq-discuss] Quick question: Writing to multiple queues
Message-ID: <CAJE2eFHhk-UKY+wURo45OzMBw1R0vej7JCpmGdPLLDBi7Br=1A@mail.gmail.com>

Hello,

Can you point me to the right direction as to how I can write a message
using RabbitMQ to multiple queues without having to open a connection for
each message?

Ragards,
Demi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110709/2009acc0/attachment.htm>

From michael.s.klishin at gmail.com  Sat Jul  9 17:30:43 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sat, 9 Jul 2011 20:30:43 +0400
Subject: [rabbitmq-discuss] Quick question: Writing to multiple queues
In-Reply-To: <CAJE2eFHhk-UKY+wURo45OzMBw1R0vej7JCpmGdPLLDBi7Br=1A@mail.gmail.com>
References: <CAJE2eFHhk-UKY+wURo45OzMBw1R0vej7JCpmGdPLLDBi7Br=1A@mail.gmail.com>
Message-ID: <CAE3HoVQzWbZviRF=OAsapgAZNqx9D_X39X=mf6j1NnmVi4axwA@mail.gmail.com>

2011/7/9 Demiss Zike <habtdemis at gmail.com>

> Can you point me to the right direction as to how I can write a message
> using RabbitMQ to multiple queues without having to open a connection for
> each message?


Demiss,

In AMQP model messages are not written to queues. They are published to
exchanges that route them to queues according to rules called "bindings".
Different exchange types employ different routing rules. To route a message
to multiple queues, take a look at fanout and topic exchanges. Regardless of
what exchange type you choose, AMQP connections are stateful and typically
long-lived: there is no need to open multiple connection for simple
scenarios.

Have a look at these tutorials:

http://www.rabbitmq.com/tutorials/tutorial-three-python.html
http://www.rabbitmq.com/tutorials/tutorial-five-python.html
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110709/70fb7242/attachment.htm>

From habtdemis at gmail.com  Sat Jul  9 18:29:38 2011
From: habtdemis at gmail.com (Demiss Zike)
Date: Sat, 9 Jul 2011 12:29:38 -0500
Subject: [rabbitmq-discuss] Quick question: Writing to multiple queues
In-Reply-To: <CAE3HoVQzWbZviRF=OAsapgAZNqx9D_X39X=mf6j1NnmVi4axwA@mail.gmail.com>
References: <CAJE2eFHhk-UKY+wURo45OzMBw1R0vej7JCpmGdPLLDBi7Br=1A@mail.gmail.com>
	<CAE3HoVQzWbZviRF=OAsapgAZNqx9D_X39X=mf6j1NnmVi4axwA@mail.gmail.com>
Message-ID: <CAJE2eFFzx=tdarht0PS5jbgL9i24L0Z2x7nmj4pst9s1BSQL5g@mail.gmail.com>

Thanks Michael,

I tried to declare two queues and bind each queue to the exchange. Then
publish the message to the exchange, so that the message will be sent to the
two queues as follows:

var connectionFactory = new ConnectionFactory();
        connectionFactory.HostName = "localhost";

        using (IConnection connection =
                    connectionFactory.CreateConnection())
        {
            using (IModel model = connection.CreateModel())
            {
                model.ExchangeDeclare("MyExchange", ExchangeType.Fanout,
true);
                model.QueueDeclare("QueueOne", true);
                model.QueueDeclare("QueueTwo", true);
                model.QueueBind("MyQueueOne", "MyExchange", "", false,
                    new Dictionary<string,object>());
                model.QueueBind("MyQueueTwo", "MyExchange", "", false,
                    new Dictionary<string,object>());
                string message = "Hello";
                IBasicProperties basicProperties =
model.CreateBasicProperties();
                model.BasicPublish("MyExchange", "", false, false,
                    basicProperties,
System.Text.Encoding.UTF8.GetBytes(message));
            }
        }

However, I am getting CS1501: No overload for method 'QueueDeclare' takes 2
arguments. My question is 1) can i declare multiple queues to then use
fanout exchange and publish a message to multiple queues? 2) what is the
last argument for QueueBind?


Thanks again,

Demiss


On Sat, Jul 9, 2011 at 11:30 AM, Michael Klishin <
michael.s.klishin at gmail.com> wrote:

> 2011/7/9 Demiss Zike <habtdemis at gmail.com>
>
>> Can you point me to the right direction as to how I can write a message
>> using RabbitMQ to multiple queues without having to open a connection for
>> each message?
>
>
> Demiss,
>
> In AMQP model messages are not written to queues. They are published to
> exchanges that route them to queues according to rules called "bindings".
> Different exchange types employ different routing rules. To route a message
> to multiple queues, take a look at fanout and topic exchanges. Regardless of
> what exchange type you choose, AMQP connections are stateful and typically
> long-lived: there is no need to open multiple connection for simple
> scenarios.
>
> Have a look at these tutorials:
>
> http://www.rabbitmq.com/tutorials/tutorial-three-python.html
> http://www.rabbitmq.com/tutorials/tutorial-five-python.html
> --
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110709/e5d04a77/attachment.htm>

From michael.s.klishin at gmail.com  Sat Jul  9 19:00:37 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sat, 9 Jul 2011 22:00:37 +0400
Subject: [rabbitmq-discuss] Quick question: Writing to multiple queues
In-Reply-To: <CAJE2eFFzx=tdarht0PS5jbgL9i24L0Z2x7nmj4pst9s1BSQL5g@mail.gmail.com>
References: <CAJE2eFHhk-UKY+wURo45OzMBw1R0vej7JCpmGdPLLDBi7Br=1A@mail.gmail.com>
	<CAE3HoVQzWbZviRF=OAsapgAZNqx9D_X39X=mf6j1NnmVi4axwA@mail.gmail.com>
	<CAJE2eFFzx=tdarht0PS5jbgL9i24L0Z2x7nmj4pst9s1BSQL5g@mail.gmail.com>
Message-ID: <CAE3HoVQyMWO2c13-PUaz9fREvrV_J2sitEjMC3fQyqYQcps26g@mail.gmail.com>

2011/7/9 Demiss Zike <habtdemis at gmail.com>

> However, I am getting CS1501: No overload for method 'QueueDeclare' takes 2
> arguments.


According to
http://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v2.5.1/rabbitmq-dotnet-client-2.5.1-user-guide.pdf,
QueueDeclare takes at least 4 arguments: name, durability, exclusivity and
auto-deletion setting. Why don't you just follow examples from that user
guide, it seems to be pretty extensive and includes code examples.

My question is 1) can i declare multiple queues to then use fanout exchange
> and publish a message to multiple queues?


Yes.


> 2) what is the last argument for QueueBind?


Binding arguments. More about bindings can be found in AMQP 0.9.1 spec
document (introductory chapters are a pretty easy read) http://bit.ly/hw2ELX
.

-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110709/cf90c33a/attachment.htm>

From videlalvaro at gmail.com  Sat Jul  9 19:10:55 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Sat, 9 Jul 2011 20:10:55 +0200
Subject: [rabbitmq-discuss] Small fix for the tutorials
Message-ID: <7ED8E297-BEBD-47C7-9664-A3CC4541389F@gmail.com>

Hi,

I saw that the PHP examples on the tutorial page are pointing the readers to a different PHP library than the one used on the sample code.

See here: http://www.rabbitmq.com/getstarted.html, the wrong link is to this page: http://code.google.com/p/php-amqplib/

While the tutorials here: https://github.com/rabbitmq/rabbitmq-tutorials/tree/master/php are pointing you to the right one which is: https://github.com/tnc/php-amqplib

Could that be fixed? Yeterday a co-worker had a problem following the tutorials since he installed the wrong library version.	

Cheers,

Alvaro

From videlalvaro at gmail.com  Sat Jul  9 19:55:33 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Sat, 9 Jul 2011 20:55:33 +0200
Subject: [rabbitmq-discuss] Experimental RabbitMQ Topology Visualiser
In-Reply-To: <20110705124905.GE30077@rabbitmq.com>
References: <20110705113855.GB30077@rabbitmq.com>
	<17979245.92.1309869728368.JavaMail.geo-discussion-forums@vbqb20>
	<20110705124905.GE30077@rabbitmq.com>
Message-ID: <24BA697C-5305-4E27-A6BF-DD2C5E5BBA6F@gmail.com>

Hi Matthew,

Have you seen/tried this to do something similar to what you try to achieve with js: 

Demo: http://tweetplumb.com/?q=#%23jquery

Library home page: http://jsplumb.org/jquery/demo.html

Cheers,

Alvaro

On Jul 5, 2011, at 2:49 PM, Matthew Sackman wrote:

> On Tue, Jul 05, 2011 at 05:42:08AM -0700, Joseph Marlin wrote:
>> Speaking of CPU usage, I'm getting a *lot* of it when I have the tab with 
>> this visualizer visible in Chrome on Ubuntu: http://i.imgur.com/uhU2m.png
> 
> Yup. n-body simulations are CPU intensive, especially when you're
> crippled by a language like javascript. That said, firstly, since the
> release at the end of last week, I've done further optimisations such as
> frustum culling, and secondly, profiling in chrome (it's built-in
> profiler is very very good!) shows that actually the CPU cost is not in
> the physics, but in the canvas drawing operations - the general state of
> canvas implementations seems to be fairly unoptimised, especially when
> it comes to things like drawing text. This could be because most of the
> shiny shiny demos don't spent a lot of time drawing text or doing much
> other than moving balls attractively around a screen ;)
> 
>> Is that normal? The dip in the beginning was when I switched to a different 
>> tab for a few seconds.
> 
> Alas so. I'm doing what I can to minimise this, but it's been fairly
> well demonstrated that implementing something in flash still leads to
> better performance than an HTML canvas on modern browsers - they still
> have some way to go yet to close the performance gap.
> 
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

Sent form my Nokia 1100




From habtdemis at gmail.com  Sat Jul  9 20:07:12 2011
From: habtdemis at gmail.com (Demiss Zike)
Date: Sat, 9 Jul 2011 14:07:12 -0500
Subject: [rabbitmq-discuss] Quick question: Writing to multiple queues
In-Reply-To: <CAE3HoVQyMWO2c13-PUaz9fREvrV_J2sitEjMC3fQyqYQcps26g@mail.gmail.com>
References: <CAJE2eFHhk-UKY+wURo45OzMBw1R0vej7JCpmGdPLLDBi7Br=1A@mail.gmail.com>
	<CAE3HoVQzWbZviRF=OAsapgAZNqx9D_X39X=mf6j1NnmVi4axwA@mail.gmail.com>
	<CAJE2eFFzx=tdarht0PS5jbgL9i24L0Z2x7nmj4pst9s1BSQL5g@mail.gmail.com>
	<CAE3HoVQyMWO2c13-PUaz9fREvrV_J2sitEjMC3fQyqYQcps26g@mail.gmail.com>
Message-ID: <CAJE2eFFcbVoXQyTQx+w9UrGU=pUek0qj7cur+UyrbNNeH8gNgw@mail.gmail.com>

Micheal, I looked at the links you sent me and based my new approach on
them. And, I did the following (and no errors but it's not doing what i
wanted):

I declared two queues q1 and q2 and bind them to a fanout exchange. Then I
published the message to the exchange.

On the receiving end of my application, I declared another queue (q3) and
bind it to the same exchange. Then when I consume messages I consume from q3
via the exchange I declared. But I don't expect to get any messages since I
send the messages to queues q1 and q2 but requesting a message from q3. The
problem is, I still get messages. I could be asking a lot but please bear
with me. Please look at the code I have and point me to the right direction:

//EmitLog.cs
using System;
using RabbitMQ.Client;

class EmitLog {
    public static void Main(string[] args) {
        ConnectionFactory factory = new ConnectionFactory();
        factory.HostName = "localhost";
        using (IConnection connection = factory.CreateConnection())
        using (IModel channel = connection.CreateModel()) {
            channel.ExchangeDeclare("logs", "fanout");
            channel.QueueDeclare("q1", false, false, false, null);
            channel.QueueDeclare("q2", false, false, false, null);
            channel.QueueBind("q1", "logs", "");
            channel.QueueBind("q2", "logs", "");

            string message = (args.Length > 0) ? string.Join(" ", args)
                                               : "info: Hello World!";
            byte[] body = System.Text.Encoding.UTF8.GetBytes(message);
            channel.BasicPublish("logs", "", null, body);
            Console.WriteLine(" [x] Sent {0}", message);
        }
    }
}



//ReceiveLogs.cs
using System;
using RabbitMQ.Client;
using RabbitMQ.Client.Events;

class ReceiveLogs {
    public static void Main(string[] args) {
        ConnectionFactory factory = new ConnectionFactory();
        factory.HostName = "localhost";
        using (IConnection connection = factory.CreateConnection())
        using (IModel channel = connection.CreateModel()) {
            channel.ExchangeDeclare("logs", "fanout");

            //string queue_name = channel.QueueDeclare();
            //string queue_name2 = channel.QueueDeclare();
            //channel.QueueDeclare("q1", false, false, false, null);
            channel.QueueDeclare("q3", false, false, false, null);

            //channel.QueueBind("q2", "logs", "");
            channel.QueueBind("q3", "logs", "");
            QueueingBasicConsumer consumer = new
QueueingBasicConsumer(channel);
            //channel.BasicConsume("q2", true, consumer);
            channel.BasicConsume("q3", true, consumer);

            Console.WriteLine(" [*] Waiting for logs." +
                              "To exit press CTRL+C");
            while(true) {
                BasicDeliverEventArgs ea =
                    (BasicDeliverEventArgs)consumer.Queue.Dequeue();

                byte[] body = ea.Body;
                string message = System.Text.Encoding.UTF8.GetString(body);
                Console.WriteLine(" [x] {0}", message);
            }
        }
    }
}

Thanks,

On Sat, Jul 9, 2011 at 1:00 PM, Michael Klishin <michael.s.klishin at gmail.com
> wrote:

>
>
> 2011/7/9 Demiss Zike <habtdemis at gmail.com>
>
>> However, I am getting CS1501: No overload for method 'QueueDeclare' takes
>> 2 arguments.
>
>
> According to
> http://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v2.5.1/rabbitmq-dotnet-client-2.5.1-user-guide.pdf,
> QueueDeclare takes at least 4 arguments: name, durability, exclusivity and
> auto-deletion setting. Why don't you just follow examples from that user
> guide, it seems to be pretty extensive and includes code examples.
>
> My question is 1) can i declare multiple queues to then use fanout exchange
>> and publish a message to multiple queues?
>
>
> Yes.
>
>
>> 2) what is the last argument for QueueBind?
>
>
> Binding arguments. More about bindings can be found in AMQP 0.9.1 spec
> document (introductory chapters are a pretty easy read)
> http://bit.ly/hw2ELX.
>
>
> --
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110709/9b8cd6f2/attachment.htm>

From michael.s.klishin at gmail.com  Sat Jul  9 20:15:21 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sat, 9 Jul 2011 23:15:21 +0400
Subject: [rabbitmq-discuss] Quick question: Writing to multiple queues
In-Reply-To: <CAJE2eFFcbVoXQyTQx+w9UrGU=pUek0qj7cur+UyrbNNeH8gNgw@mail.gmail.com>
References: <CAJE2eFHhk-UKY+wURo45OzMBw1R0vej7JCpmGdPLLDBi7Br=1A@mail.gmail.com>
	<CAE3HoVQzWbZviRF=OAsapgAZNqx9D_X39X=mf6j1NnmVi4axwA@mail.gmail.com>
	<CAJE2eFFzx=tdarht0PS5jbgL9i24L0Z2x7nmj4pst9s1BSQL5g@mail.gmail.com>
	<CAE3HoVQyMWO2c13-PUaz9fREvrV_J2sitEjMC3fQyqYQcps26g@mail.gmail.com>
	<CAJE2eFFcbVoXQyTQx+w9UrGU=pUek0qj7cur+UyrbNNeH8gNgw@mail.gmail.com>
Message-ID: <CAE3HoVQsE0Sb=t8CH7G6r1mUYH=7quZnJy=ijJGX=3gkG4d-4g@mail.gmail.com>

2011/7/9 Demiss Zike <habtdemis at gmail.com>

> On the receiving end of my application, I declared another queue (q3) and
> bind it to the same exchange. Then when I consume messages I consume from q3
> via the exchange I declared. But I don't expect to get any messages since I
> send the messages to queues q1 and q2 but requesting a message from q3. The
> problem is, I still get messages. I could be asking a lot but please bear
> with me. Please look at the code I have and point me to the right direction:


Demiss,

Maybe pictures demonstrate how AMQP works better. Here is the "Hello, world"
of messages over AMQP (1 app publishes a message, another one receives it):

https://github.com/ruby-amqp/amqp/raw/master/docs/diagrams/001_hello_world_example_routing.png

An example of a chat, Twitter-like service or any other broadcasting using
fanout exchange type:

https://github.com/ruby-amqp/amqp/raw/master/docs/diagrams/002_blabbr_example_routing.png


If you send a message to a fanout exchange, it is delivered to all the
queues bound to it, unconditionally. Then if there are consumers
(subscribers, added with BasicConsume method) on any of these queues,
RabbitMQ will push messages out to them. If you want only some of the queues
to get the message, you need a different exchange type (if so, could you
please re-state desired outcome one more time? I am a little confused).
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110709/37e8565f/attachment.htm>

From michael.s.klishin at gmail.com  Sat Jul  9 20:44:47 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sat, 9 Jul 2011 23:44:47 +0400
Subject: [rabbitmq-discuss] Quick question: Writing to multiple queues
In-Reply-To: <CAJE2eFFaLAw0a2NfqGTiGQ+ONd128ng24QGwFwbJReVUs5pWhA@mail.gmail.com>
References: <CAJE2eFHhk-UKY+wURo45OzMBw1R0vej7JCpmGdPLLDBi7Br=1A@mail.gmail.com>
	<CAE3HoVQzWbZviRF=OAsapgAZNqx9D_X39X=mf6j1NnmVi4axwA@mail.gmail.com>
	<CAJE2eFFzx=tdarht0PS5jbgL9i24L0Z2x7nmj4pst9s1BSQL5g@mail.gmail.com>
	<CAE3HoVQyMWO2c13-PUaz9fREvrV_J2sitEjMC3fQyqYQcps26g@mail.gmail.com>
	<CAJE2eFFcbVoXQyTQx+w9UrGU=pUek0qj7cur+UyrbNNeH8gNgw@mail.gmail.com>
	<CAE3HoVQsE0Sb=t8CH7G6r1mUYH=7quZnJy=ijJGX=3gkG4d-4g@mail.gmail.com>
	<CAJE2eFFaLAw0a2NfqGTiGQ+ONd128ng24QGwFwbJReVUs5pWhA@mail.gmail.com>
Message-ID: <CAE3HoVQFoPYQhVu=c=Ebm6PUeJN=kktCmghpcYYYfR-L-FW0HQ@mail.gmail.com>

2011/7/9 Demiss Zike <habtdemis at gmail.com>

> Here is the desired outcome of my simple test programs:
>
> EmitLogs.cs
>
>    - is supposed to publish messages to queues say q1 and q2
>
> ReceiveLogs.cs
>
>    - is supposed to read messages only from queues it subscribed to.
>    - i.e. if i try to read from q3, since there is no q3 bound to the
>       exchange is should not read anything
>       - on the other hand if i try to read from q1 or q2 or both, then i
>       should be able to do so as long as there is a message in the respective
>       queues
>
>
>
Demiss,

In ReceiveLogs.cs, I see the following line:

channel.QueueBind("q3", "logs", "");

so you do, in fact, bind q3 to the logs exchange, that's why it receives the
message.

-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110709/62fea08e/attachment.htm>

From michael.s.klishin at gmail.com  Sat Jul  9 22:46:43 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sun, 10 Jul 2011 01:46:43 +0400
Subject: [rabbitmq-discuss] Quick question: Writing to multiple queues
In-Reply-To: <CAJE2eFE_JQShf4XrmaCPcROovO293nqs=7FnUn=onqeZymimrw@mail.gmail.com>
References: <CAJE2eFHhk-UKY+wURo45OzMBw1R0vej7JCpmGdPLLDBi7Br=1A@mail.gmail.com>
	<CAE3HoVQzWbZviRF=OAsapgAZNqx9D_X39X=mf6j1NnmVi4axwA@mail.gmail.com>
	<CAJE2eFFzx=tdarht0PS5jbgL9i24L0Z2x7nmj4pst9s1BSQL5g@mail.gmail.com>
	<CAE3HoVQyMWO2c13-PUaz9fREvrV_J2sitEjMC3fQyqYQcps26g@mail.gmail.com>
	<CAJE2eFFcbVoXQyTQx+w9UrGU=pUek0qj7cur+UyrbNNeH8gNgw@mail.gmail.com>
	<CAE3HoVQsE0Sb=t8CH7G6r1mUYH=7quZnJy=ijJGX=3gkG4d-4g@mail.gmail.com>
	<CAJE2eFFaLAw0a2NfqGTiGQ+ONd128ng24QGwFwbJReVUs5pWhA@mail.gmail.com>
	<CAE3HoVQFoPYQhVu=c=Ebm6PUeJN=kktCmghpcYYYfR-L-FW0HQ@mail.gmail.com>
	<CAJE2eFE_JQShf4XrmaCPcROovO293nqs=7FnUn=onqeZymimrw@mail.gmail.com>
Message-ID: <CAE3HoVQh3PLYp2Y6gjOXwAFDhWe2WK9QRne7P9W_JN20o1R3yA@mail.gmail.com>

2011/7/10 Demiss Zike <habtdemis at gmail.com>

> My question is, is there a way in RabbitMQ to just subscribe to a queue? If
> so, can you give me a hint as to how I can build that into my subscribe
> method?
>

to subscribe to a queue your application needs to know name of the queue,
then simply use BasicConsume to register a consumer. Alternatively
applications can fetch messages as needed (BasicGet).


>
> My other question is, how can I keep the connection created by subscribe
> method to simply write messages to the exchange?
>

Sorry, I do not understand this question. Applications usually use the same
AMQP connection to both receive and publish messages (but possibly different
channels). Is this what you want to do?

-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110710/ea4aec90/attachment.htm>

From matthew at rabbitmq.com  Sat Jul  9 22:53:55 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Sat, 9 Jul 2011 22:53:55 +0100
Subject: [rabbitmq-discuss] Experimental RabbitMQ Topology Visualiser
In-Reply-To: <24BA697C-5305-4E27-A6BF-DD2C5E5BBA6F@gmail.com>
References: <20110705113855.GB30077@rabbitmq.com>
	<17979245.92.1309869728368.JavaMail.geo-discussion-forums@vbqb20>
	<20110705124905.GE30077@rabbitmq.com>
	<24BA697C-5305-4E27-A6BF-DD2C5E5BBA6F@gmail.com>
Message-ID: <20110709215354.GA2535@rabbitmq.com>

On Sat, Jul 09, 2011 at 08:55:33PM +0200, Alvaro Videla wrote:
> Have you seen/tried this to do something similar to what you try to achieve with js: 
> Demo: http://tweetplumb.com/?q=#%23jquery

That's quite nice. They're lacking exciting boingy elasticated draggable
boxes though.

Matthew

From danarea at gmail.com  Sat Jul  9 22:15:39 2011
From: danarea at gmail.com (Dana Rea)
Date: Sat, 9 Jul 2011 14:15:39 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ won't start on RHEL 6.1
Message-ID: <fdbdc8fe-645f-4c80-a6f3-897eca33c594@r2g2000vbj.googlegroups.com>

When starting rabbit, the network start fails (messages below). From
the messages, it seems like rabbit and epmd are both trying to connect
on 5672 since there's an 'eaddrinuse' message in the log file.

I installed RabbitMQ and Erlang using Fedora's EPEL 6 repo. Rabbit is
version 2.1.1 and Erlang is R14B.

Startup Messages:

Activating RabbitMQ plugins ...
*WARNING* Undefined function fdsrv:bind_socket/2
*WARNING* Undefined function fdsrv:start/0
*WARNING* Undefined function fdsrv:stop/0
*WARNING* Undefined function webmachine_resource:start_link/2
8 plugins activated:
* amqp_client-2.1.1
* erlang_smtp-0.0
* mochiweb-1.4.1
* rabbit_stomp-2.1.1
* rabbit_management-2.1.1
* rabbit_mochiweb-2.1.1
* rabbitmq_smtp_server-2.1.1
* webmachine-1.7.0


+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
|   v2.1.1  +---+   |
|                   |
+-------------------+
AMQP 0-9-1 / 0-9 / 0-8
Copyright (C) 2007-2010 LShift Ltd., Cohesive Financial Technologies
LLC., and Rabbit Technologies Ltd.
Licensed under the MPL.  See http://www.rabbitmq.com/

node           : rabbit at srv6
app descriptor : /usr/lib/rabbitmq/lib/rabbitmq_server-2.1.1/sbin/../
ebin/rabbit.app
home dir       : /var/lib/rabbitmq
cookie hash    : LohMTiS/RBnxf/P8CT1n0A==
log            : /var/log/rabbitmq/rabbit at srv6.log
sasl log       : /var/log/rabbitmq/rabbit at srv6-sasl.log
database dir   : /var/lib/rabbitmq/mnesia/rabbit at srv6
erlang version : 5.8.1

starting file handle cache
server                                     ...done
starting worker
pool                                                  ...done
starting
database                                                     ...done
starting codec correctness
check                                      ...done
-- external infrastructure ready
starting exchange type
registry                                       ...done
starting exchange type
topic                                          ...done
starting exchange type
headers                                        ...done
starting exchange type
fanout                                         ...done
starting exchange type
direct                                         ...done
starting statistics event
manager                                     ...done
starting logging
server                                               ...done
-- kernel ready
starting alarm
handler                                                ...done
starting node
monitor                                                 ...done
starting cluster
delegate                                             ...done
starting guid
generator                                               ...done
starting memory
monitor                                               ...done
-- core initialized
starting empty DB
check                                               ...done
starting exchange
recovery                                            ...done
starting management statistics
database                               ...done
starting queue supervisor and queue
recovery                          ...done
-- message delivery logic ready
starting error log
relay                                              ...done
starting
networking                                                   ...BOOT
ERROR: FAILED
Reason: {{badmatch,
             {error,
                 {shutdown,
 
{child,undefined,'rabbit_tcp_listener_sup_0.0.0.0:5672',
                         {tcp_listener_sup,start_link,
                             [{0,0,0,0},
                              5672,
                              [binary,
                               {packet,raw},
                               {reuseaddr,true},
                               {backlog,128},
                               {exit_on_close,false}],
                              {rabbit_networking,tcp_listener_started,
[]},
                              {rabbit_networking,tcp_listener_stopped,
[]},
                              {rabbit_networking,start_client,[]},
                              "TCP Listener"]},
                         transient,infinity,supervisor,
                         [tcp_listener_sup]}}}},
         [{rabbit_networking,start_listener,4},
          {rabbit_networking,'-boot_tcp/0-lc$^0/1-0-',1},
          {rabbit_networking,boot_tcp,0},
          {rabbit_networking,boot,0},
          {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
          {rabbit,run_boot_step,1},
          {rabbit,'-start/2-lc$^0/1-0-',1},
          {rabbit,start,2}]}
Erlang has closed
{"Kernel pid
terminated",application_controller,"{application_start_failure,rabbit,
{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',
{rabbit,failure_during_boot}}}}}"}

Crash dump was written to: erl_crash.dump
Kernel pid terminated (application_controller)
({application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,
[]]},{'EXIT',{rabbit,failure_during_boot}}}}})

Log:


=INFO REPORT==== 9-Jul-2011::17:11:50 ===
Limiting to approx 924 file handles (829 sockets)

=INFO REPORT==== 9-Jul-2011::17:11:50 ===
Memory limit set to 12844MB.

=INFO REPORT==== 9-Jul-2011::17:11:50 ===
msg_store_transient: using rabbit_msg_store_ets_index to provide index

=INFO REPORT==== 9-Jul-2011::17:11:50 ===
msg_store_persistent: using rabbit_msg_store_ets_index to provide
index

=ERROR REPORT==== 9-Jul-2011::17:11:50 ===
failed to start TCP Listener on 0.0.0.0:5672 - eaddrinuse

=ERROR REPORT==== 9-Jul-2011::17:11:50 ===
FAILED
Reason: {{badmatch,
             {error,
                 {shutdown,
 
{child,undefined,'rabbit_tcp_listener_sup_0.0.0.0:5672',
                         {tcp_listener_sup,start_link,
                             [{0,0,0,0},
                              5672,
                              [binary,
                               {packet,raw},
                               {reuseaddr,true},
                               {backlog,128},
                               {exit_on_close,false}],
                              {rabbit_networking,tcp_listener_started,
[]},
                              {rabbit_networking,tcp_listener_stopped,
[]},
                              {rabbit_networking,start_client,[]},
                              "TCP Listener"]},
                         transient,infinity,supervisor,
                         [tcp_listener_sup]}}}},
         [{rabbit_networking,start_listener,4},
          {rabbit_networking,'-boot_tcp/0-lc$^0/1-0-',1},
          {rabbit_networking,boot_tcp,0},
          {rabbit_networking,boot,0},
          {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
          {rabbit,run_boot_step,1},
          {rabbit,'-start/2-lc$^0/1-0-',1},
          {rabbit,start,2}]}

=INFO REPORT==== 9-Jul-2011::17:11:51 ===
    application: rabbit
    exited: {bad_return,{{rabbit,start,[normal,[]]},
                         {'EXIT',{rabbit,failure_during_boot}}}}
    type: permanent

From videlalvaro at gmail.com  Sun Jul 10 20:22:13 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Sun, 10 Jul 2011 21:22:13 +0200
Subject: [rabbitmq-discuss] RabbitMQ won't start on RHEL 6.1
In-Reply-To: <fdbdc8fe-645f-4c80-a6f3-897eca33c594@r2g2000vbj.googlegroups.com>
References: <fdbdc8fe-645f-4c80-a6f3-897eca33c594@r2g2000vbj.googlegroups.com>
Message-ID: <13F0AAD6-82C0-45D3-BF60-7E8B0343111C@gmail.com>

Hi

> =ERROR REPORT==== 9-Jul-2011::17:11:50 ===
> failed to start TCP Listener on 0.0.0.0:5672 - eaddrinuse

I think that tells that RabbitMQ is already running in your machine or that at least you have a service that is already using that address.

Try checking that there's no version of the broker already running.

-Alvaro


From danarea at gmail.com  Sun Jul 10 20:29:20 2011
From: danarea at gmail.com (Dana Rea)
Date: Sun, 10 Jul 2011 15:29:20 -0400
Subject: [rabbitmq-discuss] RabbitMQ won't start on RHEL 6.1
In-Reply-To: <13F0AAD6-82C0-45D3-BF60-7E8B0343111C@gmail.com>
References: <fdbdc8fe-645f-4c80-a6f3-897eca33c594@r2g2000vbj.googlegroups.com>
	<13F0AAD6-82C0-45D3-BF60-7E8B0343111C@gmail.com>
Message-ID: <CAJpUcHA7gMbS-3bAuu2--JFLFPw2AVbk5uE8aLjvrmBWTccFbQ@mail.gmail.com>

I have, netstat -tlp tells me that it's epmd running on port 5672. Rabbit
still doesn't start if I kill all processes running on that port beforehand.

I'm not familiar with Erlang, but it it possible that Rabbit is trying to
listen on the same port as epmd? Although, starting epmd on another port
didn't help either.

On Sun, Jul 10, 2011 at 3:22 PM, Alvaro Videla <videlalvaro at gmail.com>wrote:

> Hi
>
> > =ERROR REPORT==== 9-Jul-2011::17:11:50 ===
> > failed to start TCP Listener on 0.0.0.0:5672 - eaddrinuse
>
> I think that tells that RabbitMQ is already running in your machine or that
> at least you have a service that is already using that address.
>
> Try checking that there's no version of the broker already running.
>
> -Alvaro
>
>


-- 
 Dana
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110710/c6d7348f/attachment.htm>

From videlalvaro at gmail.com  Sun Jul 10 20:32:54 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Sun, 10 Jul 2011 21:32:54 +0200
Subject: [rabbitmq-discuss] RabbitMQ won't start on RHEL 6.1
In-Reply-To: <CAJpUcHA7gMbS-3bAuu2--JFLFPw2AVbk5uE8aLjvrmBWTccFbQ@mail.gmail.com>
References: <fdbdc8fe-645f-4c80-a6f3-897eca33c594@r2g2000vbj.googlegroups.com>
	<13F0AAD6-82C0-45D3-BF60-7E8B0343111C@gmail.com>
	<CAJpUcHA7gMbS-3bAuu2--JFLFPw2AVbk5uE8aLjvrmBWTccFbQ@mail.gmail.com>
Message-ID: <E5260876-BF2F-4207-AAF6-0376032DD6A6@gmail.com>

If you do:

ps ax | grep rabbit

Do you get any process running? 

BTW, the port 5672 is not the EPMD default one, so that's very strange.

-Alvaro

On Jul 10, 2011, at 9:29 PM, Dana Rea wrote:

> I have, netstat -tlp tells me that it's epmd running on port 5672. Rabbit still doesn't start if I kill all processes running on that port beforehand.
> 
> I'm not familiar with Erlang, but it it possible that Rabbit is trying to listen on the same port as epmd? Although, starting epmd on another port didn't help either.
> 
> On Sun, Jul 10, 2011 at 3:22 PM, Alvaro Videla <videlalvaro at gmail.com> wrote:
> Hi
> 
> > =ERROR REPORT==== 9-Jul-2011::17:11:50 ===
> > failed to start TCP Listener on 0.0.0.0:5672 - eaddrinuse
> 
> I think that tells that RabbitMQ is already running in your machine or that at least you have a service that is already using that address.
> 
> Try checking that there's no version of the broker already running.
> 
> -Alvaro
> 
> 
> 
> 
> -- 
>  Dana

Sent form my Nokia 1100



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110710/6f6d1c83/attachment.htm>

From danarea at gmail.com  Sun Jul 10 20:37:04 2011
From: danarea at gmail.com (Dana Rea)
Date: Sun, 10 Jul 2011 15:37:04 -0400
Subject: [rabbitmq-discuss] RabbitMQ won't start on RHEL 6.1
In-Reply-To: <E5260876-BF2F-4207-AAF6-0376032DD6A6@gmail.com>
References: <fdbdc8fe-645f-4c80-a6f3-897eca33c594@r2g2000vbj.googlegroups.com>
	<13F0AAD6-82C0-45D3-BF60-7E8B0343111C@gmail.com>
	<CAJpUcHA7gMbS-3bAuu2--JFLFPw2AVbk5uE8aLjvrmBWTccFbQ@mail.gmail.com>
	<E5260876-BF2F-4207-AAF6-0376032DD6A6@gmail.com>
Message-ID: <CAJpUcHCpT8b=ZY=b4bUQHOsBzSf9dEL7xErbNdbL=F4kMsXvEA@mail.gmail.com>

On Sun, Jul 10, 2011 at 3:32 PM, Alvaro Videla <videlalvaro at gmail.com>wrote:

> If you do:
>
> ps ax | grep rabbit
>
> Do you get any process running?
>

No, I've been careful to check for running Rabbit processes before trying to
start it.

>
> BTW, the port 5672 is not the EPMD default one, so that's very strange.
>

Hmm, perhaps I'm mistaken then. netstat just reports 0.0.0.0:epmd, so 5672
may not already be in use, netstat doesn't list that number for anything
else.

>
> -Alvaro
>
> On Jul 10, 2011, at 9:29 PM, Dana Rea wrote:
>
> I have, netstat -tlp tells me that it's epmd running on port 5672. Rabbit
> still doesn't start if I kill all processes running on that port beforehand.
>
> I'm not familiar with Erlang, but it it possible that Rabbit is trying to
> listen on the same port as epmd? Although, starting epmd on another port
> didn't help either.
>
> On Sun, Jul 10, 2011 at 3:22 PM, Alvaro Videla <videlalvaro at gmail.com>wrote:
>
>> Hi
>>
>> > =ERROR REPORT==== 9-Jul-2011::17:11:50 ===
>> > failed to start TCP Listener on 0.0.0.0:5672 - eaddrinuse
>>
>> I think that tells that RabbitMQ is already running in your machine or
>> that at least you have a service that is already using that address.
>>
>> Try checking that there's no version of the broker already running.
>>
>> -Alvaro
>>
>>
>
>
> --
>  Dana
>
>
> Sent form my Nokia 1100
>
>
>
>


-- 
 Dana
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110710/7be1c0ce/attachment.htm>

From videlalvaro at gmail.com  Sun Jul 10 20:38:46 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Sun, 10 Jul 2011 21:38:46 +0200
Subject: [rabbitmq-discuss] RabbitMQ won't start on RHEL 6.1
In-Reply-To: <CAJpUcHCpT8b=ZY=b4bUQHOsBzSf9dEL7xErbNdbL=F4kMsXvEA@mail.gmail.com>
References: <fdbdc8fe-645f-4c80-a6f3-897eca33c594@r2g2000vbj.googlegroups.com>
	<13F0AAD6-82C0-45D3-BF60-7E8B0343111C@gmail.com>
	<CAJpUcHA7gMbS-3bAuu2--JFLFPw2AVbk5uE8aLjvrmBWTccFbQ@mail.gmail.com>
	<E5260876-BF2F-4207-AAF6-0376032DD6A6@gmail.com>
	<CAJpUcHCpT8b=ZY=b4bUQHOsBzSf9dEL7xErbNdbL=F4kMsXvEA@mail.gmail.com>
Message-ID: <6EED0B79-F4B2-4937-BD53-D7EEF0D6881A@gmail.com>

If you are sure you don't have any other Erlang application running on your system that may depend on epmd running then you can try by stopping it and starting RabbitMQ afterwards.

On Jul 10, 2011, at 9:37 PM, Dana Rea wrote:

> On Sun, Jul 10, 2011 at 3:32 PM, Alvaro Videla <videlalvaro at gmail.com> wrote:
> If you do:
> 
> ps ax | grep rabbit
> 
> Do you get any process running? 
> 
> No, I've been careful to check for running Rabbit processes before trying to start it. 
> 
> BTW, the port 5672 is not the EPMD default one, so that's very strange.
> 
> Hmm, perhaps I'm mistaken then. netstat just reports 0.0.0.0:epmd, so 5672 may not already be in use, netstat doesn't list that number for anything else. 
> 
> -Alvaro
> 
> On Jul 10, 2011, at 9:29 PM, Dana Rea wrote:
> 
>> I have, netstat -tlp tells me that it's epmd running on port 5672. Rabbit still doesn't start if I kill all processes running on that port beforehand.
>> 
>> I'm not familiar with Erlang, but it it possible that Rabbit is trying to listen on the same port as epmd? Although, starting epmd on another port didn't help either.
>> 
>> On Sun, Jul 10, 2011 at 3:22 PM, Alvaro Videla <videlalvaro at gmail.com> wrote:
>> Hi
>> 
>> > =ERROR REPORT==== 9-Jul-2011::17:11:50 ===
>> > failed to start TCP Listener on 0.0.0.0:5672 - eaddrinuse
>> 
>> I think that tells that RabbitMQ is already running in your machine or that at least you have a service that is already using that address.
>> 
>> Try checking that there's no version of the broker already running.
>> 
>> -Alvaro
>> 
>> 
>> 
>> 
>> -- 
>>  Dana
> 
> Sent form my Nokia 1100
> 
> 
> 
> 
> 
> 
> -- 
>  Dana

Sent form my Nokia 1100



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110710/b640179c/attachment.htm>

From danarea at gmail.com  Sun Jul 10 20:41:35 2011
From: danarea at gmail.com (Dana Rea)
Date: Sun, 10 Jul 2011 15:41:35 -0400
Subject: [rabbitmq-discuss] RabbitMQ won't start on RHEL 6.1
In-Reply-To: <6EED0B79-F4B2-4937-BD53-D7EEF0D6881A@gmail.com>
References: <fdbdc8fe-645f-4c80-a6f3-897eca33c594@r2g2000vbj.googlegroups.com>
	<13F0AAD6-82C0-45D3-BF60-7E8B0343111C@gmail.com>
	<CAJpUcHA7gMbS-3bAuu2--JFLFPw2AVbk5uE8aLjvrmBWTccFbQ@mail.gmail.com>
	<E5260876-BF2F-4207-AAF6-0376032DD6A6@gmail.com>
	<CAJpUcHCpT8b=ZY=b4bUQHOsBzSf9dEL7xErbNdbL=F4kMsXvEA@mail.gmail.com>
	<6EED0B79-F4B2-4937-BD53-D7EEF0D6881A@gmail.com>
Message-ID: <CAJpUcHBCEpxhsPLL-P2U7QmjLNNjC2K5w-Vz_b-pO94ibA-Ntg@mail.gmail.com>

Yes, I have tried that as well.

On Sun, Jul 10, 2011 at 3:38 PM, Alvaro Videla <videlalvaro at gmail.com>wrote:

> If you are sure you don't have any other Erlang application running on your
> system that may depend on epmd running then you can try by stopping it and
> starting RabbitMQ afterwards.
>
> On Jul 10, 2011, at 9:37 PM, Dana Rea wrote:
>
> On Sun, Jul 10, 2011 at 3:32 PM, Alvaro Videla <videlalvaro at gmail.com>wrote:
>
>> If you do:
>>
>> ps ax | grep rabbit
>>
>> Do you get any process running?
>>
>
> No, I've been careful to check for running Rabbit processes before trying
> to start it.
>
>>
>> BTW, the port 5672 is not the EPMD default one, so that's very strange.
>>
>
> Hmm, perhaps I'm mistaken then. netstat just reports 0.0.0.0:epmd, so 5672
> may not already be in use, netstat doesn't list that number for anything
> else.
>
>>
>> -Alvaro
>>
>> On Jul 10, 2011, at 9:29 PM, Dana Rea wrote:
>>
>> I have, netstat -tlp tells me that it's epmd running on port 5672. Rabbit
>> still doesn't start if I kill all processes running on that port beforehand.
>>
>> I'm not familiar with Erlang, but it it possible that Rabbit is trying to
>> listen on the same port as epmd? Although, starting epmd on another port
>> didn't help either.
>>
>> On Sun, Jul 10, 2011 at 3:22 PM, Alvaro Videla <videlalvaro at gmail.com>wrote:
>>
>>> Hi
>>>
>>> > =ERROR REPORT==== 9-Jul-2011::17:11:50 ===
>>> > failed to start TCP Listener on 0.0.0.0:5672 - eaddrinuse
>>>
>>> I think that tells that RabbitMQ is already running in your machine or
>>> that at least you have a service that is already using that address.
>>>
>>> Try checking that there's no version of the broker already running.
>>>
>>> -Alvaro
>>>
>>>
>>
>>
>> --
>>  Dana
>>
>>
>>  Sent form my Nokia 1100
>>
>>
>>
>>
>
>
> --
>  Dana
>
>
> Sent form my Nokia 1100
>
>
>
>


-- 
 Dana
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110710/88c0ac3d/attachment.htm>

From matthias at rabbitmq.com  Sun Jul 10 23:25:43 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 10 Jul 2011 23:25:43 +0100
Subject: [rabbitmq-discuss] RabbitMQ won't start on RHEL 6.1
In-Reply-To: <CAJpUcHBCEpxhsPLL-P2U7QmjLNNjC2K5w-Vz_b-pO94ibA-Ntg@mail.gmail.com>
References: <fdbdc8fe-645f-4c80-a6f3-897eca33c594@r2g2000vbj.googlegroups.com>	<13F0AAD6-82C0-45D3-BF60-7E8B0343111C@gmail.com>	<CAJpUcHA7gMbS-3bAuu2--JFLFPw2AVbk5uE8aLjvrmBWTccFbQ@mail.gmail.com>	<E5260876-BF2F-4207-AAF6-0376032DD6A6@gmail.com>	<CAJpUcHCpT8b=ZY=b4bUQHOsBzSf9dEL7xErbNdbL=F4kMsXvEA@mail.gmail.com>	<6EED0B79-F4B2-4937-BD53-D7EEF0D6881A@gmail.com>
	<CAJpUcHBCEpxhsPLL-P2U7QmjLNNjC2K5w-Vz_b-pO94ibA-Ntg@mail.gmail.com>
Message-ID: <4E1A26E7.2070009@rabbitmq.com>

Dana,

On 10/07/11 20:41, Dana Rea wrote:
> Yes, I have tried that as well.

Run 'lsof -i:5672'. That should tell you what Unix pid is listening on 
the AMQP port.

Matthias.

From thomas.kant at gmail.com  Mon Jul 11 09:50:08 2011
From: thomas.kant at gmail.com (scorpiovn)
Date: Mon, 11 Jul 2011 01:50:08 -0700 (PDT)
Subject: [rabbitmq-discuss] Hibernate-search and RabbitMQ
Message-ID: <d0f86ec4-a045-439c-8a7f-1dcc221be1ae@p29g2000pre.googlegroups.com>

Hi All,

Can we use hibernate-search and RabbitMQ?

Thanks,
+++
thomas kant

From stammailbox at gmail.com  Mon Jul 11 10:23:31 2011
From: stammailbox at gmail.com (mysurf mail)
Date: Mon, 11 Jul 2011 12:23:31 +0300
Subject: [rabbitmq-discuss] a few json rpc questions
Message-ID: <CAJ2-VrkDARuoP-iJgEiwagh_44WgiAhhizEbfTNj9YYyJPCMeQ@mail.gmail.com>

Hi,

I have three general questions regarding rabbit java rpc
1. How should I define the client when I want to use two applications?
currently i use this line
                    new JsonRpcCleint(channel,"",SomeStringNotUniqueToApp)
in all my apps.
Sometimes the application gets stuck in the client wen trying to get the
RPCClient

2. Is the JsonRPCClient/Server a guaranteed message delivery process?
By that I am asking if when the server falls and loads again after few
seconds- will it send answers ?

3. Is there any way to determine timout for RPC ?
I have asked it here before and received a negative answer (emile opened a
bug for it - bug23515)

Thank you very much.
10x.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110711/013fc549/attachment.htm>

From mike.hadlow at 15below.com  Mon Jul 11 11:31:16 2011
From: mike.hadlow at 15below.com (Mike Hadlow)
Date: Mon, 11 Jul 2011 05:31:16 -0500
Subject: [rabbitmq-discuss] Publish/subscribe in RabbitMQ
In-Reply-To: <CAJE2eFETiCOuz5e-6cDon5y52OxcF5H0o9UkdYBquFMZ5fOcRA@mail.gmail.com>
References: <CAJE2eFETiCOuz5e-6cDon5y52OxcF5H0o9UkdYBquFMZ5fOcRA@mail.gmail.com>
Message-ID: <3095E7BFC8C0664E97D71288189F19C6179F8C7C71@AUSP01VMBX29.collaborationhost.net>

Hi Demi,

I've been writing a 'high level' API for RabbitMQ on .NET. It might give you some pointers:
https://github.com/mikehadlow/EasyNetQ

Mike


From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Demiss Zike
Sent: 08 July 2011 17:59
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: [rabbitmq-discuss] Publish/subscribe in RabbitMQ

I am using RabbitMQ to publish/subscribe. I have a class (in C#) that has the following methods to do this job:

    void write (Measurement m);
    Measurement read();
    void publish(string queue);
    Measurement subscribe(string queue);

I am having difficulty separating writing a message from publishing the message to a queue (or reading a message from subscribing to a queue for that message). What would be the best method of design/implementation?

Regards,
Demi

15below Limited: Company registered in England and Wales No 3945289
Registered Office: Lyndean House, 43-46 Queens Road, Brighton BN1 3XB, United Kingdom

15below Australia Pty Limited: ABN 25 132 716 379
Level 50, 120 Collins Street, Melbourne, Victoria 3000, Australia

Please think about the environment before printing this email.

************************************************************************
This email and any attachments may be confidential and/or legally privileged and are solely for the use of the intended recipient. If you have received this email in error please contact the sender. Any views or opinions expressed within this e-mail are solely those of the sender, and do not necessarily represent those of 15below unless otherwise specifically stated. Although 15below has taken every reasonable precaution to ensure that any attachment to this e-mail has been checked for viruses, it is strongly recommended that you carry out your own virus check before opening any attachment, as we cannot accept liability for any damage sustained as a result of software virus infection.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110711/fc7af4e6/attachment.htm>

From majek04 at gmail.com  Mon Jul 11 11:38:26 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Mon, 11 Jul 2011 11:38:26 +0100
Subject: [rabbitmq-discuss] Small fix for the tutorials
In-Reply-To: <7ED8E297-BEBD-47C7-9664-A3CC4541389F@gmail.com>
References: <7ED8E297-BEBD-47C7-9664-A3CC4541389F@gmail.com>
Message-ID: <CABzX+qy7RfZBRxOUMNKc0zPY5ooUaG=kOaoyBfZe9aAkjSjWJQ@mail.gmail.com>

On Sat, Jul 9, 2011 at 19:10, Alvaro Videla <videlalvaro at gmail.com> wrote:
> Hi,
>
> I saw that the PHP examples on the tutorial page are pointing the readers to a different PHP library than the one used on the sample code.
>
> See here: http://www.rabbitmq.com/getstarted.html, the wrong link is to this page: http://code.google.com/p/php-amqplib/
>
> While the tutorials here: https://github.com/rabbitmq/rabbitmq-tutorials/tree/master/php are pointing you to the right one which is: https://github.com/tnc/php-amqplib
>
> Could that be fixed? Yeterday a co-worker had a problem following the tutorials since he installed the wrong library version.

Fixed. Thanks for reporting that.

Cheers,
 Marek

From emile at rabbitmq.com  Mon Jul 11 12:00:43 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 11 Jul 2011 12:00:43 +0100
Subject: [rabbitmq-discuss] a few json rpc questions
In-Reply-To: <CAJ2-VrkDARuoP-iJgEiwagh_44WgiAhhizEbfTNj9YYyJPCMeQ@mail.gmail.com>
References: <CAJ2-VrkDARuoP-iJgEiwagh_44WgiAhhizEbfTNj9YYyJPCMeQ@mail.gmail.com>
Message-ID: <4E1AD7DB.2090702@rabbitmq.com>

Hi,

On 11/07/11 10:23, mysurf mail wrote:
> Hi, 
> 
> I have three general questions regarding rabbit java rpc 
> 1. How should I define the client when I want to use two applications? 
> currently i use this line 
>                     new JsonRpcCleint(channel,"",SomeStringNotUniqueToApp)
> in all my apps. 
> Sometimes the application gets stuck in the client wen trying to get the
> RPCClient

The RPC servers that serve requests for different applications must be
listening on different work queues. You must ensure that RPC clients use
a routing key that matches the server queue and are different for each
application.

I don't see how it makes sense to use a routing key that is not unique
to the application. Perhaps you can explain your intended use.

> 2. Is the JsonRPCClient/Server a guaranteed message delivery process? 
> By that I am asking if when the server falls and loads again after few
> seconds- will it send answers ? 

The server work queue is normally declared outside the RPC Server
framework, so you can set this up as a durable queue if you want work
messages to survive a server restart.

> 3. Is there any way to determine timout for RPC ? 
> I have asked it here before and received a negative answer (emile opened
> a bug for it - bug23515)

This feature has been added recently and will be in the next release.


-Emile

From emile at rabbitmq.com  Mon Jul 11 12:07:55 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 11 Jul 2011 12:07:55 +0100
Subject: [rabbitmq-discuss] Hibernate-search and RabbitMQ
In-Reply-To: <d0f86ec4-a045-439c-8a7f-1dcc221be1ae@p29g2000pre.googlegroups.com>
References: <d0f86ec4-a045-439c-8a7f-1dcc221be1ae@p29g2000pre.googlegroups.com>
Message-ID: <4E1AD98B.1000600@rabbitmq.com>

Hi Thomas,

On 11/07/11 09:50, scorpiovn wrote:
> Hi All,
> 
> Can we use hibernate-search and RabbitMQ?

Those are two very different technologies - can you describe how you
want them to work together?


-Emile

From rob.harrop at gmail.com  Mon Jul 11 12:24:59 2011
From: rob.harrop at gmail.com (Rob Harrop)
Date: Mon, 11 Jul 2011 12:24:59 +0100
Subject: [rabbitmq-discuss] Feedback on STOMP changes
In-Reply-To: <iun5u2$p2r$1@dough.gmane.org>
References: <4E04923C.4090307@rabbitmq.com> <iun5u2$p2r$1@dough.gmane.org>
Message-ID: <4E1ADD8B.6080907@rabbitmq.com>

We are adding support for reply-to destinations just like ActiveMQ and 
Apollo.

Clients will not have to ensure that queue names are unique - this will 
be handled by the broker.

Michael Justin wrote:
> Am 24.06.2011 15:33, Rob Harrop wrote:
>
>> We'll add support for durable, exclusive, auto-delete and everything
>
> Would this include creation of "temporary queues", which exist only for
> the duration of the connection?
>
> If yes, does the client have to ensure that the temporary queue name is
> unique?
>
> In Stomp implementations for ActiveMQ and OpenMQ, the server creates the
> queue name and adds it as "reply-to" header to the messages (see
> https://issues.jboss.org/browse/HORNETQ-381)
>
> Regards

From alexandru at rabbitmq.com  Mon Jul 11 13:32:45 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Mon, 11 Jul 2011 13:32:45 +0100
Subject: [rabbitmq-discuss] precondition_failed error with amqp_client
 for erlang
In-Reply-To: <CAApCF45mYRGXzz1BcpTxd0cLC7EQrZ+pMui+=5Giq6QZxfzVaw@mail.gmail.com>
References: <BANLkTimEPWwHhza=v_6bP98a2JPuo64j9Q@mail.gmail.com>
	<20110630114821.GB18064@rabbitmq.com>
	<BANLkTi=feh3MPQxQ6vfBnwiaN1TqYsHAkg@mail.gmail.com>
	<BANLkTikioatpncH7r9otPHdLJ8n60wEnJw@mail.gmail.com>
	<20110704161643.GF6403@dakota.eng.vmware.com>
	<CAApCF45mYRGXzz1BcpTxd0cLC7EQrZ+pMui+=5Giq6QZxfzVaw@mail.gmail.com>
Message-ID: <20110711123245.GB2688@dakota.eng.vmware.com>

Hi Max,

Sorry for the wait, we're actually rewriting that part of the Erlang
client right now.  So, some of things I say now will change in the near
future.

> For the sake of clarity here is the glossary of terms I used in my last

Thanks for the clarification.

> Yes a list of messages that the amqp_client process sends to a subscriber,
> particularly pertaining to errors in amqp_client land, would be very
> helpful.  I'd like to be able to handle all {'DOWN',Etc} messages with my
> long running process (server).  I'm hoping to handle all hard errors so that
> a restart from either supervisor (my long running process or the
> amqp_client's) won't break the communication between the two.

You don't need to call amqp_client:start/2.  Amqp_connection:start/1
does that automatically.  If you really do need to do it manually, you
should probably use amqp_client:start/0 which uses the .app.  I don't
think it makes any difference to what you're doing.

The AMQP client supervises connections and connections supervise their
channels.  Neither channels nor connections are restarted if they
encounter an error; in certain cases they actually take down their
supervisors, as well.

You normally receive messages from connections and channels.  I don't
see any way for amqp_sup to send a message or even die.  It's only there
if you need a quick way to close all connections.

Connections and channels are gen_servers and you're used to working with
them through the various amqp_connection and amqp_channel methods.
Ignoring the usual call/casts and replies, connection shouldn't send you
any messages and channel should only send:
  * {#'basic.deliver'{}, #'amqp_msg'{}}, #'basic.cancel'{}, and
    #'basic.cancel_ok'{}, to registered consumers (including the
    default consumer),
  * {#'basic.return'{}, #'amqp_msg'{}} to the return handler if it's
    registered,
  * #'channel.flow'{} to the flow handler if it's registered, and
  * #'basic.ack'{} and #'basic.nack'{} to the confirm handler if it's
    registered.

(We're currently changing the way consumers work: consumer behaviour
will be determined by what consumer module is registered with the
channel.  The default selective_consumer will behave more or less like
the current implementation and will send out approximately the same
messages.  Direct_consumer, by contrast, will forward all the messages
it receives to another process and let it handle the details of
multiplexing many consumer processes.)

In case of an error, connections and channels behave in the same way: if
the error occurs while waiting for a blocking call to finish (for
instance during an amqp_channel:call), the channel/connections will die
and the calling process will be sent one of the exit signals below (as
per gen_server normal behaviour); if the error occurs "in the background",
the channel/connection will exit with one of the reasons below.

The following are Connection's possible exit reasons:
  * normal, when the connection was closed cleanly by the *user*,
  * {timeout_waiting_for_close_ok, Reason}, {socket_closing_timeout,
    Reason}, socket_closed_unexpectedly, {socket_error, _},
    {channel0_died, Reason}, heartbeat_timeout; these are all specific
    to network connections: half deal with various environment problems,
    the other half involve errant server behaviour or a key process
    inside the connection dying;
  * {shutdown, {error, Error}} caused by gen_tcp:connect during the initial
    call to amqp_connection:start/0;
  * {shutdown, normal}, {shutdown, {server_initiated_close, Code, Text}},
    when the server initiated the connection close; again, normal just
    means that the reply_code was 200;
  * {shutdown, {app_initiated_close, Code, Text}}, {shutdown,
    {server_misbehaved, Code, Text}}, {shutdown, {internal_error, Code,
    Text}} when you or the amqp_client started shutting down the
    connection;
  * if you attempt to use a connection or channel method while the
    connection is closing, the method will return closing.

The following are Channel's possible exit reasons:
  * normal, when the channel was closed cleanly by the *user*, or when
    the connection is closed cleanly,
  * timed_out_flushing_channel, timed_out_waiting_close_ok, when the
    channel is waiting for various things; the first one happens when
    the channel is closing cleanly but still has pending methods to
    execute and times out; see below,
  * {shutdown, {server_misbehaved, #amqp_error{}}}, when the server does
    something illegal to the channel,
  * {shutdown, {server_initiated_close, Code, Text}}, when the server
    sends a channel.close to *this* channel (it it's sent to another
    channel, this channel will exit with a connection_closing status),
  * {shutdown, {app_initiated_close, Code, Text}}, when the user closes
    this channel, and
  * {shutdown, {connection_closing, Reason}}, when the connection is
    closing and has instructed this channel to close; the Reason is
    one of the connection closing reasons mentioned above; if the Reason
    is normal, the channel will also exit with normal.

Amqp_channel holds a queue of pending RPC methods to execute.  When you
call amqp_channel:close/1, it starts "flushing", that is, it no longer
accepts new methods, but still tries to execute the already enqueued
ones.

Those are the different ways connections and channels can close as far
as I can tell.

We're currently changing the behaviour so that the various methods
return {error, Error} rather than kill the calling process.

> But I get the impression that I'm missing something about how I'm supposed
> to treat the amqp_client library with regard to amqp_client:start/2.  Should
> I be treating the amqp_client connection like mnesia (an application
> entirely independent of mine), add it to my existing supervision tree and
> share one connection throughout my application, or, what I'm currently
> doing, let each part of my application that needs to talk to amqp spin up
> and close their own connection/channel?

It's more of a standalone-application, I think.  There's not much point
in supervising amqp_sup since it can't really go down.  It's probably
best to just ignore it entirely and focus on channels and connections,
which are *not* restarted on failure.

Multiple connections is fine, especially since otherwise you'd have to
worry about restarting connections *and* letting other processes know
that the connection has changed.

Does this help?

Cheers,
Alex

On Tue, Jul 05, 2011 at 11:28:46AM -0400, Max Warnock wrote:
> Sorry about the ambiguity,
> 
> For the sake of clarity here is the glossary of terms I used in my last
> email (which probably clashes with the erlang/amqp_client context you're
> coming from):
> 
> Server - I'm referring to my long running process in erlang that I have
> given a registered name and passed as the 3rd argument to
> amqp_client:subscribe/3.
> Listener - the process created by the amqp_client library when a connection
> and channel are opened
> Subscribe - calling of amqp_client:subscribe/3
> My - I'm using this pronoun to distinguish code written by me from code
> written by you cats at rabbitmq (client library, rabbitmq server, etc)
> 
> I've attached a diagram (approximation/abstraction) of how I'm interacting
> with the amqp_client library. (sorry to the mailing list if attaching a 40K
> diagram breaks etiquette).
> 
> I'm using the amqp_client library in network mode, i.e.,
> amqp_client:start(network, #amqp_params{host = Host, heartbeat=60000})
> 
> Yes a list of messages that the amqp_client process sends to a subscriber,
> particularly pertaining to errors in amqp_client land, would be very
> helpful.  I'd like to be able to handle all {'DOWN',Etc} messages with my
> long running process (server).  I'm hoping to handle all hard errors so that
> a restart from either supervisor (my long running process or the
> amqp_client's) won't break the communication between the two.
> 
> But I get the impression that I'm missing something about how I'm supposed
> to treat the amqp_client library with regard to amqp_client:start/2.  Should
> I be treating the amqp_client connection like mnesia (an application
> entirely independent of mine), add it to my existing supervision tree and
> share one connection throughout my application, or, what I'm currently
> doing, let each part of my application that needs to talk to amqp spin up
> and close their own connection/channel?
> 
> Thanks,
> -Max
> 
> On Mon, Jul 4, 2011 at 12:16 PM, Alexandru Scvor?ov
> <alexandru at rabbitmq.com>wrote:
> 
> > Hi Max,
> >
> > I'm trying to run through the steps you provided, but I'm having a bit
> > of trouble following.
> >
> > Are you using a network or a direct connection? (I assume network, but
> > it probably doesn't matter)
> >
> > By server, do you mean the actual RabbitMQ server, or you application?
> > (I'm guessing your long-running application)
> >
> > By subscribe, do you mean calling amqp_channel:subscribe/3?  If so, do
> > you still need a list of the messages the channel may send its
> > subscriber?
> >
> > Or do you mean that your application is sending messages to its
> > subscribers?
> >
> > > 6.) The server supervisor restarts the server which creates a new
> > listener,
> > > but the old listener is still hanging around trying to send the the
> > > registered name
> >
> > What's a listener?  Is it a process that receives messages from the
> > erlang client because it's the endpoint of a subscription to a queue?
> >
> > Can't you link listeners to the server so that when the server goes
> > down, it takes the listeners with it?
> >
> > > So my question then is how should I kill the amqp_client?
> >
> > What do you mean by amqp_client?  If it's an amqp_connection process,
> > you can just send it an shutdown exit.
> >
> > Thanks for the information.
> >
> > Cheers,
> > Alex
> >
> > On Fri, Jul 01, 2011 at 01:51:10PM -0400, Max Warnock wrote:
> > > Problem found.  Thanks for your help.  The problem is a strange one and
> > has
> > > to do with me not shutting my amqp_client listener down properly if my
> > > server dies.  Here is how it manifests:
> > >
> > > 1.) Server starts up and starts up a amqp client connection and channel
> > > 2.) The server binds to that channel and starts the subscription using a
> > > registered name name as the process to which messages will be sent
> > > 3.) Messages start coming in and are ack-ing fine
> > > 4.) Poor error handling in farming out processes brings the server down
> > > 5.) The server does no close the amqp_client connection
> > > 6.) The server supervisor restarts the server which creates a new
> > listener,
> > > but the old listener is still hanging around trying to send the the
> > > registered name
> > > 7.) The older listener sends a message to the server
> > > 8.) The server tries to ack to the new listener which did not send the
> > > message
> > > 9.) The new server pukes because it never sent a message with that tag
> > >
> > > So my question then is how should I kill the amqp_client? If I send it an
> > > exit its supervisor will restart it.  This is what I was getting at with
> > my
> > > tangential questions in the last email.  How should I shut down the
> > > amqp_client without shutting down all the other servers' amqp client
> > > listeners?
> > >
> > > Thanks for all the help,
> > > -Max
> > >
> > > On Thu, Jun 30, 2011 at 9:23 AM, Max Warnock <maxjwarnock at gmail.com>
> > wrote:
> > >
> > > > Thanks, that's very helpful from both the possible issues to chase and
> > > > sanity check perspectives.
> > > >
> > > > I'm using erlang R13B04 with a rabbitmq server installed via gentoo's
> > > > portage at version 2.4.1. I pulled the client library from github (tag
> > > > 2.3.0, commit: 844738f9b56d34104c1ea2ac5700d0898126c5b4).
> > > >
> > > > I'm going to write some debug code to store all the tags I try to ack
> > on
> > > > and see if I can get this error to where it's easily reproducible.
> > Thanks
> > > > for narrowing my search, it's very helpful.  I'll keep you updated. I
> > must
> > > > be doing something wrong somewhere.  I have a hard time believing such
> > a
> > > > widely used library could fail so hard myself.
> > > >
> > > > One thing that would be extremely helpful is if you could point me to
> > some
> > > > documentation which I haven't been able to find:  I'm looking for a
> > listing
> > > > of all the events/messages that are sent out by the amqp client to a
> > > > subscriber.  What does it send when it goes down, what other soft
> > errors
> > > > will it send out, etc.  Additionally, is there a doc somewhere for best
> > > > practices in connecting a listener to another server/long-running
> > process?
> > > >  Not having either of those there has been some struggle to know how to
> > > > restart the subscription/listening process if my server dies.  The
> > > > amqp_client tutorial has been a great help, but when it comes to error
> > > > handling from the listening module perspective it doesn't tell me what
> > the
> > > > library is expecting me to do.  I don't want to have to do a bunch of
> > > > engineering because I'm square peg, round hole-ing the library.  The
> > primary
> > > > issues I'm concerned with are when my server dies hard and is destined
> > to be
> > > > restarted by its supervisor what should I send to the amqp client
> > process?
> > > > Should I send it close messages and then start a new one? Or should I
> > > > reconnect to the client library.  This wouldn't be as big of an issue
> > but I
> > > > need to use durable/persistent queues and if I still have a listener
> > hanging
> > > > around with the same bindings on the same queue it will eat all my
> > messages
> > > > and send them nowhere.
> > > >
> > > > Thanks,
> > > > -Max
> > > >
> > > > On Thu, Jun 30, 2011 at 7:48 AM, Matthew Sackman <matthew at rabbitmq.com
> > >wrote:
> > > >
> > > >> Hi Max,
> > > >>
> > > >> On Wed, Jun 29, 2011 at 06:28:59PM -0400, Max Warnock wrote:
> > > >> > I've built a behavior in erlang to subscribe to a given topic
> > exchange
> > > >> and
> > > >> > farm out message handling.  I'm using the rabbitmq amqp_client
> > library
> > > >> for
> > > >> > erlang and when I put the system under heavy load I get, on
> > occasion,
> > > >> the
> > > >> > following error:
> > > >>
> > > >> Could you let us know which version of Rabbit, Erlang and the Erlang
> > > >> client you're using?
> > > >>
> > > >> > =ERROR REPORT==== 29-Jun-2011::18:02:18 ===
> > > >> > ** Generic server <0.1117.0> terminating
> > > >> > ** Last message in was {'$gen_cast',
> > > >> >                            {method,
> > > >> >                                {'channel.close',406,
> > > >> >                                    <<"PRECONDITION_FAILED - unknown
> > > >> delivery
> > > >> > tag 856">>,
> > > >> >                                    60,80},
> > > >>
> > > >> That's a double-ack (probably). Sadly, the AMQP 0-9-1 spec says that
> > > >> acking is not idempotent, thus it's a fault to ack the same message
> > > >> multiple times...
> > > >>
> > > >> > The server receive loop where the ack happens looks like this:
> > > >> > receive
> > > >> > ...
> > > >> > {#'basic.deliver'{delivery_tag = Tag, routing_key = RoutingKey},
> > > >> > #amqp_msg{payload = Payload}} ->
> > > >> >     amqp_channel:cast(get(amqp_channel_pid),
> > #'basic.ack'{delivery_tag =
> > > >> > Tag}),
> > > >> >     spawn_and_queue(spawn_handle_message, Module, RoutingKey,
> > Payload),
> > > >> >     loop(Module);
> > > >> > ...
> > > >> > end
> > > >>
> > > >> ...hmmm, which is so simple that I can't see how it could go wrong: if
> > > >> you're not double acking then something else must be going on to make
> > > >> the broker think that it's not expecting an ack for that message,
> > hence
> > > >> the error. If you're doing some sort of reject operation - either
> > > >> basic.nack or basic.reject on messages and you then subsequently ack
> > one
> > > >> of those messages then that would also cause this error. There may be
> > > >> other cases as well.
> > > >>
> > > >> > The amqp_client_sup can't seem to bring back the the client either
> > and
> > > >> dies
> > > >> > from the retry intensity being reached.  I've done a hefty amount of
> > > >> > googling and can't seem to find where things could be going wrong.
> > > >>  Before
> > > >> > jumping into the amqp_client code I thought I'd ask the mailing list
> > if
> > > >> they
> > > >> > have any ideas.  The only thing I can think is that there is a race
> > > >> > condition within the client library.  I will be double checking my
> > code
> > > >> to
> > > >> > be sure it isn't sending the ack twice, but given the simplicity of
> > the
> > > >> ack
> > > >> > the only way it could is if it receives the same message (with
> > identical
> > > >> > delivery tag) from the amqp_client library twice.
> > > >>
> > > >> It could be a bug in the client library, but I'd be a little surprised
> > > >> if we're managing to duplicate messages somehow - that would be a new
> > > >> level of fail for us. ;) However, the fact that the entire connection
> > > >> dies is alarming and almost certainly a bug: PRECONDITION_FAILED is a
> > > >> soft error and should only tear down the channel, not the whole
> > > >> connection. After that, all you should have to do is create a new
> > > >> channel and everything else should be ok. If that's not the case
> > please
> > > >> let us know.
> > > >>
> > > >> Best wishes,
> > > >>
> > > >> Matthew
> > > >> _______________________________________________
> > > >> rabbitmq-discuss mailing list
> > > >> rabbitmq-discuss at lists.rabbitmq.com
> > > >> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > > >>
> > > >
> > > >
> >
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-discuss at lists.rabbitmq.com
> > > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >



From matthias at rabbitmq.com  Mon Jul 11 13:35:12 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 11 Jul 2011 13:35:12 +0100
Subject: [rabbitmq-discuss] Published message not queued after
 publish-ok received when connection quickly closed
In-Reply-To: <CA+JR6zNqufispyo+Je-nuCCAzAwsczkSOw2FzKP549UFA3P2Sw@mail.gmail.com>
References: <BANLkTi=G-sMFmrr_-srSqmo_bSfyw8-w8Q@mail.gmail.com>	<4DC3C2B7.701@rabbitmq.com>	<yrv4coc3gt7bt.fsf@dwragg.eng.vmware.com>	<CA+JR6zMSpkSdsptApw0Mwy1f8hpz2vmxYq_0oT0RgOkcs8WL4g@mail.gmail.com>	<CA+1R4g7ERx+36NX=9Kas1nyfY70_9ZV8SNokHEHrW+nEBFMgKA@mail.gmail.com>	<CA+JR6zMXTAZOhfE8L5n5D6G__4rzJqpqyXstz+Pr8+aqLFf4PQ@mail.gmail.com>	<CA+1R4g4DLq2bEVg8qoMrfXKObhS4bCmwx6WA3RM_YyO=bxPKow@mail.gmail.com>	<CA+JR6zMAtcQrEXqCH+pXb3+HGQ3gV=sFHxZO=C_=Tpo1JYhoMQ@mail.gmail.com>	<314D419E-FDDC-4AA9-84C5-3E8EA4230D62@101ideas.cz>	<CA+JR6zNM+jD540A8YaTs11H+azFHV6zqnC_OCXhnLFa6DMTFFg@mail.gmail.com>	<CAE3HoVSgTHzo8MTC1L84ccJ2q-vSesxhW6=cTyXEd2nxd_-M6w@mail.gmail.com>
	<CA+JR6zNqufispyo+Je-nuCCAzAwsczkSOw2FzKP549UFA3P2Sw@mail.gmail.com>
Message-ID: <4E1AEE00.1090006@rabbitmq.com>

Michael,

On 08/07/11 17:37, Michael Nacos wrote:
> the code is similar to the one I originally posted
>
>      @queue1.subscribe(:ack => true) do |metadata, data|
>        @channel.tx_select
>        @channel.default_exchange.publish(data, \
>          :routing_key => @deliver_to, \
>          :persistent => true, \
>          :nowait => false)
>        puts '.'
>        @channel.tx_commit
>        metadata.ack
>        @channel.tx_commit # <-- if not present, there is always one
> unacked msg in @queue1
>      end
>
> it wasn't hanging, but because of the tx_select, the ack didn't happen
> until the next time the consume callback was run, which I fixed by
> introducing another tx_commit right after the ack. mind you, with one
> tx_commit right after metadata.ack I lost messages.

Under what circumstances did messages get lost? When killing the broker?

I could see that happening if the broker is killed during the tx.commit 
- the 'ack' may get processed before the 'publish', and if the broker is 
nuked in-between the latter would get lost.

'confirms' would be a better way to handle the above scenario, i.e. wait 
for confirmation of the 'publish' and only then send the ack.

Regards,

Matthias.

From matthias at rabbitmq.com  Mon Jul 11 14:01:41 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 11 Jul 2011 14:01:41 +0100
Subject: [rabbitmq-discuss] RabbitMQ: Implementing "Topic" feature of
 ActiveMQ via RabbitMQ.
In-Reply-To: <CAHGiV9KE-9sD4P6Caau56qUKHyz2_1JcTWsmwm3cCeZpJ+3jOg@mail.gmail.com>
References: <CAHGiV9KE-9sD4P6Caau56qUKHyz2_1JcTWsmwm3cCeZpJ+3jOg@mail.gmail.com>
Message-ID: <4E1AF435.50201@rabbitmq.com>

On 08/07/11 11:42, GURPREET SINGH wrote:
> The producer produces messages and receiver receives /all/ the messages,
> which are published after the time it has first connected to the queue.
>
> [...]
>
> A consumer C1 creates a queue Q1 which is exclusive and durable. Now it
> is down for some time and in the meantime another user C2 tries to
> connect to queue Q1. C2 will be successfull since, Q1 has now no
> subscriber connected to it. So, C2 gets connected to the exclusive and
> durable queue. Now, if C1 tries to connect to queue Q1 it cannot do so,
> since already a consumer C2 is subscribed to the queue Q1.
>
> How one can prevent such scenario ?

If you want multiple consumers to receive the same message then you need 
multiple queues, e.g. one per consumer - see 
http://www.rabbitmq.com/tutorials/tutorial-three-python.html. And in 
order to get the equivalent of durable subscriptions, the queues need to 
be durable, non-exclusive and explicitly named.

So simply get each consumer to declare a durable, non-exclusive named 
queue on start up, bind it to the desired exchange, and then start 
consuming. Since all these operations are idempotent, a clients can 
execute them on startup even when the referenced queues/bindings already 
exist from a previous invocation.

Regards,

Matthias.

From matthias at rabbitmq.com  Mon Jul 11 15:02:19 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 11 Jul 2011 15:02:19 +0100
Subject: [rabbitmq-discuss] RabbitMQ: Implementing "Topic" feature of
 ActiveMQ via RabbitMQ.
In-Reply-To: <CAHGiV9+Xy5MYkh=mHV3DuEevsOLUqweKxT9ToaWUo=CErH3+=g@mail.gmail.com>
References: <CAHGiV9KE-9sD4P6Caau56qUKHyz2_1JcTWsmwm3cCeZpJ+3jOg@mail.gmail.com>	<4E1AF435.50201@rabbitmq.com>
	<CAHGiV9+Xy5MYkh=mHV3DuEevsOLUqweKxT9ToaWUo=CErH3+=g@mail.gmail.com>
Message-ID: <4E1B026B.8040109@rabbitmq.com>

Gurpreet,

[adding the list back on 'cc']

On 11/07/11 14:48, GURPREET SINGH wrote:
> Got it. It means, that the consumer has to keep the queue name very
> secret, since if it is hacked by someone then this will be very
> troublesome to the original user.

Sure, but that's unavoidable, i.e. something somewhere has to remain secret.

One can shift the secrecy to the authentication scheme, e.g. by 
partitioning the queue name space between users.

> Also, there can be a situation when a consumer creates a durable queue,
> uses it to receive messages.
> Now, the same consumer creates another queue, uses it and then create
> another queue again. This will
> cause lot of junk queues and memory wasted for those types of junk
> queues, and might reduce the performance of RabbitMQ.
> Is there anything like a time-out thing, i.e. if there is no consumer
> for a specified duration of time, the queue gets auto-deleted.
> I know about auto-delete option but that deletes the queue as soon as
> there is no other consumer connected to it, there is no timeout concept.

We invented queue leases 
(http://www.rabbitmq.com/extensions.html#queue-leases) for that very 
purpose :)


Matthias.

From danarea at gmail.com  Mon Jul 11 15:59:33 2011
From: danarea at gmail.com (Dana Rea)
Date: Mon, 11 Jul 2011 07:59:33 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ won't start on RHEL 6.1
In-Reply-To: <4E1A26E7.2070009@rabbitmq.com>
References: <fdbdc8fe-645f-4c80-a6f3-897eca33c594@r2g2000vbj.googlegroups.com>
	<13F0AAD6-82C0-45D3-BF60-7E8B0343111C@gmail.com>
	<CAJpUcHA7gMbS-3bAuu2--JFLFPw2AVbk5uE8aLjvrmBWTccFbQ@mail.gmail.com>
	<E5260876-BF2F-4207-AAF6-0376032DD6A6@gmail.com>
	<CAJpUcHCpT8b=ZY=b4bUQHOsBzSf9dEL7xErbNdbL=F4kMsXvEA@mail.gmail.com>
	<6EED0B79-F4B2-4937-BD53-D7EEF0D6881A@gmail.com>
	<CAJpUcHBCEpxhsPLL-P2U7QmjLNNjC2K5w-Vz_b-pO94ibA-Ntg@mail.gmail.com>
	<4E1A26E7.2070009@rabbitmq.com>
Message-ID: <7afb6a90-0b91-452b-8a4d-1e87ebe3b655@j15g2000yqf.googlegroups.com>

As in most cases I'm sure, this issue was caused by a misunderstanding
on my part. RHEL provides an amqp server called Qpid which was already
running. Since I thought that epmd was running on 5672, I missed the
listing for ampq/Qpid in netstat (not a fan of symbolic ports in the
output now).

Stopping the Qpid service corrects the problem.

# service qpidd stop & chkconfig --del qpidd

May be useful provide a brief note about this in the install document
for RHEL.

On Jul 10, 6:25?pm, Matthias Radestock <matth... at rabbitmq.com> wrote:
> Dana,
>
> On 10/07/11 20:41, Dana Rea wrote:
>
> > Yes, I have tried that as well.
>
> Run 'lsof -i:5672'. That should tell you what Unix pid is listening on
> the AMQP port.
>
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From alexis at rabbitmq.com  Mon Jul 11 17:05:41 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Mon, 11 Jul 2011 17:05:41 +0100
Subject: [rabbitmq-discuss] Integration of SAP XI with RabbitMQ
In-Reply-To: <4db977ae-8bad-44c8-b204-13c6f2aa4c40@c41g2000yqm.googlegroups.com>
References: <ce1093a7-7fb3-4797-8c39-c3457581ebcf@w4g2000yqm.googlegroups.com>
	<4db977ae-8bad-44c8-b204-13c6f2aa4c40@c41g2000yqm.googlegroups.com>
Message-ID: <CACOPnve_ocGxcydweiaw3a8BX8LMFcVepNApgjqnh1dAi+Q_jA@mail.gmail.com>

Rishi

I have bcc'd someone who may be able to advise you.

alexis


On Fri, Jul 8, 2011 at 9:21 PM, RishiDev <rishdev at gmail.com> wrote:
> To certain extent I believe the question should go to SAPXI community.
> And we have already raised a ticket with them, but still I wanted to
> quickly check if someone from our RabbitMQ community has some tips to
> share.
>
> On Jul 8, 1:36?pm, RishiDev <rish... at gmail.com> wrote:
>> Hi,
>>
>> Our organization has SAP XI 7.0 systems which sends various messages
>> to other systems across the enterprise.
>> For better performance, reliability and message compression etc
>> abilities we are trying to move from ActiveMQ to RabbitMQ. Having SAP
>> XI talk to ActiveMQ was easy by using JMS type communication channel
>> configured in XI. I want to learn from the group, what is best &
>> recommended approach for SAPXI to Rabbit integration.
>>
>> I know that we can use QPID (I haven't tried yet though) and get a JMS
>> kind of integration between SAPXI and Rabbit, but I would love it, if
>> we can have a pure AMQP base communication and avoid JMS.
>>
>> I will appreciate any help for what approach and how (to follow) to
>> integrate SAPXI with Rabbit.
>>
>> Thank you.
>> Rishi
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From thomas.kant at gmail.com  Mon Jul 11 17:41:34 2011
From: thomas.kant at gmail.com (scorpiovn)
Date: Mon, 11 Jul 2011 09:41:34 -0700 (PDT)
Subject: [rabbitmq-discuss] Hibernate-search and RabbitMQ
In-Reply-To: <4E1AD98B.1000600@rabbitmq.com>
References: <d0f86ec4-a045-439c-8a7f-1dcc221be1ae@p29g2000pre.googlegroups.com>
	<4E1AD98B.1000600@rabbitmq.com>
Message-ID: <a37f641a-0815-4ef1-9f6a-80ee63fff592@d8g2000prf.googlegroups.com>

Hi Emile,

Please see these link.
http://community.jboss.org/wiki/ClusteringUsingActiveMQAndTomcat
https://forum.hibernate.org/viewtopic.php?f=9&t=965929&view=next

In hibernate search indexing, they use ActiveMQ queue for async.
I want to use RabbitMQ instead of ActiveMQ.

On Jul 11, 6:07?pm, Emile Joubert <em... at rabbitmq.com> wrote:
> Hi Thomas,
>
> On 11/07/11 09:50, scorpiovn wrote:
>
> > Hi All,
>
> > Can we use hibernate-search and RabbitMQ?
>
> Those are two very different technologies - can you describe how you
> want them to work together?
>
> -Emile
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From alexis at rabbitmq.com  Mon Jul 11 20:00:06 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Mon, 11 Jul 2011 20:00:06 +0100
Subject: [rabbitmq-discuss] Integration of SAP XI with RabbitMQ
In-Reply-To: <4E1B40E8.9080901@logosworld.com>
References: <ce1093a7-7fb3-4797-8c39-c3457581ebcf@w4g2000yqm.googlegroups.com>
	<4db977ae-8bad-44c8-b204-13c6f2aa4c40@c41g2000yqm.googlegroups.com>
	<CACOPnve_ocGxcydweiaw3a8BX8LMFcVepNApgjqnh1dAi+Q_jA@mail.gmail.com>
	<4E1B40E8.9080901@logosworld.com>
Message-ID: <CACOPnvcRWugRBR7V6uZRUeyNuRTAeJ=Jw6QOkstgdmgJyVQZiw@mail.gmail.com>

Thanks very much Lynton!

I assume you meant RPC not RFC ;-)



On Mon, Jul 11, 2011 at 7:28 PM, Lynton Grice <lynton.grice at ls-cs.com> wrote:
> ?Hi Rishi,
>
> I am a SAP XI consultant in Johannesburg and also play around with RabbitMQ
> when I get a chance.
>
> Your question is very interesting, and one that I have wondered about
> before. Obviously the long term approach would be to develop a sender /
> receiver Java adapter for SAP XI / PI to handle the AMQP communication, but
> the disadvantage here is that adapter development can be tricky and has a
> relatively steep learning curve. But if you have the skills I say go for it.
>
> I have not been following the current "adapters" for RabbitMQ, but I would
> imagine that putting some sort of RESTful / HTTP interface using something
> like MochiWeb would be pretty simple to talk to from a SAP XI HTTP adapter.
> I know this is not perfect but an option nevertheless.
>
> Sending messages from RabbitMQ to SAP XI would be very easy from a proof of
> concept point of view. As you already know you would simple build up the URL
> to post the XML message to using the correct channel, sender service, sender
> interface etc in the
>
> http://<server>:<port>/XISOAPAdapter/MessageServlet?channel=:<service>:<sender_channle>&version=3.0&Sender.Service=<service>&Interface=<namespace><interface_name>
>
> Writing an "adapter" for RabbitMQ that takes messages off a queue and sends
> them to a configurable URL like the one above should not be too hard.
>
> A question for you: What format would the messages be in on the RabbitMQ
> queue? Already in "SAP XI XML" format?
>
> The bottomline is their are many ways one could do this, if you had to ask
> me my choice I would choose between the following 2:
>
> 1. Create a custom Java adapter for both the sender AMQP and receiver AMQP
> adapter
>
> 2. On the next option I speak from experience in doing it and it works
> great:
> ? ? ? ?- Create an RFC Server in C / C++. This could be called from SAP XI
> and pass the messages to it, from there you would simple use some RabbitMQ
> API to send the messages to RabbitMQ
> ? ? ? ?- For sending messages to SAP I would just post the message straight
> to SAP XI using something like the URL above. You could easily write such a
> HTTP client in Erlang (or Python etc) and "plug it in as an adapter" to
> RabbitMQ.
>
> Let me brainstorm it a little more, but feel free to email me and we can
> discuss this more to get the best answer.
>
> Lynton
>
>
> On 11/07/2011 18:05, Alexis Richardson wrote:
>>
>> Rishi
>>
>> I have bcc'd someone who may be able to advise you.
>>
>> alexis
>>
>>
>> On Fri, Jul 8, 2011 at 9:21 PM, RishiDev<rishdev at gmail.com> ?wrote:
>>>
>>> To certain extent I believe the question should go to SAPXI community.
>>> And we have already raised a ticket with them, but still I wanted to
>>> quickly check if someone from our RabbitMQ community has some tips to
>>> share.
>>>
>>> On Jul 8, 1:36 pm, RishiDev<rish... at gmail.com> ?wrote:
>>>>
>>>> Hi,
>>>>
>>>> Our organization has SAP XI 7.0 systems which sends various messages
>>>> to other systems across the enterprise.
>>>> For better performance, reliability and message compression etc
>>>> abilities we are trying to move from ActiveMQ to RabbitMQ. Having SAP
>>>> XI talk to ActiveMQ was easy by using JMS type communication channel
>>>> configured in XI. I want to learn from the group, what is best&
>>>> recommended approach for SAPXI to Rabbit integration.
>>>>
>>>> I know that we can use QPID (I haven't tried yet though) and get a JMS
>>>> kind of integration between SAPXI and Rabbit, but I would love it, if
>>>> we can have a pure AMQP base communication and avoid JMS.
>>>>
>>>> I will appreciate any help for what approach and how (to follow) to
>>>> integrate SAPXI with Rabbit.
>>>>
>>>> Thank you.
>>>> Rishi
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>>
>>>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>
>

From lynton.grice at ls-cs.com  Mon Jul 11 19:28:56 2011
From: lynton.grice at ls-cs.com (Lynton Grice)
Date: Mon, 11 Jul 2011 20:28:56 +0200
Subject: [rabbitmq-discuss] Integration of SAP XI with RabbitMQ
In-Reply-To: <CACOPnve_ocGxcydweiaw3a8BX8LMFcVepNApgjqnh1dAi+Q_jA@mail.gmail.com>
References: <ce1093a7-7fb3-4797-8c39-c3457581ebcf@w4g2000yqm.googlegroups.com>	<4db977ae-8bad-44c8-b204-13c6f2aa4c40@c41g2000yqm.googlegroups.com>
	<CACOPnve_ocGxcydweiaw3a8BX8LMFcVepNApgjqnh1dAi+Q_jA@mail.gmail.com>
Message-ID: <4E1B40E8.9080901@logosworld.com>

  Hi Rishi,

I am a SAP XI consultant in Johannesburg and also play around with 
RabbitMQ when I get a chance.

Your question is very interesting, and one that I have wondered about 
before. Obviously the long term approach would be to develop a sender / 
receiver Java adapter for SAP XI / PI to handle the AMQP communication, 
but the disadvantage here is that adapter development can be tricky and 
has a relatively steep learning curve. But if you have the skills I say 
go for it.

I have not been following the current "adapters" for RabbitMQ, but I 
would imagine that putting some sort of RESTful / HTTP interface using 
something like MochiWeb would be pretty simple to talk to from a SAP XI 
HTTP adapter. I know this is not perfect but an option nevertheless.

Sending messages from RabbitMQ to SAP XI would be very easy from a proof 
of concept point of view. As you already know you would simple build up 
the URL to post the XML message to using the correct channel, sender 
service, sender interface etc in the

http://<server>:<port>/XISOAPAdapter/MessageServlet?channel=:<service>:<sender_channle>&version=3.0&Sender.Service=<service>&Interface=<namespace><interface_name>

Writing an "adapter" for RabbitMQ that takes messages off a queue and 
sends them to a configurable URL like the one above should not be too hard.

A question for you: What format would the messages be in on the RabbitMQ 
queue? Already in "SAP XI XML" format?

The bottomline is their are many ways one could do this, if you had to 
ask me my choice I would choose between the following 2:

1. Create a custom Java adapter for both the sender AMQP and receiver 
AMQP adapter

2. On the next option I speak from experience in doing it and it works 
great:
         - Create an RFC Server in C / C++. This could be called from 
SAP XI and pass the messages to it, from there you would simple use some 
RabbitMQ API to send the messages to RabbitMQ
         - For sending messages to SAP I would just post the message 
straight to SAP XI using something like the URL above. You could easily 
write such a HTTP client in Erlang (or Python etc) and "plug it in as an 
adapter" to RabbitMQ.

Let me brainstorm it a little more, but feel free to email me and we can 
discuss this more to get the best answer.

Lynton


On 11/07/2011 18:05, Alexis Richardson wrote:
> Rishi
>
> I have bcc'd someone who may be able to advise you.
>
> alexis
>
>
> On Fri, Jul 8, 2011 at 9:21 PM, RishiDev<rishdev at gmail.com>  wrote:
>> To certain extent I believe the question should go to SAPXI community.
>> And we have already raised a ticket with them, but still I wanted to
>> quickly check if someone from our RabbitMQ community has some tips to
>> share.
>>
>> On Jul 8, 1:36 pm, RishiDev<rish... at gmail.com>  wrote:
>>> Hi,
>>>
>>> Our organization has SAP XI 7.0 systems which sends various messages
>>> to other systems across the enterprise.
>>> For better performance, reliability and message compression etc
>>> abilities we are trying to move from ActiveMQ to RabbitMQ. Having SAP
>>> XI talk to ActiveMQ was easy by using JMS type communication channel
>>> configured in XI. I want to learn from the group, what is best&
>>> recommended approach for SAPXI to Rabbit integration.
>>>
>>> I know that we can use QPID (I haven't tried yet though) and get a JMS
>>> kind of integration between SAPXI and Rabbit, but I would love it, if
>>> we can have a pure AMQP base communication and avoid JMS.
>>>
>>> I will appreciate any help for what approach and how (to follow) to
>>> integrate SAPXI with Rabbit.
>>>
>>> Thank you.
>>> Rishi
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>


From rishdev at gmail.com  Tue Jul 12 02:34:49 2011
From: rishdev at gmail.com (Rishi Dev)
Date: Mon, 11 Jul 2011 19:34:49 -0600
Subject: [rabbitmq-discuss] Integration of SAP XI with RabbitMQ
In-Reply-To: <CACOPnvcRWugRBR7V6uZRUeyNuRTAeJ=Jw6QOkstgdmgJyVQZiw@mail.gmail.com>
References: <ce1093a7-7fb3-4797-8c39-c3457581ebcf@w4g2000yqm.googlegroups.com>
	<4db977ae-8bad-44c8-b204-13c6f2aa4c40@c41g2000yqm.googlegroups.com>
	<CACOPnve_ocGxcydweiaw3a8BX8LMFcVepNApgjqnh1dAi+Q_jA@mail.gmail.com>
	<4E1B40E8.9080901@logosworld.com>
	<CACOPnvcRWugRBR7V6uZRUeyNuRTAeJ=Jw6QOkstgdmgJyVQZiw@mail.gmail.com>
Message-ID: <CANjYeshxiRBThhUtCpv2fNXt064noi5cZh8-9Jw3=HzzKApv0A@mail.gmail.com>

Hi Lynton, Alexis,

I must thank you both for your kind gesture of help.
I will go through the details based on your inputs along with my SAP XI
experts here, and will try to come back with some updates on my side ASAP.
And I sure will wait for more suggestions from our team here.

Thank you,
Rishi

On Mon, Jul 11, 2011 at 1:00 PM, Alexis Richardson <alexis at rabbitmq.com>wrote:

> Thanks very much Lynton!
>
> I assume you meant RPC not RFC ;-)
>
>
>
> On Mon, Jul 11, 2011 at 7:28 PM, Lynton Grice <lynton.grice at ls-cs.com>
> wrote:
> >  Hi Rishi,
> >
> > I am a SAP XI consultant in Johannesburg and also play around with
> RabbitMQ
> > when I get a chance.
> >
> > Your question is very interesting, and one that I have wondered about
> > before. Obviously the long term approach would be to develop a sender /
> > receiver Java adapter for SAP XI / PI to handle the AMQP communication,
> but
> > the disadvantage here is that adapter development can be tricky and has a
> > relatively steep learning curve. But if you have the skills I say go for
> it.
> >
> > I have not been following the current "adapters" for RabbitMQ, but I
> would
> > imagine that putting some sort of RESTful / HTTP interface using
> something
> > like MochiWeb would be pretty simple to talk to from a SAP XI HTTP
> adapter.
> > I know this is not perfect but an option nevertheless.
> >
> > Sending messages from RabbitMQ to SAP XI would be very easy from a proof
> of
> > concept point of view. As you already know you would simple build up the
> URL
> > to post the XML message to using the correct channel, sender service,
> sender
> > interface etc in the
> >
> > http://
> <server>:<port>/XISOAPAdapter/MessageServlet?channel=:<service>:<sender_channle>&version=3.0&Sender.Service=<service>&Interface=<namespace><interface_name>
> >
> > Writing an "adapter" for RabbitMQ that takes messages off a queue and
> sends
> > them to a configurable URL like the one above should not be too hard.
> >
> > A question for you: What format would the messages be in on the RabbitMQ
> > queue? Already in "SAP XI XML" format?
> >
> > The bottomline is their are many ways one could do this, if you had to
> ask
> > me my choice I would choose between the following 2:
> >
> > 1. Create a custom Java adapter for both the sender AMQP and receiver
> AMQP
> > adapter
> >
> > 2. On the next option I speak from experience in doing it and it works
> > great:
> >        - Create an RFC Server in C / C++. This could be called from SAP
> XI
> > and pass the messages to it, from there you would simple use some
> RabbitMQ
> > API to send the messages to RabbitMQ
> >        - For sending messages to SAP I would just post the message
> straight
> > to SAP XI using something like the URL above. You could easily write such
> a
> > HTTP client in Erlang (or Python etc) and "plug it in as an adapter" to
> > RabbitMQ.
> >
> > Let me brainstorm it a little more, but feel free to email me and we can
> > discuss this more to get the best answer.
> >
> > Lynton
> >
> >
> > On 11/07/2011 18:05, Alexis Richardson wrote:
> >>
> >> Rishi
> >>
> >> I have bcc'd someone who may be able to advise you.
> >>
> >> alexis
> >>
> >>
> >> On Fri, Jul 8, 2011 at 9:21 PM, RishiDev<rishdev at gmail.com>  wrote:
> >>>
> >>> To certain extent I believe the question should go to SAPXI community.
> >>> And we have already raised a ticket with them, but still I wanted to
> >>> quickly check if someone from our RabbitMQ community has some tips to
> >>> share.
> >>>
> >>> On Jul 8, 1:36 pm, RishiDev<rish... at gmail.com>  wrote:
> >>>>
> >>>> Hi,
> >>>>
> >>>> Our organization has SAP XI 7.0 systems which sends various messages
> >>>> to other systems across the enterprise.
> >>>> For better performance, reliability and message compression etc
> >>>> abilities we are trying to move from ActiveMQ to RabbitMQ. Having SAP
> >>>> XI talk to ActiveMQ was easy by using JMS type communication channel
> >>>> configured in XI. I want to learn from the group, what is best&
> >>>> recommended approach for SAPXI to Rabbit integration.
> >>>>
> >>>> I know that we can use QPID (I haven't tried yet though) and get a JMS
> >>>> kind of integration between SAPXI and Rabbit, but I would love it, if
> >>>> we can have a pure AMQP base communication and avoid JMS.
> >>>>
> >>>> I will appreciate any help for what approach and how (to follow) to
> >>>> integrate SAPXI with Rabbit.
> >>>>
> >>>> Thank you.
> >>>> Rishi
> >>>> _______________________________________________
> >>>> rabbitmq-discuss mailing list
> >>>>
> >>>> rabbitmq-disc... at lists.rabbitmq.comhttps://
> lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >>>
> >>> _______________________________________________
> >>> rabbitmq-discuss mailing list
> >>> rabbitmq-discuss at lists.rabbitmq.com
> >>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >>>
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110711/8f6fd712/attachment.htm>

From emile at rabbitmq.com  Tue Jul 12 11:12:07 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 12 Jul 2011 11:12:07 +0100
Subject: [rabbitmq-discuss] Hibernate-search and RabbitMQ
In-Reply-To: <a37f641a-0815-4ef1-9f6a-80ee63fff592@d8g2000prf.googlegroups.com>
References: <d0f86ec4-a045-439c-8a7f-1dcc221be1ae@p29g2000pre.googlegroups.com>	<4E1AD98B.1000600@rabbitmq.com>
	<a37f641a-0815-4ef1-9f6a-80ee63fff592@d8g2000prf.googlegroups.com>
Message-ID: <4E1C1DF7.2000705@rabbitmq.com>

Hi Thomas,

The Hibernate Search documentation describes how index updates can be
shared using JMS. RabbitMQ does not implement JMS, so I doubt that it
can be used with Hibernate Search easily.

http://docs.jboss.org/hibernate/search/3.4/reference/en-US/html/search-configuration.html#jms-backend


On 11/07/11 17:41, scorpiovn wrote:
> Hi Emile,
> 
> Please see these link.
> http://community.jboss.org/wiki/ClusteringUsingActiveMQAndTomcat
> https://forum.hibernate.org/viewtopic.php?f=9&t=965929&view=next
> 
> In hibernate search indexing, they use ActiveMQ queue for async.
> I want to use RabbitMQ instead of ActiveMQ.
> 
> On Jul 11, 6:07 pm, Emile Joubert <em... at rabbitmq.com> wrote:
>> Hi Thomas,
>>
>> On 11/07/11 09:50, scorpiovn wrote:
>>
>>> Hi All,
>>
>>> Can we use hibernate-search and RabbitMQ?
>>
>> Those are two very different technologies - can you describe how you
>> want them to work together?
>>
>> -Emile

From Massimo.Paladin at cern.ch  Tue Jul 12 13:57:46 2011
From: Massimo.Paladin at cern.ch (Massimo Paladin)
Date: Tue, 12 Jul 2011 14:57:46 +0200
Subject: [rabbitmq-discuss] rabbitmq mochiweb and ssl
Message-ID: <CAMOXM2-grtXFrmK5YwWJ7Qpont1kw5AwC36GAzScJLfT6G5hWg@mail.gmail.com>

Hello,

did someone try to enable ssl on the management interface?

I followed instruction at: http://www.rabbitmq.com/mochiweb.html

with following configuration:
{rabbitmq_mochiweb, [{listeners, [
                                  {'*',  [{port, 61100}]},
                                  {mgmt, [{port, 61101}]},
                                          {ssl,      true},
                                          {ssl_opts, [{cacertfile,
"/path/to/cacert.pem"},
                                                      {certfile,
"/path/to/hostcert.pem"},
                                                      {keyfile,
"/path/to/hostkey.pem"}
                                                     ]}
                                 ]}
                    ]}

I can still connect via normal http at 61101 but not through ssl, did
I do something wrong?
I am using rabbitmq 2.5.1 of course.

Cheers,
---
Massimo Paladin

email:?massimo.paladin at gmail.com
website:?http://www.mpaladin.com
flickr's page:?http://flickr.com/photos/massimop

From rtrlists at googlemail.com  Tue Jul 12 14:04:18 2011
From: rtrlists at googlemail.com (Robert Raschke)
Date: Tue, 12 Jul 2011 14:04:18 +0100
Subject: [rabbitmq-discuss] rabbitmq mochiweb and ssl
In-Reply-To: <CAMOXM2-grtXFrmK5YwWJ7Qpont1kw5AwC36GAzScJLfT6G5hWg@mail.gmail.com>
References: <CAMOXM2-grtXFrmK5YwWJ7Qpont1kw5AwC36GAzScJLfT6G5hWg@mail.gmail.com>
Message-ID: <CAH+xwdBMcp26enPQnxLJZUO-AxxP6tSMCQfQV3-MoS2eJgHCoA@mail.gmail.com>

On Tue, Jul 12, 2011 at 1:57 PM, Massimo Paladin <Massimo.Paladin at cern.ch>wrote:

> Hello,
>
> did someone try to enable ssl on the management interface?
>
> I followed instruction at: http://www.rabbitmq.com/mochiweb.html
>
> with following configuration:
> {rabbitmq_mochiweb, [{listeners, [
>                                  {'*',  [{port, 61100}]},
>                                  {mgmt, [{port, 61101}]},
>                                          {ssl,      true},
>                                          {ssl_opts, [{cacertfile,
> "/path/to/cacert.pem"},
>                                                      {certfile,
> "/path/to/hostcert.pem"},
>                                                      {keyfile,
> "/path/to/hostkey.pem"}
>                                                     ]}
>                                 ]}
>                    ]}
>
> I can still connect via normal http at 61101 but not through ssl, did
> I do something wrong?
> I am using rabbitmq 2.5.1 of course.
>
> Cheers,
> ---
> Massimo Paladin
>
>
Which version of Erlang are you using? There were some SSL issues on R13, so
it might be worth giving R14 a shot if you're not yet on that.

Robby

PS: You are putting https in the url, yes? Just pointing it out as that's my
favorite "why's ssl not going" mistake.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110712/336237a9/attachment.htm>

From simon at rabbitmq.com  Tue Jul 12 14:05:36 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 12 Jul 2011 14:05:36 +0100
Subject: [rabbitmq-discuss] rabbitmq mochiweb and ssl
In-Reply-To: <CAMOXM2-grtXFrmK5YwWJ7Qpont1kw5AwC36GAzScJLfT6G5hWg@mail.gmail.com>
References: <CAMOXM2-grtXFrmK5YwWJ7Qpont1kw5AwC36GAzScJLfT6G5hWg@mail.gmail.com>
Message-ID: <4E1C46A0.7030004@rabbitmq.com>

On 12/07/11 13:57, Massimo Paladin wrote:
> did someone try to enable ssl on the management interface?
>
> I followed instruction at: http://www.rabbitmq.com/mochiweb.html
>
> with following configuration:
> {rabbitmq_mochiweb, [{listeners, [
>                                    {'*',  [{port, 61100}]},
>                                    {mgmt, [{port, 61101}]},
                                    here is the problem ---^
>                                            {ssl,      true},
>                                            {ssl_opts, [{cacertfile,
> "/path/to/cacert.pem"},
>                                                        {certfile,
> "/path/to/hostcert.pem"},
>                                                        {keyfile,
> "/path/to/hostkey.pem"}
>                                                       ]}
>                                   ]}
>                      ]}

You've closed the proplist defining the "mgmt" listener after defining 
the port but before getting to {ssl, true}.

I think you need to change

 >                                    {mgmt, [{port, 61101}]},

to

 >                                    {mgmt, [{port, 61101},

You'll then need another "]}" after the ssl_opts.

If you're in a position to do so, editing your config in Emacs' 
erlang-mode and indenting can help make this sort ofn problem more obvious.

I know that the term file format is confusing for a lot of people. 
Hopefully at some point we can come up with something which is as 
flexible but easier to understand.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From Massimo.Paladin at cern.ch  Tue Jul 12 14:10:48 2011
From: Massimo.Paladin at cern.ch (Massimo Paladin)
Date: Tue, 12 Jul 2011 15:10:48 +0200
Subject: [rabbitmq-discuss] rabbitmq mochiweb and ssl
In-Reply-To: <4E1C46A0.7030004@rabbitmq.com>
References: <CAMOXM2-grtXFrmK5YwWJ7Qpont1kw5AwC36GAzScJLfT6G5hWg@mail.gmail.com>
	<4E1C46A0.7030004@rabbitmq.com>
Message-ID: <CAMOXM286uc1TJnb-EQo46bV3JbeovdhxU1TV4M9H344YwZ6FnQ@mail.gmail.com>

Thank you Simon, it works!

...and I checked it more than once! ;-)

Cheers,
---
Massimo Paladin

email:?massimo.paladin at gmail.com
website:?http://www.mpaladin.com
flickr's page:?http://flickr.com/photos/massimop



On Tue, Jul 12, 2011 at 3:05 PM, Simon MacMullen <simon at rabbitmq.com> wrote:
> On 12/07/11 13:57, Massimo Paladin wrote:
>>
>> did someone try to enable ssl on the management interface?
>>
>> I followed instruction at: http://www.rabbitmq.com/mochiweb.html
>>
>> with following configuration:
>> {rabbitmq_mochiweb, [{listeners, [
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? {'*', ?[{port, 61100}]},
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? {mgmt, [{port, 61101}]},
>
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? here is the problem ---^
>>
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? {ssl, ? ? ?true},
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? {ssl_opts, [{cacertfile,
>> "/path/to/cacert.pem"},
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? {certfile,
>> "/path/to/hostcert.pem"},
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? {keyfile,
>> "/path/to/hostkey.pem"}
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?]}
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?]}
>> ? ? ? ? ? ? ? ? ? ? ]}
>
> You've closed the proplist defining the "mgmt" listener after defining the
> port but before getting to {ssl, true}.
>
> I think you need to change
>
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?{mgmt, [{port, 61101}]},
>
> to
>
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?{mgmt, [{port, 61101},
>
> You'll then need another "]}" after the ssl_opts.
>
> If you're in a position to do so, editing your config in Emacs' erlang-mode
> and indenting can help make this sort ofn problem more obvious.
>
> I know that the term file format is confusing for a lot of people. Hopefully
> at some point we can come up with something which is as flexible but easier
> to understand.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From andi.constantin at mediasat.ro  Tue Jul 12 14:40:11 2011
From: andi.constantin at mediasat.ro (Andi Constantin)
Date: Tue, 12 Jul 2011 16:40:11 +0300
Subject: [rabbitmq-discuss] rabbitmqadmin or rabbitmqctl
Message-ID: <4E1C4EBB.4090008@mediasat.ro>

Hi !

When I start two programs who takes messages from the same queue i can 
see in the API interface in the zone "Message Rates" two channels at 
"Deliveries"
In the Consumers are says ... no consumers ...

How can i see that with rabbitmqadmin or rabbitmqctl ?

I need to see if how many consumers i have on a queue, even when the 
queue is empty.

Thanks,
Andi.

From videlalvaro at gmail.com  Tue Jul 12 14:45:56 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Tue, 12 Jul 2011 15:45:56 +0200
Subject: [rabbitmq-discuss] rabbitmqadmin or rabbitmqctl
In-Reply-To: <4E1C4EBB.4090008@mediasat.ro>
References: <4E1C4EBB.4090008@mediasat.ro>
Message-ID: <CAMcAHLVKaen5k3-0c_j7+quhFFyFnHJHSpDJoT7SeLKBtUPQzg@mail.gmail.com>

Hi,

Not exactly what you asked for but you can get such information via
queue.declare.

See declare-ok here:
http://www.rabbitmq.com/amqp-0-9-1-reference.html#class.queue

-Alvaro

On Tue, Jul 12, 2011 at 3:40 PM, Andi Constantin <
andi.constantin at mediasat.ro> wrote:

> Hi !
>
> When I start two programs who takes messages from the same queue i can see
> in the API interface in the zone "Message Rates" two channels at
> "Deliveries"
> In the Consumers are says ... no consumers ...
>
> How can i see that with rabbitmqadmin or rabbitmqctl ?
>
> I need to see if how many consumers i have on a queue, even when the queue
> is empty.
>
> Thanks,
> Andi.
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110712/0ccea1a0/attachment.htm>

From simon at rabbitmq.com  Tue Jul 12 15:29:16 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 12 Jul 2011 15:29:16 +0100
Subject: [rabbitmq-discuss] rabbitmqadmin or rabbitmqctl
In-Reply-To: <4E1C4EBB.4090008@mediasat.ro>
References: <4E1C4EBB.4090008@mediasat.ro>
Message-ID: <4E1C5A3C.4050403@rabbitmq.com>

On 12/07/11 14:40, Andi Constantin wrote:
> Hi !
>
> When I start two programs who takes messages from the same queue i can
> see in the API interface in the zone "Message Rates" two channels at
> "Deliveries"
> In the Consumers are says ... no consumers ...

Was the message rate 0? Management can show a 0 message rate for a given 
(queue, channel) combination if there have previously been messages 
delivered for that combination (even if there aren't any being delivered 
now). Also the web interface conflates deliveries (to consumers) and 
gets (which don't require consumers) - if any of your clients use 
basic.get then that can contribute to message rates without consumers 
being involved.

However, if you're really seeing messages being consumed while the 
management interface says "no consumers" then that's a bug. This is 
quite well-used code though, so I'd be interested in how you managed to 
trigger it.

> How can i see that with rabbitmqadmin or rabbitmqctl ?

I'm not sure what "that" is, so here are some possible answers:

$ rabbitmqctl list_consumers

will list all consumers, with columns [queue, channel pid, consumer tag, 
acks required].

$ rabbitmqctl list_queues name consumers

will list the count of consumers for each queue.

$ rabbitmqadmin list queues name consumers

will do the same.

Does that answer your question?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From andi.constantin at mediasat.ro  Tue Jul 12 15:40:46 2011
From: andi.constantin at mediasat.ro (Andi Constantin)
Date: Tue, 12 Jul 2011 17:40:46 +0300
Subject: [rabbitmq-discuss] rabbitmqadmin or rabbitmqctl
In-Reply-To: <4E1C5A3C.4050403@rabbitmq.com>
References: <4E1C4EBB.4090008@mediasat.ro> <4E1C5A3C.4050403@rabbitmq.com>
Message-ID: <4E1C5CEE.6070306@mediasat.ro>

Hi !

  rabbitmqctl list_consumers always returns:
Listing consumers ...
...done.

rabbitmqadmin list queues name consumers  returns all the queues with 
zero consumers :(
And i know i have consumers because the system works fine.

That's why i try to see "Deliverers"

Andi.

On 12.07.2011 17:29, Simon MacMullen wrote:
> On 12/07/11 14:40, Andi Constantin wrote:
>> Hi !
>>
>> When I start two programs who takes messages from the same queue i can
>> see in the API interface in the zone "Message Rates" two channels at
>> "Deliveries"
>> In the Consumers are says ... no consumers ...
>
> Was the message rate 0? Management can show a 0 message rate for a 
> given (queue, channel) combination if there have previously been 
> messages delivered for that combination (even if there aren't any 
> being delivered now). Also the web interface conflates deliveries (to 
> consumers) and gets (which don't require consumers) - if any of your 
> clients use basic.get then that can contribute to message rates 
> without consumers being involved.
>
> However, if you're really seeing messages being consumed while the 
> management interface says "no consumers" then that's a bug. This is 
> quite well-used code though, so I'd be interested in how you managed 
> to trigger it.
>
>> How can i see that with rabbitmqadmin or rabbitmqctl ?
>
> I'm not sure what "that" is, so here are some possible answers:
>
> $ rabbitmqctl list_consumers
>
> will list all consumers, with columns [queue, channel pid, consumer 
> tag, acks required].
>
> $ rabbitmqctl list_queues name consumers
>
> will list the count of consumers for each queue.
>
> $ rabbitmqadmin list queues name consumers
>
> will do the same.
>
> Does that answer your question?
>
> Cheers, Simon
>


From Massimo.Paladin at cern.ch  Tue Jul 12 16:11:53 2011
From: Massimo.Paladin at cern.ch (Massimo Paladin)
Date: Tue, 12 Jul 2011 17:11:53 +0200
Subject: [rabbitmq-discuss] rabbitmq mochiweb and ssl
In-Reply-To: <CAMOXM286uc1TJnb-EQo46bV3JbeovdhxU1TV4M9H344YwZ6FnQ@mail.gmail.com>
References: <CAMOXM2-grtXFrmK5YwWJ7Qpont1kw5AwC36GAzScJLfT6G5hWg@mail.gmail.com>
	<4E1C46A0.7030004@rabbitmq.com>
	<CAMOXM286uc1TJnb-EQo46bV3JbeovdhxU1TV4M9H344YwZ6FnQ@mail.gmail.com>
Message-ID: <CAMOXM28AZHNr4Jo6BmvvWbsir+tPgPbG8Hn7nDQnpTV6b_H=Xg@mail.gmail.com>

Other question, since 2.5.0 it is possible to instance the mgmt, api
and acl in different contexts.
I tried to set the mgmt with ssl on a specific port and the api on
another port without ssl.

This does not work because mgmt uses the api part with relative urls
and mgmt stays empty....

Is there any way to do what I am looking for?

Cheers,
---
Massimo Paladin

email:?massimo.paladin at gmail.com
website:?http://www.mpaladin.com
flickr's page:?http://flickr.com/photos/massimop



On Tue, Jul 12, 2011 at 3:10 PM, Massimo Paladin
<Massimo.Paladin at cern.ch> wrote:
> Thank you Simon, it works!
>
> ...and I checked it more than once! ;-)
>
> Cheers,
> ---
> Massimo Paladin
>
> email:?massimo.paladin at gmail.com
> website:?http://www.mpaladin.com
> flickr's page:?http://flickr.com/photos/massimop
>
>
>
> On Tue, Jul 12, 2011 at 3:05 PM, Simon MacMullen <simon at rabbitmq.com> wrote:
>> On 12/07/11 13:57, Massimo Paladin wrote:
>>>
>>> did someone try to enable ssl on the management interface?
>>>
>>> I followed instruction at: http://www.rabbitmq.com/mochiweb.html
>>>
>>> with following configuration:
>>> {rabbitmq_mochiweb, [{listeners, [
>>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? {'*', ?[{port, 61100}]},
>>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? {mgmt, [{port, 61101}]},
>>
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? here is the problem ---^
>>>
>>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? {ssl, ? ? ?true},
>>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? {ssl_opts, [{cacertfile,
>>> "/path/to/cacert.pem"},
>>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? {certfile,
>>> "/path/to/hostcert.pem"},
>>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? {keyfile,
>>> "/path/to/hostkey.pem"}
>>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?]}
>>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?]}
>>> ? ? ? ? ? ? ? ? ? ? ]}
>>
>> You've closed the proplist defining the "mgmt" listener after defining the
>> port but before getting to {ssl, true}.
>>
>> I think you need to change
>>
>>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?{mgmt, [{port, 61101}]},
>>
>> to
>>
>>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?{mgmt, [{port, 61101},
>>
>> You'll then need another "]}" after the ssl_opts.
>>
>> If you're in a position to do so, editing your config in Emacs' erlang-mode
>> and indenting can help make this sort ofn problem more obvious.
>>
>> I know that the term file format is confusing for a lot of people. Hopefully
>> at some point we can come up with something which is as flexible but easier
>> to understand.
>>
>> Cheers, Simon
>>
>> --
>> Simon MacMullen
>> RabbitMQ, VMware
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>

From simon at rabbitmq.com  Tue Jul 12 16:15:44 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 12 Jul 2011 16:15:44 +0100
Subject: [rabbitmq-discuss] rabbitmq mochiweb and ssl
In-Reply-To: <CAMOXM28AZHNr4Jo6BmvvWbsir+tPgPbG8Hn7nDQnpTV6b_H=Xg@mail.gmail.com>
References: <CAMOXM2-grtXFrmK5YwWJ7Qpont1kw5AwC36GAzScJLfT6G5hWg@mail.gmail.com>
	<4E1C46A0.7030004@rabbitmq.com>
	<CAMOXM286uc1TJnb-EQo46bV3JbeovdhxU1TV4M9H344YwZ6FnQ@mail.gmail.com>
	<CAMOXM28AZHNr4Jo6BmvvWbsir+tPgPbG8Hn7nDQnpTV6b_H=Xg@mail.gmail.com>
Message-ID: <4E1C6520.60603@rabbitmq.com>

On 12/07/11 16:11, Massimo Paladin wrote:
> Other question, since 2.5.0 it is possible to instance the mgmt, api
> and acl in different contexts.
> I tried to set the mgmt with ssl on a specific port and the api on
> another port without ssl.
>
> This does not work because mgmt uses the api part with relative urls
> and mgmt stays empty....
>
> Is there any way to do what I am looking for?

Not really. You should only move contexts relative to each other if they 
don't know anything about each other, like management vs jsonrpc. In the 
next release the three management contexts will be merged into one anyway.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From Massimo.Paladin at cern.ch  Tue Jul 12 16:33:21 2011
From: Massimo.Paladin at cern.ch (Massimo Paladin)
Date: Tue, 12 Jul 2011 17:33:21 +0200
Subject: [rabbitmq-discuss] rabbitmq_auth_mechanism_ssl limitations
In-Reply-To: <4E15EC36.9090302@rabbitmq.com>
References: <CAMOXM29jANOoR9t6v82E-ftoj3Y6xNbyShPMFsF8VNXgrWrx0w@mail.gmail.com>
	<4E130F1A.8050505@rabbitmq.com>
	<CAMOXM28Mg5h0Ysr0fzK_s-z+RzrzAJBL25E8VoZQXx7KLp2wnA@mail.gmail.com>
	<4E131DD3.40909@rabbitmq.com>
	<CAMOXM2-tqc9tjwnyrsyyBc1TabfegKhw08edHXEEm5XgwADKZQ@mail.gmail.com>
	<4E15EC36.9090302@rabbitmq.com>
Message-ID: <CAMOXM2-L42DiAx8Mqts0PWWN7uv6cjOyvr_xCtkiD78+mv0Yow@mail.gmail.com>

Will this take part of the next release?

Regards,
---
Massimo Paladin

email:?massimo.paladin at gmail.com
website:?http://www.mpaladin.com
flickr's page:?http://flickr.com/photos/massimop



On Thu, Jul 7, 2011 at 7:26 PM, Matthias Radestock
<matthias at rabbitmq.com> wrote:
> Massimo,
>
> On 07/07/11 17:17, Massimo Paladin wrote:
>>
>> Matthias, would you say there is no way to get this right?
>
> I don't know. It's a tricky problem.
>
>> In any case I think this implementation is not very useful since it
>> takes one CN (which one if multiple?) as username and limit to only
>> one CA signed certificates.
>
> The current implementation does not permit multi-valued CNs. I don't
> remember whether the x509 RFCs permit them.
>
> We could just forget about ASN.1/x509's obscure notions of equivalence and
> convert the DNs to strings according to RFC 4514. That will be ok as long as
> users always present exactly the same certificate and whoever provisions the
> rabbit auth db can get hold of the certificates or the RFC 4514
> presentations of their subject DNs.
>
> In practice that would probably also work in many cases where users present
> multiple certs containing the same logical subject DN. But there is no
> guarantee of that since it is possible for, say, two CAs to issue certs for
> the same subject DN but construct the underlying ASN.1 differently such that
> an RFC4514 conversion to string produces different results. Or even for the
> same CA to do that when a cert is renewed.
>
>
> Regards,
>
> Matthias.
>

From simon at rabbitmq.com  Tue Jul 12 16:42:38 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 12 Jul 2011 16:42:38 +0100
Subject: [rabbitmq-discuss] rabbitmq_auth_mechanism_ssl limitations
In-Reply-To: <CAMOXM2-L42DiAx8Mqts0PWWN7uv6cjOyvr_xCtkiD78+mv0Yow@mail.gmail.com>
References: <CAMOXM29jANOoR9t6v82E-ftoj3Y6xNbyShPMFsF8VNXgrWrx0w@mail.gmail.com>
	<4E130F1A.8050505@rabbitmq.com>
	<CAMOXM28Mg5h0Ysr0fzK_s-z+RzrzAJBL25E8VoZQXx7KLp2wnA@mail.gmail.com>
	<4E131DD3.40909@rabbitmq.com>
	<CAMOXM2-tqc9tjwnyrsyyBc1TabfegKhw08edHXEEm5XgwADKZQ@mail.gmail.com>
	<4E15EC36.9090302@rabbitmq.com>
	<CAMOXM2-L42DiAx8Mqts0PWWN7uv6cjOyvr_xCtkiD78+mv0Yow@mail.gmail.com>
Message-ID: <4E1C6B6E.8080203@rabbitmq.com>

On 12/07/11 16:33, Massimo Paladin wrote:
> Will this take part of the next release?

I doubt it, nothing has been done.

This is something Matthias and I have been arguing about for ages. I 
suspect that even though just RFC 4514-serialising the DN and doing 
string matching is completely wrong in theory, in practice it would be 
what a decent number of users would want. Matthias thinks that it will 
lead into a tarpit of bugs around DN equivalence. And I have to admit 
that he has much more real world experience dealing with stupid SSL / 
x509 behaviour than I do!

But neither of us really know. Hearing from people like you who want 
this would be helpful:

* If you have many CAs, is that just a bunch of internal sysadmins 
running Openssl or real-world CAs?

* If you had to update usernames when a user had a new certificate and 
the DN format changed for some daft reason, how big a deal would that be?

etc etc...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From ltorje at kno.com  Tue Jul 12 17:54:18 2011
From: ltorje at kno.com (Lucian-Paul Torje)
Date: Tue, 12 Jul 2011 19:54:18 +0300
Subject: [rabbitmq-discuss] RabbitMQ HA
Message-ID: <4E1C7C3A.3090600@kno.com>

Hello,
I'm trying to configure rabbit mq with HA but starting/stopping ($ 
/usr/sbin/crm_resource --meta -t primitive -r res_rabbitmq-server_1 -p 
target-role -v started) the rabbit mq ogc has no effect, rabbit mq is 
not started/stopped, there is nothing on /var/log/rabbitmq, just like 
the rabbitmq didn't received the command - please advice.

I've added an exit 0 line in /etc/init.d/rabbitmq-server just as 
described in http://www.rabbitmq.com/pacemaker.html

Here is my configuration  (I'm using a mounted shared folder and already 
tested starting manually rabbitmq with that mnesia folder - 
/mnt/rabbit_mnesia and it works):

node ha-node1
node ha-node2
primitive res_rabbitmq-server_1 ocf:rabbitmq:rabbitmq-server \
     params ip="10.41.0.158" port="5672" 
config_file="/etc/rabbitmq/rabbitmq" mnesia_base="/mnt/rabbit_mnesia" \
     operations $id="res_rabbitmq-server_1-operations" \
     op start interval="0" timeout="600" \
     op stop interval="0" timeout="120" \
     op monitor interval="10" timeout="20" start-delay="0" \
     meta target-role="started" allow-migrate="true"
ms ms_rabbitmq-server_1 res_rabbitmq-server_1 \
     meta clone-max="2" notify="true"
property $id="cib-bootstrap-options" \
     expected-quorum-votes="2" \
     dc-version="1.0.8-042548a451fce8400660f6031f4da6f0223dd5dd" \
     cluster-infrastructure="openais" \
     last-lrm-refresh="1310489170"

-- 
Best regards,
Software Engineer
Lucian-Paul Torje


From thomas.kant at gmail.com  Tue Jul 12 18:10:45 2011
From: thomas.kant at gmail.com (scorpiovn)
Date: Tue, 12 Jul 2011 10:10:45 -0700 (PDT)
Subject: [rabbitmq-discuss] OpenAMQ JMS client and RabbitMQ
Message-ID: <cb57c543-b2cc-472e-bc10-d330ced58a7d@h25g2000prf.googlegroups.com>

Hi All,

This guy instructs to run OpenAMQ JMS client with RabbitMQ.
http://www.lshift.net/blog/2009/03

Anybody could help me out this solution with more detail instruction?

thanks,
+++
thomas kant

From kernel-hacker at bennee.com  Tue Jul 12 19:28:57 2011
From: kernel-hacker at bennee.com (Alex Bennee)
Date: Tue, 12 Jul 2011 19:28:57 +0100
Subject: [rabbitmq-discuss] Debian Packaging for additional components
Message-ID: <CAJ-05NPLkH7aa7k3di2THhv1B9tKDtNvqgAyzwYChP=W_NG8Tw@mail.gmail.com>

Hi,

I'm looking at utilising RabbitMQ's STOMP plugin as a message bus for
a boxed product the company I work for sells. From mentions on the IRC
channel it was noted that Ubuntu/Debian's packages are generally out
of date and I was pointed at:

http://www.rabbitmq.com/debian.html

However this repo only packages the core server but not any of the
plugins. Before I spend too much time delving into the intricacies of
packaging Erlang code with common build-infrastructure I thought I'd
better check:

1. Does anyone already package the plugins as debs?
2. If not, is anyone currently working on it?
3. If not, would patches adding debian/ to the source tree be acceptable?

Assuming I don't get lucky....

I suspect I'll have to package rabbitmq-public-umbrella and build all
the plugins from one source repository as I'm not sure there is an
easy way to create a pristine tarball with out-of-tree source
dependencies.

Do the plugins share a common version ID? From what I can see the
"make co" is essentially the HEAD of all the sub-dir plugins. I
suspect this means the versions will have to be something like
${SERVER_VERSION}-hg-`date`.

Regards,

-- 
Alex, homepage: http://www.bennee.com/~alex/
http://www.half-llama.co.uk

From habtdemis at gmail.com  Tue Jul 12 20:22:01 2011
From: habtdemis at gmail.com (Demi Zike)
Date: Tue, 12 Jul 2011 14:22:01 -0500
Subject: [rabbitmq-discuss] Make connection,
	connection factory etc visible in a class level
Message-ID: <CAJE2eFFj-PvXVrgDsZbrf-CcgLcQAmDPfr+OC0+S3gz6XaybnA@mail.gmail.com>

Hi,

I encapsulated the send and receive codes into a class I created in
different apps(.cs files). I created a constructor for each class at these
two apps and put the declaration for factory, connection, and channel in
this constructor so that the object that will be created out of classes from
app1 and app2 will exploit the connection when declaring queues, exchanges,
etc in the respective publish and subscribe methods. However, when I try to
use factory, connection and channel in the subscribe and publish methods, I
got an error saying it doesn't know those attributes. How can you make
connection, hostname etc public to the class so that methods in the class
exploit this declaration?

Regards,
Demi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110712/72f17b1a/attachment.htm>

From matthias at rabbitmq.com  Tue Jul 12 20:26:08 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 12 Jul 2011 20:26:08 +0100
Subject: [rabbitmq-discuss] Debian Packaging for additional components
In-Reply-To: <CAJ-05NPLkH7aa7k3di2THhv1B9tKDtNvqgAyzwYChP=W_NG8Tw@mail.gmail.com>
References: <CAJ-05NPLkH7aa7k3di2THhv1B9tKDtNvqgAyzwYChP=W_NG8Tw@mail.gmail.com>
Message-ID: <4E1C9FD0.3070405@rabbitmq.com>

Alex,

On 12/07/11 19:28, Alex Bennee wrote:
> 1. Does anyone already package the plugins as debs?
> 2. If not, is anyone currently working on it?

No, but finding a way to distribute plug-ins that is more convenient for 
our users is on our to-do list.

(Un)fortunately rabbit is deployed on many platforms, not just debian. 
Until a year or so ago the only way to get hold of plug-ins was to build 
them from source from the hg repos. That was a serious barrier for 
users. Then we started producing downloadable .ez files. No more 
compiling from source and they have the huge advantage of working across 
all platforms.

 From a rabbit user perspective, I reckon by far the most convenient way 
to get hold of rabbit plug-ins is not having to get hold of them at all 
:) I.e. we could bundle plug-ins with the server, and add a mechanism 
(in, e.g. rabbitmqctl) to select which plug-ins should be enabled.

As well as being convenient for users, this "batteries included" 
approach is also completely cross-platform. And it addresses another 
issue too: some plug-ins, such as management, arguably are part of the 
server; the fact that they are plug-ins is a implementation detail. And 
I can envisage a future rabbit being refactored s.t. the AMQP support 
becomes a plug-in, just like STOMP is today. Would we then ship a server 
package that doesn't do anything? That doesn't seem right. Bundling of 
plug-ins would avoid that situation.

But there are downsides too. The main one is that bundling only works 
for plug-ins blessed by Rabbit HQ, with all other plug-ins having to go 
the existing .ez route. And there are some challenges in the packaging, 
e.g. what should the source distribution (i.e. the source downloads on 
the rabbit web site, the debian source package, etc) contain?


Suggestions are welcome on how we should go about this.


Regards,

Matthias.

From simone.busoli at gmail.com  Tue Jul 12 20:30:43 2011
From: simone.busoli at gmail.com (Simone Busoli)
Date: Tue, 12 Jul 2011 21:30:43 +0200
Subject: [rabbitmq-discuss] Make connection,
 connection factory etc visible in a class level
In-Reply-To: <CAJE2eFFj-PvXVrgDsZbrf-CcgLcQAmDPfr+OC0+S3gz6XaybnA@mail.gmail.com>
References: <CAJE2eFFj-PvXVrgDsZbrf-CcgLcQAmDPfr+OC0+S3gz6XaybnA@mail.gmail.com>
Message-ID: <CAOn7oW--cOCLPnWOKPhAbD5A2aWGN=sYJ_fJfpv2Jag5AOD7GQ@mail.gmail.com>

Demi, I am under the impression that you're trying to program in a
programming language that you're not familiar with, I would suggest that you
first develop some basic skills about your programming environment, and then
exploit them to build the system you need. This is a very general
programming question which I don't think has a lot to do with RabbitMQ. To
begin with, if you're working with the .NET framework, I would suggest you
to use an IDE like Visual Studio, MonoDevelop or SharpDevelop.
On Jul 12, 2011 9:22 PM, "Demi Zike" <habtdemis at gmail.com> wrote:
> Hi,
>
> I encapsulated the send and receive codes into a class I created in
> different apps(.cs files). I created a constructor for each class at these
> two apps and put the declaration for factory, connection, and channel in
> this constructor so that the object that will be created out of classes
from
> app1 and app2 will exploit the connection when declaring queues,
exchanges,
> etc in the respective publish and subscribe methods. However, when I try
to
> use factory, connection and channel in the subscribe and publish methods,
I
> got an error saying it doesn't know those attributes. How can you make
> connection, hostname etc public to the class so that methods in the class
> exploit this declaration?
>
> Regards,
> Demi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110712/e13d73e1/attachment.htm>

From michael.s.klishin at gmail.com  Tue Jul 12 20:42:49 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 12 Jul 2011 23:42:49 +0400
Subject: [rabbitmq-discuss] Debian Packaging for additional components
In-Reply-To: <4E1C9FD0.3070405@rabbitmq.com>
References: <CAJ-05NPLkH7aa7k3di2THhv1B9tKDtNvqgAyzwYChP=W_NG8Tw@mail.gmail.com>
	<4E1C9FD0.3070405@rabbitmq.com>
Message-ID: <CAE3HoVSKupfVKt+-8QVecngiBFk0DBD0R0F77dzo=zJ=uamytA@mail.gmail.com>

2011/7/12 Matthias Radestock <matthias at rabbitmq.com>

> From a rabbit user perspective, I reckon by far the most convenient way to
> get hold of rabbit plug-ins is not having to get hold of them at all :) I.e.
> we could bundle plug-ins with the server, and add a mechanism (in, e.g.
> rabbitmqctl) to select which plug-ins should be enabled.
>
> ?
>
> But there are downsides too. The main one is that bundling only works for
> plug-ins blessed by Rabbit HQ, with all other plug-ins having to go the
> existing .ez route. And there are some challenges in the packaging, e.g.
> what should the source distribution (i.e. the source downloads on the rabbit
> web site, the debian source package, etc) contain?
>
>
> Suggestions are welcome on how we should go about this.
>

Matthias,

bundling "RabbitMQ HQ" plugins and having a way to activate them sounds like
a good idea. 3rd party plugins can work the way they work today, and the
source distribution should then include plugins, structured similarly to the
way RabbitMQ public umbrella repository is structured. I don't think it will
make building packages significantly more complicated.

Some package managers, for example, Homebrew, push back on adding ways to
install plugins for projects like RabbitMQ and Nginx (the idea is that it is
too much work for everyone to maintain packages that in turn manage
"subpackages"). But if plugins are part of the core RabbitMQ package and
only need activation, this issue will likely to be considered resolved for
Rabbit once and for all.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110712/4c345d7a/attachment.htm>

From jerryk at vmware.com  Tue Jul 12 21:28:29 2011
From: jerryk at vmware.com (Jerry Kuch)
Date: Tue, 12 Jul 2011 13:28:29 -0700 (PDT)
Subject: [rabbitmq-discuss] OpenAMQ JMS client and RabbitMQ
In-Reply-To: <cb57c543-b2cc-472e-bc10-d330ced58a7d@h25g2000prf.googlegroups.com>
Message-ID: <1073036565.105048.1310502509504.JavaMail.root@zimbra-prod-mbox-4.vmware.com>

Hi, Thomas:

I'm not entirely sure the Rabbit-JMQ stuff has been kept up to date, or what it's currently level of usability is.  Can you say a bit more about what you'd like to try to do?

Best regards,
Jerry

----- Original Message -----
From: "scorpiovn" <thomas.kant at gmail.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Tuesday, July 12, 2011 10:10:45 AM
Subject: [rabbitmq-discuss] OpenAMQ JMS client and RabbitMQ

Hi All,

This guy instructs to run OpenAMQ JMS client with RabbitMQ.
http://www.lshift.net/blog/2009/03

Anybody could help me out this solution with more detail instruction?

thanks,
+++
thomas kant
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From ltorje at kno.com  Tue Jul 12 22:03:14 2011
From: ltorje at kno.com (Lucian-Paul Torje)
Date: Wed, 13 Jul 2011 00:03:14 +0300
Subject: [rabbitmq-discuss] RabbitMQ OCF script not started
Message-ID: <4E1CB692.6090406@kno.com>

Hello,
I have a strange behaviour - although the resource 
/usr/lib/ocf/resource.d/rabbitmq/rabbitmq-server exits and I've modified 
it's script is seems that pacemaker does no start the script at all 
(I've made it log some values in case it is started). Do you have any 
idea why?

-- 
Best regards,
Software Engineer
Lucian-Paul Torje


From thomas.kant at gmail.com  Wed Jul 13 03:33:48 2011
From: thomas.kant at gmail.com (scorpiovn)
Date: Tue, 12 Jul 2011 19:33:48 -0700 (PDT)
Subject: [rabbitmq-discuss] OpenAMQ JMS client and RabbitMQ
In-Reply-To: <1073036565.105048.1310502509504.JavaMail.root@zimbra-prod-mbox-4.vmware.com>
References: <1073036565.105048.1310502509504.JavaMail.root@zimbra-prod-mbox-4.vmware.com>
Message-ID: <d2025207-4f6d-4681-86c5-afbba8d68438@z7g2000prh.googlegroups.com>

Hi Jerry,

In our application, it currently use Hibernate search which supports
JMS and JGroup. So that it uses ActiveMQ as a search queue in backend.
However, we want to replace ActiveMQ to RabbitMQ and need a JMS client
can work with RabbitMQ.


On Jul 13, 3:28?am, Jerry Kuch <jer... at vmware.com> wrote:
> Hi, Thomas:
>
> I'm not entirely sure the Rabbit-JMQ stuff has been kept up to date, or what it's currently level of usability is. ?Can you say a bit more about what you'd like to try to do?
>
> Best regards,
> Jerry
>
>
>
>
>
>
>
> ----- Original Message -----
> From: "scorpiovn" <thomas.k... at gmail.com>
> To: rabbitmq-disc... at lists.rabbitmq.com
> Sent: Tuesday, July 12, 2011 10:10:45 AM
> Subject: [rabbitmq-discuss] OpenAMQ JMS client and RabbitMQ
>
> Hi All,
>
> This guy instructs to run OpenAMQ JMS client with RabbitMQ.http://www.lshift.net/blog/2009/03
>
> Anybody could help me out this solution with more detail instruction?
>
> thanks,
> +++
> thomas kant
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simon at rabbitmq.com  Wed Jul 13 08:59:25 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 13 Jul 2011 08:59:25 +0100
Subject: [rabbitmq-discuss] Debian Packaging for additional components
In-Reply-To: <CAJ-05NPLkH7aa7k3di2THhv1B9tKDtNvqgAyzwYChP=W_NG8Tw@mail.gmail.com>
References: <CAJ-05NPLkH7aa7k3di2THhv1B9tKDtNvqgAyzwYChP=W_NG8Tw@mail.gmail.com>
Message-ID: <4E1D505D.5020308@rabbitmq.com>

On 12/07/2011 7:28PM, Alex Bennee wrote:
> Do the plugins share a common version ID? From what I can see the
> "make co" is essentially the HEAD of all the sub-dir plugins. I
> suspect this means the versions will have to be something like
> ${SERVER_VERSION}-hg-`date`.

Each plugin repo is tagged during a release (as are the other repos). 
Tags are of the form rabbitmq_v2_5_1.

Cheers, Simon


From Massimo.Paladin at cern.ch  Wed Jul 13 09:31:46 2011
From: Massimo.Paladin at cern.ch (Massimo Paladin)
Date: Wed, 13 Jul 2011 10:31:46 +0200
Subject: [rabbitmq-discuss] rabbitmq_auth_mechanism_ssl limitations
In-Reply-To: <4E1C6B6E.8080203@rabbitmq.com>
References: <CAMOXM29jANOoR9t6v82E-ftoj3Y6xNbyShPMFsF8VNXgrWrx0w@mail.gmail.com>
	<4E130F1A.8050505@rabbitmq.com>
	<CAMOXM28Mg5h0Ysr0fzK_s-z+RzrzAJBL25E8VoZQXx7KLp2wnA@mail.gmail.com>
	<4E131DD3.40909@rabbitmq.com>
	<CAMOXM2-tqc9tjwnyrsyyBc1TabfegKhw08edHXEEm5XgwADKZQ@mail.gmail.com>
	<4E15EC36.9090302@rabbitmq.com>
	<CAMOXM2-L42DiAx8Mqts0PWWN7uv6cjOyvr_xCtkiD78+mv0Yow@mail.gmail.com>
	<4E1C6B6E.8080203@rabbitmq.com>
Message-ID: <CAMOXM2_FtREq0QpautxAyKBR4zucpoiZvp0g=UrUNyVcWym+Xw@mail.gmail.com>

We are dealing with 10s of CAs and thousands of certificates.

We have been using serialized DNs for years in ActiveMQ and we didn't have
problems.
Usually we get the DN and we just add it to the configuration. The update of
DN usually is not
an operation which cause us troubles.

Regards,
---
Massimo Paladin

email: massimo.paladin at gmail.com
website: http://www.mpaladin.com
flickr's page: http://flickr.com/photos/massimop



On Tue, Jul 12, 2011 at 5:42 PM, Simon MacMullen <simon at rabbitmq.com> wrote:
> On 12/07/11 16:33, Massimo Paladin wrote:
>>
>> Will this take part of the next release?
>
> I doubt it, nothing has been done.
>
> This is something Matthias and I have been arguing about for ages. I
suspect
> that even though just RFC 4514-serialising the DN and doing string
matching
> is completely wrong in theory, in practice it would be what a decent
number
> of users would want. Matthias thinks that it will lead into a tarpit of
bugs
> around DN equivalence. And I have to admit that he has much more real
world
> experience dealing with stupid SSL / x509 behaviour than I do!
>
> But neither of us really know. Hearing from people like you who want this
> would be helpful:
>
> * If you have many CAs, is that just a bunch of internal sysadmins running
> Openssl or real-world CAs?
>
> * If you had to update usernames when a user had a new certificate and the
> DN format changed for some daft reason, how big a deal would that be?
>
> etc etc...
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110713/6c68c671/attachment.htm>

From Massimo.Paladin at cern.ch  Wed Jul 13 09:33:36 2011
From: Massimo.Paladin at cern.ch (Massimo Paladin)
Date: Wed, 13 Jul 2011 10:33:36 +0200
Subject: [rabbitmq-discuss] rabbitmq mochiweb and ssl
In-Reply-To: <4E1C6520.60603@rabbitmq.com>
References: <CAMOXM2-grtXFrmK5YwWJ7Qpont1kw5AwC36GAzScJLfT6G5hWg@mail.gmail.com>
	<4E1C46A0.7030004@rabbitmq.com>
	<CAMOXM286uc1TJnb-EQo46bV3JbeovdhxU1TV4M9H344YwZ6FnQ@mail.gmail.com>
	<CAMOXM28AZHNr4Jo6BmvvWbsir+tPgPbG8Hn7nDQnpTV6b_H=Xg@mail.gmail.com>
	<4E1C6520.60603@rabbitmq.com>
Message-ID: <CAMOXM29Yr2yAYOUmjZXMzLCATmKDuZmpXeKH0AKcyuvycp_2DQ@mail.gmail.com>

Yes, it makes sense since they need to be together.

Thanks for clarifying.

Regards,
---
Massimo Paladin

email: massimo.paladin at gmail.com
website: http://www.mpaladin.com
flickr's page: http://flickr.com/photos/massimop


On Tue, Jul 12, 2011 at 5:15 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 12/07/11 16:11, Massimo Paladin wrote:
>
>> Other question, since 2.5.0 it is possible to instance the mgmt, api
>> and acl in different contexts.
>> I tried to set the mgmt with ssl on a specific port and the api on
>> another port without ssl.
>>
>> This does not work because mgmt uses the api part with relative urls
>> and mgmt stays empty....
>>
>> Is there any way to do what I am looking for?
>>
>
> Not really. You should only move contexts relative to each other if they
> don't know anything about each other, like management vs jsonrpc. In the
> next release the three management contexts will be merged into one anyway.
>
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110713/b4546070/attachment.htm>

From matthias at rabbitmq.com  Wed Jul 13 09:43:54 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 13 Jul 2011 09:43:54 +0100
Subject: [rabbitmq-discuss] rabbitmq_auth_mechanism_ssl limitations
In-Reply-To: <CAMOXM2_FtREq0QpautxAyKBR4zucpoiZvp0g=UrUNyVcWym+Xw@mail.gmail.com>
References: <CAMOXM29jANOoR9t6v82E-ftoj3Y6xNbyShPMFsF8VNXgrWrx0w@mail.gmail.com>
	<4E130F1A.8050505@rabbitmq.com>
	<CAMOXM28Mg5h0Ysr0fzK_s-z+RzrzAJBL25E8VoZQXx7KLp2wnA@mail.gmail.com>
	<4E131DD3.40909@rabbitmq.com>
	<CAMOXM2-tqc9tjwnyrsyyBc1TabfegKhw08edHXEEm5XgwADKZQ@mail.gmail.com>
	<4E15EC36.9090302@rabbitmq.com>
	<CAMOXM2-L42DiAx8Mqts0PWWN7uv6cjOyvr_xCtkiD78+mv0Yow@mail.gmail.com>
	<4E1C6B6E.8080203@rabbitmq.com>
	<CAMOXM2_FtREq0QpautxAyKBR4zucpoiZvp0g=UrUNyVcWym+Xw@mail.gmail.com>
Message-ID: <4E1D5ACA.2080106@rabbitmq.com>

Massimo,

On 13/07/11 09:31, Massimo Paladin wrote:
> We have been using serialized DNs for years in ActiveMQ and we didn't
> have problems.

But is ActiveMQ definitely performing DN matching by string comparison? 
Or is it perhaps doing a fully-fledged ASN.1 structural comparison 
following the rules of DN equivalence set out by the various RFCs?

> Usually we get the DN and we just add it to the configuration.

How do you "get the DN"? For example, openssl displays the DN in the 
wrong form by default - one needs to add the "-nameopt RFC2253" switch 
to get an RFC-compliant representation. And even then it's only rfc2253, 
not the more recent rfc4514; though I have no idea what the difference is.

Matthias.

From gsim at redhat.com  Wed Jul 13 09:53:55 2011
From: gsim at redhat.com (Gordon Sim)
Date: Wed, 13 Jul 2011 09:53:55 +0100
Subject: [rabbitmq-discuss] rabbitmq_auth_mechanism_ssl limitations
In-Reply-To: <4E1C6B6E.8080203@rabbitmq.com>
References: <CAMOXM29jANOoR9t6v82E-ftoj3Y6xNbyShPMFsF8VNXgrWrx0w@mail.gmail.com>	<4E130F1A.8050505@rabbitmq.com>	<CAMOXM28Mg5h0Ysr0fzK_s-z+RzrzAJBL25E8VoZQXx7KLp2wnA@mail.gmail.com>	<4E131DD3.40909@rabbitmq.com>	<CAMOXM2-tqc9tjwnyrsyyBc1TabfegKhw08edHXEEm5XgwADKZQ@mail.gmail.com>	<4E15EC36.9090302@rabbitmq.com>	<CAMOXM2-L42DiAx8Mqts0PWWN7uv6cjOyvr_xCtkiD78+mv0Yow@mail.gmail.com>
	<4E1C6B6E.8080203@rabbitmq.com>
Message-ID: <4E1D5D23.5040209@redhat.com>

On 07/12/2011 04:42 PM, Simon MacMullen wrote:
> This is something Matthias and I have been arguing about for ages. I
> suspect that even though just RFC 4514-serialising the DN and doing
> string matching is completely wrong in theory, in practice it would be
> what a decent number of users would want. Matthias thinks that it will
> lead into a tarpit of bugs around DN equivalence. And I have to admit
> that he has much more real world experience dealing with stupid SSL /
> x509 behaviour than I do!

The RFC 4514 strings are also a little unwieldy. E.g. if you need to use 
the name in ACLs or if application logic checks the publisher of a 
message or whatever.

I'm certainly no expert but fwiw what I did was to concatenate any DC 
elements separated by a '.' to form a domain qualifier and appended that 
to the CN.

e.g. CN=bob,DC=example,DC=com => bob at example.com

It's not canonical, and I'm sure it wouldn't work for every case 
(doesn't handle the multiple CN case for example). However it is simple, 
allows for non-unique CN provided the domain components are included 
(which seems to be a very common pattern in practice) and results in a 
qualified username of the form we use for other authentication mechanisms.


From Massimo.Paladin at cern.ch  Wed Jul 13 10:32:45 2011
From: Massimo.Paladin at cern.ch (Massimo Paladin)
Date: Wed, 13 Jul 2011 11:32:45 +0200
Subject: [rabbitmq-discuss] rabbitmq_auth_mechanism_ssl limitations
In-Reply-To: <4E1D5ACA.2080106@rabbitmq.com>
References: <CAMOXM29jANOoR9t6v82E-ftoj3Y6xNbyShPMFsF8VNXgrWrx0w@mail.gmail.com>
	<4E130F1A.8050505@rabbitmq.com>
	<CAMOXM28Mg5h0Ysr0fzK_s-z+RzrzAJBL25E8VoZQXx7KLp2wnA@mail.gmail.com>
	<4E131DD3.40909@rabbitmq.com>
	<CAMOXM2-tqc9tjwnyrsyyBc1TabfegKhw08edHXEEm5XgwADKZQ@mail.gmail.com>
	<4E15EC36.9090302@rabbitmq.com>
	<CAMOXM2-L42DiAx8Mqts0PWWN7uv6cjOyvr_xCtkiD78+mv0Yow@mail.gmail.com>
	<4E1C6B6E.8080203@rabbitmq.com>
	<CAMOXM2_FtREq0QpautxAyKBR4zucpoiZvp0g=UrUNyVcWym+Xw@mail.gmail.com>
	<4E1D5ACA.2080106@rabbitmq.com>
Message-ID: <CAMOXM28EnAMvsRKJDdMVrX0-XZ9rqRpF8LB5N0qyP8JQM0f9DA@mail.gmail.com>

Both ActiveMQ and Apollo are doing string comparison.

Usually we get the DN in the default openssl format, then according to our
needs we translate them.
Apollo seems using rfc2253. ActiveMQ seems using rfc2253 also but with
spaces after commas.

Regards,
---
Massimo Paladin

email: massimo.paladin at gmail.com
website: http://www.mpaladin.com
flickr's page: http://flickr.com/photos/massimop


On Wed, Jul 13, 2011 at 10:43 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Massimo,
>
>
> On 13/07/11 09:31, Massimo Paladin wrote:
>
>> We have been using serialized DNs for years in ActiveMQ and we didn't
>> have problems.
>>
>
> But is ActiveMQ definitely performing DN matching by string comparison? Or
> is it perhaps doing a fully-fledged ASN.1 structural comparison following
> the rules of DN equivalence set out by the various RFCs?
>
>
>  Usually we get the DN and we just add it to the configuration.
>>
>
> How do you "get the DN"? For example, openssl displays the DN in the wrong
> form by default - one needs to add the "-nameopt RFC2253" switch to get an
> RFC-compliant representation. And even then it's only rfc2253, not the more
> recent rfc4514; though I have no idea what the difference is.
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110713/f7a05bf4/attachment.htm>

From lee.m.henson at gmail.com  Wed Jul 13 10:26:27 2011
From: lee.m.henson at gmail.com (Lee Henson)
Date: Wed, 13 Jul 2011 10:26:27 +0100
Subject: [rabbitmq-discuss] Strictly sequential queue processing with
	round-robin consumers
Message-ID: <CAODN=bRShrb0v0O-esMox=bYxY1OUK6yjN5of3TkN-6jiSqo6Q@mail.gmail.com>

Hi

This question is based on a hypothetical situation that I am going to do my
absolute best to avoid. I fully expect a "don't do that, it's a bad idea"
response. But just for arguments sake, I'd like to know whether such a
scenario is possible with rmq. Forewarned is forearmed, as they say..... :D

The scenario would be a durable persistent queue Q with n consumers C1, C2,
.. Cn. The queue should round-robin messages off to each consumer but only
delivering the next message to the next consumer when the previous consumer
has ACKed or REJECTed the last one. If the previous consumer failed in some
way, then that message should be delivered to the next consumer immediately
instead of delivering the next message in the queue. In this fashion, a
guaranteed order of processing could be relied upon and it would be
fault-tolerant with respect to consumers.

The only possible solution I could think of was setting the qos.prefetch to
a huge number, say 1000000. As I understand it, that will deliver 1000000
messages to one consumer before it starts delivering them to the next.

Any thoughts?

Cheers
Lee
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110713/f825e0af/attachment.htm>

From ekirpichov at gmail.com  Wed Jul 13 11:30:40 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Wed, 13 Jul 2011 14:30:40 +0400
Subject: [rabbitmq-discuss] Strictly sequential queue processing with
 round-robin consumers
In-Reply-To: <CAODN=bRShrb0v0O-esMox=bYxY1OUK6yjN5of3TkN-6jiSqo6Q@mail.gmail.com>
References: <CAODN=bRShrb0v0O-esMox=bYxY1OUK6yjN5of3TkN-6jiSqo6Q@mail.gmail.com>
Message-ID: <CANVKUrWjj__X3bc6=Z4UuqsCkA6rU_b+shPLyCF_9-ePO86LAg@mail.gmail.com>

No, IIRC qos doesn't do that. It will still roundrobin, but it will
not stop roundrobining to a particular consumer until you accumulate
100000 unacked messages there.

2011/7/13 Lee Henson <lee.m.henson at gmail.com>:
> Hi
> This question is based on a hypothetical situation that I am going to do my
> absolute best to avoid.?I fully expect a "don't do that, it's a bad idea"
> response. But just for arguments sake, I'd like to know whether such a
> scenario is possible with rmq. Forewarned is forearmed, as they say..... :D
> The scenario would be a durable persistent queue Q with n consumers C1, C2,
> .. Cn. The queue should round-robin messages off to each consumer but only
> delivering the next message to the next consumer when the previous consumer
> has ACKed or REJECTed the last one. If the previous consumer failed in some
> way, then that message should be delivered to the next consumer immediately
> instead of delivering the next message in the queue. In this fashion, a
> guaranteed order of processing could be relied upon and it would be
> fault-tolerant with respect to consumers.
> The only possible solution I could think of was setting the qos.prefetch to
> a huge number, say 1000000. As I understand it, that will deliver 1000000
> messages to one consumer before it starts delivering them to the next.
> Any thoughts?
> Cheers
> Lee
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/

From pierre-marie.padiou at morpho.com  Wed Jul 13 12:02:26 2011
From: pierre-marie.padiou at morpho.com (PADIOU Pierre-Marie (MORPHO))
Date: Wed, 13 Jul 2011 13:02:26 +0200
Subject: [rabbitmq-discuss] default qos settings
Message-ID: <E9FBE39960CDBF4A8CD9DE7E9D14C5091270811592@Y000IMRV01.rd1.rf1>

Hello,

Is there a way to tell the broker to use channel.basicQos(1) instead of channel.basicQos(0) when clients do not override this setting?

Thanks,

Pierre-Marie
#
" Ce courriel et les documents qui lui sont joints peuvent contenir des informations confidentielles ou ayant un caract?re priv?. S'ils ne vous sont pas destin?s, nous vous signalons qu'il est strictement interdit de les divulguer, de les reproduire ou d'en utiliser de quelque mani?re que ce soit le contenu. Si ce message vous a ?t? transmis par erreur, merci d'en informer l'exp?diteur et de supprimer imm?diatement de votre syst?me informatique ce courriel ainsi que tous les documents qui y sont attach?s."
******
" This e-mail and any attached documents may contain confidential or proprietary information. If you are not the intended recipient, you are notified that any dissemination, copying of this e-mail and any attachments thereto or use of their contents by any means whatsoever is strictly prohibited. If you have received this e-mail in error, please advise the sender immediately and delete this e-mail and all attached documents from your computer system."
#
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110713/b9a14bba/attachment.htm>

From majek04 at gmail.com  Wed Jul 13 12:23:06 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 13 Jul 2011 12:23:06 +0100
Subject: [rabbitmq-discuss] default qos settings
In-Reply-To: <E9FBE39960CDBF4A8CD9DE7E9D14C5091270811592@Y000IMRV01.rd1.rf1>
References: <E9FBE39960CDBF4A8CD9DE7E9D14C5091270811592@Y000IMRV01.rd1.rf1>
Message-ID: <CABzX+qxKHHHSS8YexEYxT4vQkv3WKRywVJPE6OD5fUR3F3e-4Q@mail.gmail.com>

On Wed, Jul 13, 2011 at 12:02, PADIOU Pierre-Marie (MORPHO)
<pierre-marie.padiou at morpho.com> wrote:
> Is there a way to tell the broker to use channel.basicQos(1) instead of
> channel.basicQos(0) when clients do not override this setting?

No, you always need to set it manually on a new channel.

Cheers,
 Marek

From danbarua at gmail.com  Wed Jul 13 12:42:45 2011
From: danbarua at gmail.com (Dan B)
Date: Wed, 13 Jul 2011 04:42:45 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMq not honouring high_watermark setting?
Message-ID: <c7e57d33-bf7a-43b9-b2d3-81ba8c8f4474@l28g2000yqc.googlegroups.com>

Hi all,

I'm trying to tweak Rabbit 2.5.1 on a server running Windows Server
2008 x64 with 8gb ram.

My rabbitmq.config file looks like this:

[
  {rabbit, [
     {ssl_listeners, [5671]},
     {ssl_options, [{cacertfile,"C:/CAConfig/trustisroot.cer"},
                    {certfile,"C:/CAConfig/publicCertificate.pem"},
                    {keyfile,"C:/CAConfig/private.pem"},
                    {verify,verify_peer},
                    {fail_if_no_peer_cert,false}]},
     {vm_memory_high_watermark, 0.4}
   ]}
].

However Rabbit starts up with the standard 819mb memory limit.

=INFO REPORT==== 13-Jul-2011::12:36:32 ===
Limiting to approx 924 file handles (829 sockets)

=INFO REPORT==== 13-Jul-2011::12:36:32 ===
Memory limit set to 819MB.

=INFO REPORT==== 13-Jul-2011::12:36:32 ===
Management plugin upgraded statistics to fine.

=INFO REPORT==== 13-Jul-2011::12:36:32 ===
Statistics database started.

=INFO REPORT==== 13-Jul-2011::12:36:32 ===
msg_store_transient: using rabbit_msg_store_ets_index to provide index

=INFO REPORT==== 13-Jul-2011::12:36:32 ===
msg_store_persistent: using rabbit_msg_store_ets_index to provide
index

=INFO REPORT==== 13-Jul-2011::12:36:32 ===
started TCP Listener on [::]:5672

=INFO REPORT==== 13-Jul-2011::12:36:32 ===
started TCP Listener on 0.0.0.0:5672

=INFO REPORT==== 13-Jul-2011::12:36:32 ===
Management agent started.

=INFO REPORT==== 13-Jul-2011::12:36:32 ===
Management plugin started.
HTTP API:       http://CALLCRAFT:55672/api/
Management UI:  http://CALLCRAFT:55672/mgmt/

Any ideas where I'm going wrong?

Thanks in advance,

-Dan

From simon at rabbitmq.com  Wed Jul 13 12:54:28 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 13 Jul 2011 12:54:28 +0100
Subject: [rabbitmq-discuss] rabbitmqadmin or rabbitmqctl
In-Reply-To: <4E1C5CEE.6070306@mediasat.ro>
References: <4E1C4EBB.4090008@mediasat.ro> <4E1C5A3C.4050403@rabbitmq.com>
	<4E1C5CEE.6070306@mediasat.ro>
Message-ID: <4E1D8774.2000708@rabbitmq.com>

On 12/07/11 15:40, Andi Constantin wrote:
> rabbitmqadmin list queues name consumers  returns all the queues with
> zero consumers :(
> And i know i have consumers because the system works fine.

This seems very dodgy. At the risk of being patronising: are you 
absolutely sure your system is using basic.consume and not basic.get? 
(Does the mgmt overview page show a deliver rate or a get rate or both?)

Or could it be doing something like consume / deliver / cancel very 
fast, so that at any given instant there is very likely no consumer?

If this still doesn't make sense, could you post some sample code?

Cheers, Simon
-- 
Simon MacMullen
RabbitMQ, VMware

From danbarua at gmail.com  Wed Jul 13 12:55:23 2011
From: danbarua at gmail.com (Dan B)
Date: Wed, 13 Jul 2011 04:55:23 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMq not honouring high_watermark
	setting?
In-Reply-To: <c7e57d33-bf7a-43b9-b2d3-81ba8c8f4474@l28g2000yqc.googlegroups.com>
References: <c7e57d33-bf7a-43b9-b2d3-81ba8c8f4474@l28g2000yqc.googlegroups.com>
Message-ID: <e5527a85-7c64-498b-a5b9-cd7b0253d287@g16g2000yqg.googlegroups.com>

I should have RTFM a bit more thoroughly.

>> Thus when RabbitMQ can't recognize your platform, if you actually have 8GB RAM
>> installed and you want RabbitMQ to throttle producers when the server is using
>> above 3GB, set vm_memory_high_watermark to 3

On my server, vm_memory_high_watermark = n results in a watermark of
2n for some reason. I've set it to 1.5 (3gb), I'm not sure if Rabbit
can access all of that though, probably not.

-Dan

On Jul 13, 12:42?pm, Dan B <danba... at gmail.com> wrote:
> Hi all,
>
> I'm trying to tweak Rabbit 2.5.1 on a server running Windows Server
> 2008 x64 with 8gb ram.
>
> My rabbitmq.config file looks like this:
>
> [
> ? {rabbit, [
> ? ? ?{ssl_listeners, [5671]},
> ? ? ?{ssl_options, [{cacertfile,"C:/CAConfig/trustisroot.cer"},
> ? ? ? ? ? ? ? ? ? ? {certfile,"C:/CAConfig/publicCertificate.pem"},
> ? ? ? ? ? ? ? ? ? ? {keyfile,"C:/CAConfig/private.pem"},
> ? ? ? ? ? ? ? ? ? ? {verify,verify_peer},
> ? ? ? ? ? ? ? ? ? ? {fail_if_no_peer_cert,false}]},
> ? ? ?{vm_memory_high_watermark, 0.4}
> ? ?]}
> ].
>
> However Rabbit starts up with the standard 819mb memory limit.
>
> =INFO REPORT==== 13-Jul-2011::12:36:32 ===
> Limiting to approx 924 file handles (829 sockets)
>
> =INFO REPORT==== 13-Jul-2011::12:36:32 ===
> Memory limit set to 819MB.
>
> =INFO REPORT==== 13-Jul-2011::12:36:32 ===
> Management plugin upgraded statistics to fine.
>
> =INFO REPORT==== 13-Jul-2011::12:36:32 ===
> Statistics database started.
>
> =INFO REPORT==== 13-Jul-2011::12:36:32 ===
> msg_store_transient: using rabbit_msg_store_ets_index to provide index
>
> =INFO REPORT==== 13-Jul-2011::12:36:32 ===
> msg_store_persistent: using rabbit_msg_store_ets_index to provide
> index
>
> =INFO REPORT==== 13-Jul-2011::12:36:32 ===
> started TCP Listener on [::]:5672
>
> =INFO REPORT==== 13-Jul-2011::12:36:32 ===
> started TCP Listener on 0.0.0.0:5672
>
> =INFO REPORT==== 13-Jul-2011::12:36:32 ===
> Management agent started.
>
> =INFO REPORT==== 13-Jul-2011::12:36:32 ===
> Management plugin started.
> HTTP API: ? ? ?http://CALLCRAFT:55672/api/
> Management UI: ?http://CALLCRAFT:55672/mgmt/
>
> Any ideas where I'm going wrong?
>
> Thanks in advance,
>
> -Dan
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simon at rabbitmq.com  Wed Jul 13 12:59:54 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 13 Jul 2011 12:59:54 +0100
Subject: [rabbitmq-discuss] RabbitMq not honouring
	high_watermark	setting?
In-Reply-To: <e5527a85-7c64-498b-a5b9-cd7b0253d287@g16g2000yqg.googlegroups.com>
References: <c7e57d33-bf7a-43b9-b2d3-81ba8c8f4474@l28g2000yqc.googlegroups.com>
	<e5527a85-7c64-498b-a5b9-cd7b0253d287@g16g2000yqg.googlegroups.com>
Message-ID: <4E1D88BA.7080707@rabbitmq.com>

On 13/07/11 12:55, Dan B wrote:
> On my server, vm_memory_high_watermark = n results in a watermark of
> 2n for some reason. I've set it to 1.5 (3gb), I'm not sure if Rabbit
> can access all of that though, probably not.

Probably not. Unfortunately there's still no 64 bit build of Erlang for 
Windows so I think you're seeing a 2GB process memory limit. I think I 
heard some rumblings there should be 64 bit Windows Erlang towards the 
end of the year, but right now if you want to run a big-memory-footprint 
Rabbit, you'll need to do so on Unix :(

On the other hand, RabbitMQ can still do quite a lot in 2GB.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Wed Jul 13 13:04:27 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 13 Jul 2011 13:04:27 +0100
Subject: [rabbitmq-discuss] RabbitMq not honouring
	high_watermark	setting?
In-Reply-To: <e5527a85-7c64-498b-a5b9-cd7b0253d287@g16g2000yqg.googlegroups.com>
References: <c7e57d33-bf7a-43b9-b2d3-81ba8c8f4474@l28g2000yqc.googlegroups.com>
	<e5527a85-7c64-498b-a5b9-cd7b0253d287@g16g2000yqg.googlegroups.com>
Message-ID: <4E1D89CB.7020300@rabbitmq.com>

On 13/07/11 12:55, Dan B wrote:
> I should have RTFM a bit more thoroughly.
> 
>>> Thus when RabbitMQ can't recognize your platform, if you actually have 8GB RAM
>>> installed and you want RabbitMQ to throttle producers when the server is using
>>> above 3GB, set vm_memory_high_watermark to 3
> 
> On my server, vm_memory_high_watermark = n results in a watermark of
> 2n for some reason. I've set it to 1.5 (3gb), I'm not sure if Rabbit
> can access all of that though, probably not.


You are certain to run out of memory at some point if you do that.
Unfortunately the Windows Erlang VM is 32bit and limited to 2Gb. Some
versions of Windows support an alternative memory model that may allow a
suitably patched Erlang VM access to slightly more memory, but I don't
know of anyone succeeding in making it work:

http://support.microsoft.com/default.aspx?scid=kb%3BEN-US%3B297812

-Emile

From danbarua at gmail.com  Wed Jul 13 13:11:30 2011
From: danbarua at gmail.com (Dan Barua)
Date: Wed, 13 Jul 2011 13:11:30 +0100
Subject: [rabbitmq-discuss] RabbitMq not honouring high_watermark
	setting?
In-Reply-To: <4E1D89CB.7020300@rabbitmq.com>
References: <c7e57d33-bf7a-43b9-b2d3-81ba8c8f4474@l28g2000yqc.googlegroups.com>
	<e5527a85-7c64-498b-a5b9-cd7b0253d287@g16g2000yqg.googlegroups.com>
	<4E1D89CB.7020300@rabbitmq.com>
Message-ID: <CAMvXXvgOqrXZqfvR2BmOTiDnydVsgXPx+8-kstWHG+aJD_FLKQ@mail.gmail.com>

Aaaah yes cheers Emile - the Erlang 32-bit limit slipped my mind there.
On Jul 13, 2011 1:04 PM, "Emile Joubert" <emile at rabbitmq.com> wrote:
> On 13/07/11 12:55, Dan B wrote:
>> I should have RTFM a bit more thoroughly.
>>
>>>> Thus when RabbitMQ can't recognize your platform, if you actually have
8GB RAM
>>>> installed and you want RabbitMQ to throttle producers when the server
is using
>>>> above 3GB, set vm_memory_high_watermark to 3
>>
>> On my server, vm_memory_high_watermark = n results in a watermark of
>> 2n for some reason. I've set it to 1.5 (3gb), I'm not sure if Rabbit
>> can access all of that though, probably not.
>
>
> You are certain to run out of memory at some point if you do that.
> Unfortunately the Windows Erlang VM is 32bit and limited to 2Gb. Some
> versions of Windows support an alternative memory model that may allow a
> suitably patched Erlang VM access to slightly more memory, but I don't
> know of anyone succeeding in making it work:
>
> http://support.microsoft.com/default.aspx?scid=kb%3BEN-US%3B297812
>
> -Emile
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110713/08b1ff6f/attachment.htm>

From danbarua at gmail.com  Wed Jul 13 13:27:07 2011
From: danbarua at gmail.com (Dan B)
Date: Wed, 13 Jul 2011 05:27:07 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMq not honouring high_watermark
	setting?
In-Reply-To: <4E1D89CB.7020300@rabbitmq.com>
References: <c7e57d33-bf7a-43b9-b2d3-81ba8c8f4474@l28g2000yqc.googlegroups.com>
	<e5527a85-7c64-498b-a5b9-cd7b0253d287@g16g2000yqg.googlegroups.com>
	<4E1D89CB.7020300@rabbitmq.com>
Message-ID: <ce425424-003f-4472-9654-bbedad32641b@a31g2000vbt.googlegroups.com>

Can I safely set Rabbit to hoover up 100% of the memory that's
available to Erlang under windows?

Thanks

-Dan

On Jul 13, 1:04?pm, Emile Joubert <em... at rabbitmq.com> wrote:
> On 13/07/11 12:55, Dan B wrote:
>
> > I should have RTFM a bit more thoroughly.
>
> >>> Thus when RabbitMQ can't recognize your platform, if you actually have 8GB RAM
> >>> installed and you want RabbitMQ to throttle producers when the server is using
> >>> above 3GB, set vm_memory_high_watermark to 3
>
> > On my server, vm_memory_high_watermark = n results in a watermark of
> > 2n for some reason. I've set it to 1.5 (3gb), I'm not sure if Rabbit
> > can access all of that though, probably not.
>
> You are certain to run out of memory at some point if you do that.
> Unfortunately the Windows Erlang VM is 32bit and limited to 2Gb. Some
> versions of Windows support an alternative memory model that may allow a
> suitably patched Erlang VM access to slightly more memory, but I don't
> know of anyone succeeding in making it work:
>
> http://support.microsoft.com/default.aspx?scid=kb%3BEN-US%3B297812
>
> -Emile
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From stammailbox at gmail.com  Wed Jul 13 14:28:42 2011
From: stammailbox at gmail.com (mysurf mail)
Date: Wed, 13 Jul 2011 16:28:42 +0300
Subject: [rabbitmq-discuss] Fwd:  a few json rpc questions
In-Reply-To: <CAJ2-Vrk2EqzWXBkFC2zOHYxN8hCNYsqB24sokkoJcJfE5rOmDA@mail.gmail.com>
References: <CAJ2-VrkDARuoP-iJgEiwagh_44WgiAhhizEbfTNj9YYyJPCMeQ@mail.gmail.com>
	<4E1AD7DB.2090702@rabbitmq.com>
	<CAJ2-Vrk2EqzWXBkFC2zOHYxN8hCNYsqB24sokkoJcJfE5rOmDA@mail.gmail.com>
Message-ID: <CAJ2-Vrk7aTeSnS+szosSB=-Ak-iSo+iVHeKYmoeqJOEvdBpJoA@mail.gmail.com>

---------- Forwarded message ----------
From: mysurf mail <stammailbox at gmail.com>
Date: Wed, Jul 13, 2011 at 4:27 PM
Subject: Re: [rabbitmq-discuss] a few json rpc questions
To: Emile Joubert <emile at rabbitmq.com>


Hi Emile,

Thanks for the assistance.

Though I have read the tutorial in your site, it looks like I did not fully
understand the rpc for multiple clients' mechanism.



What I want is that the rpc server will serve all rpc clients.

I don't know how many clients I will have in advance.

I have a lot and some will run from the same folder with the same
configurations (more that one instance)



I have put a routing key in the server and all the clients (same one) and I
thought it would make the server handle all the requests.

1. Is there any way to use the rpc like that for multiple clients?
2. Would I need to give each one a different routing key?

3. Would I need to use different server threads for each client?


Thanks.


I will add my client / server code.

I would appreciate it very much if you elaborate your answer

Thank you.


My server code ( try catch keywords were removed for clarity)


    public void startListenToClients() {

        ConnectionFactory connFactory = new ConnectionFactory();

        connFactory.setHost(props.getProperty("Host"));

        connFactory.setPort(Integer.parseInt(props.getProperty("Port")));

        Connection conn = null;

        JsonRpcServer server = null;



        conn = connFactory.newConnection();

        final Channel ch = conn.createChannel();

        String positionsServerRPCQueueName =
props.getProperty("PositionsServerRPCQueueName");

        ch.queueDeclare(positionsServerRPCQueueName, false, false, true,
null);



        server = new JsonRpcServer(ch, positionsServerRPCQueueName,
IPositionsServerServicesInternal.class, new
PositionsServerServicesInternalWrapper(positionsServerServicesImpl));



            Thread thread = new Thread(new Runnable() {

            @Override public void run() {

                 server.mainloop();

            }

        });

        thread.start();

    }



My client code



        public IPositionsServerServicesInternal getPositionsServerClient() {

                ConnectionFactory ConnFactory = new ConnectionFactory();

            ConnFactory.setHost(props.getProperty("Host"));


ConnFactory.setPort(Integer.parseInt(props.getProperty("Port")));

            positionsServerClientConnection = ConnFactory.newConnection();



            Channel channel = getToServerChannel().getChannel();

            client = new JsonRpcClient(channel, "",
props.getProperty("PositionsServerRPCQueueName"));

    }













On Mon, Jul 11, 2011 at 2:00 PM, Emile Joubert <emile at rabbitmq.com> wrote:

Hi,


On 11/07/11 10:23, mysurf mail wrote:
> Hi,
>
> I have three general questions regarding rabbit java rpc
> 1. How should I define the client when I want to use two applications?
> currently i use this line
>                     new JsonRpcCleint(channel,"",SomeStringNotUniqueToApp)
> in all my apps.
> Sometimes the application gets stuck in the client wen trying to get the
> RPCClient

The RPC servers that serve requests for different applications must be
listening on different work queues. You must ensure that RPC clients use
a routing key that matches the server queue and are different for each
application.

I don't see how it makes sense to use a routing key that is not unique
to the application. Perhaps you can explain your intended use.


> 2. Is the JsonRPCClient/Server a guaranteed message delivery process?
> By that I am asking if when the server falls and loads again after few
> seconds- will it send answers ?

The server work queue is normally declared outside the RPC Server
framework, so you can set this up as a durable queue if you want work
messages to survive a server restart.


> 3. Is there any way to determine timout for RPC ?
> I have asked it here before and received a negative answer (emile opened
> a bug for it - bug23515)

This feature has been added recently and will be in the next release.


-Emile
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110713/65a41ebe/attachment.htm>

From jamesc.000 at gmail.com  Wed Jul 13 14:34:43 2011
From: jamesc.000 at gmail.com (James Casey)
Date: Wed, 13 Jul 2011 15:34:43 +0200
Subject: [rabbitmq-discuss] rabbitmq_auth_mechanism_ssl limitations
In-Reply-To: <4E1C6B6E.8080203@rabbitmq.com>
References: <CAMOXM29jANOoR9t6v82E-ftoj3Y6xNbyShPMFsF8VNXgrWrx0w@mail.gmail.com>
	<4E130F1A.8050505@rabbitmq.com>
	<CAMOXM28Mg5h0Ysr0fzK_s-z+RzrzAJBL25E8VoZQXx7KLp2wnA@mail.gmail.com>
	<4E131DD3.40909@rabbitmq.com>
	<CAMOXM2-tqc9tjwnyrsyyBc1TabfegKhw08edHXEEm5XgwADKZQ@mail.gmail.com>
	<4E15EC36.9090302@rabbitmq.com>
	<CAMOXM2-L42DiAx8Mqts0PWWN7uv6cjOyvr_xCtkiD78+mv0Yow@mail.gmail.com>
	<4E1C6B6E.8080203@rabbitmq.com>
Message-ID: <CAApq3GjSxdXy+gsN_BrCuiOJffdRz3TUa5w4pzLFrfGZUzmxyw@mail.gmail.com>

On 12 July 2011 17:42, Simon MacMullen <simon at rabbitmq.com> wrote:
> On 12/07/11 16:33, Massimo Paladin wrote:
>>
>> Will this take part of the next release?
>
> I doubt it, nothing has been done.
>
> This is something Matthias and I have been arguing about for ages. I suspect
> that even though just RFC 4514-serialising the DN and doing string matching
> is completely wrong in theory, in practice it would be what a decent number
> of users would want. Matthias thinks that it will lead into a tarpit of bugs
> around DN equivalence. And I have to admit that he has much more real world
> experience dealing with stupid SSL / x509 behaviour than I do!
>
> But neither of us really know. Hearing from people like you who want this
> would be helpful:
>
> * If you have many CAs, is that just a bunch of internal sysadmins running
> Openssl or real-world CAs?
>

I think one of the big use-cases which needs multiple CA support (and
the one that Massimo at CERN in fact has) are the various academic
Grid infrastructures which inherited X509 from Globus.  Here there are
multiple CAs (one per country usually) which all control different
parts of the DN namespace. The CAs collaborate via ta global body, the
IGTF (http://www.igtf.net/) on common policies.  For instance for any
CA there is a signing policy distributed which defines the allowed
subtrees of certificates signed by that CA - therefore if you're only
using certificates from IGTF CAs you should never run into any DN
collisions.

> * If you had to update usernames when a user had a new certificate and the
> DN format changed for some daft reason, how big a deal would that be?

Again, in the case CERN has there is a layer of membership services on
top of the CAs so you can map multiple DNs over time to some sort of
unique principal.   Also you can query the membership services for a
list of valid DNs and groups that they belong to - in the ActiveMQ
case this is then used to seed the JAAS authentication provider.

So in this case a lot of the issues have been sort of solved  - it's
often not pretty but it has been working in production for many years
now.  this is clearly a much more constrained problem that the general
case of X509 support in Rabbit.

cheers,

James.
--
>
> etc etc...
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From emile at rabbitmq.com  Wed Jul 13 15:23:30 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 13 Jul 2011 15:23:30 +0100
Subject: [rabbitmq-discuss] Fwd:  a few json rpc questions
In-Reply-To: <CAJ2-Vrk7aTeSnS+szosSB=-Ak-iSo+iVHeKYmoeqJOEvdBpJoA@mail.gmail.com>
References: <CAJ2-VrkDARuoP-iJgEiwagh_44WgiAhhizEbfTNj9YYyJPCMeQ@mail.gmail.com>	<4E1AD7DB.2090702@rabbitmq.com>	<CAJ2-Vrk2EqzWXBkFC2zOHYxN8hCNYsqB24sokkoJcJfE5rOmDA@mail.gmail.com>
	<CAJ2-Vrk7aTeSnS+szosSB=-Ak-iSo+iVHeKYmoeqJOEvdBpJoA@mail.gmail.com>
Message-ID: <4E1DAA62.8060909@rabbitmq.com>

Hi,

On 13/07/11 14:28, mysurf mail wrote:
> 
> 
> ---------- Forwarded message ----------
> From: *mysurf mail* <stammailbox at gmail.com <mailto:stammailbox at gmail.com>>
> Date: Wed, Jul 13, 2011 at 4:27 PM
> Subject: Re: [rabbitmq-discuss] a few json rpc questions
> To: Emile Joubert <emile at rabbitmq.com <mailto:emile at rabbitmq.com>>
> 
> 
> Hi Emile, 
> 
> Thanks for the assistance.
> 
> Though I have read the tutorial in your site, it looks like I did not
> fully understand the rpc for multiple clients' mechanism. 

The RPC classes that you are using are designed to support multiple clients.

I would suggest that you get RPC working reliably with a single client
first. The problem you describe (sometimes the application gets stuck)
may not relate to the presence of multiple clients at all.

The management plugin (http://www.rabbitmq.com/management.html) or the
rabbitmqctl utility can be used to confirm queue sizes if you believe
the problem is a messaging one.


> I have put a routing key in the server and all the clients (same one)
> and I thought it would make the server handle all the requests. 
> 
> 1. Is there any way to use the rpc like that for multiple clients?

Yes, as previously stated.

> 2. Would I need to give each one a different routing key? 

No, not specifically to support multiple clients.

> 3. Would I need to use different server threads for each client? 

Threading is not a relevant issue here.




-Emile

From stammailbox at gmail.com  Wed Jul 13 15:32:52 2011
From: stammailbox at gmail.com (mysurf mail)
Date: Wed, 13 Jul 2011 17:32:52 +0300
Subject: [rabbitmq-discuss] Fwd:  a few json rpc questions
In-Reply-To: <4E1DAA62.8060909@rabbitmq.com>
References: <CAJ2-VrkDARuoP-iJgEiwagh_44WgiAhhizEbfTNj9YYyJPCMeQ@mail.gmail.com>
	<4E1AD7DB.2090702@rabbitmq.com>
	<CAJ2-Vrk2EqzWXBkFC2zOHYxN8hCNYsqB24sokkoJcJfE5rOmDA@mail.gmail.com>
	<CAJ2-Vrk7aTeSnS+szosSB=-Ak-iSo+iVHeKYmoeqJOEvdBpJoA@mail.gmail.com>
	<4E1DAA62.8060909@rabbitmq.com>
Message-ID: <CAJ2-VrmZREaxrtukWdkBX6bPEODCSNBb99h8SNqj-xUMRFHosw@mail.gmail.com>

hi,
Not fully understanding yet.
You wrote :

The RPC servers that serve requests for different applications must be
listening on different work queues. You must ensure that RPC clients use
a routing key that matches the server queue and are different for each
application.

and also you wrote in the last mail that I  Wouldn't need to give each one a
different routing key ( not specifically to support multiple clients in
answer to my second question.

So, in brief. Should i give the same routing key or shouldnt i?
can each application run with the same routing key and queue and all get
their own answer?
Can you elaborate on working with multiple client and rpc ?

Thank you.




On Wed, Jul 13, 2011 at 5:23 PM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi,
>
> On 13/07/11 14:28, mysurf mail wrote:
> >
> >
> > ---------- Forwarded message ----------
> > From: *mysurf mail* <stammailbox at gmail.com <mailto:stammailbox at gmail.com
> >>
> > Date: Wed, Jul 13, 2011 at 4:27 PM
> > Subject: Re: [rabbitmq-discuss] a few json rpc questions
> > To: Emile Joubert <emile at rabbitmq.com <mailto:emile at rabbitmq.com>>
> >
> >
> > Hi Emile,
> >
> > Thanks for the assistance.
> >
> > Though I have read the tutorial in your site, it looks like I did not
> > fully understand the rpc for multiple clients' mechanism.
>
> The RPC classes that you are using are designed to support multiple
> clients.
>
> I would suggest that you get RPC working reliably with a single client
> first. The problem you describe (sometimes the application gets stuck)
> may not relate to the presence of multiple clients at all.
>
> The management plugin (http://www.rabbitmq.com/management.html) or the
> rabbitmqctl utility can be used to confirm queue sizes if you believe
> the problem is a messaging one.
>
>
> > I have put a routing key in the server and all the clients (same one)
> > and I thought it would make the server handle all the requests.
> >
> > 1. Is there any way to use the rpc like that for multiple clients?
>
> Yes, as previously stated.
>
> > 2. Would I need to give each one a different routing key?
>
> No, not specifically to support multiple clients.
>
> > 3. Would I need to use different server threads for each client?
>
> Threading is not a relevant issue here.
>
>
>
>
> -Emile
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110713/426fd18b/attachment.htm>

From mikeb at rabbitmq.com  Wed Jul 13 15:53:32 2011
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Wed, 13 Jul 2011 15:53:32 +0100
Subject: [rabbitmq-discuss] Fwd:  a few json rpc questions
In-Reply-To: <CAJ2-VrmZREaxrtukWdkBX6bPEODCSNBb99h8SNqj-xUMRFHosw@mail.gmail.com>
References: <CAJ2-VrkDARuoP-iJgEiwagh_44WgiAhhizEbfTNj9YYyJPCMeQ@mail.gmail.com>	<4E1AD7DB.2090702@rabbitmq.com>	<CAJ2-Vrk2EqzWXBkFC2zOHYxN8hCNYsqB24sokkoJcJfE5rOmDA@mail.gmail.com>	<CAJ2-Vrk7aTeSnS+szosSB=-Ak-iSo+iVHeKYmoeqJOEvdBpJoA@mail.gmail.com>	<4E1DAA62.8060909@rabbitmq.com>
	<CAJ2-VrmZREaxrtukWdkBX6bPEODCSNBb99h8SNqj-xUMRFHosw@mail.gmail.com>
Message-ID: <4E1DB16C.5070906@rabbitmq.com>

> The RPC servers that serve requests for different applications must be
> listening on different work queues. You must ensure that RPC clients use
> a routing key that matches the server queue and are different for each
> application.
>
> and also you wrote in the last mail that I  Wouldn't need to give each
> one a different routing key ( not specifically to support multiple
> clients in answer to my second question.
>
> So, in brief. Should i give the same routing key or shouldnt i?
> can each application run with the same routing key and queue and all get
> their own answer?

By far the easiest way to encode RPC is to have one queue per service.

Many clients may make requests by publishing to that queue. Many clients 
may answer requests by consuming from that queue.

If you have disjoint services, use separate queues. To publish to a 
queue, you use the exchange "" and name the queue in the routing key.

All the rest follows.


--Michael


> On Wed, Jul 13, 2011 at 5:23 PM, Emile Joubert <emile at rabbitmq.com
> <mailto:emile at rabbitmq.com>> wrote:
>
>     Hi,
>
>     On 13/07/11 14:28, mysurf mail wrote:
>      >
>      >
>      > ---------- Forwarded message ----------
>      > From: *mysurf mail* <stammailbox at gmail.com
>     <mailto:stammailbox at gmail.com> <mailto:stammailbox at gmail.com
>     <mailto:stammailbox at gmail.com>>>
>      > Date: Wed, Jul 13, 2011 at 4:27 PM
>      > Subject: Re: [rabbitmq-discuss] a few json rpc questions
>      > To: Emile Joubert <emile at rabbitmq.com <mailto:emile at rabbitmq.com>
>     <mailto:emile at rabbitmq.com <mailto:emile at rabbitmq.com>>>
>      >
>      >
>      > Hi Emile,
>      >
>      > Thanks for the assistance.
>      >
>      > Though I have read the tutorial in your site, it looks like I did not
>      > fully understand the rpc for multiple clients' mechanism.
>
>     The RPC classes that you are using are designed to support multiple
>     clients.
>
>     I would suggest that you get RPC working reliably with a single client
>     first. The problem you describe (sometimes the application gets stuck)
>     may not relate to the presence of multiple clients at all.
>
>     The management plugin (http://www.rabbitmq.com/management.html) or the
>     rabbitmqctl utility can be used to confirm queue sizes if you believe
>     the problem is a messaging one.
>
>
>      > I have put a routing key in the server and all the clients (same one)
>      > and I thought it would make the server handle all the requests.
>      >
>      > 1. Is there any way to use the rpc like that for multiple clients?
>
>     Yes, as previously stated.
>
>      > 2. Would I need to give each one a different routing key?
>
>     No, not specifically to support multiple clients.
>
>      > 3. Would I need to use different server threads for each client?
>
>     Threading is not a relevant issue here.
>
>
>
>
>     -Emile
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From jerryk at vmware.com  Wed Jul 13 18:43:03 2011
From: jerryk at vmware.com (Jerry Kuch)
Date: Wed, 13 Jul 2011 10:43:03 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMq not honouring
	high_watermark	setting?
In-Reply-To: <ce425424-003f-4472-9654-bbedad32641b@a31g2000vbt.googlegroups.com>
Message-ID: <1056279598.130171.1310578983818.JavaMail.root@zimbra-prod-mbox-4.vmware.com>

You'll want to be mindful when bumping up against hard memory limits.  Erlang's garbage collector may exhibit ephemeral surges in its hunger for memory during copying phases, and those can be fatal in small heap environments as one is limited to on Windows with the 32-bit Erlang limitations that Emile and Simon have mentioned earlier in the thread...

Best regards,
Jerry

----- Original Message -----
From: "Dan B" <danbarua at gmail.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Wednesday, July 13, 2011 5:27:07 AM
Subject: Re: [rabbitmq-discuss] RabbitMq not honouring high_watermark	setting?

Can I safely set Rabbit to hoover up 100% of the memory that's
available to Erlang under windows?

Thanks

-Dan

On Jul 13, 1:04?pm, Emile Joubert <em... at rabbitmq.com> wrote:
> On 13/07/11 12:55, Dan B wrote:
>
> > I should have RTFM a bit more thoroughly.
>
> >>> Thus when RabbitMQ can't recognize your platform, if you actually have 8GB RAM
> >>> installed and you want RabbitMQ to throttle producers when the server is using
> >>> above 3GB, set vm_memory_high_watermark to 3
>
> > On my server, vm_memory_high_watermark = n results in a watermark of
> > 2n for some reason. I've set it to 1.5 (3gb), I'm not sure if Rabbit
> > can access all of that though, probably not.
>
> You are certain to run out of memory at some point if you do that.
> Unfortunately the Windows Erlang VM is 32bit and limited to 2Gb. Some
> versions of Windows support an alternative memory model that may allow a
> suitably patched Erlang VM access to slightly more memory, but I don't
> know of anyone succeeding in making it work:
>
> http://support.microsoft.com/default.aspx?scid=kb%3BEN-US%3B297812
>
> -Emile
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From jerryk at vmware.com  Wed Jul 13 19:06:04 2011
From: jerryk at vmware.com (Jerry Kuch)
Date: Wed, 13 Jul 2011 11:06:04 -0700 (PDT)
Subject: [rabbitmq-discuss] OpenAMQ JMS client and RabbitMQ
In-Reply-To: <d2025207-4f6d-4681-86c5-afbba8d68438@z7g2000prh.googlegroups.com>
Message-ID: <1576722805.131480.1310580364076.JavaMail.root@zimbra-prod-mbox-4.vmware.com>

Hi, Thomas...

Lacking expertise in this area I'm not sure Rabbit would be a super easy drop-in replacement given the state of the JMS story.  How much code in Hibernate search actually touches the message queueing?  Might one imagine porting it around the Rabbit Java client?

Best regards,
Jerry

----- Original Message -----
From: "scorpiovn" <thomas.kant at gmail.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Tuesday, July 12, 2011 7:33:48 PM
Subject: Re: [rabbitmq-discuss] OpenAMQ JMS client and RabbitMQ

Hi Jerry,

In our application, it currently use Hibernate search which supports
JMS and JGroup. So that it uses ActiveMQ as a search queue in backend.
However, we want to replace ActiveMQ to RabbitMQ and need a JMS client
can work with RabbitMQ.


On Jul 13, 3:28?am, Jerry Kuch <jer... at vmware.com> wrote:
> Hi, Thomas:
>
> I'm not entirely sure the Rabbit-JMQ stuff has been kept up to date, or what it's currently level of usability is. ?Can you say a bit more about what you'd like to try to do?
>
> Best regards,
> Jerry
>
>
>
>
>
>
>
> ----- Original Message -----
> From: "scorpiovn" <thomas.k... at gmail.com>
> To: rabbitmq-disc... at lists.rabbitmq.com
> Sent: Tuesday, July 12, 2011 10:10:45 AM
> Subject: [rabbitmq-discuss] OpenAMQ JMS client and RabbitMQ
>
> Hi All,
>
> This guy instructs to run OpenAMQ JMS client with RabbitMQ.http://www.lshift.net/blog/2009/03
>
> Anybody could help me out this solution with more detail instruction?
>
> thanks,
> +++
> thomas kant
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From Lowell.Boggs at emc.com  Wed Jul 13 20:21:32 2011
From: Lowell.Boggs at emc.com (Lowell.Boggs at emc.com)
Date: Wed, 13 Jul 2011 15:21:32 -0400
Subject: [rabbitmq-discuss] Documentation on priority?
In-Reply-To: <mailman.1.1310554801.15820.rabbitmq-discuss@lists.rabbitmq.com>
References: <mailman.1.1310554801.15820.rabbitmq-discuss@lists.rabbitmq.com>
Message-ID: <8A1A883E3F171B42A81817DEC138352C1DB514C03A@MX06A.corp.emc.com>

Hi,

Is there a page some where that explains what priorities are and how to use them?

I did not see message priority discussed in the tutorials.  A search of the rabbitmq site did not indicate that there was anything about priority there.  The only references the search gave me were to functions that allow you to set the priority or get it.  I found that the priorities range from 0-9 but that was about it.

For example, I'm interested in this information:

*  Is priority 0 higher or lower than priority 1?

*  Are messages with higher priority (whatever direction that is) guaranteed to be delivered before messages of lower priority?

*  Are the priorities of persistent messages in durable queues preserved after a server restart?

*  When populating the amq_basic_properties object with a priority, is it necessary to set the flags field such with a bit that indicates that priority is valid?

*  Are there any other aspects of the priority that I need to program around?

Thanks,
   Lowell


From michael.s.klishin at gmail.com  Wed Jul 13 20:31:28 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 13 Jul 2011 23:31:28 +0400
Subject: [rabbitmq-discuss] Documentation on priority?
In-Reply-To: <8A1A883E3F171B42A81817DEC138352C1DB514C03A@MX06A.corp.emc.com>
References: <mailman.1.1310554801.15820.rabbitmq-discuss@lists.rabbitmq.com>
	<8A1A883E3F171B42A81817DEC138352C1DB514C03A@MX06A.corp.emc.com>
Message-ID: <CAE3HoVTP_G68iRQNHaFknfJOMv85dTG2rQYxyiTGMJ2Ca_fVPQ@mail.gmail.com>

2011/7/13 <Lowell.Boggs at emc.com>

> For example, I'm interested in this information:
>
> *  Is priority 0 higher or lower than priority 1?
>
>
I don't think the spec defines it, so it is up to your applications.


>  *  Are messages with higher priority (whatever direction that is)
> guaranteed to be delivered before messages of lower priority?
>
>
As far as I know RabbitMQ does not use priority attribute for deliveries (or
any other purpuses).


>  *  Are the priorities of persistent messages in durable queues preserved
> after a server restart?
>
>
Yes, just like other message attributes.


>
>
> *  Are there any other aspects of the priority that I need to program
> around?
>

It is up to your applications how fields like `priority` or `type` are used.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110713/5387cf07/attachment.htm>

From dougk7 at gmail.com  Wed Jul 13 14:04:21 2011
From: dougk7 at gmail.com (Doug Kisabaka)
Date: Wed, 13 Jul 2011 06:04:21 -0700 (PDT)
Subject: [rabbitmq-discuss] Problem starting RabbitMQ 2.4.1 on Ubuntu
Message-ID: <6596071.1028.1310562261979.JavaMail.geo-discussion-forums@yqil17>

I tried installing RabbitMQ 2.4.1 on 2 servers running Ubuntu 10.04 from the 
.deb package in http://www.rabbitmq.com/releases/rabbitmq-server/v2.4.1/ and 
some plugins.
The server is failing to start yet this is the same version running on 
another server I successfully installed 2 weeks ago. Really have no clue 
what's going on

Here's the output for startup_log and startup_err.

startup_err:

Crash dump was written to: erl_crash.dump
init terminating in do_boot ()

startup_log:

*WARNING* Undefined function fdsrv:bind_socket/2
*WARNING* Undefined function fdsrv:start/0
*WARNING* Undefined function fdsrv:stop/0
*WARNING* Undefined function webmachine_resource:start_link/2
6 plugins activated:
* amqp_client-2.4.1
* mochiweb-1.3
* rabbit_management-2.4.1
* rabbit_management_agent-2.4.1
* rabbit_mochiweb-2.4.1
* webmachine-1.7.0

{"init terminating in 
do_boot",{{nocatch,{error,previous_upgrade_failed}},[{rabbit_upgrade,ensure_backup_taken,0},{rabbit_upgrade,maybe_upgrade_mnesia,0},{rabbit,prepare,0},{init,eval_script,8},{init,do_boot,3}]}}

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110713/a461990b/attachment.htm>

From toni.vdv at gmail.com  Wed Jul 13 16:47:57 2011
From: toni.vdv at gmail.com (Toni Van de Voorde)
Date: Wed, 13 Jul 2011 08:47:57 -0700 (PDT)
Subject: [rabbitmq-discuss] How to stop a consumer from consuming message
 after a message SHUTDOWN
Message-ID: <14699471.881.1310572077827.JavaMail.geo-discussion-forums@yqjc4>

Hello all,

We have a java application with rabbitmq consumers which processes different 
things based on a given message published from a php application.

When we need to upgrade the java application we would like a save way to 
shutdown the java. We thought about sending a message SHUTDOWN. But we can't 
seem to find a way to stop the consumer from consuming. Is it the correct 
way to do it or is there another way.

The java application is running in background on linux (not through an 
application server).

Thx
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110713/e54da640/attachment.htm>

From joseph.a.marlin at gmail.com  Wed Jul 13 21:22:19 2011
From: joseph.a.marlin at gmail.com (Joseph Marlin)
Date: Wed, 13 Jul 2011 13:22:19 -0700 (PDT)
Subject: [rabbitmq-discuss] Documentation on priority?
In-Reply-To: <8A1A883E3F171B42A81817DEC138352C1DB514C03A@MX06A.corp.emc.com>
Message-ID: <29014043.230.1310588540000.JavaMail.geo-discussion-forums@vbf27>

To supplement Michael's response, here is the spec [pdf]: 
http://www.amqp.org/confluence/download/attachments/2523279/amqp_1-0_PR3.pdf

Priority is detailed on pages 77-78.

RabbitMQ does not implement priorities. However, if you'd like some concept 
of priority, you can make a high priority queue and a low priority queue and 
make sure consumers check the high priority queue before doing anything from 
the low. 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110713/0400c653/attachment.htm>

From matthew at rabbitmq.com  Wed Jul 13 21:57:08 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 13 Jul 2011 21:57:08 +0100
Subject: [rabbitmq-discuss] Problem starting RabbitMQ 2.4.1 on Ubuntu
In-Reply-To: <6596071.1028.1310562261979.JavaMail.geo-discussion-forums@yqil17>
References: <6596071.1028.1310562261979.JavaMail.geo-discussion-forums@yqil17>
Message-ID: <20110713205708.GA2650@rabbitmq.com>

On Wed, Jul 13, 2011 at 06:04:21AM -0700, Doug Kisabaka wrote:
> {"init terminating in 
> do_boot",{{nocatch,{error,previous_upgrade_failed}},[{rabbit_upgrade,ensure_backup_taken,0},{rabbit_upgrade,maybe_upgrade_mnesia,0},{rabbit,prepare,0},{init,eval_script,8},{init,do_boot,3}]}}

Interesting - that suggests that something went wrong when upgrading the
data store on disk from a previous version of Rabbit. If you can locate
where Rabbit is storing files on disk - usually given in the successful
startup of Rabbit - and can pack up the files and send them to us (off
list), I'm sure we'd like to take a look at that to try and figure out
what went wrong.

Once you've taken a copy of those files, you can delete all those files,
and Rabbit will start up fine, but it'll start up with a fresh state and
will have forgotten all messages/queues/exchanges/bindings/vhosts/users
that it had saved (if any).

Matthew

From alfonso.pantoja at gmail.com  Wed Jul 13 23:36:09 2011
From: alfonso.pantoja at gmail.com (Alfonso Pantoja)
Date: Thu, 14 Jul 2011 00:36:09 +0200
Subject: [rabbitmq-discuss] Default Virtual Host and HTTP API problem
In-Reply-To: <CAM8fPiRKF0ifrFDJ9MgPiLaJj2s6tCub=7uoyR_DRPqd4aY+aw@mail.gmail.com>
References: <f317ef14-4c73-4877-a84d-27e9717dfeb4@l14g2000pro.googlegroups.com>
	<CAM8fPiRKF0ifrFDJ9MgPiLaJj2s6tCub=7uoyR_DRPqd4aY+aw@mail.gmail.com>
Message-ID: <CAGVpBAD5TJKS1OymGKvDwWd_E2JVwr9-KcPYb9i=8d=DB-hSKg@mail.gmail.com>

Tony,

Thank you for the advice.
Didn't test yet the third party library you suggested but I've seen in
the source code that it is using Uri .NET object to construct the HTTP
request which is the cause of   %2F  becomes "/".
Anyway it is obvious that this is an error in .NET framework.

Regards,

Alfonso


2011/6/30 Tony Garnock-Jones <tonygarnockjones+rabbitmq at gmail.com>:
> Hi Alfonso,
>
> On 30 June 2011 11:39, Alfonso Pantoja <alfonso.pantoja at gmail.com> wrote:
>>
>> I've found a problem using the HTTP API. Using .NET you should use
>> sockets or a hack to make a webrequest using the character %2F
>> because .NET replaces that %2F by "/"
>> so http://server/api/%2F/queues becomes always http://server/api///queues
>> and a not found is get.
>
> I recommend avoiding the broken Microsoft HTTP client library, and using a
> better third-party library. A few minutes googling produced
> http://www.codescales.com/, which looks plausible.
>
> (It seems that MS have actually willfully crippled their client: see, for
> instance, this bug report. "We are not aware of any such real world
> scenarios currently."?good grief!)
>
> Regards,
> ? Tony
>
>

From alfonso.pantoja at gmail.com  Wed Jul 13 23:40:16 2011
From: alfonso.pantoja at gmail.com (Alfonso Pantoja)
Date: Thu, 14 Jul 2011 00:40:16 +0200
Subject: [rabbitmq-discuss] Default Virtual Host and HTTP API problem
In-Reply-To: <BANLkTimmhXQJBkjXDuynrNHbTKTQtADM=g@mail.gmail.com>
References: <BANLkTimmhXQJBkjXDuynrNHbTKTQtADM=g@mail.gmail.com>
Message-ID: <CAGVpBABtURER+d6xeXc8_UY-gbAqS0hA0OvTOvJQHw_J1pWH+Q@mail.gmail.com>

Simone,

Thank you very much.
It's a pity that the workaround could stop working after any new
framewok release but it is a great solution :)

Regards,

Alfonso

2011/6/30 Simone Busoli <simone.busoli at gmail.com>:
> Alfonso, the workaround is quite simple, and btw it's flaw in MS
> implementation. If you need ideas about how to solve it you can check out
> what I did in the rest API wrapper for .NET I created here (the workaround
> comes from stackoverflow btw):
> http://code.google.com/p/mexexp/source/browse/trunk/RabbitMQ/Resbit/ResbitClient.cs
>
> On Jun 30, 2011 5:39 PM, "Alfonso Pantoja" <alfonso.pantoja at gmail.com>
> wrote:
>

From alfonso.pantoja at gmail.com  Wed Jul 13 23:50:29 2011
From: alfonso.pantoja at gmail.com (Alfonso Pantoja)
Date: Thu, 14 Jul 2011 00:50:29 +0200
Subject: [rabbitmq-discuss] Rabbit 2.2 does not report connected
	consumers
In-Reply-To: <4E0B48E4.60409@rabbitmq.com>
References: <9a1eb85a-f323-40a6-be30-2bf3aa42b996@e17g2000prj.googlegroups.com>
	<4E0B48E4.60409@rabbitmq.com>
Message-ID: <CAGVpBADQKyqLxfNBvoOLjjanbw6YmsA7sJfEtuhD0sZ9dXK2rw@mail.gmail.com>

Hi Matthias,

I haven't got much info about this problem currently.
It usually happens with one single consumer and neither the web admin
pluggin nor rabbitmqctl didn't detect the consumer.
I'll try to provide more details when I could do some research.

Regards,

Alfonso


2011/6/29 Matthias Radestock <matthias at rabbitmq.com>:
> Alfonso,
>
> On 23/06/11 12:49, Alfonso Pantoja wrote:
>>
>> We are using RabbitMQ 2.2 and I've noticed that in some queues the
>> number of consumers is always reported as "0"
>> (these queues really have consumers attached to them because when
>> sending messages to them they are processed by the consumers)
>
> How are the consumers consuming the messages? Can you post some sample code?
> And how reproducible is this?
>
> Regards,
>
> Matthias.
>

From udaymitra4u at gmail.com  Thu Jul 14 06:01:56 2011
From: udaymitra4u at gmail.com (Uday Mitra)
Date: Wed, 13 Jul 2011 22:01:56 -0700
Subject: [rabbitmq-discuss] Unable to share fanned out queue between two
	cosnumers
Message-ID: <CAKGgVGs3Aj-U6RqskZ3YDsOYtFHCBbkaEB+Ep3txs3Jzs62Urg@mail.gmail.com>

Hi All,

I have a fanout exchange and I am binding different queues to this exchange.
When I send data to this exchange each queue that is bound to this exchange
is getting data as expected. But when I try to connect multiple consumers to
one of these fanned out queues, I get the following message:
"Queue message_queue1 has an exclusive consumer. No more consumers allowed."

Here is the properties file that has the configuration:

fanout.properties:
--------------------
java.naming.factory.initial =
org.apache.qpid.jndi.PropertiesFileInitialContextFactory
connectionfactory.qpidConnectionfactory = amqp://guest:guest at xxxxxxx
/?brokerlist='tcp://xxxxx:5672'

# for producer
destination.fanoutQueue =
BURL:fanout://testcollector.fanout//message_queue?durable='false'&autodelete='true'&exclusive='false'

# for consumers
destination.fanoutQueue1 =
BURL:fanout://testcollector.fanout//message_queue1?durable='false'&autodelete='true'&exclusive='false'

destination.fanoutQueue2 =
BURL:fanout://testcollector.fanout//message_queue2?durable='false'&autodelete='true'&exclusive='false'

destination.fanoutQueue3 =
BURL:fanout://testcollector.fanout//message_queue3?durable='false'&autodelete='true'&exclusive='false'
-------------------------

I tried to connect two consumers to message_queue1 and I get the following
error:
INFO org.apache.qpid.client.AMQConnection - Closing AMQConnection due to
:org.apache.qpid.AMQException: ch=0 id=0
ExecutionException(errorCode=RESOURCE_LOCKED, commandId=6, classCode=4,
commandCode=7, fieldIndex=0, description=resource-locked: Queue
message_queue1 has an exclusive consumer. No more consumers allowed.
(qpid/broker/Queue.cpp:385), errorInfo={}) [error code 405: Already exists]

I checked the configuration on AMQP Server and it says that message_queue1
is a non-exclusive queue.
-bash-4.1$ qpid-stat -q
Queues
  queue                                  dur  autoDel  excl  msg   msgIn
msgOut  bytes  bytesIn  bytesOut  cons  bind
  message_queue1                              Y                 1    22
21      15    324      309         1     2


Here is the code I am using.

Producer.java: (queueName=fanoutQueue)
----------------
                Properties properties = new Properties();

properties.load(this.getClass().getResourceAsStream("fanout.properties"));

        //Create the initial context
        Context ctx = new InitialContext(properties);

        // look up destination and connection factory
        Destination destination = (Destination)ctx.lookup(queueName);
        ConnectionFactory conFac =
(ConnectionFactory)ctx.lookup("qpidConnectionfactory");

        Connection connection = conFac.createConnection();
        Session session = connection.createSession(false,
Session.AUTO_ACKNOWLEDGE);

        MessageProducer messageProducer =
session.createProducer(destination);
        TextMessage message;

        // Send a series of messages in a loop
        int i=0;
        while(true) {
            message = session.createTextMessage("Hello world! "+i);
            messageProducer.send(message, DeliveryMode.NON_PERSISTENT,
Message.DEFAULT_PRIORITY, 60*1000);
            i++;
            Thread.sleep(1000);
        }
-------------------

Consumer.java: (queueName=fanoutQueue1)
-----------------
                Properties properties = new Properties();

properties.load(this.getClass().getResourceAsStream("fanout.properties"));

        //Create the initial context
        Context ctx = new InitialContext(properties);

        // look up destination and connection factory
        Destination destination = (Destination)ctx.lookup(queueName);
        ConnectionFactory conFac =
(ConnectionFactory)ctx.lookup("qpidConnectionfactory");

        Connection connection = conFac.createConnection();
        connection.setExceptionListener(new ExceptionListener()
        {
            public void onException(JMSException jmse)
            {
                System.err.println(CLASS + ": The sample received an
exception through the ExceptionListener");
                System.exit(0);
            }
        });

        System.out.println(CLASS + ": Creating a non-transacted,
auto-acknowledged session");
        Session session = connection.createSession(false,
Session.AUTO_ACKNOWLEDGE);

        MessageConsumer messageConsumer =
session.createConsumer(destination);
        connection.start();

        while(true) {
            TextMessage message =
(TextMessage)messageConsumer.receive(1000);
            if(message != null)
                System.out.println(message.getText());
        }
-----------------

I am using QPID, but I figured if this is doable in RabbitMQ, then it should
be possible in QPID too.
Am I missing something here?

I really appreciate your help.

Thanks,
Uday
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110713/50a63a4d/attachment.htm>

From stammailbox at gmail.com  Thu Jul 14 07:35:32 2011
From: stammailbox at gmail.com (mysurf mail)
Date: Thu, 14 Jul 2011 09:35:32 +0300
Subject: [rabbitmq-discuss] Fwd: a few json rpc questions
In-Reply-To: <4E1DB16C.5070906@rabbitmq.com>
References: <CAJ2-VrkDARuoP-iJgEiwagh_44WgiAhhizEbfTNj9YYyJPCMeQ@mail.gmail.com>
	<4E1AD7DB.2090702@rabbitmq.com>
	<CAJ2-Vrk2EqzWXBkFC2zOHYxN8hCNYsqB24sokkoJcJfE5rOmDA@mail.gmail.com>
	<CAJ2-Vrk7aTeSnS+szosSB=-Ak-iSo+iVHeKYmoeqJOEvdBpJoA@mail.gmail.com>
	<4E1DAA62.8060909@rabbitmq.com>
	<CAJ2-VrmZREaxrtukWdkBX6bPEODCSNBb99h8SNqj-xUMRFHosw@mail.gmail.com>
	<4E1DB16C.5070906@rabbitmq.com>
Message-ID: <CAJ2-VrmdAo6B0K-QmjAC6nW4cxGDd=OQUBaxiCVhttWimKYVVw@mail.gmail.com>

Hi,
Thanks for the answer.
As I have mentioned - I need a more than one client to one server. 1 server
- n clients.
my question - I was probably not clear in my mails so I will try to rephrase
it one more time.

Can all the clients be configurated with the same queuename ("") and the
same routing key (the same for all)?
That is it.

thank you .


On Wed, Jul 13, 2011 at 5:53 PM, Michael Bridgen <mikeb at rabbitmq.com> wrote:

> The RPC servers that serve requests for different applications must be
>> listening on different work queues. You must ensure that RPC clients use
>> a routing key that matches the server queue and are different for each
>> application.
>>
>> and also you wrote in the last mail that I  Wouldn't need to give each
>> one a different routing key ( not specifically to support multiple
>> clients in answer to my second question.
>>
>> So, in brief. Should i give the same routing key or shouldnt i?
>> can each application run with the same routing key and queue and all get
>> their own answer?
>>
>
> By far the easiest way to encode RPC is to have one queue per service.
>
> Many clients may make requests by publishing to that queue. Many clients
> may answer requests by consuming from that queue.
>
> If you have disjoint services, use separate queues. To publish to a queue,
> you use the exchange "" and name the queue in the routing key.
>
> All the rest follows.
>
>
> --Michael
>
>
>  On Wed, Jul 13, 2011 at 5:23 PM, Emile Joubert <emile at rabbitmq.com
>> <mailto:emile at rabbitmq.com>> wrote:
>>
>>    Hi,
>>
>>    On 13/07/11 14:28, mysurf mail wrote:
>>     >
>>     >
>>     > ---------- Forwarded message ----------
>>     > From: *mysurf mail* <stammailbox at gmail.com
>>    <mailto:stammailbox at gmail.com> <mailto:stammailbox at gmail.com
>>    <mailto:stammailbox at gmail.com>**>>
>>     > Date: Wed, Jul 13, 2011 at 4:27 PM
>>     > Subject: Re: [rabbitmq-discuss] a few json rpc questions
>>     > To: Emile Joubert <emile at rabbitmq.com <mailto:emile at rabbitmq.com>
>>    <mailto:emile at rabbitmq.com <mailto:emile at rabbitmq.com>>>
>>     >
>>     >
>>     > Hi Emile,
>>     >
>>     > Thanks for the assistance.
>>     >
>>     > Though I have read the tutorial in your site, it looks like I did
>> not
>>     > fully understand the rpc for multiple clients' mechanism.
>>
>>    The RPC classes that you are using are designed to support multiple
>>    clients.
>>
>>    I would suggest that you get RPC working reliably with a single client
>>    first. The problem you describe (sometimes the application gets stuck)
>>    may not relate to the presence of multiple clients at all.
>>
>>    The management plugin (http://www.rabbitmq.com/**management.html<http://www.rabbitmq.com/management.html>)
>> or the
>>    rabbitmqctl utility can be used to confirm queue sizes if you believe
>>    the problem is a messaging one.
>>
>>
>>     > I have put a routing key in the server and all the clients (same
>> one)
>>     > and I thought it would make the server handle all the requests.
>>     >
>>     > 1. Is there any way to use the rpc like that for multiple clients?
>>
>>    Yes, as previously stated.
>>
>>     > 2. Would I need to give each one a different routing key?
>>
>>    No, not specifically to support multiple clients.
>>
>>     > 3. Would I need to use different server threads for each client?
>>
>>    Threading is not a relevant issue here.
>>
>>
>>
>>
>>    -Emile
>>
>>
>>
>>
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110714/f785efb6/attachment.htm>

From udaymitra4u at gmail.com  Thu Jul 14 01:11:32 2011
From: udaymitra4u at gmail.com (Mitra77)
Date: Wed, 13 Jul 2011 17:11:32 -0700 (PDT)
Subject: [rabbitmq-discuss] Unable to connect multiple consumers to a queue
 bound to fanned out exchange
Message-ID: <32058027.post@talk.nabble.com>


Hi All,

I have a fanout exchange and I am binding different queues to this exchange.
When I send data to this exchange each queue that is bound to this exchange
is getting data as expected. But when I try to connect multiple consumers to
one of these fanned out queues, I get the following message:
"Queue message_queue1 has an exclusive consumer. No more consumers allowed."

Here is the properties file that has the configuration:

fanout.properties:
--------------------
java.naming.factory.initial =
org.apache.qpid.jndi.PropertiesFileInitialContextFactory
connectionfactory.qpidConnectionfactory =
amqp://guest:guest at lsq20.geo.apple.com/?brokerlist='tcp://lsq20.geo.apple.com:5672'

# for producer
destination.fanoutQueue =
BURL:fanout://testcollector.fanout//message_queue?durable='false'&autodelete='true'&exclusive='false'

# for consumers
destination.fanoutQueue1 =
BURL:fanout://testcollector.fanout//message_queue1?durable='false'&autodelete='true'&exclusive='false'

destination.fanoutQueue2 =
BURL:fanout://testcollector.fanout//message_queue2?durable='false'&autodelete='true'&exclusive='false'

destination.fanoutQueue3 =
BURL:fanout://testcollector.fanout//message_queue3?durable='false'&autodelete='true'&exclusive='false'
-------------------------

I tried to connect two consumers to message_queue1 and I get the following
error:
INFO org.apache.qpid.client.AMQConnection - Closing AMQConnection due to
:org.apache.qpid.AMQException: ch=0 id=0
ExecutionException(errorCode=RESOURCE_LOCKED, commandId=6, classCode=4,
commandCode=7, fieldIndex=0, description=resource-locked: Queue
message_queue1 has an exclusive consumer. No more consumers allowed.
(qpid/broker/Queue.cpp:385), errorInfo={}) [error code 405: Already exists]

I checked the configuration on AMQP Server and it says that message_queue1
is a non-exclusive queue.
-bash-4.1$ qpid-stat -q
Queues
  queue                                  dur  autoDel  excl  msg   msgIn 
msgOut  bytes  bytesIn  bytesOut  cons  bind
  message_queue1                              Y                 1    22    
21      15    324      309         1     2


Here is the code I am using.

Producer.java: (queueName=fanoutQueue)
----------------
                Properties properties = new Properties();
		properties.load(this.getClass().getResourceAsStream("fanout.properties"));

		//Create the initial context
		Context ctx = new InitialContext(properties);

		// look up destination and connection factory
		Destination destination = (Destination)ctx.lookup(queueName);
		ConnectionFactory conFac =
(ConnectionFactory)ctx.lookup("qpidConnectionfactory");
		
		Connection connection = conFac.createConnection();
		Session session = connection.createSession(false,
Session.AUTO_ACKNOWLEDGE);
		
		MessageProducer messageProducer = session.createProducer(destination);
		TextMessage message;

		// Send a series of messages in a loop
		int i=0;
		while(true) {
			message = session.createTextMessage("Hello world! "+i);
		    messageProducer.send(message, DeliveryMode.NON_PERSISTENT,   
Message.DEFAULT_PRIORITY, 60*1000);
			i++;
			Thread.sleep(1000);
		}
-------------------

Consumer.java: (queueName=fanoutQueue1)
-----------------
                Properties properties = new Properties();
		properties.load(this.getClass().getResourceAsStream("fanout.properties"));

		//Create the initial context
		Context ctx = new InitialContext(properties);

		// look up destination and connection factory
		Destination destination = (Destination)ctx.lookup(queueName);
		ConnectionFactory conFac =
(ConnectionFactory)ctx.lookup("qpidConnectionfactory");
		
		Connection connection = conFac.createConnection();
		connection.setExceptionListener(new ExceptionListener()
		{
		    public void onException(JMSException jmse)
		    {
		        System.err.println(CLASS + ": The sample received an exception
through the ExceptionListener");
		        System.exit(0);
		    }
		});

		System.out.println(CLASS + ": Creating a non-transacted, auto-acknowledged
session");
		Session session = connection.createSession(false,
Session.AUTO_ACKNOWLEDGE);
		
		MessageConsumer messageConsumer = session.createConsumer(destination);
		connection.start();
		
		while(true) {
			TextMessage message = (TextMessage)messageConsumer.receive(1000);
			if(message != null)
				System.out.println(message.getText());
		}
-----------------

I am using QPID, but I figured if this is doable in RabbitMQ, then it should
be possible in QPID too.
Am I missing something here?

I really appreciate your help.

Thanks,
Uday

-- 
View this message in context: http://old.nabble.com/Unable-to-connect-multiple-consumers-to-a-queue-bound-to-fanned-out-exchange-tp32058027p32058027.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From udaymitra4u at gmail.com  Thu Jul 14 01:12:40 2011
From: udaymitra4u at gmail.com (Mitra77)
Date: Wed, 13 Jul 2011 17:12:40 -0700 (PDT)
Subject: [rabbitmq-discuss] Unable to connect multiple consumers to a queue
 bound to fanned out exchange
Message-ID: <32058027.post@talk.nabble.com>


Hi All,

I have a fanout exchange and I am binding different queues to this exchange.
When I send data to this exchange each queue that is bound to this exchange
is getting data as expected. But when I try to connect multiple consumers to
one of these fanned out queues, I get the following message:
"Queue message_queue1 has an exclusive consumer. No more consumers allowed."

Here is the properties file that has the configuration:

fanout.properties:
--------------------
java.naming.factory.initial =
org.apache.qpid.jndi.PropertiesFileInitialContextFactory
connectionfactory.qpidConnectionfactory =
amqp://guest:guest at xxxxxxx/?brokerlist='tcp://xxxxx:5672'

# for producer
destination.fanoutQueue =
BURL:fanout://testcollector.fanout//message_queue?durable='false'&autodelete='true'&exclusive='false'

# for consumers
destination.fanoutQueue1 =
BURL:fanout://testcollector.fanout//message_queue1?durable='false'&autodelete='true'&exclusive='false'

destination.fanoutQueue2 =
BURL:fanout://testcollector.fanout//message_queue2?durable='false'&autodelete='true'&exclusive='false'

destination.fanoutQueue3 =
BURL:fanout://testcollector.fanout//message_queue3?durable='false'&autodelete='true'&exclusive='false'
-------------------------

I tried to connect two consumers to message_queue1 and I get the following
error:
INFO org.apache.qpid.client.AMQConnection - Closing AMQConnection due to
:org.apache.qpid.AMQException: ch=0 id=0
ExecutionException(errorCode=RESOURCE_LOCKED, commandId=6, classCode=4,
commandCode=7, fieldIndex=0, description=resource-locked: Queue
message_queue1 has an exclusive consumer. No more consumers allowed.
(qpid/broker/Queue.cpp:385), errorInfo={}) [error code 405: Already exists]

I checked the configuration on AMQP Server and it says that message_queue1
is a non-exclusive queue.
-bash-4.1$ qpid-stat -q
Queues
  queue                                  dur  autoDel  excl  msg   msgIn 
msgOut  bytes  bytesIn  bytesOut  cons  bind
  message_queue1                              Y                 1    22    
21      15    324      309         1     2


Here is the code I am using.

Producer.java: (queueName=fanoutQueue)
----------------
                Properties properties = new Properties();
		properties.load(this.getClass().getResourceAsStream("fanout.properties"));

		//Create the initial context
		Context ctx = new InitialContext(properties);

		// look up destination and connection factory
		Destination destination = (Destination)ctx.lookup(queueName);
		ConnectionFactory conFac =
(ConnectionFactory)ctx.lookup("qpidConnectionfactory");
		
		Connection connection = conFac.createConnection();
		Session session = connection.createSession(false,
Session.AUTO_ACKNOWLEDGE);
		
		MessageProducer messageProducer = session.createProducer(destination);
		TextMessage message;

		// Send a series of messages in a loop
		int i=0;
		while(true) {
			message = session.createTextMessage("Hello world! "+i);
		    messageProducer.send(message, DeliveryMode.NON_PERSISTENT,   
Message.DEFAULT_PRIORITY, 60*1000);
			i++;
			Thread.sleep(1000);
		}
-------------------

Consumer.java: (queueName=fanoutQueue1)
-----------------
                Properties properties = new Properties();
		properties.load(this.getClass().getResourceAsStream("fanout.properties"));

		//Create the initial context
		Context ctx = new InitialContext(properties);

		// look up destination and connection factory
		Destination destination = (Destination)ctx.lookup(queueName);
		ConnectionFactory conFac =
(ConnectionFactory)ctx.lookup("qpidConnectionfactory");
		
		Connection connection = conFac.createConnection();
		connection.setExceptionListener(new ExceptionListener()
		{
		    public void onException(JMSException jmse)
		    {
		        System.err.println(CLASS + ": The sample received an exception
through the ExceptionListener");
		        System.exit(0);
		    }
		});

		System.out.println(CLASS + ": Creating a non-transacted, auto-acknowledged
session");
		Session session = connection.createSession(false,
Session.AUTO_ACKNOWLEDGE);
		
		MessageConsumer messageConsumer = session.createConsumer(destination);
		connection.start();
		
		while(true) {
			TextMessage message = (TextMessage)messageConsumer.receive(1000);
			if(message != null)
				System.out.println(message.getText());
		}
-----------------

I am using QPID, but I figured if this is doable in RabbitMQ, then it should
be possible in QPID too.
Am I missing something here?

I really appreciate your help.

Thanks,
Uday

-- 
View this message in context: http://old.nabble.com/Unable-to-connect-multiple-consumers-to-a-queue-bound-to-fanned-out-exchange-tp32058027p32058027.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From mike.hadlow at 15below.com  Thu Jul 14 11:51:59 2011
From: mike.hadlow at 15below.com (Mike Hadlow)
Date: Thu, 14 Jul 2011 05:51:59 -0500
Subject: [rabbitmq-discuss] How Should a Messaging Client Handle Errors?
Message-ID: <3095E7BFC8C0664E97D71288189F19C6179FC73A31@AUSP01VMBX29.collaborationhost.net>

Hi All,

This is a copy of a blog post I've just written<http://mikehadlow.blogspot.com/2011/07/easynetq-how-should-messaging-client.html>. I was wondering if anyone on the group had any good suggestions for error handling strategies?

EasyNetQ<https://github.com/mikehadlow/EasyNetQ> is my simple .NET API for RabbitMQ.

I've started thinking about the best patterns for implementing error handling in EasyNetQ. One of the aims of EasyNetQ is to remove as many infrastructure concerns from the application developer as possible. This means that the API should correctly handle any exceptions that bubble up from the application layer.

One of the core requirements is that we shouldn't lose messages when the application throws. The question then becomes: where should the message, that the application was consuming when it threw, go? There seem to be three choices:

 1.  Put the failed message back on the queue it was consumed from.
 2.  Put the failed message on an error queue.
 3.  A combination of 1 and 2.

Option 1 has the benefit that it's the out-of-the-box behaviour of AMQP. In the case of EasyNetQ, I would simply catch any exceptions, log them, and just send a noAck command back to RabbitMQ. Rabbit would put the message at the back of the queue and then resend it when it got to the front.

Another advantage of this technique is that it gives competing consumers the opportunity to process the message. If you have more than one consumer on a queue, Rabbit will send the messages to them in turn, so this is out-of-the-box.

The drawback of this method is that there's the possibility of the queue filling up with failed messages. The consumer would just be cycling around throwing exceptions and any messages that it might be able to to consume would be slowed down by having to wait their turn amongst a long queue of failed messages.

Another problem is that it's difficult to manually inspect the messages and selectively delete or retry them.

Option 2 is harder to implement. I would have to catch exceptions, log them and then write the message to an error queue. I would need to write an error queue consumer to store the messages in a database. I would then need to provide the user with some way to inspect the messages alongside the error that caused them to arrive in the error queue so that they could make a ignore/retry decision.

I could also implement some kind of wait-and-retry function on the error queue, but that would also add additional complexity.

It has the advantage that the original queue remains clear of failing messages. Failed messages and the error condition that caused the failure can be inspected together, and failed messages can be manually ignored or retried.

With the failed messages sitting in a database, it would also be simple to create a mechanism where those messages could be replayed on a developer machine to aid in debugging.

A combination of 1 and 2. I'm moving towards thinking that a combination of 1 & 2 might be the best strategy. When a message fails initially, we simply noAck it and it goes back to the queue. AMQP provides a Redelivered flag, so when the messages is consumed a second time we can be aware that it's a retry. Unfortunately there doesn't seem to be a retry count in AMQP, so the best we can do is allow for a single retry. This has the benefit that it gives a competing consumer a chance to process the message.

After the single retry we fall back to Option 2. The message is passed to the error queue on the second failure.

I would be very interested in hearing how other people have implemented error handling with AMQP/RabbitMQ.

Many thanks

Mike


15below Limited: Company registered in England and Wales No 3945289
Registered Office: Lyndean House, 43-46 Queens Road, Brighton BN1 3XB, United Kingdom

15below Australia Pty Limited: ABN 25 132 716 379
Level 50, 120 Collins Street, Melbourne, Victoria 3000, Australia

Please think about the environment before printing this email.

************************************************************************
This email and any attachments may be confidential and/or legally privileged and are solely for the use of the intended recipient. If you have received this email in error please contact the sender. Any views or opinions expressed within this e-mail are solely those of the sender, and do not necessarily represent those of 15below unless otherwise specifically stated. Although 15below has taken every reasonable precaution to ensure that any attachment to this e-mail has been checked for viruses, it is strongly recommended that you carry out your own virus check before opening any attachment, as we cannot accept liability for any damage sustained as a result of software virus infection.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110714/8d8c642e/attachment.htm>

From rob.harrop at gmail.com  Thu Jul 14 12:45:43 2011
From: rob.harrop at gmail.com (Rob Harrop)
Date: Thu, 14 Jul 2011 12:45:43 +0100
Subject: [rabbitmq-discuss] How Should a Messaging Client Handle Errors?
In-Reply-To: <3095E7BFC8C0664E97D71288189F19C6179FC73A31@AUSP01VMBX29.collaborationhost.net>
References: <3095E7BFC8C0664E97D71288189F19C6179FC73A31@AUSP01VMBX29.collaborationhost.net>
Message-ID: <4E1ED6E7.4090304@rabbitmq.com>

Mike,

The solution you outline in option 2 sounds like the Dead-Letter 
Exchange support I'm working on at the moment.

Using DLEs, you can declare that a queue routes all dead messages to a 
specified exchange for later processing. Messages are considered dead when:

* The queue containing the message is deleted
* The queue containing the message is purged
* The queue containing is deleted due to lease expiry
* The message is rejected (basic.reject or basic.nack) with requeue=false
* The TTL for the message expires

Messages are routed to DLEs using their original routing key. If you 
make the DLE a fanout exchange then you can easily route all dead 
messages to all queues bound to the DLE.

When this feature is complete, the DLE code will ensure that persistent 
messages are routed through the DLE before being removed from the source 
queue - this should give you the guarantee of safety that you are 
looking for.

Regards,

Rob

Mike Hadlow wrote:
> Hi All,
>
> This is a copy of a blog post I?ve just written
> <http://mikehadlow.blogspot.com/2011/07/easynetq-how-should-messaging-client.html>.
> I was wondering if anyone on the group had any good suggestions for
> error handling strategies?
>
> EasyNetQ <https://github.com/mikehadlow/EasyNetQ> is my simple .NET API
> for RabbitMQ.
>
> I?ve started thinking about the best patterns for implementing error
> handling in EasyNetQ. One of the aims of EasyNetQ is to remove as many
> infrastructure concerns from the application developer as possible. This
> means that the API should correctly handle any exceptions that bubble up
> from the application layer.
>
> One of the core requirements is that we shouldn?t lose messages when the
> application throws. The question then becomes: where should the message,
> that the application was consuming when it threw, go? There seem to be
> three choices:
>
>    1. Put the failed message back on the queue it was consumed from.
>    2. Put the failed message on an error queue.
>    3. A combination of 1 and 2.
>
> *Option 1*has the benefit that it?s the out-of-the-box behaviour of
> AMQP. In the case of EasyNetQ, I would simply catch any exceptions, log
> them, and just send a noAck command back to RabbitMQ. Rabbit would put
> the message at the back of the queue and then resend it when it got to
> the front.
>
> Another advantage of this technique is that it gives competing consumers
> the opportunity to process the message. If you have more than one
> consumer on a queue, Rabbit will send the messages to them in turn, so
> this is out-of-the-box.
>
> The drawback of this method is that there?s the possibility of the queue
> filling up with failed messages. The consumer would just be cycling
> around throwing exceptions and any messages that it might be able to to
> consume would be slowed down by having to wait their turn amongst a long
> queue of failed messages.
>
> Another problem is that it?s difficult to manually inspect the messages
> and selectively delete or retry them.
>
> *Option 2*is harder to implement. I would have to catch exceptions, log
> them and then write the message to an error queue. I would need to write
> an error queue consumer to store the messages in a database. I would
> then need to provide the user with some way to inspect the messages
> alongside the error that caused them to arrive in the error queue so
> that they could make a ignore/retry decision.
>
> I could also implement some kind of wait-and-retry function on the error
> queue, but that would also add additional complexity.
>
> It has the advantage that the original queue remains clear of failing
> messages. Failed messages and the error condition that caused the
> failure can be inspected together, and failed messages can be manually
> ignored or retried.
>
> With the failed messages sitting in a database, it would also be simple
> to create a mechanism where those messages could be replayed on a
> developer machine to aid in debugging.
>
> *A combination of 1 and 2*. I?m moving towards thinking that a
> combination of 1 & 2 might be the best strategy. When a message fails
> initially, we simply noAck it and it goes back to the queue. AMQP
> provides a Redelivered flag, so when the messages is consumed a second
> time we can be aware that it?s a retry. Unfortunately there doesn?t seem
> to be a retry count in AMQP, so the best we can do is allow for a single
> retry. This has the benefit that it gives a competing consumer a chance
> to process the message.
>
> After the single retry we fall back to *Option 2*. The message is passed
> to the error queue on the second failure.
>
> I would be very interested in hearing how other people have implemented
> error handling with AMQP/RabbitMQ.
>
> Many thanks
>
> Mike
>
>
> 15below Limited: Company registered in England and Wales No 3945289
> Registered Office: Lyndean House, 43-46 Queens Road, Brighton BN1 3XB,
> United Kingdom
>
> 15below Australia Pty Limited: ABN 25 132 716 379
> Level 50, 120 Collins Street, Melbourne, Victoria 3000, Australia
>
> Please think about the environment before printing this email.
>
> ************************************************************************
> This email and any attachments may be confidential and/or legally
> privileged and are solely for the use of the intended recipient. If you
> have received this email in error please contact the sender. Any views
> or opinions expressed within this e-mail are solely those of the sender,
> and do not necessarily represent those of 15below unless otherwise
> specifically stated. Although 15below has taken every reasonable
> precaution to ensure that any attachment to this e-mail has been checked
> for viruses, it is strongly recommended that you carry out your own
> virus check before opening any attachment, as we cannot accept liability
> for any damage sustained as a result of software virus infection.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From mike.hadlow at 15below.com  Thu Jul 14 13:01:17 2011
From: mike.hadlow at 15below.com (Mike Hadlow)
Date: Thu, 14 Jul 2011 07:01:17 -0500
Subject: [rabbitmq-discuss] How Should a Messaging Client Handle Errors?
In-Reply-To: <4E1ED6E7.4090304@rabbitmq.com>
References: <3095E7BFC8C0664E97D71288189F19C6179FC73A31@AUSP01VMBX29.collaborationhost.net>
	<4E1ED6E7.4090304@rabbitmq.com>
Message-ID: <3095E7BFC8C0664E97D71288189F19C6179FC73A55@AUSP01VMBX29.collaborationhost.net>

Hi Rob,

Your Dead Letter Exchange sounds very interesting, just what I need in fact for option 2 :)

How long before we can expect to see this in RabbitMQ? I'm thinking I'll probably have to implement a client-side DLE for the time being and then change to use your DLE once it's available. But it's great to hear that it's happening.

A very useful feature would be some way of communicating the reason for the basic.reject or basic.nack, such as a stack trace for example. If basic.nack took a reason string that could be added as a header to the message sent to the DLE, it would be very helpful.

Thanks
Mike

-----Original Message-----
From: Rob Harrop [mailto:rob.harrop at gmail.com]
Sent: 14 July 2011 12:46
To: Mike Hadlow
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] How Should a Messaging Client Handle Errors?

Mike,

The solution you outline in option 2 sounds like the Dead-Letter Exchange support I'm working on at the moment.

Using DLEs, you can declare that a queue routes all dead messages to a specified exchange for later processing. Messages are considered dead when:

* The queue containing the message is deleted
* The queue containing the message is purged
* The queue containing is deleted due to lease expiry
* The message is rejected (basic.reject or basic.nack) with requeue=false
* The TTL for the message expires

Messages are routed to DLEs using their original routing key. If you make the DLE a fanout exchange then you can easily route all dead messages to all queues bound to the DLE.

When this feature is complete, the DLE code will ensure that persistent messages are routed through the DLE before being removed from the source queue - this should give you the guarantee of safety that you are looking for.

Regards,

Rob

Mike Hadlow wrote:
> Hi All,
>
> This is a copy of a blog post I've just written
> <http://mikehadlow.blogspot.com/2011/07/easynetq-how-should-messaging-client.html>.
> I was wondering if anyone on the group had any good suggestions for
> error handling strategies?
>
> EasyNetQ <https://github.com/mikehadlow/EasyNetQ> is my simple .NET
> API for RabbitMQ.
>
> I've started thinking about the best patterns for implementing error
> handling in EasyNetQ. One of the aims of EasyNetQ is to remove as many
> infrastructure concerns from the application developer as possible.
> This means that the API should correctly handle any exceptions that
> bubble up from the application layer.
>
> One of the core requirements is that we shouldn't lose messages when
> the application throws. The question then becomes: where should the
> message, that the application was consuming when it threw, go? There
> seem to be three choices:
>
>    1. Put the failed message back on the queue it was consumed from.
>    2. Put the failed message on an error queue.
>    3. A combination of 1 and 2.
>
> *Option 1*has the benefit that it's the out-of-the-box behaviour of
> AMQP. In the case of EasyNetQ, I would simply catch any exceptions,
> log them, and just send a noAck command back to RabbitMQ. Rabbit would
> put the message at the back of the queue and then resend it when it
> got to the front.
>
> Another advantage of this technique is that it gives competing
> consumers the opportunity to process the message. If you have more
> than one consumer on a queue, Rabbit will send the messages to them in
> turn, so this is out-of-the-box.
>
> The drawback of this method is that there's the possibility of the
> queue filling up with failed messages. The consumer would just be
> cycling around throwing exceptions and any messages that it might be
> able to to consume would be slowed down by having to wait their turn
> amongst a long queue of failed messages.
>
> Another problem is that it's difficult to manually inspect the
> messages and selectively delete or retry them.
>
> *Option 2*is harder to implement. I would have to catch exceptions,
> log them and then write the message to an error queue. I would need to
> write an error queue consumer to store the messages in a database. I
> would then need to provide the user with some way to inspect the
> messages alongside the error that caused them to arrive in the error
> queue so that they could make a ignore/retry decision.
>
> I could also implement some kind of wait-and-retry function on the
> error queue, but that would also add additional complexity.
>
> It has the advantage that the original queue remains clear of failing
> messages. Failed messages and the error condition that caused the
> failure can be inspected together, and failed messages can be manually
> ignored or retried.
>
> With the failed messages sitting in a database, it would also be
> simple to create a mechanism where those messages could be replayed on
> a developer machine to aid in debugging.
>
> *A combination of 1 and 2*. I'm moving towards thinking that a
> combination of 1 & 2 might be the best strategy. When a message fails
> initially, we simply noAck it and it goes back to the queue. AMQP
> provides a Redelivered flag, so when the messages is consumed a second
> time we can be aware that it's a retry. Unfortunately there doesn't
> seem to be a retry count in AMQP, so the best we can do is allow for a
> single retry. This has the benefit that it gives a competing consumer
> a chance to process the message.
>
> After the single retry we fall back to *Option 2*. The message is
> passed to the error queue on the second failure.
>
> I would be very interested in hearing how other people have
> implemented error handling with AMQP/RabbitMQ.
>
> Many thanks
>
> Mike
>
>
> 15below Limited: Company registered in England and Wales No 3945289
> Registered Office: Lyndean House, 43-46 Queens Road, Brighton BN1 3XB,
> United Kingdom
>
> 15below Australia Pty Limited: ABN 25 132 716 379 Level 50, 120
> Collins Street, Melbourne, Victoria 3000, Australia
>
> Please think about the environment before printing this email.
>
> **********************************************************************
> ** This email and any attachments may be confidential and/or legally
> privileged and are solely for the use of the intended recipient. If
> you have received this email in error please contact the sender. Any
> views or opinions expressed within this e-mail are solely those of the
> sender, and do not necessarily represent those of 15below unless
> otherwise specifically stated. Although 15below has taken every
> reasonable precaution to ensure that any attachment to this e-mail has
> been checked for viruses, it is strongly recommended that you carry
> out your own virus check before opening any attachment, as we cannot
> accept liability for any damage sustained as a result of software virus infection.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

 15below Limited: Company registered in England and Wales No 3945289
Registered Office: Lyndean House, 43-46 Queens Road, Brighton BN1 3XB, United Kingdom

15below Australia Pty Limited: ABN 25 132 716 379
Level 50, 120 Collins Street, Melbourne, Victoria 3000, Australia

Please think about the environment before printing this email.

************************************************************************
This email and any attachments may be confidential and/or legally privileged and are solely for the use of the intended recipient.  If you have received this email in error please contact the sender.  Any views or opinions expressed within this e-mail are solely those of the sender, and do not necessarily represent those of 15below unless otherwise specifically stated.  Although 15below has taken every reasonable precaution to ensure that any attachment to this e-mail has been checked for viruses, it is strongly recommended that you carry out your own virus check before opening any attachment, as we cannot accept liability for any damage sustained as a result of software virus infection.

From rob.harrop at gmail.com  Thu Jul 14 13:07:17 2011
From: rob.harrop at gmail.com (Rob Harrop)
Date: Thu, 14 Jul 2011 13:07:17 +0100
Subject: [rabbitmq-discuss] How Should a Messaging Client Handle Errors?
In-Reply-To: <3095E7BFC8C0664E97D71288189F19C6179FC73A55@AUSP01VMBX29.collaborationhost.net>
References: <3095E7BFC8C0664E97D71288189F19C6179FC73A31@AUSP01VMBX29.collaborationhost.net>	<4E1ED6E7.4090304@rabbitmq.com>
	<3095E7BFC8C0664E97D71288189F19C6179FC73A55@AUSP01VMBX29.collaborationhost.net>
Message-ID: <4E1EDBF5.3020402@rabbitmq.com>

Hi Mike,

I can't give you exact timelines other than to say this is what I'm 
working on now, but I'm also working on STOMP too :)

I see your point about reason strings in the nack, but I'm doubtful this 
is something we would add. It feels like a leakage of DLE into the protocol.

With DLE as it stands, you *can* tell that a message was dead-lettered 
because it was nacked, or because its queue was deleted and so on.

Rob

Mike Hadlow wrote:
> Hi Rob,
>
> Your Dead Letter Exchange sounds very interesting, just what I need in fact for option 2 :)
>
> How long before we can expect to see this in RabbitMQ? I'm thinking I'll probably have to implement a client-side DLE for the time being and then change to use your DLE once it's available. But it's great to hear that it's happening.
>
> A very useful feature would be some way of communicating the reason for the basic.reject or basic.nack, such as a stack trace for example. If basic.nack took a reason string that could be added as a header to the message sent to the DLE, it would be very helpful.
>
> Thanks
> Mike
>
> -----Original Message-----
> From: Rob Harrop [mailto:rob.harrop at gmail.com]
> Sent: 14 July 2011 12:46
> To: Mike Hadlow
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] How Should a Messaging Client Handle Errors?
>
> Mike,
>
> The solution you outline in option 2 sounds like the Dead-Letter Exchange support I'm working on at the moment.
>
> Using DLEs, you can declare that a queue routes all dead messages to a specified exchange for later processing. Messages are considered dead when:
>
> * The queue containing the message is deleted
> * The queue containing the message is purged
> * The queue containing is deleted due to lease expiry
> * The message is rejected (basic.reject or basic.nack) with requeue=false
> * The TTL for the message expires
>
> Messages are routed to DLEs using their original routing key. If you make the DLE a fanout exchange then you can easily route all dead messages to all queues bound to the DLE.
>
> When this feature is complete, the DLE code will ensure that persistent messages are routed through the DLE before being removed from the source queue - this should give you the guarantee of safety that you are looking for.
>
> Regards,
>
> Rob
>
> Mike Hadlow wrote:
>> Hi All,
>>
>> This is a copy of a blog post I've just written
>> <http://mikehadlow.blogspot.com/2011/07/easynetq-how-should-messaging-client.html>.
>> I was wondering if anyone on the group had any good suggestions for
>> error handling strategies?
>>
>> EasyNetQ<https://github.com/mikehadlow/EasyNetQ>  is my simple .NET
>> API for RabbitMQ.
>>
>> I've started thinking about the best patterns for implementing error
>> handling in EasyNetQ. One of the aims of EasyNetQ is to remove as many
>> infrastructure concerns from the application developer as possible.
>> This means that the API should correctly handle any exceptions that
>> bubble up from the application layer.
>>
>> One of the core requirements is that we shouldn't lose messages when
>> the application throws. The question then becomes: where should the
>> message, that the application was consuming when it threw, go? There
>> seem to be three choices:
>>
>>     1. Put the failed message back on the queue it was consumed from.
>>     2. Put the failed message on an error queue.
>>     3. A combination of 1 and 2.
>>
>> *Option 1*has the benefit that it's the out-of-the-box behaviour of
>> AMQP. In the case of EasyNetQ, I would simply catch any exceptions,
>> log them, and just send a noAck command back to RabbitMQ. Rabbit would
>> put the message at the back of the queue and then resend it when it
>> got to the front.
>>
>> Another advantage of this technique is that it gives competing
>> consumers the opportunity to process the message. If you have more
>> than one consumer on a queue, Rabbit will send the messages to them in
>> turn, so this is out-of-the-box.
>>
>> The drawback of this method is that there's the possibility of the
>> queue filling up with failed messages. The consumer would just be
>> cycling around throwing exceptions and any messages that it might be
>> able to to consume would be slowed down by having to wait their turn
>> amongst a long queue of failed messages.
>>
>> Another problem is that it's difficult to manually inspect the
>> messages and selectively delete or retry them.
>>
>> *Option 2*is harder to implement. I would have to catch exceptions,
>> log them and then write the message to an error queue. I would need to
>> write an error queue consumer to store the messages in a database. I
>> would then need to provide the user with some way to inspect the
>> messages alongside the error that caused them to arrive in the error
>> queue so that they could make a ignore/retry decision.
>>
>> I could also implement some kind of wait-and-retry function on the
>> error queue, but that would also add additional complexity.
>>
>> It has the advantage that the original queue remains clear of failing
>> messages. Failed messages and the error condition that caused the
>> failure can be inspected together, and failed messages can be manually
>> ignored or retried.
>>
>> With the failed messages sitting in a database, it would also be
>> simple to create a mechanism where those messages could be replayed on
>> a developer machine to aid in debugging.
>>
>> *A combination of 1 and 2*. I'm moving towards thinking that a
>> combination of 1&  2 might be the best strategy. When a message fails
>> initially, we simply noAck it and it goes back to the queue. AMQP
>> provides a Redelivered flag, so when the messages is consumed a second
>> time we can be aware that it's a retry. Unfortunately there doesn't
>> seem to be a retry count in AMQP, so the best we can do is allow for a
>> single retry. This has the benefit that it gives a competing consumer
>> a chance to process the message.
>>
>> After the single retry we fall back to *Option 2*. The message is
>> passed to the error queue on the second failure.
>>
>> I would be very interested in hearing how other people have
>> implemented error handling with AMQP/RabbitMQ.
>>
>> Many thanks
>>
>> Mike
>>
>>
>> 15below Limited: Company registered in England and Wales No 3945289
>> Registered Office: Lyndean House, 43-46 Queens Road, Brighton BN1 3XB,
>> United Kingdom
>>
>> 15below Australia Pty Limited: ABN 25 132 716 379 Level 50, 120
>> Collins Street, Melbourne, Victoria 3000, Australia
>>
>> Please think about the environment before printing this email.
>>
>> **********************************************************************
>> ** This email and any attachments may be confidential and/or legally
>> privileged and are solely for the use of the intended recipient. If
>> you have received this email in error please contact the sender. Any
>> views or opinions expressed within this e-mail are solely those of the
>> sender, and do not necessarily represent those of 15below unless
>> otherwise specifically stated. Although 15below has taken every
>> reasonable precaution to ensure that any attachment to this e-mail has
>> been checked for viruses, it is strongly recommended that you carry
>> out your own virus check before opening any attachment, as we cannot
>> accept liability for any damage sustained as a result of software virus infection.
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>   15below Limited: Company registered in England and Wales No 3945289
> Registered Office: Lyndean House, 43-46 Queens Road, Brighton BN1 3XB, United Kingdom
>
> 15below Australia Pty Limited: ABN 25 132 716 379
> Level 50, 120 Collins Street, Melbourne, Victoria 3000, Australia
>
> Please think about the environment before printing this email.
>
> ************************************************************************
> This email and any attachments may be confidential and/or legally privileged and are solely for the use of the intended recipient.  If you have received this email in error please contact the sender.  Any views or opinions expressed within this e-mail are solely those of the sender, and do not necessarily represent those of 15below unless otherwise specifically stated.  Although 15below has taken every reasonable precaution to ensure that any attachment to this e-mail has been checked for viruses, it is strongly recommended that you carry out your own virus check before opening any attachment, as we cannot accept liability for any damage sustained as a result of software virus infection.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simon at rabbitmq.com  Thu Jul 14 13:15:56 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 14 Jul 2011 13:15:56 +0100
Subject: [rabbitmq-discuss] Unable to connect multiple consumers to a
 queue bound to fanned out exchange
In-Reply-To: <32058027.post@talk.nabble.com>
References: <32058027.post@talk.nabble.com>
Message-ID: <4E1EDDFC.5070508@rabbitmq.com>

On 14/07/11 01:11, Mitra77 wrote:
> I get the following message:
> "Queue message_queue1 has an exclusive consumer. No more consumers allowed."

RabbitMQ never returns that exact error message. QPid does though. Are 
you sure you're using RabbitMQ?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Jul 14 13:28:35 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 14 Jul 2011 13:28:35 +0100
Subject: [rabbitmq-discuss] Unable to connect multiple consumers to a
 queue bound to fanned out exchange
In-Reply-To: <4E1EDDFC.5070508@rabbitmq.com>
References: <32058027.post@talk.nabble.com> <4E1EDDFC.5070508@rabbitmq.com>
Message-ID: <4E1EE0F3.5030501@rabbitmq.com>

On 14/07/11 13:15, Simon MacMullen wrote:
> On 14/07/11 01:11, Mitra77 wrote:
>> I get the following message:
>> "Queue message_queue1 has an exclusive consumer. No more consumers
>> allowed."
>
> RabbitMQ never returns that exact error message. QPid does though. Are
> you sure you're using RabbitMQ?

On 14/07/11 01:12, Mitra77 wrote:
 > I am using QPID, but I figured if this is doable in RabbitMQ, then it 
should
 > be possible in QPID too.
 > Am I missing something here?

Oops, missed that bit. Both QPid and RabbitMQ have the concept of an 
"exclusive" consumer - a consumer which won't let anything else share 
the queue it's consuming from. Somehow you're inadvertently creating 
one; it sounds like you don't want to.

Unfortunately I'm no expert on the JMS API (understatement); it's not 
obvious how you might create a non-exclusive consumer (I would have 
expected that would be the default, but hey...)

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From tonygarnockjones+rabbitmq at gmail.com  Thu Jul 14 14:14:18 2011
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Thu, 14 Jul 2011 09:14:18 -0400
Subject: [rabbitmq-discuss] How Should a Messaging Client Handle Errors?
In-Reply-To: <4E1EDBF5.3020402@rabbitmq.com>
References: <3095E7BFC8C0664E97D71288189F19C6179FC73A31@AUSP01VMBX29.collaborationhost.net>
	<4E1ED6E7.4090304@rabbitmq.com>
	<3095E7BFC8C0664E97D71288189F19C6179FC73A55@AUSP01VMBX29.collaborationhost.net>
	<4E1EDBF5.3020402@rabbitmq.com>
Message-ID: <CAM8fPiTPVBsdmq3KatWY6quLn48_qiA9e0dysr2g4pvgAfzjjQ@mail.gmail.com>

On 14 July 2011 08:07, Rob Harrop <rob.harrop at gmail.com> wrote:

> With DLE as it stands, you *can* tell that a message was dead-lettered
> because it was nacked, or because its queue was deleted and so on.


How is this represented? (i.e. how does a program tell, concretely?)

Regards,
  Tony
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110714/3e6f4ddb/attachment.htm>

From matthew at rabbitmq.com  Thu Jul 14 14:51:48 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 14 Jul 2011 14:51:48 +0100
Subject: [rabbitmq-discuss] RabbitMQ HA
In-Reply-To: <4E1C7C3A.3090600@kno.com>
References: <4E1C7C3A.3090600@kno.com>
Message-ID: <20110714135146.GC29337@rabbitmq.com>

Hi Lucian-Paul,

On Tue, Jul 12, 2011 at 07:54:18PM +0300, Lucian-Paul Torje wrote:
> I'm trying to configure rabbit mq with HA but starting/stopping ($
> /usr/sbin/crm_resource --meta -t primitive -r res_rabbitmq-server_1
> -p target-role -v started) the rabbit mq ogc has no effect, rabbit
> mq is not started/stopped, there is nothing on /var/log/rabbitmq,
> just like the rabbitmq didn't received the command - please advice.

What about the syslog? pacemaker is normally very noisy about what it's
doing and puts lots of entries into syslog.

> I've added an exit 0 line in /etc/init.d/rabbitmq-server just as
> described in http://www.rabbitmq.com/pacemaker.html

Ok, and you've checked that rabbit isn't actually running before you
start up pacemaker / corosync?


> Here is my configuration  (I'm using a mounted shared folder and
> already tested starting manually rabbitmq with that mnesia folder -
> /mnt/rabbit_mnesia and it works):
> 
> node ha-node1
> node ha-node2
> primitive res_rabbitmq-server_1 ocf:rabbitmq:rabbitmq-server \
>     params ip="10.41.0.158" port="5672"
> config_file="/etc/rabbitmq/rabbitmq"
> mnesia_base="/mnt/rabbit_mnesia" \
>     operations $id="res_rabbitmq-server_1-operations" \
>     op start interval="0" timeout="600" \
>     op stop interval="0" timeout="120" \
>     op monitor interval="10" timeout="20" start-delay="0" \
>     meta target-role="started" allow-migrate="true"
> ms ms_rabbitmq-server_1 res_rabbitmq-server_1 \
>     meta clone-max="2" notify="true"
> property $id="cib-bootstrap-options" \
>     expected-quorum-votes="2" \
>     dc-version="1.0.8-042548a451fce8400660f6031f4da6f0223dd5dd" \
>     cluster-infrastructure="openais" \
>     last-lrm-refresh="1310489170"

Here's mine:

virt-debian-4:~# crm configure show
node virt-debian-3
node virt-debian-4
primitive bunny ocf:rabbitmq:rabbitmq-server \
        params mnesia_base="/media/drbd1" ip="192.168.122.100" log_base="/media/drbd1/rabbitmq_logs" config_file="/etc/rabbitmq/rabbitmq" \
        meta target-role="Started" is-managed="true"
primitive drbd ocf:linbit:drbd \
        params drbd_resource="r0" \
        op monitor interval="60s"
primitive drbd_fs ocf:heartbeat:Filesystem \
        params device="/dev/drbd1" directory="/media/drbd1" fstype="ext3"
primitive ip ocf:heartbeat:IPaddr2 \
        params ip="192.168.122.100" cidr_netmask="24"
ms drbd_ms drbd \
        meta master-max="1" master-node-max="1" clone-max="2" clone-node-max="1" notify="true" target-role="Started"
colocation bunny_on_fs inf: bunny drbd_fs
colocation bunny_on_ip inf: bunny ip
colocation fs_on_drbd inf: drbd_fs drbd_ms:Master
order bunny_after_fs inf: drbd_fs bunny
order bunny_after_ip inf: ip bunny
order fs_after_drbd inf: drbd_ms:promote drbd_fs:start
property $id="cib-bootstrap-options" \
        dc-version="1.0.9-74392a28b7f31d7ddc86689598bd23114f58978b" \
        cluster-infrastructure="openais" \
        expected-quorum-votes="2" \
        stonith-enabled="false" \
        no-quorum-policy="ignore" \
        resource-stickiness="100" \
        last-lrm-refresh="1310651109"
rsc_defaults $id="rsc-options" \
        resource-stickiness="100"

Differences that appear possibly relevant to me are:

is-managed

I've turned off the no-quorum-policy - if you're doing this with a
cluster of just 2, and you've got one down then it'll never do anything
because it won't be able to reach quorate.

resource-stickiness - this shouldn't affect things starting, but it's
useful to have it set.

stonith-enabled - I have a feeling you may have to set that unless you
actually have STONITH devices lying around.

It should work - the above config works fine for me. I'm afraid you may
just have to dig around the syslogs to try and figure out what the
problem is that is stopping pacemaker from starting up your rabbit.

Matthew

From matthew at rabbitmq.com  Thu Jul 14 14:59:51 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 14 Jul 2011 14:59:51 +0100
Subject: [rabbitmq-discuss] RabbitMQ OCF script not started
In-Reply-To: <4E1CB692.6090406@kno.com>
References: <4E1CB692.6090406@kno.com>
Message-ID: <20110714135951.GD29337@rabbitmq.com>

Hi Lucian-Paul,

On Wed, Jul 13, 2011 at 12:03:14AM +0300, Lucian-Paul Torje wrote:
> I have a strange behaviour - although the resource
> /usr/lib/ocf/resource.d/rabbitmq/rabbitmq-server exits and I've
> modified it's script is seems that pacemaker does no start the
> script at all (I've made it log some values in case it is started).
> Do you have any idea why?

As I said in my other email, I'd recommend trawling through the syslog
output (assuming it's there - there may be switches in corosync or
pacemaker config that'll up the log level) to understand what and why
pacemaker is doing.

Matthew

From alexis at rabbitmq.com  Thu Jul 14 15:39:04 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Thu, 14 Jul 2011 15:39:04 +0100
Subject: [rabbitmq-discuss] Distributed queue setup
In-Reply-To: <CAG7cANQYaq5ODOrPjvJ=AtWLrXngwxN6k1kKwhug5_oOJLisMg@mail.gmail.com>
References: <CAG7cANQYaq5ODOrPjvJ=AtWLrXngwxN6k1kKwhug5_oOJLisMg@mail.gmail.com>
Message-ID: <CACOPnvdMG9fAK3irmaVahWdpgfkoq_Ge6+1O1WDXTO1QsB4frg@mail.gmail.com>

Greg

Did you resolve this?

alexis

On Tue, Jul 5, 2011 at 6:10 PM, Meredith Gregory
<lgreg.meredith at gmail.com> wrote:
> Dear Rabbitters,
> We've got a situation -- it must be quite common -- where, in the simplest
> case, we have two application nodes, call them A and B. RabbitMQ server is
> running on the machines for both A and B. The B node has established it's
> connection to exchange and queue, but does not know whether A has. In the
> case that A has, all is well in the world. When B sends a message to A over
> RabbitMQ, A happily processes it and returns a response message. However, if
> A has not established it's connection to exchange and queue, then if B has
> sent a message to A on this exchange and queue, then when A establishes it's
> connection -- not only does it not see the pending message, the next message
> B sends causes a Java exception to be thrown (see below).?Now, we can
> arrange a bit of a handshake to work around this, and have done so. However,
> we'd like to know if there's a better or Rabbitier way of doing this.
> Best wishes,
> --greg
>
> com.rabbitmq.client.AlreadyClosedException: clean connection shutdown;
> reason: Attempt to use closed channelscala>
>         at
> com.rabbitmq.client.impl.AMQChannel.ensureIsOpen(AMQChannel.java:181)
>         at com.rabbitmq.client.impl.AMQChannel.transmit(AMQChannel.java:276)
>         at com.rabbitmq.client.impl.ChannelN.basicPublish(ChannelN.java:521)
>         at com.rabbitmq.client.impl.ChannelN.basicPublish(ChannelN.java:507)
>         at net.liftweb.amqp.AMQPSender.send(AMQPSender.scala:25)
>         at
> net.liftweb.amqp.AMQPSender$$anonfun$loop$1.apply(AMQPSender.scala:32)
>         at
> net.liftweb.amqp.AMQPSender$$anonfun$loop$1.apply(AMQPSender.scala:31)
>         at scala.actors.ReactorTask.run(ReactorTask.scala:31)
>         at scala.actors.Reactor$class.resumeReceiver(Reactor.scala:129)
>         at
> net.liftweb.amqp.AMQPSender.scala$actors$ReplyReactor$$super$resumeReceiver(AMQPSender.scala:15)
>         at
> scala.actors.ReplyReactor$class.resumeReceiver(ReplyReactor.scala:68)
>         at net.liftweb.amqp.AMQPSender.resumeReceiver(AMQPSender.scala:15)
>         at scala.actors.Actor$class.searchMailbox(Actor.scala:500)
>         at net.liftweb.amqp.AMQPSender.searchMailbox(AMQPSender.scala:15)
>         at
> scala.actors.Reactor$$anonfun$startSearch$1$$anonfun$apply$mcV$sp$1.apply$mcV$sp(Reactor.scala:117)
>         at
> scala.actors.Reactor$$anonfun$startSearch$1$$anonfun$apply$mcV$sp$1.apply(Reactor.scala:114)
>         at
> scala.actors.Reactor$$anonfun$startSearch$1$$anonfun$apply$mcV$sp$1.apply(Reactor.scala:114)
>         at scala.actors.ReactorTask.run(ReactorTask.scala:33)
>         at
> scala.concurrent.forkjoin.ForkJoinPool$AdaptedRunnable.exec(ForkJoinPool.java:611)
>         at
> scala.concurrent.forkjoin.ForkJoinTask.quietlyExec(ForkJoinTask.java:422)
>         at
> scala.concurrent.forkjoin.ForkJoinWorkerThread.mainLoop(ForkJoinWorkerThread.java:340)
>         at
> scala.concurrent.forkjoin.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:325)
>
>
> --
> L.G. Meredith
> Managing Partner
> Biosimilarity LLC
> 7329 39th Ave SW
> Seattle, WA 98136
>
> +1 206.650.3740
>
> http://biosimilarity.blogspot.com
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From rob at rabbitmq.com  Thu Jul 14 19:33:19 2011
From: rob at rabbitmq.com (Rob Harrop)
Date: Thu, 14 Jul 2011 19:33:19 +0100
Subject: [rabbitmq-discuss] How Should a Messaging Client Handle Errors?
In-Reply-To: <CAM8fPiTPVBsdmq3KatWY6quLn48_qiA9e0dysr2g4pvgAfzjjQ@mail.gmail.com>
References: <3095E7BFC8C0664E97D71288189F19C6179FC73A31@AUSP01VMBX29.collaborationhost.net>
	<4E1ED6E7.4090304@rabbitmq.com>
	<3095E7BFC8C0664E97D71288189F19C6179FC73A55@AUSP01VMBX29.collaborationhost.net>
	<4E1EDBF5.3020402@rabbitmq.com>
	<CAM8fPiTPVBsdmq3KatWY6quLn48_qiA9e0dysr2g4pvgAfzjjQ@mail.gmail.com>
Message-ID: <85736D04-D445-4362-A442-27BD51BCFC2C@rabbitmq.com>

The reason is included in the message properties during the publish to the DLE.



On 14 Jul 2011, at 14:14, Tony Garnock-Jones <tonygarnockjones+rabbitmq at gmail.com> wrote:

> On 14 July 2011 08:07, Rob Harrop <rob.harrop at gmail.com> wrote:
> With DLE as it stands, you *can* tell that a message was dead-lettered because it was nacked, or because its queue was deleted and so on.
> 
> How is this represented? (i.e. how does a program tell, concretely?)
> 
> Regards,
>   Tony
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110714/cb73fdc2/attachment.htm>

From udaymitra4u at gmail.com  Thu Jul 14 20:19:25 2011
From: udaymitra4u at gmail.com (Uday Mitra)
Date: Thu, 14 Jul 2011 12:19:25 -0700
Subject: [rabbitmq-discuss] Unable to connect multiple consumers to a
 queue bound to fanned out exchange
In-Reply-To: <4E1EE0F3.5030501@rabbitmq.com>
References: <32058027.post@talk.nabble.com> <4E1EDDFC.5070508@rabbitmq.com>
	<4E1EE0F3.5030501@rabbitmq.com>
Message-ID: <CAKGgVGv9ijupCz-cm=wY464hdF8fi8kKAd7V322LMjvtYrVPNA@mail.gmail.com>

JMX API allows me to create a consumer from session using
session.createConsumer().
I looked at QPID's implementation for session (AMQSession.java), and here is
what I found:

public MessageConsumer createConsumer(Destination destination) throws
JMSException
    {
        checkValidDestination(destination);

        return createConsumerImpl(destination, _prefetchHighMark,
_prefetchLowMark, false, (destination instanceof Topic), null, null,
                                  ((destination instanceof AMQDestination)
&& ((AMQDestination)destination).isBrowseOnly()), false);
    }


protected C createConsumerImpl(final Destination destination, final int
prefetchHigh,
                                                 final int prefetchLow,
final boolean noLocal, final boolean exclusive, String selector, final
FieldTable rawSelector,
                                                 final boolean noConsume,
final boolean autoClose) throws JMSException
    {
......
}

When I use the properties for queue1, its creating an object of type
AMQAnyDestination.java which implements Topic. So, (destination instanceof
Topic) => true. And this will set the consumer as exclusive.

I wonder if the AMQP design is such that fanout is considered an exchange
and so we cannot share the queue?


On Thu, Jul 14, 2011 at 5:28 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 14/07/11 13:15, Simon MacMullen wrote:
>
>> On 14/07/11 01:11, Mitra77 wrote:
>>
>>> I get the following message:
>>> "Queue message_queue1 has an exclusive consumer. No more consumers
>>> allowed."
>>>
>>
>> RabbitMQ never returns that exact error message. QPid does though. Are
>> you sure you're using RabbitMQ?
>>
>
> On 14/07/11 01:12, Mitra77 wrote:
> > I am using QPID, but I figured if this is doable in RabbitMQ, then it
> should
> > be possible in QPID too.
> > Am I missing something here?
>
> Oops, missed that bit. Both QPid and RabbitMQ have the concept of an
> "exclusive" consumer - a consumer which won't let anything else share the
> queue it's consuming from. Somehow you're inadvertently creating one; it
> sounds like you don't want to.
>
> Unfortunately I'm no expert on the JMS API (understatement); it's not
> obvious how you might create a non-exclusive consumer (I would have expected
> that would be the default, but hey...)
>
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110714/394418e6/attachment.htm>

From fredrik.bjork at gmail.com  Thu Jul 14 23:52:29 2011
From: fredrik.bjork at gmail.com (fbjork)
Date: Thu, 14 Jul 2011 15:52:29 -0700 (PDT)
Subject: [rabbitmq-discuss] error: {amqp_error, precondition_failed,
	"unknown delivery tag 29", 'basic.ack'}
Message-ID: <723a14e3-4571-46bf-b8b3-104d83bfd3c1@j14g2000prn.googlegroups.com>

When we push our Ruby app to production, after processing a few
messages we get this in the RabbitMQ (2.4.1) error log:

=ERROR REPORT==== 14-Jul-2011::22:31:30 ===
connection <0.29022.1855>, channel 1 - error:
{amqp_error,precondition_failed,"unknown delivery tag 29",'basic.ack'}


Any idea what it means who to fix it?

From alexandru at rabbitmq.com  Fri Jul 15 09:34:44 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Fri, 15 Jul 2011 09:34:44 +0100
Subject: [rabbitmq-discuss] error: {amqp_error, precondition_failed,
 "unknown delivery tag 29", 'basic.ack'}
In-Reply-To: <723a14e3-4571-46bf-b8b3-104d83bfd3c1@j14g2000prn.googlegroups.com>
References: <723a14e3-4571-46bf-b8b3-104d83bfd3c1@j14g2000prn.googlegroups.com>
Message-ID: <20110715083444.GA3124@dakota.eng.vmware.com>

Hi,

That error usually happens when you ack the same message twice.  Could
you be doing that somehow?

Cheers,
Alex

On Thu, Jul 14, 2011 at 03:52:29PM -0700, fbjork wrote:
> When we push our Ruby app to production, after processing a few
> messages we get this in the RabbitMQ (2.4.1) error log:
> 
> =ERROR REPORT==== 14-Jul-2011::22:31:30 ===
> connection <0.29022.1855>, channel 1 - error:
> {amqp_error,precondition_failed,"unknown delivery tag 29",'basic.ack'}
> 
> 
> Any idea what it means who to fix it?
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From emile at rabbitmq.com  Fri Jul 15 10:27:20 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 15 Jul 2011 10:27:20 +0100
Subject: [rabbitmq-discuss] Fwd: a few json rpc questions
In-Reply-To: <CAJ2-VrmdAo6B0K-QmjAC6nW4cxGDd=OQUBaxiCVhttWimKYVVw@mail.gmail.com>
References: <CAJ2-VrkDARuoP-iJgEiwagh_44WgiAhhizEbfTNj9YYyJPCMeQ@mail.gmail.com>	<4E1AD7DB.2090702@rabbitmq.com>	<CAJ2-Vrk2EqzWXBkFC2zOHYxN8hCNYsqB24sokkoJcJfE5rOmDA@mail.gmail.com>	<CAJ2-Vrk7aTeSnS+szosSB=-Ak-iSo+iVHeKYmoeqJOEvdBpJoA@mail.gmail.com>	<4E1DAA62.8060909@rabbitmq.com>	<CAJ2-VrmZREaxrtukWdkBX6bPEODCSNBb99h8SNqj-xUMRFHosw@mail.gmail.com>	<4E1DB16C.5070906@rabbitmq.com>
	<CAJ2-VrmdAo6B0K-QmjAC6nW4cxGDd=OQUBaxiCVhttWimKYVVw@mail.gmail.com>
Message-ID: <4E2007F8.8030807@rabbitmq.com>

Hi,

On 14/07/11 07:35, mysurf mail wrote:
> Hi, 

> Can all the clients be configurated with the same queuename ("") and the
> same routing key (the same for all)? 

There are two queues required for an RPC call over AMQP. The first is
the work queue for the service. The request published by the RPC client
needs to end up in this queue and be consumed by the RPC server. The
second is the callback queue. This is declared by the RPC client and
receives the reply from the RPC server.

When multiple RPC clients are making use of the same RPC service then
they should all use the same routing key so that all requests for that
service go to the same work queue. This is called RPC_QUEUE_NAME in the
relevant Java tutorial:

http://www.rabbitmq.com/tutorials/tutorial-six-java.html

When you make use of RpcClient in the Java client (see

http://hg.rabbitmq.com/rabbitmq-java-client/file/default/src/com/rabbitmq/client/RpcClient.java
)

you will see each client declares its own callback queue, so these are
not shared. If a queue is declared with an empty name then the server
assigns a random name. (See the "Temporary Queues" explanation in the
3rd tutorial.) So even if it looks like all the clients are declaring
the same queue named "", they are all using different callback queues.
This is the recommended approach.


-Emile

From news.anand11 at gmail.com  Fri Jul 15 14:09:56 2011
From: news.anand11 at gmail.com (News Aanad)
Date: Fri, 15 Jul 2011 06:09:56 -0700 (PDT)
Subject: [rabbitmq-discuss] 15000 msg/sec
Message-ID: <cca8b833-4263-4b7d-b03e-cf6c0c1acc83@g5g2000prn.googlegroups.com>

Hi, I wanted to achieve the goal of 15000 msg/sec in RabbitMQ. I have
tried a lot in java as well as in ruby. And right now implementing
node.js .
I want to prefer java because after lots of experimentation the only
java has given me good result but still goal is not achieved.
So i want help to know how to reach upto 15000 msg/sec in RabbitMQ
using java. If any good suggestion  is there please tell me or if any
site to prefer then please tell me.

Thanks.

From ekirpichov at gmail.com  Fri Jul 15 14:17:44 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Fri, 15 Jul 2011 17:17:44 +0400
Subject: [rabbitmq-discuss] 15000 msg/sec
In-Reply-To: <cca8b833-4263-4b7d-b03e-cf6c0c1acc83@g5g2000prn.googlegroups.com>
References: <cca8b833-4263-4b7d-b03e-cf6c0c1acc83@g5g2000prn.googlegroups.com>
Message-ID: <CANVKUrU=5TuhGmMD+94E-yEp6ctGDFXGwxLpL92vg+Vtc=MmAQ@mail.gmail.com>

Hi.

What's the size of messages?
What's your messaging scenario in general? Persistence, prefetch, transactions?

2011/7/15 News Aanad <news.anand11 at gmail.com>:
> Hi, I wanted to achieve the goal of 15000 msg/sec in RabbitMQ. I have
> tried a lot in java as well as in ruby. And right now implementing
> node.js .
> I want to prefer java because after lots of experimentation the only
> java has given me good result but still goal is not achieved.
> So i want help to know how to reach upto 15000 msg/sec in RabbitMQ
> using java. If any good suggestion ?is there please tell me or if any
> site to prefer then please tell me.
>
> Thanks.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/

From michael.s.klishin at gmail.com  Fri Jul 15 14:21:24 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 15 Jul 2011 17:21:24 +0400
Subject: [rabbitmq-discuss] 15000 msg/sec
In-Reply-To: <CANVKUrU=5TuhGmMD+94E-yEp6ctGDFXGwxLpL92vg+Vtc=MmAQ@mail.gmail.com>
References: <cca8b833-4263-4b7d-b03e-cf6c0c1acc83@g5g2000prn.googlegroups.com>
	<CANVKUrU=5TuhGmMD+94E-yEp6ctGDFXGwxLpL92vg+Vtc=MmAQ@mail.gmail.com>
Message-ID: <CAE3HoVQp6e9qSf9XySkm8_sHQWdGYNG9DvmFFRoPgH=x1xQB1Q@mail.gmail.com>

2011/7/15 Eugene Kirpichov <ekirpichov at gmail.com>

> What's the size of messages?
> What's your messaging scenario in general? Persistence, prefetch,
> transactions?
>

And is it end-to-end messages or publisher-to-broker?

-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110715/4960655a/attachment.htm>

From ekirpichov at gmail.com  Fri Jul 15 14:23:20 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Fri, 15 Jul 2011 17:23:20 +0400
Subject: [rabbitmq-discuss] 15000 msg/sec
In-Reply-To: <CAL9wd7cx9ppeJ3GErjBuwSFHXiF8JRdHHvapRH4pdhOUnn3b-A@mail.gmail.com>
References: <cca8b833-4263-4b7d-b03e-cf6c0c1acc83@g5g2000prn.googlegroups.com>
	<CANVKUrU=5TuhGmMD+94E-yEp6ctGDFXGwxLpL92vg+Vtc=MmAQ@mail.gmail.com>
	<CAL9wd7cx9ppeJ3GErjBuwSFHXiF8JRdHHvapRH4pdhOUnn3b-A@mail.gmail.com>
Message-ID: <CANVKUrWK6ZDimx4bFjLEszGzvy10vomY3ypf5Xg55orwREgXCQ@mail.gmail.com>

I guess you should get the speed you want, and much more, if you just
set up a high enough value for prefetch (see basic.qos) and set
autoack.
I got ~8k msg/s with much larger messages and persistence turned on too.

2011/7/15 News Aanad <news.anand11 at gmail.com>:
>
> Message size is 199 bytes
> Messaging scenario is Persistence
>
> On Fri, Jul 15, 2011 at 6:47 PM, Eugene Kirpichov <ekirpichov at gmail.com>
> wrote:
>>
>> Hi.
>>
>> What's the size of messages?
>
>> What's your messaging scenario in general? Persistence, prefetch,
>> transactions?
>
>>
>> 2011/7/15 News Aanad <news.anand11 at gmail.com>:
>> > Hi, I wanted to achieve the goal of 15000 msg/sec in RabbitMQ. I have
>> > tried a lot in java as well as in ruby. And right now implementing
>> > node.js .
>> > I want to prefer java because after lots of experimentation the only
>> > java has given me good result but still goal is not achieved.
>> > So i want help to know how to reach upto 15000 msg/sec in RabbitMQ
>> > using java. If any good suggestion ?is there please tell me or if any
>> > site to prefer then please tell me.
>> >
>> > Thanks.
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >
>>
>>
>>
>> --
>> Eugene Kirpichov
>> Principal Engineer, Mirantis Inc. http://www.mirantis.com/
>> Editor, http://fprog.ru/
>
>



-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/

From ekirpichov at gmail.com  Fri Jul 15 14:26:31 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Fri, 15 Jul 2011 17:26:31 +0400
Subject: [rabbitmq-discuss] 15000 msg/sec
In-Reply-To: <CAL9wd7cmB+Z6TcY0QWbD2aG3Z_GvHUtGvx6hyKpeid8of-boUA@mail.gmail.com>
References: <cca8b833-4263-4b7d-b03e-cf6c0c1acc83@g5g2000prn.googlegroups.com>
	<CANVKUrU=5TuhGmMD+94E-yEp6ctGDFXGwxLpL92vg+Vtc=MmAQ@mail.gmail.com>
	<CAL9wd7cx9ppeJ3GErjBuwSFHXiF8JRdHHvapRH4pdhOUnn3b-A@mail.gmail.com>
	<CANVKUrWK6ZDimx4bFjLEszGzvy10vomY3ypf5Xg55orwREgXCQ@mail.gmail.com>
	<CAL9wd7cmB+Z6TcY0QWbD2aG3Z_GvHUtGvx6hyKpeid8of-boUA@mail.gmail.com>
Message-ID: <CANVKUrUpjtid78j=1ZdXJB946irJBHquGDf_UBWKO_hCxKh75g@mail.gmail.com>

Please show the source code of all participating components. It's
impossible to say anything definite without it.

2011/7/15 News Aanad <news.anand11 at gmail.com>:
>
> Till now i am getting the result of 5000 msg/sec in java.
>
> On Fri, Jul 15, 2011 at 6:53 PM, Eugene Kirpichov <ekirpichov at gmail.com>
> wrote:
>>
>> I guess you should get the speed you want, and much more, if you just
>> set up a high enough value for prefetch (see basic.qos) and set
>> autoack.
>> I got ~8k msg/s with much larger messages and persistence turned on too.
>>
>> 2011/7/15 News Aanad <news.anand11 at gmail.com>:
>> >
>> > Message size is 199 bytes
>> > Messaging scenario is Persistence
>> >
>> > On Fri, Jul 15, 2011 at 6:47 PM, Eugene Kirpichov <ekirpichov at gmail.com>
>> > wrote:
>> >>
>> >> Hi.
>> >>
>> >> What's the size of messages?
>> >
>> >> What's your messaging scenario in general? Persistence, prefetch,
>> >> transactions?
>> >
>> >>
>> >> 2011/7/15 News Aanad <news.anand11 at gmail.com>:
>> >> > Hi, I wanted to achieve the goal of 15000 msg/sec in RabbitMQ. I have
>> >> > tried a lot in java as well as in ruby. And right now implementing
>> >> > node.js .
>> >> > I want to prefer java because after lots of experimentation the only
>> >> > java has given me good result but still goal is not achieved.
>> >> > So i want help to know how to reach upto 15000 msg/sec in RabbitMQ
>> >> > using java. If any good suggestion ?is there please tell me or if any
>> >> > site to prefer then please tell me.
>> >> >
>> >> > Thanks.
>> >> > _______________________________________________
>> >> > rabbitmq-discuss mailing list
>> >> > rabbitmq-discuss at lists.rabbitmq.com
>> >> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >> >
>> >>
>> >>
>> >>
>> >> --
>> >> Eugene Kirpichov
>> >> Principal Engineer, Mirantis Inc. http://www.mirantis.com/
>> >> Editor, http://fprog.ru/
>> >
>> >
>>
>>
>>
>> --
>> Eugene Kirpichov
>> Principal Engineer, Mirantis Inc. http://www.mirantis.com/
>> Editor, http://fprog.ru/
>
>



-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/

From matthew at rabbitmq.com  Fri Jul 15 14:35:24 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 15 Jul 2011 14:35:24 +0100
Subject: [rabbitmq-discuss] 15000 msg/sec
In-Reply-To: <CANVKUrUpjtid78j=1ZdXJB946irJBHquGDf_UBWKO_hCxKh75g@mail.gmail.com>
References: <cca8b833-4263-4b7d-b03e-cf6c0c1acc83@g5g2000prn.googlegroups.com>
	<CANVKUrU=5TuhGmMD+94E-yEp6ctGDFXGwxLpL92vg+Vtc=MmAQ@mail.gmail.com>
	<CAL9wd7cx9ppeJ3GErjBuwSFHXiF8JRdHHvapRH4pdhOUnn3b-A@mail.gmail.com>
	<CANVKUrWK6ZDimx4bFjLEszGzvy10vomY3ypf5Xg55orwREgXCQ@mail.gmail.com>
	<CAL9wd7cmB+Z6TcY0QWbD2aG3Z_GvHUtGvx6hyKpeid8of-boUA@mail.gmail.com>
	<CANVKUrUpjtid78j=1ZdXJB946irJBHquGDf_UBWKO_hCxKh75g@mail.gmail.com>
Message-ID: <20110715133524.GB13345@rabbitmq.com>

On Fri, Jul 15, 2011 at 05:26:31PM +0400, Eugene Kirpichov wrote:
> Please show the source code of all participating components. It's
> impossible to say anything definite without it.

You already have the source - see MulticastMain in our Java client.

On my desktop here:

matthew at hazel:~/work/rabbit/rabbitmq-umbrella/rabbitmq-java-client$ sh ./build/dist/runjava.sh com/rabbitmq/examples/MulticastMain -a -r 23000 -z 30 -i 5
starting consumer #0
starting producer #0
recving rate: 22413 msg/s, min/avg/max latency: 173/94617/305179 microseconds
sending rate: 22992 msg/s
recving rate: 23115 msg/s, min/avg/max latency: 148/36310/123523 microseconds
sending rate: 22996 msg/s
recving rate: 22819 msg/s, min/avg/max latency: 171/48192/153662 microseconds
sending rate: 23000 msg/s
recving rate: 23182 msg/s, min/avg/max latency: 152/13728/45222 microseconds
sending rate: 22998 msg/s
recving rate: 22902 msg/s, min/avg/max latency: 178/23257/65176 microseconds
sending rate: 22996 msg/s
recving rate: 23040 msg/s, min/avg/max latency: 167/16047/56063 microseconds
recving rate avg: 22985 msg/s
sending rate avg: 22997 msg/s

And that's both 23kHz in and 23kHz out at the same time. The only caveat
there is that it's using noAck on the consumer.

And with acks back on, it's a little slower but still able to meet your
needs:

matthew at hazel:~/work/rabbit/rabbitmq-umbrella/rabbitmq-java-client$ sh ./build/dist/runjava.sh com/rabbitmq/examples/MulticastMain -r 17000 -z 30 -i 5
starting consumer #0
starting producer #0
recving rate: 16258 msg/s, min/avg/max latency: 340/171686/285537 microseconds
sending rate: 17000 msg/s
recving rate: 17396 msg/s, min/avg/max latency: 170/22980/139531 microseconds
sending rate: 17000 msg/s
recving rate: 16980 msg/s, min/avg/max latency: 169/3099/14077 microseconds
sending rate: 16999 msg/s
recving rate: 17026 msg/s, min/avg/max latency: 168/1734/20361 microseconds
sending rate: 17000 msg/s
recving rate: 17000 msg/s, min/avg/max latency: 174/1863/17528 microseconds
sending rate: 17000 msg/s
recving rate: 17001 msg/s, min/avg/max latency: 173/1704/12944 microseconds
recving rate avg: 16995 msg/s
sending rate avg: 16999 msg/s


Matthew

From ekirpichov at gmail.com  Fri Jul 15 14:36:09 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Fri, 15 Jul 2011 17:36:09 +0400
Subject: [rabbitmq-discuss] 15000 msg/sec
In-Reply-To: <CAL9wd7epatwRF=ioUkik22NN3b6p+7+UEBeqzn50-YNOkJHMvQ@mail.gmail.com>
References: <cca8b833-4263-4b7d-b03e-cf6c0c1acc83@g5g2000prn.googlegroups.com>
	<CANVKUrU=5TuhGmMD+94E-yEp6ctGDFXGwxLpL92vg+Vtc=MmAQ@mail.gmail.com>
	<CAL9wd7cx9ppeJ3GErjBuwSFHXiF8JRdHHvapRH4pdhOUnn3b-A@mail.gmail.com>
	<CANVKUrWK6ZDimx4bFjLEszGzvy10vomY3ypf5Xg55orwREgXCQ@mail.gmail.com>
	<CAL9wd7cmB+Z6TcY0QWbD2aG3Z_GvHUtGvx6hyKpeid8of-boUA@mail.gmail.com>
	<CANVKUrUpjtid78j=1ZdXJB946irJBHquGDf_UBWKO_hCxKh75g@mail.gmail.com>
	<CAL9wd7epatwRF=ioUkik22NN3b6p+7+UEBeqzn50-YNOkJHMvQ@mail.gmail.com>
Message-ID: <CANVKUrXLPceXpR2DQ_r_=vYvJWmKq5=y-4xkYACKai+9fLYc=A@mail.gmail.com>

I am sorry but this link doesn't have any source code - this is the library.
I meant *your* source code, the code of your program; the code which
exercises the library and gets 5000 msg/s.

P.S. Please use "Reply all", this discussion is most probably
interesting for many people in the community.

2011/7/15 News Aanad <news.anand11 at gmail.com>:
> I am following this link for my java code:
> http://www.rabbitmq.com/releases/rabbitmq-java-client/v2.5.1/rabbitmq-java-client-bin-2.5.1.tar.gz
>
> On Fri, Jul 15, 2011 at 6:56 PM, Eugene Kirpichov <ekirpichov at gmail.com>
> wrote:
>>
>> Please show the source code of all participating components. It's
>> impossible to say anything definite without it.
>>
>> 2011/7/15 News Aanad <news.anand11 at gmail.com>:
>> >
>> > Till now i am getting the result of 5000 msg/sec in java.
>> >
>> > On Fri, Jul 15, 2011 at 6:53 PM, Eugene Kirpichov <ekirpichov at gmail.com>
>> > wrote:
>> >>
>> >> I guess you should get the speed you want, and much more, if you just
>> >> set up a high enough value for prefetch (see basic.qos) and set
>> >> autoack.
>> >> I got ~8k msg/s with much larger messages and persistence turned on
>> >> too.
>> >>
>> >> 2011/7/15 News Aanad <news.anand11 at gmail.com>:
>> >> >
>> >> > Message size is 199 bytes
>> >> > Messaging scenario is Persistence
>> >> >
>> >> > On Fri, Jul 15, 2011 at 6:47 PM, Eugene Kirpichov
>> >> > <ekirpichov at gmail.com>
>> >> > wrote:
>> >> >>
>> >> >> Hi.
>> >> >>
>> >> >> What's the size of messages?
>> >> >
>> >> >> What's your messaging scenario in general? Persistence, prefetch,
>> >> >> transactions?
>> >> >
>> >> >>
>> >> >> 2011/7/15 News Aanad <news.anand11 at gmail.com>:
>> >> >> > Hi, I wanted to achieve the goal of 15000 msg/sec in RabbitMQ. I
>> >> >> > have
>> >> >> > tried a lot in java as well as in ruby. And right now implementing
>> >> >> > node.js .
>> >> >> > I want to prefer java because after lots of experimentation the
>> >> >> > only
>> >> >> > java has given me good result but still goal is not achieved.
>> >> >> > So i want help to know how to reach upto 15000 msg/sec in RabbitMQ
>> >> >> > using java. If any good suggestion ?is there please tell me or if
>> >> >> > any
>> >> >> > site to prefer then please tell me.
>> >> >> >
>> >> >> > Thanks.
>> >> >> > _______________________________________________
>> >> >> > rabbitmq-discuss mailing list
>> >> >> > rabbitmq-discuss at lists.rabbitmq.com
>> >> >> >
>> >> >> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >> >> >
>> >> >>
>> >> >>
>> >> >>
>> >> >> --
>> >> >> Eugene Kirpichov
>> >> >> Principal Engineer, Mirantis Inc. http://www.mirantis.com/
>> >> >> Editor, http://fprog.ru/
>> >> >
>> >> >
>> >>
>> >>
>> >>
>> >> --
>> >> Eugene Kirpichov
>> >> Principal Engineer, Mirantis Inc. http://www.mirantis.com/
>> >> Editor, http://fprog.ru/
>> >
>> >
>>
>>
>>
>> --
>> Eugene Kirpichov
>> Principal Engineer, Mirantis Inc. http://www.mirantis.com/
>> Editor, http://fprog.ru/
>
>



-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/

From news.anand11 at gmail.com  Fri Jul 15 14:42:40 2011
From: news.anand11 at gmail.com (News Aanad)
Date: Fri, 15 Jul 2011 19:12:40 +0530
Subject: [rabbitmq-discuss] 15000 msg/sec
In-Reply-To: <CANVKUrXLPceXpR2DQ_r_=vYvJWmKq5=y-4xkYACKai+9fLYc=A@mail.gmail.com>
References: <cca8b833-4263-4b7d-b03e-cf6c0c1acc83@g5g2000prn.googlegroups.com>
	<CANVKUrU=5TuhGmMD+94E-yEp6ctGDFXGwxLpL92vg+Vtc=MmAQ@mail.gmail.com>
	<CAL9wd7cx9ppeJ3GErjBuwSFHXiF8JRdHHvapRH4pdhOUnn3b-A@mail.gmail.com>
	<CANVKUrWK6ZDimx4bFjLEszGzvy10vomY3ypf5Xg55orwREgXCQ@mail.gmail.com>
	<CAL9wd7cmB+Z6TcY0QWbD2aG3Z_GvHUtGvx6hyKpeid8of-boUA@mail.gmail.com>
	<CANVKUrUpjtid78j=1ZdXJB946irJBHquGDf_UBWKO_hCxKh75g@mail.gmail.com>
	<CAL9wd7epatwRF=ioUkik22NN3b6p+7+UEBeqzn50-YNOkJHMvQ@mail.gmail.com>
	<CANVKUrXLPceXpR2DQ_r_=vYvJWmKq5=y-4xkYACKai+9fLYc=A@mail.gmail.com>
Message-ID: <CAL9wd7ebwnbm2=o0-U9pptqe=zfhbdNiuZrrhbtnk=6Q2XPbjg@mail.gmail.com>

This is my code.


//  The contents of this file are subject to the Mozilla Public License
//  Version 1.1 (the "License"); you may not use this file except in
//  compliance with the License. You may obtain a copy of the License
//  at http://www.mozilla.org/MPL/
//
//  Software distributed under the License is distributed on an "AS IS"
//  basis, WITHOUT WARRANTY OF ANY KIND, either express or implied. See
//  the License for the specific language governing rights and
//  limitations under the License.
//
//  The Original Code is RabbitMQ.
//
//  The Initial Developer of the Original Code is VMware, Inc.
//  Copyright (c) 2007-2011 VMware, Inc.  All rights reserved.
//


package com.rabbitmq.examples;

import java.io.ByteArrayInputStream;
import java.io.ByteArrayOutputStream;
import java.io.DataInputStream;
import java.io.DataOutputStream;
import java.io.IOException;
import java.util.Arrays;
import java.util.Collections;
import java.util.List;
import java.util.SortedSet;
import java.util.TreeSet;
import java.util.UUID;
import java.util.concurrent.Semaphore;

import org.apache.commons.cli.CommandLine;
import org.apache.commons.cli.CommandLineParser;
import org.apache.commons.cli.GnuParser;
import org.apache.commons.cli.HelpFormatter;
import org.apache.commons.cli.Option;
import org.apache.commons.cli.Options;
import org.apache.commons.cli.ParseException;

import com.rabbitmq.client.AMQP;
import com.rabbitmq.client.Channel;
import com.rabbitmq.client.ConfirmListener;
import com.rabbitmq.client.Connection;
import com.rabbitmq.client.ConnectionFactory;
import com.rabbitmq.client.Envelope;
import com.rabbitmq.client.MessageProperties;
import com.rabbitmq.client.QueueingConsumer;
import com.rabbitmq.client.QueueingConsumer.Delivery;
import com.rabbitmq.client.ReturnListener;
import com.rabbitmq.client.ShutdownSignalException;


public class MulticastMain {

    public static void main(String[] args) {
        Options options = getOptions();
        CommandLineParser parser = new GnuParser();
        try {
            CommandLine cmd = parser.parse(options, args);

            if (cmd.hasOption('?')) {
                usage(options);
                System.exit(0);
            }

            String hostName      = strArg(cmd, 'h', "localhost");
            int portNumber       = intArg(cmd, 'p', AMQP.PROTOCOL.PORT);
            String exchangeType  = strArg(cmd, 't', "direct");
            String exchangeName  = strArg(cmd, 'e', exchangeType);
            int samplingInterval = intArg(cmd, 'i', 1);
            int rateLimit        = intArg(cmd, 'r', 0);
            int producerCount    = intArg(cmd, 'x', 1);
            int consumerCount    = intArg(cmd, 'y', 1);
            int producerTxSize   = intArg(cmd, 'm', 0);
            int consumerTxSize   = intArg(cmd, 'n', 0);
            long confirm         = intArg(cmd, 'c', -1);
            boolean autoAck      = cmd.hasOption('a');
            int prefetchCount    = intArg(cmd, 'q', 0);
            int minMsgSize       = intArg(cmd, 's', 0);
            int timeLimit        = intArg(cmd, 'z', 0);
            List<?> flags        = lstArg(cmd, 'f');
            int frameMax         = intArg(cmd, 'M', 0);
            int heartbeat        = intArg(cmd, 'b', 0);

            if ((producerTxSize > 0) && confirm >= 0) {
                throw new ParseException("Cannot select both
producerTxSize"+
                                         " and confirm");
            }

            //setup
            String id = UUID.randomUUID().toString();
            Stats stats = new Stats(1000L * samplingInterval);
            ConnectionFactory factory = new ConnectionFactory();
            factory.setHost(hostName);
            factory.setPort(portNumber);
            factory.setRequestedFrameMax(frameMax);
            factory.setRequestedHeartbeat(heartbeat);

            Thread[] consumerThreads = new Thread[consumerCount];
            Connection[] consumerConnections = new
Connection[consumerCount];
            for (int i = 0; i < consumerCount; i++) {
                System.out.println("starting consumer #" + i);
                Connection conn = factory.newConnection();
                consumerConnections[i] = conn;
                Channel channel = conn.createChannel();
                if (consumerTxSize > 0) channel.txSelect();
                channel.exchangeDeclare(exchangeName, exchangeType);
                String queueName =
                        channel.queueDeclare("",
flags.contains("persistent"),
                                             true, false, null).getQueue();
                QueueingConsumer consumer = new QueueingConsumer(channel);
                if (prefetchCount > 0) channel.basicQos(prefetchCount);
                channel.basicConsume(queueName, autoAck, consumer);
                channel.queueBind(queueName, exchangeName, id);
                Thread t =
                    new Thread(new Consumer(consumer, id,
                                            consumerTxSize, autoAck,
                                            stats, timeLimit));
                consumerThreads[i] = t;
                t.start();
            }
            Thread[] producerThreads = new Thread[producerCount];
            Connection[] producerConnections = new
Connection[producerCount];
            for (int i = 0; i < producerCount; i++) {
                System.out.println("starting producer #" + i);
                Connection conn = factory.newConnection();
                producerConnections[i] = conn;
                Channel channel = conn.createChannel();
                if (producerTxSize > 0) channel.txSelect();
                if (confirm >= 0) channel.confirmSelect();
                channel.exchangeDeclare(exchangeName, exchangeType);
                final Producer p = new Producer(channel, exchangeName, id,
                                                flags, producerTxSize,
                                                1000L * samplingInterval,
                                                rateLimit, minMsgSize,
timeLimit,
                                                confirm);
                channel.setReturnListener(p);
                channel.setConfirmListener(p);
                Thread t = new Thread(p);
                producerThreads[i] = t;
                t.start();
            }

            for (int i = 0; i < producerCount; i++) {
                producerThreads[i].join();
                producerConnections[i].close();
            }

            for (int i = 0; i < consumerCount; i++) {
                consumerThreads[i].join();
                consumerConnections[i].close();
            }

        }
        catch( ParseException exp ) {
            System.err.println("Parsing failed. Reason: " +
exp.getMessage());
            usage(options);
        } catch (Exception e) {
            System.err.println("Main thread caught exception: " + e);
            e.printStackTrace();
            System.exit(1);
        }
    }

    private static void usage(Options options) {
        HelpFormatter formatter = new HelpFormatter();
        formatter.printHelp("<program>", options);
    }

    private static Options getOptions() {
        Options options = new Options();
        options.addOption(new Option("?", "help",      false,"show usage"));
        options.addOption(new Option("h", "host",      true, "broker
host"));
        options.addOption(new Option("p", "port",      true, "broker
port"));
        options.addOption(new Option("t", "type",      true, "exchange
type"));
        options.addOption(new Option("e", "exchange",  true, "exchange
name"));
        options.addOption(new Option("i", "interval",  true, "sampling
interval"));
        options.addOption(new Option("r", "rate",      true, "rate limit"));
        options.addOption(new Option("x", "producers", true, "producer
count"));
        options.addOption(new Option("y", "consumers", true, "consumer
count"));
        options.addOption(new Option("m", "ptxsize",   true, "producer tx
size"));
        options.addOption(new Option("n", "ctxsize",   true, "consumer tx
size"));
        options.addOption(new Option("c", "confirm",   true, "max
unconfirmed publishes"));
        options.addOption(new Option("a", "autoack",   false,"auto ack"));
        options.addOption(new Option("q", "qos",       true, "qos prefetch
count"));
        options.addOption(new Option("s", "size",      true, "message
size"));
        options.addOption(new Option("z", "time",      true, "time limit"));
        Option flag =     new Option("f", "flag",      true, "message
flag");
        flag.setArgs(Option.UNLIMITED_VALUES);
        options.addOption(flag);
        options.addOption(new Option("M", "framemax",  true, "frame max"));
        options.addOption(new Option("b", "heartbeat", true, "heartbeat
interval"));
        return options;
    }

    private static String strArg(CommandLine cmd, char opt, String def) {
        return cmd.getOptionValue(opt, def);
    }

    private static int intArg(CommandLine cmd, char opt, int def) {
        return Integer.parseInt(cmd.getOptionValue(opt,
Integer.toString(def)));
    }

    private static List<?> lstArg(CommandLine cmd, char opt) {
        String[] vals = cmd.getOptionValues('f');
        if (vals == null) {
            vals = new String[] {};
        }
        return Arrays.asList(vals);
    }

    public static class Producer implements Runnable, ReturnListener,
                                            ConfirmListener
    {
        private Channel channel;
        private String  exchangeName;
        private String  id;
        private boolean mandatory;
        private boolean immediate;
        private boolean persistent;
        private int     txSize;
        private long    interval;
        private int     rateLimit;
        private long    timeLimit;

        private byte[]  message;

        private long    startTime;
        private long    lastStatsTime;
        private int     msgCount;
        private int     returnCount;

        private long      confirm;
        private Semaphore confirmPool;
        private long      confirmCount;
        private long      nackCount;
        private volatile SortedSet<Long> unconfirmedSet =
            Collections.synchronizedSortedSet(new TreeSet<Long>());

        public Producer(Channel channel, String exchangeName, String id,
                        List<?> flags, int txSize,
                        long interval, int rateLimit, int minMsgSize, int
timeLimit,
                        long confirm)
            throws IOException {

            this.channel      = channel;
            this.exchangeName = exchangeName;
            this.id           = id;
            this.mandatory    = flags.contains("mandatory");
            this.immediate    = flags.contains("immediate");
            this.persistent   = flags.contains("persistent");
            this.txSize       = txSize;
            this.interval     = interval;
            this.rateLimit    = rateLimit;
            this.timeLimit    = 1000L * timeLimit;
            this.message      = new byte[minMsgSize];
            this.confirm      = confirm;
            if (confirm > 0) {
                this.confirmPool  = new Semaphore((int)confirm);
            }
        }

        public synchronized void handleReturn(int replyCode,
                                              String replyText,
                                              String exchange,
                                              String routingKey,
                                              AMQP.BasicProperties
properties,
                                              byte[] body)
            throws IOException {
            returnCount++;
        }

        public void handleAck(long seqNo, boolean multiple) {
            handleAckNack(seqNo, multiple, false);
        }

        public void handleNack(long seqNo, boolean multiple) {
            handleAckNack(seqNo, multiple, true);
        }

        private void handleAckNack(long seqNo, boolean multiple,
                                   boolean nack) {
            int numConfirms = 0;
            if (multiple) {
                SortedSet<Long> confirmed = unconfirmedSet.headSet(seqNo +
1);
                numConfirms += confirmed.size();
                confirmed.clear();
            } else {
                unconfirmedSet.remove(seqNo);
                numConfirms = 1;
            }
            synchronized (this) {
                if (nack) {
                    nackCount += numConfirms;
                } else {
                    confirmCount += numConfirms;
                }
            }

            if (confirmPool != null) {
                for (int i = 0; i < numConfirms; ++i) {
                    confirmPool.release();
                }
            }

        }

        public void run() {

            long now;
            now = startTime = lastStatsTime = System.currentTimeMillis();
            msgCount = 0;
            int totalMsgCount = 0;

            try {

                while (timeLimit == 0 || now < startTime + timeLimit) {
                    if (confirmPool != null) {
                        confirmPool.acquire();
                    }
                    delay(now);
                    publish(createMessage(totalMsgCount));
                    totalMsgCount++;
                    msgCount++;

                    if (txSize != 0 && totalMsgCount % txSize == 0) {
                        channel.txCommit();
                    }
                    now = System.currentTimeMillis();
                }

            } catch (IOException e) {
                throw new RuntimeException(e);
            } catch (InterruptedException e) {
                throw new RuntimeException (e);
            }

            System.out.println("sending rate avg: " +
                               (totalMsgCount * 1000L / (now - startTime)) +
                               " msg/s");

        }

        private void publish(byte[] msg)
            throws IOException {

            unconfirmedSet.add(channel.getNextPublishSeqNo());
            channel.basicPublish(exchangeName, id,
                                 mandatory, immediate,
                                 persistent ?
MessageProperties.MINIMAL_PERSISTENT_BASIC :
MessageProperties.MINIMAL_BASIC,
                                 msg);
        }

        private void delay(long now)
            throws InterruptedException {

            long elapsed = now - lastStatsTime;
            //example: rateLimit is 5000 msg/s,
            //10 ms have elapsed, we have sent 200 messages
            //the 200 msgs we have actually sent should have taken us
            //200 * 1000 / 5000 = 40 ms. So we pause for 40ms - 10ms
            long pause = rateLimit == 0 ?
                0 : (msgCount * 1000L / rateLimit - elapsed);
            if (pause > 0) {
                Thread.sleep(pause);
            }
            if (elapsed > interval) {
                long sendRate, returnRate, confirmRate, nackRate;
                synchronized(this) {
                    sendRate     = msgCount     * 1000L / elapsed;
                    returnRate   = returnCount  * 1000L / elapsed;
                    confirmRate  = confirmCount * 1000L / elapsed;
                    nackRate     = nackCount    * 1000L / elapsed;
                    msgCount     = 0;
                    returnCount  = 0;
                    confirmCount = 0;
                    nackCount    = 0;
                }
                System.out.print("sending rate: " + sendRate + " msg/s");
                if (mandatory || immediate) {
                    System.out.print(", returns: " + returnRate + " ret/s");
                }
                if (confirm >= 0) {
                    System.out.print(", confirms: " + confirmRate + " c/s");
                    if (nackRate > 0) {
                        System.out.print(", nacks: " + nackRate + " n/s");
                    }
                }
                System.out.println();
                lastStatsTime = now;
            }
        }

        private byte[] createMessage(int sequenceNumber)
            throws IOException {

            ByteArrayOutputStream acc = new ByteArrayOutputStream();
            DataOutputStream d = new DataOutputStream(acc);
            long nano = System.nanoTime();
            d.writeInt(sequenceNumber);
            d.writeLong(nano);
            d.flush();
            acc.flush();
            byte[] m = acc.toByteArray();
            if (m.length <= message.length) {
                System.arraycopy(m, 0, message, 0, m.length);
                return message;
            } else {
                return m;
            }
        }

    }

    public static class Consumer implements Runnable {

        private QueueingConsumer q;
        private String           id;
        private int              txSize;
        private boolean          autoAck;
        private Stats            stats;
        private long             timeLimit;

        public Consumer(QueueingConsumer q, String id,
                        int txSize, boolean autoAck,
                        Stats stats, int timeLimit) {

            this.q         = q;
            this.id        = id;
            this.txSize    = txSize;
            this.autoAck   = autoAck;
            this.stats     = stats;
            this.timeLimit = 1000L * timeLimit;
        }

        public void run() {

            long now;
            long startTime;
            startTime = now = System.currentTimeMillis();
            int totalMsgCount = 0;

            Channel channel = q.getChannel();

            try {

                while (timeLimit == 0 || now < startTime + timeLimit) {
                    Delivery delivery;
                    if (timeLimit == 0) {
                        delivery = q.nextDelivery();
                    } else {
                        delivery = q.nextDelivery(startTime + timeLimit -
now);
                        if (delivery == null) break;
                    }
            totalMsgCount++;

                    DataInputStream d = new DataInputStream(new
ByteArrayInputStream(delivery.getBody()));
                    d.readInt();
                    long msgNano = d.readLong();
                    long nano = System.nanoTime();

                    Envelope envelope = delivery.getEnvelope();

                    if (!autoAck) {
                        channel.basicAck(envelope.getDeliveryTag(), false);
                    }

                    if (txSize != 0 && totalMsgCount % txSize == 0) {
                        channel.txCommit();
                    }

                    now = System.currentTimeMillis();

                    stats.collectStats(now,
id.equals(envelope.getRoutingKey()) ? (nano - msgNano) : 0L);
                }

            } catch (IOException e) {
                throw new RuntimeException(e);
            } catch (InterruptedException e) {
                throw new RuntimeException (e);
            } catch (ShutdownSignalException e) {
                throw new RuntimeException(e);
            }

            long elapsed = now - startTime;
            if (elapsed > 0) {
                System.out.println("recving rate avg: " +
                                   (totalMsgCount * 1000L / elapsed) +
                                   " msg/s");
            }
        }

    }

    public static class Stats {

        private long    interval;

        private long    lastStatsTime;
        private int     msgCount;
        private int     latencyCount;
        private long    minLatency;
        private long    maxLatency;
        private long    cumulativeLatency;

        public Stats(long interval) {
            this.interval = interval;
            reset(System.currentTimeMillis());
        }

        private void reset(long t) {
            lastStatsTime     = t;
            msgCount          = 0;
            latencyCount      = 0;
            minLatency        = Long.MAX_VALUE;
            maxLatency        = Long.MIN_VALUE;
            cumulativeLatency = 0L;
        }

        public synchronized void collectStats(long now, long latency) {
            msgCount++;

            if (latency > 0) {
                minLatency = Math.min(minLatency, latency);
                maxLatency = Math.max(maxLatency, latency);
                cumulativeLatency += latency;
                latencyCount++;
            }

            long elapsed = now - lastStatsTime;
            if (elapsed > interval) {
                System.out.println("recving rate: " +
                                   (1000L * msgCount / elapsed) +
                                   " msg/s" +
                                   (latencyCount > 0 ?
                                    ", min/avg/max latency: " +
                                    minLatency/1000L + "/" +
                                    cumulativeLatency / (1000L *
latencyCount) + "/" +
                                    maxLatency/1000L + " microseconds" :
                                    ""));
                reset(now);
            }

        }

    }

}


On Fri, Jul 15, 2011 at 7:06 PM, Eugene Kirpichov <ekirpichov at gmail.com>wrote:

> I am sorry but this link doesn't have any source code - this is the
> library.
> I meant *your* source code, the code of your program; the code which
> exercises the library and gets 5000 msg/s.
>
> P.S. Please use "Reply all", this discussion is most probably
> interesting for many people in the community.
>
> 2011/7/15 News Aanad <news.anand11 at gmail.com>:
> > I am following this link for my java code:
> >
> http://www.rabbitmq.com/releases/rabbitmq-java-client/v2.5.1/rabbitmq-java-client-bin-2.5.1.tar.gz
> >
> > On Fri, Jul 15, 2011 at 6:56 PM, Eugene Kirpichov <ekirpichov at gmail.com>
> > wrote:
> >>
> >> Please show the source code of all participating components. It's
> >> impossible to say anything definite without it.
> >>
> >> 2011/7/15 News Aanad <news.anand11 at gmail.com>:
> >> >
> >> > Till now i am getting the result of 5000 msg/sec in java.
> >> >
> >> > On Fri, Jul 15, 2011 at 6:53 PM, Eugene Kirpichov <
> ekirpichov at gmail.com>
> >> > wrote:
> >> >>
> >> >> I guess you should get the speed you want, and much more, if you just
> >> >> set up a high enough value for prefetch (see basic.qos) and set
> >> >> autoack.
> >> >> I got ~8k msg/s with much larger messages and persistence turned on
> >> >> too.
> >> >>
> >> >> 2011/7/15 News Aanad <news.anand11 at gmail.com>:
> >> >> >
> >> >> > Message size is 199 bytes
> >> >> > Messaging scenario is Persistence
> >> >> >
> >> >> > On Fri, Jul 15, 2011 at 6:47 PM, Eugene Kirpichov
> >> >> > <ekirpichov at gmail.com>
> >> >> > wrote:
> >> >> >>
> >> >> >> Hi.
> >> >> >>
> >> >> >> What's the size of messages?
> >> >> >
> >> >> >> What's your messaging scenario in general? Persistence, prefetch,
> >> >> >> transactions?
> >> >> >
> >> >> >>
> >> >> >> 2011/7/15 News Aanad <news.anand11 at gmail.com>:
> >> >> >> > Hi, I wanted to achieve the goal of 15000 msg/sec in RabbitMQ. I
> >> >> >> > have
> >> >> >> > tried a lot in java as well as in ruby. And right now
> implementing
> >> >> >> > node.js .
> >> >> >> > I want to prefer java because after lots of experimentation the
> >> >> >> > only
> >> >> >> > java has given me good result but still goal is not achieved.
> >> >> >> > So i want help to know how to reach upto 15000 msg/sec in
> RabbitMQ
> >> >> >> > using java. If any good suggestion  is there please tell me or
> if
> >> >> >> > any
> >> >> >> > site to prefer then please tell me.
> >> >> >> >
> >> >> >> > Thanks.
> >> >> >> > _______________________________________________
> >> >> >> > rabbitmq-discuss mailing list
> >> >> >> > rabbitmq-discuss at lists.rabbitmq.com
> >> >> >> >
> >> >> >> >
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >> >> >> >
> >> >> >>
> >> >> >>
> >> >> >>
> >> >> >> --
> >> >> >> Eugene Kirpichov
> >> >> >> Principal Engineer, Mirantis Inc. http://www.mirantis.com/
> >> >> >> Editor, http://fprog.ru/
> >> >> >
> >> >> >
> >> >>
> >> >>
> >> >>
> >> >> --
> >> >> Eugene Kirpichov
> >> >> Principal Engineer, Mirantis Inc. http://www.mirantis.com/
> >> >> Editor, http://fprog.ru/
> >> >
> >> >
> >>
> >>
> >>
> >> --
> >> Eugene Kirpichov
> >> Principal Engineer, Mirantis Inc. http://www.mirantis.com/
> >> Editor, http://fprog.ru/
> >
> >
>
>
>
> --
> Eugene Kirpichov
> Principal Engineer, Mirantis Inc. http://www.mirantis.com/
> Editor, http://fprog.ru/
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110715/e18e2d3d/attachment.htm>

From ekirpichov at gmail.com  Fri Jul 15 15:27:12 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Fri, 15 Jul 2011 18:27:12 +0400
Subject: [rabbitmq-discuss] 15000 msg/sec
In-Reply-To: <CAL9wd7ebwnbm2=o0-U9pptqe=zfhbdNiuZrrhbtnk=6Q2XPbjg@mail.gmail.com>
References: <cca8b833-4263-4b7d-b03e-cf6c0c1acc83@g5g2000prn.googlegroups.com>
	<CANVKUrU=5TuhGmMD+94E-yEp6ctGDFXGwxLpL92vg+Vtc=MmAQ@mail.gmail.com>
	<CAL9wd7cx9ppeJ3GErjBuwSFHXiF8JRdHHvapRH4pdhOUnn3b-A@mail.gmail.com>
	<CANVKUrWK6ZDimx4bFjLEszGzvy10vomY3ypf5Xg55orwREgXCQ@mail.gmail.com>
	<CAL9wd7cmB+Z6TcY0QWbD2aG3Z_GvHUtGvx6hyKpeid8of-boUA@mail.gmail.com>
	<CANVKUrUpjtid78j=1ZdXJB946irJBHquGDf_UBWKO_hCxKh75g@mail.gmail.com>
	<CAL9wd7epatwRF=ioUkik22NN3b6p+7+UEBeqzn50-YNOkJHMvQ@mail.gmail.com>
	<CANVKUrXLPceXpR2DQ_r_=vYvJWmKq5=y-4xkYACKai+9fLYc=A@mail.gmail.com>
	<CAL9wd7ebwnbm2=o0-U9pptqe=zfhbdNiuZrrhbtnk=6Q2XPbjg@mail.gmail.com>
Message-ID: <CANVKUrUJ4X6mxoS3Lo5tjsfBguLzA_E40z-dVETA-9pJ-EEUdg@mail.gmail.com>

Is this the minimal piece of code that demonstrates poor performance?
It's hard to decipher that much code and it can have many kinds of
problems inside; I think you should be able to trim it down to a
couple dozen lines demonstrating the same speed; then diagnosing will
become a lot easier.

2011/7/15 News Aanad <news.anand11 at gmail.com>:
> This is my code.
>
>
> //? The contents of this file are subject to the Mozilla Public License
> //? Version 1.1 (the "License"); you may not use this file except in
> //? compliance with the License. You may obtain a copy of the License
> //? at http://www.mozilla.org/MPL/
> //
> //? Software distributed under the License is distributed on an "AS IS"
> //? basis, WITHOUT WARRANTY OF ANY KIND, either express or implied. See
> //? the License for the specific language governing rights and
> //? limitations under the License.
> //
> //? The Original Code is RabbitMQ.
> //
> //? The Initial Developer of the Original Code is VMware, Inc.
> //? Copyright (c) 2007-2011 VMware, Inc.? All rights reserved.
> //
>
>
> package com.rabbitmq.examples;
>
> import java.io.ByteArrayInputStream;
> import java.io.ByteArrayOutputStream;
> import java.io.DataInputStream;
> import java.io.DataOutputStream;
> import java.io.IOException;
> import java.util.Arrays;
> import java.util.Collections;
> import java.util.List;
> import java.util.SortedSet;
> import java.util.TreeSet;
> import java.util.UUID;
> import java.util.concurrent.Semaphore;
>
> import org.apache.commons.cli.CommandLine;
> import org.apache.commons.cli.CommandLineParser;
> import org.apache.commons.cli.GnuParser;
> import org.apache.commons.cli.HelpFormatter;
> import org.apache.commons.cli.Option;
> import org.apache.commons.cli.Options;
> import org.apache.commons.cli.ParseException;
>
> import com.rabbitmq.client.AMQP;
> import com.rabbitmq.client.Channel;
> import com.rabbitmq.client.ConfirmListener;
> import com.rabbitmq.client.Connection;
> import com.rabbitmq.client.ConnectionFactory;
> import com.rabbitmq.client.Envelope;
> import com.rabbitmq.client.MessageProperties;
> import com.rabbitmq.client.QueueingConsumer;
> import com.rabbitmq.client.QueueingConsumer.Delivery;
> import com.rabbitmq.client.ReturnListener;
> import com.rabbitmq.client.ShutdownSignalException;
>
>
> public class MulticastMain {
>
> ??? public static void main(String[] args) {
> ??????? Options options = getOptions();
> ??????? CommandLineParser parser = new GnuParser();
> ??????? try {
> ??????????? CommandLine cmd = parser.parse(options, args);
>
> ??????????? if (cmd.hasOption('?')) {
> ??????????????? usage(options);
> ??????????????? System.exit(0);
> ??????????? }
>
> ??????????? String hostName????? = strArg(cmd, 'h', "localhost");
> ??????????? int portNumber?????? = intArg(cmd, 'p', AMQP.PROTOCOL.PORT);
> ??????????? String exchangeType? = strArg(cmd, 't', "direct");
> ??????????? String exchangeName? = strArg(cmd, 'e', exchangeType);
> ??????????? int samplingInterval = intArg(cmd, 'i', 1);
> ??????????? int rateLimit??????? = intArg(cmd, 'r', 0);
> ??????????? int producerCount??? = intArg(cmd, 'x', 1);
> ??????????? int consumerCount??? = intArg(cmd, 'y', 1);
> ??????????? int producerTxSize?? = intArg(cmd, 'm', 0);
> ??????????? int consumerTxSize?? = intArg(cmd, 'n', 0);
> ??????????? long confirm???????? = intArg(cmd, 'c', -1);
> ??????????? boolean autoAck????? = cmd.hasOption('a');
> ??????????? int prefetchCount??? = intArg(cmd, 'q', 0);
> ??????????? int minMsgSize?????? = intArg(cmd, 's', 0);
> ??????????? int timeLimit??????? = intArg(cmd, 'z', 0);
> ??????????? List<?> flags??????? = lstArg(cmd, 'f');
> ??????????? int frameMax???????? = intArg(cmd, 'M', 0);
> ??????????? int heartbeat??????? = intArg(cmd, 'b', 0);
>
> ??????????? if ((producerTxSize > 0) && confirm >= 0) {
> ??????????????? throw new ParseException("Cannot select both
> producerTxSize"+
> ???????????????????????????????????????? " and confirm");
> ??????????? }
>
> ??????????? //setup
> ??????????? String id = UUID.randomUUID().toString();
> ??????????? Stats stats = new Stats(1000L * samplingInterval);
> ??????????? ConnectionFactory factory = new ConnectionFactory();
> ??????????? factory.setHost(hostName);
> ??????????? factory.setPort(portNumber);
> ??????????? factory.setRequestedFrameMax(frameMax);
> ??????????? factory.setRequestedHeartbeat(heartbeat);
>
> ??????????? Thread[] consumerThreads = new Thread[consumerCount];
> ??????????? Connection[] consumerConnections = new
> Connection[consumerCount];
> ??????????? for (int i = 0; i < consumerCount; i++) {
> ??????????????? System.out.println("starting consumer #" + i);
> ??????????????? Connection conn = factory.newConnection();
> ??????????????? consumerConnections[i] = conn;
> ??????????????? Channel channel = conn.createChannel();
> ??????????????? if (consumerTxSize > 0) channel.txSelect();
> ??????????????? channel.exchangeDeclare(exchangeName, exchangeType);
> ??????????????? String queueName =
> ??????????????????????? channel.queueDeclare("",
> flags.contains("persistent"),
> ???????????????????????????????????????????? true, false, null).getQueue();
> ??????????????? QueueingConsumer consumer = new QueueingConsumer(channel);
> ??????????????? if (prefetchCount > 0) channel.basicQos(prefetchCount);
> ??????????????? channel.basicConsume(queueName, autoAck, consumer);
> ??????????????? channel.queueBind(queueName, exchangeName, id);
> ??????????????? Thread t =
> ??????????????????? new Thread(new Consumer(consumer, id,
> ??????????????????????????????????????????? consumerTxSize, autoAck,
> ??????????????????????????????????????????? stats, timeLimit));
> ??????????????? consumerThreads[i] = t;
> ??????????????? t.start();
> ??????????? }
> ??????????? Thread[] producerThreads = new Thread[producerCount];
> ??????????? Connection[] producerConnections = new
> Connection[producerCount];
> ??????????? for (int i = 0; i < producerCount; i++) {
> ??????????????? System.out.println("starting producer #" + i);
> ??????????????? Connection conn = factory.newConnection();
> ??????????????? producerConnections[i] = conn;
> ??????????????? Channel channel = conn.createChannel();
> ??????????????? if (producerTxSize > 0) channel.txSelect();
> ??????????????? if (confirm >= 0) channel.confirmSelect();
> ??????????????? channel.exchangeDeclare(exchangeName, exchangeType);
> ??????????????? final Producer p = new Producer(channel, exchangeName, id,
> ??????????????????????????????????????????????? flags, producerTxSize,
> ??????????????????????????????????????????????? 1000L * samplingInterval,
> ??????????????????????????????????????????????? rateLimit, minMsgSize,
> timeLimit,
> ??????????????????????????????????????????????? confirm);
> ??????????????? channel.setReturnListener(p);
> ??????????????? channel.setConfirmListener(p);
> ??????????????? Thread t = new Thread(p);
> ??????????????? producerThreads[i] = t;
> ??????????????? t.start();
> ??????????? }
>
> ??????????? for (int i = 0; i < producerCount; i++) {
> ??????????????? producerThreads[i].join();
> ??????????????? producerConnections[i].close();
> ??????????? }
>
> ??????????? for (int i = 0; i < consumerCount; i++) {
> ??????????????? consumerThreads[i].join();
> ??????????????? consumerConnections[i].close();
> ??????????? }
>
> ??????? }
> ??????? catch( ParseException exp ) {
> ??????????? System.err.println("Parsing failed. Reason: " +
> exp.getMessage());
> ??????????? usage(options);
> ??????? } catch (Exception e) {
> ??????????? System.err.println("Main thread caught exception: " + e);
> ??????????? e.printStackTrace();
> ??????????? System.exit(1);
> ??????? }
> ??? }
>
> ??? private static void usage(Options options) {
> ??????? HelpFormatter formatter = new HelpFormatter();
> ??????? formatter.printHelp("<program>", options);
> ??? }
>
> ??? private static Options getOptions() {
> ??????? Options options = new Options();
> ??????? options.addOption(new Option("?", "help",????? false,"show usage"));
> ??????? options.addOption(new Option("h", "host",????? true, "broker
> host"));
> ??????? options.addOption(new Option("p", "port",????? true, "broker
> port"));
> ??????? options.addOption(new Option("t", "type",????? true, "exchange
> type"));
> ??????? options.addOption(new Option("e", "exchange",? true, "exchange
> name"));
> ??????? options.addOption(new Option("i", "interval",? true, "sampling
> interval"));
> ??????? options.addOption(new Option("r", "rate",????? true, "rate limit"));
> ??????? options.addOption(new Option("x", "producers", true, "producer
> count"));
> ??????? options.addOption(new Option("y", "consumers", true, "consumer
> count"));
> ??????? options.addOption(new Option("m", "ptxsize",?? true, "producer tx
> size"));
> ??????? options.addOption(new Option("n", "ctxsize",?? true, "consumer tx
> size"));
> ??????? options.addOption(new Option("c", "confirm",?? true, "max
> unconfirmed publishes"));
> ??????? options.addOption(new Option("a", "autoack",?? false,"auto ack"));
> ??????? options.addOption(new Option("q", "qos",?????? true, "qos prefetch
> count"));
> ??????? options.addOption(new Option("s", "size",????? true, "message
> size"));
> ??????? options.addOption(new Option("z", "time",????? true, "time limit"));
> ??????? Option flag =???? new Option("f", "flag",????? true, "message
> flag");
> ??????? flag.setArgs(Option.UNLIMITED_VALUES);
> ??????? options.addOption(flag);
> ??????? options.addOption(new Option("M", "framemax",? true, "frame max"));
> ??????? options.addOption(new Option("b", "heartbeat", true, "heartbeat
> interval"));
> ??????? return options;
> ??? }
>
> ??? private static String strArg(CommandLine cmd, char opt, String def) {
> ??????? return cmd.getOptionValue(opt, def);
> ??? }
>
> ??? private static int intArg(CommandLine cmd, char opt, int def) {
> ??????? return Integer.parseInt(cmd.getOptionValue(opt,
> Integer.toString(def)));
> ??? }
>
> ??? private static List<?> lstArg(CommandLine cmd, char opt) {
> ??????? String[] vals = cmd.getOptionValues('f');
> ??????? if (vals == null) {
> ??????????? vals = new String[] {};
> ??????? }
> ??????? return Arrays.asList(vals);
> ??? }
>
> ??? public static class Producer implements Runnable, ReturnListener,
> ??????????????????????????????????????????? ConfirmListener
> ??? {
> ??????? private Channel channel;
> ??????? private String? exchangeName;
> ??????? private String? id;
> ??????? private boolean mandatory;
> ??????? private boolean immediate;
> ??????? private boolean persistent;
> ??????? private int???? txSize;
> ??????? private long??? interval;
> ??????? private int???? rateLimit;
> ??????? private long??? timeLimit;
>
> ??????? private byte[]? message;
>
> ??????? private long??? startTime;
> ??????? private long??? lastStatsTime;
> ??????? private int???? msgCount;
> ??????? private int???? returnCount;
>
> ??????? private long????? confirm;
> ??????? private Semaphore confirmPool;
> ??????? private long????? confirmCount;
> ??????? private long????? nackCount;
> ??????? private volatile SortedSet<Long> unconfirmedSet =
> ??????????? Collections.synchronizedSortedSet(new TreeSet<Long>());
>
> ??????? public Producer(Channel channel, String exchangeName, String id,
> ??????????????????????? List<?> flags, int txSize,
> ??????????????????????? long interval, int rateLimit, int minMsgSize, int
> timeLimit,
> ??????????????????????? long confirm)
> ??????????? throws IOException {
>
> ??????????? this.channel????? = channel;
> ??????????? this.exchangeName = exchangeName;
> ??????????? this.id?????????? = id;
> ??????????? this.mandatory??? = flags.contains("mandatory");
> ??????????? this.immediate??? = flags.contains("immediate");
> ??????????? this.persistent?? = flags.contains("persistent");
> ??????????? this.txSize?????? = txSize;
> ??????????? this.interval???? = interval;
> ??????????? this.rateLimit??? = rateLimit;
> ??????????? this.timeLimit??? = 1000L * timeLimit;
> ??????????? this.message????? = new byte[minMsgSize];
> ??????????? this.confirm????? = confirm;
> ??????????? if (confirm > 0) {
> ??????????????? this.confirmPool? = new Semaphore((int)confirm);
> ??????????? }
> ??????? }
>
> ??????? public synchronized void handleReturn(int replyCode,
> ????????????????????????????????????????????? String replyText,
> ????????????????????????????????????????????? String exchange,
> ????????????????????????????????????????????? String routingKey,
> ????????????????????????????????????????????? AMQP.BasicProperties
> properties,
> ????????????????????????????????????????????? byte[] body)
> ??????????? throws IOException {
> ??????????? returnCount++;
> ??????? }
>
> ??????? public void handleAck(long seqNo, boolean multiple) {
> ??????????? handleAckNack(seqNo, multiple, false);
> ??????? }
>
> ??????? public void handleNack(long seqNo, boolean multiple) {
> ??????????? handleAckNack(seqNo, multiple, true);
> ??????? }
>
> ??????? private void handleAckNack(long seqNo, boolean multiple,
> ?????????????????????????????????? boolean nack) {
> ??????????? int numConfirms = 0;
> ??????????? if (multiple) {
> ??????????????? SortedSet<Long> confirmed = unconfirmedSet.headSet(seqNo +
> 1);
> ??????????????? numConfirms += confirmed.size();
> ??????????????? confirmed.clear();
> ??????????? } else {
> ??????????????? unconfirmedSet.remove(seqNo);
> ??????????????? numConfirms = 1;
> ??????????? }
> ??????????? synchronized (this) {
> ??????????????? if (nack) {
> ??????????????????? nackCount += numConfirms;
> ??????????????? } else {
> ??????????????????? confirmCount += numConfirms;
> ??????????????? }
> ??????????? }
>
> ??????????? if (confirmPool != null) {
> ??????????????? for (int i = 0; i < numConfirms; ++i) {
> ??????????????????? confirmPool.release();
> ??????????????? }
> ??????????? }
>
> ??????? }
>
> ??????? public void run() {
>
> ??????????? long now;
> ??????????? now = startTime = lastStatsTime = System.currentTimeMillis();
> ??????????? msgCount = 0;
> ??????????? int totalMsgCount = 0;
>
> ??????????? try {
>
> ??????????????? while (timeLimit == 0 || now < startTime + timeLimit) {
> ??????????????????? if (confirmPool != null) {
> ??????????????????????? confirmPool.acquire();
> ??????????????????? }
> ??????????????????? delay(now);
> ??????????????????? publish(createMessage(totalMsgCount));
> ??????????????????? totalMsgCount++;
> ??????????????????? msgCount++;
>
> ??????????????????? if (txSize != 0 && totalMsgCount % txSize == 0) {
> ??????????????????????? channel.txCommit();
> ??????????????????? }
> ??????????????????? now = System.currentTimeMillis();
> ??????????????? }
>
> ??????????? } catch (IOException e) {
> ??????????????? throw new RuntimeException(e);
> ??????????? } catch (InterruptedException e) {
> ??????????????? throw new RuntimeException (e);
> ??????????? }
>
> ??????????? System.out.println("sending rate avg: " +
> ?????????????????????????????? (totalMsgCount * 1000L / (now - startTime)) +
> ?????????????????????????????? " msg/s");
>
> ??????? }
>
> ??????? private void publish(byte[] msg)
> ??????????? throws IOException {
>
> ??????????? unconfirmedSet.add(channel.getNextPublishSeqNo());
> ??????????? channel.basicPublish(exchangeName, id,
> ???????????????????????????????? mandatory, immediate,
> ???????????????????????????????? persistent ?
> MessageProperties.MINIMAL_PERSISTENT_BASIC :
> MessageProperties.MINIMAL_BASIC,
> ???????????????????????????????? msg);
> ??????? }
>
> ??????? private void delay(long now)
> ??????????? throws InterruptedException {
>
> ??????????? long elapsed = now - lastStatsTime;
> ??????????? //example: rateLimit is 5000 msg/s,
> ??????????? //10 ms have elapsed, we have sent 200 messages
> ??????????? //the 200 msgs we have actually sent should have taken us
> ??????????? //200 * 1000 / 5000 = 40 ms. So we pause for 40ms - 10ms
> ??????????? long pause = rateLimit == 0 ?
> ??????????????? 0 : (msgCount * 1000L / rateLimit - elapsed);
> ??????????? if (pause > 0) {
> ??????????????? Thread.sleep(pause);
> ??????????? }
> ??????????? if (elapsed > interval) {
> ??????????????? long sendRate, returnRate, confirmRate, nackRate;
> ??????????????? synchronized(this) {
> ??????????????????? sendRate???? = msgCount???? * 1000L / elapsed;
> ??????????????????? returnRate?? = returnCount? * 1000L / elapsed;
> ??????????????????? confirmRate? = confirmCount * 1000L / elapsed;
> ??????????????????? nackRate???? = nackCount??? * 1000L / elapsed;
> ??????????????????? msgCount???? = 0;
> ??????????????????? returnCount? = 0;
> ??????????????????? confirmCount = 0;
> ??????????????????? nackCount??? = 0;
> ??????????????? }
> ??????????????? System.out.print("sending rate: " + sendRate + " msg/s");
> ??????????????? if (mandatory || immediate) {
> ??????????????????? System.out.print(", returns: " + returnRate + " ret/s");
> ??????????????? }
> ??????????????? if (confirm >= 0) {
> ??????????????????? System.out.print(", confirms: " + confirmRate + " c/s");
> ??????????????????? if (nackRate > 0) {
> ??????????????????????? System.out.print(", nacks: " + nackRate + " n/s");
> ??????????????????? }
> ??????????????? }
> ??????????????? System.out.println();
> ??????????????? lastStatsTime = now;
> ??????????? }
> ??????? }
>
> ??????? private byte[] createMessage(int sequenceNumber)
> ??????????? throws IOException {
>
> ??????????? ByteArrayOutputStream acc = new ByteArrayOutputStream();
> ??????????? DataOutputStream d = new DataOutputStream(acc);
> ??????????? long nano = System.nanoTime();
> ??????????? d.writeInt(sequenceNumber);
> ??????????? d.writeLong(nano);
> ??????????? d.flush();
> ??????????? acc.flush();
> ??????????? byte[] m = acc.toByteArray();
> ??????????? if (m.length <= message.length) {
> ??????????????? System.arraycopy(m, 0, message, 0, m.length);
> ??????????????? return message;
> ??????????? } else {
> ??????????????? return m;
> ??????????? }
> ??????? }
>
> ??? }
>
> ??? public static class Consumer implements Runnable {
>
> ??????? private QueueingConsumer q;
> ??????? private String?????????? id;
> ??????? private int????????????? txSize;
> ??????? private boolean????????? autoAck;
> ??????? private Stats??????????? stats;
> ??????? private long???????????? timeLimit;
>
> ??????? public Consumer(QueueingConsumer q, String id,
> ??????????????????????? int txSize, boolean autoAck,
> ??????????????????????? Stats stats, int timeLimit) {
>
> ??????????? this.q???????? = q;
> ??????????? this.id??????? = id;
> ??????????? this.txSize??? = txSize;
> ??????????? this.autoAck?? = autoAck;
> ??????????? this.stats???? = stats;
> ??????????? this.timeLimit = 1000L * timeLimit;
> ??????? }
>
> ??????? public void run() {
>
> ??????????? long now;
> ??????????? long startTime;
> ??????????? startTime = now = System.currentTimeMillis();
> ??????????? int totalMsgCount = 0;
>
> ??????????? Channel channel = q.getChannel();
>
> ??????????? try {
>
> ??????????????? while (timeLimit == 0 || now < startTime + timeLimit) {
> ??????????????????? Delivery delivery;
> ??????????????????? if (timeLimit == 0) {
> ??????????????????????? delivery = q.nextDelivery();
> ??????????????????? } else {
> ??????????????????????? delivery = q.nextDelivery(startTime + timeLimit -
> now);
> ??????????????????????? if (delivery == null) break;
> ??????????????????? }
> ??? ??? ??? totalMsgCount++;
>
> ??????????????????? DataInputStream d = new DataInputStream(new
> ByteArrayInputStream(delivery.getBody()));
> ??????????????????? d.readInt();
> ??????????????????? long msgNano = d.readLong();
> ??????????????????? long nano = System.nanoTime();
>
> ??????????????????? Envelope envelope = delivery.getEnvelope();
>
> ??????????????????? if (!autoAck) {
> ??????????????????????? channel.basicAck(envelope.getDeliveryTag(), false);
> ??????????????????? }
>
> ??????????????????? if (txSize != 0 && totalMsgCount % txSize == 0) {
> ??????????????????????? channel.txCommit();
> ??????????????????? }
>
> ??????????????????? now = System.currentTimeMillis();
>
> ??????????????????? stats.collectStats(now,
> id.equals(envelope.getRoutingKey()) ? (nano - msgNano) : 0L);
> ??????????????? }
>
> ??????????? } catch (IOException e) {
> ??????????????? throw new RuntimeException(e);
> ??????????? } catch (InterruptedException e) {
> ??????????????? throw new RuntimeException (e);
> ??????????? } catch (ShutdownSignalException e) {
> ??????????????? throw new RuntimeException(e);
> ??????????? }
>
> ??????????? long elapsed = now - startTime;
> ??????????? if (elapsed > 0) {
> ??????????????? System.out.println("recving rate avg: " +
> ?????????????????????????????????? (totalMsgCount * 1000L / elapsed) +
> ?????????????????????????????????? " msg/s");
> ??????????? }
> ??????? }
>
> ??? }
>
> ??? public static class Stats {
>
> ??????? private long??? interval;
>
> ??????? private long??? lastStatsTime;
> ??????? private int???? msgCount;
> ??????? private int???? latencyCount;
> ??????? private long??? minLatency;
> ??????? private long??? maxLatency;
> ??????? private long??? cumulativeLatency;
>
> ??????? public Stats(long interval) {
> ??????????? this.interval = interval;
> ??????????? reset(System.currentTimeMillis());
> ??????? }
>
> ??????? private void reset(long t) {
> ??????????? lastStatsTime???? = t;
> ??????????? msgCount????????? = 0;
> ??????????? latencyCount????? = 0;
> ??????????? minLatency??????? = Long.MAX_VALUE;
> ??????????? maxLatency??????? = Long.MIN_VALUE;
> ??????????? cumulativeLatency = 0L;
> ??????? }
>
> ??????? public synchronized void collectStats(long now, long latency) {
> ??????????? msgCount++;
>
> ??????????? if (latency > 0) {
> ??????????????? minLatency = Math.min(minLatency, latency);
> ??????????????? maxLatency = Math.max(maxLatency, latency);
> ??????????????? cumulativeLatency += latency;
> ??????????????? latencyCount++;
> ??????????? }
>
> ??????????? long elapsed = now - lastStatsTime;
> ??????????? if (elapsed > interval) {
> ??????????????? System.out.println("recving rate: " +
> ?????????????????????????????????? (1000L * msgCount / elapsed) +
> ?????????????????????????????????? " msg/s" +
> ?????????????????????????????????? (latencyCount > 0 ?
> ??????????????????????????????????? ", min/avg/max latency: " +
> ??????????????????????????????????? minLatency/1000L + "/" +
> ??????????????????????????????????? cumulativeLatency / (1000L *
> latencyCount) + "/" +
> ??????????????????????????????????? maxLatency/1000L + " microseconds" :
> ??????????????????????????????????? ""));
> ??????????????? reset(now);
> ??????????? }
>
> ??????? }
>
> ??? }
>
> }
>
>
> On Fri, Jul 15, 2011 at 7:06 PM, Eugene Kirpichov <ekirpichov at gmail.com>
> wrote:
>>
>> I am sorry but this link doesn't have any source code - this is the
>> library.
>> I meant *your* source code, the code of your program; the code which
>> exercises the library and gets 5000 msg/s.
>>
>> P.S. Please use "Reply all", this discussion is most probably
>> interesting for many people in the community.
>>
>> 2011/7/15 News Aanad <news.anand11 at gmail.com>:
>> > I am following this link for my java code:
>> >
>> > http://www.rabbitmq.com/releases/rabbitmq-java-client/v2.5.1/rabbitmq-java-client-bin-2.5.1.tar.gz
>> >
>> > On Fri, Jul 15, 2011 at 6:56 PM, Eugene Kirpichov <ekirpichov at gmail.com>
>> > wrote:
>> >>
>> >> Please show the source code of all participating components. It's
>> >> impossible to say anything definite without it.
>> >>
>> >> 2011/7/15 News Aanad <news.anand11 at gmail.com>:
>> >> >
>> >> > Till now i am getting the result of 5000 msg/sec in java.
>> >> >
>> >> > On Fri, Jul 15, 2011 at 6:53 PM, Eugene Kirpichov
>> >> > <ekirpichov at gmail.com>
>> >> > wrote:
>> >> >>
>> >> >> I guess you should get the speed you want, and much more, if you
>> >> >> just
>> >> >> set up a high enough value for prefetch (see basic.qos) and set
>> >> >> autoack.
>> >> >> I got ~8k msg/s with much larger messages and persistence turned on
>> >> >> too.
>> >> >>
>> >> >> 2011/7/15 News Aanad <news.anand11 at gmail.com>:
>> >> >> >
>> >> >> > Message size is 199 bytes
>> >> >> > Messaging scenario is Persistence
>> >> >> >
>> >> >> > On Fri, Jul 15, 2011 at 6:47 PM, Eugene Kirpichov
>> >> >> > <ekirpichov at gmail.com>
>> >> >> > wrote:
>> >> >> >>
>> >> >> >> Hi.
>> >> >> >>
>> >> >> >> What's the size of messages?
>> >> >> >
>> >> >> >> What's your messaging scenario in general? Persistence, prefetch,
>> >> >> >> transactions?
>> >> >> >
>> >> >> >>
>> >> >> >> 2011/7/15 News Aanad <news.anand11 at gmail.com>:
>> >> >> >> > Hi, I wanted to achieve the goal of 15000 msg/sec in RabbitMQ.
>> >> >> >> > I
>> >> >> >> > have
>> >> >> >> > tried a lot in java as well as in ruby. And right now
>> >> >> >> > implementing
>> >> >> >> > node.js .
>> >> >> >> > I want to prefer java because after lots of experimentation the
>> >> >> >> > only
>> >> >> >> > java has given me good result but still goal is not achieved.
>> >> >> >> > So i want help to know how to reach upto 15000 msg/sec in
>> >> >> >> > RabbitMQ
>> >> >> >> > using java. If any good suggestion ?is there please tell me or
>> >> >> >> > if
>> >> >> >> > any
>> >> >> >> > site to prefer then please tell me.
>> >> >> >> >
>> >> >> >> > Thanks.
>> >> >> >> > _______________________________________________
>> >> >> >> > rabbitmq-discuss mailing list
>> >> >> >> > rabbitmq-discuss at lists.rabbitmq.com
>> >> >> >> >
>> >> >> >> >
>> >> >> >> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >> >> >> >
>> >> >> >>
>> >> >> >>
>> >> >> >>
>> >> >> >> --
>> >> >> >> Eugene Kirpichov
>> >> >> >> Principal Engineer, Mirantis Inc. http://www.mirantis.com/
>> >> >> >> Editor, http://fprog.ru/
>> >> >> >
>> >> >> >
>> >> >>
>> >> >>
>> >> >>
>> >> >> --
>> >> >> Eugene Kirpichov
>> >> >> Principal Engineer, Mirantis Inc. http://www.mirantis.com/
>> >> >> Editor, http://fprog.ru/
>> >> >
>> >> >
>> >>
>> >>
>> >>
>> >> --
>> >> Eugene Kirpichov
>> >> Principal Engineer, Mirantis Inc. http://www.mirantis.com/
>> >> Editor, http://fprog.ru/
>> >
>> >
>>
>>
>>
>> --
>> Eugene Kirpichov
>> Principal Engineer, Mirantis Inc. http://www.mirantis.com/
>> Editor, http://fprog.ru/
>
>



-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/

From news.anand11 at gmail.com  Fri Jul 15 18:08:58 2011
From: news.anand11 at gmail.com (News Aanad)
Date: Fri, 15 Jul 2011 22:38:58 +0530
Subject: [rabbitmq-discuss] 15000 msg/sec
In-Reply-To: <CANVKUrUJ4X6mxoS3Lo5tjsfBguLzA_E40z-dVETA-9pJ-EEUdg@mail.gmail.com>
References: <cca8b833-4263-4b7d-b03e-cf6c0c1acc83@g5g2000prn.googlegroups.com>
	<CANVKUrU=5TuhGmMD+94E-yEp6ctGDFXGwxLpL92vg+Vtc=MmAQ@mail.gmail.com>
	<CAL9wd7cx9ppeJ3GErjBuwSFHXiF8JRdHHvapRH4pdhOUnn3b-A@mail.gmail.com>
	<CANVKUrWK6ZDimx4bFjLEszGzvy10vomY3ypf5Xg55orwREgXCQ@mail.gmail.com>
	<CAL9wd7cmB+Z6TcY0QWbD2aG3Z_GvHUtGvx6hyKpeid8of-boUA@mail.gmail.com>
	<CANVKUrUpjtid78j=1ZdXJB946irJBHquGDf_UBWKO_hCxKh75g@mail.gmail.com>
	<CAL9wd7epatwRF=ioUkik22NN3b6p+7+UEBeqzn50-YNOkJHMvQ@mail.gmail.com>
	<CANVKUrXLPceXpR2DQ_r_=vYvJWmKq5=y-4xkYACKai+9fLYc=A@mail.gmail.com>
	<CAL9wd7ebwnbm2=o0-U9pptqe=zfhbdNiuZrrhbtnk=6Q2XPbjg@mail.gmail.com>
	<CANVKUrUJ4X6mxoS3Lo5tjsfBguLzA_E40z-dVETA-9pJ-EEUdg@mail.gmail.com>
Message-ID: <CAL9wd7cdwqA5VnVyfvnuQ2wSzwC=cAiBZWuSM+KL1oNUbdz8Gg@mail.gmail.com>

Thanks for reply Eugene Kirpichov ,
One more help, Can you suggest me any reference site from where i can follow
and code for my goal?

On Fri, Jul 15, 2011 at 7:57 PM, Eugene Kirpichov <ekirpichov at gmail.com>wrote:

> Is this the minimal piece of code that demonstrates poor performance?
> It's hard to decipher that much code and it can have many kinds of
> problems inside; I think you should be able to trim it down to a
> couple dozen lines demonstrating the same speed; then diagnosing will
> become a lot easier.
>
> 2011/7/15 News Aanad <news.anand11 at gmail.com>:
> > This is my code.
> >
> >
> > //  The contents of this file are subject to the Mozilla Public License
> > //  Version 1.1 (the "License"); you may not use this file except in
> > //  compliance with the License. You may obtain a copy of the License
> > //  at http://www.mozilla.org/MPL/
> > //
> > //  Software distributed under the License is distributed on an "AS IS"
> > //  basis, WITHOUT WARRANTY OF ANY KIND, either express or implied. See
> > //  the License for the specific language governing rights and
> > //  limitations under the License.
> > //
> > //  The Original Code is RabbitMQ.
> > //
> > //  The Initial Developer of the Original Code is VMware, Inc.
> > //  Copyright (c) 2007-2011 VMware, Inc.  All rights reserved.
> > //
> >
> >
> > package com.rabbitmq.examples;
> >
> > import java.io.ByteArrayInputStream;
> > import java.io.ByteArrayOutputStream;
> > import java.io.DataInputStream;
> > import java.io.DataOutputStream;
> > import java.io.IOException;
> > import java.util.Arrays;
> > import java.util.Collections;
> > import java.util.List;
> > import java.util.SortedSet;
> > import java.util.TreeSet;
> > import java.util.UUID;
> > import java.util.concurrent.Semaphore;
> >
> > import org.apache.commons.cli.CommandLine;
> > import org.apache.commons.cli.CommandLineParser;
> > import org.apache.commons.cli.GnuParser;
> > import org.apache.commons.cli.HelpFormatter;
> > import org.apache.commons.cli.Option;
> > import org.apache.commons.cli.Options;
> > import org.apache.commons.cli.ParseException;
> >
> > import com.rabbitmq.client.AMQP;
> > import com.rabbitmq.client.Channel;
> > import com.rabbitmq.client.ConfirmListener;
> > import com.rabbitmq.client.Connection;
> > import com.rabbitmq.client.ConnectionFactory;
> > import com.rabbitmq.client.Envelope;
> > import com.rabbitmq.client.MessageProperties;
> > import com.rabbitmq.client.QueueingConsumer;
> > import com.rabbitmq.client.QueueingConsumer.Delivery;
> > import com.rabbitmq.client.ReturnListener;
> > import com.rabbitmq.client.ShutdownSignalException;
> >
> >
> > public class MulticastMain {
> >
> >     public static void main(String[] args) {
> >         Options options = getOptions();
> >         CommandLineParser parser = new GnuParser();
> >         try {
> >             CommandLine cmd = parser.parse(options, args);
> >
> >             if (cmd.hasOption('?')) {
> >                 usage(options);
> >                 System.exit(0);
> >             }
> >
> >             String hostName      = strArg(cmd, 'h', "localhost");
> >             int portNumber       = intArg(cmd, 'p', AMQP.PROTOCOL.PORT);
> >             String exchangeType  = strArg(cmd, 't', "direct");
> >             String exchangeName  = strArg(cmd, 'e', exchangeType);
> >             int samplingInterval = intArg(cmd, 'i', 1);
> >             int rateLimit        = intArg(cmd, 'r', 0);
> >             int producerCount    = intArg(cmd, 'x', 1);
> >             int consumerCount    = intArg(cmd, 'y', 1);
> >             int producerTxSize   = intArg(cmd, 'm', 0);
> >             int consumerTxSize   = intArg(cmd, 'n', 0);
> >             long confirm         = intArg(cmd, 'c', -1);
> >             boolean autoAck      = cmd.hasOption('a');
> >             int prefetchCount    = intArg(cmd, 'q', 0);
> >             int minMsgSize       = intArg(cmd, 's', 0);
> >             int timeLimit        = intArg(cmd, 'z', 0);
> >             List<?> flags        = lstArg(cmd, 'f');
> >             int frameMax         = intArg(cmd, 'M', 0);
> >             int heartbeat        = intArg(cmd, 'b', 0);
> >
> >             if ((producerTxSize > 0) && confirm >= 0) {
> >                 throw new ParseException("Cannot select both
> > producerTxSize"+
> >                                          " and confirm");
> >             }
> >
> >             //setup
> >             String id = UUID.randomUUID().toString();
> >             Stats stats = new Stats(1000L * samplingInterval);
> >             ConnectionFactory factory = new ConnectionFactory();
> >             factory.setHost(hostName);
> >             factory.setPort(portNumber);
> >             factory.setRequestedFrameMax(frameMax);
> >             factory.setRequestedHeartbeat(heartbeat);
> >
> >             Thread[] consumerThreads = new Thread[consumerCount];
> >             Connection[] consumerConnections = new
> > Connection[consumerCount];
> >             for (int i = 0; i < consumerCount; i++) {
> >                 System.out.println("starting consumer #" + i);
> >                 Connection conn = factory.newConnection();
> >                 consumerConnections[i] = conn;
> >                 Channel channel = conn.createChannel();
> >                 if (consumerTxSize > 0) channel.txSelect();
> >                 channel.exchangeDeclare(exchangeName, exchangeType);
> >                 String queueName =
> >                         channel.queueDeclare("",
> > flags.contains("persistent"),
> >                                              true, false,
> null).getQueue();
> >                 QueueingConsumer consumer = new
> QueueingConsumer(channel);
> >                 if (prefetchCount > 0) channel.basicQos(prefetchCount);
> >                 channel.basicConsume(queueName, autoAck, consumer);
> >                 channel.queueBind(queueName, exchangeName, id);
> >                 Thread t =
> >                     new Thread(new Consumer(consumer, id,
> >                                             consumerTxSize, autoAck,
> >                                             stats, timeLimit));
> >                 consumerThreads[i] = t;
> >                 t.start();
> >             }
> >             Thread[] producerThreads = new Thread[producerCount];
> >             Connection[] producerConnections = new
> > Connection[producerCount];
> >             for (int i = 0; i < producerCount; i++) {
> >                 System.out.println("starting producer #" + i);
> >                 Connection conn = factory.newConnection();
> >                 producerConnections[i] = conn;
> >                 Channel channel = conn.createChannel();
> >                 if (producerTxSize > 0) channel.txSelect();
> >                 if (confirm >= 0) channel.confirmSelect();
> >                 channel.exchangeDeclare(exchangeName, exchangeType);
> >                 final Producer p = new Producer(channel, exchangeName,
> id,
> >                                                 flags, producerTxSize,
> >                                                 1000L * samplingInterval,
> >                                                 rateLimit, minMsgSize,
> > timeLimit,
> >                                                 confirm);
> >                 channel.setReturnListener(p);
> >                 channel.setConfirmListener(p);
> >                 Thread t = new Thread(p);
> >                 producerThreads[i] = t;
> >                 t.start();
> >             }
> >
> >             for (int i = 0; i < producerCount; i++) {
> >                 producerThreads[i].join();
> >                 producerConnections[i].close();
> >             }
> >
> >             for (int i = 0; i < consumerCount; i++) {
> >                 consumerThreads[i].join();
> >                 consumerConnections[i].close();
> >             }
> >
> >         }
> >         catch( ParseException exp ) {
> >             System.err.println("Parsing failed. Reason: " +
> > exp.getMessage());
> >             usage(options);
> >         } catch (Exception e) {
> >             System.err.println("Main thread caught exception: " + e);
> >             e.printStackTrace();
> >             System.exit(1);
> >         }
> >     }
> >
> >     private static void usage(Options options) {
> >         HelpFormatter formatter = new HelpFormatter();
> >         formatter.printHelp("<program>", options);
> >     }
> >
> >     private static Options getOptions() {
> >         Options options = new Options();
> >         options.addOption(new Option("?", "help",      false,"show
> usage"));
> >         options.addOption(new Option("h", "host",      true, "broker
> > host"));
> >         options.addOption(new Option("p", "port",      true, "broker
> > port"));
> >         options.addOption(new Option("t", "type",      true, "exchange
> > type"));
> >         options.addOption(new Option("e", "exchange",  true, "exchange
> > name"));
> >         options.addOption(new Option("i", "interval",  true, "sampling
> > interval"));
> >         options.addOption(new Option("r", "rate",      true, "rate
> limit"));
> >         options.addOption(new Option("x", "producers", true, "producer
> > count"));
> >         options.addOption(new Option("y", "consumers", true, "consumer
> > count"));
> >         options.addOption(new Option("m", "ptxsize",   true, "producer tx
> > size"));
> >         options.addOption(new Option("n", "ctxsize",   true, "consumer tx
> > size"));
> >         options.addOption(new Option("c", "confirm",   true, "max
> > unconfirmed publishes"));
> >         options.addOption(new Option("a", "autoack",   false,"auto
> ack"));
> >         options.addOption(new Option("q", "qos",       true, "qos
> prefetch
> > count"));
> >         options.addOption(new Option("s", "size",      true, "message
> > size"));
> >         options.addOption(new Option("z", "time",      true, "time
> limit"));
> >         Option flag =     new Option("f", "flag",      true, "message
> > flag");
> >         flag.setArgs(Option.UNLIMITED_VALUES);
> >         options.addOption(flag);
> >         options.addOption(new Option("M", "framemax",  true, "frame
> max"));
> >         options.addOption(new Option("b", "heartbeat", true, "heartbeat
> > interval"));
> >         return options;
> >     }
> >
> >     private static String strArg(CommandLine cmd, char opt, String def) {
> >         return cmd.getOptionValue(opt, def);
> >     }
> >
> >     private static int intArg(CommandLine cmd, char opt, int def) {
> >         return Integer.parseInt(cmd.getOptionValue(opt,
> > Integer.toString(def)));
> >     }
> >
> >     private static List<?> lstArg(CommandLine cmd, char opt) {
> >         String[] vals = cmd.getOptionValues('f');
> >         if (vals == null) {
> >             vals = new String[] {};
> >         }
> >         return Arrays.asList(vals);
> >     }
> >
> >     public static class Producer implements Runnable, ReturnListener,
> >                                             ConfirmListener
> >     {
> >         private Channel channel;
> >         private String  exchangeName;
> >         private String  id;
> >         private boolean mandatory;
> >         private boolean immediate;
> >         private boolean persistent;
> >         private int     txSize;
> >         private long    interval;
> >         private int     rateLimit;
> >         private long    timeLimit;
> >
> >         private byte[]  message;
> >
> >         private long    startTime;
> >         private long    lastStatsTime;
> >         private int     msgCount;
> >         private int     returnCount;
> >
> >         private long      confirm;
> >         private Semaphore confirmPool;
> >         private long      confirmCount;
> >         private long      nackCount;
> >         private volatile SortedSet<Long> unconfirmedSet =
> >             Collections.synchronizedSortedSet(new TreeSet<Long>());
> >
> >         public Producer(Channel channel, String exchangeName, String id,
> >                         List<?> flags, int txSize,
> >                         long interval, int rateLimit, int minMsgSize, int
> > timeLimit,
> >                         long confirm)
> >             throws IOException {
> >
> >             this.channel      = channel;
> >             this.exchangeName = exchangeName;
> >             this.id           = id;
> >             this.mandatory    = flags.contains("mandatory");
> >             this.immediate    = flags.contains("immediate");
> >             this.persistent   = flags.contains("persistent");
> >             this.txSize       = txSize;
> >             this.interval     = interval;
> >             this.rateLimit    = rateLimit;
> >             this.timeLimit    = 1000L * timeLimit;
> >             this.message      = new byte[minMsgSize];
> >             this.confirm      = confirm;
> >             if (confirm > 0) {
> >                 this.confirmPool  = new Semaphore((int)confirm);
> >             }
> >         }
> >
> >         public synchronized void handleReturn(int replyCode,
> >                                               String replyText,
> >                                               String exchange,
> >                                               String routingKey,
> >                                               AMQP.BasicProperties
> > properties,
> >                                               byte[] body)
> >             throws IOException {
> >             returnCount++;
> >         }
> >
> >         public void handleAck(long seqNo, boolean multiple) {
> >             handleAckNack(seqNo, multiple, false);
> >         }
> >
> >         public void handleNack(long seqNo, boolean multiple) {
> >             handleAckNack(seqNo, multiple, true);
> >         }
> >
> >         private void handleAckNack(long seqNo, boolean multiple,
> >                                    boolean nack) {
> >             int numConfirms = 0;
> >             if (multiple) {
> >                 SortedSet<Long> confirmed = unconfirmedSet.headSet(seqNo
> +
> > 1);
> >                 numConfirms += confirmed.size();
> >                 confirmed.clear();
> >             } else {
> >                 unconfirmedSet.remove(seqNo);
> >                 numConfirms = 1;
> >             }
> >             synchronized (this) {
> >                 if (nack) {
> >                     nackCount += numConfirms;
> >                 } else {
> >                     confirmCount += numConfirms;
> >                 }
> >             }
> >
> >             if (confirmPool != null) {
> >                 for (int i = 0; i < numConfirms; ++i) {
> >                     confirmPool.release();
> >                 }
> >             }
> >
> >         }
> >
> >         public void run() {
> >
> >             long now;
> >             now = startTime = lastStatsTime = System.currentTimeMillis();
> >             msgCount = 0;
> >             int totalMsgCount = 0;
> >
> >             try {
> >
> >                 while (timeLimit == 0 || now < startTime + timeLimit) {
> >                     if (confirmPool != null) {
> >                         confirmPool.acquire();
> >                     }
> >                     delay(now);
> >                     publish(createMessage(totalMsgCount));
> >                     totalMsgCount++;
> >                     msgCount++;
> >
> >                     if (txSize != 0 && totalMsgCount % txSize == 0) {
> >                         channel.txCommit();
> >                     }
> >                     now = System.currentTimeMillis();
> >                 }
> >
> >             } catch (IOException e) {
> >                 throw new RuntimeException(e);
> >             } catch (InterruptedException e) {
> >                 throw new RuntimeException (e);
> >             }
> >
> >             System.out.println("sending rate avg: " +
> >                                (totalMsgCount * 1000L / (now -
> startTime)) +
> >                                " msg/s");
> >
> >         }
> >
> >         private void publish(byte[] msg)
> >             throws IOException {
> >
> >             unconfirmedSet.add(channel.getNextPublishSeqNo());
> >             channel.basicPublish(exchangeName, id,
> >                                  mandatory, immediate,
> >                                  persistent ?
> > MessageProperties.MINIMAL_PERSISTENT_BASIC :
> > MessageProperties.MINIMAL_BASIC,
> >                                  msg);
> >         }
> >
> >         private void delay(long now)
> >             throws InterruptedException {
> >
> >             long elapsed = now - lastStatsTime;
> >             //example: rateLimit is 5000 msg/s,
> >             //10 ms have elapsed, we have sent 200 messages
> >             //the 200 msgs we have actually sent should have taken us
> >             //200 * 1000 / 5000 = 40 ms. So we pause for 40ms - 10ms
> >             long pause = rateLimit == 0 ?
> >                 0 : (msgCount * 1000L / rateLimit - elapsed);
> >             if (pause > 0) {
> >                 Thread.sleep(pause);
> >             }
> >             if (elapsed > interval) {
> >                 long sendRate, returnRate, confirmRate, nackRate;
> >                 synchronized(this) {
> >                     sendRate     = msgCount     * 1000L / elapsed;
> >                     returnRate   = returnCount  * 1000L / elapsed;
> >                     confirmRate  = confirmCount * 1000L / elapsed;
> >                     nackRate     = nackCount    * 1000L / elapsed;
> >                     msgCount     = 0;
> >                     returnCount  = 0;
> >                     confirmCount = 0;
> >                     nackCount    = 0;
> >                 }
> >                 System.out.print("sending rate: " + sendRate + " msg/s");
> >                 if (mandatory || immediate) {
> >                     System.out.print(", returns: " + returnRate + "
> ret/s");
> >                 }
> >                 if (confirm >= 0) {
> >                     System.out.print(", confirms: " + confirmRate + "
> c/s");
> >                     if (nackRate > 0) {
> >                         System.out.print(", nacks: " + nackRate + "
> n/s");
> >                     }
> >                 }
> >                 System.out.println();
> >                 lastStatsTime = now;
> >             }
> >         }
> >
> >         private byte[] createMessage(int sequenceNumber)
> >             throws IOException {
> >
> >             ByteArrayOutputStream acc = new ByteArrayOutputStream();
> >             DataOutputStream d = new DataOutputStream(acc);
> >             long nano = System.nanoTime();
> >             d.writeInt(sequenceNumber);
> >             d.writeLong(nano);
> >             d.flush();
> >             acc.flush();
> >             byte[] m = acc.toByteArray();
> >             if (m.length <= message.length) {
> >                 System.arraycopy(m, 0, message, 0, m.length);
> >                 return message;
> >             } else {
> >                 return m;
> >             }
> >         }
> >
> >     }
> >
> >     public static class Consumer implements Runnable {
> >
> >         private QueueingConsumer q;
> >         private String           id;
> >         private int              txSize;
> >         private boolean          autoAck;
> >         private Stats            stats;
> >         private long             timeLimit;
> >
> >         public Consumer(QueueingConsumer q, String id,
> >                         int txSize, boolean autoAck,
> >                         Stats stats, int timeLimit) {
> >
> >             this.q         = q;
> >             this.id        = id;
> >             this.txSize    = txSize;
> >             this.autoAck   = autoAck;
> >             this.stats     = stats;
> >             this.timeLimit = 1000L * timeLimit;
> >         }
> >
> >         public void run() {
> >
> >             long now;
> >             long startTime;
> >             startTime = now = System.currentTimeMillis();
> >             int totalMsgCount = 0;
> >
> >             Channel channel = q.getChannel();
> >
> >             try {
> >
> >                 while (timeLimit == 0 || now < startTime + timeLimit) {
> >                     Delivery delivery;
> >                     if (timeLimit == 0) {
> >                         delivery = q.nextDelivery();
> >                     } else {
> >                         delivery = q.nextDelivery(startTime + timeLimit -
> > now);
> >                         if (delivery == null) break;
> >                     }
> >             totalMsgCount++;
> >
> >                     DataInputStream d = new DataInputStream(new
> > ByteArrayInputStream(delivery.getBody()));
> >                     d.readInt();
> >                     long msgNano = d.readLong();
> >                     long nano = System.nanoTime();
> >
> >                     Envelope envelope = delivery.getEnvelope();
> >
> >                     if (!autoAck) {
> >                         channel.basicAck(envelope.getDeliveryTag(),
> false);
> >                     }
> >
> >                     if (txSize != 0 && totalMsgCount % txSize == 0) {
> >                         channel.txCommit();
> >                     }
> >
> >                     now = System.currentTimeMillis();
> >
> >                     stats.collectStats(now,
> > id.equals(envelope.getRoutingKey()) ? (nano - msgNano) : 0L);
> >                 }
> >
> >             } catch (IOException e) {
> >                 throw new RuntimeException(e);
> >             } catch (InterruptedException e) {
> >                 throw new RuntimeException (e);
> >             } catch (ShutdownSignalException e) {
> >                 throw new RuntimeException(e);
> >             }
> >
> >             long elapsed = now - startTime;
> >             if (elapsed > 0) {
> >                 System.out.println("recving rate avg: " +
> >                                    (totalMsgCount * 1000L / elapsed) +
> >                                    " msg/s");
> >             }
> >         }
> >
> >     }
> >
> >     public static class Stats {
> >
> >         private long    interval;
> >
> >         private long    lastStatsTime;
> >         private int     msgCount;
> >         private int     latencyCount;
> >         private long    minLatency;
> >         private long    maxLatency;
> >         private long    cumulativeLatency;
> >
> >         public Stats(long interval) {
> >             this.interval = interval;
> >             reset(System.currentTimeMillis());
> >         }
> >
> >         private void reset(long t) {
> >             lastStatsTime     = t;
> >             msgCount          = 0;
> >             latencyCount      = 0;
> >             minLatency        = Long.MAX_VALUE;
> >             maxLatency        = Long.MIN_VALUE;
> >             cumulativeLatency = 0L;
> >         }
> >
> >         public synchronized void collectStats(long now, long latency) {
> >             msgCount++;
> >
> >             if (latency > 0) {
> >                 minLatency = Math.min(minLatency, latency);
> >                 maxLatency = Math.max(maxLatency, latency);
> >                 cumulativeLatency += latency;
> >                 latencyCount++;
> >             }
> >
> >             long elapsed = now - lastStatsTime;
> >             if (elapsed > interval) {
> >                 System.out.println("recving rate: " +
> >                                    (1000L * msgCount / elapsed) +
> >                                    " msg/s" +
> >                                    (latencyCount > 0 ?
> >                                     ", min/avg/max latency: " +
> >                                     minLatency/1000L + "/" +
> >                                     cumulativeLatency / (1000L *
> > latencyCount) + "/" +
> >                                     maxLatency/1000L + " microseconds" :
> >                                     ""));
> >                 reset(now);
> >             }
> >
> >         }
> >
> >     }
> >
> > }
> >
> >
> > On Fri, Jul 15, 2011 at 7:06 PM, Eugene Kirpichov <ekirpichov at gmail.com>
> > wrote:
> >>
> >> I am sorry but this link doesn't have any source code - this is the
> >> library.
> >> I meant *your* source code, the code of your program; the code which
> >> exercises the library and gets 5000 msg/s.
> >>
> >> P.S. Please use "Reply all", this discussion is most probably
> >> interesting for many people in the community.
> >>
> >> 2011/7/15 News Aanad <news.anand11 at gmail.com>:
> >> > I am following this link for my java code:
> >> >
> >> >
> http://www.rabbitmq.com/releases/rabbitmq-java-client/v2.5.1/rabbitmq-java-client-bin-2.5.1.tar.gz
> >> >
> >> > On Fri, Jul 15, 2011 at 6:56 PM, Eugene Kirpichov <
> ekirpichov at gmail.com>
> >> > wrote:
> >> >>
> >> >> Please show the source code of all participating components. It's
> >> >> impossible to say anything definite without it.
> >> >>
> >> >> 2011/7/15 News Aanad <news.anand11 at gmail.com>:
> >> >> >
> >> >> > Till now i am getting the result of 5000 msg/sec in java.
> >> >> >
> >> >> > On Fri, Jul 15, 2011 at 6:53 PM, Eugene Kirpichov
> >> >> > <ekirpichov at gmail.com>
> >> >> > wrote:
> >> >> >>
> >> >> >> I guess you should get the speed you want, and much more, if you
> >> >> >> just
> >> >> >> set up a high enough value for prefetch (see basic.qos) and set
> >> >> >> autoack.
> >> >> >> I got ~8k msg/s with much larger messages and persistence turned
> on
> >> >> >> too.
> >> >> >>
> >> >> >> 2011/7/15 News Aanad <news.anand11 at gmail.com>:
> >> >> >> >
> >> >> >> > Message size is 199 bytes
> >> >> >> > Messaging scenario is Persistence
> >> >> >> >
> >> >> >> > On Fri, Jul 15, 2011 at 6:47 PM, Eugene Kirpichov
> >> >> >> > <ekirpichov at gmail.com>
> >> >> >> > wrote:
> >> >> >> >>
> >> >> >> >> Hi.
> >> >> >> >>
> >> >> >> >> What's the size of messages?
> >> >> >> >
> >> >> >> >> What's your messaging scenario in general? Persistence,
> prefetch,
> >> >> >> >> transactions?
> >> >> >> >
> >> >> >> >>
> >> >> >> >> 2011/7/15 News Aanad <news.anand11 at gmail.com>:
> >> >> >> >> > Hi, I wanted to achieve the goal of 15000 msg/sec in
> RabbitMQ.
> >> >> >> >> > I
> >> >> >> >> > have
> >> >> >> >> > tried a lot in java as well as in ruby. And right now
> >> >> >> >> > implementing
> >> >> >> >> > node.js .
> >> >> >> >> > I want to prefer java because after lots of experimentation
> the
> >> >> >> >> > only
> >> >> >> >> > java has given me good result but still goal is not achieved.
> >> >> >> >> > So i want help to know how to reach upto 15000 msg/sec in
> >> >> >> >> > RabbitMQ
> >> >> >> >> > using java. If any good suggestion  is there please tell me
> or
> >> >> >> >> > if
> >> >> >> >> > any
> >> >> >> >> > site to prefer then please tell me.
> >> >> >> >> >
> >> >> >> >> > Thanks.
> >> >> >> >> > _______________________________________________
> >> >> >> >> > rabbitmq-discuss mailing list
> >> >> >> >> > rabbitmq-discuss at lists.rabbitmq.com
> >> >> >> >> >
> >> >> >> >> >
> >> >> >> >> >
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >> >> >> >> >
> >> >> >> >>
> >> >> >> >>
> >> >> >> >>
> >> >> >> >> --
> >> >> >> >> Eugene Kirpichov
> >> >> >> >> Principal Engineer, Mirantis Inc. http://www.mirantis.com/
> >> >> >> >> Editor, http://fprog.ru/
> >> >> >> >
> >> >> >> >
> >> >> >>
> >> >> >>
> >> >> >>
> >> >> >> --
> >> >> >> Eugene Kirpichov
> >> >> >> Principal Engineer, Mirantis Inc. http://www.mirantis.com/
> >> >> >> Editor, http://fprog.ru/
> >> >> >
> >> >> >
> >> >>
> >> >>
> >> >>
> >> >> --
> >> >> Eugene Kirpichov
> >> >> Principal Engineer, Mirantis Inc. http://www.mirantis.com/
> >> >> Editor, http://fprog.ru/
> >> >
> >> >
> >>
> >>
> >>
> >> --
> >> Eugene Kirpichov
> >> Principal Engineer, Mirantis Inc. http://www.mirantis.com/
> >> Editor, http://fprog.ru/
> >
> >
>
>
>
> --
> Eugene Kirpichov
> Principal Engineer, Mirantis Inc. http://www.mirantis.com/
> Editor, http://fprog.ru/
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110715/cdc1ef93/attachment.htm>

From csharpplusproject at gmail.com  Fri Jul 15 19:24:38 2011
From: csharpplusproject at gmail.com (Shalom Rav)
Date: Fri, 15 Jul 2011 11:24:38 -0700 (PDT)
Subject: [rabbitmq-discuss] =?windows-1252?q?Python_=26_RabbitMQ_=97_Commu?=
	=?windows-1252?q?nicate_Between_Parent_=26_Children=3F?=
Message-ID: <8bf5acfb-1c2f-43a8-b903-32b223c35780@p14g2000yqj.googlegroups.com>

I'd like to write a python app that uses rabbitMQ to do the following:

There will be ONE *parent*, and TEN workers.

Every 2[sec], the *parent* sends a message that must be consumed by
*all workers*.

Every 5[sec], each one of the *workers* should send a message directly
to the *parent*.


Both routes ( every 2[sec], message from *parent* to *all workers*;
every 5[sec], message from each *worker* straight to the parent ) must
run concurrently, at the same time.


How do I go about modeling it using rabbitMQ & python?

From jasonjwwilliams at gmail.com  Fri Jul 15 20:11:33 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Fri, 15 Jul 2011 13:11:33 -0600
Subject: [rabbitmq-discuss]
	=?utf-8?q?Python_=26_RabbitMQ_=E2=80=94_Commun?=
	=?utf-8?q?icate_Between_Parent_=26_Children=3F?=
In-Reply-To: <8bf5acfb-1c2f-43a8-b903-32b223c35780@p14g2000yqj.googlegroups.com>
References: <8bf5acfb-1c2f-43a8-b903-32b223c35780@p14g2000yqj.googlegroups.com>
Message-ID: <CAHZAEpep_PQw-Lnwzh2Tp7o+O-WQsdTSXTFJzwxteRoJuWtWOQ@mail.gmail.com>

Are the workers' published message replies to the parent's messages or
independent? If the latter, it sounds like a fanout exchange with a
private queue per work would work for the parent->child communication,
and then create a private anonymous queue for the parent and set the
"reply-to" header on the parent's messages to the name of it's private
queue. The children processes can then publish directly to that queue.

-J

On Fri, Jul 15, 2011 at 12:24 PM, Shalom Rav
<csharpplusproject at gmail.com> wrote:
> I'd like to write a python app that uses rabbitMQ to do the following:
>
> There will be ONE *parent*, and TEN workers.
>
> Every 2[sec], the *parent* sends a message that must be consumed by
> *all workers*.
>
> Every 5[sec], each one of the *workers* should send a message directly
> to the *parent*.
>
>
> Both routes ( every 2[sec], message from *parent* to *all workers*;
> every 5[sec], message from each *worker* straight to the parent ) must
> run concurrently, at the same time.
>
>
> How do I go about modeling it using rabbitMQ & python?
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From habtdemis at gmail.com  Fri Jul 15 20:18:09 2011
From: habtdemis at gmail.com (Demi Zike)
Date: Fri, 15 Jul 2011 14:18:09 -0500
Subject: [rabbitmq-discuss] Reading messages using basicGet
Message-ID: <CAJE2eFHC5dNYpL94C5Z=M7C071rZNmz5HRUjzXptZdUGdixaVA@mail.gmail.com>

I read the api-guide on your website at
http://www.rabbitmq.com/api-guide.html. Retrieving individual messages using
basicGet will get the job done but I am dealing with reading from multiple
queues.

I have a List of strings that store to which queues my app subscribed to
read messages from.  How can I read through each of them until I find a
message to return if there is one. And if I searched all the queues for
available messages and didn't find any message sent to any of them then I
want to return null. I understand this may not be your favourite question,
but I'm new to rabbitmq and I need help.

Thanks in advance,
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110715/5a904a2e/attachment.htm>

From jvarona at directpartners.com  Fri Jul 15 20:43:46 2011
From: jvarona at directpartners.com (Jorge Varona)
Date: Fri, 15 Jul 2011 12:43:46 -0700
Subject: [rabbitmq-discuss] Alice in Wonderland chasing the RabbitMq
Message-ID: <032637508AC6BB4D8B1521E650C6C88657860B8CE8@mail.directpartners.com>

I have to ask, why go with RabbitMQ. There were some serious problems with replication last time I checked, which could make it hard to scale.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110715/4e8d7852/attachment.htm>

From gmr at myyearbook.com  Fri Jul 15 21:54:06 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Fri, 15 Jul 2011 16:54:06 -0400
Subject: [rabbitmq-discuss] Alice in Wonderland chasing the RabbitMq
In-Reply-To: <032637508AC6BB4D8B1521E650C6C88657860B8CE8@mail.directpartners.com>
References: <032637508AC6BB4D8B1521E650C6C88657860B8CE8@mail.directpartners.com>
Message-ID: <CAL_e=0p3=4U7NoKu2PWkJvNBfWMvW-RKfPY5fET_sq0YO3m09w@mail.gmail.com>

Serious problems with replication? What are you replicating? Other than HA,
I'm having a hard time envisioning a desire to replicate queues since there
are multiple routing models to publish data across multiple nodes without
extra effort on your part.

I've scaled Rabbit to a fairly high velocity without any scaling issues. Not
sure what the gripe is here.

Regards,

Gavin

On Fri, Jul 15, 2011 at 3:43 PM, Jorge Varona <jvarona at directpartners.com>wrote:

> I have to ask, why go with RabbitMQ. There were some serious problems with
> replication last time I checked, which could make it hard to scale.****
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110715/d8c121a5/attachment.htm>

From csharpplusproject at gmail.com  Fri Jul 15 22:51:00 2011
From: csharpplusproject at gmail.com (csharpplusproject at gmail.com)
Date: Fri, 15 Jul 2011 21:51:00 +0000
Subject: [rabbitmq-discuss]
	=?windows-1252?q?Python_=26_RabbitMQ_=97_Commu?=
	=?windows-1252?q?nicate_Between_Parent_=26_Children=3F?=
Message-ID: <1172664034-1310766680-cardhu_decombobulator_blackberry.rim.net-1286063907-@b1.c23.bise6.blackberry>

Jason,

Thank you for your help.

The workers' messages to the parent are independent of the parent's message to the workers. These are two separate things that work in parallel. 

Note that the parents sends *the same message* to all workers, while (separately) each one of the workers sends *its own unique message* straight to the parent.

I am brand new to rabbitMQ -- is it possible to provide some further info / code snippets that would allow me to get a better sense of things?

Thanks,
Shalom. 

------Original Message------
From: Jason J. W. Williams
To: Shalom Rav
Cc: rabbitmq-discuss at lists.rabbitmq.com
Sent: Jul 15, 2011 15:11
Subject: Re: [rabbitmq-discuss] Python & RabbitMQ ? Communicate Between Parent & Children?

Are the workers' published message replies to the parent's messages or
independent? If the latter, it sounds like a fanout exchange with a
private queue per work would work for the parent->child communication,
and then create a private anonymous queue for the parent and set the
"reply-to" header on the parent's messages to the name of it's private
queue. The children processes can then publish directly to that queue.

-J

On Fri, Jul 15, 2011 at 12:24 PM, Shalom Rav
<csharpplusproject at gmail.com> wrote:
> I'd like to write a python app that uses rabbitMQ to do the following:
>
> There will be ONE *parent*, and TEN workers.
>
> Every 2[sec], the *parent* sends a message that must be consumed by
> *all workers*.
>
> Every 5[sec], each one of the *workers* should send a message directly
> to the *parent*.
>
>
> Both routes ( every 2[sec], message from *parent* to *all workers*;
> every 5[sec], message from each *worker* straight to the parent ) must
> run concurrently, at the same time.
>
>
> How do I go about modeling it using rabbitMQ & python?
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


Sent via BlackBerry from T-Mobile

From irrer at umich.edu  Fri Jul 15 22:55:29 2011
From: irrer at umich.edu (Jim Irrer)
Date: Fri, 15 Jul 2011 17:55:29 -0400
Subject: [rabbitmq-discuss] installing Pika
Message-ID: <CAK27CLruhKjWmswSKZt_fLkeSAam8FH3xMgZ1i-gYcwE_L6gNw@mail.gmail.com>

Hi -

I'm trying to install Pika on a Windows 7 64 bit system, and according to
the
instructions at http://www.rabbitmq.com/tutorials/tutorial-one-python.html
should first install easy_install, and then use that to install pip (an
installer
to install another installer to install what I want?  Whatever ...) but am
getting the following error:

C:\Program Files (x86)\Python32>python  d:\downloads\ez_setup.py
  File "d:\downloads\ez_setup.py", line 106
    except pkg_resources.VersionConflict, e:
                                        ^
SyntaxError: invalid syntax


Does anyone know how to proceed from here?

FYI - This is a new install of Python 3 and I'm new to Python.  The
ez_setup.py
file was downloaded from http://peak.telecommunity.com/dist/ez_setup.py .

Thanks for any hints,

- Jim

Jim Irrer     irrer at umich.edu       (734) 647-4409
University of Michigan Hospital Radiation Oncology
519 W. William St.             Ann Arbor, MI 48103
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110715/72076d0f/attachment.htm>

From gmr at myyearbook.com  Fri Jul 15 23:04:20 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Fri, 15 Jul 2011 18:04:20 -0400
Subject: [rabbitmq-discuss] installing Pika
In-Reply-To: <CAK27CLruhKjWmswSKZt_fLkeSAam8FH3xMgZ1i-gYcwE_L6gNw@mail.gmail.com>
References: <CAK27CLruhKjWmswSKZt_fLkeSAam8FH3xMgZ1i-gYcwE_L6gNw@mail.gmail.com>
Message-ID: <CAL_e=0ppw5nJvOmCU+D6-yWqbZmiZQXoky3POgVmp0bgbTqwGw@mail.gmail.com>

Pika does not work on Version 3 yet, it is only supported on 2.4->2.7 and
really should be used with 2.7 or 2.6.

Regards,

Gavin

On Fri, Jul 15, 2011 at 5:55 PM, Jim Irrer <irrer at umich.edu> wrote:

> Hi -
>
> I'm trying to install Pika on a Windows 7 64 bit system, and according to
> the
> instructions at http://www.rabbitmq.com/tutorials/tutorial-one-python.html
> should first install easy_install, and then use that to install pip (an
> installer
> to install another installer to install what I want?  Whatever ...) but am
> getting the following error:
>
> C:\Program Files (x86)\Python32>python  d:\downloads\ez_setup.py
>   File "d:\downloads\ez_setup.py", line 106
>     except pkg_resources.VersionConflict, e:
>                                         ^
> SyntaxError: invalid syntax
>
>
> Does anyone know how to proceed from here?
>
> FYI - This is a new install of Python 3 and I'm new to Python.  The
> ez_setup.py
> file was downloaded from http://peak.telecommunity.com/dist/ez_setup.py .
>
> Thanks for any hints,
>
> - Jim
>
> Jim Irrer     irrer at umich.edu       (734) 647-4409
> University of Michigan Hospital Radiation Oncology
> 519 W. William St.             Ann Arbor, MI 48103
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110715/1cc0926e/attachment.htm>

From irrer at umich.edu  Fri Jul 15 23:21:49 2011
From: irrer at umich.edu (Jim Irrer)
Date: Fri, 15 Jul 2011 18:21:49 -0400
Subject: [rabbitmq-discuss] installing Pika
In-Reply-To: <CAL_e=0ppw5nJvOmCU+D6-yWqbZmiZQXoky3POgVmp0bgbTqwGw@mail.gmail.com>
References: <CAK27CLruhKjWmswSKZt_fLkeSAam8FH3xMgZ1i-gYcwE_L6gNw@mail.gmail.com>
	<CAL_e=0ppw5nJvOmCU+D6-yWqbZmiZQXoky3POgVmp0bgbTqwGw@mail.gmail.com>
Message-ID: <CAK27CLonzQ2+KRHm-koFAKmV=M=bhr8mfWaNrF=KDK0-DEZeAw@mail.gmail.com>

Fair enough.  So I am running this from Eclipse, and imported the
ez_setup.py
file into my project, set the grammar compatibility to 2.7, and get the
the different error on line 99

import setuptools; setuptools.bootstrap_install_from = egg


*Unresolved import: setuptools*


Is there another library that I need to install first?

Thanks,

- Jim

Jim Irrer     irrer at umich.edu       (734) 647-4409
University of Michigan Hospital Radiation Oncology
519 W. William St.             Ann Arbor, MI 48103


On Fri, Jul 15, 2011 at 6:04 PM, Gavin M. Roy <gmr at myyearbook.com> wrote:

> Pika does not work on Version 3 yet, it is only supported on 2.4->2.7 and
> really should be used with 2.7 or 2.6.
>
> Regards,
>
> Gavin
>
> On Fri, Jul 15, 2011 at 5:55 PM, Jim Irrer <irrer at umich.edu> wrote:
>
>> Hi -
>>
>> I'm trying to install Pika on a Windows 7 64 bit system, and according to
>> the
>> instructions at
>> http://www.rabbitmq.com/tutorials/tutorial-one-python.html
>> should first install easy_install, and then use that to install pip (an
>> installer
>> to install another installer to install what I want?  Whatever ...) but am
>> getting the following error:
>>
>> C:\Program Files (x86)\Python32>python  d:\downloads\ez_setup.py
>>   File "d:\downloads\ez_setup.py", line 106
>>     except pkg_resources.VersionConflict, e:
>>                                         ^
>> SyntaxError: invalid syntax
>>
>>
>> Does anyone know how to proceed from here?
>>
>> FYI - This is a new install of Python 3 and I'm new to Python.  The
>> ez_setup.py
>> file was downloaded from http://peak.telecommunity.com/dist/ez_setup.py .
>>
>> Thanks for any hints,
>>
>> - Jim
>>
>> Jim Irrer     irrer at umich.edu       (734) 647-4409
>> University of Michigan Hospital Radiation Oncology
>> 519 W. William St.             Ann Arbor, MI 48103
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110715/37d8a3a3/attachment.htm>

From irrer at umich.edu  Fri Jul 15 23:26:27 2011
From: irrer at umich.edu (Jim Irrer)
Date: Fri, 15 Jul 2011 18:26:27 -0400
Subject: [rabbitmq-discuss] installing Pika
In-Reply-To: <CAK27CLonzQ2+KRHm-koFAKmV=M=bhr8mfWaNrF=KDK0-DEZeAw@mail.gmail.com>
References: <CAK27CLruhKjWmswSKZt_fLkeSAam8FH3xMgZ1i-gYcwE_L6gNw@mail.gmail.com>
	<CAL_e=0ppw5nJvOmCU+D6-yWqbZmiZQXoky3POgVmp0bgbTqwGw@mail.gmail.com>
	<CAK27CLonzQ2+KRHm-koFAKmV=M=bhr8mfWaNrF=KDK0-DEZeAw@mail.gmail.com>
Message-ID: <CAK27CLpSn6GndhM5RELKj9+CYhkQ-HvJ+3=DPPtgE03VFvn5uw@mail.gmail.com>

Forgot to add that there are also unresolved imports with

urllib2
pkg_resources
main


Thanks,

- Jim

Jim Irrer     irrer at umich.edu       (734) 647-4409
University of Michigan Hospital Radiation Oncology
519 W. William St.             Ann Arbor, MI 48103


On Fri, Jul 15, 2011 at 6:21 PM, Jim Irrer <irrer at umich.edu> wrote:

> Fair enough.  So I am running this from Eclipse, and imported the
> ez_setup.py
> file into my project, set the grammar compatibility to 2.7, and get the
> the different error on line 99
>
> import setuptools; setuptools.bootstrap_install_from = egg
>
>
> *Unresolved import: setuptools*
>
>
> Is there another library that I need to install first?
>
> Thanks,
>
>
> - Jim
>
> Jim Irrer     irrer at umich.edu       (734) 647-4409
> University of Michigan Hospital Radiation Oncology
> 519 W. William St.             Ann Arbor, MI 48103
>
>
> On Fri, Jul 15, 2011 at 6:04 PM, Gavin M. Roy <gmr at myyearbook.com> wrote:
>
>> Pika does not work on Version 3 yet, it is only supported on 2.4->2.7 and
>> really should be used with 2.7 or 2.6.
>>
>> Regards,
>>
>> Gavin
>>
>> On Fri, Jul 15, 2011 at 5:55 PM, Jim Irrer <irrer at umich.edu> wrote:
>>
>>> Hi -
>>>
>>> I'm trying to install Pika on a Windows 7 64 bit system, and according to
>>> the
>>> instructions at
>>> http://www.rabbitmq.com/tutorials/tutorial-one-python.html
>>> should first install easy_install, and then use that to install pip (an
>>> installer
>>> to install another installer to install what I want?  Whatever ...) but
>>> am
>>> getting the following error:
>>>
>>> C:\Program Files (x86)\Python32>python  d:\downloads\ez_setup.py
>>>   File "d:\downloads\ez_setup.py", line 106
>>>     except pkg_resources.VersionConflict, e:
>>>                                         ^
>>> SyntaxError: invalid syntax
>>>
>>>
>>> Does anyone know how to proceed from here?
>>>
>>> FYI - This is a new install of Python 3 and I'm new to Python.  The
>>> ez_setup.py
>>> file was downloaded from http://peak.telecommunity.com/dist/ez_setup.py.
>>>
>>> Thanks for any hints,
>>>
>>> - Jim
>>>
>>> Jim Irrer     irrer at umich.edu       (734) 647-4409
>>> University of Michigan Hospital Radiation Oncology
>>> 519 W. William St.             Ann Arbor, MI 48103
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110715/17d0df30/attachment.htm>

From gmr at myyearbook.com  Fri Jul 15 23:39:58 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Fri, 15 Jul 2011 18:39:58 -0400
Subject: [rabbitmq-discuss] installing Pika
In-Reply-To: <CAK27CLpSn6GndhM5RELKj9+CYhkQ-HvJ+3=DPPtgE03VFvn5uw@mail.gmail.com>
References: <CAK27CLruhKjWmswSKZt_fLkeSAam8FH3xMgZ1i-gYcwE_L6gNw@mail.gmail.com>
	<CAL_e=0ppw5nJvOmCU+D6-yWqbZmiZQXoky3POgVmp0bgbTqwGw@mail.gmail.com>
	<CAK27CLonzQ2+KRHm-koFAKmV=M=bhr8mfWaNrF=KDK0-DEZeAw@mail.gmail.com>
	<CAK27CLpSn6GndhM5RELKj9+CYhkQ-HvJ+3=DPPtgE03VFvn5uw@mail.gmail.com>
Message-ID: <CAL_e=0qymuo30-YKbu4qJMahAKLS2np+juOziuhV-5ZMkHV04w@mail.gmail.com>

You'll need to install setuptools. It's a fairly common core bit with Python
installed on most systems.

http://pypi.python.org/pypi/setuptools

Once installed when you run:

"easy_install pika"

all dependencies are installed.

Cheers,

Gavin

On Fri, Jul 15, 2011 at 6:26 PM, Jim Irrer <irrer at umich.edu> wrote:

> Forgot to add that there are also unresolved imports with
>
> urllib2
> pkg_resources
> main
>
>
> Thanks,
>
> - Jim
>
> Jim Irrer     irrer at umich.edu       (734) 647-4409
> University of Michigan Hospital Radiation Oncology
> 519 W. William St.             Ann Arbor, MI 48103
>
>
> On Fri, Jul 15, 2011 at 6:21 PM, Jim Irrer <irrer at umich.edu> wrote:
>
>> Fair enough.  So I am running this from Eclipse, and imported the
>> ez_setup.py
>> file into my project, set the grammar compatibility to 2.7, and get the
>> the different error on line 99
>>
>> import setuptools; setuptools.bootstrap_install_from = egg
>>
>>
>> *Unresolved import: setuptools*
>>
>>
>> Is there another library that I need to install first?
>>
>> Thanks,
>>
>>
>> - Jim
>>
>> Jim Irrer     irrer at umich.edu       (734) 647-4409
>> University of Michigan Hospital Radiation Oncology
>> 519 W. William St.             Ann Arbor, MI 48103
>>
>>
>> On Fri, Jul 15, 2011 at 6:04 PM, Gavin M. Roy <gmr at myyearbook.com> wrote:
>>
>>> Pika does not work on Version 3 yet, it is only supported on 2.4->2.7 and
>>> really should be used with 2.7 or 2.6.
>>>
>>> Regards,
>>>
>>> Gavin
>>>
>>> On Fri, Jul 15, 2011 at 5:55 PM, Jim Irrer <irrer at umich.edu> wrote:
>>>
>>>> Hi -
>>>>
>>>> I'm trying to install Pika on a Windows 7 64 bit system, and according
>>>> to the
>>>> instructions at
>>>> http://www.rabbitmq.com/tutorials/tutorial-one-python.html
>>>> should first install easy_install, and then use that to install pip (an
>>>> installer
>>>> to install another installer to install what I want?  Whatever ...) but
>>>> am
>>>> getting the following error:
>>>>
>>>> C:\Program Files (x86)\Python32>python  d:\downloads\ez_setup.py
>>>>   File "d:\downloads\ez_setup.py", line 106
>>>>     except pkg_resources.VersionConflict, e:
>>>>                                         ^
>>>> SyntaxError: invalid syntax
>>>>
>>>>
>>>> Does anyone know how to proceed from here?
>>>>
>>>> FYI - This is a new install of Python 3 and I'm new to Python.  The
>>>> ez_setup.py
>>>> file was downloaded from http://peak.telecommunity.com/dist/ez_setup.py.
>>>>
>>>> Thanks for any hints,
>>>>
>>>> - Jim
>>>>
>>>> Jim Irrer     irrer at umich.edu       (734) 647-4409
>>>> University of Michigan Hospital Radiation Oncology
>>>> 519 W. William St.             Ann Arbor, MI 48103
>>>>
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>
>>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110715/015aee93/attachment.htm>

From irrer at umich.edu  Sat Jul 16 00:12:39 2011
From: irrer at umich.edu (Jim Irrer)
Date: Fri, 15 Jul 2011 19:12:39 -0400
Subject: [rabbitmq-discuss] installing Pika
In-Reply-To: <CAL_e=0qymuo30-YKbu4qJMahAKLS2np+juOziuhV-5ZMkHV04w@mail.gmail.com>
References: <CAK27CLruhKjWmswSKZt_fLkeSAam8FH3xMgZ1i-gYcwE_L6gNw@mail.gmail.com>
	<CAL_e=0ppw5nJvOmCU+D6-yWqbZmiZQXoky3POgVmp0bgbTqwGw@mail.gmail.com>
	<CAK27CLonzQ2+KRHm-koFAKmV=M=bhr8mfWaNrF=KDK0-DEZeAw@mail.gmail.com>
	<CAK27CLpSn6GndhM5RELKj9+CYhkQ-HvJ+3=DPPtgE03VFvn5uw@mail.gmail.com>
	<CAL_e=0qymuo30-YKbu4qJMahAKLS2np+juOziuhV-5ZMkHV04w@mail.gmail.com>
Message-ID: <CAK27CLp4Sooi-r7+tYatXGR1f5r=a0ZmVTJ3jEtf_SinHfydZA@mail.gmail.com>

Ok, I uninstalled Python 3, installed Python 2.7, and then tried to
install setuptools but it complains:

Python version 2.7 required, which was not found in the registry.


and the installer does not allow any input after that.

Thanks for your patience,

- Jim

Jim Irrer     irrer at umich.edu       (734) 647-4409
University of Michigan Hospital Radiation Oncology
519 W. William St.             Ann Arbor, MI 48103


On Fri, Jul 15, 2011 at 6:39 PM, Gavin M. Roy <gmr at myyearbook.com> wrote:

> You'll need to install setuptools. It's a fairly common core bit with
> Python installed on most systems.
>
> http://pypi.python.org/pypi/setuptools
>
> Once installed when you run:
>
> "easy_install pika"
>
> all dependencies are installed.
>
> Cheers,
>
> Gavin
>
>
> On Fri, Jul 15, 2011 at 6:26 PM, Jim Irrer <irrer at umich.edu> wrote:
>
>> Forgot to add that there are also unresolved imports with
>>
>> urllib2
>> pkg_resources
>> main
>>
>>
>> Thanks,
>>
>> - Jim
>>
>> Jim Irrer     irrer at umich.edu       (734) 647-4409
>> University of Michigan Hospital Radiation Oncology
>> 519 W. William St.             Ann Arbor, MI 48103
>>
>>
>> On Fri, Jul 15, 2011 at 6:21 PM, Jim Irrer <irrer at umich.edu> wrote:
>>
>>> Fair enough.  So I am running this from Eclipse, and imported the
>>> ez_setup.py
>>> file into my project, set the grammar compatibility to 2.7, and get the
>>> the different error on line 99
>>>
>>> import setuptools; setuptools.bootstrap_install_from = egg
>>>
>>>
>>> *Unresolved import: setuptools*
>>>
>>>
>>> Is there another library that I need to install first?
>>>
>>> Thanks,
>>>
>>>
>>> - Jim
>>>
>>> Jim Irrer     irrer at umich.edu       (734) 647-4409
>>> University of Michigan Hospital Radiation Oncology
>>> 519 W. William St.             Ann Arbor, MI 48103
>>>
>>>
>>> On Fri, Jul 15, 2011 at 6:04 PM, Gavin M. Roy <gmr at myyearbook.com>wrote:
>>>
>>>> Pika does not work on Version 3 yet, it is only supported on 2.4->2.7
>>>> and really should be used with 2.7 or 2.6.
>>>>
>>>> Regards,
>>>>
>>>> Gavin
>>>>
>>>> On Fri, Jul 15, 2011 at 5:55 PM, Jim Irrer <irrer at umich.edu> wrote:
>>>>
>>>>> Hi -
>>>>>
>>>>> I'm trying to install Pika on a Windows 7 64 bit system, and according
>>>>> to the
>>>>> instructions at
>>>>> http://www.rabbitmq.com/tutorials/tutorial-one-python.html
>>>>> should first install easy_install, and then use that to install pip (an
>>>>> installer
>>>>> to install another installer to install what I want?  Whatever ...) but
>>>>> am
>>>>> getting the following error:
>>>>>
>>>>> C:\Program Files (x86)\Python32>python  d:\downloads\ez_setup.py
>>>>>   File "d:\downloads\ez_setup.py", line 106
>>>>>     except pkg_resources.VersionConflict, e:
>>>>>                                         ^
>>>>> SyntaxError: invalid syntax
>>>>>
>>>>>
>>>>> Does anyone know how to proceed from here?
>>>>>
>>>>> FYI - This is a new install of Python 3 and I'm new to Python.  The
>>>>> ez_setup.py
>>>>> file was downloaded from
>>>>> http://peak.telecommunity.com/dist/ez_setup.py .
>>>>>
>>>>> Thanks for any hints,
>>>>>
>>>>> - Jim
>>>>>
>>>>> Jim Irrer     irrer at umich.edu       (734) 647-4409
>>>>> University of Michigan Hospital Radiation Oncology
>>>>> 519 W. William St.             Ann Arbor, MI 48103
>>>>>
>>>>> _______________________________________________
>>>>> rabbitmq-discuss mailing list
>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>>
>>>>>
>>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110715/51ebfc79/attachment.htm>

From jvarona at directpartners.com  Sat Jul 16 00:14:06 2011
From: jvarona at directpartners.com (Jorge Varona)
Date: Fri, 15 Jul 2011 16:14:06 -0700
Subject: [rabbitmq-discuss] Alice in Wonderland chasing the RabbitMq -
 Email found in subject
Message-ID: <032637508AC6BB4D8B1521E650C6C88657860B8D2C@mail.directpartners.com>

So things may have changed with the implementation but the last time I worked with Rabbit clustered nodes simply brokered requests to the master node. So depending on which node you connected, that connection brokered a request to the node where the queue existed. The notion of replication with full transactionality did not exist since 1) there weren't replicas of data on at least 2 nodes and 2) since there were not replicas,  transactionality did not have to span multiple boxes. If this has been corrected, and please forgive me since my testing and review of all the code was circa 2009. It probably means that the throughput of Rabbit has probably diminished a great deal. Is this not the case anymore?

From: Gavin M. Roy [mailto:gmr at myyearbook.com]
Sent: Friday, July 15, 2011 1:54 PM
To: Jorge Varona
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Alice in Wonderland chasing the RabbitMq - Email found in subject

Serious problems with replication? What are you replicating? Other than HA, I'm having a hard time envisioning a desire to replicate queues since there are multiple routing models to publish data across multiple nodes without extra effort on your part.

I've scaled Rabbit to a fairly high velocity without any scaling issues. Not sure what the gripe is here.

Regards,

Gavin
On Fri, Jul 15, 2011 at 3:43 PM, Jorge Varona <jvarona at directpartners.com<mailto:jvarona at directpartners.com>> wrote:
I have to ask, why go with RabbitMQ. There were some serious problems with replication last time I checked, which could make it hard to scale.

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110715/3d57e4f7/attachment.htm>

From videlalvaro at gmail.com  Sat Jul 16 06:32:22 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Sat, 16 Jul 2011 07:32:22 +0200
Subject: [rabbitmq-discuss] Alice in Wonderland chasing the RabbitMq -
	Email found in subject
In-Reply-To: <032637508AC6BB4D8B1521E650C6C88657860B8D2C@mail.directpartners.com>
References: <032637508AC6BB4D8B1521E650C6C88657860B8D2C@mail.directpartners.com>
Message-ID: <F97411CC-E544-4B73-89C6-F54963D64113@gmail.com>

Hi Jorge,

What you describe was RabbitMQ expected behavior while on cluster mode, so there's nothing to "correct".  Such behavior hasn't changed AFAIK.

Also AFAIK the RabbitMQ team is working on "Mirrored Queues", there's a thread on this ML explaining what they do and how they will work.

Cheers,

Alvaro

On Jul 16, 2011, at 1:14 AM, Jorge Varona wrote:

> So things may have changed with the implementation but the last time I worked with Rabbit clustered nodes simply brokered requests to the master node. So depending on which node you connected, that connection brokered a request to the node where the queue existed. The notion of replication with full transactionality did not exist since 1) there weren?t replicas of data on at least 2 nodes and 2) since there were not replicas,  transactionality did not have to span multiple boxes. If this has been corrected, and please forgive me since my testing and review of all the code was circa 2009. It probably means that the throughput of Rabbit has probably diminished a great deal. Is this not the case anymore?
>  
> From: Gavin M. Roy [mailto:gmr at myyearbook.com] 
> Sent: Friday, July 15, 2011 1:54 PM
> To: Jorge Varona
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] Alice in Wonderland chasing the RabbitMq - Email found in subject
>  
> Serious problems with replication? What are you replicating? Other than HA, I'm having a hard time envisioning a desire to replicate queues since there are multiple routing models to publish data across multiple nodes without extra effort on your part.
>  
> I've scaled Rabbit to a fairly high velocity without any scaling issues. Not sure what the gripe is here.
>  
> Regards,
> 
> Gavin
> 
> On Fri, Jul 15, 2011 at 3:43 PM, Jorge Varona <jvarona at directpartners.com> wrote:
> I have to ask, why go with RabbitMQ. There were some serious problems with replication last time I checked, which could make it hard to scale.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
>  
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

Sent form my Nokia 1100



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110716/3f9a60b1/attachment.htm>

From screechrocks at gmail.com  Sat Jul 16 03:06:18 2011
From: screechrocks at gmail.com (DarthMaul)
Date: Fri, 15 Jul 2011 19:06:18 -0700 (PDT)
Subject: [rabbitmq-discuss] Single Queue With Multiple Consumers
Message-ID: <4ebf7a83-5ae7-409f-a555-92c14da7763f@h14g2000yqd.googlegroups.com>

I would like to implement a messaging strategy in RabbitMQ that seems
really simple, but I can't figure out how to configure it.
Essentially, I want to have all message producers send messages to a
single queue. Meanwhile, there are any number of message consumers
ready to consume messages off the queue, but each message should be
processed only once.

So lets say you have 1 producer, 20 messages, and 5 consumers. I want
each consumer to be "assigned" one message to start it off, so 15
messages are left. Then as each consumer gets done, he grabs the next
one. And so on.

Essentially, this is what happens at your local bank--one line and
multiple tellers.

Any insight into how to pull this off--or a better approach
altogether--is appreciated.

Thanks.

From simone.busoli at gmail.com  Sat Jul 16 09:40:30 2011
From: simone.busoli at gmail.com (Simone Busoli)
Date: Sat, 16 Jul 2011 10:40:30 +0200
Subject: [rabbitmq-discuss] Single Queue With Multiple Consumers
In-Reply-To: <4ebf7a83-5ae7-409f-a555-92c14da7763f@h14g2000yqd.googlegroups.com>
References: <4ebf7a83-5ae7-409f-a555-92c14da7763f@h14g2000yqd.googlegroups.com>
Message-ID: <CAOn7oW_+vq708bSEXaJ2LTTb_TNN1h5PJ1xBrwKwMjjOO_eFbg@mail.gmail.com>

I think you can achieve this by simply using a single queue, having your
producer publish directly to it and the consumers consuming from it. Does
this make sense?
On Jul 16, 2011 9:30 AM, "DarthMaul" <screechrocks at gmail.com> wrote:
> I would like to implement a messaging strategy in RabbitMQ that seems
> really simple, but I can't figure out how to configure it.
> Essentially, I want to have all message producers send messages to a
> single queue. Meanwhile, there are any number of message consumers
> ready to consume messages off the queue, but each message should be
> processed only once.
>
> So lets say you have 1 producer, 20 messages, and 5 consumers. I want
> each consumer to be "assigned" one message to start it off, so 15
> messages are left. Then as each consumer gets done, he grabs the next
> one. And so on.
>
> Essentially, this is what happens at your local bank--one line and
> multiple tellers.
>
> Any insight into how to pull this off--or a better approach
> altogether--is appreciated.
>
> Thanks.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110716/4004a8f1/attachment.htm>

From matthias at rabbitmq.com  Sat Jul 16 09:50:48 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 16 Jul 2011 09:50:48 +0100
Subject: [rabbitmq-discuss] Single Queue With Multiple Consumers
In-Reply-To: <CAOn7oW_+vq708bSEXaJ2LTTb_TNN1h5PJ1xBrwKwMjjOO_eFbg@mail.gmail.com>
References: <4ebf7a83-5ae7-409f-a555-92c14da7763f@h14g2000yqd.googlegroups.com>
	<CAOn7oW_+vq708bSEXaJ2LTTb_TNN1h5PJ1xBrwKwMjjOO_eFbg@mail.gmail.com>
Message-ID: <4E2150E8.9090306@rabbitmq.com>

On 16/07/11 09:40, Simone Busoli wrote:
> On Jul 16, 2011 9:30 AM, "DarthMaul" <screechrocks at gmail.com> wrote:
>  > So lets say you have 1 producer, 20 messages, and 5 consumers. I want
>  > each consumer to be "assigned" one message to start it off, so 15
>  > messages are left. Then as each consumer gets done, he grabs the next
>  > one. And so on.
>
> I think you can achieve this by simply using a single queue, having your
> producer publish directly to it and the consumers consuming from it.

You'll also need to set the basic.qos prefetch to 1. See the section on 
"Fair dispatch" in 
http://www.rabbitmq.com/tutorials/tutorial-two-python.html.

Matthias.

From michael.s.klishin at gmail.com  Sun Jul 17 03:02:20 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sun, 17 Jul 2011 06:02:20 +0400
Subject: [rabbitmq-discuss] A heads up: amqp gem 0.7.2 and 0.8.0.RC14
	releases in the next few days
Message-ID: <CAE3HoVSJrb2hJh-k=qKgTLqTieMa+K9s9kw2ddV+7ggn5SuA5w@mail.gmail.com>

I just want to give the community a heads up: I am going to release amqp gem
0.7.2
release on Sunday and 0.8.0.RC14 will follow in the next few days.

0.8.0.RC14 is fully backwards compatible with RC13 but amq-client library
will need an upgrade to the 0.7.0 (will be released right before amqp
0.8.0.RC14). So when upgrading, make
sure to update your Gemfile or .gemspec dependency on amq-client if
necessary.

0.8.0.RC14 introduces a number of exciting features related to application
recovery from network & broker failures:

* A number of events/callbacks and API methods useful to developers who want
to implement their own recovery strategies.
* Automatic recovery mode that makes it very easy to re-declare all
entities, bindings & consumers when AMQP connection recovers from
  a network outage or broker failure: it is opt-in (not opt-out) and will
make recovery significantly simpler for "the 80%" of apps.

(Not yet compete) documentation of these features is available at
http://bit.ly/amqp-gem-error-handling-and-recovery


There are also other improvements:

* RC14 will no longer have pre-release gem dependencies. This should make
life easier for RubyGems 1.3.7 users, most notably those running on Heroku.
   RubyGems 1.3.7, also know as "the Internet Explorer 6 of the Ruby
ecosystem", has broken pre-release version comparison logic and considers
   version 0.7.0.pre9 to be more recent than 0.7.0.pre35, for example.

* Ability to register more than one consumer per queue on the same channel.
Historically AMQP:::Queue#subscribe only allowed to register one consumer.
  This is still being the case for backwards compatibility but you now can
easily instantiate AMQP::Consumers directly.

* New bitset-based channel id allocator. Previously apps that open & close
channels aggressively could hit connection max channel limit
  pretty quickly because channel id was a growing integer. Now channel id
are allocated from a pool of integers, just as in the RabbitMQ Java client.

* Broker capabilities introspection API. See
http://www.rabbitmq.com/extensions.html#capabilities
* Support for arrays in attribute tables (for example, message headers)

As usual, we keep improving my favorite amqp gem feature: documentation (
http://bit.ly/amqp-gem-docs).

* Documentation is now being proof-read and edited by Chris Duncan, the
creator of the bunny gem.
* Initial bits of the Migration guide 0.6.x and 0.7.x to 0.8.x (
http://bit.ly/amqp-gem-080-migration-guide)
* Initial bits of the Patterns & Use Cases guide (
http://bit.ly/amqp-gem-patterns) that explains how to implement many
patterns from the Enterprise Integration Patterns book (
http://www.eaipatterns.com)
* TLS guide
* Numerous small improvements to all other guides & code examples.

RC14 will be the second to last RC before 0.8.0. RC15 will bring up support
for Ruby 1.8.7-p249 (this particular patch level) that has a bug that
seriously affects amqp gem.
Working around it will take a moderate refactoring on our side. Learn more
in the FAQ at the bottom of
https://github.com/ruby-amqp/amqp/blob/master/README.md

Have a great sunny Sunday.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110717/e4b3de04/attachment.htm>

From alex.gronholm at nextday.fi  Sun Jul 17 05:26:13 2011
From: alex.gronholm at nextday.fi (=?UTF-8?Q?Alex_Gr=C3=B6nholm?=)
Date: Sat, 16 Jul 2011 21:26:13 -0700 (PDT)
Subject: [rabbitmq-discuss] Pika and threads
Message-ID: <28393563.3648.1310876773295.JavaMail.geo-discussion-forums@yqu12>

I wanted to use Pika to implement an RPC server using RabbitMQ. I found that 
this was however not possible because when I process the request in a 
thread, I have no good way to thread safely send the results back. The 
IOLoop lacks a mechanism for interrupting it directly. The best I could 
figure was setting a timeout of 0, but it might take up to a second for this 
to happen, considerably adding to the response latency.
Why isn't there just a dummy signalling socket that could be used for 
interrupting the poll?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110716/18891d38/attachment.htm>

From matthias at rabbitmq.com  Sun Jul 17 10:29:57 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 17 Jul 2011 10:29:57 +0100
Subject: [rabbitmq-discuss] Channel thread safety in Java client
In-Reply-To: <20110707181606.79062zhagtf0cag4@webmail.active24.cz>
References: <1309855320.3929.25.camel@holba>	<A7F601B8-1674-4AF2-BA08-4EAEBF0D4E01@rabbitmq.com>
	<20110707181606.79062zhagtf0cag4@webmail.active24.cz>
Message-ID: <4E22AB95.6070903@rabbitmq.com>

Jiri,

On 07/07/11 17:16, Jiri Krutil wrote:
> You say that a client application may continue to use a Channel from its
> main thread even if the RabbitMQ client library uses the same Channel
> for async receiving.

Correct.

> How is the use of a Channel from the RabbitMQ client library connection
> thread sychronized with the use of the same Channel from the client
> application thread?

That synchronisation happens internally in the RabbitMQ client library.

> Is such concurrent Channel access different from a situation when two
> client application threads access the same Channel concurrently?

Yes. Don't do that.

Regards,

Matthias.

From matthias at rabbitmq.com  Sun Jul 17 10:51:59 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 17 Jul 2011 10:51:59 +0100
Subject: [rabbitmq-discuss] Unable to connect multiple consumers to a
 queue bound to fanned out exchange
In-Reply-To: <CAKGgVGv9ijupCz-cm=wY464hdF8fi8kKAd7V322LMjvtYrVPNA@mail.gmail.com>
References: <32058027.post@talk.nabble.com>
	<4E1EDDFC.5070508@rabbitmq.com>	<4E1EE0F3.5030501@rabbitmq.com>
	<CAKGgVGv9ijupCz-cm=wY464hdF8fi8kKAd7V322LMjvtYrVPNA@mail.gmail.com>
Message-ID: <4E22B0BF.5010106@rabbitmq.com>

Uday,

On 14/07/11 20:19, Uday Mitra wrote:
> I wonder if the AMQP design is such that fanout is considered an
> exchange and so we cannot share the queue?

AMQP permits consumers to share queues. Regardless of what exchange 
these queues are bound to.

However, as Simon explained, consumers can request exclusive access to a 
queue, preventing sharing of the queue with other consumers. The error 
message you get from qpid indicates that the client library is doing 
just that. I suggest you ask the qpid folks how to change that behaviour.


Regards,

Matthias.

From michael.s.klishin at gmail.com  Sun Jul 17 19:36:45 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sun, 17 Jul 2011 22:36:45 +0400
Subject: [rabbitmq-discuss] An easy cross-platform way to start RabbitMQ
	programatically?
Message-ID: <CAE3HoVQJjF-O-+UK5KeknhYfxTSp6hcLkbGw8RRfoyrTWMyeNA@mail.gmail.com>

Hi,

I am adding some tests to the amqp gem test suite that deal with automatic
recovery from network & broker failures. Thanks to rabbitmqctl I can stop
and obtain pid of the broker easily, and killing it programmatically is
trivial, too. What I am not sure how to do is starting it again. Right now I
am
using a Homebrew/OS X-specific shell script and disabling these tests for
CI.

Looking at the Java client test suite doesn't yield me anything. Am I not
looking carefully enough or there is really no easy cross-platform way to
start RabbitMQ
programmatically?
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110717/13cdfd20/attachment.htm>

From csharpplusproject at gmail.com  Sun Jul 17 22:26:06 2011
From: csharpplusproject at gmail.com (Shalom Rav)
Date: Sun, 17 Jul 2011 14:26:06 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ -- communicate between 3 different
	machines?
Message-ID: <0c484afa-9cb5-45cf-acf1-2471822fc3fc@n5g2000yqh.googlegroups.com>

Using a SINGLE MACHINE, I have successfuly run the first 4 examples
that are on the RabbitMQ website.

Now, I'd like to test THE SAME EXAMPLES using 3 different machines
that are connected in a network.

Suppose that the RabbitMQ server is installed ONLY on host
192.168.0.1;

And suppose that I'd like to use machines {192.168.0.2, 192.168.0.3}
as *workers* (they DO NOT have the RabbitMQ server installed on
them).

Taking for instance the first example {send.py, receive.py} -- how do
I establish the connection between the three machines?


From jasonjwwilliams at gmail.com  Sun Jul 17 23:50:06 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Sun, 17 Jul 2011 16:50:06 -0600
Subject: [rabbitmq-discuss] RabbitMQ -- communicate between 3 different
	machines?
In-Reply-To: <0c484afa-9cb5-45cf-acf1-2471822fc3fc@n5g2000yqh.googlegroups.com>
References: <0c484afa-9cb5-45cf-acf1-2471822fc3fc@n5g2000yqh.googlegroups.com>
Message-ID: <CAHZAEpewL5i1Cz9tZCZPTASoAGBrhgfdPgEy7bDn=M5bLYd44w@mail.gmail.com>

Hi Shalom,

The connection is not between the machines/clients themselves, but
rather between the clients and the server running the RabbitMQ broker.
You should be able to bind the clients to the queues you're using in
the examples and RMQ will round robin incoming messages between them.

-J

On Sun, Jul 17, 2011 at 3:26 PM, Shalom Rav <csharpplusproject at gmail.com> wrote:
> Using a SINGLE MACHINE, I have successfuly run the first 4 examples
> that are on the RabbitMQ website.
>
> Now, I'd like to test THE SAME EXAMPLES using 3 different machines
> that are connected in a network.
>
> Suppose that the RabbitMQ server is installed ONLY on host
> 192.168.0.1;
>
> And suppose that I'd like to use machines {192.168.0.2, 192.168.0.3}
> as *workers* (they DO NOT have the RabbitMQ server installed on
> them).
>
> Taking for instance the first example {send.py, receive.py} -- how do
> I establish the connection between the three machines?
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From csharpplusproject at gmail.com  Mon Jul 18 00:12:25 2011
From: csharpplusproject at gmail.com (csharpplusproject)
Date: Sun, 17 Jul 2011 19:12:25 -0400
Subject: [rabbitmq-discuss] RabbitMQ -- communicate between 3 different
 machines?
In-Reply-To: <CAHZAEpewL5i1Cz9tZCZPTASoAGBrhgfdPgEy7bDn=M5bLYd44w@mail.gmail.com>
References: <0c484afa-9cb5-45cf-acf1-2471822fc3fc@n5g2000yqh.googlegroups.com>
	<CAHZAEpewL5i1Cz9tZCZPTASoAGBrhgfdPgEy7bDn=M5bLYd44w@mail.gmail.com>
Message-ID: <1310944345.1866.722.camel@internet>

Hi Jason,

Thank you for your assistance.

Suppose that the RabbitMQ server is installed on host 192.168.0.1;

How do I establish a connection between my 2 worker clients
(192.168.0.2, 192.168.0.3), and the RabbitMQ server? (I'm using the pika
client)

Thanks,
Shalom.

-----Original Message-----
From: Jason J. W. Williams <jasonjwwilliams at gmail.com>
To: Shalom Rav <csharpplusproject at gmail.com>
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] RabbitMQ -- communicate between 3
different machines?
Date: Sun, 17 Jul 2011 16:50:06 -0600


Hi Shalom,

The connection is not between the machines/clients themselves, but
rather between the clients and the server running the RabbitMQ broker.
You should be able to bind the clients to the queues you're using in
the examples and RMQ will round robin incoming messages between them.

-J

On Sun, Jul 17, 2011 at 3:26 PM, Shalom Rav <csharpplusproject at gmail.com> wrote:
> Using a SINGLE MACHINE, I have successfuly run the first 4 examples
> that are on the RabbitMQ website.
>
> Now, I'd like to test THE SAME EXAMPLES using 3 different machines
> that are connected in a network.
>
> Suppose that the RabbitMQ server is installed ONLY on host
> 192.168.0.1;
>
> And suppose that I'd like to use machines {192.168.0.2, 192.168.0.3}
> as *workers* (they DO NOT have the RabbitMQ server installed on
> them).
>
> Taking for instance the first example {send.py, receive.py} -- how do
> I establish the connection between the three machines?
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110717/8a11780a/attachment.htm>

From videlalvaro at gmail.com  Mon Jul 18 00:20:23 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Mon, 18 Jul 2011 01:20:23 +0200
Subject: [rabbitmq-discuss] RabbitMQ -- communicate between 3 different
	machines?
In-Reply-To: <1310944345.1866.722.camel@internet>
References: <0c484afa-9cb5-45cf-acf1-2471822fc3fc@n5g2000yqh.googlegroups.com>
	<CAHZAEpewL5i1Cz9tZCZPTASoAGBrhgfdPgEy7bDn=M5bLYd44w@mail.gmail.com>
	<1310944345.1866.722.camel@internet>
Message-ID: <C50E687B-F6DD-4945-9352-1B3B38477DDC@gmail.com>

Hi Shalom,

Start RabbitMQ on server 192.168.0.1.

Then go to say server 192.168.0.2 and start one of the workers. Do the same on server 192.168.0.3  (Change the IP according to your configuration of course).

Then on the workers code you have to specify on which host RabbitMQ is running. For example on the first tutorial you see this code:

connection = pika.BlockingConnection(pika.ConnectionParameters(
               'localhost'))

Change "localhost" for the IP where RabbitMQ is running. Do the same for the message publisher.

See the documentation here: http://pika.github.com/connecting.html#connection-parameters to understand the parameters passed to a new connection.

Cheers,

Alvaro

On Jul 18, 2011, at 1:12 AM, csharpplusproject wrote:

> Hi Jason,
> 
> Thank you for your assistance.
> 
> Suppose that the RabbitMQ server is installed on host 192.168.0.1;
> 
> How do I establish a connection between my 2 worker clients (192.168.0.2, 192.168.0.3), and the RabbitMQ server? (I'm using the pika client)
> 
> Thanks,
> Shalom.
> 
> -----Original Message-----
> From: Jason J. W. Williams <jasonjwwilliams at gmail.com>
> To: Shalom Rav <csharpplusproject at gmail.com>
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] RabbitMQ -- communicate between 3 different machines?
> Date: Sun, 17 Jul 2011 16:50:06 -0600
> 
> Hi Shalom,
> 
> The connection is not between the machines/clients themselves, but
> rather between the clients and the server running the RabbitMQ broker.
> You should be able to bind the clients to the queues you're using in
> the examples and RMQ will round robin incoming messages between them.
> 
> -J
> 
> On Sun, Jul 17, 2011 at 3:26 PM, Shalom Rav <csharpplusproject at gmail.com> wrote:
> > Using a SINGLE MACHINE, I have successfuly run the first 4 examples
> > that are on the RabbitMQ website.
> >
> > Now, I'd like to test THE SAME EXAMPLES using 3 different machines
> > that are connected in a network.
> >
> > Suppose that the RabbitMQ server is installed ONLY on host
> > 192.168.0.1;
> >
> > And suppose that I'd like to use machines {192.168.0.2, 192.168.0.3}
> > as *workers* (they DO NOT have the RabbitMQ server installed on
> > them).
> >
> > Taking for instance the first example {send.py, receive.py} -- how do
> > I establish the connection between the three machines?
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

Sent form my Nokia 1100



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110718/81e157f7/attachment.htm>

From csharpplusproject at gmail.com  Mon Jul 18 01:11:44 2011
From: csharpplusproject at gmail.com (csharpplusproject)
Date: Sun, 17 Jul 2011 20:11:44 -0400
Subject: [rabbitmq-discuss] RabbitMQ -- communicate between 3 different
 machines?
In-Reply-To: <C50E687B-F6DD-4945-9352-1B3B38477DDC@gmail.com>
References: <0c484afa-9cb5-45cf-acf1-2471822fc3fc@n5g2000yqh.googlegroups.com>
	<CAHZAEpewL5i1Cz9tZCZPTASoAGBrhgfdPgEy7bDn=M5bLYd44w@mail.gmail.com>
	<1310944345.1866.722.camel@internet>
	<C50E687B-F6DD-4945-9352-1B3B38477DDC@gmail.com>
Message-ID: <1310947904.1866.729.camel@internet>

Hi Alavro,

Thank you for your response.

Yes, I confirm that I am successful connecting to my server
(192.168.0.1) from my 2 worker clients (192.168.0.2, 192.168.0.3) by
specifying the server's IP.

Yet, this brings down another question -- in this case, I have a single
server (192.168.0.1) and 2 worker clients (192.168.0.2, 192.168.0.3).

Since my server is a 'single point of failure', what happens if my
server dies? How does RabbitMQ handle such a case?

Is there a way to make things more reliabile? (for instance, have
multiple nodes that will all have the same contents of 192.168.0.1 and
thus provide reliability in case the main server dies...).

I appreciate your help.

Best,
Shalom.


-----Original Message-----
From: Alvaro Videla <videlalvaro at gmail.com>
To: csharpplusproject <csharpplusproject at gmail.com>
Cc: Jason J. W. Williams <jasonjwwilliams at gmail.com>,
rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] RabbitMQ -- communicate between 3
different machines?
Date: Mon, 18 Jul 2011 01:20:23 +0200

Hi Shalom,


Start RabbitMQ on server 192.168.0.1.


Then go to say server 192.168.0.2 and start one of the workers. Do the
same on server 192.168.0.3  (Change the IP according to your
configuration of course).


Then on the workers code you have to specify on which host RabbitMQ is
running. For example on the first tutorial you see this code:


connection = pika.BlockingConnection(pika.ConnectionParameters(
               'localhost'))


Change "localhost" for the IP where RabbitMQ is running. Do the same for
the message publisher.


See the documentation
here: http://pika.github.com/connecting.html#connection-parameters to
understand the parameters passed to a new connection.


Cheers,


Alvaro

On Jul 18, 2011, at 1:12 AM, csharpplusproject wrote:

> Hi Jason,
> 
> Thank you for your assistance.
> 
> Suppose that the RabbitMQ server is installed on host 192.168.0.1;
> 
> How do I establish a connection between my 2 worker clients
> (192.168.0.2, 192.168.0.3), and the RabbitMQ server? (I'm using the
> pika client)
> 
> Thanks,
> Shalom.
> 
> -----Original Message-----
> From: Jason J. W. Williams <jasonjwwilliams at gmail.com>
> To: Shalom Rav <csharpplusproject at gmail.com>
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] RabbitMQ -- communicate between 3
> different machines?
> Date: Sun, 17 Jul 2011 16:50:06 -0600
> 
> 
> Hi Shalom,
> 
> The connection is not between the machines/clients themselves, but
> rather between the clients and the server running the RabbitMQ broker.
> You should be able to bind the clients to the queues you're using in
> the examples and RMQ will round robin incoming messages between them.
> 
> -J
> 
> On Sun, Jul 17, 2011 at 3:26 PM, Shalom Rav <csharpplusproject at gmail.com> wrote:
> > Using a SINGLE MACHINE, I have successfuly run the first 4 examples
> > that are on the RabbitMQ website.
> >
> > Now, I'd like to test THE SAME EXAMPLES using 3 different machines
> > that are connected in a network.
> >
> > Suppose that the RabbitMQ server is installed ONLY on host
> > 192.168.0.1;
> >
> > And suppose that I'd like to use machines {192.168.0.2, 192.168.0.3}
> > as *workers* (they DO NOT have the RabbitMQ server installed on
> > them).
> >
> > Taking for instance the first example {send.py, receive.py} -- how do
> > I establish the connection between the three machines?
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> 
> 
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

Sent form my Nokia 1100







-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110717/345d869f/attachment.htm>

From videlalvaro at gmail.com  Mon Jul 18 01:21:27 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Mon, 18 Jul 2011 02:21:27 +0200
Subject: [rabbitmq-discuss] RabbitMQ -- communicate between 3 different
	machines?
In-Reply-To: <1310947904.1866.729.camel@internet>
References: <0c484afa-9cb5-45cf-acf1-2471822fc3fc@n5g2000yqh.googlegroups.com>
	<CAHZAEpewL5i1Cz9tZCZPTASoAGBrhgfdPgEy7bDn=M5bLYd44w@mail.gmail.com>
	<1310944345.1866.722.camel@internet>
	<C50E687B-F6DD-4945-9352-1B3B38477DDC@gmail.com>
	<1310947904.1866.729.camel@internet>
Message-ID: <0230E5CB-7EC2-4F60-87A0-06BE9B09EA3D@gmail.com>

Hi Shalom,

You can read the guide here: http://www.rabbitmq.com/pacemaker.html

Not that I like to do self advertisement, but you can also read our book about RabbitMQ that discusses clustering too: http://bitly.com/rabbitmq

Cheers,

Alvaro

On Jul 18, 2011, at 2:11 AM, csharpplusproject wrote:

> Hi Alavro,
> 
> Thank you for your response.
> 
> Yes, I confirm that I am successful connecting to my server (192.168.0.1) from my 2 worker clients (192.168.0.2, 192.168.0.3) by specifying the server's IP.
> 
> Yet, this brings down another question -- in this case, I have a single server (192.168.0.1) and 2 worker clients (192.168.0.2, 192.168.0.3).
> 
> Since my server is a 'single point of failure', what happens if my server dies? How does RabbitMQ handle such a case?
> 
> Is there a way to make things more reliabile? (for instance, have multiple nodes that will all have the same contents of 192.168.0.1 and thus provide reliability in case the main server dies...).
> 
> I appreciate your help.
> 
> Best,
> Shalom.
> 
> 
> -----Original Message-----
> From: Alvaro Videla <videlalvaro at gmail.com>
> To: csharpplusproject <csharpplusproject at gmail.com>
> Cc: Jason J. W. Williams <jasonjwwilliams at gmail.com>, rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] RabbitMQ -- communicate between 3 different machines?
> Date: Mon, 18 Jul 2011 01:20:23 +0200
> 
> Hi Shalom, 
> 
> Start RabbitMQ on server 192.168.0.1. 
> 
> Then go to say server 192.168.0.2 and start one of the workers. Do the same on server 192.168.0.3  (Change the IP according to your configuration of course). 
> 
> Then on the workers code you have to specify on which host RabbitMQ is running. For example on the first tutorial you see this code: 
> 
> connection = pika.BlockingConnection(pika.ConnectionParameters(
>                'localhost'))
> 
> 
> Change "localhost" for the IP where RabbitMQ is running. Do the same for the message publisher. 
> 
> See the documentation here: http://pika.github.com/connecting.html#connection-parameters to understand the parameters passed to a new connection. 
> 
> Cheers, 
> 
> Alvaro 
> On Jul 18, 2011, at 1:12 AM, csharpplusproject wrote: 
>> Hi Jason,
>> 
>> Thank you for your assistance.
>> 
>> Suppose that the RabbitMQ server is installed on host 192.168.0.1;
>> 
>> How do I establish a connection between my 2 worker clients (192.168.0.2, 192.168.0.3), and the RabbitMQ server? (I'm using the pika client)
>> 
>> Thanks,
>> Shalom.
>> 
>> -----Original Message-----
>> From: Jason J. W. Williams <jasonjwwilliams at gmail.com>
>> To: Shalom Rav <csharpplusproject at gmail.com>
>> Cc: rabbitmq-discuss at lists.rabbitmq.com
>> Subject: Re: [rabbitmq-discuss] RabbitMQ -- communicate between 3 different machines?
>> Date: Sun, 17 Jul 2011 16:50:06 -0600
>> 
>> Hi Shalom,
>> 
>> The connection is not between the machines/clients themselves, but
>> rather between the clients and the server running the RabbitMQ broker.
>> You should be able to bind the clients to the queues you're using in
>> the examples and RMQ will round robin incoming messages between them.
>> 
>> -J
>> 
>> On Sun, Jul 17, 2011 at 3:26 PM, Shalom Rav <csharpplusproject at gmail.com> wrote:
>> > Using a SINGLE MACHINE, I have successfuly run the first 4 examples
>> > that are on the RabbitMQ website.
>> >
>> > Now, I'd like to test THE SAME EXAMPLES using 3 different machines
>> > that are connected in a network.
>> >
>> > Suppose that the RabbitMQ server is installed ONLY on host
>> > 192.168.0.1;
>> >
>> > And suppose that I'd like to use machines {192.168.0.2, 192.168.0.3}
>> > as *workers* (they DO NOT have the RabbitMQ server installed on
>> > them).
>> >
>> > Taking for instance the first example {send.py, receive.py} -- how do
>> > I establish the connection between the three machines?
>> >
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >
>> 
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> Sent form my Nokia 1100 
> 
> 
> 
> 
> 
> 

Sent form my Nokia 1100



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110718/41c78661/attachment.htm>

From csharpplusproject at gmail.com  Mon Jul 18 02:07:46 2011
From: csharpplusproject at gmail.com (csharpplusproject)
Date: Sun, 17 Jul 2011 21:07:46 -0400
Subject: [rabbitmq-discuss] RabbitMQ -- communicate between 3 different
 machines?
In-Reply-To: <0230E5CB-7EC2-4F60-87A0-06BE9B09EA3D@gmail.com>
References: <0c484afa-9cb5-45cf-acf1-2471822fc3fc@n5g2000yqh.googlegroups.com>
	<CAHZAEpewL5i1Cz9tZCZPTASoAGBrhgfdPgEy7bDn=M5bLYd44w@mail.gmail.com>
	<1310944345.1866.722.camel@internet>
	<C50E687B-F6DD-4945-9352-1B3B38477DDC@gmail.com>
	<1310947904.1866.729.camel@internet>
	<0230E5CB-7EC2-4F60-87A0-06BE9B09EA3D@gmail.com>
Message-ID: <1310951266.1866.732.camel@internet>

Hi Alvaro,

Thank you for the link and your book recommendation.

Just so that I get things straight, if I install RabbitMQ on 2 different
IPs -- say, {192.168.0.1, 192.168.0.2} -- will both of these be
considered DIFFERENT, independent RabbitMQ servers?
Meaning, each server will carry on its own tasks, messages etc?

Thanks,
Shalom.

-----Original Message-----
From: Alvaro Videla <videlalvaro at gmail.com>
To: csharpplusproject <csharpplusproject at gmail.com>
Cc: Jason J. W. Williams <jasonjwwilliams at gmail.com>,
rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] RabbitMQ -- communicate between 3
different machines?
Date: Mon, 18 Jul 2011 02:21:27 +0200

Hi Shalom,


You can read the guide here: http://www.rabbitmq.com/pacemaker.html


Not that I like to do self advertisement, but you can also read our book
about RabbitMQ that discusses clustering too: http://bitly.com/rabbitmq


Cheers,


Alvaro

On Jul 18, 2011, at 2:11 AM, csharpplusproject wrote:

> Hi Alavro,
> 
> Thank you for your response.
> 
> Yes, I confirm that I am successful connecting to my server
> (192.168.0.1) from my 2 worker clients (192.168.0.2, 192.168.0.3) by
> specifying the server's IP.
> 
> Yet, this brings down another question -- in this case, I have a
> single server (192.168.0.1) and 2 worker clients (192.168.0.2,
> 192.168.0.3).
> 
> Since my server is a 'single point of failure', what happens if my
> server dies? How does RabbitMQ handle such a case?
> 
> Is there a way to make things more reliabile? (for instance, have
> multiple nodes that will all have the same contents of 192.168.0.1 and
> thus provide reliability in case the main server dies...).
> 
> I appreciate your help.
> 
> Best,
> Shalom.
> 
> 
> -----Original Message-----
> From: Alvaro Videla <videlalvaro at gmail.com>
> To: csharpplusproject <csharpplusproject at gmail.com>
> Cc: Jason J. W. Williams <jasonjwwilliams at gmail.com>,
> rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] RabbitMQ -- communicate between 3
> different machines?
> Date: Mon, 18 Jul 2011 01:20:23 +0200
> 
> Hi Shalom, 
> 
> Start RabbitMQ on server 192.168.0.1. 
> 
> Then go to say server 192.168.0.2 and start one of the workers. Do the
> same on server 192.168.0.3  (Change the IP according to your
> configuration of course). 
> 
> Then on the workers code you have to specify on which host RabbitMQ is
> running. For example on the first tutorial you see this code: 
> 
> 
> connection = pika.BlockingConnection(pika.ConnectionParameters(
>                'localhost'))
> 
> 
> 
> Change "localhost" for the IP where RabbitMQ is running. Do the same
> for the message publisher. 
> 
> See the documentation
> here: http://pika.github.com/connecting.html#connection-parameters to
> understand the parameters passed to a new connection. 
> 
> Cheers, 
> 
> Alvaro 
> On Jul 18, 2011, at 1:12 AM, csharpplusproject wrote: 
> 
> > Hi Jason,
> > 
> > Thank you for your assistance.
> > 
> > Suppose that the RabbitMQ server is installed on host 192.168.0.1;
> > 
> > How do I establish a connection between my 2 worker clients
> > (192.168.0.2, 192.168.0.3), and the RabbitMQ server? (I'm using the
> > pika client)
> > 
> > Thanks,
> > Shalom.
> > 
> > -----Original Message-----
> > From: Jason J. W. Williams <jasonjwwilliams at gmail.com>
> > To: Shalom Rav <csharpplusproject at gmail.com>
> > Cc: rabbitmq-discuss at lists.rabbitmq.com
> > Subject: Re: [rabbitmq-discuss] RabbitMQ -- communicate between 3
> > different machines?
> > Date: Sun, 17 Jul 2011 16:50:06 -0600
> > 
> > 
> > Hi Shalom,
> > 
> > The connection is not between the machines/clients themselves, but
> > rather between the clients and the server running the RabbitMQ broker.
> > You should be able to bind the clients to the queues you're using in
> > the examples and RMQ will round robin incoming messages between them.
> > 
> > -J
> > 
> > On Sun, Jul 17, 2011 at 3:26 PM, Shalom Rav <csharpplusproject at gmail.com> wrote:
> > > Using a SINGLE MACHINE, I have successfuly run the first 4 examples
> > > that are on the RabbitMQ website.
> > >
> > > Now, I'd like to test THE SAME EXAMPLES using 3 different machines
> > > that are connected in a network.
> > >
> > > Suppose that the RabbitMQ server is installed ONLY on host
> > > 192.168.0.1;
> > >
> > > And suppose that I'd like to use machines {192.168.0.2, 192.168.0.3}
> > > as *workers* (they DO NOT have the RabbitMQ server installed on
> > > them).
> > >
> > > Taking for instance the first example {send.py, receive.py} -- how do
> > > I establish the connection between the three machines?
> > >
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-discuss at lists.rabbitmq.com
> > > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > >
> > 
> > 
> > 
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> Sent form my Nokia 1100 
> 
> 
> 
> 
> 
> 
> 

Sent form my Nokia 1100







-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110717/ebfed528/attachment.htm>

From csharpplusproject at gmail.com  Mon Jul 18 03:22:46 2011
From: csharpplusproject at gmail.com (Shalom Rav)
Date: Sun, 17 Jul 2011 19:22:46 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ -- Patterns For Background
	Communication?
Message-ID: <a2ef39c8-d3e7-4c7c-9dbf-5f1f8669d02e@t9g2000vbs.googlegroups.com>

I'd like to write a python app (using pika & rabbitMQ) to do the
following:

There will be ONE *parent*, and TEN *workers*:

Every 2[sec], the *parent* sends a message that must be consumed by
*all workers*.

Every 5[sec], each one of the *workers* sends a message directly to
the *parent*.
___________________________________________________________

Thanks to Jason W., I was able to write two small python scripts
('parent.py', 'child.py') that serve as a proof of concept.

Yet, I have one main problem: the two scripts ('parent.py',
'child.py') keep exchanging messages between them non-stop. Since BOTH
the *parent* & the *child* scripts need to publish and consume, I am
basically 'stuck' with infinite publish / consume loops, leaving no
room for my actual app to run.

The problem is that I use the line *channel.start_consuming()* in both
scripts -- which causes the publishing/consuming to run continuously,
leaving no room for my actual app to do its work.

Given the above case, can you suggest a *background* (or silent, if
you will) communication pattern that will allow my *actual app* to
run, and be able to 'send'  / 'receive' messages only at desired
points in the code -- and not continuously? It looks like the main
problem is with *channel.start_consuming()*.

I see that one can publish a message ONCE using
*channel.basic_publish(exchange = 'my_exchange', routing_key = '',
body = my_message )*; Is there a similar call to consume ONCE (not
continuously)?

From jasonjwwilliams at gmail.com  Mon Jul 18 09:11:09 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Mon, 18 Jul 2011 02:11:09 -0600
Subject: [rabbitmq-discuss] RabbitMQ -- communicate between 3 different
	machines?
In-Reply-To: <1310951266.1866.732.camel@internet>
References: <0c484afa-9cb5-45cf-acf1-2471822fc3fc@n5g2000yqh.googlegroups.com>
	<CAHZAEpewL5i1Cz9tZCZPTASoAGBrhgfdPgEy7bDn=M5bLYd44w@mail.gmail.com>
	<1310944345.1866.722.camel@internet>
	<C50E687B-F6DD-4945-9352-1B3B38477DDC@gmail.com>
	<1310947904.1866.729.camel@internet>
	<0230E5CB-7EC2-4F60-87A0-06BE9B09EA3D@gmail.com>
	<1310951266.1866.732.camel@internet>
Message-ID: <9364AF17-6BB1-4E31-8377-46C556CF8F11@gmail.com>

Hi Shalom,

They will be considered independent unless you cluster them. In which case, the servers will appear as a single unit with the same queues, exchanges and bindings. Where this breaks down is when a server in the cluster fails. While queues are accessible from any cluster node, each queue is only stored on one node (the cluster tries to evenly distribute the queues as they are declared). So when a cluster node fails, any queues it was the master for disappear until the node is returned to service. This is being addressed by the mirrored queues feature that should be available soon. 

Does that answer your question?

-J

Sent via iPhone

Is your email Premiere?

On Jul 17, 2011, at 19:07, csharpplusproject <csharpplusproject at gmail.com> wrote:

> Hi Alvaro,
> 
> Thank you for the link and your book recommendation.
> 
> Just so that I get things straight, if I install RabbitMQ on 2 different IPs -- say, {192.168.0.1, 192.168.0.2} -- will both of these be considered DIFFERENT, independent RabbitMQ servers?
> Meaning, each server will carry on its own tasks, messages etc?
> 
> Thanks,
> Shalom.
> 
> -----Original Message-----
> From: Alvaro Videla <videlalvaro at gmail.com>
> To: csharpplusproject <csharpplusproject at gmail.com>
> Cc: Jason J. W. Williams <jasonjwwilliams at gmail.com>, rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] RabbitMQ -- communicate between 3 different machines?
> Date: Mon, 18 Jul 2011 02:21:27 +0200
> 
> Hi Shalom, 
> 
> You can read the guide here: http://www.rabbitmq.com/pacemaker.html 
> 
> Not that I like to do self advertisement, but you can also read our book about RabbitMQ that discusses clustering too: http://bitly.com/rabbitmq 
> 
> Cheers, 
> 
> Alvaro 
> On Jul 18, 2011, at 2:11 AM, csharpplusproject wrote: 
>> Hi Alavro,
>> 
>> Thank you for your response.
>> 
>> Yes, I confirm that I am successful connecting to my server (192.168.0.1) from my 2 worker clients (192.168.0.2, 192.168.0.3) by specifying the server's IP.
>> 
>> Yet, this brings down another question -- in this case, I have a single server (192.168.0.1) and 2 worker clients (192.168.0.2, 192.168.0.3).
>> 
>> Since my server is a 'single point of failure', what happens if my server dies? How does RabbitMQ handle such a case?
>> 
>> Is there a way to make things more reliabile? (for instance, have multiple nodes that will all have the same contents of 192.168.0.1 and thus provide reliability in case the main server dies...).
>> 
>> I appreciate your help.
>> 
>> Best,
>> Shalom.
>> 
>> 
>> -----Original Message-----
>> From: Alvaro Videla <videlalvaro at gmail.com>
>> To: csharpplusproject <csharpplusproject at gmail.com>
>> Cc: Jason J. W. Williams <jasonjwwilliams at gmail.com>, rabbitmq-discuss at lists.rabbitmq.com
>> Subject: Re: [rabbitmq-discuss] RabbitMQ -- communicate between 3 different machines?
>> Date: Mon, 18 Jul 2011 01:20:23 +0200
>> 
>> Hi Shalom, 
>> 
>> Start RabbitMQ on server 192.168.0.1. 
>> 
>> Then go to say server 192.168.0.2 and start one of the workers. Do the same on server 192.168.0.3  (Change the IP according to your configuration of course). 
>> 
>> Then on the workers code you have to specify on which host RabbitMQ is running. For example on the first tutorial you see this code: 
>> 
>> connection = pika.BlockingConnection(pika.ConnectionParameters(
>>                'localhost'))
>> 
>> 
>> Change "localhost" for the IP where RabbitMQ is running. Do the same for the message publisher. 
>> 
>> See the documentation here: http://pika.github.com/connecting.html#connection-parameters to understand the parameters passed to a new connection. 
>> 
>> Cheers, 
>> 
>> Alvaro 
>> On Jul 18, 2011, at 1:12 AM, csharpplusproject wrote: 
>>> Hi Jason,
>>> 
>>> Thank you for your assistance.
>>> 
>>> Suppose that the RabbitMQ server is installed on host 192.168.0.1;
>>> 
>>> How do I establish a connection between my 2 worker clients (192.168.0.2, 192.168.0.3), and the RabbitMQ server? (I'm using the pika client)
>>> 
>>> Thanks,
>>> Shalom.
>>> 
>>> -----Original Message-----
>>> From: Jason J. W. Williams <jasonjwwilliams at gmail.com>
>>> To: Shalom Rav <csharpplusproject at gmail.com>
>>> Cc: rabbitmq-discuss at lists.rabbitmq.com
>>> Subject: Re: [rabbitmq-discuss] RabbitMQ -- communicate between 3 different machines?
>>> Date: Sun, 17 Jul 2011 16:50:06 -0600
>>> 
>>> Hi Shalom,
>>> 
>>> The connection is not between the machines/clients themselves, but
>>> rather between the clients and the server running the RabbitMQ broker.
>>> You should be able to bind the clients to the queues you're using in
>>> the examples and RMQ will round robin incoming messages between them.
>>> 
>>> -J
>>> 
>>> On Sun, Jul 17, 2011 at 3:26 PM, Shalom Rav <csharpplusproject at gmail.com> wrote:
>>> > Using a SINGLE MACHINE, I have successfuly run the first 4 examples
>>> > that are on the RabbitMQ website.
>>> >
>>> > Now, I'd like to test THE SAME EXAMPLES using 3 different machines
>>> > that are connected in a network.
>>> >
>>> > Suppose that the RabbitMQ server is installed ONLY on host
>>> > 192.168.0.1;
>>> >
>>> > And suppose that I'd like to use machines {192.168.0.2, 192.168.0.3}
>>> > as *workers* (they DO NOT have the RabbitMQ server installed on
>>> > them).
>>> >
>>> > Taking for instance the first example {send.py, receive.py} -- how do
>>> > I establish the connection between the three machines?
>>> >
>>> > _______________________________________________
>>> > rabbitmq-discuss mailing list
>>> > rabbitmq-discuss at lists.rabbitmq.com
>>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> >
>>> 
>>> 
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> Sent form my Nokia 1100 
>> 
>> 
>> 
>> 
>> 
>> 
>> 
> 
> Sent form my Nokia 1100 
> 
> 
> 
> 
> 
> 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110718/d766a9e8/attachment.htm>

From stammailbox at gmail.com  Mon Jul 18 10:04:03 2011
From: stammailbox at gmail.com (mysurf mail)
Date: Mon, 18 Jul 2011 12:04:03 +0300
Subject: [rabbitmq-discuss] Fwd: a few json rpc questions
In-Reply-To: <4E2007F8.8030807@rabbitmq.com>
References: <CAJ2-VrkDARuoP-iJgEiwagh_44WgiAhhizEbfTNj9YYyJPCMeQ@mail.gmail.com>
	<4E1AD7DB.2090702@rabbitmq.com>
	<CAJ2-Vrk2EqzWXBkFC2zOHYxN8hCNYsqB24sokkoJcJfE5rOmDA@mail.gmail.com>
	<CAJ2-Vrk7aTeSnS+szosSB=-Ak-iSo+iVHeKYmoeqJOEvdBpJoA@mail.gmail.com>
	<4E1DAA62.8060909@rabbitmq.com>
	<CAJ2-VrmZREaxrtukWdkBX6bPEODCSNBb99h8SNqj-xUMRFHosw@mail.gmail.com>
	<4E1DB16C.5070906@rabbitmq.com>
	<CAJ2-VrmdAo6B0K-QmjAC6nW4cxGDd=OQUBaxiCVhttWimKYVVw@mail.gmail.com>
	<4E2007F8.8030807@rabbitmq.com>
Message-ID: <CAJ2-Vrnk3Q27A4r+uT0eGxCoeSaTr5r1_rCw+PLFS2qdWr6-0Q@mail.gmail.com>

Thanks Emile,

I find a lot of assistance in your answers.
I do use the RPC the way you mentioned and multiple clients do connect.
but my problem is that sometimes - a new client cannot connect .

While investigating this problem I found that one of the server RPC queues
was deleted. and when the client tries to connect to it, it halts when
trying.

How come?
I have 2 RPC queues for different services/ I declare them both in the same
way - declaring both queues for the rpcserver with this line

      ch.queueDeclare(QueueName, false,false,true,null)

(obviously giving  different names in the first parameter for the different
queues.. )
But only the first queue is sometimes deleted.
I have tried to see if it happens when the last client is shut down but it
is not related.
1. When do you think it could happen?
2. Should I declare it in another way? Like changing the third parameter -
autodelete to false?
(  though it should never be deleted because the server app is still holding
a handle to it, no?)
Any hints would be highly appreciated.


On Fri, Jul 15, 2011 at 12:27 PM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi,
>
> On 14/07/11 07:35, mysurf mail wrote:
> > Hi,
>
> > Can all the clients be configurated with the same queuename ("") and the
> > same routing key (the same for all)?
>
> There are two queues required for an RPC call over AMQP. The first is
> the work queue for the service. The request published by the RPC client
> needs to end up in this queue and be consumed by the RPC server. The
> second is the callback queue. This is declared by the RPC client and
> receives the reply from the RPC server.
>
> When multiple RPC clients are making use of the same RPC service then
> they should all use the same routing key so that all requests for that
> service go to the same work queue. This is called RPC_QUEUE_NAME in the
> relevant Java tutorial:
>
> http://www.rabbitmq.com/tutorials/tutorial-six-java.html
>
> When you make use of RpcClient in the Java client (see
>
>
> http://hg.rabbitmq.com/rabbitmq-java-client/file/default/src/com/rabbitmq/client/RpcClient.java
> )
>
> you will see each client declares its own callback queue, so these are
> not shared. If a queue is declared with an empty name then the server
> assigns a random name. (See the "Temporary Queues" explanation in the
> 3rd tutorial.) So even if it looks like all the clients are declaring
> the same queue named "", they are all using different callback queues.
> This is the recommended approach.
>
>
> -Emile
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110718/565cbb70/attachment.htm>

From emile at rabbitmq.com  Mon Jul 18 10:31:33 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 18 Jul 2011 10:31:33 +0100
Subject: [rabbitmq-discuss] Fwd: a few json rpc questions
In-Reply-To: <CAJ2-Vrnk3Q27A4r+uT0eGxCoeSaTr5r1_rCw+PLFS2qdWr6-0Q@mail.gmail.com>
References: <CAJ2-VrkDARuoP-iJgEiwagh_44WgiAhhizEbfTNj9YYyJPCMeQ@mail.gmail.com>	<4E1AD7DB.2090702@rabbitmq.com>	<CAJ2-Vrk2EqzWXBkFC2zOHYxN8hCNYsqB24sokkoJcJfE5rOmDA@mail.gmail.com>	<CAJ2-Vrk7aTeSnS+szosSB=-Ak-iSo+iVHeKYmoeqJOEvdBpJoA@mail.gmail.com>	<4E1DAA62.8060909@rabbitmq.com>	<CAJ2-VrmZREaxrtukWdkBX6bPEODCSNBb99h8SNqj-xUMRFHosw@mail.gmail.com>	<4E1DB16C.5070906@rabbitmq.com>	<CAJ2-VrmdAo6B0K-QmjAC6nW4cxGDd=OQUBaxiCVhttWimKYVVw@mail.gmail.com>	<4E2007F8.8030807@rabbitmq.com>
	<CAJ2-Vrnk3Q27A4r+uT0eGxCoeSaTr5r1_rCw+PLFS2qdWr6-0Q@mail.gmail.com>
Message-ID: <4E23FD75.5080703@rabbitmq.com>

Hi,

On 18/07/11 10:04, mysurf mail wrote:

> While investigating this problem I found that one of the server RPC
> queues was deleted. and when the client tries to connect to it, it halts
> when trying.

> 2. Should I declare it in another way? Like changing the third parameter
> - autodelete to false? 

That is the first thing I would try. The queue is probably no longer in
use and therefore autodeleted. This is not an RPC-specific feature.


-Emile

From pierre-marie.padiou at morpho.com  Mon Jul 18 11:02:09 2011
From: pierre-marie.padiou at morpho.com (PADIOU Pierre-Marie (MORPHO))
Date: Mon, 18 Jul 2011 12:02:09 +0200
Subject: [rabbitmq-discuss] unexplained broker shutdown
Message-ID: <E9FBE39960CDBF4A8CD9DE7E9D14C509127085E15E@Y000IMRV01.rd1.rf1>

Hi there,

My broker encountered an error last week that caused him to shutdown.

Attached is a shortened version of the error log. It looks Chinese to me, can anyone help?

Thanks

Pierre-Marie
#
" Ce courriel et les documents qui lui sont joints peuvent contenir des informations confidentielles ou ayant un caract?re priv?. S'ils ne vous sont pas destin?s, nous vous signalons qu'il est strictement interdit de les divulguer, de les reproduire ou d'en utiliser de quelque mani?re que ce soit le contenu. Si ce message vous a ?t? transmis par erreur, merci d'en informer l'exp?diteur et de supprimer imm?diatement de votre syst?me informatique ce courriel ainsi que tous les documents qui y sont attach?s."
******
" This e-mail and any attached documents may contain confidential or proprietary information. If you are not the intended recipient, you are notified that any dissemination, copying of this e-mail and any attachments thereto or use of their contents by any means whatsoever is strictly prohibited. If you have received this e-mail in error, please advise the sender immediately and delete this e-mail and all attached documents from your computer system."
#
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110718/fa549fed/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit_shortened.log
Type: application/octet-stream
Size: 5688 bytes
Desc: rabbit_shortened.log
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110718/fa549fed/attachment.obj>

From matthias at rabbitmq.com  Mon Jul 18 11:02:41 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 18 Jul 2011 11:02:41 +0100
Subject: [rabbitmq-discuss] Persistent messages and durable
	queue	questions
In-Reply-To: <CAFDmHdOw__CWb3W0VLLD5LH8J_9G+HKNorrZJ_Sn64T=a_7zTg@mail.gmail.com>
References: <BANLkTinehFtF17CT6koQ-W_kUV-7fdJWSw@mail.gmail.com>	<4E01A49C.9010402@rabbitmq.com>	<BANLkTikBasN97dpS2XaPxh-Mr9rz4Ft-Xg@mail.gmail.com>	<0F51CD98-3C30-4029-855A-228B79C3FD71@rabbitmq.com>
	<CAFDmHdOw__CWb3W0VLLD5LH8J_9G+HKNorrZJ_Sn64T=a_7zTg@mail.gmail.com>
Message-ID: <4E2404C1.1000705@rabbitmq.com>

Elias,

On 08/07/11 18:23, Elias Levy wrote:
> We want to ensure that, if the queue is not reachable and there is a
> binding that matches the message to the queue, or the queue is not
> reachable and there is no binding that matches the message to the queue,
> (i.e. that the cluster has lost the node to which the queue is attached
> or the queue was deleted), that the producer will get a nack.  Publisher
> confirm fails here.
> [...]
> What is needed is a way to define a binding as durable, so that it won't
> be forgotten if the queue is references goes away because of a cluster
> partition or the queue is deleted.  It gives the system a hint that the
> queue in question should exist, but does not.  Alternatively, the system
> should not forget a durable queue just because the node it was attached
> goes away.  A durable queue should only be forgotten if it is actively
> deleted.

"absent" durable queues are only forgotten for routing purposes. 
RabbitMQ prevents re-creation of these queues since that would result in 
inconsistency when the node re-joins.

We could change things s.t. absent durable queues still participate in 
routing and that confirms return a 'nack' when messages are routed to 
such queues.

I am concerned though that there may be use cases where the current 
behaviour is the correct one.

Regards,

Matthias.

From matthias at rabbitmq.com  Mon Jul 18 11:08:34 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 18 Jul 2011 11:08:34 +0100
Subject: [rabbitmq-discuss] unexplained broker shutdown
In-Reply-To: <E9FBE39960CDBF4A8CD9DE7E9D14C509127085E15E@Y000IMRV01.rd1.rf1>
References: <E9FBE39960CDBF4A8CD9DE7E9D14C509127085E15E@Y000IMRV01.rd1.rf1>
Message-ID: <4E240622.6020709@rabbitmq.com>

Pierre-Marie,

On 18/07/11 11:02, PADIOU Pierre-Marie (MORPHO) wrote:
> My broker encountered an error last week that caused him to shutdown.
>
> Attached is a shortened version of the error log. It looks Chinese to
> me, can anyone help?

from the log...

> ** Reason for termination ==
> ** {{badmatch,{error,enospc}},
>     [{rabbit_msg_store,write_message,3},
>      {gen_server2,handle_msg,2},
>      {proc_lib,wake_up,3}]}

enospc == you have run out of disk space.


Matthias.

From alexandru at rabbitmq.com  Mon Jul 18 11:08:26 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Mon, 18 Jul 2011 11:08:26 +0100
Subject: [rabbitmq-discuss] unexplained broker shutdown
In-Reply-To: <E9FBE39960CDBF4A8CD9DE7E9D14C509127085E15E@Y000IMRV01.rd1.rf1>
References: <E9FBE39960CDBF4A8CD9DE7E9D14C509127085E15E@Y000IMRV01.rd1.rf1>
Message-ID: <20110718100826.GA2938@dakota.eng.vmware.com>

Hi,

The error seems to say it ran out of disk space while writing a message
to disk.  Is this possible?

Cheers,
Alex


On Mon, Jul 18, 2011 at 12:02:09PM +0200, PADIOU Pierre-Marie (MORPHO) wrote:
> Hi there,
> 
> My broker encountered an error last week that caused him to shutdown.
> 
> Attached is a shortened version of the error log. It looks Chinese to me, can anyone help?
> 
> Thanks
> 
> Pierre-Marie
> #
> " Ce courriel et les documents qui lui sont joints peuvent contenir des informations confidentielles ou ayant un caract?re priv?. S'ils ne vous sont pas destin?s, nous vous signalons qu'il est strictement interdit de les divulguer, de les reproduire ou d'en utiliser de quelque mani?re que ce soit le contenu. Si ce message vous a ?t? transmis par erreur, merci d'en informer l'exp?diteur et de supprimer imm?diatement de votre syst?me informatique ce courriel ainsi que tous les documents qui y sont attach?s."
> ******
> " This e-mail and any attached documents may contain confidential or proprietary information. If you are not the intended recipient, you are notified that any dissemination, copying of this e-mail and any attachments thereto or use of their contents by any means whatsoever is strictly prohibited. If you have received this e-mail in error, please advise the sender immediately and delete this e-mail and all attached documents from your computer system."
> #


> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From matthias at rabbitmq.com  Mon Jul 18 11:12:56 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 18 Jul 2011 11:12:56 +0100
Subject: [rabbitmq-discuss] Reading messages using basicGet
In-Reply-To: <CAJE2eFHC5dNYpL94C5Z=M7C071rZNmz5HRUjzXptZdUGdixaVA@mail.gmail.com>
References: <CAJE2eFHC5dNYpL94C5Z=M7C071rZNmz5HRUjzXptZdUGdixaVA@mail.gmail.com>
Message-ID: <4E240728.6070804@rabbitmq.com>

Demi,

On 15/07/11 20:18, Demi Zike wrote:
> I read the api-guide on your website at
> http://www.rabbitmq.com/api-guide.html. Retrieving individual messages
> using basicGet will get the job done but I am dealing with reading from
> multiple queues.
>
> I have a List of strings that store to which queues my app subscribed to
> read messages from.  How can I read through each of them until I find a
> message to return if there is one. And if I searched all the queues for
> available messages and didn't find any message sent to any of them then
> I want to return null.

basic.get returns basic.get-empty when the queue is empty. So simply 
iterate through the list of queues and do a basicGet on them until you 
find a message or reach the end.

Regards,

Matthias.

From pierre-marie.padiou at morpho.com  Mon Jul 18 11:35:36 2011
From: pierre-marie.padiou at morpho.com (PADIOU Pierre-Marie (MORPHO))
Date: Mon, 18 Jul 2011 12:35:36 +0200
Subject: [rabbitmq-discuss] unexplained broker shutdown
In-Reply-To: <20110718100826.GA2938@dakota.eng.vmware.com>
References: <E9FBE39960CDBF4A8CD9DE7E9D14C509127085E15E@Y000IMRV01.rd1.rf1>
	<20110718100826.GA2938@dakota.eng.vmware.com>
Message-ID: <E9FBE39960CDBF4A8CD9DE7E9D14C509127085E18A@Y000IMRV01.rd1.rf1>

Thanks for the quick answer!

There are still 10GB available on my server. Furthermore, we're not using persistent messages (I mean, we should not).

Is there a minimum amount of disk space available for rabbitmq to run? Like 10GB?

Is this error raised in case we are running out of disk space for logs (not for messages)?

Pierre-Marie


-----Original Message-----
From: Alexandru Scvor?ov [mailto:scvalex at gmail.com] On Behalf Of Alexandru Scvortov
Sent: Monday, July 18, 2011 12:08 PM
To: PADIOU Pierre-Marie (MORPHO)
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] unexplained broker shutdown

Hi,

The error seems to say it ran out of disk space while writing a message
to disk.  Is this possible?

Cheers,
Alex


On Mon, Jul 18, 2011 at 12:02:09PM +0200, PADIOU Pierre-Marie (MORPHO) wrote:
> Hi there,
> 
> My broker encountered an error last week that caused him to shutdown.
> 
> Attached is a shortened version of the error log. It looks Chinese to me, can anyone help?
> 
> Thanks
> 
> Pierre-Marie
> #
> " Ce courriel et les documents qui lui sont joints peuvent contenir des informations confidentielles ou ayant un caract?re priv?. S'ils ne vous sont pas destin?s, nous vous signalons qu'il est strictement interdit de les divulguer, de les reproduire ou d'en utiliser de quelque mani?re que ce soit le contenu. Si ce message vous a ?t? transmis par erreur, merci d'en informer l'exp?diteur et de supprimer imm?diatement de votre syst?me informatique ce courriel ainsi que tous les documents qui y sont attach?s."
> ******
> " This e-mail and any attached documents may contain confidential or proprietary information. If you are not the intended recipient, you are notified that any dissemination, copying of this e-mail and any attachments thereto or use of their contents by any means whatsoever is strictly prohibited. If you have received this e-mail in error, please advise the sender immediately and delete this e-mail and all attached documents from your computer system."
> #


> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

#
" Ce courriel et les documents qui lui sont joints peuvent contenir des informations confidentielles ou ayant un caract?re priv?. S'ils ne vous sont pas destin?s, nous vous signalons qu'il est strictement interdit de les divulguer, de les reproduire ou d'en utiliser de quelque mani?re que ce soit le contenu. Si ce message vous a ?t? transmis par erreur, merci d'en informer l'exp?diteur et de supprimer imm?diatement de votre syst?me informatique ce courriel ainsi que tous les documents qui y sont attach?s."
******
" This e-mail and any attached documents may contain confidential or proprietary information. If you are not the intended recipient, you are notified that any dissemination, copying of this e-mail and any attachments thereto or use of their contents by any means whatsoever is strictly prohibited. If you have received this e-mail in error, please advise the sender immediately and delete this e-mail and all attached documents from your computer system."
#

From matthias at rabbitmq.com  Mon Jul 18 11:41:17 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 18 Jul 2011 11:41:17 +0100
Subject: [rabbitmq-discuss] unexplained broker shutdown
In-Reply-To: <E9FBE39960CDBF4A8CD9DE7E9D14C509127085E18A@Y000IMRV01.rd1.rf1>
References: <E9FBE39960CDBF4A8CD9DE7E9D14C509127085E15E@Y000IMRV01.rd1.rf1>	<20110718100826.GA2938@dakota.eng.vmware.com>
	<E9FBE39960CDBF4A8CD9DE7E9D14C509127085E18A@Y000IMRV01.rd1.rf1>
Message-ID: <4E240DCD.9050600@rabbitmq.com>

Pierre-Marie,

On 18/07/11 11:35, PADIOU Pierre-Marie (MORPHO) wrote:
> There are still 10GB available on my server.

Is that after you restarted the server? If so that's not surprising. See 
next point...

> Furthermore, we're not using persistent messages

Rabbit ran out of disk space when paging transient messages to disk in 
response to memory pressure.

Restarting rabbit will delete these messages (since they are transient).

> Is there a minimum amount of disk space available for rabbitmq to
> run? Like 10GB?

A few hundred k should do.

> Is this error raised in case we are running out of disk space for
> logs (not for messages)?

No, the error would be different.

Regards,

Matthias.

From pierre-marie.padiou at morpho.com  Mon Jul 18 11:56:50 2011
From: pierre-marie.padiou at morpho.com (PADIOU Pierre-Marie (MORPHO))
Date: Mon, 18 Jul 2011 12:56:50 +0200
Subject: [rabbitmq-discuss] unexplained broker shutdown
In-Reply-To: <4E240DCD.9050600@rabbitmq.com>
References: <E9FBE39960CDBF4A8CD9DE7E9D14C509127085E15E@Y000IMRV01.rd1.rf1>
	<20110718100826.GA2938@dakota.eng.vmware.com>
	<E9FBE39960CDBF4A8CD9DE7E9D14C509127085E18A@Y000IMRV01.rd1.rf1>
	<4E240DCD.9050600@rabbitmq.com>
Message-ID: <E9FBE39960CDBF4A8CD9DE7E9D14C509127085E1AD@Y000IMRV01.rd1.rf1>

Thanks, that explains everything.

What triggers message paging? Is there a configurable threshold?

Thanks,

Pierre-Marie


-----Original Message-----
From: Matthias Radestock [mailto:matthias at rabbitmq.com] 
Sent: Monday, July 18, 2011 12:41 PM
To: PADIOU Pierre-Marie (MORPHO)
Cc: Alexandru Scvor?ov; rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] unexplained broker shutdown

Pierre-Marie,

On 18/07/11 11:35, PADIOU Pierre-Marie (MORPHO) wrote:
> There are still 10GB available on my server.

Is that after you restarted the server? If so that's not surprising. See 
next point...

> Furthermore, we're not using persistent messages

Rabbit ran out of disk space when paging transient messages to disk in 
response to memory pressure.

Restarting rabbit will delete these messages (since they are transient).

> Is there a minimum amount of disk space available for rabbitmq to
> run? Like 10GB?

A few hundred k should do.

> Is this error raised in case we are running out of disk space for
> logs (not for messages)?

No, the error would be different.

Regards,

Matthias.
#
" Ce courriel et les documents qui lui sont joints peuvent contenir des informations confidentielles ou ayant un caract?re priv?. S'ils ne vous sont pas destin?s, nous vous signalons qu'il est strictement interdit de les divulguer, de les reproduire ou d'en utiliser de quelque mani?re que ce soit le contenu. Si ce message vous a ?t? transmis par erreur, merci d'en informer l'exp?diteur et de supprimer imm?diatement de votre syst?me informatique ce courriel ainsi que tous les documents qui y sont attach?s."
******
" This e-mail and any attached documents may contain confidential or proprietary information. If you are not the intended recipient, you are notified that any dissemination, copying of this e-mail and any attachments thereto or use of their contents by any means whatsoever is strictly prohibited. If you have received this e-mail in error, please advise the sender immediately and delete this e-mail and all attached documents from your computer system."
#

From matthias at rabbitmq.com  Mon Jul 18 12:14:16 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 18 Jul 2011 12:14:16 +0100
Subject: [rabbitmq-discuss] unexplained broker shutdown
In-Reply-To: <E9FBE39960CDBF4A8CD9DE7E9D14C509127085E1AD@Y000IMRV01.rd1.rf1>
References: <E9FBE39960CDBF4A8CD9DE7E9D14C509127085E15E@Y000IMRV01.rd1.rf1>	<20110718100826.GA2938@dakota.eng.vmware.com>
	<E9FBE39960CDBF4A8CD9DE7E9D14C509127085E18A@Y000IMRV01.rd1.rf1>
	<4E240DCD.9050600@rabbitmq.com>
	<E9FBE39960CDBF4A8CD9DE7E9D14C509127085E1AD@Y000IMRV01.rd1.rf1>
Message-ID: <4E241588.9040300@rabbitmq.com>

Pierre-Marie,

On 18/07/11 11:56, PADIOU Pierre-Marie (MORPHO) wrote:
> What triggers message paging?

Running low on memory. Or, more accurately, rabbit estimating that it 
will run out of memory if messages keep getting produced/consumed at the 
current rates.

> Is there a configurable threshold?

There is no threshold as such at which paging starts, due to the 
heuristics mentioned above. There is, however, a threshold telling 
rabbit how much memory it has to play with. See 
http://www.rabbitmq.com/extensions.html#memsup. I recommend not fiddling 
with that.

Regards,

Matthias.

From rob at rabbitmq.com  Mon Jul 18 12:31:23 2011
From: rob at rabbitmq.com (Rob Harrop)
Date: Mon, 18 Jul 2011 12:31:23 +0100
Subject: [rabbitmq-discuss] How to stop a consumer from consuming
 message after a message SHUTDOWN
In-Reply-To: <14699471.881.1310572077827.JavaMail.geo-discussion-forums@yqjc4>
References: <14699471.881.1310572077827.JavaMail.geo-discussion-forums@yqjc4>
Message-ID: <4E24198B.3030406@rabbitmq.com>

Toni,

Once your consumer receives the SHUTDOWN message you can simply have it
issue a Channel.basicCancel passing in the consumer's consumer tag.

The tag is returned by the basicConsume method, and is either one you
supplied or a broker-generated one.

Regards,

Rob


Toni Van de Voorde wrote:
> Hello all,
>
> We have a java application with rabbitmq consumers which processes
> different things based on a given message published from a php application.
>
> When we need to upgrade the java application we would like a save way to
> shutdown the java. We thought about sending a message SHUTDOWN. But we
> can't seem to find a way to stop the consumer from consuming. Is it the
> correct way to do it or is there another way.
>
> The java application is running in background on linux (not through an
> application server).
>
> Thx
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From pierre-marie.padiou at morpho.com  Mon Jul 18 13:04:13 2011
From: pierre-marie.padiou at morpho.com (PADIOU Pierre-Marie (MORPHO))
Date: Mon, 18 Jul 2011 14:04:13 +0200
Subject: [rabbitmq-discuss] unexplained broker shutdown
In-Reply-To: <4E241588.9040300@rabbitmq.com>
References: <E9FBE39960CDBF4A8CD9DE7E9D14C509127085E15E@Y000IMRV01.rd1.rf1>
	<20110718100826.GA2938@dakota.eng.vmware.com>
	<E9FBE39960CDBF4A8CD9DE7E9D14C509127085E18A@Y000IMRV01.rd1.rf1>
	<4E240DCD.9050600@rabbitmq.com>
	<E9FBE39960CDBF4A8CD9DE7E9D14C509127085E1AD@Y000IMRV01.rd1.rf1>
	<4E241588.9040300@rabbitmq.com>
Message-ID: <E9FBE39960CDBF4A8CD9DE7E9D14C509127085E268@Y000IMRV01.rd1.rf1>

Last question ;-)

Can the broker make the decision to page messages even if there is plenty of ram left (say 30GB out of 40GB?), just on its estimation?

Pierre-Marie


-----Original Message-----
From: Matthias Radestock [mailto:matthias at rabbitmq.com] 
Sent: Monday, July 18, 2011 1:14 PM
To: PADIOU Pierre-Marie (MORPHO)
Cc: Alexandru Scvor?ov; rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] unexplained broker shutdown

Pierre-Marie,

On 18/07/11 11:56, PADIOU Pierre-Marie (MORPHO) wrote:
> What triggers message paging?

Running low on memory. Or, more accurately, rabbit estimating that it 
will run out of memory if messages keep getting produced/consumed at the 
current rates.

> Is there a configurable threshold?

There is no threshold as such at which paging starts, due to the 
heuristics mentioned above. There is, however, a threshold telling 
rabbit how much memory it has to play with. See 
http://www.rabbitmq.com/extensions.html#memsup. I recommend not fiddling 
with that.

Regards,

Matthias.
#
" Ce courriel et les documents qui lui sont joints peuvent contenir des informations confidentielles ou ayant un caract?re priv?. S'ils ne vous sont pas destin?s, nous vous signalons qu'il est strictement interdit de les divulguer, de les reproduire ou d'en utiliser de quelque mani?re que ce soit le contenu. Si ce message vous a ?t? transmis par erreur, merci d'en informer l'exp?diteur et de supprimer imm?diatement de votre syst?me informatique ce courriel ainsi que tous les documents qui y sont attach?s."
******
" This e-mail and any attached documents may contain confidential or proprietary information. If you are not the intended recipient, you are notified that any dissemination, copying of this e-mail and any attachments thereto or use of their contents by any means whatsoever is strictly prohibited. If you have received this e-mail in error, please advise the sender immediately and delete this e-mail and all attached documents from your computer system."
#

From matthias at rabbitmq.com  Mon Jul 18 13:15:32 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 18 Jul 2011 13:15:32 +0100
Subject: [rabbitmq-discuss] unexplained broker shutdown
In-Reply-To: <E9FBE39960CDBF4A8CD9DE7E9D14C509127085E268@Y000IMRV01.rd1.rf1>
References: <E9FBE39960CDBF4A8CD9DE7E9D14C509127085E15E@Y000IMRV01.rd1.rf1>	<20110718100826.GA2938@dakota.eng.vmware.com>
	<E9FBE39960CDBF4A8CD9DE7E9D14C509127085E18A@Y000IMRV01.rd1.rf1>
	<4E240DCD.9050600@rabbitmq.com>
	<E9FBE39960CDBF4A8CD9DE7E9D14C509127085E1AD@Y000IMRV01.rd1.rf1>
	<4E241588.9040300@rabbitmq.com>
	<E9FBE39960CDBF4A8CD9DE7E9D14C509127085E268@Y000IMRV01.rd1.rf1>
Message-ID: <4E2423E4.9020601@rabbitmq.com>

Pierre-Marie,

On 18/07/11 13:04, PADIOU Pierre-Marie (MORPHO) wrote:
> Can the broker make the decision to page messages even if there is
> plenty of ram left (say 30GB out of 40GB?), just on its estimation?

Yes.

Matthias.

From matthew at rabbitmq.com  Mon Jul 18 13:20:48 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 18 Jul 2011 13:20:48 +0100
Subject: [rabbitmq-discuss] unexplained broker shutdown
In-Reply-To: <E9FBE39960CDBF4A8CD9DE7E9D14C509127085E268@Y000IMRV01.rd1.rf1>
References: <E9FBE39960CDBF4A8CD9DE7E9D14C509127085E15E@Y000IMRV01.rd1.rf1>
	<20110718100826.GA2938@dakota.eng.vmware.com>
	<E9FBE39960CDBF4A8CD9DE7E9D14C509127085E18A@Y000IMRV01.rd1.rf1>
	<4E240DCD.9050600@rabbitmq.com>
	<E9FBE39960CDBF4A8CD9DE7E9D14C509127085E1AD@Y000IMRV01.rd1.rf1>
	<4E241588.9040300@rabbitmq.com>
	<E9FBE39960CDBF4A8CD9DE7E9D14C509127085E268@Y000IMRV01.rd1.rf1>
Message-ID: <20110718122048.GA2614@rabbitmq.com>

On Mon, Jul 18, 2011 at 02:04:13PM +0200, PADIOU Pierre-Marie (MORPHO) wrote:
> Can the broker make the decision to page messages even if there is plenty of ram left (say 30GB out of 40GB?), just on its estimation?

Yes.

The worst possible implementation of paging would be to wait until all
RAM is used up, and then write out potentially millions of messages.

Essentially, Rabbit has to decide how to allocate RAM (and actually more
importantly, disk bandwidth) to queues. In many ways, it tries to
prioritise the allocation of RAM to queues that are very active (i.e.
lots of msgs being received by and/or sent by the queue) because such
queues would not be able to cope with the performance hit of being
written to disk.

To avoid the crow-bar effect of suddenly having to write out millions of
messages, Rabbit starts writing out messages fairly early on. In most
cases, should RAM remain relatively plentiful, these msgs will be only
written async, and never read, because a copy will remain in RAM until
memory pressure is such that the RAM copy has to be discarded.

Due to taking into account the effects of garbage collection and other
issues, it's possible that Rabbit, with default configuration, will
start paging out messages to disk when it's using only 8% of the RAM
installed in the machine.

The goal is for Rabbit to try and stay as responsive as possible in all
its operations for as long as possible, as memory gets tighter and
tighter. Once that goal fails (i.e. we have to block publishers because,
ultimately, they're publishing msgs faster than we can write them to
disk), the next goal is to ensure that Rabbit will always be able to
recover (assuming disk space is plentiful) to the point where it will be
able to accept the next message sent to it.

Matthew

From matthias at rabbitmq.com  Mon Jul 18 13:59:36 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 18 Jul 2011 13:59:36 +0100
Subject: [rabbitmq-discuss]
 =?windows-1252?q?Python_=26_RabbitMQ_=97_Commu?=
 =?windows-1252?q?nicate_Between_Parent_=26_Children=3F?=
In-Reply-To: <1172664034-1310766680-cardhu_decombobulator_blackberry.rim.net-1286063907-@b1.c23.bise6.blackberry>
References: <1172664034-1310766680-cardhu_decombobulator_blackberry.rim.net-1286063907-@b1.c23.bise6.blackberry>
Message-ID: <4E242E38.4000503@rabbitmq.com>

On 15/07/11 22:51, csharpplusproject at gmail.com wrote:
> The workers' messages to the parent are independent of the parent's
> message to the workers. These are two separate things that work in
> parallel.
>
> Note that the parents sends *the same message* to all workers, while
> (separately) each one of the workers sends *its own unique message*
> straight to the parent.

As Jason suggested, the parent->child messaging could be accomplished 
with a fanout exchange an private per-worker queues.

And for the child->parent communication, just get the parent to create a 
queue with a well-known name and get the children to publish to that via 
the default exchange.

> I am brand new to rabbitMQ -- is it possible to provide some further
> info / code snippets that would allow me to get a better sense of
> things?

If you haven't done so already, please go through our tutorials at 
http://www.rabbitmq.com/getstarted.html


Regards,

Matthias.

From josh at gebaschtel.ch  Mon Jul 18 14:39:27 2011
From: josh at gebaschtel.ch (Josh Geisser)
Date: Mon, 18 Jul 2011 15:39:27 +0200
Subject: [rabbitmq-discuss] Pika Question (publish and consume as fast as
	possible)
Message-ID: <9C37154E143FE14CBA656B2D2232745F08CE65CF05F8@popeye.gebaschtel.bnet>

Hi List

(with all the Pika relevant mails going around this list would be worth to have a dedicated pika list?)

Anyway, I want to write a little AMPQ Ping tool which should allow us to test various delivery patterns over a Rabbit Cluster.

For that I want to have the possibility to publish and consume as fast as possible, also kind of benchmarking the system.

I made some progress in getting into Pika and think I understand the idea of the TCP_Backpressure, but I find it a bit hard to implement it on the 'enduser' side. (I found the old idea of TX_ and TX_commit easier to prevent overflow...)

Long speech short, I ended up with using 'BlockingConnection' for publishing and 'SelectConnection' for consuming, otherwise i always ran into buffer-warnings and eventually crashes ....

Could someone provide me with a quick snipped that publish/consumes as fast as possible, the way you'd implement it?

Cheers & thanks a lot
Josh

(pika in my case latest git-version, Python 2.7.2)

From aaron at agoragames.com  Mon Jul 18 15:36:40 2011
From: aaron at agoragames.com (Aaron Westendorf)
Date: Mon, 18 Jul 2011 10:36:40 -0400
Subject: [rabbitmq-discuss] Pika Question (publish and consume as fast
	as possible)
In-Reply-To: <9C37154E143FE14CBA656B2D2232745F08CE65CF05F8@popeye.gebaschtel.bnet>
References: <9C37154E143FE14CBA656B2D2232745F08CE65CF05F8@popeye.gebaschtel.bnet>
Message-ID: <CAHiEoM7RacpRBrX7mGga6uVZvCtCcLadUTGpV7dWv-+i=OLtNQ@mail.gmail.com>

Not in pika, but the stress test script in haigha should get you started.

https://github.com/agoragames/haigha/blob/master/scripts/stress_test



On Mon, Jul 18, 2011 at 9:39 AM, Josh Geisser <josh at gebaschtel.ch> wrote:
> Hi List
>
> (with all the Pika relevant mails going around this list would be worth to have a dedicated pika list?)
>
> Anyway, I want to write a little AMPQ Ping tool which should allow us to test various delivery patterns over a Rabbit Cluster.
>
> For that I want to have the possibility to publish and consume as fast as possible, also kind of benchmarking the system.
>
> I made some progress in getting into Pika and think I understand the idea of the TCP_Backpressure, but I find it a bit hard to implement it on the 'enduser' side. (I found the old idea of TX_ and TX_commit easier to prevent overflow...)
>
> Long speech short, I ended up with using 'BlockingConnection' for publishing and 'SelectConnection' for consuming, otherwise i always ran into buffer-warnings and eventually crashes ....
>
> Could someone provide me with a quick snipped that publish/consumes as fast as possible, the way you'd implement it?
>
> Cheers & thanks a lot
> Josh
>
> (pika in my case latest git-version, Python 2.7.2)
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From majek04 at gmail.com  Mon Jul 18 16:06:29 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Mon, 18 Jul 2011 16:06:29 +0100
Subject: [rabbitmq-discuss] Pika Question (publish and consume as fast
	as possible)
In-Reply-To: <9C37154E143FE14CBA656B2D2232745F08CE65CF05F8@popeye.gebaschtel.bnet>
References: <9C37154E143FE14CBA656B2D2232745F08CE65CF05F8@popeye.gebaschtel.bnet>
Message-ID: <CABzX+qy4b1cdLb6GqN_s3DDc-gPnnZdXySpJ4Fvgd6Xdr9iioA@mail.gmail.com>

On Mon, Jul 18, 2011 at 14:39, Josh Geisser <josh at gebaschtel.ch> wrote:
> Anyway, I want to write a little AMPQ Ping tool which should allow us to test various delivery patterns over a Rabbit Cluster.
>
> For that I want to have the possibility to publish and consume as fast as possible, also kind of benchmarking the system.

You are aware that Python is not the fastest language, right?

My rough guess would be that for a decent client you should be able to
get something like 1k - 6k msgs/sec for simple messaging patterns.

>
> I made some progress in getting into Pika and think I understand the idea of the TCP_Backpressure, but I find it a bit hard to implement it on the 'enduser' side. (I found the old idea of TX_ and TX_commit easier to prevent overflow...)
>
> Long speech short, I ended up with using 'BlockingConnection' for publishing and 'SelectConnection' for consuming, otherwise i always ran into buffer-warnings and eventually crashes ....
>
> Could someone provide me with a quick snipped that publish/consumes as fast as possible, the way you'd implement it?
>
> Cheers & thanks a lot
> Josh
>
> (pika in my case latest git-version, Python 2.7.2)
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From csharpplusproject at gmail.com  Mon Jul 18 16:12:06 2011
From: csharpplusproject at gmail.com (csharpplusproject at gmail.com)
Date: Mon, 18 Jul 2011 15:12:06 +0000
Subject: [rabbitmq-discuss] RabbitMQ -- communicate between 3 different
	machines?
In-Reply-To: <9364AF17-6BB1-4E31-8377-46C556CF8F11@gmail.com>
References: <0c484afa-9cb5-45cf-acf1-2471822fc3fc@n5g2000yqh.googlegroups.com>
	<CAHZAEpewL5i1Cz9tZCZPTASoAGBrhgfdPgEy7bDn=M5bLYd44w@mail.gmail.com>
	<1310944345.1866.722.camel@internet>
	<C50E687B-F6DD-4945-9352-1B3B38477DDC@gmail.com>
	<1310947904.1866.729.camel@internet>
	<0230E5CB-7EC2-4F60-87A0-06BE9B09EA3D@gmail.com>
	<1310951266.1866.732.camel@internet><9364AF17-6BB1-4E31-8377-46C556CF8F11@gmail.com>
Message-ID: <1765040811-1311001949-cardhu_decombobulator_blackberry.rim.net-807202078-@b1.c23.bise6.blackberry>

Jason,

Thank you for your response.

You write: "...This is being addressed by the mirrored queues feature that should be available soon."

When will this feature be available?

Once available, it looks like things will be pretty reliable, even if a node in the cluster fails. 

In such a case, will the use of Pacemaker  etc still be necessary? 

Thanks,
Shalom.
Sent via BlackBerry from T-Mobile

-----Original Message-----
From: "Jason J. W. Williams" <jasonjwwilliams at gmail.com>
Date: Mon, 18 Jul 2011 02:11:09 
To: csharpplusproject<csharpplusproject at gmail.com>
Cc: Alvaro Videla<videlalvaro at gmail.com>; rabbitmq-discuss at lists.rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
Subject: Re: [rabbitmq-discuss] RabbitMQ -- communicate between 3 different machines?

Hi Shalom,

They will be considered independent unless you cluster them. In which case, the servers will appear as a single unit with the same queues, exchanges and bindings. Where this breaks down is when a server in the cluster fails. While queues are accessible from any cluster node, each queue is only stored on one node (the cluster tries to evenly distribute the queues as they are declared). So when a cluster node fails, any queues it was the master for disappear until the node is returned to service. This is being addressed by the mirrored queues feature that should be available soon. 

Does that answer your question?

-J

Sent via iPhone

Is your email Premiere?

On Jul 17, 2011, at 19:07, csharpplusproject <csharpplusproject at gmail.com> wrote:

> Hi Alvaro,
> 
> Thank you for the link and your book recommendation.
> 
> Just so that I get things straight, if I install RabbitMQ on 2 different IPs -- say, {192.168.0.1, 192.168.0.2} -- will both of these be considered DIFFERENT, independent RabbitMQ servers?
> Meaning, each server will carry on its own tasks, messages etc?
> 
> Thanks,
> Shalom.
> 
> -----Original Message-----
> From: Alvaro Videla <videlalvaro at gmail.com>
> To: csharpplusproject <csharpplusproject at gmail.com>
> Cc: Jason J. W. Williams <jasonjwwilliams at gmail.com>, rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] RabbitMQ -- communicate between 3 different machines?
> Date: Mon, 18 Jul 2011 02:21:27 +0200
> 
> Hi Shalom, 
> 
> You can read the guide here: http://www.rabbitmq.com/pacemaker.html 
> 
> Not that I like to do self advertisement, but you can also read our book about RabbitMQ that discusses clustering too: http://bitly.com/rabbitmq 
> 
> Cheers, 
> 
> Alvaro 
> On Jul 18, 2011, at 2:11 AM, csharpplusproject wrote: 
>> Hi Alavro,
>> 
>> Thank you for your response.
>> 
>> Yes, I confirm that I am successful connecting to my server (192.168.0.1) from my 2 worker clients (192.168.0.2, 192.168.0.3) by specifying the server's IP.
>> 
>> Yet, this brings down another question -- in this case, I have a single server (192.168.0.1) and 2 worker clients (192.168.0.2, 192.168.0.3).
>> 
>> Since my server is a 'single point of failure', what happens if my server dies? How does RabbitMQ handle such a case?
>> 
>> Is there a way to make things more reliabile? (for instance, have multiple nodes that will all have the same contents of 192.168.0.1 and thus provide reliability in case the main server dies...).
>> 
>> I appreciate your help.
>> 
>> Best,
>> Shalom.
>> 
>> 
>> -----Original Message-----
>> From: Alvaro Videla <videlalvaro at gmail.com>
>> To: csharpplusproject <csharpplusproject at gmail.com>
>> Cc: Jason J. W. Williams <jasonjwwilliams at gmail.com>, rabbitmq-discuss at lists.rabbitmq.com
>> Subject: Re: [rabbitmq-discuss] RabbitMQ -- communicate between 3 different machines?
>> Date: Mon, 18 Jul 2011 01:20:23 +0200
>> 
>> Hi Shalom, 
>> 
>> Start RabbitMQ on server 192.168.0.1. 
>> 
>> Then go to say server 192.168.0.2 and start one of the workers. Do the same on server 192.168.0.3  (Change the IP according to your configuration of course). 
>> 
>> Then on the workers code you have to specify on which host RabbitMQ is running. For example on the first tutorial you see this code: 
>> 
>> connection = pika.BlockingConnection(pika.ConnectionParameters(
>>                'localhost'))
>> 
>> 
>> Change "localhost" for the IP where RabbitMQ is running. Do the same for the message publisher. 
>> 
>> See the documentation here: http://pika.github.com/connecting.html#connection-parameters to understand the parameters passed to a new connection. 
>> 
>> Cheers, 
>> 
>> Alvaro 
>> On Jul 18, 2011, at 1:12 AM, csharpplusproject wrote: 
>>> Hi Jason,
>>> 
>>> Thank you for your assistance.
>>> 
>>> Suppose that the RabbitMQ server is installed on host 192.168.0.1;
>>> 
>>> How do I establish a connection between my 2 worker clients (192.168.0.2, 192.168.0.3), and the RabbitMQ server? (I'm using the pika client)
>>> 
>>> Thanks,
>>> Shalom.
>>> 
>>> -----Original Message-----
>>> From: Jason J. W. Williams <jasonjwwilliams at gmail.com>
>>> To: Shalom Rav <csharpplusproject at gmail.com>
>>> Cc: rabbitmq-discuss at lists.rabbitmq.com
>>> Subject: Re: [rabbitmq-discuss] RabbitMQ -- communicate between 3 different machines?
>>> Date: Sun, 17 Jul 2011 16:50:06 -0600
>>> 
>>> Hi Shalom,
>>> 
>>> The connection is not between the machines/clients themselves, but
>>> rather between the clients and the server running the RabbitMQ broker.
>>> You should be able to bind the clients to the queues you're using in
>>> the examples and RMQ will round robin incoming messages between them.
>>> 
>>> -J
>>> 
>>> On Sun, Jul 17, 2011 at 3:26 PM, Shalom Rav <csharpplusproject at gmail.com> wrote:
>>> > Using a SINGLE MACHINE, I have successfuly run the first 4 examples
>>> > that are on the RabbitMQ website.
>>> >
>>> > Now, I'd like to test THE SAME EXAMPLES using 3 different machines
>>> > that are connected in a network.
>>> >
>>> > Suppose that the RabbitMQ server is installed ONLY on host
>>> > 192.168.0.1;
>>> >
>>> > And suppose that I'd like to use machines {192.168.0.2, 192.168.0.3}
>>> > as *workers* (they DO NOT have the RabbitMQ server installed on
>>> > them).
>>> >
>>> > Taking for instance the first example {send.py, receive.py} -- how do
>>> > I establish the connection between the three machines?
>>> >
>>> >_______________________________________________
>>> > rabbitmq-discuss mailing list
>>> > rabbitmq-discuss at lists.rabbitmq.com
>>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> >
>>> 
>>> 
>>>_______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> Sent form my Nokia 1100 
>> 
>> 
>> 
>> 
>> 
>> 
>> 
> 
> Sent form my Nokia 1100 
> 
> 
> 
> 
> 
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110718/e7bfa41f/attachment.htm>

From matthew at rabbitmq.com  Mon Jul 18 16:19:55 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 18 Jul 2011 16:19:55 +0100
Subject: [rabbitmq-discuss] RabbitMQ -- communicate between 3 different
 machines?
In-Reply-To: <1765040811-1311001949-cardhu_decombobulator_blackberry.rim.net-807202078-@b1.c23.bise6.blackberry>
References: <0c484afa-9cb5-45cf-acf1-2471822fc3fc@n5g2000yqh.googlegroups.com>
	<CAHZAEpewL5i1Cz9tZCZPTASoAGBrhgfdPgEy7bDn=M5bLYd44w@mail.gmail.com>
	<1310944345.1866.722.camel@internet>
	<C50E687B-F6DD-4945-9352-1B3B38477DDC@gmail.com>
	<1310947904.1866.729.camel@internet>
	<0230E5CB-7EC2-4F60-87A0-06BE9B09EA3D@gmail.com>
	<1310951266.1866.732.camel@internet>
	<9364AF17-6BB1-4E31-8377-46C556CF8F11@gmail.com>
	<1765040811-1311001949-cardhu_decombobulator_blackberry.rim.net-807202078-@b1.c23.bise6.blackberry>
Message-ID: <20110718151954.GD2614@rabbitmq.com>

On Mon, Jul 18, 2011 at 03:12:06PM +0000, csharpplusproject at gmail.com wrote:
> You write: "...This is being addressed by the mirrored queues feature that should be available soon."
> When will this feature be available?

In the future. Hopefully soon, but no one really knows. We should be
talking weeks, not months though. It'll be in the next release, whenever
that happens.

> In such a case, will the use of Pacemaker  etc still be necessary? 

Nope. But there are still use cases for Pacemaker, eg pacemaker doesn't
rely on you forming a cluster. Pacemaker can integrate with other
services too, so, for example, you can say in pacemaker than you always
want your rabbit service to be on the same machine as your apache
service, and such like. Pacemaker works well when you have a range of
services that you wish to make HA-like decisions about. The
active/active HA that's coming with Rabbit only knows about Rabbit.

That said, it should be possible to have configurations that use both.

Matthew

From csharpplusproject at gmail.com  Mon Jul 18 16:24:18 2011
From: csharpplusproject at gmail.com (csharpplusproject at gmail.com)
Date: Mon, 18 Jul 2011 15:24:18 +0000
Subject: [rabbitmq-discuss]
	=?windows-1252?q?Python_=26_RabbitMQ_=97_Commu?=
	=?windows-1252?q?nicate_Between_Parent_=26_Children=3F?=
Message-ID: <776465424-1311002681-cardhu_decombobulator_blackberry.rim.net-666815522-@b1.c23.bise6.blackberry>

Hi Matthias,

Thank you for your response.

Yes, I have gone through your tutorial.

It looks like the (workers --> parent) case is handled by a code similar to your FIRST example.

Also, it looks like the (parent --> workers) case is handled by a code similar to your THIRD example (parent is a publisher, fanout, all workers are consumers).

I was able to combine both cases into one piece of code, and it works.

The problem that I have is that the code *hangs* on sending / receiving messages, leaving no room for my actual app to run.

I think this is due to the 'start_consuming' function call, which runs infinitely and won't let any code underneath it to get executed.

Is there a way to have the messaging run in the *background* -- thus, not blocking the regular work of the app?

Thanks,
Shalom.
------Original Message------
From: Matthias Radestock
To: csharpplusproject at gmail.com
Cc: Jason J. W. Williams
Cc: rabbitmq-discuss at lists.rabbitmq.com
Sent: Jul 18, 2011 08:59
Subject: Re: [rabbitmq-discuss] Python & RabbitMQ ? Communicate Between Parent & Children?

On 15/07/11 22:51, csharpplusproject at gmail.com wrote:
> The workers' messages to the parent are independent of the parent's
> message to the workers. These are two separate things that work in
> parallel.
>
> Note that the parents sends *the same message* to all workers, while
> (separately) each one of the workers sends *its own unique message*
> straight to the parent.

As Jason suggested, the parent->child messaging could be accomplished 
with a fanout exchange an private per-worker queues.

And for the child->parent communication, just get the parent to create a 
queue with a well-known name and get the children to publish to that via 
the default exchange.

> I am brand new to rabbitMQ -- is it possible to provide some further
> info / code snippets that would allow me to get a better sense of
> things?

If you haven't done so already, please go through our tutorials at 
http://www.rabbitmq.com/getstarted.html


Regards,

Matthias.


Sent via BlackBerry from T-Mobile

From irrer at umich.edu  Mon Jul 18 17:22:05 2011
From: irrer at umich.edu (Jim Irrer)
Date: Mon, 18 Jul 2011 12:22:05 -0400
Subject: [rabbitmq-discuss] installing Pika
In-Reply-To: <CAK27CLp4Sooi-r7+tYatXGR1f5r=a0ZmVTJ3jEtf_SinHfydZA@mail.gmail.com>
References: <CAK27CLruhKjWmswSKZt_fLkeSAam8FH3xMgZ1i-gYcwE_L6gNw@mail.gmail.com>
	<CAL_e=0ppw5nJvOmCU+D6-yWqbZmiZQXoky3POgVmp0bgbTqwGw@mail.gmail.com>
	<CAK27CLonzQ2+KRHm-koFAKmV=M=bhr8mfWaNrF=KDK0-DEZeAw@mail.gmail.com>
	<CAK27CLpSn6GndhM5RELKj9+CYhkQ-HvJ+3=DPPtgE03VFvn5uw@mail.gmail.com>
	<CAL_e=0qymuo30-YKbu4qJMahAKLS2np+juOziuhV-5ZMkHV04w@mail.gmail.com>
	<CAK27CLp4Sooi-r7+tYatXGR1f5r=a0ZmVTJ3jEtf_SinHfydZA@mail.gmail.com>
Message-ID: <CAK27CLpYKWSZ3kHErBX0UEb0ALdiUv_GDDe0LW2CFnbrNK0=cw@mail.gmail.com>

Never mind.  Got it working.

Thanks,

- Jim

Jim Irrer     irrer at umich.edu       (734) 647-4409
University of Michigan Hospital Radiation Oncology
519 W. William St.             Ann Arbor, MI 48103


On Fri, Jul 15, 2011 at 7:12 PM, Jim Irrer <irrer at umich.edu> wrote:

> Ok, I uninstalled Python 3, installed Python 2.7, and then tried to
> install setuptools but it complains:
>
> Python version 2.7 required, which was not found in the registry.
>
>
> and the installer does not allow any input after that.
>
> Thanks for your patience,
>
>
> - Jim
>
> Jim Irrer     irrer at umich.edu       (734) 647-4409
> University of Michigan Hospital Radiation Oncology
> 519 W. William St.             Ann Arbor, MI 48103
>
>
> On Fri, Jul 15, 2011 at 6:39 PM, Gavin M. Roy <gmr at myyearbook.com> wrote:
>
>> You'll need to install setuptools. It's a fairly common core bit with
>> Python installed on most systems.
>>
>> http://pypi.python.org/pypi/setuptools
>>
>> Once installed when you run:
>>
>> "easy_install pika"
>>
>> all dependencies are installed.
>>
>> Cheers,
>>
>> Gavin
>>
>>
>> On Fri, Jul 15, 2011 at 6:26 PM, Jim Irrer <irrer at umich.edu> wrote:
>>
>>> Forgot to add that there are also unresolved imports with
>>>
>>> urllib2
>>> pkg_resources
>>> main
>>>
>>>
>>> Thanks,
>>>
>>> - Jim
>>>
>>> Jim Irrer     irrer at umich.edu       (734) 647-4409
>>> University of Michigan Hospital Radiation Oncology
>>> 519 W. William St.             Ann Arbor, MI 48103
>>>
>>>
>>> On Fri, Jul 15, 2011 at 6:21 PM, Jim Irrer <irrer at umich.edu> wrote:
>>>
>>>> Fair enough.  So I am running this from Eclipse, and imported the
>>>> ez_setup.py
>>>> file into my project, set the grammar compatibility to 2.7, and get the
>>>> the different error on line 99
>>>>
>>>> import setuptools; setuptools.bootstrap_install_from = egg
>>>>
>>>>
>>>> *Unresolved import: setuptools*
>>>>
>>>>
>>>> Is there another library that I need to install first?
>>>>
>>>> Thanks,
>>>>
>>>>
>>>> - Jim
>>>>
>>>> Jim Irrer     irrer at umich.edu       (734) 647-4409
>>>> University of Michigan Hospital Radiation Oncology
>>>> 519 W. William St.             Ann Arbor, MI 48103
>>>>
>>>>
>>>> On Fri, Jul 15, 2011 at 6:04 PM, Gavin M. Roy <gmr at myyearbook.com>wrote:
>>>>
>>>>> Pika does not work on Version 3 yet, it is only supported on 2.4->2.7
>>>>> and really should be used with 2.7 or 2.6.
>>>>>
>>>>> Regards,
>>>>>
>>>>> Gavin
>>>>>
>>>>> On Fri, Jul 15, 2011 at 5:55 PM, Jim Irrer <irrer at umich.edu> wrote:
>>>>>
>>>>>> Hi -
>>>>>>
>>>>>> I'm trying to install Pika on a Windows 7 64 bit system, and according
>>>>>> to the
>>>>>> instructions at
>>>>>> http://www.rabbitmq.com/tutorials/tutorial-one-python.html
>>>>>> should first install easy_install, and then use that to install pip
>>>>>> (an installer
>>>>>> to install another installer to install what I want?  Whatever ...)
>>>>>> but am
>>>>>> getting the following error:
>>>>>>
>>>>>> C:\Program Files (x86)\Python32>python  d:\downloads\ez_setup.py
>>>>>>   File "d:\downloads\ez_setup.py", line 106
>>>>>>     except pkg_resources.VersionConflict, e:
>>>>>>                                         ^
>>>>>> SyntaxError: invalid syntax
>>>>>>
>>>>>>
>>>>>> Does anyone know how to proceed from here?
>>>>>>
>>>>>> FYI - This is a new install of Python 3 and I'm new to Python.  The
>>>>>> ez_setup.py
>>>>>> file was downloaded from
>>>>>> http://peak.telecommunity.com/dist/ez_setup.py .
>>>>>>
>>>>>> Thanks for any hints,
>>>>>>
>>>>>> - Jim
>>>>>>
>>>>>> Jim Irrer     irrer at umich.edu       (734) 647-4409
>>>>>> University of Michigan Hospital Radiation Oncology
>>>>>> 519 W. William St.             Ann Arbor, MI 48103
>>>>>>
>>>>>> _______________________________________________
>>>>>> rabbitmq-discuss mailing list
>>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>>>
>>>>>>
>>>>>
>>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110718/602e3f78/attachment.htm>

From michael.s.klishin at gmail.com  Mon Jul 18 17:35:42 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 18 Jul 2011 20:35:42 +0400
Subject: [rabbitmq-discuss] [announce] amqp gem 0.7.2 is released
Message-ID: <CAE3HoVS6t59AEhLS4Sc3y=K7afQ45wz7+Vc7KozEK27+RqnVpA@mail.gmail.com>

Ruby amqp gem 0.7.2 is released. This is a bugfix release, all 0.7.x users
are encouraged to ugprade.

The changelog:

  * [BUG] Server-named queues declared en masse now get their unique names
instead of all beign assigned the first generated name
  * [API] Connection URI (string) format for vhosts no longer assumes that
vhosts begin with a slash (/), learn more at http://bit.ly/mfzwcB
  * [BUG] Queue#reset leaks consumer tags [#40].
  * [API] Backport Channel#default_exchange from master
  * [API] Improve backwards compatibility with 0.6.x: implement & deprecate
MQ.id, MQ.default, MQ.method_missing
  * [BUG] Ensure Heartbeats are always on Channel 0

-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110718/b2d7f8de/attachment.htm>

From aaron at agoragames.com  Mon Jul 18 19:02:28 2011
From: aaron at agoragames.com (Aaron Westendorf)
Date: Mon, 18 Jul 2011 14:02:28 -0400
Subject: [rabbitmq-discuss] Pika Question (publish and consume as fast
	as possible)
In-Reply-To: <CABzX+qy4b1cdLb6GqN_s3DDc-gPnnZdXySpJ4Fvgd6Xdr9iioA@mail.gmail.com>
References: <9C37154E143FE14CBA656B2D2232745F08CE65CF05F8@popeye.gebaschtel.bnet>
	<CABzX+qy4b1cdLb6GqN_s3DDc-gPnnZdXySpJ4Fvgd6Xdr9iioA@mail.gmail.com>
Message-ID: <CAHiEoM5o7aQ3p_N=gLo1r40G3NkZvN=WEMeRX4VbrVSireW=Og@mail.gmail.com>

I've documented to the list and also on our blog that I've been able
to use 3 hosts, each running 3 python processes, to push 40-48k
messages/sec through a single broker, which is in the 4-5k/sec per
process range. The stress test uses direct exchanges and the hosts are
VMs.

With Python and the GIL, there are practical limits to what a single
process is capable of, but it is still very fast given the following
conditions:
* IO is as close to the C implementation as possible
* Allocations per message cycle are deterministic and small

I've had great experience with IO in all Python applications I've
written. As always, vigilance and a keen eye make all the difference.

-Aaron


On Mon, Jul 18, 2011 at 11:06 AM, Marek Majkowski <majek04 at gmail.com> wrote:
> On Mon, Jul 18, 2011 at 14:39, Josh Geisser <josh at gebaschtel.ch> wrote:
>> Anyway, I want to write a little AMPQ Ping tool which should allow us to test various delivery patterns over a Rabbit Cluster.
>>
>> For that I want to have the possibility to publish and consume as fast as possible, also kind of benchmarking the system.
>
> You are aware that Python is not the fastest language, right?
>
> My rough guess would be that for a decent client you should be able to
> get something like 1k - 6k msgs/sec for simple messaging patterns.
>
>>
>> I made some progress in getting into Pika and think I understand the idea of the TCP_Backpressure, but I find it a bit hard to implement it on the 'enduser' side. (I found the old idea of TX_ and TX_commit easier to prevent overflow...)
>>
>> Long speech short, I ended up with using 'BlockingConnection' for publishing and 'SelectConnection' for consuming, otherwise i always ran into buffer-warnings and eventually crashes ....
>>
>> Could someone provide me with a quick snipped that publish/consumes as fast as possible, the way you'd implement it?
>>
>> Cheers & thanks a lot
>> Josh
>>
>> (pika in my case latest git-version, Python 2.7.2)
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From fearsome.lucidity at gmail.com  Mon Jul 18 19:30:08 2011
From: fearsome.lucidity at gmail.com (Elias Levy)
Date: Mon, 18 Jul 2011 18:30:08 +0000
Subject: [rabbitmq-discuss] Persistent messages and durable queue
	questions
In-Reply-To: <4E2404C1.1000705@rabbitmq.com>
References: <BANLkTinehFtF17CT6koQ-W_kUV-7fdJWSw@mail.gmail.com>
	<4E01A49C.9010402@rabbitmq.com>
	<BANLkTikBasN97dpS2XaPxh-Mr9rz4Ft-Xg@mail.gmail.com>
	<0F51CD98-3C30-4029-855A-228B79C3FD71@rabbitmq.com>
	<CAFDmHdOw__CWb3W0VLLD5LH8J_9G+HKNorrZJ_Sn64T=a_7zTg@mail.gmail.com>
	<4E2404C1.1000705@rabbitmq.com>
Message-ID: <CAFDmHdOhc8N406gbd_bogCXTVGrFwONEChpRxLGEqYzFZ=Wj_Q@mail.gmail.com>

On Mon, Jul 18, 2011 at 10:02 AM, Matthias Radestock <matthias at rabbitmq.com>
 wrote:

> "absent" durable queues are only forgotten for routing purposes. RabbitMQ
> prevents re-creation of these queues since that would result in
> inconsistency when the node re-joins.
>
> We could change things s.t. absent durable queues still participate in
> routing and that confirms return a 'nack' when messages are routed to such
> queues.
>

It seems like that is the correct thing to do.


> I am concerned though that there may be use cases where the current
> behaviour is the correct one.
>

I am curious as to what that case may be.  A network partition in a cluster
like RabbitMQ's is an error condition.  Thus, I expect the cluster to inform
me of the error, not to silently go on as if nothing is wrong.

AMQP is often compared with SMTP, with exchanges acting as MTAs and with
senders and receivers.  A topic exchange is akin to a distribution list.
 Publisher submit to the list and the message is sent to subscribers.  If
there are no subscribers, then the publisher will receive no errors.  But if
there are subscribers, but their mailbox is unreachable, then the subscriber
(or the MTA, depending on the configuration) will receive an error message.


At the moment RabbitMQ is failing to generate those error messages, so I
have no way of knowing whether the radio silence means there are no
subscribers or the subscriber failed to receive the message, actually is
worse, since I would actually get a publisher confirm ack, a positive
response.

Elias Levy
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110718/0068b74d/attachment.htm>

From matthias at rabbitmq.com  Mon Jul 18 20:18:48 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 18 Jul 2011 20:18:48 +0100
Subject: [rabbitmq-discuss] Persistent messages and durable queue
	questions
In-Reply-To: <CAFDmHdOhc8N406gbd_bogCXTVGrFwONEChpRxLGEqYzFZ=Wj_Q@mail.gmail.com>
References: <BANLkTinehFtF17CT6koQ-W_kUV-7fdJWSw@mail.gmail.com>	<4E01A49C.9010402@rabbitmq.com>	<BANLkTikBasN97dpS2XaPxh-Mr9rz4Ft-Xg@mail.gmail.com>	<0F51CD98-3C30-4029-855A-228B79C3FD71@rabbitmq.com>	<CAFDmHdOw__CWb3W0VLLD5LH8J_9G+HKNorrZJ_Sn64T=a_7zTg@mail.gmail.com>	<4E2404C1.1000705@rabbitmq.com>
	<CAFDmHdOhc8N406gbd_bogCXTVGrFwONEChpRxLGEqYzFZ=Wj_Q@mail.gmail.com>
Message-ID: <4E248718.9000903@rabbitmq.com>

Elias,

On 18/07/11 19:30, Elias Levy wrote:
> On Mon, Jul 18, 2011 at 10:02 AM, Matthias Radestock
> <matthias at rabbitmq.com <mailto:matthias at rabbitmq.com>> wrote:
>     We could change things s.t. absent durable queues still participate
>     in routing and that confirms return a 'nack' when messages are
>     routed to such queues.
>
> It seems like that is the correct thing to do.
>
>     I am concerned though that there may be use cases where the current
>     behaviour is the correct one.
>
> I am curious as to what that case may be.

Me too. Alas the behaviour has been like this forever. Even prior to 
confirms, tx.commit behaved in the same way. And to date nobody has 
complained.

It's a lot of work to make this change. So I'd rather be sure that this 
really is the only sensible semantics.


Matthias.

From jaxx at jaxx.org  Mon Jul 18 20:39:27 2011
From: jaxx at jaxx.org (Julien Banchet)
Date: Mon, 18 Jul 2011 16:39:27 -0300
Subject: [rabbitmq-discuss] Management plugin crash server at startup
Message-ID: <89583B36-2B3E-4745-91D9-811BF50B6382@jaxx.org>

Hello!

(Reposted+edited since I forgot to join the list first)

I'm trying to move my actual (working) RabbitMQ node to another, less
loaded, server (actually another VM, hidden from internet, which will
also have a memcache).

So after setting up a barebone 64b Debian6 from a netinst and adding
RabbitMQ repo and installing it I got a working node.

Problem is, the management plugin seems to die, bringing down the
daemon with it after a couple of seconds (immediatly after start,
rabbitmq_ctl status does list plugins, two seconds later it's dead
already):

[... end of output launched from cli http://pastebin.com/rQGBDbF8 ]
broker running
** Found 0 name clashes in code paths
Erlang has closed
{"Kernel pid
terminated",application_controller,"{application_start_failure,rabbitmq_management,
{bad_return,{{rabbit_mgmt_app,start,[normal,[]]},{'EXIT',{timeout,
{gen_server,call,[rabbit_mochiweb_registry,
{add,rabbit_mgmt,#Fun<rabbit_mochiweb.2.78160903>,#Fun<rabbit_mochiweb.
5.23044403>,{[109,103,109,116],
[77,97,110,97,103,101,109,101,110,116,58,32,87,101,98,32,85,73]}}]}}}}}}"}
_____________
[... end of rabbit at mqcache.log ]
=INFO REPORT==== 18-Jul-2011::17:57:27 ===
Management agent started.

=INFO REPORT==== 18-Jul-2011::17:57:27 ===
Management plugin started.
HTTP API:       http://mqcache:55672/api/
Management UI:  http://mqcache:55672/mgmt/

=INFO REPORT==== 18-Jul-2011::17:57:32 ===
   application: rabbitmq_management
   exited: {bad_return,
               {{rabbit_mgmt_app,start,[normal,[]]},
                {'EXIT',
                    {timeout,
                        {gen_server,call,
                            [rabbit_mochiweb_registry,
                             {add,rabbit_mgmt,
                                 #Fun<rabbit_mochiweb.2.78160903>,
                                 #Fun<rabbit_mochiweb.5.23044403>,
                                 {"mgmt","Management: Web UI"}}]}}}}}
   type: permanent

=INFO REPORT==== 18-Jul-2011::17:57:32 ===
stopped TCP Listener on [::]:5672

Crash dump was written to: erl_crash.dump
Kernel pid terminated (application_controller)
({application_start_failure,rabbitmq_management,{bad_return,
{{rabbit_mgmt_app,start,[normal,[]]},{'EXIT',{timeout,{gen_server,call,
[rabbit_mochiweb_reg


All plugin files are there, I even compared the CRCs with my actual
RabbitMQ installation (which is another VM, just internet wise +
apache/mysql/etc...) . It's an independant node, no clustering,
replication, nothing special involved. Installing plugins one after
another boils it down to rabbitmq_management alone being the culprit.

As said, it's a fresh and updated Deb6 64b 2 CPUs, 2Gigs of RAM.
Erlang R14A (erts-5.8)
RabbitMQ 2.5.1
# md5sum *.ez
2602dd3df87fa4c7dedd6eb3192b0c19  amqp_client-2.5.1.ez
07f3b87ccb1d03d479a4277014a7e017  mochiweb-1.3-rmq2.5.1-git9a53dbd.ez
69aa2c17ebfff7bdf141d8df0b358631  rabbitmq_management-2.5.1.ez
4165b7d2aeeeeae9239b173b5e803c89  rabbitmq_management_agent-2.5.1.ez
0cd0b60bd8b9019fd9dbea08f667a697  rabbitmq_mochiweb-2.5.1.ez
2c7fddc210317a054c97b43e13d38ced  webmachine-1.7.0-rmq2.5.1-
hg0c4b60a.ez

The only diff I can imagine is that no queues/exchanges have ever been
created yet, and there's already an admin user created on it.

Has anyone encountered this? Erlang is a bit chinese to me, I might
have missed an obvious message somewhere, but I can't figure it out
yet :-)

Thanks in advance,

JaXX
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110718/65e39e16/attachment.htm>

From jaxx at jaxx.org  Mon Jul 18 19:19:18 2011
From: jaxx at jaxx.org (Julien Banchet)
Date: Mon, 18 Jul 2011 11:19:18 -0700 (PDT)
Subject: [rabbitmq-discuss] Management plugin(s) crash server at startup
Message-ID: <73bdd130-aa5f-49c0-92b3-bf6ddaead530@12g2000yqr.googlegroups.com>

Hello!

I'm trying to move my actual (working) RabbitMQ node to another, less
loaded, server (actually another VM, hidden from internet, which will
also have a memcache).

So after setting up a barebone 64b Debian6 from a netinst and adding
RabbitMQ repo and installing it I got a working node.

Problem is, the management plugin seems to die, bringing down the
daemon with it after a couple of seconds (immediatly after start,
rabbitmq_ctl status does list plugins, two seconds later it's dead
already):

[... end of output launched from cli ]
broker running
** Found 0 name clashes in code paths
Erlang has closed
{"Kernel pid
terminated",application_controller,"{application_start_failure,rabbitmq_management,
{bad_return,{{rabbit_mgmt_app,start,[normal,[]]},{'EXIT',{timeout,
{gen_server,call,[rabbit_mochiweb_registry,
{add,rabbit_mgmt,#Fun<rabbit_mochiweb.2.78160903>,#Fun<rabbit_mochiweb.
5.23044403>,{[109,103,109,116],
[77,97,110,97,103,101,109,101,110,116,58,32,87,101,98,32,85,73]}}]}}}}}}"}
_____________
[... end of rabbit at mqcache.log ]
=INFO REPORT==== 18-Jul-2011::17:57:27 ===
Management agent started.

=INFO REPORT==== 18-Jul-2011::17:57:27 ===
Management plugin started.
HTTP API:       http://mqcache:55672/api/
Management UI:  http://mqcache:55672/mgmt/

=INFO REPORT==== 18-Jul-2011::17:57:32 ===
    application: rabbitmq_management
    exited: {bad_return,
                {{rabbit_mgmt_app,start,[normal,[]]},
                 {'EXIT',
                     {timeout,
                         {gen_server,call,
                             [rabbit_mochiweb_registry,
                              {add,rabbit_mgmt,
                                  #Fun<rabbit_mochiweb.2.78160903>,
                                  #Fun<rabbit_mochiweb.5.23044403>,
                                  {"mgmt","Management: Web UI"}}]}}}}}
    type: permanent

=INFO REPORT==== 18-Jul-2011::17:57:32 ===
stopped TCP Listener on [::]:5672

Crash dump was written to: erl_crash.dump
Kernel pid terminated (application_controller)
({application_start_failure,rabbitmq_management,{bad_return,
{{rabbit_mgmt_app,start,[normal,[]]},{'EXIT',{timeout,{gen_server,call,
[rabbit_mochiweb_reg


All plugin files are there, I even compared the CRCs with my actual
RabbitMQ installation (which is another VM, just internet wise +
apache/mysql/etc...) . It's an independant node, no clustering,
replication, nothing special involved. Installing plugins one after
another boils it down to rabbitmq_management being the culprit.

As said, it's a fresh and updated Deb6 64b 2 CPUs, 2Gigs of RAM.
Erlang R14A (erts-5.8)
RabbitMQ 2.5.1
# md5sum *.ez
2602dd3df87fa4c7dedd6eb3192b0c19  amqp_client-2.5.1.ez
07f3b87ccb1d03d479a4277014a7e017  mochiweb-1.3-rmq2.5.1-git9a53dbd.ez
69aa2c17ebfff7bdf141d8df0b358631  rabbitmq_management-2.5.1.ez
4165b7d2aeeeeae9239b173b5e803c89  rabbitmq_management_agent-2.5.1.ez
0cd0b60bd8b9019fd9dbea08f667a697  rabbitmq_mochiweb-2.5.1.ez
2c7fddc210317a054c97b43e13d38ced  webmachine-1.7.0-rmq2.5.1-
hg0c4b60a.ez

The only diff I can imagine is that no queues/exchanges have ever been
created yet, and there's already an admin user created on it.

Has anyone encountered this? Erlang is a bit chinese to me, I might
have missed an obvious message somewhere, but I can't figure it out
yet :-)

Thanks in advance,

JaXX

From jaxx at jaxx.org  Mon Jul 18 21:24:16 2011
From: jaxx at jaxx.org (Julien Banchet)
Date: Mon, 18 Jul 2011 13:24:16 -0700 (PDT)
Subject: [rabbitmq-discuss] Management plugin crash server at startup
In-Reply-To: <89583B36-2B3E-4745-91D9-811BF50B6382@jaxx.org>
References: <89583B36-2B3E-4745-91D9-811BF50B6382@jaxx.org>
Message-ID: <6baec844-fedb-4551-bc6f-e0d25653a291@t5g2000yqj.googlegroups.com>

release built from mercurial gives the same results, only ditching out
the rabbitmq_managment plugin gets RabbitMQ to run (tested some
twitter streams against it)... and I don't see any big differences
between the one working perfectly and this one, could it be a secret
dependency somewhere?

I am ready to help as much as possible, and since the VM is empty, I
could even give access to it if needed

I could be the perfect noob at times, but I don't understand what's
going on (and Erlang being total abscon to me I don't know how to
debug it, even having played with ejabberd back in my teen years ;-) )
Though I'm sure I hit a bug, I'm just scared to have missed something
obvious and turn tomato-red-ashamed :-)

On Jul 18, 4:39?pm, Julien Banchet <j... at jaxx.org> wrote:
> Hello!
> [...]

From josh at gebaschtel.ch  Mon Jul 18 21:38:57 2011
From: josh at gebaschtel.ch (Josh Geisser)
Date: Mon, 18 Jul 2011 22:38:57 +0200
Subject: [rabbitmq-discuss] Pika Question (publish and consume "save" as
 fast as possible)
In-Reply-To: <CABzX+qy4b1cdLb6GqN_s3DDc-gPnnZdXySpJ4Fvgd6Xdr9iioA@mail.gmail.com>
References: <9C37154E143FE14CBA656B2D2232745F08CE65CF05F8@popeye.gebaschtel.bnet>
	<CABzX+qy4b1cdLb6GqN_s3DDc-gPnnZdXySpJ4Fvgd6Xdr9iioA@mail.gmail.com>
Message-ID: <9C37154E143FE14CBA656B2D2232745F08CE65CF05FD@popeye.gebaschtel.bnet>

Aware of that, but supposed to work cross-platform while maintaining script character.

Sorry, I've to rephrase, less a question of throughput rather than programmer approach: any simple way to avoid dealing with the buffers itself?

With py-amqp I could set the transaction-flag to control the publisher won't exceed it's capabilities, dito on consumer. How to achieve that in pika? 

Just find the setup with blocking-publisher and select-consumer strange, but only configuration that worked stable for me so far without running into buffer warnings.

Cheers
Josh

-----Urspr?ngliche Nachricht-----
Von: Marek Majkowski [mailto:majek04 at gmail.com] 
Gesendet: Montag, 18. Juli 2011 17:06
An: Josh Geisser
Cc: rabbitmq
Betreff: Re: [rabbitmq-discuss] Pika Question (publish and consume as fast as possible)

On Mon, Jul 18, 2011 at 14:39, Josh Geisser <josh at gebaschtel.ch> wrote:
> Anyway, I want to write a little AMPQ Ping tool which should allow us to test various delivery patterns over a Rabbit Cluster.
>
> For that I want to have the possibility to publish and consume as fast as possible, also kind of benchmarking the system.

You are aware that Python is not the fastest language, right?

My rough guess would be that for a decent client you should be able to
get something like 1k - 6k msgs/sec for simple messaging patterns.

>
> I made some progress in getting into Pika and think I understand the idea of the TCP_Backpressure, but I find it a bit hard to implement it on the 'enduser' side. (I found the old idea of TX_ and TX_commit easier to prevent overflow...)
>
> Long speech short, I ended up with using 'BlockingConnection' for publishing and 'SelectConnection' for consuming, otherwise i always ran into buffer-warnings and eventually crashes ....
>
> Could someone provide me with a quick snipped that publish/consumes as fast as possible, the way you'd implement it?
>
> Cheers & thanks a lot
> Josh
>
> (pika in my case latest git-version, Python 2.7.2)
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From simon at rabbitmq.com  Mon Jul 18 21:57:42 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 18 Jul 2011 21:57:42 +0100
Subject: [rabbitmq-discuss] Management plugin crash server at startup
In-Reply-To: <6baec844-fedb-4551-bc6f-e0d25653a291@t5g2000yqj.googlegroups.com>
References: <89583B36-2B3E-4745-91D9-811BF50B6382@jaxx.org>
	<6baec844-fedb-4551-bc6f-e0d25653a291@t5g2000yqj.googlegroups.com>
Message-ID: <4E249E46.2060007@rabbitmq.com>

Hi Julien.

On 18/07/2011 9:24PM, Julien Banchet wrote:
> release built from mercurial gives the same results, only ditching out
> the rabbitmq_managment plugin gets RabbitMQ to run (tested some
> twitter streams against it)... and I don't see any big differences
> between the one working perfectly and this one, could it be a secret
> dependency somewhere?

I should hope not - the Debian rabbitmq-server package is supposed to 
pull in all the dependencies needed by all the plugins.

> I am ready to help as much as possible, and since the VM is empty, I
> could even give access to it if needed
 >
> I could be the perfect noob at times, but I don't understand what's
> going on (and Erlang being total abscon to me I don't know how to
> debug it, even having played with ejabberd back in my teen years ;-) )
> Though I'm sure I hit a bug, I'm just scared to have missed something
> obvious and turn tomato-red-ashamed :-)

This does look like a bug. Somehow the mgmt plugin is timing out trying 
to contact the web plugin registry. Odd. Do you have any unusual config? 
(Can you post your /etc/rabbitmq/rabbitmq.config if you have one?) Also, 
can you post or pastebin the rabbit at mqcache-sasl.log?

Cheers, Simon

From jaxx at jaxx.org  Mon Jul 18 23:28:33 2011
From: jaxx at jaxx.org (Julien Banchet)
Date: Mon, 18 Jul 2011 15:28:33 -0700 (PDT)
Subject: [rabbitmq-discuss] Management plugin crash server at startup
In-Reply-To: <4E249E46.2060007@rabbitmq.com>
References: <89583B36-2B3E-4745-91D9-811BF50B6382@jaxx.org>
	<6baec844-fedb-4551-bc6f-e0d25653a291@t5g2000yqj.googlegroups.com>
	<4E249E46.2060007@rabbitmq.com>
Message-ID: <a0f9af33-a23e-41b7-aa2d-c373c8412dc6@n28g2000vbs.googlegroups.com>

Hi Simon,

On Jul 18, 5:57?pm, Simon MacMullen <si... at rabbitmq.com> wrote:
> Hi Julien.
>
> On 18/07/2011 9:24PM, Julien Banchet wrote:
> [...]
>
> I should hope not - the Debian rabbitmq-server package is supposed to
> pull in all the dependencies needed by all the plugins.

Yeah, I imagine so too :-) Plus, looks like it barely needs anything
out of the erlang scope which is long time packaged with mainstream
debian.

>
>
>
> > I am ready to help as much as possible, and since the VM is empty, I
> > could even give access to it if needed
>
> > I could be the perfect noob at times, but I don't understand what's
> > going on (and Erlang being total abscon to me I don't know how to
> > debug it, even having played with ejabberd back in my teen years ;-) )
> > Though I'm sure I hit a bug, I'm just scared to have missed something
> > obvious and turn tomato-red-ashamed :-)
>
> This does look like a bug. Somehow the mgmt plugin is timing out trying
> to contact the web plugin registry. Odd. Do you have any unusual config?
> (Can you post your /etc/rabbitmq/rabbitmq.config if you have one?) Also,
> can you post or pastebin the rab... at mqcache-sasl.log?

rabbitmq.config inexistant or with
 [
   {rabbit, [{tcp_listeners, [{"0.0.0.0", 5672}]}]}
 ].

(tried in case it was related to networking and to simplify it... the
VM (vmware) has two interfaces, eth0 on NAT, eth1 on HostOnly, no need
for IPv6 nor bridging)

Nothing special otherwise, debian 6.0.2.1 amd64 netinstall, selected
only SSH server (the damn thing still puts Exim as an MTA, yuk :-) ),
added "deb http://www.rabbitmq.com/debian/ testing main" to the
sources, updated apt, install rabbitmq-server, wget'd the 6 plugin
files, restarted, et voil? :-(


PasteBined on http://pastebin.com/42Ptzq8R rabbit at mqcache-sasl.log +
rabbit at mqcache.log + startup_log  (loaded with the precompiled
plugins)

>
> Cheers, Simon

Thanks,

Julien (JaXX)

> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From csharpplusproject at gmail.com  Tue Jul 19 00:44:31 2011
From: csharpplusproject at gmail.com (Shalom Rav)
Date: Mon, 18 Jul 2011 16:44:31 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ Usage Patterms?
Message-ID: <890f139c-f398-43e1-bdf1-85304408400e@e18g2000vbx.googlegroups.com>

I have gone through the 'Get Started' examples on the RabbitMQ
website.

While the examples are good, it looks like they are all similar --
having the 'app' part of the code (a function call, a task etc)
*embedded* within the messages consumer.

In other words, using *channel.start_consuming()* we continuously WAIT
for messages to arrive; As soon as a message is consumed (--> *** in
response to the message's consumption *** <--) we do something (this
is the 'app').

This pattern is basically having the 'app' *embedded* within the
consumer. An 'app' will ONLY work in response to a message that was
being consumed.
___________________________________________________________

What about the other way around -- can we have the messages *embedded*
within an 'app'?

In other words, is it possible to simply code up our app (say, a
class) in the usual way, and, whenever we want to receive a message,
simply include that code where we want to?

In such a scenario, our script will spend most of its time running our
app. When a certain condition is met (and ONLY then), we will invoke a
call to rabbitMQ to receive a message from a queue.

Does it make sense?  Are there any python code samples that
demonstrate this approach?

From simone.busoli at gmail.com  Tue Jul 19 00:51:16 2011
From: simone.busoli at gmail.com (Simone Busoli)
Date: Tue, 19 Jul 2011 01:51:16 +0200
Subject: [rabbitmq-discuss] RabbitMQ Usage Patterms?
In-Reply-To: <890f139c-f398-43e1-bdf1-85304408400e@e18g2000vbx.googlegroups.com>
References: <890f139c-f398-43e1-bdf1-85304408400e@e18g2000vbx.googlegroups.com>
Message-ID: <CAOn7oW8HnBTNhU=i1dLD9R2Wha1YFMepuMLjWMQp-SCqs1Yq-w@mail.gmail.com>

A common way to go is to have a thread - or whathever your environment calls
it - running in parallel to your application code, listening for messages
arriving from RabbitMQ and dispatching them to your application.
On Jul 19, 2011 1:45 AM, "Shalom Rav" <csharpplusproject at gmail.com> wrote:
> I have gone through the 'Get Started' examples on the RabbitMQ
> website.
>
> While the examples are good, it looks like they are all similar --
> having the 'app' part of the code (a function call, a task etc)
> *embedded* within the messages consumer.
>
> In other words, using *channel.start_consuming()* we continuously WAIT
> for messages to arrive; As soon as a message is consumed (--> *** in
> response to the message's consumption *** <--) we do something (this
> is the 'app').
>
> This pattern is basically having the 'app' *embedded* within the
> consumer. An 'app' will ONLY work in response to a message that was
> being consumed.
> ___________________________________________________________
>
> What about the other way around -- can we have the messages *embedded*
> within an 'app'?
>
> In other words, is it possible to simply code up our app (say, a
> class) in the usual way, and, whenever we want to receive a message,
> simply include that code where we want to?
>
> In such a scenario, our script will spend most of its time running our
> app. When a certain condition is met (and ONLY then), we will invoke a
> call to rabbitMQ to receive a message from a queue.
>
> Does it make sense? Are there any python code samples that
> demonstrate this approach?
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110719/e4d951c7/attachment.htm>

From MVierling at attinteractive.com  Tue Jul 19 02:52:38 2011
From: MVierling at attinteractive.com (Michael Vierling)
Date: Mon, 18 Jul 2011 18:52:38 -0700
Subject: [rabbitmq-discuss] RabbitMQ Uptime
Message-ID: <237050FF255D844CBDF840D42334EB9B67843CBF90@SFOEXM02.YELLOWPAGES.LOCAL>

Since RabbitMQ is advertised to be a high availability service, I'm happy to share our uptime numbers.

RabbitMQ host Uptime:
Virginia DC
rabbit1 - 369 days
rabbit2 - 418 days

California DC
rabbit1 - 409 days
rabbit2 - 409 days

No reboots or restarts.  So, according to Wikipedia we're seeing better than six nines availability.  Kudos to everyone on the RabbitMQ team!
http://en.wikipedia.org/wiki/High_availability
FYI: RabbitMQ 1.7.1, Erlang R13B04 and Red Hat 5.4

Best,
Michael Vierling
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110718/13adf49c/attachment.htm>

From csharpplusproject at gmail.com  Tue Jul 19 03:31:50 2011
From: csharpplusproject at gmail.com (csharpplusproject)
Date: Mon, 18 Jul 2011 22:31:50 -0400
Subject: [rabbitmq-discuss] RabbitMQ Usage Patterms?
In-Reply-To: <CAOn7oW8HnBTNhU=i1dLD9R2Wha1YFMepuMLjWMQp-SCqs1Yq-w@mail.gmail.com>
References: <890f139c-f398-43e1-bdf1-85304408400e@e18g2000vbx.googlegroups.com>
	<CAOn7oW8HnBTNhU=i1dLD9R2Wha1YFMepuMLjWMQp-SCqs1Yq-w@mail.gmail.com>
Message-ID: <1311042710.1866.909.camel@internet>

Simone,

Thank you for your explanation, although I do not really understand how
this works. 

You write: "...listening for messages arriving from RabbitMQ and
dispatching them to your application."

I have no problem writing code that is "...listening for messages
arriving from RabbitMQ". The question is, how do I dispatch these
messages to my application while letting the application run
continuously with no interruptions?

Can anybody provide sample code in python that demonstrates such a
pattern? Thanks.

-----Original Message-----
From: Simone Busoli <simone.busoli at gmail.com>
To: Shalom Rav <csharpplusproject at gmail.com>
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] RabbitMQ Usage Patterms?
Date: Tue, 19 Jul 2011 01:51:16 +0200



A common way to go is to have a thread - or whathever your environment
calls it - running in parallel to your application code, listening for
messages arriving from RabbitMQ and dispatching them to your
application.

On Jul 19, 2011 1:45 AM, "Shalom Rav" <csharpplusproject at gmail.com>
wrote:
> I have gone through the 'Get Started' examples on the RabbitMQ
> website.
> 
> While the examples are good, it looks like they are all similar --
> having the 'app' part of the code (a function call, a task etc)
> *embedded* within the messages consumer.
> 
> In other words, using *channel.start_consuming()* we continuously WAIT
> for messages to arrive; As soon as a message is consumed (--> *** in
> response to the message's consumption *** <--) we do something (this
> is the 'app').
> 
> This pattern is basically having the 'app' *embedded* within the
> consumer. An 'app' will ONLY work in response to a message that was
> being consumed.
> ___________________________________________________________
> 
> What about the other way around -- can we have the messages *embedded*
> within an 'app'?
> 
> In other words, is it possible to simply code up our app (say, a
> class) in the usual way, and, whenever we want to receive a message,
> simply include that code where we want to?
> 
> In such a scenario, our script will spend most of its time running our
> app. When a certain condition is met (and ONLY then), we will invoke a
> call to rabbitMQ to receive a message from a queue.
> 
> Does it make sense? Are there any python code samples that
> demonstrate this approach?
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110718/77437f61/attachment.htm>

From matthias at rabbitmq.com  Tue Jul 19 08:06:17 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 19 Jul 2011 08:06:17 +0100
Subject: [rabbitmq-discuss] An easy cross-platform way to start RabbitMQ
 programatically?
In-Reply-To: <CAE3HoVQJjF-O-+UK5KeknhYfxTSp6hcLkbGw8RRfoyrTWMyeNA@mail.gmail.com>
References: <CAE3HoVQJjF-O-+UK5KeknhYfxTSp6hcLkbGw8RRfoyrTWMyeNA@mail.gmail.com>
Message-ID: <4E252CE9.8070103@rabbitmq.com>

Michael,

On 17/07/11 19:36, Michael Klishin wrote:
> is really no easy cross-platform way to start RabbitMQ
> programmatically?

What would that look like? Bear in mind that this would have to work on 
Windows, MacOS, Debian, ...

The closest we have are rabbitmq-server script on Unixes and the 
rabbitmq-server.bat script on Windows, which do behave in much the same 
way. Though you have to locate them first. Mind you, if you have managed 
to locate rabbitmqctl then locating the rabbitmq-server script should be 
easy, since the two are sitting alongside each other.

> Thanks to rabbitmqctl I can stop and obtain pid of the broker easily,
> and killing it programmatically is trivial, too.

Instead of shutting down rabbit completely, you could just stop/start 
the rabbit app (with 'rabbitmqctl {start,stop}_app').

Regards,

Matthias.

From matthias at rabbitmq.com  Tue Jul 19 08:16:28 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 19 Jul 2011 08:16:28 +0100
Subject: [rabbitmq-discuss] RabbitMQ Uptime
In-Reply-To: <237050FF255D844CBDF840D42334EB9B67843CBF90@SFOEXM02.YELLOWPAGES.LOCAL>
References: <237050FF255D844CBDF840D42334EB9B67843CBF90@SFOEXM02.YELLOWPAGES.LOCAL>
Message-ID: <4E252F4C.5000801@rabbitmq.com>

Michael,

On 19/07/11 02:52, Michael Vierling wrote:
> So, according to Wikipedia we're seeing better than six nines
> availability.

Congratulations!

Can you tell us a bit more about your set up? #queues, #exchanges, 
#messages, msg size, etc.

> FYI: RabbitMQ 1.7.1, Erlang R13B04 and Red Hat 5.4

You really should upgrade ;)


Regards,

Matthias.

From ekirpichov at gmail.com  Tue Jul 19 09:14:11 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Tue, 19 Jul 2011 12:14:11 +0400
Subject: [rabbitmq-discuss] RabbitMQ Uptime
In-Reply-To: <237050FF255D844CBDF840D42334EB9B67843CBF90@SFOEXM02.YELLOWPAGES.LOCAL>
References: <237050FF255D844CBDF840D42334EB9B67843CBF90@SFOEXM02.YELLOWPAGES.LOCAL>
Message-ID: <17C4371F-C2A2-45DF-9D4F-BB795D56D09D@gmail.com>

Michael, did you see cases where rmq survived the failure of one node in the cluster, or a hot code upgrade, etc? That's what is most interesting :)



19.07.2011, ? 5:52, Michael Vierling <MVierling at attinteractive.com> ???????(?):

> Since RabbitMQ is advertised to be a high availability service, I'm happy to share our uptime numbers.
> 
>  
> 
> RabbitMQ host Uptime:
> 
> Virginia DC
> 
> rabbit1 - 369 days
> 
> rabbit2 - 418 days
> 
>  
> 
> California DC
> 
> rabbit1 - 409 days
> 
> rabbit2 - 409 days
> 
>  
> 
> No reboots or restarts.  So, according to Wikipedia we're seeing better than six nines availability.  Kudos to everyone on the RabbitMQ team!
> 
> http://en.wikipedia.org/wiki/High_availability
> 
> FYI: RabbitMQ 1.7.1, Erlang R13B04 and Red Hat 5.4
> 
>  
> 
> Best,
> 
> Michael Vierling
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110719/6713c95c/attachment.htm>

From maxime.bouroumeau at gmail.com  Tue Jul 19 09:46:45 2011
From: maxime.bouroumeau at gmail.com (Maxime Bouroumeau-Fuseau)
Date: Tue, 19 Jul 2011 10:46:45 +0200
Subject: [rabbitmq-discuss] RabbitMQ consumer stops receiving messages
Message-ID: <CAOU8vTsWoh=4cP8rYEd6iRFTg49YSd07noNF12_wu4-4ZK+SXw@mail.gmail.com>

Hello,

I have a serious problem with RabbitMQ. After a certain amount of messages
received, the consumers simply stop receiving messages.
They are still connected but they are not receiving messages anymore. I have
found other posts about this issue but none have a working answer.

Here is the connection wrapper I use: http://pastebin.com/XVY3HNGq. I use
stormed-amqp which is an async amqp lib for python.

All errors are caught and none are thrown during the process and I'm pretty
sure it doesn't come from an application error (but I can be mistaken of
course :).
On the same server there is a single exchange with 2 queues which each
process hundreds of thousands of messages a day. The first queue (which
works just fine) receives messages,
processes them and publishes them in the second one for further processing.
It's this second queue which stops after a certain amount of messages. I
have tried with one or multiple consumers
but the problem remains.

I have tried consuming messages without ack or with ack and a qos prefetch
count of 100 (as indicated in several responses to this kind of problems).
When I do "rabbitmqctl list_queues name messages_ready
messages_unacknowledged", I have a lot of ready messages and the "prefetch
count" (100) value of unacknoledged messages when using ack.

I really don't know wha'ts happening!
Thank you for your answers.

Maxime Bouroumeau-Fuseau
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110719/ff446313/attachment.htm>

From matthias at rabbitmq.com  Tue Jul 19 10:09:27 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 19 Jul 2011 10:09:27 +0100
Subject: [rabbitmq-discuss] RabbitMQ consumer stops receiving messages
In-Reply-To: <CAOU8vTsWoh=4cP8rYEd6iRFTg49YSd07noNF12_wu4-4ZK+SXw@mail.gmail.com>
References: <CAOU8vTsWoh=4cP8rYEd6iRFTg49YSd07noNF12_wu4-4ZK+SXw@mail.gmail.com>
Message-ID: <4E2549C7.7060609@rabbitmq.com>

Maxime,

On 19/07/11 09:46, Maxime Bouroumeau-Fuseau wrote:
> I have a serious problem with RabbitMQ. After a certain amount of
> messages received, the consumers simply stop receiving messages.
> They are still connected but they are not receiving messages anymore.
> [...]
> I have tried consuming messages without ack or with ack and a qos
> prefetch count of 100 (as indicated in several responses to this kind of
> problems).
> When I do "rabbitmqctl list_queues name messages_ready
> messages_unacknowledged", I have a lot of ready messages and the
> "prefetch count" (100) value of unacknoledged messages when using ack.

That indicates that, for whatever reason, the client is not accepting 
any more messages.

What version of the RabbitMQ server are you running? If it's >= 2.5.0, 
please run 'rabbitmqctl report > server_report.txt' and send us the 
output. Preferably when it's stuck while consuming messages without 
acks, since that scenario has the fewest places to get stuck. If your 
server version is < 2.5.0 then please upgrade.

Regards,

Matthias.

From toby.corkindale at strategicdata.com.au  Tue Jul 19 10:55:07 2011
From: toby.corkindale at strategicdata.com.au (Toby Corkindale)
Date: Tue, 19 Jul 2011 19:55:07 +1000
Subject: [rabbitmq-discuss] STOMP plugin and virtual hosts
Message-ID: <4E25547B.3080606@strategicdata.com.au>

Hi everyone,
I've been using the STOMP plugin with RabbitMQ for some time now, 
successfully. I've just been using the default "/" virtual host.

I'm now trying to work on partitioning different things into their own 
virtual hosts, but I'm not sure how this works with the STOMP plugin.

How do I specify which virtual host to attempt to write to from within 
it? Do I put it in the destination field? Is it a header?

Thanks,
Toby

From maxime.bouroumeau at gmail.com  Tue Jul 19 10:57:35 2011
From: maxime.bouroumeau at gmail.com (Maxime Bouroumeau-Fuseau)
Date: Tue, 19 Jul 2011 11:57:35 +0200
Subject: [rabbitmq-discuss] RabbitMQ consumer stops receiving messages
In-Reply-To: <4E2549C7.7060609@rabbitmq.com>
References: <CAOU8vTsWoh=4cP8rYEd6iRFTg49YSd07noNF12_wu4-4ZK+SXw@mail.gmail.com>
	<4E2549C7.7060609@rabbitmq.com>
Message-ID: <CAOU8vTsVqTGX9BXhbKw1mhEZpTkrFMizoHbM8bx9Y6kM6Rd6sw@mail.gmail.com>

Matthias,

I was using stormed-amqp 0.1 and rabbitmq 2.3.1.
I have updated to the latest master of stormed-amqp and to rabbitmq 2.5.1.

The problem persists but appears after more messages have been received.
You'll find attached report.txt which is with a consumer without ack and
report_with_ack.txt

Regars,

Maxime Bouroumeau-Fuseau


On Tue, Jul 19, 2011 at 11:09 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Maxime,
>
>
> On 19/07/11 09:46, Maxime Bouroumeau-Fuseau wrote:
>
>> I have a serious problem with RabbitMQ. After a certain amount of
>> messages received, the consumers simply stop receiving messages.
>> They are still connected but they are not receiving messages anymore.
>> [...]
>> I have tried consuming messages without ack or with ack and a qos
>> prefetch count of 100 (as indicated in several responses to this kind of
>> problems).
>> When I do "rabbitmqctl list_queues name messages_ready
>> messages_unacknowledged", I have a lot of ready messages and the
>> "prefetch count" (100) value of unacknoledged messages when using ack.
>>
>
> That indicates that, for whatever reason, the client is not accepting any
> more messages.
>
> What version of the RabbitMQ server are you running? If it's >= 2.5.0,
> please run 'rabbitmqctl report > server_report.txt' and send us the output.
> Preferably when it's stuck while consuming messages without acks, since that
> scenario has the fewest places to get stuck. If your server version is <
> 2.5.0 then please upgrade.
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110719/d53a0a45/attachment.htm>
-------------- next part --------------
{error_logger,{{2011,7,19},{11,50,50}},"inet_parse:~p:~p: erroneous line, SKIPPED~n",["/etc/hosts",8]}

=INFO REPORT==== 19-Jul-2011::11:50:50 ===
inet_parse:"/etc/hosts":8: erroneous line, SKIPPED
Reporting server status on {{2011,7,19},{9,50,50}}

Status of node rabbit at ns353204 ...
[{pid,19099},
 {running_applications,[{rabbit,"RabbitMQ","2.5.1"},
                        {mnesia,"MNESIA  CXC 138 12","4.4.12"},
                        {os_mon,"CPO  CXC 138 46","2.2.4"},
                        {sasl,"SASL  CXC 138 11","2.1.8"},
                        {stdlib,"ERTS  CXC 138 10","1.16.4"},
                        {kernel,"ERTS  CXC 138 10","2.13.4"}]},
 {os,{unix,linux}},
 {erlang_version,"Erlang R13B03 (erts-5.7.4) [source] [64-bit] [smp:2:2] [rq:2] [async-threads:30] [hipe] [kernel-poll:true]\n"},
 {memory,[{total,28389696},
          {processes,12546536},
          {processes_used,12533840},
          {system,15843160},
          {atom,1101009},
          {atom_used,1085489},
          {binary,516840},
          {code,11606637},
          {ets,749280}]}]

Cluster status of node rabbit at ns353204 ...
[{nodes,[{disc,[rabbit at ns353204]}]},{running_nodes,[rabbit at ns353204]}]

Application environment of node rabbit at ns353204 ...
[{auth_backends,[rabbit_auth_backend_internal]},
 {auth_mechanisms,['PLAIN','AMQPLAIN']},
 {backing_queue_module,rabbit_variable_queue},
 {cluster_nodes,[]},
 {collect_statistics,none},
 {default_permissions,[<<".*">>,<<".*">>,<<".*">>]},
 {default_user,<<"guest">>},
 {default_user_is_admin,true},
 {default_vhost,<<"/">>},
 {delegate_count,16},
 {frame_max,131072},
 {included_applications,[]},
 {msg_store_file_size_limit,16777216},
 {msg_store_index_module,rabbit_msg_store_ets_index},
 {persister_hibernate_after,10000},
 {persister_max_wrap_entries,500},
 {queue_index_max_journal_entries,262144},
 {server_properties,[]},
 {ssl_listeners,[]},
 {ssl_options,[]},
 {tcp_listen_options,[binary,
                      {packet,raw},
                      {reuseaddr,true},
                      {backlog,128},
                      {nodelay,true},
                      {exit_on_close,false}]},
 {tcp_listeners,[5672]},
 {trace_vhosts,[]},
 {vm_memory_high_watermark,0.4}]

Connections:
pid	address	port	peer_address	peer_port	ssl	peer_cert_subject	peer_cert_issuer	peer_cert_validity	auth_mechanism	ssl_protocol	ssl_key_exchange	ssl_cipher	ssl_hash	protocol	user	vhost	timeout	frame_max	client_properties	recv_oct	recv_cnt	send_oct	send_cnt	send_pend	state	channels
<rabbit at ns353204.3.428.0>	127.0.0.1	5672	127.0.0.1	42713	false				AMQPLAIN					{0,9,1}	guest	/	0	65536	[{"client","stormed-amqp"}]	138	3	368	3	0	running	0
<rabbit at ns353204.3.1621.0>	127.0.0.1	5672	127.0.0.1	54223	false				AMQPLAIN					{0,9,1}	guest	/	0	65536	[{"client","stormed-amqp"}]	305	8	1248829	2934	8432	running	1
<rabbit at ns353204.3.1145.0>	127.0.0.1	5672	127.0.0.1	47849	false				AMQPLAIN					{0,9,1}	guest	/	0	65536	[{"client","stormed-amqp"}]	2167945	6497	384	4	0	running	1
<rabbit at ns353204.3.1721.0>	127.0.0.1	5672	127.0.0.1	54866	false				AMQPLAIN					{0,9,1}	guest	/	0	65536	[{"client","stormed-amqp"}]	881066	2245	840093	2296	0	running	2

Channels:
pid	connection	number	user	vhost	transactional	confirm	consumer_count	messages_unacknowledged	messages_unconfirmed	acks_uncommitted	prefetch_count	client_flow_blocked
<rabbit at ns353204.3.1148.0>	<rabbit at ns353204.3.1145.0>	1	guest	/	false	false	0	0	0	0	0	false
<rabbit at ns353204.3.1624.0>	<rabbit at ns353204.3.1621.0>	1	guest	/	false	false	1	0	0	0	0	false
<rabbit at ns353204.3.1724.0>	<rabbit at ns353204.3.1721.0>	1	guest	/	false	false	1	0	0	0	0	false
<rabbit at ns353204.3.1727.0>	<rabbit at ns353204.3.1721.0>	2	guest	/	false	false	0	0	0	0	0	false

Queues on /:
pid	name	durable	auto_delete	arguments	owner_pid	exclusive_consumer_pid	exclusive_consumer_tag	messages_ready	messages_unacknowledged	messages	consumers	memory	backing_queue_status
<rabbit at ns353204.3.295.0>	thot.tracker	true	false	[]				0	0	0	1	142896	[{q1,0}, {q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,0}, {q4,0}, {len,0}, {pending_acks,0}, {outstanding_txns,0}, {target_ram_count,infinity}, {ram_msg_count,0}, {ram_ack_count,0}, {ram_index_count,0}, {next_seq_id,368}, {persistent_count,0}, {avg_ingress_rate,0.0}, {avg_egress_rate,0.0}, {avg_ack_ingress_rate,0.0}, {avg_ack_egress_rate,0.0}]
<rabbit at ns353204.3.460.0>	thot.processor	true	false	[]				863	0	863	1	1801808	[{q1,0}, {q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,0}, {q4,863}, {len,863}, {pending_acks,0}, {outstanding_txns,0}, {target_ram_count,infinity}, {ram_msg_count,863}, {ram_ack_count,0}, {ram_index_count,0}, {next_seq_id,2067}, {persistent_count,0}, {avg_ingress_rate,14.365453956325828}, {avg_egress_rate,0.0}, {avg_ack_ingress_rate,0.0}, {avg_ack_egress_rate,0.0}]

Exchanges on /:
name	type	durable	auto_delete	internal	arguments
amq.direct	direct	true	false	false	[]
thot	direct	true	false	false	[]
amq.topic	topic	true	false	false	[]
amq.rabbitmq.trace	topic	true	false	false	[]
amq.rabbitmq.log	topic	true	false	false	[]
amq.fanout	fanout	true	false	false	[]
amq.headers	headers	true	false	false	[]
	direct	true	false	false	[]
amq.match	headers	true	false	false	[]

Bindings on /:
source_name	source_kind	destination_name	destination_kind	routing_key	arguments
	exchange	thot.processor	queue	thot.processor	[]
	exchange	thot.tracker	queue	thot.tracker	[]
thot	exchange	thot.processor	queue	thot.processor	[]
thot	exchange	thot.tracker	queue	thot.tracker	[]

Consumers on /:
queue_name	channel_pid	consumer_tag	ack_required
thot.tracker	<rabbit at ns353204.3.1724.0>	amq.ctag-MrgQjPfwELAqNOvL4ONfXQ==	false
thot.processor	<rabbit at ns353204.3.1624.0>	amq.ctag-YbiqDaXfDod+eChM9ViPtQ==	false

Permissions on /:
user	configure	write	read
guest	.*	.*	.*

End of server status report
...done.
-------------- next part --------------
{error_logger,{{2011,7,19},{11,55,25}},"inet_parse:~p:~p: erroneous line, SKIPPED~n",["/etc/hosts",8]}

=INFO REPORT==== 19-Jul-2011::11:55:25 ===
inet_parse:"/etc/hosts":8: erroneous line, SKIPPED
Reporting server status on {{2011,7,19},{9,55,25}}

Status of node rabbit at ns353204 ...
[{pid,19099},
 {running_applications,[{rabbit,"RabbitMQ","2.5.1"},
                        {mnesia,"MNESIA  CXC 138 12","4.4.12"},
                        {os_mon,"CPO  CXC 138 46","2.2.4"},
                        {sasl,"SASL  CXC 138 11","2.1.8"},
                        {stdlib,"ERTS  CXC 138 10","1.16.4"},
                        {kernel,"ERTS  CXC 138 10","2.13.4"}]},
 {os,{unix,linux}},
 {erlang_version,"Erlang R13B03 (erts-5.7.4) [source] [64-bit] [smp:2:2] [rq:2] [async-threads:30] [hipe] [kernel-poll:true]\n"},
 {memory,[{total,27474056},
          {processes,11786984},
          {processes_used,11775288},
          {system,15687072},
          {atom,1101817},
          {atom_used,1086017},
          {binary,357392},
          {code,11606637},
          {ets,749928}]}]

Cluster status of node rabbit at ns353204 ...
[{nodes,[{disc,[rabbit at ns353204]}]},{running_nodes,[rabbit at ns353204]}]

Application environment of node rabbit at ns353204 ...
[{auth_backends,[rabbit_auth_backend_internal]},
 {auth_mechanisms,['PLAIN','AMQPLAIN']},
 {backing_queue_module,rabbit_variable_queue},
 {cluster_nodes,[]},
 {collect_statistics,none},
 {default_permissions,[<<".*">>,<<".*">>,<<".*">>]},
 {default_user,<<"guest">>},
 {default_user_is_admin,true},
 {default_vhost,<<"/">>},
 {delegate_count,16},
 {frame_max,131072},
 {included_applications,[]},
 {msg_store_file_size_limit,16777216},
 {msg_store_index_module,rabbit_msg_store_ets_index},
 {persister_hibernate_after,10000},
 {persister_max_wrap_entries,500},
 {queue_index_max_journal_entries,262144},
 {server_properties,[]},
 {ssl_listeners,[]},
 {ssl_options,[]},
 {tcp_listen_options,[binary,
                      {packet,raw},
                      {reuseaddr,true},
                      {backlog,128},
                      {nodelay,true},
                      {exit_on_close,false}]},
 {tcp_listeners,[5672]},
 {trace_vhosts,[]},
 {vm_memory_high_watermark,0.4}]

Connections:
pid	address	port	peer_address	peer_port	ssl	peer_cert_subject	peer_cert_issuer	peer_cert_validity	auth_mechanism	ssl_protocol	ssl_key_exchange	ssl_cipher	ssl_hash	protocol	user	vhost	timeout	frame_max	client_properties	recv_oct	recv_cnt	send_oct	send_cnt	send_pend	state	channels
<rabbit at ns353204.3.2466.0>	127.0.0.1	5672	127.0.0.1	55538	false				AMQPLAIN					{0,9,1}	guest	/	0	65536	[{"client","stormed-amqp"}]	23697	747	522926	1222	0	running	1
<rabbit at ns353204.3.428.0>	127.0.0.1	5672	127.0.0.1	42713	false				AMQPLAIN					{0,9,1}	guest	/	0	65536	[{"client","stormed-amqp"}]	138	3	368	3	0	running	0
<rabbit at ns353204.3.1145.0>	127.0.0.1	5672	127.0.0.1	47849	false				AMQPLAIN					{0,9,1}	guest	/	0	65536	[{"client","stormed-amqp"}]	3475460	10414	384	4	0	running	1
<rabbit at ns353204.3.1721.0>	127.0.0.1	5672	127.0.0.1	54866	false				AMQPLAIN					{0,9,1}	guest	/	0	65536	[{"client","stormed-amqp"}]	2419305	6153	2306728	6274	0	running	2

Channels:
pid	connection	number	user	vhost	transactional	confirm	consumer_count	messages_unacknowledged	messages_unconfirmed	acks_uncommitted	prefetch_count	client_flow_blocked
<rabbit at ns353204.3.1148.0>	<rabbit at ns353204.3.1145.0>	1	guest	/	false	false	0	0	0	0	0	false
<rabbit at ns353204.3.1724.0>	<rabbit at ns353204.3.1721.0>	1	guest	/	false	false	1	0	0	0	0	false
<rabbit at ns353204.3.1727.0>	<rabbit at ns353204.3.1721.0>	2	guest	/	false	false	0	0	0	0	0	false
<rabbit at ns353204.3.2469.0>	<rabbit at ns353204.3.2466.0>	1	guest	/	false	false	1	100	0	0	100	false

Queues on /:
pid	name	durable	auto_delete	arguments	owner_pid	exclusive_consumer_pid	exclusive_consumer_tag	messages_ready	messages_unacknowledged	messages	consumers	memory	backing_queue_status
<rabbit at ns353204.3.295.0>	thot.tracker	true	false	[]				0	0	0	1	142896	[{q1,0}, {q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,0}, {q4,0}, {len,0}, {pending_acks,0}, {outstanding_txns,0}, {target_ram_count,infinity}, {ram_msg_count,0}, {ram_ack_count,0}, {ram_index_count,0}, {next_seq_id,368}, {persistent_count,0}, {avg_ingress_rate,0.0}, {avg_egress_rate,0.0}, {avg_ack_ingress_rate,0.0}, {avg_ack_egress_rate,0.0}]
<rabbit at ns353204.3.460.0>	thot.processor	true	false	[]				530	100	630	1	1114112	[{q1,0}, {q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,0}, {q4,530}, {len,530}, {pending_acks,100}, {outstanding_txns,0}, {target_ram_count,infinity}, {ram_msg_count,530}, {ram_ack_count,100}, {ram_index_count,0}, {next_seq_id,4947}, {persistent_count,0}, {avg_ingress_rate,12.14102738766987}, {avg_egress_rate,0.0}, {avg_ack_ingress_rate,0.0}, {avg_ack_egress_rate,0.0}]

Exchanges on /:
name	type	durable	auto_delete	internal	arguments
amq.direct	direct	true	false	false	[]
thot	direct	true	false	false	[]
amq.topic	topic	true	false	false	[]
amq.rabbitmq.trace	topic	true	false	false	[]
amq.rabbitmq.log	topic	true	false	false	[]
amq.fanout	fanout	true	false	false	[]
amq.headers	headers	true	false	false	[]
	direct	true	false	false	[]
amq.match	headers	true	false	false	[]

Bindings on /:
source_name	source_kind	destination_name	destination_kind	routing_key	arguments
	exchange	thot.processor	queue	thot.processor	[]
	exchange	thot.tracker	queue	thot.tracker	[]
thot	exchange	thot.processor	queue	thot.processor	[]
thot	exchange	thot.tracker	queue	thot.tracker	[]

Consumers on /:
queue_name	channel_pid	consumer_tag	ack_required
thot.tracker	<rabbit at ns353204.3.1724.0>	amq.ctag-MrgQjPfwELAqNOvL4ONfXQ==	false
thot.processor	<rabbit at ns353204.3.2469.0>	amq.ctag-7kDGEwDPOKGAVaXBbI+HzQ==	true

Permissions on /:
user	configure	write	read
guest	.*	.*	.*

End of server status report
...done.

From matthias at rabbitmq.com  Tue Jul 19 11:30:57 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 19 Jul 2011 11:30:57 +0100
Subject: [rabbitmq-discuss] RabbitMQ consumer stops receiving messages
In-Reply-To: <CAOU8vTsVqTGX9BXhbKw1mhEZpTkrFMizoHbM8bx9Y6kM6Rd6sw@mail.gmail.com>
References: <CAOU8vTsWoh=4cP8rYEd6iRFTg49YSd07noNF12_wu4-4ZK+SXw@mail.gmail.com>
	<4E2549C7.7060609@rabbitmq.com>
	<CAOU8vTsVqTGX9BXhbKw1mhEZpTkrFMizoHbM8bx9Y6kM6Rd6sw@mail.gmail.com>
Message-ID: <4E255CE1.2040404@rabbitmq.com>

Maxime,

On 19/07/11 10:57, Maxime Bouroumeau-Fuseau wrote:
> I was using stormed-amqp 0.1 and rabbitmq 2.3.1.
> I have updated to the latest master of stormed-amqp and to rabbitmq 2.5.1.
>
> The problem persists but appears after more messages have been received.
> You'll find attached report.txt which is with a consumer without ack and
> report_with_ack.txt

We can see that the 'thot.processor' queue has 863 messages ready, and 
one consumer, on channel <rabbit at ns353204.3.1624.0>. That channel is 
associated with connection <rabbit at ns353204.3.1621.0>. That connection 
has a 'send_pend' count of 8432.

This indicates that the client is not reading from the rabbit connection 
socket. So this is either a problem with the client library or with the 
app. I am not much of a python hacker and am not familiar with 
stormed-amqp, but I suggest the next step is to figure out what the 
consumer process is doing when its stuck, i.e. somehow get a stack trace 
from it.


Regards,

Matthias.

From majek04 at gmail.com  Tue Jul 19 11:37:47 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Tue, 19 Jul 2011 11:37:47 +0100
Subject: [rabbitmq-discuss] Pika and threads
In-Reply-To: <28393563.3648.1310876773295.JavaMail.geo-discussion-forums@yqu12>
References: <28393563.3648.1310876773295.JavaMail.geo-discussion-forums@yqu12>
Message-ID: <CABzX+qwubP78OsFFpLPUTvC5tdAzbB9B5BtVOOo+F2D3TApfwA@mail.gmail.com>

Alex,

2011/7/17 Alex Gr?nholm <alex.gronholm at nextday.fi>:
> I wanted to use Pika to implement an RPC server using RabbitMQ. I found that
> this was however not possible because when I process the request in a
> thread, I have no good way to thread safely send the results back.

Isn't that the point of RPC? To stop the request process/thread until
the response comes back.

> The IOLoop lacks a mechanism for interrupting it directly. The best I could
> figure was setting a timeout of 0, but it might take up to a second for this
> to happen, considerably adding to the response latency.
> Why isn't there just a dummy signalling socket that could be used for
> interrupting the poll?

In the tutorials I was using BlockingConnection:
   http://www.rabbitmq.com/tutorials/tutorial-six-python.html

Is that of any use to you?

Cheers,
  Marek

From simon at rabbitmq.com  Tue Jul 19 11:44:11 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 19 Jul 2011 11:44:11 +0100
Subject: [rabbitmq-discuss] STOMP plugin and virtual hosts
In-Reply-To: <4E25547B.3080606@strategicdata.com.au>
References: <4E25547B.3080606@strategicdata.com.au>
Message-ID: <4E255FFB.5090703@rabbitmq.com>

On 19/07/11 10:55, Toby Corkindale wrote:
> Hi everyone,
> I've been using the STOMP plugin with RabbitMQ for some time now,
> successfully. I've just been using the default "/" virtual host.
>
> I'm now trying to work on partitioning different things into their own
> virtual hosts, but I'm not sure how this works with the STOMP plugin.
>
> How do I specify which virtual host to attempt to write to from within
> it? Do I put it in the destination field? Is it a header?

On CONNECT, STOMP 1.1 defines a "host" header. If present, Rabbit will 
interpret this as the virtual host to use.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From alex.gronholm at nextday.fi  Tue Jul 19 11:44:22 2011
From: alex.gronholm at nextday.fi (=?UTF-8?B?QWxleCBHcsO2bmhvbG0=?=)
Date: Tue, 19 Jul 2011 13:44:22 +0300
Subject: [rabbitmq-discuss] Pika and threads
In-Reply-To: <CABzX+qwubP78OsFFpLPUTvC5tdAzbB9B5BtVOOo+F2D3TApfwA@mail.gmail.com>
References: <28393563.3648.1310876773295.JavaMail.geo-discussion-forums@yqu12>
	<CABzX+qwubP78OsFFpLPUTvC5tdAzbB9B5BtVOOo+F2D3TApfwA@mail.gmail.com>
Message-ID: <4E256006.2020203@nextday.fi>

19.07.2011 13:37, Marek Majkowski kirjoitti:
> Alex,
>
> 2011/7/17 Alex Gr?nholm<alex.gronholm at nextday.fi>:
>> I wanted to use Pika to implement an RPC server using RabbitMQ. I found that
>> this was however not possible because when I process the request in a
>> thread, I have no good way to thread safely send the results back.
> Isn't that the point of RPC? To stop the request process/thread until
> the response comes back.
That way the server could only process one request at a time. Obviously 
that is not good enough. My server uses 15 worker threads (possibly 
processes in the future) which need to send results back to the client 
once they are done processing the request. I solved this by using 
TornadoConnection, since Tornado's I/O loop does implement the required 
functionality (add_callback()) and uses a proper waking mechanism unlike 
SelectConnection's. That way, when a worker thread wants to send its 
results back to the client, it can interrupt the I/O loop which then 
proceeds to send the data.
>
>> The IOLoop lacks a mechanism for interrupting it directly. The best I could
>> figure was setting a timeout of 0, but it might take up to a second for this
>> to happen, considerably adding to the response latency.
>> Why isn't there just a dummy signalling socket that could be used for
>> interrupting the poll?
> In the tutorials I was using BlockingConnection:
>     http://www.rabbitmq.com/tutorials/tutorial-six-python.html
>
> Is that of any use to you?
The docs say that BlockingConnection is legacy stuff and should not be 
used. Is this no longer the case?
>
> Cheers,
>    Marek


From majek04 at gmail.com  Tue Jul 19 11:47:00 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Tue, 19 Jul 2011 11:47:00 +0100
Subject: [rabbitmq-discuss] RabbitMQ -- Patterns For Background
	Communication?
In-Reply-To: <a2ef39c8-d3e7-4c7c-9dbf-5f1f8669d02e@t9g2000vbs.googlegroups.com>
References: <a2ef39c8-d3e7-4c7c-9dbf-5f1f8669d02e@t9g2000vbs.googlegroups.com>
Message-ID: <CABzX+qx8-R24iK0vHKZfja8nC0oq2GutLqv8G6_4WA5yMR_bGQ@mail.gmail.com>

Hi!

On Mon, Jul 18, 2011 at 03:22, Shalom Rav <csharpplusproject at gmail.com> wrote:
> I'd like to write a python app (using pika & rabbitMQ) to do the
> following:
>
> There will be ONE *parent*, and TEN *workers*:
>
> Every 2[sec], the *parent* sends a message that must be consumed by
> *all workers*.

Sounds like a every child needs one queue.

> Every 5[sec], each one of the *workers* sends a message directly to
> the *parent*.

And a parent needs one queue as weel.

> __________________________________________________________
>
> Thanks to Jason W., I was able to write two small python scripts
> ('parent.py', 'child.py') that serve as a proof of concept.
>
> Yet, I have one main problem: the two scripts ('parent.py',
> 'child.py') keep exchanging messages between them non-stop. Since BOTH
> the *parent* & the *child* scripts need to publish and consume, I am
> basically 'stuck' with infinite publish / consume loops, leaving no
> room for my actual app to run.
>
> The problem is that I use the line *channel.start_consuming()* in both
> scripts -- which causes the publishing/consuming to run continuously,
> leaving no room for my actual app to do its work.
>
> Given the above case, can you suggest a *background* (or silent, if
> you will) communication pattern that will allow my *actual app* to
> run, and be able to 'send' ?/ 'receive' messages only at desired
> points in the code -- and not continuously? It looks like the main
> problem is with *channel.start_consuming()*.

Well, you can always run channel.stop_consuming, right?

If you run start_consuming only in order to publish, maybe
you're looking for synchronous publish command. I'm not sure
pika supports it though. There was also a method called
drain_something some time ago, that could be used
to force buffers to be flushed and the message delivered.
Yet another hack is to run a synchronous command after
publish on a channel, in order to synchronize publish.

> I see that one can publish a message ONCE using
> *channel.basic_publish(exchange = 'my_exchange', routing_key = '',
> body = my_message )*; Is there a similar call to consume ONCE (not
> continuously)?

The rough and ugly way of doing that is to use basic.get.

Chers,
 Marek

From simon at rabbitmq.com  Tue Jul 19 11:58:43 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 19 Jul 2011 11:58:43 +0100
Subject: [rabbitmq-discuss] Management plugin crash server at startup
In-Reply-To: <a0f9af33-a23e-41b7-aa2d-c373c8412dc6@n28g2000vbs.googlegroups.com>
References: <89583B36-2B3E-4745-91D9-811BF50B6382@jaxx.org>	<6baec844-fedb-4551-bc6f-e0d25653a291@t5g2000yqj.googlegroups.com>	<4E249E46.2060007@rabbitmq.com>
	<a0f9af33-a23e-41b7-aa2d-c373c8412dc6@n28g2000vbs.googlegroups.com>
Message-ID: <4E256363.8040801@rabbitmq.com>

On 18/07/11 23:28, Julien Banchet wrote:
>>> I am ready to help as much as possible, and since the VM is empty, I
>>> could even give access to it if needed

Yeah, it may come to that. I'm afraid none of the logs say anything 
useful. I'll send you an ssh key via private mail if you don't mind.

> Nothing special otherwise, debian 6.0.2.1 amd64 netinstall, selected
> only SSH server (the damn thing still puts Exim as an MTA, yuk :-) ),
> added "deb http://www.rabbitmq.com/debian/ testing main" to the
> sources, updated apt, install rabbitmq-server, wget'd the 6 plugin
> files, restarted, et voil? :-(

I've replicated this as best I can (VMware / Debian 6 / amd64 / minimal 
debs / 2 networks), no dice.

Cheers, Simon
-- 
Simon MacMullen
RabbitMQ, VMware

From ask at rabbitmq.com  Tue Jul 19 12:04:36 2011
From: ask at rabbitmq.com (Ask Solem)
Date: Tue, 19 Jul 2011 12:04:36 +0100
Subject: [rabbitmq-discuss] RabbitMQ consumer stops receiving messages
In-Reply-To: <4E255CE1.2040404@rabbitmq.com>
References: <CAOU8vTsWoh=4cP8rYEd6iRFTg49YSd07noNF12_wu4-4ZK+SXw@mail.gmail.com>
	<4E2549C7.7060609@rabbitmq.com>
	<CAOU8vTsVqTGX9BXhbKw1mhEZpTkrFMizoHbM8bx9Y6kM6Rd6sw@mail.gmail.com>
	<4E255CE1.2040404@rabbitmq.com>
Message-ID: <5D60F581-FA3C-4943-9BEF-E498897320FB@rabbitmq.com>

> 
> 
> This indicates that the client is not reading from the rabbit connection socket. So this is either a problem with the client library or with the app. I am not much of a python hacker and am not familiar with stormed-amqp, but I suggest the next step is to figure out what the consumer process is doing when its stuck, i.e. somehow get a stack trace from it.


In Celery we have a signal handler to get the stack trace of all active
threads, I cut the code out into a paste for you here:

   http://pastie.org/2236433

Just call "install_cry_handler" somewhere when your process starts,
and then you can 'kill -USR1 <pid>' to make the process dump out
the stack traces.

Also ktrace/strace/dtruss can help you find out if the process
is stuck in the system call.  If you ktrace the running process,
then it should interrupt it.

I've had a similar issue in the past, which I hacked working by
adding a socket timeout.

From maxime.bouroumeau at gmail.com  Tue Jul 19 13:56:08 2011
From: maxime.bouroumeau at gmail.com (Maxime Bouroumeau-Fuseau)
Date: Tue, 19 Jul 2011 14:56:08 +0200
Subject: [rabbitmq-discuss] RabbitMQ consumer stops receiving messages
In-Reply-To: <4E255CE1.2040404@rabbitmq.com>
References: <CAOU8vTsWoh=4cP8rYEd6iRFTg49YSd07noNF12_wu4-4ZK+SXw@mail.gmail.com>
	<4E2549C7.7060609@rabbitmq.com>
	<CAOU8vTsVqTGX9BXhbKw1mhEZpTkrFMizoHbM8bx9Y6kM6Rd6sw@mail.gmail.com>
	<4E255CE1.2040404@rabbitmq.com>
Message-ID: <CAOU8vTs5mhPAhWRpbho42UyrYhUgZjt=8TbCvWAK60vHxRQUOA@mail.gmail.com>

Matthias,

Thank you for your response. I will try to investigate more in the
application layer in the next few days.

Regards,

Maxime Bouroumeau-Fuseau


On Tue, Jul 19, 2011 at 12:30 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Maxime,
>
>
> On 19/07/11 10:57, Maxime Bouroumeau-Fuseau wrote:
>
>> I was using stormed-amqp 0.1 and rabbitmq 2.3.1.
>> I have updated to the latest master of stormed-amqp and to rabbitmq 2.5.1.
>>
>> The problem persists but appears after more messages have been received.
>> You'll find attached report.txt which is with a consumer without ack and
>> report_with_ack.txt
>>
>
> We can see that the 'thot.processor' queue has 863 messages ready, and one
> consumer, on channel <rabbit at ns353204.3.1624.0>. That channel is
> associated with connection <rabbit at ns353204.3.1621.0>. That connection has
> a 'send_pend' count of 8432.
>
> This indicates that the client is not reading from the rabbit connection
> socket. So this is either a problem with the client library or with the app.
> I am not much of a python hacker and am not familiar with stormed-amqp, but
> I suggest the next step is to figure out what the consumer process is doing
> when its stuck, i.e. somehow get a stack trace from it.
>
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110719/da85d6fc/attachment.htm>

From majek04 at gmail.com  Tue Jul 19 13:56:32 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Tue, 19 Jul 2011 13:56:32 +0100
Subject: [rabbitmq-discuss] Pika Question (publish and consume "save" as
 fast as possible)
In-Reply-To: <9C37154E143FE14CBA656B2D2232745F08CE65CF05FD@popeye.gebaschtel.bnet>
References: <9C37154E143FE14CBA656B2D2232745F08CE65CF05F8@popeye.gebaschtel.bnet>
	<CABzX+qy4b1cdLb6GqN_s3DDc-gPnnZdXySpJ4Fvgd6Xdr9iioA@mail.gmail.com>
	<9C37154E143FE14CBA656B2D2232745F08CE65CF05FD@popeye.gebaschtel.bnet>
Message-ID: <CABzX+qxH_ONSHOogaAvozL9EzYbYJkfu59bDVtnp4YERv-foVg@mail.gmail.com>

On Mon, Jul 18, 2011 at 21:38, Josh Geisser <josh at gebaschtel.ch> wrote:
> Aware of that, but supposed to work cross-platform while maintaining script character.
>
> Sorry, I've to rephrase, less a question of throughput rather than programmer approach: any simple way to avoid dealing with the buffers itself?
>
> With py-amqp I could set the transaction-flag to control the publisher won't exceed it's capabilities, dito on consumer. How to achieve that in pika?
>
> Just find the setup with blocking-publisher and select-consumer strange, but only configuration that worked stable for me so far without running into buffer warnings.

Yes, you probably need a blocking publish if you don't want to
overcome rabbitmq with too many messages.

Cheers,
  Marek

From majek04 at gmail.com  Tue Jul 19 14:20:05 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Tue, 19 Jul 2011 14:20:05 +0100
Subject: [rabbitmq-discuss] RabbitMQ Usage Patterms?
In-Reply-To: <1311042710.1866.909.camel@internet>
References: <890f139c-f398-43e1-bdf1-85304408400e@e18g2000vbx.googlegroups.com>
	<CAOn7oW8HnBTNhU=i1dLD9R2Wha1YFMepuMLjWMQp-SCqs1Yq-w@mail.gmail.com>
	<1311042710.1866.909.camel@internet>
Message-ID: <CABzX+qyBGvsNdFh5jbm3ey__HmcrSbwtAArzR1xx_xtMikLseg@mail.gmail.com>

On Tue, Jul 19, 2011 at 03:31, csharpplusproject
<csharpplusproject at gmail.com> wrote:
> Thank you for your explanation, although I do not really understand how this
> works.
>
> You write: "...listening for messages arriving from RabbitMQ and dispatching
> them to your application."
>
> I have no problem writing code that is "...listening for messages arriving
> from RabbitMQ". The question is, how do I dispatch these messages to my
> application while letting the application run continuously with no
> interruptions?
>
> Can anybody provide sample code in python that demonstrates such a pattern?

Okay, where to start....

When Rabbitmq (or any other network application) sends data to tcp/ip
connection,
well, it is encoded as electrons on the wire.

On the other side of the wire, maybe on different computer, a network card
receives electrons, decodes them and appends to a tcp/ip receive
buffer for a particular tcp/ip connection.

That was easy. Now the hard part. It's the application that needs to ask
the kernel: "is there more data available for me in the buffers?"

Asking this question all over again would be quite inefficient, so it's usually
put as a blocking request: "give me this number of bytes of data from
my tcp/ip buffers, wait if there isn't enough yet".

Most AMQP clients follow this pattern: you can do CPU intensive
work in your application *or* you can wait on the network and
receive and send data.

If you want to listen to messages: you shall block your program and wait
for network traffic.

Coming back to your question:
> The question is, how do I dispatch these messages to my
> application while letting the application run continuously with no
> interruptions?

You don't. If you want to receive data, you need to or:
 - block program and hang on socket till data is received
 - or poll kernel asking for more data which is quite inefficient

In normal programming languages people use threads to do that,
one thread does CPU stuff, the other does network stuff.
But a) threads in general are complex b) threads in python are weird.

Hope that helps,
  Marek

From vbernard42 at gmail.com  Tue Jul 19 14:44:32 2011
From: vbernard42 at gmail.com (Valentin Bernard)
Date: Tue, 19 Jul 2011 06:44:32 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ .NET client: DeclareOK equivalent?
Message-ID: <47fbffc6-cbe7-4f17-b555-a2c5686eff9b@l37g2000yqd.googlegroups.com>

Hi,

Is there any way, using the RabbitMQ .NET client library, to know how
many consumers are registered on a queue and how many messages are
pending? This information is available using the Java client library,
thanks to the  AMQP.Queue.DeclareOk class ? or using the experimental
C client library, with the amqp_queue_declare_ok_t structure. However,
the .NET's queueDeclarePassive() method only returns a string.

Thank you.

Regards,

Valentin.

From jaxx at jaxx.org  Tue Jul 19 14:56:17 2011
From: jaxx at jaxx.org (Julien Banchet)
Date: Tue, 19 Jul 2011 10:56:17 -0300
Subject: [rabbitmq-discuss] Management plugin crash server at startup
In-Reply-To: <4E256363.8040801@rabbitmq.com>
References: <89583B36-2B3E-4745-91D9-811BF50B6382@jaxx.org>	<6baec844-fedb-4551-bc6f-e0d25653a291@t5g2000yqj.googlegroups.com>	<4E249E46.2060007@rabbitmq.com>
	<a0f9af33-a23e-41b7-aa2d-c373c8412dc6@n28g2000vbs.googlegroups.com>
	<4E256363.8040801@rabbitmq.com>
Message-ID: <ED54E0CB-100A-4E2E-98B6-A5239D090BBF@jaxx.org>

Le 19 juil. 2011 ? 07:58, Simon MacMullen a ?crit :

> On 18/07/11 23:28, Julien Banchet wrote:
>>>> I am ready to help as much as possible, and since the VM is empty, I
>>>> could even give access to it if needed
> 
> Yeah, it may come to that. I'm afraid none of the logs say anything useful. I'll send you an ssh key via private mail if you don't mind.

catted to authorized_keys everywhere needed :-)

> 
>> Nothing special otherwise, debian 6.0.2.1 amd64 netinstall, selected
>> only SSH server (the damn thing still puts Exim as an MTA, yuk :-) ),
>> added "deb http://www.rabbitmq.com/debian/ testing main" to the
>> sources, updated apt, install rabbitmq-server, wget'd the 6 plugin
>> files, restarted, et voil? :-(
> 
> I've replicated this as best I can (VMware / Debian 6 / amd64 / minimal debs / 2 networks), no dice.

I possibly messed up somehow then, but innocently enough to declare this "unclear" then; you'll probably understand the guts of Erlang and the management plugin better than me though... 

(btw, replaced it with the "visualizer" version I saw on the mailing list, same result, it dies the same way)

Best,

JaXX


From emile at rabbitmq.com  Tue Jul 19 15:05:12 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 19 Jul 2011 15:05:12 +0100
Subject: [rabbitmq-discuss] RabbitMQ .NET client: DeclareOK equivalent?
In-Reply-To: <47fbffc6-cbe7-4f17-b555-a2c5686eff9b@l37g2000yqd.googlegroups.com>
References: <47fbffc6-cbe7-4f17-b555-a2c5686eff9b@l37g2000yqd.googlegroups.com>
Message-ID: <4E258F18.6020906@rabbitmq.com>

Hi Valentin,

On 19/07/11 14:44, Valentin Bernard wrote:
> Hi,
> 
> Is there any way, using the RabbitMQ .NET client library, to know how
> many consumers are registered on a queue and how many messages are
> pending? 

Unfortunately not without modifying the client library first. This is a
known weakness that we will address in a future version. The restriction
stems from some simplifying assumptions of the underlying code
generation framework, which work well in most cases. You could use a
different library or to wait until we update the .NET library.

-Emile

From majek04 at gmail.com  Tue Jul 19 15:09:47 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Tue, 19 Jul 2011 15:09:47 +0100
Subject: [rabbitmq-discuss] Pika and threads
In-Reply-To: <4E256006.2020203@nextday.fi>
References: <28393563.3648.1310876773295.JavaMail.geo-discussion-forums@yqu12>
	<CABzX+qwubP78OsFFpLPUTvC5tdAzbB9B5BtVOOo+F2D3TApfwA@mail.gmail.com>
	<4E256006.2020203@nextday.fi>
Message-ID: <CABzX+qzEbO_372Cu2Gub+BtocDQYEaRcBv5+fpUFyPvcSFzxRg@mail.gmail.com>

2011/7/19 Alex Gr?nholm <alex.gronholm at nextday.fi>:
> 19.07.2011 13:37, Marek Majkowski kirjoitti:
>>
>> Alex,
>>
>> 2011/7/17 Alex Gr?nholm<alex.gronholm at nextday.fi>:
>>>
>>> I wanted to use Pika to implement an RPC server using RabbitMQ. I found
>>> that
>>> this was however not possible because when I process the request in a
>>> thread, I have no good way to thread safely send the results back.
>>
>> Isn't that the point of RPC? To stop the request process/thread until
>> the response comes back.
>
> That way the server could only process one request at a time. Obviously that
> is not good enough. My server uses 15 worker threads (possibly processes in
> the future) which need to send results back to the client once they are done
> processing the request. I solved this by using TornadoConnection, since
> Tornado's I/O loop does implement the required functionality
> (add_callback()) and uses a proper waking mechanism unlike
> SelectConnection's. That way, when a worker thread wants to send its results
> back to the client, it can interrupt the I/O loop which then proceeds to
> send the data.

I'm glad you were able to come up with a sensible solution.

>>> The IOLoop lacks a mechanism for interrupting it directly. The best I
>>> could
>>> figure was setting a timeout of 0, but it might take up to a second for
>>> this
>>> to happen, considerably adding to the response latency.
>>> Why isn't there just a dummy signalling socket that could be used for
>>> interrupting the poll?
>>
>> In the tutorials I was using BlockingConnection:
>> ? ?http://www.rabbitmq.com/tutorials/tutorial-six-python.html
>>
>> Is that of any use to you?
>
> The docs say that BlockingConnection is legacy stuff and should not be used.
> Is this no longer the case?

I don't know. Loosing BlockingConnection would be a pitty, rabbitmq
tutorials are using it :)

From vbernard42 at gmail.com  Tue Jul 19 15:44:08 2011
From: vbernard42 at gmail.com (Valentin Bernard)
Date: Tue, 19 Jul 2011 07:44:08 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ .NET client: DeclareOK equivalent?
In-Reply-To: <4E258F18.6020906@rabbitmq.com>
References: <47fbffc6-cbe7-4f17-b555-a2c5686eff9b@l37g2000yqd.googlegroups.com>
	<4E258F18.6020906@rabbitmq.com>
Message-ID: <7970d0b7-5def-40dc-a58e-84d43ce2bb13@gv8g2000vbb.googlegroups.com>

Hi Emile,

OK, thanks for your fast answer.

Regards,

Valentin.

On Jul 19, 4:05?pm, Emile Joubert <em... at rabbitmq.com> wrote:
> Hi Valentin,
>
> On 19/07/11 14:44, Valentin Bernard wrote:
>
> > Hi,
>
> > Is there any way, using the RabbitMQ .NET client library, to know how
> > many consumers are registered on a queue and how many messages are
> > pending?
>
> Unfortunately not without modifying the client library first. This is a
> known weakness that we will address in a future version. The restriction
> stems from some simplifying assumptions of the underlying code
> generation framework, which work well in most cases. You could use a
> different library or to wait until we update the .NET library.
>
> -Emile
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From david at rabbitmq.com  Tue Jul 19 15:50:44 2011
From: david at rabbitmq.com (David Wragg)
Date: Tue, 19 Jul 2011 15:50:44 +0100
Subject: [rabbitmq-discuss] RabbitMQ Usage Patterms?
In-Reply-To: <CABzX+qyBGvsNdFh5jbm3ey__HmcrSbwtAArzR1xx_xtMikLseg@mail.gmail.com>
	(Marek Majkowski's message of "Tue, 19 Jul 2011 14:20:05 +0100")
References: <890f139c-f398-43e1-bdf1-85304408400e@e18g2000vbx.googlegroups.com>
	<CAOn7oW8HnBTNhU=i1dLD9R2Wha1YFMepuMLjWMQp-SCqs1Yq-w@mail.gmail.com>
	<1311042710.1866.909.camel@internet>
	<CABzX+qyBGvsNdFh5jbm3ey__HmcrSbwtAArzR1xx_xtMikLseg@mail.gmail.com>
Message-ID: <yrv4c4o2is4sb.fsf@dwragg.eng.vmware.com>

Marek Majkowski <majek04 at gmail.com> writes:
> When Rabbitmq (or any other network application) sends data to tcp/ip
> connection, well, it is encoded as electrons on the wire.

Or photons on the fibre.

-- 
David Wragg
Staff Engineer, RabbitMQ
VMware, Inc.

From gmr at myyearbook.com  Tue Jul 19 16:09:09 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Tue, 19 Jul 2011 11:09:09 -0400
Subject: [rabbitmq-discuss] Pika and threads
In-Reply-To: <CABzX+qzEbO_372Cu2Gub+BtocDQYEaRcBv5+fpUFyPvcSFzxRg@mail.gmail.com>
References: <28393563.3648.1310876773295.JavaMail.geo-discussion-forums@yqu12>
	<CABzX+qwubP78OsFFpLPUTvC5tdAzbB9B5BtVOOo+F2D3TApfwA@mail.gmail.com>
	<4E256006.2020203@nextday.fi>
	<CABzX+qzEbO_372Cu2Gub+BtocDQYEaRcBv5+fpUFyPvcSFzxRg@mail.gmail.com>
Message-ID: <C2B2AA6690B84C1AAF55C58801768251@myyearbook.com>

 BlockingConnection is now an blocking emulation layer on top of the asynchronous core. It will be maintained but it is not very efficient for synchronous commands.  

I am no longer considering it deprecated due to the widespread use and natural inclination of people to go with it. The notes for this will be updated in the next release.  


On Tuesday, July 19, 2011 at 10:09 AM, Marek Majkowski wrote:

> 2011/7/19 Alex Gr?nholm <alex.gronholm at nextday.fi (mailto:alex.gronholm at nextday.fi)>:
> > 19.07.2011 13:37, Marek Majkowski kirjoitti:
> > >  
> > > Alex,
> > >  
> > > 2011/7/17 Alex Gr?nholm<alex.gronholm at nextday.fi (mailto:alex.gronholm at nextday.fi)>:
> > > >  
> > > > I wanted to use Pika to implement an RPC server using RabbitMQ. I found
> > > > that
> > > > this was however not possible because when I process the request in a
> > > > thread, I have no good way to thread safely send the results back.
> > >  
> > > Isn't that the point of RPC? To stop the request process/thread until
> > > the response comes back.
> >  
> > That way the server could only process one request at a time. Obviously that
> > is not good enough. My server uses 15 worker threads (possibly processes in
> > the future) which need to send results back to the client once they are done
> > processing the request. I solved this by using TornadoConnection, since
> > Tornado's I/O loop does implement the required functionality
> > (add_callback()) and uses a proper waking mechanism unlike
> > SelectConnection's. That way, when a worker thread wants to send its results
> > back to the client, it can interrupt the I/O loop which then proceeds to
> > send the data.
>  
> I'm glad you were able to come up with a sensible solution.
>  
> > > > The IOLoop lacks a mechanism for interrupting it directly. The best I
> > > > could
> > > > figure was setting a timeout of 0, but it might take up to a second for
> > > > this
> > > > to happen, considerably adding to the response latency.
> > > > Why isn't there just a dummy signalling socket that could be used for
> > > > interrupting the poll?
> > >  
> > > In the tutorials I was using BlockingConnection:
> > > http://www.rabbitmq.com/tutorials/tutorial-six-python.html
> > >  
> > > Is that of any use to you?
> >  
> > The docs say that BlockingConnection is legacy stuff and should not be used.
> > Is this no longer the case?
>  
> I don't know. Loosing BlockingConnection would be a pitty, rabbitmq
> tutorials are using it :)
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



From gmr at myyearbook.com  Tue Jul 19 16:10:14 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Tue, 19 Jul 2011 11:10:14 -0400
Subject: [rabbitmq-discuss] Pika Question (publish and consume "save" as
 fast as possible)
In-Reply-To: <CABzX+qxH_ONSHOogaAvozL9EzYbYJkfu59bDVtnp4YERv-foVg@mail.gmail.com>
References: <9C37154E143FE14CBA656B2D2232745F08CE65CF05F8@popeye.gebaschtel.bnet>
	<CABzX+qy4b1cdLb6GqN_s3DDc-gPnnZdXySpJ4Fvgd6Xdr9iioA@mail.gmail.com>
	<9C37154E143FE14CBA656B2D2232745F08CE65CF05FD@popeye.gebaschtel.bnet>
	<CABzX+qxH_ONSHOogaAvozL9EzYbYJkfu59bDVtnp4YERv-foVg@mail.gmail.com>
Message-ID: <F130326665264FF3AF8A917E8640F073@myyearbook.com>

 Also note that Pika will raise user warnings by default that you can catch and react to when it thinks that you're overwhelming the broker. 


On Tuesday, July 19, 2011 at 8:56 AM, Marek Majkowski wrote:

> On Mon, Jul 18, 2011 at 21:38, Josh Geisser <josh at gebaschtel.ch (mailto:josh at gebaschtel.ch)> wrote:
> > Aware of that, but supposed to work cross-platform while maintaining script character.
> > 
> > Sorry, I've to rephrase, less a question of throughput rather than programmer approach: any simple way to avoid dealing with the buffers itself?
> > 
> > With py-amqp I could set the transaction-flag to control the publisher won't exceed it's capabilities, dito on consumer. How to achieve that in pika?
> > 
> > Just find the setup with blocking-publisher and select-consumer strange, but only configuration that worked stable for me so far without running into buffer warnings.
> 
> Yes, you probably need a blocking publish if you don't want to
> overcome rabbitmq with too many messages.
> 
> Cheers,
>  Marek
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



From majek04 at gmail.com  Tue Jul 19 16:10:41 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Tue, 19 Jul 2011 16:10:41 +0100
Subject: [rabbitmq-discuss] Pika and threads
In-Reply-To: <C2B2AA6690B84C1AAF55C58801768251@myyearbook.com>
References: <28393563.3648.1310876773295.JavaMail.geo-discussion-forums@yqu12>
	<CABzX+qwubP78OsFFpLPUTvC5tdAzbB9B5BtVOOo+F2D3TApfwA@mail.gmail.com>
	<4E256006.2020203@nextday.fi>
	<CABzX+qzEbO_372Cu2Gub+BtocDQYEaRcBv5+fpUFyPvcSFzxRg@mail.gmail.com>
	<C2B2AA6690B84C1AAF55C58801768251@myyearbook.com>
Message-ID: <CABzX+qzQBSPKbU04hoc5ugES-vePYwiDvZ+VNzOdkZwoW_mU0w@mail.gmail.com>

On Tue, Jul 19, 2011 at 16:09, Gavin M. Roy <gmr at myyearbook.com> wrote:
> ?BlockingConnection is now an blocking emulation layer on top of the asynchronous core. It will be maintained but it is not very efficient for synchronous commands.
>
> I am no longer considering it deprecated due to the widespread use and natural inclination of  people to go with it. The notes for this will be updated in the next release.

That's a good news. Thanks!

> On Tuesday, July 19, 2011 at 10:09 AM, Marek Majkowski wrote:
>
>> 2011/7/19 Alex Gr?nholm <alex.gronholm at nextday.fi (mailto:alex.gronholm at nextday.fi)>:
>> > 19.07.2011 13:37, Marek Majkowski kirjoitti:
>> > >
>> > > Alex,
>> > >
>> > > 2011/7/17 Alex Gr?nholm<alex.gronholm at nextday.fi (mailto:alex.gronholm at nextday.fi)>:
>> > > >
>> > > > I wanted to use Pika to implement an RPC server using RabbitMQ. I found
>> > > > that
>> > > > this was however not possible because when I process the request in a
>> > > > thread, I have no good way to thread safely send the results back.
>> > >
>> > > Isn't that the point of RPC? To stop the request process/thread until
>> > > the response comes back.
>> >
>> > That way the server could only process one request at a time. Obviously that
>> > is not good enough. My server uses 15 worker threads (possibly processes in
>> > the future) which need to send results back to the client once they are done
>> > processing the request. I solved this by using TornadoConnection, since
>> > Tornado's I/O loop does implement the required functionality
>> > (add_callback()) and uses a proper waking mechanism unlike
>> > SelectConnection's. That way, when a worker thread wants to send its results
>> > back to the client, it can interrupt the I/O loop which then proceeds to
>> > send the data.
>>
>> I'm glad you were able to come up with a sensible solution.
>>
>> > > > The IOLoop lacks a mechanism for interrupting it directly. The best I
>> > > > could
>> > > > figure was setting a timeout of 0, but it might take up to a second for
>> > > > this
>> > > > to happen, considerably adding to the response latency.
>> > > > Why isn't there just a dummy signalling socket that could be used for
>> > > > interrupting the poll?
>> > >
>> > > In the tutorials I was using BlockingConnection:
>> > > http://www.rabbitmq.com/tutorials/tutorial-six-python.html
>> > >
>> > > Is that of any use to you?
>> >
>> > The docs say that BlockingConnection is legacy stuff and should not be used.
>> > Is this no longer the case?
>>
>> I don't know. Loosing BlockingConnection would be a pitty, rabbitmq
>> tutorials are using it :)
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>

From simon at rabbitmq.com  Tue Jul 19 16:21:59 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 19 Jul 2011 16:21:59 +0100
Subject: [rabbitmq-discuss] Management plugin crash server at startup
In-Reply-To: <89583B36-2B3E-4745-91D9-811BF50B6382@jaxx.org>
References: <89583B36-2B3E-4745-91D9-811BF50B6382@jaxx.org>
Message-ID: <4E25A117.3090605@rabbitmq.com>

On 18/07/11 20:39, Julien Banchet wrote:
> Problem is, the management plugin seems to die, bringing down the
> daemon with it after a couple of seconds (immediatly after start,
> rabbitmq_ctl status does list plugins, two seconds later it's dead
> already):

So this turns out to be a bug which can cause startup for the whole 
broker to fail when mochiweb takes too long (more than five seconds) to 
start an HTTP listening socket.

On Julien's machine this was happening because mochiweb tries to look up 
"localhost" as an IPv6 address, and it was taking a while to time out.

In case anybody else is bitten by this, you can download a version of 
rabbitmq_mochiweb which will wait longer than 5s from:

http://www.rabbitmq.com/releases/plugins/v2.5.1/rabbitmq_mochiweb-2.5.1-registry-timeout-fix.ez

...although the "correct" fix is probably to have IPv6 working properly, 
or turned off.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From michael.s.klishin at gmail.com  Tue Jul 19 16:42:30 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 19 Jul 2011 19:42:30 +0400
Subject: [rabbitmq-discuss] An easy cross-platform way to start RabbitMQ
	programatically?
In-Reply-To: <4E252CE9.8070103@rabbitmq.com>
References: <CAE3HoVQJjF-O-+UK5KeknhYfxTSp6hcLkbGw8RRfoyrTWMyeNA@mail.gmail.com>
	<4E252CE9.8070103@rabbitmq.com>
Message-ID: <CAE3HoVQom7qPb+8zn-arFMoHM25+TUE1b6xaPeQmvRgw+jzdKQ@mail.gmail.com>

2011/7/19 Matthias Radestock <matthias at rabbitmq.com>

> Instead of shutting down rabbit completely, you could just stop/start the
> rabbit app (with 'rabbitmqctl {start,stop}_app').


I just tried it and it looks like stop_app (as seen by AMQP clients) is
equivalent to kill or any other forced shutdown. This is great, however,
to imitate graceful shutdown I use `rabbitmqctl stop`, so start_app won't
work for that case.

But stop_app and start_app make it possible for me to exclude only one test
case from CI.

Thank you.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110719/95f45956/attachment.htm>

From jaxx at jaxx.org  Tue Jul 19 16:50:43 2011
From: jaxx at jaxx.org (Julien Banchet)
Date: Tue, 19 Jul 2011 12:50:43 -0300
Subject: [rabbitmq-discuss] Management plugin crash server at startup
In-Reply-To: <4E25A117.3090605@rabbitmq.com>
References: <89583B36-2B3E-4745-91D9-811BF50B6382@jaxx.org>
	<4E25A117.3090605@rabbitmq.com>
Message-ID: <E1BA8741-0DA7-4D7A-BCAA-09184BA6A9FC@jaxx.org>


Le 19 juil. 2011 ? 12:21, Simon MacMullen a ?crit :

> On 18/07/11 20:39, Julien Banchet wrote:
>> Problem is, the management plugin seems to die, bringing down the
>> daemon with it after a couple of seconds (immediatly after start,
>> rabbitmq_ctl status does list plugins, two seconds later it's dead
>> already):
> 
> So this turns out to be a bug which can cause startup for the whole broker to fail when mochiweb takes too long (more than five seconds) to start an HTTP listening socket.
> 
> On Julien's machine this was happening because mochiweb tries to look up "localhost" as an IPv6 address, and it was taking a while to time out.
> 
> In case anybody else is bitten by this, you can download a version of rabbitmq_mochiweb which will wait longer than 5s from:
> 
> http://www.rabbitmq.com/releases/plugins/v2.5.1/rabbitmq_mochiweb-2.5.1-registry-timeout-fix.ez
> 
> ...although the "correct" fix is probably to have IPv6 working properly, or turned off.

Hopefully you know it inside-out too, and being the only thing affected by an incomplete (though stock) v6 stack, on an isolated machine, I would have never figured that alone

So as we say "Don't need it? Remove it!"
echo net.ipv6.conf.all.disable_ipv6=1 > /etc/sysctl.d/noipv6.conf

Thanks again,

JaXX
arg, missed the reply to all button

From matthias at rabbitmq.com  Tue Jul 19 16:57:46 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 19 Jul 2011 16:57:46 +0100
Subject: [rabbitmq-discuss] An easy cross-platform way to start RabbitMQ
 programatically?
In-Reply-To: <CAE3HoVQom7qPb+8zn-arFMoHM25+TUE1b6xaPeQmvRgw+jzdKQ@mail.gmail.com>
References: <CAE3HoVQJjF-O-+UK5KeknhYfxTSp6hcLkbGw8RRfoyrTWMyeNA@mail.gmail.com>
	<4E252CE9.8070103@rabbitmq.com>
	<CAE3HoVQom7qPb+8zn-arFMoHM25+TUE1b6xaPeQmvRgw+jzdKQ@mail.gmail.com>
Message-ID: <4E25A97A.70309@rabbitmq.com>

On 19/07/11 16:42, Michael Klishin wrote:
> 2011/7/19 Matthias Radestock <matthias at rabbitmq.com
> <mailto:matthias at rabbitmq.com>>
>
>     Instead of shutting down rabbit completely, you could just
>     stop/start the rabbit app (with 'rabbitmqctl {start,stop}_app').
>
>
> I just tried it and it looks like stop_app (as seen by AMQP clients) is
> equivalent to kill or any other forced shutdown.

Really? It should be a graceful shutdown. What difference are you seeing 
compared to 'rabbitmqctl stop'?

Btw, another thing you can do is gracefully close individual connections 
with 'rabbitmqctl close_connection <connection_pid> "goodbye"'.

Matthias.

From csharpplusproject at gmail.com  Tue Jul 19 17:31:32 2011
From: csharpplusproject at gmail.com (Shalom Rav)
Date: Tue, 19 Jul 2011 09:31:32 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ Usage Patterms?
In-Reply-To: <CABzX+qyBGvsNdFh5jbm3ey__HmcrSbwtAArzR1xx_xtMikLseg@mail.gmail.com>
References: <890f139c-f398-43e1-bdf1-85304408400e@e18g2000vbx.googlegroups.com>
	<CAOn7oW8HnBTNhU=i1dLD9R2Wha1YFMepuMLjWMQp-SCqs1Yq-w@mail.gmail.com>
	<1311042710.1866.909.camel@internet>
	<CABzX+qyBGvsNdFh5jbm3ey__HmcrSbwtAArzR1xx_xtMikLseg@mail.gmail.com>
Message-ID: <ef8234e1-2a76-43d1-b40e-2b50f7f04117@h14g2000yqd.googlegroups.com>

Marek,

Thank you for your response.

Obviosuly, my main attention goes to the application itself. So 99% of
the time, I'd like it to just run.

I am *happy* to block my app momentarily to consume incoming messages
as they arrive. Then, when messages are consumed, I'd like the
application to keep running.

The question is, how do I achieve the above using python?

So far, it looks like *channel.start_consuming()* just BLOCKS
EVERYTHING and puts 100% of the focus on the messaging (not letting
anything else to run).

Any idea how to solve this?

On Jul 19, 9:20?am, Marek Majkowski <maje... at gmail.com> wrote:
> On Tue, Jul 19, 2011 at 03:31, csharpplusproject
>
> <csharpplusproj... at gmail.com> wrote:
> > Thank you for your explanation, although I do not really understand how this
> > works.
>
> > You write: "...listening for messages arriving from RabbitMQ and dispatching
> > them to your application."
>
> > I have no problem writing code that is "...listening for messages arriving
> > from RabbitMQ". The question is, how do I dispatch these messages to my
> > application while letting the application run continuously with no
> > interruptions?
>
> > Can anybody provide sample code in python that demonstrates such a pattern?
>
> Okay, where to start....
>
> When Rabbitmq (or any other network application) sends data to tcp/ip
> connection,
> well, it is encoded as electrons on the wire.
>
> On the other side of the wire, maybe on different computer, a network card
> receives electrons, decodes them and appends to a tcp/ip receive
> buffer for a particular tcp/ip connection.
>
> That was easy. Now the hard part. It's the application that needs to ask
> the kernel: "is there more data available for me in the buffers?"
>
> Asking this question all over again would be quite inefficient, so it's usually
> put as a blocking request: "give me this number of bytes of data from
> my tcp/ip buffers, wait if there isn't enough yet".
>
> Most AMQP clients follow this pattern: you can do CPU intensive
> work in your application *or* you can wait on the network and
> receive and send data.
>
> If you want to listen to messages: you shall block your program and wait
> for network traffic.
>
> Coming back to your question:
>
> > The question is, how do I dispatch these messages to my
> > application while letting the application run continuously with no
> > interruptions?
>
> You don't. If you want to receive data, you need to or:
> ?- block program and hang on socket till data is received
> ?- or poll kernel asking for more data which is quite inefficient
>
> In normal programming languages people use threads to do that,
> one thread does CPU stuff, the other does network stuff.
> But a) threads in general are complex b) threads in python are weird.
>
> Hope that helps,
> ? Marek
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From majek04 at gmail.com  Tue Jul 19 17:52:27 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Tue, 19 Jul 2011 17:52:27 +0100
Subject: [rabbitmq-discuss] RabbitMQ Usage Patterms?
In-Reply-To: <ef8234e1-2a76-43d1-b40e-2b50f7f04117@h14g2000yqd.googlegroups.com>
References: <890f139c-f398-43e1-bdf1-85304408400e@e18g2000vbx.googlegroups.com>
	<CAOn7oW8HnBTNhU=i1dLD9R2Wha1YFMepuMLjWMQp-SCqs1Yq-w@mail.gmail.com>
	<1311042710.1866.909.camel@internet>
	<CABzX+qyBGvsNdFh5jbm3ey__HmcrSbwtAArzR1xx_xtMikLseg@mail.gmail.com>
	<ef8234e1-2a76-43d1-b40e-2b50f7f04117@h14g2000yqd.googlegroups.com>
Message-ID: <CABzX+qy1nM-Egk5MvH1052_XNdonpyLZ-jxTr9VQNBh+cASy_A@mail.gmail.com>

On Tue, Jul 19, 2011 at 17:31, Shalom Rav <csharpplusproject at gmail.com> wrote:
> Thank you for your response.
>
> Obviosuly, my main attention goes to the application itself. So 99% of
> the time, I'd like it to just run.
>
> I am *happy* to block my app momentarily to consume incoming messages
> as they arrive. Then, when messages are consumed, I'd like the
> application to keep running.
>
> The question is, how do I achieve the above using python?
>
> So far, it looks like *channel.start_consuming()* just BLOCKS
> EVERYTHING and puts 100% of the focus on the messaging (not letting
> anything else to run).
>
> Any idea how to solve this?

I see. I guess there should be a way of doing something like
start_consuming() but with a timeout, but I can't find anything.

If you are interested in my opinion, take a look at this:
    http://www.rabbitmq.com/blog/2011/07/08/%EF%BB%BFpuka-rethinking-amqp-clients/

Cheers,
  Marek

From csharpplusproject at gmail.com  Tue Jul 19 18:02:14 2011
From: csharpplusproject at gmail.com (Shalom Rav)
Date: Tue, 19 Jul 2011 10:02:14 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ Usage Patterms?
In-Reply-To: <CABzX+qy1nM-Egk5MvH1052_XNdonpyLZ-jxTr9VQNBh+cASy_A@mail.gmail.com>
References: <890f139c-f398-43e1-bdf1-85304408400e@e18g2000vbx.googlegroups.com>
	<CAOn7oW8HnBTNhU=i1dLD9R2Wha1YFMepuMLjWMQp-SCqs1Yq-w@mail.gmail.com>
	<1311042710.1866.909.camel@internet>
	<CABzX+qyBGvsNdFh5jbm3ey__HmcrSbwtAArzR1xx_xtMikLseg@mail.gmail.com>
	<ef8234e1-2a76-43d1-b40e-2b50f7f04117@h14g2000yqd.googlegroups.com>
	<CABzX+qy1nM-Egk5MvH1052_XNdonpyLZ-jxTr9VQNBh+cASy_A@mail.gmail.com>
Message-ID: <6de0771a-9535-4cc8-be90-5924dd550308@g12g2000yqd.googlegroups.com>

Marek,

Thank you. I will take a look at puka.

I think I was not successful clarifying what I am trying to do. So
here's another attempt.


Simply, I want my application (which is written in python) to receive
messages ONLY when my application desires to, NOT when messages
arrive.

Here's a simple example:

Suppose that we have ONE parent, and many children that run at the
same time. Every 1[min] or so, each child sends a unique message to
the parent.

Yet, the parent is busy doing it's own work. It doesn't want to be
interrupted whenever a child sends him a message. Instead, the parent
'says' to the children: "just send me the messages -- I will get to
them when I get a free moment".

Whenever the parent gets a free moment (say, every 15[min] or so), it
temporarily stops its work, read the messages, and then resumes back
to his work.

This is essentially how we all read our emails -- we don't consume
*every email* the moment it arrives to us! sometimes, there is a delay
until we get to read a message.

The question is, how can I model the above parent / children behavior
using python?

Best,
Shalom.

On Jul 19, 12:52?pm, Marek Majkowski <maje... at gmail.com> wrote:
> On Tue, Jul 19, 2011 at 17:31, Shalom Rav <csharpplusproj... at gmail.com> wrote:
> > Thank you for your response.
>
> > Obviosuly, my main attention goes to the application itself. So 99% of
> > the time, I'd like it to just run.
>
> > I am *happy* to block my app momentarily to consume incoming messages
> > as they arrive. Then, when messages are consumed, I'd like the
> > application to keep running.
>
> > The question is, how do I achieve the above using python?
>
> > So far, it looks like *channel.start_consuming()* just BLOCKS
> > EVERYTHING and puts 100% of the focus on the messaging (not letting
> > anything else to run).
>
> > Any idea how to solve this?
>
> I see. I guess there should be a way of doing something like
> start_consuming() but with a timeout, but I can't find anything.
>
> If you are interested in my opinion, take a look at this:
> ? ?http://www.rabbitmq.com/blog/2011/07/08/%EF%BB%BFpuka-rethinking-amqp...
>
> Cheers,
> ? Marek
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From mikeb at rabbitmq.com  Tue Jul 19 18:08:50 2011
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Tue, 19 Jul 2011 18:08:50 +0100
Subject: [rabbitmq-discuss] RabbitMQ Usage Patterms?
In-Reply-To: <6de0771a-9535-4cc8-be90-5924dd550308@g12g2000yqd.googlegroups.com>
References: <890f139c-f398-43e1-bdf1-85304408400e@e18g2000vbx.googlegroups.com>	<CAOn7oW8HnBTNhU=i1dLD9R2Wha1YFMepuMLjWMQp-SCqs1Yq-w@mail.gmail.com>	<1311042710.1866.909.camel@internet>	<CABzX+qyBGvsNdFh5jbm3ey__HmcrSbwtAArzR1xx_xtMikLseg@mail.gmail.com>	<ef8234e1-2a76-43d1-b40e-2b50f7f04117@h14g2000yqd.googlegroups.com>	<CABzX+qy1nM-Egk5MvH1052_XNdonpyLZ-jxTr9VQNBh+cASy_A@mail.gmail.com>
	<6de0771a-9535-4cc8-be90-5924dd550308@g12g2000yqd.googlegroups.com>
Message-ID: <4E25BA22.1050409@rabbitmq.com>


> Simply, I want my application (which is written in python) to receive
> messages ONLY when my application desires to, NOT when messages
> arrive.
>
> Here's a simple example:
>
> Suppose that we have ONE parent, and many children that run at the
> same time. Every 1[min] or so, each child sends a unique message to
> the parent.
>
> Yet, the parent is busy doing it's own work. It doesn't want to be
> interrupted whenever a child sends him a message. Instead, the parent
> 'says' to the children: "just send me the messages -- I will get to
> them when I get a free moment".
>
> Whenever the parent gets a free moment (say, every 15[min] or so), it
> temporarily stops its work, read the messages, and then resumes back
> to his work.
>
> This is essentially how we all read our emails -- we don't consume
> *every email* the moment it arrives to us! sometimes, there is a delay
> until we get to read a message.
>
> The question is, how can I model the above parent / children behavior
> using python?

If you really want to poll for messages you can use basic.get.

In Pika this is channel.basic_get(queue_name).

http://pika.github.com/communicating.html#blocking_connection.BlockingChannel


Michael

> On Jul 19, 12:52 pm, Marek Majkowski<maje... at gmail.com>  wrote:
>> On Tue, Jul 19, 2011 at 17:31, Shalom Rav<csharpplusproj... at gmail.com>  wrote:
>>> Thank you for your response.
>>
>>> Obviosuly, my main attention goes to the application itself. So 99% of
>>> the time, I'd like it to just run.
>>
>>> I am *happy* to block my app momentarily to consume incoming messages
>>> as they arrive. Then, when messages are consumed, I'd like the
>>> application to keep running.
>>
>>> The question is, how do I achieve the above using python?
>>
>>> So far, it looks like *channel.start_consuming()* just BLOCKS
>>> EVERYTHING and puts 100% of the focus on the messaging (not letting
>>> anything else to run).
>>
>>> Any idea how to solve this?
>>
>> I see. I guess there should be a way of doing something like
>> start_consuming() but with a timeout, but I can't find anything.
>>
>> If you are interested in my opinion, take a look at this:
>>     http://www.rabbitmq.com/blog/2011/07/08/%EF%BB%BFpuka-rethinking-amqp...
>>
>> Cheers,
>>    Marek
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From michael.s.klishin at gmail.com  Tue Jul 19 18:10:15 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 19 Jul 2011 21:10:15 +0400
Subject: [rabbitmq-discuss] [announce] amqp gem 0.7.3 is released
Message-ID: <CAE3HoVQ51nOcmat3Rb+0vcsOvEm-oHTX5Pcu5H_is1=YjxLz0g@mail.gmail.com>

A quick announcement: amqp gem 0.7.3 is released, fixes an
AMQP::Queue#status regression in 0.7.2 (GH-94)
(0.8.0.RCs do not have this issue)

Have a good day.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110719/275a9ca7/attachment.htm>

From kyle.bader at dreamhost.com  Tue Jul 19 18:14:36 2011
From: kyle.bader at dreamhost.com (Kyle Bader)
Date: Tue, 19 Jul 2011 10:14:36 -0700
Subject: [rabbitmq-discuss] Debian Squeeze init script
Message-ID: <B28A4906-5A84-4AC6-9FB2-01C1CDE8EA51@dreamhost.com>

The init script for the rabbitmq-server package provided by Debian Squeeze does not contain default-start/stop runlevel information as described in this bug from 2009:

http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=552434

I'm in a situation where I have another service that depends on rabbitmq-server (chef-server components).  I've installed the rabbitmq-server package using both the RabbitMQ and Debian repositories and both suffer from this problem.  The only rabbitmq-server package that appear to have it fixed are the most recent ones available for direct download here:

http://www.rabbitmq.com/server.html

Is there something impeding this being fixed Debian Squeeze proper that I can help with?

-- 
Systems Administrator
DreamHost.com
Kyle Bader


From james at 2600hz.com  Tue Jul 19 22:20:59 2011
From: james at 2600hz.com (James Aimonetti)
Date: Tue, 19 Jul 2011 14:20:59 -0700
Subject: [rabbitmq-discuss] Channel takes everyone down?
Message-ID: <4E25F53B.7000204@2600hz.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

My setup is as follows: I have a channel per consumer, and I'm trying to
link the consumer to the channel so that if either dies, the other goes
down (most consumers are ephemeral and easy to restart, those that are
longer living trap exits).

However, when a consumer has a non-normal exit, the channel goes down,
but the exit signal bubbles up all the way to where *all* other channels
go down as well.

Any pointers how to link a consumer to its channel without taking the
whole tree of channels down?

This is with rabbitmq server and erlang-client 2.4.1 and r14b03.

Thanks!

James

- -- 
James Aimonetti
Distributed Systems Engineer / DJ MC_

2600hz | http://2600hz.com
sip:james at 2600hz.com
tel: 415.886.7905
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iQEcBAEBAgAGBQJOJfU6AAoJENc77s1OYoGg/LoH/jIA8jdA7nUsZC+hbTstmkxv
RkYg05yyB2qMp5yvoE54NL7U7LjpM6DZtCGrubbva5s9bYpRvQgQrO6XbAV17bTV
nEyY+31L2IpAxX2hFOjIpMqiQ85iMlXZ+zzHnQ5vnaKlxPuhlpgRdaMdX/0ca+8W
cMZF/FkNcX9Trwsz+XmOdKdKK0ctzZ7N4T6/5aIPzpObGBGuvZQG+b62txYf3x6Y
5Y0vPXlIDcQrU9yZ7osSG9q2DuW6qzDL9zMBZ8M8UwZoDhLRUw4DxZO3PnI+FZJz
npJcpMeQXNopE6K1idEkFfVmB+XBgcS3a9FGlruuhiBrMLWWmpjpKBJaZ+CRPFU=
=/7L/
-----END PGP SIGNATURE-----

From toby.corkindale at strategicdata.com.au  Wed Jul 20 02:46:33 2011
From: toby.corkindale at strategicdata.com.au (Toby Corkindale)
Date: Wed, 20 Jul 2011 11:46:33 +1000
Subject: [rabbitmq-discuss] STOMP plugin and virtual hosts
In-Reply-To: <4E255FFB.5090703@rabbitmq.com>
References: <4E25547B.3080606@strategicdata.com.au>
	<4E255FFB.5090703@rabbitmq.com>
Message-ID: <4E263379.4010808@strategicdata.com.au>

On 19/07/11 20:44, Simon MacMullen wrote:
> On 19/07/11 10:55, Toby Corkindale wrote:
>> Hi everyone,
>> I've been using the STOMP plugin with RabbitMQ for some time now,
>> successfully. I've just been using the default "/" virtual host.
>>
>> I'm now trying to work on partitioning different things into their own
>> virtual hosts, but I'm not sure how this works with the STOMP plugin.
>>
>> How do I specify which virtual host to attempt to write to from within
>> it? Do I put it in the destination field? Is it a header?
>
> On CONNECT, STOMP 1.1 defines a "host" header. If present, Rabbit will
> interpret this as the virtual host to use.

Ah, thanks.

It seems neither of the two available Perl STOMP modules support STOMP 
1.1, just STOMP 1.0.

In particular the module I'm using, Net::STOMP, doesn't let you pass a 
host header in the CONNECT frame.

I guess I'll be sticking to the / virtual host for a a bit longer!
(It wouldn't be hard to patch the Perl module, but maybe another day 
when I have more tuits..)

Thanks,
Toby

From toby.corkindale at strategicdata.com.au  Wed Jul 20 03:25:57 2011
From: toby.corkindale at strategicdata.com.au (Toby Corkindale)
Date: Wed, 20 Jul 2011 12:25:57 +1000
Subject: [rabbitmq-discuss] STOMP plugin and virtual hosts
In-Reply-To: <4E263379.4010808@strategicdata.com.au>
References: <4E25547B.3080606@strategicdata.com.au>	<4E255FFB.5090703@rabbitmq.com>
	<4E263379.4010808@strategicdata.com.au>
Message-ID: <4E263CB5.6010702@strategicdata.com.au>

On 20/07/11 11:46, Toby Corkindale wrote:
> On 19/07/11 20:44, Simon MacMullen wrote:
>> On 19/07/11 10:55, Toby Corkindale wrote:
>>> Hi everyone,
>>> I've been using the STOMP plugin with RabbitMQ for some time now,
>>> successfully. I've just been using the default "/" virtual host.
>>>
>>> I'm now trying to work on partitioning different things into their own
>>> virtual hosts, but I'm not sure how this works with the STOMP plugin.
>>>
>>> How do I specify which virtual host to attempt to write to from within
>>> it? Do I put it in the destination field? Is it a header?
>>
>> On CONNECT, STOMP 1.1 defines a "host" header. If present, Rabbit will
>> interpret this as the virtual host to use.
>
> Ah, thanks.
>
> It seems neither of the two available Perl STOMP modules support STOMP
> 1.1, just STOMP 1.0.
>
> In particular the module I'm using, Net::STOMP, doesn't let you pass a
> host header in the CONNECT frame.


It seems like there's been some good activity on CPAN in just the last 
few months - I just discovered Net::STOMP::Client, which implements 
STOMP 1.1, and Net::RabbitMQ (which uses AMQP).

I'll look into porting my code to one of them..

cheers,
Toby

From chakhedik at gmail.com  Wed Jul 20 08:12:32 2011
From: chakhedik at gmail.com (Chak Hedik)
Date: Wed, 20 Jul 2011 00:12:32 -0700 (PDT)
Subject: [rabbitmq-discuss] Frequently getting {badmatch, {error,
	einval} from one of my rabbimq nodes
Message-ID: <bb1ddfc2-0886-485e-8a02-09434ce92c53@t8g2000prm.googlegroups.com>

Hi,

I frequently getting this terminating error from one of my nodes :

** Generic server <0.28067.2> terminating
** Last message in was {inet_async,#Port<0.15349>,9049,
{ok,<<0,10,0,51,206>>}}
** When Server state == {state,#Port<0.15349>,<0.28063.2>,<0.28064.2>,
                               {method,rabbit_framing_amqp_0_9_1},
                               {1,0,4}}
** Reason for termination ==
** {{badmatch,{error,einval}},
    [{amqp_main_reader,handle_inet_async,2},
     {gen_server,handle_msg,5},
     {proc_lib,init_p_do_apply,3}]}

While several other nodes with the same setup didn't have the same
issue. May I know what it means and willl it affect my queues?How do I
fix this?

Thank,
Chak

From 0x6e6562 at gmail.com  Wed Jul 20 09:32:50 2011
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 20 Jul 2011 09:32:50 +0100
Subject: [rabbitmq-discuss] Management Plugin
Message-ID: <CAB-G1jiySPJ3ZS4Y=19WCOBHgfNuRehL2pYH5BL5gD-M2tKOoA@mail.gmail.com>

Hi,

Using 2.5.1/RHEL, I've come across an issue with the queues page in
the management plugin and I was wondering if anybody had seen this
before (see attached screenshot). I've also attached the JSON that is
rendered in the page. Unfortunately I'm having an uphill battle to get
hold of the server logs, due to helpful corporate standards, but I
will endeavour to glean these.

Cheers,

Ben
-------------- next part --------------
Got response code 500 with body {"error":"JSON encode error: {bad_term,<0.4170.189>}","reason":"While encoding:\n[[{memory,9360},\n {idle_since,<<\"2011-7-19 14:12:23\">>},\n {exclusive_consumer_pid,''},\n {exclusive_consumer_tag,''},\n {messages_ready,0},\n {messages_unacknowledged,0},\n {messages,0},\n {consumers,0},\n {backing_queue_status,\n {struct,\n [{q1,0},\n {q2,0},\n {delta,[delta,undefined,0,undefined]},\n {q3,0},\n {q4,0},\n {len,0},\n {pending_acks,0},\n {outstanding_txns,0},\n {target_ram_count,infinity},\n {ram_msg_count,0},\n {ram_ack_count,0},\n {ram_index_count,0},\n {next_seq_id,0},\n {persistent_count,0},\n {avg_ingress_rate,0.0},\n {avg_egress_rate,0.0},\n {avg_ack_ingress_rate,0.0},\n {avg_ack_egress_rate,0.0}]}},\n {name,<<\"acme.Book.foo-IntTest\">>},\n {vhost,<<\"/\">>},\n {durable,true},\n {auto_delete,false},\n {arguments,{struct,[]}},\n {node,rabbit at acme388}],\n [{memory,9864},\n {idle_since,<<\"2011-7-19 19:53:14\">>},\n {exclusive_consumer_pid,''},\n {exclusive_consumer_tag,''},\n {messages_ready,0},\n {messages_unacknowledged,0},\n {messages,0},\n {consumers,1},\n {backing_queue_status,\n {struct,\n [{q1,0},\n {q2,0},\n {delta,[delta,undefined,0,undefined]},\n {q3,0},\n {q4,0},\n {len,0},\n {pending_acks,0},\n {outstanding_txns,0},\n {target_ram_count,infinity},\n {ram_msg_count,0},\n {ram_ack_count,0},\n {ram_index_count,0},\n {next_seq_id,0},\n {persistent_count,0},\n {avg_ingress_rate,0.0},\n {avg_egress_rate,0.0},\n {avg_ack_ingress_rate,0.0},\n {avg_ack_egress_rate,0.0}]}},\n {name,<<\"acme.Book.foo-Staging4\">>},\n {vhost,<<\"/\">>},\n {durable,true},\n {auto_delete,false},\n {arguments,{struct,[]}},\n {node,rabbit at acme388}],\n [{memory,9832},\n {idle_since,<<\"2011-7-19 19:53:14\">>},\n {exclusive_consumer_pid,''},\n {exclusive_consumer_tag,''},\n {messages_ready,0},\n {messages_unacknowledged,0},\n {messages,0},\n {consumers,1},\n {backing_queue_status,\n {struct,\n [{q1,0},\n {q2,0},\n {delta,[delta,undefined,0,undefined]},\n {q3,0},\n {q4,0},\n {len,0},\n {pending_acks,0},\n {outstanding_txns,0},\n {target_ram_count,infinity},\n {ram_msg_count,0},\n {ram_ack_count,0},\n {ram_index_count,0},\n {next_seq_id,0},\n {persistent_count,0},\n {avg_ingress_rate,0.0},\n {avg_egress_rate,0.0},\n {avg_ack_ingress_rate,0.0},\n {avg_ack_egress_rate,0.0}]}},\n {name,<<\"acme.Book.foo-Staging6\">>},\n {vhost,<<\"/\">>},\n {durable,true},\n {auto_delete,false},\n {arguments,{struct,[]}},\n {node,rabbit at acme388}],\n [{memory,9360},\n {idle_since,<<\"2011-7-19 14:12:23\">>},\n {exclusive_consumer_pid,''},\n {exclusive_consumer_tag,''},\n {messages_ready,0},\n {messages_unacknowledged,0},\n {messages,0},\n {consumers,0},\n {backing_queue_status,\n {struct,\n [{q1,0},\n {q2,0},\n {delta,[delta,undefined,0,undefined]},\n {q3,0},\n {q4,0},\n {len,0},\n {pending_acks,0},\n {outstanding_txns,0},\n {target_ram_count,infinity},\n {ram_msg_count,0},\n {ram_ack_count,0},\n {ram_index_count,0},\n {next_seq_id,0},\n {persistent_count,0},\n {avg_ingress_rate,0.0},\n {avg_egress_rate,0.0},\n {avg_ack_ingress_rate,0.0},\n {avg_ack_egress_rate,0.0}]}},\n {name,<<\"acme.Company.foo-IntTest\">>},\n {vhost,<<\"/\">>},\n {durable,true},\n {auto_delete,false},\n {arguments,{struct,[]}},\n {node,rabbit at acme388}],\n [{memory,9872},\n {idle_since,<<\"2011-7-19 19:53:14\">>},\n {exclusive_consumer_pid,''},\n {exclusive_consumer_tag,''},\n {messages_ready,0},\n {messages_unacknowledged,0},\n {messages,0},\n {consumers,1},\n {backing_queue_status,\n {struct,\n [{q1,0},\n {q2,0},\n {delta,[delta,undefined,0,undefined]},\n {q3,0},\n {q4,0},\n {len,0},\n {pending_acks,0},\n {outstanding_txns,0},\n {target_ram_count,infinity},\n {ram_msg_count,0},\n {ram_ack_count,0},\n {ram_index_count,0},\n {next_seq_id,0},\n {persistent_count,0},\n {avg_ingress_rate,0.0},\n {avg_egress_rate,0.0},\n {avg_ack_ingress_rate,0.0},\n {avg_ack_egress_rate,0.0}]}},\n {name,<<\"acme.Company.foo-Staging4\">>},\n {vhost,<<\"/\">>},\n {durable,true},\n {auto_delete,false},\n {arguments,{struct,[]}},\n {node,rabbit at acme388}],\n [{memory,9840},\n {idle_since,<<\"2011-7-19 19:53:14\">>},\n {exclusive_consumer_pid,''},\n {exclusive_consumer_tag,''},\n {messages_ready,0},\n {messages_unacknowledged,0},\n {messages,0},\n {consumers,1},\n {backing_queue_status,\n {struct,\n [{q1,0},\n {q2,0},\n {delta,[delta,undefined,0,undefined]},\n {q3,0},\n {q4,0},\n {len,0},\n {pending_acks,0},\n {outstanding_txns,0},\n {target_ram_count,infinity},\n {ram_msg_count,0},\n {ram_ack_count,0},\n {ram_index_count,0},\n {next_seq_id,0},\n {persistent_count,0},\n {avg_ingress_rate,0.0},\n {avg_egress_rate,0.0},\n {avg_ack_ingress_rate,0.0},\n {avg_ack_egress_rate,0.0}]}},\n {name,<<\"acme.Company.foo-Staging6\">>},\n {vhost,<<\"/\">>},\n {durable,true},\n {auto_delete,false},\n {arguments,{struct,[]}},\n {node,rabbit at acme388}],\n [{memory,9360},\n {idle_since,<<\"2011-7-19 14:12:23\">>},\n {exclusive_consumer_pid,''},\n {exclusive_consumer_tag,''},\n {messages_ready,0},\n {messages_unacknowledged,0},\n {messages,0},\n {consumers,0},\n {backing_queue_status,\n {struct,\n [{q1,0},\n {q2,0},\n {delta,[delta,undefined,0,undefined]},\n {q3,0},\n {q4,0},\n {len,0},\n {pending_acks,0},\n {outstanding_txns,0},\n {target_ram_count,infinity},\n {ram_msg_count,0},\n {ram_ack_count,0},\n {ram_index_count,0},\n {next_seq_id,0},\n {persistent_count,0},\n {avg_ingress_rate,0.0},\n {avg_egress_rate,0.0},\n {avg_ack_ingress_rate,0.0},\n {avg_ack_egress_rate,0.0}]}},\n {name,<<\"acme.Deal.foo-IntTest\">>},\n {vhost,<<\"/\">>},\n {durable,true},\n {auto_delete,false},\n {arguments,{struct,[]}},\n {node,rabbit at acme388}],\n [{memory,9832},\n {idle_since,<<\"2011-7-19 19:53:14\">>},\n {exclusive_consumer_pid,''},\n {exclusive_consumer_tag,''},\n {messages_ready,0},\n {messages_unacknowledged,0},\n {messages,0},\n {consumers,1},\n {backing_queue_status,\n {struct,\n [{q1,0},\n {q2,0},\n {delta,[delta,undefined,0,undefined]},\n {q3,0},\n {q4,0},\n {len,0},\n {pending_acks,0},\n {outstanding_txns,0},\n {target_ram_count,infinity},\n {ram_msg_count,0},\n {ram_ack_count,0},\n {ram_index_count,0},\n {next_seq_id,0},\n {persistent_count,0},\n {avg_ingress_rate,0.0},\n {avg_egress_rate,0.0},\n {avg_ack_ingress_rate,0.0},\n {avg_ack_egress_rate,0.0}]}},\n {name,<<\"acme.Deal.foo-Staging4\">>},\n {vhost,<<\"/\">>},\n {durable,true},\n {auto_delete,false},\n {arguments,{struct,[]}},\n {node,rabbit at acme388}],\n [{memory,9832},\n {idle_since,<<\"2011-7-19 19:53:14\">>},\n {exclusive_consumer_pid,''},\n {exclusive_consumer_tag,''},\n {messages_ready,0},\n {messages_unacknowledged,0},\n {messages,0},\n {consumers,1},\n {backing_queue_status,\n {struct,\n [{q1,0},\n {q2,0},\n {delta,[delta,undefined,0,undefined]},\n {q3,0},\n {q4,0},\n {len,0},\n {pending_acks,0},\n {outstanding_txns,0},\n {target_ram_count,infinity},\n {ram_msg_count,0},\n {ram_ack_count,0},\n {ram_index_count,0},\n {next_seq_id,0},\n {persistent_count,0},\n {avg_ingress_rate,0.0},\n {avg_egress_rate,0.0},\n {avg_ack_ingress_rate,0.0},\n {avg_ack_egress_rate,0.0}]}},\n {name,<<\"acme.Deal.foo-Staging6\">>},\n {vhost,<<\"/\">>},\n {durable,true},\n {auto_delete,false},\n {arguments,{struct,[]}},\n {node,rabbit at acme388}],\n [{memory,9368},\n {idle_since,<<\"2011-7-13 11:51:18\">>},\n {exclusive_consumer_pid,''},\n {exclusive_consumer_tag,''},\n {messages_ready,0},\n {messages_unacknowledged,0},\n {messages,0},\n {consumers,0},\n {backing_queue_status,\n {struct,\n [{q1,0},\n {q2,0},\n {delta,[delta,undefined,0,undefined]},\n {q3,0},\n {q4,0},\n {len,0},\n {pending_acks,0},\n {outstanding_txns,0},\n {target_ram_count,infinity},\n {ram_msg_count,0},\n {ram_ack_count,0},\n {ram_index_count,0},\n {next_seq_id,0},\n {persistent_count,0},\n {avg_ingress_rate,0.0},\n {avg_egress_rate,0.0},\n {avg_ack_ingress_rate,0.0},\n {avg_ack_egress_rate,0.0}]}},\n {name,<<\"acme.Diffa.foo-Staging4.Mgmt\">>},\n {vhost,<<\"/\">>},\n {durable,true},\n {auto_delete,false},\n {arguments,{struct,[]}},\n {node,rabbit at acme388}],\n [{memory,9368},\n {idle_since,<<\"2011-7-13 11:51:18\">>},\n {exclusive_consumer_pid,''},\n {exclusive_consumer_tag,''},\n {messages_ready,0},\n {messages_unacknowledged,0},\n {messages,0},\n {consumers,0},\n {backing_queue_status,\n {struct,\n [{q1,0},\n {q2,0},\n {delta,[delta,undefined,0,undefined]},\n {q3,0},\n {q4,0},\n {len,0},\n {pending_acks,0},\n {outstanding_txns,0},\n {target_ram_count,infinity},\n {ram_msg_count,0},\n {ram_ack_count,0},\n {ram_index_count,0},\n {next_seq_id,0},\n {persistent_count,0},\n {avg_ingress_rate,0.0},\n {avg_egress_rate,0.0},\n {avg_ack_ingress_rate,0.0},\n {avg_ack_egress_rate,0.0}]}},\n {name,<<\"acme.Diffa.foo-Staging6.Mgmt\">>},\n {vhost,<<\"/\">>},\n {durable,true},\n {auto_delete,false},\n {arguments,{struct,[]}},\n {node,rabbit at acme388}],\n [{memory,7480},\n {idle_since,<<\"2011-7-18 18:41:23\">>},\n {exclusive_consumer_pid,<0.4170.189>},\n {exclusive_consumer_tag,<<\"amq.ctag-ZKPFlqJFdGd60Q3vcDIiew==\">>},\n {messages_ready,0},\n {messages_unacknowledged,0},\n {messages,0},\n {consumers,1},\n {backing_queue_status,\n {struct,\n [{q1,0},\n {q2,0},\n {delta,[delta,undefined,0,undefined]},\n {q3,0},\n {q4,0},\n {len,0},\n {pending_acks,0},\n {outstanding_txns,0},\n {target_ram_count,infinity},\n {ram_msg_count,0},\n {ram_ack_count,0},\n {ram_index_count,0},\n {next_seq_id,0},\n {persistent_count,0},\n {avg_ingress_rate,0.0},\n {avg_egress_rate,0.0},\n {avg_ack_ingress_rate,0.0},\n {avg_ack_egress_rate,0.0}]}},\n {name,<<\"acme.Diffa.MTM.Mgmt\">>},\n {vhost,<<\"/\">>},\n {durable,false},\n {auto_delete,false},\n {arguments,{struct,[]}},\n {node,rabbit at acme388}],\n [{memory,9360},\n {idle_since,<<\"2011-7-12 9:36:58\">>},\n {exclusive_consumer_pid,''},\n {exclusive_consumer_tag,''},\n {messages_ready,0},\n {messages_unacknowledged,0},\n {messages,0},\n {consumers,0},\n {backing_queue_status,\n {struct,\n [{q1,0},\n {q2,0},\n {delta,[delta,undefined,0,undefined]},\n {q3,0},\n {q4,0},\n {len,0},\n {pending_acks,0},\n {outstanding_txns,0},\n {target_ram_count,infinity},\n {ram_msg_count,0},\n {ram_ack_count,0},\n {ram_index_count,0},\n {next_seq_id,0},\n {persistent_count,0},\n {avg_ingress_rate,0.0},\n {avg_egress_rate,0.0},\n {avg_ack_ingress_rate,0.0},\n {avg_ack_egress_rate,0.0}]}},\n {name,\n <<\"acme.FeedbackEvent.MTM.LON-EDhoodLT.ben.hood.4yLQjtFaEE-EJFqM-lBMjg\">>},\n {vhost,<<\"/\">>},\n {durable,true},\n {auto_delete,true},\n {arguments,{struct,[]}},\n {node,rabbit at acme388}],\n [{memory,9360},\n {idle_since,<<\"2011-7-12 9:57:34\">>},\n {exclusive_consumer_pid,''},\n {exclusive_consumer_tag,''},\n {messages_ready,0},\n {messages_unacknowledged,0},\n {messages,0},\n {consumers,0},\n {backing_queue_status,\n {struct,\n [{q1,0},\n {q2,0},\n {delta,[delta,undefined,0,undefined]},\n {q3,0},\n {q4,0},\n {len,0},\n {pending_acks,0},\n {outstanding_txns,0},\n {target_ram_count,infinity},\n {ram_msg_count,0},\n {ram_ack_count,0},\n {ram_index_count,0},\n {next_seq_id,0},\n {persistent_count,0},\n {avg_ingress_rate,0.0},\n {avg_egress_rate,0.0},\n {avg_ack_ingress_rate,0.0},\n {avg_ack_egress_rate,0.0}]}},\n {name,\n <<\"acme.FeedbackEvent.MTM.LON-EDhoodLT.ben.hood.7A5ZwbflZkKMc-63bU4-hQ\">>},\n {vhost,<<\"/\">>},\n {durable,true},\n {auto_delete,true},\n {arguments,{struct,[]}},\n {node,rabbit at acme388}],\n [{memory,9360},\n {idle_since,<<\"2011-7-12 15:34:14\">>},\n {exclusive_consumer_pid,''},\n {exclusive_consumer_tag,''},\n {messages_ready,0},\n {messages_unacknowledged,0},\n {messages,0},\n {consumers,0},\n {backing_queue_status,\n {struct,\n [{q1,0},\n {q2,0},\n {delta,[delta,undefined,0,undefined]},\n {q3,0},\n {q4,0},\n {len,0},\n {pending_acks,0},\n {outstanding_txns,0},\n {target_ram_count,infinity},\n {ram_msg_count,0},\n {ram_ack_count,0},\n {ram_index_count,0},\n {next_seq_id,0},\n {persistent_count,0},\n {avg_ingress_rate,0.0},\n {avg_egress_rate,0.0},\n {avg_ack_ingress_rate,0.0},\n {avg_ack_egress_rate,0.0}]}},\n {name,\n <<\"acme.FeedbackEvent.MTM.LON-EDhoodLT.ben.hood.BWjXBkvq8Uq3QUYMMOgyyA\">>},\n {vhost,<<\"/\">>},\n {durable,true},\n {auto_delete,true},\n {arguments,{struct,[]}},\n {node,rabbit at acme388}],\n [{memory,11344},\n {idle_since,<<\"2011-7-11 17:45:17\">>},\n {exclusive_consumer_pid,''},\n {exclusive_consumer_tag,''},\n {messages_ready,0},\n {messages_unacknowledged,0},\n {messages,0},\n {consumers,0},\n {backing_queue_status,\n {struct,\n [{q1,0},\n {q2,0},\n {delta,[delta,0,0,0]},\n {q3,0},\n {q4,0},\n {len,0},\n {pending_acks,0},\n {outstanding_txns,0},\n {target_ram_count,infinity},\n {ram_msg_count,0},\n {ram_ack_count,0},\n {ram_index_count,0},\n {next_seq_id,0},\n {persistent_count,0},\n {avg_ingress_rate,0.0},\n {avg_egress_rate,0.0},\n {avg_ack_ingress_rate,0.0},\n {avg_ack_egress_rate,0.0}]}},\n {name,\n <<\"acme.FeedbackEvent.MTM.LON-EDhoodLT.ben.hood.MU-ei8krMEmosy9NsYRuaQ\">>},\n {vhost,<<\"/\">>},\n {durable,true},\n {auto_delete,true},\n {arguments,{struct,[]}},\n {node,rabbit at acme388}],\n [{memory,9360},\n {idle_since,<<\"2011-7-12 13:10:22\">>},\n {exclusive_consumer_pid,''},\n {exclusive_consumer_tag,''},\n {messages_ready,0},\n {messages_unacknowledged,0},\n {messages,0},\n {consumers,0},\n {backing_queue_status,\n {struct,\n [{q1,0},\n {q2,0},\n {delta,[delta,undefined,0,undefined]},\n {q3,0},\n {q4,0},\n {len,0},\n {pending_acks,0},\n {outstanding_txns,0},\n {target_ram_count,infinity},\n {ram_msg_count,0},\n {ram_ack_count,0},\n {ram_index_count,0},\n {next_seq_id,0},\n {persistent_count,0},\n {avg_ingress_rate,0.0},\n {avg_egress_rate,0.0},\n {avg_ack_ingress_rate,0.0},\n {avg_ack_egress_rate,0.0}]}},\n {name,\n <<\"acme.FeedbackEvent.MTM.LON-EDhoodLT.ben.hood.NnTIhcudPU2UGLN7E3sqCA\">>},\n {vhost,<<\"/\">>},\n {durable,true},\n {auto_delete,true},\n {arguments,{struct,[]}},\n {node,rabbit at acme388}],\n [{memory,9360},\n {idle_since,<<\"2011-7-12 13:5:24\">>},\n {exclusive_consumer_pid,''},\n {exclusive_consumer_tag,''},\n {messages_ready,0},\n {messages_unacknowledged,0},\n {messages,0},\n {consumers,0},\n {backing_queue_status,\n {struct,\n [{q1,0},\n {q2,0},\n {delta,[delta,undefined,0,undefined]},\n {q3,0},\n {q4,0},\n {len,0},\n {pending_acks,0},\n {outstanding_txns,0},\n {target_ram_count,infinity},\n {ram_msg_count,0},\n {ram_ack_count,0},\n {ram_index_count,0},\n {next_seq_id,0},\n {persistent_count,0},\n {avg_ingress_rate,0.0},\n {avg_egress_rate,0.0},\n {avg_ack_ingress_rate,0.0},\n {avg_ack_egress_rate,0.0}]}},\n {name,\n <<\"acme.FeedbackEvent.MTM.LON-EDhoodLT.ben.hood.SE-yDSejXEaPi1WG_3zXCA\">>},\n {vhost,<<\"/\">>},\n {durable,true},\n {auto_delete,true},\n {arguments,{struct,[]}},\n {node,rabbit at acme388}],\n [{memory,9360},\n {idle_since,<<\"2011-7-12 9:54:21\">>},\n {exclusive_consumer_pid,''},\n {exclusive_consumer_tag,''},\n {messages_ready,0},\n {messages_unacknowledged,0},\n {messages,0},\n {consumers,0},\n {backing_queue_status,\n {struct,\n [{q1,0},\n {q2,0},\n {delta,[delta,undefined,0,undefined]},\n {q3,0},\n {q4,0},\n {len,0},\n {pending_acks,0},\n {outstanding_txns,0},\n {target_ram_count,infinity},\n {ram_msg_count,0},\n {ram_ack_count,0},\n {ram_index_count,0},\n {next_seq_id,0},\n {persistent_count,0},\n {avg_ingress_rate,0.0},\n {avg_egress_rate,0.0},\n {avg_ack_ingress_rate,0.0},\n {avg_ack_egress_rate,0.0}]}},\n {name,\n <<\"acme.FeedbackEvent.MTM.LON-EDhoodLT.ben.hood.WTbnj5tU4kexn0R_BvADsA\">>},\n {vhost,<<\"/\">>},\n {durable,true},\n {auto_delete,true},\n {arguments,{struct,[]}},\n {node,rabbit at acme388}],\n [{memory,9360},\n {idle_since,<<\"2011-7-12 11:7:10\">>},\n {exclusive_consumer_pid,''},\n {exclusive_consumer_tag,''},\n {messages_ready,0},\n {messages_unacknowledged,0},\n {messages,0},\n {consumers,0},\n {backing_queue_status,\n {struct,\n [{q1,0},\n {q2,0},\n {delta,[delta,undefined,0,undefined]},\n {q3,0},\n {q4,0},\n {len,0},\n {pending_acks,0},\n {outstanding_txns,0},\n {target_ram_count,infinity},\n {ram_msg_count,0},\n {ram_ack_count,0},\n {ram_index_count,0},\n {next_seq_id,0},\n {persistent_count,0},\n {avg_ingress_rate,0.0},\n {avg_egress_rate,0.0},\n {avg_ack_ingress_rate,0.0},\n {avg_ack_egress_rate,0.0}]}},\n {name,\n <<\"acme.FeedbackEvent.MTM.LON-EDhoodLT.ben.hood.kLt1u2uYcEi5Ohs7miuL0Q\">>},\n {vhost,<<\"/\">>},\n {durable,true},\n {auto_delete,true},\n {arguments,{struct,[]}},\n {node,rabbit at acme388}],\n [{memory,9360},\n {idle_since,<<\"2011-7-12 13:11:50\">>},\n {exclusive_consumer_pid,''},\n {exclusive_consumer_tag,''},\n {messages_ready,0},\n {messages_unacknowledged,0},\n {messages,0},\n {consumers,0},\n {backing_queue_status,\n {struct,\n [{q1,0},\n {q2,0},\n {delta,[delta,undefined,0,undefined]},\n {q3,0},\n {q4,0},\n {len,0},\n {pending_acks,0},\n {outstanding_txns,0},\n {target_ram_count,infinity},\n {ram_msg_count,0},\n {ram_ack_count,0},\n {ram_index_count,0},\n {next_seq_id,0},\n {persistent_count,0},\n {avg_ingress_rate,0.0},\n {avg_egress_rate,0.0},\n {avg_ack_ingress_rate,0.0},\n {avg_ack_egress_rate,0.0}]}},\n {name,\n <<\"acme.FeedbackEvent.MTM.LON-EDhoodLT.ben.hood.kmvgnSNm8Eu9X9mXAJbnRg\">>},\n {vhost,<<\"/\">>},\n {durable,true},\n {auto_delete,true},\n {arguments,{struct,[]}},\n {node,rabbit at acme388}],\n [{memory,11376},\n {idle_since,<<\"2011-7-11 17:45:17\">>},\n {exclusive_consumer_pid,''},\n {exclusive_consumer_tag,''},\n {messages_ready,0},\n {messages_unacknowledged,0},\n {messages,0},\n {consumers,0},\n {backing_queue_status,\n {struct,\n [{q1,0},\n {q2,0},\n {delta,[delta,0,0,0]},\n {q3,0},\n {q4,0},\n {len,0},\n {pending_acks,0},\n {outstanding_txns,0},\n {target_ram_count,infinity},\n {ram_msg_count,0},\n {ram_ack_count,0},\n {ram_index_count,0},\n {next_seq_id,0},\n {persistent_count,0},\n {avg_ingress_rate,0.0},\n {avg_egress_rate,0.0},\n {avg_ack_ingress_rate,0.0},\n {avg_ack_egress_rate,0.0}]}},\n {name,\n <<\"acme.FeedbackEvent.MTM.LON-EDhoodLT.ben.hood.w_95PVbhBk6DmwBNI7BV_w\">>},\n {vhost,<<\"/\">>},\n {durable,true},\n {auto_delete,true},\n {arguments,{struct,[]}},\n {node,rabbit at acme388}],\n [{memory,9360},\n {idle_since,<<\"2011-7-19 19:47:39\">>},\n {exclusive_consumer_pid,''},\n {exclusive_consumer_tag,''},\n {messages_ready,0},\n {messages_unacknowledged,0},\n {messages,0},\n {consumers,0},\n {backing_queue_status,\n {struct,\n [{q1,0},\n {q2,0},\n {delta,[delta,undefined,0,undefined]},\n {q3,0},\n {q4,0},\n {len,0},\n {pending_acks,0},\n {outstanding_txns,0},\n {target_ram_count,infinity},\n {ram_msg_count,0},\n {ram_ack_count,0},\n {ram_index_count,0},\n {next_seq_id,0},\n {persistent_count,0},\n {avg_ingress_rate,0.0},\n {avg_egress_rate,0.0},\n {avg_ack_ingress_rate,0.0},\n {avg_ack_egress_rate,0.0}]}},\n {name,\n <<\"acme.FeedbackEvent.MTM.LSHIFT1.ben.hood.7STIKyVNtk-SafVlVkHhSA\">>},\n {vhost,<<\"/\">>},\n {durable,true},\n {auto_delete,true},\n {arguments,{struct,[]}},\n {node,rabbit at acme388}],\n [{memory,9360},\n {idle_since,<<\"2011-7-11 17:54:27\">>},\n {exclusive_consumer_pid,''},\n {exclusive_consumer_tag,''},\n {messages_ready,0},\n {messages_unacknowledged,0},\n {messages,0},\n {consumers,0},\n {backing_queue_status,\n {struct,\n [{q1,0},\n {q2,0},\n {delta,[delta,undefined,0,undefined]},\n {q3,0},\n {q4,0},\n {len,0},\n {pending_acks,0},\n {outstanding_txns,0},\n {target_ram_count,infinity},\n {ram_msg_count,0},\n {ram_ack_count,0},\n {ram_index_count,0},\n {next_seq_id,0},\n {persistent_count,0},\n {avg_ingress_rate,0.0},\n {avg_egress_rate,0.0},\n {avg_ack_ingress_rate,0.0},\n {avg_ack_egress_rate,0.0}]}},\n {name,\n <<\"acme.FeedbackEvent.MTM.LSHIFT1.ben.hood.JxYt3f-lR0i5DgUoJNLtgg\">>},\n {vhost,<<\"/\">>},\n {durable,true},\n {auto_delete,true},\n {arguments,{struct,[]}},\n {node,rabbit at acme388}],\n [{memory,9904},\n {idle_since,<<\"2011-7-19 20:6:14\">>},\n {exclusive_consumer_pid,''},\n {exclusive_consumer_tag,''},\n {messages_ready,0},\n {messages_unacknowledged,0},\n {messages,0},\n {consumers,1},\n {backing_queue_status,\n {struct,\n [{q1,0},\n {q2,0},\n {delta,[delta,undefined,0,undefined]},\n {q3,0},\n {q4,0},\n {len,0},\n {pending_acks,0},\n {outstanding_txns,0},\n {target_ram_count,infinity},\n {ram_msg_count,0},\n {ram_ack_count,0},\n {ram_index_count,0},\n {next_seq_id,0},\n {persistent_count,0},\n {avg_ingress_rate,0.0},\n {avg_egress_rate,0.0},\n {avg_ack_ingress_rate,0.0},\n {avg_ack_egress_rate,0.0}]}},\n {name,\n <<\"acme.FeedbackEvent.MTM.LSHIFT1.ben.hood.jQk3mPbOVk2pn4ZmXadLMA\">>},\n {vhost,<<\"/\">>},\n {durable,true},\n {auto_delete,true},\n {arguments,{struct,[]}},\n {node,rabbit at acme388}],\n [{memory,9368},\n {idle_since,<<\"2011-7-19 14:12:31\">>},\n {exclusive_consumer_pid,''},\n {exclusive_consumer_tag,''},\n {messages_ready,0},\n {messages_unacknowledged,0},\n {messages,0},\n {consumers,0},\n {backing_queue_status,\n {struct,\n [{q1,0},\n {q2,0},\n {delta,[delta,undefined,0,undefined]},\n {q3,0},\n {q4,0},\n {len,0},\n {pending_acks,0},\n {outstanding_txns,0},\n {target_ram_count,infinity},\n {ram_msg_count,0},\n {ram_ack_count,0},\n {ram_index_count,0},\n {next_seq_id,0},\n {persistent_count,0},\n {avg_ingress_rate,0.0},\n {avg_egress_rate,0.0},\n {avg_ack_ingress_rate,0.0},\n {avg_ack_egress_rate,0.0}]}},\n {name,<<\"acme.FeedbackEvent.SmokeTest\">>},\n {vhost,<<\"/\">>},\n {durable,true},\n {auto_delete,false},\n {arguments,{struct,[]}},\n {node,rabbit at acme388}],\n [{memory,9360},\n {idle_since,<<\"2011-7-19 14:12:23\">>},\n {exclusive_consumer_pid,''},\n {exclusive_consumer_tag,''},\n {messages_ready,0},\n {messages_unacknowledged,0},\n {messages,0},\n {consumers,0},\n {backing_queue_status,\n {struct,\n [{q1,0},\n {q2,0},\n {delta,[delta,undefined,0,undefined]},\n {q3,0},\n {q4,0},\n {len,0},\n {pending_acks,0},\n {outstanding_txns,0},\n {target_ram_count,infinity},\n {ram_msg_count,0},\n {ram_ack_count,0},\n {ram_index_count,0},\n {next_seq_id,0},\n {persistent_count,0},\n {avg_ingress_rate,0.0},\n {avg_egress_rate,0.0},\n {avg_ack_ingress_rate,0.0},\n {avg_ack_egress_rate,0.0}]}},\n {name,<<\"acme.Grade.foo-IntTest\">>},\n {vhost,<<\"/\">>},\n {durable,true},\n {auto_delete,false},\n {arguments,{struct,[]}},\n {node,rabbit at acme388}],\n [{memory,9832},\n {idle_since,<<\"2011-7-19 19:53:14\">>},\n {exclusive_consumer_pid,''},\n {exclusive_consumer_tag,''},\n {messages_ready,0},\n {messages_unacknowledged,0},\n {messages,0},\n {consumers,1},\n {backing_queue_status,\n {struct,\n [{q1,0},\n {q2,0},\n {delta,[delta,undefined,0,undefined]},\n {q3,0},\n {q4,0},\n {len,0},\n {pending_acks,0},\n {outstanding_txns,0},\n {target_ram_count,infinity},\n {ram_msg_count,0},\n {ram_ack_count,0},\n {ram_index_count,0},\n {next_seq_id,0},\n {persistent_count,0},\n {avg_ingress_rate,0.0},\n {avg_egress_rate,0.0},\n {avg_ack_ingress_rate,0.0},\n {avg_ack_egress_rate,0.0}]}},\n {name,<<\"acme.Grade.foo-Staging4\">>},\n {vhost,<<\"/\">>},\n {durable,true},\n {auto_delete,false},\n {arguments,{struct,[]}},\n {node,rabbit at acme388}],\n [{memory,9832},\n {idle_since,<<\"2011-7-19 19:53:14\">>},\n {exclusive_consumer_pid,''},\n {exclusive_consumer_tag,''},\n {messages_ready,0},\n {messages_unacknowledged,0},\n {messages,0},\n {consumers,1},\n {backing_queue_status,\n {struct,\n [{q1,0},\n {q2,0},\n {delta,[delta,undefined,0,undefined]},\n {q3,0},\n {q4,0},\n {len,0},\n {pending_acks,0},\n {outstanding_txns,0},\n {target_ram_count,infinity},\n {ram_msg_count,0},\n {ram_ack_count,0},\n {ram_index_count,0},\n {next_seq_id,0},\n {persistent_count,0},\n {avg_ingress_rate,0.0},\n {avg_egress_rate,0.0},\n {avg_ack_ingress_rate,0.0},\n {avg_ack_egress_rate,0.0}]}},\n {name,<<\"acme.Grade.foo-Staging6\">>},\n {vhost,<<\"/\">>},\n {durable,true},\n {auto_delete,false},\n {arguments,{struct,[]}},\n {node,rabbit at acme388}],\n [{memory,9368},\n {idle_since,<<\"2011-7-19 14:12:23\">>},\n {exclusive_consumer_pid,''},\n {exclusive_consumer_tag,''},\n {messages_ready,0},\n {messages_unacknowledged,0},\n {messages,0},\n {consumers,0},\n {backing_queue_status,\n {struct,\n [{q1,0},\n {q2,0},\n {delta,[delta,undefined,0,undefined]},\n {q3,0},\n {q4,0},\n {len,0},\n {pending_acks,0},\n {outstanding_txns,0},\n {target_ram_count,infinity},\n {ram_msg_count,0},\n {ram_ack_count,0},\n {ram_index_count,0},\n {next_seq_id,0},\n {persistent_count,0},\n {avg_ingress_rate,0.0},\n {avg_egress_rate,0.0},\n {avg_ack_ingress_rate,0.0},\n {avg_ack_egress_rate,0.0}]}},\n {name,<<\"acme.Location.foo-IntTest\">>},\n {vhost,<<\"/\">>},\n {durable,true},\n {auto_delete,false},\n {arguments,{struct,[]}},\n {node,rabbit at acme388}],\n [{memory,9840},\n {idle_since,<<\"2011-7-19 19:53:15\">>},\n {exclusive_consumer_pid,''},\n {exclusive_consumer_tag,''},\n {messages_ready,0},\n {messages_unacknowledged,0},\n {messages,0},\n {consumers,1},\n {backing_queue_status,\n {struct,\n [{q1,0},\n {q2,0},\n {delta,[delta,undefined,0,undefined]},\n {q3,0},\n {q4,0},\n {len,0},\n {pending_acks,0},\n {outstanding_txns,0},\n {target_ram_count,infinity},\n {ram_msg_count,0},\n {ram_ack_count,0},\n {ram_index_count,0},\n {next_seq_id,0},\n {persistent_count,0},\n {avg_ingress_rate,0.0},\n {avg_egress_rate,0.0},\n {avg_ack_ingress_rate,0.0},\n {avg_ack_egress_rate,0.0}]}},\n {name,<<\"acme.Location.foo-Staging4\">>},\n {vhost,<<\"/\">>},\n {durable,true},\n {auto_delete,false},\n {arguments,{struct,[]}},\n {node,rabbit at acme388}],\n [{memory,9840},\n {idle_since,<<\"2011-7-19 19:53:15\">>},\n {exclusive_consumer_pid,''},\n {exclusive_consumer_tag,''},\n {messages_ready,0},\n {messages_unacknowledged,0},\n {messages,0},\n {consumers,1},\n {backing_queue_status,\n {struct,\n [{q1,0},\n {q2,0},\n {delta,[delta,undefined,0,undefined]},\n {q3,0},\n {q4,0},\n {len,0},\n {pending_acks,0},\n {outstanding_txns,0},\n {target_ram_count,infinity},\n {ram_msg_count,0},\n {ram_ack_count,0},\n {ram_index_count,0},\n {next_seq_id,0},\n {persistent_count,0},\n {avg_ingress_rate,0.0},\n {avg_egress_rate,0.0},\n {avg_ack_ingress_rate,0.0},\n {avg_ack_egress_rate,0.0}]}},\n {name,<<\"acme.Location.foo-Staging6\">>},\n {vhost,<<\"/\">>},\n {durable,true},\n {auto_delete,false},\n {arguments,{struct,[]}},\n {node,rabbit at acme388}],\n [{memory,9360},\n {idle_since,<<\"2011-7-19 14:12:24\">>},\n {exclusive_consumer_pid,''},\n {exclusive_consumer_tag,''},\n {messages_ready,0},\n {messages_unacknowledged,0},\n {messages,0},\n {consumers,0},\n {backing_queue_status,\n {struct,\n [{q1,0},\n {q2,0},\n {delta,[delta,undefined,0,undefined]},\n {q3,0},\n {q4,0},\n {len,0},\n {pending_acks,0},\n {outstanding_txns,0},\n {target_ram_count,infinity},\n {ram_msg_count,0},\n {ram_ack_count,0},\n {ram_index_count,0},\n {next_seq_id,0},\n {persistent_count,0},\n {avg_ingress_rate,0.0},\n {avg_egress_rate,0.0},\n {avg_ack_ingress_rate,0.0},\n {avg_ack_egress_rate,0.0}]}},\n {name,<<\"acme.Market.foo-IntTest\">>},\n {vhost,<<\"/\">>},\n {durable,true},\n {auto_delete,false},\n {arguments,{struct,[]}},\n {node,rabbit at acme388}],\n [{memory,9848},\n {idle_since,<<\"2011-7-19 19:53:14\">>},\n {exclusive_consumer_pid,''},\n {exclusive_consumer_tag,''},\n {messages_ready,0},\n {messages_unacknowledged,0},\n {messages,0},\n {consumers,1},\n {backing_queue_status,\n {struct,\n [{q1,0},\n {q2,0},\n {delta,[delta,undefined,0,undefined]},\n {q3,0},\n {q4,0},\n {len,0},\n {pending_acks,0},\n {outstanding_txns,0},\n {target_ram_count,infinity},\n {ram_msg_count,0},\n {ram_ack_count,0},\n {ram_index_count,0},\n {next_seq_id,0},\n {persistent_count,0},\n {avg_ingress_rate,0.0},\n {avg_egress_rate,0.0},\n {avg_ack_ingress_rate,0.0},\n {avg_ack_egress_rate,0.0}]}},\n {name,<<\"acme.Market.foo-Staging4\">>},\n {vhost,<<\"/\">>},\n {durable,true},\n {auto_delete,false},\n {arguments,{struct,[]}},\n {node,rabbit at acme388}],\n [{memory,9832},\n {idle_since,<<\"2011-7-19 19:53:14\">>},\n {exclusive_consumer_pid,''},\n {exclusive_consumer_tag,''},\n {messages_ready,0},\n {messages_unacknowledged,0},\n {messages,0},\n {consumers,1},\n {backing_queue_status,\n {struct,\n [{q1,0},\n {q2,0},\n {delta,[delta,undefined,0,undefined]},\n {q3,0},\n {q4,0},\n {len,0},\n {pending_acks,0},\n {outstanding_txns,0},\n {target_ram_count,infinity},\n {ram_msg_count,0},\n {ram_ack_count,0},\n {ram_index_count,0},\n {next_seq_id,0},\n {persistent_count,0},\n {avg_ingress_rate,0.0},\n {avg_egress_rate,0.0},\n {avg_ack_ingress_rate,0.0},\n {avg_ack_egress_rate,0.0}]}},\n {name,<<\"acme.Market.foo-Staging6\">>},\n {vhost,<<\"/\">>},\n {durable,true},\n {auto_delete,false},\n {arguments,{struct,[]}},\n {node,rabbit at acme388}],\n [{memory,9360},\n {idle_since,<<\"2011-7-19 14:12:24\">>},\n {exclusive_consumer_pid,''},\n {exclusive_consumer_tag,''},\n {messages_ready,0},\n {messages_unacknowledged,0},\n {messages,0},\n {consumers,0},\n {backing_queue_status,\n {struct,\n [{q1,0},\n {q2,0},\n {delta,[delta,undefined,0,undefined]},\n {q3,0},\n {q4,0},\n {len,0},\n {pending_acks,0},\n {outstanding_txns,0},\n {target_ram_count,infinity},\n {ram_msg_count,0},\n {ram_ack_count,0},\n {ram_index_count,0},\n {next_seq_id,0},\n {persistent_count,0},\n {avg_ingress_rate,0.0},\n {avg_egress_rate,0.0},\n {avg_ack_ingress_rate,0.0},\n {avg_ack_egress_rate,0.0}]}},\n {name,<<\"acme.Person.foo-IntTest\">>},\n {vhost,<<\"/\">>},\n {durable,true},\n {auto_delete,false},\n {arguments,{struct,[]}},\n {node,rabbit at acme388}],\n [{memory,9832},\n {idle_since,<<\"2011-7-19 19:53:14\">>},\n {exclusive_consumer_pid,''},\n {exclusive_consumer_tag,''},\n {messages_ready,0},\n {messages_unacknowledged,0},\n {messages,0},\n {consumers,1},\n {backing_queue_status,\n {struct,\n [{q1,0},\n {q2,0},\n {delta,[delta,undefined,0,undefined]},\n {q3,0},\n {q4,0},\n {len,0},\n {pending_acks,0},\n {outstanding_txns,0},\n {target_ram_count,infinity},\n {ram_msg_count,0},\n {ram_ack_count,0},\n {ram_index_count,0},\n {next_seq_id,0},\n {persistent_count,0},\n {avg_ingress_rate,0.0},\n {avg_egress_rate,0.0},\n {avg_ack_ingress_rate,0.0},\n {avg_ack_egress_rate,0.0}]}},\n {name,<<\"acme.Person.foo-Staging4\">>},\n {vhost,<<\"/\">>},\n {durable,true},\n {auto_delete,false},\n {arguments,{struct,[]}},\n {node,rabbit at acme388}],\n [{memory,9848},\n {idle_since,<<\"2011-7-19 19:53:14\">>},\n {exclusive_consumer_pid,''},\n {exclusive_consumer_tag,''},\n {messages_ready,0},\n {messages_unacknowledged,0},\n {messages,0},\n {consumers,1},\n {backing_queue_status,\n {struct,\n [{q1,0},\n {q2,0},\n {delta,[delta,undefined,0,undefined]},\n {q3,0},\n {q4,0},\n {len,0},\n {pending_acks,0},\n {outstanding_txns,0},\n {target_ram_count,infinity},\n {ram_msg_count,0},\n {ram_ack_count,0},\n {ram_index_count,0},\n {next_seq_id,0},\n {persistent_count,0},\n {avg_ingress_rate,0.0},\n {avg_egress_rate,0.0},\n {avg_ack_ingress_rate,0.0},\n {avg_ack_egress_rate,0.0}]}},\n {name,<<\"acme.Person.foo-Staging6\">>},\n {vhost,<<\"/\">>},\n {durable,true},\n {auto_delete,false},\n {arguments,{struct,[]}},\n {node,rabbit at acme388}],\n [{memory,9344},\n {idle_since,<<\"2011-7-19 14:12:24\">>},\n {exclusive_consumer_pid,''},\n {exclusive_consumer_tag,''},\n {messages_ready,0},\n {messages_unacknowledged,0},\n {messages,0},\n {consumers,0},\n {backing_queue_status,\n {struct,\n [{q1,0},\n {q2,0},\n {delta,[delta,undefined,0,undefined]},\n {q3,0},\n {q4,0},\n {len,0},\n {pending_acks,0},\n {outstanding_txns,0},\n {target_ram_count,infinity},\n {ram_msg_count,0},\n {ram_ack_count,0},\n {ram_index_count,0},\n {next_seq_id,0},\n {persistent_count,0},\n {avg_ingress_rate,0.0},\n {avg_egress_rate,0.0},\n {avg_ack_ingress_rate,0.0},\n {avg_ack_egress_rate,0.0}]}},\n {name,<<\"acme.Product.foo-IntTest\">>},\n {vhost,<<\"/\">>},\n {durable,true},\n {auto_delete,false},\n {arguments,{struct,[]}},\n {node,rabbit at acme388}],\n [{memory,9840},\n {idle_since,<<\"2011-7-19 19:53:14\">>},\n {exclusive_consumer_pid,''},\n {exclusive_consumer_tag,''},\n {messages_ready,0},\n {messages_unacknowledged,0},\n {messages,0},\n {consumers,1},\n {backing_queue_status,\n {struct,\n [{q1,0},\n {q2,0},\n {delta,[delta,undefined,0,undefined]},\n {q3,0},\n {q4,0},\n {len,0},\n {pending_acks,0},\n {outstanding_txns,0},\n {target_ram_count,infinity},\n {ram_msg_count,0},\n {ram_ack_count,0},\n {ram_index_count,0},\n {next_seq_id,0},\n {persistent_count,0},\n {avg_ingress_rate,0.0},\n {avg_egress_rate,0.0},\n {avg_ack_ingress_rate,0.0},\n {avg_ack_egress_rate,0.0}]}},\n {name,<<\"acme.Product.foo-Staging4\">>},\n {vhost,<<\"/\">>},\n {durable,true},\n {auto_delete,false},\n {arguments,{struct,[]}},\n {node,rabbit at acme388}],\n [{memory,9872},\n {idle_since,<<\"2011-7-19 19:53:14\">>},\n {exclusive_consumer_pid,''},\n {exclusive_consumer_tag,''},\n {messages_ready,0},\n {messages_unacknowledged,0},\n {messages,0},\n {consumers,1},\n {backing_queue_status,\n {struct,\n [{q1,0},\n {q2,0},\n {delta,[delta,undefined,0,undefined]},\n {q3,0},\n {q4,0},\n {len,0},\n {pending_acks,0},\n {outstanding_txns,0},\n {target_ram_count,infinity},\n {ram_msg_count,0},\n {ram_ack_count,0},\n {ram_index_count,0},\n {next_seq_id,0},\n {persistent_count,0},\n {avg_ingress_rate,0.0},\n {avg_egress_rate,0.0},\n {avg_ack_ingress_rate,0.0},\n {avg_ack_egress_rate,0.0}]}},\n {name,<<\"acme.Product.foo-Staging6\">>},\n {vhost,<<\"/\">>},\n {durable,true},\n {auto_delete,false},\n {arguments,{struct,[]}},\n {node,rabbit at acme388}],\n [{memory,9368},\n {idle_since,<<\"2011-7-19 14:12:24\">>},\n {exclusive_consumer_pid,''},\n {exclusive_consumer_tag,''},\n {messages_ready,0},\n {messages_unacknowledged,0},\n {messages,0},\n {consumers,0},\n {backing_queue_status,\n {struct,\n [{q1,0},\n {q2,0},\n {delta,[delta,undefined,0,undefined]},\n {q3,0},\n {q4,0},\n {len,0},\n {pending_acks,0},\n {outstanding_txns,0},\n {target_ram_count,infinity},\n {ram_msg_count,0},\n {ram_ack_count,0},\n {ram_index_count,0},\n {next_seq_id,0},\n {persistent_count,0},\n {avg_ingress_rate,0.0},\n {avg_egress_rate,0.0},\n {avg_ack_ingress_rate,0.0},\n {avg_ack_egress_rate,0.0}]}},\n {name,<<\"acme.Strategy.foo-IntTest\">>},\n {vhost,<<\"/\">>},\n {durable,true},\n {auto_delete,false},\n {arguments,{struct,[]}},\n {node,rabbit at acme388}],\n [{memory,9856},\n {idle_since,<<\"2011-7-19 19:53:14\">>},\n {exclusive_consumer_pid,''},\n {exclusive_consumer_tag,''},\n {messages_ready,0},\n {messages_unacknowledged,0},\n {messages,0},\n {consumers,1},\n {backing_queue_status,\n {struct,\n [{q1,0},\n {q2,0},\n {delta,[delta,undefined,0,undefined]},\n {q3,0},\n {q4,0},\n {len,0},\n {pending_acks,0},\n {outstanding_txns,0},\n {target_ram_count,infinity},\n {ram_msg_count,0},\n {ram_ack_count,0},\n {ram_index_count,0},\n {next_seq_id,0},\n {persistent_count,0},\n {avg_ingress_rate,0.0},\n {avg_egress_rate,0.0},\n {avg_ack_ingress_rate,0.0},\n {avg_ack_egress_rate,0.0}]}},\n {name,<<\"acme.Strategy.foo-Staging4\">>},\n {vhost,<<\"/\">>},\n {durable,true},\n {auto_delete,false},\n {arguments,{struct,[]}},\n {node,rabbit at acme388}],\n [{memory,9840},\n {idle_since,<<\"2011-7-19 19:53:15\">>},\n {exclusive_consumer_pid,''},\n {exclusive_consumer_tag,''},\n {messages_ready,0},\n {messages_unacknowledged,0},\n {messages,0},\n {consumers,1},\n {backing_queue_status,\n {struct,\n [{q1,0},\n {q2,0},\n {delta,[delta,undefined,0,undefined]},\n {q3,0},\n {q4,0},\n {len,0},\n {pending_acks,0},\n {outstanding_txns,0},\n {target_ram_count,infinity},\n {ram_msg_count,0},\n {ram_ack_count,0},\n {ram_index_count,0},\n {next_seq_id,0},\n {persistent_count,0},\n {avg_ingress_rate,0.0},\n {avg_egress_rate,0.0},\n {avg_ack_ingress_rate,0.0},\n {avg_ack_egress_rate,0.0}]}},\n {name,<<\"acme.Strategy.foo-Staging6\">>},\n {vhost,<<\"/\">>},\n {durable,true},\n {auto_delete,false},\n {arguments,{struct,[]}},\n {node,rabbit at acme388}],\n [{memory,9368},\n {idle_since,<<\"2011-7-19 14:12:23\">>},\n {exclusive_consumer_pid,''},\n {exclusive_consumer_tag,''},\n {messages_ready,0},\n {messages_unacknowledged,0},\n {messages,0},\n {consumers,0},\n {backing_queue_status,\n {struct,\n [{q1,0},\n {q2,0},\n {delta,[delta,undefined,0,undefined]},\n {q3,0},\n {q4,0},\n {len,0},\n {pending_acks,0},\n {outstanding_txns,0},\n {target_ram_count,infinity},\n {ram_msg_count,0},\n {ram_ack_count,0},\n {ram_index_count,0},\n {next_seq_id,0},\n {persistent_count,0},\n {avg_ingress_rate,0.0},\n {avg_egress_rate,0.0},\n {avg_ack_ingress_rate,0.0},\n {avg_ack_egress_rate,0.0}]}},\n {name,<<\"acme.Transaction.foo-IntTest\">>},\n {vhost,<<\"/\">>},\n {durable,true},\n {auto_delete,false},\n {arguments,{struct,[]}},\n {node,rabbit at acme388}],\n [{memory,9840},\n {idle_since,<<\"2011-7-19 19:53:14\">>},\n {exclusive_consumer_pid,''},\n {exclusive_consumer_tag,''},\n {messages_ready,0},\n {messages_unacknowledged,0},\n {messages,0},\n {consumers,1},\n {backing_queue_status,\n {struct,\n [{q1,0},\n {q2,0},\n {delta,[delta,undefined,0,undefined]},\n {q3,0},\n {q4,0},\n {len,0},\n {pending_acks,0},\n {outstanding_txns,0},\n {target_ram_count,infinity},\n {ram_msg_count,0},\n {ram_ack_count,0},\n {ram_index_count,0},\n {next_seq_id,0},\n {persistent_count,0},\n {avg_ingress_rate,0.0},\n {avg_egress_rate,0.0},\n {avg_ack_ingress_rate,0.0},\n {avg_ack_egress_rate,0.0}]}},\n {name,<<\"acme.Transaction.foo-Staging4\">>},\n {vhost,<<\"/\">>},\n {durable,true},\n {auto_delete,false},\n {arguments,{struct,[]}},\n {node,rabbit at acme388}],\n [{memory,9840},\n {idle_since,<<\"2011-7-19 19:53:14\">>},\n {exclusive_consumer_pid,''},\n {exclusive_consumer_tag,''},\n {messages_ready,0},\n {messages_unacknowledged,0},\n {messages,0},\n {consumers,1},\n {backing_queue_status,\n {struct,\n [{q1,0},\n {q2,0},\n {delta,[delta,undefined,0,undefined]},\n {q3,0},\n {q4,0},\n {len,0},\n {pending_acks,0},\n {outstanding_txns,0},\n {target_ram_count,infinity},\n {ram_msg_count,0},\n {ram_ack_count,0},\n {ram_index_count,0},\n {next_seq_id,0},\n {persistent_count,0},\n {avg_ingress_rate,0.0},\n {avg_egress_rate,0.0},\n {avg_ack_ingress_rate,0.0},\n {avg_ack_egress_rate,0.0}]}},\n {name,<<\"acme.Transaction.foo-Staging6\">>},\n {vhost,<<\"/\">>},\n {durable,true},\n {auto_delete,false},\n {arguments,{struct,[]}},\n {node,rabbit at acme388}],\n [{memory,10280},\n {idle_since,<<\"2011-7-19 20:2:10\">>},\n {exclusive_consumer_pid,''},\n {exclusive_consumer_tag,''},\n {messages_ready,0},\n {messages_unacknowledged,0},\n {messages,0},\n {consumers,2},\n {backing_queue_status,\n {struct,\n [{q1,0},\n {q2,0},\n {delta,[delta,undefined,0,undefined]},\n {q3,0},\n {q4,0},\n {len,0},\n {pending_acks,0},\n {outstanding_txns,0},\n {target_ram_count,infinity},\n {ram_msg_count,0},\n {ram_ack_count,0},\n {ram_index_count,0},\n {next_seq_id,0},\n {persistent_count,0},\n {avg_ingress_rate,0.0},\n {avg_egress_rate,0.0},\n {avg_ack_ingress_rate,0.0},\n {avg_ack_egress_rate,0.0}]}},\n {name,<<\"acme.Transaction.Diffa-MTM-foo-Staging4\">>},\n {vhost,<<\"/\">>},\n {durable,true},\n {auto_delete,false},\n {arguments,{struct,[]}},\n {node,rabbit at acme388}],\n [{memory,10280},\n {idle_since,<<\"2011-7-19 20:2:9\">>},\n {exclusive_consumer_pid,''},\n {exclusive_consumer_tag,''},\n {messages_ready,0},\n {messages_unacknowledged,0},\n {messages,0},\n {consumers,2},\n {backing_queue_status,\n {struct,\n [{q1,0},\n {q2,0},\n {delta,[delta,undefined,0,undefined]},\n {q3,0},\n {q4,0},\n {len,0},\n {pending_acks,0},\n {outstanding_txns,0},\n {target_ram_count,infinity},\n {ram_msg_count,0},\n {ram_ack_count,0},\n {ram_index_count,0},\n {next_seq_id,0},\n {persistent_count,0},\n {avg_ingress_rate,0.0},\n {avg_egress_rate,0.0},\n {avg_ack_ingress_rate,0.0},\n {avg_ack_egress_rate,0.0}]}},\n {name,<<\"acme.Transaction.Diffa-MTM-foo-Staging6\">>},\n {vhost,<<\"/\">>},\n {durable,true},\n {auto_delete,false},\n {arguments,{struct,[]}},\n {node,rabbit at acme388}],\n [{memory,11344},\n {idle_since,<<\"2011-7-11 17:45:17\">>},\n {exclusive_consumer_pid,''},\n {exclusive_consumer_tag,''},\n {messages_ready,0},\n {messages_unacknowledged,0},\n {messages,0},\n {consumers,0},\n {backing_queue_status,\n {struct,\n [{q1,0},\n {q2,0},\n {delta,[delta,0,0,0]},\n {q3,0},\n {q4,0},\n {len,0},\n {pending_acks,0},\n {outstanding_txns,0},\n {target_ram_count,infinity},\n {ram_msg_count,0},\n {ram_ack_count,0},\n {ram_index_count,0},\n {next_seq_id,0},\n {persistent_count,0},\n {avg_ingress_rate,0.0},\n {avg_egress_rate,0.0},\n {avg_ack_ingress_rate,0.0},\n {avg_ack_egress_rate,0.0}]}},\n {name,\n <<\"acme.UploadStatus.MTM.LON-EDhoodLT.ben.hood.KFQbK9yWN0-t4c7ApFgPiQ\">>},\n {vhost,<<\"/\">>},\n {durable,true},\n {auto_delete,true},\n {arguments,{struct,[]}},\n {node,rabbit at acme388}],\n [{memory,11344},\n {idle_since,<<\"2011-7-11 17:45:17\">>},\n {exclusive_consumer_pid,''},\n {exclusive_consumer_tag,''},\n {messages_ready,0},\n {messages_unacknowledged,0},\n {messages,0},\n {consumers,0},\n {backing_queue_status,\n {struct,\n [{q1,0},\n {q2,0},\n {delta,[delta,0,0,0]},\n {q3,0},\n {q4,0},\n {len,0},\n {pending_acks,0},\n {outstanding_txns,0},\n {target_ram_count,infinity},\n {ram_msg_count,0},\n {ram_ack_count,0},\n {ram_index_count,0},\n {next_seq_id,0},\n {persistent_count,0},\n {avg_ingress_rate,0.0},\n {avg_egress_rate,0.0},\n {avg_ack_ingress_rate,0.0},\n {avg_ack_egress_rate,0.0}]}},\n {name,\n <<\"acme.UploadStatus.MTM.LON-EDhoodLT.ben.hood.a6cxkRwQBkybIPreuaZ97A\">>},\n {vhost,<<\"/\">>},\n {durable,true},\n {auto_delete,true},\n {arguments,{struct,[]}},\n {node,rabbit at acme388}],\n [{memory,12288},\n {idle_since,<<\"2011-7-13 11:48:7\">>},\n {exclusive_consumer_pid,''},\n {exclusive_consumer_tag,''},\n {messages_ready,0},\n {messages_unacknowledged,0},\n {messages,0},\n {consumers,1},\n {backing_queue_status,\n {struct,\n [{q1,0},\n {q2,0},\n {delta,[delta,undefined,0,undefined]},\n {q3,0},\n {q4,0},\n {len,0},\n {pending_acks,0},\n {outstanding_txns,0},\n {target_ram_count,infinity},\n {ram_msg_count,0},\n {ram_ack_count,0},\n {ram_index_count,0},\n {next_seq_id,91298},\n {persistent_count,0},\n {avg_ingress_rate,0.0},\n {avg_egress_rate,0.0},\n {avg_ack_ingress_rate,0.0},\n {avg_ack_egress_rate,0.0}]}},\n {message_stats,\n [{ack,91298},\n {ack_details,[{rate,0},{interval,8182949},{last_event,1310554057355}]},\n {deliver,91298},\n {deliver_details,\n [{rate,0},{interval,8182949},{last_event,1310554057355}]},\n {deliver_get,91298},\n {deliver_get_details,\n [{rate,0},{interval,8182949},{last_event,1310554057355}]}]},\n {name,\n <<\"acme.UploadStatus.MTM.LSHIFT1.ben.hood.0DVhex9Lr0iFyj7Y4bFA9A\">>},\n {vhost,<<\"/\">>},\n {durable,true},\n {auto_delete,true},\n {arguments,{struct,[]}},\n {node,rabbit at acme388}],\n [{memory,9904},\n {idle_since,<<\"2011-7-19 20:6:15\">>},\n {exclusive_consumer_pid,''},\n {exclusive_consumer_tag,''},\n {messages_ready,0},\n {messages_unacknowledged,0},\n {messages,0},\n {consumers,1},\n {backing_queue_status,\n {struct,\n [{q1,0},\n {q2,0},\n {delta,[delta,undefined,0,undefined]},\n {q3,0},\n {q4,0},\n {len,0},\n {pending_acks,0},\n {outstanding_txns,0},\n {target_ram_count,infinity},\n {ram_msg_count,0},\n {ram_ack_count,0},\n {ram_index_count,0},\n {next_seq_id,0},\n {persistent_count,0},\n {avg_ingress_rate,0.0},\n {avg_egress_rate,0.0},\n {avg_ack_ingress_rate,0.0},\n {avg_ack_egress_rate,0.0}]}},\n {name,\n <<\"acme.UploadStatus.MTM.LSHIFT1.ben.hood.P0ApXIPTo0Of4JVCsXBC0A\">>},\n {vhost,<<\"/\">>},\n {durable,true},\n {auto_delete,true},\n {arguments,{struct,[]}},\n {node,rabbit at acme388}],\n [{memory,9360},\n {idle_since,<<\"2011-7-19 14:12:24\">>},\n {exclusive_consumer_pid,''},\n {exclusive_consumer_tag,''},\n {messages_ready,0},\n {messages_unacknowledged,0},\n {messages,0},\n {consumers,0},\n {backing_queue_status,\n {struct,\n [{q1,0},\n {q2,0},\n {delta,[delta,undefined,0,undefined]},\n {q3,0},\n {q4,0},\n {len,0},\n {pending_acks,0},\n {outstanding_txns,0},\n {target_ram_count,infinity},\n {ram_msg_count,0},\n {ram_ack_count,0},\n {ram_index_count,0},\n {next_seq_id,0},\n {persistent_count,0},\n {avg_ingress_rate,0.0},\n {avg_egress_rate,0.0},\n {avg_ack_ingress_rate,0.0},\n {avg_ack_egress_rate,0.0}]}},\n {name,<<\"acme.Vessel.foo-IntTest\">>},\n {vhost,<<\"/\">>},\n {durable,true},\n {auto_delete,false},\n {arguments,{struct,[]}},\n {node,rabbit at acme388}],\n [{memory,9832},\n {idle_since,<<\"2011-7-19 19:53:14\">>},\n {exclusive_consumer_pid,''},\n {exclusive_consumer_tag,''},\n {messages_ready,0},\n {messages_unacknowledged,0},\n {messages,0},\n {consumers,1},\n {backing_queue_status,\n {struct,\n [{q1,0},\n {q2,0},\n {delta,[delta,undefined,0,undefined]},\n {q3,0},\n {q4,0},\n {len,0},\n {pending_acks,0},\n {outstanding_txns,0},\n {target_ram_count,infinity},\n {ram_msg_count,0},\n {ram_ack_count,0},\n {ram_index_count,0},\n {next_seq_id,0},\n {persistent_count,0},\n {avg_ingress_rate,0.0},\n {avg_egress_rate,0.0},\n {avg_ack_ingress_rate,0.0},\n {avg_ack_egress_rate,0.0}]}},\n {name,<<\"acme.Vessel.foo-Staging4\">>},\n {vhost,<<\"/\">>},\n {durable,true},\n {auto_delete,false},\n {arguments,{struct,[]}},\n {node,rabbit at acme388}],\n [{memory,9832},\n {idle_since,<<\"2011-7-19 19:53:15\">>},\n {exclusive_consumer_pid,''},\n {exclusive_consumer_tag,''},\n {messages_ready,0},\n {messages_unacknowledged,0},\n {messages,0},\n {consumers,1},\n {backing_queue_status,\n {struct,\n [{q1,0},\n {q2,0},\n {delta,[delta,undefined,0,undefined]},\n {q3,0},\n {q4,0},\n {len,0},\n {pending_acks,0},\n {outstanding_txns,0},\n {target_ram_count,infinity},\n {ram_msg_count,0},\n {ram_ack_count,0},\n {ram_index_count,0},\n {next_seq_id,0},\n {persistent_count,0},\n {avg_ingress_rate,0.0},\n {avg_egress_rate,0.0},\n {avg_ack_ingress_rate,0.0},\n {avg_ack_egress_rate,0.0}]}},\n {name,<<\"acme.Vessel.foo-Staging6\">>},\n {vhost,<<\"/\">>},\n {durable,true},\n {auto_delete,false},\n {arguments,{struct,[]}},\n {node,rabbit at acme388}],\n [{memory,7608},\n {owner_pid_details,\n [{name,<<\"172.20.8.229:53773\">>},\n {peer_address,<<\"172.20.8.229\">>},\n {peer_port,53773}]},\n {idle_since,<<\"2011-7-19 19:39:6\">>},\n {exclusive_consumer_pid,''},\n {exclusive_consumer_tag,''},\n {messages_ready,0},\n {messages_unacknowledged,0},\n {messages,0},\n {consumers,1},\n {backing_queue_status,\n {struct,\n [{q1,0},\n {q2,0},\n {delta,[delta,undefined,0,undefined]},\n {q3,0},\n {q4,0},\n {len,0},\n {pending_acks,0},\n {outstanding_txns,0},\n {target_ram_count,infinity},\n {ram_msg_count,0},\n {ram_ack_count,0},\n {ram_index_count,0},\n {next_seq_id,0},\n {persistent_count,0},\n {avg_ingress_rate,0.0},\n {avg_egress_rate,0.0},\n {avg_ack_ingress_rate,0.0},\n {avg_ack_egress_rate,0.0}]}},\n {name,<<\"amq.gen-2Ow0enDUpYAc5wniNJxJ0A==\">>},\n {vhost,<<\"/\">>},\n {durable,false},\n {auto_delete,true},\n {arguments,{struct,[]}},\n {node,rabbit at acme388}],\n [{memory,7976},\n {owner_pid_details,\n [{name,<<\"172.20.8.227:44273\">>},\n {peer_address,<<\"172.20.8.227\">>},\n {peer_port,44273}]},\n {idle_since,<<\"2011-7-19 20:2:8\">>},\n {exclusive_consumer_pid,''},\n {exclusive_consumer_tag,''},\n {messages_ready,0},\n {messages_unacknowledged,0},\n {messages,0},\n {consumers,1},\n {backing_queue_status,\n {struct,\n [{q1,0},\n {q2,0},\n {delta,[delta,undefined,0,undefined]},\n {q3,0},\n {q4,0},\n {len,0},\n {pending_acks,0},\n {outstanding_txns,0},\n {target_ram_count,infinity},\n {ram_msg_count,0},\n {ram_ack_count,0},\n {ram_index_count,0},\n {next_seq_id,4},\n {persistent_count,0},\n {avg_ingress_rate,0.0041024162641047635},\n {avg_egress_rate,0.0041024162641047635},\n {avg_ack_ingress_rate,0.0041024162641047635},\n {avg_ack_egress_rate,0.0041024162641047635}]}},\n {message_stats,\n [{ack,4},\n {ack_details,[{rate,0},{interval,45154021},{last_event,1311102128160}]},\n {deliver,4},\n {deliver_details,\n [{rate,0},{interval,45154021},{last_event,1311102128160}]},\n {deliver_get,4},\n {deliver_get_details,\n [{rate,0},{interval,45154021},{last_event,1311102128160}]}]},\n {name,<<\"amq.gen-V+EbuNSjBUiHVoqJ0di0ZQ==\">>},\n {vhost,<<\"/\">>},\n {durable,false},\n {auto_delete,true},\n {arguments,{struct,[]}},\n {node,rabbit at acme388}],\n [{memory,7608},\n {owner_pid_details,\n [{name,<<\"172.20.8.229:53772\">>},\n {peer_address,<<\"172.20.8.229\">>},\n {peer_port,53772}]},\n {idle_since,<<\"2011-7-19 19:39:6\">>},\n {exclusive_consumer_pid,''},\n {exclusive_consumer_tag,''},\n {messages_ready,0},\n {messages_unacknowledged,0},\n {messages,0},\n {consumers,1},\n {backing_queue_status,\n {struct,\n [{q1,0},\n {q2,0},\n {delta,[delta,undefined,0,undefined]},\n {q3,0},\n {q4,0},\n {len,0},\n {pending_acks,0},\n {outstanding_txns,0},\n {target_ram_count,infinity},\n {ram_msg_count,0},\n {ram_ack_count,0},\n {ram_index_count,0},\n {next_seq_id,0},\n {persistent_count,0},\n {avg_ingress_rate,0.0},\n {avg_egress_rate,0.0},\n {avg_ack_ingress_rate,0.0},\n {avg_ack_egress_rate,0.0}]}},\n {name,<<\"amq.gen-ZdGp8Sw29MwMHXdFGI8Pdg==\">>},\n {vhost,<<\"/\">>},\n {durable,false},\n {auto_delete,true},\n {arguments,{struct,[]}},\n {node,rabbit at acme388}],\n [{memory,7640},\n {owner_pid_details,\n [{name,<<\"172.20.8.229:53771\">>},\n {peer_address,<<\"172.20.8.229\">>},\n {peer_port,53771}]},\n {idle_since,<<\"2011-7-19 19:39:6\">>},\n {exclusive_consumer_pid,''},\n {exclusive_consumer_tag,''},\n {messages_ready,0},\n {messages_unacknowledged,0},\n {messages,0},\n {consumers,1},\n {backing_queue_status,\n {struct,\n [{q1,0},\n {q2,0},\n {delta,[delta,undefined,0,undefined]},\n {q3,0},\n {q4,0},\n {len,0},\n {pending_acks,0},\n {outstanding_txns,0},\n {target_ram_count,infinity},\n {ram_msg_count,0},\n {ram_ack_count,0},\n {ram_index_count,0},\n {next_seq_id,0},\n {persistent_count,0},\n {avg_ingress_rate,0.0},\n {avg_egress_rate,0.0},\n {avg_ack_ingress_rate,0.0},\n {avg_ack_egress_rate,0.0}]}},\n {name,<<\"amq.gen-jYCvIgzY3IgH1uFprQs39Q==\">>},\n {vhost,<<\"/\">>},\n {durable,false},\n {auto_delete,true},\n {arguments,{struct,[]}},\n {node,rabbit at acme388}]]"}
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Rabbit Management Screenshot.png
Type: image/png
Size: 147995 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110720/5f8347fe/attachment.png>

From matthias at rabbitmq.com  Wed Jul 20 09:39:41 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 20 Jul 2011 09:39:41 +0100
Subject: [rabbitmq-discuss] Management Plugin
In-Reply-To: <CAB-G1jiySPJ3ZS4Y=19WCOBHgfNuRehL2pYH5BL5gD-M2tKOoA@mail.gmail.com>
References: <CAB-G1jiySPJ3ZS4Y=19WCOBHgfNuRehL2pYH5BL5gD-M2tKOoA@mail.gmail.com>
Message-ID: <4E26944D.10903@rabbitmq.com>

Ben,

On 20/07/11 09:32, Ben Hood wrote:
> I've come across an issue with the queues page in
> the management plugin

Congratulations, you've found a bug. It's tripping over an exclusive 
consumer. I suspect very few apps have these, which is why this has gone 
unnoticed.


Matthias.

From 0x6e6562 at gmail.com  Wed Jul 20 09:44:04 2011
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 20 Jul 2011 09:44:04 +0100
Subject: [rabbitmq-discuss] Management Plugin
In-Reply-To: <4E26944D.10903@rabbitmq.com>
References: <CAB-G1jiySPJ3ZS4Y=19WCOBHgfNuRehL2pYH5BL5gD-M2tKOoA@mail.gmail.com>
	<4E26944D.10903@rabbitmq.com>
Message-ID: <CAB-G1jgv3q2kV851jvx2wGi+Eab3_T55Tbu+zgV=vaE1ApH5uA@mail.gmail.com>

Matthias,

On Wed, Jul 20, 2011 at 9:39 AM, Matthias Radestock
<matthias at rabbitmq.com> wrote:
> Congratulations, you've found a bug. It's tripping over an exclusive
> consumer. I suspect very few apps have these, which is why this has gone
> unnoticed.

In case it helps, I've managed to convince the friendly sysads to give
me the log (please find attached).

Cheers,

Ben

PS (Minor feature request) Would you consider making the Rabbit log
file downloadable via the management UI?
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit at acme388.log
Type: application/octet-stream
Size: 73110 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110720/f82e4840/attachment.obj>

From stammailbox at gmail.com  Wed Jul 20 10:04:08 2011
From: stammailbox at gmail.com (mysurf mail)
Date: Wed, 20 Jul 2011 12:04:08 +0300
Subject: [rabbitmq-discuss] management plugin
Message-ID: <CAJ2-VrkLPy5QxCMbQJZNv-y4P8cOt05P=fqsSpOAJQN5bQ3Abw@mail.gmail.com>

Hi,
I am trying to install the management plugin, and I keep getting
Boot Error: Could not add boot step dependency of rabbit_management_database
on recovery

Is that because I am running 2.3.1 version. Is there a management plugins
history page for 2.3.1?
Thank you.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110720/ca7342a0/attachment.htm>

From simon at rabbitmq.com  Wed Jul 20 11:12:05 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 20 Jul 2011 11:12:05 +0100
Subject: [rabbitmq-discuss] management plugin
In-Reply-To: <CAJ2-VrkLPy5QxCMbQJZNv-y4P8cOt05P=fqsSpOAJQN5bQ3Abw@mail.gmail.com>
References: <CAJ2-VrkLPy5QxCMbQJZNv-y4P8cOt05P=fqsSpOAJQN5bQ3Abw@mail.gmail.com>
Message-ID: <4E26A9F5.4040505@rabbitmq.com>

On 20/07/11 10:04, mysurf mail wrote:
> Hi,
> I am trying to install the management plugin, and I keep getting
> Boot Error: Could not add boot step dependency of
> rabbit_management_database on recovery
>
> Is that because I am running 2.3.1 version. Is there a management
> plugins history page for 2.3.1?
> Thank you.

Yeah, the plugins versions are closely tied to the server versions. You 
can get the plugins for 2.3.1 here:

http://www.rabbitmq.com/releases/plugins/v2.3.1/

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From 0x6e6562 at gmail.com  Wed Jul 20 11:13:10 2011
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 20 Jul 2011 11:13:10 +0100
Subject: [rabbitmq-discuss] Management Plugin
In-Reply-To: <CAB-G1jgv3q2kV851jvx2wGi+Eab3_T55Tbu+zgV=vaE1ApH5uA@mail.gmail.com>
References: <CAB-G1jiySPJ3ZS4Y=19WCOBHgfNuRehL2pYH5BL5gD-M2tKOoA@mail.gmail.com>
	<4E26944D.10903@rabbitmq.com>
	<CAB-G1jgv3q2kV851jvx2wGi+Eab3_T55Tbu+zgV=vaE1ApH5uA@mail.gmail.com>
Message-ID: <CAB-G1jiJ6kp229WM4-s7Eg3=VGyMMUPZTDE6nQz2vAi47Fh8xg@mail.gmail.com>

Matthias,

On Wed, Jul 20, 2011 at 9:44 AM, Ben Hood <0x6e6562 at gmail.com> wrote:
> On Wed, Jul 20, 2011 at 9:39 AM, Matthias Radestock
> <matthias at rabbitmq.com> wrote:
>> Congratulations, you've found a bug. It's tripping over an exclusive
>> consumer. I suspect very few apps have these, which is why this has gone
>> unnoticed.

FWIW our test environment is using 2.3.1 and our staging environment
is using 2.4.1. Production, OTOH, is using 2.5.1, which is where we
saw this issue. So this is potentially a regression that has occurred
on the 2.5.x series.

Cheers,

Ben

From simon at rabbitmq.com  Wed Jul 20 11:13:53 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 20 Jul 2011 11:13:53 +0100
Subject: [rabbitmq-discuss] STOMP plugin and virtual hosts
In-Reply-To: <4E263CB5.6010702@strategicdata.com.au>
References: <4E25547B.3080606@strategicdata.com.au>	<4E255FFB.5090703@rabbitmq.com>	<4E263379.4010808@strategicdata.com.au>
	<4E263CB5.6010702@strategicdata.com.au>
Message-ID: <4E26AA61.5030705@rabbitmq.com>

On 20/07/11 03:25, Toby Corkindale wrote:
>
> It seems like there's been some good activity on CPAN in just the last
> few months - I just discovered Net::STOMP::Client, which implements
> STOMP 1.1, and Net::RabbitMQ (which uses AMQP).

FTR the current STOMP plugin doesn't treat 1.1 as very different from 
1.0 (since 1.1 is almost entirely a tightening-up and clarification) so 
if you can persuade your client to set a host header on CONNECT with 
1.0, you should be good.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed Jul 20 12:13:45 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 20 Jul 2011 12:13:45 +0100
Subject: [rabbitmq-discuss] Management Plugin
In-Reply-To: <CAB-G1jiJ6kp229WM4-s7Eg3=VGyMMUPZTDE6nQz2vAi47Fh8xg@mail.gmail.com>
References: <CAB-G1jiySPJ3ZS4Y=19WCOBHgfNuRehL2pYH5BL5gD-M2tKOoA@mail.gmail.com>	<4E26944D.10903@rabbitmq.com>	<CAB-G1jgv3q2kV851jvx2wGi+Eab3_T55Tbu+zgV=vaE1ApH5uA@mail.gmail.com>
	<CAB-G1jiJ6kp229WM4-s7Eg3=VGyMMUPZTDE6nQz2vAi47Fh8xg@mail.gmail.com>
Message-ID: <4E26B869.8090203@rabbitmq.com>

On 20/07/11 11:13, Ben Hood wrote:
> FWIW our test environment is using 2.3.1 and our staging environment
> is using 2.4.1. Production, OTOH, is using 2.5.1, which is where we
> saw this issue. So this is potentially a regression that has occurred
> on the 2.5.x series.

Yeah, that's exactly right. The regression was introduced in 2.5.0.

I've put a patched version of the plugin here; this will also be fixed 
in the next release:

http://www.rabbitmq.com/releases/plugins/v2.5.1/rabbitmq_management-2.5.1-exclusive-consumer-fix.ez

Cheers, Simon
-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed Jul 20 12:54:25 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 20 Jul 2011 12:54:25 +0100
Subject: [rabbitmq-discuss] Management Plugin
In-Reply-To: <CAB-G1jgv3q2kV851jvx2wGi+Eab3_T55Tbu+zgV=vaE1ApH5uA@mail.gmail.com>
References: <CAB-G1jiySPJ3ZS4Y=19WCOBHgfNuRehL2pYH5BL5gD-M2tKOoA@mail.gmail.com>	<4E26944D.10903@rabbitmq.com>
	<CAB-G1jgv3q2kV851jvx2wGi+Eab3_T55Tbu+zgV=vaE1ApH5uA@mail.gmail.com>
Message-ID: <4E26C1F1.2060801@rabbitmq.com>

On 20/07/11 09:44, Ben Hood wrote:
> PS (Minor feature request) Would you consider making the Rabbit log
> file downloadable via the management UI?

There are a few issues:

1) The web server we use would not be great at streaming large files 
without a bunch of work

2) ATM the management plugin doesn't make much distinction between the 
node it's running on and any other nodes. We'd have to relax this for 
log files, or copy logs across the cluster (ugh!).

3) I'm not sure how many people would use it. Hopefully the number of 
people suffering from helpful corporate standards would be quite low.

Still, I'll file a bug.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From 0x6e6562 at gmail.com  Wed Jul 20 13:25:14 2011
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 20 Jul 2011 13:25:14 +0100
Subject: [rabbitmq-discuss] Management Plugin
In-Reply-To: <4E26B869.8090203@rabbitmq.com>
References: <CAB-G1jiySPJ3ZS4Y=19WCOBHgfNuRehL2pYH5BL5gD-M2tKOoA@mail.gmail.com>
	<4E26944D.10903@rabbitmq.com>
	<CAB-G1jgv3q2kV851jvx2wGi+Eab3_T55Tbu+zgV=vaE1ApH5uA@mail.gmail.com>
	<CAB-G1jiJ6kp229WM4-s7Eg3=VGyMMUPZTDE6nQz2vAi47Fh8xg@mail.gmail.com>
	<4E26B869.8090203@rabbitmq.com>
Message-ID: <CAB-G1jgY7VSU81RUUODp8ZNzod+SCn+PPFMpRYJvbBFKrYz=aw@mail.gmail.com>

Simon,

On Wed, Jul 20, 2011 at 12:13 PM, Simon MacMullen <simon at rabbitmq.com> wrote:
> I've put a patched version of the plugin here; this will also be fixed in
> the next release:
>
> http://www.rabbitmq.com/releases/plugins/v2.5.1/rabbitmq_management-2.5.1-exclusive-consumer-fix.ez

Cool, thanks for this. Do I just drop this into the plugins dir, or
does it need to replace one the existing archives?

For note, this is what I've currently got:

[ben.hood at acme388 ~]$ ls -l /usr/lib/rabbitmq/lib/rabbitmq_server-2.5.1/plugins/
total 888
-rw-r--r-- 1 root root 160661 Jul  6 16:55 amqp_client-2.5.1.ez
-rw-r--r-- 1 root root 211883 Jul  6 16:55 mochiweb-1.3-rmq2.5.1-git9a53dbd.ez
-rw-r--r-- 1 root root 335037 Jul  6 16:55 rabbitmq_management-2.5.1.ez
-rw-r--r-- 1 root root  14704 Jul  6 16:55 rabbitmq_management_agent-2.5.1.ez
-rw-r--r-- 1 root root  23711 Jul  6 16:55 rabbitmq_mochiweb-2.5.1.ez
-rw-r--r-- 1 root root     45 Jun 27 11:28 README
-rw-r--r-- 1 root root 131472 Jul  6 16:55
webmachine-1.7.0-rmq2.5.1-hg0c4b60a.ez

Cheers,

Ben

From 0x6e6562 at gmail.com  Wed Jul 20 13:26:08 2011
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 20 Jul 2011 13:26:08 +0100
Subject: [rabbitmq-discuss] Management Plugin
In-Reply-To: <4E26C1F1.2060801@rabbitmq.com>
References: <CAB-G1jiySPJ3ZS4Y=19WCOBHgfNuRehL2pYH5BL5gD-M2tKOoA@mail.gmail.com>
	<4E26944D.10903@rabbitmq.com>
	<CAB-G1jgv3q2kV851jvx2wGi+Eab3_T55Tbu+zgV=vaE1ApH5uA@mail.gmail.com>
	<4E26C1F1.2060801@rabbitmq.com>
Message-ID: <CAB-G1jgsC7iDqB0fDNd7x2vxOP36od=P1FfCrHHTr+vCewvz_A@mail.gmail.com>

Simon,

On Wed, Jul 20, 2011 at 12:54 PM, Simon MacMullen <simon at rabbitmq.com> wrote:
>
> 1) The web server we use would not be great at streaming large files without
> a bunch of work
>
> 2) ATM the management plugin doesn't make much distinction between the node
> it's running on and any other nodes. We'd have to relax this for log files,
> or copy logs across the cluster (ugh!).
>
> 3) I'm not sure how many people would use it. Hopefully the number of people
> suffering from helpful corporate standards would be quite low.
>
> Still, I'll file a bug.


Fair point. On balance it looks like the cost outweighs the benefit.

Cheers,

Ben
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From simon at rabbitmq.com  Wed Jul 20 13:26:45 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 20 Jul 2011 13:26:45 +0100
Subject: [rabbitmq-discuss] Management Plugin
In-Reply-To: <CAB-G1jgY7VSU81RUUODp8ZNzod+SCn+PPFMpRYJvbBFKrYz=aw@mail.gmail.com>
References: <CAB-G1jiySPJ3ZS4Y=19WCOBHgfNuRehL2pYH5BL5gD-M2tKOoA@mail.gmail.com>	<4E26944D.10903@rabbitmq.com>	<CAB-G1jgv3q2kV851jvx2wGi+Eab3_T55Tbu+zgV=vaE1ApH5uA@mail.gmail.com>	<CAB-G1jiJ6kp229WM4-s7Eg3=VGyMMUPZTDE6nQz2vAi47Fh8xg@mail.gmail.com>	<4E26B869.8090203@rabbitmq.com>
	<CAB-G1jgY7VSU81RUUODp8ZNzod+SCn+PPFMpRYJvbBFKrYz=aw@mail.gmail.com>
Message-ID: <4E26C985.5020209@rabbitmq.com>

On 20/07/11 13:25, Ben Hood wrote:
> Simon,
>
> On Wed, Jul 20, 2011 at 12:13 PM, Simon MacMullen<simon at rabbitmq.com>  wrote:
>> I've put a patched version of the plugin here; this will also be fixed in
>> the next release:
>>
>> http://www.rabbitmq.com/releases/plugins/v2.5.1/rabbitmq_management-2.5.1-exclusive-consumer-fix.ez
>
> Cool, thanks for this. Do I just drop this into the plugins dir, or
> does it need to replace one the existing archives?

Ah, yes. It replaces rabbitmq_management-2.5.1.ez.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From 0x6e6562 at gmail.com  Wed Jul 20 13:30:17 2011
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 20 Jul 2011 13:30:17 +0100
Subject: [rabbitmq-discuss] Management Plugin
In-Reply-To: <4E26C985.5020209@rabbitmq.com>
References: <CAB-G1jiySPJ3ZS4Y=19WCOBHgfNuRehL2pYH5BL5gD-M2tKOoA@mail.gmail.com>
	<4E26944D.10903@rabbitmq.com>
	<CAB-G1jgv3q2kV851jvx2wGi+Eab3_T55Tbu+zgV=vaE1ApH5uA@mail.gmail.com>
	<CAB-G1jiJ6kp229WM4-s7Eg3=VGyMMUPZTDE6nQz2vAi47Fh8xg@mail.gmail.com>
	<4E26B869.8090203@rabbitmq.com>
	<CAB-G1jgY7VSU81RUUODp8ZNzod+SCn+PPFMpRYJvbBFKrYz=aw@mail.gmail.com>
	<4E26C985.5020209@rabbitmq.com>
Message-ID: <CAB-G1jgTo6_VBsWHWHyV3pqSgqv=Mjipd1RCTUYwLDYUR9J6qA@mail.gmail.com>

Simon,

On Wed, Jul 20, 2011 at 1:26 PM, Simon MacMullen <simon at rabbitmq.com> wrote:
> Ah, yes. It replaces rabbitmq_management-2.5.1.ez.

Thanks for the heads up.

Cheers,

Ben

From stammailbox at gmail.com  Wed Jul 20 15:22:31 2011
From: stammailbox at gmail.com (mysurf mail)
Date: Wed, 20 Jul 2011 17:22:31 +0300
Subject: [rabbitmq-discuss] Change port in Management Plugin
Message-ID: <CAJ2-VrnjGcpAwqPQxsLcGbWTdZZpeBSg3Z4dUod32nVgEvh7=w@mail.gmail.com>

Hi,

1. Can someone assist me in changing the default port in the management
plugin.
I have read the docs but couldnt figure it out.
I understand I need to put in my %APPDATA%\Rabbitmq folder a rabbitmq.config
file.
But what should I put in it to change the management 55672 port.

2. After putting the 2.3.1 management plugin in my 2.3.1 rabbit folder
I get those warnings upon restart :

Activating RabbitMQ plugins ...
*WARNING* Undefined function fdsrv:bind_socket/2
*WARNING* Undefined function fdsrv:start/0
*WARNING* Undefined function fdsrv:stop/0
*WARNING* Undefined function webmachine_resource:start_link/2
6 plugins activated:
* amqp_client-2.3.1
* mochiweb-1.3-rmq2.5.1-git9a53dbd
* rabbit_management-2.3.1
* rabbit_management_agent-2.3.1
* rabbit_mochiweb-2.3.1
* webmachine-1.7.0

Any Ideas?

Thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110720/5c46dd69/attachment.htm>

From habtdemis at gmail.com  Wed Jul 20 15:50:01 2011
From: habtdemis at gmail.com (Demi Zike)
Date: Wed, 20 Jul 2011 09:50:01 -0500
Subject: [rabbitmq-discuss] Reading multiple messages in RabbitMQ
Message-ID: <CAJE2eFFQk1=NYHfWhhg3=KC8_JWwazcokgeiSNXGyQ6iCE7t-Q@mail.gmail.com>

Hi,

I use Subscription from the RabbitMQ.Client.MessagePatterns namespace to
subscribe to multiple queues. I then read messages based on the subscription
(code below). However, I am not able to read messages other than the first
one. i.e. Whether I try to read from multiple queues(subscriptions) or a
single queue(subscription). I do Ack() at each iteration of the message
reading. Could you see where the run time error originated at for me?

Thanks

private List<Subscription> subscriptions = new List<Subscription>();
Subscription sub = null;


    public Measurement readMessage()
           {
            Measurement m = new Measurement();
            foreach(Subscription element in subscriptions)
            {
                if( element.QueueName == null)
                {
                    m = null;
                }
                else
                {
                    BasicDeliverEventArgs ev = element.Next();
                    if( ev != null) {
                        m = Measurement.AltDeSerialize( ev.Body );
                        m.id = element.QueueName;
                        element.Ack();
                        return m;
                    }
                    m =  null;
                    element.Ack();

                }
            }
            System.Console.WriteLine("No message in the queue(s) at this
time.");
            return m;
        }

        public void subscribeToQueue(string queueName)
        {
            sub = new Subscription(channel, queueName);
            subscriptions.Add(sub);
        }
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110720/30a7e8ef/attachment.htm>

From matthew at rabbitmq.com  Wed Jul 20 18:23:26 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 20 Jul 2011 18:23:26 +0100
Subject: [rabbitmq-discuss] RabbitMQ Uptime
In-Reply-To: <4E252F4C.5000801@rabbitmq.com>
References: <237050FF255D844CBDF840D42334EB9B67843CBF90@SFOEXM02.YELLOWPAGES.LOCAL>
	<4E252F4C.5000801@rabbitmq.com>
Message-ID: <20110720172326.GA17517@rabbitmq.com>

On Tue, Jul 19, 2011 at 08:16:28AM +0100, Matthias Radestock wrote:
> >FYI: RabbitMQ 1.7.1, Erlang R13B04 and Red Hat 5.4
> 
> You really should upgrade ;)

We really should implement hot code upgrades so that he can upgrade
without losing uptime! ;)

Matthew

From matthias at rabbitmq.com  Wed Jul 20 18:26:24 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 20 Jul 2011 18:26:24 +0100
Subject: [rabbitmq-discuss] RabbitMQ Uptime
In-Reply-To: <20110720172326.GA17517@rabbitmq.com>
References: <237050FF255D844CBDF840D42334EB9B67843CBF90@SFOEXM02.YELLOWPAGES.LOCAL>	<4E252F4C.5000801@rabbitmq.com>
	<20110720172326.GA17517@rabbitmq.com>
Message-ID: <4E270FC0.7080007@rabbitmq.com>

On 20/07/11 18:23, Matthew Sackman wrote:
> On Tue, Jul 19, 2011 at 08:16:28AM +0100, Matthias Radestock wrote:
>>> FYI: RabbitMQ 1.7.1, Erlang R13B04 and Red Hat 5.4
>>
>> You really should upgrade ;)
>
> We really should implement hot code upgrades so that he can upgrade
> without losing uptime! ;)

Ah, but he'd have to upgrade to the hot-code-upgrade-enabled version 
first ;)

Matthias.

From gmr at myyearbook.com  Wed Jul 20 18:29:36 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Wed, 20 Jul 2011 13:29:36 -0400
Subject: [rabbitmq-discuss] RabbitMQ Uptime
In-Reply-To: <20110720172326.GA17517@rabbitmq.com>
References: <237050FF255D844CBDF840D42334EB9B67843CBF90@SFOEXM02.YELLOWPAGES.LOCAL>
	<4E252F4C.5000801@rabbitmq.com> <20110720172326.GA17517@rabbitmq.com>
Message-ID: <A9A40D8A1EA04308A9C49A393809DCFC@myyearbook.com>



On Wednesday, July 20, 2011 at 1:23 PM, Matthew Sackman wrote:

> On Tue, Jul 19, 2011 at 08:16:28AM +0100, Matthias Radestock wrote:
> We really should implement hot code upgrades so that he can upgrade
> without losing uptime! ;)
+1 :)



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110720/e08ec5f4/attachment.htm>

From abhishek.kona at gmail.com  Wed Jul 20 19:38:06 2011
From: abhishek.kona at gmail.com (Abhishek K)
Date: Thu, 21 Jul 2011 00:08:06 +0530
Subject: [rabbitmq-discuss] Connection Pooling Options to solve FD
	Consumption on RabbitMQ.
Message-ID: <CAGTBvKtVZo6X6A2P33fC9SpiimhBUCOS+dJNn_ihhB1XBRMfdQ@mail.gmail.com>

I am using RabbitMQ with the Java Client.
On each request, I create a new Connection and Channel. During high load
times, this is causing the Rabbit to go unresponsive (due to a large no. of
open file Descriptor's).

This would be solved if I could connection pool on the client side, what are
the strategies and API's suggested for that.

-Abhishek Kona
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110721/60b2fd33/attachment.htm>

From msteele at beringmedia.com  Wed Jul 20 20:12:57 2011
From: msteele at beringmedia.com (Mark Steele)
Date: Wed, 20 Jul 2011 15:12:57 -0400
Subject: [rabbitmq-discuss] SSL errors
Message-ID: <CAH24rBNVqqfa4zWA_3+E3c94o+aOUObKOvSS6jp34ni92=H0DA@mail.gmail.com>

Hey folks. I'm seeing an intermittent error in my rabbit logs:

Error in process <0.17086.7> on node 'rabbit at D1750-2' with exit value:
{undef,[{ssl_session_cache,delete,[{9000,<<32 bytes>>}]}]}

When it occurs, it seems to happen hundreds of thousands of times before it
stop (all on the same pid/connection).

Any clues on what may cause this?

Erlang R14B03, rabbit 2.5.0


Mark Steele
Bering Media Inc.
Office: +1 (416) 583-5227
Mobile: +1 (416) 888-1009
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110720/3fb5e1c4/attachment.htm>

From matthias at rabbitmq.com  Wed Jul 20 20:17:28 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 20 Jul 2011 20:17:28 +0100
Subject: [rabbitmq-discuss] SSL errors
In-Reply-To: <CAH24rBNVqqfa4zWA_3+E3c94o+aOUObKOvSS6jp34ni92=H0DA@mail.gmail.com>
References: <CAH24rBNVqqfa4zWA_3+E3c94o+aOUObKOvSS6jp34ni92=H0DA@mail.gmail.com>
Message-ID: <4E2729C8.50208@rabbitmq.com>

Mark,

On 20/07/11 20:12, Mark Steele wrote:
> Error in process <0.17086.7> on node 'rabbit at D1750-2' with exit value:
> {undef,[{ssl_session_cache,delete,[{9000,<<32 bytes>>}]}]}
> [...]
> Any clues on what may cause this?
>
> Erlang R14B03, rabbit 2.5.0

That is a known bug in Erlang R14B03. afaik it is pretty harmless in the 
context of rabbitmq, aside from the annoying log entries.


Matthias.

From michael.s.klishin at gmail.com  Wed Jul 20 20:42:06 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 20 Jul 2011 23:42:06 +0400
Subject: [rabbitmq-discuss] Connection Pooling Options to solve FD
 Consumption on RabbitMQ.
In-Reply-To: <CAGTBvKtVZo6X6A2P33fC9SpiimhBUCOS+dJNn_ihhB1XBRMfdQ@mail.gmail.com>
References: <CAGTBvKtVZo6X6A2P33fC9SpiimhBUCOS+dJNn_ihhB1XBRMfdQ@mail.gmail.com>
Message-ID: <CAE3HoVTGCheLtjLC_kB-5QoJAKVON0BOig1RbNeYPWGq0M-YNA@mail.gmail.com>

2011/7/20 Abhishek K <abhishek.kona at gmail.com>

> On each request, I create a new Connection and Channel. During high load
> times, this is causing the Rabbit to go unresponsive (due to a large no. of
> open file Descriptor's).
>
> This would be solved if I could connection pool on the client side, what
> are the strategies and API's suggested for that.
>

Why do you need a new connection on each (HTTP?) request? This is what
channels are for, if you want to absolutely separate data flowing between on
each individual request.
AMQP was designed with the idea of keeping # of TCP connections as low as #
of applications.

-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110720/38b362d4/attachment.htm>

From rishdev at gmail.com  Wed Jul 20 20:47:51 2011
From: rishdev at gmail.com (Rishi Dev)
Date: Wed, 20 Jul 2011 13:47:51 -0600
Subject: [rabbitmq-discuss] Integration of SAP XI with RabbitMQ
In-Reply-To: <CANjYeshxiRBThhUtCpv2fNXt064noi5cZh8-9Jw3=HzzKApv0A@mail.gmail.com>
References: <ce1093a7-7fb3-4797-8c39-c3457581ebcf@w4g2000yqm.googlegroups.com>
	<4db977ae-8bad-44c8-b204-13c6f2aa4c40@c41g2000yqm.googlegroups.com>
	<CACOPnve_ocGxcydweiaw3a8BX8LMFcVepNApgjqnh1dAi+Q_jA@mail.gmail.com>
	<4E1B40E8.9080901@logosworld.com>
	<CACOPnvcRWugRBR7V6uZRUeyNuRTAeJ=Jw6QOkstgdmgJyVQZiw@mail.gmail.com>
	<CANjYeshxiRBThhUtCpv2fNXt064noi5cZh8-9Jw3=HzzKApv0A@mail.gmail.com>
Message-ID: <CANjYesg_R=d6_gSEZz=Q01yODCbhp2gkr3iK3W-4DhRHxLbiQg@mail.gmail.com>

Here are some updates from my side.
    1. There is not much scope in our project plan to squeeze in development
of an XI AMQP adapter. Our SAPXI team is mostly overwhelmed with work.

    2. We are planning to attempt for XI HTTP adapter. Most likely will use
some plugin in Rabbit which will allow PubSub over HTTP. I believe MochiWeb
will need additional plug-in to act as an http interface to Rabbit broker. I
am not sure if any is readily available. Let me know if someone would like
to recommend any.

    3. I did look at amqp-rest, haven't installed it yet, but it appears
that this prj hasn't been active sine more than a year. Does anyone has any
experience with it?
        I also am not sure how it will handle msgs of XML format. It appears
to have having forward slash as a delimiter in url.

    4. We did look briefly at QPID JMS client with Rabbit broker to make our
life easier, but alas they don't gel easily with each other in negotiating
protocols & versions and maybe more issues. It will need me to deep dive.
Probably will consider when no other option.

    5. I was wondering, whatif I create a small webapp, to which SAPXI can
submit a html form with msg etc data and that webapp takes care of pushing
it to Rabbit. It appears more along the lines of some plugin inside Rabbit
using Mochi, but will spare me of learning how to develop plug-in for
rabbit.

    Btw, I was going through
https://dev.rabbitmq.com/wiki/WritingYourOwnClient and "How to guide" and
"Ben's guide" links appear to be broken.

*Lynton,*
    To answer your question and provide more details.
    1. The format of msgs from SAPXI is XML.
    2. Our communication requirement between XI and Rabbit is one way. XI
will be publishing msgs to other systems through rabbit, but not consuming
any.

I will update you and our group here, as and when we progress with some
decisions/implementations.

Thanks,
Rishi

On Mon, Jul 11, 2011 at 7:34 PM, Rishi Dev <rishdev at gmail.com> wrote:

> Hi Lynton, Alexis,
>
> I must thank you both for your kind gesture of help.
> I will go through the details based on your inputs along with my SAP XI
> experts here, and will try to come back with some updates on my side ASAP.
> And I sure will wait for more suggestions from our team here.
>
> Thank you,
> Rishi
>
>
> On Mon, Jul 11, 2011 at 1:00 PM, Alexis Richardson <alexis at rabbitmq.com>wrote:
>
>> Thanks very much Lynton!
>>
>> I assume you meant RPC not RFC ;-)
>>
>>
>>
>> On Mon, Jul 11, 2011 at 7:28 PM, Lynton Grice <lynton.grice at ls-cs.com>
>> wrote:
>> >  Hi Rishi,
>> >
>> > I am a SAP XI consultant in Johannesburg and also play around with
>> RabbitMQ
>> > when I get a chance.
>> >
>> > Your question is very interesting, and one that I have wondered about
>> > before. Obviously the long term approach would be to develop a sender /
>> > receiver Java adapter for SAP XI / PI to handle the AMQP communication,
>> but
>> > the disadvantage here is that adapter development can be tricky and has
>> a
>> > relatively steep learning curve. But if you have the skills I say go for
>> it.
>> >
>> > I have not been following the current "adapters" for RabbitMQ, but I
>> would
>> > imagine that putting some sort of RESTful / HTTP interface using
>> something
>> > like MochiWeb would be pretty simple to talk to from a SAP XI HTTP
>> adapter.
>> > I know this is not perfect but an option nevertheless.
>> >
>> > Sending messages from RabbitMQ to SAP XI would be very easy from a proof
>> of
>> > concept point of view. As you already know you would simple build up the
>> URL
>> > to post the XML message to using the correct channel, sender service,
>> sender
>> > interface etc in the
>> >
>> > http://
>> <server>:<port>/XISOAPAdapter/MessageServlet?channel=:<service>:<sender_channle>&version=3.0&Sender.Service=<service>&Interface=<namespace><interface_name>
>> >
>> > Writing an "adapter" for RabbitMQ that takes messages off a queue and
>> sends
>> > them to a configurable URL like the one above should not be too hard.
>> >
>> > A question for you: What format would the messages be in on the RabbitMQ
>> > queue? Already in "SAP XI XML" format?
>> >
>> > The bottomline is their are many ways one could do this, if you had to
>> ask
>> > me my choice I would choose between the following 2:
>> >
>> > 1. Create a custom Java adapter for both the sender AMQP and receiver
>> AMQP
>> > adapter
>> >
>> > 2. On the next option I speak from experience in doing it and it works
>> > great:
>> >        - Create an RFC Server in C / C++. This could be called from SAP
>> XI
>> > and pass the messages to it, from there you would simple use some
>> RabbitMQ
>> > API to send the messages to RabbitMQ
>> >        - For sending messages to SAP I would just post the message
>> straight
>> > to SAP XI using something like the URL above. You could easily write
>> such a
>> > HTTP client in Erlang (or Python etc) and "plug it in as an adapter" to
>> > RabbitMQ.
>> >
>> > Let me brainstorm it a little more, but feel free to email me and we can
>> > discuss this more to get the best answer.
>> >
>> > Lynton
>> >
>> >
>> > On 11/07/2011 18:05, Alexis Richardson wrote:
>> >>
>> >> Rishi
>> >>
>> >> I have bcc'd someone who may be able to advise you.
>> >>
>> >> alexis
>> >>
>> >>
>> >> On Fri, Jul 8, 2011 at 9:21 PM, RishiDev<rishdev at gmail.com>  wrote:
>> >>>
>> >>> To certain extent I believe the question should go to SAPXI community.
>> >>> And we have already raised a ticket with them, but still I wanted to
>> >>> quickly check if someone from our RabbitMQ community has some tips to
>> >>> share.
>> >>>
>> >>> On Jul 8, 1:36 pm, RishiDev<rish... at gmail.com>  wrote:
>> >>>>
>> >>>> Hi,
>> >>>>
>> >>>> Our organization has SAP XI 7.0 systems which sends various messages
>> >>>> to other systems across the enterprise.
>> >>>> For better performance, reliability and message compression etc
>> >>>> abilities we are trying to move from ActiveMQ to RabbitMQ. Having SAP
>> >>>> XI talk to ActiveMQ was easy by using JMS type communication channel
>> >>>> configured in XI. I want to learn from the group, what is best&
>> >>>> recommended approach for SAPXI to Rabbit integration.
>> >>>>
>> >>>> I know that we can use QPID (I haven't tried yet though) and get a
>> JMS
>> >>>> kind of integration between SAPXI and Rabbit, but I would love it, if
>> >>>> we can have a pure AMQP base communication and avoid JMS.
>> >>>>
>> >>>> I will appreciate any help for what approach and how (to follow) to
>> >>>> integrate SAPXI with Rabbit.
>> >>>>
>> >>>> Thank you.
>> >>>> Rishi
>> >>>> _______________________________________________
>> >>>> rabbitmq-discuss mailing list
>> >>>>
>> >>>> rabbitmq-disc... at lists.rabbitmq.comhttps://
>> lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >>>
>> >>> _______________________________________________
>> >>> rabbitmq-discuss mailing list
>> >>> rabbitmq-discuss at lists.rabbitmq.com
>> >>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >>>
>> >
>> >
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110720/20057ca2/attachment.htm>

From myname.whatis at gmail.com  Wed Jul 20 20:23:43 2011
From: myname.whatis at gmail.com (albert_newton)
Date: Wed, 20 Jul 2011 12:23:43 -0700 (PDT)
Subject: [rabbitmq-discuss] What is the server-name to get the rabbitmqadmin
Message-ID: <32102103.post@talk.nabble.com>


I am trying to install the rabbitmqadmin so that I can get the UI and the
command line tool. I already followed the steps mentioned here to get the
management plugin installed:
http://www.rabbitmq.com/plugins.html#rabbitmq-management

However when I try to hit this url: http://server-name:55672/cli/


I am not getting anything. I am not sure what the server-name is supposed to
be in the url above. I tried different values for it like:
rabbit at myhostname, rabbitmq-server, etc, but those did not work. 

Anyone have any idea about this?
-- 
View this message in context: http://old.nabble.com/What-is-the-server-name-to-get-the-rabbitmqadmin-tp32102103p32102103.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From alexandru at rabbitmq.com  Wed Jul 20 22:00:09 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Wed, 20 Jul 2011 22:00:09 +0100
Subject: [rabbitmq-discuss] Channel takes everyone down?
In-Reply-To: <4E25F53B.7000204@2600hz.com>
References: <4E25F53B.7000204@2600hz.com>
Message-ID: <20110720210009.GA12886@dakota>

Hi James,

> However, when a consumer has a non-normal exit, the channel goes down,
> but the exit signal bubbles up all the way to where *all* other channels
> go down as well.

I've just tried it and you're right: sending a non-normal exit to a
channel will cause the connection to go down, taking all the other
channels with it.

For what it's worth, this also happens with 2.5.1 and we don't have any
plans to change this behaviour right now.  It happens because channels
don't trap exits.

I'm afraid there isn't anyway to do it automatically.  You could start
a separate process that traps exits and is linked to your consumer.
When you receive an exit from the consumer, close its channel cleanly.
So, a very basic supervisor.

Maybe something like this:
  https://gist.github.com/1095910

Run() is what I think you're doing.  Run2() starts up a separate thread
to monitor the consumer and close its channel when the time comes.
That's 2.5.1 code, btw: the parameters for connection:open/1 changed a
bit.

Hope this helps.

Cheers,
Alex

On Tue, Jul 19, 2011 at 02:20:59PM -0700, James Aimonetti wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
> 
> My setup is as follows: I have a channel per consumer, and I'm trying to
> link the consumer to the channel so that if either dies, the other goes
> down (most consumers are ephemeral and easy to restart, those that are
> longer living trap exits).
> 
> However, when a consumer has a non-normal exit, the channel goes down,
> but the exit signal bubbles up all the way to where *all* other channels
> go down as well.
> 
> Any pointers how to link a consumer to its channel without taking the
> whole tree of channels down?
> 
> This is with rabbitmq server and erlang-client 2.4.1 and r14b03.
> 
> Thanks!
> 
> James
> 
> - -- 
> James Aimonetti
> Distributed Systems Engineer / DJ MC_
> 
> 2600hz | http://2600hz.com
> sip:james at 2600hz.com
> tel: 415.886.7905
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1.4.10 (GNU/Linux)
> Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/
> 
> iQEcBAEBAgAGBQJOJfU6AAoJENc77s1OYoGg/LoH/jIA8jdA7nUsZC+hbTstmkxv
> RkYg05yyB2qMp5yvoE54NL7U7LjpM6DZtCGrubbva5s9bYpRvQgQrO6XbAV17bTV
> nEyY+31L2IpAxX2hFOjIpMqiQ85iMlXZ+zzHnQ5vnaKlxPuhlpgRdaMdX/0ca+8W
> cMZF/FkNcX9Trwsz+XmOdKdKK0ctzZ7N4T6/5aIPzpObGBGuvZQG+b62txYf3x6Y
> 5Y0vPXlIDcQrU9yZ7osSG9q2DuW6qzDL9zMBZ8M8UwZoDhLRUw4DxZO3PnI+FZJz
> npJcpMeQXNopE6K1idEkFfVmB+XBgcS3a9FGlruuhiBrMLWWmpjpKBJaZ+CRPFU=
> =/7L/
> -----END PGP SIGNATURE-----
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From alexandru at rabbitmq.com  Wed Jul 20 22:14:14 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Wed, 20 Jul 2011 22:14:14 +0100
Subject: [rabbitmq-discuss] Frequently getting {badmatch, {error,
 einval} from one of my rabbimq nodes
In-Reply-To: <bb1ddfc2-0886-485e-8a02-09434ce92c53@t8g2000prm.googlegroups.com>
References: <bb1ddfc2-0886-485e-8a02-09434ce92c53@t8g2000prm.googlegroups.com>
Message-ID: <20110720211414.GB12886@dakota>

Hi Chak,

Could you please answer the following questions:
* What OS are you using?
* What version of RabbitMQ?
* What version of the Erlang client?
* What version of Erlang?

> ** Reason for termination ==
> ** {{badmatch,{error,einval}},
>     [{amqp_main_reader,handle_inet_async,2},
>      {gen_server,handle_msg,5},
>      {proc_lib,init_p_do_apply,3}]}

Looks like something strange is taking down the socket, which in turn is
taking down the entire connection.  If you have more than one
connection, the others should be fine.

Is there something in the server logs that corresponds to this error?

You say your other nodes don't have similar issues.  Is there something
special about this node?

Cheers,
Alex

On Wed, Jul 20, 2011 at 12:12:32AM -0700, Chak Hedik wrote:
> Hi,
> 
> I frequently getting this terminating error from one of my nodes :
> 
> ** Generic server <0.28067.2> terminating
> ** Last message in was {inet_async,#Port<0.15349>,9049,
> {ok,<<0,10,0,51,206>>}}
> ** When Server state == {state,#Port<0.15349>,<0.28063.2>,<0.28064.2>,
>                                {method,rabbit_framing_amqp_0_9_1},
>                                {1,0,4}}
> ** Reason for termination ==
> ** {{badmatch,{error,einval}},
>     [{amqp_main_reader,handle_inet_async,2},
>      {gen_server,handle_msg,5},
>      {proc_lib,init_p_do_apply,3}]}
> 
> While several other nodes with the same setup didn't have the same
> issue. May I know what it means and willl it affect my queues?How do I
> fix this?
> 
> Thank,
> Chak
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From michael.s.klishin at gmail.com  Wed Jul 20 22:30:56 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 21 Jul 2011 01:30:56 +0400
Subject: [rabbitmq-discuss] Patching rabbitmq to get more information about
	framing exceptions
Message-ID: <CAE3HoVRoV19iC511vE2vFL3ifQGg_DkF37OedMwXQhyD0WMfJA@mail.gmail.com>

Hi,

I am investigating a rare (but nonetheless top priority) amqp gem issue when
frames are delivered out of order. Neither the Tracer tool nor Wireshark
give me
good understanding of what frame exactly RabbitMQ chokes on, it just says
"expected a method frame, got a non-method frame instead".

So I am trying to patch RabbitMQ to get some more information. What's the
right way to do it? Right now I am trying to make
rabbit_command_assembler:process/2 do what I want and I am not sure how to
get a string representation of

1. Method that was delivered out of order.
2. # of the channel on which it happened
3. Ideally, 10-20 most recent frames

Can I ask someone from the RabbitMQ team help me a little bit? Where should
I be looking? Is it a good idea to make Rabbit log such
issues with more detail (it shouldn't affect hot code path performance
anyway)?

At this point I have an app that reproduces the issue roughly every other
time and I am using a Rabbit instance compiled from HEAD sources.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110721/49d020d1/attachment.htm>

From james at 2600hz.com  Wed Jul 20 22:33:12 2011
From: james at 2600hz.com (James Aimonetti)
Date: Wed, 20 Jul 2011 14:33:12 -0700
Subject: [rabbitmq-discuss] Channel takes everyone down?
In-Reply-To: <20110720210009.GA12886@dakota>
References: <4E25F53B.7000204@2600hz.com> <20110720210009.GA12886@dakota>
Message-ID: <4E274998.4000602@2600hz.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Alex,

Thanks for the response. I did indeed have a solution similar to Run2(),
but was finding channels were leaking, in that the third party
monitoring process wasn't shutting the channels down when the consumer
exited.

Linking the two was my quick solution to the problem but I guess not
feasible at the moment. I'll re-work my monitoring code and see if I
can't sniff out the leak.

Thanks again,

James

On 07/20/2011 02:00 PM, Alexandru Scvor?ov wrote:
> Hi James,
> 
>> However, when a consumer has a non-normal exit, the channel goes down,
>> but the exit signal bubbles up all the way to where *all* other channels
>> go down as well.
> 
> I've just tried it and you're right: sending a non-normal exit to a
> channel will cause the connection to go down, taking all the other
> channels with it.
> 
> For what it's worth, this also happens with 2.5.1 and we don't have any
> plans to change this behaviour right now.  It happens because channels
> don't trap exits.
> 
> I'm afraid there isn't anyway to do it automatically.  You could start
> a separate process that traps exits and is linked to your consumer.
> When you receive an exit from the consumer, close its channel cleanly.
> So, a very basic supervisor.
> 
> Maybe something like this:
>   https://gist.github.com/1095910
> 
> Run() is what I think you're doing.  Run2() starts up a separate thread
> to monitor the consumer and close its channel when the time comes.
> That's 2.5.1 code, btw: the parameters for connection:open/1 changed a
> bit.
> 
> Hope this helps.
> 
> Cheers,
> Alex
> 
> On Tue, Jul 19, 2011 at 02:20:59PM -0700, James Aimonetti wrote:
> My setup is as follows: I have a channel per consumer, and I'm trying to
> link the consumer to the channel so that if either dies, the other goes
> down (most consumers are ephemeral and easy to restart, those that are
> longer living trap exits).
> 
> However, when a consumer has a non-normal exit, the channel goes down,
> but the exit signal bubbles up all the way to where *all* other channels
> go down as well.
> 
> Any pointers how to link a consumer to its channel without taking the
> whole tree of channels down?
> 
> This is with rabbitmq server and erlang-client 2.4.1 and r14b03.
> 
> Thanks!
> 
> James
> 
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

- -- 
James Aimonetti
Distributed Systems Engineer / DJ MC_

2600hz | http://2600hz.com
sip:james at 2600hz.com
tel: 415.886.7905
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iQEcBAEBAgAGBQJOJ0mYAAoJENc77s1OYoGgX60H/iY53s3e2MrlWtEyK7CQgePL
Bltt1OhOq2Ag2ohsz8HOf8G8X9VbSbeAwx5hJdKpZD+gF1MGuXIc55AClGxQRnD4
CTewQZVJbB6b+ClkiRXBo4yllwmTLzA/MdKAycQSpcmNF6yRZxcFwqsOmXUk+p52
xhxetuPjP1TVpUUTFIfitqdz6NDxd659nnx4YIAoTI1A37FAwpmwZtCvJFCa12ug
oVG9hwsMoP9Dz+N6GHr36p8IQfSeeQOaR/ZCaJESQkHAvqx9Jmior6P+YZyD6Th3
c7/Os2GOGrP6rUv9i6YytgA1coLDOKTLn1c6HZfSwzck7GpkFZtgMlodMibyoLM=
=1fsj
-----END PGP SIGNATURE-----

From matthias at rabbitmq.com  Wed Jul 20 23:01:20 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 20 Jul 2011 23:01:20 +0100
Subject: [rabbitmq-discuss] Patching rabbitmq to get more information
 about	framing exceptions
In-Reply-To: <CAE3HoVRoV19iC511vE2vFL3ifQGg_DkF37OedMwXQhyD0WMfJA@mail.gmail.com>
References: <CAE3HoVRoV19iC511vE2vFL3ifQGg_DkF37OedMwXQhyD0WMfJA@mail.gmail.com>
Message-ID: <4E275030.9030908@rabbitmq.com>

Michael,

On 20/07/11 22:30, Michael Klishin wrote:
> I am investigating a rare (but nonetheless top priority) amqp gem issue
> when frames are delivered out of order. Neither the Tracer tool nor
> Wireshark give me
> good understanding of what frame exactly RabbitMQ chokes on, it just
> says "expected a method frame, got a non-method frame instead".

That means the server got a content header or body frame, which in case 
of client->server communication can only be as part of a publish. The 
most likely cause is the client sending more content body frames than it 
should, e.g. a trailing empty frame.

It should be possible to spot that from the tracer / wireshark.

> Is it a good idea to make Rabbit log such issues with more detail (it
> shouldn't affect hot code path performance anyway)?

We wouldn't want to log complete frame contents since that would 
introduce a major DoS attack vector. Having said that, the error that is 
logged (and indeed returned to the client) should include some more info 
than it currently does. I have filed a bug for that.

Regards,

Matthias.

From michael.s.klishin at gmail.com  Wed Jul 20 23:09:16 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 21 Jul 2011 02:09:16 +0400
Subject: [rabbitmq-discuss] Patching rabbitmq to get more information
 about framing exceptions
In-Reply-To: <4E275030.9030908@rabbitmq.com>
References: <CAE3HoVRoV19iC511vE2vFL3ifQGg_DkF37OedMwXQhyD0WMfJA@mail.gmail.com>
	<4E275030.9030908@rabbitmq.com>
Message-ID: <CAE3HoVRWXQx1H=SHAVNq-gH5yTGoavqxfAQq1YmVJf=z_DoJSA@mail.gmail.com>

2011/7/21 Matthias Radestock <matthias at rabbitmq.com>

> That means the server got a content header or body frame, which in case of
> client->server communication can only be as part of a publish. The most
> likely cause is the client sending more content body frames than it should,
> e.g. a trailing empty frame.
>
> It should be possible to spot that from the tracer / wireshark.
>
>
Yes, it is purely a publishing issue and the idea of extra frames has
crossed my mind. Wireshark doesn't prove it though.


>
>  Is it a good idea to make Rabbit log such issues with more detail (it
>> shouldn't affect hot code path performance anyway)?
>>
>
> We wouldn't want to log complete frame contents since that would introduce
> a major DoS attack vector. Having said that, the error that is logged (and
> indeed returned to the client) should include some more info than it
> currently does. I have filed a bug for that.
>

I still need to find a way to patch my local rabbit copy to get more
information. What's a good way to keep a few recent frames around? Is it
possible to implement as a plugin?

-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110721/b7fd8170/attachment.htm>

From matthias at rabbitmq.com  Wed Jul 20 23:33:48 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 20 Jul 2011 23:33:48 +0100
Subject: [rabbitmq-discuss] Patching rabbitmq to get more information
 about framing exceptions
In-Reply-To: <CAE3HoVRWXQx1H=SHAVNq-gH5yTGoavqxfAQq1YmVJf=z_DoJSA@mail.gmail.com>
References: <CAE3HoVRoV19iC511vE2vFL3ifQGg_DkF37OedMwXQhyD0WMfJA@mail.gmail.com>
	<4E275030.9030908@rabbitmq.com>
	<CAE3HoVRWXQx1H=SHAVNq-gH5yTGoavqxfAQq1YmVJf=z_DoJSA@mail.gmail.com>
Message-ID: <4E2757CC.6080701@rabbitmq.com>

Michael,

On 20/07/11 23:09, Michael Klishin wrote:
> 2011/7/21 Matthias Radestock <matthias at rabbitmq.com
> <mailto:matthias at rabbitmq.com>>
>
>     That means the server got a content header or body frame, which in
>     case of client->server communication can only be as part of a
>     publish. The most likely cause is the client sending more content
>     body frames than it should, e.g. a trailing empty frame.
>
>     It should be possible to spot that from the tracer / wireshark.
>
>
> Yes, it is purely a publishing issue and the idea of extra frames has
> crossed my mind. Wireshark doesn't prove it though.

Wireshark should have all the information you need. It probably won't 
call this issue out as an error though. Ditto for the tracer.

> I still need to find a way to patch my local rabbit copy to get more
> information. What's a good way to keep a few recent frames around?

Given that you can reproduce the problem easily, you may just want to 
log some details of all the frames - frame type, class id, method id, 
and for content headers the expected body size, and for content bodies 
the payload size.

> Is it possible to implement as a plugin?

No. Well, technically yes, but you are much better off just modifying 
the code in rabbit_command_assembler.

Regards,

Matthias.

From chakhedik at gmail.com  Wed Jul 20 23:40:51 2011
From: chakhedik at gmail.com (Chak Hedik)
Date: Wed, 20 Jul 2011 15:40:51 -0700 (PDT)
Subject: [rabbitmq-discuss] Frequently getting {badmatch, {error,
 einval} from one of my rabbimq nodes
In-Reply-To: <20110720211414.GB12886@dakota>
References: <bb1ddfc2-0886-485e-8a02-09434ce92c53@t8g2000prm.googlegroups.com>
	<20110720211414.GB12886@dakota>
Message-ID: <73926954-e458-4bc2-90e6-a490c69ce8f3@v11g2000prn.googlegroups.com>

Hi Alex,

*Ubuntu Server 11.04 64-Bit
*RabbitMQ 2.3.1 (Default ubuntu package)
*Erlang Client 2.3.1 (Default ubuntu package)
*Erlang R13B03 (Default ubuntu package)

Is there something in the server logs that corresponds to this error?
- That's the only thing appeared in the logs.

You say your other nodes don't have similar issues.  Is there
something
special about this node?
- Nothing special, pretty much the same but handle more messages than
others. 1 worker handling 1 queue.

It is strange behaviour and it happen at the very beginning where the
worker up for the first time (no message in queue yet). I've created
another node and put this worker there and will wait and see if
similar error appear again or not today.

Thanks for your reply.

Chak


On Jul 21, 5:14?am, Alexandru Scvor?ov <alexan... at rabbitmq.com> wrote:
> Hi Chak,
>
> Could you please answer the following questions:
> * What OS are you using?
> * What version of RabbitMQ?
> * What version of the Erlang client?
> * What version of Erlang?
>
> > ** Reason for termination ==
> > ** {{badmatch,{error,einval}},
> > ? ? [{amqp_main_reader,handle_inet_async,2},
> > ? ? ?{gen_server,handle_msg,5},
> > ? ? ?{proc_lib,init_p_do_apply,3}]}
>
> Looks like something strange is taking down the socket, which in turn is
> taking down the entire connection. ?If you have more than one
> connection, the others should be fine.
>
> Is there something in the server logs that corresponds to this error?
>
> You say your other nodes don't have similar issues. ?Is there something
> special about this node?
>
> Cheers,
> Alex
>
>
>
>
>
>
>
>
>
> On Wed, Jul 20, 2011 at 12:12:32AM -0700, Chak Hedik wrote:
> > Hi,
>
> > I frequently getting this terminating error from one of my nodes :
>
> > ** Generic server <0.28067.2> terminating
> > ** Last message in was {inet_async,#Port<0.15349>,9049,
> > {ok,<<0,10,0,51,206>>}}
> > ** When Server state == {state,#Port<0.15349>,<0.28063.2>,<0.28064.2>,
> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?{method,rabbit_framing_amqp_0_9_1},
> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?{1,0,4}}
> > ** Reason for termination ==
> > ** {{badmatch,{error,einval}},
> > ? ? [{amqp_main_reader,handle_inet_async,2},
> > ? ? ?{gen_server,handle_msg,5},
> > ? ? ?{proc_lib,init_p_do_apply,3}]}
>
> > While several other nodes with the same setup didn't have the same
> > issue. May I know what it means and willl it affect my queues?How do I
> > fix this?
>
> > Thank,
> > Chak
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From michael.s.klishin at gmail.com  Wed Jul 20 23:42:28 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 21 Jul 2011 02:42:28 +0400
Subject: [rabbitmq-discuss] Patching rabbitmq to get more information
 about framing exceptions
In-Reply-To: <4E2757CC.6080701@rabbitmq.com>
References: <CAE3HoVRoV19iC511vE2vFL3ifQGg_DkF37OedMwXQhyD0WMfJA@mail.gmail.com>
	<4E275030.9030908@rabbitmq.com>
	<CAE3HoVRWXQx1H=SHAVNq-gH5yTGoavqxfAQq1YmVJf=z_DoJSA@mail.gmail.com>
	<4E2757CC.6080701@rabbitmq.com>
Message-ID: <CAE3HoVQKO+2LdvS31iMdYW-ULK6BFmqS_F9ADgpvueNzSjG4BQ@mail.gmail.com>

2011/7/21 Matthias Radestock <matthias at rabbitmq.com>

> Given that you can reproduce the problem easily, you may just want to log
> some details of all the frames - frame type, class id, method id, and for
> content headers the expected body size, and for content bodies the payload
> size.


That's what I am doing now. One thing that has caught my attention is a
0-sized BodyFrame. that did not cause any exceptions to be raised (for good
10 seconds or so, anyway)
but there is absolutely no way I am publishing empty payloads. So you are
likely to be right. We also have a long-stanging issue (not 0.8.x specific
though) with empty messages.

I will try to investigate more on the client side and take a look at the
Java client framing code. Thank you for your help. I did not suspect extra
frames to be an issue initially.

-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110721/9f57f6cd/attachment.htm>

From matthew at rabbitmq.com  Thu Jul 21 00:06:17 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 21 Jul 2011 00:06:17 +0100
Subject: [rabbitmq-discuss] Channel takes everyone down?
In-Reply-To: <4E274998.4000602@2600hz.com>
References: <4E25F53B.7000204@2600hz.com> <20110720210009.GA12886@dakota>
	<4E274998.4000602@2600hz.com>
Message-ID: <20110720230617.GA7231@rabbitmq.com>

Hi James,

Note that this will get better in the future when some branches land
after getting through QA. In short, the channel will monitor consumers
automatically (well, not quite the channel, but something similar to it)
and you as the consumer could monitor rather than link to the channel.

Really though, why would your processes be exiting with a non-normal
reason? That suggests some sort of crash/bug and thus tearing down the
connection _could_ be considered the right thing to do. One way around
this though would be to use several connections rather than several
channels.

Best wishes,

Matthew

From michael.s.klishin at gmail.com  Thu Jul 21 02:21:01 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 21 Jul 2011 05:21:01 +0400
Subject: [rabbitmq-discuss] What is the server-name to get the
	rabbitmqadmin
In-Reply-To: <32102103.post@talk.nabble.com>
References: <32102103.post@talk.nabble.com>
Message-ID: <CAE3HoVRBMdR=E1P_z8_NJ5sWYkvTDHUkCqJNKojk+9Yo54LbaA@mail.gmail.com>

2011/7/20 albert_newton <myname.whatis at gmail.com>

> Anyone have any idea about this?



If RabbitMQ is running locally, then localhost. Or whatever hostname you
bound RabbitMQ to.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110721/b8dd2665/attachment.htm>

From michael.s.klishin at gmail.com  Thu Jul 21 03:51:28 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 21 Jul 2011 06:51:28 +0400
Subject: [rabbitmq-discuss] Patching rabbitmq to get more information
 about framing exceptions
In-Reply-To: <4E2757CC.6080701@rabbitmq.com>
References: <CAE3HoVRoV19iC511vE2vFL3ifQGg_DkF37OedMwXQhyD0WMfJA@mail.gmail.com>
	<4E275030.9030908@rabbitmq.com>
	<CAE3HoVRWXQx1H=SHAVNq-gH5yTGoavqxfAQq1YmVJf=z_DoJSA@mail.gmail.com>
	<4E2757CC.6080701@rabbitmq.com>
Message-ID: <CAE3HoVSG-cQs+bdwRiUc8gPgX3Yn9-QMjmpKeVn1SQ269z8-WA@mail.gmail.com>

2011/7/21 Matthias Radestock <matthias at rabbitmq.com>

> Given that you can reproduce the problem easily, you may just want to log
> some details of all the frames - frame type, class id, method id, and for
> content headers the expected body size, and for content bodies the payload
> size.


So far I narrowed it down to the "empty messages" problem: whenever there is
an empty message sent by amqp gem master version, RabbitMQ
doesn't consider it a complete message and thus clients do not get anything.
With a simple script that terminates as soon as the message is received
(by the same process), this looks like app is hanging. In the context of a
larger application, sometimes there are empty messages transmitted (I am
streaming a stdout output).

After comparing 2 clients I see the following picture: the data transmitted
is exactly the same, frame order is correct but Wireshark GUI suggests that
one client transmits 3 frames as 3 IP packets. In this case, RabbitMQ is
happy. The other transmits them all in a single IP packet and RabbitMQ
doesn't seem to recognize it as a complete message.

Here are two Wireshark session exports:
https://gist.github.com/1096404

If the [frames] content is the same, what may be going on here?

-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110721/f182e032/attachment.htm>

From michael.s.klishin at gmail.com  Thu Jul 21 05:08:59 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 21 Jul 2011 08:08:59 +0400
Subject: [rabbitmq-discuss] Patching rabbitmq to get more information
 about framing exceptions
In-Reply-To: <CAE3HoVSG-cQs+bdwRiUc8gPgX3Yn9-QMjmpKeVn1SQ269z8-WA@mail.gmail.com>
References: <CAE3HoVRoV19iC511vE2vFL3ifQGg_DkF37OedMwXQhyD0WMfJA@mail.gmail.com>
	<4E275030.9030908@rabbitmq.com>
	<CAE3HoVRWXQx1H=SHAVNq-gH5yTGoavqxfAQq1YmVJf=z_DoJSA@mail.gmail.com>
	<4E2757CC.6080701@rabbitmq.com>
	<CAE3HoVSG-cQs+bdwRiUc8gPgX3Yn9-QMjmpKeVn1SQ269z8-WA@mail.gmail.com>
Message-ID: <CAE3HoVRYv0ZBcwjEQZeOvN_dZ5472GL6St1s82p2Byph748NAw@mail.gmail.com>

2011/7/21 Michael Klishin <michael.s.klishin at gmail.com>

> Here are two Wireshark session exports:
> https://gist.github.com/1096404
>

One more session: https://gist.github.com/1096472

-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110721/600092c6/attachment.htm>

From taylste at gmail.com  Thu Jul 21 05:12:58 2011
From: taylste at gmail.com (Steven Taylor)
Date: Thu, 21 Jul 2011 05:12:58 +0100
Subject: [rabbitmq-discuss] publish/suscribe model with typed consumers
In-Reply-To: <4DF1F963.7080603@rabbitmq.com>
References: <E9FBE39960CDBF4A8CD9DE7E9D14C509126B73A729@Y000IMRV01.rd1.rf1>
	<4DF1F963.7080603@rabbitmq.com>
Message-ID: <CA+zYriSSf9UJjo6_Sh8NC5gG43fHtnAMtEfVZO9LJ=t3+ryLKg@mail.gmail.com>

will you be extending this functionality to the .net client?  Is it there
already?  btw: I'm fielding a question from the wider community on this for
a c# client.  Personally, it's something I've needed in the past, but not
something I need right now.

My reading of the spec was it is possible (confirmed by this thread), but of
the Subscriber class source code in .net is no, it is only set up for one
queue.

thanks,
-Steven

On 10 June 2011 12:00, Matthias Radestock <matthias at rabbitmq.com> wrote:

> Pierre-Marie,
>
>
> On 10/06/11 11:15, PADIOU Pierre-Marie (MORPHO) wrote:
>
>> For now, the only solution I see would be to create as many queues as
>> requests
>> types (queueA, queueB, etc), and make consumer listen to the appropriate
>> queues.
>>
>> Thing is:
>>
>> - this implies that consumers create as many threads as queues there are
>> listening from (more than a hundred in my case), which I would like to
>> avoid.
>>
>
> Which client are you using? Java? If so, a single consumer thread can
> happily consume from multiple queues. E.g. you can pass a single
> QueuingConsumer instance to multiple ch.basicConsume(...) invocations.
>
>
> Regards,
>
> Matthias.
>
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110721/320b7cca/attachment.htm>

From sidchilling at gmail.com  Thu Jul 21 06:04:48 2011
From: sidchilling at gmail.com (Siddharth Saha)
Date: Thu, 21 Jul 2011 10:34:48 +0530
Subject: [rabbitmq-discuss] Getting stats from celery
Message-ID: <CAJ5t=U5HsPUH7z6ywpbW3=Bp6uC7rW58oenRg+QK1j9JOFEv0w@mail.gmail.com>

Hi,

I want to write a script which will keep track of what tasks have been
submitted and processed and whether the status of the job was Success /
Failure and how much time did each task take to finish. I want to dump these
info in a database so that I can pull out reports now and then about the
performance.

Please give me some cues on how I can proceed on this.

I am using RabbitMQ with Celery in my Python project. Looking forward for
some help.

-- 
-Siddharth Saha
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110721/6b7d0895/attachment.htm>

From abhishek.kona at gmail.com  Thu Jul 21 06:14:49 2011
From: abhishek.kona at gmail.com (Abhishek K)
Date: Thu, 21 Jul 2011 10:44:49 +0530
Subject: [rabbitmq-discuss] Connection Pooling Options to solve FD
 Consumption on RabbitMQ.
In-Reply-To: <CAE3HoVTGCheLtjLC_kB-5QoJAKVON0BOig1RbNeYPWGq0M-YNA@mail.gmail.com>
References: <CAGTBvKtVZo6X6A2P33fC9SpiimhBUCOS+dJNn_ihhB1XBRMfdQ@mail.gmail.com>
	<CAE3HoVTGCheLtjLC_kB-5QoJAKVON0BOig1RbNeYPWGq0M-YNA@mail.gmail.com>
Message-ID: <CAGTBvKtiVMo+P6o6DuchUmf+=fXYdFTc=cd5EDVJyXqGLVPUDQ@mail.gmail.com>

Yes . currently I am creating a connection on each Thrift (similar to HTTP
request).


I am assuming each channel is opening a TCP connection - Is it correct ?
Also should I create a channel from a globale connections instead of
creating connection each time?


-Abhishek Kona



On Thu, Jul 21, 2011 at 1:12 AM, Michael Klishin <
michael.s.klishin at gmail.com> wrote:

> 2011/7/20 Abhishek K <abhishek.kona at gmail.com>
>
>> On each request, I create a new Connection and Channel. During high load
>> times, this is causing the Rabbit to go unresponsive (due to a large no. of
>> open file Descriptor's).
>>
>> This would be solved if I could connection pool on the client side, what
>> are the strategies and API's suggested for that.
>>
>
> Why do you need a new connection on each (HTTP?) request? This is what
> channels are for, if you want to absolutely separate data flowing between on
> each individual request.
> AMQP was designed with the idea of keeping # of TCP connections as low as #
> of applications.
>
> --
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110721/06313ee9/attachment.htm>

From taylste at gmail.com  Thu Jul 21 06:19:23 2011
From: taylste at gmail.com (Steven Taylor)
Date: Thu, 21 Jul 2011 06:19:23 +0100
Subject: [rabbitmq-discuss] Getting stats from celery
In-Reply-To: <CAJ5t=U5HsPUH7z6ywpbW3=Bp6uC7rW58oenRg+QK1j9JOFEv0w@mail.gmail.com>
References: <CAJ5t=U5HsPUH7z6ywpbW3=Bp6uC7rW58oenRg+QK1j9JOFEv0w@mail.gmail.com>
Message-ID: <CA+zYriRen14Zo38j1YCS0-ejCYMZyVHGPasW5HVevJT-qdL+OQ@mail.gmail.com>

a few thoughts:

declare "monitor" queue:
* register task (must be done via RPC)  --> dump to database
* report on status at each stage: started, pending, completed.  --> dump to
database

Why RPC?  Because rabbit guarantees delivery, but not the order in which
messages are delievered in.  RPC at the start ensures that later monitoring
has a context.  It just seems a little tidier.

Let me know if this helps.

btw: I haven't had a chance to look at Celery... so don't know on that.

-Steven





On 21 July 2011 06:04, Siddharth Saha <sidchilling at gmail.com> wrote:

> Hi,
>
> I want to write a script which will keep track of what tasks have been
> submitted and processed and whether the status of the job was Success /
> Failure and how much time did each task take to finish. I want to dump these
> info in a database so that I can pull out reports now and then about the
> performance.
>
> Please give me some cues on how I can proceed on this.
>
> I am using RabbitMQ with Celery in my Python project. Looking forward for
> some help.
>
> --
> -Siddharth Saha
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110721/9b768684/attachment.htm>

From taylste at gmail.com  Thu Jul 21 06:21:15 2011
From: taylste at gmail.com (Steven Taylor)
Date: Thu, 21 Jul 2011 06:21:15 +0100
Subject: [rabbitmq-discuss] Getting stats from celery
In-Reply-To: <CA+zYriRen14Zo38j1YCS0-ejCYMZyVHGPasW5HVevJT-qdL+OQ@mail.gmail.com>
References: <CAJ5t=U5HsPUH7z6ywpbW3=Bp6uC7rW58oenRg+QK1j9JOFEv0w@mail.gmail.com>
	<CA+zYriRen14Zo38j1YCS0-ejCYMZyVHGPasW5HVevJT-qdL+OQ@mail.gmail.com>
Message-ID: <CA+zYriRHTh4qQD+vsfVwAYbOvmPS0ZKpppT5N5bYHcsmBnP1fw@mail.gmail.com>

btw: ---->  was supposed to mean "send over queue" to a consumer... just
making that clear.

On 21 July 2011 06:19, Steven Taylor <taylste at gmail.com> wrote:

> a few thoughts:
>
> declare "monitor" queue:
> * register task (must be done via RPC)  --> dump to database
> * report on status at each stage: started, pending, completed.  --> dump to
> database
>
> Why RPC?  Because rabbit guarantees delivery, but not the order in which
> messages are delievered in.  RPC at the start ensures that later monitoring
> has a context.  It just seems a little tidier.
>
> Let me know if this helps.
>
> btw: I haven't had a chance to look at Celery... so don't know on that.
>
> -Steven
>
>
>
>
>
> On 21 July 2011 06:04, Siddharth Saha <sidchilling at gmail.com> wrote:
>
>> Hi,
>>
>> I want to write a script which will keep track of what tasks have been
>> submitted and processed and whether the status of the job was Success /
>> Failure and how much time did each task take to finish. I want to dump these
>> info in a database so that I can pull out reports now and then about the
>> performance.
>>
>> Please give me some cues on how I can proceed on this.
>>
>> I am using RabbitMQ with Celery in my Python project. Looking forward for
>> some help.
>>
>> --
>> -Siddharth Saha
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110721/c66bd442/attachment.htm>

From matthias at rabbitmq.com  Thu Jul 21 07:31:01 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 21 Jul 2011 07:31:01 +0100
Subject: [rabbitmq-discuss] Patching rabbitmq to get more information
 about framing exceptions
In-Reply-To: <CAE3HoVSG-cQs+bdwRiUc8gPgX3Yn9-QMjmpKeVn1SQ269z8-WA@mail.gmail.com>
References: <CAE3HoVRoV19iC511vE2vFL3ifQGg_DkF37OedMwXQhyD0WMfJA@mail.gmail.com>
	<4E275030.9030908@rabbitmq.com>
	<CAE3HoVRWXQx1H=SHAVNq-gH5yTGoavqxfAQq1YmVJf=z_DoJSA@mail.gmail.com>
	<4E2757CC.6080701@rabbitmq.com>
	<CAE3HoVSG-cQs+bdwRiUc8gPgX3Yn9-QMjmpKeVn1SQ269z8-WA@mail.gmail.com>
Message-ID: <4E27C7A5.10008@rabbitmq.com>

Michael,

On 21/07/11 03:51, Michael Klishin wrote:
> So far I narrowed it down to the "empty messages" problem: whenever
> there is an empty message sent by amqp gem master version, RabbitMQ
> doesn't consider it a complete message and thus clients do not get
> anything. With a simple script that terminates as soon as the message is
> received
> (by the same process), this looks like app is hanging. In the context of
> a larger application, sometimes there are empty messages transmitted (I
> am streaming a stdout output).
>
> After comparing 2 clients I see the following picture: the data
> transmitted is exactly the same, frame order is correct but Wireshark
> GUI suggests that
> one client transmits 3 frames as 3 IP packets. In this case, RabbitMQ is
> happy. The other transmits them all in a single IP packet and RabbitMQ
> doesn't seem to recognize it as a complete message.
>
> Here are two Wireshark session exports:
> https://gist.github.com/1096404
>
> If the [frames] content is the same, what may be going on here?

That's curious. Both should cause rabbit to complain with the "expected 
method frame, got non method frame instead" error. Are you sure you are 
seeing different behaviour here? If so, please send through the pcap 
files showing the entire tcp session.

Content body frames should never be zero length. If the content length 
is zero then no content body frame should be sent at all, just a header.


Matthias.

From ask at rabbitmq.com  Thu Jul 21 10:27:41 2011
From: ask at rabbitmq.com (Ask Solem)
Date: Thu, 21 Jul 2011 10:27:41 +0100
Subject: [rabbitmq-discuss] Getting stats from celery
In-Reply-To: <CAJ5t=U5HsPUH7z6ywpbW3=Bp6uC7rW58oenRg+QK1j9JOFEv0w@mail.gmail.com>
References: <CAJ5t=U5HsPUH7z6ywpbW3=Bp6uC7rW58oenRg+QK1j9JOFEv0w@mail.gmail.com>
Message-ID: <A06A3892-FCB8-459A-9A87-3DF749CB68A2@rabbitmq.com>


On 21 Jul 2011, at 06:04, Siddharth Saha wrote:

> Hi,
> 
> I want to write a script which will keep track of what tasks have been submitted and processed and whether the status of the job was Success / Failure and how much time did each task take to finish. I want to dump these info in a database so that I can pull out reports now and then about the performance.
> 
> Please give me some cues on how I can proceed on this.
> 
> I am using RabbitMQ with Celery in my Python project. Looking forward for some help.
> 

Hey,

Have you not seen the django-celery monitor?
It does exactly what you describe:

http://docs.celeryproject.org/en/latest/userguide/monitoring.html#django-admin-monitor


From sidchilling at gmail.com  Thu Jul 21 10:29:01 2011
From: sidchilling at gmail.com (Siddharth Saha)
Date: Thu, 21 Jul 2011 14:59:01 +0530
Subject: [rabbitmq-discuss] Getting stats from celery
In-Reply-To: <A06A3892-FCB8-459A-9A87-3DF749CB68A2@rabbitmq.com>
References: <CAJ5t=U5HsPUH7z6ywpbW3=Bp6uC7rW58oenRg+QK1j9JOFEv0w@mail.gmail.com>
	<A06A3892-FCB8-459A-9A87-3DF749CB68A2@rabbitmq.com>
Message-ID: <CAJ5t=U6pYoMDZtCrFVg9+TtUZrhgDQsusaYBTZ=bYzRAuu33LA@mail.gmail.com>

Unfortunately, I am not doing a Django project and don't want any
dependencies on Django. Any API library using which I can write my own small
customized script ?

On Thu, Jul 21, 2011 at 2:57 PM, Ask Solem <ask at rabbitmq.com> wrote:

>
> On 21 Jul 2011, at 06:04, Siddharth Saha wrote:
>
> > Hi,
> >
> > I want to write a script which will keep track of what tasks have been
> submitted and processed and whether the status of the job was Success /
> Failure and how much time did each task take to finish. I want to dump these
> info in a database so that I can pull out reports now and then about the
> performance.
> >
> > Please give me some cues on how I can proceed on this.
> >
> > I am using RabbitMQ with Celery in my Python project. Looking forward for
> some help.
> >
>
> Hey,
>
> Have you not seen the django-celery monitor?
> It does exactly what you describe:
>
>
> http://docs.celeryproject.org/en/latest/userguide/monitoring.html#django-admin-monitor
>
>


-- 
-Siddharth Saha
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110721/6cec8939/attachment.htm>

From ask at rabbitmq.com  Thu Jul 21 10:34:40 2011
From: ask at rabbitmq.com (Ask Solem)
Date: Thu, 21 Jul 2011 10:34:40 +0100
Subject: [rabbitmq-discuss] Getting stats from celery
In-Reply-To: <CAJ5t=U6pYoMDZtCrFVg9+TtUZrhgDQsusaYBTZ=bYzRAuu33LA@mail.gmail.com>
References: <CAJ5t=U5HsPUH7z6ywpbW3=Bp6uC7rW58oenRg+QK1j9JOFEv0w@mail.gmail.com>
	<A06A3892-FCB8-459A-9A87-3DF749CB68A2@rabbitmq.com>
	<CAJ5t=U6pYoMDZtCrFVg9+TtUZrhgDQsusaYBTZ=bYzRAuu33LA@mail.gmail.com>
Message-ID: <FE85C2A8-D931-499F-8B5A-6606265E7A0C@rabbitmq.com>


On 21 Jul 2011, at 10:29, Siddharth Saha wrote:

> Unfortunately, I am not doing a Django project and don't want any dependencies on Django. Any API library using which I can write my own small customized script ? 
> 


The code to do this is mostly part of Celery itself, django-celery just writes
it to a Django model:

https://github.com/ask/django-celery/blob/master/djcelery/snapshot.py

From simon at rabbitmq.com  Thu Jul 21 10:35:18 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 21 Jul 2011 10:35:18 +0100
Subject: [rabbitmq-discuss] What is the server-name to get
	the	rabbitmqadmin
In-Reply-To: <CAE3HoVRBMdR=E1P_z8_NJ5sWYkvTDHUkCqJNKojk+9Yo54LbaA@mail.gmail.com>
References: <32102103.post@talk.nabble.com>
	<CAE3HoVRBMdR=E1P_z8_NJ5sWYkvTDHUkCqJNKojk+9Yo54LbaA@mail.gmail.com>
Message-ID: <4E27F2D6.4050706@rabbitmq.com>

On 21/07/11 02:21, Michael Klishin wrote:

> 2011/7/20 albert_newton <myname.whatis at gmail.com
> <mailto:myname.whatis at gmail.com>>
>
>     Anyone have any idea about this?
>
>
>
> If RabbitMQ is running locally, then localhost. Or whatever hostname you
> bound RabbitMQ to.

The page documenting rabbitmqadmin also has a direct link to download 
the latest version:

http://www.rabbitmq.com/management-cli.html

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Thu Jul 21 10:56:26 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 21 Jul 2011 10:56:26 +0100
Subject: [rabbitmq-discuss] Reading multiple messages in RabbitMQ
In-Reply-To: <CAJE2eFFQk1=NYHfWhhg3=KC8_JWwazcokgeiSNXGyQ6iCE7t-Q@mail.gmail.com>
References: <CAJE2eFFQk1=NYHfWhhg3=KC8_JWwazcokgeiSNXGyQ6iCE7t-Q@mail.gmail.com>
Message-ID: <4E27F7CA.1020901@rabbitmq.com>

Hi Demiss,

On 20/07/11 15:50, Demi Zike wrote:
> Hi,
> 
> I use Subscription from the RabbitMQ.Client.MessagePatterns namespace to
> subscribe to multiple queues. I then read messages based on the
> subscription (code below). However, I am not able to read messages other
> than the first one.

I assume that element.Next() is blocking on one of the subscriptions.
You could retrieve deliveries from each subscription with a timeout to
read past it. Alternatively you could set up a single queue to receive
all measurements and retrieve messages from it with a single subscription.

The best setup will depend on how frequently measurements are expected,
whether they are correlated, whether other consumers also need to
observe them, and so on. A list of subscriptions is probably not ideal
in most cases.


-Emile

From clint at rtcreativegroup.com  Wed Jul 20 21:45:38 2011
From: clint at rtcreativegroup.com (Clint Miller)
Date: Wed, 20 Jul 2011 15:45:38 -0500
Subject: [rabbitmq-discuss] RabbitMQ-C: amqp_simple_rpc blocks waiting for
	frames already received
Message-ID: <3B42E373-F4A9-48DB-997F-FFB9EEB9901D@rtcreativegroup.com>

Hi,

I'm having a little trouble with the RabbitMQ-C library. I'm able to declare exchanges, queues, setup bindings, and start the basic.consume (amqp_simple_rpc function) method as I would expect. But when a message is received by the consumer, I am able to observe (via the debugger) the complete message (all the frames) being processed. However, loop where multiple frames are linked together in the amqp_simple_rpc function (labeled "retry:") never terminates, and thus, at the end of what I think is a correct processing of all the frames in the message, control goes back into the wait_frame_inner function, where the recv function is called, anticipating more raw data on the socket that isn't going to arrive.

Do I have a correct (basic) understanding of how the amqp_simple_rpc is supposed to be working? 

I am using the current tip (ef4df46cc0db) of the repository, default branch in the repo. RabbitMQ 2.4.1.

Thanks,

Clint Miller

From fangbot at gmail.com  Wed Jul 20 23:26:00 2011
From: fangbot at gmail.com (fangbot)
Date: Wed, 20 Jul 2011 15:26:00 -0700 (PDT)
Subject: [rabbitmq-discuss]  Consumer Callback
Message-ID: <32103305.post@talk.nabble.com>


I'm looking to create multiple publishers/subscribers from the main thread
that my program is run (i.e. the thread where I have declared my channel).
It seems that in the tutorials, the only way for consumers to get a message
from the queue its connected to is to explicitly call
consumer.nextDelivery(). However, as far as my understanding, in order to
constantly check for new publications, this call must reside within a
while(true) loop. 

Say I wanted to create a consumer with an anonymous queue and attach it to
an exchange. Then, I want to make a publication to that exchange. When that
publication is made, the consumer will print something to the console using
an overridden nextDelivery(). In order to do this, do I have to basically

1. Create the consumer/queue and attach it with a routingId to the exchange
2. Publish a method with that routingId to the exchange
3. Invoke the while loop to constantly check for messages

in that order?

If so, then is there a way to support two (or more) consumers to
automatically get nextDelivery? It seems that the only way is to write a
while loop that goes through every consumer, and calls nextDelivery on that
consumer, in an infinite loop. Instead, is there a way to create an event
such that when a queue gets pushed a message, it automatically calls
consumer.nextDelivery somehow?

Thanks in advance for the reply. I'm fairly new to RabbitMQ, so please
forgive me if the question is somewhat basic/has already been answered
elsewhere :-D.
-- 
View this message in context: http://old.nabble.com/Consumer-Callback-tp32103305p32103305.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From michael.s.klishin at gmail.com  Thu Jul 21 11:15:12 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 21 Jul 2011 14:15:12 +0400
Subject: [rabbitmq-discuss] Patching rabbitmq to get more information
 about framing exceptions
In-Reply-To: <4E27C7A5.10008@rabbitmq.com>
References: <CAE3HoVRoV19iC511vE2vFL3ifQGg_DkF37OedMwXQhyD0WMfJA@mail.gmail.com>
	<4E275030.9030908@rabbitmq.com>
	<CAE3HoVRWXQx1H=SHAVNq-gH5yTGoavqxfAQq1YmVJf=z_DoJSA@mail.gmail.com>
	<4E2757CC.6080701@rabbitmq.com>
	<CAE3HoVSG-cQs+bdwRiUc8gPgX3Yn9-QMjmpKeVn1SQ269z8-WA@mail.gmail.com>
	<4E27C7A5.10008@rabbitmq.com>
Message-ID: <CAE3HoVTYd=O132G3_mDFRQJPeAyfALhgMkJ_HfyjCC4z4J2BuA@mail.gmail.com>

2011/7/21 Matthias Radestock <matthias at rabbitmq.com>

>
> That's curious. Both should cause rabbit to complain with the "expected
> method frame, got non method frame instead" error. Are you sure you are
> seeing different behaviour here? If so, please send through the pcap files
> showing the entire tcp session.
>

Yes, I am very much sure. I have spent hours investigating this thing and
ran it probably hundreds of times. Will do.


>
> Content body frames should never be zero length. If the content length is
> zero then no content body frame should be sent at all, just a header.


Ah, yes, I read this line in the spec but then the fact that another Ruby
client that *also sends an empty content body frame* works fine confused me.

So for a blank string payload, the sequence is always

[method frame] [content header frame]

not

[method frame] [content header frame] [content body frame with size = 0]

correct?
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110721/9c1cd2f8/attachment.htm>

From matthias at rabbitmq.com  Thu Jul 21 11:21:35 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 21 Jul 2011 11:21:35 +0100
Subject: [rabbitmq-discuss] Patching rabbitmq to get more information
 about framing exceptions
In-Reply-To: <CAE3HoVTYd=O132G3_mDFRQJPeAyfALhgMkJ_HfyjCC4z4J2BuA@mail.gmail.com>
References: <CAE3HoVRoV19iC511vE2vFL3ifQGg_DkF37OedMwXQhyD0WMfJA@mail.gmail.com>
	<4E275030.9030908@rabbitmq.com>
	<CAE3HoVRWXQx1H=SHAVNq-gH5yTGoavqxfAQq1YmVJf=z_DoJSA@mail.gmail.com>
	<4E2757CC.6080701@rabbitmq.com>
	<CAE3HoVSG-cQs+bdwRiUc8gPgX3Yn9-QMjmpKeVn1SQ269z8-WA@mail.gmail.com>
	<4E27C7A5.10008@rabbitmq.com>
	<CAE3HoVTYd=O132G3_mDFRQJPeAyfALhgMkJ_HfyjCC4z4J2BuA@mail.gmail.com>
Message-ID: <4E27FDAF.3010202@rabbitmq.com>

On 21/07/11 11:15, Michael Klishin wrote:
> So for a blank string payload, the sequence is always
>
> [method frame] [content header frame]
>
> not
>
> [method frame] [content header frame] [content body frame with size = 0]
>
> correct?

Correct.

Matthias.

From david at rabbitmq.com  Thu Jul 21 11:50:32 2011
From: david at rabbitmq.com (David Wragg)
Date: Thu, 21 Jul 2011 11:50:32 +0100
Subject: [rabbitmq-discuss] RabbitMQ-C: amqp_simple_rpc blocks waiting
	for frames already received
In-Reply-To: <3B42E373-F4A9-48DB-997F-FFB9EEB9901D@rtcreativegroup.com> (Clint
	Miller's message of "Wed, 20 Jul 2011 15:45:38 -0500")
References: <3B42E373-F4A9-48DB-997F-FFB9EEB9901D@rtcreativegroup.com>
Message-ID: <yrv4cwrfbvrev.fsf@dwragg.eng.vmware.com>

Clint Miller <clint at rtcreativegroup.com> writes:
> I'm having a little trouble with the RabbitMQ-C library. I'm able to
> declare exchanges, queues, setup bindings, and start the basic.consume
> (amqp_simple_rpc function) method as I would expect.

You are calling the amqp_basic_*, amqp_queue_* and amqp_exchange_*
functions, right?  amqp_simple_rpc is best thought of as an internal
function, and calling it directly should never be necessary these days.
None of the sample code in the tools/ and examples/ directories uses it.

> But when a message is received by the consumer, I am able to observe
> (via the debugger) the complete message (all the frames) being
> processed. However, loop where multiple frames are linked together in
> the amqp_simple_rpc function (labeled "retry:") never terminates, and
> thus, at the end of what I think is a correct processing of all the
> frames in the message, control goes back into the wait_frame_inner
> function, where the recv function is called, anticipating more raw
> data on the socket that isn't going to arrive.

amqp_simple_rpc doesn't process incoming messages.  If it gets an
incoming frame that doesn't relate to the method, it stashes that frame
away for later handling, and waits for the next frame (as the reply
method frame should arrive sooner or later).

To consume messages via basic.get, use amqp_basic_get and then
amqp_simple_wait_frame to receive the body (see tools/get.c).

To consume messages via basic.consume, use amqp_basic_consume and then
call amqp_simple_wait_frame in a loop (see tools/consume.c and
examples/amqp_consumer.c).

-- 
David Wragg
Staff Engineer, RabbitMQ
VMware, Inc.

From emile at rabbitmq.com  Thu Jul 21 11:50:44 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 21 Jul 2011 11:50:44 +0100
Subject: [rabbitmq-discuss] publish/suscribe model with typed consumers
In-Reply-To: <CA+zYriSSf9UJjo6_Sh8NC5gG43fHtnAMtEfVZO9LJ=t3+ryLKg@mail.gmail.com>
References: <E9FBE39960CDBF4A8CD9DE7E9D14C509126B73A729@Y000IMRV01.rd1.rf1>	<4DF1F963.7080603@rabbitmq.com>
	<CA+zYriSSf9UJjo6_Sh8NC5gG43fHtnAMtEfVZO9LJ=t3+ryLKg@mail.gmail.com>
Message-ID: <4E280484.6020506@rabbitmq.com>

Hi Steve,

It is already possible to use the QueueingBasicConsumer in the .net
client to consume from multiple queues in the same way as you can with
the Java client.

You rightly point out that the Subscription class in its current form is
not able to consume from multiple queues.

-Emile

On 21/07/11 05:12, Steven Taylor wrote:
> will you be extending this functionality to the .net client?  Is it
> there already?  btw: I'm fielding a question from the wider community on
> this for a c# client.  Personally, it's something I've needed in the
> past, but not something I need right now.
>  
> My reading of the spec was it is possible (confirmed by this thread),
> but of the Subscriber class source code in .net is no, it is only set up
> for one queue.
>  
> thanks,
> -Steven
> 
> On 10 June 2011 12:00, Matthias Radestock <matthias at rabbitmq.com
> <mailto:matthias at rabbitmq.com>> wrote:
> 
>     Pierre-Marie,
> 
> 
>     On 10/06/11 11:15, PADIOU Pierre-Marie (MORPHO) wrote:
> 
>         For now, the only solution I see would be to create as many
>         queues as requests
>         types (queueA, queueB, etc), and make consumer listen to the
>         appropriate
>         queues.
> 
>         Thing is:
> 
>         - this implies that consumers create as many threads as queues
>         there are
>         listening from (more than a hundred in my case), which I would
>         like to
>         avoid.
> 
> 
>     Which client are you using? Java? If so, a single consumer thread
>     can happily consume from multiple queues. E.g. you can pass a single
>     QueuingConsumer instance to multiple ch.basicConsume(...) invocations.
> 
> 
>     Regards,
> 
>     Matthias.

From taylste at gmail.com  Thu Jul 21 12:12:41 2011
From: taylste at gmail.com (Steven Taylor)
Date: Thu, 21 Jul 2011 12:12:41 +0100
Subject: [rabbitmq-discuss] Celery access from .net
Message-ID: <CA+zYriSbOSaRu-+ysMgo1FsE3wrzUSd6XZ4vx0gwarXG+aUzeA@mail.gmail.com>

yep... replied to the wrong thread.  Oops.  Didn't make much sense of the
Celery docs.  I know RabbitMQ has nothing to do with it

Mind if I paste a link in here to remind myself?

http://docs.celeryproject.org/en/latest/userguide/remote-tasks.html

My only thoughts is... perhaps the better option for me would be to compile
under Iron Python + then hook into the API with C#.

Probably my preference will be *still* be to build my own.  Perhaps Celery
can delay this.

thanks,
-Steven
On 21 July 2011 11:15, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 21/07/11 11:11, Steven Taylor wrote:
>
>> is there a link to show what a message task status updates should look
>> like?  Is this format in json?
>>
>
> Hi Steven. It sounds like you're asking about celery - rabbitmqadmin is
> nothing to do with celery; it's a CLI to the management plugin. All the HTTP
> responses that come back are JSON, but rabbitmqadmin can render them in a
> variety of ways.
>
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110721/acb23d18/attachment.htm>

From michael.s.klishin at gmail.com  Thu Jul 21 12:28:18 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 21 Jul 2011 15:28:18 +0400
Subject: [rabbitmq-discuss] Patching rabbitmq to get more information
 about framing exceptions
In-Reply-To: <4E27FDAF.3010202@rabbitmq.com>
References: <CAE3HoVRoV19iC511vE2vFL3ifQGg_DkF37OedMwXQhyD0WMfJA@mail.gmail.com>
	<4E275030.9030908@rabbitmq.com>
	<CAE3HoVRWXQx1H=SHAVNq-gH5yTGoavqxfAQq1YmVJf=z_DoJSA@mail.gmail.com>
	<4E2757CC.6080701@rabbitmq.com>
	<CAE3HoVSG-cQs+bdwRiUc8gPgX3Yn9-QMjmpKeVn1SQ269z8-WA@mail.gmail.com>
	<4E27C7A5.10008@rabbitmq.com>
	<CAE3HoVTYd=O132G3_mDFRQJPeAyfALhgMkJ_HfyjCC4z4J2BuA@mail.gmail.com>
	<4E27FDAF.3010202@rabbitmq.com>
Message-ID: <CAE3HoVSXvEtzJXKmrfwHGf6iv7JL2dduc7s+hKWu15VYupXREw@mail.gmail.com>

2011/7/21 Matthias Radestock <matthias at rabbitmq.com>

> On 21/07/11 11:15, Michael Klishin wrote:
>
>> So for a blank string payload, the sequence is always
>>
>> [method frame] [content header frame]
>>
>> not
>>
>> [method frame] [content header frame] [content body frame with size = 0]
>>
>> correct?
>>
>
> Correct.


Thanks Matthias. This was a one-line fix and it makes multiple issues that I
has been investigating for some time go away.
New amq-protocol gem release is on its way to rubygems.org.

I am going to send you pcap dumps that demonstrate the aforementioned rabbit
behavior with respect to # of IP packets
later today or tomorrow.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110721/aa51219b/attachment.htm>

From ask at rabbitmq.com  Thu Jul 21 12:41:15 2011
From: ask at rabbitmq.com (Ask Solem)
Date: Thu, 21 Jul 2011 12:41:15 +0100
Subject: [rabbitmq-discuss] Celery access from .net
In-Reply-To: <CA+zYriSbOSaRu-+ysMgo1FsE3wrzUSd6XZ4vx0gwarXG+aUzeA@mail.gmail.com>
References: <CA+zYriSbOSaRu-+ysMgo1FsE3wrzUSd6XZ4vx0gwarXG+aUzeA@mail.gmail.com>
Message-ID: <A6319B0B-204F-4AF7-8647-EA448303640F@rabbitmq.com>


On 21 Jul 2011, at 12:12, Steven Taylor wrote:

> yep... replied to the wrong thread.  Oops.  Didn't make much sense of the Celery docs.  I know RabbitMQ has nothing to do with it
>  
> Mind if I paste a link in here to remind myself?
>  
> http://docs.celeryproject.org/en/latest/userguide/remote-tasks.html
>  
> My only thoughts is... perhaps the better option for me would be to compile under Iron Python + then hook into the API with C#.
>  
> Probably my preference will be *still* be to build my own.  Perhaps Celery can delay this.
>  


I don't understand what it is you want to do from .Net.

Do you want to publish task messages from .net to Celery, or something else?

From taylste at gmail.com  Thu Jul 21 12:54:53 2011
From: taylste at gmail.com (Steven Taylor)
Date: Thu, 21 Jul 2011 12:54:53 +0100
Subject: [rabbitmq-discuss] Celery access from .net
In-Reply-To: <A6319B0B-204F-4AF7-8647-EA448303640F@rabbitmq.com>
References: <CA+zYriSbOSaRu-+ysMgo1FsE3wrzUSd6XZ4vx0gwarXG+aUzeA@mail.gmail.com>
	<A6319B0B-204F-4AF7-8647-EA448303640F@rabbitmq.com>
Message-ID: <CA+zYriSdCWvSzQWBnCfUDTZAsH-0FKoCMQ3Qo4WXsbX0rf=MJg@mail.gmail.com>

"Do you want to publish task messages from .net to Celery, or something
else?"

yes, I want to publish task messages from .net to Celery and see what
Celery is like to work with.  Preferably I'd like to use RabbitMQ for
connectivity rather than http hooks.  I'm not a Python person (can you
tell?)

thanks,
-Steven
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110721/da30c07f/attachment.htm>

From ask at rabbitmq.com  Thu Jul 21 13:05:53 2011
From: ask at rabbitmq.com (Ask Solem)
Date: Thu, 21 Jul 2011 13:05:53 +0100
Subject: [rabbitmq-discuss] Celery access from .net
In-Reply-To: <CA+zYriSdCWvSzQWBnCfUDTZAsH-0FKoCMQ3Qo4WXsbX0rf=MJg@mail.gmail.com>
References: <CA+zYriSbOSaRu-+ysMgo1FsE3wrzUSd6XZ4vx0gwarXG+aUzeA@mail.gmail.com>
	<A6319B0B-204F-4AF7-8647-EA448303640F@rabbitmq.com>
	<CA+zYriSdCWvSzQWBnCfUDTZAsH-0FKoCMQ3Qo4WXsbX0rf=MJg@mail.gmail.com>
Message-ID: <B53AF34B-8094-466E-A24F-CA8902F12ED5@rabbitmq.com>


On 21 Jul 2011, at 12:54, Steven Taylor wrote:

> "Do you want to publish task messages from .net to Celery, or something else?"
>  
> yes, I want to publish task messages from .net to Celery and see what Celery is like to work with.  Preferably I'd like to use RabbitMQ for connectivity rather than http hooks.  I'm not a Python person (can you tell?)
>  


Ah!  This is certainly possible,
see e.g. http://www.toforge.com/2011/01/run-celery-tasks-from-php/

See also http://ask.github.com/celery/internals/protocol.html#task-messages


From joseph.a.marlin at gmail.com  Thu Jul 21 13:34:28 2011
From: joseph.a.marlin at gmail.com (Joseph Marlin)
Date: Thu, 21 Jul 2011 05:34:28 -0700 (PDT)
Subject: [rabbitmq-discuss] What is the server-name to get the
 rabbitmqadmin
In-Reply-To: <32102103.post@talk.nabble.com>
Message-ID: <5560061.3140.1311251668498.JavaMail.geo-discussion-forums@yqdx5>

Just using the IP of the machine should work.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110721/7d683768/attachment.htm>

From james at 2600hz.com  Thu Jul 21 14:11:34 2011
From: james at 2600hz.com (James Aimonetti)
Date: Thu, 21 Jul 2011 06:11:34 -0700
Subject: [rabbitmq-discuss] Channel takes everyone down
Message-ID: <4E282586.5020108@2600hz.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

>Really though, why would your processes be exiting with a non-normal
>reason? That suggests some sort of crash/bug and thus tearing down the
>connection _could_ be considered the right thing to do. One way around
>this though would be to use several connections rather than several
>channels.

I have many consumers that listen for a given type of request. They
spawn handlers for each request to see if they should handle this
particular request. Those handlers will exit non-normally because there
are a lot of pattern-matching-as-assertion lines to make sure the
handler is processing a request it knows how to respond to, a la "let it
crash". We have redundancy in the cluster so that segment A that has
clients A-M and segment B with clients N-Z (not really how its done)
will both receive a call for client P. Both segments will spawn at least
two handlers for the call each, but those handlers on segment A will
crash pretty quickly, while segment B will happily process the
particular call.

Mmore specifically, for example, there is a listener for incoming
telephone calls that spawns a handler for that particular call-id.
Events for that call are published with the routing key
call.event.CALLID. This listener can crash for a variety of reasons,
valid or not, but those moments it was out of service mean it can't know
the state of the call (having a durable queue store those messages isn't
an option because we run primarily with ram_nodes since we want to be
able to put this on an embedded device that may not have a hard-drive,
or may have a flash-card which we want to avoid writing to).

Each call handler has a channel to consume over, but since call handlers
can live a few milliseconds or a few minutes or even hours (depending on
how long the call lasts), I've found it hard to simulate various call
volumes to track down when and why my channel/consumer monitoring
process "orphans" a channel (the consumer goes down but the channel
isn't closed). So my quick fix was to link them directly.

I've stayed away from multiple connections as I thought channels were a
lighter-weight concept than connections. One day, I'd like to see if we
can't increase throughput by having multiple connections as well, but
for now what we have serves us well. And, like I said, this issue is
relatively easy to clean up manually and only becomes a problem after
weeks of running, but when we hit the embedded device phase, our memory
constraints will start to expose these types of leaks faster.

Sorry for the ramble. Will be watching for those updates!

Take care,

James

- -- 
James Aimonetti
Distributed Systems Engineer / DJ MC_

2600hz | http://2600hz.com
sip:james at 2600hz.com
tel: 415.886.7905
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iQEcBAEBAgAGBQJOKCWGAAoJENc77s1OYoGgHdoIAK0bjjm3ZWArxzkVuih3WcmL
weWry4wBpLZ1stc+JzLBoFYgzdPVeGO+1BHC1pkkqrygd1YMYgpCn8NRuIxpFpbE
D9QjwsNz+eMJAiBR+PCHt96PEYi7W29w0wjoTSvMdZWsXro1FMWIu0cYslJ1zcgd
BA6xoNEBPj1CpOCFsbT3RkBpr130lpd14KLHl2N//LQPm7GdkTF3IXCwuuK5xcFI
1saTYM7X1aPTt1Bzf6q7HFIJsB528Pm1b6kyaNuhLvacz0psUMYGe8RTnutGDRtV
c5eZAKNk7jmBrFDgk6GNZBLKXzOe1F5pAu2zb+U8d4KPDWkGiB8g7E45LZcUKo0=
=fBi6
-----END PGP SIGNATURE-----

From msteele at beringmedia.com  Thu Jul 21 14:15:02 2011
From: msteele at beringmedia.com (Mark Steele)
Date: Thu, 21 Jul 2011 09:15:02 -0400
Subject: [rabbitmq-discuss] SSL errors
In-Reply-To: <4E2729C8.50208@rabbitmq.com>
References: <CAH24rBNVqqfa4zWA_3+E3c94o+aOUObKOvSS6jp34ni92=H0DA@mail.gmail.com>
	<4E2729C8.50208@rabbitmq.com>
Message-ID: <CAH24rBNeASyTJZLeYF4gqjBAW4iJkYmaCQKZfWtxT8sFJ1F1VQ@mail.gmail.com>

Matthias,

Does this interfere with the client/server communication?

Thanks,

Mark


On Wed, Jul 20, 2011 at 3:17 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Mark,
>
>
> On 20/07/11 20:12, Mark Steele wrote:
>
>> Error in process <0.17086.7> on node 'rabbit at D1750-2' with exit value:
>> {undef,[{ssl_session_cache,**delete,[{9000,<<32 bytes>>}]}]}
>> [...]
>>
>> Any clues on what may cause this?
>>
>> Erlang R14B03, rabbit 2.5.0
>>
>
> That is a known bug in Erlang R14B03. afaik it is pretty harmless in the
> context of rabbitmq, aside from the annoying log entries.
>
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110721/97720134/attachment.htm>

From clint at rtcreativegroup.com  Thu Jul 21 15:09:54 2011
From: clint at rtcreativegroup.com (Clint Miller)
Date: Thu, 21 Jul 2011 09:09:54 -0500
Subject: [rabbitmq-discuss] RabbitMQ-C: amqp_simple_rpc blocks waiting
	for frames already received
In-Reply-To: <yrv4cwrfbvrev.fsf@dwragg.eng.vmware.com>
References: <3B42E373-F4A9-48DB-997F-FFB9EEB9901D@rtcreativegroup.com>
	<yrv4cwrfbvrev.fsf@dwragg.eng.vmware.com>
Message-ID: <85A5068F-EB3B-4841-B453-453D2631D499@rtcreativegroup.com>

Well,

I'm actually using the community supported C++ client available here: https://github.com/akalend/amqpcpp

As best as I can tell, that's the most current/up-to-date version. However, when I'm reading the source, I do see that it DOES NOT call the amqp_basic_* functions. Both the implementations of basic.get and basic.consume use the amqp_simple_rpc function. Is it possible there's a newer version of the C++ client that uses RabbitMQ-C's amqp_basic_* functions? Or do I need to build that myself?

Clint

On Jul 21, 2011, at 5:50 AM, David Wragg wrote:

> Clint Miller <clint at rtcreativegroup.com> writes:
>> I'm having a little trouble with the RabbitMQ-C library. I'm able to
>> declare exchanges, queues, setup bindings, and start the basic.consume
>> (amqp_simple_rpc function) method as I would expect.
> 
> You are calling the amqp_basic_*, amqp_queue_* and amqp_exchange_*
> functions, right?  amqp_simple_rpc is best thought of as an internal
> function, and calling it directly should never be necessary these days.
> None of the sample code in the tools/ and examples/ directories uses it.
> 
>> But when a message is received by the consumer, I am able to observe
>> (via the debugger) the complete message (all the frames) being
>> processed. However, loop where multiple frames are linked together in
>> the amqp_simple_rpc function (labeled "retry:") never terminates, and
>> thus, at the end of what I think is a correct processing of all the
>> frames in the message, control goes back into the wait_frame_inner
>> function, where the recv function is called, anticipating more raw
>> data on the socket that isn't going to arrive.
> 
> amqp_simple_rpc doesn't process incoming messages.  If it gets an
> incoming frame that doesn't relate to the method, it stashes that frame
> away for later handling, and waits for the next frame (as the reply
> method frame should arrive sooner or later).
> 
> To consume messages via basic.get, use amqp_basic_get and then
> amqp_simple_wait_frame to receive the body (see tools/get.c).
> 
> To consume messages via basic.consume, use amqp_basic_consume and then
> call amqp_simple_wait_frame in a loop (see tools/consume.c and
> examples/amqp_consumer.c).
> 
> -- 
> David Wragg
> Staff Engineer, RabbitMQ
> VMware, Inc.
> 


From david at rabbitmq.com  Thu Jul 21 15:22:39 2011
From: david at rabbitmq.com (David Wragg)
Date: Thu, 21 Jul 2011 15:22:39 +0100
Subject: [rabbitmq-discuss] RabbitMQ-C: amqp_simple_rpc blocks waiting
	for frames already received
In-Reply-To: <85A5068F-EB3B-4841-B453-453D2631D499@rtcreativegroup.com> (Clint
	Miller's message of "Thu, 21 Jul 2011 09:09:54 -0500")
References: <3B42E373-F4A9-48DB-997F-FFB9EEB9901D@rtcreativegroup.com>
	<yrv4cwrfbvrev.fsf@dwragg.eng.vmware.com>
	<85A5068F-EB3B-4841-B453-453D2631D499@rtcreativegroup.com>
Message-ID: <yrv4clivrvhlc.fsf@dwragg.eng.vmware.com>

Clint Miller <clint at rtcreativegroup.com> writes:
> I'm actually using the community supported C++ client available here:
> https://github.com/akalend/amqpcpp

I'm afraid I have never looked closely at that client.

> As best as I can tell, that's the most current/up-to-date
> version. However, when I'm reading the source, I do see that it DOES
> NOT call the amqp_basic_* functions. Both the implementations of
> basic.get and basic.consume use the amqp_simple_rpc function. Is it
> possible there's a newer version of the C++ client that uses
> RabbitMQ-C's amqp_basic_* functions? Or do I need to build that
> myself?

The C++ library should certainly be updated to avoid using
amqp_simple_rpc, and use the method-specific API functions instead.  But
that is probably not the source of the problem in itself (those
functions are generated wrappers onto amqp_simple_rpc).

basic.get and basic.consume do involve an amqp_simple_rpc call.  But
then further code is required to actually receive the message or message
deliveries.

Could you construct a minimal program that demonstrates the problem?

-- 
David Wragg
Staff Engineer, RabbitMQ
VMware, Inc.

From clint at rtcreativegroup.com  Thu Jul 21 15:25:38 2011
From: clint at rtcreativegroup.com (Clint Miller)
Date: Thu, 21 Jul 2011 09:25:38 -0500
Subject: [rabbitmq-discuss] RabbitMQ-C: amqp_simple_rpc blocks waiting
	for frames already received
In-Reply-To: <yrv4clivrvhlc.fsf@dwragg.eng.vmware.com>
References: <3B42E373-F4A9-48DB-997F-FFB9EEB9901D@rtcreativegroup.com>
	<yrv4cwrfbvrev.fsf@dwragg.eng.vmware.com>
	<85A5068F-EB3B-4841-B453-453D2631D499@rtcreativegroup.com>
	<yrv4clivrvhlc.fsf@dwragg.eng.vmware.com>
Message-ID: <33F47A2C-3C5C-416F-ADEF-C84106231E5C@rtcreativegroup.com>

Would you want the minimal program to demonstrate the problem via use of the C++ client (as it exists today)?

On Jul 21, 2011, at 9:22 AM, David Wragg wrote:

> Clint Miller <clint at rtcreativegroup.com> writes:
>> I'm actually using the community supported C++ client available here:
>> https://github.com/akalend/amqpcpp
> 
> I'm afraid I have never looked closely at that client.
> 
>> As best as I can tell, that's the most current/up-to-date
>> version. However, when I'm reading the source, I do see that it DOES
>> NOT call the amqp_basic_* functions. Both the implementations of
>> basic.get and basic.consume use the amqp_simple_rpc function. Is it
>> possible there's a newer version of the C++ client that uses
>> RabbitMQ-C's amqp_basic_* functions? Or do I need to build that
>> myself?
> 
> The C++ library should certainly be updated to avoid using
> amqp_simple_rpc, and use the method-specific API functions instead.  But
> that is probably not the source of the problem in itself (those
> functions are generated wrappers onto amqp_simple_rpc).
> 
> basic.get and basic.consume do involve an amqp_simple_rpc call.  But
> then further code is required to actually receive the message or message
> deliveries.
> 
> Could you construct a minimal program that demonstrates the problem?
> 
> -- 
> David Wragg
> Staff Engineer, RabbitMQ
> VMware, Inc.
> 


From david at rabbitmq.com  Thu Jul 21 15:30:02 2011
From: david at rabbitmq.com (David Wragg)
Date: Thu, 21 Jul 2011 15:30:02 +0100
Subject: [rabbitmq-discuss] RabbitMQ-C: amqp_simple_rpc blocks waiting
	for frames already received
In-Reply-To: <33F47A2C-3C5C-416F-ADEF-C84106231E5C@rtcreativegroup.com> (Clint
	Miller's message of "Thu, 21 Jul 2011 09:25:38 -0500")
References: <3B42E373-F4A9-48DB-997F-FFB9EEB9901D@rtcreativegroup.com>
	<yrv4cwrfbvrev.fsf@dwragg.eng.vmware.com>
	<85A5068F-EB3B-4841-B453-453D2631D499@rtcreativegroup.com>
	<yrv4clivrvhlc.fsf@dwragg.eng.vmware.com>
	<33F47A2C-3C5C-416F-ADEF-C84106231E5C@rtcreativegroup.com>
Message-ID: <yrv4chb6fvh91.fsf@dwragg.eng.vmware.com>

Clint Miller <clint at rtcreativegroup.com> writes:
> Would you want the minimal program to demonstrate the problem via use
> of the C++ client (as it exists today)?

Yes, that will be fine.  I'm not sure where the problem lies, but it
will be much easier to work that out from a complete example.

-- 
David Wragg
Staff Engineer, RabbitMQ
VMware, Inc.

From tonygarnockjones+rabbitmq at gmail.com  Thu Jul 21 16:23:27 2011
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Thu, 21 Jul 2011 11:23:27 -0400
Subject: [rabbitmq-discuss] Patching rabbitmq to get more information
 about framing exceptions
In-Reply-To: <CAE3HoVTYd=O132G3_mDFRQJPeAyfALhgMkJ_HfyjCC4z4J2BuA@mail.gmail.com>
References: <CAE3HoVRoV19iC511vE2vFL3ifQGg_DkF37OedMwXQhyD0WMfJA@mail.gmail.com>
	<4E275030.9030908@rabbitmq.com>
	<CAE3HoVRWXQx1H=SHAVNq-gH5yTGoavqxfAQq1YmVJf=z_DoJSA@mail.gmail.com>
	<4E2757CC.6080701@rabbitmq.com>
	<CAE3HoVSG-cQs+bdwRiUc8gPgX3Yn9-QMjmpKeVn1SQ269z8-WA@mail.gmail.com>
	<4E27C7A5.10008@rabbitmq.com>
	<CAE3HoVTYd=O132G3_mDFRQJPeAyfALhgMkJ_HfyjCC4z4J2BuA@mail.gmail.com>
Message-ID: <CAM8fPiTuU_eP-6LS8HtCd8irZM3=KtqJXfj_CzGxJoP6ArxU8w@mail.gmail.com>

On 21 July 2011 06:15, Michael Klishin <michael.s.klishin at gmail.com> wrote:

> Ah, yes, I read this line in the spec but then the fact that another Ruby
> client that *also sends an empty content body frame* works fine confused me.
>

I could have sworn I made a pull-request with this commit
https://github.com/tonyg/amqp/commit/d92a455dcc6763a4495f512f0d74f667354e5a60some
time ago, but I can't for the life of me find it now. Just FTR. It
might be worth comparing with the solution you've adopted.

Regards,
  Tony
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110721/a26e2c18/attachment.htm>

From michael.s.klishin at gmail.com  Thu Jul 21 19:08:04 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 21 Jul 2011 22:08:04 +0400
Subject: [rabbitmq-discuss] Patching rabbitmq to get more information
 about framing exceptions
In-Reply-To: <CAM8fPiTuU_eP-6LS8HtCd8irZM3=KtqJXfj_CzGxJoP6ArxU8w@mail.gmail.com>
References: <CAE3HoVRoV19iC511vE2vFL3ifQGg_DkF37OedMwXQhyD0WMfJA@mail.gmail.com>
	<4E275030.9030908@rabbitmq.com>
	<CAE3HoVRWXQx1H=SHAVNq-gH5yTGoavqxfAQq1YmVJf=z_DoJSA@mail.gmail.com>
	<4E2757CC.6080701@rabbitmq.com>
	<CAE3HoVSG-cQs+bdwRiUc8gPgX3Yn9-QMjmpKeVn1SQ269z8-WA@mail.gmail.com>
	<4E27C7A5.10008@rabbitmq.com>
	<CAE3HoVTYd=O132G3_mDFRQJPeAyfALhgMkJ_HfyjCC4z4J2BuA@mail.gmail.com>
	<CAM8fPiTuU_eP-6LS8HtCd8irZM3=KtqJXfj_CzGxJoP6ArxU8w@mail.gmail.com>
Message-ID: <CAE3HoVT1AJHse8GVTnEn_YSbGBhvzLNjZjtrPAEeL_PUdqx5FA@mail.gmail.com>

2011/7/21 Tony Garnock-Jones <tonygarnockjones+rabbitmq at gmail.com>

> I could have sworn I made a pull-request with this commit
> https://github.com/tonyg/amqp/commit/d92a455dcc6763a4495f512f0d74f667354e5a60some time ago, but I can't for the life of me find it now. Just FTR. It
> might be worth comparing with the solution you've adopted.
>

Tony,

We discovered a separate (although similar) issue: framing on publishing.

From rmurthi at gilt.com  Thu Jul 21 20:18:11 2011
From: rmurthi at gilt.com (Raymond Murthi)
Date: Thu, 21 Jul 2011 15:18:11 -0400
Subject: [rabbitmq-discuss] Slow shutdown issue
Message-ID: <62F8A49C-F4C3-46DA-B451-08C6D9E44B6C@gilt.com>

Hello, 

I am pretty new on RabbitMQ and I am trying to do a stress test on RabbitMQ (v. 2.5.1) using the following properties: 1kb persistent message, nondurable queue, and without any ready consumer (that is, just writing to the queue). However, every time I overload the RAM (13.7GB high watermark) and force RabbitMQ to write to disk, I always experience a very long wait time whenever I want to shutdown the server/stopping the app/purging the queue. The wait time could be over an hour depending on the number of messages I sent (I sent over 5 millions messages). I  also notice that RabbitMQ tries to dump the messages from the memory to the disk (under /msg_store_transient) - since nothing is consumed. 

Is it a common behavior? I read the documentation and it looks like it is (but isn't it too long?). How to kill the process immediately? And why are messages stored under /msg_store_transient instead of /msg_store_persistent? What  is the difference between the two directories? I would like to understand on the memory/disk usage and how messages are stored.

 

Thanks a lot!  
-Ray


From clint at rtcreativegroup.com  Thu Jul 21 23:08:40 2011
From: clint at rtcreativegroup.com (Clint Miller)
Date: Thu, 21 Jul 2011 17:08:40 -0500
Subject: [rabbitmq-discuss] RabbitMQ-C: amqp_simple_rpc blocks waiting
	for frames already received
In-Reply-To: <yrv4chb6fvh91.fsf@dwragg.eng.vmware.com>
References: <3B42E373-F4A9-48DB-997F-FFB9EEB9901D@rtcreativegroup.com>
	<yrv4cwrfbvrev.fsf@dwragg.eng.vmware.com>
	<85A5068F-EB3B-4841-B453-453D2631D499@rtcreativegroup.com>
	<yrv4clivrvhlc.fsf@dwragg.eng.vmware.com>
	<33F47A2C-3C5C-416F-ADEF-C84106231E5C@rtcreativegroup.com>
	<yrv4chb6fvh91.fsf@dwragg.eng.vmware.com>
Message-ID: <E30AE0F2-3D9D-4EF3-8E88-4A51ED60899D@rtcreativegroup.com>

OK, here's the basic example. It shows how the basic.consume method of the C++ library is not functioning correctly, but the basic.get works correctly.

-------------- next part --------------
A non-text attachment was scrubbed...
Name: amqpcpp_example.tar.gz
Type: application/x-gzip
Size: 1022 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110721/2e2fb15d/attachment.bin>
-------------- next part --------------


There's a basic Makefile that will probably require a little tweaking to get it working. It also depends on the 2 following libraries:

- RabbitMQ-C (from the official repository, I built it at rev/changeset ef4df46cc0db)
- AMQPcpp (from https://github.com/akalend/amqpcpp.git I built it at rev/changeset 80b17375f5bed6965acc07477499285b6851c92f)

Thanks,

Clint

On Jul 21, 2011, at 9:30 AM, David Wragg wrote:

> Clint Miller <clint at rtcreativegroup.com> writes:
>> Would you want the minimal program to demonstrate the problem via use
>> of the C++ client (as it exists today)?
> 
> Yes, that will be fine.  I'm not sure where the problem lies, but it
> will be much easier to work that out from a complete example.
> 
> -- 
> David Wragg
> Staff Engineer, RabbitMQ
> VMware, Inc.
> 


From chakhedik at gmail.com  Fri Jul 22 03:48:29 2011
From: chakhedik at gmail.com (Chak Hedik)
Date: Thu, 21 Jul 2011 19:48:29 -0700 (PDT)
Subject: [rabbitmq-discuss] Frequently getting {badmatch, {error,
 einval} from one of my rabbimq nodes
In-Reply-To: <73926954-e458-4bc2-90e6-a490c69ce8f3@v11g2000prn.googlegroups.com>
References: <bb1ddfc2-0886-485e-8a02-09434ce92c53@t8g2000prm.googlegroups.com>
	<20110720211414.GB12886@dakota>
	<73926954-e458-4bc2-90e6-a490c69ce8f3@v11g2000prn.googlegroups.com>
Message-ID: <67be1e43-db8e-4069-9354-502a1c04d294@p29g2000pre.googlegroups.com>

Hi Alex,

Seems like this error is still there and it seems like either it
occurred when worker entering the loop and send another message to the
same queue within the loop or occurred when function retry, means
function call itself for a retry (pretty much like loop also).

Thanks,
Chak

On Jul 21, 6:40?am, Chak Hedik <chakhe... at gmail.com> wrote:
> Hi Alex,
>
> *Ubuntu Server 11.04 64-Bit
> *RabbitMQ 2.3.1 (Default ubuntu package)
> *Erlang Client 2.3.1 (Default ubuntu package)
> *Erlang R13B03 (Default ubuntu package)
>
> Is there something in the server logs that corresponds to this error?
> - That's the only thing appeared in the logs.
>
> You say your other nodes don't have similar issues. ?Is there
> something
> special about this node?
> - Nothing special, pretty much the same but handle more messages than
> others. 1 worker handling 1 queue.
>
> It is strange behaviour and it happen at the very beginning where the
> worker up for the first time (no message in queue yet). I've created
> another node and put this worker there and will wait and see if
> similar error appear again or not today.
>
> Thanks for your reply.
>
> Chak
>
> On Jul 21, 5:14?am, Alexandru Scvor?ov <alexan... at rabbitmq.com> wrote:
>
>
>
>
>
>
>
> > Hi Chak,
>
> > Could you please answer the following questions:
> > * What OS are you using?
> > * What version of RabbitMQ?
> > * What version of the Erlang client?
> > * What version of Erlang?
>
> > > ** Reason for termination ==
> > > ** {{badmatch,{error,einval}},
> > > ? ? [{amqp_main_reader,handle_inet_async,2},
> > > ? ? ?{gen_server,handle_msg,5},
> > > ? ? ?{proc_lib,init_p_do_apply,3}]}
>
> > Looks like something strange is taking down the socket, which in turn is
> > taking down the entire connection. ?If you have more than one
> > connection, the others should be fine.
>
> > Is there something in the server logs that corresponds to this error?
>
> > You say your other nodes don't have similar issues. ?Is there something
> > special about this node?
>
> > Cheers,
> > Alex
>
> > On Wed, Jul 20, 2011 at 12:12:32AM -0700, Chak Hedik wrote:
> > > Hi,
>
> > > I frequently getting this terminating error from one of my nodes :
>
> > > ** Generic server <0.28067.2> terminating
> > > ** Last message in was {inet_async,#Port<0.15349>,9049,
> > > {ok,<<0,10,0,51,206>>}}
> > > ** When Server state == {state,#Port<0.15349>,<0.28063.2>,<0.28064.2>,
> > > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?{method,rabbit_framing_amqp_0_9_1},
> > > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?{1,0,4}}
> > > ** Reason for termination ==
> > > ** {{badmatch,{error,einval}},
> > > ? ? [{amqp_main_reader,handle_inet_async,2},
> > > ? ? ?{gen_server,handle_msg,5},
> > > ? ? ?{proc_lib,init_p_do_apply,3}]}
>
> > > While several other nodes with the same setup didn't have the same
> > > issue. May I know what it means and willl it affect my queues?How do I
> > > fix this?
>
> > > Thank,
> > > Chak
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-disc... at lists.rabbitmq.com
> > >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From alex.gronholm at nextday.fi  Fri Jul 22 09:56:37 2011
From: alex.gronholm at nextday.fi (=?ISO-8859-1?Q?Alex_Gr=F6nholm?=)
Date: Fri, 22 Jul 2011 11:56:37 +0300
Subject: [rabbitmq-discuss] Reconnection strategies in Pika
Message-ID: <4E293B45.2030602@nextday.fi>

I never quite grasped what these are for. Their use is not documented, 
and they seem to have no effect on connections. When a connection dies, 
pika dies too regardless of whether I have a connection strategy in 
place or not. Could someone clarify this?

From majek04 at gmail.com  Fri Jul 22 09:59:01 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 22 Jul 2011 09:59:01 +0100
Subject: [rabbitmq-discuss] Slow shutdown issue
In-Reply-To: <62F8A49C-F4C3-46DA-B451-08C6D9E44B6C@gilt.com>
References: <AcxH2u7vx+chcBYwSO2b7P7NgJuzvw==>
	<62F8A49C-F4C3-46DA-B451-08C6D9E44B6C@gilt.com>
Message-ID: <CABzX+qy7+B5ewi-_dzZ0Fbuof-xhoWPn-PH3M5QLLXx1Sfh3Vw@mail.gmail.com>

Hi,

I don't know the answers to all your questions.

On Thu, Jul 21, 2011 at 20:18, Raymond Murthi <rmurthi at gilt.com> wrote:
> I am pretty new on RabbitMQ and I am trying to do a stress test on RabbitMQ (v. 2.5.1) using the following properties: 1kb persistent message, nondurable queue, and without any ready consumer (that is, just writing to the queue). However, every time I overload the RAM (13.7GB high watermark) and force RabbitMQ to write to disk, I always experience a very long wait time whenever I want to shutdown the server/stopping the app/purging the queue. The wait time could be over an hour depending on the number of messages I sent (I sent over 5 millions messages). I ?also notice that RabbitMQ tries to dump the messages from the memory to the disk (under /msg_store_transient) - since nothing is consumed.

This is quite a hard thing for rabbit - you're using it as a database
rather than messaging system!

> Is it a common behavior? I read the documentation and it looks like it is (but isn't it too long?).
> How to kill the process immediately?

I can only suggest what you already know: queue_purge or queue_delete.

> And why are messages stored under /msg_store_transient instead of /msg_store_persistent? What ?is the difference between the two directories?

You said you are sending messages to a nondurable queue - so in a case
of broker shutdown, the queue will be lost. If you want to use
persistance, you need to send persistent messages to a durable queue.
That's why you see messages in the msg_store_transient.

I would be interested to hear what are the results of your test for
persistent/durable messages!
(though rabbit will probably initally be slower)

> I would like to understand on the memory/disk usage and how messages are stored.

Cheers,
  Marek

From aph at repido.co.uk  Fri Jul 22 09:00:52 2011
From: aph at repido.co.uk (Andrew)
Date: Fri, 22 Jul 2011 01:00:52 -0700 (PDT)
Subject: [rabbitmq-discuss] PHP message receiving code.
Message-ID: <4052e1f0-f34d-47d0-a617-594e4b8333a4@m10g2000yqd.googlegroups.com>

Hi there,

Apologies if this is a rather basic question but I'm not sure how to
tackle the implementation of part of a solution using RabbitMQ with
PHP and AMQP library on Linux.

I have a component on Linux that will receive messages from a web
site. This component will process each message, performing DB updates
depending on the message contents. My question is around how this
receiving software should poll for messages from RabbitMQ. I wondered
if there is some call-back mechanism that is invoked when a message is
received, though I haven't found anything on this, or do I implement
my receiving software as a daemon that periodically polls the message
queue and processes messages when there are detected in the queue?

If the latter is the case can anybody point me to some guidelines on a
good approach for implementing such a daemon?

Many thanks,
Andrew

From majek04 at gmail.com  Fri Jul 22 11:10:02 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 22 Jul 2011 11:10:02 +0100
Subject: [rabbitmq-discuss] PHP message receiving code.
In-Reply-To: <4052e1f0-f34d-47d0-a617-594e4b8333a4@m10g2000yqd.googlegroups.com>
References: <4052e1f0-f34d-47d0-a617-594e4b8333a4@m10g2000yqd.googlegroups.com>
Message-ID: <CABzX+qwKCOk1cueFnDgh0mT+7q8vLu9BKez2U500Yu2C=4dEMg@mail.gmail.com>

Hi,

On Fri, Jul 22, 2011 at 09:00, Andrew <aph at repido.co.uk> wrote:
> Hi there,
>
> Apologies if this is a rather basic question but I'm not sure how to
> tackle the implementation of part of a solution using RabbitMQ with
> PHP and AMQP library on Linux.
>
> I have a component on Linux that will receive messages from a web
> site. This component will process each message, performing DB updates
> depending on the message contents. My question is around how this
> receiving software should poll for messages from RabbitMQ. I wondered
> if there is some call-back mechanism that is invoked when a message is
> received, though I haven't found anything on this, or do I implement
> my receiving software as a daemon that periodically polls the message
> queue and processes messages when there are detected in the queue?

We have few tutorials done in php, is it of any use to you?
https://github.com/rabbitmq/rabbitmq-tutorials/tree/master/php

Cheers,
  Marek

From harvey.robin at gmail.com  Fri Jul 22 11:27:24 2011
From: harvey.robin at gmail.com (Robin Harvey)
Date: Fri, 22 Jul 2011 11:27:24 +0100
Subject: [rabbitmq-discuss] PHP message receiving code.
In-Reply-To: <CABzX+qwKCOk1cueFnDgh0mT+7q8vLu9BKez2U500Yu2C=4dEMg@mail.gmail.com>
References: <4052e1f0-f34d-47d0-a617-594e4b8333a4@m10g2000yqd.googlegroups.com>
	<CABzX+qwKCOk1cueFnDgh0mT+7q8vLu9BKez2U500Yu2C=4dEMg@mail.gmail.com>
Message-ID: <CAOvN6FCSsG9vcxgryt6aX9bFHjCP+kg8AO_ZymPiOtq1GiDkSw@mail.gmail.com>

Hi Andrew,

There's some background information as well as API specific instructions for
my PHP package here:

https://github.com/BraveSirRobin/amqphp/wiki/Documentation

HTH.
--Robin

On Fri, Jul 22, 2011 at 11:10 AM, Marek Majkowski <majek04 at gmail.com> wrote:

> Hi,
>
> On Fri, Jul 22, 2011 at 09:00, Andrew <aph at repido.co.uk> wrote:
> > Hi there,
> >
> > Apologies if this is a rather basic question but I'm not sure how to
> > tackle the implementation of part of a solution using RabbitMQ with
> > PHP and AMQP library on Linux.
> >
> > I have a component on Linux that will receive messages from a web
> > site. This component will process each message, performing DB updates
> > depending on the message contents. My question is around how this
> > receiving software should poll for messages from RabbitMQ. I wondered
> > if there is some call-back mechanism that is invoked when a message is
> > received, though I haven't found anything on this, or do I implement
> > my receiving software as a daemon that periodically polls the message
> > queue and processes messages when there are detected in the queue?
>
> We have few tutorials done in php, is it of any use to you?
> https://github.com/rabbitmq/rabbitmq-tutorials/tree/master/php
>
> Cheers,
>   Marek
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110722/c90f813a/attachment.htm>

From videlalvaro at gmail.com  Fri Jul 22 11:37:29 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 22 Jul 2011 12:37:29 +0200
Subject: [rabbitmq-discuss] PHP message receiving code.
In-Reply-To: <CABzX+qwKCOk1cueFnDgh0mT+7q8vLu9BKez2U500Yu2C=4dEMg@mail.gmail.com>
References: <4052e1f0-f34d-47d0-a617-594e4b8333a4@m10g2000yqd.googlegroups.com>
	<CABzX+qwKCOk1cueFnDgh0mT+7q8vLu9BKez2U500Yu2C=4dEMg@mail.gmail.com>
Message-ID: <8FB9C3AB-BE47-43EC-BF6F-C0743744994D@gmail.com>

+1

I was having lunch so couldn't reply earlier. I think you can just follow what tutorial #1 is doing. Keep in mind that is using a plain PHP library, not the PECL extension.

On Jul 22, 2011, at 12:10 PM, Marek Majkowski wrote:

> Hi,
> 
> On Fri, Jul 22, 2011 at 09:00, Andrew <aph at repido.co.uk> wrote:
>> Hi there,
>> 
>> Apologies if this is a rather basic question but I'm not sure how to
>> tackle the implementation of part of a solution using RabbitMQ with
>> PHP and AMQP library on Linux.
>> 
>> I have a component on Linux that will receive messages from a web
>> site. This component will process each message, performing DB updates
>> depending on the message contents. My question is around how this
>> receiving software should poll for messages from RabbitMQ. I wondered
>> if there is some call-back mechanism that is invoked when a message is
>> received, though I haven't found anything on this, or do I implement
>> my receiving software as a daemon that periodically polls the message
>> queue and processes messages when there are detected in the queue?
> 
> We have few tutorials done in php, is it of any use to you?
> https://github.com/rabbitmq/rabbitmq-tutorials/tree/master/php
> 
> Cheers,
>  Marek
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

Sent form my Nokia 1100




From awitbrock at vmware.com  Fri Jul 22 12:01:36 2011
From: awitbrock at vmware.com (Ann Witbrock (c))
Date: Fri, 22 Jul 2011 04:01:36 -0700 (PDT)
Subject: [rabbitmq-discuss] What is the server-name to get the
 rabbitmqadmin
In-Reply-To: <32102103.post@talk.nabble.com>
Message-ID: <45598043.337755.1311332496316.JavaMail.root@zimbra-prod-mbox-4.vmware.com>

Hi Albert,
Are your broker and plugins on Windows?
After installing plugins you would need to again remove, (re)install and start the service (From the start menu is easiest, or just reboot your machine).
On other platforms, you may need to restart the service similarly.

Then http://localhost:55672/cli/ should find it.

Hopefully it is just that.

Ann

----- Original Message -----
From: "albert_newton" <myname.whatis at gmail.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Wednesday, 20 July, 2011 8:23:43 PM
Subject: [rabbitmq-discuss] What is the server-name to get the rabbitmqadmin


I am trying to install the rabbitmqadmin so that I can get the UI and the
command line tool. I already followed the steps mentioned here to get the
management plugin installed:
http://www.rabbitmq.com/plugins.html#rabbitmq-management

However when I try to hit this url: http://server-name:55672/cli/


I am not getting anything. I am not sure what the server-name is supposed to
be in the url above. I tried different values for it like:
rabbit at myhostname, rabbitmq-server, etc, but those did not work. 

Anyone have any idea about this?
-- 
View this message in context: http://old.nabble.com/What-is-the-server-name-to-get-the-rabbitmqadmin-tp32102103p32102103.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthew at rabbitmq.com  Fri Jul 22 12:38:38 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 22 Jul 2011 12:38:38 +0100
Subject: [rabbitmq-discuss] Slow shutdown issue
In-Reply-To: <62F8A49C-F4C3-46DA-B451-08C6D9E44B6C@gilt.com>
References: <62F8A49C-F4C3-46DA-B451-08C6D9E44B6C@gilt.com>
Message-ID: <20110722113838.GA22073@rabbitmq.com>

Hi Ray,

On Thu, Jul 21, 2011 at 03:18:11PM -0400, Raymond Murthi wrote:
> I am pretty new on RabbitMQ and I am trying to do a stress test on
> RabbitMQ (v. 2.5.1) using the following properties: 1kb persistent
> message, nondurable queue, and without any ready consumer (that is,
> just writing to the queue). However, every time I overload the RAM
> (13.7GB high watermark) and force RabbitMQ to write to disk, I always
> experience a very long wait time whenever I want to shutdown the
> server/stopping the app/purging the queue. The wait time could be over
> an hour depending on the number of messages I sent (I sent over 5
> millions messages). I  also notice that RabbitMQ tries to dump the
> messages from the memory to the disk (under /msg_store_transient) -
> since nothing is consumed.

Regardless of whether a persistent msg is written to a transient or
durable queue, it will eventually get written to disk. If you don't want
msgs to be written to disk by default then don't publish persistent
msgs. That way, they'll only get written to disk when you run low on
memory.

The test you're running results in many GB of msgs in RAM pending being
written to disk. On shutdown, Rabbit is trying to write those msgs to
disk, and thus your disk is the bottleneck.

If you declared the queue exclusive then we have some logic in there
that should make the shutdown of the queue and broker much faster. I'll
checker later today but I've a feeling that the same logic doesn't apply
to transient queues, though I can't think of a good reason why not.

Repeat your test but declare the queue as exclusive. You should find
that the shutdown of the broker is then much much faster.

> I read the documentation and it looks like it is (but isn't it too
> long?).

Writing 14GB of data to disk is likely to take a while.

> How to kill the process immediately?

kill -9, pull the power chord etc. But you'll lose messages. That said,
your test probably isnt concerned with msgs surviving restart.

> And why are messages
> stored under /msg_store_transient instead of /msg_store_persistent?

Because they're msgs going to a transient queue.

> What  is the difference between the two directories?

transient is for msgs sent to transient queues. This directory is blown
away on startup because no transient queues survive broker restart.

persistent is fro msgs sent to durable queues.

Matthew

From aph at repido.co.uk  Fri Jul 22 12:52:24 2011
From: aph at repido.co.uk (Andrew)
Date: Fri, 22 Jul 2011 04:52:24 -0700 (PDT)
Subject: [rabbitmq-discuss] PHP message receiving code.
In-Reply-To: <8FB9C3AB-BE47-43EC-BF6F-C0743744994D@gmail.com>
References: <4052e1f0-f34d-47d0-a617-594e4b8333a4@m10g2000yqd.googlegroups.com>
	<CABzX+qwKCOk1cueFnDgh0mT+7q8vLu9BKez2U500Yu2C=4dEMg@mail.gmail.com>
	<8FB9C3AB-BE47-43EC-BF6F-C0743744994D@gmail.com>
Message-ID: <ed2089b9-dbb2-494f-86f5-9a66fc59d145@m18g2000vbl.googlegroups.com>

Thanks Marek, Robin & Alvaro.

I've had a quick look at the tutorials and I think that's what I'm
after but haven't digested it all yet. However just wanted to thank
you for your quick responses and help.

Regards,
Andrew


> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From csharpplusproject at gmail.com  Fri Jul 22 16:12:59 2011
From: csharpplusproject at gmail.com (Shalom Rav)
Date: Fri, 22 Jul 2011 08:12:59 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ & EC2?
Message-ID: <a510f223-f091-4996-863f-6ff732ed5825@fv14g2000vbb.googlegroups.com>

Is it possible to setup a RabbitMQ server on an Amazon EC2 instance,
and have of my local machines at the office connect to this RabbitMQ
server and send/receive messages to/from it?

With a regular internet connection, what should be the approx. time to
deliver say a message of size 1[MB] to my RabbitMQ server on the EC2
instance?

Will I be charged by `Amazon` for the bandwidth / messages that flow
into / out from my `RabbitMQ EC2  instance`?

From michael.s.klishin at gmail.com  Fri Jul 22 16:21:50 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 22 Jul 2011 19:21:50 +0400
Subject: [rabbitmq-discuss] RabbitMQ & EC2?
In-Reply-To: <a510f223-f091-4996-863f-6ff732ed5825@fv14g2000vbb.googlegroups.com>
References: <a510f223-f091-4996-863f-6ff732ed5825@fv14g2000vbb.googlegroups.com>
Message-ID: <CAE3HoVQCqYVeUbtz5=U6sH3w1k4sxV2Ky1kJP+gwNh=sOcSUuQ@mail.gmail.com>

2011/7/22 Shalom Rav <csharpplusproject at gmail.com>

> Is it possible to setup a RabbitMQ server on an Amazon EC2 instance,
> and have of my local machines at the office connect to this RabbitMQ
> server and send/receive messages to/from it?
>
>
Yes.


> With a regular internet connection, what should be the approx. time to
> deliver say a message of size 1[MB] to my RabbitMQ server on the EC2
> instance?
>

No one can tell, you need to measure it. It very much depends on your
location
but also on location of the EC2 instance you will be running. It should be
on average slightly less
than uploading the same 1 MB file from your machine to the instance via HTTP
or rsync
or something like that.


>
> Will I be charged by `Amazon` for the bandwidth / messages that flow
> into / out from my `RabbitMQ EC2  instance`?
>

Yes.

-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110722/a1168958/attachment.htm>

From kiall at managedit.ie  Fri Jul 22 16:23:34 2011
From: kiall at managedit.ie (Kiall Mac Innes)
Date: Fri, 22 Jul 2011 16:23:34 +0100
Subject: [rabbitmq-discuss] RabbitMQ & EC2?
In-Reply-To: <a510f223-f091-4996-863f-6ff732ed5825@fv14g2000vbb.googlegroups.com>
References: <a510f223-f091-4996-863f-6ff732ed5825@fv14g2000vbb.googlegroups.com>
Message-ID: <CAGSj+QvS+sqasQYvFVKLoHJh7yLTyvP5HEkdNWLH7oMoRjx1kA@mail.gmail.com>

On Fri, Jul 22, 2011 at 4:12 PM, Shalom Rav <csharpplusproject at gmail.com>wrote:

> Is it possible to setup a RabbitMQ server on an Amazon EC2 instance,
> and have of my local machines at the office connect to this RabbitMQ
> server and send/receive messages to/from it?
>

Yes - This is certainly possible. But, If the only clients will be
connecting from your office - I probably wouldn't go this route.


>
> With a regular internet connection, what should be the approx. time to
> deliver say a message of size 1[MB] to my RabbitMQ server on the EC2
> instance?
>

What's a "regular internet connection"? 1Mb/s, 10Mb/s, 100Mb/s?

The AMQP protocol is fairly lean, I'm betting your internet connection will
be the bottleneck.


Will I be charged by `Amazon` for the bandwidth / messages that flow
> into / out from my `RabbitMQ EC2  instance`?
>

Yes - Amazon charges for all data in/out of EC2, they don't care that its
your office .. all they see is the traffic is leaving EC2..


> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110722/f9e21c8b/attachment.htm>

From michael.justin at gmx.net  Fri Jul 22 16:36:13 2011
From: michael.justin at gmx.net (Michael Justin)
Date: Fri, 22 Jul 2011 17:36:13 +0200
Subject: [rabbitmq-discuss] RabbitMQ & EC2?
In-Reply-To: <a510f223-f091-4996-863f-6ff732ed5825@fv14g2000vbb.googlegroups.com>
References: <a510f223-f091-4996-863f-6ff732ed5825@fv14g2000vbb.googlegroups.com>
Message-ID: <j0c5dg$q52$1@dough.gmane.org>

Am 22.07.2011 17:12, Shalom Rav wrote:

> Will I be charged by `Amazon` for the bandwidth / messages that flow
> into / out from my `RabbitMQ EC2  instance`?

Only for transfer out. From the Amazon AWS newsletter (July 2011):

"New Data Transfer Pricing
We've often said that one of our goals is to drive down costs 
continuously and to pass those savings on to our customers. We're 
pleased to announce that effective July 1, 2011 we've lowered our 
pricing for AWS data transfer. We will no longer charge a separate fee 
for internet data transfer in."


Amazon Web Services Data Transfer Pricing Changes Effective July 1, 2011

http://aws.amazon.com/pricing_effective_july_2011/


Cheers
Michael Justin


From Lowell.Boggs at emc.com  Fri Jul 22 17:10:13 2011
From: Lowell.Boggs at emc.com (Lowell.Boggs at emc.com)
Date: Fri, 22 Jul 2011 12:10:13 -0400
Subject: [rabbitmq-discuss] Read now ack later,
	much later -- maybe after program restart
In-Reply-To: <mailman.1.1311332402.18475.rabbitmq-discuss@lists.rabbitmq.com>
References: <mailman.1.1311332402.18475.rabbitmq-discuss@lists.rabbitmq.com>
Message-ID: <8A1A883E3F171B42A81817DEC138352C1DB52BA337@MX06A.corp.emc.com>


What happens to messages in durable queues which have already been _read_ but which have not yet been _acked_ when:

1.  rabbit is shutdown gracefully?
2.  the consumer channel closes abruptly -- say from crash, kill, or forced shutdown?

The rabbitmq documentation gives me the impression that I can read messages from a durable queue and choose not to ack them until I  want -- perhaps hours later.  Obviously, I have to watch my queue sizes in this situation.  But what happens if the application never acks the messages before it terminates?  What will happen when the rabbitmq-server is restarted or when or the program is restarted, will it get the messages again?

Suppose I have multiple consumers reading from the same durable queue in a round robin fashion (read ahead is 1) and one consumer has read but not acked 10 messages.  If it dies, or at least closes the connection abruptly, will those 10 messages be sent to the other consumers to read?

Thanks,
   Lowell



From michael.s.klishin at gmail.com  Fri Jul 22 17:20:05 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 22 Jul 2011 20:20:05 +0400
Subject: [rabbitmq-discuss] Read now ack later,
 much later -- maybe after program restart
In-Reply-To: <8A1A883E3F171B42A81817DEC138352C1DB52BA337@MX06A.corp.emc.com>
References: <mailman.1.1311332402.18475.rabbitmq-discuss@lists.rabbitmq.com>
	<8A1A883E3F171B42A81817DEC138352C1DB52BA337@MX06A.corp.emc.com>
Message-ID: <CAE3HoVQgN-kptm8osFZ-cJX+YzWF4ATtj-VDkpMyknuvPSBOnQ@mail.gmail.com>

2011/7/22 <Lowell.Boggs at emc.com>

> 2.  the consumer channel closes abruptly -- say from crash, kill, or forced
> shutdown?


In this case unacknowledged messages will be returned to the queue.

-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110722/e050a231/attachment.htm>

From Lowell.Boggs at emc.com  Fri Jul 22 17:26:04 2011
From: Lowell.Boggs at emc.com (Lowell.Boggs at emc.com)
Date: Fri, 22 Jul 2011 12:26:04 -0400
Subject: [rabbitmq-discuss] Are there any unused delivery tag values?
In-Reply-To: <mailman.1.1311332402.18475.rabbitmq-discuss@lists.rabbitmq.com>
References: <mailman.1.1311332402.18475.rabbitmq-discuss@lists.rabbitmq.com>
Message-ID: <8A1A883E3F171B42A81817DEC138352C1DB52BA33F@MX06A.corp.emc.com>

Delivery tags are uint64_t data.

Is zero a valid delivery tag?  Is (uint64_t)(-1)?

I'm interested in knowing whether I need to keep extra bools laying around to keep track of the "has been auto-acked" or not flag.

Thanks,
   Lowell

From matthew at rabbitmq.com  Fri Jul 22 17:31:23 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 22 Jul 2011 17:31:23 +0100
Subject: [rabbitmq-discuss] Read now ack later,
 much later -- maybe after program restart
In-Reply-To: <8A1A883E3F171B42A81817DEC138352C1DB52BA337@MX06A.corp.emc.com>
References: <mailman.1.1311332402.18475.rabbitmq-discuss@lists.rabbitmq.com>
	<8A1A883E3F171B42A81817DEC138352C1DB52BA337@MX06A.corp.emc.com>
Message-ID: <20110722163123.GC4828@rabbitmq.com>

On Fri, Jul 22, 2011 at 12:10:13PM -0400, Lowell.Boggs at emc.com wrote:
> What happens to messages in durable queues which have already been _read_ but which have not yet been _acked_ when:
> 
> 1.  rabbit is shutdown gracefully?

They are requeued to the back of the queue.

> 2.  the consumer channel closes abruptly -- say from crash, kill, or forced shutdown?

They are requeued to the back of the queue.

This is only relevant for persistent messages - transient messages will
be lost if rabbit dies in any way.

The one exception to the requeuing at the back rule is if rabbit is hard
killed. There's a possibility that the fact that the message has been
delivered to a consumer has not been successfully recorded on disk. As
such, on recovery, the message may reappear at the front of the queue,
rather than the back.

> The rabbitmq documentation gives me the impression that I can read
> messages from a durable queue and choose not to ack them until I  want
> -- perhaps hours later.  Obviously, I have to watch my queue sizes in
> this situation.  But what happens if the application never acks the
> messages before it terminates?  What will happen when the
> rabbitmq-server is restarted or when or the program is restarted, will
> it get the messages again?

They are requeued to the back of the queue.

> Suppose I have multiple consumers reading from the same durable queue
> in a round robin fashion (read ahead is 1) and one consumer has read
> but not acked 10 messages.

Not possible. If qos prefetch is 1 then that consumer will be sent at
most 1 message at a time and will then receive no more until it acks
that message.

>  If it dies, or at least closes the
> connection abruptly, will those 10 messages be sent to the other
> consumers to read?

Yes.

Matthew

From irrer at umich.edu  Fri Jul 22 19:12:29 2011
From: irrer at umich.edu (Jim Irrer)
Date: Fri, 22 Jul 2011 14:12:29 -0400
Subject: [rabbitmq-discuss] Pika blocking receive does not block
Message-ID: <CAK27CLqM22Kd=MXoF6x+cqye8SJOoxObKmv8=z=D_rc5Fvg2gA@mail.gmail.com>

Hi -

I'm trying to implement a blocking client that does an RPC style call to a
server and get a result.  Currently my client sends a message that the
server
receives, and then the client immediately checks for a response using
basic_consume.  The basic_consume method is executed before the
server can respond, and returns without getting a result.

If I add a 'sleep' before the basic_consume, everything works fine, but
that is a poor solution.  I want to block until there is something on the
queue to read.

outline of the code:

use channel.queue_declare to declare the reply queue

use queue_bind to bind the reply queue to a unique string

call basic_consume to set up the reply queue handler (I thought that this
would block but it does not)

use basic_publish to send a message to the server, with the reply_to
property set to the unique string

sleep long enough for server to process message (do not want to do this, but
if I don't then I get no reply)

call basic_get (not sure why, but it makes things work)


I have some holes in my understanding, but to not know how to make the
program wait until there is something on the queue and then read it.

Thanks for any hints,

- Jim

Jim Irrer     irrer at umich.edu       (734) 647-4409
University of Michigan Hospital Radiation Oncology
519 W. William St.             Ann Arbor, MI 48103
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110722/29da51b3/attachment.htm>

From myname.whatis at gmail.com  Fri Jul 22 20:39:31 2011
From: myname.whatis at gmail.com (albert_newton)
Date: Fri, 22 Jul 2011 12:39:31 -0700 (PDT)
Subject: [rabbitmq-discuss]  RabbitMQ integration with websphere
Message-ID: <32117918.post@talk.nabble.com>


I have my application ( my .ear) deployed on Websphere, but want to use the
messaging provided by rabbitmq. I have already installed the rabbitmqserver,
erlang and all that stuff on my box. I am trying to find a way (a location
in websphere) where I can configure to use the rabbitmq stuff rather than
the websphere jms stuff ( which I am using right now). I read something
about the shovel plugin:
http://www.rabbitmq.com/plugins.html#rabbitmq-shovel

but not sure if that is what fulfills my purpose ( because that sounds like
i would have two messaging setups - one within websphere, and other within
rabbitmq, rather than a single one in rabbit mq). I also read about
configuring a third party provider in websphere here:
http://publib.boulder.ibm.com/infocenter/wasinfo/v6r0/index.jsp?topic=/com.ibm.websphere.express.doc/info/exp/ae/cmj_jmsp.html

Maybe that is closer to what I need but not sure. Is there any way to
achieve what I am trying to do ( maybe one of the above approaches, or some
other way)?

-- 
View this message in context: http://old.nabble.com/RabbitMQ-integration-with-websphere-tp32117918p32117918.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From csharpplusproject at gmail.com  Fri Jul 22 20:44:45 2011
From: csharpplusproject at gmail.com (Shalom Rav)
Date: Fri, 22 Jul 2011 12:44:45 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ & EC2?
In-Reply-To: <j0c5dg$q52$1@dough.gmane.org>
References: <a510f223-f091-4996-863f-6ff732ed5825@fv14g2000vbb.googlegroups.com>
	<j0c5dg$q52$1@dough.gmane.org>
Message-ID: <85d6dfcd-5c95-4987-902f-24249dd5bfcf@l18g2000vbe.googlegroups.com>

Thank you all for the detailed responses. I appreciate it.

On Jul 22, 11:36?am, Michael Justin <michael.jus... at gmx.net> wrote:
> Am 22.07.2011 17:12, Shalom Rav wrote:
>
> > Will I be charged by `Amazon` for the bandwidth / messages that flow
> > into / out from my `RabbitMQ EC2 ?instance`?
>
> Only for transfer out. From the Amazon AWS newsletter (July 2011):
>
> "New Data Transfer Pricing
> We've often said that one of our goals is to drive down costs
> continuously and to pass those savings on to our customers. We're
> pleased to announce that effective July 1, 2011 we've lowered our
> pricing for AWS data transfer. We will no longer charge a separate fee
> for internet data transfer in."
>
> Amazon Web Services Data Transfer Pricing Changes Effective July 1, 2011
>
> http://aws.amazon.com/pricing_effective_july_2011/
>
> Cheers
> Michael Justin
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From irrer at umich.edu  Fri Jul 22 21:15:51 2011
From: irrer at umich.edu (Jim Irrer)
Date: Fri, 22 Jul 2011 16:15:51 -0400
Subject: [rabbitmq-discuss] Pika blocking receive does not block
In-Reply-To: <CAFw-dikW7L8+ADhuhURapFbH5i5WpjCy9v_cqGtjZV+hiDKY9Q@mail.gmail.com>
References: <CAK27CLqM22Kd=MXoF6x+cqye8SJOoxObKmv8=z=D_rc5Fvg2gA@mail.gmail.com>
	<CAFw-dikW7L8+ADhuhURapFbH5i5WpjCy9v_cqGtjZV+hiDKY9Q@mail.gmail.com>
Message-ID: <CAK27CLrAuAQgUtX0xnSGBzYuXGwdPWeRERSfXYwUpptKcEFHWA@mail.gmail.com>

Excellent!  Problem solved.

Many thanks,

- Jim

Jim Irrer     irrer at umich.edu       (734) 647-4409
University of Michigan Hospital Radiation Oncology
519 W. William St.             Ann Arbor, MI 48103


2011/7/22 Rapha?l De GIUSTI <raphael.degiusti at guardis.com>

> Hello,
>
> You should try the start_consuming() method. See the example on github :
> https://github.com/pika/pika/blob/master/examples/blocking/demo_receive.py
>
> Raph
>
> On Fri, Jul 22, 2011 at 8:12 PM, Jim Irrer <irrer at umich.edu> wrote:
>
>> Hi -
>>
>> I'm trying to implement a blocking client that does an RPC style call to a
>> server and get a result.  Currently my client sends a message that the
>> server
>> receives, and then the client immediately checks for a response using
>> basic_consume.  The basic_consume method is executed before the
>> server can respond, and returns without getting a result.
>>
>> If I add a 'sleep' before the basic_consume, everything works fine, but
>> that is a poor solution.  I want to block until there is something on the
>> queue to read.
>>
>> outline of the code:
>>
>> use channel.queue_declare to declare the reply queue
>>
>> use queue_bind to bind the reply queue to a unique string
>>
>> call basic_consume to set up the reply queue handler (I thought that this
>> would block but it does not)
>>
>> use basic_publish to send a message to the server, with the reply_to
>> property set to the unique string
>>
>> sleep long enough for server to process message (do not want to do this,
>> but if I don't then I get no reply)
>>
>> call basic_get (not sure why, but it makes things work)
>>
>>
>> I have some holes in my understanding, but to not know how to make the
>> program wait until there is something on the queue and then read it.
>>
>> Thanks for any hints,
>>
>> - Jim
>>
>> Jim Irrer     irrer at umich.edu       (734) 647-4409
>> University of Michigan Hospital Radiation Oncology
>> 519 W. William St.             Ann Arbor, MI 48103
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110722/6fe4fac6/attachment.htm>

From Lowell.Boggs at emc.com  Fri Jul 22 22:28:23 2011
From: Lowell.Boggs at emc.com (Lowell.Boggs at emc.com)
Date: Fri, 22 Jul 2011 17:28:23 -0400
Subject: [rabbitmq-discuss] Reading messages without acking them
Message-ID: <8A1A883E3F171B42A81817DEC138352C1DB52BA3D9@MX06A.corp.emc.com>

Thanks Michael and Matt.

In the attached, Matt says that with a QOS/prefetch of 1, I rabbitmq will not let me read more than one message without acking it.

So, is it true then that if I set the prefetch number to  10, I can read up to 10 without acking any of them?

Thanks,
   Lowell


On Fri, Jul 22, 2011 at 12:10:13PM -0400, Lowell.Bo...<blocked::http://groups.google.com/groups/unlock?_done=/group/rabbitmq-discuss/browse_thread/thread/c764b1ebb8471857&msg=c9cc14c924840370>@emc.com wrote:
> What happens to messages in durable queues which have already been _read_ but which have not yet been _acked_ when:

> 1.  rabbit is shutdown gracefully?


They are requeued to the back of the queue.

> 2.  the consumer channel closes abruptly -- say from crash, kill, or forced shutdown?

They are requeued to the back of the queue.

This is only relevant for persistent messages - transient messages will
be lost if rabbit dies in any way.

The one exception to the requeuing at the back rule is if rabbit is hard
killed. There's a possibility that the fact that the message has been
delivered to a consumer has not been successfully recorded on disk. As
such, on recovery, the message may reappear at the front of the queue,
rather than the back.

> The rabbitmq documentation gives me the impression that I can read
> messages from a durable queue and choose not to ack them until I  want
> -- perhaps hours later.  Obviously, I have to watch my queue sizes in
> this situation.  But what happens if the application never acks the
> messages before it terminates?  What will happen when the
> rabbitmq-server is restarted or when or the program is restarted, will
> it get the messages again?

They are requeued to the back of the queue.

> Suppose I have multiple consumers reading from the same durable queue
> in a round robin fashion (read ahead is 1) and one consumer has read
> but not acked 10 messages.

Not possible. If qos prefetch is 1 then that consumer will be sent at
most 1 message at a time and will then receive no more until it acks
that message.

>  If it dies, or at least closes the
> connection abruptly, will those 10 messages be sent to the other
> consumers to read?

Yes.

Matthew
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110722/3b83e72a/attachment.htm>

From Lowell.Boggs at emc.com  Fri Jul 22 22:34:37 2011
From: Lowell.Boggs at emc.com (Lowell.Boggs at emc.com)
Date: Fri, 22 Jul 2011 17:34:37 -0400
Subject: [rabbitmq-discuss] Reading messages without acking them
Message-ID: <8A1A883E3F171B42A81817DEC138352C1DB52BA3DD@MX06A.corp.emc.com>

To extend my previous question, if I set the prefetch count to 10 but there is only 1 message in the buffer, and if I read the message but do not ack it, will I be able to read up to 9 messages later when they show up?  Or is the prefetch only applicable when the messages are actually available in the buffer?

Thanks,
   Lowell

________________________________
From: Boggs Jr., Lowell
Sent: Friday, July 22, 2011 4:28 PM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Reading messages without acking them


Thanks Michael and Matt.

In the attached, Matt says that with a QOS/prefetch of 1, I rabbitmq will not let me read more than one message without acking it.

So, is it true then that if I set the prefetch number to  10, I can read up to 10 without acking any of them?

Thanks,
   Lowell


On Fri, Jul 22, 2011 at 12:10:13PM -0400, Lowell.Bo...<blocked::http://groups.google.com/groups/unlock?_done=/group/rabbitmq-discuss/browse_thread/thread/c764b1ebb8471857&msg=c9cc14c924840370>@emc.com wrote:
> What happens to messages in durable queues which have already been _read_ but which have not yet been _acked_ when:

> 1.  rabbit is shutdown gracefully?


They are requeued to the back of the queue.

> 2.  the consumer channel closes abruptly -- say from crash, kill, or forced shutdown?

They are requeued to the back of the queue.

This is only relevant for persistent messages - transient messages will
be lost if rabbit dies in any way.

The one exception to the requeuing at the back rule is if rabbit is hard
killed. There's a possibility that the fact that the message has been
delivered to a consumer has not been successfully recorded on disk. As
such, on recovery, the message may reappear at the front of the queue,
rather than the back.

> The rabbitmq documentation gives me the impression that I can read
> messages from a durable queue and choose not to ack them until I  want
> -- perhaps hours later.  Obviously, I have to watch my queue sizes in
> this situation.  But what happens if the application never acks the
> messages before it terminates?  What will happen when the
> rabbitmq-server is restarted or when or the program is restarted, will
> it get the messages again?

They are requeued to the back of the queue.

> Suppose I have multiple consumers reading from the same durable queue
> in a round robin fashion (read ahead is 1) and one consumer has read
> but not acked 10 messages.

Not possible. If qos prefetch is 1 then that consumer will be sent at
most 1 message at a time and will then receive no more until it acks
that message.

>  If it dies, or at least closes the
> connection abruptly, will those 10 messages be sent to the other
> consumers to read?

Yes.

Matthew
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110722/36a87fba/attachment.htm>

From michael.s.klishin at gmail.com  Fri Jul 22 22:40:39 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sat, 23 Jul 2011 01:40:39 +0400
Subject: [rabbitmq-discuss] Reading messages without acking them
In-Reply-To: <8A1A883E3F171B42A81817DEC138352C1DB52BA3D9@MX06A.corp.emc.com>
References: <8A1A883E3F171B42A81817DEC138352C1DB52BA3D9@MX06A.corp.emc.com>
Message-ID: <CAE3HoVTNu6J30bFPmCGSZpzpbX4Eo6Cgs+LLe9p6CLw8H68yfw@mail.gmail.com>

2011/7/23 <Lowell.Boggs at emc.com>

> So, is it true then that if I set the prefetch number to  10, I can read up
> to 10 without acking any of them?


yes, and rabbitmq won't give your consumer 11th message until it receives an
ack for at least one of the first 10.

Take a look at
http://rubydoc.info/github/ruby-amqp/amqp/master/file/docs/Queues.textile#QoS___Prefetching_messages,
it has an example
of a few "apps" that share a queue, one of them "crashes" (its connection is
closed) and messages it did not acknowledge are redelivered
to the peers.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110723/b9632753/attachment.htm>

From simone.busoli at gmail.com  Fri Jul 22 23:01:45 2011
From: simone.busoli at gmail.com (Simone Busoli)
Date: Sat, 23 Jul 2011 00:01:45 +0200
Subject: [rabbitmq-discuss] Asynchronous request-reply across shovel
Message-ID: <CAOn7oW_m1G-3xKOBRi_oDj4pPECvJmP69yy5idSMVPUKZTu8Vg@mail.gmail.com>

Hi, I'm stuck with trying to find a way to implement generic asynchronous
request-reply which works well across shovels. It is going to be somewhat
contrived since I'm building a generic bus int .NET using RabbitMQ as the
transport, so please bear with me.
So far it used to work like this: when performing a request I created a
temporary queue and sent its name in the ReplyTo field, then the receiver of
the request sent its reply on the default exchange using this queue name as
the routing key.

Now what I would like to do it make it work across shovels, but my
implementation (the way I would like it to be) ideally imposes some
decoupling between the request message and the reply message which prevents
me from being able to achieve this result.

To explain, the request message and the reply message are supposed to be
published to different exchanges to make it work across a shovel. This is
because, supposing I have two servers, the request has to be published to an
exchange that is "shoveled" from server1 to server2, while the reply in
order to come back to the requestor needs to be published to an exchange
shoveled from server2 to server1. I hope it makes sense so far.

What I would like to do is avoiding, when performing the request, to know
what exchange the reply will be published to, as I don't even want to let
the requestor be aware of what kind of reply the application is going to
receive; it could be a RequestSuccessfulMessage or a RequestFailedMessage
for instance. Of course my application will have "handlers" for both of
them, but the requestor needen't know about that.
As an additional detail, in the system I am setting up the channel that
dispatches messages is already subscribing to the response exchange because,
by convention, I am subscribing to all message types for whom there is a
suitable consumer in the application by using their exposed exchange name (I
decorate every message type with an attribute containing the name of the
exchange that message type is published to) and a string representation of
message type as the binding key, but in a request/reply scenario I don't
want every instance of my application to receive the reply message, just the
one which sent the request, therefore the reply has to come through a
different combination of exchange/routing key.

Any advice is welcome, you can look at the code
here<http://code.google.com/p/mexexp/source/checkout>. There
is a failing test
in RabbitMQ\Tests.Integration\Bus\RequestReply\Request_and_reply.cs which
exposes the problem. The tests are self contained except that they expect a
rabbitmq server to be running on localhost (there is one embedded in the
repo in folder RabbitMQServer, you can start that one directly)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110723/3234b3f2/attachment.htm>

From habtdemis at gmail.com  Sat Jul 23 01:10:24 2011
From: habtdemis at gmail.com (Demi Zike)
Date: Fri, 22 Jul 2011 19:10:24 -0500
Subject: [rabbitmq-discuss] How to read from multiple queues
Message-ID: <CAJE2eFF5kp5EgzhCzuWwsW7=tyoLjPu0a15rrKpt7JTtXutLJg@mail.gmail.com>

 Hi,

My application should be able to use the same AMQP connection to read
messages with different channels (each channel to consume messages from each
queue). Can you give me a hint on how I can implement this?

Thanks,
Demiss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110722/6e60a889/attachment.htm>

From ekirpichov at gmail.com  Sat Jul 23 06:46:03 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Sat, 23 Jul 2011 09:46:03 +0400
Subject: [rabbitmq-discuss] How to read from multiple queues
In-Reply-To: <CAJE2eFF5kp5EgzhCzuWwsW7=tyoLjPu0a15rrKpt7JTtXutLJg@mail.gmail.com>
References: <CAJE2eFF5kp5EgzhCzuWwsW7=tyoLjPu0a15rrKpt7JTtXutLJg@mail.gmail.com>
Message-ID: <CANVKUrVxB8442e6yFUOHrQwmjGeLs4kjw9NSnEpO_-f3X5HLWg@mail.gmail.com>

Which language are you using?

2011/7/23 Demi Zike <habtdemis at gmail.com>:
> Hi,
>
> My application should be able to use the same AMQP connection to read
> messages with different channels (each channel to consume messages from each
> queue). Can you give me a hint on how I can implement this?
>
> Thanks,
> Demiss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/

From habtdemis at gmail.com  Sat Jul 23 07:03:52 2011
From: habtdemis at gmail.com (Demi Zike)
Date: Sat, 23 Jul 2011 01:03:52 -0500
Subject: [rabbitmq-discuss] How to read from multiple queues
In-Reply-To: <CANVKUrVxB8442e6yFUOHrQwmjGeLs4kjw9NSnEpO_-f3X5HLWg@mail.gmail.com>
References: <CAJE2eFF5kp5EgzhCzuWwsW7=tyoLjPu0a15rrKpt7JTtXutLJg@mail.gmail.com>
	<CANVKUrVxB8442e6yFUOHrQwmjGeLs4kjw9NSnEpO_-f3X5HLWg@mail.gmail.com>
Message-ID: <CAJE2eFFSae6GjX5-frvtjxXmn4PHBv+xajLpOG3Jzt1p++t-Fw@mail.gmail.com>

I am using C# using the .NET client.

Demiss

On Sat, Jul 23, 2011 at 12:46 AM, Eugene Kirpichov <ekirpichov at gmail.com>wrote:

> Which language are you using?
>
> 2011/7/23 Demi Zike <habtdemis at gmail.com>:
> > Hi,
> >
> > My application should be able to use the same AMQP connection to read
> > messages with different channels (each channel to consume messages from
> each
> > queue). Can you give me a hint on how I can implement this?
> >
> > Thanks,
> > Demiss
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
>
>
>
> --
> Eugene Kirpichov
> Principal Engineer, Mirantis Inc. http://www.mirantis.com/
> Editor, http://fprog.ru/
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110723/21ae4375/attachment.htm>

From ekirpichov at gmail.com  Sat Jul 23 07:56:40 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Sat, 23 Jul 2011 10:56:40 +0400
Subject: [rabbitmq-discuss] How to read from multiple queues
In-Reply-To: <CAJE2eFFSae6GjX5-frvtjxXmn4PHBv+xajLpOG3Jzt1p++t-Fw@mail.gmail.com>
References: <CAJE2eFF5kp5EgzhCzuWwsW7=tyoLjPu0a15rrKpt7JTtXutLJg@mail.gmail.com>
	<CANVKUrVxB8442e6yFUOHrQwmjGeLs4kjw9NSnEpO_-f3X5HLWg@mail.gmail.com>
	<CAJE2eFFSae6GjX5-frvtjxXmn4PHBv+xajLpOG3Jzt1p++t-Fw@mail.gmail.com>
Message-ID: <CANVKUrUuzzRDpQCiJvGay_RhZmaytak_zQCyPSjrbvnAn+4ABg@mail.gmail.com>

Why don't you just start several Consumers for different channels &
queues, bound to the same connection? e.g. EventingBasicConsumer's

2011/7/23 Demi Zike <habtdemis at gmail.com>:
> I am using C# using the .NET client.
>
> Demiss
>
> On Sat, Jul 23, 2011 at 12:46 AM, Eugene Kirpichov <ekirpichov at gmail.com>
> wrote:
>>
>> Which language are you using?
>>
>> 2011/7/23 Demi Zike <habtdemis at gmail.com>:
>> > Hi,
>> >
>> > My application should be able to use the same AMQP connection to read
>> > messages with different channels (each channel to consume messages from
>> > each
>> > queue). Can you give me a hint on how I can implement this?
>> >
>> > Thanks,
>> > Demiss
>> >
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >
>> >
>>
>>
>>
>> --
>> Eugene Kirpichov
>> Principal Engineer, Mirantis Inc. http://www.mirantis.com/
>> Editor, http://fprog.ru/
>
>



-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/

From habtdemis at gmail.com  Sat Jul 23 08:42:33 2011
From: habtdemis at gmail.com (Demi Zike)
Date: Sat, 23 Jul 2011 02:42:33 -0500
Subject: [rabbitmq-discuss] How to read from multiple queues
In-Reply-To: <CANVKUrUuzzRDpQCiJvGay_RhZmaytak_zQCyPSjrbvnAn+4ABg@mail.gmail.com>
References: <CAJE2eFF5kp5EgzhCzuWwsW7=tyoLjPu0a15rrKpt7JTtXutLJg@mail.gmail.com>
	<CANVKUrVxB8442e6yFUOHrQwmjGeLs4kjw9NSnEpO_-f3X5HLWg@mail.gmail.com>
	<CAJE2eFFSae6GjX5-frvtjxXmn4PHBv+xajLpOG3Jzt1p++t-Fw@mail.gmail.com>
	<CANVKUrUuzzRDpQCiJvGay_RhZmaytak_zQCyPSjrbvnAn+4ABg@mail.gmail.com>
Message-ID: <CAJE2eFGZzU-qh3hCQWpRG8_mmPEmWivC0ERzpf2sXVYLOrTeNA@mail.gmail.com>

I never used EventingBasicConsumer's before. It'd be very helpful if I can
get implementation samples?

Thanks,
Demissew

On Sat, Jul 23, 2011 at 1:56 AM, Eugene Kirpichov <ekirpichov at gmail.com>wrote:

> Why don't you just start several Consumers for different channels &
> queues, bound to the same connection? e.g. EventingBasicConsumer's
>
> 2011/7/23 Demi Zike <habtdemis at gmail.com>:
> > I am using C# using the .NET client.
> >
> > Demiss
> >
> > On Sat, Jul 23, 2011 at 12:46 AM, Eugene Kirpichov <ekirpichov at gmail.com
> >
> > wrote:
> >>
> >> Which language are you using?
> >>
> >> 2011/7/23 Demi Zike <habtdemis at gmail.com>:
> >> > Hi,
> >> >
> >> > My application should be able to use the same AMQP connection to read
> >> > messages with different channels (each channel to consume messages
> from
> >> > each
> >> > queue). Can you give me a hint on how I can implement this?
> >> >
> >> > Thanks,
> >> > Demiss
> >> >
> >> > _______________________________________________
> >> > rabbitmq-discuss mailing list
> >> > rabbitmq-discuss at lists.rabbitmq.com
> >> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >> >
> >> >
> >>
> >>
> >>
> >> --
> >> Eugene Kirpichov
> >> Principal Engineer, Mirantis Inc. http://www.mirantis.com/
> >> Editor, http://fprog.ru/
> >
> >
>
>
>
> --
> Eugene Kirpichov
> Principal Engineer, Mirantis Inc. http://www.mirantis.com/
> Editor, http://fprog.ru/
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110723/f1b3aa50/attachment.htm>

From Simone.Busoli at ferrari.com  Sat Jul 23 09:38:31 2011
From: Simone.Busoli at ferrari.com (Busoli, Simone)
Date: Sat, 23 Jul 2011 08:38:31 +0000
Subject: [rabbitmq-discuss] Feature request for shovel addin - max hops
Message-ID: <88E590DC4586974D825FC82AE798294E52020433@GSVCLU03.ges.ferlan.it>

Hello,  I think it would be very useful to have the shovel addin support a max-hops option like the federation addin does (while waiting for it to be production-ready), to avoid needing to do contrived exchange-exchange bindings to implement a transparent federation-like pub/sub behavior which otherwise currently goes into an infinite loop. It sounds like it would be easy to do by adding some metadata to deliveries.

It would be helpful in one of our scenarios where we currently need to setup two shovels to let two servers communicate, one from s1 to s2 and vice-versa.

What do you think?


_________________________________________________________________________________________________________________
Questo messaggio e da intendersi esclusivamente ad uso del destinatario e puo contenere informazioni che sono di natura privilegiata, confidenziale
o non divulgabile secondo le leggi vigenti. Se il lettore del presente messaggio non e il destinatario designato, o il dipendente/agente responsabile
per la consegna del messaggio al destinatario designato, si informa che ogni disseminazione, distribuzione o copiatura di questa comunicazione e 
strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
immediatamente a mezzo e-mail di risposta e successivamente di procedere alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
_________________________________________________________________________________________________________________
This message is intended only for the use of the addressee and may contain information that is privileged, confidential and exempt from 
disclosure under applicable law. If the reader of this message is not the intended recipient, or the employee or agent responsible for delivering the 
message to the intended recipient, you are hereby notified that any dissemination, distribution or copying of this communication is strictly 
prohibited. If you have received this e-mail in error, please notify us immediately by return e-mail and delete this e-mail and all attachments from 
your system.
_________________________________________________________________________________________________________________

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110723/bf08b468/attachment.htm>

From ekirpichov at gmail.com  Sat Jul 23 12:13:09 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Sat, 23 Jul 2011 15:13:09 +0400
Subject: [rabbitmq-discuss] How to read from multiple queues
In-Reply-To: <CAJE2eFGZzU-qh3hCQWpRG8_mmPEmWivC0ERzpf2sXVYLOrTeNA@mail.gmail.com>
References: <CAJE2eFF5kp5EgzhCzuWwsW7=tyoLjPu0a15rrKpt7JTtXutLJg@mail.gmail.com>
	<CANVKUrVxB8442e6yFUOHrQwmjGeLs4kjw9NSnEpO_-f3X5HLWg@mail.gmail.com>
	<CAJE2eFFSae6GjX5-frvtjxXmn4PHBv+xajLpOG3Jzt1p++t-Fw@mail.gmail.com>
	<CANVKUrUuzzRDpQCiJvGay_RhZmaytak_zQCyPSjrbvnAn+4ABg@mail.gmail.com>
	<CAJE2eFGZzU-qh3hCQWpRG8_mmPEmWivC0ERzpf2sXVYLOrTeNA@mail.gmail.com>
Message-ID: <CANVKUrVMZGR1fPYbCKcs7PVE7mV3-6J=HEMWTWdwsQfUvmossw@mail.gmail.com>

Well.. I think actually its interface speaks for itself. Just use
IModel.BasicConsume to start listening to events and subscribe to the
required EventingBasicConsumer events. Is there anything in particular
that you'd like clarified in the documentation of
EventingBasicConsumer?

The download page for RabbitMQ .net client references the API
documentation: http://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v2.5.1/rabbitmq-dotnet-client-2.5.1-user-guide.pdf

2011/7/23 Demi Zike <habtdemis at gmail.com>:
> I never used EventingBasicConsumer's before. It'd be very helpful if I can
> get implementation samples?
>
> Thanks,
> Demissew
>
> On Sat, Jul 23, 2011 at 1:56 AM, Eugene Kirpichov <ekirpichov at gmail.com>
> wrote:
>>
>> Why don't you just start several Consumers for different channels &
>> queues, bound to the same connection? e.g. EventingBasicConsumer's
>>
>> 2011/7/23 Demi Zike <habtdemis at gmail.com>:
>> > I am using C# using the .NET client.
>> >
>> > Demiss
>> >
>> > On Sat, Jul 23, 2011 at 12:46 AM, Eugene Kirpichov
>> > <ekirpichov at gmail.com>
>> > wrote:
>> >>
>> >> Which language are you using?
>> >>
>> >> 2011/7/23 Demi Zike <habtdemis at gmail.com>:
>> >> > Hi,
>> >> >
>> >> > My application should be able to use the same AMQP connection to read
>> >> > messages with different channels (each channel to consume messages
>> >> > from
>> >> > each
>> >> > queue). Can you give me a hint on how I can implement this?
>> >> >
>> >> > Thanks,
>> >> > Demiss
>> >> >
>> >> > _______________________________________________
>> >> > rabbitmq-discuss mailing list
>> >> > rabbitmq-discuss at lists.rabbitmq.com
>> >> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >> >
>> >> >
>> >>
>> >>
>> >>
>> >> --
>> >> Eugene Kirpichov
>> >> Principal Engineer, Mirantis Inc. http://www.mirantis.com/
>> >> Editor, http://fprog.ru/
>> >
>> >
>>
>>
>>
>> --
>> Eugene Kirpichov
>> Principal Engineer, Mirantis Inc. http://www.mirantis.com/
>> Editor, http://fprog.ru/
>
>



-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/

From aph at repido.co.uk  Sat Jul 23 13:18:42 2011
From: aph at repido.co.uk (Andrew)
Date: Sat, 23 Jul 2011 05:18:42 -0700 (PDT)
Subject: [rabbitmq-discuss] PHP message receiving code.
In-Reply-To: <8FB9C3AB-BE47-43EC-BF6F-C0743744994D@gmail.com>
References: <4052e1f0-f34d-47d0-a617-594e4b8333a4@m10g2000yqd.googlegroups.com>
	<CABzX+qwKCOk1cueFnDgh0mT+7q8vLu9BKez2U500Yu2C=4dEMg@mail.gmail.com>
	<8FB9C3AB-BE47-43EC-BF6F-C0743744994D@gmail.com>
Message-ID: <5a4282db-71ff-4149-b609-581045d87234@a12g2000vbf.googlegroups.com>

Hi Alvaro

You mentioned in your reply:
> Keep in mind that is using a plain PHP library, not the PECL extension.
The machine I'm working on has the PHP AMQP PECL extension (http://
www.php.net/manual/en/amqp.installation.php) which I think differs
from the examples in the tutorials in that it doesn't seem to support
the callback mechanism that is documented in the examples - or I'm
missing something!
The version I'm using doesn't seems to have the 'channel' object in
the documentation (http://www.php.net/manual/en/book.amqp.php) through
which the call back is set up in the tutorial examples.
Is there an explanation somewhere of the different libraries and what
they support? I'm finding it a bit tricky as a newcomer to establish
which functionality and therefore which library I should be using -
there is one already installed on the server so feel inclined to use
that if at all possible.
It looks like the version I have doesn't provide the callback facility
and I'd have to implement some daemon that periodically polls for
messages and then acts upong them - is this right for the library that
I have?

Thanks & regards,
Andrew

On Jul 22, 11:37?am, Alvaro Videla <videlalv... at gmail.com> wrote:
> +1
>
> I was having lunch so couldn't reply earlier. I think you can just follow what tutorial #1 is doing. Keep in mind that is using a plain PHP library, not the PECL extension.
>
> On Jul 22, 2011, at 12:10 PM, Marek Majkowski wrote:
>
>
>
>
>
>
>
>
>
> > Hi,
>
> > On Fri, Jul 22, 2011 at 09:00, Andrew <a... at repido.co.uk> wrote:
> >> Hi there,
>
> >> Apologies if this is a rather basic question but I'm not sure how to
> >> tackle the implementation of part of a solution using RabbitMQ with
> >> PHP and AMQP library on Linux.
>
> >> I have a component on Linux that will receive messages from a web
> >> site. This component will process each message, performing DB updates
> >> depending on the message contents. My question is around how this
> >> receiving software should poll for messages from RabbitMQ. I wondered
> >> if there is some call-back mechanism that is invoked when a message is
> >> received, though I haven't found anything on this, or do I implement
> >> my receiving software as a daemon that periodically polls the message
> >> queue and processes messages when there are detected in the queue?
>
> > We have few tutorials done in php, is it of any use to you?
> >https://github.com/rabbitmq/rabbitmq-tutorials/tree/master/php
>
> > Cheers,
> > ?Marek
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> Sent form my Nokia 1100
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From videlalvaro at gmail.com  Sat Jul 23 13:22:31 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Sat, 23 Jul 2011 14:22:31 +0200
Subject: [rabbitmq-discuss] PHP message receiving code.
In-Reply-To: <5a4282db-71ff-4149-b609-581045d87234@a12g2000vbf.googlegroups.com>
References: <4052e1f0-f34d-47d0-a617-594e4b8333a4@m10g2000yqd.googlegroups.com>
	<CABzX+qwKCOk1cueFnDgh0mT+7q8vLu9BKez2U500Yu2C=4dEMg@mail.gmail.com>
	<8FB9C3AB-BE47-43EC-BF6F-C0743744994D@gmail.com>
	<5a4282db-71ff-4149-b609-581045d87234@a12g2000vbf.googlegroups.com>
Message-ID: <793480AC-29A5-4563-89E6-7EAF3051126A@gmail.com>

Hi,

As I said the examples are using another library, not the PECL extension.

The library used on the tutorials is this one: https://github.com/tnc/php-amqplib

You can implement such daemon using that library. 

Regarding the PECL extension, I haven't used it.

Cheers,

Alvaro

On Jul 23, 2011, at 2:18 PM, Andrew wrote:

> Hi Alvaro
> 
> You mentioned in your reply:
>> Keep in mind that is using a plain PHP library, not the PECL extension.
> The machine I'm working on has the PHP AMQP PECL extension (http://
> www.php.net/manual/en/amqp.installation.php) which I think differs
> from the examples in the tutorials in that it doesn't seem to support
> the callback mechanism that is documented in the examples - or I'm
> missing something!
> The version I'm using doesn't seems to have the 'channel' object in
> the documentation (http://www.php.net/manual/en/book.amqp.php) through
> which the call back is set up in the tutorial examples.
> Is there an explanation somewhere of the different libraries and what
> they support? I'm finding it a bit tricky as a newcomer to establish
> which functionality and therefore which library I should be using -
> there is one already installed on the server so feel inclined to use
> that if at all possible.
> It looks like the version I have doesn't provide the callback facility
> and I'd have to implement some daemon that periodically polls for
> messages and then acts upong them - is this right for the library that
> I have?
> 
> Thanks & regards,
> Andrew
> 
> On Jul 22, 11:37 am, Alvaro Videla <videlalv... at gmail.com> wrote:
>> +1
>> 
>> I was having lunch so couldn't reply earlier. I think you can just follow what tutorial #1 is doing. Keep in mind that is using a plain PHP library, not the PECL extension.
>> 
>> On Jul 22, 2011, at 12:10 PM, Marek Majkowski wrote:
>> 
>> 
>> 
>> 
>> 
>> 
>> 
>> 
>> 
>>> Hi,
>> 
>>> On Fri, Jul 22, 2011 at 09:00, Andrew <a... at repido.co.uk> wrote:
>>>> Hi there,
>> 
>>>> Apologies if this is a rather basic question but I'm not sure how to
>>>> tackle the implementation of part of a solution using RabbitMQ with
>>>> PHP and AMQP library on Linux.
>> 
>>>> I have a component on Linux that will receive messages from a web
>>>> site. This component will process each message, performing DB updates
>>>> depending on the message contents. My question is around how this
>>>> receiving software should poll for messages from RabbitMQ. I wondered
>>>> if there is some call-back mechanism that is invoked when a message is
>>>> received, though I haven't found anything on this, or do I implement
>>>> my receiving software as a daemon that periodically polls the message
>>>> queue and processes messages when there are detected in the queue?
>> 
>>> We have few tutorials done in php, is it of any use to you?
>>> https://github.com/rabbitmq/rabbitmq-tutorials/tree/master/php
>> 
>>> Cheers,
>>>  Marek
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-disc... at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> Sent form my Nokia 1100
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

Sent form my Nokia 1100




From matthew at rabbitmq.com  Sat Jul 23 13:34:58 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Sat, 23 Jul 2011 13:34:58 +0100
Subject: [rabbitmq-discuss] Slow shutdown issue
In-Reply-To: <20110722113838.GA22073@rabbitmq.com>
References: <62F8A49C-F4C3-46DA-B451-08C6D9E44B6C@gilt.com>
	<20110722113838.GA22073@rabbitmq.com>
Message-ID: <20110723123458.GA22850@rabbitmq.com>

On Fri, Jul 22, 2011 at 12:38:38PM +0100, Matthew Sackman wrote:
> If you declared the queue exclusive then we have some logic in there
> that should make the shutdown of the queue and broker much faster. I'll
> check later today but I've a feeling that the same logic doesn't apply
> to transient queues, though I can't think of a good reason why not.

Yup, we don't optimise the transient queue shutdown in the same way that
we optimise the exclusive queue deletion. I'll raise a bug, although
it's possible there's a good reason for this which I can't currently
think of.

Matthew

From matthew at rabbitmq.com  Sat Jul 23 18:30:34 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Sat, 23 Jul 2011 18:30:34 +0100
Subject: [rabbitmq-discuss] Slow shutdown issue
In-Reply-To: <20110722113838.GA22073@rabbitmq.com>
References: <62F8A49C-F4C3-46DA-B451-08C6D9E44B6C@gilt.com>
	<20110722113838.GA22073@rabbitmq.com>
Message-ID: <20110723173033.GA27994@rabbitmq.com>

On Fri, Jul 22, 2011 at 12:38:38PM +0100, Matthew Sackman wrote:
> Regardless of whether a persistent msg is written to a transient or
> durable queue, it will eventually get written to disk. If you don't want
> msgs to be written to disk by default then don't publish persistent
> msgs. That way, they'll only get written to disk when you run low on
> memory.

Turns out I can't read my own code. Only persistent msgs sent to durable
queues are immediately scheduled for writing to disk. Of course, all
msgs may still be sent to disk for memory reasons.

Matthew

From simone.busoli at gmail.com  Sun Jul 24 12:23:30 2011
From: simone.busoli at gmail.com (Simone Busoli)
Date: Sun, 24 Jul 2011 13:23:30 +0200
Subject: [rabbitmq-discuss] Building addins on Windows
Message-ID: <CAOn7oW9Z7EtU_W-9Xs17_-NTvh9Esno45=7W1PJ0EDNqKfqzSw@mail.gmail.com>

I would like to try adding a max-hops option to the shovel addin, but I have
no past experience in erlang nor in building an addin from the sources. I
looked at the docs and I would like to know whether building on Windows is
supported and especially if I need to build the server too, or a binary
deployment is enough to modify and test the addin.

Thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110724/f168e28a/attachment.htm>

From emile at rabbitmq.com  Sun Jul 24 12:48:46 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Sun, 24 Jul 2011 12:48:46 +0100
Subject: [rabbitmq-discuss] Building addins on Windows
In-Reply-To: <CAOn7oW9Z7EtU_W-9Xs17_-NTvh9Esno45=7W1PJ0EDNqKfqzSw@mail.gmail.com>
References: <CAOn7oW9Z7EtU_W-9Xs17_-NTvh9Esno45=7W1PJ0EDNqKfqzSw@mail.gmail.com>
Message-ID: <4E2C069E.502@rabbitmq.com>

Hi Simone,

Op 24/07/11 12:23, het Simone Busoli geskryf:
> I would like to try adding a max-hops option to the shovel addin, but I have
> no past experience in erlang nor in building an addin from the sources. I
> looked at the docs and I would like to know whether building on Windows is
> supported and especially if I need to build the server too, or a binary
> deployment is enough to modify and test the addin.

It is fairly easy to build the broker on Windows if Cygwin is installed.
You will need at least GNU Make and have the Erlang compiler and
utilities in $PATH. You may want to go this route if you need to modify
the broker or if you want to develop against the very latest unreleased
version of the broker.

If you don't need to modify the broker then dropping your .ez file in
the plugins directory of a released build will work. Creating symlinks
in the plugins directory as suggested in the plugins development page
will not work on Windows.

http://www.rabbitmq.com/plugin-development.html


-Emile

From simone.busoli at gmail.com  Sun Jul 24 13:01:33 2011
From: simone.busoli at gmail.com (Simone Busoli)
Date: Sun, 24 Jul 2011 14:01:33 +0200
Subject: [rabbitmq-discuss] Building addins on Windows
In-Reply-To: <4E2C069E.502@rabbitmq.com>
References: <CAOn7oW9Z7EtU_W-9Xs17_-NTvh9Esno45=7W1PJ0EDNqKfqzSw@mail.gmail.com>
	<4E2C069E.502@rabbitmq.com>
Message-ID: <CAOn7oW9RHg754rmSb7z=WChv=KZJJDZO9QUgc_nP2wpBv+VV9g@mail.gmail.com>

Thanks Emile, so I'll just need to build the plugin itself if I don't need
to change the server, right?
And building the plugin, the shovel in this case, does have any specific
requirements?
On Jul 24, 2011 1:48 PM, "Emile Joubert" <emile at rabbitmq.com> wrote:
> Hi Simone,
>
> Op 24/07/11 12:23, het Simone Busoli geskryf:
>> I would like to try adding a max-hops option to the shovel addin, but I
have
>> no past experience in erlang nor in building an addin from the sources. I
>> looked at the docs and I would like to know whether building on Windows
is
>> supported and especially if I need to build the server too, or a binary
>> deployment is enough to modify and test the addin.
>
> It is fairly easy to build the broker on Windows if Cygwin is installed.
> You will need at least GNU Make and have the Erlang compiler and
> utilities in $PATH. You may want to go this route if you need to modify
> the broker or if you want to develop against the very latest unreleased
> version of the broker.
>
> If you don't need to modify the broker then dropping your .ez file in
> the plugins directory of a released build will work. Creating symlinks
> in the plugins directory as suggested in the plugins development page
> will not work on Windows.
>
> http://www.rabbitmq.com/plugin-development.html
>
>
> -Emile
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110724/5ec8ff67/attachment.htm>

From simone.busoli at gmail.com  Sun Jul 24 17:03:32 2011
From: simone.busoli at gmail.com (Simone Busoli)
Date: Sun, 24 Jul 2011 18:03:32 +0200
Subject: [rabbitmq-discuss] Building addins on Windows
In-Reply-To: <CAOn7oW9RHg754rmSb7z=WChv=KZJJDZO9QUgc_nP2wpBv+VV9g@mail.gmail.com>
References: <CAOn7oW9Z7EtU_W-9Xs17_-NTvh9Esno45=7W1PJ0EDNqKfqzSw@mail.gmail.com>
	<4E2C069E.502@rabbitmq.com>
	<CAOn7oW9RHg754rmSb7z=WChv=KZJJDZO9QUgc_nP2wpBv+VV9g@mail.gmail.com>
Message-ID: <CAOn7oW-NhR329GmWD6oCMBRVsc+iB50zkZyBdMsKzyviV9T2PQ@mail.gmail.com>

Hi, I'm having some issues building the shovel addin on Windows under
cygwin. I am following the instructions in the README of the addin, cloning
the umbrella project and the others below it (I think the addin requires
erlando as well, which is not documented).
I can build the rabbitmq-erlang-client just fine, but erlando and server
fail, which prevent me from building the shovel addin. The problem seems to
be related to escript (I'm invoking my Windows erlang installation as it
appears Erlang won't build under cygwin), and not the one related to
appending .exe when invoking it since I patched the scripts to do that
already.
When invoking escript.exe from the win command line it works, while invoking
it from cygwin always gives "Failed to open file ...". It looks like escript
windows version doesn't play nice with cygwin.
That said, if I didn't have to build server and erlando I may be able to
build the shovel addin, but I could not figure out how to point it to my
existing server binaries.

On Sun, Jul 24, 2011 at 14:01, Simone Busoli <simone.busoli at gmail.com>wrote:

> Thanks Emile, so I'll just need to build the plugin itself if I don't need
> to change the server, right?
> And building the plugin, the shovel in this case, does have any specific
> requirements?
> On Jul 24, 2011 1:48 PM, "Emile Joubert" <emile at rabbitmq.com> wrote:
> > Hi Simone,
> >
> > Op 24/07/11 12:23, het Simone Busoli geskryf:
> >> I would like to try adding a max-hops option to the shovel addin, but I
> have
> >> no past experience in erlang nor in building an addin from the sources.
> I
> >> looked at the docs and I would like to know whether building on Windows
> is
> >> supported and especially if I need to build the server too, or a binary
> >> deployment is enough to modify and test the addin.
> >
> > It is fairly easy to build the broker on Windows if Cygwin is installed.
> > You will need at least GNU Make and have the Erlang compiler and
> > utilities in $PATH. You may want to go this route if you need to modify
> > the broker or if you want to develop against the very latest unreleased
> > version of the broker.
> >
> > If you don't need to modify the broker then dropping your .ez file in
> > the plugins directory of a released build will work. Creating symlinks
> > in the plugins directory as suggested in the plugins development page
> > will not work on Windows.
> >
> > http://www.rabbitmq.com/plugin-development.html
> >
> >
> > -Emile
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110724/a5c63e5c/attachment.htm>

From bryanalves at gmail.com  Sun Jul 24 18:30:06 2011
From: bryanalves at gmail.com (Bryan Alves)
Date: Sun, 24 Jul 2011 13:30:06 -0400
Subject: [rabbitmq-discuss] RabbitMQ crash in production - help diagnose
 from log
In-Reply-To: <4E13816C.7040905@rabbitmq.com>
References: <BANLkTi=qQ-wYE5LYRk-0oV1vhiCyTR_40g@mail.gmail.com>
	<4E0F0B67.3020408@rabbitmq.com> <4E13816C.7040905@rabbitmq.com>
Message-ID: <CAGErLKUejhMUVC1dVvOfo6ccOxEFGxgui8X-NR0sUxSDATgPGA@mail.gmail.com>

Sorry for taking so long to get back, my answers inline

On Tue, Jul 5, 2011 at 5:26 PM, Matthias Radestock <matthias at rabbitmq.com>wrote:

> Bryan,
>
> On 02/07/11 13:13, Matthias Radestock wrote:
>
>> It looks like the crash might be triggered by a rare race
>> condition. [...] Nothing obvious jumps out at me from the
>> code, so this may take a while to track down.
>>
>
> As feared, a few hours of poking the code hasn't thrown up any dirt.
>
> Do you still have the rabbit.log file from around the time of the crash? If
> so, please send it to us.
>

Sorry I don't have this anymore.


>
> Also, it would be useful to get some more details on how you are using
> rabbit...
>
> How many queues are there? How much queue churn is there (i.e. queues being
> created and deleted)?
>

There's about 3 durable queues.  0 churn


>
> Do published messages only ever get routed to a single queue or can they
> get routed to multiple queues?
>


Messages very often (>90%, estimate) get routed to multiple queues


>
> How big are the messages?
>

< 1k bytes


>
> How long (#messages) are the queues, and how does that figure change over
> time?
>

Consumers almost always keep up with load, so the queue size is usually 0,
occasionally there will be spikes if we manually dump a lot of messages into
the queue.  Spikes in this sense is a few thousand messages, up to maybe
50,000 messages.  Queues will gradually make their way back to 0 after a few
minutes after these instances.


>
>
> Regards,
>
> Matthias.
>



-- 
Bryan Alves
Software Engineer
Blue State Digital
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110724/0a063e62/attachment.htm>

From james.r.carr at gmail.com  Sun Jul 24 19:52:21 2011
From: james.r.carr at gmail.com (James Carr)
Date: Sun, 24 Jul 2011 13:52:21 -0500
Subject: [rabbitmq-discuss] Server crash, won't start up
Message-ID: <CAJreXKACDmUrBo2FB0=gG_Srw4OFoPd2rX9sKvUwzggrKAXkvA@mail.gmail.com>

Hi All,

I have a server that crashed over the weekend and when attempting to
restart the server hangs on

"starting exchange, queue and binding recovery                         ..."

Any way to recover this or find any other details on how to get the
server up and running?

Thanks,
James

From matthew at rabbitmq.com  Sun Jul 24 19:58:34 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Sun, 24 Jul 2011 19:58:34 +0100
Subject: [rabbitmq-discuss] Server crash, won't start up
In-Reply-To: <CAJreXKACDmUrBo2FB0=gG_Srw4OFoPd2rX9sKvUwzggrKAXkvA@mail.gmail.com>
References: <CAJreXKACDmUrBo2FB0=gG_Srw4OFoPd2rX9sKvUwzggrKAXkvA@mail.gmail.com>
Message-ID: <20110724185833.GA1414@rabbitmq.com>

On Sun, Jul 24, 2011 at 01:52:21PM -0500, James Carr wrote:
> I have a server that crashed over the weekend and when attempting to
> restart the server hangs on
> 
> "starting exchange, queue and binding recovery                         ..."
> 
> Any way to recover this or find any other details on how to get the
> server up and running?

What makes you think it hangs? Is there no disk or CPU activity? if it's
recovering from a crash, startup time can be proportional to the number
of msgs stored on disk. It can take a long time.

But why did it crash?

Matthew

From james.r.carr at gmail.com  Sun Jul 24 20:28:05 2011
From: james.r.carr at gmail.com (James Carr)
Date: Sun, 24 Jul 2011 14:28:05 -0500
Subject: [rabbitmq-discuss] Server crash, won't start up
In-Reply-To: <20110724185833.GA1414@rabbitmq.com>
References: <CAJreXKACDmUrBo2FB0=gG_Srw4OFoPd2rX9sKvUwzggrKAXkvA@mail.gmail.com>
	<20110724185833.GA1414@rabbitmq.com>
Message-ID: <CAJreXKBNOcEGuzZ49iKMF74uVwecPmg9Q3DJqsg6Xtzj7vJiAA@mail.gmail.com>

I'm still sleuthing around to figure out the crash. The box had been
restarted due to connection issues and hangs in that stage during
startup.

for now I deleted the data files under
/var/lib/rabbitmq/mnesia/rabbit at brokerm01 and it starts up fine
(albiet with any unprocessed messages dropped). Still looking through
the logs to see what happened... is there any place that records
memory high watermark bypasses?

Luckily this was on a test server. :)

Thanks,
James


On Sun, Jul 24, 2011 at 1:58 PM, Matthew Sackman <matthew at rabbitmq.com> wrote:
> On Sun, Jul 24, 2011 at 01:52:21PM -0500, James Carr wrote:
>> I have a server that crashed over the weekend and when attempting to
>> restart the server hangs on
>>
>> "starting exchange, queue and binding recovery ? ? ? ? ? ? ? ? ? ? ? ? ..."
>>
>> Any way to recover this or find any other details on how to get the
>> server up and running?
>
> What makes you think it hangs? Is there no disk or CPU activity? if it's
> recovering from a crash, startup time can be proportional to the number
> of msgs stored on disk. It can take a long time.
>
> But why did it crash?
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From rmurthi at gilt.com  Sun Jul 24 22:02:57 2011
From: rmurthi at gilt.com (Raymond Murthi)
Date: Sun, 24 Jul 2011 17:02:57 -0400
Subject: [rabbitmq-discuss] Slow shutdown issue
In-Reply-To: <CABzX+qy7+B5ewi-_dzZ0Fbuof-xhoWPn-PH3M5QLLXx1Sfh3Vw@mail.gmail.com>
References: <AcxH2u7vx+chcBYwSO2b7P7NgJuzvw==>
	<62F8A49C-F4C3-46DA-B451-08C6D9E44B6C@gilt.com>
	<CABzX+qy7+B5ewi-_dzZ0Fbuof-xhoWPn-PH3M5QLLXx1Sfh3Vw@mail.gmail.com>
Message-ID: <7E8DA6E9-4761-450F-A54D-631FEFF1D753@gilt.com>

Hi Marek/Matthew, 

Thank you for your replies. They have been really helpful for me. I did further tests and everything looks much clearer now.

@Marek: yup, I explicitly overloaded the queue to understand where messages go after the memory is used up. I suppose it could also happen when all consumers somehow stop consuming or in faster publisher/slow consumer scenarios. We would like to put some monitoring in place to prevent that from happening though.  

@Matthew: Does declaring queue as exclusive mean that the broker can only accept one connection to the queue? If so, isn't it preventing both sender and consumer to connect to the queue at the same time? I tried and as expected, I got an exception for doing so.


-Ray

On Jul 22, 2011, at 4:59 AM, Marek Majkowski wrote:

> Hi,
> 
> I don't know the answers to all your questions.
> 
> On Thu, Jul 21, 2011 at 20:18, Raymond Murthi <rmurthi at gilt.com> wrote:
>> I am pretty new on RabbitMQ and I am trying to do a stress test on RabbitMQ (v. 2.5.1) using the following properties: 1kb persistent message, nondurable queue, and without any ready consumer (that is, just writing to the queue). However, every time I overload the RAM (13.7GB high watermark) and force RabbitMQ to write to disk, I always experience a very long wait time whenever I want to shutdown the server/stopping the app/purging the queue. The wait time could be over an hour depending on the number of messages I sent (I sent over 5 millions messages). I  also notice that RabbitMQ tries to dump the messages from the memory to the disk (under /msg_store_transient) - since nothing is consumed.
> 
> This is quite a hard thing for rabbit - you're using it as a database
> rather than messaging system!
> 
>> Is it a common behavior? I read the documentation and it looks like it is (but isn't it too long?).
>> How to kill the process immediately?
> 
> I can only suggest what you already know: queue_purge or queue_delete.
> 
>> And why are messages stored under /msg_store_transient instead of /msg_store_persistent? What  is the difference between the two directories?
> 
> You said you are sending messages to a nondurable queue - so in a case
> of broker shutdown, the queue will be lost. If you want to use
> persistance, you need to send persistent messages to a durable queue.
> That's why you see messages in the msg_store_transient.
> 
> I would be interested to hear what are the results of your test for
> persistent/durable messages!
> (though rabbit will probably initally be slower)
> 
>> I would like to understand on the memory/disk usage and how messages are stored.
> 
> Cheers,
>  Marek

Thanks, 
-Ray


From toby.corkindale at strategicdata.com.au  Mon Jul 25 02:10:55 2011
From: toby.corkindale at strategicdata.com.au (Toby Corkindale)
Date: Mon, 25 Jul 2011 11:10:55 +1000
Subject: [rabbitmq-discuss] STOMP plugin and virtual hosts
In-Reply-To: <4E26AA61.5030705@rabbitmq.com>
References: <4E25547B.3080606@strategicdata.com.au>	<4E255FFB.5090703@rabbitmq.com>	<4E263379.4010808@strategicdata.com.au>	<4E263CB5.6010702@strategicdata.com.au>
	<4E26AA61.5030705@rabbitmq.com>
Message-ID: <4E2CC29F.1070107@strategicdata.com.au>

On 20/07/11 20:13, Simon MacMullen wrote:
> On 20/07/11 03:25, Toby Corkindale wrote:
>>
>> It seems like there's been some good activity on CPAN in just the last
>> few months - I just discovered Net::STOMP::Client, which implements
>> STOMP 1.1, and Net::RabbitMQ (which uses AMQP).
>
> FTR the current STOMP plugin doesn't treat 1.1 as very different from
> 1.0 (since 1.1 is almost entirely a tightening-up and clarification) so
> if you can persuade your client to set a host header on CONNECT with
> 1.0, you should be good.

Ah, I'd like to get the client-server heartbeat stuff going too, which 
comes for free with the later Perl STOMP client anyway.
(Although in the end I've had to submit a patch to make it actually work..)

Toby

From michael.s.klishin at gmail.com  Mon Jul 25 04:39:44 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 25 Jul 2011 07:39:44 +0400
Subject: [rabbitmq-discuss] [announcement] Ruby amqp gem 0.8.0.rc14 is
	released
Message-ID: <CAE3HoVRXk5X6w3nhXih0Udosago840sZwF67AXBCYt25LTdNiw@mail.gmail.com>

amqp gem 0.8.0.RC14 is released to rubygems.org. All 0.8.0.RCs users are
highly encouraged to upgrade.

== Backwards compatibility with RC13

0.8.0.RC14 is fully backwards compatible with RC13 but amq-client library
will need an upgrade to the 0.8.0 (which is already available from
rubygems.org). When upgrading, make
sure to update your Gemfile or .gemspec dependency on amq-client if
necessary.

To check that you have RC14 installed, you can use irb and check
AMQP::VERSION constant.

If you have questions about upgrading, join #rabbitmq IRC channel on
freenode.net and I (antares_) will
be happy to answer them.


== Highlights

0.8.0.RC14 introduces a number of exciting features related to application
recovery from network & broker failures:

* A number of events/callbacks and API methods useful to developers who want
to implement their own recovery strategies.
* Automatic recovery mode that makes it very easy to re-declare all
entities, bindings & consumers when AMQP connection recovers from
  a network outage or broker failure: it is opt-in (not opt-out) and will
make recovery significantly simpler for "the 80%" of apps.

Documentation of these features is available at
http://bit.ly/amqp-gem-error-handling-and-recovery



== Bug fixes

RC14 includes two bug fixes:

* Empty messages are now framed properly. Yes, it took us 3 years to get
this right.
* Sporadic UNEXPECTED_FRAME exceptions in multi-threaded publisher apps are
now gone. AMQP::Exchange#publish now internally synchronizes data delivery
  on the channel exchange is associated with.
  This makes sure that even if you end up publishing from multiple threads,
frames will be delivered in the proper order.



== Other features & API usability improvements

There are also other improvements:

* RC14 no longer has pre-release gem dependencies. This should make life
easier for RubyGems 1.3.7 users (this includes those running on Heroku).
   RubyGems 1.3.7, also know as "the Internet Explorer 6 of the Ruby
ecosystem", has broken pre-release version comparison and considers
   version 0.8.0.rc9 to be more recent than 0.8.0.rc14, for example.

* Ability to register more than one consumer per queue on the same channel.
Historically AMQP:::Queue#subscribe only allowed to register one consumer.
  This is still being the case for backwards compatibility but you now can
easily instantiate AMQP::Consumers directly.

* New bitset-based channel id allocator. Previously apps that open & close
channels aggressively could hit connection max channel limit
  pretty quickly because channel id was a growing integer. Now channel id
are allocated from a pool of integers, just as in the RabbitMQ Java client.

* Broker capabilities introspection API. See
http://www.rabbitmq.com/extensions.html#capabilities
* Support for arrays in attribute tables (for example, message headers)



== Documentation improvements

As usual, we keep improving my favorite amqp gem feature: documentation (
http://bit.ly/amqp-gem-docs).

* Documentation is now being proof-read and edited by Chris Duncan, the
creator of the bunny gem.
* AMQP 0.9.1 Mode Explained guide (http://bit.ly/amqp-model-explained) is
about 2 pages long and explains AMQP 0.9.1 concepts & features in simple
language. If you were
  looking for something between shallow blog posts about AMQP and reading
the whole spec document, this guide is for you.
* Initial bits of the Migration guide 0.6.x and 0.7.x to 0.8.x (
http://bit.ly/amqp-gem-080-migration-guide)
* Initial bits of the Patterns & Use Cases guide (
http://bit.ly/amqp-gem-patterns) that explains how to implement many
patterns from the Enterprise Integration Patterns book (
http://www.eaipatterns.com)
* TLS guide
* Numerous small improvements to all other guides & code examples.


== The Road to 0.8.0

Many people have expressed their interest in knowing when 0.8.0 is going to
be out. Lets get this out of the way.

RC14 is the second to last RC before 0.8.0. Here's what to expect in RC15:

* RC15 will bring up support for Ruby 1.8.7-p249 (this particular patch
level) that has a bug that seriously affects amqp gem.
 Working around it will take a moderate refactoring on our side. Learn more
in the FAQ at the bottom of
https://github.com/ruby-amqp/amqp/blob/master/README.md

* RC15 will see many documentation improvements. We will finish 0.6.x/0.7.x
=> 0.8.x migration guide, RabbitMQ extensions guide, Bindings guide and
expand Patterns & Use Cases guide.
Existing documentation is pretty good but certainly can be improved &
expanded.

* RC15 will involve heavy QA and interoperability test suite with the
RabbitMQ Java client and Pika, the most popular Python client. Many people
(including myself)
have been using amqp gem 0.8.0.RCs with those two for quite some time but
there is no such thing as "too much QA".

After that, there will be only bug fixes and documentation corrections, as
needed. All the other ideas/feature requests are put in the queue for
v0.9.0.

So, give RC14 a spin and have a good day.

-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110725/665cc043/attachment.htm>

From emile at rabbitmq.com  Mon Jul 25 10:06:34 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 25 Jul 2011 10:06:34 +0100
Subject: [rabbitmq-discuss] Building addins on Windows
In-Reply-To: <CAOn7oW-NhR329GmWD6oCMBRVsc+iB50zkZyBdMsKzyviV9T2PQ@mail.gmail.com>
References: <CAOn7oW9Z7EtU_W-9Xs17_-NTvh9Esno45=7W1PJ0EDNqKfqzSw@mail.gmail.com>
	<4E2C069E.502@rabbitmq.com>
	<CAOn7oW9RHg754rmSb7z=WChv=KZJJDZO9QUgc_nP2wpBv+VV9g@mail.gmail.com>
	<CAOn7oW-NhR329GmWD6oCMBRVsc+iB50zkZyBdMsKzyviV9T2PQ@mail.gmail.com>
Message-ID: <4E2D321A.6050000@rabbitmq.com>

Hi Simone,

On 24/07/11 17:03, Simone Busoli wrote:
> When invoking escript.exe from the win command line it works, while
> invoking it from cygwin always gives "Failed to open file ...". It looks
> like escript windows version doesn't play nice with cygwin.

My apologies - I should have checked first. It looks like not all the
latest build scripts work on Cygwin. Part of the problem is the way that
paths are constructed. Another is that escript treats empty arguments
differently on Windows. I will file a bug.

> That said, if I didn't have to build server and erlando I may be able to
> build the shovel addin, but I could not figure out how to point it to my
> existing server binaries.

You should drop the *.ez files in the server plugins/ directory.


I understand that you are now building successfully on Ubuntu. That
would have been my suggested workaround.



-Emile

From Simone.Busoli at ferrari.com  Mon Jul 25 10:45:09 2011
From: Simone.Busoli at ferrari.com (Busoli, Simone)
Date: Mon, 25 Jul 2011 09:45:09 +0000
Subject: [rabbitmq-discuss] Shovel with exchange-exchange bindings
Message-ID: <88E590DC4586974D825FC82AE798294E520208AA@GSVCLU03.ges.ferlan.it>

I'm trying to set up a shovel with exchange-exchange bindings to workaround the issue with infinite loops when configuring a symmetric shovel between two brokers (to achieve transparent bidirectional communication), but I get an error on broker startup as if the shovel didn't support exchange-exchange bindings.

As suggested by Matthew some time ago on the list this is what I'm trying to accomplish:

              /---------------------[ Shovel 2 ]---------------------\
              |                                                      |
              V                                                      |
--->[X1]--->[X2]---->[[my queues]]        [[my queues]]<---[X2]<---[X1]<---
     |                                                       ^
     |                                                       |
     \------------------[ Shovel 1 ]-------------------------/


But on broker startup I get  this:

{"Kernel pid terminated",application_controller,"{application_start_failure,rabbitmq_shovel,{{invalid_shovel_configuration,test1,{invalid_parameter_value,sources,{unknown_method_name,'exchange.bind'}}},{rabbit_shovel,start,[normal,[]]}}}"}

Here is the configuration fragment:

{test1,
      [{sources, [{broker, "amqp://"},
                       {declarations,
                          [	{'exchange.declare',
                                  [{exchange, <<"X1">>},
                                   {type, <<"topic">>}]},
		{'exchange.declare',
                                  [{exchange, <<"X2">>},
                                   {type, <<"topic">>}]},
		{'queue.declare',
		   [{queue, <<"xshovelqueue">>}]},
                           {	'queue.bind',
                                  [{exchange, <<"X1">>},
                                   {queue,    <<"xshovelqueue">>},
		   {routing_key, <<"#">>}]},
		{'exchange.bind',
                                  [{source, <<"X1">>},
                                   {destination,    <<"X2">>},
		    {routing_key, <<"#">>}]}
                          ]}]},
       {destinations, [{broker, "amqp://localhost/shovel"},
                       {declarations,
                          [{'exchange.declare',
                                  [{exchange, <<"X2">>},
                                   {type, <<"topic">>}]}
                          ]}]},
       {queue, <<"xshovelqueue">>},
       {auto_ack, false},
       {tx_size, 0}
      ]}

_________________________________________________________________________________________________________________
Questo messaggio e da intendersi esclusivamente ad uso del destinatario e puo contenere informazioni che sono di natura privilegiata, confidenziale
o non divulgabile secondo le leggi vigenti. Se il lettore del presente messaggio non e il destinatario designato, o il dipendente/agente responsabile
per la consegna del messaggio al destinatario designato, si informa che ogni disseminazione, distribuzione o copiatura di questa comunicazione e 
strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
immediatamente a mezzo e-mail di risposta e successivamente di procedere alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
_________________________________________________________________________________________________________________
This message is intended only for the use of the addressee and may contain information that is privileged, confidential and exempt from 
disclosure under applicable law. If the reader of this message is not the intended recipient, or the employee or agent responsible for delivering the 
message to the intended recipient, you are hereby notified that any dissemination, distribution or copying of this communication is strictly 
prohibited. If you have received this e-mail in error, please notify us immediately by return e-mail and delete this e-mail and all attachments from 
your system.
_________________________________________________________________________________________________________________


From lionel.cons at cern.ch  Mon Jul 25 10:55:21 2011
From: lionel.cons at cern.ch (Lionel Cons)
Date: Mon, 25 Jul 2011 11:55:21 +0200
Subject: [rabbitmq-discuss] STOMP plugin and virtual hosts
In-Reply-To: <4E263CB5.6010702@strategicdata.com.au> (Toby Corkindale's
	message of "Wed, 20 Jul 2011 12:25:57 +1000")
References: <4E25547B.3080606@strategicdata.com.au>
	<4E255FFB.5090703@rabbitmq.com>
	<4E263379.4010808@strategicdata.com.au>
	<4E263CB5.6010702@strategicdata.com.au>
Message-ID: <vfqlivmd6ra.fsf@mail.cern.ch>

Toby Corkindale <toby.corkindale at strategicdata.com.au> writes:
> It seems like there's been some good activity on CPAN in just the last
> few months - I just discovered Net::STOMP::Client, which implements
> STOMP 1.1, and Net::RabbitMQ (which uses AMQP).

Toby,

I confirm that Net::STOMP::Client does support STOMP 1.1, is used in
production on hundreds of machines and is actively maintained (by me).

Cheers,

Lionel

From matthew at rabbitmq.com  Mon Jul 25 11:56:59 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 25 Jul 2011 11:56:59 +0100
Subject: [rabbitmq-discuss] Shovel with exchange-exchange bindings
In-Reply-To: <88E590DC4586974D825FC82AE798294E520208AA@GSVCLU03.ges.ferlan.it>
References: <88E590DC4586974D825FC82AE798294E520208AA@GSVCLU03.ges.ferlan.it>
Message-ID: <20110725105659.GB398@rabbitmq.com>

Hi Simone,

On Mon, Jul 25, 2011 at 09:45:09AM +0000, Busoli, Simone wrote:
> I'm trying to set up a shovel with exchange-exchange bindings to
> workaround the issue with infinite loops when configuring a symmetric
> shovel between two brokers (to achieve transparent bidirectional
> communication), but I get an error on broker startup as if the shovel
> didn't support exchange-exchange bindings.
> 
> As suggested by Matthew some time ago on the list this is what I'm
> trying to accomplish:
> 
>               /---------------------[ Shovel 2 ]---------------------\
>               |                                                      |
>               V                                                      |
> --->[X1]--->[X2]---->[[my queues]]        [[my queues]]<---[X2]<---[X1]<---
>      |                                                       ^
>      |                                                       |
>      \------------------[ Shovel 1 ]-------------------------/

That's a very pretty picture ;)

> But on broker startup I get  this:
> 
> {"Kernel pid terminated",application_controller,"{application_start_failure,rabbitmq_shovel,{{invalid_shovel_configuration,test1,{invalid_parameter_value,sources,{unknown_method_name,'exchange.bind'}}},{rabbit_shovel,start,[normal,[]]}}}"}
> 

Yup. I've just fixed this on default - if you pull from our hg repos,
update, and compile again, then you'll get it working though check the
README because a few other things have changed in the mean time (like
support for confirms has been added, and support for transactions has
been removed).

In short, the problem was that the shovel predated Rabbit's support of
AMQP 0-9-1. When 0-9-1 was added, the shovel seems to have been forced
to check only 0-8 methods. As such, it didn't have support for our
extensions to 0-9-1 (at least from configuration - the actual erlang
client being used does connect using 0-9-1 and uses those features that
we've added, such as confirms). Anyway, fixed now.

Many thanks for the bug reports - the shovel will clearly benefit!


Matthew

From Simone.Busoli at ferrari.com  Mon Jul 25 12:06:50 2011
From: Simone.Busoli at ferrari.com (Busoli, Simone)
Date: Mon, 25 Jul 2011 11:06:50 +0000
Subject: [rabbitmq-discuss] Shovel with exchange-exchange bindings
In-Reply-To: <20110725105659.GB398@rabbitmq.com>
References: <88E590DC4586974D825FC82AE798294E520208AA@GSVCLU03.ges.ferlan.it>
	<20110725105659.GB398@rabbitmq.com>
Message-ID: <88E590DC4586974D825FC82AE798294E52020989@GSVCLU03.ges.ferlan.it>

Thank you very much Matthew. Now, isn't there a chance that you have some spare time to add the max-hops option to the shovel addin as well? ;)
Because all I'm trying to do with these tricks is what I would accomplish with that.. I am already working on it, I've been able to build the addin and its dependencies on Ubuntu - which is unfamiliar environment for me - but my erlang-fu is still not very good.

As a side note,  as mentioned in another thread, shovel has a dependency on erlando, which is not documented in the readme.

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Matthew Sackman
Sent: Monday, July 25, 2011 12:57 PM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Shovel with exchange-exchange bindings

Hi Simone,

On Mon, Jul 25, 2011 at 09:45:09AM +0000, Busoli, Simone wrote:
> I'm trying to set up a shovel with exchange-exchange bindings to 
> workaround the issue with infinite loops when configuring a symmetric 
> shovel between two brokers (to achieve transparent bidirectional 
> communication), but I get an error on broker startup as if the shovel 
> didn't support exchange-exchange bindings.
> 
> As suggested by Matthew some time ago on the list this is what I'm 
> trying to accomplish:
> 
>               /---------------------[ Shovel 2 ]---------------------\
>               |                                                      |
>               V                                                      |
> --->[X1]--->[X2]---->[[my queues]]        [[my queues]]<---[X2]<---[X1]<---
>      |                                                       ^
>      |                                                       |
>      \------------------[ Shovel 1 ]-------------------------/

That's a very pretty picture ;)

> But on broker startup I get  this:
> 
> {"Kernel pid 
> terminated",application_controller,"{application_start_failure,rabbitm
> q_shovel,{{invalid_shovel_configuration,test1,{invalid_parameter_value
> ,sources,{unknown_method_name,'exchange.bind'}}},{rabbit_shovel,start,
> [normal,[]]}}}"}
> 

Yup. I've just fixed this on default - if you pull from our hg repos, update, and compile again, then you'll get it working though check the README because a few other things have changed in the mean time (like support for confirms has been added, and support for transactions has been removed).

In short, the problem was that the shovel predated Rabbit's support of AMQP 0-9-1. When 0-9-1 was added, the shovel seems to have been forced to check only 0-8 methods. As such, it didn't have support for our extensions to 0-9-1 (at least from configuration - the actual erlang client being used does connect using 0-9-1 and uses those features that we've added, such as confirms). Anyway, fixed now.

Many thanks for the bug reports - the shovel will clearly benefit!


Matthew
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

_________________________________________________________________________________________________________________
Questo messaggio e da intendersi esclusivamente ad uso del destinatario e puo contenere informazioni che sono di natura privilegiata, confidenziale
o non divulgabile secondo le leggi vigenti. Se il lettore del presente messaggio non e il destinatario designato, o il dipendente/agente responsabile
per la consegna del messaggio al destinatario designato, si informa che ogni disseminazione, distribuzione o copiatura di questa comunicazione e 
strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
immediatamente a mezzo e-mail di risposta e successivamente di procedere alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
_________________________________________________________________________________________________________________
This message is intended only for the use of the addressee and may contain information that is privileged, confidential and exempt from 
disclosure under applicable law. If the reader of this message is not the intended recipient, or the employee or agent responsible for delivering the 
message to the intended recipient, you are hereby notified that any dissemination, distribution or copying of this communication is strictly 
prohibited. If you have received this e-mail in error, please notify us immediately by return e-mail and delete this e-mail and all attachments from 
your system.
_________________________________________________________________________________________________________________


From matthew at rabbitmq.com  Mon Jul 25 12:10:52 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 25 Jul 2011 12:10:52 +0100
Subject: [rabbitmq-discuss] Shovel with exchange-exchange bindings
In-Reply-To: <88E590DC4586974D825FC82AE798294E52020989@GSVCLU03.ges.ferlan.it>
References: <88E590DC4586974D825FC82AE798294E520208AA@GSVCLU03.ges.ferlan.it>
	<20110725105659.GB398@rabbitmq.com>
	<88E590DC4586974D825FC82AE798294E52020989@GSVCLU03.ges.ferlan.it>
Message-ID: <20110725111052.GC398@rabbitmq.com>

On Mon, Jul 25, 2011 at 11:06:50AM +0000, Busoli, Simone wrote:
> Thank you very much Matthew. Now, isn't there a chance that you have
> some spare time to add the max-hops option to the shovel addin as
> well? ;)

I'm fairly sure that'll not get approval from the politburo around here,
I'm afraid. Plus almost exactly that feature is sort of in federation.

> As a side note,  as mentioned in another thread, shovel has a
> dependency on erlando, which is not documented in the readme.

Yes thanks for that. Neither I, nor the QA, caught that oversight when
that change was made. I'll sort that.

Matthew

From matthew at rabbitmq.com  Mon Jul 25 12:31:39 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 25 Jul 2011 12:31:39 +0100
Subject: [rabbitmq-discuss] Shovel with exchange-exchange bindings
In-Reply-To: <20110725111052.GC398@rabbitmq.com>
References: <88E590DC4586974D825FC82AE798294E520208AA@GSVCLU03.ges.ferlan.it>
	<20110725105659.GB398@rabbitmq.com>
	<88E590DC4586974D825FC82AE798294E52020989@GSVCLU03.ges.ferlan.it>
	<20110725111052.GC398@rabbitmq.com>
Message-ID: <20110725113139.GD398@rabbitmq.com>

On Mon, Jul 25, 2011 at 12:10:52PM +0100, Matthew Sackman wrote:
> > As a side note,  as mentioned in another thread, shovel has a
> > dependency on erlando, which is not documented in the readme.
> 
> Yes thanks for that. Neither I, nor the QA, caught that oversight when
> that change was made. I'll sort that.

Done. Note though that the website only documents the current released
version, so that won't get changed until the next release. However, the
README in the shovel is now rather more accurate (and standardised).

Matthew

From Simone.Busoli at ferrari.com  Mon Jul 25 13:28:30 2011
From: Simone.Busoli at ferrari.com (Busoli, Simone)
Date: Mon, 25 Jul 2011 12:28:30 +0000
Subject: [rabbitmq-discuss] Shovel with exchange-exchange bindings
In-Reply-To: <20110725111052.GC398@rabbitmq.com>
References: <88E590DC4586974D825FC82AE798294E520208AA@GSVCLU03.ges.ferlan.it><20110725105659.GB398@rabbitmq.com><88E590DC4586974D825FC82AE798294E52020989@GSVCLU03.ges.ferlan.it>
	<20110725111052.GC398@rabbitmq.com>
Message-ID: <88E590DC4586974D825FC82AE798294E52020A4C@GSVCLU03.ges.ferlan.it>

That's unfortunate as we had to rely on a custom 'shoveler' built outside of the server to achieve that, which is not something we would have liked to do.
By the way,  what is the current status of the federation addin? It will definitely work in our scenario, although I think it is going to present still some issues in building distributed request-reply use cases.

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Matthew Sackman
Sent: Monday, July 25, 2011 1:11 PM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Shovel with exchange-exchange bindings

On Mon, Jul 25, 2011 at 11:06:50AM +0000, Busoli, Simone wrote:
> Thank you very much Matthew. Now, isn't there a chance that you have 
> some spare time to add the max-hops option to the shovel addin as 
> well? ;)

I'm fairly sure that'll not get approval from the politburo around here, I'm afraid. Plus almost exactly that feature is sort of in federation.

> As a side note,  as mentioned in another thread, shovel has a 
> dependency on erlando, which is not documented in the readme.

Yes thanks for that. Neither I, nor the QA, caught that oversight when that change was made. I'll sort that.

Matthew
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

_________________________________________________________________________________________________________________
Questo messaggio e da intendersi esclusivamente ad uso del destinatario e puo contenere informazioni che sono di natura privilegiata, confidenziale
o non divulgabile secondo le leggi vigenti. Se il lettore del presente messaggio non e il destinatario designato, o il dipendente/agente responsabile
per la consegna del messaggio al destinatario designato, si informa che ogni disseminazione, distribuzione o copiatura di questa comunicazione e 
strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
immediatamente a mezzo e-mail di risposta e successivamente di procedere alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
_________________________________________________________________________________________________________________
This message is intended only for the use of the addressee and may contain information that is privileged, confidential and exempt from 
disclosure under applicable law. If the reader of this message is not the intended recipient, or the employee or agent responsible for delivering the 
message to the intended recipient, you are hereby notified that any dissemination, distribution or copying of this communication is strictly 
prohibited. If you have received this e-mail in error, please notify us immediately by return e-mail and delete this e-mail and all attachments from 
your system.
_________________________________________________________________________________________________________________


From myname.whatis at gmail.com  Mon Jul 25 15:37:25 2011
From: myname.whatis at gmail.com (albert_newton)
Date: Mon, 25 Jul 2011 07:37:25 -0700 (PDT)
Subject: [rabbitmq-discuss] What is the server-name to get the
 rabbitmqadmin
In-Reply-To: <45598043.337755.1311332496316.JavaMail.root@zimbra-prod-mbox-4.vmware.com>
References: <32102103.post@talk.nabble.com>
	<45598043.337755.1311332496316.JavaMail.root@zimbra-prod-mbox-4.vmware.com>
Message-ID: <32132293.post@talk.nabble.com>


I was able to use localhost to hit through the browser. Thanks.




Ann Witbrock wrote:
> 
> Hi Albert,
> Are your broker and plugins on Windows?
> After installing plugins you would need to again remove, (re)install and
> start the service (From the start menu is easiest, or just reboot your
> machine).
> On other platforms, you may need to restart the service similarly.
> 
> Then http://localhost:55672/cli/ should find it.
> 
> Hopefully it is just that.
> 
> Ann
> 
> ----- Original Message -----
> From: "albert_newton" <myname.whatis at gmail.com>
> To: rabbitmq-discuss at lists.rabbitmq.com
> Sent: Wednesday, 20 July, 2011 8:23:43 PM
> Subject: [rabbitmq-discuss] What is the server-name to get the
> rabbitmqadmin
> 
> 
> I am trying to install the rabbitmqadmin so that I can get the UI and the
> command line tool. I already followed the steps mentioned here to get the
> management plugin installed:
> http://www.rabbitmq.com/plugins.html#rabbitmq-management
> 
> However when I try to hit this url: http://server-name:55672/cli/
> 
> 
> I am not getting anything. I am not sure what the server-name is supposed
> to
> be in the url above. I tried different values for it like:
> rabbit at myhostname, rabbitmq-server, etc, but those did not work. 
> 
> Anyone have any idea about this?
> -- 
> View this message in context:
> http://old.nabble.com/What-is-the-server-name-to-get-the-rabbitmqadmin-tp32102103p32102103.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://old.nabble.com/What-is-the-server-name-to-get-the-rabbitmqadmin-tp32102103p32132293.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From james.r.carr at gmail.com  Mon Jul 25 16:14:42 2011
From: james.r.carr at gmail.com (James Carr)
Date: Mon, 25 Jul 2011 10:14:42 -0500
Subject: [rabbitmq-discuss] Monitoring
Message-ID: <CAJreXKC01sBBfWzh4S72d=fGvSiMyy+NP8-caJGgfGAK+L0jqQ@mail.gmail.com>

Hi All,

Is there any existing tools available to monitor things like an
excessive number of connections or a queue getting backed up to a
certain amount? All I can think of for now is using the management
plugin's JSON API to roll my own but I'd like to know if there is
anything existing so I can save myself some time.

Surely this isn't a unique requirement and somone has some monitoring
like this in place, right? :)

Thanks,
James

From simon at rabbitmq.com  Mon Jul 25 16:31:31 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 25 Jul 2011 16:31:31 +0100
Subject: [rabbitmq-discuss] Shovel with exchange-exchange bindings
In-Reply-To: <88E590DC4586974D825FC82AE798294E52020A4C@GSVCLU03.ges.ferlan.it>
References: <88E590DC4586974D825FC82AE798294E520208AA@GSVCLU03.ges.ferlan.it><20110725105659.GB398@rabbitmq.com><88E590DC4586974D825FC82AE798294E52020989@GSVCLU03.ges.ferlan.it>	<20110725111052.GC398@rabbitmq.com>
	<88E590DC4586974D825FC82AE798294E52020A4C@GSVCLU03.ges.ferlan.it>
Message-ID: <4E2D8C53.3080100@rabbitmq.com>

On 25/07/11 13:28, Busoli, Simone wrote:
> By the way,  what is the current status of the federation addin?

It's seeing some development. It'll be part of the next release. Was 
that what you were asking?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From joseph.a.marlin at gmail.com  Mon Jul 25 16:34:09 2011
From: joseph.a.marlin at gmail.com (Joseph Marlin)
Date: Mon, 25 Jul 2011 08:34:09 -0700 (PDT)
Subject: [rabbitmq-discuss] Monitoring
In-Reply-To: <CAJreXKC01sBBfWzh4S72d=fGvSiMyy+NP8-caJGgfGAK+L0jqQ@mail.gmail.com>
Message-ID: <24719863.594.1311608049570.JavaMail.geo-discussion-forums@vbli26>

I'd be interested in this too. Has anyone gotten Rabbit to talk to Cacti for 
graphs or Nagios?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110725/3ab9e13d/attachment.htm>

From simone.busoli at gmail.com  Mon Jul 25 18:21:42 2011
From: simone.busoli at gmail.com (Simone Busoli)
Date: Mon, 25 Jul 2011 19:21:42 +0200
Subject: [rabbitmq-discuss] Shovel with exchange-exchange bindings
In-Reply-To: <4E2D8C53.3080100@rabbitmq.com>
References: <88E590DC4586974D825FC82AE798294E520208AA@GSVCLU03.ges.ferlan.it>
	<20110725105659.GB398@rabbitmq.com>
	<88E590DC4586974D825FC82AE798294E52020989@GSVCLU03.ges.ferlan.it>
	<20110725111052.GC398@rabbitmq.com>
	<88E590DC4586974D825FC82AE798294E52020A4C@GSVCLU03.ges.ferlan.it>
	<4E2D8C53.3080100@rabbitmq.com>
Message-ID: <CAOn7oW8trc=1t1t5KfmR_Ech96Fexp8PUCtNps1t6B9MtUWC_Q@mail.gmail.com>

If there are any estimates about when the next release is going to be out
that would be interesting too.
On Jul 25, 2011 5:32 PM, "Simon MacMullen" <simon at rabbitmq.com> wrote:
> On 25/07/11 13:28, Busoli, Simone wrote:
>> By the way, what is the current status of the federation addin?
>
> It's seeing some development. It'll be part of the next release. Was
> that what you were asking?
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110725/16df7293/attachment.htm>

From matthew at rabbitmq.com  Mon Jul 25 19:21:52 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 25 Jul 2011 19:21:52 +0100
Subject: [rabbitmq-discuss] Shovel with exchange-exchange bindings
In-Reply-To: <CAOn7oW8trc=1t1t5KfmR_Ech96Fexp8PUCtNps1t6B9MtUWC_Q@mail.gmail.com>
References: <88E590DC4586974D825FC82AE798294E520208AA@GSVCLU03.ges.ferlan.it>
	<20110725105659.GB398@rabbitmq.com>
	<88E590DC4586974D825FC82AE798294E52020989@GSVCLU03.ges.ferlan.it>
	<20110725111052.GC398@rabbitmq.com>
	<88E590DC4586974D825FC82AE798294E52020A4C@GSVCLU03.ges.ferlan.it>
	<4E2D8C53.3080100@rabbitmq.com>
	<CAOn7oW8trc=1t1t5KfmR_Ech96Fexp8PUCtNps1t6B9MtUWC_Q@mail.gmail.com>
Message-ID: <20110725182152.GA16814@rabbitmq.com>

On Mon, Jul 25, 2011 at 07:21:42PM +0200, Simone Busoli wrote:
> If there are any estimates about when the next release is going to be out
> that would be interesting too.

Ahh well it should have been on 12th July. A while ago, several of us
thought we had a meeting in which we'd agreed to switch to a monthly
release cycle, and indeed for a while we did monthly releases. However,
for unclear reasons this no longer seems to be the case.

So your guess is as good as mine.

Matthew

From msteele at beringmedia.com  Mon Jul 25 19:34:37 2011
From: msteele at beringmedia.com (Mark Steele)
Date: Mon, 25 Jul 2011 14:34:37 -0400
Subject: [rabbitmq-discuss] Monitoring
In-Reply-To: <24719863.594.1311608049570.JavaMail.geo-discussion-forums@vbli26>
References: <CAJreXKC01sBBfWzh4S72d=fGvSiMyy+NP8-caJGgfGAK+L0jqQ@mail.gmail.com>
	<24719863.594.1311608049570.JavaMail.geo-discussion-forums@vbli26>
Message-ID: <CAH24rBMinpiSp3OERjyT9UFq_NMrSmRFmAR6VckQNv_EY0dCyQ@mail.gmail.com>

It's trivial to get rabbit graphs in zabbix.

Here's what I use (zabbix agent configuration file):

UserParameter=rabbitmq.local.queues.count[*],sudo rabbitmqctl -q list_queues
-p $1 | wc -l
UserParameter=rabbitmq.local.messages_ready.count[*],sudo rabbitmqctl -q
list_queues -p $1 messages_ready | awk '{S = S + $ 0}END{print S}'

Just need to make sure your zabbix user has sudo permissions or running
rabbitmqctl, then add a few items/graphs in the zabbix dashboard for the
vhosts you want to watch.

A similar approach could probably be used with cacti.

Cheers,

Mark Steele
Bering Media Inc.

On Mon, Jul 25, 2011 at 11:34 AM, Joseph Marlin
<joseph.a.marlin at gmail.com>wrote:

> I'd be interested in this too. Has anyone gotten Rabbit to talk to Cacti
> for graphs or Nagios?
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110725/1ab8dcc9/attachment.htm>

From jasonjwwilliams at gmail.com  Mon Jul 25 19:56:01 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Mon, 25 Jul 2011 12:56:01 -0600
Subject: [rabbitmq-discuss] Monitoring
In-Reply-To: <24719863.594.1311608049570.JavaMail.geo-discussion-forums@vbli26>
References: <CAJreXKC01sBBfWzh4S72d=fGvSiMyy+NP8-caJGgfGAK+L0jqQ@mail.gmail.com>
	<24719863.594.1311608049570.JavaMail.geo-discussion-forums@vbli26>
Message-ID: <CAHZAEpcD8huZ+PT0mhUr+WNBiZmaCa-AtY1=RJGkmsFLFZ=4Lg@mail.gmail.com>

This Nagios check will monitor queue depth:

https://github.com/williamsjj/platar/blob/master/nagios/amqp_queue_check.py

-J

On Mon, Jul 25, 2011 at 9:34 AM, Joseph Marlin
<joseph.a.marlin at gmail.com> wrote:
> I'd be interested in this too. Has anyone gotten Rabbit to talk to Cacti for
> graphs or Nagios?
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From jasonjwwilliams at gmail.com  Mon Jul 25 19:57:24 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Mon, 25 Jul 2011 12:57:24 -0600
Subject: [rabbitmq-discuss] Monitoring
In-Reply-To: <24719863.594.1311608049570.JavaMail.geo-discussion-forums@vbli26>
References: <CAJreXKC01sBBfWzh4S72d=fGvSiMyy+NP8-caJGgfGAK+L0jqQ@mail.gmail.com>
	<24719863.594.1311608049570.JavaMail.geo-discussion-forums@vbli26>
Message-ID: <CAHZAEpe=Z7u_7AcedseL4iDqFC8xkVY8PkQdDM4u6e1qeJUnBQ@mail.gmail.com>

I wrote a Nagios check that will monitor queue depths:
https://github.com/williamsjj/platar/blob/master/nagios/amqp_queue_check.py

-J

On Mon, Jul 25, 2011 at 9:34 AM, Joseph Marlin
<joseph.a.marlin at gmail.com> wrote:
> I'd be interested in this too. Has anyone gotten Rabbit to talk to Cacti for
> graphs or Nagios?
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From habtdemis at gmail.com  Mon Jul 25 22:49:56 2011
From: habtdemis at gmail.com (Demi Zike)
Date: Mon, 25 Jul 2011 16:49:56 -0500
Subject: [rabbitmq-discuss] Read messages non-blocking in RabbitMQ
Message-ID: <CAJE2eFH8TGmraSCgpuWYMM46gcuJdt2vojYO5MJ2_V4Akcd+YA@mail.gmail.com>

Hello,

We can read messages fine. But due to the large volume of messages our
system is expected to transport and process, we want to avoid blocking while
reading messages from a list of queues our direct exchange is bound to. How
can we achieve that in RabbitMQ?

Regards,
Demiss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110725/ba471f23/attachment.htm>

From simone.busoli at gmail.com  Tue Jul 26 02:29:06 2011
From: simone.busoli at gmail.com (Simone Busoli)
Date: Tue, 26 Jul 2011 03:29:06 +0200
Subject: [rabbitmq-discuss] Shovel with exchange-exchange bindings
In-Reply-To: <20110725182152.GA16814@rabbitmq.com>
References: <88E590DC4586974D825FC82AE798294E520208AA@GSVCLU03.ges.ferlan.it>
	<20110725105659.GB398@rabbitmq.com>
	<88E590DC4586974D825FC82AE798294E52020989@GSVCLU03.ges.ferlan.it>
	<20110725111052.GC398@rabbitmq.com>
	<88E590DC4586974D825FC82AE798294E52020A4C@GSVCLU03.ges.ferlan.it>
	<4E2D8C53.3080100@rabbitmq.com>
	<CAOn7oW8trc=1t1t5KfmR_Ech96Fexp8PUCtNps1t6B9MtUWC_Q@mail.gmail.com>
	<20110725182152.GA16814@rabbitmq.com>
Message-ID: <CAOn7oW8b+CM=PC+QZGP4f5E=Tb6NSG8eTEfWkBETwbe62yHZDw@mail.gmail.com>

No worries, by the next release I'll have sharpened my erlang skills I hope
;-)
On Jul 25, 2011 8:22 PM, "Matthew Sackman" <matthew at rabbitmq.com> wrote:
> On Mon, Jul 25, 2011 at 07:21:42PM +0200, Simone Busoli wrote:
>> If there are any estimates about when the next release is going to be out
>> that would be interesting too.
>
> Ahh well it should have been on 12th July. A while ago, several of us
> thought we had a meeting in which we'd agreed to switch to a monthly
> release cycle, and indeed for a while we did monthly releases. However,
> for unclear reasons this no longer seems to be the case.
>
> So your guess is as good as mine.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110726/dc5bd786/attachment.htm>

From arno.puschmann at acodeas.de  Tue Jul 26 08:27:13 2011
From: arno.puschmann at acodeas.de (Arno Puschmann)
Date: Tue, 26 Jul 2011 09:27:13 +0200
Subject: [rabbitmq-discuss] RabbitMQ and Spring
Message-ID: <27D6B27DB616654BBEF4DDB8B31EAF916B590E9526@vs-msx01.IT-NG.local>

Hi,

I'm trying to use RabbitMQ in a Spring Application. I have installed RabbitMQ Server 2.5.1 and using Spring 3.0.5.

I have the following Bean-Configuration

<bean id="rabbitConnFactory" class="org.springframework.amqp.rabbit.connection.SingleConnectionFactory">
	<property name="host" value="localhost" />
	<property name="username" value="guest" />
	<property name="password" value="guest" />
	<property name="virtualHost" value="/" />
	<property name="port" value="5672" />
</bean>

<bean id="admin" class="org.springframework.amqp.rabbit.core.RabbitAdmin">
	<constructor-arg ref="rabbitConnFactory" />
</bean>

<bean id="template" class="org.springframework.amqp.rabbit.core.RabbitTemplate">
 	<property name="connectionFactory" ref="rabbitConnFactory" />
	<property name="routingKey" value="test.queue"/>
	<property name="queue" value="junitqueue"/>
	<property name="messageConverter" ref="messageConverter" />
</bean>

<bean id="messageListener" class="de.ami.ws.Queue.Receiver" />


Finally I want to access to my RabbitMQ-Server. So I Autowired my Properties and call

template.convertAndSend(object);

but after this there is no message on the queue and the no exception is thrown.


Trying the same with this Code then it works.

			Connection connection = rabbitConnFactory.createConnection();
			Channel channel = connection.createChannel(true);
			channel.exchangeDeclare(EXCHANGE_NAME, "direct", true);
			channel.queueDeclare(QUEUE_NAME, true, false, false, null);
			channel.queueBind(QUEUE_NAME, EXCHANGE_NAME, ROUTING_KEY);

			ByteArrayOutputStream baos = new ByteArrayOutputStream();
			ObjectOutputStream oos;
			oos = new ObjectOutputStream(baos);
			oos.writeObject(object);
			oos.close();
			byte[] ByteMessage = baos.toByteArray();

			channel.basicPublish(EXCHANGE_NAME, ROUTING_KEY, null, ByteMessage);
			channel.close();
			connection.close();

But this is not a solution for a Spring Application.

By the way i get a Exception if I try to use the Spring-AMQP-Cient-Version 2.5.1 im my pom.xml.

java.lang.IllegalAccessError: tried to access method com.rabbitmq.client.impl.AMQBasicProperties.<init>()V from class org.springframework.amqp.rabbit.support.RabbitUtils
	at org.springframework.amqp.rabbit.support.RabbitUtils.extractBasicProperties(RabbitUtils.java:195)
	at org.springframework.amqp.rabbit.core.RabbitTemplate.doSend(RabbitTemplate.java:332)
	at org.springframework.amqp.rabbit.core.RabbitTemplate.access$000(RabbitTemplate.java:51)
	at org.springframework.amqp.rabbit.core.RabbitTemplate$1.doInRabbit(RabbitTemplate.java:141)
	at org.springframework.amqp.rabbit.core.RabbitTemplate.execute(RabbitTemplate.java:297)
	at org.springframework.amqp.rabbit.core.RabbitTemplate.send(RabbitTemplate.java:139)
	at org.springframework.amqp.rabbit.core.RabbitTemplate.convertAndSend(RabbitTemplate.java:156)
	at org.springframework.amqp.rabbit.core.RabbitTemplate.convertAndSend(RabbitTemplate.java:148)

Have anybody some Experience or a solution?

Thanks.

Arno Puschmann

From lionel.cons at cern.ch  Tue Jul 26 09:19:59 2011
From: lionel.cons at cern.ch (Lionel Cons)
Date: Tue, 26 Jul 2011 10:19:59 +0200
Subject: [rabbitmq-discuss] STOMP plugin and virtual hosts
In-Reply-To: <4E2CC29F.1070107@strategicdata.com.au> (Toby Corkindale's
	message of "Mon, 25 Jul 2011 11:10:55 +1000")
References: <4E25547B.3080606@strategicdata.com.au>
	<4E255FFB.5090703@rabbitmq.com>
	<4E263379.4010808@strategicdata.com.au>
	<4E263CB5.6010702@strategicdata.com.au>
	<4E26AA61.5030705@rabbitmq.com>
	<4E2CC29F.1070107@strategicdata.com.au>
Message-ID: <vfqy5zlv4gg.fsf@mail.cern.ch>

I'm not fluent in Erlang but it seems that there is a bug in the STOMP
plugin code dealing with heart-beats. The code contains:

  ensure_heartbeats(...) -> ...
    catch rabbit_net:send(Sock, <<0>>)

The STOMP 1.1 spec states that newlines (not nulls) can be used for
heart-beats. Shouldn't it be <<10>> instead of <<0>>?

Cheers,

Lionel Cons

From majek04 at gmail.com  Tue Jul 26 09:48:43 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Tue, 26 Jul 2011 09:48:43 +0100
Subject: [rabbitmq-discuss] Read messages non-blocking in RabbitMQ
In-Reply-To: <CAJE2eFH8TGmraSCgpuWYMM46gcuJdt2vojYO5MJ2_V4Akcd+YA@mail.gmail.com>
References: <CAJE2eFH8TGmraSCgpuWYMM46gcuJdt2vojYO5MJ2_V4Akcd+YA@mail.gmail.com>
Message-ID: <CABzX+qz5u8B_p=TFsJW-A-0xcfpkG0BjCdfbNSZGyn9FR=vwCA@mail.gmail.com>

On Mon, Jul 25, 2011 at 22:49, Demi Zike <habtdemis at gmail.com> wrote:
> We can read messages fine. But due to the large volume of messages our
> system is expected to transport and process, we want to avoid blocking while
> reading messages from a list of queues our direct exchange is bound to. How
> can we achieve that in RabbitMQ?

The normal method to asynchronously receive messages  is to use
'basic_consume' command. The blocking method is 'basic_get'.

What exactly is your question?

Cheers,
  Marek

From simon at rabbitmq.com  Tue Jul 26 10:25:56 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 26 Jul 2011 10:25:56 +0100
Subject: [rabbitmq-discuss] Change port in Management Plugin
In-Reply-To: <CAJ2-VrnjGcpAwqPQxsLcGbWTdZZpeBSg3Z4dUod32nVgEvh7=w@mail.gmail.com>
References: <CAJ2-VrnjGcpAwqPQxsLcGbWTdZZpeBSg3Z4dUod32nVgEvh7=w@mail.gmail.com>
Message-ID: <4E2E8824.5080403@rabbitmq.com>

Forgot to send this to the list the first time...

On 20/07/11 15:22, mysurf mail wrote:
> 1. Can someone assist me in changing the default port in the management
> plugin.
> I have read the docs but couldnt figure it out.
> I understand I need to put in my %APPDATA%\Rabbitmq folder a
> rabbitmq.config file.
> But what should I put in it to change the management 55672 port.

The config has changed, so if you're following the instructions on the 
website with 2.3.1 it won't work. You should be able to use a complete 
file like:

[{rabbit_mochiweb, [{port, 12345}]}].

if memory serves (note that the dot on the end is part of the config).

> 2. After putting the 2.3.1 management plugin in my 2.3.1 rabbit folder
> I get those warnings upon restart :

Yeah, those are harmless. Again, they have been fixed in later versions.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From matthias at rabbitmq.com  Tue Jul 26 10:29:22 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 26 Jul 2011 10:29:22 +0100
Subject: [rabbitmq-discuss] Connection Pooling Options to solve FD
 Consumption on RabbitMQ.
In-Reply-To: <CAGTBvKtiVMo+P6o6DuchUmf+=fXYdFTc=cd5EDVJyXqGLVPUDQ@mail.gmail.com>
References: <CAGTBvKtVZo6X6A2P33fC9SpiimhBUCOS+dJNn_ihhB1XBRMfdQ@mail.gmail.com>	<CAE3HoVTGCheLtjLC_kB-5QoJAKVON0BOig1RbNeYPWGq0M-YNA@mail.gmail.com>
	<CAGTBvKtiVMo+P6o6DuchUmf+=fXYdFTc=cd5EDVJyXqGLVPUDQ@mail.gmail.com>
Message-ID: <4E2E88F2.7030403@rabbitmq.com>

On 21/07/11 06:14, Abhishek K wrote:
> I am assuming each channel is opening a TCP connection - Is it correct ?

No. Each, connection corresponds to a TCP connections. The clue is in 
the name ;) Channels are multiplexed on a connection.

> Also should I create a channel from a globale connections instead of
> creating connection each time?

Yes.

Matthias.

From simon at rabbitmq.com  Tue Jul 26 10:36:27 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 26 Jul 2011 10:36:27 +0100
Subject: [rabbitmq-discuss] Debian Squeeze init script
In-Reply-To: <B28A4906-5A84-4AC6-9FB2-01C1CDE8EA51@dreamhost.com>
References: <B28A4906-5A84-4AC6-9FB2-01C1CDE8EA51@dreamhost.com>
Message-ID: <4E2E8A9B.8020501@rabbitmq.com>

Hi Kyle.

On 19/07/11 18:14, Kyle Bader wrote:
> The init script for the rabbitmq-server package provided by Debian
> Squeeze does not contain default-start/stop runlevel information as
> described in this bug from 2009:
>
> http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=552434
>
> I'm in a situation where I have another service that depends on
> rabbitmq-server (chef-server components).  I've installed the
> rabbitmq-server package using both the RabbitMQ and Debian
> repositories and both suffer from this problem.  The only
> rabbitmq-server package that appear to have it fixed are the most
> recent ones available for direct download here:
>
> http://www.rabbitmq.com/server.html
>
> Is there something impeding this being fixed Debian Squeeze proper
> that I can help with?

We don't backport any fixes to older versions of RabbitMQ ourselves 
(haven't really got the resources to do something so distro-specific), 
and I'm not sure anybody from the Debian side does that either, so I 
suspect that's why nothing's changed.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From matthias at rabbitmq.com  Tue Jul 26 10:59:35 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 26 Jul 2011 10:59:35 +0100
Subject: [rabbitmq-discuss] SSL errors
In-Reply-To: <CAH24rBNeASyTJZLeYF4gqjBAW4iJkYmaCQKZfWtxT8sFJ1F1VQ@mail.gmail.com>
References: <CAH24rBNVqqfa4zWA_3+E3c94o+aOUObKOvSS6jp34ni92=H0DA@mail.gmail.com>
	<4E2729C8.50208@rabbitmq.com>
	<CAH24rBNeASyTJZLeYF4gqjBAW4iJkYmaCQKZfWtxT8sFJ1F1VQ@mail.gmail.com>
Message-ID: <4E2E9007.4010208@rabbitmq.com>

Mark,

On 21/07/11 14:15, Mark Steele wrote:
> Does this interfere with the client/server communication?

I don't think so, which is why I said it's "pretty harmless". AFAIK the 
error is only triggered during connection termination. I could be wrong 
though.

Matthias.

From steve at rabbitmq.com  Tue Jul 26 11:21:17 2011
From: steve at rabbitmq.com (Steve Powell)
Date: Tue, 26 Jul 2011 11:21:17 +0100
Subject: [rabbitmq-discuss] Consumer Callback
In-Reply-To: <32103305.post@talk.nabble.com>
References: <32103305.post@talk.nabble.com>
Message-ID: <9E349AF4-25D2-4871-8E6E-ECF2528A25A9@rabbitmq.com>

Dear fangbot,
You do not say whether you are using Python or Java (the two languages shown on the tutorials pages) but I will assume it is Java.

> is there a way to create an event
> such that when a queue gets pushed a message, it automatically calls
> consumer.nextDelivery somehow


The simple answer is 'yes', approximately.  There is a push interface (defined by the Consumer interface) which is driven whenever a message is delivered.

The tutorials use QueueingConsumer, which is a way to isolate the clients engine (the channel thread) from the user's thread.  As you observe, this is a pull interface. QueueingConsumer.nextDelivery() will block until there is a message to return.

If you want to use a push interface (which is what QueueingConsumer uses under the covers) then you are free to create your own Consumer (implementation of the Consumer interface) class, and the handleDelivery() method therein will be driven when a message arrives.  The drawback is that this 'callback' is driven on a RabbitMQ client thread, and (at the moment) you are not permitted to do long-running things on this thread or make channel calls, or block, as this will often result in deadlocks. However, if you can limit what this does, you are free to communicate with another thread of yours, for example to put it on a BlockingQueue (like QueueingConsumer does), or to otherwise trigger another thread to do something.

The easiest (and recommended) way to code your own Consumer is to subclass DefaultConsumer, and override the methods you want to change (in your case handleDelivery()). Take a look at the DefaultConsumer class to see what it does.

Other methods on the Consumer interface are driven if other events occur, like channel close, for example.  Your class can then do the right thing.

This area is currently being reworked -- not to change the interface (much!) but to lift some of the restrictions on the things a callback method can do without causing deadlocks -- which will also see better control of the system resources used by the consumer callbacks.

I hope this helps -- please come back here if you have any more questions; or even if you don't -- we'd like to know how you get on.

Steve Powell  (a happy bunny)
----------some definitions from the SPD----------
Rigatoni n. A prime-ministerial grin.
Nigella n. The next bottle-size up from a Nebuchadnezzar.
Homily adv. Rather like a frenchman.

On 20 Jul 2011, at 23:26, fangbot wrote:

> 
> I'm looking to create multiple publishers/subscribers from the main thread
> that my program is run (i.e. the thread where I have declared my channel).
> It seems that in the tutorials, the only way for consumers to get a message
> from the queue its connected to is to explicitly call
> consumer.nextDelivery(). However, as far as my understanding, in order to
> constantly check for new publications, this call must reside within a
> while(true) loop. 
> 
> Say I wanted to create a consumer with an anonymous queue and attach it to
> an exchange. Then, I want to make a publication to that exchange. When that
> publication is made, the consumer will print something to the console using
> an overridden nextDelivery(). In order to do this, do I have to basically
> 
> 1. Create the consumer/queue and attach it with a routingId to the exchange
> 2. Publish a method with that routingId to the exchange
> 3. Invoke the while loop to constantly check for messages
> 
> in that order?
> 
> If so, then is there a way to support two (or more) consumers to
> automatically get nextDelivery? It seems that the only way is to write a
> while loop that goes through every consumer, and calls nextDelivery on that
> consumer, in an infinite loop. Instead, is there a way to create an event
> such that when a queue gets pushed a message, it automatically calls
> consumer.nextDelivery somehow?
> 
> Thanks in advance for the reply. I'm fairly new to RabbitMQ, so please
> forgive me if the question is somewhat basic/has already been answered
> elsewhere :-D.
> -- 
> View this message in context: http://old.nabble.com/Consumer-Callback-tp32103305p32103305.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110726/fccedb35/attachment.htm>

From matthias at rabbitmq.com  Tue Jul 26 11:43:48 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 26 Jul 2011 11:43:48 +0100
Subject: [rabbitmq-discuss] Reading messages without acking them
In-Reply-To: <8A1A883E3F171B42A81817DEC138352C1DB52BA3DD@MX06A.corp.emc.com>
References: <8A1A883E3F171B42A81817DEC138352C1DB52BA3DD@MX06A.corp.emc.com>
Message-ID: <4E2E9A64.1020306@rabbitmq.com>

Lowell,

On 22/07/11 22:34, Lowell.Boggs at emc.com wrote:
> To extend my previous question, if I set the prefetch count to 10 but
> there is only 1 message in the buffer, and if I read the message but do
> not ack it, will I be able to read up to 9 messages later when they show
> up?

When you say 'buffer' do you mean 'queue'? If so, yes.

On a related note, the prefetch count is associated with the channel, so 
it can be 'shared' when consuming from multiple queues on the channel.

Regards,

Matthias.

From matthias at rabbitmq.com  Tue Jul 26 11:56:26 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 26 Jul 2011 11:56:26 +0100
Subject: [rabbitmq-discuss] Server crash, won't start up
In-Reply-To: <CAJreXKBNOcEGuzZ49iKMF74uVwecPmg9Q3DJqsg6Xtzj7vJiAA@mail.gmail.com>
References: <CAJreXKACDmUrBo2FB0=gG_Srw4OFoPd2rX9sKvUwzggrKAXkvA@mail.gmail.com>	<20110724185833.GA1414@rabbitmq.com>
	<CAJreXKBNOcEGuzZ49iKMF74uVwecPmg9Q3DJqsg6Xtzj7vJiAA@mail.gmail.com>
Message-ID: <4E2E9D5A.5050206@rabbitmq.com>

James,

On 24/07/11 20:28, James Carr wrote:
> I'm still sleuthing around to figure out the crash. The box had been
> restarted due to connection issues and hangs in that stage during
> startup.

As Matthew asked, what makes you think it *hangs* rather than just 
taking a long time?

> for now I deleted the data files under
> /var/lib/rabbitmq/mnesia/rabbit at brokerm01 and it starts up fine
> (albiet with any unprocessed messages dropped).

Argh, if it *really* hangs that would have been the data we need to 
reproduce the problem :(

> Still looking through the logs to see what happened... is there any
> place that records memory high watermark bypasses?

Yes, that's in the logs. Look for entries involving 
'vm_memory_high_watermark'.


Matthias.

From steve at rabbitmq.com  Tue Jul 26 12:52:22 2011
From: steve at rabbitmq.com (Steve Powell)
Date: Tue, 26 Jul 2011 12:52:22 +0100
Subject: [rabbitmq-discuss] STOMP plugin and virtual hosts
In-Reply-To: <vfqy5zlv4gg.fsf@mail.cern.ch>
References: <4E25547B.3080606@strategicdata.com.au>
	<4E255FFB.5090703@rabbitmq.com>
	<4E263379.4010808@strategicdata.com.au>
	<4E263CB5.6010702@strategicdata.com.au>
	<4E26AA61.5030705@rabbitmq.com>
	<4E2CC29F.1070107@strategicdata.com.au>
	<vfqy5zlv4gg.fsf@mail.cern.ch>
Message-ID: <AD933193-AC53-411E-A4B8-B38DD1BE1102@rabbitmq.com>

Lionel,
Thanks for raising this -- I agree it does look like a bug -- I've raised bugzilla 24304 to cover this.

Steve Powell  (a happy bunny)
----------some definitions from the SPD----------
Rigatoni n. A prime-ministerial grin.
Nigella n. The next bottle-size up from a Nebuchadnezzar.
Homily adv. Rather like a frenchman.

On 26 Jul 2011, at 09:19, Lionel Cons wrote:

> I'm not fluent in Erlang but it seems that there is a bug in the STOMP
> plugin code dealing with heart-beats. The code contains:
> 
>  ensure_heartbeats(...) -> ...
>    catch rabbit_net:send(Sock, <<0>>)
> 
> The STOMP 1.1 spec states that newlines (not nulls) can be used for
> heart-beats. Shouldn't it be <<10>> instead of <<0>>?
> 
> Cheers,
> 
> Lionel Cons
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110726/c7eccbb9/attachment.htm>

From majek04 at gmail.com  Tue Jul 26 14:45:26 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Tue, 26 Jul 2011 14:45:26 +0100
Subject: [rabbitmq-discuss] Reconnection strategies in Pika
In-Reply-To: <4E293B45.2030602@nextday.fi>
References: <4E293B45.2030602@nextday.fi>
Message-ID: <CABzX+qwgzSAghV66nFODJc-EpiocQdfc+H2MMzDXh2CxUUOjjw@mail.gmail.com>

2011/7/22 Alex Gr?nholm <alex.gronholm at nextday.fi>:
> I never quite grasped what these are for. Their use is not documented, and
> they seem to have no effect on connections. When a connection dies, pika
> dies too regardless of whether I have a connection strategy in place or not.
> Could someone clarify this?

I suspect, the idea was to support automatic reconnections. But this
is quite hard in AMQP world (that's a polite way of saying "impossible").

I wouldn't be surprised to hear that that feature was never finished.

That's my guess, I haven't looked at the code.

Cheers,
  Marek

From Lowell.Boggs at emc.com  Tue Jul 26 14:58:28 2011
From: Lowell.Boggs at emc.com (Lowell.Boggs at emc.com)
Date: Tue, 26 Jul 2011 09:58:28 -0400
Subject: [rabbitmq-discuss] Reading messages without acking them
In-Reply-To: <4E2E9A64.1020306@rabbitmq.com>
References: <8A1A883E3F171B42A81817DEC138352C1DB52BA3DD@MX06A.corp.emc.com>
	<4E2E9A64.1020306@rabbitmq.com>
Message-ID: <8A1A883E3F171B42A81817DEC138352C1DB52BA702@MX06A.corp.emc.com>

Thanks Matthias -- especially for that tidbit about sharing the prefetch across the whole channel!

Lowell 

-----Original Message-----
From: Matthias Radestock [mailto:matthias at rabbitmq.com] 
Sent: Tuesday, July 26, 2011 5:44 AM
To: Boggs Jr., Lowell
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Reading messages without acking them

Lowell,

On 22/07/11 22:34, Lowell.Boggs at emc.com wrote:
> To extend my previous question, if I set the prefetch count to 10 but
> there is only 1 message in the buffer, and if I read the message but do
> not ack it, will I be able to read up to 9 messages later when they show
> up?

When you say 'buffer' do you mean 'queue'? If so, yes.

On a related note, the prefetch count is associated with the channel, so 
it can be 'shared' when consuming from multiple queues on the channel.

Regards,

Matthias.


From habtdemis at gmail.com  Tue Jul 26 15:54:58 2011
From: habtdemis at gmail.com (Demi Zike)
Date: Tue, 26 Jul 2011 09:54:58 -0500
Subject: [rabbitmq-discuss] Read messages non-blocking in RabbitMQ
In-Reply-To: <CABzX+qz5u8B_p=TFsJW-A-0xcfpkG0BjCdfbNSZGyn9FR=vwCA@mail.gmail.com>
References: <CAJE2eFH8TGmraSCgpuWYMM46gcuJdt2vojYO5MJ2_V4Akcd+YA@mail.gmail.com>
	<CABzX+qz5u8B_p=TFsJW-A-0xcfpkG0BjCdfbNSZGyn9FR=vwCA@mail.gmail.com>
Message-ID: <CAJE2eFGDPMXfNUSgYfg62Pk3ou_=Bhhf2Dd31hTcm3bp8y2irw@mail.gmail.com>

We actually was looking to read messages without actively waiting for a
message to arrive if the queue is empty at that point for example. The
basic_get method did the trick. Thanks though!

Regards,
Demiss

On Tue, Jul 26, 2011 at 3:48 AM, Marek Majkowski <majek04 at gmail.com> wrote:

> On Mon, Jul 25, 2011 at 22:49, Demi Zike <habtdemis at gmail.com> wrote:
> > We can read messages fine. But due to the large volume of messages our
> > system is expected to transport and process, we want to avoid blocking
> while
> > reading messages from a list of queues our direct exchange is bound to.
> How
> > can we achieve that in RabbitMQ?
>
> The normal method to asynchronously receive messages  is to use
> 'basic_consume' command. The blocking method is 'basic_get'.
>
> What exactly is your question?
>
> Cheers,
>   Marek
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110726/02f6f4f1/attachment.htm>

From gmr at myyearbook.com  Tue Jul 26 16:08:13 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Tue, 26 Jul 2011 11:08:13 -0400
Subject: [rabbitmq-discuss] Reconnection strategies in Pika
In-Reply-To: <CABzX+qwgzSAghV66nFODJc-EpiocQdfc+H2MMzDXh2CxUUOjjw@mail.gmail.com>
References: <4E293B45.2030602@nextday.fi>
	<CABzX+qwgzSAghV66nFODJc-EpiocQdfc+H2MMzDXh2CxUUOjjw@mail.gmail.com>
Message-ID: <7774581B999A4D6AA21FFC35E24FACD3@myyearbook.com>

 The SimpleReconnectionStrategy implementation was to on disconnect, have a incrementally delayed attempt to reconnect to the broker. I believe there's a ticket with this being broken in 0.9.5, I need to confirm that's the case.  

Gavin  


On Tuesday, July 26, 2011 at 9:45 AM, Marek Majkowski wrote:

> 2011/7/22 Alex Gr?nholm <alex.gronholm at nextday.fi (mailto:alex.gronholm at nextday.fi)>:
> > I never quite grasped what these are for. Their use is not documented, and
> > they seem to have no effect on connections. When a connection dies, pika
> > dies too regardless of whether I have a connection strategy in place or not.
> > Could someone clarify this?
>  
> I suspect, the idea was to support automatic reconnections. But this
> is quite hard in AMQP world (that's a polite way of saying "impossible").
>  
> I wouldn't be surprised to hear that that feature was never finished.
>  
> That's my guess, I haven't looked at the code.
>  
> Cheers,
>  Marek
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110726/b0134606/attachment.htm>

From david at rabbitmq.com  Tue Jul 26 16:13:12 2011
From: david at rabbitmq.com (David Wragg)
Date: Tue, 26 Jul 2011 16:13:12 +0100
Subject: [rabbitmq-discuss] RabbitMQ-C: amqp_simple_rpc blocks waiting
	for frames already received
In-Reply-To: <E30AE0F2-3D9D-4EF3-8E88-4A51ED60899D@rtcreativegroup.com> (Clint
	Miller's message of "Thu, 21 Jul 2011 17:08:40 -0500")
References: <3B42E373-F4A9-48DB-997F-FFB9EEB9901D@rtcreativegroup.com>
	<yrv4cwrfbvrev.fsf@dwragg.eng.vmware.com>
	<85A5068F-EB3B-4841-B453-453D2631D499@rtcreativegroup.com>
	<yrv4clivrvhlc.fsf@dwragg.eng.vmware.com>
	<33F47A2C-3C5C-416F-ADEF-C84106231E5C@rtcreativegroup.com>
	<yrv4chb6fvh91.fsf@dwragg.eng.vmware.com>
	<E30AE0F2-3D9D-4EF3-8E88-4A51ED60899D@rtcreativegroup.com>
Message-ID: <yrv4coc0hrs6v.fsf@dwragg.eng.vmware.com>

Hi Clint,

Clint Miller <clint at rtcreativegroup.com> writes:
> OK, here's the basic example. It shows how the basic.consume method of
> the C++ library is not functioning correctly, but the basic.get works
> correctly.
>
> There's a basic Makefile that will probably require a little tweaking to get it working. It also depends on the 2 following libraries:
>
> - RabbitMQ-C (from the official repository, I built it at rev/changeset ef4df46cc0db)
> - AMQPcpp (from https://github.com/akalend/amqpcpp.git I built it at
> rev/changeset 80b17375f5bed6965acc07477499285b6851c92f)

Thanks, I got it building quite easily.  I'm not sure if I'm able to
reproduce the problem that you described in your original mail, but I
can confirm that it doesn't work for me.

This isn't primarily due to the use of librabbitmq in amqpcpp.  That
looks basically sound (there are some calls to amqp_release_buffers in
AMQPQueue.cpp that should be amqp_maybe_release_buffers, but otherwise I
haven't found anything specifically wrong).

But when I run the program, it aborts.  Running it inside gdb, I get
double free errors reported.  So I ran it under valgrind.  And valgrind
finds many problems in amqpcpp.  (In fairness, it also complains about
some things in librabbitmq, but they are about the use of uninitialized
data, and may be harmless.)

The critical issue is a double free of the message buffer in
AMQPQueue::sendConsumeCommand: At AMQPQueue.cpp#L512, buf is handed to
the AMQPMessage object, and then freed.  But AMQPMessage holds on to
this pointer, and frees it again in its destructor (called via the
message auto_ptr).

valgrind also revealed a lot of cases of amqpcpp trying to use freed
data (e.g. by passing a char* to AMQPQueue::setConsumerTag, you invoke
the implicit conversion to string, and the string data is freed after
the call; but setConsumerTag then uses c_str to get a pointer to the
string data, which is saved in consumer_tag and only used later in
sendConsumeCommand).

I think amqpcpp needs cleaning up with valgrind in order to work
reliably.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
VMware, Inc.

From clint at rtcreativegroup.com  Tue Jul 26 16:17:25 2011
From: clint at rtcreativegroup.com (Clint Miller)
Date: Tue, 26 Jul 2011 10:17:25 -0500
Subject: [rabbitmq-discuss] RabbitMQ-C: amqp_simple_rpc blocks waiting
	for frames already received
In-Reply-To: <yrv4coc0hrs6v.fsf@dwragg.eng.vmware.com>
References: <3B42E373-F4A9-48DB-997F-FFB9EEB9901D@rtcreativegroup.com>
	<yrv4cwrfbvrev.fsf@dwragg.eng.vmware.com>
	<85A5068F-EB3B-4841-B453-453D2631D499@rtcreativegroup.com>
	<yrv4clivrvhlc.fsf@dwragg.eng.vmware.com>
	<33F47A2C-3C5C-416F-ADEF-C84106231E5C@rtcreativegroup.com>
	<yrv4chb6fvh91.fsf@dwragg.eng.vmware.com>
	<E30AE0F2-3D9D-4EF3-8E88-4A51ED60899D@rtcreativegroup.com>
	<yrv4coc0hrs6v.fsf@dwragg.eng.vmware.com>
Message-ID: <B576FDCB-4C7D-43A0-9CCB-F106E789B520@rtcreativegroup.com>

Hmm... I think I follow you. I'm correct thinking that AMQPcpp is maintained by someone not associated with VMWare/RabbitMQ?

Regardless, thanks for your work looking into this issue.

Clint

On Jul 26, 2011, at 10:13 AM, David Wragg wrote:

> Hi Clint,
> 
> Clint Miller <clint at rtcreativegroup.com> writes:
>> OK, here's the basic example. It shows how the basic.consume method of
>> the C++ library is not functioning correctly, but the basic.get works
>> correctly.
>> 
>> There's a basic Makefile that will probably require a little tweaking to get it working. It also depends on the 2 following libraries:
>> 
>> - RabbitMQ-C (from the official repository, I built it at rev/changeset ef4df46cc0db)
>> - AMQPcpp (from https://github.com/akalend/amqpcpp.git I built it at
>> rev/changeset 80b17375f5bed6965acc07477499285b6851c92f)
> 
> Thanks, I got it building quite easily.  I'm not sure if I'm able to
> reproduce the problem that you described in your original mail, but I
> can confirm that it doesn't work for me.
> 
> This isn't primarily due to the use of librabbitmq in amqpcpp.  That
> looks basically sound (there are some calls to amqp_release_buffers in
> AMQPQueue.cpp that should be amqp_maybe_release_buffers, but otherwise I
> haven't found anything specifically wrong).
> 
> But when I run the program, it aborts.  Running it inside gdb, I get
> double free errors reported.  So I ran it under valgrind.  And valgrind
> finds many problems in amqpcpp.  (In fairness, it also complains about
> some things in librabbitmq, but they are about the use of uninitialized
> data, and may be harmless.)
> 
> The critical issue is a double free of the message buffer in
> AMQPQueue::sendConsumeCommand: At AMQPQueue.cpp#L512, buf is handed to
> the AMQPMessage object, and then freed.  But AMQPMessage holds on to
> this pointer, and frees it again in its destructor (called via the
> message auto_ptr).
> 
> valgrind also revealed a lot of cases of amqpcpp trying to use freed
> data (e.g. by passing a char* to AMQPQueue::setConsumerTag, you invoke
> the implicit conversion to string, and the string data is freed after
> the call; but setConsumerTag then uses c_str to get a pointer to the
> string data, which is saved in consumer_tag and only used later in
> sendConsumeCommand).
> 
> I think amqpcpp needs cleaning up with valgrind in order to work
> reliably.
> 
> David
> 
> -- 
> David Wragg
> Staff Engineer, RabbitMQ
> VMware, Inc.
> 


From msteele at beringmedia.com  Tue Jul 26 16:26:22 2011
From: msteele at beringmedia.com (Mark Steele)
Date: Tue, 26 Jul 2011 11:26:22 -0400
Subject: [rabbitmq-discuss] SSL errors
In-Reply-To: <4E2E9007.4010208@rabbitmq.com>
References: <CAH24rBNVqqfa4zWA_3+E3c94o+aOUObKOvSS6jp34ni92=H0DA@mail.gmail.com>
	<4E2729C8.50208@rabbitmq.com>
	<CAH24rBNeASyTJZLeYF4gqjBAW4iJkYmaCQKZfWtxT8sFJ1F1VQ@mail.gmail.com>
	<4E2E9007.4010208@rabbitmq.com>
Message-ID: <CAH24rBMzA+3YDqxb5UB8j3wq_sWf1x=U=0ThH6NCcDHd9uQC8Q@mail.gmail.com>

It certainly is noisy. It generates typically gigabytes worth of log
messages per day in my setup. Any way to mitigate this?


On Tue, Jul 26, 2011 at 5:59 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Mark,
>
> On 21/07/11 14:15, Mark Steele wrote:
>
>> Does this interfere with the client/server communication?
>>
>
> I don't think so, which is why I said it's "pretty harmless". AFAIK the
> error is only triggered during connection termination. I could be wrong
> though.
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110726/7fe5fb80/attachment.htm>

From matthias at rabbitmq.com  Tue Jul 26 16:28:22 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 26 Jul 2011 16:28:22 +0100
Subject: [rabbitmq-discuss] SSL errors
In-Reply-To: <CAH24rBMzA+3YDqxb5UB8j3wq_sWf1x=U=0ThH6NCcDHd9uQC8Q@mail.gmail.com>
References: <CAH24rBNVqqfa4zWA_3+E3c94o+aOUObKOvSS6jp34ni92=H0DA@mail.gmail.com>
	<4E2729C8.50208@rabbitmq.com>
	<CAH24rBNeASyTJZLeYF4gqjBAW4iJkYmaCQKZfWtxT8sFJ1F1VQ@mail.gmail.com>
	<4E2E9007.4010208@rabbitmq.com>
	<CAH24rBMzA+3YDqxb5UB8j3wq_sWf1x=U=0ThH6NCcDHd9uQC8Q@mail.gmail.com>
Message-ID: <4E2EDD16.30505@rabbitmq.com>

Mark,

On 26/07/11 16:26, Mark Steele wrote:
> It certainly is noisy. It generates typically gigabytes worth of log
> messages per day in my setup. Any way to mitigate this?

Perhaps try an older Erlang version. Or ask for advise on erlang-questions.

Matthias.

From david at rabbitmq.com  Tue Jul 26 16:32:16 2011
From: david at rabbitmq.com (David Wragg)
Date: Tue, 26 Jul 2011 16:32:16 +0100
Subject: [rabbitmq-discuss] RabbitMQ-C: amqp_simple_rpc blocks waiting
	for frames already received
In-Reply-To: <B576FDCB-4C7D-43A0-9CCB-F106E789B520@rtcreativegroup.com> (Clint
	Miller's message of "Tue, 26 Jul 2011 10:17:25 -0500")
References: <3B42E373-F4A9-48DB-997F-FFB9EEB9901D@rtcreativegroup.com>
	<yrv4cwrfbvrev.fsf@dwragg.eng.vmware.com>
	<85A5068F-EB3B-4841-B453-453D2631D499@rtcreativegroup.com>
	<yrv4clivrvhlc.fsf@dwragg.eng.vmware.com>
	<33F47A2C-3C5C-416F-ADEF-C84106231E5C@rtcreativegroup.com>
	<yrv4chb6fvh91.fsf@dwragg.eng.vmware.com>
	<E30AE0F2-3D9D-4EF3-8E88-4A51ED60899D@rtcreativegroup.com>
	<yrv4coc0hrs6v.fsf@dwragg.eng.vmware.com>
	<B576FDCB-4C7D-43A0-9CCB-F106E789B520@rtcreativegroup.com>
Message-ID: <yrv4cfwltrrb3.fsf@dwragg.eng.vmware.com>

Clint Miller <clint at rtcreativegroup.com> writes:
> Hmm... I think I follow you. I'm correct thinking that AMQPcpp is
> maintained by someone not associated with VMWare/RabbitMQ?

That's correct.  I have CC'ed Alexandre Kalenderev, who is the author.

-- 
David Wragg
Staff Engineer, RabbitMQ
VMware, Inc.

From david at rabbitmq.com  Tue Jul 26 16:48:38 2011
From: david at rabbitmq.com (David Wragg)
Date: Tue, 26 Jul 2011 16:48:38 +0100
Subject: [rabbitmq-discuss] Are there any unused delivery tag values?
In-Reply-To: <8A1A883E3F171B42A81817DEC138352C1DB52BA33F@MX06A.corp.emc.com>
	(Lowell Boggs's message of "Fri, 22 Jul 2011 12:26:04 -0400")
References: <mailman.1.1311332402.18475.rabbitmq-discuss@lists.rabbitmq.com>
	<8A1A883E3F171B42A81817DEC138352C1DB52BA33F@MX06A.corp.emc.com>
Message-ID: <yrv4cbowhrqjt.fsf@dwragg.eng.vmware.com>

Hi Lowell,

<Lowell.Boggs at emc.com> writes:
> Delivery tags are uint64_t data.
>
> Is zero a valid delivery tag?  Is (uint64_t)(-1)?
>
> I'm interested in knowing whether I need to keep extra bools laying
> around to keep track of the "has been auto-acked" or not flag.


From majek04 at gmail.com  Tue Jul 26 16:57:54 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Tue, 26 Jul 2011 16:57:54 +0100
Subject: [rabbitmq-discuss] Reconnection strategies in Pika
In-Reply-To: <7774581B999A4D6AA21FFC35E24FACD3@myyearbook.com>
References: <4E293B45.2030602@nextday.fi>
	<CABzX+qwgzSAghV66nFODJc-EpiocQdfc+H2MMzDXh2CxUUOjjw@mail.gmail.com>
	<7774581B999A4D6AA21FFC35E24FACD3@myyearbook.com>
Message-ID: <CABzX+qyeCPYk1tF_7npUN5K5a1zXvpoEddzqnxZ4UeeEhuN_0g@mail.gmail.com>

On Tue, Jul 26, 2011 at 16:08, Gavin M. Roy <gmr at myyearbook.com> wrote:
> The SimpleReconnectionStrategy implementation was to on disconnect, have a
> incrementally delayed attempt to reconnect to the broker. I believe there's
> a ticket with this being broken in 0.9.5, I need to confirm that's the case.

Stupid question: what happens after reconnection succeeds, is
the user informed in any way? What happens to things
waiting on basic_consume and such?


> On Tuesday, July 26, 2011 at 9:45 AM, Marek Majkowski wrote:
>
> 2011/7/22 Alex Gr?nholm <alex.gronholm at nextday.fi>:
>
> I never quite grasped what these are for. Their use is not documented, and
> they seem to have no effect on connections. When a connection dies, pika
> dies too regardless of whether I have a connection strategy in place or not.
> Could someone clarify this?
>
> I suspect, the idea was to support automatic reconnections. But this
> is quite hard in AMQP world (that's a polite way of saying "impossible").
>
> I wouldn't be surprised to hear that that feature was never finished.
>
> That's my guess, I haven't looked at the code.
>
> Cheers,
> Marek
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From Lowell.Boggs at emc.com  Tue Jul 26 17:09:59 2011
From: Lowell.Boggs at emc.com (Lowell.Boggs at emc.com)
Date: Tue, 26 Jul 2011 12:09:59 -0400
Subject: [rabbitmq-discuss] Are there any unused delivery tag values?
In-Reply-To: <yrv4cbowhrqjt.fsf@dwragg.eng.vmware.com>
References: <mailman.1.1311332402.18475.rabbitmq-discuss@lists.rabbitmq.com>
	<8A1A883E3F171B42A81817DEC138352C1DB52BA33F@MX06A.corp.emc.com>
	<yrv4cbowhrqjt.fsf@dwragg.eng.vmware.com>
Message-ID: <8A1A883E3F171B42A81817DEC138352C1DB52BA76F@MX06A.corp.emc.com>

Great!  I really don't like making assumptions about data ranges without documentation.

I'll see if I can find the spec on the web for answers to similar questions in the future.

Thanks!

Lowell 

-----Original Message-----
From: David Wragg [mailto:david at rabbitmq.com] 
Sent: Tuesday, July 26, 2011 10:49 AM
To: Boggs Jr., Lowell
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Are there any unused delivery tag values?

Hi Lowell,

<Lowell.Boggs at emc.com> writes:
> Delivery tags are uint64_t data.
>
> Is zero a valid delivery tag?  Is (uint64_t)(-1)?
>
> I'm interested in knowing whether I need to keep extra bools laying
> around to keep track of the "has been auto-acked" or not flag.


From gmr at myyearbook.com  Tue Jul 26 17:13:29 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Tue, 26 Jul 2011 12:13:29 -0400
Subject: [rabbitmq-discuss] Reconnection strategies in Pika
In-Reply-To: <CABzX+qyeCPYk1tF_7npUN5K5a1zXvpoEddzqnxZ4UeeEhuN_0g@mail.gmail.com>
References: <4E293B45.2030602@nextday.fi>
	<CABzX+qwgzSAghV66nFODJc-EpiocQdfc+H2MMzDXh2CxUUOjjw@mail.gmail.com>
	<7774581B999A4D6AA21FFC35E24FACD3@myyearbook.com>
	<CABzX+qyeCPYk1tF_7npUN5K5a1zXvpoEddzqnxZ4UeeEhuN_0g@mail.gmail.com>
Message-ID: <B02C8ADB00904EA5BBE21BAEB12B3DEC@myyearbook.com>



On Tuesday, July 26, 2011 at 11:57 AM, Marek Majkowski wrote:

> On Tue, Jul 26, 2011 at 16:08, Gavin M. Roy <gmr at myyearbook.com (mailto:gmr at myyearbook.com)> wrote:
> > The SimpleReconnectionStrategy implementation was to on disconnect, have a
> > incrementally delayed attempt to reconnect to the broker. I believe there's
> > a ticket with this being broken in 0.9.5, I need to confirm that's the case.
> 
> Stupid question: what happens after reconnection succeeds, is
> the user informed in any way? What happens to things
> waiting on basic_consume and such?
There is a callback mechanism in place the user can subscribe to, but it must be treated as a new connection, there is nothing automated but the reconnection. 

No channels recreated, etc. The behavior of it should mirror the 0.5.2 behavior as of right now. Future direction hasn't been contemplated.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110726/a6891521/attachment.htm>

From tonygarnockjones+rabbitmq at gmail.com  Tue Jul 26 19:48:49 2011
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Tue, 26 Jul 2011 14:48:49 -0400
Subject: [rabbitmq-discuss] Reconnection strategies in Pika
In-Reply-To: <CABzX+qwgzSAghV66nFODJc-EpiocQdfc+H2MMzDXh2CxUUOjjw@mail.gmail.com>
References: <4E293B45.2030602@nextday.fi>
	<CABzX+qwgzSAghV66nFODJc-EpiocQdfc+H2MMzDXh2CxUUOjjw@mail.gmail.com>
Message-ID: <CAM8fPiQ1p8AXz=hNVbBa=3knzx+ACpD_Qbo-CR=zCy_RLejC9w@mail.gmail.com>

2011/7/26 Marek Majkowski <majek04 at gmail.com>

> I suspect, the idea was to support automatic reconnections. But this
> is quite hard in AMQP world (that's a polite way of saying "impossible").
>

It's not so bad actually. The application needs to know what to do when the
connection comes back, of course, but automation of the connection
lifecycle, with backoff etc and notification of the transitions between
states is quite straightforward.


> I wouldn't be surprised to hear that that feature was never finished.
>

It was working OK way back at pika 0.5.x, but I think it might have slipped
out of sync with the refactorings that have happened since. If you're
interested, you can see a functional example of the use of automatic
reconnections in a shovel-like tool at
https://github.com/pika/pika/blob/ffac8a64c23e1d1e8aabacfefb91abc125d31375/examples/demo_relay.py.
That tool, once started, was able to cope with repeated broker restarts at
either end.

Regards,
  Tony
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110726/314d79b7/attachment.htm>

From msteele at beringmedia.com  Tue Jul 26 20:28:27 2011
From: msteele at beringmedia.com (Mark Steele)
Date: Tue, 26 Jul 2011 15:28:27 -0400
Subject: [rabbitmq-discuss] SSL errors
In-Reply-To: <4E2EDD16.30505@rabbitmq.com>
References: <CAH24rBNVqqfa4zWA_3+E3c94o+aOUObKOvSS6jp34ni92=H0DA@mail.gmail.com>
	<4E2729C8.50208@rabbitmq.com>
	<CAH24rBNeASyTJZLeYF4gqjBAW4iJkYmaCQKZfWtxT8sFJ1F1VQ@mail.gmail.com>
	<4E2E9007.4010208@rabbitmq.com>
	<CAH24rBMzA+3YDqxb5UB8j3wq_sWf1x=U=0ThH6NCcDHd9uQC8Q@mail.gmail.com>
	<4E2EDD16.30505@rabbitmq.com>
Message-ID: <CAH24rBOu1N41mrLj7FhQX26So5vyN7DN4Ko9WjSmSH_G_y=U3w@mail.gmail.com>

What's the recommended version?


On Tue, Jul 26, 2011 at 11:28 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Mark,
>
> On 26/07/11 16:26, Mark Steele wrote:
>
>> It certainly is noisy. It generates typically gigabytes worth of log
>> messages per day in my setup. Any way to mitigate this?
>>
>
> Perhaps try an older Erlang version. Or ask for advise on erlang-questions.
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110726/365880a4/attachment.htm>

From matthias at rabbitmq.com  Tue Jul 26 20:39:28 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 26 Jul 2011 20:39:28 +0100
Subject: [rabbitmq-discuss] SSL errors
In-Reply-To: <CAH24rBOu1N41mrLj7FhQX26So5vyN7DN4Ko9WjSmSH_G_y=U3w@mail.gmail.com>
References: <CAH24rBNVqqfa4zWA_3+E3c94o+aOUObKOvSS6jp34ni92=H0DA@mail.gmail.com>
	<4E2729C8.50208@rabbitmq.com>
	<CAH24rBNeASyTJZLeYF4gqjBAW4iJkYmaCQKZfWtxT8sFJ1F1VQ@mail.gmail.com>
	<4E2E9007.4010208@rabbitmq.com>
	<CAH24rBMzA+3YDqxb5UB8j3wq_sWf1x=U=0ThH6NCcDHd9uQC8Q@mail.gmail.com>
	<4E2EDD16.30505@rabbitmq.com>
	<CAH24rBOu1N41mrLj7FhQX26So5vyN7DN4Ko9WjSmSH_G_y=U3w@mail.gmail.com>
Message-ID: <4E2F17F0.7090605@rabbitmq.com>

On 26/07/11 20:28, Mark Steele wrote:
> What's the recommended version?

IIRC the bug was introduced in R14B03, though I cannot find confirmation 
of that. So try the one before that, i.e. R14B02. If that doesn't work 
then ask on erlang-questions.

See 
http://erlang.2086793.n4.nabble.com/SSL-cache-delete-bug-td3614886.html 
for more details on the bug.

Matthias.

From alex.gronholm at nextday.fi  Tue Jul 26 22:06:16 2011
From: alex.gronholm at nextday.fi (=?UTF-8?B?QWxleCBHcsO2bmhvbG0=?=)
Date: Wed, 27 Jul 2011 00:06:16 +0300
Subject: [rabbitmq-discuss] Reconnection strategies in Pika
In-Reply-To: <B02C8ADB00904EA5BBE21BAEB12B3DEC@myyearbook.com>
References: <4E293B45.2030602@nextday.fi>
	<CABzX+qwgzSAghV66nFODJc-EpiocQdfc+H2MMzDXh2CxUUOjjw@mail.gmail.com>
	<7774581B999A4D6AA21FFC35E24FACD3@myyearbook.com>
	<CABzX+qyeCPYk1tF_7npUN5K5a1zXvpoEddzqnxZ4UeeEhuN_0g@mail.gmail.com>
	<B02C8ADB00904EA5BBE21BAEB12B3DEC@myyearbook.com>
Message-ID: <4E2F2C48.10601@nextday.fi>

26.07.2011 19:13, Gavin M. Roy kirjoitti:
>
> On Tuesday, July 26, 2011 at 11:57 AM, Marek Majkowski wrote:
>
>> On Tue, Jul 26, 2011 at 16:08, Gavin M. Roy <gmr at myyearbook.com 
>> <mailto:gmr at myyearbook.com>> wrote:
>>> The SimpleReconnectionStrategy implementation was to on disconnect, 
>>> have a
>>> incrementally delayed attempt to reconnect to the broker. I believe 
>>> there's
>>> a ticket with this being broken in 0.9.5, I need to confirm that's 
>>> the case.
>>
>> Stupid question: what happens after reconnection succeeds, is
>> the user informed in any way? What happens to things
>> waiting on basic_consume and such?
> There is a callback mechanism in place the user can subscribe to, but 
> it must be treated as a new connection, there is nothing automated but 
> the reconnection.
>
> No channels recreated, etc. The behavior of it should mirror the 0.5.2 
> behavior as of right now.  Future direction hasn't been contemplated.
I just need reconnection to work, but as of 0.9.5 it doesn't. Would be 
nice if it did. The callbacks will handle channel creation etc.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110727/e4d597e2/attachment.htm>

From gmr at myyearbook.com  Tue Jul 26 22:08:27 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Tue, 26 Jul 2011 17:08:27 -0400
Subject: [rabbitmq-discuss] Reconnection strategies in Pika
In-Reply-To: <4E2F2C48.10601@nextday.fi>
References: <4E293B45.2030602@nextday.fi>
	<CABzX+qwgzSAghV66nFODJc-EpiocQdfc+H2MMzDXh2CxUUOjjw@mail.gmail.com>
	<7774581B999A4D6AA21FFC35E24FACD3@myyearbook.com>
	<CABzX+qyeCPYk1tF_7npUN5K5a1zXvpoEddzqnxZ4UeeEhuN_0g@mail.gmail.com>
	<B02C8ADB00904EA5BBE21BAEB12B3DEC@myyearbook.com>
	<4E2F2C48.10601@nextday.fi>
Message-ID: <121FC96424EC45D6AE617A9503F7CFD5@myyearbook.com>

 I'll take a look at that soon. As a work-around you can register with the callback manager to be notified when the connection closes and handle it yourself.  

Check out the connection.Connection class to see how to do that.

Gavin  

On Tuesday, July 26, 2011 at 5:06 PM, Alex Gr?nholm wrote:

>  26.07.2011 19:13, Gavin M. Roy kirjoitti:  
> >  
> >  
> > On Tuesday, July 26, 2011 at 11:57 AM, Marek Majkowski wrote:
> >  
> > > On Tue, Jul 26, 2011 at 16:08, Gavin M. Roy <gmr at myyearbook.com (mailto:gmr at myyearbook.com)> wrote:
> > > > The SimpleReconnectionStrategy implementation was to on disconnect, have a
> > > >  incrementally delayed attempt to reconnect to the broker. I believe there's
> > > >  a ticket with this being broken in 0.9.5, I need to confirm that's the case.
> > >  
> > >  Stupid question: what happens after reconnection succeeds, is
> > >  the user informed in any way? What happens to things
> > >  waiting on basic_consume and such?
> > There is a callback mechanism in place the user can subscribe to, but it must be treated as a new connection, there is nothing automated but the reconnection.  
> >  
> > No channels recreated, etc. The behavior of it should mirror the 0.5.2 behavior as of right now. Future direction hasn't been contemplated.  I just need reconnection to work, but as of 0.9.5 it doesn't. Would be nice if it did. The callbacks will handle channel creation etc.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110726/8ee93ee9/attachment.htm>

From fangbot at gmail.com  Tue Jul 26 22:27:15 2011
From: fangbot at gmail.com (fangbot)
Date: Tue, 26 Jul 2011 14:27:15 -0700 (PDT)
Subject: [rabbitmq-discuss] Consumer Callback
In-Reply-To: <9E349AF4-25D2-4871-8E6E-ECF2528A25A9@rabbitmq.com>
References: <32103305.post@talk.nabble.com>
	<9E349AF4-25D2-4871-8E6E-ECF2528A25A9@rabbitmq.com>
Message-ID: <32143563.post@talk.nabble.com>


Hi Steve,

Thanks for the response. After reviewing some other posts on this forum,
I've decided to use multithreading in order to achieve the behavior I'm
looking for. Essentially, for every consumer, I create a new thread and
inside the run() method, I am calling an infinite while loop in order to
automatically retrieve the results. All of this is just to familiarize
myself with how RabbitMQ works - in the future, I suspect that every client
will run on a different machine and thus there will be only two threads max
(the application thread and the consumer thread).

Another question - I am doing some performance testing on the messaging
speeds, and my tests are roughly modeled after those in MulticastMain.
However, I've noticed that to record the speeds, getTimeMillis() is being
used. However, if there are other threads (outside of my process) that are
also running, won't they throw off (i.e. increase) the recorded time since
getTimeMillis() isn't thread-specific? Shouldn't something like
ThreadMXBean.getCurrentThreadCPUTime() be used instead?

Thanks in advance for the response!

Best,
-Fang


Steve Powell-7 wrote:
> 
> Dear fangbot,
> You do not say whether you are using Python or Java (the two languages
> shown on the tutorials pages) but I will assume it is Java.
> 
>> is there a way to create an event
>> such that when a queue gets pushed a message, it automatically calls
>> consumer.nextDelivery somehow
> 
> 
> The simple answer is 'yes', approximately.  There is a push interface
> (defined by the Consumer interface) which is driven whenever a message is
> delivered.
> 
> The tutorials use QueueingConsumer, which is a way to isolate the clients
> engine (the channel thread) from the user's thread.  As you observe, this
> is a pull interface. QueueingConsumer.nextDelivery() will block until
> there is a message to return.
> 
> If you want to use a push interface (which is what QueueingConsumer uses
> under the covers) then you are free to create your own Consumer
> (implementation of the Consumer interface) class, and the handleDelivery()
> method therein will be driven when a message arrives.  The drawback is
> that this 'callback' is driven on a RabbitMQ client thread, and (at the
> moment) you are not permitted to do long-running things on this thread or
> make channel calls, or block, as this will often result in deadlocks.
> However, if you can limit what this does, you are free to communicate with
> another thread of yours, for example to put it on a BlockingQueue (like
> QueueingConsumer does), or to otherwise trigger another thread to do
> something.
> 
> The easiest (and recommended) way to code your own Consumer is to subclass
> DefaultConsumer, and override the methods you want to change (in your case
> handleDelivery()). Take a look at the DefaultConsumer class to see what it
> does.
> 
> Other methods on the Consumer interface are driven if other events occur,
> like channel close, for example.  Your class can then do the right thing.
> 
> This area is currently being reworked -- not to change the interface
> (much!) but to lift some of the restrictions on the things a callback
> method can do without causing deadlocks -- which will also see better
> control of the system resources used by the consumer callbacks.
> 
> I hope this helps -- please come back here if you have any more questions;
> or even if you don't -- we'd like to know how you get on.
> 
> Steve Powell  (a happy bunny)
> ----------some definitions from the SPD----------
> Rigatoni n. A prime-ministerial grin.
> Nigella n. The next bottle-size up from a Nebuchadnezzar.
> Homily adv. Rather like a frenchman.
> 
> On 20 Jul 2011, at 23:26, fangbot wrote:
> 
>> 
>> I'm looking to create multiple publishers/subscribers from the main
>> thread
>> that my program is run (i.e. the thread where I have declared my
>> channel).
>> It seems that in the tutorials, the only way for consumers to get a
>> message
>> from the queue its connected to is to explicitly call
>> consumer.nextDelivery(). However, as far as my understanding, in order to
>> constantly check for new publications, this call must reside within a
>> while(true) loop. 
>> 
>> Say I wanted to create a consumer with an anonymous queue and attach it
>> to
>> an exchange. Then, I want to make a publication to that exchange. When
>> that
>> publication is made, the consumer will print something to the console
>> using
>> an overridden nextDelivery(). In order to do this, do I have to basically
>> 
>> 1. Create the consumer/queue and attach it with a routingId to the
>> exchange
>> 2. Publish a method with that routingId to the exchange
>> 3. Invoke the while loop to constantly check for messages
>> 
>> in that order?
>> 
>> If so, then is there a way to support two (or more) consumers to
>> automatically get nextDelivery? It seems that the only way is to write a
>> while loop that goes through every consumer, and calls nextDelivery on
>> that
>> consumer, in an infinite loop. Instead, is there a way to create an event
>> such that when a queue gets pushed a message, it automatically calls
>> consumer.nextDelivery somehow?
>> 
>> Thanks in advance for the reply. I'm fairly new to RabbitMQ, so please
>> forgive me if the question is somewhat basic/has already been answered
>> elsewhere :-D.
>> -- 
>> View this message in context:
>> http://old.nabble.com/Consumer-Callback-tp32103305p32103305.html
>> Sent from the RabbitMQ mailing list archive at Nabble.com.
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://old.nabble.com/Consumer-Callback-tp32103305p32143563.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From fangbot at gmail.com  Tue Jul 26 22:33:30 2011
From: fangbot at gmail.com (fangbot)
Date: Tue, 26 Jul 2011 14:33:30 -0700 (PDT)
Subject: [rabbitmq-discuss] Consumer Callback
In-Reply-To: <9E349AF4-25D2-4871-8E6E-ECF2528A25A9@rabbitmq.com>
References: <32103305.post@talk.nabble.com>
	<9E349AF4-25D2-4871-8E6E-ECF2528A25A9@rabbitmq.com>
Message-ID: <32143565.post@talk.nabble.com>


Hi Steve,
Sorry, a few clarifications. First of all, yes, I am using the Java client.
Also, when I say two threads, I meant two threads per box. Finally,
getTimeMillis() = System.currentTimeMillis().
Thanks again,
-Fang
-- 
View this message in context: http://old.nabble.com/Consumer-Callback-tp32103305p32143565.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From cmoloney at vt.edu  Wed Jul 27 01:16:54 2011
From: cmoloney at vt.edu (Christopher Moloney)
Date: Tue, 26 Jul 2011 17:16:54 -0700
Subject: [rabbitmq-discuss] Installation Trouble on Windows - "The handle is
	invalid"
Message-ID: <CACwg43cVM+HqNAboVYdjtmfYmT86JuQQ1tjJtd07XtzAjnnqOw@mail.gmail.com>

Hello,

I am new to rabbitmq and these sorts of messaging services. I am having
trouble installing RabbitMQ on window7. I would like to use it in
conjunction with django-celery to manage a task queue.

I looked around the archives but I didn?t see anything that offered a
solution to my problem.

Here is a summary of what I have done thus far. First I installed erlang
5.8.4 and rabbitmq 2.5.1 and followed the procedure on the windows install
page. Everything seemed to go well, however when I tried to run the server
it continually returned node down. In the hello world example using pika I
got the message that the connection was actively refused by the machine. So
first I checked my firewall to make sure port 5672 was open. Then, I made
sure my C:/Windows .erlang.cookie matched the on in my user directory.

Starting the server I would get a boot error that was not very descriptive:
error, badmatch error.

So I decided to try to uninstall and run the prepackaged windows binaries.
Well then there was a windows service error mismatch because I had installed
erlang 5.8.4 and the windows binaries used 5.8.3.  The windows service was
point to the wrong directory. Service.msc does not allow you to edit the
path. I used the SC DELETE command at the terminal to remove the RabbitMQ
service imaging that a fresh install would replace the service value with
the correct location.

Since then I have not been able to add the service back. When I attempt to
run ?rabbitmq-service install? get the message: Warning, could not set
correct service description (comment) Error: The handle is invalid.

The same message comes up when I run any of the commands. I have tried to
wipe all traces of erlang and rabbit from my machine to start again, but it
has not been possible. I would really like to resolve this matter and get
the messaging server up and running.

Any suggestions? I appreciate any assistance.

Thanks.

Chris
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110726/60321b6a/attachment.htm>

From emile at rabbitmq.com  Wed Jul 27 11:15:45 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 27 Jul 2011 11:15:45 +0100
Subject: [rabbitmq-discuss] Installation Trouble on Windows - "The
 handle is	invalid"
In-Reply-To: <CACwg43cVM+HqNAboVYdjtmfYmT86JuQQ1tjJtd07XtzAjnnqOw@mail.gmail.com>
References: <CACwg43cVM+HqNAboVYdjtmfYmT86JuQQ1tjJtd07XtzAjnnqOw@mail.gmail.com>
Message-ID: <4E2FE551.5010203@rabbitmq.com>

Hi Christopher,

On 27/07/11 01:16, Christopher Moloney wrote:

> Here is a summary of what I have done thus far. First I installed erlang
> 5.8.4 and rabbitmq 2.5.1 and followed the procedure on the windows
> install page. Everything seemed to go well, however when I tried to run
> the server it continually returned node down. In the hello world example

Could you tell by using the troubleshooting tips at
http://www.rabbitmq.com/install.html#troubleshooting
whether the broker was running at this point?
Was the "nodedown" a result of running the rabbitmqctl script?
Were the .erlang.cookies matching at this time?

> using pika I got the message that the connection was actively refused by
> the machine. So first I checked my firewall to make sure port 5672 was
> open. Then, I made sure my C:/Windows .erlang.cookie matched the on in
> my user directory.
> 
> Starting the server I would get a boot error that was not very
> descriptive: error, badmatch error.

What command preceded this error, and was there any additional
information following the error?

> So I decided to try to uninstall and run the prepackaged windows
> binaries. Well then there was a windows service error mismatch because I
> had installed erlang 5.8.4 and the windows binaries used 5.8.3.  The

This is not a problem. You must set the %ERLANG_HOME% variable in any
case. Also see the rabbitmq-service documentation at
http://www.rabbitmq.com/man/rabbitmq-service.man.html

> windows service was point to the wrong directory. Service.msc does not
> allow you to edit the path. I used the SC DELETE command at the terminal
> to remove the RabbitMQ service imaging that a fresh install would
> replace the service value with the correct location.

It is possible to modify the service parameters by installing the
service again, as explained in the rabbitmq-service documentation:
http://www.rabbitmq.com/install.html#running-windows-service

> Since then I have not been able to add the service back. When I attempt
> to run ?rabbitmq-service install? get the message: Warning, could not
> set correct service description (comment) Error: The handle is invalid.

I would recommend using the "rabbitmq-service.bat remove" command to
remove the service. See the documentation:
http://www.rabbitmq.com/man/rabbitmq-service.man.html#Commands

Running "SC DELETE" may have caused problems. There are additional
registry keys that need to be removed if you want to completely remove
the service. On my workstation they are under
HKEY_LOCAL_MACHINE\SOFTWARE\Ericsson\Erlang\ErlSrv\1.1\RabbitMQ

You must use the rabbitmq-service.bat (or the Erlang Service Manager
directly) to modify services. If these fail then you may need to remove
the registry keys manually. Needless to say, this is not standard
operating procedure and you risk even more serious problem if you make a
mistake. Take a backup first.

> The same message comes up when I run any of the commands. I have tried
> to wipe all traces of erlang and rabbit from my machine to start again,
> but it has not been possible. I would really like to resolve this matter
> and get the messaging server up and running.
> 
> Any suggestions? I appreciate any assistance.

Clean up the registry and make sure you install and remove the service
using the rabbitmq-service.bat script. Your experience suggests that we
could add more troubleshooting tips. Please let us know if you wish to
suggest some.


-Emile


From awitbrock at vmware.com  Wed Jul 27 11:18:21 2011
From: awitbrock at vmware.com (Ann Witbrock (c))
Date: Wed, 27 Jul 2011 03:18:21 -0700 (PDT)
Subject: [rabbitmq-discuss] Installation Trouble on Windows - "The
 handle is	invalid"
In-Reply-To: <CACwg43cVM+HqNAboVYdjtmfYmT86JuQQ1tjJtd07XtzAjnnqOw@mail.gmail.com>
Message-ID: <1776037840.451663.1311761901870.JavaMail.root@zimbra-prod-mbox-4.vmware.com>


Hi Chris, 
I'm sorry our troubleshooting instructions weren't able to help you. 

Does the rabbitmq service still appear in your list of services? 
Is epmd.exe still running in your processes? You may like to kill that. 
Did you make any change to the cookie or was that ok? 

It sounds like you had an older version already installed. Is that correct? 
If so, you may need to install the older version combination in order to stop and remove the old service. 
After removing the service you should be able to uninstall rabbitmq, remove directories (including mnesia and logs if you want) and uninstall erlang, and remove any?environment variables?you dont want (eg from path and ERLANG_HOME). 
Double check there is no RabbitMQ service present and that epmd.exe is not running. You may wish to reboot. 

After that a clean?fresh install should work ok. Our "experimental" installer works quite well, just ensure you stop, remove and start the service again (or reboot) after adding plugins. Also remember you may need to run some steps as administrator (elevated permission). 

Ann 

----- Original Message -----

From: "Christopher Moloney" <cmoloney at vt.edu> 
To: rabbitmq-discuss at lists.rabbitmq.com 
Sent: Wednesday, 27 July, 2011 1:16:54 AM 
Subject: [rabbitmq-discuss] Installation Trouble on Windows - "The handle is????????invalid" 


Hello, 
I am new to rabbitmq and these sorts of messaging services. I am having trouble installing RabbitMQ on window7. I would like to use it in conjunction with django-celery to manage a task queue. 
I looked around the archives but I didn?t see anything that offered a solution to my problem. 
Here is a summary of what I have done thus far. First I installed erlang 5.8.4 and rabbitmq 2.5.1 and followed the procedure on the windows install page. Everything seemed to go well, however when I tried to run the server it continually returned node down. In the hello world example using pika I got the message that the connection was actively refused by the machine. So first I checked my firewall to make sure port 5672 was open. Then, I made sure my C:/Windows .erlang.cookie matched the on in my user directory. 
Starting the server I would get a boot error that was not very descriptive: error, badmatch error. 
So I decided to try to uninstall and run the prepackaged windows binaries. Well then there was a windows service error mismatch because I had installed erlang 5.8.4 and the windows binaries used 5.8.3. ? The windows service was point to the wrong directory. Service.msc does not allow you to edit the path. I used the SC DELETE command at the terminal to remove the RabbitMQ service imaging that a fresh install would replace the service value with the correct location. 
Since then I have not been able to add the service back. When I attempt to run ?rabbitmq-service install? get the message: Warning, could not set correct service description (comment) Error: The handle is invalid. 
The same message comes up when I run any of the commands. I have tried to wipe all traces of erlang and rabbit from my machine to start again, but it has not been possible. I would really like to resolve this matter and get the messaging server up and running. 
Any suggestions? I appreciate any assistance. 
Thanks. 
Chris 
_______________________________________________ 
rabbitmq-discuss mailing list 
rabbitmq-discuss at lists.rabbitmq.com 
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110727/0f9f3727/attachment.htm>

From matthias at rabbitmq.com  Wed Jul 27 15:08:57 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 27 Jul 2011 15:08:57 +0100
Subject: [rabbitmq-discuss] RabbitMQ crash in production - help diagnose
 from log
In-Reply-To: <CAGErLKUejhMUVC1dVvOfo6ccOxEFGxgui8X-NR0sUxSDATgPGA@mail.gmail.com>
References: <BANLkTi=qQ-wYE5LYRk-0oV1vhiCyTR_40g@mail.gmail.com>	<4E0F0B67.3020408@rabbitmq.com>	<4E13816C.7040905@rabbitmq.com>
	<CAGErLKUejhMUVC1dVvOfo6ccOxEFGxgui8X-NR0sUxSDATgPGA@mail.gmail.com>
Message-ID: <4E301BF9.607@rabbitmq.com>

Bryan,

On 24/07/11 18:30, Bryan Alves wrote:
> On Tue, Jul 5, 2011 at 5:26 PM, Matthias Radestock
> <matthias at rabbitmq.com <mailto:matthias at rabbitmq.com>> wrote:
>     Do you still have the rabbit.log file from around the time of the
>     crash? If so, please send it to us.
>
> Sorry I don't have this anymore.

It didn't just get appended to to rabbit.log.1 on the restart? That's 
what normally happens.


Matthias.

From joseph.a.marlin at gmail.com  Wed Jul 27 16:10:58 2011
From: joseph.a.marlin at gmail.com (Joseph Marlin)
Date: Wed, 27 Jul 2011 08:10:58 -0700 (PDT)
Subject: [rabbitmq-discuss] Some quick configuration questions
Message-ID: <19764058.79.1311779458182.JavaMail.geo-discussion-forums@yqdg35>

I'd like to store persistent messages on a very large ISCSI volume, instead 
of in /var/lib/rabbitmq/mnesia/. 

If I changed the environment variable 'RABBITMQ_MNESIA_BASE' to the ISCSI 
volume, would that accomplish my goal and change the the location of my 
future stored persistent messages?

What would happen to my currently store persistent messages upon restart 
after making this change?

Thanks!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110727/c3f01297/attachment.htm>

From matthew at rabbitmq.com  Wed Jul 27 16:16:25 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 27 Jul 2011 16:16:25 +0100
Subject: [rabbitmq-discuss] Some quick configuration questions
In-Reply-To: <19764058.79.1311779458182.JavaMail.geo-discussion-forums@yqdg35>
References: <19764058.79.1311779458182.JavaMail.geo-discussion-forums@yqdg35>
Message-ID: <20110727151625.GG5905@rabbitmq.com>

Hi Joseph,

On Wed, Jul 27, 2011 at 08:10:58AM -0700, Joseph Marlin wrote:
> I'd like to store persistent messages on a very large ISCSI volume, instead 
> of in /var/lib/rabbitmq/mnesia/. 
> 
> If I changed the environment variable 'RABBITMQ_MNESIA_BASE' to the ISCSI 
> volume, would that accomplish my goal and change the the location of my 
> future stored persistent messages?

Yes.

> What would happen to my currently store persistent messages upon restart 
> after making this change?

Nothing, but rabbit would not load anything from the old store - it
would start from a blank slate, so to speak. You could copy the contents
of /var/lib/rabbitmq/mnesia/ to your new location and then rabbit should
happily load it all up once you've changed RABBITMQ_MNESIA_BASE
appropriately - there's no storage of absolute paths in there at all, so
it should Just Work.

Matthew

From joseph.a.marlin at gmail.com  Wed Jul 27 16:19:58 2011
From: joseph.a.marlin at gmail.com (Joseph Marlin)
Date: Wed, 27 Jul 2011 08:19:58 -0700 (PDT)
Subject: [rabbitmq-discuss] Some quick configuration questions
In-Reply-To: <20110727151625.GG5905@rabbitmq.com>
References: <19764058.79.1311779458182.JavaMail.geo-discussion-forums@yqdg35>
	<20110727151625.GG5905@rabbitmq.com>
Message-ID: <30070082.120.1311779998558.JavaMail.geo-discussion-forums@yqcj24>

Fantastic, thank you!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110727/fc046382/attachment.htm>

From alexandru at rabbitmq.com  Wed Jul 27 17:38:50 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Wed, 27 Jul 2011 17:38:50 +0100
Subject: [rabbitmq-discuss] Frequently getting {badmatch, {error,
 einval} from one of my rabbimq nodes
In-Reply-To: <67be1e43-db8e-4069-9354-502a1c04d294@p29g2000pre.googlegroups.com>
References: <bb1ddfc2-0886-485e-8a02-09434ce92c53@t8g2000prm.googlegroups.com>
	<20110720211414.GB12886@dakota>
	<73926954-e458-4bc2-90e6-a490c69ce8f3@v11g2000prn.googlegroups.com>
	<67be1e43-db8e-4069-9354-502a1c04d294@p29g2000pre.googlegroups.com>
Message-ID: <20110727163850.GC3188@dakota.eng.vmware.com>

Hi Chak,

I've been trying for a while, but I can't reproduce this.

That error is coming from deep inside Erlang's inet driver.  As far as I
can tell, the only way to get that error would be to call
prim_inet:async_recv/3 on a socket with a {packet, Packet} setting
different from 'raw'.  But this can't happen on any version of rabbit.

Could you give us a more detailed description of the program?  Is it a
plugin?  Is it doing anything special with the connection? (like setting
socket options after the connection is established) Is there any chance
we could see the code?

You mentioned it starts at the very beginning.  Does this mean the
problem goes away after some time?

Cheers,
Alex


On Thu, Jul 21, 2011 at 07:48:29PM -0700, Chak Hedik wrote:
> Hi Alex,
> 
> Seems like this error is still there and it seems like either it
> occurred when worker entering the loop and send another message to the
> same queue within the loop or occurred when function retry, means
> function call itself for a retry (pretty much like loop also).
> 
> Thanks,
> Chak
> 
> On Jul 21, 6:40?am, Chak Hedik <chakhe... at gmail.com> wrote:
> > Hi Alex,
> >
> > *Ubuntu Server 11.04 64-Bit
> > *RabbitMQ 2.3.1 (Default ubuntu package)
> > *Erlang Client 2.3.1 (Default ubuntu package)
> > *Erlang R13B03 (Default ubuntu package)
> >
> > Is there something in the server logs that corresponds to this error?
> > - That's the only thing appeared in the logs.
> >
> > You say your other nodes don't have similar issues. ?Is there
> > something
> > special about this node?
> > - Nothing special, pretty much the same but handle more messages than
> > others. 1 worker handling 1 queue.
> >
> > It is strange behaviour and it happen at the very beginning where the
> > worker up for the first time (no message in queue yet). I've created
> > another node and put this worker there and will wait and see if
> > similar error appear again or not today.
> >
> > Thanks for your reply.
> >
> > Chak
> >
> > On Jul 21, 5:14?am, Alexandru Scvor?ov <alexan... at rabbitmq.com> wrote:
> >
> >
> >
> >
> >
> >
> >
> > > Hi Chak,
> >
> > > Could you please answer the following questions:
> > > * What OS are you using?
> > > * What version of RabbitMQ?
> > > * What version of the Erlang client?
> > > * What version of Erlang?
> >
> > > > ** Reason for termination ==
> > > > ** {{badmatch,{error,einval}},
> > > > ? ? [{amqp_main_reader,handle_inet_async,2},
> > > > ? ? ?{gen_server,handle_msg,5},
> > > > ? ? ?{proc_lib,init_p_do_apply,3}]}
> >
> > > Looks like something strange is taking down the socket, which in turn is
> > > taking down the entire connection. ?If you have more than one
> > > connection, the others should be fine.
> >
> > > Is there something in the server logs that corresponds to this error?
> >
> > > You say your other nodes don't have similar issues. ?Is there something
> > > special about this node?
> >
> > > Cheers,
> > > Alex
> >
> > > On Wed, Jul 20, 2011 at 12:12:32AM -0700, Chak Hedik wrote:
> > > > Hi,
> >
> > > > I frequently getting this terminating error from one of my nodes :
> >
> > > > ** Generic server <0.28067.2> terminating
> > > > ** Last message in was {inet_async,#Port<0.15349>,9049,
> > > > {ok,<<0,10,0,51,206>>}}
> > > > ** When Server state == {state,#Port<0.15349>,<0.28063.2>,<0.28064.2>,
> > > > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?{method,rabbit_framing_amqp_0_9_1},
> > > > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?{1,0,4}}
> > > > ** Reason for termination ==
> > > > ** {{badmatch,{error,einval}},
> > > > ? ? [{amqp_main_reader,handle_inet_async,2},
> > > > ? ? ?{gen_server,handle_msg,5},
> > > > ? ? ?{proc_lib,init_p_do_apply,3}]}
> >
> > > > While several other nodes with the same setup didn't have the same
> > > > issue. May I know what it means and willl it affect my queues?How do I
> > > > fix this?
> >
> > > > Thank,
> > > > Chak
> > > > _______________________________________________
> > > > rabbitmq-discuss mailing list
> > > > rabbitmq-disc... at lists.rabbitmq.com
> > > >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From bryanalves at gmail.com  Wed Jul 27 19:02:18 2011
From: bryanalves at gmail.com (Bryan Alves)
Date: Wed, 27 Jul 2011 14:02:18 -0400
Subject: [rabbitmq-discuss] RabbitMQ crash in production - help diagnose
 from log
In-Reply-To: <4E301BF9.607@rabbitmq.com>
References: <BANLkTi=qQ-wYE5LYRk-0oV1vhiCyTR_40g@mail.gmail.com>
	<4E0F0B67.3020408@rabbitmq.com> <4E13816C.7040905@rabbitmq.com>
	<CAGErLKUejhMUVC1dVvOfo6ccOxEFGxgui8X-NR0sUxSDATgPGA@mail.gmail.com>
	<4E301BF9.607@rabbitmq.com>
Message-ID: <CAGErLKWJwejczz9TYXFUM_0uW=rYFKpiYmiao+e8FJXDpwgfLA@mail.gmail.com>

Unfortunately logs have been misplaced/deleted at this point.
On Jul 27, 2011 10:09 AM, "Matthias Radestock" <matthias at rabbitmq.com>
wrote:
> Bryan,
>
> On 24/07/11 18:30, Bryan Alves wrote:
>> On Tue, Jul 5, 2011 at 5:26 PM, Matthias Radestock
>> <matthias at rabbitmq.com <mailto:matthias at rabbitmq.com>> wrote:
>> Do you still have the rabbit.log file from around the time of the
>> crash? If so, please send it to us.
>>
>> Sorry I don't have this anymore.
>
> It didn't just get appended to to rabbit.log.1 on the restart? That's
> what normally happens.
>
>
> Matthias.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110727/bf75bfb7/attachment.htm>

From videlalvaro at gmail.com  Wed Jul 27 23:28:44 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Thu, 28 Jul 2011 00:28:44 +0200
Subject: [rabbitmq-discuss] Problems building rabbitmq-erlang-client
Message-ID: <DDAA2357-549D-48BB-816E-43BA1852D311@gmail.com>

Hi,

Today I was trying to build the rabbitmq-erlang-client directly from the latest umbrella and I've had some errors that the function 'monitor/2' was defined.

I've solved it by prefixing the calls to monitor/demomitor with 'erlang:'. I don't if that's the expected behavior (why the functions on the erlang module are not imported).

So I've attached a patch for this.

Cheers,

Alvaro


-------------- next part --------------
A non-text attachment was scrubbed...
Name: monitor.patch
Type: application/octet-stream
Size: 2489 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110728/c4dfba72/attachment.obj>

From sunkaiflorence at gmail.com  Wed Jul 27 23:57:37 2011
From: sunkaiflorence at gmail.com (sunkai florence)
Date: Thu, 28 Jul 2011 06:57:37 +0800
Subject: [rabbitmq-discuss] rabbitmq-ha-test setup
Message-ID: <CAGJaRztG6BvuXH2V6vvDnAVd2P6RU3iTD9dxhjdvR8e5EzTHzw@mail.gmail.com>

Hello together

I heard about the rabbitmq-ha-test developed by rabitmq as an
experimental feature and I have download the source code from github.
I am considering a high availability broker setup using the
rabbitmq-ha-test code and I wanted to check if there is someone here
who could help with experience/advice.

I have searched on google for a long while and I got nothing about the
function and setup of these code.

Is these code used for clustering or active/passive HA?

Using the rabbitmq-ha-test, there is no message to be lost when a
rabbitmq-node is down, is this right?

Meanwhile, what is the right way to setup these source code?
I am not quite familiar whit erlang, so I just download the code and
don't know what to do next.

Any ideas or hints will be much appreciated.

Sunkai
Peking University
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110728/1643e166/attachment.htm>

From cmoloney at vt.edu  Thu Jul 28 04:09:34 2011
From: cmoloney at vt.edu (Christopher Moloney)
Date: Wed, 27 Jul 2011 20:09:34 -0700
Subject: [rabbitmq-discuss] Installation Trouble on Windows - "The
 handle is invalid"
In-Reply-To: <1776037840.451663.1311761901870.JavaMail.root@zimbra-prod-mbox-4.vmware.com>
References: <CACwg43cVM+HqNAboVYdjtmfYmT86JuQQ1tjJtd07XtzAjnnqOw@mail.gmail.com>
	<1776037840.451663.1311761901870.JavaMail.root@zimbra-prod-mbox-4.vmware.com>
Message-ID: <CACwg43cx3SV7_4CoEYT=iCXTjc5ued-fiKo1kPXJ=712Ph5SEw@mail.gmail.com>

Hello Emile and Ann,



Thanks for your help.  Your suggestions were enough to help me solve my
problems and get the server up and running. If you would like to know
more detail about what went wrong form me you can keep reading.



I did not have an older version installed before my problems began. I
installed for the first time Monday per the windows install instructions
(not using the binary), but that didn?t work. I went through the install
instructions several times and I think I was making a mess and causing
conflicts with various erlang installations and directories for the rabbitmq
server. Eventually I understood the process and I wascertain to make sure to
set the %ERLANG_HOME% and % RABBITMQ_SERVER% path variables, then add
%ERLANG_HOME%\bin and % RABBITMQ_SERVER%\sbin to path, and copy the
C:\Windows .erlang.cookie over to replace the cookie in my C:\Users\cmoloney
folder. However by this point I think my problem was with the windows
service.



During the multiple installs, I tried to remove the services and use the
binary install. Running the binary, the windows service was not removed. I
thought the fresh install would overwrite the current service. It did not.
The existing service remained and it referenced the old erlang directory.
First, I tried to edit the path in the windows service, but could not. Then
I looked up how to remove a service and found the SC DELETE command. I used
it to remove the service, which it seemed to do because it is no longer in
the list. However when I try to install rabbitmq now I am told the ?service
is already present ? only updating service parameters? after that no service
appears in the list.



Unfortunately I was not aware of the ?rabbitmq-service.bat remove? command
when I ran SC DELETE. I do think the presence of some registry values was
the root of the problem. I did not discover the trouble shooting page until
late in the game, which is odd because I was staring at the install page for
hours and the trouble shooting is at the bottom of the install page. For
people like me I would say put a link to ?Trouble Shooting? at the end of
each install section where you have ?more info? links. Also I looked for
FAQs, Support/Trouble shooting in the nav at the top and did not see it.
Eventually I turned to google to search rabbitmq troubleshooting. The first
page returned is RabbitMQ ? Installation, which I ignored the first time
through because of the page title, but later I notice that the text below
the title contained troubleshooting.



Another suggestion would be to make a brief mention of ?rabbitmq-service
remove? in the install section (along with the link trouble shooting)
because when I encountered a problem I didn?t continue reading the
documentation and overlooked the remove command. Perhaps I should have
looked it all over but being hasty I breezed over it, which resulted in more
problems.



Based on your advice I first checked my registry.  There was a bunch of
stuff associated with rabbitmq in the directory where Emile suggested it
would be.



I checked to see if epmd.exe was running. It was, so I killed it.



I began by backing up the registry. I uninstalled erlang. I deleted the
rabbitmq registry entries under ErlSrv. I went to add remove programs, found
RabbitMQ still had a trace there, removed it. I removed the path variables.
I removed the directory in APP_DATA.



Then I restarted. I installed erlang and rabbitmq from the windows package.
I restarted after the install.

The windows install binary did not add the %RABBITMQ_SERVER% variable or add
";%RABBITMQ_SERVER%\sbin" to path. I added these things. I am running
windows 7 on a 64bit machine.



That did the trick. The server runs and I went through the tutorials today.



Thanks for your advice. I guess, my suggestions would be to add links to
trouble shooting at the foot of each operating system?s install guide (and
perhaps to the header nav) and to mention the ?rabbitmq-service remove?


When I was going through the tutorials I got this error message back with
every submission to the server:

C:\Python27\...\pika\callback.py:69: UserWarning: CallbackManager.add:
Duplicate callback found for ?0:Connection.CloseOk?
I am not sure if it is associated with my initial problem or if I mistakenly
defined the connection twice without clearing the connection. Does that
error message mean anything to you?

Thanks again.

Chris


On Wed, Jul 27, 2011 at 3:18 AM, Ann Witbrock (c) <awitbrock at vmware.com>wrote:

>  Hi Chris,
>
> I'm sorry our troubleshooting instructions weren't able to help you.
>
>
>
> Does the rabbitmq service still appear in your list of services?
>
> Is epmd.exe still running in your processes? You may like to kill that.
>
> Did you make any change to the cookie or was that ok?
>
>
>
> It sounds like you had an older version already installed. Is that correct?
>
> If so, you may need to install the older version combination in order to
> stop and remove the old service.
>
> After removing the service you should be able to uninstall rabbitmq, remove
> directories (including mnesia and logs if you want) and uninstall erlang,
> and remove any environment variables you dont want (eg from path and
> ERLANG_HOME).
>
> Double check there is no RabbitMQ service present and that epmd.exe is not
> running. You may wish to reboot.
>
>
>
> After that a clean fresh install should work ok. Our "experimental"
> installer works quite well, just ensure you stop, remove and start the
> service again (or reboot) after adding plugins. Also remember you may need
> to run some steps as administrator (elevated permission).
>
>
>
> Ann
>
>
>
> ------------------------------
>
> *From: *"Christopher Moloney" <cmoloney at vt.edu>
> *To: *rabbitmq-discuss at lists.rabbitmq.com
> *Sent: *Wednesday, 27 July, 2011 1:16:54 AM
> *Subject: *[rabbitmq-discuss] Installation Trouble on Windows - "The
> handle is        invalid"
>
>
> Hello,
>
> I am new to rabbitmq and these sorts of messaging services. I am having
> trouble installing RabbitMQ on window7. I would like to use it in
> conjunction with django-celery to manage a task queue.
>
> I looked around the archives but I didn?t see anything that offered a
> solution to my problem.
>
> Here is a summary of what I have done thus far. First I installed erlang
> 5.8.4 and rabbitmq 2.5.1 and followed the procedure on the windows install
> page. Everything seemed to go well, however when I tried to run the server
> it continually returned node down. In the hello world example using pika I
> got the message that the connection was actively refused by the machine. So
> first I checked my firewall to make sure port 5672 was open. Then, I made
> sure my C:/Windows .erlang.cookie matched the on in my user directory.
>
> Starting the server I would get a boot error that was not very descriptive:
> error, badmatch error.
>
> So I decided to try to uninstall and run the prepackaged windows binaries.
> Well then there was a windows service error mismatch because I had installed
> erlang 5.8.4 and the windows binaries used 5.8.3.  The windows service was
> point to the wrong directory. Service.msc does not allow you to edit the
> path. I used the SC DELETE command at the terminal to remove the RabbitMQ
> service imaging that a fresh install would replace the service value with
> the correct location.
>
> Since then I have not been able to add the service back. When I attempt to
> run ?rabbitmq-service install? get the message: Warning, could not set
> correct service description (comment) Error: The handle is invalid.
>
> The same message comes up when I run any of the commands. I have tried to
> wipe all traces of erlang and rabbit from my machine to start again, but it
> has not been possible. I would really like to resolve this matter and get
> the messaging server up and running.
>
> Any suggestions? I appreciate any assistance.
>
> Thanks.
>
> Chris
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110727/c593e3ff/attachment.htm>

From bp at barryp.org  Thu Jul 28 06:43:19 2011
From: bp at barryp.org (Barry Pederson)
Date: Wed, 27 Jul 2011 22:43:19 -0700
Subject: [rabbitmq-discuss] Python amqplib 1.0.0
Message-ID: <45BC93B0-8DB7-46AF-98AA-1D314D44309E@barryp.org>

To celebrate OSCON 2011 which I am attending for the first time, I thought I'd wrap up the Python amqplib library a bit and consider it more-or-less finished for what it is (a simple blocking 0-8 client), and call it 1.0.0   You can find it on the web here:

http://code.google.com/p/py-amqplib/
http://pypi.python.org/pypi/amqplib/1.0.0

For people who haven't moved on to Pika or Haigha, it's definitely a worthwhile upgrade in that it's significantly faster than amqplib  0.6.1, and has a fair number of bug fixes.  Also noteworthy are support for Python 3.x (via 2to3) and IPv6

	Barry 


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110727/599e1627/attachment.htm>

From michael.s.klishin at gmail.com  Thu Jul 28 06:48:11 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 28 Jul 2011 09:48:11 +0400
Subject: [rabbitmq-discuss] Python amqplib 1.0.0
In-Reply-To: <45BC93B0-8DB7-46AF-98AA-1D314D44309E@barryp.org>
References: <45BC93B0-8DB7-46AF-98AA-1D314D44309E@barryp.org>
Message-ID: <CAE3HoVTD9GknyZfrtJNY=eknB6=pJKBUPnB+76o7f=jVodeJqQ@mail.gmail.com>

2011/7/28 Barry Pederson <bp at barryp.org>

> To celebrate OSCON 2011 which I am attending for the first time, I thought
> I'd wrap up the Python amqplib library a bit and consider it more-or-less
> finished for what it is (a simple blocking 0-8 client), and call it 1.0.0


Barry,

Congratulations!

-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110728/38042ea6/attachment.htm>

From jasonjwwilliams at gmail.com  Thu Jul 28 07:17:35 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Thu, 28 Jul 2011 00:17:35 -0600
Subject: [rabbitmq-discuss] Python amqplib 1.0.0
In-Reply-To: <45BC93B0-8DB7-46AF-98AA-1D314D44309E@barryp.org>
References: <45BC93B0-8DB7-46AF-98AA-1D314D44309E@barryp.org>
Message-ID: <F89928FA-2AAB-4C36-AE51-2223600AF133@gmail.com>

Thank you Barry! Particularly for providing a solid library when there weren't a lot of folks putting effort into AMQP libraries. py-amqplib still powers a lot of our company's Rabbit infrastructure and those parts would never have been possible without pyamqplib. 

-J

Sent via iPhone

Is your email Premiere?

On Jul 27, 2011, at 23:43, Barry Pederson <bp at barryp.org> wrote:

> To celebrate OSCON 2011 which I am attending for the first time, I thought I'd wrap up the Python amqplib library a bit and consider it more-or-less finished for what it is (a simple blocking 0-8 client), and call it 1.0.0   You can find it on the web here:
> 
> http://code.google.com/p/py-amqplib/
> http://pypi.python.org/pypi/amqplib/1.0.0
> 
> For people who haven't moved on to Pika or Haigha, it's definitely a worthwhile upgrade in that it's significantly faster than amqplib  0.6.1, and has a fair number of bug fixes.  Also noteworthy are support for Python 3.x (via 2to3) and IPv6
> 
> 	Barry 
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110728/8bb5e867/attachment.htm>

From simon at rabbitmq.com  Thu Jul 28 11:19:48 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 28 Jul 2011 11:19:48 +0100
Subject: [rabbitmq-discuss] rabbitmq-ha-test setup
In-Reply-To: <CAGJaRztG6BvuXH2V6vvDnAVd2P6RU3iTD9dxhjdvR8e5EzTHzw@mail.gmail.com>
References: <CAGJaRztG6BvuXH2V6vvDnAVd2P6RU3iTD9dxhjdvR8e5EzTHzw@mail.gmail.com>
Message-ID: <4E3137C4.803@rabbitmq.com>

Hi Sunkai.

rabbitmq-ha-test is just test infrastructure for the new HA feature. The 
actual HA code is in rabbitmq-server. If you build that from mercurial 
you can use HA, although there aren't really any docs yet. (Super-brief 
explanation: build a cluster, then declare a queue with an argument 
"x-ha-policy" set to "all". The queue will then be mirrored across all 
nodes in the cluster.)

If you're not comfortable building RabbitMQ from source then the 
simplest thing to do is wait, it will hopefully be released in the next 
few weeks. Documentation will be forthcoming at release :)

Cheers, Simon

On 27/07/11 23:57, sunkai florence wrote:
> Hello together
>
> I heard about the rabbitmq-ha-test developed by rabitmq as an
> experimental feature and I have download the source code from
> github. I am considering a high availability broker setup using the
> rabbitmq-ha-test code and I wanted to check if there is someone here
> who could help with experience/advice.
>
>
>
> I have searched on google for a long while and I got nothing about
> the function and setup of these code.
>
> Is these code used for clustering or active/passive HA?
>
> Using the rabbitmq-ha-test, there is no message to be lost when a
> rabbitmq-node is down, is this right?
>
>
>
> Meanwhile, what is the right way to setup these source code? I am not
> quite familiar whit erlang, so I just download the code and don't
> know what to do next.
>
> Any ideas or hints will be much appreciated.
>
>
>
> Sunkai Peking University
>
>
>
> _______________________________________________ rabbitmq-discuss
> mailing list rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From rob.harrop at gmail.com  Thu Jul 28 11:20:21 2011
From: rob.harrop at gmail.com (Rob Harrop)
Date: Thu, 28 Jul 2011 11:20:21 +0100
Subject: [rabbitmq-discuss] RabbitMQ integration with websphere
In-Reply-To: <32117918.post@talk.nabble.com>
References: <32117918.post@talk.nabble.com>
Message-ID: <4E3137E5.8070107@rabbitmq.com>

Albert,

The documentation you point to is about integrating full-featured JMS 
providers into WAS.

Whilst there are some JMS drivers for accessing AMQP brokers, I would 
strongly recommend against their usage.

To use RabbitMQ from within a Java EE application, you can package the 
RabbitMQ Java Client libraries in your EAR and access RabbitMQ using the 
standard RabbitMQ API (http://www.rabbitmq.com/api-guide.html).

Regards,

Rob

albert_newton wrote:
> I have my application ( my .ear) deployed on Websphere, but want to use the
> messaging provided by rabbitmq. I have already installed the rabbitmqserver,
> erlang and all that stuff on my box. I am trying to find a way (a location
> in websphere) where I can configure to use the rabbitmq stuff rather than
> the websphere jms stuff ( which I am using right now). I read something
> about the shovel plugin:
> http://www.rabbitmq.com/plugins.html#rabbitmq-shovel
>
> but not sure if that is what fulfills my purpose ( because that sounds like
> i would have two messaging setups - one within websphere, and other within
> rabbitmq, rather than a single one in rabbit mq). I also read about
> configuring a third party provider in websphere here:
> http://publib.boulder.ibm.com/infocenter/wasinfo/v6r0/index.jsp?topic=/com.ibm.websphere.express.doc/info/exp/ae/cmj_jmsp.html
>
> Maybe that is closer to what I need but not sure. Is there any way to
> achieve what I am trying to do ( maybe one of the above approaches, or some
> other way)?
>

From rob.harrop at gmail.com  Thu Jul 28 11:36:52 2011
From: rob.harrop at gmail.com (Rob Harrop)
Date: Thu, 28 Jul 2011 11:36:52 +0100
Subject: [rabbitmq-discuss] rabbitmq-ha-test setup
In-Reply-To: <CAGJaRztG6BvuXH2V6vvDnAVd2P6RU3iTD9dxhjdvR8e5EzTHzw@mail.gmail.com>
References: <CAGJaRztG6BvuXH2V6vvDnAVd2P6RU3iTD9dxhjdvR8e5EzTHzw@mail.gmail.com>
Message-ID: <4E313BC4.2030703@rabbitmq.com>

The rabbitmq-ha-test code is simply a test suite to exercise the HA 
functions available in the default of the rabbitmq-server repo.

To test the new HA functions you'll need to clone default of 
rabbitmq-server from http://hg.rabbitmq.com/rabbitmq-server/

Once you've cloned the code you can build and run the broker by issuing 
a `make run`.

I've attached a copy of the docs for HA as they currently stand.

Regards,

Rob

sunkai florence wrote:
> Hello together
>
> I heard about the rabbitmq-ha-test developed by rabitmq as an experimental feature and I have download the source code from github.
> I am considering a high availability broker setup using the rabbitmq-ha-test code and I wanted to check if there is someone here who could help with experience/advice.
>
>
>
> I have searched on google for a long while and I got nothing about the function and setup of these code.
>
> Is these code used for clustering or active/passive HA?
>
> Using the rabbitmq-ha-test, there is no message to be lost when a rabbitmq-node is down, is this right?
>
>
>
> Meanwhile, what is the right way to setup these source code?
> I am not quite familiar whit erlang, so I just download the code and don't know what to do next.
>
> Any ideas or hints will be much appreciated.
>
>
>
> Sunkai
> Peking University
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
A non-text attachment was scrubbed...
Name: ha.xml
Type: text/xml
Size: 16842 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110728/bb160eff/attachment.bin>

From matthew at rabbitmq.com  Thu Jul 28 12:27:43 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 28 Jul 2011 12:27:43 +0100
Subject: [rabbitmq-discuss] Problems building rabbitmq-erlang-client
In-Reply-To: <DDAA2357-549D-48BB-816E-43BA1852D311@gmail.com>
References: <DDAA2357-549D-48BB-816E-43BA1852D311@gmail.com>
Message-ID: <20110728112742.GA28034@rabbitmq.com>

Hi Alvaro,

On Thu, Jul 28, 2011 at 12:28:44AM +0200, Alvaro Videla wrote:
> Today I was trying to build the rabbitmq-erlang-client directly from
> the latest umbrella and I've had some errors that the function
> 'monitor/2' was defined.
> 
> I've solved it by prefixing the calls to monitor/demomitor with
> 'erlang:'. I don't if that's the expected behavior (why the functions
> on the erlang module are not imported).

Argh, thanks for that. I think that's a result of us using the latest
Erlang release which doesn't require the erlang: prefix as much. Will
fix.

Matthew

From videlalvaro at gmail.com  Thu Jul 28 12:34:14 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Thu, 28 Jul 2011 13:34:14 +0200
Subject: [rabbitmq-discuss] Problems building rabbitmq-erlang-client
In-Reply-To: <20110728112742.GA28034@rabbitmq.com>
References: <DDAA2357-549D-48BB-816E-43BA1852D311@gmail.com>
	<20110728112742.GA28034@rabbitmq.com>
Message-ID: <F5A50379-EF35-4F1E-9389-F29FA767C6AB@gmail.com>

Hi Matthew,

Thanks. Talking of missing things? now that I read my email again I see that a lot of verbs and words are missing :D

Cheers,

Alvaro

On Jul 28, 2011, at 1:27 PM, Matthew Sackman wrote:

> Hi Alvaro,
> 
> On Thu, Jul 28, 2011 at 12:28:44AM +0200, Alvaro Videla wrote:
>> Today I was trying to build the rabbitmq-erlang-client directly from
>> the latest umbrella and I've had some errors that the function
>> 'monitor/2' was defined.
>> 
>> I've solved it by prefixing the calls to monitor/demomitor with
>> 'erlang:'. I don't if that's the expected behavior (why the functions
>> on the erlang module are not imported).
> 
> Argh, thanks for that. I think that's a result of us using the latest
> Erlang release which doesn't require the erlang: prefix as much. Will
> fix.
> 
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

Sent form my Nokia 1100




From david_syer at hotmail.com  Thu Jul 28 13:10:27 2011
From: david_syer at hotmail.com (Dave Syer)
Date: Thu, 28 Jul 2011 05:10:27 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ and Spring
In-Reply-To: <27D6B27DB616654BBEF4DDB8B31EAF916B590E9526@vs-msx01.IT-NG.local>
References: <27D6B27DB616654BBEF4DDB8B31EAF916B590E9526@vs-msx01.IT-NG.local>
Message-ID: <468ecd19-1a84-4b35-934c-b16a1c36c30e@e35g2000yqc.googlegroups.com>

Your application context does not declare are beans of type Exchange,
Queue or Binding, so the RabbitAdmin is left with nothing to do.  That
would explain why you need to declare them manually in the Java
snippet. Note that there is a <rabbit:/> namespace for declaring most
of the stuff that you have done longhand using <beans:/>, and also for
declaring the exchanges, queues and bindings.  It also creates a
CachingConnectionFactory, not a SIngleConnectionFactory, which is
better for performance and resilience.

You didn't say which version of Spring AMQP you are using but I can
tell from the stack trace at the end that it is not 1.0.0.RC2, which
depends on the Rabbit Client 2.5.1.  If you upgrade that should make
things easier.

From aaron at agoragames.com  Thu Jul 28 13:11:13 2011
From: aaron at agoragames.com (Aaron Westendorf)
Date: Thu, 28 Jul 2011 08:11:13 -0400
Subject: [rabbitmq-discuss] Python amqplib 1.0.0
In-Reply-To: <45BC93B0-8DB7-46AF-98AA-1D314D44309E@barryp.org>
References: <45BC93B0-8DB7-46AF-98AA-1D314D44309E@barryp.org>
Message-ID: <CAHiEoM4+tp-f1+n9irhSk8bWPQXGMtTMSEQNvoizrfSQgXGJvg@mail.gmail.com>

Thank you Barry, py-amqplib allowed us to launch our product quickly and
reliably, and served us well for 2 years. Congratulations on the
accomplishment, the hard work paid off.

cheers,
Aaron

On Thu, Jul 28, 2011 at 1:43 AM, Barry Pederson <bp at barryp.org> wrote:

> To celebrate OSCON 2011 which I am attending for the first time, I thought
> I'd wrap up the Python amqplib library a bit and consider it more-or-less
> finished for what it is (a simple blocking 0-8 client), and call it 1.0.0
> You can find it on the web here:
>
> http://code.google.com/p/py-amqplib/
> http://pypi.python.org/pypi/amqplib/1.0.0
>
> For people who haven't moved on to Pika or Haigha, it's definitely a
> worthwhile upgrade in that it's significantly faster than amqplib  0.6.1,
> and has a fair number of bug fixes.  Also noteworthy are support for Python
> 3.x (via 2to3) and IPv6
>
> Barry
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110728/aa6474f3/attachment.htm>

From tonygarnockjones+rabbitmq at gmail.com  Thu Jul 28 13:17:49 2011
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Thu, 28 Jul 2011 08:17:49 -0400
Subject: [rabbitmq-discuss] Python amqplib 1.0.0
In-Reply-To: <45BC93B0-8DB7-46AF-98AA-1D314D44309E@barryp.org>
References: <45BC93B0-8DB7-46AF-98AA-1D314D44309E@barryp.org>
Message-ID: <CAM8fPiRCXV7Eaq75qe9Ej+yPVykT5MGMB-oAW5M53jS24mnf-g@mail.gmail.com>

Congratulations and thanks Barry - your library's design was the original
inspiration for aspects of the designs of both Pika and also the C libamqp.
Both have drifted a little since then, but without seeing that the approach
you took could have worked, I might never have tried it.

Regards,
  Tony

On 28 July 2011 01:43, Barry Pederson <bp at barryp.org> wrote:

> To celebrate OSCON 2011 which I am attending for the first time, I thought
> I'd wrap up the Python amqplib library a bit and consider it more-or-less
> finished for what it is (a simple blocking 0-8 client), and call it 1.0.0
> You can find it on the web here:
>
> http://code.google.com/p/py-amqplib/
> http://pypi.python.org/pypi/amqplib/1.0.0
>
> For people who haven't moved on to Pika or Haigha, it's definitely a
> worthwhile upgrade in that it's significantly faster than amqplib  0.6.1,
> and has a fair number of bug fixes.  Also noteworthy are support for Python
> 3.x (via 2to3) and IPv6
>
> Barry
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110728/78f6d403/attachment.htm>

From awitbrock at vmware.com  Thu Jul 28 14:00:00 2011
From: awitbrock at vmware.com (Ann Witbrock (c))
Date: Thu, 28 Jul 2011 06:00:00 -0700 (PDT)
Subject: [rabbitmq-discuss] Installation Trouble on Windows - "The
 handle is invalid"
In-Reply-To: <CACwg43cx3SV7_4CoEYT=iCXTjc5ued-fiKo1kPXJ=712Ph5SEw@mail.gmail.com>
Message-ID: <1403569813.481027.1311858000124.JavaMail.root@zimbra-prod-mbox-4.vmware.com>


Chris, 
Happy to hear you now have RabbitMQ service running ok. 

Thanks for your detailed description. 
To avoid many of these problems, we created the windows installer, which is the preferred way of installing?fresh ?(the site?should say so when we release our next RabbitMQ version) . 

We are aware that the troubleshooting and uninstall need to be improved, and also our site navigation. 

Your comments will be helpful in making useful changes to that side of the problem. 

Regards, 
Ann 


----- Original Message -----

From: "Christopher Moloney" <cmoloney at vt.edu> 
To: "Ann Witbrock (c)" <awitbrock at vmware.com>, emile at rabbitmq.com 
Cc: rabbitmq-discuss at lists.rabbitmq.com 
Sent: Thursday, 28 July, 2011 4:09:34 AM 
Subject: Re: [rabbitmq-discuss] Installation Trouble on Windows - "The handle is invalid" 


Hello Emile and Ann, 
? 
Thanks for your help.? Your suggestions were enough to help me solve my problems and get the server up and running. If you would like to know more?detail about what went wrong form me?you can keep reading. 
? 
I did not have an older version installed before my problems began. I installed for the first time Monday per the windows install instructions (not using the binary), but that didn?t work. I went through the install instructions?several times and I think I was making a mess and causing conflicts with various erlang installations and directories for the rabbitmq server. Eventually I understood the process and I wascertain to make sure to set the %ERLANG_HOME% and % RABBITMQ_SERVER% path variables, then add %ERLANG_HOME%\bin and % RABBITMQ_SERVER%\sbin to path, and copy the C:\Windows .erlang.cookie over to replace the cookie in my C:\Users\cmoloney folder. However by this point I think my problem was with the windows service. 
? 
During the multiple installs, I tried to remove the services and use the binary install. Running the binary, the windows service was not removed. I thought the fresh install would overwrite the current service. It did not. The existing service remained and it referenced the old erlang directory. First, I tried to edit the path in the windows service, but could not. Then I looked up how to remove a service and found the SC DELETE command. I used it to remove the service, which it seemed to do because it is no longer in the list. However when I try to install rabbitmq now I am told the ?service is already present ? only updating service parameters? after that no service appears in the list. 
? 
Unfortunately I was not aware of the ?rabbitmq-service.bat remove? command when I ran SC DELETE. I do think the presence of some registry values was the root of the problem. I did not discover the trouble shooting page until late in the game, which is odd because I was staring at the install page for hours and the trouble shooting is at the bottom of the install page. For people like me I would say put a link to ?Trouble Shooting? at the end of each install section where you have ?more info? links. Also I looked for FAQs, Support/Trouble shooting in the nav at the top and did not see it. Eventually I turned to google to search rabbitmq troubleshooting. The first page returned is RabbitMQ ? Installation, which I ignored the first time through because of the page title, but later I notice that the text below the title contained troubleshooting. 
? 
Another suggestion would be to make a brief mention of ?rabbitmq-service remove? in the install section (along with the link trouble shooting) because when I encountered a problem I didn?t continue reading the documentation and overlooked the remove command. Perhaps I should have looked it all over but being hasty I breezed over it, which resulted in more problems. 
? 
Based on your advice I first checked my registry.? There was a bunch of stuff associated with rabbitmq in the directory where Emile?suggested it would be. 
? 
I checked to see if epmd.exe was running. It was, so I killed it. 
? 
I began by?backing up the registry. I uninstalled erlang. I deleted the rabbitmq registry entries under ErlSrv. I went to add remove programs, found RabbitMQ still had a trace there, removed it. I removed the path variables. I removed the directory in APP_DATA. 
? 
Then I restarted. I installed erlang and rabbitmq from the windows package. I restarted after the install. 
The windows install binary did not add the %RABBITMQ_SERVER% variable or add " ;%RABBITMQ_SERVER%\sbin " to path. I added these things. I am running windows 7 on a 64bit machine. 
? 
That did the trick. The server runs and I went through the tutorials today. 
? 
Thanks for your advice. I guess, my suggestions would be to add links to trouble shooting at the foot of each operating system?s install guide (and perhaps to the header nav) and to mention the ?rabbitmq-service remove? 
? 
? 
When I was going through the tutorials I got this error message back with every submission to the server: 
C:\Python27\...\pika\callback.py:69: UserWarning: CallbackManager.add: Duplicate callback found for ?0:Connection.CloseOk? 
I am not sure if it is associated with my initial problem or if I mistakenly defined the connection twice without clearing the connection. Does that error message mean anything to you? 
? 
Thanks again. 

Chris 



On Wed, Jul 27, 2011 at 3:18 AM, Ann Witbrock (c) < awitbrock at vmware.com > wrote: 





Hi Chris, 
I'm sorry our troubleshooting instructions weren't able to help you. 
? 
Does the rabbitmq service still appear in your list of services? 
Is epmd.exe still running in your processes? You may like to kill that. 
Did you make any change to the cookie or was that ok? 
? 
It sounds like you had an older version already installed. Is that correct? 
If so, you may need to install the older version combination in order to stop and remove the old service. 
After removing the service you should be able to uninstall rabbitmq, remove directories (including mnesia and logs if you want) and uninstall erlang, and remove any?environment variables?you dont want (eg from path and ERLANG_HOME). 
Double check there is no RabbitMQ service present and that epmd.exe is not running. You may wish to reboot. 
? 
After that a clean?fresh install should work ok. Our "experimental" installer works quite well, just ensure you stop, remove and start the service again (or reboot) after adding plugins. Also remember you may need to run some steps as administrator (elevated permission). 
? 
Ann 
? 



From: "Christopher Moloney" < cmoloney at vt.edu > 
To: rabbitmq-discuss at lists.rabbitmq.com 
Sent: Wednesday, 27 July, 2011 1:16:54 AM 
Subject: [rabbitmq-discuss] Installation Trouble on Windows - "The handle is????????invalid" 





Hello, 
I am new to rabbitmq and these sorts of messaging services. I am having trouble installing RabbitMQ on window7. I would like to use it in conjunction with django-celery to manage a task queue. 
I looked around the archives but I didn?t see anything that offered a solution to my problem. 
Here is a summary of what I have done thus far. First I installed erlang 5.8.4 and rabbitmq 2.5.1 and followed the procedure on the windows install page. Everything seemed to go well, however when I tried to run the server it continually returned node down. In the hello world example using pika I got the message that the connection was actively refused by the machine. So first I checked my firewall to make sure port 5672 was open. Then, I made sure my C:/Windows .erlang.cookie matched the on in my user directory. 
Starting the server I would get a boot error that was not very descriptive: error, badmatch error. 
So I decided to try to uninstall and run the prepackaged windows binaries. Well then there was a windows service error mismatch because I had installed erlang 5.8.4 and the windows binaries used 5.8.3. ? The windows service was point to the wrong directory. Service.msc does not allow you to edit the path. I used the SC DELETE command at the terminal to remove the RabbitMQ service imaging that a fresh install would replace the service value with the correct location. 
Since then I have not been able to add the service back. When I attempt to run ?rabbitmq-service install? get the message: Warning, could not set correct service description (comment) Error: The handle is invalid. 
The same message comes up when I run any of the commands. I have tried to wipe all traces of erlang and rabbit from my machine to start again, but it has not been possible. I would really like to resolve this matter and get the messaging server up and running. 
Any suggestions? I appreciate any assistance. 
Thanks. 
Chris 
_______________________________________________ 
rabbitmq-discuss mailing list 
rabbitmq-discuss at lists.rabbitmq.com 
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss 






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110728/a31bf2ab/attachment.htm>

From jamie at durablemethods.com  Thu Jul 28 15:12:37 2011
From: jamie at durablemethods.com (Jamie McIlroy)
Date: Thu, 28 Jul 2011 08:12:37 -0600
Subject: [rabbitmq-discuss] Installing the service on Windows 7
Message-ID: <CAKYOifAiTKFD+KmY_8aMRWi8-u8JyzvT3pSx2tydSd8YS=V8sw@mail.gmail.com>

New to rabbit mq and erlang.
I can run the rabbitmq server from the command line.  I can produce and
consume messages from the broker when running the server in this way.  I'd
like to run it as a service but when I try the install scrip, I get the
following output:

c:\Program Files (x86)\rabbitmq_server-2.5.1\sbin>rabbitmq-service.bat
install
C:\Program Files (x86)\erl5.8.4\erts-5.8.4\bin\erlsrv: Unable to register
servic
e with service manager.
Error: Access is denied.
Activating RabbitMQ plugins ...
0 plugins activated:

C:\Program Files (x86)\erl5.8.4\erts-5.8.4\bin\erlsrv: No service with the
name
RabbitMQ exists.

Is there any way to know what access is getting denied?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110728/5565471e/attachment.htm>

From ekirpichov at gmail.com  Thu Jul 28 15:13:41 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Thu, 28 Jul 2011 18:13:41 +0400
Subject: [rabbitmq-discuss] Installing the service on Windows 7
In-Reply-To: <CAKYOifAiTKFD+KmY_8aMRWi8-u8JyzvT3pSx2tydSd8YS=V8sw@mail.gmail.com>
References: <CAKYOifAiTKFD+KmY_8aMRWi8-u8JyzvT3pSx2tydSd8YS=V8sw@mail.gmail.com>
Message-ID: <CANVKUrV6x36kgBfXL=zpd931g3R_KsDT+=aww1wkvawOyWmVKw@mail.gmail.com>

Did you run this from an elevated command prompt?

2011/7/28 Jamie McIlroy <jamie at durablemethods.com>:
> New to rabbit mq and erlang.
> I can run the rabbitmq server from the command line.? I can produce and
> consume messages from the broker when running the server in this way.? I'd
> like to run it as a service but when I try the install scrip, I get the
> following output:
>
> c:\Program Files (x86)\rabbitmq_server-2.5.1\sbin>rabbitmq-service.bat
> install
> C:\Program Files (x86)\erl5.8.4\erts-5.8.4\bin\erlsrv: Unable to register
> servic
> e with service manager.
> Error: Access is denied.
> Activating RabbitMQ plugins ...
> 0 plugins activated:
>
> C:\Program Files (x86)\erl5.8.4\erts-5.8.4\bin\erlsrv: No service with the
> name
> RabbitMQ exists.
>
> Is there any way to know what access is getting denied?
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/

From ekirpichov at gmail.com  Thu Jul 28 15:15:32 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Thu, 28 Jul 2011 18:15:32 +0400
Subject: [rabbitmq-discuss] Installing the service on Windows 7
In-Reply-To: <CAKYOifA9kW=U1z4_hNh6804dkFL=e2G8mAQVBwfA+T+Ezo4d6A@mail.gmail.com>
References: <CAKYOifAiTKFD+KmY_8aMRWi8-u8JyzvT3pSx2tydSd8YS=V8sw@mail.gmail.com>
	<CANVKUrV6x36kgBfXL=zpd931g3R_KsDT+=aww1wkvawOyWmVKw@mail.gmail.com>
	<CAKYOifA9kW=U1z4_hNh6804dkFL=e2G8mAQVBwfA+T+Ezo4d6A@mail.gmail.com>
Message-ID: <CANVKUrWt9L0CVpv1gRws9uyE=LG1OjAYr6oEp1OoO6qFEdnmTA@mail.gmail.com>

Well, it only works from an elevated prompt ("Run as administrator")
:) You're doing a privileged action (installing a service), after all.

2011/7/28 Jamie McIlroy <jamie at durablemethods.com>:
> nope, just type cmd from the run dialog (not a windows guy)
>
> On Thu, Jul 28, 2011 at 8:13 AM, Eugene Kirpichov <ekirpichov at gmail.com>
> wrote:
>>
>> Did you run this from an elevated command prompt?
>>
>> 2011/7/28 Jamie McIlroy <jamie at durablemethods.com>:
>> > New to rabbit mq and erlang.
>> > I can run the rabbitmq server from the command line.? I can produce and
>> > consume messages from the broker when running the server in this way.
>> > I'd
>> > like to run it as a service but when I try the install scrip, I get the
>> > following output:
>> >
>> > c:\Program Files (x86)\rabbitmq_server-2.5.1\sbin>rabbitmq-service.bat
>> > install
>> > C:\Program Files (x86)\erl5.8.4\erts-5.8.4\bin\erlsrv: Unable to
>> > register
>> > servic
>> > e with service manager.
>> > Error: Access is denied.
>> > Activating RabbitMQ plugins ...
>> > 0 plugins activated:
>> >
>> > C:\Program Files (x86)\erl5.8.4\erts-5.8.4\bin\erlsrv: No service with
>> > the
>> > name
>> > RabbitMQ exists.
>> >
>> > Is there any way to know what access is getting denied?
>> >
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >
>> >
>>
>>
>>
>> --
>> Eugene Kirpichov
>> Principal Engineer, Mirantis Inc. http://www.mirantis.com/
>> Editor, http://fprog.ru/
>
>



-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/

From jamie at durablemethods.com  Thu Jul 28 15:28:42 2011
From: jamie at durablemethods.com (Jamie McIlroy)
Date: Thu, 28 Jul 2011 08:28:42 -0600
Subject: [rabbitmq-discuss] Installing the service on Windows 7
In-Reply-To: <CANVKUrWt9L0CVpv1gRws9uyE=LG1OjAYr6oEp1OoO6qFEdnmTA@mail.gmail.com>
References: <CAKYOifAiTKFD+KmY_8aMRWi8-u8JyzvT3pSx2tydSd8YS=V8sw@mail.gmail.com>
	<CANVKUrV6x36kgBfXL=zpd931g3R_KsDT+=aww1wkvawOyWmVKw@mail.gmail.com>
	<CAKYOifA9kW=U1z4_hNh6804dkFL=e2G8mAQVBwfA+T+Ezo4d6A@mail.gmail.com>
	<CANVKUrWt9L0CVpv1gRws9uyE=LG1OjAYr6oEp1OoO6qFEdnmTA@mail.gmail.com>
Message-ID: <CAKYOifAq98Gy8fiESx_Qkw0DpfsevyCT3Qe2=BXKpfnLbFAT9A@mail.gmail.com>

Perfect, worked like a charm.  Thanks a lot Eugene

J

On Thu, Jul 28, 2011 at 8:15 AM, Eugene Kirpichov <ekirpichov at gmail.com>wrote:

> Well, it only works from an elevated prompt ("Run as administrator")
> :) You're doing a privileged action (installing a service), after all.
>
> 2011/7/28 Jamie McIlroy <jamie at durablemethods.com>:
> > nope, just type cmd from the run dialog (not a windows guy)
> >
> > On Thu, Jul 28, 2011 at 8:13 AM, Eugene Kirpichov <ekirpichov at gmail.com>
> > wrote:
> >>
> >> Did you run this from an elevated command prompt?
> >>
> >> 2011/7/28 Jamie McIlroy <jamie at durablemethods.com>:
> >> > New to rabbit mq and erlang.
> >> > I can run the rabbitmq server from the command line.  I can produce
> and
> >> > consume messages from the broker when running the server in this way.
> >> > I'd
> >> > like to run it as a service but when I try the install scrip, I get
> the
> >> > following output:
> >> >
> >> > c:\Program Files (x86)\rabbitmq_server-2.5.1\sbin>rabbitmq-service.bat
> >> > install
> >> > C:\Program Files (x86)\erl5.8.4\erts-5.8.4\bin\erlsrv: Unable to
> >> > register
> >> > servic
> >> > e with service manager.
> >> > Error: Access is denied.
> >> > Activating RabbitMQ plugins ...
> >> > 0 plugins activated:
> >> >
> >> > C:\Program Files (x86)\erl5.8.4\erts-5.8.4\bin\erlsrv: No service with
> >> > the
> >> > name
> >> > RabbitMQ exists.
> >> >
> >> > Is there any way to know what access is getting denied?
> >> >
> >> > _______________________________________________
> >> > rabbitmq-discuss mailing list
> >> > rabbitmq-discuss at lists.rabbitmq.com
> >> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >> >
> >> >
> >>
> >>
> >>
> >> --
> >> Eugene Kirpichov
> >> Principal Engineer, Mirantis Inc. http://www.mirantis.com/
> >> Editor, http://fprog.ru/
> >
> >
>
>
>
> --
> Eugene Kirpichov
> Principal Engineer, Mirantis Inc. http://www.mirantis.com/
> Editor, http://fprog.ru/
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110728/9e2afa8f/attachment.htm>

From rmartele at gmail.com  Thu Jul 28 16:37:18 2011
From: rmartele at gmail.com (Renaud)
Date: Thu, 28 Jul 2011 08:37:18 -0700 (PDT)
Subject: [rabbitmq-discuss] Connection closed after 10 minutes. Cause :
	end-of-stream
Message-ID: <ed37b4c6-8832-49e8-8761-f2da5e076973@y13g2000yqy.googlegroups.com>

Hi everyone,

I'm using .NET API of rabbitmq and I'm facing a problem. After 10
minutes (precisely) of use, my IConnection (or my IModel, I don't know
wich one) closes by itself. It seems to be due to an "endofstream
exception". I set no timeout on my IConnection and on my IModel so I
don't understand...

What is even more weird is that I don't have this problem with my
applications using Java API.

Can someone help me to unlock this constraint of 10 minutes please?

From matthew at rabbitmq.com  Thu Jul 28 16:51:21 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 28 Jul 2011 16:51:21 +0100
Subject: [rabbitmq-discuss] Connection closed after 10 minutes. Cause :
 end-of-stream
In-Reply-To: <ed37b4c6-8832-49e8-8761-f2da5e076973@y13g2000yqy.googlegroups.com>
References: <ed37b4c6-8832-49e8-8761-f2da5e076973@y13g2000yqy.googlegroups.com>
Message-ID: <20110728155121.GH28034@rabbitmq.com>

On Thu, Jul 28, 2011 at 08:37:18AM -0700, Renaud wrote:
> Can someone help me to unlock this constraint of 10 minutes please?

It's not some weird firewall issue is it? I realise that it would have
to be a very very strange firewall to affect .Net connections and not
Java connections, but stranger things have happened... ;)

Matthew

From peter.mezzina at gmail.com  Thu Jul 28 18:20:13 2011
From: peter.mezzina at gmail.com (Peter Mezzina)
Date: Thu, 28 Jul 2011 10:20:13 -0700 (PDT)
Subject: [rabbitmq-discuss] How to communicate with a CGI endpoint expecting
	an XML post
Message-ID: <10fb78da-fe4a-4271-971d-cd632d09aa76@y13g2000yqy.googlegroups.com>

Would anyone know of an adapter for posting XML to an Apache HTTP
Server based CGI application? For example, how to get RabbitMQ to do
an HTTP post to a URL?

From jon at jbrisbin.com  Thu Jul 28 20:18:54 2011
From: jon at jbrisbin.com (Jon Brisbin)
Date: Thu, 28 Jul 2011 14:18:54 -0500 (CDT)
Subject: [rabbitmq-discuss] How to communicate with a CGI endpoint
	expecting	an XML post
In-Reply-To: <10fb78da-fe4a-4271-971d-cd632d09aa76@y13g2000yqy.googlegroups.com>
Message-ID: <fd212911-be52-4adf-8680-c2eb1d7969a1@jbrisbin.local>

There is a plugin I wrote to do just this: 

https://github.com/jbrisbin/rabbitmq-webhooks 

Thanks! 

Jon Brisbin 
http//jbrisbin.com 

----- Original Message -----

> From: "Peter Mezzina" <peter.mezzina at gmail.com>
> To: rabbitmq-discuss at lists.rabbitmq.com
> Sent: Thursday, July 28, 2011 12:20:13 PM
> Subject: [rabbitmq-discuss] How to communicate with a CGI endpoint
> expecting an XML post

> Would anyone know of an adapter for posting XML to an Apache HTTP
> Server based CGI application? For example, how to get RabbitMQ to do
> an HTTP post to a URL?
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110728/308ead84/attachment.htm>

From rmartele at gmail.com  Thu Jul 28 20:29:25 2011
From: rmartele at gmail.com (Renaud)
Date: Thu, 28 Jul 2011 12:29:25 -0700 (PDT)
Subject: [rabbitmq-discuss] Connection closed after 10 minutes. Cause :
	end-of-stream
In-Reply-To: <20110728155121.GH28034@rabbitmq.com>
References: <ed37b4c6-8832-49e8-8761-f2da5e076973@y13g2000yqy.googlegroups.com>
	<20110728155121.GH28034@rabbitmq.com>
Message-ID: <93f4e0c5-bcd0-4f8f-a6fb-ed590ff7c9f0@gv8g2000vbb.googlegroups.com>

I checked right now and as I thought : I already disabled Windows
firewall, and there is no other firewall installed on this computer...
I'm going to make some tests and try to figure it out.

I have to precise that Java clients are not on the same computer, they
run on Ubuntu Server. My .Net client run on Windows XP.

Renaud

On 28 juil, 17:51, Matthew Sackman <matt... at rabbitmq.com> wrote:
> On Thu, Jul 28, 2011 at 08:37:18AM -0700, Renaud wrote:
> > Can someone help me to unlock this constraint of 10 minutes please?
>
> It's not some weird firewall issue is it? I realise that it would have
> to be a very very strange firewall to affect .Net connections and not
> Java connections, but stranger things have happened... ;)
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From jon at jbrisbin.com  Thu Jul 28 22:14:27 2011
From: jon at jbrisbin.com (Jon Brisbin)
Date: Thu, 28 Jul 2011 16:14:27 -0500 (CDT)
Subject: [rabbitmq-discuss] How to communicate with a CGI endpoint
	expecting an XML post
In-Reply-To: <CAO85Wy9YfbB0d0Hc4MSPEYjWQ-wn_ARhOLehiNp1no05ppgWQA@mail.gmail.com>
Message-ID: <95c8b890-0ac1-4dd4-8a17-5d1228c30786@jbrisbin.local>

----- Original Message -----

> From: "Peter Mezzina" <pmezzina at procint.com>
> To: "Jon Brisbin" <jon at jbrisbin.com>
> Sent: Thursday, July 28, 2011 4:08:23 PM
> Subject: Re: [rabbitmq-discuss] How to communicate with a CGI
> endpoint expecting an XML post

> Jon,

> Looks very good. Is there any config documentation?
In the wiki: 

https://github.com/jbrisbin/rabbitmq-webhooks/wiki/configuration 

Thanks! 

Jon Brisbin 
http//jbrisbin.com 

> - Peter

> On Thu, Jul 28, 2011 at 3:18 PM, Jon Brisbin < jon at jbrisbin.com >
> wrote:

> > There is a plugin I wrote to do just this:
> 

> > https://github.com/jbrisbin/rabbitmq-webhooks
> 

> > Thanks!
> 

> > Jon Brisbin
> 
> > http// jbrisbin.com
> 

> > > From: "Peter Mezzina" < peter.mezzina at gmail.com >
> > 
> 
> > > To: rabbitmq-discuss at lists.rabbitmq.com
> > 
> 
> > > Sent: Thursday, July 28, 2011 12:20:13 PM
> > 
> 
> > > Subject: [rabbitmq-discuss] How to communicate with a CGI
> > > endpoint
> > > expecting an XML post
> > 
> 

> > > Would anyone know of an adapter for posting XML to an Apache HTTP
> > 
> 
> > > Server based CGI application? For example, how to get RabbitMQ to
> > > do
> > 
> 
> > > an HTTP post to a URL?
> > 
> 
> > > _______________________________________________
> > 
> 
> > > rabbitmq-discuss mailing list
> > 
> 
> > > rabbitmq-discuss at lists.rabbitmq.com
> > 
> 
> > > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > 
> 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110728/20a5b4b7/attachment.htm>

From christian.haintz at gmail.com  Thu Jul 28 23:45:40 2011
From: christian.haintz at gmail.com (Christian Haintz)
Date: Fri, 29 Jul 2011 00:45:40 +0200
Subject: [rabbitmq-discuss] Pika: Error when doing a stop_consuming() from a
	timeout callback
Message-ID: <4E31E694.7090304@gmail.com>

Hi,

I want to stop the consuming loop of a BlockingConnection after some 
timeout. I used the following code. Producer is not running because I
want to simulate the timeout. Current pika version is used from github.

--------8<--------- snip ----------8<-----------
import pika
connection = pika.BlockingConnection(pika.ConnectionParameters(
                                 host='localhost'))

channel = connection.channel()

result = channel.queue_declare(exclusive=True)
callback_queue = result.method.queue

def on_response(self, ch, method, props, body):
    #do some processing
    channel.stop_consuming()

# normaly i do some publish here but that's not relevant
# to reproduce the error

channel.basic_consume(on_response, no_ack=True,
    queue=callback_queue)

def panic():
    channel.stop_consuming()

connection.add_timeout(1, panic)
channel.start_consuming()

--------8<------- snip end --------8<-----------

But I get the following error:

--------8<--------- snip ----------8<-----------
$ python pika_test.py
/Users/christian/devel/pika/pika/callback.py:69: UserWarning: 
CallbackManager.add: Duplicate callback found for "1:Basic.CancelOk"
   (self.__class__.__name__, prefix, key))
Traceback (most recent call last):
   File "pika_test.py", line 21, in <module>
     channel.start_consuming()
   File 
"/Users/christian/devel/pika/pika/adapters/blocking_connection.py", line 
307, in start_consuming
     self.transport.connection.process_data_events()
   File 
"/Users/christian/devel/pika/pika/adapters/blocking_connection.py", line 
104, in process_data_events
     self.process_timeouts()
   File 
"/Users/christian/devel/pika/pika/adapters/blocking_connection.py", line 
164, in process_timeouts
     self._timeouts[timeout_id]['handler']()
   File "pika_test.py", line 18, in panic
     channel.stop_consuming()
   File 
"/Users/christian/devel/pika/pika/adapters/blocking_connection.py", line 
318, in stop_consuming
     self.basic_cancel(consumer_tag)
   File "/Users/christian/devel/pika/pika/channel.py", line 333, in 
basic_cancel
     self._on_cancel_ok, [spec.Basic.CancelOk])
   File 
"/Users/christian/devel/pika/pika/adapters/blocking_connection.py", line 
220, in rpc
     self.send_method(method, None, wait)
   File 
"/Users/christian/devel/pika/pika/adapters/blocking_connection.py", line 
249, in send_method
     self.connection.process_data_events()
   File 
"/Users/christian/devel/pika/pika/adapters/blocking_connection.py", line 
104, in process_data_events
     self.process_timeouts()
   File 
"/Users/christian/devel/pika/pika/adapters/blocking_connection.py", line 
164, in process_timeouts
     self._timeouts[timeout_id]['handler']()
   File "pika_test.py", line 18, in panic
     channel.stop_consuming()
   File 
"/Users/christian/devel/pika/pika/adapters/blocking_connection.py", line 
318, in stop_consuming
     self.basic_cancel(consumer_tag)
   File "/Users/christian/devel/pika/pika/channel.py", line 333, in 
basic_cancel
     self._on_cancel_ok, [spec.Basic.CancelOk])
   File 
"/Users/christian/devel/pika/pika/adapters/blocking_connection.py", line 
209, in rpc
     self._on_rpc_complete)
TypeError: 'NoneType' object is not iterable


What I am doing wrong? Are the timeout callbacks not capable of stopping 
the consumer?


Regards,
Christian

From gmr at myyearbook.com  Thu Jul 28 23:54:45 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Thu, 28 Jul 2011 18:54:45 -0400
Subject: [rabbitmq-discuss] Pika: Error when doing a stop_consuming()
 from a timeout callback
In-Reply-To: <4E31E694.7090304@gmail.com>
References: <4E31E694.7090304@gmail.com>
Message-ID: <A4FFE086EF18458799387D124D38CBB5@myyearbook.com>



On Thursday, July 28, 2011 at 6:45 PM, Christian Haintz wrote:

> Hi,
> 
> I want to stop the consuming loop of a BlockingConnection after some 
> timeout. I used the following code. Producer is not running because I
> want to simulate the timeout. Current pika version is used from github.
I'd not consider the master branch on Pika stable, which is one of the reasons I've not tagged 0.9.6. I'd do a pip install of 0.9.5 and see if that solves your problem. 

Gavin

> 
> --------8<--------- snip ----------8<-----------
> import pika
> connection = pika.BlockingConnection(pika.ConnectionParameters(
>  host='localhost'))
> 
> channel = connection.channel()
> 
> result = channel.queue_declare(exclusive=True)
> callback_queue = result.method.queue
> 
> def on_response(self, ch, method, props, body):
>  #do some processing
>  channel.stop_consuming()
> 
> # normaly i do some publish here but that's not relevant
> # to reproduce the error
> 
> channel.basic_consume(on_response, no_ack=True,
>  queue=callback_queue)
> 
> def panic():
>  channel.stop_consuming()
> 
> connection.add_timeout(1, panic)
> channel.start_consuming()
> 
> --------8<------- snip end --------8<-----------
> 
> But I get the following error:
> 
> --------8<--------- snip ----------8<-----------
> $ python pika_test.py
> /Users/christian/devel/pika/pika/callback.py:69: UserWarning: 
> CallbackManager.add: Duplicate callback found for "1:Basic.CancelOk"
>  (self.__class__.__name__, prefix, key))
> Traceback (most recent call last):
>  File "pika_test.py", line 21, in <module>
>  channel.start_consuming()
>  File 
> "/Users/christian/devel/pika/pika/adapters/blocking_connection.py", line 
> 307, in start_consuming
>  self.transport.connection.process_data_events()
>  File 
> "/Users/christian/devel/pika/pika/adapters/blocking_connection.py", line 
> 104, in process_data_events
>  self.process_timeouts()
>  File 
> "/Users/christian/devel/pika/pika/adapters/blocking_connection.py", line 
> 164, in process_timeouts
>  self._timeouts[timeout_id]['handler']()
>  File "pika_test.py", line 18, in panic
>  channel.stop_consuming()
>  File 
> "/Users/christian/devel/pika/pika/adapters/blocking_connection.py", line 
> 318, in stop_consuming
>  self.basic_cancel(consumer_tag)
>  File "/Users/christian/devel/pika/pika/channel.py", line 333, in 
> basic_cancel
>  self._on_cancel_ok, [spec.Basic.CancelOk])
>  File 
> "/Users/christian/devel/pika/pika/adapters/blocking_connection.py", line 
> 220, in rpc
>  self.send_method(method, None, wait)
>  File 
> "/Users/christian/devel/pika/pika/adapters/blocking_connection.py", line 
> 249, in send_method
>  self.connection.process_data_events()
>  File 
> "/Users/christian/devel/pika/pika/adapters/blocking_connection.py", line 
> 104, in process_data_events
>  self.process_timeouts()
>  File 
> "/Users/christian/devel/pika/pika/adapters/blocking_connection.py", line 
> 164, in process_timeouts
>  self._timeouts[timeout_id]['handler']()
>  File "pika_test.py", line 18, in panic
>  channel.stop_consuming()
>  File 
> "/Users/christian/devel/pika/pika/adapters/blocking_connection.py", line 
> 318, in stop_consuming
>  self.basic_cancel(consumer_tag)
>  File "/Users/christian/devel/pika/pika/channel.py", line 333, in 
> basic_cancel
>  self._on_cancel_ok, [spec.Basic.CancelOk])
>  File 
> "/Users/christian/devel/pika/pika/adapters/blocking_connection.py", line 
> 209, in rpc
>  self._on_rpc_complete)
> TypeError: 'NoneType' object is not iterable
> 
> 
> What I am doing wrong? Are the timeout callbacks not capable of stopping 
> the consumer?
> 
> 
> Regards,
> Christian
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110728/142a88f7/attachment.htm>

From christian.haintz at gmail.com  Fri Jul 29 00:04:06 2011
From: christian.haintz at gmail.com (Christian Haintz)
Date: Fri, 29 Jul 2011 01:04:06 +0200
Subject: [rabbitmq-discuss] Pika: Error when doing a stop_consuming()
 from a timeout callback
In-Reply-To: <A4FFE086EF18458799387D124D38CBB5@myyearbook.com>
References: <4E31E694.7090304@gmail.com>
	<A4FFE086EF18458799387D124D38CBB5@myyearbook.com>
Message-ID: <4E31EAE6.3080305@gmail.com>

On 29/7/11 24:54, Gavin M. Roy wrote:
>
> On Thursday, July 28, 2011 at 6:45 PM, Christian Haintz wrote:
>
>> Hi,
>>
>> I want to stop the consuming loop of a BlockingConnection after some
>> timeout. I used the following code. Producer is not running because I
>> want to simulate the timeout. Current pika version is used from github.
> I'd not consider the master branch on Pika stable, which is one of the
> reasons I've not tagged 0.9.6. I'd do a pip install of 0.9.5 and see if
> that solves your problem.
>
> Gavin
>

I tried it first with 0.9.5 but that leads to a different error which 
seams to be fixed in the master branch (used the same test code as in 
the previous e-mail):

--------8<--------- snip ----------8<-----------
python pika_test.py
Traceback (most recent call last):
   File "pika_test.py", line 21, in <module>
     channel.start_consuming()
   File 
"build/bdist.macosx-10.6-universal/egg/pika/adapters/blocking_connection.py", 
line 293, in start_consuming
   File 
"build/bdist.macosx-10.6-universal/egg/pika/adapters/blocking_connection.py", 
line 103, in process_data_events
   File 
"build/bdist.macosx-10.6-universal/egg/pika/adapters/blocking_connection.py", 
line 157, in process_timeouts
NameError: global name 'log' is not defined
--------8<------- snip end --------8<-----------

Best Regards,
Christian


>>
>> --------8<--------- snip ----------8<-----------
>> import pika
>> connection = pika.BlockingConnection(pika.ConnectionParameters(
>> host='localhost'))
>>
>> channel = connection.channel()
>>
>> result = channel.queue_declare(exclusive=True)
>> callback_queue = result.method.queue
>>
>> def on_response(self, ch, method, props, body):
>> #do some processing
>> channel.stop_consuming()
>>
>> # normaly i do some publish here but that's not relevant
>> # to reproduce the error
>>
>> channel.basic_consume(on_response, no_ack=True,
>> queue=callback_queue)
>>
>> def panic():
>> channel.stop_consuming()
>>
>> connection.add_timeout(1, panic)
>> channel.start_consuming()
>>
>> --------8<------- snip end --------8<-----------
>>
>> But I get the following error:
>>
>> --------8<--------- snip ----------8<-----------
>> $ python pika_test.py
>> /Users/christian/devel/pika/pika/callback.py:69: UserWarning:
>> CallbackManager.add: Duplicate callback found for "1:Basic.CancelOk"
>> (self.__class__.__name__, prefix, key))
>> Traceback (most recent call last):
>> File "pika_test.py", line 21, in <module>
>> channel.start_consuming()
>> File
>> "/Users/christian/devel/pika/pika/adapters/blocking_connection.py", line
>> 307, in start_consuming
>> self.transport.connection.process_data_events()
>> File
>> "/Users/christian/devel/pika/pika/adapters/blocking_connection.py", line
>> 104, in process_data_events
>> self.process_timeouts()
>> File
>> "/Users/christian/devel/pika/pika/adapters/blocking_connection.py", line
>> 164, in process_timeouts
>> self._timeouts[timeout_id]['handler']()
>> File "pika_test.py", line 18, in panic
>> channel.stop_consuming()
>> File
>> "/Users/christian/devel/pika/pika/adapters/blocking_connection.py", line
>> 318, in stop_consuming
>> self.basic_cancel(consumer_tag)
>> File "/Users/christian/devel/pika/pika/channel.py", line 333, in
>> basic_cancel
>> self._on_cancel_ok, [spec.Basic.CancelOk])
>> File
>> "/Users/christian/devel/pika/pika/adapters/blocking_connection.py", line
>> 220, in rpc
>> self.send_method(method, None, wait)
>> File
>> "/Users/christian/devel/pika/pika/adapters/blocking_connection.py", line
>> 249, in send_method
>> self.connection.process_data_events()
>> File
>> "/Users/christian/devel/pika/pika/adapters/blocking_connection.py", line
>> 104, in process_data_events
>> self.process_timeouts()
>> File
>> "/Users/christian/devel/pika/pika/adapters/blocking_connection.py", line
>> 164, in process_timeouts
>> self._timeouts[timeout_id]['handler']()
>> File "pika_test.py", line 18, in panic
>> channel.stop_consuming()
>> File
>> "/Users/christian/devel/pika/pika/adapters/blocking_connection.py", line
>> 318, in stop_consuming
>> self.basic_cancel(consumer_tag)
>> File "/Users/christian/devel/pika/pika/channel.py", line 333, in
>> basic_cancel
>> self._on_cancel_ok, [spec.Basic.CancelOk])
>> File
>> "/Users/christian/devel/pika/pika/adapters/blocking_connection.py", line
>> 209, in rpc
>> self._on_rpc_complete)
>> TypeError: 'NoneType' object is not iterable
>>
>>
>> What I am doing wrong? Are the timeout callbacks not capable of stopping
>> the consumer?
>>
>>
>> Regards,
>> Christian
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


From gmr at myyearbook.com  Fri Jul 29 00:05:44 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Thu, 28 Jul 2011 19:05:44 -0400
Subject: [rabbitmq-discuss] Pika: Error when doing a stop_consuming()
 from a timeout callback
In-Reply-To: <4E31EAE6.3080305@gmail.com>
References: <4E31E694.7090304@gmail.com>
	<A4FFE086EF18458799387D124D38CBB5@myyearbook.com>
	<4E31EAE6.3080305@gmail.com>
Message-ID: <BAA61C5E3C344A9BBA1E1542CA95FECD@myyearbook.com>

I'll take a look shortly, mind opening a issue on github for me to track with? 


On Thursday, July 28, 2011 at 7:04 PM, Christian Haintz wrote:

> On 29/7/11 24:54, Gavin M. Roy wrote:
> > 
> > On Thursday, July 28, 2011 at 6:45 PM, Christian Haintz wrote:
> > 
> > > Hi,
> > > 
> > > I want to stop the consuming loop of a BlockingConnection after some
> > > timeout. I used the following code. Producer is not running because I
> > > want to simulate the timeout. Current pika version is used from github.
> > I'd not consider the master branch on Pika stable, which is one of the
> > reasons I've not tagged 0.9.6. I'd do a pip install of 0.9.5 and see if
> > that solves your problem.
> > 
> > Gavin
> 
> I tried it first with 0.9.5 but that leads to a different error which 
> seams to be fixed in the master branch (used the same test code as in 
> the previous e-mail):
> 
> --------8<--------- snip ----------8<-----------
> python pika_test.py
> Traceback (most recent call last):
>  File "pika_test.py", line 21, in <module>
>  channel.start_consuming()
>  File 
> "build/bdist.macosx-10.6-universal/egg/pika/adapters/blocking_connection.py", 
> line 293, in start_consuming
>  File 
> "build/bdist.macosx-10.6-universal/egg/pika/adapters/blocking_connection.py", 
> line 103, in process_data_events
>  File 
> "build/bdist.macosx-10.6-universal/egg/pika/adapters/blocking_connection.py", 
> line 157, in process_timeouts
> NameError: global name 'log' is not defined
> --------8<------- snip end --------8<-----------
> 
> Best Regards,
> Christian
> 
> 
> > > 
> > > --------8<--------- snip ----------8<-----------
> > > import pika
> > > connection = pika.BlockingConnection(pika.ConnectionParameters(
> > > host='localhost'))
> > > 
> > > channel = connection.channel()
> > > 
> > > result = channel.queue_declare(exclusive=True)
> > > callback_queue = result.method.queue
> > > 
> > > def on_response(self, ch, method, props, body):
> > > #do some processing
> > > channel.stop_consuming()
> > > 
> > > # normaly i do some publish here but that's not relevant
> > > # to reproduce the error
> > > 
> > > channel.basic_consume(on_response, no_ack=True,
> > > queue=callback_queue)
> > > 
> > > def panic():
> > > channel.stop_consuming()
> > > 
> > > connection.add_timeout(1, panic)
> > > channel.start_consuming()
> > > 
> > > --------8<------- snip end --------8<-----------
> > > 
> > > But I get the following error:
> > > 
> > > --------8<--------- snip ----------8<-----------
> > > $ python pika_test.py
> > > /Users/christian/devel/pika/pika/callback.py:69: UserWarning:
> > > CallbackManager.add: Duplicate callback found for "1:Basic.CancelOk"
> > > (self.__class__.__name__, prefix, key))
> > > Traceback (most recent call last):
> > > File "pika_test.py", line 21, in <module>
> > > channel.start_consuming()
> > > File
> > > "/Users/christian/devel/pika/pika/adapters/blocking_connection.py", line
> > > 307, in start_consuming
> > > self.transport.connection.process_data_events()
> > > File
> > > "/Users/christian/devel/pika/pika/adapters/blocking_connection.py", line
> > > 104, in process_data_events
> > > self.process_timeouts()
> > > File
> > > "/Users/christian/devel/pika/pika/adapters/blocking_connection.py", line
> > > 164, in process_timeouts
> > > self._timeouts[timeout_id]['handler']()
> > > File "pika_test.py", line 18, in panic
> > > channel.stop_consuming()
> > > File
> > > "/Users/christian/devel/pika/pika/adapters/blocking_connection.py", line
> > > 318, in stop_consuming
> > > self.basic_cancel(consumer_tag)
> > > File "/Users/christian/devel/pika/pika/channel.py", line 333, in
> > > basic_cancel
> > > self._on_cancel_ok, [spec.Basic.CancelOk])
> > > File
> > > "/Users/christian/devel/pika/pika/adapters/blocking_connection.py", line
> > > 220, in rpc
> > > self.send_method(method, None, wait)
> > > File
> > > "/Users/christian/devel/pika/pika/adapters/blocking_connection.py", line
> > > 249, in send_method
> > > self.connection.process_data_events()
> > > File
> > > "/Users/christian/devel/pika/pika/adapters/blocking_connection.py", line
> > > 104, in process_data_events
> > > self.process_timeouts()
> > > File
> > > "/Users/christian/devel/pika/pika/adapters/blocking_connection.py", line
> > > 164, in process_timeouts
> > > self._timeouts[timeout_id]['handler']()
> > > File "pika_test.py", line 18, in panic
> > > channel.stop_consuming()
> > > File
> > > "/Users/christian/devel/pika/pika/adapters/blocking_connection.py", line
> > > 318, in stop_consuming
> > > self.basic_cancel(consumer_tag)
> > > File "/Users/christian/devel/pika/pika/channel.py", line 333, in
> > > basic_cancel
> > > self._on_cancel_ok, [spec.Basic.CancelOk])
> > > File
> > > "/Users/christian/devel/pika/pika/adapters/blocking_connection.py", line
> > > 209, in rpc
> > > self._on_rpc_complete)
> > > TypeError: 'NoneType' object is not iterable
> > > 
> > > 
> > > What I am doing wrong? Are the timeout callbacks not capable of stopping
> > > the consumer?
> > > 
> > > 
> > > Regards,
> > > Christian
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> > > <mailto:rabbitmq-discuss at lists.rabbitmq.com>
> > > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110728/4cc90584/attachment.htm>

From christian.haintz at gmail.com  Fri Jul 29 00:10:10 2011
From: christian.haintz at gmail.com (Christian Haintz)
Date: Fri, 29 Jul 2011 01:10:10 +0200
Subject: [rabbitmq-discuss] Pika: Error when doing a stop_consuming()
 from a timeout callback
In-Reply-To: <BAA61C5E3C344A9BBA1E1542CA95FECD@myyearbook.com>
References: <4E31E694.7090304@gmail.com>
	<A4FFE086EF18458799387D124D38CBB5@myyearbook.com>
	<4E31EAE6.3080305@gmail.com>
	<BAA61C5E3C344A9BBA1E1542CA95FECD@myyearbook.com>
Message-ID: <4E31EC52.6000705@gmail.com>

On 29/7/11 1:05, Gavin M. Roy wrote:
> I'll take a look shortly, mind opening a issue on github for me to track
> with?

Opened an issue on github (https://github.com/pika/pika/issues/75)

Thank you for your help!

Best Regards,
Christian


>
> On Thursday, July 28, 2011 at 7:04 PM, Christian Haintz wrote:
>
>> On 29/7/11 24:54, Gavin M. Roy wrote:
>>>
>>> On Thursday, July 28, 2011 at 6:45 PM, Christian Haintz wrote:
>>>
>>>> Hi,
>>>>
>>>> I want to stop the consuming loop of a BlockingConnection after some
>>>> timeout. I used the following code. Producer is not running because I
>>>> want to simulate the timeout. Current pika version is used from github.
>>> I'd not consider the master branch on Pika stable, which is one of the
>>> reasons I've not tagged 0.9.6. I'd do a pip install of 0.9.5 and see if
>>> that solves your problem.
>>>
>>> Gavin
>>
>> I tried it first with 0.9.5 but that leads to a different error which
>> seams to be fixed in the master branch (used the same test code as in
>> the previous e-mail):
>>
>> --------8<--------- snip ----------8<-----------
>> python pika_test.py
>> Traceback (most recent call last):
>> File "pika_test.py", line 21, in <module>
>> channel.start_consuming()
>> File
>> "build/bdist.macosx-10.6-universal/egg/pika/adapters/blocking_connection.py",
>>
>> line 293, in start_consuming
>> File
>> "build/bdist.macosx-10.6-universal/egg/pika/adapters/blocking_connection.py",
>>
>> line 103, in process_data_events
>> File
>> "build/bdist.macosx-10.6-universal/egg/pika/adapters/blocking_connection.py",
>>
>> line 157, in process_timeouts
>> NameError: global name 'log' is not defined
>> --------8<------- snip end --------8<-----------
>>
>> Best Regards,
>> Christian
>>
>>
>>>
>>>     --------8<--------- snip ----------8<-----------
>>>     import pika
>>>     connection = pika.BlockingConnection(pika.ConnectionParameters(
>>>     host='localhost'))
>>>
>>>     channel = connection.channel()
>>>
>>>     result = channel.queue_declare(exclusive=True)
>>>     callback_queue = result.method.queue
>>>
>>>     def on_response(self, ch, method, props, body):
>>>     #do some processing
>>>     channel.stop_consuming()
>>>
>>>     # normaly i do some publish here but that's not relevant
>>>     # to reproduce the error
>>>
>>>     channel.basic_consume(on_response, no_ack=True,
>>>     queue=callback_queue)
>>>
>>>     def panic():
>>>     channel.stop_consuming()
>>>
>>>     connection.add_timeout(1, panic)
>>>     channel.start_consuming()
>>>
>>>     --------8<------- snip end --------8<-----------
>>>
>>>     But I get the following error:
>>>
>>>     --------8<--------- snip ----------8<-----------
>>>     $ python pika_test.py
>>>     /Users/christian/devel/pika/pika/callback.py:69: UserWarning:
>>>     CallbackManager.add: Duplicate callback found for "1:Basic.CancelOk"
>>>     (self.__class__.__name__, prefix, key))
>>>     Traceback (most recent call last):
>>>     File "pika_test.py", line 21, in <module>
>>>     channel.start_consuming()
>>>     File
>>>     "/Users/christian/devel/pika/pika/adapters/blocking_connection.py",
>>>     line
>>>     307, in start_consuming
>>>     self.transport.connection.process_data_events()
>>>     File
>>>     "/Users/christian/devel/pika/pika/adapters/blocking_connection.py",
>>>     line
>>>     104, in process_data_events
>>>     self.process_timeouts()
>>>     File
>>>     "/Users/christian/devel/pika/pika/adapters/blocking_connection.py",
>>>     line
>>>     164, in process_timeouts
>>>     self._timeouts[timeout_id]['handler']()
>>>     File "pika_test.py", line 18, in panic
>>>     channel.stop_consuming()
>>>     File
>>>     "/Users/christian/devel/pika/pika/adapters/blocking_connection.py",
>>>     line
>>>     318, in stop_consuming
>>>     self.basic_cancel(consumer_tag)
>>>     File "/Users/christian/devel/pika/pika/channel.py", line 333, in
>>>     basic_cancel
>>>     self._on_cancel_ok, [spec.Basic.CancelOk])
>>>     File
>>>     "/Users/christian/devel/pika/pika/adapters/blocking_connection.py",
>>>     line
>>>     220, in rpc
>>>     self.send_method(method, None, wait)
>>>     File
>>>     "/Users/christian/devel/pika/pika/adapters/blocking_connection.py",
>>>     line
>>>     249, in send_method
>>>     self.connection.process_data_events()
>>>     File
>>>     "/Users/christian/devel/pika/pika/adapters/blocking_connection.py",
>>>     line
>>>     104, in process_data_events
>>>     self.process_timeouts()
>>>     File
>>>     "/Users/christian/devel/pika/pika/adapters/blocking_connection.py",
>>>     line
>>>     164, in process_timeouts
>>>     self._timeouts[timeout_id]['handler']()
>>>     File "pika_test.py", line 18, in panic
>>>     channel.stop_consuming()
>>>     File
>>>     "/Users/christian/devel/pika/pika/adapters/blocking_connection.py",
>>>     line
>>>     318, in stop_consuming
>>>     self.basic_cancel(consumer_tag)
>>>     File "/Users/christian/devel/pika/pika/channel.py", line 333, in
>>>     basic_cancel
>>>     self._on_cancel_ok, [spec.Basic.CancelOk])
>>>     File
>>>     "/Users/christian/devel/pika/pika/adapters/blocking_connection.py",
>>>     line
>>>     209, in rpc
>>>     self._on_rpc_complete)
>>>     TypeError: 'NoneType' object is not iterable
>>>
>>>
>>>     What I am doing wrong? Are the timeout callbacks not capable of
>>>     stopping
>>>     the consumer?
>>>
>>>
>>>     Regards,
>>>     Christian
>>>     _______________________________________________
>>>     rabbitmq-discuss mailing list
>>>     rabbitmq-discuss at lists.rabbitmq.com
>>>     <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>>>     <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>>>     https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>


From bp at barryp.org  Fri Jul 29 05:53:03 2011
From: bp at barryp.org (Barry Pederson)
Date: Thu, 28 Jul 2011 21:53:03 -0700
Subject: [rabbitmq-discuss] Python amqplib 1.0.0
In-Reply-To: <CAM8fPiRCXV7Eaq75qe9Ej+yPVykT5MGMB-oAW5M53jS24mnf-g@mail.gmail.com>
References: <45BC93B0-8DB7-46AF-98AA-1D314D44309E@barryp.org>
	<CAM8fPiRCXV7Eaq75qe9Ej+yPVykT5MGMB-oAW5M53jS24mnf-g@mail.gmail.com>
Message-ID: <E98A240F-E449-47A7-8805-1BC2DADCDAF7@barryp.org>


On Jul 28, 2011, at 5:17 AM, Tony Garnock-Jones wrote:

> Congratulations and thanks Barry - your library's design was the original inspiration for aspects of the designs of both Pika and also the C libamqp. Both have drifted a little since then, but without seeing that the approach you took could have worked, I might never have tried it.


Thanks everybody, it's gratifying to hear that something you've worked on had some kind of positive impact - moved the ball a little farther long at least.  

   Cheers

	Barry

From ask at rabbitmq.com  Fri Jul 29 09:32:35 2011
From: ask at rabbitmq.com (Ask Solem)
Date: Fri, 29 Jul 2011 09:32:35 +0100
Subject: [rabbitmq-discuss] Python amqplib 1.0.0
In-Reply-To: <E98A240F-E449-47A7-8805-1BC2DADCDAF7@barryp.org>
References: <45BC93B0-8DB7-46AF-98AA-1D314D44309E@barryp.org>
	<CAM8fPiRCXV7Eaq75qe9Ej+yPVykT5MGMB-oAW5M53jS24mnf-g@mail.gmail.com>
	<E98A240F-E449-47A7-8805-1BC2DADCDAF7@barryp.org>
Message-ID: <B7EEF0C3-FCF2-478C-9C4B-33A6C4F52FA0@rabbitmq.com>


On 29 Jul 2011, at 05:53, Barry Pederson wrote:

> 
> On Jul 28, 2011, at 5:17 AM, Tony Garnock-Jones wrote:
> 
>> Congratulations and thanks Barry - your library's design was the original inspiration for aspects of the designs of both Pika and also the C libamqp. Both have drifted a little since then, but without seeing that the approach you took could have worked, I might never have tried it.
> 
> 
> Thanks everybody, it's gratifying to hear that something you've worked on had some kind of positive impact - moved the ball a little farther long at least.  
> 


Note that Celery uses amqplib!
Kombu patches in support for timeouts and the ability to wait
for events on multiple channels at once, also a lot of work
has been done to map out possible errors, to auto retry operations,
and automatically recover from lost connections.
It even works well in combination with eventlet/gevent.


py3k support is very good news, although I had been using that as an
excuse...

From steve at rabbitmq.com  Fri Jul 29 10:20:56 2011
From: steve at rabbitmq.com (Steve Powell)
Date: Fri, 29 Jul 2011 10:20:56 +0100
Subject: [rabbitmq-discuss] Consumer Callback
In-Reply-To: <32143565.post@talk.nabble.com>
References: <32103305.post@talk.nabble.com>
	<9E349AF4-25D2-4871-8E6E-ECF2528A25A9@rabbitmq.com>
	<32143565.post@talk.nabble.com>
Message-ID: <1C266D3D-0BD7-4422-ABA5-5DC944491D8A@rabbitmq.com>

Dear Fang,

Your scheme should work, although it might involve rather more threads than are necessary.  (I assume you are still using the QueueingConsumer and in the loop in your consumer threads you are calling QueueingConsumer.nextDelivery().)

This is fine, especially if you are going to do some work in the consumer threads that you cannot do directly in the Consumer.handleDelivery() method -- something that has to run on a separate thread from the Channel.

However, you only say that you are going to
> automatically retrieve the results

and I cannot tell what this might entail -- what do you do with the results when you retrieve them? At some point you are going to accumulate them and output something (I presume) and the Java question then arises about how you coordinate the threads you have to safely share this state and terminate correctly?  These questions cannot be easily divorced from the Consumer interface choices you make.

In your final client configuration (the application thread and the consumer thread) there are, of course, other threads in the Java Client.  Having a separate consumer thread cleanly separates the problems on the Consumer interface, but leaves you with the issue of coordinating application and consumer thread issues.  If the messages sent (application thread?) and received (consumer thread) are part of the same conversation, you are going to have to share state and synchronise the sending and receiving of messages.  That is why we produced the QueueingConsumer class in the first place.  This allows you to take the received messages only when you want to process them, and if this is part of the application thread you can request them whenever you want to devote time to processing them. You don't need another thread.

On the other hand, if your client is not an end-point in an application, but offers a service, then it might want to process received messages (and pass them on, say) independently of sending messages.  Then you multiple thread design seems appropriate: you want to process received messages as soon as they arrive, and not wait until the sender thread can spare some time.

Incidentally, the best book on multi-threaded programming in Java is probably still Goetz, et al.: Java Concurrency in Practice.

The System.currentTimeMillis() gives a (rough) measure of elapsed time (not CPU time) and so (by subtraction) can help you to measure how much time is spent waiting in a thread (or calling long-running stuff).  It is rough and ready, and intentionally independent of thread. CPU Time isn't really of interest here, since not a lot of CPU is being used -- most of the time is spent waiting, so elapsed time is the most interesting measure.

If you want more accurate measurements (provided the hardware can support it, which most can) you can use System.nanoTime() which returns the most accurate time point it can -- this is only to be used for measuring elapsed time -- and will allow you to measure really quite small intervals.

Regards,
Steve Powell  (a happy bunny)
----------some definitions from the SPD----------
Rigatoni n. A prime-ministerial grin.
Nigella n. The next bottle-size up from a Nebuchadnezzar.
Homily adv. Rather like a frenchman.

On 26 Jul 2011, at 22:33, fangbot wrote:

> 
> Hi Steve,
> Sorry, a few clarifications. First of all, yes, I am using the Java client.
> Also, when I say two threads, I meant two threads per box. Finally,
> getTimeMillis() = System.currentTimeMillis().
> Thanks again,
> -Fang
> -- 
> View this message in context: http://old.nabble.com/Consumer-Callback-tp32103305p32143565.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
and
> Thanks for the response. After reviewing some other posts on this forum,
> I've decided to use multithreading in order to achieve the behavior I'm
> looking for. Essentially, for every consumer, I create a new thread and
> inside the run() method, I am calling an infinite while loop in order to
> automatically retrieve the results. All of this is just to familiarize
> myself with how RabbitMQ works - in the future, I suspect that every client
> will run on a different machine and thus there will be only two threads max
> (the application thread and the consumer thread).
> 
> Another question - I am doing some performance testing on the messaging
> speeds, and my tests are roughly modeled after those in MulticastMain.
> However, I've noticed that to record the speeds, getTimeMillis() is being
> used. However, if there are other threads (outside of my process) that are
> also running, won't they throw off (i.e. increase) the recorded time since
> getTimeMillis() isn't thread-specific? Shouldn't something like
> ThreadMXBean.getCurrentThreadCPUTime() be used instead?
> 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110729/81de80e7/attachment.htm>

From cristofer.seccia at gmail.com  Fri Jul 29 12:05:50 2011
From: cristofer.seccia at gmail.com (Cristoforo Seccia)
Date: Fri, 29 Jul 2011 13:05:50 +0200
Subject: [rabbitmq-discuss] RabbitMQ + CEP
Message-ID: <CABzW0g5vsVTc0d3Wnj9G_UM7bLPx0ZENE+n4TqLfKcesEGoX3g@mail.gmail.com>

Hi All,
is there anyone who has used or is using RabbitMQ in conjunction with a CEP
engine, for example Esper. I know this should not be a problem but I can't
find (at least googling does not help me) any information or useful tips on
how to implement this kind of stuff. Thanks in advance. Cris.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110729/2c003818/attachment.htm>

From msteele at beringmedia.com  Fri Jul 29 14:25:55 2011
From: msteele at beringmedia.com (Mark Steele)
Date: Fri, 29 Jul 2011 09:25:55 -0400
Subject: [rabbitmq-discuss] rabbitmq-ha-test setup
In-Reply-To: <4E313BC4.2030703@rabbitmq.com>
References: <CAGJaRztG6BvuXH2V6vvDnAVd2P6RU3iTD9dxhjdvR8e5EzTHzw@mail.gmail.com>
	<4E313BC4.2030703@rabbitmq.com>
Message-ID: <CAH24rBO5+Vt-x3Y7t39uye59c=c=RZgnoW7vqAfQHe6JP_d+nQ@mail.gmail.com>

Out of curiosity, does the master election occur on a per queue basis or is
it cluster-wide?


From thecwin at gmail.com  Fri Jul 29 14:21:46 2011
From: thecwin at gmail.com (Cameron Harris)
Date: Fri, 29 Jul 2011 14:21:46 +0100
Subject: [rabbitmq-discuss] channel.flow calls causing code 541
	INTERNAL_ERROR
Message-ID: <CABfOskHMX_L7uQXV+owjHAE6Hmb5ynNYQ0dWPASd9rfDBXNDzw@mail.gmail.com>

Hi all,

I have a process that consumes from a queue with BasicConsume, but if
there is a problem on the consumer that slows down message processing,
RabbitMQ will carry on delivering messages until the process runs out
of memory and crashes. In order to fix this, I created a second thread
that watches for too many messages building up in the client and calls
ChannelFlow(false) on the channel. After the consumer catches up
again, it ChannelFlow(true) to re-enable the channel flow.

Unfortunately, since switching the broker to Windows Server 2008 and
upgrading both the server and client to 2.5.1, the broker is
occasionally terminating my connection on the ChannelFlow call. The
exception text from the .NET client is:

       The AMQP operation was interrupted: AMQP close-reason,
initiated by Peer, code=541, text="INTERNAL_ERROR", classId=0,
methodId=0, cause=

When I was running on RHEL 6 I didn?t experience any problems, but I
hadn?t tested it thoroughly, so it might just be less likely to occur
on that setup. The clients are all running on Windows and using the
.NET client.

When this error occurs, the following is logged on the RabbitMQ server log:


=ERROR REPORT==== 29-Jul-2011::13:25:28 ===
** Generic server <0.2462.52> terminating
** Last message in was {'$gen_cast',{method,{'channel.flow',false},none}}
** When Server state == {ch,running,rabbit_framing_amqp_0_9_1,1,<0.2459.52>,
                         <0.2461.52>,<0.2459.52>,undefined,
                         #Fun<rabbit_channel_sup.0.15412730>,none,
                         {set,0,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                          {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                         4089,
                         {[],[]},
                         {[],[]},
                         {user,<<"guest">>,true,rabbit_auth_backend_internal,
                          {internal_user,<<"guest">>,
                           <<99,244,141,154,192,80,146,251,179,199,206,114,71,
                             177,54,91,30,76,32,168>>,
                           true}},
                         <<"/">>,<<"testq">>,
                         {dict,1,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                          {{[],[],[],[],[],[],[],[],[],[],[],
                            [[<<"amq.ctag-KeIdUjHd5LF+Zcti3NHf1A==">>|
                              {{amqqueue,
                                {resource,<<"/">>,queue,<<"testq">>},
                                false,false,none,[],<0.26681.51>},
                               #Ref<0.0.8.186885>}]],
                            [],[],[],[]}}},
                         {dict,0,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                          {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                         {dict,1,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                          {{[],
                            [[#Ref<0.0.8.186885>|
                              <<"amq.ctag-KeIdUjHd5LF+Zcti3NHf1A==">>]],
                            [],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                         <0.2457.52>,
                         {state,fine,{1311942332995907,#Ref<0.0.8.186868>}},
                         false,1,
                         {0,nil},
                         {0,nil},
                         [],
                         [{<<"basic.nack">>,bool,true},
                          {<<"publisher_confirms">>,bool,true},
                          {<<"consumer_cancel_notify">>,bool,true},
                          {<<"exchange_exchange_bindings">>,bool,true}],
                         none}
** Reason for termination ==
** {{badmatch,{error,already_present}},
    [{rabbit_channel_sup,'-start_limiter_fun/1-fun-0-',2},
     {rabbit_channel,start_limiter,1},
     {rabbit_channel,handle_method,3},
     {rabbit_channel,handle_cast,2},
     {gen_server2,handle_msg,2},
     {proc_lib,init_p_do_apply,3}]}



Here is the code I?m using that will trigger the error:


// ---------------------------- Start code ------------------------------------

using System;
using System.Threading;

using RabbitMQ.Client;

namespace test
{
    class Consumer : IBasicConsumer
    {
        private int count;

        public Consumer(IModel model) { this.Model = model; }

        public void HandleBasicConsumeOk(string consumerTag) { }
        public void HandleBasicCancelOk(string consumerTag) { }
        public void HandleBasicCancel(string consumerTag) { }
        public void HandleModelShutdown(IModel model,
ShutdownEventArgs reason) { }

        public void HandleBasicDeliver(string consumerTag, ulong
deliveryTag, bool redelivered, string exchange, string routingKey,
IBasicProperties properties, byte[] body)
        {
            Interlocked.Increment(ref count);
            if (count % 1000 == 0) Console.WriteLine("Consumed {0}", count);
        }

        public IModel Model { get; set; }

        public int Count { get { return count; } }
    }

    class Program
    {
        static void Main()
        {
            var cf = new ConnectionFactory
                {
                    HostName = "vmdevrmq1.apdev.local",
                    UserName = "guest",
                    Password = "guest",
                    Port = AmqpTcpEndpoint.UseDefaultPort
                };

            var conn = cf.CreateConnection();
            new Thread(
                x =>
                    {
                        var model = conn.CreateModel();
                        model.QueueDeclare("testq", false, false, false, null);

                        var props = model.CreateBasicProperties();
                        for (var i = 0; ; i++)
                        {
                            if (i % 1000 == 0)
                            {
                                Console.WriteLine("Published {0}", i);
                            }
                            model.BasicPublish("", "testq", false,
false, props, new byte[] { });
                        }
                    }).Start();

            var consumerModel = conn.CreateModel();
            consumerModel.QueueDeclare("testq", false, false, false, null);

            var consumer = new Consumer(consumerModel);
            consumerModel.BasicConsume("testq", true, null, consumer);

            bool flowEnabled = true;
            while (true)
            {
                flowEnabled = !flowEnabled;
                Console.WriteLine("Setting Channel Flow: {0}", flowEnabled);
                consumerModel.ChannelFlow(flowEnabled);
            }
        }
    }
}

// ---------------------------- End code ------------------------------------

I accept that this might be an error in my usage; in particular, the
way I?m calling ChannelFlow on my thread at the same time as consuming
on the connection thread, but I didn?t know how else to do it (doing
it from the connection thread in the consumer causes deadlocks), and
also I wouldn?t have expected an internal error. Another approach
would be explicit acks and basic.qos, but when it worked, the
ChannelFlow approach was much faster.

Thanks!
Cameron

From matthew at rabbitmq.com  Fri Jul 29 14:47:17 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 29 Jul 2011 14:47:17 +0100
Subject: [rabbitmq-discuss] rabbitmq-ha-test setup
In-Reply-To: <CAH24rBO5+Vt-x3Y7t39uye59c=c=RZgnoW7vqAfQHe6JP_d+nQ@mail.gmail.com>
References: <CAGJaRztG6BvuXH2V6vvDnAVd2P6RU3iTD9dxhjdvR8e5EzTHzw@mail.gmail.com>
	<4E313BC4.2030703@rabbitmq.com>
	<CAH24rBO5+Vt-x3Y7t39uye59c=c=RZgnoW7vqAfQHe6JP_d+nQ@mail.gmail.com>
Message-ID: <20110729134717.GF24507@rabbitmq.com>

On Fri, Jul 29, 2011 at 09:25:55AM -0400, Mark Steele wrote:
> Out of curiosity, does the master election occur on a per queue basis or is
> it cluster-wide?

Per queue. And it's not really master election. It's simply a list which
is appended to when new slaves join and removed from as people die. It's
done in such a way as to ensure that when the master dies, the new
master is the most likely to have been in the same state as the old
master.

> Mirrored queues are great, however there is still the thorny issue of being
> limited to the throughput of the master when you've got one queue that has
> lots of messages in it.
> 
> If the election process operates on a per queue basis, then it would be
> possible to declare multiple queues to the same exchange and effectively get
> load balanced usage of the cluster with all the goodness of high
> availability.

Slaves have to do almost as much work as the master, and there's much
greater communication overhead. Thus even though the design is async and
has been substantially tuned, you will find mirrored queues perform less
well than non-mirrored queues. At the end of the day, you just have to
do quite a lot more work and that'll take more time.

Matthew

From alexandru at rabbitmq.com  Fri Jul 29 14:49:54 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Fri, 29 Jul 2011 14:49:54 +0100
Subject: [rabbitmq-discuss] LATEST.LOG growth on clustered ram node
In-Reply-To: <BANLkTikHRU8bUZBgetW2=BYTH3yRg1RbQQ@mail.gmail.com>
References: <mailman.555.1308639242.2898.rabbitmq-discuss@lists.rabbitmq.com>
	<ABA42E48EC654326B9E2F059573DA9BE@gmail.com>
	<20110622102503.GB2780@rabbitmq.com>
	<4E01C5EB.3070504@rabbitmq.com>
	<BANLkTikHRU8bUZBgetW2=BYTH3yRg1RbQQ@mail.gmail.com>
Message-ID: <20110729134954.GC3277@dakota.eng.vmware.com>

Chris,

A fix for this has landed on default earlier today and should be in the
next release.

Basically, we re-enabled disk-less nodes.  So, 'ram' nodes will not have
any files on disk anymore.

Thanks for reporting the problem.

Cheers,
Alex

On Mon, Jun 27, 2011 at 09:55:26PM -0400, Chris Madden wrote:
> I've whipped up a pair of python scripts that demonstrate the issue.
>  They're using the queue-per-request anti-pattern, as that is what my
> production code is using  (if I can only get more time...)
> 
> My test environment is 2 ubuntu 11.04 server boxes with erlang R14b03.  I
> have no plugins on a clean install of rabbit 2.5.0.  There are  2 nodes in
> my cluster, A and B.  A is a disc node, B is a ram node.  I run echo.py on
> the ram node, and spew.py on the disc node.  Each python script connects to
> its local broker.  I'm using python-amqplib 0.6.1-1 for these scripts,
> though my production code is java based.  The "guest" account is set as an
> administrator on vhost /.  On my setup, the LATEST.LOG grows decently fast,
> maybe 15 meg an hour.
> 
> If there is something pathological in my scripts, I'd love to hear it
> (beyond the aforementioned anti-pattern)... it is entirely possible I'm not
> releasing a resource I guess.  Also, I'm using basic_get() as it avoids the
> complexity of threading logic in the example, in production I use consumers.
> 
> tarball md5 is 1591ebbb1e9cffa06e6aec1c1ecb7b1d
> 
> 
> 
> On Wed, Jun 22, 2011 at 6:37 AM, Matthias Radestock
> <matthias at rabbitmq.com>wrote:
> 
> > Chris,
> >
> >
> > On 22/06/11 11:25, Matthew Sackman wrote:
> >
> >> On Tue, Jun 21, 2011 at 11:18:36AM -0400, Chris Madden wrote:
> >>
> >>> I upgraded our erlang version to R14B03, but the LATEST.LOG still
> >>> continues to be growing, albeit, more slowly perhaps?
> >>>
> >>
> >> Curious.
> >>
> >
> > Are you sure that you haven't perhaps got a growing list of queues? Check
> > with 'rabbitmqctl list_queues'. Or, even better, use the fancy new
> > 'rabbitmqctl report' to produce a complete report of the server status and
> > send that to us.
> >
> >
> >  I'm kind of suspicious of one of the queue usage models I'm using.
> >>> When one of the processes needs to make a one-off request (rpc
> >>> like), it creates a queue dedicated to that request, and expects
> >>> the reply to come back on that queue.
> >>>
> >>
> > Generally, "queue per request" is a design anti pattern. Though if your
> > processes are short-lived and don't make many requests it's ok.
> >
> >
> > Matthias.
> >
> > ______________________________**_________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> > https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
> >


> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From matthew at rabbitmq.com  Fri Jul 29 14:51:06 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 29 Jul 2011 14:51:06 +0100
Subject: [rabbitmq-discuss] channel.flow calls causing code 541
 INTERNAL_ERROR
In-Reply-To: <CABfOskHMX_L7uQXV+owjHAE6Hmb5ynNYQ0dWPASd9rfDBXNDzw@mail.gmail.com>
References: <CABfOskHMX_L7uQXV+owjHAE6Hmb5ynNYQ0dWPASd9rfDBXNDzw@mail.gmail.com>
Message-ID: <20110729135106.GG24507@rabbitmq.com>

Hi,

On Fri, Jul 29, 2011 at 02:21:46PM +0100, Cameron Harris wrote:
> I have a process that consumes from a queue with BasicConsume, but if
> there is a problem on the consumer that slows down message processing,
> RabbitMQ will carry on delivering messages until the process runs out
> of memory and crashes. In order to fix this...

...you should just use basic.qos with a non-zero prefetch count.

> I created a second thread
> that watches for too many messages building up in the client and calls
> ChannelFlow(false) on the channel. After the consumer catches up
> again, it ChannelFlow(true) to re-enable the channel flow.
> 
> Unfortunately, since switching the broker to Windows Server 2008 and
> upgrading both the server and client to 2.5.1, the broker is
> occasionally terminating my connection on the ChannelFlow call. The
> exception text from the .NET client is:
> 
>        The AMQP operation was interrupted: AMQP close-reason,
> initiated by Peer, code=541, text="INTERNAL_ERROR", classId=0,
> methodId=0, cause=
> 
> When I was running on RHEL 6 I didn?t experience any problems, but I
> hadn?t tested it thoroughly, so it might just be less likely to occur
> on that setup. The clients are all running on Windows and using the
> .NET client.
>                          none}
> ** Reason for termination ==
> ** {{badmatch,{error,already_present}},
>     [{rabbit_channel_sup,'-start_limiter_fun/1-fun-0-',2},
>      {rabbit_channel,start_limiter,1},

That is odd, and does point to a bug in our code, I think... yes, we're
doing the wrong thing with our limiter.

Anyway, if you do just set a qos prefetch before consuming from the
queue, you'll find that'll solve the problem. I'll file a bug for the
other thing.

Matthew

From alexandru at rabbitmq.com  Fri Jul 29 14:53:23 2011
From: alexandru at rabbitmq.com (Alexandru Scvortov)
Date: Fri, 29 Jul 2011 14:53:23 +0100
Subject: [rabbitmq-discuss] LATEST.LOG growth on clustered ram node
In-Reply-To: <20110729134954.GC3277@dakota.eng.vmware.com>
References: <mailman.555.1308639242.2898.rabbitmq-discuss@lists.rabbitmq.com>
	<ABA42E48EC654326B9E2F059573DA9BE@gmail.com>
	<20110622102503.GB2780@rabbitmq.com>
	<4E01C5EB.3070504@rabbitmq.com>
	<BANLkTikHRU8bUZBgetW2=BYTH3yRg1RbQQ@mail.gmail.com>
	<20110729134954.GC3277@dakota.eng.vmware.com>
Message-ID: <20110729135323.GD3277@dakota.eng.vmware.com>

> Basically, we re-enabled disk-less nodes.  So, 'ram' nodes will not have
> any files on disk anymore.

'Ram' nodes will not have any *mnesia* files on disk anymore.  Message
store files will still be there.

Alex

On Fri, Jul 29, 2011 at 02:49:54PM +0100, Alexandru Scvor?ov wrote:
> Chris,
> 
> A fix for this has landed on default earlier today and should be in the
> next release.
> 
> Basically, we re-enabled disk-less nodes.  So, 'ram' nodes will not have
> any files on disk anymore.
> 
> Thanks for reporting the problem.
> 
> Cheers,
> Alex
> 
> On Mon, Jun 27, 2011 at 09:55:26PM -0400, Chris Madden wrote:
> > I've whipped up a pair of python scripts that demonstrate the issue.
> >  They're using the queue-per-request anti-pattern, as that is what my
> > production code is using  (if I can only get more time...)
> > 
> > My test environment is 2 ubuntu 11.04 server boxes with erlang R14b03.  I
> > have no plugins on a clean install of rabbit 2.5.0.  There are  2 nodes in
> > my cluster, A and B.  A is a disc node, B is a ram node.  I run echo.py on
> > the ram node, and spew.py on the disc node.  Each python script connects to
> > its local broker.  I'm using python-amqplib 0.6.1-1 for these scripts,
> > though my production code is java based.  The "guest" account is set as an
> > administrator on vhost /.  On my setup, the LATEST.LOG grows decently fast,
> > maybe 15 meg an hour.
> > 
> > If there is something pathological in my scripts, I'd love to hear it
> > (beyond the aforementioned anti-pattern)... it is entirely possible I'm not
> > releasing a resource I guess.  Also, I'm using basic_get() as it avoids the
> > complexity of threading logic in the example, in production I use consumers.
> > 
> > tarball md5 is 1591ebbb1e9cffa06e6aec1c1ecb7b1d
> > 
> > 
> > 
> > On Wed, Jun 22, 2011 at 6:37 AM, Matthias Radestock
> > <matthias at rabbitmq.com>wrote:
> > 
> > > Chris,
> > >
> > >
> > > On 22/06/11 11:25, Matthew Sackman wrote:
> > >
> > >> On Tue, Jun 21, 2011 at 11:18:36AM -0400, Chris Madden wrote:
> > >>
> > >>> I upgraded our erlang version to R14B03, but the LATEST.LOG still
> > >>> continues to be growing, albeit, more slowly perhaps?
> > >>>
> > >>
> > >> Curious.
> > >>
> > >
> > > Are you sure that you haven't perhaps got a growing list of queues? Check
> > > with 'rabbitmqctl list_queues'. Or, even better, use the fancy new
> > > 'rabbitmqctl report' to produce a complete report of the server status and
> > > send that to us.
> > >
> > >
> > >  I'm kind of suspicious of one of the queue usage models I'm using.
> > >>> When one of the processes needs to make a one-off request (rpc
> > >>> like), it creates a queue dedicated to that request, and expects
> > >>> the reply to come back on that queue.
> > >>>
> > >>
> > > Generally, "queue per request" is a design anti pattern. Though if your
> > > processes are short-lived and don't make many requests it's ok.
> > >
> > >
> > > Matthias.
> > >
> > > ______________________________**_________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> > > https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
> > >
> 
> 
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 

From msteele at beringmedia.com  Fri Jul 29 14:57:07 2011
From: msteele at beringmedia.com (Mark Steele)
Date: Fri, 29 Jul 2011 09:57:07 -0400
Subject: [rabbitmq-discuss] rabbitmq-ha-test setup
In-Reply-To: <20110729134717.GF24507@rabbitmq.com>
References: <CAGJaRztG6BvuXH2V6vvDnAVd2P6RU3iTD9dxhjdvR8e5EzTHzw@mail.gmail.com>
	<4E313BC4.2030703@rabbitmq.com>
	<CAH24rBO5+Vt-x3Y7t39uye59c=c=RZgnoW7vqAfQHe6JP_d+nQ@mail.gmail.com>
	<20110729134717.GF24507@rabbitmq.com>
Message-ID: <CAH24rBPHfHG-UbVEOGt=70SpJ4ypsa0OR7avZyMPa2AAd3ktYA@mail.gmail.com>

Hope springs eternal. I'm looking forward to the 'linear scale full blown
HA' feature that must be deep down somewhere in the roadmap.

Still, mirrored queues will be a welcome addition.

Cheers

M


On Fri, Jul 29, 2011 at 9:47 AM, Matthew Sackman <matthew at rabbitmq.com>wrote:

> On Fri, Jul 29, 2011 at 09:25:55AM -0400, Mark Steele wrote:
> > Out of curiosity, does the master election occur on a per queue basis or
> is
> > it cluster-wide?
>
> Per queue. And it's not really master election. It's simply a list which
> is appended to when new slaves join and removed from as people die. It's
> done in such a way as to ensure that when the master dies, the new
> master is the most likely to have been in the same state as the old
> master.
>
> > Mirrored queues are great, however there is still the thorny issue of
> being
> > limited to the throughput of the master when you've got one queue that
> has
> > lots of messages in it.
> >
> > If the election process operates on a per queue basis, then it would be
> > possible to declare multiple queues to the same exchange and effectively
> get
> > load balanced usage of the cluster with all the goodness of high
> > availability.
>
> Slaves have to do almost as much work as the master, and there's much
> greater communication overhead. Thus even though the design is async and
> has been substantially tuned, you will find mirrored queues perform less
> well than non-mirrored queues. At the end of the day, you just have to
> do quite a lot more work and that'll take more time.
>
> Matthew
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110729/5ac8b12e/attachment.htm>

From 214575002 at qq.com  Sun Jul 24 01:58:37 2011
From: 214575002 at qq.com (=?gbk?B?xr2zo9DEzKw=?=)
Date: Sun, 24 Jul 2011 08:58:37 +0800
Subject: [rabbitmq-discuss] =?gbk?b?fFNwYW18INeqt6KjulJlOiByYWJiaXRtcSBv?=
	=?gbk?q?verwriting_messages?=
Message-ID: <tencent_4B042BFC58871FCF4999A79F@qq.com>

ask for help.


 
------------------ ???? ------------------
???: "David Wragg"<david at rabbitmq.com>;
????: 2011?7?24?(???) ??4:42
???: "????"<214575002 at qq.com>; 
??: "legitimategrievance"<legitimategrievance at rabbitmq.com>; 
??: Re: rabbitmq overwriting messages

 
Hi,

"????" <214575002 at qq.com> writes:
> sorry to bother you all because the bug i report is not the bug of
> rabbitmq.  i use tcpdump to find out that the data transfered from
> both direction(send and recv) is right, but when i use the php pecl
> client function consume() to get the message, it is wrong!
>
>
> when i use the php pecl client function get(), it is ok!!!

I'm afraid we don't have any PHP experts on the rabbitmq team.  It might
be best to send this to the rabbitmq-discuss mailing list (see
<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>).
Some users of RabbitMQ with PHP seem to read that list, and might be
able to provide specific advice.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
VMware, Inc.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110724/f4239ca8/attachment.htm>

From matthew at rabbitmq.com  Fri Jul 29 15:01:26 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 29 Jul 2011 15:01:26 +0100
Subject: [rabbitmq-discuss] rabbitmq-ha-test setup
In-Reply-To: <CAH24rBPHfHG-UbVEOGt=70SpJ4ypsa0OR7avZyMPa2AAd3ktYA@mail.gmail.com>
References: <CAGJaRztG6BvuXH2V6vvDnAVd2P6RU3iTD9dxhjdvR8e5EzTHzw@mail.gmail.com>
	<4E313BC4.2030703@rabbitmq.com>
	<CAH24rBO5+Vt-x3Y7t39uye59c=c=RZgnoW7vqAfQHe6JP_d+nQ@mail.gmail.com>
	<20110729134717.GF24507@rabbitmq.com>
	<CAH24rBPHfHG-UbVEOGt=70SpJ4ypsa0OR7avZyMPa2AAd3ktYA@mail.gmail.com>
Message-ID: <20110729140126.GH24507@rabbitmq.com>

On Fri, Jul 29, 2011 at 09:57:07AM -0400, Mark Steele wrote:
> Hope springs eternal. I'm looking forward to the 'linear scale full blown
> HA' feature that must be deep down somewhere in the roadmap.

Well yes, once we have quantum computers, many impossible things will
become possible.

RAID 1 does not go faster for writes than a single disk, does it? Thus
neither will mirrored queues go faster for writes than a non-mirrored
queue.

Matthew

From thecwin at gmail.com  Fri Jul 29 16:39:08 2011
From: thecwin at gmail.com (Cameron Harris)
Date: Fri, 29 Jul 2011 16:39:08 +0100
Subject: [rabbitmq-discuss] channel.flow calls causing code 541
	INTERNAL_ERROR
Message-ID: <CABfOskGOYsvNDbHat5Cct7gwfz5V6xmLzr3v352RS6T95G19Eg@mail.gmail.com>

>?...you should just use basic.qos with a non-zero prefetch count.

basic.qos requires explicit acks, doesn't it? I found that using
basic.qos and explicit acks had a much lower throughput than
auto-acking + channel.flow.

> I'll file a bug for the other thing.

Thanks!

Cameron Harris

From matthew at rabbitmq.com  Fri Jul 29 16:41:14 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 29 Jul 2011 16:41:14 +0100
Subject: [rabbitmq-discuss] channel.flow calls causing code 541
	INTERNAL_ERROR
In-Reply-To: <CABfOskGOYsvNDbHat5Cct7gwfz5V6xmLzr3v352RS6T95G19Eg@mail.gmail.com>
References: <CABfOskGOYsvNDbHat5Cct7gwfz5V6xmLzr3v352RS6T95G19Eg@mail.gmail.com>
Message-ID: <20110729154114.GB29231@rabbitmq.com>

On Fri, Jul 29, 2011 at 04:39:08PM +0100, Cameron Harris wrote:
> >?...you should just use basic.qos with a non-zero prefetch count.
> 
> basic.qos requires explicit acks, doesn't it? I found that using
> basic.qos and explicit acks had a much lower throughput than
> auto-acking + channel.flow.

Ahh yes, that's true. I'd failed to spot that your code was using
noAck=true. What kind of throughput numbers are you after?


Matthew

From alexandru at rabbitmq.com  Fri Jul 29 16:50:57 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Fri, 29 Jul 2011 16:50:57 +0100
Subject: [rabbitmq-discuss] channel.flow calls causing code 541
 INTERNAL_ERROR
In-Reply-To: <CABfOskGOYsvNDbHat5Cct7gwfz5V6xmLzr3v352RS6T95G19Eg@mail.gmail.com>
References: <CABfOskGOYsvNDbHat5Cct7gwfz5V6xmLzr3v352RS6T95G19Eg@mail.gmail.com>
Message-ID: <20110729155057.GG3277@dakota.eng.vmware.com>

> > I'll file a bug for the other thing.
> 
> Thanks!

This has been fixed on a bug branch (bug24285 if you're curious) and is
pending QA.  With a bit of luck, it should be in the next release.

Cheers,
Alex

On Fri, Jul 29, 2011 at 04:39:08PM +0100, Cameron Harris wrote:
> >?...you should just use basic.qos with a non-zero prefetch count.
> 
> basic.qos requires explicit acks, doesn't it? I found that using
> basic.qos and explicit acks had a much lower throughput than
> auto-acking + channel.flow.
> 
> > I'll file a bug for the other thing.
> 
> Thanks!
> 
> Cameron Harris
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From thecwin at gmail.com  Fri Jul 29 16:57:15 2011
From: thecwin at gmail.com (Cameron Harris)
Date: Fri, 29 Jul 2011 16:57:15 +0100
Subject: [rabbitmq-discuss] channel.flow calls causing code 541
	INTERNAL_ERROR
In-Reply-To: <CABfOskGOYsvNDbHat5Cct7gwfz5V6xmLzr3v352RS6T95G19Eg@mail.gmail.com>
References: <CABfOskGOYsvNDbHat5Cct7gwfz5V6xmLzr3v352RS6T95G19Eg@mail.gmail.com>
Message-ID: <CABfOskEN18WvD4wm-FEfkezncfgqQva+0Fv6oF5oApNCD_p05A@mail.gmail.com>

On 29 July 2011 16:41, Matthew Sackman <matthew at rabbitmq.com> wrote:
> Ahh yes, that's true. I'd failed to spot that your code was using
> noAck=true. What kind of throughput numbers are you after?

Varies from app to app, but for certain things, we're after as high
throughput as we can get on our hardware (f.ex. at least 50 000 per
second for one of our applications). The lower the messages
throughput, the more complicated our client code needs to be, so we're
trying to get throughput as high as we can on our hardware.

Cameron

From matthew at rabbitmq.com  Fri Jul 29 17:01:15 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 29 Jul 2011 17:01:15 +0100
Subject: [rabbitmq-discuss] channel.flow calls causing code 541
	INTERNAL_ERROR
In-Reply-To: <CABfOskEN18WvD4wm-FEfkezncfgqQva+0Fv6oF5oApNCD_p05A@mail.gmail.com>
References: <CABfOskGOYsvNDbHat5Cct7gwfz5V6xmLzr3v352RS6T95G19Eg@mail.gmail.com>
	<CABfOskEN18WvD4wm-FEfkezncfgqQva+0Fv6oF5oApNCD_p05A@mail.gmail.com>
Message-ID: <20110729160114.GC29231@rabbitmq.com>

On Fri, Jul 29, 2011 at 04:57:15PM +0100, Cameron Harris wrote:
> Varies from app to app, but for certain things, we're after as high
> throughput as we can get on our hardware (f.ex. at least 50 000 per
> second for one of our applications). The lower the messages
> throughput, the more complicated our client code needs to be, so we're
> trying to get throughput as high as we can on our hardware.

Interesting - ok, yes, that certainly is sufficiently high as to be
beyond the capability of rabbit on non-exotic hardware with acks turned
on. Ultimately you'll find that a single queue will become your
bottleneck as queues are individually single-threaded. Thus you might
find that you can scale better by having multiple queues for the same
purpose and spreading your publishes across them. Of course, you need to
be careful about which ordering guarantees you may start to lose...

Matthew

From hedelson at vmware.com  Fri Jul 29 19:00:39 2011
From: hedelson at vmware.com (Helena Edelson)
Date: Fri, 29 Jul 2011 11:00:39 -0700
Subject: [rabbitmq-discuss] Message payload encoding
Message-ID: <BDE140BF4C952041931EF8CAAC83341D026B6B8D70@exch-mbx-111.vmware.com>

Is there a preference, as in performance or other reason (please specify if so) for a message payload to be encoded for Rabbit as UTF-8 or base64?
I have been doing UTF-8; just curious. 

Thanks,
Helena  

From mpollack at vmware.com  Fri Jul 29 20:50:23 2011
From: mpollack at vmware.com (Mark Pollack)
Date: Fri, 29 Jul 2011 12:50:23 -0700 (PDT)
Subject: [rabbitmq-discuss] running rabbitmqadmin CLI on windows 7
Message-ID: <03e801cc4e28$c39bd590$4ad380b0$@vmware.com>

Hi,

 

I've gotten the following error trying to run the rabbitmqadmin python
script on windows 7.  I've installed python-3.2.1.msi (32bit)

 

C:\Users\mpollack>rabbitmqadmin.py

  File "C:\software\bin\rabbitmqadmin.py", line 206

    print maybe_utf8(s, sys.stdout)

                   ^

SyntaxError: invalid syntax

 

 

Any tips?

 

Thanks,

Mark

 

 

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110729/857aed4b/attachment.htm>

From bryanalves at gmail.com  Fri Jul 29 21:27:04 2011
From: bryanalves at gmail.com (Bryan Alves)
Date: Fri, 29 Jul 2011 16:27:04 -0400
Subject: [rabbitmq-discuss] running rabbitmqadmin CLI on windows 7
In-Reply-To: <03e801cc4e28$c39bd590$4ad380b0$@vmware.com>
References: <03e801cc4e28$c39bd590$4ad380b0$@vmware.com>
Message-ID: <CAGErLKX907Muig-ui5iAhyxH7PofHY+M-nChDKdHk=LqP2YbNw@mail.gmail.com>

That print statement is python 2 syntax. Get python 2 installed instead of
python 3.
On Jul 29, 2011 3:51 PM, "Mark Pollack" <mpollack at vmware.com> wrote:
> Hi,
>
>
>
> I've gotten the following error trying to run the rabbitmqadmin python
> script on windows 7. I've installed python-3.2.1.msi (32bit)
>
>
>
> C:\Users\mpollack>rabbitmqadmin.py
>
> File "C:\software\bin\rabbitmqadmin.py", line 206
>
> print maybe_utf8(s, sys.stdout)
>
> ^
>
> SyntaxError: invalid syntax
>
>
>
>
>
> Any tips?
>
>
>
> Thanks,
>
> Mark
>
>
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110729/49f7e4a2/attachment.htm>

From justin.adam.miller at gmail.com  Fri Jul 29 19:30:57 2011
From: justin.adam.miller at gmail.com (justin.adam.miller at gmail.com)
Date: Fri, 29 Jul 2011 11:30:57 -0700 (PDT)
Subject: [rabbitmq-discuss] single broker and queue scalability question
Message-ID: <b84336ff-df0e-4f2f-a0ef-cc489d53520a@f20g2000yqm.googlegroups.com>

I have an app that will have, at any one time, < 500 connections to a
single broker, across multiple machines, all of whom I want as
consumers of one queue so that rabbit can load balance amongst them.

Is handling so few connections/consumers a joke for rabbit? Should I
consider clustering, and if so, what does clustering buy me in this
case? The one thing I don't love about clustering is that, without
active/passive failover, the node that declares the queue is a single
point of failure.

The idea of clustering along with multiple queues bound to one
exchange is appealing (since exchange and binding information is
replicated across the cluster), but rabbit will not round robin
messages to all the bound queues -- there's no exchange type (that I
know of) that has that behavior.

If I knew the bound queues ahead of time, then I could pick one at
random, but it seems like determining that queue would be cumbersome,
inefficient and/or costly at best.

Thanks,
Justin

From peter at ohler.com  Sat Jul 30 03:12:25 2011
From: peter at ohler.com (Peter Ohler)
Date: Sat, 30 Jul 2011 11:12:25 +0900
Subject: [rabbitmq-discuss] Message payload encoding
In-Reply-To: <BDE140BF4C952041931EF8CAAC83341D026B6B8D70@exch-mbx-111.vmware.com>
References: <BDE140BF4C952041931EF8CAAC83341D026B6B8D70@exch-mbx-111.vmware.com>
Message-ID: <AC22A5D6-03C9-41C3-85A0-4334D611D2A9@ohler.com>

If you don't mind I will take a shot at that one.

There are a few consideration that should be looked at. It is often the case that message size is not the most significant factor in performance, especially if the message size is small. Consider what it is you are sending. If it is a UTF-8 string then sending the string directly takes no preparation and is smaller than base64 encoding which also incurs and overhead in serialization and deserialization.

If what you are sending is an Java, Python, or Ruby object then there will be significant overhead in the serialization itself. For Ruby I wrote a fast object to XML serializer (Ox gem) that is much faster than the native Marshal encoding and that alone improved performance of our systems significantly.

Something else worth considering besides is how difficult it will be to debug and trace message exchanges. A binary format or base64 requires extra decoding to see what is in the body of a message while UTF-8 strings or XML can be viewed and understood directly. That is a real time saver during development and even in production when trying to fix a problem quickly.

-Pete

On Jul 30, 2011, at 3:00 AM, Helena Edelson wrote:

> Is there a preference, as in performance or other reason (please specify if so) for a message payload to be encoded for Rabbit as UTF-8 or base64?
> I have been doing UTF-8; just curious. 
> 
> Thanks,
> Helena  
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From datasprout.io at gmail.com  Sat Jul 30 08:34:24 2011
From: datasprout.io at gmail.com (drew)
Date: Sat, 30 Jul 2011 00:34:24 -0700 (PDT)
Subject: [rabbitmq-discuss] Plugins fail to load
Message-ID: <de4452b4-bfef-4572-9c4c-b1ec77442816@r11g2000prd.googlegroups.com>

Hi guys,

Having problems loading plugins on ubuntu 11.04 with rabbitmq 2.5.1

I've put all the required files for the management plugin into /usr/
lib/rabbitmq/lib/rabbitmq_server-2.5.1/plugins and restarted rabbitmq.
However no plugins are loaded and there is no mention of plugins being
loaded in the log files.

I can't find any further documentation explaining if plugins need to
be registered etc, what am I missing?

Thanks,

Drew.

From matthew at rabbitmq.com  Sat Jul 30 14:43:35 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Sat, 30 Jul 2011 14:43:35 +0100
Subject: [rabbitmq-discuss] Plugins fail to load
In-Reply-To: <de4452b4-bfef-4572-9c4c-b1ec77442816@r11g2000prd.googlegroups.com>
References: <de4452b4-bfef-4572-9c4c-b1ec77442816@r11g2000prd.googlegroups.com>
Message-ID: <20110730134334.GD17234@wellquite.org>

On Sat, Jul 30, 2011 at 12:34:24AM -0700, drew wrote:
> I've put all the required files for the management plugin into /usr/
> lib/rabbitmq/lib/rabbitmq_server-2.5.1/plugins and restarted rabbitmq.
> However no plugins are loaded and there is no mention of plugins being
> loaded in the log files.

Which plugins are you trying to install? Which files have you placed in
the plugins directory? What does the startup log say? In particular,
there should be lines that look a bit like:

Copyright (C) 2007-2011 VMware, Inc.
Licensed under the MPL.  See http://www.rabbitmq.com/

node           : rabbit at koba
app descriptor :
/home/matthew/rabbitmq-umbrella/rabbitmq-server/scripts/../ebin/rabbit.app
home dir       : /home/matthew
config file(s) : /etc/rabbitmq/rabbitmq.config
cookie hash    : ccGTTVV6GNSUxPewIZAXjg==
log            : /tmp/rabbit at koba.log
sasl log       : /tmp/rabbit at koba-sasl.log
database dir   : /tmp/rabbitmq-rabbit-mnesia
erlang version : 5.8.3

though with different paths. What are those paths?

Matthew

From david at rabbitmq.com  Sat Jul 30 23:48:56 2011
From: david at rabbitmq.com (David Wragg)
Date: Sat, 30 Jul 2011 23:48:56 +0100
Subject: [rabbitmq-discuss] single broker and queue scalability question
In-Reply-To: <b84336ff-df0e-4f2f-a0ef-cc489d53520a@f20g2000yqm.googlegroups.com>
	(justin adam's message of "Fri, 29 Jul 2011 11:30:57 -0700 (PDT)")
References: <b84336ff-df0e-4f2f-a0ef-cc489d53520a@f20g2000yqm.googlegroups.com>
Message-ID: <yrv4czkjv8jvr.fsf@dwragg.eng.vmware.com>

"justin.adam.miller at gmail.com" <justin.adam.miller at gmail.com> writes:
> I have an app that will have, at any one time, < 500 connections to a
> single broker, across multiple machines, all of whom I want as
> consumers of one queue so that rabbit can load balance amongst them.

It's certainly possible for rabbit to handle 500 connections, even on
relatively modest hardware.

As for 500 consumers of a single queue, it doesn't seem likely to be a
problem.  But you could prototype it and see what you get.  Try to match
your expected message throughput, message size distribution, and
consumption intervals (how long between a message being delivered and
being acked).  And try with hardware similar or less capable than what
you expect to use in production.

> Is handling so few connections/consumers a joke for rabbit? Should I
> consider clustering, and if so, what does clustering buy me in this
> case? The one thing I don't love about clustering is that, without
> active/passive failover, the node that declares the queue is a single
> point of failure.

Currently clustering won't buy you anything in this context.

As for active/active failover, there will be developments in that area
soon.  But even then, a single queue will remain a potential bottleneck.

> The idea of clustering along with multiple queues bound to one
> exchange is appealing (since exchange and binding information is
> replicated across the cluster), but rabbit will not round robin
> messages to all the bound queues -- there's no exchange type (that I
> know of) that has that behavior.
>
> If I knew the bound queues ahead of time, then I could pick one at
> random, but it seems like determining that queue would be cumbersome,
> inefficient and/or costly at best.

If you were to go down this route, there may be advantages to using
multiple brokers rather than clustering.  E.g., have one queue in each
broker, with each consumer coonsuming from one of them.  Then each
producer connects to each broker and publishes each message to one of
them, chosen at random.  This would allow you to do things like rolling
upgrades of the brokers.  Clustering won't, as we don't support mixed
version clusters.

-- 
David Wragg
Staff Engineer, RabbitMQ
VMware, Inc.

