From joey.jiaojg at gmail.com  Tue Jul  1 02:31:49 2014
From: joey.jiaojg at gmail.com (Joey Jiao)
Date: Tue, 1 Jul 2014 09:31:49 +0800
Subject: [rabbitmq-discuss] rabbitmq with only ldap auth
In-Reply-To: <53B13DF9.6000302@rabbitmq.com>
References: <CAKOmCvrKTiZkXULDZ-PRCwgt_bcZ-mw52-xL7F9S6=idRJ29pA@mail.gmail.com>
 <53B12FAD.9080604@rabbitmq.com>
 <CAKOmCvoxzxmChtu=7YQ=xf+b7ZhkxdRgLXYNyntk89AgkXnFGA@mail.gmail.com>
 <53B13765.4010306@rabbitmq.com>
 <CAKOmCvqK6mcJEfC=H_gP1msTxFa-nOg3sN=pMAy1E9RyJub=4g@mail.gmail.com>
 <53B138C3.4060307@rabbitmq.com>
 <CAKOmCvpmCwWVAzccvFKpZ=ARANs6znH3fpV8P7wV4dF2dOtFaQ@mail.gmail.com>
 <53B13C50.7060108@rabbitmq.com>
 <CAKOmCvojK09J=190tuxr=8-1fen4tx32kzDNgJpUr1Nrv9Vi4w@mail.gmail.com>
 <53B13DF9.6000302@rabbitmq.com>
Message-ID: <CAKOmCvoZawo3XeoTVwwMDUP59ts_LdKkSJNeHeRUPiBDRRAmRw@mail.gmail.com>

You are right, that's the issue.
rabbitmq-env is ended by conf while rabbitmq ended with config.
Thanks for the help Simon.


2014-06-30 18:37 GMT+08:00 Simon MacMullen <simon at rabbitmq.com>:

> On 30/06/14 11:34, Joey Jiao wrote:
>
>> It's actually readable with 644 permission.
>> How can I know where it read from the config file
>>
>
> It is in the log file. (For the fourth time!)
>
> Example:
>
> =INFO REPORT==== 27-Jun-2014::16:30:00 ===
> node           : rabbit at smacmullen
> home dir       : /home/simon
> config file(s) : /etc/rabbitmq/rabbitmq.config
> cookie hash    : BigcLqsHkDEWyvCp2e4gvA==
> log            : /tmp/rabbit at smacmullen.log
> sasl log       : /tmp/rabbit at smacmullen-sasl.log
> database dir   : /tmp/rabbitmq-rabbit-mnesia
>
>
> Note that the file is called rabbitmq.config, not rabbitmq.conf.
>
> Cheers, Simon
>
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>



-- 
-Joey Jiao
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140701/078bb5d5/attachment.html>

From joey.jiaojg at gmail.com  Tue Jul  1 06:20:54 2014
From: joey.jiaojg at gmail.com (Joey Jiao)
Date: Tue, 1 Jul 2014 13:20:54 +0800
Subject: [rabbitmq-discuss] eldap simple_bind failure
Message-ID: <CAKOmCvoUxS9_Q9L6RD_5quuVuf39mrL7Mb6N_C5xh9u_seHj5g@mail.gmail.com>

Hi,
I'm still on using rabbitmq_auth_backends_ldap plugin but login still
failed.
After a track, it failed during eldap:simple_bind.
But it failed at simple_bind with
eldap:simple_bind(L,"uid=jiangenj,ou=people,o=xxx","password") with error
{error,confidentialityRequired}.

My django app uses settings below and it worked. How can I convert to
rabbitmq way?
import ldap



*AUTH_LDAP_START_TLS = TrueAUTH_LDAP_GLOBAL_OPTIONS = {
ldap.OPT_X_TLS_REQUIRE_CERT: ldap.OPT_X_TLS_NEVER }*

*AUTH_LDAP_BIND_DN = ''AUTH_LDAP_BIND_PASSWORD = ''*
*AUTH_LDAP_BIND_AS_AUTHENTICATING_USER = True*
AUTH_LDAP_SERVER_URI = 'ldap://ldap'
AUTH_LDAP_USER_DN_TEMPLATE = 'uid=%(user)s,ou=people,o=xxx'

-- 
-Joey Jiao
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140701/db0cf11c/attachment.html>

From ankur5.c at tcs.com  Tue Jul  1 06:20:32 2014
From: ankur5.c at tcs.com (Ankur5 C)
Date: Tue, 1 Jul 2014 10:50:32 +0530
Subject: [rabbitmq-discuss] Unable to establish MQTT plugin in rabbitmq
 version : 3.1.3.
In-Reply-To: <OF74C79851.CFCF803F-ON65257D07.00341ECF-65257D07.00342C7C@LocalDomain>
References: <OF19D17275.EB899AD9-ON65257D04.00410E76-65257D04.0041511E@tcs.com>
 <etPan.53ad5c98.1befd79f.e552@mercurio.local>
 <OF25085B34.C861C7A3-ON65257D04.0041E694-65257D04.00423F99@tcs.com>
 <etPan.53ad5e56.41a7c4c9.e552@mercurio.local>
 <OFB0EA535F.1B2EEDA6-ON65257D04.0042B1E1-65257D04.0042CE0F@tcs.com>
 <etPan.53ad5fd1.4e6afb66.e552@mercurio.local>
 <OFF19E89BC.BA947DB7-ON65257D07.002A1576-65257D07.002A3259@tcs.com>
 <etPan.53b12587.6b8b4567.1759a@mercurio.local>
 <etPan.53b126a6.643c9869.1759a@mercurio.local>
 <OF74C79851.CFCF803F-ON65257D07.00341ECF-65257D07.00342C7C@LocalDomain>
Message-ID: <OF47B3F19B.5B110EAC-ON65257D08.001D17CC-65257D08.001D58C6@tcs.com>

Thanks so much . I am also getting the same message but with an error .
Connection is established but then some error lines are displayed in log.

=INFO REPORT==== 1-Jul-2014::11:01:55 ===
accepting MQTT connection (127.0.0.1:57198 -> 127.0.0.1:8883)

=ERROR REPORT==== 1-Jul-2014::11:01:55 ===
connection <0.7519.1>, channel 1 - soft error:
{amqp_error,not_found,
            "no queue 'mqtt-subscription-paho-java-1qos1' in vhost '/'",
            'queue.delete'}

I guess there are some problems in the rabbitmq configuration file. Please
refer to my config file.

[{rabbit,        [{tcp_listeners,    [5672]},{ssl_listeners, [5671]},
			{ssl_options,
[{cacertfile,"/usr/lib/rabbitmq/testca/cacert.pem"},
                    {certfile,"/usr/lib/rabbitmq/server/cert.pem"},
                    {keyfile,"/usr/lib/rabbitmq/server/key.pem"},
                    {verify,verify_peer},
                    {fail_if_no_peer_cert,false}]}]},
 {rabbitmq_mqtt, [{default_user,     <<"guest">>},
                  {default_pass,     <<"guest">>},
                  {allow_anonymous,  true},
                  {vhost,            <<"/">>},
                  {exchange,         <<"amq.topic">>},
                  {subscription_ttl, 1800000},
                  {prefetch,         10},
                  {ssl_listeners,    [8883]},
                  {tcp_listeners,    [1883]},
                  {tcp_listen_options, [binary,
                                        {packet,    raw},
                                        {reuseaddr, true},
                                        {backlog,   128},
                                        {nodelay,   true}]}]}
].

Is something wrong here ? Please suggest.

Thanks and Regards,
Ankur Chakraborty




From:	Ankur5 C/KOL/TCS
To:	Michael Klishin <mklishin at gopivotal.com>
Cc:	rabbitmq-discuss at lists.rabbitmq.com
Date:	30-06-2014 14:59
Subject:	Re: [rabbitmq-discuss] Unable to establish MQTT plugin in
            rabbitmq version : 3.1.3.


Thanks so much , will try the same and let you know the updates.

Thanks and Regards,
Ankur Chakraborty




From:	Michael Klishin <mklishin at gopivotal.com>
To:	Ankur5 C <ankur5.c at tcs.com>
Cc:	rabbitmq-discuss at lists.rabbitmq.com
Date:	30-06-2014 14:28
Subject:	Re: [rabbitmq-discuss] Unable to establish MQTT plugin in
            rabbitmq version : 3.1.3.



?On 30 June 2014 at 12:53:28, Michael Klishin (mklishin at gopivotal.com)
wrote:
> > It works just like Paho Python and Ruby clients.

I've pushed all 3 examples I've used to GitHub:

https://github.com/michaelklishin/mqtt-tls-playground
--
MK

Staff Software Engineer, Pivotal/RabbitMQ


=====-----=====-----=====
Notice: The information contained in this e-mail
message and/or attachments to it may contain 
confidential or privileged information. If you are 
not the intended recipient, any dissemination, use, 
review, distribution, printing or copying of the 
information contained in this e-mail message 
and/or attachments to it are strictly prohibited. If 
you have received this communication in error, 
please notify us by reply e-mail or telephone and 
immediately and permanently delete the message 
and any attachments. Thank you




From ankur5.c at tcs.com  Tue Jul  1 06:44:01 2014
From: ankur5.c at tcs.com (Ankur5 C)
Date: Tue, 1 Jul 2014 11:14:01 +0530
Subject: [rabbitmq-discuss] Unable to establish MQTT plugin in rabbitmq
 version : 3.1.3.
In-Reply-To: <OF47B3F19B.5B110EAC-ON65257D08.001D17CC-65257D08.001D58ED@LocalDomain>
References: <OF19D17275.EB899AD9-ON65257D04.00410E76-65257D04.0041511E@tcs.com>
 <etPan.53ad5c98.1befd79f.e552@mercurio.local>
 <OF25085B34.C861C7A3-ON65257D04.0041E694-65257D04.00423F99@tcs.com>
 <etPan.53ad5e56.41a7c4c9.e552@mercurio.local>
 <OFB0EA535F.1B2EEDA6-ON65257D04.0042B1E1-65257D04.0042CE0F@tcs.com>
 <etPan.53ad5fd1.4e6afb66.e552@mercurio.local>
 <OFF19E89BC.BA947DB7-ON65257D07.002A1576-65257D07.002A3259@tcs.com>
 <etPan.53b12587.6b8b4567.1759a@mercurio.local>
 <etPan.53b126a6.643c9869.1759a@mercurio.local>
 <OF74C79851.CFCF803F-ON65257D07.00341ECF-65257D07.00342C7C@LocalDomain>
 <OF47B3F19B.5B110EAC-ON65257D08.001D17CC-65257D08.001D58ED@LocalDomain>
Message-ID: <OF8380804B.FE587844-ON65257D08.001F592E-65257D08.001F7F46@tcs.com>

Hi Michael,

It worked . I removed the  {exchange,         <<"amq.topic">>}, part from
rabbitmq config file , now it is working fine.

Data are getting published.

Thanks again.

Thanks and Regards,
Ankur Chakraborty




From:	Ankur5 C/KOL/TCS
To:	Michael Klishin <mklishin at gopivotal.com>
Cc:	rabbitmq-discuss at lists.rabbitmq.com
Date:	01-07-2014 10:50
Subject:	Re: [rabbitmq-discuss] Unable to establish MQTT plugin in
            rabbitmq version : 3.1.3.


Thanks so much . I am also getting the same message but with an error .
Connection is established but then some error lines are displayed in log.

=INFO REPORT==== 1-Jul-2014::11:01:55 ===
accepting MQTT connection (127.0.0.1:57198 -> 127.0.0.1:8883)

=ERROR REPORT==== 1-Jul-2014::11:01:55 ===
connection <0.7519.1>, channel 1 - soft error:
{amqp_error,not_found,
            "no queue 'mqtt-subscription-paho-java-1qos1' in vhost '/'",
            'queue.delete'}

I guess there are some problems in the rabbitmq configuration file. Please
refer to my config file.

[{rabbit,        [{tcp_listeners,    [5672]},{ssl_listeners, [5671]},
			{ssl_options,
[{cacertfile,"/usr/lib/rabbitmq/testca/cacert.pem"},
                    {certfile,"/usr/lib/rabbitmq/server/cert.pem"},
                    {keyfile,"/usr/lib/rabbitmq/server/key.pem"},
                    {verify,verify_peer},
                    {fail_if_no_peer_cert,false}]}]},
 {rabbitmq_mqtt, [{default_user,     <<"guest">>},
                  {default_pass,     <<"guest">>},
                  {allow_anonymous,  true},
                  {vhost,            <<"/">>},
                  {exchange,         <<"amq.topic">>},
                  {subscription_ttl, 1800000},
                  {prefetch,         10},
                  {ssl_listeners,    [8883]},
                  {tcp_listeners,    [1883]},
                  {tcp_listen_options, [binary,
                                        {packet,    raw},
                                        {reuseaddr, true},
                                        {backlog,   128},
                                        {nodelay,   true}]}]}
].

Is something wrong here ? Please suggest.

Thanks and Regards,
Ankur Chakraborty





From:	Ankur5 C/KOL/TCS
To:	Michael Klishin <mklishin at gopivotal.com>
Cc:	rabbitmq-discuss at lists.rabbitmq.com
Date:	30-06-2014 14:59
Subject:	Re: [rabbitmq-discuss] Unable to establish MQTT plugin in
            rabbitmq version : 3.1.3.


Thanks so much , will try the same and let you know the updates.

Thanks and Regards,
Ankur Chakraborty




From:	Michael Klishin <mklishin at gopivotal.com>
To:	Ankur5 C <ankur5.c at tcs.com>
Cc:	rabbitmq-discuss at lists.rabbitmq.com
Date:	30-06-2014 14:28
Subject:	Re: [rabbitmq-discuss] Unable to establish MQTT plugin in
            rabbitmq version : 3.1.3.



?On 30 June 2014 at 12:53:28, Michael Klishin (mklishin at gopivotal.com)
wrote:
> > It works just like Paho Python and Ruby clients.

I've pushed all 3 examples I've used to GitHub:

https://github.com/michaelklishin/mqtt-tls-playground
--
MK

Staff Software Engineer, Pivotal/RabbitMQ


=====-----=====-----=====
Notice: The information contained in this e-mail
message and/or attachments to it may contain 
confidential or privileged information. If you are 
not the intended recipient, any dissemination, use, 
review, distribution, printing or copying of the 
information contained in this e-mail message 
and/or attachments to it are strictly prohibited. If 
you have received this communication in error, 
please notify us by reply e-mail or telephone and 
immediately and permanently delete the message 
and any attachments. Thank you




From joey.jiaojg at gmail.com  Tue Jul  1 09:16:01 2014
From: joey.jiaojg at gmail.com (Joey Jiao)
Date: Tue, 1 Jul 2014 16:16:01 +0800
Subject: [rabbitmq-discuss] eldap simple_bind failure
In-Reply-To: <CAKOmCvoUxS9_Q9L6RD_5quuVuf39mrL7Mb6N_C5xh9u_seHj5g@mail.gmail.com>
References: <CAKOmCvoUxS9_Q9L6RD_5quuVuf39mrL7Mb6N_C5xh9u_seHj5g@mail.gmail.com>
Message-ID: <CAKOmCvqWNXTpqR1YUCZWJiZf+=VRJmZLcjReyniyEoPHwAxzXQ@mail.gmail.com>

Here is my config

[
  {rabbit, [
    {log_levels, [{default, info}]},
    {reverse_dns_lookups, true},
    {auth_backends, [rabbit_auth_backend_ldap]},
    {ssl_listeners, [5671]}
%    {ssl_options, [
%      {verify, verify_none},
%      {cacertfile, "/etc/rabbitmq/qc_root_g2_cert.crt"},
%      {certfile, "/etc/rabbitmq/ssl_v1_cert.crt"}
%    ]}
  ]},
  {rabbitmq_auth_backend_ldap, [
    {servers, ["ldap"]},
    {user_dn_pattern, "uid=${username},ou=people,o=xxx"},
 %  {dn_lookup_attribute, "uid"},
 %  {dn_lookup_base, "ou=people,o=xxx"},
 %  {dn_lookup_bind, anon},
    {use_ssl, false},
    {log, network},
    {vhost_access_query, {constant, true}},
    {resource_access_query, {constant, true}},
    {tag_queries, [{administrator, {constant, true}},
                   {management, {constant, true}}]}
  ]}
].


2014-07-01 13:20 GMT+08:00 Joey Jiao <joey.jiaojg at gmail.com>:

> Hi,
> I'm still on using rabbitmq_auth_backends_ldap plugin but login still
> failed.
> After a track, it failed during eldap:simple_bind.
> But it failed at simple_bind with
> eldap:simple_bind(L,"uid=jiangenj,ou=people,o=xxx","password") with error
> {error,confidentialityRequired}.
>
> My django app uses settings below and it worked. How can I convert to
> rabbitmq way?
> import ldap
>
>
>
> *AUTH_LDAP_START_TLS = TrueAUTH_LDAP_GLOBAL_OPTIONS = {
> ldap.OPT_X_TLS_REQUIRE_CERT: ldap.OPT_X_TLS_NEVER }*
>
> *AUTH_LDAP_BIND_DN = ''AUTH_LDAP_BIND_PASSWORD = ''*
> *AUTH_LDAP_BIND_AS_AUTHENTICATING_USER = True*
> AUTH_LDAP_SERVER_URI = 'ldap://ldap'
> AUTH_LDAP_USER_DN_TEMPLATE = 'uid=%(user)s,ou=people,o=xxx'
>
> --
> -Joey Jiao
>



-- 
-Joey Jiao
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140701/55dbf948/attachment.html>

From joey.jiaojg at gmail.com  Tue Jul  1 09:36:00 2014
From: joey.jiaojg at gmail.com (Joey Jiao)
Date: Tue, 1 Jul 2014 16:36:00 +0800
Subject: [rabbitmq-discuss] eldap simple_bind failure
In-Reply-To: <CAKOmCvqWNXTpqR1YUCZWJiZf+=VRJmZLcjReyniyEoPHwAxzXQ@mail.gmail.com>
References: <CAKOmCvoUxS9_Q9L6RD_5quuVuf39mrL7Mb6N_C5xh9u_seHj5g@mail.gmail.com>
 <CAKOmCvqWNXTpqR1YUCZWJiZf+=VRJmZLcjReyniyEoPHwAxzXQ@mail.gmail.com>
Message-ID: <CAKOmCvpjzS0GoFYe0uL+d-s4i3cUFbm88cMGMa3AxXwD9YJn8A@mail.gmail.com>

Looks like I'm hitting this as I cannot connect to port 636. But does eldap
support StartTLS now?

From: Simon MacMullen <simon at ...
<http://gmane.org/get-address.php?address=simon%2dmQ7lE4MOPXtWk0Htik3J%2fw%40public.gmane.org>
>
Subject: Re: Configuring Auth LDAP Backend using LDAP+SSL/TLS
<http://news.gmane.org/find-root.php?message_id=5268EBB6.4010504%40rabbitmq.com>
Newsgroups: gmane.comp.networking.rabbitmq.general
<http://news.gmane.org/gmane.comp.networking.rabbitmq.general>
Date: 2013-10-24 09:43:18 GMT (35 weeks, 4 days, 22 hours and 49 minutes
ago)

Currently you can't set SSL options for *LDAP* connections, you can only
set {*use_ssl*, true} to make a connection without presenting a client
certificate. I guess this should be fixed.

Also you have {port, 389} which is unlikely to work as it's the non-SSL
port and I'm not at all convinced e*ldap* (the underlying Erlang *LDAP*
library) supports StartTLS.

So the only configuration that could work at the moment is

{*use_ssl*, true},
{port,    636}




2014-07-01 16:16 GMT+08:00 Joey Jiao <joey.jiaojg at gmail.com>:

> Here is my config
>
> [
>   {rabbit, [
>     {log_levels, [{default, info}]},
>     {reverse_dns_lookups, true},
>     {auth_backends, [rabbit_auth_backend_ldap]},
>     {ssl_listeners, [5671]}
> %    {ssl_options, [
> %      {verify, verify_none},
> %      {cacertfile, "/etc/rabbitmq/qc_root_g2_cert.crt"},
> %      {certfile, "/etc/rabbitmq/ssl_v1_cert.crt"}
> %    ]}
>   ]},
>   {rabbitmq_auth_backend_ldap, [
>     {servers, ["ldap"]},
>     {user_dn_pattern, "uid=${username},ou=people,o=xxx"},
>  %  {dn_lookup_attribute, "uid"},
>  %  {dn_lookup_base, "ou=people,o=xxx"},
>  %  {dn_lookup_bind, anon},
>     {use_ssl, false},
>     {log, network},
>     {vhost_access_query, {constant, true}},
>     {resource_access_query, {constant, true}},
>     {tag_queries, [{administrator, {constant, true}},
>                    {management, {constant, true}}]}
>   ]}
> ].
>
>
> 2014-07-01 13:20 GMT+08:00 Joey Jiao <joey.jiaojg at gmail.com>:
>
>  Hi,
>> I'm still on using rabbitmq_auth_backends_ldap plugin but login still
>> failed.
>> After a track, it failed during eldap:simple_bind.
>> But it failed at simple_bind with
>> eldap:simple_bind(L,"uid=jiangenj,ou=people,o=xxx","password") with error
>> {error,confidentialityRequired}.
>>
>> My django app uses settings below and it worked. How can I convert to
>> rabbitmq way?
>> import ldap
>>
>>
>>
>> *AUTH_LDAP_START_TLS = TrueAUTH_LDAP_GLOBAL_OPTIONS = {
>> ldap.OPT_X_TLS_REQUIRE_CERT: ldap.OPT_X_TLS_NEVER }*
>>
>> *AUTH_LDAP_BIND_DN = ''AUTH_LDAP_BIND_PASSWORD = ''*
>> *AUTH_LDAP_BIND_AS_AUTHENTICATING_USER = True*
>> AUTH_LDAP_SERVER_URI = 'ldap://ldap'
>> AUTH_LDAP_USER_DN_TEMPLATE = 'uid=%(user)s,ou=people,o=xxx'
>>
>> --
>> -Joey Jiao
>>
>
>
>
> --
> -Joey Jiao
>



-- 
-Joey Jiao
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140701/f1846bff/attachment.html>

From simon at rabbitmq.com  Tue Jul  1 10:47:43 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 01 Jul 2014 10:47:43 +0100
Subject: [rabbitmq-discuss] eldap simple_bind failure
In-Reply-To: <CAKOmCvpjzS0GoFYe0uL+d-s4i3cUFbm88cMGMa3AxXwD9YJn8A@mail.gmail.com>
References: <CAKOmCvoUxS9_Q9L6RD_5quuVuf39mrL7Mb6N_C5xh9u_seHj5g@mail.gmail.com>
 <CAKOmCvqWNXTpqR1YUCZWJiZf+=VRJmZLcjReyniyEoPHwAxzXQ@mail.gmail.com>
 <CAKOmCvpjzS0GoFYe0uL+d-s4i3cUFbm88cMGMa3AxXwD9YJn8A@mail.gmail.com>
Message-ID: <53B283BF.3070505@rabbitmq.com>

On 01/07/14 09:36, Joey Jiao wrote:
> Looks like I'm hitting this as I cannot connect to port 636. But does
> eldap support StartTLS now?

Looks like it does now:

http://www.erlang.org/doc/man/eldap.html#start_tls-2

So I'll file a bug for StartTLS support. But for the time being your 
only option is to use SSL on port 636.

Cheers, Simon


> From: Simon MacMullen <simon at ...
> <http://gmane.org/get-address.php?address=simon%2dmQ7lE4MOPXtWk0Htik3J%2fw%40public.gmane.org>>
> Subject: Re: Configuring Auth LDAP Backend using LDAP+SSL/TLS
> <http://news.gmane.org/find-root.php?message_id=5268EBB6.4010504%40rabbitmq.com>
> Newsgroups: gmane.comp.networking.rabbitmq.general
> <http://news.gmane.org/gmane.comp.networking.rabbitmq.general>
> Date: 2013-10-24 09:43:18 GMT (35 weeks, 4 days, 22 hours and 49 minutes
> ago)
>
> Currently you can't set SSL options for*LDAP*  connections, you can only
> set {*use_ssl*, true} to make a connection without presenting a client
> certificate. I guess this should be fixed.
>
> Also you have {port, 389} which is unlikely to work as it's the non-SSL
> port and I'm not at all convinced e*ldap*  (the underlying Erlang*LDAP*
> library) supports StartTLS.
>
> So the only configuration that could work at the moment is
>
> {*use_ssl*, true},
> {port,    636}
>
>
>
>
> 2014-07-01 16:16 GMT+08:00 Joey Jiao <joey.jiaojg at gmail.com
> <mailto:joey.jiaojg at gmail.com>>:
>
>     Here is my config
>
>     [
>        {rabbit, [
>          {log_levels, [{default, info}]},
>          {reverse_dns_lookups, true},
>          {auth_backends, [rabbit_auth_backend_ldap]},
>          {ssl_listeners, [5671]}
>     %    {ssl_options, [
>     %      {verify, verify_none},
>     %      {cacertfile, "/etc/rabbitmq/qc_root_g2_cert.crt"},
>     %      {certfile, "/etc/rabbitmq/ssl_v1_cert.crt"}
>     %    ]}
>        ]},
>        {rabbitmq_auth_backend_ldap, [
>          {servers, ["ldap"]},
>          {user_dn_pattern, "uid=${username},ou=people,o=xxx"},
>       %  {dn_lookup_attribute, "uid"},
>       %  {dn_lookup_base, "ou=people,o=xxx"},
>       %  {dn_lookup_bind, anon},
>          {use_ssl, false},
>          {log, network},
>          {vhost_access_query, {constant, true}},
>          {resource_access_query, {constant, true}},
>          {tag_queries, [{administrator, {constant, true}},
>                         {management, {constant, true}}]}
>        ]}
>     ].
>
>
>     2014-07-01 13:20 GMT+08:00 Joey Jiao <joey.jiaojg at gmail.com
>     <mailto:joey.jiaojg at gmail.com>>:
>
>         Hi,
>         I'm still on using rabbitmq_auth_backends_ldap plugin but login
>         still failed.
>         After a track, it failed during eldap:simple_bind.
>         But it failed at simple_bind with
>         eldap:simple_bind(L,"uid=jiangenj,ou=people,o=xxx","password")
>         with error {error,confidentialityRequired}.
>
>         My django app uses settings below and it worked. How can I
>         convert to rabbitmq way?
>         import ldap
>         *AUTH_LDAP_START_TLS = True
>         AUTH_LDAP_GLOBAL_OPTIONS = {
>              ldap.OPT_X_TLS_REQUIRE_CERT: ldap.OPT_X_TLS_NEVER
>         }*
>         *AUTH_LDAP_BIND_DN = ''
>         AUTH_LDAP_BIND_PASSWORD = ''*
>         *AUTH_LDAP_BIND_AS_AUTHENTICATING_USER = True*
>         AUTH_LDAP_SERVER_URI = 'ldap://ldap'
>         AUTH_LDAP_USER_DN_TEMPLATE = 'uid=%(user)s,ou=people,o=xxx'
>
>         --
>         -Joey Jiao
>
>
>
>
>     --
>     -Joey Jiao
>
>
>
>
> --
> -Joey Jiao
>
>
> _______________________________________________
> rabbitmq-discuss mailing list has moved to https://groups.google.com/forum/#!forum/rabbitmq-users,
> please subscribe to the new list!
>
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From ankur5.c at tcs.com  Tue Jul  1 11:22:41 2014
From: ankur5.c at tcs.com (Ankur5 C)
Date: Tue, 1 Jul 2014 15:52:41 +0530
Subject: [rabbitmq-discuss] Unable to establish MQTT plugin in rabbitmq
 version : 3.1.3.
In-Reply-To: <OF8380804B.FE587844-ON65257D08.001F592E-65257D08.001F7F4B@LocalDomain>
References: <OF19D17275.EB899AD9-ON65257D04.00410E76-65257D04.0041511E@tcs.com>
 <etPan.53ad5c98.1befd79f.e552@mercurio.local>
 <OF25085B34.C861C7A3-ON65257D04.0041E694-65257D04.00423F99@tcs.com>
 <etPan.53ad5e56.41a7c4c9.e552@mercurio.local>
 <OFB0EA535F.1B2EEDA6-ON65257D04.0042B1E1-65257D04.0042CE0F@tcs.com>
 <etPan.53ad5fd1.4e6afb66.e552@mercurio.local>
 <OFF19E89BC.BA947DB7-ON65257D07.002A1576-65257D07.002A3259@tcs.com>
 <etPan.53b12587.6b8b4567.1759a@mercurio.local>
 <etPan.53b126a6.643c9869.1759a@mercurio.local>
 <OF74C79851.CFCF803F-ON65257D07.00341ECF-65257D07.00342C7C@LocalDomain>
 <OF47B3F19B.5B110EAC-ON65257D08.001D17CC-65257D08.001D58ED@LocalDomain>
 <OF8380804B.FE587844-ON65257D08.001F592E-65257D08.001F7F4B@LocalDomain>
Message-ID: <OF75F90CDB.E2FD7BD7-ON65257D08.003876C2-65257D08.0039026B@tcs.com>

Hi Michael,

I was going through the TLSConnection.java file .

Could you please clarify how exactly the SSL authentication happening ?

At the client side I have  client key.

I have done the server certificate trusting by importing only the server
certificate to the jvm keystore.

At the server side I have server certificates and keys and ca certificate.

My idea was like I need to have a ca certificate , client certificate and
client key at the client side (same as in the server side.)

How exactly the SSL handshaking happening ? Please clarify.



Thanks and Regards,
Ankur Chakraborty




From:	Ankur5 C/KOL/TCS
To:	Michael Klishin <mklishin at gopivotal.com>
Cc:	rabbitmq-discuss at lists.rabbitmq.com
Date:	01-07-2014 11:14
Subject:	Re: [rabbitmq-discuss] Unable to establish MQTT plugin in
            rabbitmq version : 3.1.3.


Hi Michael,

It worked . I removed the  {exchange,         <<"amq.topic">>}, part from
rabbitmq config file , now it is working fine.

Data are getting published.

Thanks again.

Thanks and Regards,
Ankur Chakraborty





From:	Ankur5 C/KOL/TCS
To:	Michael Klishin <mklishin at gopivotal.com>
Cc:	rabbitmq-discuss at lists.rabbitmq.com
Date:	01-07-2014 10:50
Subject:	Re: [rabbitmq-discuss] Unable to establish MQTT plugin in
            rabbitmq version : 3.1.3.


Thanks so much . I am also getting the same message but with an error .
Connection is established but then some error lines are displayed in log.

=INFO REPORT==== 1-Jul-2014::11:01:55 ===
accepting MQTT connection (127.0.0.1:57198 -> 127.0.0.1:8883)

=ERROR REPORT==== 1-Jul-2014::11:01:55 ===
connection <0.7519.1>, channel 1 - soft error:
{amqp_error,not_found,
            "no queue 'mqtt-subscription-paho-java-1qos1' in vhost '/'",
            'queue.delete'}

I guess there are some problems in the rabbitmq configuration file. Please
refer to my config file.

[{rabbit,        [{tcp_listeners,    [5672]},{ssl_listeners, [5671]},
			{ssl_options,
[{cacertfile,"/usr/lib/rabbitmq/testca/cacert.pem"},
                    {certfile,"/usr/lib/rabbitmq/server/cert.pem"},
                    {keyfile,"/usr/lib/rabbitmq/server/key.pem"},
                    {verify,verify_peer},
                    {fail_if_no_peer_cert,false}]}]},
 {rabbitmq_mqtt, [{default_user,     <<"guest">>},
                  {default_pass,     <<"guest">>},
                  {allow_anonymous,  true},
                  {vhost,            <<"/">>},
                  {exchange,         <<"amq.topic">>},
                  {subscription_ttl, 1800000},
                  {prefetch,         10},
                  {ssl_listeners,    [8883]},
                  {tcp_listeners,    [1883]},
                  {tcp_listen_options, [binary,
                                        {packet,    raw},
                                        {reuseaddr, true},
                                        {backlog,   128},
                                        {nodelay,   true}]}]}
].

Is something wrong here ? Please suggest.

Thanks and Regards,
Ankur Chakraborty





From:	Ankur5 C/KOL/TCS
To:	Michael Klishin <mklishin at gopivotal.com>
Cc:	rabbitmq-discuss at lists.rabbitmq.com
Date:	30-06-2014 14:59
Subject:	Re: [rabbitmq-discuss] Unable to establish MQTT plugin in
            rabbitmq version : 3.1.3.


Thanks so much , will try the same and let you know the updates.

Thanks and Regards,
Ankur Chakraborty




From:	Michael Klishin <mklishin at gopivotal.com>
To:	Ankur5 C <ankur5.c at tcs.com>
Cc:	rabbitmq-discuss at lists.rabbitmq.com
Date:	30-06-2014 14:28
Subject:	Re: [rabbitmq-discuss] Unable to establish MQTT plugin in
            rabbitmq version : 3.1.3.



?On 30 June 2014 at 12:53:28, Michael Klishin (mklishin at gopivotal.com)
wrote:
> > It works just like Paho Python and Ruby clients.

I've pushed all 3 examples I've used to GitHub:

https://github.com/michaelklishin/mqtt-tls-playground
--
MK

Staff Software Engineer, Pivotal/RabbitMQ


=====-----=====-----=====
Notice: The information contained in this e-mail
message and/or attachments to it may contain 
confidential or privileged information. If you are 
not the intended recipient, any dissemination, use, 
review, distribution, printing or copying of the 
information contained in this e-mail message 
and/or attachments to it are strictly prohibited. If 
you have received this communication in error, 
please notify us by reply e-mail or telephone and 
immediately and permanently delete the message 
and any attachments. Thank you




From ankur5.c at tcs.com  Tue Jul  1 11:25:59 2014
From: ankur5.c at tcs.com (Ankur5 C)
Date: Tue, 1 Jul 2014 15:55:59 +0530
Subject: [rabbitmq-discuss] How is SSL handshaking  happening
Message-ID: <OFCAB72187.CB9F8392-ON65257D08.00390D2D-65257D08.00395025@tcs.com>

Hi Michael,

I was going through the TLSConnection.java file .

Could you please clarify how exactly the SSL authentication happening ?

At the client side I have  client key.

I have done the server certificate trusting by importing only the server 
certificate to the jvm keystore.

At the server side I have server certificates and keys and ca certificate.

My idea was like I need to have a ca certificate , client certificate and 
client key at the client side (same as in the server side.)

How exactly the SSL handshaking happening ? Please clarify.


Thanks and Regards,
Ankur Chakraborty
=====-----=====-----=====
Notice: The information contained in this e-mail
message and/or attachments to it may contain 
confidential or privileged information. If you are 
not the intended recipient, any dissemination, use, 
review, distribution, printing or copying of the 
information contained in this e-mail message 
and/or attachments to it are strictly prohibited. If 
you have received this communication in error, 
please notify us by reply e-mail or telephone and 
immediately and permanently delete the message 
and any attachments. Thank you


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140701/9df39ecf/attachment.html>

From mklishin at gopivotal.com  Tue Jul  1 11:27:19 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 1 Jul 2014 14:27:19 +0400
Subject: [rabbitmq-discuss] Unable to establish MQTT plugin in rabbitmq
 version : 3.1.3.
In-Reply-To: <OF75F90CDB.E2FD7BD7-ON65257D08.003876C2-65257D08.003920A3@tcs.com>
References: <OF19D17275.EB899AD9-ON65257D04.00410E76-65257D04.0041511E@tcs.com>
 <etPan.53ad5c98.1befd79f.e552@mercurio.local>
 <OF25085B34.C861C7A3-ON65257D04.0041E694-65257D04.00423F99@tcs.com>
 <etPan.53ad5e56.41a7c4c9.e552@mercurio.local>
 <OFB0EA535F.1B2EEDA6-ON65257D04.0042B1E1-65257D04.0042CE0F@tcs.com>
 <etPan.53ad5fd1.4e6afb66.e552@mercurio.local>
 <OFF19E89BC.BA947DB7-ON65257D07.002A1576-65257D07.002A3259@tcs.com>
 <etPan.53b12587.6b8b4567.1759a@mercurio.local>
 <etPan.53b126a6.643c9869.1759a@mercurio.local>
 <OF74C79851.CFCF803F-ON65257D07.00341ECF-65257D07.00342C7C@LocalDomain>
 <OF47B3F19B.5B110EAC-ON65257D08.001D17CC-65257D08.001D58ED@LocalDomain>
 <OF8380804B.FE587844-ON65257D08.001F592E-65257D08.001F7F4B@LocalDomain>
 <OF75F90CDB.E2FD7BD7-ON65257D08.003876C2-65257D08.003920A3@tcs.com>
Message-ID: <etPan.53b28d24.46e87ccd.2949@mercurio.local>

?On 1 July 2014 at 14:24:07, Ankur5 C (ankur5.c at tcs.com) wrote:
> > I was going through the TLSConnection.java file .
>  
> Could you please clarify how exactly the SSL authentication  
> happening ?
>  
> At the client side I have client key.
>  
> I have done the server certificate trusting by importing only  
> the server certificate to the jvm keystore.
>  
> At the server side I have server certificates and keys and ca certificate.  
>  
> My idea was like I need to have a ca certificate , client certificate  
> and client key at the client side (same as in the server side.)  
>  
> How exactly the SSL handshaking happening ? Please clarify.  

It is documented in [1] (see?Key Managers, Trust Managers and Stores)
and JDK documentation.

1.?http://www.rabbitmq.com/ssl.html
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From sp345s at att.com  Tue Jul  1 14:47:01 2014
From: sp345s at att.com (PATAR, SAGAR)
Date: Tue, 1 Jul 2014 13:47:01 +0000
Subject: [rabbitmq-discuss] durability = true & auto delete = true
Message-ID: <59BF56992750434F89F8EBE141E64B1D0222D852@GAALPA1MSGUSRAA.ITServices.sbc.com>

Hi ..
We are trying to understand the behavior of the below setting to a Queue in a clustered environment with multiple nodes

1)durability = true & auto delete = true ??
                What will happen to the messages in the queue when a connection is lost??
                Will the Queues be mirrored across the cluster .. what parameter needs to be set to make them mirrored ??

Also wanted to check if rabbit MQ generates a message ID which is unique and sequential ?? and can be used in java code to identify the point of failure?

Also we are sending the messages with TTL set .. but our requirement is every client has a separate TTL for the messages ... We want to check is there any option we can set when client creates the queues with    durability = true & auto delete = true

Appreciate all the help.

-Sagar
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140701/7afbea05/attachment.html>

From dmitry.andrianov at alertme.com  Tue Jul  1 14:53:49 2014
From: dmitry.andrianov at alertme.com (Dmitry Andrianov)
Date: Tue, 01 Jul 2014 14:53:49 +0100
Subject: [rabbitmq-discuss] custom exchange checking auth user
In-Reply-To: <53AC54D6.60406@rabbitmq.com>
References: <53A4436E.4090407@alertme.com> <53A444F3.10608@rabbitmq.com>
 <53A44907.5090908@alertme.com> <53A4BB81.5050509@rabbitmq.com>
 <53A7E749.6060009@alertme.com> <53AC5199.3020702@rabbitmq.com>
 <53AC53F9.9000400@alertme.com> <53AC54D6.60406@rabbitmq.com>
Message-ID: <53B2BD6D.2050803@alertme.com>

Understood.

One more question: some time ago I was told that either custom exchange 
or decorator will both serve for my purpose.
However while with exchange if I return empty list from route callback, 
no routing happens, the same does not seem to work in decorator.
Reading Erlang in rabbit_exchange.erl is very hard for me so I can be 
wrong but it looks like whatever decorator returns from route is only 
appended to the list of destinations and decorator cannot override the 
ones selected by exchange.

Is it correct? What is the correct way to deny processing message in the 
decorator?

And is there a recommended best practice for what should be used for 
validation purposes - custom exchange or exchange decorator?

Many thanks.
Dmitry


On 26/06/14 18:13, Matthias Radestock wrote:
> On 26/06/14 18:10, Dmitry Andrianov wrote:
>> While we are there given that we have our custom exchange - how can we
>> "enrich" a message with some data like client's IP?
>
> you can't. That *would* require changes to APIs. And breaking some 
> significant assumptions on the way.
>
> Matthias.

This email is for the use of the intended recipient(s) only.
If you have received this email in error, please notify the sender immediately and then delete it.
If you are not the intended recipient, you must not use, disclose or distribute this email without the
author's prior permission. AlertMe.com Ltd. is not responsible for any personal views expressed
in this message or any attachments that are those of the individual sender.

AlertMe.com Ltd, 30 Station Road, Cambridge, CB1 2RE, UK.
Registered in England, Company number 578 2908, VAT registration number GB 895 9914 42.



From mklishin at gopivotal.com  Tue Jul  1 14:54:37 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 1 Jul 2014 17:54:37 +0400
Subject: [rabbitmq-discuss] durability =?utf-8?Q?=3D_?=true & auto
 delete =?utf-8?Q?=3D_?=true
In-Reply-To: <59BF56992750434F89F8EBE141E64B1D0222D852@GAALPA1MSGUSRAA.ITServices.sbc.com>
References: <59BF56992750434F89F8EBE141E64B1D0222D852@GAALPA1MSGUSRAA.ITServices.sbc.com>
Message-ID: <etPan.53b2bdb7.41b71efb.2949@mercurio.local>

On 1 July 2014 at 17:48:53, PATAR, SAGAR (sp345s at att.com) wrote:
> >
> durability = true & auto delete = true ??
>  
>  
> What will happen to the messages in the queue when a connection  
> is lost??

If the queue is exclusive, the durability attribute has no effect
because the queue will be deleted as soon as client disconnects
(or its connection is lost).

auto-deleted queues are deleted when the last consumer is cancelled
(or its channel is closed, or its connection is lost).
If there never was a consumer (e.g. you only use basic.get), it won't
be deleted.

Obviously, when a queue is deleted, all messages in it are also deleted.?

> Will the Queues be mirrored across the cluster .. what parameter  
> needs to be set to make them mirrored ??

http://www.rabbitmq.com/ha.html

> Also wanted to check if rabbit MQ generates a message ID which  
> is unique and sequential ?? and can be used in java code to identify  
> the point of failure?

RabbitMQ does not generate message ids that are exposed to clients. Do not rely
on delivery tags for anything.
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From sp345s at att.com  Tue Jul  1 15:41:26 2014
From: sp345s at att.com (PATAR, SAGAR)
Date: Tue, 1 Jul 2014 14:41:26 +0000
Subject: [rabbitmq-discuss] durability = true & auto delete = true
In-Reply-To: <etPan.53b2bdb7.41b71efb.2949@mercurio.local>
References: <59BF56992750434F89F8EBE141E64B1D0222D852@GAALPA1MSGUSRAA.ITServices.sbc.com>
 <etPan.53b2bdb7.41b71efb.2949@mercurio.local>
Message-ID: <59BF56992750434F89F8EBE141E64B1D0222D89C@GAALPA1MSGUSRAA.ITServices.sbc.com>

Thanks Michael ..

Can you pl. help with the below ..

Also we are setting the TTL for the messages.. but our requirement is every client has a separate TTL for the messages ? We want to check is there any option we can set when client creates the queues with    durability = true & auto delete = true

-----Original Message-----
From: Michael Klishin [mailto:mklishin at gopivotal.com] 
Sent: Tuesday, July 01, 2014 9:55 AM
To: PATAR, SAGAR; Legacy list about RabbitMQ
Subject: Re: [rabbitmq-discuss] durability = true & auto delete = true

On 1 July 2014 at 17:48:53, PATAR, SAGAR (sp345s at att.com) wrote:
> >
> durability = true & auto delete = true ??
>  
>  
> What will happen to the messages in the queue when a connection  
> is lost??

If the queue is exclusive, the durability attribute has no effect
because the queue will be deleted as soon as client disconnects
(or its connection is lost).

auto-deleted queues are deleted when the last consumer is cancelled
(or its channel is closed, or its connection is lost).
If there never was a consumer (e.g. you only use basic.get), it won't
be deleted.

Obviously, when a queue is deleted, all messages in it are also deleted.?

> Will the Queues be mirrored across the cluster .. what parameter  
> needs to be set to make them mirrored ??

http://www.rabbitmq.com/ha.html

> Also wanted to check if rabbit MQ generates a message ID which  
> is unique and sequential ?? and can be used in java code to identify  
> the point of failure?

RabbitMQ does not generate message ids that are exposed to clients. Do not rely
on delivery tags for anything.
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From sp345s at att.com  Tue Jul  1 17:52:39 2014
From: sp345s at att.com (PATAR, SAGAR)
Date: Tue, 1 Jul 2014 16:52:39 +0000
Subject: [rabbitmq-discuss] durability = true & auto delete = true
In-Reply-To: <59BF56992750434F89F8EBE141E64B1D0222D89C@GAALPA1MSGUSRAA.ITServices.sbc.com>
References: <59BF56992750434F89F8EBE141E64B1D0222D852@GAALPA1MSGUSRAA.ITServices.sbc.com>
 <etPan.53b2bdb7.41b71efb.2949@mercurio.local>
 <59BF56992750434F89F8EBE141E64B1D0222D89C@GAALPA1MSGUSRAA.ITServices.sbc.com>
Message-ID: <59BF56992750434F89F8EBE141E64B1D0222D8CF@GAALPA1MSGUSRAA.ITServices.sbc.com>


Thanks Michael ..

Can you pl. help with the below ..

Also we are setting the TTL for the messages.. but our requirement is every client has a separate TTL for the messages ? We want to check is there any option we can set when client creates the queues with    durability = true & auto delete = true

-----Original Message-----
From: Michael Klishin [mailto:mklishin at gopivotal.com] 
Sent: Tuesday, July 01, 2014 9:55 AM
To: PATAR, SAGAR; Legacy list about RabbitMQ
Subject: Re: [rabbitmq-discuss] durability = true & auto delete = true

On 1 July 2014 at 17:48:53, PATAR, SAGAR (sp345s at att.com) wrote:
> >
> durability = true & auto delete = true ??
>  
>  
> What will happen to the messages in the queue when a connection  
> is lost??

If the queue is exclusive, the durability attribute has no effect
because the queue will be deleted as soon as client disconnects
(or its connection is lost).

auto-deleted queues are deleted when the last consumer is cancelled
(or its channel is closed, or its connection is lost).
If there never was a consumer (e.g. you only use basic.get), it won't
be deleted.

Obviously, when a queue is deleted, all messages in it are also deleted.?

> Will the Queues be mirrored across the cluster .. what parameter  
> needs to be set to make them mirrored ??

http://www.rabbitmq.com/ha.html

> Also wanted to check if rabbit MQ generates a message ID which  
> is unique and sequential ?? and can be used in java code to identify  
> the point of failure?

RabbitMQ does not generate message ids that are exposed to clients. Do not rely
on delivery tags for anything.
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From simon at rabbitmq.com  Tue Jul  1 17:57:38 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 01 Jul 2014 17:57:38 +0100
Subject: [rabbitmq-discuss] custom exchange checking auth user
In-Reply-To: <53B2BD6D.2050803@alertme.com>
References: <53A4436E.4090407@alertme.com> <53A444F3.10608@rabbitmq.com>
 <53A44907.5090908@alertme.com> <53A4BB81.5050509@rabbitmq.com>
 <53A7E749.6060009@alertme.com> <53AC5199.3020702@rabbitmq.com>
 <53AC53F9.9000400@alertme.com> <53AC54D6.60406@rabbitmq.com>
 <53B2BD6D.2050803@alertme.com>
Message-ID: <53B2E882.5090908@rabbitmq.com>

On 01/07/14 14:53, Dmitry Andrianov wrote:
> One more question: some time ago I was told that either custom exchange
> or decorator will both serve for my purpose.
> However while with exchange if I return empty list from route callback,
> no routing happens, the same does not seem to work in decorator.
> Reading Erlang in rabbit_exchange.erl is very hard for me so I can be
> wrong but it looks like whatever decorator returns from route is only
> appended to the list of destinations and decorator cannot override the
> ones selected by exchange.

That's correct.

> Is it correct? What is the correct way to deny processing message in the
> decorator?

You can't - I think at the point we said that we hadn't realised that 
was what you wanted to do.

The problem with allowing decorators to modify the existing routes as 
provided by the exchange is that it's not very obvious how to combine 
them when you have more than one decorator...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From mklishin at gopivotal.com  Tue Jul  1 19:06:55 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 1 Jul 2014 22:06:55 +0400
Subject: [rabbitmq-discuss] durability =?utf-8?Q?=3D_?=true & auto
 delete =?utf-8?Q?=3D_?=true
In-Reply-To: <59BF56992750434F89F8EBE141E64B1D0222D8CF@GAALPA1MSGUSRAA.ITServices.sbc.com>
References: <59BF56992750434F89F8EBE141E64B1D0222D852@GAALPA1MSGUSRAA.ITServices.sbc.com>
 <etPan.53b2bdb7.41b71efb.2949@mercurio.local>
 <59BF56992750434F89F8EBE141E64B1D0222D89C@GAALPA1MSGUSRAA.ITServices.sbc.com>
 <59BF56992750434F89F8EBE141E64B1D0222D8CF@GAALPA1MSGUSRAA.ITServices.sbc.com>
Message-ID: <etPan.53b2f8dc.6b8b4567.c058@mercurio.local>



On 1 July 2014 at 20:54:22, PATAR, SAGAR (sp345s at att.com) wrote:
> > Also we are setting the TTL for the messages.. but our requirement  
> is every client has a separate TTL for the messages ??

You can set TTL even for individual messages:

http://www.rabbitmq.com/ttl.html

> We want to  
> check is there any option we can set when client creates the queues  
> with durability = true & auto delete = true

TTL can be applied to durable and/or auto-deleted queues. These things
are orthogonal.?
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From kansalneha28 at yahoo.com  Tue Jul  1 19:23:06 2014
From: kansalneha28 at yahoo.com (Neha Kansal)
Date: Tue, 1 Jul 2014 11:23:06 -0700
Subject: [rabbitmq-discuss] Centralizing the error messages.
Message-ID: <1404238986.33220.YahooMailNeo@web141704.mail.bf1.yahoo.com>

Hi,

I have multiple consumer machines and if any consumer throws an error and logs it, I have to check every machine's logs to see which consumers might have thrown an error and sent the message back to the queue. Is there a way in RabbitMQ that would help me centralize the consumer logs? I know something can be done on the logging architecture side to fix it but I was curious if RabbitMQ has any feature support for this.?

Thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140701/0bc73324/attachment.html>

From pimenta at inatel.br  Tue Jul  1 20:01:32 2014
From: pimenta at inatel.br (Rodrigo Pimenta Carvalho)
Date: Tue, 1 Jul 2014 16:01:32 -0300
Subject: [rabbitmq-discuss] =?utf-8?q?=5BRabbit_+_SSL__connection=5D_AMQP_?=
 =?utf-8?b?ICAg4pi6Y2xvc2VkID8/IElzIGl0IG5vcm1hbD8=?=
Message-ID: <CD6B5DD5E1D03B4DA1AB7655BEDC4E8A3E745827A4@socrates.local.inatel.br>

Dears RabbitMQ begginers and experts users,

I?m using RabbitMQ on Windows, configured to use SSL, keys, certificates and CA certificates.
According to the SSL Troubleshooting page, I can confirm that:

- SSL support in Erlang is OK ! The Erlang VM has support for SSL.
- Keys and certificates with OpenSSL is OK! The certificates and keys can be used to establish a secure link by connecting two terminals.
- The broker is listening on the expected AMQPS port!

However I?m not sure about verifying SSL connection establishment, against the broke.
According to the SSL Troubleshooting page, it says that "If you present the broker with eight random bytes, the broker will respond with the string "AMQP" followed by an encoded version number". But, after presenting the  broker with eight random bytes, I just got the following message:

 AMQP    ?closed

Is it normal? Where is the "encoded version number". Should it be really closed ??

Any hint will be very helpful!

Best regards.

RODRIGO PIMENTA CARVALHO
Inatel Competence Center
Software
Ph: +55 35 3471 9979     (Brasil)

From mklishin at gopivotal.com  Tue Jul  1 20:27:47 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 1 Jul 2014 23:27:47 +0400
Subject: [rabbitmq-discuss] [Rabbit + SSL connection] AMQP
 =?utf-8?Q?=E2=98=BAclosed_?=?? Is it normal?
In-Reply-To: <CD6B5DD5E1D03B4DA1AB7655BEDC4E8A3E745827A4@socrates.local.inatel.br>
References: <CD6B5DD5E1D03B4DA1AB7655BEDC4E8A3E745827A4@socrates.local.inatel.br>
Message-ID: <etPan.53b30bce.6b8b4567.db0c@mercurio.local>

?On 1 July 2014 at 23:02:59, Rodrigo Pimenta Carvalho (pimenta at inatel.br) wrote:
> > However I?m not sure about verifying SSL connection establishment,  
> against the broke.
> According to the SSL Troubleshooting page, it says that "If you  
> present the broker with eight random bytes, the broker will respond  
> with the string "AMQP" followed by an encoded version number".  
> But, after presenting the broker with eight random bytes, I just  
> got the following message:
>  
> AMQP ?closed
>  
> Is it normal? Where is the "encoded version number". Should it  
> be really closed ??

It is normal because you are entering arbitrary data into telnet instead
of sending a valid protocol handshake.

Try with a RabbitMQ client next.
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From pimenta at inatel.br  Tue Jul  1 21:21:52 2014
From: pimenta at inatel.br (Rodrigo Pimenta Carvalho)
Date: Tue, 1 Jul 2014 17:21:52 -0300
Subject: [rabbitmq-discuss] =?utf-8?q?RES=3A__=5BRabbit_+_SSL_connection?=
 =?utf-8?b?XSBBTVFQIOKYumNsb3NlZCA/PyBJcyBpdCBub3JtYWw/?=
In-Reply-To: <etPan.53b30bce.6b8b4567.db0c@mercurio.local>
References: <CD6B5DD5E1D03B4DA1AB7655BEDC4E8A3E745827A4@socrates.local.inatel.br>,
 <etPan.53b30bce.6b8b4567.db0c@mercurio.local>
Message-ID: <CD6B5DD5E1D03B4DA1AB7655BEDC4E8A3E745827A5@socrates.local.inatel.br>

Ok.
Thank you!
So, now my unique problem is what happen when I use a RabbitMQ client. It is:

4.	=ERROR REPORT==== 27-Jun-2014::13:44:56 ===
5.	SSL: certify: ssl_handshake.erl:1358:Fatal error: handshake failure
6.	
7.	=ERROR REPORT==== 27-Jun-2014::13:45:01 ===
8.	error on AMQP connection <0.301.0>:
9.	{ssl_upgrade_error,{tls_alert,"handshake failure"}} 

Do you think I should try to do the same test again, but with the client or broker in another machine?
If I change to an Ubuntu environment (generating keys, certificates and CA certificate there again) and get the same issue, what could I conclude?

Any hint will be very hepful.

BR,

RODRIGO PIMENTA CARVALHO
Inatel Competence Center
Software
Ph: +55 35 3471 9979     (Brasil)
________________________________________
De: Michael Klishin [mklishin at gopivotal.com]
Enviado: ter?a-feira, 1 de julho de 2014 16:27
Para: rabbitmq-users at googlegroups.com; Rodrigo Pimenta Carvalho
Cc: rabbitmq-discuss at lists.rabbitmq.com
Assunto: Re: [rabbitmq-discuss] [Rabbit + SSL connection] AMQP ?closed ?? Is it normal?

 On 1 July 2014 at 23:02:59, Rodrigo Pimenta Carvalho (pimenta at inatel.br) wrote:
> > However I?m not sure about verifying SSL connection establishment,
> against the broke.
> According to the SSL Troubleshooting page, it says that "If you
> present the broker with eight random bytes, the broker will respond
> with the string "AMQP" followed by an encoded version number".
> But, after presenting the broker with eight random bytes, I just
> got the following message:
>
> AMQP ?closed
>
> Is it normal? Where is the "encoded version number". Should it
> be really closed ??

It is normal because you are entering arbitrary data into telnet instead
of sending a valid protocol handshake.

Try with a RabbitMQ client next.
--
MK

Staff Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Tue Jul  1 21:31:09 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 2 Jul 2014 00:31:09 +0400
Subject: [rabbitmq-discuss] RES: [Rabbit + SSL connection] AMQP
 =?utf-8?Q?=E2=98=BAclosed_?=?? Is it normal?
In-Reply-To: <CD6B5DD5E1D03B4DA1AB7655BEDC4E8A3E745827A5@socrates.local.inatel.br>
References: <CD6B5DD5E1D03B4DA1AB7655BEDC4E8A3E745827A4@socrates.local.inatel.br>
 <etPan.53b30bce.6b8b4567.db0c@mercurio.local>
 <CD6B5DD5E1D03B4DA1AB7655BEDC4E8A3E745827A5@socrates.local.inatel.br>
Message-ID: <etPan.53b31aa8.643c9869.dc16@mercurio.local>

On 2 July 2014 at 00:23:05, Rodrigo Pimenta Carvalho (pimenta at inatel.br) wrote:
> > So, now my unique problem is what happen when I use a RabbitMQ  
> client. It is:
>  
> 4. =ERROR REPORT==== 27-Jun-2014(http://airmail.calendar/2014-06-27%2012:00:00%20GMT+4)::13:44:56  
> ===
> 5. SSL: certify: ssl_handshake.erl:1358:Fatal error: handshake  
> failure
> 6.
> 7. =ERROR REPORT==== 27-Jun-2014()::13:45:01  
> ===
> 8. error on AMQP connection <0.301.0>:
> 9. {ssl_upgrade_error,{tls_alert,"handshake failure"}}  

This is a very generic error. Please post the code you use and s_client output
(and the exact command you run).

In an earlier email you say

"- Keys and certificates with OpenSSL is OK! The certificates and keys can be used to establish a secure link by connecting two terminals. "

I'm not sure what "two terminals" means. You need to use s_client with RabbitMQ server,
not openssl s_server, for example.?
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From pimenta at inatel.br  Tue Jul  1 22:22:03 2014
From: pimenta at inatel.br (Rodrigo Pimenta Carvalho)
Date: Tue, 1 Jul 2014 18:22:03 -0300
Subject: [rabbitmq-discuss] =?utf-8?q?RES=3A__RES=3A_=5BRabbit_+_SSL_conne?=
 =?utf-8?q?ction=5D_AMQP_=E2=98=BAclosed_=3F=3F_Is_it_normal=3F?=
In-Reply-To: <etPan.53b31aa8.643c9869.dc16@mercurio.local>
References: <CD6B5DD5E1D03B4DA1AB7655BEDC4E8A3E745827A4@socrates.local.inatel.br>
 <etPan.53b30bce.6b8b4567.db0c@mercurio.local>
 <CD6B5DD5E1D03B4DA1AB7655BEDC4E8A3E745827A5@socrates.local.inatel.br>,
 <etPan.53b31aa8.643c9869.dc16@mercurio.local>
Message-ID: <CD6B5DD5E1D03B4DA1AB7655BEDC4E8A3E745827A6@socrates.local.inatel.br>

Hi Michael.

The exact command I have used is:
--------------------------------------------
openssl s_client -connect localhost:5671 -cert client/cert.pem -key client/key.pem -CAfile testca/cacert.pem



The exact result is:
----------------------
Loading 'screen' into random state - done
CONNECTED(000001BC)
depth=1 CN = MyTestCA
verify return:1
depth=0 CN = ICCSW-109, O = server
verify return:1
---
Certificate chain
 0 s:/CN=ICCSW-109/O=server
   i:/CN=MyTestCA
 1 s:/CN=MyTestCA
   i:/CN=MyTestCA
---
Server certificate
-----BEGIN CERTIFICATE-----
MIIC4jCCAcqgAwIBAgIBATANBgkqhkiG9w0BAQUFADATMREwDwYDVQQDDAhNeVRl
c3RDQTAeFw0xNDA2MjcxMzAyMDBaFw0xNTA2MjcxMzAyMDBaMCUxEjAQBgNVBAMM
CUlDQ1NXLTEwOTEPMA0GA1UECgwGc2VydmVyMIIBIjANBgkqhkiG9w0BAQEFAAOC
AQ8AMIIBCgKCAQEAqyosJfGAjRgCbU3OP2VDAcE8vj8gNjHTFXlEkZnVeP1qyRr9
k67lG54YGttPsR/jislJgPd0sckrOoCfZikptU6ZGfYOO0b0/1rtkbuFqhdhZLle
z3XLC3RDE2hXMueDbY4vEuDKSZ2GRawCaMC4a7q5nRluI+VO8CJmHgr1uROsWQQ4
nAPJ/R3LPxbU4xmqGeOpRMl+Hw9UB3adAtIT+/zYg8JNu+1UBgHuXdL94yPG/lFm
c2WAJYflb+9yWMv5U/jHOEI2F3KWno4qiuquLCrpEX6uDNEnDhRwlu4A3oNiQXJQ
9+IO3f6icnoZxvhsq6hgnyrcrpyF7Ntvo1FlVQIDAQABoy8wLTAJBgNVHRMEAjAA
MAsGA1UdDwQEAwIFIDATBgNVHSUEDDAKBggrBgEFBQcDATANBgkqhkiG9w0BAQUF
AAOCAQEAHzIDuherNlWYlJye6v4a10xnsG3gV8c/TgGLtnK+oMwx9Jj376hUH4Ga
lwZ/7c6cFFUUUVsenjFbK6VrHCQrQFIaQbs62bGj8gbQPVbixhNCcDeu/0oK7iVL
wked5VoKcfHQ6msdJ+gZmaG3pU+8iHCfDEpYab5YOr2HORld6E2TdIpRRw+zj2/U
K4DVh2oFiD/C8H8qwBi4dFa8qBAbE7L/Xxi44FSRUAg/5RZ+FbPqd0fzThLh646T
knhbA8nh3nrFVPfrHp/Bkog4fx8gnUjFPYPVyh/AuBpG+cb0i68f+baoKtg5yKtQ
eKyyaJxv7lL55Q3+mlJ/LflFhLSjLw==
-----END CERTIFICATE-----
subject=/CN=ICCSW-109/O=server
issuer=/CN=MyTestCA
---
Acceptable client certificate CA names
/CN=MyTestCA
---
SSL handshake has read 1728 bytes and written 2420 bytes
---
New, TLSv1/SSLv3, Cipher is AES256-SHA256
Server public key is 2048 bit
Secure Renegotiation IS supported
Compression: NONE
Expansion: NONE
SSL-Session:
    Protocol  : TLSv1.2
    Cipher    : AES256-SHA256
    Session-ID: 75DAF625DC4A8458E7B539A5430C13F8602304D1B841476ED04214ECDFB48CCC
    Session-ID-ctx:
    Master-Key: 01909073E5427FB2D81F0438F26A8EF64857BF08713DCE004C6E556D39FA565995716817C3A4EDA7D7FC861B0CFDFA2E
    Key-Arg   : None
    PSK identity: None
    PSK identity hint: None
    SRP username: None
    Start Time: 1404247934
    Timeout   : 300 (sec)
    Verify return code: 0 (ok)
---
closed                                                                                                                    // closed after 10 seconds. And according to you, in an earlie email, it is ok.


Two terminals mean two prompts for commands, where I had tested keys and certificates with OpenSSL, exactly how it is explained in the RabbitMQ SSL Troubleshooting web page. All is ok here too. I?m using Windows 7.

My RabbitMQ java client is:
----------------------------------

public class Send_Hello {
	
	private final static String QUEUE_NAME = "task_queue_r";

	/**
	 * @param args
	 * @throws IOException 
	 */
	public static void main(String[] args) throws IOException {
		

		try {
	        char[] keyPassphrase = "XXXclp".toCharArray();
	        KeyStore ks = KeyStore.getInstance("PKCS12");
	        ks.load(new FileInputStream("E:\\path\\certificadosB\\server\\keycert.p12"), keyPassphrase);

	        KeyManagerFactory kmf = KeyManagerFactory.getInstance("SunX509");
	        kmf.init(ks, keyPassphrase); 

	        char[] trustPassphrase = "XXXVVclp".toCharArray();
	        KeyStore tks = KeyStore.getInstance("JKS");
	        tks.load(new FileInputStream("E:\\path\\certificadosB\\server\\rabbitstore"), trustPassphrase);


	        TrustManagerFactory tmf = TrustManagerFactory.getInstance("SunX509");
	        tmf.init(tks);

	        SSLContext c = SSLContext.getInstance("SSLv3");
	        c.init(kmf.getKeyManagers(), tmf.getTrustManagers(), null);	
	        
	        
		    ConnectionFactory factory = new ConnectionFactory();                                                                      // the exception rises here.

		    factory.setHost("localhost"); 

		    factory.setUsername("pimenta");                                                                                                           //pimenta is an administrator.
		    factory.setPassword("pimenta");

	           factory.setPort(5671);

		   factory.useSslProtocol(c);

		    Connection connection = factory.newConnection();

		    Channel channel = connection.createChannel();


		    boolean durable = true;
		    channel.queueDeclare(QUEUE_NAME, durable, false, false, null); 

		    
		    String message = "Hello World.";
		    channel.basicPublish("", QUEUE_NAME, MessageProperties.PERSISTENT_TEXT_PLAIN, message.getBytes());

		    System.out.println(" [x] Sent '" + message + "'");
		    

		     channel.close();
		     connection.close();
	        
		} catch (KeyStoreException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (NoSuchAlgorithmException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (CertificateException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (UnrecoverableKeyException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (KeyManagementException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}

	}
}

The output of this code is:
-------------------------------------
Exception in thread "main" java.net.SocketException: Software caused connection abort: recv failed
	at java.net.SocketInputStream.socketRead0(Native Method)
	at java.net.SocketInputStream.read(Unknown Source)
	at java.net.SocketInputStream.read(Unknown Source)
	at sun.security.ssl.InputRecord.readFully(Unknown Source)
	at sun.security.ssl.InputRecord.read(Unknown Source)
	at sun.security.ssl.SSLSocketImpl.readRecord(Unknown Source)
	at sun.security.ssl.SSLSocketImpl.performInitialHandshake(Unknown Source)
	at sun.security.ssl.SSLSocketImpl.writeRecord(Unknown Source)
	at sun.security.ssl.AppOutputStream.write(Unknown Source)
	at java.io.BufferedOutputStream.flushBuffer(Unknown Source)
	at java.io.BufferedOutputStream.flush(Unknown Source)
	at java.io.DataOutputStream.flush(Unknown Source)
	at com.rabbitmq.client.impl.SocketFrameHandler.sendHeader(SocketFrameHandler.java:129)
	at com.rabbitmq.client.impl.SocketFrameHandler.sendHeader(SocketFrameHandler.java:134)
	at com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:276)
	at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:590)
	at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:612)
	at br.inatel.icc.prototypeRabbitMQ.Send_Hello.main(Send_Hello.java:81)


In the log I have:
-----------------------------------------------------------------------------
=INFO REPORT==== 1-Jul-2014::18:14:02 ===
accepting AMQP connection <0.361.0> (127.0.0.1:56445 -> 127.0.0.1:5671)

=ERROR REPORT==== 1-Jul-2014::18:14:02 ===
SSL: certify: ssl_handshake.erl:1358:Fatal error: handshake failure

=ERROR REPORT==== 1-Jul-2014::18:14:07 ===
error on AMQP connection <0.361.0>:
{ssl_upgrade_error,{tls_alert,"handshake failure"}}


In the config file I have
-----------------------------------

    {ssl_listeners, [5671]},
    {ssl_options, [{cacertfile,           "E:/path/certificadosB/testca/cacert.pem"},
                   {certfile,             "E:/path/certificadosB/server/cert.pem"},
                   {keyfile,              "E:/path/certificadosB/server/key.pem"},
                   {verify,               verify_peer},   
                   {fail_if_no_peer_cert, false}]}


Would you like to see my key, certificates and CA certificate file? Could I send it attached in a next message?

Thank very much you for your effort in help !!

BR,
 
RODRIGO PIMENTA CARVALHO
Inatel Competence Center
Software
Ph: +55 35 3471 9979     (Brasil)
________________________________________
De: Michael Klishin [mklishin at gopivotal.com]
Enviado: ter?a-feira, 1 de julho de 2014 17:31
Para: Rodrigo Pimenta Carvalho; Legacy list about RabbitMQ
Assunto: Re: [rabbitmq-discuss] RES: [Rabbit + SSL connection] AMQP ?closed ?? Is it normal?

On 2 July 2014 at 00:23:05, Rodrigo Pimenta Carvalho (pimenta at inatel.br) wrote:
> > So, now my unique problem is what happen when I use a RabbitMQ
> client. It is:
>
> 4. =ERROR REPORT==== 27-Jun-2014(http://airmail.calendar/2014-06-27%2012:00:00%20GMT+4)::13:44:56
> ===
> 5. SSL: certify: ssl_handshake.erl:1358:Fatal error: handshake
> failure
> 6.
> 7. =ERROR REPORT==== 27-Jun-2014()::13:45:01
> ===
> 8. error on AMQP connection <0.301.0>:
> 9. {ssl_upgrade_error,{tls_alert,"handshake failure"}}

This is a very generic error. Please post the code you use and s_client output
(and the exact command you run).

In an earlier email you say

"- Keys and certificates with OpenSSL is OK! The certificates and keys can be used to establish a secure link by connecting two terminals. "

I'm not sure what "two terminals" means. You need to use s_client with RabbitMQ server,
not openssl s_server, for example.
--
MK

Staff Software Engineer, Pivotal/RabbitMQ

From joey.jiaojg at gmail.com  Wed Jul  2 03:29:41 2014
From: joey.jiaojg at gmail.com (Joey Jiao)
Date: Wed, 2 Jul 2014 10:29:41 +0800
Subject: [rabbitmq-discuss] eldap simple_bind failure
In-Reply-To: <53B283BF.3070505@rabbitmq.com>
References: <CAKOmCvoUxS9_Q9L6RD_5quuVuf39mrL7Mb6N_C5xh9u_seHj5g@mail.gmail.com>
 <CAKOmCvqWNXTpqR1YUCZWJiZf+=VRJmZLcjReyniyEoPHwAxzXQ@mail.gmail.com>
 <CAKOmCvpjzS0GoFYe0uL+d-s4i3cUFbm88cMGMa3AxXwD9YJn8A@mail.gmail.com>
 <53B283BF.3070505@rabbitmq.com>
Message-ID: <CAKOmCvotOr3vdTYs+tS-cepKbFW7KcvgfT+p=P-pVTgB3FsxPg@mail.gmail.com>

So is there a way I can test from erl?
like eldap:open, eldap:start_tls, eldap:simple_bind
Tutorial is less on this on google:)


2014-07-01 17:47 GMT+08:00 Simon MacMullen <simon at rabbitmq.com>:

> On 01/07/14 09:36, Joey Jiao wrote:
>
>> Looks like I'm hitting this as I cannot connect to port 636. But does
>> eldap support StartTLS now?
>>
>
> Looks like it does now:
>
> http://www.erlang.org/doc/man/eldap.html#start_tls-2
>
> So I'll file a bug for StartTLS support. But for the time being your only
> option is to use SSL on port 636.
>
> Cheers, Simon
>
>
>  From: Simon MacMullen <simon at ...
>> <http://gmane.org/get-address.php?address=simon%
>> 2dmQ7lE4MOPXtWk0Htik3J%2fw%40public.gmane.org>>
>>
>> Subject: Re: Configuring Auth LDAP Backend using LDAP+SSL/TLS
>> <http://news.gmane.org/find-root.php?message_id=5268EBB6.
>> 4010504%40rabbitmq.com>
>> Newsgroups: gmane.comp.networking.rabbitmq.general
>> <http://news.gmane.org/gmane.comp.networking.rabbitmq.general>
>>
>> Date: 2013-10-24 09:43:18 GMT (35 weeks, 4 days, 22 hours and 49 minutes
>> ago)
>>
>> Currently you can't set SSL options for*LDAP*  connections, you can only
>> set {*use_ssl*, true} to make a connection without presenting a client
>>
>> certificate. I guess this should be fixed.
>>
>> Also you have {port, 389} which is unlikely to work as it's the non-SSL
>> port and I'm not at all convinced e*ldap*  (the underlying Erlang*LDAP*
>>
>> library) supports StartTLS.
>>
>> So the only configuration that could work at the moment is
>>
>> {*use_ssl*, true},
>>
>> {port,    636}
>>
>>
>>
>>
>> 2014-07-01 16:16 GMT+08:00 Joey Jiao <joey.jiaojg at gmail.com
>> <mailto:joey.jiaojg at gmail.com>>:
>>
>>
>>     Here is my config
>>
>>     [
>>        {rabbit, [
>>          {log_levels, [{default, info}]},
>>          {reverse_dns_lookups, true},
>>          {auth_backends, [rabbit_auth_backend_ldap]},
>>          {ssl_listeners, [5671]}
>>     %    {ssl_options, [
>>     %      {verify, verify_none},
>>     %      {cacertfile, "/etc/rabbitmq/qc_root_g2_cert.crt"},
>>     %      {certfile, "/etc/rabbitmq/ssl_v1_cert.crt"}
>>     %    ]}
>>        ]},
>>        {rabbitmq_auth_backend_ldap, [
>>          {servers, ["ldap"]},
>>          {user_dn_pattern, "uid=${username},ou=people,o=xxx"},
>>       %  {dn_lookup_attribute, "uid"},
>>       %  {dn_lookup_base, "ou=people,o=xxx"},
>>       %  {dn_lookup_bind, anon},
>>          {use_ssl, false},
>>          {log, network},
>>          {vhost_access_query, {constant, true}},
>>          {resource_access_query, {constant, true}},
>>          {tag_queries, [{administrator, {constant, true}},
>>                         {management, {constant, true}}]}
>>        ]}
>>     ].
>>
>>
>>     2014-07-01 13:20 GMT+08:00 Joey Jiao <joey.jiaojg at gmail.com
>>     <mailto:joey.jiaojg at gmail.com>>:
>>
>>
>>         Hi,
>>         I'm still on using rabbitmq_auth_backends_ldap plugin but login
>>         still failed.
>>         After a track, it failed during eldap:simple_bind.
>>         But it failed at simple_bind with
>>         eldap:simple_bind(L,"uid=jiangenj,ou=people,o=xxx","password")
>>         with error {error,confidentialityRequired}.
>>
>>         My django app uses settings below and it worked. How can I
>>         convert to rabbitmq way?
>>         import ldap
>>         *AUTH_LDAP_START_TLS = True
>>         AUTH_LDAP_GLOBAL_OPTIONS = {
>>              ldap.OPT_X_TLS_REQUIRE_CERT: ldap.OPT_X_TLS_NEVER
>>         }*
>>         *AUTH_LDAP_BIND_DN = ''
>>         AUTH_LDAP_BIND_PASSWORD = ''*
>>         *AUTH_LDAP_BIND_AS_AUTHENTICATING_USER = True*
>>
>>         AUTH_LDAP_SERVER_URI = 'ldap://ldap'
>>         AUTH_LDAP_USER_DN_TEMPLATE = 'uid=%(user)s,ou=people,o=xxx'
>>
>>         --
>>         -Joey Jiao
>>
>>
>>
>>
>>     --
>>     -Joey Jiao
>>
>>
>>
>>
>> --
>> -Joey Jiao
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list has moved to https://groups.google.com/
>> forum/#!forum/rabbitmq-users,
>> please subscribe to the new list!
>>
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>



-- 
-Joey Jiao
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140702/ee8a6942/attachment.html>

From simon at rabbitmq.com  Wed Jul  2 10:42:15 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 02 Jul 2014 10:42:15 +0100
Subject: [rabbitmq-discuss] Centralizing the error messages.
In-Reply-To: <1404238986.33220.YahooMailNeo@web141704.mail.bf1.yahoo.com>
References: <1404238986.33220.YahooMailNeo@web141704.mail.bf1.yahoo.com>
Message-ID: <53B3D3F7.3090404@rabbitmq.com>

On 01/07/14 19:23, Neha Kansal wrote:
> I have multiple consumer machines and if any consumer throws an error
> and logs it, I have to check every machine's logs to see which consumers
> might have thrown an error and sent the message back to the queue. Is
> there a way in RabbitMQ that would help me centralize the consumer logs?
> I know something can be done on the logging architecture side to fix it
> but I was curious if RabbitMQ has any feature support for this.

There's no built in support for this I'm afraid.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Wed Jul  2 11:52:27 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 02 Jul 2014 11:52:27 +0100
Subject: [rabbitmq-discuss] eldap simple_bind failure
In-Reply-To: <CAKOmCvotOr3vdTYs+tS-cepKbFW7KcvgfT+p=P-pVTgB3FsxPg@mail.gmail.com>
References: <CAKOmCvoUxS9_Q9L6RD_5quuVuf39mrL7Mb6N_C5xh9u_seHj5g@mail.gmail.com>
 <CAKOmCvqWNXTpqR1YUCZWJiZf+=VRJmZLcjReyniyEoPHwAxzXQ@mail.gmail.com>
 <CAKOmCvpjzS0GoFYe0uL+d-s4i3cUFbm88cMGMa3AxXwD9YJn8A@mail.gmail.com>
 <53B283BF.3070505@rabbitmq.com>
 <CAKOmCvotOr3vdTYs+tS-cepKbFW7KcvgfT+p=P-pVTgB3FsxPg@mail.gmail.com>
Message-ID: <53B3E46B.9000503@rabbitmq.com>

On 02/07/14 03:29, Joey Jiao wrote:
> So is there a way I can test from erl?
> like eldap:open, eldap:start_tls, eldap:simple_bind
> Tutorial is less on this on google:)

I just added StartTLS support to the LDAP plugin. It will be in 
tonight's nightly build, and is documented at 
http://next.rabbitmq.com/ldap.html

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From sagu.prf1 at gmail.com  Wed Jul  2 16:51:41 2014
From: sagu.prf1 at gmail.com (sagu prf)
Date: Wed, 2 Jul 2014 08:51:41 -0700
Subject: [rabbitmq-discuss] Rabbitmq File descriptor ,
	socket descritor and memory
Message-ID: <CAMK+tBhsomOMGSZGfHzko=ogpehOSt_orX82Qn9Gea8cJcKUAw@mail.gmail.com>

Hi Team ,

I have 2 doubt on the rabbitmq tuning to maximum FD .

I have increased the file descriptor value for the rabbitmq users to
100K and now it showing socket decriptor  value to 89908 .


So now we can connect maximum 89908 TCP connection (amqp)  rights ?


 {file_descriptors,

     [{total_limit,99900},

      {total_used,40000},

      {sockets_limit,89908},

      {sockets_used,40000}]},


2. Rabbitmq paging ..


{vm_memory_high_watermark,0.4},  - 100GB RAM - high water mark 40GB

 {vm_memory_high_watermark_paging_ratio,0.5}]   rabbitmq pagingout the
messages will start at 20GB Physical RAM utilization right ?



Regards
Sagu

From simon at rabbitmq.com  Wed Jul  2 16:56:54 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 02 Jul 2014 16:56:54 +0100
Subject: [rabbitmq-discuss] Rabbitmq File descriptor ,
 socket descritor and memory
In-Reply-To: <CAMK+tBhsomOMGSZGfHzko=ogpehOSt_orX82Qn9Gea8cJcKUAw@mail.gmail.com>
References: <CAMK+tBhsomOMGSZGfHzko=ogpehOSt_orX82Qn9Gea8cJcKUAw@mail.gmail.com>
Message-ID: <53B42BC6.1050607@rabbitmq.com>

On 02/07/14 16:51, sagu prf wrote:
> I have increased the file descriptor value for the rabbitmq users to
> 100K and now it showing socket decriptor  value to 89908 .

(in order to leave some file descriptors left over for use with files.)

> So now we can connect maximum 89908 TCP connection (amqp)  rights ?

Yes.


> 2. Rabbitmq paging ..
>
>
> {vm_memory_high_watermark,0.4},  - 100GB RAM - high water mark 40GB

Yes.

>   {vm_memory_high_watermark_paging_ratio,0.5}]   rabbitmq pagingout the
> messages will start at 20GB Physical RAM utilization right ?

Yes.

Phew, that one was easy :-)

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From mklishin at gopivotal.com  Wed Jul  2 16:59:29 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 2 Jul 2014 19:59:29 +0400
Subject: [rabbitmq-discuss] Rabbitmq File descriptor ,
 socket descritor and memory
In-Reply-To: <CAMK+tBhsomOMGSZGfHzko=ogpehOSt_orX82Qn9Gea8cJcKUAw@mail.gmail.com>
References: <CAMK+tBhsomOMGSZGfHzko=ogpehOSt_orX82Qn9Gea8cJcKUAw@mail.gmail.com>
Message-ID: <etPan.53b42c7f.515f007c.13d2b@mercurio.local>

On 2 July 2014 at 19:53:52, sagu prf (sagu.prf1 at gmail.com) wrote:
> > I have increased the file descriptor value for the rabbitmq  
> users to
> 100K and now it showing socket decriptor value to 89908 .
>  
>  
> So now we can connect maximum 89908 TCP connection (amqp) rights  
> ?

File descriptors cover both file handles and sockets. RabbitMQ tries
to reuse file handles where possible to conserve them. With the file descriptor
limit of 100K you won't be able to have 100K open connections because RabbitMQ
will use at least some of them for open files (the more queues you have, the greater
the number).?


> 2. Rabbitmq paging ..
>  
>  
> {vm_memory_high_watermark,0.4}, - 100GB RAM - high water mark  
> 40GB
>  
> {vm_memory_high_watermark_paging_ratio,0.5}] rabbitmq  
> pagingout the
> messages will start at 20GB Physical RAM utilization right ?  

From the example config [1]:

? ?%% Fraction of the high watermark limit at which queues start to
? ?%% page message out to disc in order to free up memory.
? ?%%
? ?%% {vm_memory_high_watermark_paging_ratio, 0.5},

1. http://hg.rabbitmq.com/rabbitmq-server/file/27d5539e2771/docs/rabbitmq.config.example
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From kansalneha28 at yahoo.com  Wed Jul  2 17:32:16 2014
From: kansalneha28 at yahoo.com (Neha Kansal)
Date: Wed, 2 Jul 2014 09:32:16 -0700
Subject: [rabbitmq-discuss] Centralizing the error messages.
In-Reply-To: <53B3D3F7.3090404@rabbitmq.com>
References: <1404238986.33220.YahooMailNeo@web141704.mail.bf1.yahoo.com>
 <53B3D3F7.3090404@rabbitmq.com>
Message-ID: <1404318736.22993.YahooMailNeo@web141701.mail.bf1.yahoo.com>

Okay, thanks.



On Wednesday, July 2, 2014 2:42 AM, Simon MacMullen <simon at rabbitmq.com> wrote:
 


On 01/07/14 19:23, Neha Kansal wrote:

> I have multiple consumer machines and if any consumer throws an error
> and logs it, I have to check every machine's logs to see which consumers
> might have thrown an error and sent the message back to the queue. Is
> there a way in RabbitMQ that would help me centralize the consumer logs?
> I know something can be done on the logging architecture side to fix it
> but I was curious if RabbitMQ has any feature support for this.

There's no built in support for this I'm afraid.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140702/efa7aef3/attachment.html>

From kansalneha28 at yahoo.com  Wed Jul  2 19:59:20 2014
From: kansalneha28 at yahoo.com (Neha Kansal)
Date: Wed, 2 Jul 2014 11:59:20 -0700
Subject: [rabbitmq-discuss] Centralizing the error messages.
In-Reply-To: <53B3D3F7.3090404@rabbitmq.com>
References: <1404238986.33220.YahooMailNeo@web141704.mail.bf1.yahoo.com>
 <53B3D3F7.3090404@rabbitmq.com>
Message-ID: <1404327560.16737.YahooMailNeo@web141704.mail.bf1.yahoo.com>

Thanks. I wanted to clarify my question further, just to make sure I conveyed it right. Its not just about the logging part but basically about knowing the fact that which consumers have been sending messages back to the queue or are having any kind of problems with processing the message. Any way to know that in RabbitMQ distributed environment?



On Wednesday, July 2, 2014 2:42 AM, Simon MacMullen <simon at rabbitmq.com> wrote:
 


On 01/07/14 19:23, Neha Kansal wrote:

> I have multiple consumer machines and if any consumer throws an error
> and logs it, I have to check every machine's logs to see which consumers
> might have thrown an error and sent the message back to the queue. Is
> there a way in RabbitMQ that would help me centralize the consumer logs?
> I know something can be done on the logging architecture side to fix it
> but I was curious if RabbitMQ has any feature support for this.

There's no built in support for this I'm afraid.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140702/43e6c4b1/attachment.html>

From joey.jiaojg at gmail.com  Thu Jul  3 04:20:32 2014
From: joey.jiaojg at gmail.com (Joey Jiao)
Date: Thu, 3 Jul 2014 11:20:32 +0800
Subject: [rabbitmq-discuss] eldap simple_bind failure
In-Reply-To: <53B3E46B.9000503@rabbitmq.com>
References: <CAKOmCvoUxS9_Q9L6RD_5quuVuf39mrL7Mb6N_C5xh9u_seHj5g@mail.gmail.com>
 <CAKOmCvqWNXTpqR1YUCZWJiZf+=VRJmZLcjReyniyEoPHwAxzXQ@mail.gmail.com>
 <CAKOmCvpjzS0GoFYe0uL+d-s4i3cUFbm88cMGMa3AxXwD9YJn8A@mail.gmail.com>
 <53B283BF.3070505@rabbitmq.com>
 <CAKOmCvotOr3vdTYs+tS-cepKbFW7KcvgfT+p=P-pVTgB3FsxPg@mail.gmail.com>
 <53B3E46B.9000503@rabbitmq.com>
Message-ID: <CAKOmCvpuiO+fdd2JFHd38Du1LSzaOpOxwqD47HXdqk=Q+NaZYA@mail.gmail.com>

Awesome, Simon.
I also worked with our IT to solve 636 port access problem and now I'm able
to login in with ldaps.
Thanks


2014-07-02 18:52 GMT+08:00 Simon MacMullen <simon at rabbitmq.com>:

> On 02/07/14 03:29, Joey Jiao wrote:
>
>> So is there a way I can test from erl?
>> like eldap:open, eldap:start_tls, eldap:simple_bind
>> Tutorial is less on this on google:)
>>
>
> I just added StartTLS support to the LDAP plugin. It will be in tonight's
> nightly build, and is documented at http://next.rabbitmq.com/ldap.html
>
> Cheers, Simon
>
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>



-- 
-Joey Jiao
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140703/846dfce5/attachment.html>

From sagu.prf1 at gmail.com  Thu Jul  3 04:27:46 2014
From: sagu.prf1 at gmail.com (sagu prf)
Date: Wed, 2 Jul 2014 20:27:46 -0700
Subject: [rabbitmq-discuss] Rabbitmq File descriptor ,
 socket descritor and memory
In-Reply-To: <etPan.53b42c7f.515f007c.13d2b@mercurio.local>
References: <CAMK+tBhsomOMGSZGfHzko=ogpehOSt_orX82Qn9Gea8cJcKUAw@mail.gmail.com>
 <etPan.53b42c7f.515f007c.13d2b@mercurio.local>
Message-ID: <CAMK+tBhAQyP+3_iA=2rkJ=-adHV9xy1jtVEc5QaXAe_5tJeC8A@mail.gmail.com>

Hi Team ,


We are  publishing non-persistent messages to rabbitmq whether these
paged messages are written to disk (mnesia db ) or it should use swap
space .


it seems rabbitmq not using Swap space ?

rabbitmq at rabbitmq1$ free -m
             total       used       free     shared    buffers     cached
Mem:         24576      12175      12400          0        735       1252
-/+ buffers/cache:      10187      14388
Swap:        12255          7      12248
rabbitmq at rabbitmq1$


Memory 7.8GB  - backlog messages

Paging(?) .

 4,537,909 / 5,056,437 msg (in RAM / total)
RAM target: 9,158,043 msg


It seems the rabbitmq paged out  (non-persistent messages ) to  mnesia database)

mnesia/rabbit at rabbitmq1$ du -sh *

4.0K cluster_nodes.config

4.0K DECISION_TAB.LOG

4.0K LATEST.LOG

38M msg_store_persistent

428M msg_store_transient

4.0K nodes_running_at_shutdown

8.1M queues

68K rabbit_durable_exchange.DCD

12K rabbit_durable_exchange.DCL

252K rabbit_durable_queue.DCD

72K rabbit_durable_queue.DCL

352K rabbit_durable_route.DCD

20K rabbit_durable_route.DCL

4.0K rabbit_runtime_parameters.DCD

4.0K rabbit_serial

4.0K rabbit_user.DCD

8.0K rabbit_user_permission.DCD

4.0K rabbit_vhost.DCD

28K schema.DAT

4.0K schema_version

Regards
Sagu

On Wed, Jul 2, 2014 at 8:59 AM, Michael Klishin <mklishin at gopivotal.com> wrote:
> On 2 July 2014 at 19:53:52, sagu prf (sagu.prf1 at gmail.com) wrote:
>> > I have increased the file descriptor value for the rabbitmq
>> users to
>> 100K and now it showing socket decriptor value to 89908 .
>>
>>
>> So now we can connect maximum 89908 TCP connection (amqp) rights
>> ?
>
> File descriptors cover both file handles and sockets. RabbitMQ tries
> to reuse file handles where possible to conserve them. With the file descriptor
> limit of 100K you won't be able to have 100K open connections because RabbitMQ
> will use at least some of them for open files (the more queues you have, the greater
> the number).
>
>
>> 2. Rabbitmq paging ..
>>
>>
>> {vm_memory_high_watermark,0.4}, - 100GB RAM - high water mark
>> 40GB
>>
>> {vm_memory_high_watermark_paging_ratio,0.5}] rabbitmq
>> pagingout the
>> messages will start at 20GB Physical RAM utilization right ?
>
> From the example config [1]:
>
>    %% Fraction of the high watermark limit at which queues start to
>    %% page message out to disc in order to free up memory.
>    %%
>    %% {vm_memory_high_watermark_paging_ratio, 0.5},
>
> 1. http://hg.rabbitmq.com/rabbitmq-server/file/27d5539e2771/docs/rabbitmq.config.example
> --
> MK
>
> Staff Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Thu Jul  3 07:28:38 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 3 Jul 2014 10:28:38 +0400
Subject: [rabbitmq-discuss] Rabbitmq File descriptor ,
 socket descritor and memory
In-Reply-To: <CAMK+tBhAQyP+3_iA=2rkJ=-adHV9xy1jtVEc5QaXAe_5tJeC8A@mail.gmail.com>
References: <CAMK+tBhsomOMGSZGfHzko=ogpehOSt_orX82Qn9Gea8cJcKUAw@mail.gmail.com>
 <etPan.53b42c7f.515f007c.13d2b@mercurio.local>
 <CAMK+tBhAQyP+3_iA=2rkJ=-adHV9xy1jtVEc5QaXAe_5tJeC8A@mail.gmail.com>
Message-ID: <etPan.53b4f835.6b8b4567.60b3@mercurio.local>

On 3 July 2014 at 07:29:59, sagu prf (sagu.prf1 at gmail.com) wrote:
> > We are publishing non-persistent messages to rabbitmq whether 
> these
> paged messages are written to disk (mnesia db ) or it should use 
> swap
> space .
> 
> 
> it seems rabbitmq not using Swap space ?

Paging in the RabbitMQ config has nothing to do with OS swap.
RabbitMQ does not store messages in Mnesia. Messages are stored
in Rabbit's own message store, together with message index.
-- 
MK 

Staff Software Engineer, Pivotal/RabbitMQ

From hitesh at artoonsolutions.com  Thu Jul  3 09:51:13 2014
From: hitesh at artoonsolutions.com (Hitesh Dobariya)
Date: Thu, 3 Jul 2014 14:21:13 +0530
Subject: [rabbitmq-discuss] [ Listen event when queue destroy from client ]
Message-ID: <CAJGFNjSBkkWnLdp1w5=01hZoObEWX+qdqAyrB3h5oiA-TPgxKA@mail.gmail.com>

Hello, All


I am developing application in which client is creating queue with rabbitmq
server, and there is also another server that will manage all the
calculation over server.

I am facing problem with detection of queue destroy at server side. For
example : queue with name "a" created from android client, and now user is
going to kill the app, that time queue will destroy. but server still in
unknown state of that queue. so i am want to listen any event or any method
to call for detect queue has been destroy from client side.

-- 
*Thanks,*
Hitesh Dobariya,
Artoon Solutions PVT. LTD
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140703/8b93cb11/attachment.html>

From mklishin at gopivotal.com  Thu Jul  3 10:07:49 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 3 Jul 2014 13:07:49 +0400
Subject: [rabbitmq-discuss] [ Listen event when queue destroy from
 client ]
In-Reply-To: <CAJGFNjSBkkWnLdp1w5=01hZoObEWX+qdqAyrB3h5oiA-TPgxKA@mail.gmail.com>
References: <CAJGFNjSBkkWnLdp1w5=01hZoObEWX+qdqAyrB3h5oiA-TPgxKA@mail.gmail.com>
Message-ID: <etPan.53b51d7e.643c9869.60b3@mercurio.local>

On 3 July 2014 at 13:04:08, Hitesh Dobariya (hitesh at artoonsolutions.com) wrote:
> > I am facing problem with detection of queue destroy at server  
> side. For example : queue with name "a" created from android client,  
> and now user is going to kill the app, that time queue will destroy.  
> but server still in unknown state of that queue. so i am want to  
> listen any event or any method to call for detect queue has been  
> destroy from client side.

See passive declaration in your client's API.

Note that queues do not have to be deleted when a client disconnects. If queue
names are constant and well-known, you can use shared durable non-exclusive queues.

If your problem is primarily client presence detection, there's presence exchange:
https://github.com/tonyg/presence-exchange.?
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From simon at rabbitmq.com  Thu Jul  3 10:11:17 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 03 Jul 2014 10:11:17 +0100
Subject: [rabbitmq-discuss] [ Listen event when queue destroy from
 client ]
In-Reply-To: <CAJGFNjSBkkWnLdp1w5=01hZoObEWX+qdqAyrB3h5oiA-TPgxKA@mail.gmail.com>
References: <CAJGFNjSBkkWnLdp1w5=01hZoObEWX+qdqAyrB3h5oiA-TPgxKA@mail.gmail.com>
Message-ID: <53B51E35.5080808@rabbitmq.com>

On 03/07/2014 9:51AM, Hitesh Dobariya wrote:
> I am facing problem with detection of queue destroy at server side. For
> example : queue with name "a" created from android client, and now user
> is going to kill the app, that time queue will destroy. but server still
> in unknown state of that queue. so i am want to listen any event or any
> method to call for detect queue has been destroy from client side.

Have a look at 
https://github.com/simonmacmullen/rabbitmq-event-exchange, binding with 
"queue.deleted" should tell you what you want to know.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Thu Jul  3 14:45:46 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 03 Jul 2014 14:45:46 +0100
Subject: [rabbitmq-discuss] [ Listen event when queue destroy from
 client ]
In-Reply-To: <CAJGFNjQTcEpjdXK6_DO6NFa7Ho8TiUq9fac6ijCYCe1hNgHP2A@mail.gmail.com>
References: <CAJGFNjSBkkWnLdp1w5=01hZoObEWX+qdqAyrB3h5oiA-TPgxKA@mail.gmail.com>
 <53B51E35.5080808@rabbitmq.com>
 <CAJGFNjQTcEpjdXK6_DO6NFa7Ho8TiUq9fac6ijCYCe1hNgHP2A@mail.gmail.com>
Message-ID: <53B55E8A.7040504@rabbitmq.com>

On 03/07/2014 2:40PM, Hitesh Dobariya wrote:
> can you please send me path where to get .ex for installation? i tried
> but unable to install new plugin on my rabbitmq server.

It's available for 3.3.x from 
http://www.rabbitmq.com/community-plugins/v3.3.x/

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From sean at monkeysnatchbanana.com  Thu Jul  3 17:23:36 2014
From: sean at monkeysnatchbanana.com (Sean Allen)
Date: Thu, 3 Jul 2014 12:23:36 -0400
Subject: [rabbitmq-discuss] federated exchange question
Message-ID: <CABm-Wmd7KvfmS0Q-BNrYYKyOwQhEFLdRfFaz=NSjSnZJ6dqGxQ@mail.gmail.com>

i have an exchange A in cluster 1 that is being federated to cluster 2.

that created a queue for said message on a node in cluster 1.
if that node goes down, what happens? message loss?
if yes, can i use a policy to HA that queue?

thanks,
sean

-- 

Ce n'est pas une signature
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140703/03eedbed/attachment.html>

From simon at rabbitmq.com  Thu Jul  3 17:30:40 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 03 Jul 2014 17:30:40 +0100
Subject: [rabbitmq-discuss] federated exchange question
In-Reply-To: <CABm-Wmd7KvfmS0Q-BNrYYKyOwQhEFLdRfFaz=NSjSnZJ6dqGxQ@mail.gmail.com>
References: <CABm-Wmd7KvfmS0Q-BNrYYKyOwQhEFLdRfFaz=NSjSnZJ6dqGxQ@mail.gmail.com>
Message-ID: <53B58530.5050704@rabbitmq.com>

On 03/07/2014 5:23PM, Sean Allen wrote:
> i have an exchange A in cluster 1 that is being federated to cluster 2.
>
> that created a queue for said message on a node in cluster 1.
> if that node goes down, what happens? message loss?

Yes.

> if yes, can i use a policy to HA that queue?

Definitely, you are strongly advised to!

You probably also want to set multiple URLs for the cluster 1 upstream 
in cluster 2; then it will fail over whenever a node goes down in cluster 1.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From sean at monkeysnatchbanana.com  Fri Jul  4 03:55:18 2014
From: sean at monkeysnatchbanana.com (Sean Allen)
Date: Thu, 3 Jul 2014 22:55:18 -0400
Subject: [rabbitmq-discuss] federated exchange question
In-Reply-To: <53B58530.5050704@rabbitmq.com>
References: <CABm-Wmd7KvfmS0Q-BNrYYKyOwQhEFLdRfFaz=NSjSnZJ6dqGxQ@mail.gmail.com>
 <53B58530.5050704@rabbitmq.com>
Message-ID: <CABm-WmcffvjjTRfgv2AX4HOzGO6b3NohvDT-ftziLsjjOeLtOw@mail.gmail.com>

On Thu, Jul 3, 2014 at 12:30 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 03/07/2014 5:23PM, Sean Allen wrote:
>
>> i have an exchange A in cluster 1 that is being federated to cluster 2.
>>
>> that created a queue for said message on a node in cluster 1.
>> if that node goes down, what happens? message loss?
>>
>
> Yes.
>
>
>  if yes, can i use a policy to HA that queue?
>>
>
> Definitely, you are strongly advised to!
>
> You probably also want to set multiple URLs for the cluster 1 upstream in
> cluster 2; then it will fail over whenever a node goes down in cluster 1.
>
>
Thanks Simon,

Is there documentation beyond
https://www.rabbitmq.com/federated-exchanges.html that covers this?
Or a blog post?

-Sean-
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140703/991caa0e/attachment.html>

From rom.t.cabral at gmail.com  Fri Jul  4 07:14:08 2014
From: rom.t.cabral at gmail.com (Rom Cabral)
Date: Thu, 3 Jul 2014 23:14:08 -0700 (PDT)
Subject: [rabbitmq-discuss] Network Partition Configuration
Message-ID: <93ec9586-0784-4aaf-9ef1-dbd59c475842@googlegroups.com>

Hi guys,

I encountered a "Network Partition" after I configure my 3 vm to join a 
cluster. Upon reading the net, I found out about network partition and the 
different mode to handle the problem. However, I cannot find any 
documentation how to configure it to either autoheal or pause-minority.

Thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140703/36e15ce8/attachment.html>

From mklishin at gopivotal.com  Fri Jul  4 07:25:01 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 4 Jul 2014 10:25:01 +0400
Subject: [rabbitmq-discuss] Network Partition Configuration
In-Reply-To: <93ec9586-0784-4aaf-9ef1-dbd59c475842@googlegroups.com>
References: <93ec9586-0784-4aaf-9ef1-dbd59c475842@googlegroups.com>
Message-ID: <etPan.53b648db.643c9869.173bf@mercurio.local>

On 4 July 2014 at 10:16:21, Rom Cabral (rom.t.cabral at gmail.com) wrote:
> > I encountered a "Network Partition" after I configure my 3 vm 
> to join a cluster. Upon reading the net, I found out about network 
> partition and the different mode to handle the problem. However, 
> I cannot find any documentation how to configure it to either 
> autoheal or pause-minority.

See

http://hg.rabbitmq.com/rabbitmq-server/file/28354a2b240d/docs/rabbitmq.config.example#l206
http://www.rabbitmq.com/partitions.html
-- 
MK 

Staff Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Fri Jul  4 08:52:41 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 4 Jul 2014 11:52:41 +0400
Subject: [rabbitmq-discuss] [RUBY-AMQP GEM] How to enable hostname
 verification in auth ssl
In-Reply-To: <CAD_i5MEfpDX2Ss7niqENcUtzH3o2ABX8MmbonO-uZc4j0iJSrg@mail.gmail.com>
References: <CAD_i5MEfpDX2Ss7niqENcUtzH3o2ABX8MmbonO-uZc4j0iJSrg@mail.gmail.com>
Message-ID: <etPan.53b65d64.2ae8944a.173bf@mercurio.local>

?On 30 June 2014 at 10:47:00, Loganathan Sellapa (loganathan.ms at gmail.com) wrote:
> > Currently I am connecting to the RMQ Server from my Rails app  
> using SSL authentication mechanism. This is working fine, but  
> I want to enable the hostname verification while accepting SSL  
> connection from RMQ, what is the proper way to achieve this.  

Answered on the Ruby clients mailing list:

https://groups.google.com/forum/#!topic/ruby-amqp/29Xkej9GxZQ
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Fri Jul  4 08:53:22 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 4 Jul 2014 11:53:22 +0400
Subject: [rabbitmq-discuss] Rabbitmq.client 3.3.0 oddity (.NET)
In-Reply-To: <9da80042-07f4-4be5-8747-82fa78a5e845@googlegroups.com>
References: <9da80042-07f4-4be5-8747-82fa78a5e845@googlegroups.com>
Message-ID: <etPan.53b65d8e.238e1f29.173bf@mercurio.local>

?On 21 June 2014 at 03:04:20, Scott McFadden (scott.kendall.mcfadden at gmail.com) wrote:
> > Whe using IModel.BasicPublish to an invalid exchange you get  
> the following wonky error message:
>  
> The AMQP operation was interrupted: AMQP close-reason, initiated  
> by Application, code =200, text="Goodbye", class=0, methodId=0  
>  
> Took me a while but finally realized, I was attemping to publish  
> to an exchange that didn't exist (typo in exchange name). Fixed  
> the exchange name and it works great now.
>  
> Any way we could get a more helpful error message?

This sounds like a bug. You should get AlreadyClosedException from the connection.
We'll investigate.
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Fri Jul  4 08:55:17 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 4 Jul 2014 11:55:17 +0400
Subject: [rabbitmq-discuss] Feature Request: Copy Bindings To Another
 Queue In Management UI
In-Reply-To: <2a781459-aa3d-457d-b0eb-cee2e5d1b8ce@googlegroups.com>
References: <2a781459-aa3d-457d-b0eb-cee2e5d1b8ce@googlegroups.com>
Message-ID: <etPan.53b65e03.3d1b58ba.173bf@mercurio.local>

On 24 June 2014 at 16:56:02, Chris Haines (cjbhaines at gmail.com) wrote:
> > I would like to request a small feature in the Management UI to  
> be able to copy all of the bindings from one queue to another queue.  
> This is useful if I have a live queue that I want to inspect is receiving  
> the correct messages, I can just clone its bindings to a test queue  
> and see what it is reviving. This can be a bit tedious/slow in live  
> support scenarios when time is of the essence

I'm worried that this feature can be abused and cause fat finger errors but we will
consider adding it.?
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Fri Jul  4 08:57:29 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 4 Jul 2014 11:57:29 +0400
Subject: [rabbitmq-discuss] 3.3.4, web_stomp and ssl
In-Reply-To: <1403693749.7113.10.camel@s-rwysocki>
References: <1403692918.7113.5.camel@s-rwysocki>
 <etPan.53aaa835.66ef438d.143a2@mercurio.local>
 <1403693749.7113.10.camel@s-rwysocki>
Message-ID: <etPan.53b65e88.2eb141f2.173bf@mercurio.local>

On 25 June 2014 at 14:57:14, Robert Wysocki (robert.wysocki at unity.pl) wrote:
> > {rabbitmq_web_stomp,
> [{ssl_config, [{port, 15671},
> {backlog, 1024},
> {certfile, "/etc/ssl/certs/hostname.pl.pem"},
> {keyfile, "/etc/ssl/private/hostname.pl.key"},
> {cacertfile, "/etc/ssl/certs/cacert.pem"}
> ]
> }]

This is basically the config I use locally for development.

How do you find out that the TLS listener is not listening,
with netstat or similar? By trying to connect with a command line
client?
-- 
MK 

Staff Software Engineer, Pivotal/RabbitMQ

From DeepNightTwo at gmail.com  Fri Jul  4 09:34:46 2014
From: DeepNightTwo at gmail.com (DeepNightTwo)
Date: Fri, 4 Jul 2014 01:34:46 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ big queue load balance issue
Message-ID: <1404462886642-36690.post@n5.nabble.com>

My case need a big queue. But the sequence is not strictly needed. So I
trying to use the following solution to handle big queue:

Using a plug-in named random-exchange.
https://github.com/jbrisbin/random-exchange. It provide the feature to
distribute the incoming message randomly to an queue that bonded to the
exchange. 
Create a queue on each host of the cluster, like host1-q, host2-q...
Create an exchange named ex-loadbalance, binding these queues to the
exchange using exchange type "x-random"
client send message to exchange and the message will randomly goes to a
queue which hosted in the cluster's machine. 

My question is, is there a better way to handle the big queue requirement?
If not, is there an official plugin/exchange for "random distribute"? The
plugin is now working with latest rabbitmq 3.3.x. So I have to use 3.1.x
now. 

Thanks!





--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-big-queue-load-balance-issue-tp36690.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mklishin at gopivotal.com  Fri Jul  4 09:39:07 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 4 Jul 2014 12:39:07 +0400
Subject: [rabbitmq-discuss] RabbitMQ big queue load balance issue
In-Reply-To: <1404462886642-36690.post@n5.nabble.com>
References: <1404462886642-36690.post@n5.nabble.com>
Message-ID: <etPan.53b66846.79e2a9e3.173bf@mercurio.local>

On 4 July 2014 at 12:35:54, DeepNightTwo (deepnighttwo at gmail.com) wrote:
> > My question is, is there a better way to handle the big queue requirement?  
> If not, is there an official plugin/exchange for "random distribute"?  
> The
> plugin is now working with latest rabbitmq 3.3.x. So I have to  
> use 3.1.x
> now.

See consistent-hash exchange. It's less efficient than the most commonly used
built-in types (except the headers one) but should be good enough for a lot of cases.

Also, take a look at?http://blog.travis-ci.com/2013-08-08-solving-the-puzzle-of-scalable-log-processing/
? if you don't need message ordering, you don't really need a single queue and can get away
with N queues and N consumers having its own channel with the same basic.qos setting.?
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From videlalvaro at gmail.com  Fri Jul  4 11:47:57 2014
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 4 Jul 2014 12:47:57 +0200
Subject: [rabbitmq-discuss] RabbitMQ big queue load balance issue
In-Reply-To: <etPan.53b66846.79e2a9e3.173bf@mercurio.local>
References: <1404462886642-36690.post@n5.nabble.com>
 <etPan.53b66846.79e2a9e3.173bf@mercurio.local>
Message-ID: <CAMcAHLU6-kdQCTj4rkKx4-mzabwO-xeX_rvvmzbufL8DVruLTw@mail.gmail.com>

We also have the rabbitmq-sharding plugin. It's still on a experimental
stage, since we haven't heard of people using it. You can always be the
first ;-)

At some point we want to release some benchmarks for it.

See here: https://github.com/rabbitmq/rabbitmq-sharding

-Alvaro


On Fri, Jul 4, 2014 at 10:39 AM, Michael Klishin <mklishin at gopivotal.com>
wrote:

> On 4 July 2014 at 12:35:54, DeepNightTwo (deepnighttwo at gmail.com) wrote:
> > > My question is, is there a better way to handle the big queue
> requirement?
> > If not, is there an official plugin/exchange for "random distribute"?
> > The
> > plugin is now working with latest rabbitmq 3.3.x. So I have to
> > use 3.1.x
> > now.
>
> See consistent-hash exchange. It's less efficient than the most commonly
> used
> built-in types (except the headers one) but should be good enough for a
> lot of cases.
>
> Also, take a look at
> http://blog.travis-ci.com/2013-08-08-solving-the-puzzle-of-scalable-log-processing/
> ? if you don't need message ordering, you don't really need a single queue
> and can get away
> with N queues and N consumers having its own channel with the same
> basic.qos setting.
> --
> MK
>
> Staff Software Engineer, Pivotal/RabbitMQ
> _______________________________________________
> rabbitmq-discuss mailing list has moved to
> https://groups.google.com/forum/#!forum/rabbitmq-users,
> please subscribe to the new list!
>
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140704/97ce54b7/attachment.html>

From jsosic at gmail.com  Sat Jul  5 19:50:31 2014
From: jsosic at gmail.com (Jakov Sosic)
Date: Sat, 05 Jul 2014 20:50:31 +0200
Subject: [rabbitmq-discuss] Changing file descriptor limit without restart?
Message-ID: <53B848F7.6030205@gmail.com>

Hi guys,


I want to increase fs limit on my running RabbitMQ cluster.

I have tried doing something like:


From jsosic at gmail.com  Sat Jul  5 19:53:54 2014
From: jsosic at gmail.com (Jakov Sosic)
Date: Sat, 05 Jul 2014 20:53:54 +0200
Subject: [rabbitmq-discuss] Changing file descriptor limit wihtout restart?
Message-ID: <53B849C2.8040909@gmail.com>

Hi guys


I want to increase file descriptor limit (ulimit -n) on my running 
RabbitMQ cluster.

I know I can do it by setting up limits.conf and restarting RabbitMQ 
nodes but I would prefer to do it without node downtime if possible.

What I tried was:

# echo -n "Max open files=4096:4096" > /proc/$(cat 
/var/run/rabbitmq/pid)/limits

but rabbitmqctl still shows lower value:

# rabbitmqctl status | grep -A 2 file_descriptors
  {file_descriptors,
      [{total_limit,924},
       {total_used,163},


Where is this total limit of 924 coming from at first place?!

Process itself seems to accepted the increase :

# grep -i open /proc/$(cat /var/run/rabbitmq/pid)/limits
Max open files          4096               4096               files

From mklishin at gopivotal.com  Sat Jul  5 19:58:07 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Sat, 5 Jul 2014 22:58:07 +0400
Subject: [rabbitmq-discuss] Changing file descriptor limit wihtout
 restart?
In-Reply-To: <53B849C2.8040909@gmail.com>
References: <53B849C2.8040909@gmail.com>
Message-ID: <etPan.53b84ad9.19495cff.cc3d@mercurio.local>

On 5 July 2014 at 22:56:11, Jakov Sosic (jsosic at gmail.com) wrote:
> > I know I can do it by setting up limits.conf and restarting RabbitMQ  
> nodes but I would prefer to do it without node downtime if possible.  

ulimit changes will only be effective after OS process restart.
This is true for all processes, RabbitMQ or not.?
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From jsosic at gmail.com  Sat Jul  5 21:26:26 2014
From: jsosic at gmail.com (Jakov Sosic)
Date: Sat, 05 Jul 2014 22:26:26 +0200
Subject: [rabbitmq-discuss] Changing file descriptor limit wihtout
	restart?
In-Reply-To: <etPan.53b84ad9.19495cff.cc3d@mercurio.local>
References: <53B849C2.8040909@gmail.com>
 <etPan.53b84ad9.19495cff.cc3d@mercurio.local>
Message-ID: <53B85F72.5020903@gmail.com>

On 07/05/2014 08:58 PM, Michael Klishin wrote:
> On 5 July 2014 at 22:56:11, Jakov Sosic (jsosic at gmail.com) wrote:
>>> I know I can do it by setting up limits.conf and restarting RabbitMQ
>> nodes but I would prefer to do it without node downtime if possible.
>
> ulimit changes will only be effective after OS process restart.
> This is true for all processes, RabbitMQ or not.

What about write-able limits and prlimit(2)?

Although it seems writeable limits is not affecting running programs, at 
least not on CentOS 6... I have written small C program to verify this:

#include <stdio.h>
#include <limits.h>
#include <unistd.h>

int main(){
	int i=sysconf(_SC_OPEN_MAX);
	int n=0;

	while(n<1000){
		n++;
		printf("Max open files: %d\n", i);
		sleep(5);
	}
	return 0;
}


but, after running it and increasing ulimit via

echo -n "Max open files=4096:4096" > /proc/<pid>/limits

program still reports 1024 :-/

From tonygarnockjones+rabbitmq at gmail.com  Sat Jul  5 22:40:27 2014
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Sat, 5 Jul 2014 17:40:27 -0400
Subject: [rabbitmq-discuss] Changing file descriptor limit wihtout
	restart?
In-Reply-To: <53B85F72.5020903@gmail.com>
References: <53B849C2.8040909@gmail.com>
 <etPan.53b84ad9.19495cff.cc3d@mercurio.local>
 <53B85F72.5020903@gmail.com>
Message-ID: <CAM8fPiSZtrDkCcJMCAHW6PgWPMhTEG=hxtbvhoqKb2EuAsKdvQ@mail.gmail.com>

Try putting the call to sysconf() inside the loop.


On 5 July 2014 16:26, Jakov Sosic <jsosic at gmail.com> wrote:

> On 07/05/2014 08:58 PM, Michael Klishin wrote:
>
>> On 5 July 2014 at 22:56:11, Jakov Sosic (jsosic at gmail.com) wrote:
>>
>>> I know I can do it by setting up limits.conf and restarting RabbitMQ
>>>>
>>> nodes but I would prefer to do it without node downtime if possible.
>>>
>>
>> ulimit changes will only be effective after OS process restart.
>> This is true for all processes, RabbitMQ or not.
>>
>
> What about write-able limits and prlimit(2)?
>
> Although it seems writeable limits is not affecting running programs, at
> least not on CentOS 6... I have written small C program to verify this:
>
> #include <stdio.h>
> #include <limits.h>
> #include <unistd.h>
>
> int main(){
>         int i=sysconf(_SC_OPEN_MAX);
>         int n=0;
>
>         while(n<1000){
>                 n++;
>                 printf("Max open files: %d\n", i);
>                 sleep(5);
>         }
>         return 0;
> }
>
>
> but, after running it and increasing ulimit via
>
> echo -n "Max open files=4096:4096" > /proc/<pid>/limits
>
> program still reports 1024 :-/
> _______________________________________________
> rabbitmq-discuss mailing list has moved to https://groups.google.com/
> forum/#!forum/rabbitmq-users,
> please subscribe to the new list!
>
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Tony Garnock-Jones
tonygarnockjones at gmail.com
http://homepages.kcbbs.gen.nz/tonyg/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140705/be0bd61b/attachment.html>

From jsosic at gmail.com  Sun Jul  6 00:03:29 2014
From: jsosic at gmail.com (Jakov Sosic)
Date: Sun, 06 Jul 2014 01:03:29 +0200
Subject: [rabbitmq-discuss] Changing file descriptor limit wihtout
	restart?
In-Reply-To: <CAM8fPiSZtrDkCcJMCAHW6PgWPMhTEG=hxtbvhoqKb2EuAsKdvQ@mail.gmail.com>
References: <53B849C2.8040909@gmail.com>
 <etPan.53b84ad9.19495cff.cc3d@mercurio.local> <53B85F72.5020903@gmail.com>
 <CAM8fPiSZtrDkCcJMCAHW6PgWPMhTEG=hxtbvhoqKb2EuAsKdvQ@mail.gmail.com>
Message-ID: <53B88441.6060006@gmail.com>

On 07/05/2014 11:40 PM, Tony Garnock-Jones wrote:
> Try putting the call to sysconf() inside the loop.

That's what happens when you don't get much sleep :)


Anyway it works:

Max open files: 1024
Max open files: 2048
Max open files: 2048
Max open files: 4096


which brings us back to original question, is there a way to increase 
the descriptor limit for running RabbitMQ server? Is there a way for 
ERLang process to figure out limits have changed?

From mklishin at gopivotal.com  Mon Jul  7 10:09:39 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 7 Jul 2014 13:09:39 +0400
Subject: [rabbitmq-discuss] [ Listen event when queue destroy from
 client ]
In-Reply-To: <CAJGFNjQvU55hSBAFaHeTDPg099M3V-nSCd3SU7_C+2Tbsyy4Yg@mail.gmail.com>
References: <CAJGFNjSBkkWnLdp1w5=01hZoObEWX+qdqAyrB3h5oiA-TPgxKA@mail.gmail.com>
 <etPan.53b51d7e.643c9869.60b3@mercurio.local>
 <CAJGFNjQvU55hSBAFaHeTDPg099M3V-nSCd3SU7_C+2Tbsyy4Yg@mail.gmail.com>
Message-ID: <etPan.53ba63ef.2ae8944a.1fb1@mercurio.local>

+rabbitmq-discuss. Also, please start a new thread for new questions.

On 7 July 2014 at 13:05:15, Hitesh Dobariya (hitesh at artoonsolutions.com) wrote:
> > Is this correct code, please reply i am not getting any event  
> on this. i checked with management plugin & exchange is appearing  
> on the panel but i am not receiving any event on queue.

Is the message rate on the exchange > 0 when you declare/delete queues?

> connection.queue("eventListener", function(queue){
> queue.bind("amq.rabbitmq.event",'#');
>  
> queue.subscribe(function (message, headers, deliveryInfo,  
> messageObject) {
> console.log(deliveryInfo);
> })
>  
> });

What client do you use? The code looks reasonable.?
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From hitesh at artoonsolutions.com  Mon Jul  7 10:11:19 2014
From: hitesh at artoonsolutions.com (Hitesh Dobariya)
Date: Mon, 7 Jul 2014 14:41:19 +0530
Subject: [rabbitmq-discuss] [ Listen event when queue destroy from
	client ]
In-Reply-To: <etPan.53ba63ef.2ae8944a.1fb1@mercurio.local>
References: <CAJGFNjSBkkWnLdp1w5=01hZoObEWX+qdqAyrB3h5oiA-TPgxKA@mail.gmail.com>
 <etPan.53b51d7e.643c9869.60b3@mercurio.local>
 <CAJGFNjQvU55hSBAFaHeTDPg099M3V-nSCd3SU7_C+2Tbsyy4Yg@mail.gmail.com>
 <etPan.53ba63ef.2ae8944a.1fb1@mercurio.local>
Message-ID: <CAJGFNjRVYN0i6P_EU+OzHhKcB5pVE5fNqRfKAj9vt3ZN+p3ECg@mail.gmail.com>

I am using node-amqp as server and android as client.


On Mon, Jul 7, 2014 at 2:39 PM, Michael Klishin <mklishin at gopivotal.com>
wrote:

> +rabbitmq-discuss. Also, please start a new thread for new questions.
>
> On 7 July 2014 at 13:05:15, Hitesh Dobariya (hitesh at artoonsolutions.com)
> wrote:
> > > Is this correct code, please reply i am not getting any event
> > on this. i checked with management plugin & exchange is appearing
> > on the panel but i am not receiving any event on queue.
>
> Is the message rate on the exchange > 0 when you declare/delete queues?
>
> > connection.queue("eventListener", function(queue){
> > queue.bind("amq.rabbitmq.event",'#');
> >
> > queue.subscribe(function (message, headers, deliveryInfo,
> > messageObject) {
> > console.log(deliveryInfo);
> > })
> >
> > });
>
> What client do you use? The code looks reasonable.
> --
> MK
>
> Staff Software Engineer, Pivotal/RabbitMQ
>



-- 
*Thanks,*
Hitesh Dobariya,
Artoon Solutions PVT. LTD
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140707/ea54d877/attachment.html>

From mklishin at gopivotal.com  Mon Jul  7 10:22:03 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 7 Jul 2014 13:22:03 +0400
Subject: [rabbitmq-discuss] [ Listen event when queue destroy from
 client ]
In-Reply-To: <CAJGFNjRVYN0i6P_EU+OzHhKcB5pVE5fNqRfKAj9vt3ZN+p3ECg@mail.gmail.com>
References: <CAJGFNjSBkkWnLdp1w5=01hZoObEWX+qdqAyrB3h5oiA-TPgxKA@mail.gmail.com>
 <etPan.53b51d7e.643c9869.60b3@mercurio.local>
 <CAJGFNjQvU55hSBAFaHeTDPg099M3V-nSCd3SU7_C+2Tbsyy4Yg@mail.gmail.com>
 <etPan.53ba63ef.2ae8944a.1fb1@mercurio.local>
 <CAJGFNjRVYN0i6P_EU+OzHhKcB5pVE5fNqRfKAj9vt3ZN+p3ECg@mail.gmail.com>
Message-ID: <etPan.53ba66d4.625558ec.1fb1@mercurio.local>

?On 7 July 2014 at 13:12:55, Hitesh Dobariya (hitesh at artoonsolutions.com) wrote:
> > I am using node-amqp as server and android as client.

Using a loop that declares and deletes 2 queues per second, I can confirm
that rabbitmq_event_exchange works as advertised with amqplib [1] for me:

http://monosnap.com/image/riTPDb4nttHV6mCxFm6X6Ckn2A9jpD

My code:?https://gist.github.com/michaelklishin/5d951eda6fb84f88eca2

node.amqp is not really maintained and has opinionated features that cause confusion
from time to time. Use amqplib if you can.

1.?https://github.com/squaremo/amqp.node/
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Mon Jul  7 10:31:09 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 7 Jul 2014 13:31:09 +0400
Subject: [rabbitmq-discuss] [ Listen event when queue destroy from
 client ]
In-Reply-To: <etPan.53ba66d4.625558ec.1fb1@mercurio.local>
References: <CAJGFNjSBkkWnLdp1w5=01hZoObEWX+qdqAyrB3h5oiA-TPgxKA@mail.gmail.com>
 <etPan.53b51d7e.643c9869.60b3@mercurio.local>
 <CAJGFNjQvU55hSBAFaHeTDPg099M3V-nSCd3SU7_C+2Tbsyy4Yg@mail.gmail.com>
 <etPan.53ba63ef.2ae8944a.1fb1@mercurio.local>
 <CAJGFNjRVYN0i6P_EU+OzHhKcB5pVE5fNqRfKAj9vt3ZN+p3ECg@mail.gmail.com>
 <etPan.53ba66d4.625558ec.1fb1@mercurio.local>
Message-ID: <etPan.53ba68fb.46e87ccd.1fb1@mercurio.local>

On 7 July 2014 at 13:23:48, Michael Klishin (mklishin at gopivotal.com) wrote:
> > My code: https://gist.github.com/michaelklishin/5d951eda6fb84f88eca2  

And a better version that outputs events in a readable for:
https://gist.github.com/michaelklishin/72e1fce9b7ef7349212f?
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From simon at rabbitmq.com  Mon Jul  7 10:35:49 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 07 Jul 2014 10:35:49 +0100
Subject: [rabbitmq-discuss] Changing file descriptor limit wihtout
	restart?
In-Reply-To: <53B88441.6060006@gmail.com>
References: <53B849C2.8040909@gmail.com>
 <etPan.53b84ad9.19495cff.cc3d@mercurio.local> <53B85F72.5020903@gmail.com>
 <CAM8fPiSZtrDkCcJMCAHW6PgWPMhTEG=hxtbvhoqKb2EuAsKdvQ@mail.gmail.com>
 <53B88441.6060006@gmail.com>
Message-ID: <53BA69F5.8010005@rabbitmq.com>

On 06/07/2014 12:03AM, Jakov Sosic wrote:
> which brings us back to original question, is there a way to increase
> the descriptor limit for running RabbitMQ server? Is there a way for
> ERLang process to figure out limits have changed?

It's not Erlang, it's RabbitMQ. The problem is that the file handle 
cache (the component which manages file descriptors inside the broker) 
only checks the limit at startup.

But you can tell it the limit has changed with something like:

$ rabbitmqctl eval 'file_handle_cache:set_limit(4096).'

BIG FAT WARNING:

This number is not validated; it's taken entirely on trust. If you tell 
the FHC that it has a larger limit than the one the OS will enforce, you 
can run out of file descriptors and crash the server.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Mon Jul  7 10:37:38 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 07 Jul 2014 10:37:38 +0100
Subject: [rabbitmq-discuss] Feature Request: Copy Bindings To Another
 Queue In Management UI
In-Reply-To: <etPan.53b65e03.3d1b58ba.173bf@mercurio.local>
References: <2a781459-aa3d-457d-b0eb-cee2e5d1b8ce@googlegroups.com>
 <etPan.53b65e03.3d1b58ba.173bf@mercurio.local>
Message-ID: <53BA6A62.6040808@rabbitmq.com>

On 04/07/2014 8:55AM, Michael Klishin wrote:
> On 24 June 2014 at 16:56:02, Chris Haines (cjbhaines at gmail.com) wrote:
>>> I would like to request a small feature in the Management UI to
>> be able to copy all of the bindings from one queue to another queue.
>> This is useful if I have a live queue that I want to inspect is receiving
>> the correct messages, I can just clone its bindings to a test queue
>> and see what it is reviving. This can be a bit tedious/slow in live
>> support scenarios when time is of the essence
>
> I'm worried that this feature can be abused and cause fat finger errors but we will
> consider adding it.

This is of course the sort of thing that could be done very easily by a 
script outside the broker talking to the HTTP API.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From DeepNightTwo at gmail.com  Mon Jul  7 11:19:54 2014
From: DeepNightTwo at gmail.com (DeepNightTwo)
Date: Mon, 7 Jul 2014 03:19:54 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ big queue load balance issue
In-Reply-To: <CAMcAHLU6-kdQCTj4rkKx4-mzabwO-xeX_rvvmzbufL8DVruLTw@mail.gmail.com>
References: <1404462886642-36690.post@n5.nabble.com>
 <etPan.53b66846.79e2a9e3.173bf@mercurio.local>
 <CAMcAHLU6-kdQCTj4rkKx4-mzabwO-xeX_rvvmzbufL8DVruLTw@mail.gmail.com>
Message-ID: <1404728394410-36710.post@n5.nabble.com>

This seems very COOL. 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-big-queue-load-balance-issue-tp36690p36710.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From DeepNightTwo at gmail.com  Mon Jul  7 11:21:36 2014
From: DeepNightTwo at gmail.com (DeepNightTwo)
Date: Mon, 7 Jul 2014 03:21:36 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ big queue load balance issue
In-Reply-To: <CAMcAHLU6-kdQCTj4rkKx4-mzabwO-xeX_rvvmzbufL8DVruLTw@mail.gmail.com>
References: <1404462886642-36690.post@n5.nabble.com>
 <etPan.53b66846.79e2a9e3.173bf@mercurio.local>
 <CAMcAHLU6-kdQCTj4rkKx4-mzabwO-xeX_rvvmzbufL8DVruLTw@mail.gmail.com>
Message-ID: <1404728496653-36711.post@n5.nabble.com>

Thanks! This can replace the exchange I used now. 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-big-queue-load-balance-issue-tp36690p36711.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mklishin at gopivotal.com  Mon Jul  7 13:19:13 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 7 Jul 2014 16:19:13 +0400
Subject: [rabbitmq-discuss] [ Listen event when queue destroy from
 client ]
In-Reply-To: <CAJGFNjTsuGU6d9Y4eOa1TbGwCqKPVmAZqjPSizhgB1TvoiVbrA@mail.gmail.com>
References: <CAJGFNjSBkkWnLdp1w5=01hZoObEWX+qdqAyrB3h5oiA-TPgxKA@mail.gmail.com>
 <etPan.53b51d7e.643c9869.60b3@mercurio.local>
 <CAJGFNjQvU55hSBAFaHeTDPg099M3V-nSCd3SU7_C+2Tbsyy4Yg@mail.gmail.com>
 <etPan.53ba63ef.2ae8944a.1fb1@mercurio.local>
 <CAJGFNjRVYN0i6P_EU+OzHhKcB5pVE5fNqRfKAj9vt3ZN+p3ECg@mail.gmail.com>
 <etPan.53ba66d4.625558ec.1fb1@mercurio.local>
 <etPan.53ba68fb.46e87ccd.1fb1@mercurio.local>
 <CAJGFNjSWphzC7=1ncRDUuMmNafUOh3VvTMDqtVUfrYmjewrTRw@mail.gmail.com>
 <CAJGFNjTsuGU6d9Y4eOa1TbGwCqKPVmAZqjPSizhgB1TvoiVbrA@mail.gmail.com>
Message-ID: <etPan.53ba905e.7545e146.1fb1@mercurio.local>

+rabbitmq-discuss

On 7 July 2014 at 14:23:52, Hitesh Dobariya (hitesh at artoonsolutions.com) wrote:
> > This code is not working. Please check code that i am sending  
> you.

Except that it does but you have a condition in the consumer that filters out deliveries
from amq.rabbitmq.event.

Change your consumer to

queue.subscribe(function (message, headers, deliveryInfo, messageObject) {
? console.log(JSON.stringify(headers));
});

and you will see event info printed.?
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From mzraly at gmail.com  Mon Jul  7 12:30:40 2014
From: mzraly at gmail.com (Mike Zraly)
Date: Mon, 7 Jul 2014 04:30:40 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmqctl start_app hangs when replacing
 mirrored cluster instances in EC2
Message-ID: <d651f7cc-1ff6-4451-87a6-e912d4aa0f2e@googlegroups.com>

[I tried posting this to the new group, rabbitmq-users, but got no 
response.  Google groups tells me rabbitmq-users only has 101 members now, 
compared to 1800 or so for rabbitmq-discuss, so I hope re-posting to the 
larger group will at least elicit some (non-meta) feedback.]

Hi all,

I am setting up a RabbitMQ cluster in an Amazon EC2 region.  Each host is 
in the same geographical region, so I do not expect network partitions in 
the sense that two members of the cluster are both running but cannot 
communicate with each other.  However it is reasonable to expect individual 
cluster hosts to be terminated and replaced with new hosts having the same 
hostname but a new IP address and a fresh install of RabbitMQ.  A typical 
use case for this is a rolling upgrade where we keep 2 of the 3 cluster 
nodes up at all times to continue providing service during the upgrade 
period.

What I hope is that the same post-install provisioning script that joins a 
newly created instance into the cluster will work for the new instance that 
is taking over for an older one.  What I am seeing is rabbitmqctl start_app 
hang.

The installation sequence is basically this:

install rabbitmq-server_3.3.1-1
enable management plugin
add health check user account with monitoring tag
add application user account
add HA policy '{"ha-mode": "all", "ha-sync-mode": "automatic"} for all 
application queues
service rabbitmq-server stop
set /var/lib/rabbitmq/.erlang.cookie
reboot system (restarting rabbitmq server)
for each hostname 'target' that this host should join into a cluster with:
    if target is listening on port 5672
        rabbitmqctl stop_app
        if rabbitmqctl join_cluster target has non-zero exit status
            rabbitmqctl start_app

What I see if I start a cluster with hosts A, B, and C, then terminate 
instance C and replace it with a new instance that executes these same 
steps, is that rabbitmqctl join_cluster succeeds saying C is already part 
of the cluster, then rabbitmqctl start_app hangs.

What am I doing wrong?

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140707/be95dce0/attachment.html>

From mklishin at gopivotal.com  Mon Jul  7 13:29:52 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 7 Jul 2014 16:29:52 +0400
Subject: [rabbitmq-discuss] [ Listen event when queue destroy from
 client ]
In-Reply-To: <CAJGFNjQj-h4Y02VRmt2RwH9h0w9NbLDaoeVG-QyXTL=FXtZ6QA@mail.gmail.com>
References: <CAJGFNjSBkkWnLdp1w5=01hZoObEWX+qdqAyrB3h5oiA-TPgxKA@mail.gmail.com>
 <etPan.53b51d7e.643c9869.60b3@mercurio.local>
 <CAJGFNjQvU55hSBAFaHeTDPg099M3V-nSCd3SU7_C+2Tbsyy4Yg@mail.gmail.com>
 <etPan.53ba63ef.2ae8944a.1fb1@mercurio.local>
 <CAJGFNjRVYN0i6P_EU+OzHhKcB5pVE5fNqRfKAj9vt3ZN+p3ECg@mail.gmail.com>
 <etPan.53ba66d4.625558ec.1fb1@mercurio.local>
 <etPan.53ba68fb.46e87ccd.1fb1@mercurio.local>
 <CAJGFNjSWphzC7=1ncRDUuMmNafUOh3VvTMDqtVUfrYmjewrTRw@mail.gmail.com>
 <CAJGFNjTsuGU6d9Y4eOa1TbGwCqKPVmAZqjPSizhgB1TvoiVbrA@mail.gmail.com>
 <etPan.53ba905e.7545e146.1fb1@mercurio.local>
 <CAJGFNjQj-h4Y02VRmt2RwH9h0w9NbLDaoeVG-QyXTL=FXtZ6QA@mail.gmail.com>
Message-ID: <etPan.53ba92de.515f007c.1fb1@mercurio.local>

+rabbitmq-discuss: please, please CC the mailing list.

On 7 July 2014 at 16:25:26, Hitesh Dobariya (hitesh at artoonsolutions.com) wrote:
> > is it working only on local server? i added this code in amqp.js  
> file as you mentioned in previous mail. but still i am not getting  
> any other event like queue.created, queue.deleted etc on the  
> amqp.js.

It should not matter whether RabbitMQ node is local or not. I highly recommend
not using passive declares unless you get comfortable with the code. Right now
your scripts depend on their start order, for example.

I only modified queue.js. I see the same code commented out in amqp.js, both sharing
a queue. If you want *both* consumers to get a message copy, you need to use two queues.

See?http://www.rabbitmq.com/getstarted.html and?http://www.rabbitmq.com/tutorials/amqp-concepts.html
if this is not clear.
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From hitesh at artoonsolutions.com  Mon Jul  7 13:45:56 2014
From: hitesh at artoonsolutions.com (Hitesh Dobariya)
Date: Mon, 7 Jul 2014 18:15:56 +0530
Subject: [rabbitmq-discuss] [ Listen event when queue destroy from
	client ]
In-Reply-To: <etPan.53ba92de.515f007c.1fb1@mercurio.local>
References: <CAJGFNjSBkkWnLdp1w5=01hZoObEWX+qdqAyrB3h5oiA-TPgxKA@mail.gmail.com>
 <etPan.53b51d7e.643c9869.60b3@mercurio.local>
 <CAJGFNjQvU55hSBAFaHeTDPg099M3V-nSCd3SU7_C+2Tbsyy4Yg@mail.gmail.com>
 <etPan.53ba63ef.2ae8944a.1fb1@mercurio.local>
 <CAJGFNjRVYN0i6P_EU+OzHhKcB5pVE5fNqRfKAj9vt3ZN+p3ECg@mail.gmail.com>
 <etPan.53ba66d4.625558ec.1fb1@mercurio.local>
 <etPan.53ba68fb.46e87ccd.1fb1@mercurio.local>
 <CAJGFNjSWphzC7=1ncRDUuMmNafUOh3VvTMDqtVUfrYmjewrTRw@mail.gmail.com>
 <CAJGFNjTsuGU6d9Y4eOa1TbGwCqKPVmAZqjPSizhgB1TvoiVbrA@mail.gmail.com>
 <etPan.53ba905e.7545e146.1fb1@mercurio.local>
 <CAJGFNjQj-h4Y02VRmt2RwH9h0w9NbLDaoeVG-QyXTL=FXtZ6QA@mail.gmail.com>
 <etPan.53ba92de.515f007c.1fb1@mercurio.local>
Message-ID: <CAJGFNjS5UxNUNcZ5E9SWATbqTUtaraf4TywsmESDJYBC8LqMjg@mail.gmail.com>

I don't want listen both queue, i think i have describe you briefly what i
want to achieve.

1) Amqp.js : This is the server in nodejs. when user connect to server.
server will generate the queue, and tell client to listen to that queue in
passive mode. in short client don't have access for create queue. if i will
listen from both side then queue will not destroy automatically becuase my
server (amqp.js) file's queue consuming it. so i want that when client
(queue.js) killed or close. at that time server will notify that queue is
destroyed, and i will get all data like routing key when it destroy.

Whereas *amq.rabbitmq.event *is the exchange, that will monitor all the the
events.
*connection.queue("eventListener", { exclusive: true } ,  function(q){*
 * q.bind("amq.rabbitmq.event","");*

* //i want to listen all events here when queue destroy when client app
killed.*
* q.subscribe(function (message, headers, deliveryInfo, messageObject) {*
* console.log(JSON.stringify(headers));*
*  })*
* });*

Above code will generate queue that will listen all the event like exchange
create, exchange delete, binding, queue created, queue delete, etc..
I read in the documentation of the amqp-event plugin that it will deliver
all the event which are happing to all exchanges on the rabbitmq server.


2) queue.js : it is the simple client that have only read access to queue
in passive mode only. if any event goes to this client like queue delete
then it's not helpful to me.
My main purpose is to listen event and get message when queue.js will be
killed or application killed in android.

Hope you understand. if you made any correction in my file then please send
it to me with correction.



On Mon, Jul 7, 2014 at 5:59 PM, Michael Klishin <mklishin at gopivotal.com>
wrote:

> +rabbitmq-discuss: please, please CC the mailing list.
>
> On 7 July 2014 at 16:25:26, Hitesh Dobariya (hitesh at artoonsolutions.com)
> wrote:
> > > is it working only on local server? i added this code in amqp.js
> > file as you mentioned in previous mail. but still i am not getting
> > any other event like queue.created, queue.deleted etc on the
> > amqp.js.
>
> It should not matter whether RabbitMQ node is local or not. I highly
> recommend
> not using passive declares unless you get comfortable with the code. Right
> now
> your scripts depend on their start order, for example.
>
> I only modified queue.js. I see the same code commented out in amqp.js,
> both sharing
> a queue. If you want *both* consumers to get a message copy, you need to
> use two queues.
>
> See http://www.rabbitmq.com/getstarted.html and
> http://www.rabbitmq.com/tutorials/amqp-concepts.html
> if this is not clear.
> --
> MK
>
> Staff Software Engineer, Pivotal/RabbitMQ
>



-- 
*Thanks,*
Hitesh Dobariya,
Artoon Solutions PVT. LTD
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140707/ce09f715/attachment.html>

From mklishin at gopivotal.com  Mon Jul  7 13:56:33 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 7 Jul 2014 16:56:33 +0400
Subject: [rabbitmq-discuss] [ Listen event when queue destroy from
 client ]
In-Reply-To: <CAJGFNjS5UxNUNcZ5E9SWATbqTUtaraf4TywsmESDJYBC8LqMjg@mail.gmail.com>
References: <CAJGFNjSBkkWnLdp1w5=01hZoObEWX+qdqAyrB3h5oiA-TPgxKA@mail.gmail.com>
 <etPan.53b51d7e.643c9869.60b3@mercurio.local>
 <CAJGFNjQvU55hSBAFaHeTDPg099M3V-nSCd3SU7_C+2Tbsyy4Yg@mail.gmail.com>
 <etPan.53ba63ef.2ae8944a.1fb1@mercurio.local>
 <CAJGFNjRVYN0i6P_EU+OzHhKcB5pVE5fNqRfKAj9vt3ZN+p3ECg@mail.gmail.com>
 <etPan.53ba66d4.625558ec.1fb1@mercurio.local>
 <etPan.53ba68fb.46e87ccd.1fb1@mercurio.local>
 <CAJGFNjSWphzC7=1ncRDUuMmNafUOh3VvTMDqtVUfrYmjewrTRw@mail.gmail.com>
 <CAJGFNjTsuGU6d9Y4eOa1TbGwCqKPVmAZqjPSizhgB1TvoiVbrA@mail.gmail.com>
 <etPan.53ba905e.7545e146.1fb1@mercurio.local>
 <CAJGFNjQj-h4Y02VRmt2RwH9h0w9NbLDaoeVG-QyXTL=FXtZ6QA@mail.gmail.com>
 <etPan.53ba92de.515f007c.1fb1@mercurio.local>
 <CAJGFNjS5UxNUNcZ5E9SWATbqTUtaraf4TywsmESDJYBC8LqMjg@mail.gmail.com>
Message-ID: <etPan.53ba991a.12200854.1fb1@mercurio.local>



On 7 July 2014 at 16:46:36, Hitesh Dobariya (hitesh at artoonsolutions.com) wrote:
> > 1) Amqp.js : This is the server in nodejs. when user connect to  
> server. server will generate the queue, and tell client to listen  
> to that queue in passive mode. in short client don't have access  
> for create queue. if i will listen from both side then queue will  
> not destroy automatically becuase my server (amqp.js) file's  
> queue consuming it. so i want that when client (queue.js) killed  
> or close. at that time server will notify that queue is destroyed,  
> and i will get all data like routing key when it destroy.

I think it's worth clarifying a few things. You do not consume in passive mode:
queue.declare is what takes the passive argument. If you want the server to generate
queue name and send it to the client for whatever reason, the use of
passive declare is fine.

>  
> Whereas amq.rabbitmq.event is the exchange, that will monitor  
> all the the events.
> connection.queue("eventListener", { exclusive: true } , function(q){  
> q.bind("amq.rabbitmq.event","");
>  
> //i want to listen all events here when queue destroy when client  
> app killed.
> q.subscribe(function (message, headers, deliveryInfo, messageObject)  
> {
> console.log(JSON.stringify(headers));
> })
> });

Two things that stand out: you bind using an empty routing key and not
"#". Perhaps that's just a typo.

If a client is "destroyed" (I assume it means it has disconnected, hibernated,
otherwise lost connection), only exclusive or auto-delete queues that had consumers
will be deleted. But then amq.rabbitmq.event will not have a message published
because it only tracks explicit queue.delete calls (I'm pretty sure this is the case but
Simon can correct me).

>  
> Above code will generate queue that will listen all the event  
> like exchange create, exchange delete, binding, queue created,  
> queue delete, etc..
> I read in the documentation of the amqp-event plugin that it will  
> deliver all the event which are happing to all exchanges on the  
> rabbitmq server.

Yes but this will not include queues deleted due to TTL, disconnect of
an exclusive queue owner, etc.

> 2) queue.js : it is the simple client that have only read access  
> to queue in passive mode only. if any event goes to this client  
> like queue delete then it's not helpful to me.

> My main purpose is to listen event and get message when queue.js  
> will be killed or application killed in android.

So your problem is effectively a presence one. This brings us back to
square one:

?If your problem is primarily client presence detection, there's presence exchange:?
https://github.com/tonyg/presence-exchange.?

?Note that RabbitMQ is not the optimal solution for tracking client presence.
Consider using a tool such as ZooKeeper or Redis.
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From hitesh at artoonsolutions.com  Mon Jul  7 14:12:25 2014
From: hitesh at artoonsolutions.com (Hitesh Dobariya)
Date: Mon, 7 Jul 2014 18:42:25 +0530
Subject: [rabbitmq-discuss] [ Listen event when queue destroy from
	client ]
In-Reply-To: <etPan.53ba991a.12200854.1fb1@mercurio.local>
References: <CAJGFNjSBkkWnLdp1w5=01hZoObEWX+qdqAyrB3h5oiA-TPgxKA@mail.gmail.com>
 <etPan.53b51d7e.643c9869.60b3@mercurio.local>
 <CAJGFNjQvU55hSBAFaHeTDPg099M3V-nSCd3SU7_C+2Tbsyy4Yg@mail.gmail.com>
 <etPan.53ba63ef.2ae8944a.1fb1@mercurio.local>
 <CAJGFNjRVYN0i6P_EU+OzHhKcB5pVE5fNqRfKAj9vt3ZN+p3ECg@mail.gmail.com>
 <etPan.53ba66d4.625558ec.1fb1@mercurio.local>
 <etPan.53ba68fb.46e87ccd.1fb1@mercurio.local>
 <CAJGFNjSWphzC7=1ncRDUuMmNafUOh3VvTMDqtVUfrYmjewrTRw@mail.gmail.com>
 <CAJGFNjTsuGU6d9Y4eOa1TbGwCqKPVmAZqjPSizhgB1TvoiVbrA@mail.gmail.com>
 <etPan.53ba905e.7545e146.1fb1@mercurio.local>
 <CAJGFNjQj-h4Y02VRmt2RwH9h0w9NbLDaoeVG-QyXTL=FXtZ6QA@mail.gmail.com>
 <etPan.53ba92de.515f007c.1fb1@mercurio.local>
 <CAJGFNjS5UxNUNcZ5E9SWATbqTUtaraf4TywsmESDJYBC8LqMjg@mail.gmail.com>
 <etPan.53ba991a.12200854.1fb1@mercurio.local>
Message-ID: <CAJGFNjSZCJuPhyYCsP3Nt9EhJ4rho=zcXwVUJ1pL9eSbd-1gnQ@mail.gmail.com>

So according to your suggestion i have to use socket.io, or redis right?
code that i sent will never work to detect client has been killed or not.

Demo that i sent you on prior mail, when i am killing the queue.js file
from node server it will automatically deleted the queue.

Well thanks for quick reply. i have to think another way to accomplish my
requirement + you link for presence exchange is not working. :(


On Mon, Jul 7, 2014 at 6:26 PM, Michael Klishin <mklishin at gopivotal.com>
wrote:

>
>
> On 7 July 2014 at 16:46:36, Hitesh Dobariya (hitesh at artoonsolutions.com)
> wrote:
> > > 1) Amqp.js : This is the server in nodejs. when user connect to
> > server. server will generate the queue, and tell client to listen
> > to that queue in passive mode. in short client don't have access
> > for create queue. if i will listen from both side then queue will
> > not destroy automatically becuase my server (amqp.js) file's
> > queue consuming it. so i want that when client (queue.js) killed
> > or close. at that time server will notify that queue is destroyed,
> > and i will get all data like routing key when it destroy.
>
> I think it's worth clarifying a few things. You do not consume in passive
> mode:
> queue.declare is what takes the passive argument. If you want the server
> to generate
> queue name and send it to the client for whatever reason, the use of
> passive declare is fine.
>
> >
> > Whereas amq.rabbitmq.event is the exchange, that will monitor
> > all the the events.
> > connection.queue("eventListener", { exclusive: true } , function(q){
> > q.bind("amq.rabbitmq.event","");
> >
> > //i want to listen all events here when queue destroy when client
> > app killed.
> > q.subscribe(function (message, headers, deliveryInfo, messageObject)
> > {
> > console.log(JSON.stringify(headers));
> > })
> > });
>
> Two things that stand out: you bind using an empty routing key and not
> "#". Perhaps that's just a typo.
>
> If a client is "destroyed" (I assume it means it has disconnected,
> hibernated,
> otherwise lost connection), only exclusive or auto-delete queues that had
> consumers
> will be deleted. But then amq.rabbitmq.event will not have a message
> published
> because it only tracks explicit queue.delete calls (I'm pretty sure this
> is the case but
> Simon can correct me).
>
> >
> > Above code will generate queue that will listen all the event
> > like exchange create, exchange delete, binding, queue created,
> > queue delete, etc..
> > I read in the documentation of the amqp-event plugin that it will
> > deliver all the event which are happing to all exchanges on the
> > rabbitmq server.
>
> Yes but this will not include queues deleted due to TTL, disconnect of
> an exclusive queue owner, etc.
>
> > 2) queue.js : it is the simple client that have only read access
> > to queue in passive mode only. if any event goes to this client
> > like queue delete then it's not helpful to me.
>
> > My main purpose is to listen event and get message when queue.js
> > will be killed or application killed in android.
>
> So your problem is effectively a presence one. This brings us back to
> square one:
>
> ?If your problem is primarily client presence detection, there's presence
> exchange:
> https://github.com/tonyg/presence-exchange.?
>
>  Note that RabbitMQ is not the optimal solution for tracking client
> presence.
> Consider using a tool such as ZooKeeper or Redis.
> --
> MK
>
> Staff Software Engineer, Pivotal/RabbitMQ
>



-- 
*Thanks,*
Hitesh Dobariya,
Artoon Solutions PVT. LTD
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140707/6572ec81/attachment.html>

From mklishin at gopivotal.com  Mon Jul  7 15:05:02 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 7 Jul 2014 18:05:02 +0400
Subject: [rabbitmq-discuss] [ Listen event when queue destroy from
 client ]
In-Reply-To: <CAJGFNjSZCJuPhyYCsP3Nt9EhJ4rho=zcXwVUJ1pL9eSbd-1gnQ@mail.gmail.com>
References: <CAJGFNjSBkkWnLdp1w5=01hZoObEWX+qdqAyrB3h5oiA-TPgxKA@mail.gmail.com>
 <etPan.53b51d7e.643c9869.60b3@mercurio.local>
 <CAJGFNjQvU55hSBAFaHeTDPg099M3V-nSCd3SU7_C+2Tbsyy4Yg@mail.gmail.com>
 <etPan.53ba63ef.2ae8944a.1fb1@mercurio.local>
 <CAJGFNjRVYN0i6P_EU+OzHhKcB5pVE5fNqRfKAj9vt3ZN+p3ECg@mail.gmail.com>
 <etPan.53ba66d4.625558ec.1fb1@mercurio.local>
 <etPan.53ba68fb.46e87ccd.1fb1@mercurio.local>
 <CAJGFNjSWphzC7=1ncRDUuMmNafUOh3VvTMDqtVUfrYmjewrTRw@mail.gmail.com>
 <CAJGFNjTsuGU6d9Y4eOa1TbGwCqKPVmAZqjPSizhgB1TvoiVbrA@mail.gmail.com>
 <etPan.53ba905e.7545e146.1fb1@mercurio.local>
 <CAJGFNjQj-h4Y02VRmt2RwH9h0w9NbLDaoeVG-QyXTL=FXtZ6QA@mail.gmail.com>
 <etPan.53ba92de.515f007c.1fb1@mercurio.local>
 <CAJGFNjS5UxNUNcZ5E9SWATbqTUtaraf4TywsmESDJYBC8LqMjg@mail.gmail.com>
 <etPan.53ba991a.12200854.1fb1@mercurio.local>
 <CAJGFNjSZCJuPhyYCsP3Nt9EhJ4rho=zcXwVUJ1pL9eSbd-1gnQ@mail.gmail.com>
Message-ID: <etPan.53baa92a.4db127f8.1fb1@mercurio.local>

On 7 July 2014 at 17:13:05, Hitesh Dobariya (hitesh at artoonsolutions.com) wrote:
> > So according to your suggestion i have to use socket.io(http://socket.io),  
> or redis right? code that i sent will never work to detect client  
> has been killed or not.
>  
> Demo that i sent you on prior mail, when i am killing the queue.js  
> file from node server it will automatically deleted the queue.  

You can use RabbitMQ for messaging (and Socket.IO/Web STOMP, for example). Redis
or ZooKeeper will do a better job at client presence.

> Well thanks for quick reply. i have to think another way to accomplish  
> my requirement + you link for presence exchange is not working.  
> :(

The link is?https://github.com/tonyg/presence-exchange ? can you not build the plugin,
or what specifically doesn't work??
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From w_pg at qq.com  Tue Jul  8 04:47:39 2014
From: w_pg at qq.com (=?ISO-8859-1?B?TG9zdA==?=)
Date: Tue, 8 Jul 2014 11:47:39 +0800
Subject: [rabbitmq-discuss] Connection is always in "flow" State.
Message-ID: <tencent_721DCB361ADD5CF0627708F8@qq.com>

I am run Rabbitmq in my machine(Win7 64bit, 4G ram, 2.9GHz cpu, Erlang OTP R16B03 (x64)).
 I have a client to publish message to rabbitmq(1 connection and 1 channel, in same machine with rabbitmq), no consumer.
 Message rates is 2000/s ~ 3000/s
 Traffic is 300Kb/s ~ 750kB/s
 The channel state is "running", but the connection state is always "flow".
 I found erl.exe cpu is only 5% ~ 10%, but why connection is in "flow" state?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140708/6bd8ec07/attachment.html>

From hitesh at artoonsolutions.com  Tue Jul  8 05:19:54 2014
From: hitesh at artoonsolutions.com (Hitesh Dobariya)
Date: Tue, 8 Jul 2014 09:49:54 +0530
Subject: [rabbitmq-discuss] [ Listen event when queue destroy from
	client ]
In-Reply-To: <etPan.53baa92a.4db127f8.1fb1@mercurio.local>
References: <CAJGFNjSBkkWnLdp1w5=01hZoObEWX+qdqAyrB3h5oiA-TPgxKA@mail.gmail.com>
 <etPan.53b51d7e.643c9869.60b3@mercurio.local>
 <CAJGFNjQvU55hSBAFaHeTDPg099M3V-nSCd3SU7_C+2Tbsyy4Yg@mail.gmail.com>
 <etPan.53ba63ef.2ae8944a.1fb1@mercurio.local>
 <CAJGFNjRVYN0i6P_EU+OzHhKcB5pVE5fNqRfKAj9vt3ZN+p3ECg@mail.gmail.com>
 <etPan.53ba66d4.625558ec.1fb1@mercurio.local>
 <etPan.53ba68fb.46e87ccd.1fb1@mercurio.local>
 <CAJGFNjSWphzC7=1ncRDUuMmNafUOh3VvTMDqtVUfrYmjewrTRw@mail.gmail.com>
 <CAJGFNjTsuGU6d9Y4eOa1TbGwCqKPVmAZqjPSizhgB1TvoiVbrA@mail.gmail.com>
 <etPan.53ba905e.7545e146.1fb1@mercurio.local>
 <CAJGFNjQj-h4Y02VRmt2RwH9h0w9NbLDaoeVG-QyXTL=FXtZ6QA@mail.gmail.com>
 <etPan.53ba92de.515f007c.1fb1@mercurio.local>
 <CAJGFNjS5UxNUNcZ5E9SWATbqTUtaraf4TywsmESDJYBC8LqMjg@mail.gmail.com>
 <etPan.53ba991a.12200854.1fb1@mercurio.local>
 <CAJGFNjSZCJuPhyYCsP3Nt9EhJ4rho=zcXwVUJ1pL9eSbd-1gnQ@mail.gmail.com>
 <etPan.53baa92a.4db127f8.1fb1@mercurio.local>
Message-ID: <CAJGFNjSpqVN5pXBe=CUJ+og5yYvqjAszZyeqx_ALvwp=exWe8A@mail.gmail.com>

there is dot at the end of the link, so it's not working .. :)


On Mon, Jul 7, 2014 at 7:35 PM, Michael Klishin <mklishin at gopivotal.com>
wrote:

> On 7 July 2014 at 17:13:05, Hitesh Dobariya (hitesh at artoonsolutions.com)
> wrote:
> > > So according to your suggestion i have to use socket.io(
> http://socket.io),
> > or redis right? code that i sent will never work to detect client
> > has been killed or not.
> >
> > Demo that i sent you on prior mail, when i am killing the queue.js
> > file from node server it will automatically deleted the queue.
>
> You can use RabbitMQ for messaging (and Socket.IO/Web STOMP, for example).
> Redis
> or ZooKeeper will do a better job at client presence.
>
> > Well thanks for quick reply. i have to think another way to accomplish
> > my requirement + you link for presence exchange is not working.
> > :(
>
> The link is https://github.com/tonyg/presence-exchange ? can you not
> build the plugin,
> or what specifically doesn't work?
> --
> MK
>
> Staff Software Engineer, Pivotal/RabbitMQ
>



-- 
*Thanks,*
Hitesh Dobariya,
Artoon Solutions PVT. LTD
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140708/b750d994/attachment.html>

From mklishin at gopivotal.com  Tue Jul  8 09:33:34 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 8 Jul 2014 12:33:34 +0400
Subject: [rabbitmq-discuss] Connection is always in "flow" State.
In-Reply-To: <tencent_721DCB361ADD5CF0627708F8@qq.com>
References: <tencent_721DCB361ADD5CF0627708F8@qq.com>
Message-ID: <etPan.53bbacf8.6b8b4567.e013@mercurio.local>



On 8 July 2014 at 07:49:26, Lost (w_pg at qq.com) wrote:
> > I have a client to publish message to rabbitmq(1 connection  
> and 1 channel, in same machine with rabbitmq), no consumer.
> Message rates is 2000/s ~ 3000/s
> Traffic is 300Kb/s ~ 750kB/s
> The channel state is "running", but the connection state is always  
> "flow".
> I found erl.exe cpu is only 5% ~ 10%, but why connection is in "flow"  
> state?

Flow control does not depend on CPU usage but rather whether consumers
can keep up with producers. Try adding a consumer.?
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Tue Jul  8 09:45:26 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 8 Jul 2014 12:45:26 +0400
Subject: [rabbitmq-discuss] Connection is always in "flow" State.
In-Reply-To: <tencent_721DCB361ADD5CF0627708F8@qq.com>
References: <tencent_721DCB361ADD5CF0627708F8@qq.com>
Message-ID: <etPan.53bbafc0.643c9869.e013@mercurio.local>

?On 8 July 2014 at 07:49:26, Lost (w_pg at qq.com) wrote:
> > I found erl.exe cpu is only 5% ~ 10%, but why connection is in "flow"  
> state?

Check how loaded the disk is. If you publish messages as persistent,
disk I/O is likely to be the bottleneck.
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Tue Jul  8 09:49:55 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 8 Jul 2014 12:49:55 +0400
Subject: [rabbitmq-discuss] Connection is always in "flow" State.
In-Reply-To: <etPan.53bbafc0.643c9869.e013@mercurio.local>
References: <tencent_721DCB361ADD5CF0627708F8@qq.com>
 <etPan.53bbafc0.643c9869.e013@mercurio.local>
Message-ID: <etPan.53bbb0d1.74b0dc51.e013@mercurio.local>

On 8 July 2014 at 12:47:11, Michael Klishin (mklishin at gopivotal.com) wrote:
> > Check how loaded the disk is. If you publish messages as persistent, 
> disk I/O is likely to be the bottleneck.

or, if you run, 3.3, management UI can help you find this out:
http://www.rabbitmq.com/blog/2014/04/14/finding-bottlenecks-with-rabbitmq-3-3/
-- 
MK 

Staff Software Engineer, Pivotal/RabbitMQ

From w_pg at qq.com  Tue Jul  8 10:23:06 2014
From: w_pg at qq.com (=?ISO-8859-1?B?TG9zdA==?=)
Date: Tue, 8 Jul 2014 17:23:06 +0800
Subject: [rabbitmq-discuss] Connection is always in "flow" State.
In-Reply-To: <etPan.53bbacf8.6b8b4567.e013@mercurio.local>
References: <tencent_721DCB361ADD5CF0627708F8@qq.com>
 <etPan.53bbacf8.6b8b4567.e013@mercurio.local>
Message-ID: <tencent_1576336F3313CED036846777@qq.com>

I have any queue to consumer message, just publish, connection is in "flow" state, channel is in "running" state.
 If i add a queue to consumer message, the connection and the channel is all in "flow" state.
  




------------------ Original message ------------------
From: "Michael Klishin"; 
Sendtime: Tuesday, Jul 8, 2014 4:33 PM
To: "Lost"; "rabbitmq-discuss"; 
Subject: Re: [rabbitmq-discuss] Connection is always in "flow" State.





On 8 July 2014 at 07:49:26, Lost (w_pg at qq.com) wrote:
> > I have a client to publish message to rabbitmq(1 connection  
> and 1 channel, in same machine with rabbitmq), no consumer.
> Message rates is 2000/s ~ 3000/s
> Traffic is 300Kb/s ~ 750kB/s
> The channel state is "running", but the connection state is always  
> "flow".
> I found erl.exe cpu is only 5% ~ 10%, but why connection is in "flow"  
> state?

Flow control does not depend on CPU usage but rather whether consumers
can keep up with producers. Try adding a consumer. 
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140708/ac3d2ae9/attachment.html>

From w_pg at qq.com  Tue Jul  8 10:23:47 2014
From: w_pg at qq.com (=?ISO-8859-1?B?TG9zdA==?=)
Date: Tue, 8 Jul 2014 17:23:47 +0800
Subject: [rabbitmq-discuss] Connection is always in "flow" State.
In-Reply-To: <etPan.53bbafc0.643c9869.e013@mercurio.local>
References: <tencent_721DCB361ADD5CF0627708F8@qq.com>
 <etPan.53bbafc0.643c9869.e013@mercurio.local>
Message-ID: <tencent_5BECCC4032E0D95737B044A4@qq.com>

I publish message as non-persistent, so no disk I/O.




------------------ Original message ------------------
From: "Michael Klishin"; 
Sendtime: Tuesday, Jul 8, 2014 4:45 PM
To: "Lost"; "rabbitmq-discuss"; 
Subject: Re: [rabbitmq-discuss] Connection is always in "flow" State.



 On 8 July 2014 at 07:49:26, Lost (w_pg at qq.com) wrote:
> > I found erl.exe cpu is only 5% ~ 10%, but why connection is in "flow"  
> state?

Check how loaded the disk is. If you publish messages as persistent,
disk I/O is likely to be the bottleneck.
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140708/7c447888/attachment.html>

From w_pg at qq.com  Tue Jul  8 10:30:30 2014
From: w_pg at qq.com (=?ISO-8859-1?B?TG9zdA==?=)
Date: Tue, 8 Jul 2014 17:30:30 +0800
Subject: [rabbitmq-discuss] Connection is always in "flow" State.
In-Reply-To: <etPan.53bbb0d1.74b0dc51.e013@mercurio.local>
References: <tencent_721DCB361ADD5CF0627708F8@qq.com>
 <etPan.53bbafc0.643c9869.e013@mercurio.local>
 <etPan.53bbb0d1.74b0dc51.e013@mercurio.local>
Message-ID: <tencent_550186A75D01EDF5336F44C8@qq.com>

Yes, i am run RabbitMQ 3.3.4, i have check this blog.
  
  "A connection is in flow control, but none of its channels are - This means that one or more of the channels is the bottleneck; the server is CPU-bound on something the channel does, probably routing logic. This is most likely to be seen when publishing small transient messages."
  
 I found this is just like my problem, it seems channels is the bottleneck, but i still have no idea to solve it.
 
 
 

 ------------------ Original ------------------
  From:  "Michael Klishin";<mklishin at gopivotal.com>;
 Send time: Tuesday, Jul 8, 2014 4:49 PM
 To: "Lost"<w_pg at qq.com>; "Legacy list about RabbitMQ"<rabbitmq-discuss at lists.rabbitmq.com>; 
 
 Subject:  Re: [rabbitmq-discuss] Connection is always in "flow" State.

 

On 8 July 2014 at 12:47:11, Michael Klishin (mklishin at gopivotal.com) wrote:
> > Check how loaded the disk is. If you publish messages as persistent, 
> disk I/O is likely to be the bottleneck.

or, if you run, 3.3, management UI can help you find this out:
http://www.rabbitmq.com/blog/2014/04/14/finding-bottlenecks-with-rabbitmq-3-3/
-- 
MK 

Staff Software Engineer, Pivotal/RabbitMQ
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140708/dd465e9e/attachment.html>

From mklishin at gopivotal.com  Tue Jul  8 10:32:18 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 8 Jul 2014 13:32:18 +0400
Subject: [rabbitmq-discuss] Connection is always in "flow" State.
In-Reply-To: <tencent_550186A75D01EDF5336F44C8@qq.com>
References: <tencent_721DCB361ADD5CF0627708F8@qq.com>
 <etPan.53bbafc0.643c9869.e013@mercurio.local>
 <etPan.53bbb0d1.74b0dc51.e013@mercurio.local>
 <tencent_550186A75D01EDF5336F44C8@qq.com>
Message-ID: <etPan.53bbbabf.46e87ccd.e013@mercurio.local>

On 8 July 2014 at 13:30:37, Lost (w_pg at qq.com) wrote:
> > I found this is just like my problem, it seems channels is the  
> bottleneck, but i still have no idea to solve it.

What exchange types(s) ?do you use? Can it be that you use a single queue that has grown very large?
A single queue can only use 1 CPU core.?
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From w_pg at qq.com  Tue Jul  8 10:35:23 2014
From: w_pg at qq.com (=?ISO-8859-1?B?TG9zdA==?=)
Date: Tue, 8 Jul 2014 17:35:23 +0800
Subject: [rabbitmq-discuss] Connection is always in "flow" State.
In-Reply-To: <etPan.53bbbabf.46e87ccd.e013@mercurio.local>
References: <tencent_721DCB361ADD5CF0627708F8@qq.com>
 <etPan.53bbafc0.643c9869.e013@mercurio.local>
 <etPan.53bbb0d1.74b0dc51.e013@mercurio.local>
 <tencent_550186A75D01EDF5336F44C8@qq.com>
 <etPan.53bbbabf.46e87ccd.e013@mercurio.local>
Message-ID: <tencent_4633D8BE193280DC1E808B38@qq.com>

a fanout exchange, i have any queues, just publish message to a fanout exchange.




------------------ Original message ------------------
From: "Michael Klishin"; 
Sendtime: Tuesday, Jul 8, 2014 5:32 PM
To: "rabbitmq-discuss"; "Lost"; 
Subject: Re: [rabbitmq-discuss] Connection is always in "flow" State.



On 8 July 2014 at 13:30:37, Lost (w_pg at qq.com) wrote:
> > I found this is just like my problem, it seems channels is the  
> bottleneck, but i still have no idea to solve it.

What exchange types(s)  do you use? Can it be that you use a single queue that has grown very large?
A single queue can only use 1 CPU core. 
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140708/c453d00a/attachment.html>

From w_pg at qq.com  Tue Jul  8 10:36:12 2014
From: w_pg at qq.com (=?ISO-8859-1?B?TG9zdA==?=)
Date: Tue, 8 Jul 2014 17:36:12 +0800
Subject: [rabbitmq-discuss] Connection is always in "flow" State.
In-Reply-To: <etPan.53bbbabf.46e87ccd.e013@mercurio.local>
References: <tencent_721DCB361ADD5CF0627708F8@qq.com>
 <etPan.53bbafc0.643c9869.e013@mercurio.local>
 <etPan.53bbb0d1.74b0dc51.e013@mercurio.local>
 <tencent_550186A75D01EDF5336F44C8@qq.com>
 <etPan.53bbbabf.46e87ccd.e013@mercurio.local>
Message-ID: <tencent_13701E3B1B52F4FF684905E2@qq.com>

a fanout exchange, i have NOT any queues, just publish message to a fanout exchange.




------------------ Original message ------------------
From: "Michael Klishin"; 
Sendtime: Tuesday, Jul 8, 2014 5:32 PM
To: "rabbitmq-discuss"; "Lost"; 
Subject: Re: [rabbitmq-discuss] Connection is always in "flow" State.



On 8 July 2014 at 13:30:37, Lost (w_pg at qq.com) wrote:
> > I found this is just like my problem, it seems channels is the  
> bottleneck, but i still have no idea to solve it.

What exchange types(s)  do you use? Can it be that you use a single queue that has grown very large?
A single queue can only use 1 CPU core. 
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140708/c169619a/attachment.html>

From mklishin at gopivotal.com  Tue Jul  8 10:36:27 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 8 Jul 2014 13:36:27 +0400
Subject: [rabbitmq-discuss] Connection is always in "flow" State.
In-Reply-To: <tencent_4633D8BE193280DC1E808B38@qq.com>
References: <tencent_721DCB361ADD5CF0627708F8@qq.com>
 <etPan.53bbafc0.643c9869.e013@mercurio.local>
 <etPan.53bbb0d1.74b0dc51.e013@mercurio.local>
 <tencent_550186A75D01EDF5336F44C8@qq.com>
 <etPan.53bbbabf.46e87ccd.e013@mercurio.local>
 <tencent_4633D8BE193280DC1E808B38@qq.com>
Message-ID: <etPan.53bbbbb9.3d1b58ba.e013@mercurio.local>

On 8 July 2014 at 13:35:28, Lost (w_pg at qq.com) wrote:
> > a fanout exchange, i have any queues, just publish message to  
> a fanout exchange.

Do you mean you *do not* have any queues bound to the exchange??
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From w_pg at qq.com  Tue Jul  8 10:38:16 2014
From: w_pg at qq.com (=?ISO-8859-1?B?TG9zdA==?=)
Date: Tue, 8 Jul 2014 17:38:16 +0800
Subject: [rabbitmq-discuss] Connection is always in "flow" State.
In-Reply-To: <etPan.53bbbbb9.3d1b58ba.e013@mercurio.local>
References: <tencent_721DCB361ADD5CF0627708F8@qq.com>
 <etPan.53bbafc0.643c9869.e013@mercurio.local>
 <etPan.53bbb0d1.74b0dc51.e013@mercurio.local>
 <tencent_550186A75D01EDF5336F44C8@qq.com>
 <etPan.53bbbabf.46e87ccd.e013@mercurio.local>
 <tencent_4633D8BE193280DC1E808B38@qq.com>
 <etPan.53bbbbb9.3d1b58ba.e013@mercurio.local>
Message-ID: <tencent_4EA6A6085832915E7AAA1300@qq.com>

Yes, just one connection, one channel and publish to a exchange(no any queues to bind it.)




------------------ Original message ------------------
From: "Michael Klishin"; 
Sendtime: Tuesday, Jul 8, 2014 5:36 PM
To: "rabbitmq-discuss"; "Lost"; 
Subject: Re: [rabbitmq-discuss] Connection is always in "flow" State.



On 8 July 2014 at 13:35:28, Lost (w_pg at qq.com) wrote:
> > a fanout exchange, i have any queues, just publish message to  
> a fanout exchange.

Do you mean you *do not* have any queues bound to the exchange? 
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140708/e6e084e5/attachment.html>

From mklishin at gopivotal.com  Tue Jul  8 11:07:50 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 8 Jul 2014 14:07:50 +0400
Subject: [rabbitmq-discuss] Connection is always in "flow" State.
In-Reply-To: <tencent_4EA6A6085832915E7AAA1300@qq.com>
References: <tencent_721DCB361ADD5CF0627708F8@qq.com>
 <etPan.53bbafc0.643c9869.e013@mercurio.local>
 <etPan.53bbb0d1.74b0dc51.e013@mercurio.local>
 <tencent_550186A75D01EDF5336F44C8@qq.com>
 <etPan.53bbbabf.46e87ccd.e013@mercurio.local>
 <tencent_4633D8BE193280DC1E808B38@qq.com>
 <etPan.53bbbbb9.3d1b58ba.e013@mercurio.local>
 <tencent_4EA6A6085832915E7AAA1300@qq.com>
Message-ID: <etPan.53bbc314.2eb141f2.e013@mercurio.local>

On 8 July 2014 at 13:39:59, Lost (w_pg at qq.com) wrote:
> > Yes, just one connection, one channel and publish to a exchange(no 
> any queues to bind it.)

You can simulate this setup with PerfTest [1]:

./runjava.sh com.rabbitmq.examples.PerfTest -y 0 -t "fanout"

and tweak various options such as message size.

For example, running PerfTest with the options above stabilizes
at about 65-70 K messages per second on my (1 gen old, not maxed-out)
MacBook Pro.

1. http://www.rabbitmq.com/java-tools.html
--
MK 

Staff Software Engineer, Pivotal/RabbitMQ

From dmitry.andrianov at alertme.com  Tue Jul  8 16:02:00 2014
From: dmitry.andrianov at alertme.com (Dmitry Andrianov)
Date: Tue, 08 Jul 2014 16:02:00 +0100
Subject: [rabbitmq-discuss] default_user vs definitions
Message-ID: <53BC07E8.3030204@alertme.com>

Hello.

RabbitMQ 3.3.4. In the rabbitmq.config we have both default user and 
loading of definitions JSON like that:

   {rabbit, [
       {default_user, <<"default">>},
       {default_pass, <<"password">>},
...
     ]},
   {rabbitmq_management, [{load_definitions, 
"/etc/rabbitmq/definitions.json"}]},

And if we have users in that JSON - they get created. However if we 
remove users from JSON, the default one does not get created. (We 
stopping, removing mnesia and starting again). Disabling definition JSON 
makes default user to appear.
I am not sure if it is an intended behaviour or just some race condition 
when the server core makes a wrong decision regarding is it the first 
start or not because management plugin has already created some entities.

The reason why we prefer creating user with rabbitmq.config is because 
the password there is plaintext while definitions requires a hash.
Usernames and passwords get populated from some master file during the 
deployment. We need plaintext password for clients so it is already in 
that file. Using JSON would require us to also add the same password but 
in hashed form to the same master config which does not feel right. 
Maintaining this pass+hash pair in multiple config files won't be very 
pleasant. I considered generating hashed value from plaintext during 
deployment myself given your algorithm is straightforward but it does 
not feel right either - this will introduce unnecessary coupling and if 
one day you change your hashing algorithm everything will break.

So are there any options here?

1. The fact default_user is ignored - is it a feature or a bug?
2. is there any way to supply plaintext passwords with definitions JSON?
3. Any other approach I should consider instead?

Many thanks.
Dmitry
This email is for the use of the intended recipient(s) only.
If you have received this email in error, please notify the sender immediately and then delete it.
If you are not the intended recipient, you must not use, disclose or distribute this email without the
author's prior permission. AlertMe.com Ltd. is not responsible for any personal views expressed
in this message or any attachments that are those of the individual sender.

AlertMe.com Ltd, 30 Station Road, Cambridge, CB1 2RE, UK.
Registered in England, Company number 578 2908, VAT registration number GB 895 9914 42.



From simon at rabbitmq.com  Tue Jul  8 16:19:45 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 08 Jul 2014 16:19:45 +0100
Subject: [rabbitmq-discuss] default_user vs definitions
In-Reply-To: <53BC07E8.3030204@alertme.com>
References: <53BC07E8.3030204@alertme.com>
Message-ID: <53BC0C11.9070507@rabbitmq.com>

On 08/07/2014 4:02PM, Dmitry Andrianov wrote:
> 1. The fact default_user is ignored - is it a feature or a bug?

Feature. If you are using the management load-definitions feature then 
it's assumed you don't also want to be defining some other things elsewhere.

http://www.rabbitmq.com/management.html#load-definitions says:

> However, if you start from a completely reset broker, use of this
> option will prevent the usual default user / virtual host /
> permissions from being created.

> 2. is there any way to supply plaintext passwords with definitions JSON?

Yes, just change the "password_hash" key to "password" to provide 
passwords in plaintext.

(This also works for PUT /api/users/{whoever}.)

> 3. Any other approach I should consider instead?

Hopefully the above will work for you.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From steven.blanc at avid.com  Tue Jul  8 22:09:08 2014
From: steven.blanc at avid.com (Steven Blanc)
Date: Tue, 8 Jul 2014 21:09:08 +0000
Subject: [rabbitmq-discuss] Possible bug in Priority Queue plugin
Message-ID: <D7C993D2A9A4464F8C0E64FEFABA9E426BB385BC@WAL-MBS02.global.avidww.com>

I have been experimenting with the priority queue plugin (3.3.x-72d20292) with RMQ Server 3.3.2.

I have a simple producer and a simple consumer written in C++ using SimplelAmqpClient.

The consumer app creates  a Channel (SimpleAmpqClient Channel), the exchange, the queue (as a priority queue with x-max-priority of 10) and a binding.
I see this all properly from the RMW Admin GUI.
After that it calls BasicConsume() and then goes into a loop calling BasicConsumeMessage() with a 1 second sleep between calls.

Meanwhile, the simple producer creates a broker connection, then goes into a loop creating messages with a priority value assigned to be either 0 or 10.

Where I think I see a bug is this:
If the consumer calls BasicConsume BEFORE the messages are in the queue, they are consumed in FIFO order, without consideration of the priority value.
If I sleep in the consumer before calling BasicConsume() until all messages are in the queue, they are consumed in priority order.

Am I doing something wrong?  Shouldn't the priority on each message place it in the queue according to priority over time and the already connected consumer(s) will get higher priority messages ahead of lower priority messages all the time?

I looked at the Java example provided here:
https://github.com/rabbitmq/rabbitmq-priority-queue/blob/master/examples/java/src/com/rabbitmq/examples/PriorityQueue.java
I am not a Java programmer, but it appears that example also publishes messages to a priority queue before there is a consumer and then creates a consumer of the queue which retrieves messages in priority order.  Same results I see, but not the desired behavior I am looking for.

Should this work after a consumer is attached to a queue and consuming it for all subsequent messages?

Thanks,
Steve
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140708/a7027dfd/attachment.html>

From mcintoshj at gmail.com  Wed Jul  9 05:50:31 2014
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Tue, 8 Jul 2014 23:50:31 -0500
Subject: [rabbitmq-discuss] Docs on rabbitmq install for OS X - /etc/hosts
	file change
Message-ID: <CAD6m6fHj50YMC2GXXr8oR8--CjHG7Afnq+MpwUgiGy9r00kwKw@mail.gmail.com>

Was working on getting RabbitMQ on my local mac (vs. a vm linux machine)
and hit one error:
ERROR: epmd error for host Jasons-iMac: timeout (timed out)

The docs don't state it, but the /etc/hosts file should have an entry:
127.0.0.1 localhost Jasons-iMac
or you'll get the above error.  A simple command that can be executed to
add this is:
sudo sudo sed -i '/^127.0.0.1/ s/$/ '`hostname`' '`hostname -s`'/'
/etc/hosts

This will on the line starting with 127.0.0.1 add the hostname and the
short hostname.  Of course there are other options on this, but this is a
simple way to get things running.

Jason

-- 
Jason McIntosh
https://github.com/jasonmcintosh/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140708/403ef5dc/attachment.html>

From mklishin at gopivotal.com  Wed Jul  9 09:32:05 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 9 Jul 2014 12:32:05 +0400
Subject: [rabbitmq-discuss] ANN March Hare 2.4.0 is released
Message-ID: <etPan.53bcfe21.6b8b4567.166fe@mercurio.local>

March Hare [1] is a fast, feature rich RabbitMQ client for JRuby.

Release notes:
http://blog.rubyrabbitmq.info/blog/2014/07/09/march-hare-2-dot-4-0-is-released/?

1. http://rubymarchhare.info
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Wed Jul  9 09:35:19 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 9 Jul 2014 12:35:19 +0400
Subject: [rabbitmq-discuss] ANN amqp gem 1.4.1 is released
Message-ID: <etPan.53bcfee5.327b23c6.166fe@mercurio.local>

amqp gem is an EventMachine-base Ruby RabbitMQ client.

Release notes:
http://blog.rubyrabbitmq.info/blog/2014/07/09/amqp-gem-1-dot-4-1-is-released/

1. http://rubyamqp.info
-- 
MK 

Staff Software Engineer, Pivotal/RabbitMQ

From simon at rabbitmq.com  Wed Jul  9 10:10:08 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 09 Jul 2014 10:10:08 +0100
Subject: [rabbitmq-discuss] Possible bug in Priority Queue plugin
In-Reply-To: <D7C993D2A9A4464F8C0E64FEFABA9E426BB385BC@WAL-MBS02.global.avidww.com>
References: <D7C993D2A9A4464F8C0E64FEFABA9E426BB385BC@WAL-MBS02.global.avidww.com>
Message-ID: <53BD06F0.2090608@rabbitmq.com>

I don't know SimpleAmqpClient but from your description it sounds like 
you are consuming with no prefetch limit - i.e. RabbitMQ will send your 
consumer as many messages as it likes, limited only by network speed.

Therefore messages aren't resting in the queue at all, they're sent 
straight out to the client, and there is no opportunity for higher 
priority messages to overtake lower ones.

You need to make sure messages are backing up in the queue (e.g. by 
consuming with basic.qos set to some small value like 1) to see the 
prioritising effect.

Cheers, Simon

On 08/07/2014 10:09PM, Steven Blanc wrote:
> I have been experimenting with the priority queue plugin
> (3.3.x-72d20292) with RMQ Server 3.3.2.
>
> I have a simple producer and a simple consumer written in C++ using
> SimplelAmqpClient.
>
> The consumer app creates  a Channel (SimpleAmpqClient Channel), the
> exchange, the queue (as a priority queue with x-max-priority of 10) and
> a binding.
>
> I see this all properly from the RMW Admin GUI.
>
> After that it calls BasicConsume() and then goes into a loop calling
> BasicConsumeMessage() with a 1 second sleep between calls.
>
> Meanwhile, the simple producer creates a broker connection, then goes
> into a loop creating messages with a priority value assigned to be
> either 0 or 10.
>
> Where I think I see a bug is this:
>
> If the consumer calls BasicConsume BEFORE the messages are in the queue,
> they are consumed in FIFO order, without consideration of the priority
> value.
>
> If I sleep in the consumer before calling BasicConsume() until all
> messages are in the queue, they are consumed in priority order.
>
> Am I doing something wrong?  Shouldn't the priority on each message
> place it in the queue according to priority over time and the already
> connected consumer(s) will get higher priority messages ahead of lower
> priority messages all the time?
>
> I looked at the Java example provided here:
>
> https://github.com/rabbitmq/rabbitmq-priority-queue/blob/master/examples/java/src/com/rabbitmq/examples/PriorityQueue.java
>
> I am not a Java programmer, but it appears that example also publishes
> messages to a priority queue before there is a consumer and then creates
> a consumer of the queue which retrieves messages in priority order.
> Same results I see, but not the desired behavior I am looking for.
>
> Should this work after a consumer is attached to a queue and consuming
> it for all subsequent messages?
>
> Thanks,
>
> Steve
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list has moved to https://groups.google.com/forum/#!forum/rabbitmq-users,
> please subscribe to the new list!
>
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

-- 
Simon MacMullen
RabbitMQ, Pivotal

From mklishin at gopivotal.com  Wed Jul  9 11:33:39 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 9 Jul 2014 14:33:39 +0400
Subject: [rabbitmq-discuss] RabbitMQ configuration issue
In-Reply-To: <0AE0D43E7CAC0342AE4BCDD4A4F5F45229EAACDEC0@NII-WINSRV.niiwin.local>
References: <0AE0D43E7CAC0342AE4BCDD4A4F5F45229EAACDEC0@NII-WINSRV.niiwin.local>
Message-ID: <etPan.53bd1a9f.3d1b58ba.166fe@mercurio.local>

On 9 July 2014 at 14:30:56, Mahendrakumar Yadavalli (mahendrakumary at neelinfo.com) wrote:
> > But I am not able to watch the dashboard in browser.ex: http://myipaddress:15672/,  
> . For this I need to one command which fecilitates the system to  
> get the access and privilages as admin. Can you please share it.

The docs explain how to enable the plugin:
http://www.rabbitmq.com/management.html

Then you need to restart RabbitMQ. That is all.?
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From simon at rabbitmq.com  Wed Jul  9 12:06:51 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 09 Jul 2014 12:06:51 +0100
Subject: [rabbitmq-discuss] Docs on rabbitmq install for OS X -
 /etc/hosts file change
In-Reply-To: <CAD6m6fHj50YMC2GXXr8oR8--CjHG7Afnq+MpwUgiGy9r00kwKw@mail.gmail.com>
References: <CAD6m6fHj50YMC2GXXr8oR8--CjHG7Afnq+MpwUgiGy9r00kwKw@mail.gmail.com>
Message-ID: <53BD224B.2020304@rabbitmq.com>

Well, it's not that it has to be in /etc/hosts, but that the hostname 
has to resolve in some way.

But yes, that seems to be more likely to break on OS X than any other 
OS, so we should probably document it on the Mac install pages.

Cheers, Simon

On 09/07/2014 5:50AM, Jason McIntosh wrote:
> Was working on getting RabbitMQ on my local mac (vs. a vm linux machine)
> and hit one error:
> ERROR: epmd error for host Jasons-iMac: timeout (timed out)
>
> The docs don't state it, but the /etc/hosts file should have an entry:
> 127.0.0.1 localhost Jasons-iMac
> or you'll get the above error.  A simple command that can be executed to
> add this is:
> sudo sudo sed -i '/^127.0.0.1/ <http://127.0.0.1/> s/$/ '`hostname`'
> '`hostname -s`'/' /etc/hosts
>
> This will on the line starting with 127.0.0.1 add the hostname and the
> short hostname.  Of course there are other options on this, but this is
> a simple way to get things running.
>
> Jason
>
> --
> Jason McIntosh
> https://github.com/jasonmcintosh/
> 573-424-7612
>
>
> _______________________________________________
> rabbitmq-discuss mailing list has moved to https://groups.google.com/forum/#!forum/rabbitmq-users,
> please subscribe to the new list!
>
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

-- 
Simon MacMullen
RabbitMQ, Pivotal

From Mahendrakumary at neelinfo.com  Wed Jul  9 11:30:54 2014
From: Mahendrakumary at neelinfo.com (Mahendrakumar Yadavalli)
Date: Wed, 9 Jul 2014 03:30:54 -0700
Subject: [rabbitmq-discuss] RabbitMQ configuration issue
Message-ID: <0AE0D43E7CAC0342AE4BCDD4A4F5F45229EAACDEC0@NII-WINSRV.niiwin.local>

Hi Michael,

       I installed the rabbit mq server in my local system(Windows). Installation done successfully. I can able to run the rabbit mq services from administrative tools. But I am not able to watch the dashboard in browser.ex: http://myipaddress:15672/, . For this I need to one command which fecilitates the system to get the access and privilages as admin. Can you please share it.

Thanks
Mahendra

From steven.blanc at avid.com  Wed Jul  9 12:58:28 2014
From: steven.blanc at avid.com (Steven Blanc)
Date: Wed, 9 Jul 2014 11:58:28 +0000
Subject: [rabbitmq-discuss] Possible bug in Priority Queue plugin
In-Reply-To: <53BD06F0.2090608@rabbitmq.com>
References: <D7C993D2A9A4464F8C0E64FEFABA9E426BB385BC@WAL-MBS02.global.avidww.com>
 <53BD06F0.2090608@rabbitmq.com>
Message-ID: <D7C993D2A9A4464F8C0E64FEFABA9E426BB38664@WAL-MBS02.global.avidww.com>

Simon,
Thank you.  As always, you guys have the answers.

I am making sure messages back up in the queue by producing with no 
delay and consuming with a 1 second delay between calls to BasicConumeMessage.

Once I set the prefetch count to 1 and properly ACK'd all the messages 
the behavior was as expected/desired.

Steve

-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: Wednesday, July 09, 2014 5:10 AM
To: Legacy list about RabbitMQ; Steven Blanc
Subject: Re: [rabbitmq-discuss] Possible bug in Priority Queue plugin

I don't know SimpleAmqpClient but from your description it sounds like 
you are consuming with no prefetch limit - i.e. RabbitMQ will send your 
consumer as many messages as it likes, limited only by network speed.

Therefore messages aren't resting in the queue at all, they're sent 
straight out to the client, and there is no opportunity for higher 
priority messages to overtake lower ones.

You need to make sure messages are backing up in the queue (e.g. by 
consuming with basic.qos set to some small value like 1) to see the 
prioritising effect.

Cheers, Simon

On 08/07/2014 10:09PM, Steven Blanc wrote:
> I have been experimenting with the priority queue plugin
> (3.3.x-72d20292) with RMQ Server 3.3.2.
>
> I have a simple producer and a simple consumer written in C++ using
> SimplelAmqpClient.
>
> The consumer app creates  a Channel (SimpleAmpqClient Channel), the
> exchange, the queue (as a priority queue with x-max-priority of 10) and
> a binding.
>
> I see this all properly from the RMW Admin GUI.
>
> After that it calls BasicConsume() and then goes into a loop calling
> BasicConsumeMessage() with a 1 second sleep between calls.
>
> Meanwhile, the simple producer creates a broker connection, then goes
> into a loop creating messages with a priority value assigned to be
> either 0 or 10.
>
> Where I think I see a bug is this:
>
> If the consumer calls BasicConsume BEFORE the messages are in the queue,
> they are consumed in FIFO order, without consideration of the priority
> value.
>
> If I sleep in the consumer before calling BasicConsume() until all
> messages are in the queue, they are consumed in priority order.
>
> Am I doing something wrong?  Shouldn't the priority on each message
> place it in the queue according to priority over time and the already
> connected consumer(s) will get higher priority messages ahead of lower
> priority messages all the time?
>
> I looked at the Java example provided here:
>
> https://github.com/rabbitmq/rabbitmq-priority-queue/blob/master/examples/java/src/com/rabbitmq/examples/PriorityQueue.java
>
> I am not a Java programmer, but it appears that example also publishes
> messages to a priority queue before there is a consumer and then creates
> a consumer of the queue which retrieves messages in priority order.
> Same results I see, but not the desired behavior I am looking for.
>
> Should this work after a consumer is attached to a queue and consuming
> it for all subsequent messages?
>
> Thanks,
>
> Steve
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list has moved to https://groups.google.com/forum/#!forum/rabbitmq-users,
> please subscribe to the new list!
>
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

-- 
Simon MacMullen
RabbitMQ, Pivotal

From mklishin at gopivotal.com  Wed Jul  9 13:07:08 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 9 Jul 2014 16:07:08 +0400
Subject: [rabbitmq-discuss] Possible bug in Priority Queue plugin
In-Reply-To: <D7C993D2A9A4464F8C0E64FEFABA9E426BB38664@WAL-MBS02.global.avidww.com>
References: <D7C993D2A9A4464F8C0E64FEFABA9E426BB385BC@WAL-MBS02.global.avidww.com>
 <53BD06F0.2090608@rabbitmq.com>
 <D7C993D2A9A4464F8C0E64FEFABA9E426BB38664@WAL-MBS02.global.avidww.com>
Message-ID: <etPan.53bd3089.2eb141f2.166fe@mercurio.local>

?On 9 July 2014 at 16:03:16, Steven Blanc (steven.blanc at avid.com) wrote:
> > I am making sure messages back up in the queue by producing with  
> no
> delay and consuming with a 1 second delay between calls to BasicConumeMessage.  

Just to clarify: do you mean basic.get? basic.consume creates a "push" subscription (RabbitMQ will
push messages to the client), so it doesn't need to be run multiple times.
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From jagadish.nadimpalli at oneconvergence.com  Wed Jul  9 16:02:01 2014
From: jagadish.nadimpalli at oneconvergence.com (Jagadish Nadimpalli)
Date: Wed, 9 Jul 2014 20:32:01 +0530
Subject: [rabbitmq-discuss] Consumer gets blocked leaving messages
	unacknowledged
Message-ID: <CAC7kndOd8JyohpDjaF2PDcH4edWnPuuNdpmBbtEmfpCHS9ccPg@mail.gmail.com>

Hello,

I am using rabbitmq server and python-kombu client library for RPC
communication. It is observed that the client stops consuming the messages
from the queue and all these messages remain unacknowledged.

We found the following link which is near to our problem. But, we observe
that open fds are not greater that the max limit (1024). Anything else can
lead to this situation?
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2014-May/036063.html

Following is the rabbitmq version.

[{rabbit,"RabbitMQ","3.0.2"},
                       {os_mon,"CPO  CXC 138 46","2.2.9"},
                       {mnesia,"MNESIA  CXC 138 12","4.7"},
                       {sasl,"SASL  CXC 138 11","2.2.1"},
                       {stdlib,"ERTS  CXC 138 10","1.18.1"},
                       {kernel,"ERTS  CXC 138 10","2.15.1"}]},

The RPC client stack is as following. Looks like it is struck for some
reason. Did anybody observe this issue?

cat /proc/12733/stack
[<ffffffff811a6609>] poll_schedule_timeout+0x49/0x70
[<ffffffff811a7d34>] do_sys_poll+0x424/0x4d0
[<ffffffff811a7e1c>] do_restart_poll+0x3c/0x70
[<ffffffff8106eabf>] sys_restart_syscall+0x1f/0x30
[<ffffffff816d379d>] system_call_fastpath+0x1a/0x1f
[<ffffffffffffffff>] 0xffffffffffffffff

Attaching strace to client process show the following.
restart_syscall(<... resuming interrupted call ...>

Thanks,
Jagadish
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140709/27cc747a/attachment.html>

From mklishin at gopivotal.com  Wed Jul  9 16:10:47 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 9 Jul 2014 19:10:47 +0400
Subject: [rabbitmq-discuss] Consumer gets blocked leaving messages
 unacknowledged
In-Reply-To: <CAC7kndOd8JyohpDjaF2PDcH4edWnPuuNdpmBbtEmfpCHS9ccPg@mail.gmail.com>
References: <CAC7kndOd8JyohpDjaF2PDcH4edWnPuuNdpmBbtEmfpCHS9ccPg@mail.gmail.com>
Message-ID: <etPan.53bd5b93.7545e146.166fe@mercurio.local>

?On 9 July 2014 at 19:03:22, Jagadish Nadimpalli (jagadish.nadimpalli at oneconvergence.com) wrote:
> > We found the following link which is near to our problem. But,  
> we observe that open fds are not greater that the max limit (1024).  
> Anything else can lead to this situation?
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2014-May/036063.html  

Your RPC implementation consumes messages with manual acknowledgement
but never acknowledges deliveries. See tutorial 2:

http://www.rabbitmq.com/getstarted.html
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From mcintoshj at gmail.com  Wed Jul  9 20:22:57 2014
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Wed, 9 Jul 2014 14:22:57 -0500
Subject: [rabbitmq-discuss] Memory not flushing?
Message-ID: <CAD6m6fHZ3ZFyo50PY5ij4pspNKTHJrhVdh=ER97UYnc7CS-2fQ@mail.gmail.com>

Running 3.3.4, we have a situation (maybe an erlang R14B04 issue?) where
rabbit hits the memory alarm and never goes out of it.  The queue (with
over 100 million messages in it) is showing 0 memory usage, all messages
paged to disk, 0 in ram.  Disk IO is non existent.  Just looking for any
ideas/suggestions?  I saw this message:
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2013-April/026649.html
But wasn't sure it applied since the ram counts are 0?  If that's still
probably the issue, is there a way to set the target ram count to something
other than infinity?  e.g. rabbitmqctl set_paramter myqueue
target_ram_count 0.50?  Below are the memory reports from a few place.
Thanks!
Jason

#####
Memory report on the node via the api memory=true parameter:


   - {
      - total: 14309117272,
      - connection_procs: 1406816,
      - queue_procs: 10781072,
      - plugins: 637448,
      - other_proc: 9246264,
      - mnesia: 66312,
      - mgmt_db: 316096,
      - msg_index: 12411588360,
      - other_ets: 1844522120,
      - binary: 9166464,
      - code: 17795943,
      - atom: 1619705,
      - other_system: 1970672
      },
   - partitions: [ ],
   - os_pid: "23782",
   - fd_used: 53,
   - fd_total: 1024,
   - sockets_used: 27,
   - sockets_total: 829,
   - mem_used: 14309008432,
   - mem_limit: 1682936627,
   - mem_alarm: true,
   - disk_free_limit: 50000000,
   - disk_free: 362680954880,
   - disk_free_alarm: false,
   - proc_used: 472,
   - proc_total: 1048576,
   - statistics_level: "fine",
   - uptime: 88779083,
   - run_queue: 0,
   - processors: 4,
   - exchange_types:
   [

####
Backing queue status from the queue (only one queue):

   - backing_queue_status:
   {
      - q1: 0,
      - q2: 0,
      - delta:
      [
         - "delta",
         - 25034752,
         - 101610341,
         - 126670623
         ],
      - q3: 3667,
      - q4: 0,
      - len: 101614008,
      - pending_acks: 0,
      - target_ram_count: "infinity",
      - ram_msg_count: 0,
      - ram_ack_count: 0,
      - next_seq_id: 126670623,
      - persistent_count: 101614008,
      - avg_ingress_rate: 6.316340263548813e-276,
      - avg_egress_rate: 0,
      - avg_ack_ingress_rate: 0,
      - avg_ack_egress_rate: 0
      },
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140709/2eb01b29/attachment.html>

From mklishin at gopivotal.com  Wed Jul  9 20:29:24 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 9 Jul 2014 23:29:24 +0400
Subject: [rabbitmq-discuss] Memory not flushing?
In-Reply-To: <CAD6m6fHZ3ZFyo50PY5ij4pspNKTHJrhVdh=ER97UYnc7CS-2fQ@mail.gmail.com>
References: <CAD6m6fHZ3ZFyo50PY5ij4pspNKTHJrhVdh=ER97UYnc7CS-2fQ@mail.gmail.com>
Message-ID: <etPan.53bd982d.6b8b4567.b56@mercurio.local>

On 9 July 2014 at 23:25:12, Jason McIntosh (mcintoshj at gmail.com) wrote:
> > Running 3.3.4, we have a situation (maybe an erlang R14B04 issue?)  
> where rabbit hits the memory alarm and never goes out of it. The  
> queue (with over 100 million messages in it) is showing 0 memory  
> usage, all messages paged to disk, 0 in ram. Disk IO is non existent.  
> Just looking for any ideas/suggestions?

Unless you use the Tokyo Cabinet-based message index implementation [1], there's a fixed
RAM cost per message (something between 15-20 bytes AFAIR).?

1.?http://hg.rabbitmq.com/rabbitmq-toke/
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Wed Jul  9 20:30:36 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 9 Jul 2014 23:30:36 +0400
Subject: [rabbitmq-discuss] Memory not flushing?
In-Reply-To: <CAD6m6fHZ3ZFyo50PY5ij4pspNKTHJrhVdh=ER97UYnc7CS-2fQ@mail.gmail.com>
References: <CAD6m6fHZ3ZFyo50PY5ij4pspNKTHJrhVdh=ER97UYnc7CS-2fQ@mail.gmail.com>
Message-ID: <etPan.53bd9878.643c9869.b56@mercurio.local>

On 9 July 2014 at 23:25:12, Jason McIntosh (mcintoshj at gmail.com) wrote:
> > msg_index: 12411588360,

That's about 11.5 ?GB used by the message index.
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Wed Jul  9 20:36:30 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 9 Jul 2014 23:36:30 +0400
Subject: [rabbitmq-discuss] Memory not flushing?
In-Reply-To: <etPan.53bd9830.327b23c6.b56@mercurio.local>
References: <CAD6m6fHZ3ZFyo50PY5ij4pspNKTHJrhVdh=ER97UYnc7CS-2fQ@mail.gmail.com>
 <etPan.53bd9830.327b23c6.b56@mercurio.local>
Message-ID: <etPan.53bd99da.74b0dc51.b56@mercurio.local>

?On 9 July 2014 at 23:29:54, Michael Klishin (michael at rabbitmq.com) wrote:
> > there's a fixed
> RAM cost per message (something between 15-20 bytes AFAIR)

Nope, it's more like ~ 100 bytes. 11.5 GB then sounds about right for ~ 100M messages.

We need to document this :)
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From mcintoshj at gmail.com  Wed Jul  9 22:00:42 2014
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Wed, 9 Jul 2014 16:00:42 -0500
Subject: [rabbitmq-discuss] Updated RabbitMQ Monitoring for Zabbix
Message-ID: <CAD6m6fE3eEfdRmCNBo-1h5S0O82yb9KHn-fDyqTz-BX+goX_FA@mail.gmail.com>

https://github.com/jasonmcintosh/rabbitmq-zabbix

The newest release adds server publish/deliver_get stats for pretty
graphing, and per queue graphs and rates.  I've changed a few of the
default thresholds to be higher (number of messages in a queue for
example), and some other tweaks to the monitoring and template.

If anyone has any questions let me know,
Jason

-- 
Jason McIntosh
https://github.com/jasonmcintosh/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140709/eb8a920e/attachment.html>

From w_pg at qq.com  Thu Jul 10 05:01:40 2014
From: w_pg at qq.com (=?ISO-8859-1?B?TG9zdA==?=)
Date: Thu, 10 Jul 2014 12:01:40 +0800
Subject: [rabbitmq-discuss] Connection is always in "flow" State.
In-Reply-To: <etPan.53bbc314.2eb141f2.e013@mercurio.local>
References: <tencent_721DCB361ADD5CF0627708F8@qq.com>
 <etPan.53bbafc0.643c9869.e013@mercurio.local>
 <etPan.53bbb0d1.74b0dc51.e013@mercurio.local>
 <tencent_550186A75D01EDF5336F44C8@qq.com>
 <etPan.53bbbabf.46e87ccd.e013@mercurio.local>
 <tencent_4633D8BE193280DC1E808B38@qq.com>
 <etPan.53bbbbb9.3d1b58ba.e013@mercurio.local>
 <tencent_4EA6A6085832915E7AAA1300@qq.com>
 <etPan.53bbc314.2eb141f2.e013@mercurio.local>
Message-ID: <tencent_0814201D1A718AC9551802A6@qq.com>

runjava.bat com.rabbitmq.examples.PerfTest -y 0 -t "fanout"
starting producer #0
time: 1.000s, sent: 31063 msg/s
time: 2.001s, sent: 59184 msg/s
time: 3.001s, sent: 61560 msg/s
time: 4.001s, sent: 62564 msg/s
time: 5.001s, sent: 59613 msg/s
time: 6.002s, sent: 38134 msg/s
time: 7.002s, sent: 53956 msg/s
 connection: 5.7MB/s, flow state
channel: 62,706/s, running state
 
runjava.bat com.rabbitmq.examples.PerfTest -y 0 -t "fanout" -s 200 -r 2000
starting producer #0
time: 1.000s, sent: 1655 msg/s
time: 2.000s, sent: 2000 msg/s
time: 3.000s, sent: 2000 msg/s
time: 4.000s, sent: 2000 msg/s
time: 5.000s, sent: 2000 msg/s
time: 6.000s, sent: 2000 msg/s
time: 7.000s, sent: 2000 msg/s
 connection: 563kB/s, running state(never see flow state)
channel: 2,000/s, running state
  
 This is my test result, it really very faster than my applicaion.
 I use rabbbitmq-c(a c language lib), i found it demo is also faster than my app.
 I have add a rate limit to my app, my msg size is about 100~200 byte, i found if message rate > 2000, the connection is always going to flow state(<500KB/s).
 It really strange, the different my app with this demo is my app is a tcp client, it receive msg from a tcp server, do some convert and publish to RabbitMQ.




------------------ Original message ------------------
From: "Michael Klishin"; 
Sendtime: Tuesday, Jul 8, 2014 6:07 PM
To: "Lost"; "rabbitmq-discuss"; 
Subject: Re: [rabbitmq-discuss] Connection is always in "flow" State.



On 8 July 2014 at 13:39:59, Lost (w_pg at qq.com) wrote:
> > Yes, just one connection, one channel and publish to a exchange(no 
> any queues to bind it.)

You can simulate this setup with PerfTest [1]:

./runjava.sh com.rabbitmq.examples.PerfTest -y 0 -t "fanout"

and tweak various options such as message size.

For example, running PerfTest with the options above stabilizes
at about 65-70 K messages per second on my (1 gen old, not maxed-out)
MacBook Pro.

1. http://www.rabbitmq.com/java-tools.html
--
MK 

Staff Software Engineer, Pivotal/RabbitMQ
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140710/2fca1bc6/attachment.html>

From jagadish.nadimpalli at oneconvergence.com  Thu Jul 10 07:22:17 2014
From: jagadish.nadimpalli at oneconvergence.com (Jagadish Nadimpalli)
Date: Thu, 10 Jul 2014 11:52:17 +0530
Subject: [rabbitmq-discuss] Consumer gets blocked leaving messages
	unacknowledged
In-Reply-To: <etPan.53bd5b93.7545e146.166fe@mercurio.local>
References: <CAC7kndOd8JyohpDjaF2PDcH4edWnPuuNdpmBbtEmfpCHS9ccPg@mail.gmail.com>
 <etPan.53bd5b93.7545e146.166fe@mercurio.local>
Message-ID: <CAC7kndOBLkHtPEsQjwjjR_OkxjK6Feq02APMNDDQBB6MewSPdw@mail.gmail.com>

MK,

Thanks for the response. Is there any reason why the client RPC is not
consuming the message.


On Wed, Jul 9, 2014 at 8:40 PM, Michael Klishin <mklishin at gopivotal.com>
wrote:

>  On 9 July 2014 at 19:03:22, Jagadish Nadimpalli (
> jagadish.nadimpalli at oneconvergence.com) wrote:
> > > We found the following link which is near to our problem. But,
> > we observe that open fds are not greater that the max limit (1024).
> > Anything else can lead to this situation?
> >
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2014-May/036063.html
>
> Your RPC implementation consumes messages with manual acknowledgement
> but never acknowledges deliveries. See tutorial 2:
>
> http://www.rabbitmq.com/getstarted.html
> --
> MK
>
> Staff Software Engineer, Pivotal/RabbitMQ
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140710/aa10e259/attachment.html>

From mklishin at gopivotal.com  Thu Jul 10 09:38:54 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 10 Jul 2014 12:38:54 +0400
Subject: [rabbitmq-discuss] Consumer gets blocked leaving messages
 unacknowledged
In-Reply-To: <CAC7kndOBLkHtPEsQjwjjR_OkxjK6Feq02APMNDDQBB6MewSPdw@mail.gmail.com>
References: <CAC7kndOd8JyohpDjaF2PDcH4edWnPuuNdpmBbtEmfpCHS9ccPg@mail.gmail.com>
 <etPan.53bd5b93.7545e146.166fe@mercurio.local>
 <CAC7kndOBLkHtPEsQjwjjR_OkxjK6Feq02APMNDDQBB6MewSPdw@mail.gmail.com>
Message-ID: <etPan.53be513c.643c9869.2efb@mercurio.local>



On 10 July 2014 at 10:23:31, Jagadish Nadimpalli (jagadish.nadimpalli at oneconvergence.com) wrote:
> > Thanks for the response. Is there any reason why the client RPC 
> is not consuming the message.

Because if you use basic.qos but never acknowledge, at some point you will
run over the limit and no messages will be delivered to your consumer
until one of the earlier deliveries are acknowledged.
-- 
MK 

Staff Software Engineer, Pivotal/RabbitMQ

From simon at rabbitmq.com  Thu Jul 10 11:24:28 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 10 Jul 2014 11:24:28 +0100
Subject: [rabbitmq-discuss] Memory not flushing?
In-Reply-To: <CAD6m6fHZ3ZFyo50PY5ij4pspNKTHJrhVdh=ER97UYnc7CS-2fQ@mail.gmail.com>
References: <CAD6m6fHZ3ZFyo50PY5ij4pspNKTHJrhVdh=ER97UYnc7CS-2fQ@mail.gmail.com>
Message-ID: <53BE69DC.4080102@rabbitmq.com>

I think Michael already answered your real question - you are running 
into the msg store index using all memory. But to answer some of your 
sub-questions...

On 09/07/2014 8:22PM, Jason McIntosh wrote:
> I saw this message:
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2013-April/026649.html
> But wasn't sure it applied since the ram counts are 0?

No, it doesn't. If the ram count is 0, all messages are paged out.

> If that's still
> probably the issue, is there a way to set the target ram count to
> something other than infinity?  e.g. rabbitmqctl set_paramter myqueue
> target_ram_count 0.50?

The target ram count is managed automatically. Ultimately it's derived 
from vm_memory_high_watermark_paging_ratio, via a system which attempts 
to ensure that all queues get a fair share of memory, where "fair" is 
defined as "slow-moving queues page out earlier than fast-moving queues, 
since they're slow anyway". It's a feedback-based system though, which 
means that if all queues are not accepting messages (i.e. when the 
memory alarm goes off) then it can end up saying "infinity". If the 
queue started moving again that number would go down some (and it's 
clearly been 0 in the past, hence the ram_msg_count).

Cheers, Simon

> Below are the memory reports from a few place.
> Thanks!
> Jason
>
> #####
> Memory report on the node via the api memory=true parameter:
>
>   *
>     {
>       o
>         total: 14309117272,
>       o
>         connection_procs: 1406816,
>       o
>         queue_procs: 10781072,
>       o
>         plugins: 637448,
>       o
>         other_proc: 9246264,
>       o
>         mnesia: 66312,
>       o
>         mgmt_db: 316096,
>       o
>         msg_index: 12411588360,
>       o
>         other_ets: 1844522120,
>       o
>         binary: 9166464,
>       o
>         code: 17795943,
>       o
>         atom: 1619705,
>       o
>         other_system: 1970672
>     },
>   *
>     partitions: [ ],
>   *
>     os_pid: "23782",
>   *
>     fd_used: 53,
>   *
>     fd_total: 1024,
>   *
>     sockets_used: 27,
>   *
>     sockets_total: 829,
>   *
>     mem_used: 14309008432,
>   *
>     mem_limit: 1682936627,
>   *
>     mem_alarm: true,
>   *
>     disk_free_limit: 50000000,
>   *
>     disk_free: 362680954880,
>   *
>     disk_free_alarm: false,
>   *
>     proc_used: 472,
>   *
>     proc_total: 1048576,
>   *
>     statistics_level: "fine",
>   *
>     uptime: 88779083,
>   *
>     run_queue: 0,
>   *
>     processors: 4,
>   *
>     exchange_types:
>     [
>
> ####
> Backing queue status from the queue (only one queue):
>
>   *
>     backing_queue_status:
>     {
>       o
>         q1: 0,
>       o
>         q2: 0,
>       o
>         delta:
>         [
>           +
>             "delta",
>           +
>             25034752,
>           +
>             101610341,
>           +
>             126670623
>         ],
>       o
>         q3: 3667,
>       o
>         q4: 0,
>       o
>         len: 101614008,
>       o
>         pending_acks: 0,
>       o
>         target_ram_count: "infinity",
>       o
>         ram_msg_count: 0,
>       o
>         ram_ack_count: 0,
>       o
>         next_seq_id: 126670623,
>       o
>         persistent_count: 101614008,
>       o
>         avg_ingress_rate: 6.316340263548813e-276,
>       o
>         avg_egress_rate: 0,
>       o
>         avg_ack_ingress_rate: 0,
>       o
>         avg_ack_egress_rate: 0
>     },
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list has moved to https://groups.google.com/forum/#!forum/rabbitmq-users,
> please subscribe to the new list!
>
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

-- 
Simon MacMullen
RabbitMQ, Pivotal

From cesar.munoz at ammeon.com  Thu Jul 10 15:02:53 2014
From: cesar.munoz at ammeon.com (Cesar Munoz)
Date: Thu, 10 Jul 2014 15:02:53 +0100
Subject: [rabbitmq-discuss] RabbitMQ waits forever for PID file during
	startup
In-Reply-To: <CAHuDZ5qXfRaf4AOXYoe1gvB0tu=xb6q8DPhJ_vHy2RW1QoSp3g@mail.gmail.com>
References: <aed0727b-fe57-4f12-8801-a523e57f3bb2@googlegroups.com>
 <539186EF.7010901@rabbitmq.com>
 <CAHuDZ5rofeocjpouy5DuhvHxpbqAhH1UO00yeG=fEYT94r=XOw@mail.gmail.com>
 <53919798.4080306@rabbitmq.com>
 <CAHuDZ5qXfRaf4AOXYoe1gvB0tu=xb6q8DPhJ_vHy2RW1QoSp3g@mail.gmail.com>
Message-ID: <CAHuDZ5pxuvDXjcEnYf4-8fdjHFY=fknmRW=UV26sofmDdZiV2Q@mail.gmail.com>

Hi Simon,

so we have tried to find the problem with the initial installation, but no
luck yet. It is very difficult to track it, as it is totally
non-deterministic!
In the meantime, we installed the latest version of RabbitMQ, which
includes de set -e fix, but the same issue still happened. Given the output
of ps auxf

https://gist.github.com/anonymous/62239513b154179a8a4e

it looks like

/bin/sh /etc/init.d/rabbitmq-server start

and

/bin/sh /usr/sbin/rabbitmqctl wait /var/run/rabbitmq/pid

were running concurrently. Is there any chance that this fact created some
sort of race condition between these 2 processes that would make the set -e
fix not work?

Cheers,
Cesar.



On 6 June 2014 11:55, Cesar Munoz <cesar.munoz at ammeon.com> wrote:

> Hi Simon,
>
> the ulimits for rabbitmq user are pretty much the same, the only
> difference is that max user processes is set to 1024 instead of 2066207.
>
> About the system itself, it is true that there has to be something strange
> going on if a shell redirection can fail, but I'm checking the
> configuration and I don't see anything specially awkward.
>
> We are using Red Hat 6.4, and these are the parameters that we set in the
> sysctl.conf:
> http://pastebin.com/SfJBwrna
>
> The rest of the parameters in the kickstart file are pretty much the
> standard ones.
> This is an intermittent issue (we are testing how often it happens, so far
> we got 3 failures in 13 installations), so it is harder to track it!
> Either way, restarting the service works, so it looks like whatever causes
> the problem disappears after a while. I've been trying to find what could
> make this non-deterministic, but so far I haven't noticed anything unusual.
>
> Thanks again!
> Cesar.
>
>
> On 6 June 2014 11:27, Simon MacMullen <simon at rabbitmq.com> wrote:
>
>> On 06/06/2014 10:49AM, Cesar Munoz wrote:
>>
>>> Hi Simon,
>>>
>>> the set -e looks like a very good idea, at least the process will return
>>> the failure straight away!
>>>
>>
>> Sure!
>>
>>
>>  These are the ulimits:
>>>
>>> [root at ms1 ~]# ulimit -a
>>>
>>
>> <snip>
>>
>> Those are the ulimits which apply to root - maybe they are different for
>> the "rabbitmq" user?
>>
>> But more to the point: we're failing to do something very very simple
>> here, there has to be something weird about this system if echo or shell
>> redirection can fail with an error message about memory allocation.
>>
>> So have you configured anything unusual about this system?
>>
>>
>> Cheers, Simon
>>
>> --
>> Simon MacMullen
>> RabbitMQ, Pivotal
>>
>
>

-- 
This email and any files transmitted with it are confidential and intended 
solely for the use of the individual or entity to whom they are addressed. 
If you have received this email in error please notify the system manager. 
This message contains confidential information and is intended only for the 
individual named. If you are not the named addressee you should not 
disseminate, distribute or copy this e-mail.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140710/193fc455/attachment.html>

From mcintoshj at gmail.com  Thu Jul 10 15:31:09 2014
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Thu, 10 Jul 2014 09:31:09 -0500
Subject: [rabbitmq-discuss] Connection is always in "flow" State.
In-Reply-To: <etPan.53bbacf8.6b8b4567.e013@mercurio.local>
References: <tencent_721DCB361ADD5CF0627708F8@qq.com>
 <etPan.53bbacf8.6b8b4567.e013@mercurio.local>
Message-ID: <CAD6m6fFY6AucRkDyMoDpNRJ0zBGmAAkpOdQdyc=mWq0fOqQ2gA@mail.gmail.com>

Just a quick confirmation on this.  The documentation states that flow
control is:

   - A per-connection mechanism that prevents messages being published
   faster than they can be routed to queues.
   - A global mechanism that prevents any messages from being published
   when the memory usage <http://www.rabbitmq.com/memory-use.html> exceeds
   a configured threshold or free disk space drops below a configured
   threshold.

In my testing, I've actually seen this as well - where messages can backlog
(so far seems to the point of available resources), while a consumer is
chugging along at half the publish speed.  SO is flow control also
triggered by consumer processing?  At what point does consumer handling
trigger flow control if so?  Just looking for a little bit of clarification
on this - I'm guessing there's some internal logic someplace I'm missing on
this,
Thanks!
Jason


On Tue, Jul 8, 2014 at 3:33 AM, Michael Klishin <mklishin at gopivotal.com>
wrote:

>
>
> On 8 July 2014 at 07:49:26, Lost (w_pg at qq.com) wrote:
> > > I have a client to publish message to rabbitmq(1 connection
> > and 1 channel, in same machine with rabbitmq), no consumer.
> > Message rates is 2000/s ~ 3000/s
> > Traffic is 300Kb/s ~ 750kB/s
> > The channel state is "running", but the connection state is always
> > "flow".
> > I found erl.exe cpu is only 5% ~ 10%, but why connection is in "flow"
> > state?
>
> Flow control does not depend on CPU usage but rather whether consumers
> can keep up with producers. Try adding a consumer.
> --
> MK
>
> Staff Software Engineer, Pivotal/RabbitMQ
> _______________________________________________
> rabbitmq-discuss mailing list has moved to
> https://groups.google.com/forum/#!forum/rabbitmq-users,
> please subscribe to the new list!
>
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Jason McIntosh
https://github.com/jasonmcintosh/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140710/cd95c915/attachment.html>

From mcintoshj at gmail.com  Thu Jul 10 15:39:55 2014
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Thu, 10 Jul 2014 09:39:55 -0500
Subject: [rabbitmq-discuss] rabbitmqctl start_app hangs when replacing
 mirrored cluster instances in EC2
In-Reply-To: <d651f7cc-1ff6-4451-87a6-e912d4aa0f2e@googlegroups.com>
References: <d651f7cc-1ff6-4451-87a6-e912d4aa0f2e@googlegroups.com>
Message-ID: <CAD6m6fH_SpdjZKd2i4qKdmKkLm7JBnzVwbgZywQobi5yZ7i3Lg@mail.gmail.com>

If this is what I've seen before the cluster thinks C is node XYZ.  But
you're trying to tell the cluster that C is really your new host YZX.  You
need to remove the old node from the cluster to add your new node as a
replacement for C.  Your new node tries to start up and thinks it should be
part of the cluster because you just tried to join it, but the cluster
refuses to accept the new node so it seems to hang.  I could be completely
wrong on this though.

As I recall, there was a rabbitmqctl command to completely remove a node
from the cluster, though I don't recall what it is off hand.  You could try
doing that first and then adding your node?

Jason


On Mon, Jul 7, 2014 at 6:30 AM, Mike Zraly <mzraly at gmail.com> wrote:

> [I tried posting this to the new group, rabbitmq-users, but got no
> response.  Google groups tells me rabbitmq-users only has 101 members now,
> compared to 1800 or so for rabbitmq-discuss, so I hope re-posting to the
> larger group will at least elicit some (non-meta) feedback.]
>
> Hi all,
>
> I am setting up a RabbitMQ cluster in an Amazon EC2 region.  Each host is
> in the same geographical region, so I do not expect network partitions in
> the sense that two members of the cluster are both running but cannot
> communicate with each other.  However it is reasonable to expect individual
> cluster hosts to be terminated and replaced with new hosts having the same
> hostname but a new IP address and a fresh install of RabbitMQ.  A typical
> use case for this is a rolling upgrade where we keep 2 of the 3 cluster
> nodes up at all times to continue providing service during the upgrade
> period.
>
> What I hope is that the same post-install provisioning script that joins a
> newly created instance into the cluster will work for the new instance that
> is taking over for an older one.  What I am seeing is rabbitmqctl start_app
> hang.
>
> The installation sequence is basically this:
>
> install rabbitmq-server_3.3.1-1
> enable management plugin
> add health check user account with monitoring tag
> add application user account
> add HA policy '{"ha-mode": "all", "ha-sync-mode": "automatic"} for all
> application queues
> service rabbitmq-server stop
> set /var/lib/rabbitmq/.erlang.cookie
> reboot system (restarting rabbitmq server)
> for each hostname 'target' that this host should join into a cluster with:
>     if target is listening on port 5672
>         rabbitmqctl stop_app
>         if rabbitmqctl join_cluster target has non-zero exit status
>             rabbitmqctl start_app
>
> What I see if I start a cluster with hosts A, B, and C, then terminate
> instance C and replace it with a new instance that executes these same
> steps, is that rabbitmqctl join_cluster succeeds saying C is already part
> of the cluster, then rabbitmqctl start_app hangs.
>
> What am I doing wrong?
>
>
> _______________________________________________
> rabbitmq-discuss mailing list has moved to
> https://groups.google.com/forum/#!forum/rabbitmq-users,
> please subscribe to the new list!
>
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
Jason McIntosh
https://github.com/jasonmcintosh/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140710/580803d4/attachment.html>

From simon at rabbitmq.com  Thu Jul 10 15:49:52 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 10 Jul 2014 15:49:52 +0100
Subject: [rabbitmq-discuss] rabbitmqctl start_app hangs when replacing
 mirrored cluster instances in EC2
In-Reply-To: <CAD6m6fH_SpdjZKd2i4qKdmKkLm7JBnzVwbgZywQobi5yZ7i3Lg@mail.gmail.com>
References: <d651f7cc-1ff6-4451-87a6-e912d4aa0f2e@googlegroups.com>
 <CAD6m6fH_SpdjZKd2i4qKdmKkLm7JBnzVwbgZywQobi5yZ7i3Lg@mail.gmail.com>
Message-ID: <53BEA810.5000800@rabbitmq.com>

Correct.

See my answer in the new group here :-)

https://groups.google.com/forum/#!topic/rabbitmq-users/QoHbNrK_Zg4

Cheers, Simon

On 10/07/2014 3:39PM, Jason McIntosh wrote:
> If this is what I've seen before the cluster thinks C is node XYZ.  But
> you're trying to tell the cluster that C is really your new host YZX.
>   You need to remove the old node from the cluster to add your new node
> as a replacement for C.  Your new node tries to start up and thinks it
> should be part of the cluster because you just tried to join it, but the
> cluster refuses to accept the new node so it seems to hang.  I could be
> completely wrong on this though.
>
> As I recall, there was a rabbitmqctl command to completely remove a node
> from the cluster, though I don't recall what it is off hand.  You could
> try doing that first and then adding your node?
>
> Jason
>
>
> On Mon, Jul 7, 2014 at 6:30 AM, Mike Zraly <mzraly at gmail.com
> <mailto:mzraly at gmail.com>> wrote:
>
>     [I tried posting this to the new group, rabbitmq-users, but got no
>     response.  Google groups tells me rabbitmq-users only has 101
>     members now, compared to 1800 or so for rabbitmq-discuss, so I hope
>     re-posting to the larger group will at least elicit some (non-meta)
>     feedback.]
>
>     Hi all,
>
>     I am setting up a RabbitMQ cluster in an Amazon EC2 region.  Each
>     host is in the same geographical region, so I do not expect network
>     partitions in the sense that two members of the cluster are both
>     running but cannot communicate with each other.  However it is
>     reasonable to expect individual cluster hosts to be terminated and
>     replaced with new hosts having the same hostname but a new IP
>     address and a fresh install of RabbitMQ.  A typical use case for
>     this is a rolling upgrade where we keep 2 of the 3 cluster nodes up
>     at all times to continue providing service during the upgrade period.
>
>     What I hope is that the same post-install provisioning script that
>     joins a newly created instance into the cluster will work for the
>     new instance that is taking over for an older one.  What I am seeing
>     is rabbitmqctl start_app hang.
>
>     The installation sequence is basically this:
>
>     install rabbitmq-server_3.3.1-1
>     enable management plugin
>     add health check user account with monitoring tag
>     add application user account
>     add HA policy '{"ha-mode": "all", "ha-sync-mode": "automatic"} for
>     all application queues
>     service rabbitmq-server stop
>     set /var/lib/rabbitmq/.erlang.__cookie
>     reboot system (restarting rabbitmq server)
>     for each hostname 'target' that this host should join into a cluster
>     with:
>          if target is listening on port 5672
>              rabbitmqctl stop_app
>              if rabbitmqctl join_cluster target has non-zero exit status
>                  rabbitmqctl start_app
>
>     What I see if I start a cluster with hosts A, B, and C, then
>     terminate instance C and replace it with a new instance that
>     executes these same steps, is that rabbitmqctl join_cluster succeeds
>     saying C is already part of the cluster, then rabbitmqctl start_app
>     hangs.
>
>     What am I doing wrong?
>
>
>     _______________________________________________
>     rabbitmq-discuss mailing list has moved to
>     https://groups.google.com/forum/#!forum/rabbitmq-users,
>     please subscribe to the new list!
>
>     rabbitmq-discuss at lists.rabbitmq.com
>     <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>     https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
>
> --
> Jason McIntosh
> https://github.com/jasonmcintosh/
> 573-424-7612
>
>
> _______________________________________________
> rabbitmq-discuss mailing list has moved to https://groups.google.com/forum/#!forum/rabbitmq-users,
> please subscribe to the new list!
>
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

-- 
Simon MacMullen
RabbitMQ, Pivotal

From ramesh25 at gmail.com  Thu Jul 10 15:51:08 2014
From: ramesh25 at gmail.com (Ramesh Natarajan)
Date: Thu, 10 Jul 2014 09:51:08 -0500
Subject: [rabbitmq-discuss] rabbitmq cluster startup problem
Message-ID: <CAGmOvD+xf3rvDehv+swPFEEDN+2VQduiHsEzWdb2n76+3jesDw@mail.gmail.com>

We are currently running a rabbitmq cluster running on RHEL 6.5 64 bit os,
comprising of 10 nodes. We use the auto-configuration for the cluster where
the first node doesn't have any cluster_nodes specified in the
rabbitmq.config and all other nodes have just the first node specified in
the cluster_nodes.  I bring up the first node and then the rest of the
nodes.  I see the cluster is setup correctly and things seem to work fine.


However occasionally when the nodes reboot I see the startup hangs in
Starting rabbitmq-cluster. It seems to hang forever and doesn't timeout or
anything.  In some cases we have left the system for a couple of hours and
it doesn't seem to timeout, suggesting the system is in a deadlock or
something.  A reset of the node in the hung state sometimes recovers and
sometimes it doesn't.

The strange part is I cannot reproduce this at will but it happens
nevertheless.

Has anyone seen this behavior?

Is specifying the cluster_nodes the way I described is the correct way to
do so?

I would appreciate if anyone has any suggestions on how to deal with this
issue..

Thanks
Ramesh


 {running_applications,[{rabbit,"RabbitMQ","3.3.1"},
                        {os_mon,"CPO  CXC 138 46","2.2.7"},
                        {xmerl,"XML parser","1.2.10"},
                        {mnesia,"MNESIA  CXC 138 12","4.5"},
                        {sasl,"SASL  CXC 138 11","2.1.10"},
                        {stdlib,"ERTS  CXC 138 10","1.17.5"},
                        {kernel,"ERTS  CXC 138 10","2.14.5"}]},
 {os,{unix,linux}},
 {erlang_version,"Erlang R14B04 (erts-5.8.5) [source] [64-bit] [smp:4:4]
[rq:4] [async-threads:30] [kernel-poll:true]\n"},
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140710/9d739611/attachment.html>

From mcintoshj at gmail.com  Thu Jul 10 16:00:42 2014
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Thu, 10 Jul 2014 10:00:42 -0500
Subject: [rabbitmq-discuss] Introducing the RabbitMQ Sharding Plugin
In-Reply-To: <CAMcAHLWRKP0RcC=TskhHzfZWBOg4eaFA6o96ZzYT9b1VN-5keQ@mail.gmail.com>
References: <CAMcAHLWEvvea1GNGZqxb=HyTnwCPTitsEu3raWZSQX5QNg+Fww@mail.gmail.com>
 <etPan.5346b614.6b68079a.704@s826.ofc.lair>
 <CAD6m6fHN57V07wa2nwRw5Gqjr6FxnbkM--Ct0OO5pDST1+b27g@mail.gmail.com>
 <CAMcAHLWRKP0RcC=TskhHzfZWBOg4eaFA6o96ZzYT9b1VN-5keQ@mail.gmail.com>
Message-ID: <CAD6m6fFJk51HtjkzV+32P1QTO9XKizxZHhevjUokjfCZ4+SrHw@mail.gmail.com>

Since I just saw this crop up again on the list, thought I'd ask again on
this plugin as it looks danged handy.  With geographically distributed data
centers, we're using RabbitMQ to replicate data and information to remote
data centers.  But with the WAN latency, we hit an issue where a single
queue would seemingly get backlogged trying to shovel messages across the
WAN.  SO we used x-consistent-hashes to basically do something like this:
Publish to a fanout exchange "bob"
bob is bound to "bob.multi"
bob.multi is an x-consistent-hash bound to 8 queues, "bobs.data.1" through
"bobs.data.8".  We then shovel "bobs.data.1" through 8 to a remote system
that has a single exchange "bob" with a single queue "bobs.data".  We have
the shovel config over ride the routing key and exchange on the publish
side so things land in one spot.  If I didn't have to script this logic out
I'd be more than happy to switch to using the "shard" exchange.  And the
goal on the remote side is to have a single consumer (java process)
connected to queue "bobs.data" on the remote side, and a single publisher
publishing to "bob" on the publish side.  I THINK I may have misunderstood
the earlier comment where we'd need 1 consumer per shard thing.

Jason




On Thu, Apr 10, 2014 at 3:10 PM, Alvaro Videla <videlalvaro at gmail.com>
wrote:

> Hi,
>
> On Thu, Apr 10, 2014 at 10:07 PM, Jason McIntosh <mcintoshj at gmail.com>
> wrote:
> >   The one thing I didn't see in the post was how many consumers you'd
> need.
> > It sounds like you'd need at least N consumers where N is the number of
> > nodes in the shard?  With the shoveling config, we'd need to dynamically
> > grow consumers to adapt to the cluster size it sounds like.
> >
>
> Yes, at the moment you would need 1 consumer per shard. So if the
> shard-per-node value is 4, then you'd need 4 consumers per node in the
> cluster.
>
> Regards,
>
> Alvaro
>



-- 
Jason McIntosh
https://github.com/jasonmcintosh/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140710/5c8eb401/attachment.html>

From simon at rabbitmq.com  Thu Jul 10 16:01:36 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 10 Jul 2014 16:01:36 +0100
Subject: [rabbitmq-discuss] Connection is always in "flow" State.
In-Reply-To: <CAD6m6fFY6AucRkDyMoDpNRJ0zBGmAAkpOdQdyc=mWq0fOqQ2gA@mail.gmail.com>
References: <tencent_721DCB361ADD5CF0627708F8@qq.com>
 <etPan.53bbacf8.6b8b4567.e013@mercurio.local>
 <CAD6m6fFY6AucRkDyMoDpNRJ0zBGmAAkpOdQdyc=mWq0fOqQ2gA@mail.gmail.com>
Message-ID: <53BEAAD0.3080202@rabbitmq.com>

On 10/07/2014 3:31PM, Jason McIntosh wrote:
> Just a quick confirmation on this.  The documentation states that flow
> control is:
>
>   * A per-connection mechanism that prevents messages being published
>     faster than they can be routed to queues.
>   * A global mechanism that prevents any messages from being published
>     when the memory usage
>     <http://www.rabbitmq.com/memory-use.html> exceeds a configured
>     threshold or free disk space drops below a configured threshold.

That documentation desperately needs a rewrite :-( It doesn't make very 
clear at all that the "flow" state applies to the first of those two 
cases only; the second will show as "blocking" or "blocked".

> In my testing, I've actually seen this as well - where messages can
> backlog (so far seems to the point of available resources), while a
> consumer is chugging along at half the publish speed.

Was this with 3.3.x?

3.3.x ensures that if consumers and producers are both going as fast as 
they can for an individual queue, then the consumers will consume ~10% 
faster than the producers produce.

For earlier releases there is no such guarantee; it's possible for the 
queue to just naturally accept more messages than it delivers. See the 
blog post on the subject:

http://www.rabbitmq.com/blog/2014/04/10/consumer-bias-in-rabbitmq-3-3/

> SO is flow
> control also triggered by consumer processing?

Not really; Michael was misinformed in the post you replied to. Flow 
control is explained a bit more at 
http://www.rabbitmq.com/blog/2014/04/14/finding-bottlenecks-with-rabbitmq-3-3/ 
but in short flow control just means that something in the chain 
(connection -> channel -> queue -> message store) is working as hard as 
it can, and that therefore a publisher is not publishing as fast as it 
would otherwise like to.

> At what point does
> consumer handling trigger flow control if so?  Just looking for a little
> bit of clarification on this - I'm guessing there's some internal logic
> someplace I'm missing on this,

It doesn't, really. Well, it's possible that you could push the queue 
over to being CPU-bound by adding another consumer and thus having it do 
slightly more work, but you'd have to be teetering on the edge anyway.

Cheers, Simon

> Thanks!
> Jason
>
>
> On Tue, Jul 8, 2014 at 3:33 AM, Michael Klishin <mklishin at gopivotal.com
> <mailto:mklishin at gopivotal.com>> wrote:
>
>
>
>     On 8 July 2014 at 07:49:26, Lost (w_pg at qq.com <mailto:w_pg at qq.com>)
>     wrote:
>      > > I have a client to publish message to rabbitmq(1 connection
>      > and 1 channel, in same machine with rabbitmq), no consumer.
>      > Message rates is 2000/s ~ 3000/s
>      > Traffic is 300Kb/s ~ 750kB/s
>      > The channel state is "running", but the connection state is always
>      > "flow".
>      > I found erl.exe cpu is only 5% ~ 10%, but why connection is in "flow"
>      > state?
>
>     Flow control does not depend on CPU usage but rather whether consumers
>     can keep up with producers. Try adding a consumer.
>     --
>     MK
>
>     Staff Software Engineer, Pivotal/RabbitMQ
>     _______________________________________________
>     rabbitmq-discuss mailing list has moved to
>     https://groups.google.com/forum/#!forum/rabbitmq-users,
>     please subscribe to the new list!
>
>     rabbitmq-discuss at lists.rabbitmq.com
>     <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>     https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
>
> --
> Jason McIntosh
> https://github.com/jasonmcintosh/
> 573-424-7612
>
>
> _______________________________________________
> rabbitmq-discuss mailing list has moved to https://groups.google.com/forum/#!forum/rabbitmq-users,
> please subscribe to the new list!
>
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

-- 
Simon MacMullen
RabbitMQ, Pivotal

From mcintoshj at gmail.com  Thu Jul 10 16:23:31 2014
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Thu, 10 Jul 2014 10:23:31 -0500
Subject: [rabbitmq-discuss] Connection is always in "flow" State.
In-Reply-To: <53BEAAD0.3080202@rabbitmq.com>
References: <tencent_721DCB361ADD5CF0627708F8@qq.com>
 <etPan.53bbacf8.6b8b4567.e013@mercurio.local>
 <CAD6m6fFY6AucRkDyMoDpNRJ0zBGmAAkpOdQdyc=mWq0fOqQ2gA@mail.gmail.com>
 <53BEAAD0.3080202@rabbitmq.com>
Message-ID: <CAD6m6fGPAbgR2jjRGit8cYNXkO2iC7wCc0ArGz6ZLnu35JUDZg@mail.gmail.com>

Interesting on the 3.3 change.  SO I gotta ask about this situation on that
(though it sounds off hand that'll fix the behavior I've seen on 3.2.4).
 If a consumer is consumer at 80 msgs/second, but incoming rates are able
to publish at 5k a second and the server CPU's/disks/etc. aren't being
touched, will rabbit then put back pressure on the publishing rate forcing
it down to 72 msgs/second (~10% less than consumes)?  I'd assume then
that'd propagate up to the publisher if there's a chain of rabbit servers
all running 3.3 - e.g. the code publish to rabbit which shovels to the
remote rabbit where the code consumer runs.  In this case the code
publisher would get back pressure that'd reduce it's publish rate to
~72msgs/second?

Jason


On Thu, Jul 10, 2014 at 10:01 AM, Simon MacMullen <simon at rabbitmq.com>
wrote:

> On 10/07/2014 3:31PM, Jason McIntosh wrote:
>
>> Just a quick confirmation on this.  The documentation states that flow
>> control is:
>>
>>   * A per-connection mechanism that prevents messages being published
>>
>>     faster than they can be routed to queues.
>>   * A global mechanism that prevents any messages from being published
>>     when the memory usage
>>     <http://www.rabbitmq.com/memory-use.html> exceeds a configured
>>
>>     threshold or free disk space drops below a configured threshold.
>>
>
> That documentation desperately needs a rewrite :-( It doesn't make very
> clear at all that the "flow" state applies to the first of those two cases
> only; the second will show as "blocking" or "blocked".
>
>
>  In my testing, I've actually seen this as well - where messages can
>> backlog (so far seems to the point of available resources), while a
>> consumer is chugging along at half the publish speed.
>>
>
> Was this with 3.3.x?
>
> 3.3.x ensures that if consumers and producers are both going as fast as
> they can for an individual queue, then the consumers will consume ~10%
> faster than the producers produce.
>
> For earlier releases there is no such guarantee; it's possible for the
> queue to just naturally accept more messages than it delivers. See the blog
> post on the subject:
>
> http://www.rabbitmq.com/blog/2014/04/10/consumer-bias-in-rabbitmq-3-3/
>
>
>  SO is flow
>> control also triggered by consumer processing?
>>
>
> Not really; Michael was misinformed in the post you replied to. Flow
> control is explained a bit more at http://www.rabbitmq.com/blog/
> 2014/04/14/finding-bottlenecks-with-rabbitmq-3-3/ but in short flow
> control just means that something in the chain (connection -> channel ->
> queue -> message store) is working as hard as it can, and that therefore a
> publisher is not publishing as fast as it would otherwise like to.
>
>
>  At what point does
>> consumer handling trigger flow control if so?  Just looking for a little
>> bit of clarification on this - I'm guessing there's some internal logic
>> someplace I'm missing on this,
>>
>
> It doesn't, really. Well, it's possible that you could push the queue over
> to being CPU-bound by adding another consumer and thus having it do
> slightly more work, but you'd have to be teetering on the edge anyway.
>
> Cheers, Simon
>
>  Thanks!
>> Jason
>>
>>
>> On Tue, Jul 8, 2014 at 3:33 AM, Michael Klishin <mklishin at gopivotal.com
>> <mailto:mklishin at gopivotal.com>> wrote:
>>
>>
>>
>>     On 8 July 2014 at 07:49:26, Lost (w_pg at qq.com <mailto:w_pg at qq.com>)
>>
>>     wrote:
>>      > > I have a client to publish message to rabbitmq(1 connection
>>      > and 1 channel, in same machine with rabbitmq), no consumer.
>>      > Message rates is 2000/s ~ 3000/s
>>      > Traffic is 300Kb/s ~ 750kB/s
>>      > The channel state is "running", but the connection state is always
>>      > "flow".
>>      > I found erl.exe cpu is only 5% ~ 10%, but why connection is in
>> "flow"
>>      > state?
>>
>>     Flow control does not depend on CPU usage but rather whether consumers
>>     can keep up with producers. Try adding a consumer.
>>     --
>>     MK
>>
>>     Staff Software Engineer, Pivotal/RabbitMQ
>>     _______________________________________________
>>     rabbitmq-discuss mailing list has moved to
>>     https://groups.google.com/forum/#!forum/rabbitmq-users,
>>     please subscribe to the new list!
>>
>>     rabbitmq-discuss at lists.rabbitmq.com
>>     <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>>
>>     https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>>
>>
>> --
>> Jason McIntosh
>> https://github.com/jasonmcintosh/
>> 573-424-7612
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list has moved to https://groups.google.com/
>> forum/#!forum/rabbitmq-users,
>> please subscribe to the new list!
>>
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>



-- 
Jason McIntosh
https://github.com/jasonmcintosh/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140710/0c952bd4/attachment.html>

From simon at rabbitmq.com  Thu Jul 10 16:41:24 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 10 Jul 2014 16:41:24 +0100
Subject: [rabbitmq-discuss] Connection is always in "flow" State.
In-Reply-To: <CAD6m6fGPAbgR2jjRGit8cYNXkO2iC7wCc0ArGz6ZLnu35JUDZg@mail.gmail.com>
References: <tencent_721DCB361ADD5CF0627708F8@qq.com>	<etPan.53bbacf8.6b8b4567.e013@mercurio.local>	<CAD6m6fFY6AucRkDyMoDpNRJ0zBGmAAkpOdQdyc=mWq0fOqQ2gA@mail.gmail.com>	<53BEAAD0.3080202@rabbitmq.com>
 <CAD6m6fGPAbgR2jjRGit8cYNXkO2iC7wCc0ArGz6ZLnu35JUDZg@mail.gmail.com>
Message-ID: <53BEB424.3070807@rabbitmq.com>

On 10/07/2014 4:23PM, Jason McIntosh wrote:
> Interesting on the 3.3 change.  SO I gotta ask about this situation on
> that (though it sounds off hand that'll fix the behavior I've seen on
> 3.2.4).  If a consumer is consumer at 80 msgs/second, but incoming rates
> are able to publish at 5k a second and the server CPU's/disks/etc.
> aren't being touched, will rabbit then put back pressure on the
> publishing rate forcing it down to 72 msgs/second (~10% less than
> consumes)?

No, no, no!

(And this is why writing documentation is hard! At least for me.)

I somewhat oversimplified. What really happens is that the queue will 
choose to do work that relates to consumers rather than publishers as 
long as:

1) The queue is running flat out; it never has any idle time.
2) The queue actually has work to do that pertains to consuming.
3) Messages are being consumed at less than 110% of the rate they're 
being published.

In the case you describe above, 2) will be false 99% of the time, at 
which point the queue will accept publishes as fast as it can.

In other words, when I said "if consumers and producers are both going 
as fast as they can" I meant if the limiting factor is the queue itself, 
not whatever work they're doing.

I hope that is clearer this time round.

> I'd assume then that'd propagate up to the publisher if
> there's a chain of rabbit servers all running 3.3 - e.g. the code
> publish to rabbit which shovels to the remote rabbit where the code
> consumer runs.  In this case the code publisher would get back pressure
> that'd reduce it's publish rate to ~72msgs/second?

Which would be a disaster. It's meant to be a queuing system, after all :-)

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From videlalvaro at gmail.com  Thu Jul 10 16:41:38 2014
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Thu, 10 Jul 2014 17:41:38 +0200
Subject: [rabbitmq-discuss] Introducing the RabbitMQ Sharding Plugin
In-Reply-To: <CAD6m6fFJk51HtjkzV+32P1QTO9XKizxZHhevjUokjfCZ4+SrHw@mail.gmail.com>
References: <CAMcAHLWEvvea1GNGZqxb=HyTnwCPTitsEu3raWZSQX5QNg+Fww@mail.gmail.com>
 <etPan.5346b614.6b68079a.704@s826.ofc.lair>
 <CAD6m6fHN57V07wa2nwRw5Gqjr6FxnbkM--Ct0OO5pDST1+b27g@mail.gmail.com>
 <CAMcAHLWRKP0RcC=TskhHzfZWBOg4eaFA6o96ZzYT9b1VN-5keQ@mail.gmail.com>
 <CAD6m6fFJk51HtjkzV+32P1QTO9XKizxZHhevjUokjfCZ4+SrHw@mail.gmail.com>
Message-ID: <CAMcAHLX3oFgfWwKx6+dEayXVBKEGm8KesG8Un7L4Cv_SwWNSZg@mail.gmail.com>

If you have 8 queues per shard, then each shard will require 8 consumers to
get the data out of those 8 queues that lay behind the shard. The plugin
will take care of selecting the queue with the least amount of consumers
whenever a new basic.consume arrives.


On Thu, Jul 10, 2014 at 5:00 PM, Jason McIntosh <mcintoshj at gmail.com> wrote:

> Since I just saw this crop up again on the list, thought I'd ask again on
> this plugin as it looks danged handy.  With geographically distributed data
> centers, we're using RabbitMQ to replicate data and information to remote
> data centers.  But with the WAN latency, we hit an issue where a single
> queue would seemingly get backlogged trying to shovel messages across the
> WAN.  SO we used x-consistent-hashes to basically do something like this:
> Publish to a fanout exchange "bob"
> bob is bound to "bob.multi"
> bob.multi is an x-consistent-hash bound to 8 queues, "bobs.data.1" through
> "bobs.data.8".  We then shovel "bobs.data.1" through 8 to a remote system
> that has a single exchange "bob" with a single queue "bobs.data".  We have
> the shovel config over ride the routing key and exchange on the publish
> side so things land in one spot.  If I didn't have to script this logic out
> I'd be more than happy to switch to using the "shard" exchange.  And the
> goal on the remote side is to have a single consumer (java process)
> connected to queue "bobs.data" on the remote side, and a single publisher
> publishing to "bob" on the publish side.  I THINK I may have misunderstood
> the earlier comment where we'd need 1 consumer per shard thing.
>
> Jason
>
>
>
>
> On Thu, Apr 10, 2014 at 3:10 PM, Alvaro Videla <videlalvaro at gmail.com>
> wrote:
>
>> Hi,
>>
>> On Thu, Apr 10, 2014 at 10:07 PM, Jason McIntosh <mcintoshj at gmail.com>
>> wrote:
>> >   The one thing I didn't see in the post was how many consumers you'd
>> need.
>> > It sounds like you'd need at least N consumers where N is the number of
>> > nodes in the shard?  With the shoveling config, we'd need to dynamically
>> > grow consumers to adapt to the cluster size it sounds like.
>> >
>>
>> Yes, at the moment you would need 1 consumer per shard. So if the
>> shard-per-node value is 4, then you'd need 4 consumers per node in the
>> cluster.
>>
>> Regards,
>>
>> Alvaro
>>
>
>
>
> --
> Jason McIntosh
> https://github.com/jasonmcintosh/
> 573-424-7612
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140710/33b0dd2d/attachment.html>

From mcintoshj at gmail.com  Thu Jul 10 16:45:08 2014
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Thu, 10 Jul 2014 10:45:08 -0500
Subject: [rabbitmq-discuss] Connection is always in "flow" State.
In-Reply-To: <53BEB424.3070807@rabbitmq.com>
References: <tencent_721DCB361ADD5CF0627708F8@qq.com>
 <etPan.53bbacf8.6b8b4567.e013@mercurio.local>
 <CAD6m6fFY6AucRkDyMoDpNRJ0zBGmAAkpOdQdyc=mWq0fOqQ2gA@mail.gmail.com>
 <53BEAAD0.3080202@rabbitmq.com>
 <CAD6m6fGPAbgR2jjRGit8cYNXkO2iC7wCc0ArGz6ZLnu35JUDZg@mail.gmail.com>
 <53BEB424.3070807@rabbitmq.com>
Message-ID: <CAD6m6fFv62LrEyKFQT1rCWJpwZ7d64FDCKmBhJDihqzjAUXBqg@mail.gmail.com>

Yep glad for the clarification and that's the behavior I'd actually want
thinking about this.  :)  It's like a file load - all IO, no CPU.  SO we
use consumers to do the CPU processing - which is inherently slower in a
ETL concept.  We're basically using RabbitMQ for distributed ETL work (go
distributed computing).  Since file loads are intermittent, you wouldn't
want to slow down file loads.

Thanks for the clarification and that makes it MUCH more clear!
Jason


On Thu, Jul 10, 2014 at 10:41 AM, Simon MacMullen <simon at rabbitmq.com>
wrote:

> On 10/07/2014 4:23PM, Jason McIntosh wrote:
>
>> Interesting on the 3.3 change.  SO I gotta ask about this situation on
>> that (though it sounds off hand that'll fix the behavior I've seen on
>> 3.2.4).  If a consumer is consumer at 80 msgs/second, but incoming rates
>> are able to publish at 5k a second and the server CPU's/disks/etc.
>> aren't being touched, will rabbit then put back pressure on the
>> publishing rate forcing it down to 72 msgs/second (~10% less than
>> consumes)?
>>
>
> No, no, no!
>
> (And this is why writing documentation is hard! At least for me.)
>
> I somewhat oversimplified. What really happens is that the queue will
> choose to do work that relates to consumers rather than publishers as long
> as:
>
> 1) The queue is running flat out; it never has any idle time.
> 2) The queue actually has work to do that pertains to consuming.
> 3) Messages are being consumed at less than 110% of the rate they're being
> published.
>
> In the case you describe above, 2) will be false 99% of the time, at which
> point the queue will accept publishes as fast as it can.
>
> In other words, when I said "if consumers and producers are both going as
> fast as they can" I meant if the limiting factor is the queue itself, not
> whatever work they're doing.
>
> I hope that is clearer this time round.
>
>
>  I'd assume then that'd propagate up to the publisher if
>> there's a chain of rabbit servers all running 3.3 - e.g. the code
>> publish to rabbit which shovels to the remote rabbit where the code
>> consumer runs.  In this case the code publisher would get back pressure
>> that'd reduce it's publish rate to ~72msgs/second?
>>
>
> Which would be a disaster. It's meant to be a queuing system, after all :-)
>
> Cheers, Simon
>
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>



-- 
Jason McIntosh
https://github.com/jasonmcintosh/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140710/9d4026bb/attachment.html>

From mcintoshj at gmail.com  Thu Jul 10 17:06:02 2014
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Thu, 10 Jul 2014 11:06:02 -0500
Subject: [rabbitmq-discuss] Introducing the RabbitMQ Sharding Plugin
In-Reply-To: <CAMcAHLX3oFgfWwKx6+dEayXVBKEGm8KesG8Un7L4Cv_SwWNSZg@mail.gmail.com>
References: <CAMcAHLWEvvea1GNGZqxb=HyTnwCPTitsEu3raWZSQX5QNg+Fww@mail.gmail.com>
 <etPan.5346b614.6b68079a.704@s826.ofc.lair>
 <CAD6m6fHN57V07wa2nwRw5Gqjr6FxnbkM--Ct0OO5pDST1+b27g@mail.gmail.com>
 <CAMcAHLWRKP0RcC=TskhHzfZWBOg4eaFA6o96ZzYT9b1VN-5keQ@mail.gmail.com>
 <CAD6m6fFJk51HtjkzV+32P1QTO9XKizxZHhevjUokjfCZ4+SrHw@mail.gmail.com>
 <CAMcAHLX3oFgfWwKx6+dEayXVBKEGm8KesG8Un7L4Cv_SwWNSZg@mail.gmail.com>
Message-ID: <CAD6m6fFfDgf1vyJqcRSNiMDEeUjESd++atGoMzSBkQ9xGtPqmg@mail.gmail.com>

Yeah this is still the issue for us - how would you dynamically increase
your consumers easily from say a Java process?  Generally, using things
like SimpleMessageListenerContainer - it starts up and consumes from a
queue "foo.data" - so would we need to start up 8 separate consumer
processes?  Or would a single bound consumer to that queue handle this when
set to 8 concurrent consumers?  Or would we need to listen for a shard
change event to allow it to do this?  I'd also ask about the shovel process
- would the shovel just consume from "foo.data" and how would that handle
the multiple queues?

Jason


On Thu, Jul 10, 2014 at 10:41 AM, Alvaro Videla <videlalvaro at gmail.com>
wrote:

> If you have 8 queues per shard, then each shard will require 8 consumers
> to get the data out of those 8 queues that lay behind the shard. The plugin
> will take care of selecting the queue with the least amount of consumers
> whenever a new basic.consume arrives.
>
>
> On Thu, Jul 10, 2014 at 5:00 PM, Jason McIntosh <mcintoshj at gmail.com>
> wrote:
>
>> Since I just saw this crop up again on the list, thought I'd ask again on
>> this plugin as it looks danged handy.  With geographically distributed data
>> centers, we're using RabbitMQ to replicate data and information to remote
>> data centers.  But with the WAN latency, we hit an issue where a single
>> queue would seemingly get backlogged trying to shovel messages across the
>> WAN.  SO we used x-consistent-hashes to basically do something like this:
>> Publish to a fanout exchange "bob"
>> bob is bound to "bob.multi"
>> bob.multi is an x-consistent-hash bound to 8 queues, "bobs.data.1"
>> through "bobs.data.8".  We then shovel "bobs.data.1" through 8 to a remote
>> system that has a single exchange "bob" with a single queue "bobs.data".
>>  We have the shovel config over ride the routing key and exchange on the
>> publish side so things land in one spot.  If I didn't have to script this
>> logic out I'd be more than happy to switch to using the "shard" exchange.
>>  And the goal on the remote side is to have a single consumer (java
>> process) connected to queue "bobs.data" on the remote side, and a single
>> publisher publishing to "bob" on the publish side.  I THINK I may have
>> misunderstood the earlier comment where we'd need 1 consumer per shard
>> thing.
>>
>> Jason
>>
>>
>>
>>
>> On Thu, Apr 10, 2014 at 3:10 PM, Alvaro Videla <videlalvaro at gmail.com>
>> wrote:
>>
>>> Hi,
>>>
>>> On Thu, Apr 10, 2014 at 10:07 PM, Jason McIntosh <mcintoshj at gmail.com>
>>> wrote:
>>> >   The one thing I didn't see in the post was how many consumers you'd
>>> need.
>>> > It sounds like you'd need at least N consumers where N is the number of
>>> > nodes in the shard?  With the shoveling config, we'd need to
>>> dynamically
>>> > grow consumers to adapt to the cluster size it sounds like.
>>> >
>>>
>>> Yes, at the moment you would need 1 consumer per shard. So if the
>>> shard-per-node value is 4, then you'd need 4 consumers per node in the
>>> cluster.
>>>
>>> Regards,
>>>
>>> Alvaro
>>>
>>
>>
>>
>> --
>> Jason McIntosh
>> https://github.com/jasonmcintosh/
>> 573-424-7612
>>
>
>


-- 
Jason McIntosh
https://github.com/jasonmcintosh/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140710/5a9c2105/attachment.html>

From steven.blanc at avid.com  Thu Jul 10 19:02:57 2014
From: steven.blanc at avid.com (Steven Blanc)
Date: Thu, 10 Jul 2014 18:02:57 +0000
Subject: [rabbitmq-discuss] Possible bug in Priority Queue plugin
In-Reply-To: <etPan.53bd3089.2eb141f2.166fe@mercurio.local>
References: <D7C993D2A9A4464F8C0E64FEFABA9E426BB385BC@WAL-MBS02.global.avidww.com>
 <53BD06F0.2090608@rabbitmq.com>
 <D7C993D2A9A4464F8C0E64FEFABA9E426BB38664@WAL-MBS02.global.avidww.com>
 <etPan.53bd3089.2eb141f2.166fe@mercurio.local>
Message-ID: <D7C993D2A9A4464F8C0E64FEFABA9E426BB38D68@WAL-MBS02.global.avidww.com>

Hi Michael,

Nope, I did mean BasicConsume/BasicConsumeMessage.  
I could have done this with BasicGet but I used BasicConsume followed by a looping BasicConsumeMessage.  In SimpleAmqpClient BasicConsumeMessage will wait for a message from the broker, where BasicGet will simply return false if no message is present. 

Here is the gist of my consumer.  The producer has no sleep and will pile up its messages (with BasicPublish) much quicker than this is supposed to consume them, thus allowing messages with low priority to build up for the occasional high priority message to arrive and be inserted above them.

    channel->BasicConsume(queue_name, consumerTag, true, false, false, /*prefetch*/1);

    for(int i = 0; i < repetitions; i++)
    {
        Envelope::ptr_t myEnvelope = channel->BasicConsumeMessage(consumerTag);
	  BasicMessage::ptr_t msg_out = myEnvelope->Message();

        // ACK the message
        channel->BasicAck(myEnvelope);        

        sleep(1);
    }


-----Original Message-----
From: Michael Klishin [mailto:mklishin at gopivotal.com] 
Sent: Wednesday, July 09, 2014 8:07 AM
To: Steven Blanc; Legacy list about RabbitMQ
Subject: Re: [rabbitmq-discuss] Possible bug in Priority Queue plugin

?On 9 July 2014 at 16:03:16, Steven Blanc (steven.blanc at avid.com) wrote:
> > I am making sure messages back up in the queue by producing with  
> no
> delay and consuming with a 1 second delay between calls to BasicConumeMessage.  

Just to clarify: do you mean basic.get? basic.consume creates a "push" subscription (RabbitMQ will
push messages to the client), so it doesn't need to be run multiple times.
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From videlalvaro at gmail.com  Thu Jul 10 21:49:37 2014
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Thu, 10 Jul 2014 22:49:37 +0200
Subject: [rabbitmq-discuss] Introducing the RabbitMQ Sharding Plugin
In-Reply-To: <CAD6m6fFfDgf1vyJqcRSNiMDEeUjESd++atGoMzSBkQ9xGtPqmg@mail.gmail.com>
References: <CAMcAHLWEvvea1GNGZqxb=HyTnwCPTitsEu3raWZSQX5QNg+Fww@mail.gmail.com>
 <etPan.5346b614.6b68079a.704@s826.ofc.lair>
 <CAD6m6fHN57V07wa2nwRw5Gqjr6FxnbkM--Ct0OO5pDST1+b27g@mail.gmail.com>
 <CAMcAHLWRKP0RcC=TskhHzfZWBOg4eaFA6o96ZzYT9b1VN-5keQ@mail.gmail.com>
 <CAD6m6fFJk51HtjkzV+32P1QTO9XKizxZHhevjUokjfCZ4+SrHw@mail.gmail.com>
 <CAMcAHLX3oFgfWwKx6+dEayXVBKEGm8KesG8Un7L4Cv_SwWNSZg@mail.gmail.com>
 <CAD6m6fFfDgf1vyJqcRSNiMDEeUjESd++atGoMzSBkQ9xGtPqmg@mail.gmail.com>
Message-ID: <CAMcAHLVDaRUcbkY18Cx3R0q0YGjiiSf00gSbgr8cUWe7Uij3fA@mail.gmail.com>

You need to issue 8 basic.consume commands, whether from the same process
or from a separate one. Of course you could use the same callback for all
those basic.consume.

About Shovel, I don't think it will work out of the box with this, but
perhaps Simon can correct me.


On Thu, Jul 10, 2014 at 6:06 PM, Jason McIntosh <mcintoshj at gmail.com> wrote:

> Yeah this is still the issue for us - how would you dynamically increase
> your consumers easily from say a Java process?  Generally, using things
> like SimpleMessageListenerContainer - it starts up and consumes from a
> queue "foo.data" - so would we need to start up 8 separate consumer
> processes?  Or would a single bound consumer to that queue handle this when
> set to 8 concurrent consumers?  Or would we need to listen for a shard
> change event to allow it to do this?  I'd also ask about the shovel process
> - would the shovel just consume from "foo.data" and how would that handle
> the multiple queues?
>
> Jason
>
>
> On Thu, Jul 10, 2014 at 10:41 AM, Alvaro Videla <videlalvaro at gmail.com>
> wrote:
>
>> If you have 8 queues per shard, then each shard will require 8 consumers
>> to get the data out of those 8 queues that lay behind the shard. The plugin
>> will take care of selecting the queue with the least amount of consumers
>> whenever a new basic.consume arrives.
>>
>>
>> On Thu, Jul 10, 2014 at 5:00 PM, Jason McIntosh <mcintoshj at gmail.com>
>> wrote:
>>
>>> Since I just saw this crop up again on the list, thought I'd ask again
>>> on this plugin as it looks danged handy.  With geographically distributed
>>> data centers, we're using RabbitMQ to replicate data and information to
>>> remote data centers.  But with the WAN latency, we hit an issue where a
>>> single queue would seemingly get backlogged trying to shovel messages
>>> across the WAN.  SO we used x-consistent-hashes to basically do something
>>> like this:
>>> Publish to a fanout exchange "bob"
>>> bob is bound to "bob.multi"
>>> bob.multi is an x-consistent-hash bound to 8 queues, "bobs.data.1"
>>> through "bobs.data.8".  We then shovel "bobs.data.1" through 8 to a remote
>>> system that has a single exchange "bob" with a single queue "bobs.data".
>>>  We have the shovel config over ride the routing key and exchange on the
>>> publish side so things land in one spot.  If I didn't have to script this
>>> logic out I'd be more than happy to switch to using the "shard" exchange.
>>>  And the goal on the remote side is to have a single consumer (java
>>> process) connected to queue "bobs.data" on the remote side, and a single
>>> publisher publishing to "bob" on the publish side.  I THINK I may have
>>> misunderstood the earlier comment where we'd need 1 consumer per shard
>>> thing.
>>>
>>> Jason
>>>
>>>
>>>
>>>
>>> On Thu, Apr 10, 2014 at 3:10 PM, Alvaro Videla <videlalvaro at gmail.com>
>>> wrote:
>>>
>>>> Hi,
>>>>
>>>> On Thu, Apr 10, 2014 at 10:07 PM, Jason McIntosh <mcintoshj at gmail.com>
>>>> wrote:
>>>> >   The one thing I didn't see in the post was how many consumers you'd
>>>> need.
>>>> > It sounds like you'd need at least N consumers where N is the number
>>>> of
>>>> > nodes in the shard?  With the shoveling config, we'd need to
>>>> dynamically
>>>> > grow consumers to adapt to the cluster size it sounds like.
>>>> >
>>>>
>>>> Yes, at the moment you would need 1 consumer per shard. So if the
>>>> shard-per-node value is 4, then you'd need 4 consumers per node in the
>>>> cluster.
>>>>
>>>> Regards,
>>>>
>>>> Alvaro
>>>>
>>>
>>>
>>>
>>> --
>>> Jason McIntosh
>>> https://github.com/jasonmcintosh/
>>> 573-424-7612
>>>
>>
>>
>
>
> --
> Jason McIntosh
> https://github.com/jasonmcintosh/
> 573-424-7612
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140710/8d7bc2c1/attachment.html>

From w_pg at qq.com  Fri Jul 11 02:31:23 2014
From: w_pg at qq.com (=?ISO-8859-1?B?TG9zdA==?=)
Date: Fri, 11 Jul 2014 09:31:23 +0800
Subject: [rabbitmq-discuss] Connection is always in "flow" State.
In-Reply-To: <etPan.53bbc314.2eb141f2.e013@mercurio.local>
References: <tencent_721DCB361ADD5CF0627708F8@qq.com>
 <etPan.53bbafc0.643c9869.e013@mercurio.local>
 <etPan.53bbb0d1.74b0dc51.e013@mercurio.local>
 <tencent_550186A75D01EDF5336F44C8@qq.com>
 <etPan.53bbbabf.46e87ccd.e013@mercurio.local>
 <tencent_4633D8BE193280DC1E808B38@qq.com>
 <etPan.53bbbbb9.3d1b58ba.e013@mercurio.local>
 <tencent_4EA6A6085832915E7AAA1300@qq.com>
 <etPan.53bbc314.2eb141f2.e013@mercurio.local>
Message-ID: <tencent_7F11CE680483E5DA483CE3E1@qq.com>

continue previous email...
 I have increase my app publish message rate(8 times), 
 Connection:
 from client is 3.5M/s, state is flow
 Channel:
 publish rate is 20000/s, state is running
  
 I am strange is why the before publish rate is only 2000/s(300K/s), the connection is still in flow state.
  




------------------ Original message ------------------
From: "Michael Klishin"; 
Sendtime: Tuesday, Jul 8, 2014 6:07 PM
To: "Lost"; "rabbitmq-discuss"; 
Subject: Re: [rabbitmq-discuss] Connection is always in "flow" State.



On 8 July 2014 at 13:39:59, Lost (w_pg at qq.com) wrote:
> > Yes, just one connection, one channel and publish to a exchange(no 
> any queues to bind it.)

You can simulate this setup with PerfTest [1]:

./runjava.sh com.rabbitmq.examples.PerfTest -y 0 -t "fanout"

and tweak various options such as message size.

For example, running PerfTest with the options above stabilizes
at about 65-70 K messages per second on my (1 gen old, not maxed-out)
MacBook Pro.

1. http://www.rabbitmq.com/java-tools.html
--
MK 

Staff Software Engineer, Pivotal/RabbitMQ
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140711/7168346a/attachment.html>

From w_pg at qq.com  Fri Jul 11 02:49:43 2014
From: w_pg at qq.com (=?ISO-8859-1?B?TG9zdA==?=)
Date: Fri, 11 Jul 2014 09:49:43 +0800
Subject: [rabbitmq-discuss] Reduce message latency
Message-ID: <tencent_538808AC5308716A538CA602@qq.com>

This is my test on my machine(Win7 64Bit)
 runjava.bat com.rabbitmq.examples.PerfTest -y 1 -t "fanout"
starting consumer #0
starting producer #0
time: 1.004s, sent: 6500 msg/s, received: 3835 msg/s, min/avg/max latency: 56688/397343/461860 microseconds
time: 2.010s, sent: 8569 msg/s, received: 10593 msg/s, min/avg/max latency: 28248/152367/530374 microseconds
time: 3.019s, sent: 14056 msg/s, received: 14002 msg/s, min/avg/max latency: 23924/47356/92764 microseconds
time: 4.035s, sent: 14766 msg/s, received: 14806 msg/s, min/avg/max latency: 22454/43967/79098 microseconds
time: 5.035s, sent: 14974 msg/s, received: 15155 msg/s, min/avg/max latency: 22796/45204/75959 microseconds
time: 6.035s, sent: 15688 msg/s, received: 15597 msg/s, min/avg/max latency: 23521/44053/79210 microseconds
time: 7.037s, sent: 14494 msg/s, received: 14538 msg/s, min/avg/max latency: 9377/45745/87104 microseconds
time: 8.037s, sent: 15988 msg/s, received: 15242 msg/s, min/avg/max latency: 12745/40687/79064 microseconds
time: 9.042s, sent: 15166 msg/s, received: 15773 msg/s, min/avg/max latency: 20401/44023/83005 microseconds
time: 10.047s, sent: 15745 msg/s, received: 15857 msg/s, min/avg/max latency: 19345/41106/90384 microseconds
time: 11.047s, sent: 15168 msg/s, received: 15135 msg/s, min/avg/max latency: 18543/44455/71619 microseconds
time: 12.047s, sent: 15815 msg/s, received: 15911 msg/s, min/avg/max latency: 21204/39684/62742 microseconds
time: 13.055s, sent: 15140 msg/s, received: 14901 msg/s, min/avg/max latency: 20643/44745/88437 microseconds
time: 14.057s, sent: 15366 msg/s, received: 15530 msg/s, min/avg/max latency: 16885/43054/71122 microseconds
time: 15.057s, sent: 15345 msg/s, received: 15336 msg/s, min/avg/max latency: 9193/43760/85081 microseconds
time: 16.059s, sent: 15666 msg/s, received: 15498 msg/s, min/avg/max latency: 17244/44310/82039 microseconds
  
 I found message avg latency is 40000~45000 microseconds, it need 40~45 milliseconds.
 Is there any possible to reduce message latency?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140711/a04808a0/attachment.html>

From jagadish.nadimpalli at oneconvergence.com  Fri Jul 11 06:17:03 2014
From: jagadish.nadimpalli at oneconvergence.com (Jagadish Nadimpalli)
Date: Fri, 11 Jul 2014 10:47:03 +0530
Subject: [rabbitmq-discuss] Consumer gets blocked leaving messages
	unacknowledged
In-Reply-To: <etPan.53be513c.643c9869.2efb@mercurio.local>
References: <CAC7kndOd8JyohpDjaF2PDcH4edWnPuuNdpmBbtEmfpCHS9ccPg@mail.gmail.com>
 <etPan.53bd5b93.7545e146.166fe@mercurio.local>
 <CAC7kndOBLkHtPEsQjwjjR_OkxjK6Feq02APMNDDQBB6MewSPdw@mail.gmail.com>
 <etPan.53be513c.643c9869.2efb@mercurio.local>
Message-ID: <CAC7kndN_XfMx4OxjonJSeVMUuKMGeWGWVsRAV46SMgQMZbN1fA@mail.gmail.com>

MK,

Thanks for the response. Where do we configure the qos parameters? Is there
a configuration file for this?


Thanks,
Jagadish



On Thu, Jul 10, 2014 at 2:08 PM, Michael Klishin <mklishin at gopivotal.com>
wrote:

>
>
> On 10 July 2014 at 10:23:31, Jagadish Nadimpalli (
> jagadish.nadimpalli at oneconvergence.com) wrote:
> > > Thanks for the response. Is there any reason why the client RPC
> > is not consuming the message.
>
> Because if you use basic.qos but never acknowledge, at some point you will
> run over the limit and no messages will be delivered to your consumer
> until one of the earlier deliveries are acknowledged.
> --
> MK
>
> Staff Software Engineer, Pivotal/RabbitMQ
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140711/b526b699/attachment.html>

From mklishin at gopivotal.com  Fri Jul 11 09:36:23 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 11 Jul 2014 12:36:23 +0400
Subject: [rabbitmq-discuss] Consumer gets blocked leaving messages
 unacknowledged
In-Reply-To: <CAC7kndN_XfMx4OxjonJSeVMUuKMGeWGWVsRAV46SMgQMZbN1fA@mail.gmail.com>
References: <CAC7kndOd8JyohpDjaF2PDcH4edWnPuuNdpmBbtEmfpCHS9ccPg@mail.gmail.com>
 <etPan.53bd5b93.7545e146.166fe@mercurio.local>
 <CAC7kndOBLkHtPEsQjwjjR_OkxjK6Feq02APMNDDQBB6MewSPdw@mail.gmail.com>
 <etPan.53be513c.643c9869.2efb@mercurio.local>
 <CAC7kndN_XfMx4OxjonJSeVMUuKMGeWGWVsRAV46SMgQMZbN1fA@mail.gmail.com>
Message-ID: <etPan.53bfa225.6b8b4567.5e81@mercurio.local>

On 11 July 2014 at 09:18:17, Jagadish Nadimpalli (jagadish.nadimpalli at oneconvergence.com) wrote:
> > Where do we configure the qos parameters? Is there a configuration 
> file for this?

Please read the tutorials, in particular tutorial 2:
http://www.rabbitmq.com/getstarted.html
-- 
MK 

Staff Software Engineer, Pivotal/RabbitMQ

From simon at rabbitmq.com  Fri Jul 11 10:23:17 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 11 Jul 2014 10:23:17 +0100
Subject: [rabbitmq-discuss] Reduce message latency
In-Reply-To: <tencent_538808AC5308716A538CA602@qq.com>
References: <tencent_538808AC5308716A538CA602@qq.com>
Message-ID: <53BFAD05.6070707@rabbitmq.com>

On 11/07/2014 2:49AM, Lost wrote:
> I found message avg latency is 40000~45000 microseconds, it need 40~45
> milliseconds.
> Is there any possible to reduce message latency?

Since you are not rate-limiting the producer, it's running as fast as it 
can. Therefore all the internal message buffers inside RabbitMQ fill up, 
and messages take longer to get through the broker.

You will find that if you reduce the message rate by 10-20% from the 
maximum using the PerfTest -r parameter (e.g. "-r 14000" or so), latency 
will drop considerably; I would expect latency of ~1ms to be acheivable 
(obviously dependent on network ping time and the underlying OS).

But note that RabbitMQ doesn't give latency *guarantees*.

This blog post talks a bit more on the subject (towards the end):

http://www.rabbitmq.com/blog/2012/04/17/rabbitmq-performance-measurements-part-1/

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Fri Jul 11 10:24:35 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 11 Jul 2014 10:24:35 +0100
Subject: [rabbitmq-discuss] Introducing the RabbitMQ Sharding Plugin
In-Reply-To: <CAMcAHLVDaRUcbkY18Cx3R0q0YGjiiSf00gSbgr8cUWe7Uij3fA@mail.gmail.com>
References: <CAMcAHLWEvvea1GNGZqxb=HyTnwCPTitsEu3raWZSQX5QNg+Fww@mail.gmail.com>
 <etPan.5346b614.6b68079a.704@s826.ofc.lair>
 <CAD6m6fHN57V07wa2nwRw5Gqjr6FxnbkM--Ct0OO5pDST1+b27g@mail.gmail.com>
 <CAMcAHLWRKP0RcC=TskhHzfZWBOg4eaFA6o96ZzYT9b1VN-5keQ@mail.gmail.com>
 <CAD6m6fFJk51HtjkzV+32P1QTO9XKizxZHhevjUokjfCZ4+SrHw@mail.gmail.com>
 <CAMcAHLX3oFgfWwKx6+dEayXVBKEGm8KesG8Un7L4Cv_SwWNSZg@mail.gmail.com>
 <CAD6m6fFfDgf1vyJqcRSNiMDEeUjESd++atGoMzSBkQ9xGtPqmg@mail.gmail.com>
 <CAMcAHLVDaRUcbkY18Cx3R0q0YGjiiSf00gSbgr8cUWe7Uij3fA@mail.gmail.com>
Message-ID: <53BFAD53.4050104@rabbitmq.com>

On 10/07/2014 9:49PM, Alvaro Videla wrote:
> About Shovel, I don't think it will work out of the box with this, but
> perhaps Simon can correct me.

If you need 8 consumers you'd have to configure 8 shovels. Not 
impossible, but a bit fiddly.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Fri Jul 11 11:37:22 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 11 Jul 2014 11:37:22 +0100
Subject: [rabbitmq-discuss] RabbitMQ waits forever for PID file during
 startup
In-Reply-To: <CAHuDZ5pxuvDXjcEnYf4-8fdjHFY=fknmRW=UV26sofmDdZiV2Q@mail.gmail.com>
References: <aed0727b-fe57-4f12-8801-a523e57f3bb2@googlegroups.com>	<539186EF.7010901@rabbitmq.com>	<CAHuDZ5rofeocjpouy5DuhvHxpbqAhH1UO00yeG=fEYT94r=XOw@mail.gmail.com>	<53919798.4080306@rabbitmq.com>	<CAHuDZ5qXfRaf4AOXYoe1gvB0tu=xb6q8DPhJ_vHy2RW1QoSp3g@mail.gmail.com>
 <CAHuDZ5pxuvDXjcEnYf4-8fdjHFY=fknmRW=UV26sofmDdZiV2Q@mail.gmail.com>
Message-ID: <53BFBE62.6010505@rabbitmq.com>

On 10/07/2014 3:02PM, Cesar Munoz wrote:
> Hi Simon,
>
> so we have tried to find the problem with the initial installation, but
> no luck yet. It is very difficult to track it, as it is totally
> non-deterministic!
> In the meantime, we installed the latest version of RabbitMQ, which
> includes de set -e fix, but the same issue still happened. Given the
> output of ps auxf
>
> https://gist.github.com/anonymous/62239513b154179a8a4e
>
> it looks like
>
> /bin/sh /etc/init.d/rabbitmq-server start
>
> and
>
> /bin/sh /usr/sbin/rabbitmqctlwait  /var/run/rabbitmq/pid
>
> were running concurrently. Is there any chance that this fact created
> some sort of race condition between these 2 processes that would make
> the set -e fix not work?

The "set -e" should cause a failure in the case where the script was not 
able to write the pid file for whatever reason. That's all. Looking at 
the ps output posted in the latest case, the startup has got past that 
point as it's started the beam process for the server.

"rabbitmqctl wait" should wait indefinitely for the server to start up, 
as long as the server has not actually died.

But it looks like something is getting stuck? Is there anything in the 
server logs at this point? Bearing in mind that the machine in question 
has claimed to run out of memory writing a 5-byte file, so I don't 
necessarily trust it.

Cheers, Simon


> Cheers,
> Cesar.
>
>
>
> On 6 June 2014 11:55, Cesar Munoz <cesar.munoz at ammeon.com
> <mailto:cesar.munoz at ammeon.com>> wrote:
>
>     Hi Simon,
>
>     the ulimits for rabbitmq user are pretty much the same, the only
>     difference is that max user processes is set to 1024 instead of 2066207.
>
>     About the system itself, it is true that there has to be something
>     strange going on if a shell redirection can fail, but I'm checking
>     the configuration and I don't see anything specially awkward.
>
>     We are using Red Hat 6.4, and these are the parameters that we set
>     in the sysctl.conf:
>     http://pastebin.com/SfJBwrna
>
>     The rest of the parameters in the kickstart file are pretty much the
>     standard ones.
>     This is an intermittent issue (we are testing how often it happens,
>     so far we got 3 failures in 13 installations), so it is harder to
>     track it!
>     Either way, restarting the service works, so it looks like whatever
>     causes the problem disappears after a while. I've been trying to
>     find what could make this non-deterministic, but so far I haven't
>     noticed anything unusual.
>
>     Thanks again!
>     Cesar.
>
>
>     On 6 June 2014 11:27, Simon MacMullen <simon at rabbitmq.com
>     <mailto:simon at rabbitmq.com>> wrote:
>
>         On 06/06/2014 10:49AM, Cesar Munoz wrote:
>
>             Hi Simon,
>
>             the set -e looks like a very good idea, at least the process
>             will return
>             the failure straight away!
>
>
>         Sure!
>
>
>             These are the ulimits:
>
>             [root at ms1 ~]# ulimit -a
>
>
>         <snip>
>
>         Those are the ulimits which apply to root - maybe they are
>         different for the "rabbitmq" user?
>
>         But more to the point: we're failing to do something very very
>         simple here, there has to be something weird about this system
>         if echo or shell redirection can fail with an error message
>         about memory allocation.
>
>         So have you configured anything unusual about this system?
>
>
>         Cheers, Simon
>
>         --
>         Simon MacMullen
>         RabbitMQ, Pivotal
>
>
>
>
> This email and any files transmitted with it are confidential and
> intended solely for the use of the individual or entity to whom they are
> addressed. If you have received this email in error please notify the
> system manager. This message contains confidential information and is
> intended only for the individual named. If you are not the named
> addressee you should not disseminate, distribute or copy this e-mail.
>

-- 
Simon MacMullen
RabbitMQ, Pivotal

From jagadish.nadimpalli at oneconvergence.com  Fri Jul 11 12:17:02 2014
From: jagadish.nadimpalli at oneconvergence.com (Jagadish Nadimpalli)
Date: Fri, 11 Jul 2014 16:47:02 +0530
Subject: [rabbitmq-discuss] Consumer gets blocked leaving messages
	unacknowledged
In-Reply-To: <etPan.53bfa225.6b8b4567.5e81@mercurio.local>
References: <CAC7kndOd8JyohpDjaF2PDcH4edWnPuuNdpmBbtEmfpCHS9ccPg@mail.gmail.com>
 <etPan.53bd5b93.7545e146.166fe@mercurio.local>
 <CAC7kndOBLkHtPEsQjwjjR_OkxjK6Feq02APMNDDQBB6MewSPdw@mail.gmail.com>
 <etPan.53be513c.643c9869.2efb@mercurio.local>
 <CAC7kndN_XfMx4OxjonJSeVMUuKMGeWGWVsRAV46SMgQMZbN1fA@mail.gmail.com>
 <etPan.53bfa225.6b8b4567.5e81@mercurio.local>
Message-ID: <CAC7kndNr19C6U+PD6sAkDJaz2Nzo+BYZQWSk3WxXqHFvUJTg2A@mail.gmail.com>

MK,

Thanks for the information. I will check this link.


On Fri, Jul 11, 2014 at 2:06 PM, Michael Klishin <mklishin at gopivotal.com>
wrote:

> On 11 July 2014 at 09:18:17, Jagadish Nadimpalli (
> jagadish.nadimpalli at oneconvergence.com) wrote:
> > > Where do we configure the qos parameters? Is there a configuration
> > file for this?
>
> Please read the tutorials, in particular tutorial 2:
> http://www.rabbitmq.com/getstarted.html
> --
> MK
>
> Staff Software Engineer, Pivotal/RabbitMQ
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140711/4d67a1a0/attachment.html>

From cesar.munoz at ammeon.com  Fri Jul 11 15:39:09 2014
From: cesar.munoz at ammeon.com (Cesar Munoz)
Date: Fri, 11 Jul 2014 15:39:09 +0100
Subject: [rabbitmq-discuss] RabbitMQ waits forever for PID file during
	startup
In-Reply-To: <53BFBE62.6010505@rabbitmq.com>
References: <aed0727b-fe57-4f12-8801-a523e57f3bb2@googlegroups.com>
 <539186EF.7010901@rabbitmq.com>
 <CAHuDZ5rofeocjpouy5DuhvHxpbqAhH1UO00yeG=fEYT94r=XOw@mail.gmail.com>
 <53919798.4080306@rabbitmq.com>
 <CAHuDZ5qXfRaf4AOXYoe1gvB0tu=xb6q8DPhJ_vHy2RW1QoSp3g@mail.gmail.com>
 <CAHuDZ5pxuvDXjcEnYf4-8fdjHFY=fknmRW=UV26sofmDdZiV2Q@mail.gmail.com>
 <53BFBE62.6010505@rabbitmq.com>
Message-ID: <CAHuDZ5rWvAJa2q4gxFPa4-HUJkYcp8TwG-oxZr2angy_ZWsB2Q@mail.gmail.com>

Hi Simon,

the thing is, /var/run/rabbitmq/pid still contains the "Cannot allocate
memory" error, that's probably why the wait pid is still blocked. The
system logs are not saying anything new, but we run sos after reproducing
the issue and we're taking a look to see if there is anything interesting.
I'll let you know!

Thanks,
Cesar.


On 11 July 2014 11:37, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 10/07/2014 3:02PM, Cesar Munoz wrote:
>
>> Hi Simon,
>>
>> so we have tried to find the problem with the initial installation, but
>> no luck yet. It is very difficult to track it, as it is totally
>> non-deterministic!
>> In the meantime, we installed the latest version of RabbitMQ, which
>> includes de set -e fix, but the same issue still happened. Given the
>> output of ps auxf
>>
>> https://gist.github.com/anonymous/62239513b154179a8a4e
>>
>> it looks like
>>
>> /bin/sh /etc/init.d/rabbitmq-server start
>>
>> and
>>
>> /bin/sh /usr/sbin/rabbitmqctlwait  /var/run/rabbitmq/pid
>>
>>
>> were running concurrently. Is there any chance that this fact created
>> some sort of race condition between these 2 processes that would make
>> the set -e fix not work?
>>
>
> The "set -e" should cause a failure in the case where the script was not
> able to write the pid file for whatever reason. That's all. Looking at the
> ps output posted in the latest case, the startup has got past that point as
> it's started the beam process for the server.
>
> "rabbitmqctl wait" should wait indefinitely for the server to start up, as
> long as the server has not actually died.
>
> But it looks like something is getting stuck? Is there anything in the
> server logs at this point? Bearing in mind that the machine in question has
> claimed to run out of memory writing a 5-byte file, so I don't necessarily
> trust it.
>
> Cheers, Simon
>
>
>  Cheers,
>> Cesar.
>>
>>
>>
>> On 6 June 2014 11:55, Cesar Munoz <cesar.munoz at ammeon.com
>> <mailto:cesar.munoz at ammeon.com>> wrote:
>>
>>     Hi Simon,
>>
>>     the ulimits for rabbitmq user are pretty much the same, the only
>>     difference is that max user processes is set to 1024 instead of
>> 2066207.
>>
>>     About the system itself, it is true that there has to be something
>>     strange going on if a shell redirection can fail, but I'm checking
>>     the configuration and I don't see anything specially awkward.
>>
>>     We are using Red Hat 6.4, and these are the parameters that we set
>>     in the sysctl.conf:
>>     http://pastebin.com/SfJBwrna
>>
>>     The rest of the parameters in the kickstart file are pretty much the
>>     standard ones.
>>     This is an intermittent issue (we are testing how often it happens,
>>     so far we got 3 failures in 13 installations), so it is harder to
>>     track it!
>>     Either way, restarting the service works, so it looks like whatever
>>     causes the problem disappears after a while. I've been trying to
>>     find what could make this non-deterministic, but so far I haven't
>>     noticed anything unusual.
>>
>>     Thanks again!
>>     Cesar.
>>
>>
>>     On 6 June 2014 11:27, Simon MacMullen <simon at rabbitmq.com
>>     <mailto:simon at rabbitmq.com>> wrote:
>>
>>         On 06/06/2014 10:49AM, Cesar Munoz wrote:
>>
>>             Hi Simon,
>>
>>             the set -e looks like a very good idea, at least the process
>>             will return
>>             the failure straight away!
>>
>>
>>         Sure!
>>
>>
>>             These are the ulimits:
>>
>>             [root at ms1 ~]# ulimit -a
>>
>>
>>         <snip>
>>
>>         Those are the ulimits which apply to root - maybe they are
>>         different for the "rabbitmq" user?
>>
>>         But more to the point: we're failing to do something very very
>>         simple here, there has to be something weird about this system
>>         if echo or shell redirection can fail with an error message
>>         about memory allocation.
>>
>>         So have you configured anything unusual about this system?
>>
>>
>>         Cheers, Simon
>>
>>         --
>>         Simon MacMullen
>>         RabbitMQ, Pivotal
>>
>>
>>
>>
>> This email and any files transmitted with it are confidential and
>> intended solely for the use of the individual or entity to whom they are
>> addressed. If you have received this email in error please notify the
>> system manager. This message contains confidential information and is
>> intended only for the individual named. If you are not the named
>> addressee you should not disseminate, distribute or copy this e-mail.
>>
>>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>

-- 
This email and any files transmitted with it are confidential and intended 
solely for the use of the individual or entity to whom they are addressed. 
If you have received this email in error please notify the system manager. 
This message contains confidential information and is intended only for the 
individual named. If you are not the named addressee you should not 
disseminate, distribute or copy this e-mail.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140711/ce9cac7c/attachment.html>

From seanmjoyce at gmail.com  Sun Jul 13 16:41:29 2014
From: seanmjoyce at gmail.com (Sean Joyce)
Date: Sun, 13 Jul 2014 11:41:29 -0400
Subject: [rabbitmq-discuss] Routing via user id
Message-ID: <CAO7e3YFMjfu_X1GDfZ6A4BF_WAqhKM10jeqPC4UWmoEqbTktKw@mail.gmail.com>

I have a scenario where one producer publishes a stream of messages to an
exchange. The exchange has 10 queues (there is an upper limit to the amount
of parallel work that can be done - e.g. Database bottleneck) that it
routes messages to. The messages can really go to any queue with one
exception: only one message with a given user id can be processed at a
time.

All messages with that user id should be routed to the same queue. If there
was no database bottleneck I would create a new queue for each user id but
I can really only process ten messages at a time.

I had thought of partitioning the user ids across ten queues but there is
no guarantee the incoming messages would be evenly distributed even with
different user ids. Thus I could have queues 1,4 and 8 with a backlog while
the rest are idle resources.

Any tips on a defined pattern that solves this type of problem so that any
message for a given user id can go to any queue but messages with the same
user id always go to the same queue?

-Sean
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140713/867953fd/attachment.html>

From michael.laing at nytimes.com  Sun Jul 13 23:47:19 2014
From: michael.laing at nytimes.com (Laing, Michael)
Date: Sun, 13 Jul 2014 18:47:19 -0400
Subject: [rabbitmq-discuss] Routing via user id
In-Reply-To: <CAO7e3YFMjfu_X1GDfZ6A4BF_WAqhKM10jeqPC4UWmoEqbTktKw@mail.gmail.com>
References: <CAO7e3YFMjfu_X1GDfZ6A4BF_WAqhKM10jeqPC4UWmoEqbTktKw@mail.gmail.com>
Message-ID: <CAKgmDnEteSTQjDW=1A+FcpUmkwsHo97jZ-JXj18EmgR00Bpwag@mail.gmail.com>

You should look at the 'consistent-hash-exchange':
http://www.rabbitmq.com/plugins.html

By either using the user id as the routing key or by setting a header to
the user id, messages w a particular user id will always get routed to the
same queue.

Hopefully your input is nicely distributed across the user id space. If
not, there is more work required.

ml


On Sun, Jul 13, 2014 at 11:41 AM, Sean Joyce <seanmjoyce at gmail.com> wrote:

> I have a scenario where one producer publishes a stream of messages to an
> exchange. The exchange has 10 queues (there is an upper limit to the amount
> of parallel work that can be done - e.g. Database bottleneck) that it
> routes messages to. The messages can really go to any queue with one
> exception: only one message with a given user id can be processed at a
> time.
>
> All messages with that user id should be routed to the same queue. If
> there was no database bottleneck I would create a new queue for each user
> id but I can really only process ten messages at a time.
>
> I had thought of partitioning the user ids across ten queues but there is
> no guarantee the incoming messages would be evenly distributed even with
> different user ids. Thus I could have queues 1,4 and 8 with a backlog while
> the rest are idle resources.
>
> Any tips on a defined pattern that solves this type of problem so that any
> message for a given user id can go to any queue but messages with the same
> user id always go to the same queue?
>
> -Sean
>
> _______________________________________________
> rabbitmq-discuss mailing list has moved to
> https://groups.google.com/forum/#!forum/rabbitmq-users,
> please subscribe to the new list!
>
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140713/3df07766/attachment.html>

From mklishin at gopivotal.com  Mon Jul 14 00:00:56 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 14 Jul 2014 03:00:56 +0400
Subject: [rabbitmq-discuss] Routing via user id
In-Reply-To: <CAKgmDnEteSTQjDW=1A+FcpUmkwsHo97jZ-JXj18EmgR00Bpwag@mail.gmail.com>
References: <CAO7e3YFMjfu_X1GDfZ6A4BF_WAqhKM10jeqPC4UWmoEqbTktKw@mail.gmail.com>
 <CAKgmDnEteSTQjDW=1A+FcpUmkwsHo97jZ-JXj18EmgR00Bpwag@mail.gmail.com>
Message-ID: <etPan.53c30fc1.431bd7b7.b780@mercurio.local>

On 14 July 2014 at 02:48:37, Laing, Michael (michael.laing at nytimes.com) wrote:
> > You should look at the 'consistent-hash-exchange': http://www.rabbitmq.com/plugins.html  
>  
> By either using the user id as the routing key or by setting a header  
> to the user id, messages w a particular user id will always get  
> routed to the same queue.

as long as the list of bindings does not change. The ?point of using consistent hashing
is to minimise the number of key/queue "re-mappings" when queues are bound
or unbound, though.
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From qiujixiong at 163.com  Mon Jul 14 03:05:39 2014
From: qiujixiong at 163.com (qiujixiong)
Date: Mon, 14 Jul 2014 10:05:39 +0800 (CST)
Subject: [rabbitmq-discuss] rabbitmq connection stay in flow or blocked
	state for a long time
Message-ID: <2de40f7f.6fff.147329e453a.Coremail.qiujixiong@163.com>

Hi,


I found that when flow control per connection triggered, some connection would stay in flow or blocked state for a long time,.
The client(RabbitMQ C client) would be blocked for several minutes or even more during publishing message. While at that time the queue was almost empty and the whole rabbimq server flow control was not triggered.
My rabbitmq version is 3.1.5.
The rabbitmq document says the flow control should be in a very short time and may happend several times during one second. Why it keep flow or blocked for such a long time?
Did anyone encount this problem too? 
What can I do? Is it possible that I use a non-blocked client or bypass the flow control?


Thanks~
Jerome
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140714/1715426e/attachment.html>

From nikita.zubrilov at gmail.com  Mon Jul 14 09:11:25 2014
From: nikita.zubrilov at gmail.com (Nikita Zubrilov)
Date: Mon, 14 Jul 2014 11:11:25 +0300
Subject: [rabbitmq-discuss] Priority queue doesn't seem to work as expected
Message-ID: <CA+xr+8SPw9f+b6sY3jDMODSi_y9AurbAbe7bXwqBNkVZjbdRgw@mail.gmail.com>

Hello,

I'm using Rabbitmq 3.3.3 on Windows 7.
I installed *rabbitmq-priority-queue plugin*, enable it, and finally restart
Rabbitmq server. When I list rabbitmq plugins I see => [E]
rabbitmq_priority_queue.

I tried the example from GitHub and it WORKS. Though, it is a very very
simple example.

But,    when I tried some a little bit complex example, the queue seems to
behave in a very strange way.

So, my setup is like this:

First, the common configuration of the queue, just like in the example:

private static final String QUEUE = "my-priority-queue";

    public static void main(String[] argv) throws Exception {
        ConnectionFactory factory = new ConnectionFactory();
        Connection conn = factory.newConnection();
        Channel ch = conn.createChannel();

        Map<String, Object> args = new HashMap<String, Object>();
        args.put("x-max-priority", 10);
        ch.queueDeclare(QUEUE, true, false, false, args);
...


I have a Producer thread that sends messages in intervals of couple of
seconds. For each message I define priority from 0 to 10 just like in the
example. For example sends 10 messages each 2 seconds:

the run() method looks like this:

while(true){
   for(Message message : MESSAGES){

BasicProperties props =
MessageProperties.PERSISTENT_BASIC.builder().priority(message.priority)
.build();
        System.out.println("Sent " + message.body);
        ch.basicPublish("", QUEUE, props, message.body.getBytes());
}
Thread.sleep(2000);

}

Also, there is a Consumer thread which waits for incoming messages and
prints them on the screen:

inside run() method:

QueueingConsumer consumer = new
QueueingConsumer(channel);channel.basicConsume("hello", true,
consumer);

while (true) {
    QueueingConsumer.Delivery delivery = consumer.nextDelivery();
    String message = new String(delivery.getBody());
    System.out.println(" [x] Received '" + message + "'");       }

nothing special...


And the behavior I get is the following:
All the messages that was posted BEFORE the Consumer starts to run are
received in prioritized order, BUT all the messages that sent AFTER the
Consumer starts, are received in the same order they were sent without
concerning a priority. Tried to put some Thread.sleep() in different places
in code to give the queue some time to reorganize itself, but it didn't
work.
So, it seems like priority works only on some static queues without
constantly working Consumer and Producer.
Am I right?
Maybe I am doing something wrong?
Can you please give some complex example for using the priority-queue
plugin?
In my project, we'll have a number of Producers and a number of Consumers
asynchronously putting and taking items from the queue. Does the plugin
support the following scenario?

Thank you,
Nik
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140714/be35fba3/attachment.html>

From mklishin at gopivotal.com  Mon Jul 14 10:06:41 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 14 Jul 2014 13:06:41 +0400
Subject: [rabbitmq-discuss] Priority queue doesn't seem to work as
 expected
In-Reply-To: <CA+xr+8SPw9f+b6sY3jDMODSi_y9AurbAbe7bXwqBNkVZjbdRgw@mail.gmail.com>
References: <CA+xr+8SPw9f+b6sY3jDMODSi_y9AurbAbe7bXwqBNkVZjbdRgw@mail.gmail.com>
Message-ID: <etPan.53c39dbc.257130a3.b780@mercurio.local>

?On 14 July 2014 at 12:13:36, Nikita Zubrilov (nikita.zubrilov at gmail.com) wrote:
> > All the messages that was posted BEFORE the Consumer starts  
> to run are received in prioritized order, BUT all the messages  
> that sent AFTER the Consumer starts, are received in the same  
> order they were sent without concerning a priority. Tried to  
> put some Thread.sleep() in different places in code to give the  
> queue some time to reorganize itself, but it didn't work.
> So, it seems like priority works only on some static queues without  
> constantly working Consumer and Producer.
> Am I right?

See?http://markmail.org/thread/afp5d774qrnx6ukh#query:+page:1+mid:zklpftnv3pce5qzz+state:results.

Reordering is performed by the message store.
If a message goes straight to the consumer, no reordering will be done.
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From simon at rabbitmq.com  Mon Jul 14 10:10:16 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 14 Jul 2014 10:10:16 +0100
Subject: [rabbitmq-discuss] Priority queue doesn't seem to work as
	expected
In-Reply-To: <CA+xr+8SPw9f+b6sY3jDMODSi_y9AurbAbe7bXwqBNkVZjbdRgw@mail.gmail.com>
References: <CA+xr+8SPw9f+b6sY3jDMODSi_y9AurbAbe7bXwqBNkVZjbdRgw@mail.gmail.com>
Message-ID: <53C39E78.1090907@rabbitmq.com>

Hopefully Michael has already answered your main question, but:

On 14/07/2014 9:11AM, Nikita Zubrilov wrote:
> In my project, we'll have a number of Producers and a number of
> Consumers asynchronously putting and taking items from the queue. Does
> the plugin support the following scenario?

Yes.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From hackeron at gmail.com  Mon Jul 14 00:10:16 2014
From: hackeron at gmail.com (Roman Gaufman)
Date: Mon, 14 Jul 2014 00:10:16 +0100
Subject: [rabbitmq-discuss] "reconnect-delay" seems to be ignored for
	Federation Upstreams
Message-ID: <CAAs9BZM=XUwTb9t9A==fBtyD6PBqL3uK-wVMwrS_+3-1J8XHDA@mail.gmail.com>

Hi there,

I have my reconnect-delay set to 300s (see attached). However when I do:

tail -f /var/log/rabbitmq/* | grep -i vpn.plus/247cctv

I see these types of messages appearing in the logs every 2-3 seconds:

Federation exchange 'xanview' in vhost '247cctv' did not connect to
exchange 'xanview' in vhost '247cctv' on amqp://vpn.plus/247cctv
Federation queue 'xanview.247cctv.portal' in vhost '247cctv' did not
connect to queue 'xanview.247cctv.portal' in vhost '247cctv' on
amqp://vpn.plus/247cctv
Federation exchange 'xanview' in vhost '247cctv' did not connect to
exchange 'xanview' in vhost '247cctv' on amqp://vpn.plus/247cctv
Federation queue 'xanview.247cctv.portal' in vhost '247cctv' did not
connect to queue 'xanview.247cctv.portal' in vhost '247cctv' on
amqp://vpn.plus/247cctv

That server is presently offline and I would like the Federation plugin to
retry every 5 minutes as requested, how would I do this?

Thank you for your time,

Roman
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140714/2cc1b2a3/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Screen Shot 2014-07-14 at 00.07.12.png
Type: image/png
Size: 37389 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140714/2cc1b2a3/attachment.png>

From nikita.zubrilov at gmail.com  Mon Jul 14 13:43:14 2014
From: nikita.zubrilov at gmail.com (Nikita Zubrilov)
Date: Mon, 14 Jul 2014 15:43:14 +0300
Subject: [rabbitmq-discuss] Priority queue doesn't seem to work as
	expected
In-Reply-To: <53C39E78.1090907@rabbitmq.com>
References: <CA+xr+8SPw9f+b6sY3jDMODSi_y9AurbAbe7bXwqBNkVZjbdRgw@mail.gmail.com>
 <53C39E78.1090907@rabbitmq.com>
Message-ID: <CA+xr+8SBG1nd9C4ShgW8YOr6QKySCx1YnbWiMkwwtya4gcYJSg@mail.gmail.com>

Thank you, it helped!

Regards, Nik


On Mon, Jul 14, 2014 at 12:10 PM, Simon MacMullen <simon at rabbitmq.com>
wrote:

> Hopefully Michael has already answered your main question, but:
>
>
> On 14/07/2014 9:11AM, Nikita Zubrilov wrote:
>
>> In my project, we'll have a number of Producers and a number of
>> Consumers asynchronously putting and taking items from the queue. Does
>> the plugin support the following scenario?
>>
>
> Yes.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140714/7394c368/attachment.html>

From simon at rabbitmq.com  Mon Jul 14 13:44:37 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 14 Jul 2014 13:44:37 +0100
Subject: [rabbitmq-discuss] "reconnect-delay" seems to be ignored for
 Federation Upstreams
In-Reply-To: <CAAs9BZM=XUwTb9t9A==fBtyD6PBqL3uK-wVMwrS_+3-1J8XHDA@mail.gmail.com>
References: <CAAs9BZM=XUwTb9t9A==fBtyD6PBqL3uK-wVMwrS_+3-1J8XHDA@mail.gmail.com>
Message-ID: <53C3D0B5.60409@rabbitmq.com>

On 14/07/2014 12:10AM, Roman Gaufman wrote:
> Hi there,
>
> I have my reconnect-delay set to 300s (see attached). However when I do:
>
> tail -f /var/log/rabbitmq/* | grep -i vpn.plus/247cctv
>
> I see these types of messages appearing in the logs every 2-3 seconds:

So I've been looking at this and I think you may have found a bug; it 
looks like the reconnect_delay is ignored if it takes more than one 
second for the link to fail to start.

Could you try replacing your federation plugin with:

http://www.rabbitmq.com/releases/plugins/v3.3.x/rabbitmq_federation-3.3.x.reconnect-fix.ez

(assuming you're running 3.3.x)

and see if that fixes it?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Mon Jul 14 14:51:20 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 14 Jul 2014 14:51:20 +0100
Subject: [rabbitmq-discuss] "reconnect-delay" seems to be ignored for
 Federation Upstreams
In-Reply-To: <53C3D0B5.60409@rabbitmq.com>
References: <CAAs9BZM=XUwTb9t9A==fBtyD6PBqL3uK-wVMwrS_+3-1J8XHDA@mail.gmail.com>
 <53C3D0B5.60409@rabbitmq.com>
Message-ID: <53C3E058.2080006@rabbitmq.com>

On 14/07/2014 1:44PM, Simon MacMullen wrote:
> Could you try replacing your federation plugin with:
>
> http://www.rabbitmq.com/releases/plugins/v3.3.x/rabbitmq_federation-3.3.x.reconnect-fix.ez
>
>
> (assuming you're running 3.3.x)
>
> and see if that fixes it?

No, that's too simplistic a fix. Actually this will take some effort to 
fix properly. It will get fixed though.

In the mean time, you can at least prevent noise in the logs by 
modifying the log_level config item for 'federation' (see 
http://www.rabbitmq.com/configure.html#configuration-file).

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From arnav.joshi at mathworks.com  Mon Jul 14 19:01:39 2014
From: arnav.joshi at mathworks.com (ArnavJoshi)
Date: Mon, 14 Jul 2014 11:01:39 -0700 (PDT)
Subject: [rabbitmq-discuss] Implement guaranteed delivery with
 ReturnListener and ConfirmListener
Message-ID: <1405360899082-36795.post@n5.nabble.com>

Hi,

We are trying to prototype guaranteed delivery of messages. RabbitMQ with
basic publishing or mandatory\immediate flags only guarantees routing a
message up to the broker with some asynchronous acknowledgements back to the
publisher. It does not promise a reliable delivery of messages. With
consumer crashes and broker restarts, the messages can be lost specifically
if it is not declared as persistent. 
 
We planned to implement both the ReturnListener and ConfirmListener
interfaces.

a.	To be notified of failed deliveries when basicPublish is called with
?mandatory? flag
b.	To get publisher confirms on whether messages have been consumed
successfully (acks), or whether they are lost/not persisted (nack).

For testing purposes, we are checking for the confirms for messages which
are being written to undeclared/unbound/currently unavailable queues. We
observe that although the ReturnListener method throws a 312 (NO_ROUTE)
error code, the ConfirmListener still calls the ?handleAck? method, and not
the ?handleNack? method as we would expect.

If this implementation is by design ? could you suggest a way in which we
can implement guaranteed delivery, i.e.:

1.	Confirm that the message has not only reached the broker, but has been
processed by one or more queues.
2.	Throw a nack, or generate an exception when the message cannot be routed
and that the message has been persisted to disk
3.	Making blocking calls to our publishes in the ReturnListener
implementation when we are trying to write to such queues?

Follow up question: If a queue process being killed is the only criterion
for ConfirmListener.handleNack being called ? shouldn?t an
undeclared/currently unavailable queue result in handleNack being called.
Our suspicion is that the message which cannot be routed to a currently
unavailable queue is handled like an unroutable message, which is confirmed
immediately after basic.return but is also ?ACK?ed, which seems
counter-intuitive.

Thanks,
Arnav Joshi




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Implement-guaranteed-delivery-with-ReturnListener-and-ConfirmListener-tp36795.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mklishin at gopivotal.com  Mon Jul 14 20:15:19 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 14 Jul 2014 23:15:19 +0400
Subject: [rabbitmq-discuss] Implement guaranteed delivery with
 ReturnListener and ConfirmListener
In-Reply-To: <1405360899082-36795.post@n5.nabble.com>
References: <1405360899082-36795.post@n5.nabble.com>
Message-ID: <etPan.53c42c61.74b0dc51.cfde@mercurio.local>



On 14 July 2014 at 22:02:52, ArnavJoshi (arnav.joshi at mathworks.com) wrote:
> > For testing purposes, we are checking for the confirms for messages  
> which
> are being written to undeclared/unbound/currently unavailable  
> queues. We
> observe that although the ReturnListener method throws a 312  
> (NO_ROUTE)
> error code, the ConfirmListener still calls the ?handleAck?  
> method, and not
> the ?handleNack? method as we would expect.

I can see that some may expect unroutable messages
to be nack-ed but RabbitMQ cannot know whether that's the case: in some cases
it's fine for messages to not be routed anywhere. So acks verify a bunch of things:

?1. Your connection is alive
?2. Your channel is still open (no exceptions)
?3. Routed message was delivered to all queue mirrors (if applicable)

Using a nack to indicate that the message is unroutable would confuse a lot
of apps into thinking that 1) or 2) were not true.


> If this implementation is by design ? could you suggest a way in  
> which we
> can implement guaranteed delivery, i.e.:
>  
> 1. Confirm that the message has not only reached the broker, but  
> has been
> processed by one or more queues.
> 2. Throw a nack, or generate an exception when the message cannot  
> be routed
> and that the message has been persisted to disk
> 3. Making blocking calls to our publishes in the ReturnListener  
> implementation when we are trying to write to such queues?

Group messages in batches if you can. Then
publish a batch, use Channel#waitForConfirms. If it returns false, schedule
the batch for re-publishing. If a return arrives, do the same.
You'll also need to have a way to identify messages, but this is generally true
with confirms.

Batching will provide good throughput with easier to use but generally slower API (#waitForConfirms vs. ConfirmListener).?

Because basic.return may arrive after #waitForConfirms returns, you may want to schedule
a "batch check" that runs in a few seconds and completely marks the batch as successfully
delivered.

> Follow up question: If a queue process being killed is the only  
> criterion
> for ConfirmListener.handleNack being called ? shouldn?t an  
> undeclared/currently unavailable queue result in handleNack  
> being called.
> Our suspicion is that the message which cannot be routed to a currently  
> unavailable queue is handled like an unroutable message, which  
> is confirmed
> immediately after basic.return but is also ?ACK?ed, which seems  
> counter-intuitive.

Can you expand on how exactly your experiment was conducted? Did you receive
an ack for a message routed to a queue whose master was unavailable? Was it the only
queue the message was routed to??
--?
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From pmaisenovich at blizzard.com  Tue Jul 15 02:39:20 2014
From: pmaisenovich at blizzard.com (Pavel)
Date: Mon, 14 Jul 2014 18:39:20 -0700 (PDT)
Subject: [rabbitmq-discuss] Possible memory leak in the management plugin
In-Reply-To: <5360DE1D.6080009@rabbitmq.com>
References: <1397058685615-34697.post@n5.nabble.com>
 <53457674.1040704@rabbitmq.com> <1397106237672-34725.post@n5.nabble.com>
 <53466D39.4050906@rabbitmq.com> <1397157592459-34779.post@n5.nabble.com>
 <5346F7AC.2090703@rabbitmq.com> <1397171854071-34790.post@n5.nabble.com>
 <5347F359.7010504@rabbitmq.com> <1398805954002-35223.post@n5.nabble.com>
 <5360DE1D.6080009@rabbitmq.com>
Message-ID: <1405388360295-36797.post@n5.nabble.com>

Hi again,

I finally got back to these tests and have some results to share.

TL/DR: baring some oddities there is a clear change of pattern in agg_stats
table growth when using 3.3.4 comparing to 3.1.5. While in 3.1.5 it grows
seemingly unbounded, 3.3.4 keeps it stable at certain level. More details
below.

I have two identical boxes in the lab one running Erlang 15B + RabbitMQ
3.1.5 and other one on Erlang 17 +  RabbitMQ 3.3.4. In both environments I
run my load generation test (slightly modified from what was shared earlier
in this thread) using JDK7 + com.rabbitmq:amqp-client:3.3.4 with the
following parameters:

RabbitSmasher 500 100 10000000 499 false false

What this does is:
- creates 499 exchanges
- creates 499 queues and binds them 1-1 to exchanges
- creates 1 connection with 500 channels
- publishes messages at the rate of 100/s rotating through 500 channels and
picking exchange/routing key sequentially (so that each of 249500
channel/queue permutations is hit once every ~40 minutes)

During the test I'm sampling mgmt_db memory on both boxes every 5 seconds
using this query:

/usr/sbin/rabbitmqctl eval
'{process_info(global:whereis_name(rabbit_mgmt_db),memory),[{T,
ets:info(T,size), ets:info(T,memory)} || T <-lists:sort(ets:all()),
rabbit_mgmt_db <- [ets:info(T, name)]]}.'

Running this for 24+ hours produced these results:

- Box running 3.1.5 crashed after ~38 hours, it's unclear though what caused
the crash (could be unrelated to the test)
- Box running 3.3.4 continued to execute the test after ~69 hours 

- 3.1.5 had agg_stats memory constantly growing for the entire test duration
(38h), ending at ~269K words
- 3.3.4 had agg_stats memory stabilized around ~65K words at ~5 hours mark
-- that said, 3.3.4 had a few huge outliers, reaching up to ~600K words

There are also quite interesting observations for total mgmt_db memory in
both tests:

- In 3.1.5 mgmt_db had a ~2 hour long spike/plateau at 2.5Gb, then went back
to under 1Gb for the remainder of the test
- In 3.3.4 mgmt_db never went above 700Mb, but after ~60 hours of run
dramatically changed the pattern staying under 100Mb for the remainder of
the test (except few outliers)

The most odd thing in these results is number of records in agg_stats table
in 3.3.4: after reaching certain limit (which remained stable for the entire
duration of test on 3.1.5), it began to jump between 253642 and
500046.

Attaching excel file with data, will post images next.

Test_5_-_charts.zip
<http://rabbitmq.1065348.n5.nabble.com/file/n36797/Test_5_-_charts.zip>  



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Possible-memory-leak-in-the-management-plugin-tp27414p36797.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From pmaisenovich at blizzard.com  Tue Jul 15 02:40:17 2014
From: pmaisenovich at blizzard.com (Pavel)
Date: Mon, 14 Jul 2014 18:40:17 -0700 (PDT)
Subject: [rabbitmq-discuss] test results on 3.1.5 + Erlang 15
In-Reply-To: <1405388360295-36797.post@n5.nabble.com>
References: <53457674.1040704@rabbitmq.com>
 <1397106237672-34725.post@n5.nabble.com> <53466D39.4050906@rabbitmq.com>
 <1397157592459-34779.post@n5.nabble.com> <5346F7AC.2090703@rabbitmq.com>
 <1397171854071-34790.post@n5.nabble.com> <5347F359.7010504@rabbitmq.com>
 <1398805954002-35223.post@n5.nabble.com> <5360DE1D.6080009@rabbitmq.com>
 <1405388360295-36797.post@n5.nabble.com>
Message-ID: <1405388417900-36798.post@n5.nabble.com>

<http://rabbitmq.1065348.n5.nabble.com/file/n36798/3.jpg> 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Possible-memory-leak-in-the-management-plugin-tp27414p36798.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From pmaisenovich at blizzard.com  Tue Jul 15 02:41:03 2014
From: pmaisenovich at blizzard.com (Pavel)
Date: Mon, 14 Jul 2014 18:41:03 -0700 (PDT)
Subject: [rabbitmq-discuss] test results on 3.3.4 + Erlang 17
In-Reply-To: <1405388417900-36798.post@n5.nabble.com>
References: <1397106237672-34725.post@n5.nabble.com>
 <53466D39.4050906@rabbitmq.com> <1397157592459-34779.post@n5.nabble.com>
 <5346F7AC.2090703@rabbitmq.com> <1397171854071-34790.post@n5.nabble.com>
 <5347F359.7010504@rabbitmq.com> <1398805954002-35223.post@n5.nabble.com>
 <5360DE1D.6080009@rabbitmq.com> <1405388360295-36797.post@n5.nabble.com>
 <1405388417900-36798.post@n5.nabble.com>
Message-ID: <1405388463793-36799.post@n5.nabble.com>

<http://rabbitmq.1065348.n5.nabble.com/file/n36799/3.jpg> 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Possible-memory-leak-in-the-management-plugin-tp27414p36799.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From ankur5.c at tcs.com  Tue Jul 15 07:45:43 2014
From: ankur5.c at tcs.com (Ankur5 C)
Date: Tue, 15 Jul 2014 12:15:43 +0530
Subject: [rabbitmq-discuss] MQTT broker bridges in RabbitMQ
In-Reply-To: <etPan.53b28d24.46e87ccd.2949@mercurio.local>
References: <OF19D17275.EB899AD9-ON65257D04.00410E76-65257D04.0041511E@tcs.com>
 <OF25085B34.C861C7A3-ON65257D04.0041E694-65257D04.00423F99@tcs.com>
 <etPan.53ad5e56.41a7c4c9.e552@mercurio.local>
 <OFB0EA535F.1B2EEDA6-ON65257D04.0042B1E1-65257D04.0042CE0F@tcs.com>
 <etPan.53ad5fd1.4e6afb66.e552@mercurio.local>
 <OFF19E89BC.BA947DB7-ON65257D07.002A1576-65257D07.002A3259@tcs.com>
 <etPan.53b12587.6b8b4567.1759a@mercurio.local>
 <etPan.53b126a6.643c9869.1759a@mercurio.local>
 <OF74C79851.CFCF803F-ON65257D07.00341ECF-65257D07.00342C7C@LocalDomain>
 <OF47B3F19B.5B110EAC-ON65257D08.001D17CC-65257D08.001D58ED@LocalDomain>
 <OF8380804B.FE587844-ON65257D08.001F592E-65257D08.001F7F4B@LocalDomain>
 <OF75F90CDB.E2FD7BD7-ON65257D08.003876C2-65257D08.003920A3@tcs.com>
 <etPan.53b28d24.46e87ccd.2949@mercurio.local>
Message-ID: <OFF4E81DAC.8CA49376-ON65257D16.0024CA82-65257D16.00252545@tcs.com>

Hi,

Is there any broker bridge concept against rabbitmq MQTT plugin , as there 
is one in Mosquito ?

And also how can we scale rabbit mq?

Can you refer any architectural diagram for RabbitMQ MQTT plugin.

Thanks ,

Ankur.

=====-----=====-----=====
Notice: The information contained in this e-mail
message and/or attachments to it may contain 
confidential or privileged information. If you are 
not the intended recipient, any dissemination, use, 
review, distribution, printing or copying of the 
information contained in this e-mail message 
and/or attachments to it are strictly prohibited. If 
you have received this communication in error, 
please notify us by reply e-mail or telephone and 
immediately and permanently delete the message 
and any attachments. Thank you


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140715/04186619/attachment.html>

From ankur5.c at tcs.com  Tue Jul 15 07:45:43 2014
From: ankur5.c at tcs.com (Ankur5 C)
Date: Tue, 15 Jul 2014 12:15:43 +0530
Subject: [rabbitmq-discuss] MQTT broker bridges in RabbitMQ and scalability
Message-ID: <OF92CBDD5E.BA53B17F-ON65257D16.002508DD-65257D16.0025254A@tcs.com>

Hi,

Is there any broker bridge concept against rabbitmq MQTT plugin , as there 
is one in Mosquito ?

And also how can we scale rabbit mq?

Can you refer any architectural diagram for RabbitMQ MQTT plugin.

Thanks ,

Ankur.

=====-----=====-----=====
Notice: The information contained in this e-mail
message and/or attachments to it may contain 
confidential or privileged information. If you are 
not the intended recipient, any dissemination, use, 
review, distribution, printing or copying of the 
information contained in this e-mail message 
and/or attachments to it are strictly prohibited. If 
you have received this communication in error, 
please notify us by reply e-mail or telephone and 
immediately and permanently delete the message 
and any attachments. Thank you


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140715/dc4cc522/attachment.html>

From simon at rabbitmq.com  Tue Jul 15 09:02:24 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 15 Jul 2014 09:02:24 +0100
Subject: [rabbitmq-discuss] Possible memory leak in the management plugin
In-Reply-To: <1405388360295-36797.post@n5.nabble.com>
References: <1397058685615-34697.post@n5.nabble.com>
 <53457674.1040704@rabbitmq.com> <1397106237672-34725.post@n5.nabble.com>
 <53466D39.4050906@rabbitmq.com> <1397157592459-34779.post@n5.nabble.com>
 <5346F7AC.2090703@rabbitmq.com> <1397171854071-34790.post@n5.nabble.com>
 <5347F359.7010504@rabbitmq.com> <1398805954002-35223.post@n5.nabble.com>
 <5360DE1D.6080009@rabbitmq.com> <1405388360295-36797.post@n5.nabble.com>
Message-ID: <53C4E010.80209@rabbitmq.com>

On 15/07/2014 2:39AM, Pavel wrote:
> TL/DR: baring some oddities there is a clear change of pattern in agg_stats
> table growth when using 3.3.4 comparing to 3.1.5. While in 3.1.5 it grows
> seemingly unbounded, 3.3.4 keeps it stable at certain level. More details
> below.

That's good news, and suggests the GC improvements in 3.3.1 are doing 
what they're meant to :-)

If running this test is not a huge effort for you, it might also be 
worth doing so against a nightly build - nightly builds disable detailed 
message stats by default, which should save a great deal of memory in 
your case.

Cheers,

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Tue Jul 15 09:33:43 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 15 Jul 2014 09:33:43 +0100
Subject: [rabbitmq-discuss] MQTT broker bridges in RabbitMQ and
	scalability
In-Reply-To: <OF92CBDD5E.BA53B17F-ON65257D16.002508DD-65257D16.0025254A@tcs.com>
References: <OF92CBDD5E.BA53B17F-ON65257D16.002508DD-65257D16.0025254A@tcs.com>
Message-ID: <53C4E767.7070809@rabbitmq.com>

On 15/07/2014 7:45AM, Ankur5 C wrote:
> Is there any broker bridge concept against rabbitmq MQTT plugin , as
> there is one in Mosquito ?

You can connect RabbitMQ brokers using federation: 
http://www.rabbitmq.com/federation.html

The underlying protocol is AMQP though.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From sean at monkeysnatchbanana.com  Tue Jul 15 15:37:10 2014
From: sean at monkeysnatchbanana.com (Sean Allen)
Date: Tue, 15 Jul 2014 10:37:10 -0400
Subject: [rabbitmq-discuss] monitoring rabbitmq w/ riemann
Message-ID: <CABm-WmdhDO0D=c-N3urvdSsVB2tng4PF_-QBDRDC29CyNNUzYw@mail.gmail.com>

Wanted to share a blog post we just published about how we are using
riemann & the rabbitmq http api to do monitoring. Thought it and the
underlying library might be of interest:

http://dev.theladders.com/2014/07/monitoring-rabbitmq-at-theladders/

-- 

Ce n'est pas une signature
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140715/fe74bede/attachment.html>

From simon at rabbitmq.com  Tue Jul 15 16:18:32 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 15 Jul 2014 16:18:32 +0100
Subject: [rabbitmq-discuss] monitoring rabbitmq w/ riemann
In-Reply-To: <CABm-WmdhDO0D=c-N3urvdSsVB2tng4PF_-QBDRDC29CyNNUzYw@mail.gmail.com>
References: <CABm-WmdhDO0D=c-N3urvdSsVB2tng4PF_-QBDRDC29CyNNUzYw@mail.gmail.com>
Message-ID: <53C54648.9020208@rabbitmq.com>

Thank you!

On 15/07/2014 3:37PM, Sean Allen wrote:
> Wanted to share a blog post we just published about how we are using
> riemann & the rabbitmq http api to do monitoring. Thought it and the
> underlying library might be of interest:
>
> http://dev.theladders.com/2014/07/monitoring-rabbitmq-at-theladders/
>
> --
>
> Ce n'est pas une signature
>
>
> _______________________________________________
> rabbitmq-discuss mailing list has moved to https://groups.google.com/forum/#!forum/rabbitmq-users,
> please subscribe to the new list!
>
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

-- 
Simon MacMullen
RabbitMQ, Pivotal

From jason at guard.ly  Tue Jul 15 16:07:23 2014
From: jason at guard.ly (Jason Broughton)
Date: Tue, 15 Jul 2014 08:07:23 -0700 (PDT)
Subject: [rabbitmq-discuss] Node.js -> RabbitMQ -> Couchbase issue
Message-ID: <87ab63b0-cd99-46f5-80dd-5e336356c596@googlegroups.com>

Good Day Everyone.
Im a few months new to Node.js and Rabbit and im having a strange issue.

RabbitMQ 3.3.1
Node.js v0.10.26
Express 4.2.0
Couchbase 2.5.1
AMQP (module from NPM) 0.2.0


The architecture

I have a main app that has a producer which sends a json object to RabbitMQ 
to a queue.

I have a secondary app that is the consumer. It receives the json object, 
parses it and formats the data to be saved in couchbase.

When I try to connect to couchbase or interact with couchbase at all from 
the consumer method, i get the following error amqp connection error:
error:  code=ECONNRESET, errno=ECONNRESET, syscall=read 

I then added LongJohn from NPM which gives longer stack trace.

and the error i get is :
/node_modules/express/lib/request.js:252
var trustProxy = this.app.get('trust proxy');
                                      ^
TypeError: Cannot call method 'get' of undefined

I have note enabled a 'trust proxy' and I think this is unrelated to my 
issue.

Im not sure how else to debug this issue and I am hoping someone out there 
has seen this before or can guide me where to look next.

Thanks
Jason




-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140715/b113db46/attachment.html>

From mklishin at gopivotal.com  Tue Jul 15 19:38:05 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 15 Jul 2014 22:38:05 +0400
Subject: [rabbitmq-discuss] Node.js -> RabbitMQ -> Couchbase issue
In-Reply-To: <87ab63b0-cd99-46f5-80dd-5e336356c596@googlegroups.com>
References: <87ab63b0-cd99-46f5-80dd-5e336356c596@googlegroups.com>
Message-ID: <etPan.53c5752b.1190cde7.cfde@mercurio.local>

On 15 July 2014 at 19:54:27, Jason Broughton (jason at guard.ly) wrote:
> > I have a secondary app that is the consumer. It receives the json 
> object, parses it and formats the data to be saved in couchbase. 
> 
> When I try to connect to couchbase or interact with couchbase 
> at all from the consumer method, i get the following error amqp 
> connection error:
> error: code=ECONNRESET, errno=ECONNRESET, syscall=read 
> 
> I then added LongJohn from NPM which gives longer stack trace. 
> 
> and the error i get is :
> /node_modules/express/lib/request.js:252
> var trustProxy = this.app.get('trust proxy');
> ^
> TypeError: Cannot call method 'get' of undefined

This error has nothing to do with the RabbitMQ client. See RabbitMQ log,
it may give a better clue what's going on.

Also, node-amqp is not really maintained, consider using amqp.lib:
https://github.com/squaremo/amqp.node/
-- 
MK 

Staff Software Engineer, Pivotal/RabbitMQ

From theonlyandrei at gmail.com  Tue Jul 15 20:34:31 2014
From: theonlyandrei at gmail.com (Andrei D.)
Date: Tue, 15 Jul 2014 12:34:31 -0700 (PDT)
Subject: [rabbitmq-discuss] Queue data recovery after master failure
In-Reply-To: <53A43515.7010201@rabbitmq.com>
References: <7FAE6517-8D75-4757-B690-800B4B63FD99@gmail.com>
 <53A150EB.9050109@rabbitmq.com> <53A43515.7010201@rabbitmq.com>
Message-ID: <1405452870998-36808.post@n5.nabble.com>

Great, I think we can make that assumption (slaves down) in the scenario I
described.
I'm thinking the recovery procedure would look like this:
1. power up all nodes without starting rabbit; say node X doesn't come up.
2. start rabbit on all the nodes that were not a slave for (any queue on) X
3. run the new and improved :) forget_cluster_node X. -> this should promote
some (offline) slave S as master
4. start rabbit on S (and the rest of the nodes) which should now be master
and have all the messages it had when the cluster went down.
Assuming the above should work (could you kindly confirm?), what do you
think the ETA would be for the next official release that would include the
required forget_cluster_node fix? (the one that's already in the nightly
build)
Thanks!
Andrei



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Queue-data-recovery-after-master-failure-tp36298p36808.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From pmaisenovich at blizzard.com  Tue Jul 15 21:29:49 2014
From: pmaisenovich at blizzard.com (Pavel)
Date: Tue, 15 Jul 2014 13:29:49 -0700 (PDT)
Subject: [rabbitmq-discuss] Possible memory leak in the management plugin
In-Reply-To: <53C4E010.80209@rabbitmq.com>
References: <1397106237672-34725.post@n5.nabble.com>
 <53466D39.4050906@rabbitmq.com> <1397157592459-34779.post@n5.nabble.com>
 <5346F7AC.2090703@rabbitmq.com> <1397171854071-34790.post@n5.nabble.com>
 <5347F359.7010504@rabbitmq.com> <1398805954002-35223.post@n5.nabble.com>
 <5360DE1D.6080009@rabbitmq.com> <1405388360295-36797.post@n5.nabble.com>
 <53C4E010.80209@rabbitmq.com>
Message-ID: <1405456189054-36809.post@n5.nabble.com>

Last night I've run another test to confirm the results: at 200/s publish
rate with 700 channels/699 queues 3.1.5 crashed in ~4 hours (test ended with
java.net.SocketException: Broken pipe), 3.3.4 continued to run after ~20
hours with agg_stats table stabilized at a bit higher mark (comparing to
last test). Test results attached.

Test_6_-_charts.zip
<http://rabbitmq.1065348.n5.nabble.com/file/n36809/Test_6_-_charts.zip>  


Simon MacMullen-2 wrote
> If running this test is not a huge effort for you, it might also be worth
> doing so against a nightly build - nightly builds disable detailed message
> stats by default, which should save a great deal of memory in your case.

Running test is trivial, it's just the environment that needs to be setup.
That said, wouldn't it be same as running 3.3.4 with
{rabbitmq_management_agent, [{force_fine_statistics, false}]} setting? We've
been using it in production since the issue with aggregated_stats table
growth was first discovered and the purpose of this test is to prove that
it's fixed now, so we can turn the detailed stats ON again.

*Thanks for the help troubleshooting this issue and quick fix in 3.3.1,
Simon!*




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Possible-memory-leak-in-the-management-plugin-tp27414p36809.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From carl.hoerberg at gmail.com  Tue Jul 15 22:07:57 2014
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Tue, 15 Jul 2014 14:07:57 -0700 (PDT)
Subject: [rabbitmq-discuss] Alternate Bunny RPC tutorial client
In-Reply-To: <etPan.537227b3.79e2a9e3.11ca@mercurio.local>
References: <1398997034146-35290.post@n5.nabble.com>
 <etPan.537223dc.3d1b58ba.11ca@mercurio.local>
 <etPan.537227b3.79e2a9e3.11ca@mercurio.local>
Message-ID: <1405458477982-36810.post@n5.nabble.com>

Yes, about 60% faster, in this micro benchmark:
https://github.com/laser/rpc-message-broker/commit/a408b9e88686b878e8594f22d750712c08607c7b#diff-af7971122a350a943036832d8ccfc6d0

related to this blog post:
http://blog.carbonfive.com/2014/04/28/micromessaging-connecting-heroku-microservices-wredis-and-rabbitmq/



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Alternate-Bunny-RPC-tutorial-client-tp35290p36810.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mklishin at gopivotal.com  Tue Jul 15 22:10:09 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 16 Jul 2014 01:10:09 +0400
Subject: [rabbitmq-discuss] Alternate Bunny RPC tutorial client
In-Reply-To: <1405458477982-36810.post@n5.nabble.com>
References: <1398997034146-35290.post@n5.nabble.com>
 <etPan.537223dc.3d1b58ba.11ca@mercurio.local>
 <etPan.537227b3.79e2a9e3.11ca@mercurio.local>
 <1405458477982-36810.post@n5.nabble.com>
Message-ID: <etPan.53c598ce.7fdcc233.cfde@mercurio.local>

?On 16 July 2014 at 01:09:05, carlhoerberg (carl.hoerberg at gmail.com) wrote:
> > Yes, about 60% faster, in this micro benchmark:
> https://github.com/laser/rpc-message-broker/commit/a408b9e88686b878e8594f22d750712c08607c7b#diff-af7971122a350a943036832d8ccfc6d0  
>  
> related to this blog post:
> http://blog.carbonfive.com/2014/04/28/micromessaging-connecting-heroku-microservices-wredis-and-rabbitmq/  

Nice. So what else do you want us to change in the tutorials repo and tutorials text
on rabbitmq.com/getstarted.html?
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From simon at rabbitmq.com  Wed Jul 16 10:48:15 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 16 Jul 2014 10:48:15 +0100
Subject: [rabbitmq-discuss] Queue data recovery after master failure
In-Reply-To: <1405452870998-36808.post@n5.nabble.com>
References: <7FAE6517-8D75-4757-B690-800B4B63FD99@gmail.com>
 <53A150EB.9050109@rabbitmq.com> <53A43515.7010201@rabbitmq.com>
 <1405452870998-36808.post@n5.nabble.com>
Message-ID: <53C64A5F.7080802@rabbitmq.com>

On 15/07/2014 8:34PM, Andrei D. wrote:
> Great, I think we can make that assumption (slaves down) in the scenario I
> described.
> I'm thinking the recovery procedure would look like this:
> 1. power up all nodes without starting rabbit; say node X doesn't come up.
> 2. start rabbit on all the nodes that were not a slave for (any queue on) X
> 3. run the new and improved:)  forget_cluster_node X. -> this should promote
> some (offline) slave S as master
> 4. start rabbit on S (and the rest of the nodes) which should now be master
> and have all the messages it had when the cluster went down.

Yes, that's correct. Except that you don't need to do 2), the cluster 
can be completely down for this to happen.

> Assuming the above should work (could you kindly confirm?), what do you
> think the ETA would be for the next official release that would include the
> required forget_cluster_node fix? (the one that's already in the nightly
> build)

It will be in 3.4.0. We usually make two feature releases per yesr, in 
spring and autumn, so I would guess that would mean September-ish.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Wed Jul 16 10:59:31 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 16 Jul 2014 10:59:31 +0100
Subject: [rabbitmq-discuss] Possible memory leak in the management plugin
In-Reply-To: <1405456189054-36809.post@n5.nabble.com>
References: <1397106237672-34725.post@n5.nabble.com>
 <53466D39.4050906@rabbitmq.com> <1397157592459-34779.post@n5.nabble.com>
 <5346F7AC.2090703@rabbitmq.com> <1397171854071-34790.post@n5.nabble.com>
 <5347F359.7010504@rabbitmq.com> <1398805954002-35223.post@n5.nabble.com>
 <5360DE1D.6080009@rabbitmq.com> <1405388360295-36797.post@n5.nabble.com>
 <53C4E010.80209@rabbitmq.com> <1405456189054-36809.post@n5.nabble.com>
Message-ID: <53C64D03.3080106@rabbitmq.com>

On 15/07/2014 9:29PM, Pavel wrote:
> Simon MacMullen-2 wrote
>> >If running this test is not a huge effort for you, it might also be worth
>> >doing so against a nightly build - nightly builds disable detailed message
>> >stats by default, which should save a great deal of memory in your case.
> Running test is trivial, it's just the environment that needs to be setup.

Cool!

> That said, wouldn't it be same as running 3.3.4 with
> {rabbitmq_management_agent, [{force_fine_statistics, false}]} setting? We've
> been using it in production since the issue with aggregated_stats table
> growth was first discovered and the purpose of this test is to prove that
> it's fixed now, so we can turn the detailed stats ON again.

No, it's not the same.

All released versions only give you a single switch, 
force_fine_statistics (not very well named) which switches all message 
rate statistics on and off.

The next release will rename this as follows:

   {force_fine_statistics, false} -> {rates_mode, none}
   {force_fine_statistics, true}  -> {rates_mode, detailed}

but will also have a new option (which will be the default):

   {rates_mode, basic}

In this mode management will display global message rates as well as 
rates for individual channels / exchanges / queues, but not for 
combinations of those objects. So for example you'll be able to see that 
a queue is accepting 5000 msg/s and delivering 6000 msg/s, but you won't 
be able to see which exchanges those messages came from and which 
channels those messages went to; i.e. the pane labelled "Message rates 
breakdown" in the web UI.

I think those detailed message rates are fairly rarely-used (in fact I 
suspect a lot of people don't realise they exist), so it makes sense to 
disable them by default. The upside is a large saving of RAM for use 
cases like yours, and some saving of CPU.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From mklishin at gopivotal.com  Wed Jul 16 11:17:27 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 16 Jul 2014 14:17:27 +0400
Subject: [rabbitmq-discuss] rabbitmq-discuss discontinued on Oct 1st,
 please move to rabbitmq-users
Message-ID: <etPan.53c65155.643c9869.15341@mercurio.local>

I have a little announcement to make on behalf of the RabbitMQ team.

As it was announced a few weeks ago, there's now a new mailing list on Google Groups,
rabbitmq-users: http://groups.google.com/forum/#!forum/rabbitmq-users.


rabbitmq-discuss will be SHUT DOWN on Oct 1st. Please move to the new group
(and tell other list members you know!) and start all new discussions there.

Thank you.
-- 
MK 

Staff Software Engineer, Pivotal/RabbitMQ

From kyleo at 0b10.mx  Wed Jul 16 12:41:55 2014
From: kyleo at 0b10.mx (Kyle O'Donnell)
Date: Wed, 16 Jul 2014 07:41:55 -0400 (EDT)
Subject: [rabbitmq-discuss] rabbitmq-discuss discontinued on Oct 1st,
 please move to rabbitmq-users
In-Reply-To: <etPan.53c65155.643c9869.15341@mercurio.local>
References: <etPan.53c65155.643c9869.15341@mercurio.local>
Message-ID: <1118480237.27228.1405510915464.JavaMail.zimbra@0b10.mx>


for those who don't like to use google...

rabbitmq-users+subscribe at googlegroups.com
subject: subscribe


----- Original Message -----
From: "Michael Klishin" <mklishin at gopivotal.com>
To: "Discussions about RabbitMQ" <rabbitmq-discuss at lists.rabbitmq.com>
Sent: Wednesday, July 16, 2014 6:17:27 AM
Subject: [rabbitmq-discuss] rabbitmq-discuss discontinued on Oct 1st, please move to rabbitmq-users

I have a little announcement to make on behalf of the RabbitMQ team.

As it was announced a few weeks ago, there's now a new mailing list on Google Groups,
rabbitmq-users: http://groups.google.com/forum/#!forum/rabbitmq-users.


rabbitmq-discuss will be SHUT DOWN on Oct 1st. Please move to the new group
(and tell other list members you know!) and start all new discussions there.

Thank you.
-- 
MK 

Staff Software Engineer, Pivotal/RabbitMQ
_______________________________________________
rabbitmq-discuss mailing list has moved to https://groups.google.com/forum/#!forum/rabbitmq-users,
please subscribe to the new list!

rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From mariusz.wojcik at hotmail.co.uk  Wed Jul 16 16:55:03 2014
From: mariusz.wojcik at hotmail.co.uk (Mariusz Wojcik)
Date: Wed, 16 Jul 2014 08:55:03 -0700 (PDT)
Subject: [rabbitmq-discuss] Windows server 2012 config file not found
In-Reply-To: <15e180e3-e2a6-4331-802f-386f90f48eac@googlegroups.com>
References: <15e180e3-e2a6-4331-802f-386f90f48eac@googlegroups.com>
Message-ID: <0d792adc-4793-45bd-adbc-b28f07b48a51@googlegroups.com>

Hi all,

   I also had the same problem with latest versions (3.3 and 3.4). To add 
more information, it seems there is an issue when running RabbitMQ as a 
Windows Service. It works when starting up server from console. I also 
thought this could be related to permissions, so I tried giving access to 
config file to anyone and running service under different user, including 
one with admin privileges with no success. Neither setting env.setting 
helped.

   I resolved to running rabbit from console instead of Windows service. 
You can also revert to previous version (3.0 worked fine for me). 

Hope someone can shed more light on this problem.

Cheers,

Mariusz


On Wednesday, 16 July 2014 16:10:26 UTC+1, Greg Woodbury wrote:
>
> I am running rabbitmq on windows server 2012 and am running into a problem 
> where rabbitmq seems to be unable to locate my config file. The log 
> suggests that it is looking in the correct directory for the file, but is 
> not being found. I would normally think that this is a permissions issue, 
> but the logs are being found and written to in a subdirectory from where 
> the config file resides. Below is the log snippet showing the error and I 
> have attached a screenshot with the config file sitting in the same 
> directory.
>
> =INFO REPORT==== 16-Jul-2014::10:51:39 ===
> node           : rabbit@{server}
> home dir       : C:\Windows
> config file(s) : c:/Users/{user}/AppData/Roaming/RabbitMQ/rabbitmq.config 
> (not found)
> ...
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140716/1ec4f7ef/attachment.html>

From pmaisenovich at blizzard.com  Wed Jul 16 18:14:21 2014
From: pmaisenovich at blizzard.com (Pavel)
Date: Wed, 16 Jul 2014 10:14:21 -0700 (PDT)
Subject: [rabbitmq-discuss] Possible memory leak in the management plugin
In-Reply-To: <53C64D03.3080106@rabbitmq.com>
References: <1397157592459-34779.post@n5.nabble.com>
 <5346F7AC.2090703@rabbitmq.com> <1397171854071-34790.post@n5.nabble.com>
 <5347F359.7010504@rabbitmq.com> <1398805954002-35223.post@n5.nabble.com>
 <5360DE1D.6080009@rabbitmq.com> <1405388360295-36797.post@n5.nabble.com>
 <53C4E010.80209@rabbitmq.com> <1405456189054-36809.post@n5.nabble.com>
 <53C64D03.3080106@rabbitmq.com>
Message-ID: <1405530861739-36817.post@n5.nabble.com>

Simon MacMullen-2 wrote
> The next release will rename this as follows:
> 
>    {force_fine_statistics, false} -> {rates_mode, none}
>    {force_fine_statistics, true}  -> {rates_mode, detailed}
> 
> but will also have a new option (which will be the default):
> 
>    {rates_mode, basic}

This sounds great, we'll put this in test!




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Possible-memory-leak-in-the-management-plugin-tp27414p36817.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From arnav.joshi at mathworks.com  Wed Jul 16 22:36:15 2014
From: arnav.joshi at mathworks.com (ArnavJoshi)
Date: Wed, 16 Jul 2014 14:36:15 -0700 (PDT)
Subject: [rabbitmq-discuss] Implement guaranteed delivery with
 ReturnListener and ConfirmListener
In-Reply-To: <etPan.53c42c61.74b0dc51.cfde@mercurio.local>
References: <1405360899082-36795.post@n5.nabble.com>
 <etPan.53c42c61.74b0dc51.cfde@mercurio.local>
Message-ID: <1405546575328-36818.post@n5.nabble.com>

> Did you receive an ack for a message routed to a queue whose master was
unavailable? 

We experimented by sending messages to undeclared exchanges and undeclared
queues. We received an individual ack for every message that was not routed
to the exchange and a specific queue.

> Was it the only queue the message was routed to?

Yes. We specify separate routing keys for 2 queues. There is no overlap.

Our architecture needs acknowledgements for individual messages, especially
when they are flagged as mandatory and need to be persisted to disk in cases
of failure. Hence, grouping messages in batches and then performing a "batch
check" is not what we are looking out for.

Can you provide an example where the producer receives an ack on whether a
message was persisted to disk, in case when an exchange or a queue are
undeclared/currently unavailable? 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Implement-guaranteed-delivery-with-ReturnListener-and-ConfirmListener-tp36795p36818.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mklishin at gopivotal.com  Wed Jul 16 22:41:19 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 17 Jul 2014 01:41:19 +0400
Subject: [rabbitmq-discuss] Implement guaranteed delivery with
 ReturnListener and ConfirmListener
In-Reply-To: <1405546575328-36818.post@n5.nabble.com>
References: <1405360899082-36795.post@n5.nabble.com>
 <etPan.53c42c61.74b0dc51.cfde@mercurio.local>
 <1405546575328-36818.post@n5.nabble.com>
Message-ID: <etPan.53c6f199.2eb141f2.88ca@mercurio.local>

On 17 July 2014 at 01:37:23, ArnavJoshi (arnav.joshi at mathworks.com) wrote:
> > We experimented by sending messages to undeclared exchanges 
> and undeclared
> queues. We received an individual ack for every message that 
> was not routed
> to the exchange and a specific queue.

Publishing to an undeclared exchange should result in a channel error (404 NOT_FOUND).

D id you use exchange-to-exchange bindings?
-- 
MK 

Staff Software Engineer, Pivotal/RabbitMQ

From hackeron at gmail.com  Wed Jul 16 13:51:39 2014
From: hackeron at gmail.com (Roman Gaufman)
Date: Wed, 16 Jul 2014 13:51:39 +0100
Subject: [rabbitmq-discuss] "reconnect-delay" seems to be ignored for
 Federation Upstreams
In-Reply-To: <53C3E058.2080006@rabbitmq.com>
References: <CAAs9BZM=XUwTb9t9A==fBtyD6PBqL3uK-wVMwrS_+3-1J8XHDA@mail.gmail.com>
 <53C3D0B5.60409@rabbitmq.com> <53C3E058.2080006@rabbitmq.com>
Message-ID: <CAAs9BZM5fCZvtJrGfJZgk0B-ttUsPjjqx5=EbMbLPxqyMy+QNA@mail.gmail.com>

Thank you for the log suggestion :) - Any rough estimate for when this can
be fixed permanently?

I have many servers that are offline a lot (mobile clients) and I suspect
that all the reconnection attempts are causing my RabbitMQ load to be 30%
CPU despite only having around 2-3 messages/sec.


On 14 July 2014 14:51, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 14/07/2014 1:44PM, Simon MacMullen wrote:
>
>> Could you try replacing your federation plugin with:
>>
>> http://www.rabbitmq.com/releases/plugins/v3.3.x/
>> rabbitmq_federation-3.3.x.reconnect-fix.ez
>>
>>
>> (assuming you're running 3.3.x)
>>
>> and see if that fixes it?
>>
>
> No, that's too simplistic a fix. Actually this will take some effort to
> fix properly. It will get fixed though.
>
> In the mean time, you can at least prevent noise in the logs by modifying
> the log_level config item for 'federation' (see http://www.rabbitmq.com/
> configure.html#configuration-file).
>
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140716/c17ee8e7/attachment.html>

From woodbury.greg at gmail.com  Wed Jul 16 16:10:26 2014
From: woodbury.greg at gmail.com (Greg Woodbury)
Date: Wed, 16 Jul 2014 08:10:26 -0700 (PDT)
Subject: [rabbitmq-discuss] Windows server 2012 config file not found
Message-ID: <15e180e3-e2a6-4331-802f-386f90f48eac@googlegroups.com>

I am running rabbitmq on windows server 2012 and am running into a problem 
where rabbitmq seems to be unable to locate my config file. The log 
suggests that it is looking in the correct directory for the file, but is 
not being found. I would normally think that this is a permissions issue, 
but the logs are being found and written to in a subdirectory from where 
the config file resides. Below is the log snippet showing the error and I 
have attached a screenshot with the config file sitting in the same 
directory.

=INFO REPORT==== 16-Jul-2014::10:51:39 ===
node           : rabbit@{server}
home dir       : C:\Windows
config file(s) : c:/Users/{user}/AppData/Roaming/RabbitMQ/rabbitmq.config 
(not found)
...




-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140716/65cd7e7d/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: RabbitMQConfig.png
Type: image/png
Size: 10487 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140716/65cd7e7d/attachment.png>

From woodbury.greg at gmail.com  Wed Jul 16 17:03:02 2014
From: woodbury.greg at gmail.com (Greg Woodbury)
Date: Wed, 16 Jul 2014 09:03:02 -0700 (PDT)
Subject: [rabbitmq-discuss] Windows server 2012 config file not found
In-Reply-To: <0d792adc-4793-45bd-adbc-b28f07b48a51@googlegroups.com>
References: <15e180e3-e2a6-4331-802f-386f90f48eac@googlegroups.com>
 <0d792adc-4793-45bd-adbc-b28f07b48a51@googlegroups.com>
Message-ID: <d3d9da25-95d5-46e5-a1a2-353761a36008@googlegroups.com>

It turns out that because the config file is not created as a part of the 
base install, you actually have to re-install the service after adding the 
config file. Doing this resolved my issue. We are currently on version 
3.3.2.

Hope this helps someone!

On Wednesday, July 16, 2014 11:55:03 AM UTC-4, Mariusz Wojcik wrote:
>
> Hi all,
>
>    I also had the same problem with latest versions (3.3 and 3.4). To add 
> more information, it seems there is an issue when running RabbitMQ as a 
> Windows Service. It works when starting up server from console. I also 
> thought this could be related to permissions, so I tried giving access to 
> config file to anyone and running service under different user, including 
> one with admin privileges with no success. Neither setting env.setting 
> helped.
>
>    I resolved to running rabbit from console instead of Windows service. 
> You can also revert to previous version (3.0 worked fine for me). 
>
> Hope someone can shed more light on this problem.
>
> Cheers,
>
> Mariusz
>
>
> On Wednesday, 16 July 2014 16:10:26 UTC+1, Greg Woodbury wrote:
>>
>> I am running rabbitmq on windows server 2012 and am running into a 
>> problem where rabbitmq seems to be unable to locate my config file. The log 
>> suggests that it is looking in the correct directory for the file, but is 
>> not being found. I would normally think that this is a permissions issue, 
>> but the logs are being found and written to in a subdirectory from where 
>> the config file resides. Below is the log snippet showing the error and I 
>> have attached a screenshot with the config file sitting in the same 
>> directory.
>>
>> =INFO REPORT==== 16-Jul-2014::10:51:39 ===
>> node           : rabbit@{server}
>> home dir       : C:\Windows
>> config file(s) : c:/Users/{user}/AppData/Roaming/RabbitMQ/rabbitmq.config 
>> (not found)
>> ...
>>
>>
>>
>>
>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140716/45b26e62/attachment.html>

From w_pg at qq.com  Thu Jul 17 02:17:44 2014
From: w_pg at qq.com (=?ISO-8859-1?B?TG9zdA==?=)
Date: Thu, 17 Jul 2014 09:17:44 +0800
Subject: [rabbitmq-discuss] duplicate exchange
Message-ID: <tencent_1190350915706E227B5093DF@qq.com>

Rabbitmq 3.3.1 on centos.
 see attachment, it has some exchange is duplicate.
 I am forget it how to get it, but I can not remove it from web management.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140717/d5ab5661/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: duplicate_exchange.png
Type: application/octet-stream
Size: 26052 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140717/d5ab5661/attachment.obj>

From codevally at gmail.com  Thu Jul 17 03:14:51 2014
From: codevally at gmail.com (Codevally)
Date: Wed, 16 Jul 2014 19:14:51 -0700 (PDT)
Subject: [rabbitmq-discuss] Is ERLANG OTP 17.1 compatible with RabbitMQ 3.3.4
Message-ID: <659131eb-f8aa-4469-8be2-b3820b7124f4@googlegroups.com>

Hi

I want to install and configure RabbitMQ 3.3.4 with erlang 17.1 version. Is 
this combination will work together without any issue?

If any issue, what is the compatible erlang version for RabbitMQ 3.3.4 
version?

Thanks

Roshan.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140716/34813323/attachment.html>

From mariusz.wojcik at hotmail.co.uk  Thu Jul 17 09:29:09 2014
From: mariusz.wojcik at hotmail.co.uk (Mariusz Wojcik)
Date: Thu, 17 Jul 2014 01:29:09 -0700 (PDT)
Subject: [rabbitmq-discuss] consumer received message from a queue it's
 not bound to? [c# rabbitmq-client, iis, servicestack]
In-Reply-To: <ec69f4a3-c45d-4e48-ad85-8c0e1e3ff631@googlegroups.com>
References: <ec69f4a3-c45d-4e48-ad85-8c0e1e3ff631@googlegroups.com>
Message-ID: <f991be1e-5982-4208-9cbf-70dd47c91777@googlegroups.com>

Hi Steve,

    This probably happens because both queues are bound to the exchange to 
receive a message. The reason for that may be an exchange type (fan-out for 
example will send message to any bound queue) or routing-key. Looking at 
your example, the routing-key used to bind queues is empty. Hence each 
message post with empty routing key will be delivered to both queues. You 
can run simple test to verify that. Just make sure all your queues are set 
up and then publish a message but do not run any consumers. Login to 
management portal to check to which queue the message has been routed to.

You can find more information about routing-key at 
[http://www.rabbitmq.com/amqp-0-9-1-reference.html#queue.bind.routing-key](http://www.rabbitmq.com/amqp-0-9-1-reference.html#queue.bind.routing-key)

Cheers,

Mariusz


On Wednesday, 16 July 2014 21:45:04 UTC+1, Steve Schoon wrote:
>
> Here is my strange problem that I can't figure out how to fix:
>
>    - consumer 1 write message 'a' to 'work-queue'
>    - worker starts processing job 'a' (this takes a few minutes)
>    - consumer 1 subscribes to 'queue-a' and try to consume 1 msg
>    - consumer 2 subscribes to 'queue-b' and tries to consume 1 msg
>    - worker completes processing job 'a'
>    - worker writes 'a-is-done' message to 'queue-a'
>    - ** CONSUMER 2 RECEIVES THE 'a-is-done' WRITTEN TO 'queue-a' EVEN 
>    THOUGH IT'S CONSUMING FROM 'queue-b'
>    - consumer 1 receives the expected message from 'queue-a'
>    - worker starts processing job 'b'
>    - worker completes processing job 'b'
>    - worker writes 'b-is-done' message to 'queue-'b
>    
> 'worker' is a console application that does the following in a forever 
> loop:
>
>    - reads 1 message from 'work-queue', 
>    - does some processing
>    - write 1 message to 'queue-X' where 'X' is part of the message it 
>    read from 'work-queue'
>    
>
> 'consumer1' and 'consumer2' are requests being handled by a a 
> ServiceStack-based webservice running under IIS 7.5.  The code looks like 
> this:
>
> string queueName = request.QueueName;
> BasicDeliverEventArgs result = null;
> var connectionFactory = new ConnectionFactory();
> connectionFactory.Endpoint = new AmqpTcpEndpoint("myhostname");
> connectionFactory.UserName = "user";
> connectionFactory.Password = "pass";
> using (IConnection connection = connectionFactory.CreateConnection())
> {
> using (IModel channel = connection.CreateModel())
> {
> channel.ExchangeDeclare("myexchange", ExchangeType.Direct, true);
> channel.QueueDeclare(queueName, false, false, true, null);
> channel.QueueBind(queueName, "myexchange", "");
> using (Subscription sub = new Subscription(channel, "queue-a", false))
> {
> bool rc = sub.Next(60 * 5 * 1000, out result);
> if (rc == false && result == null)
> {
>  throw new Exception("whatever");
> }
> sub.Ack(result);
> }
> }
> }
> string msg = Encoding.UTF8.GetString(result.Body);
>
> How is is possible that when subscribed to 'queue-a', that a message is 
> received that we placed into 'queue-b'?
>
> Hope this makes sense....thanks for any thoughts/suggestions.
>
> --
> Steve Schoon
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140717/1aaa5bf1/attachment.html>

From mariusz.wojcik at hotmail.co.uk  Thu Jul 17 09:30:36 2014
From: mariusz.wojcik at hotmail.co.uk (Mariusz Wojcik)
Date: Thu, 17 Jul 2014 01:30:36 -0700 (PDT)
Subject: [rabbitmq-discuss] Windows server 2012 config file not found
In-Reply-To: <d3d9da25-95d5-46e5-a1a2-353761a36008@googlegroups.com>
References: <15e180e3-e2a6-4331-802f-386f90f48eac@googlegroups.com>
 <0d792adc-4793-45bd-adbc-b28f07b48a51@googlegroups.com>
 <d3d9da25-95d5-46e5-a1a2-353761a36008@googlegroups.com>
Message-ID: <529f945a-77ba-400d-93a5-f0fa37b95ddd@googlegroups.com>

Thanks a lot. Didn't occur to me to try that.

Cheers,

Mariusz

On Wednesday, 16 July 2014 17:03:02 UTC+1, Greg Woodbury wrote:
>
> It turns out that because the config file is not created as a part of the 
> base install, you actually have to re-install the service after adding the 
> config file. Doing this resolved my issue. We are currently on version 
> 3.3.2.
>
> Hope this helps someone!
>
> On Wednesday, July 16, 2014 11:55:03 AM UTC-4, Mariusz Wojcik wrote:
>>
>> Hi all,
>>
>>    I also had the same problem with latest versions (3.3 and 3.4). To add 
>> more information, it seems there is an issue when running RabbitMQ as a 
>> Windows Service. It works when starting up server from console. I also 
>> thought this could be related to permissions, so I tried giving access to 
>> config file to anyone and running service under different user, including 
>> one with admin privileges with no success. Neither setting env.setting 
>> helped.
>>
>>    I resolved to running rabbit from console instead of Windows service. 
>> You can also revert to previous version (3.0 worked fine for me). 
>>
>> Hope someone can shed more light on this problem.
>>
>> Cheers,
>>
>> Mariusz
>>
>>
>> On Wednesday, 16 July 2014 16:10:26 UTC+1, Greg Woodbury wrote:
>>>
>>> I am running rabbitmq on windows server 2012 and am running into a 
>>> problem where rabbitmq seems to be unable to locate my config file. The log 
>>> suggests that it is looking in the correct directory for the file, but is 
>>> not being found. I would normally think that this is a permissions issue, 
>>> but the logs are being found and written to in a subdirectory from where 
>>> the config file resides. Below is the log snippet showing the error and I 
>>> have attached a screenshot with the config file sitting in the same 
>>> directory.
>>>
>>> =INFO REPORT==== 16-Jul-2014::10:51:39 ===
>>> node           : rabbit@{server}
>>> home dir       : C:\Windows
>>> config file(s) : 
>>> c:/Users/{user}/AppData/Roaming/RabbitMQ/rabbitmq.config (not found)
>>> ...
>>>
>>>
>>>
>>>
>>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140717/c26b2bc5/attachment.html>

From simon at rabbitmq.com  Thu Jul 17 09:38:16 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 17 Jul 2014 09:38:16 +0100
Subject: [rabbitmq-discuss] "reconnect-delay" seems to be ignored for
 Federation Upstreams
In-Reply-To: <CAAs9BZM5fCZvtJrGfJZgk0B-ttUsPjjqx5=EbMbLPxqyMy+QNA@mail.gmail.com>
References: <CAAs9BZM=XUwTb9t9A==fBtyD6PBqL3uK-wVMwrS_+3-1J8XHDA@mail.gmail.com>
 <53C3D0B5.60409@rabbitmq.com> <53C3E058.2080006@rabbitmq.com>
 <CAAs9BZM5fCZvtJrGfJZgk0B-ttUsPjjqx5=EbMbLPxqyMy+QNA@mail.gmail.com>
Message-ID: <53C78B78.7030703@rabbitmq.com>

On 16/07/2014 1:51PM, Roman Gaufman wrote:
> Any rough estimate for when this can be fixed permanently?

It's in the nightlies and will be in 3.3.5. It requires a small tweak to 
the broker though, so I couldn't just send an updated plugin.

Cheer, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Thu Jul 17 09:39:24 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 17 Jul 2014 09:39:24 +0100
Subject: [rabbitmq-discuss] Is ERLANG OTP 17.1 compatible with RabbitMQ
 3.3.4
In-Reply-To: <659131eb-f8aa-4469-8be2-b3820b7124f4@googlegroups.com>
References: <659131eb-f8aa-4469-8be2-b3820b7124f4@googlegroups.com>
Message-ID: <53C78BBC.9010906@rabbitmq.com>

On 17/07/2014 3:14AM, Codevally wrote:
> Hi
>
> I want to install and configure RabbitMQ 3.3.4 with erlang 17.1 version.
> Is this combination will work together without any issue?

Yes.

> If any issue, what is the compatible erlang version for RabbitMQ 3.3.4
> version?

See http://www.rabbitmq.com/which-erlang.html. tl;dr at least R13B03 but 
later is usually better.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Thu Jul 17 09:48:59 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 17 Jul 2014 09:48:59 +0100
Subject: [rabbitmq-discuss] duplicate exchange
In-Reply-To: <tencent_1190350915706E227B5093DF@qq.com>
References: <tencent_1190350915706E227B5093DF@qq.com>
Message-ID: <53C78DFB.9020903@rabbitmq.com>

On 17/07/2014 2:17AM, Lost wrote:
> Rabbitmq 3.3.1 on centos.
> see attachment, it has some exchange is duplicate.
> I am forget it how to get it, but I can not remove it from web management.

Wow, I've never seen that before.

I wonder if you have some trailing spaces or invisible unicode characters?

Could you send me the output of "rabbitmqctl report"?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From sp345s at att.com  Thu Jul 17 14:34:52 2014
From: sp345s at att.com (PATAR, SAGAR)
Date: Thu, 17 Jul 2014 13:34:52 +0000
Subject: [rabbitmq-discuss] channel-cache-size
Message-ID: <59BF56992750434F89F8EBE141E64B1D022357C3@GAALPA1MSGUSRAA.ITServices.sbc.com>

We are using spring rabbit mq to configure the connection , connection factory , listener etc ..

We are trying to understand how the below properties work ..

1)      The requestedChannelMax in com.rabbitmq.client.ConnectionFactory ..... Does this only set the upper limit on how many we can create  .. Meaning this will  NOT influence the no. of channels created during initialization and will restrict NOT to create more than this number


2)       The channel-cache-size in the below bean initialization
<rabbit:connection-factory id="connectionFactory" connection-factory="cf" channel-cache-size="${session.size}"/>

Do we use this property used to create the channels upfront ?? ..

Does every channel opens a new socket to the server ... How is opening a channel different from connection ...

What is the advantage of opening a channel vs connection by using connection mode?

Please help us to understand the above.. appreciate all the help

-Sagar




-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140717/dbd1155b/attachment.html>

From grussell at gopivotal.com  Thu Jul 17 14:50:53 2014
From: grussell at gopivotal.com (Gary Russell)
Date: Thu, 17 Jul 2014 09:50:53 -0400
Subject: [rabbitmq-discuss] channel-cache-size
In-Reply-To: <59BF56992750434F89F8EBE141E64B1D022357C3@GAALPA1MSGUSRAA.ITServices.sbc.com>
References: <59BF56992750434F89F8EBE141E64B1D022357C3@GAALPA1MSGUSRAA.ITServices.sbc.com>
Message-ID: <CADtU9_uTrdcj7eNN53JLjuGDB_gGJJBmqe_06eOZU3nMD=TQAA@mail.gmail.com>

I can answer number 2)

Only a single connection is used for all channels (by default). The cache
size is how many channels are cached (saved in a cache when "closed"
instead of actually closing them). It does not preallocate channels, they
are created on-demand and when "closed" either put in the cache or
physically closed if the cache is full.

It's generally more efficient to multiplex channels over a single
connection but you can configure the Spring CachingConnectionFactory to
allow multiple connections if you need to for some reason.


On Thu, Jul 17, 2014 at 9:34 AM, PATAR, SAGAR <sp345s at att.com> wrote:

>  We are using spring rabbit mq to configure the connection , connection
> factory , listener etc ..
>
>
>
> We are trying to understand how the below properties work ..
>
> 1)      The requestedChannelMax in com.rabbitmq.client.ConnectionFactory
> ?.. Does this only set the upper limit on how many we can create  ..
> Meaning this will  NOT influence the no. of channels created during
> initialization and will restrict NOT to create more than this number
>
>
>
> 2)       The channel-cache-size in the below bean initialization
>
> <rabbit:connection-factory id="connectionFactory" connection-factory="cf"
> channel-cache-size="${session.size}"/>
>
>
>
> Do we use this property used to create the channels upfront ?? ..
>
>
>
> Does every channel opens a new socket to the server ? How is opening a
> channel different from connection ?
>
>
>
> What is the advantage of opening a channel vs connection by using
> connection mode?
>
>
>
> Please help us to understand the above.. appreciate all the help
>
>
>
> -Sagar
>
>
>
>
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list has moved to
> https://groups.google.com/forum/#!forum/rabbitmq-users,
> please subscribe to the new list!
>
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140717/c7d58d21/attachment.html>

From mklishin at gopivotal.com  Thu Jul 17 15:34:39 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 17 Jul 2014 18:34:39 +0400
Subject: [rabbitmq-discuss] channel-cache-size
In-Reply-To: <59BF56992750434F89F8EBE141E64B1D022357C3@GAALPA1MSGUSRAA.ITServices.sbc.com>
References: <59BF56992750434F89F8EBE141E64B1D022357C3@GAALPA1MSGUSRAA.ITServices.sbc.com>
Message-ID: <etPan.53c7df03.12200854.be3d@mercurio.local>

On 17 July 2014 at 17:36:35, PATAR, SAGAR (sp345s at att.com) wrote:
> >
> We are trying to understand how the below properties work ..
>  
>  
> 1) The requestedChannelMax in com.rabbitmq.client.ConnectionFactory  
> ?.. Does this only set the upper limit on how many we can create  
> .. Meaning this will NOT influence the no. of channels created  
> during initialization and will restrict NOT to create more than  
> this number

Correct. channel_max is a setting negotiated between client and server to determine
how many channels are allowed per connection. There is a respective RabbitMQ config
option in the recent versions.

You rarely need to modify it. Some clients even force a limit of 65,536 channels.
I've never seen a legitimate reason to use more channels than that.?
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From w_pg at qq.com  Fri Jul 18 06:40:11 2014
From: w_pg at qq.com (=?ISO-8859-1?B?TG9zdA==?=)
Date: Fri, 18 Jul 2014 13:40:11 +0800
Subject: [rabbitmq-discuss] Is there possible use short connection in
	RabbitMQ?
Message-ID: <tencent_499FA3AC4FFE869769F8462B@qq.com>

I want use RabbitMQ as an RPC server.
 I want use short connection in requester with rabbitmq, is it possible?
 every request i need build a connection and creating a callback queue.
 RPC request finished, i need delete callback queue and disconnect.
 Is it ok or maybe inefficient?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140718/a1acb605/attachment.html>

From mklishin at gopivotal.com  Fri Jul 18 09:41:18 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 18 Jul 2014 12:41:18 +0400
Subject: [rabbitmq-discuss] Is there possible use short connection in
 RabbitMQ?
In-Reply-To: <tencent_499FA3AC4FFE869769F8462B@qq.com>
References: <tencent_499FA3AC4FFE869769F8462B@qq.com>
Message-ID: <etPan.53c8ddc7.257130a3.be3d@mercurio.local>

?On 18 July 2014 at 09:41:26, Lost (w_pg at qq.com) wrote:
> > I want use short connection in requester with rabbitmq, is it  
> possible?
> every request i need build a connection and creating a callback  
> queue.
> RPC request finished, i need delete callback queue and disconnect.  
> Is it ok or maybe inefficient?

It will be less efficient that not reconnecting every time but will work
otherwise. You can use exclusive queues for replies, those will be deleted
automatically when the connection they were created on is closed/lost.
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From ankur5.c at tcs.com  Fri Jul 18 09:59:12 2014
From: ankur5.c at tcs.com (Ankur5 C)
Date: Fri, 18 Jul 2014 14:29:12 +0530
Subject: [rabbitmq-discuss] MQTT login failed for "guest" access_refused
 even after mentioning loopback_users
In-Reply-To: <53C4E767.7070809@rabbitmq.com>
References: <OF92CBDD5E.BA53B17F-ON65257D16.002508DD-65257D16.0025254A@tcs.com>
 <53C4E767.7070809@rabbitmq.com>
Message-ID: <OF1285D0BD.AEF60F5C-ON65257D19.0030D6B6-65257D19.00315D78@tcs.com>

Hi,

I want the default user guest to work from remote host.

My rabbitmq config file looks like :
[{rabbit,        [{tcp_listeners,    [5672]},{ssl_listeners, [5671]}, 
                        {ssl_options, 
[{cacertfile,"/etc/rabbitmq/testca/cacert.pem"},
                    {certfile,"/etc/rabbitmq/server/cert.pem"},
                    {keyfile,"/etc/rabbitmq/server/key.pem"},
                    {verify,verify_peer},
                        {fail_if_no_peer_cert,false}]}]},
 {rabbitmq_mqtt, [{default_user,     <<"guest">>},
                  {default_pass,     <<"guest">>},
                        {loopback_users, []},
                  {allow_anonymous,  true},
                  {vhost,            <<"/">>},
                  {subscription_ttl, 1800000},
                  {prefetch,         10},
                  {ssl_listeners,    [8883]},
                  {tcp_listeners,    [1883]},
                  {tcp_listen_options, [binary,
                                        {packet,    raw},
                                        {reuseaddr, true},
                                        {backlog,   128},
                                        {nodelay,   true}]}]}
].


I have mentioned the {loopback_users, []} , and even after restarting the 
rabbitmq server my mqtt client is saying Not authorized to connect and the 
logs reveal , MQTT login failed for "guest" access_refused (access must be 
from localhost).

Please suggest.

From,local host all is well.


Thanks and Regards,
Ankur Chakraborty
=====-----=====-----=====
Notice: The information contained in this e-mail
message and/or attachments to it may contain 
confidential or privileged information. If you are 
not the intended recipient, any dissemination, use, 
review, distribution, printing or copying of the 
information contained in this e-mail message 
and/or attachments to it are strictly prohibited. If 
you have received this communication in error, 
please notify us by reply e-mail or telephone and 
immediately and permanently delete the message 
and any attachments. Thank you


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140718/06007372/attachment.html>

From mklishin at gopivotal.com  Fri Jul 18 10:03:26 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 18 Jul 2014 13:03:26 +0400
Subject: [rabbitmq-discuss] MQTT login failed for "guest" access_refused
 even after mentioning loopback_users
In-Reply-To: <OF1285D0BD.AEF60F5C-ON65257D19.0030D6B6-65257D19.00315D78@tcs.com>
References: <OF92CBDD5E.BA53B17F-ON65257D16.002508DD-65257D16.0025254A@tcs.com>
 <53C4E767.7070809@rabbitmq.com>
 <OF1285D0BD.AEF60F5C-ON65257D19.0030D6B6-65257D19.00315D78@tcs.com>
Message-ID: <etPan.53c8e2f8.436c6125.be3d@mercurio.local>

On 18 July 2014 at 13:00:44, Ankur5 C (ankur5.c at tcs.com) wrote:
> > {loopback_users, []}

loopback_users is a RabbitMQ server config setting, not the MQTT plugin.

The example on http://www.rabbitmq.com/access-control.html includes it in
the "rabbit" app config.

It is also highly recommended to use a new user with non-obvious credentials
rather than enabling remote access for "guest".?
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From ankur5.c at tcs.com  Fri Jul 18 10:17:35 2014
From: ankur5.c at tcs.com (Ankur5 C)
Date: Fri, 18 Jul 2014 14:47:35 +0530
Subject: [rabbitmq-discuss] MQTT login failed for "guest" access_refused
 even after mentioning loopback_users
In-Reply-To: <etPan.53c8e2f8.436c6125.be3d@mercurio.local>
References: <OF92CBDD5E.BA53B17F-ON65257D16.002508DD-65257D16.0025254A@tcs.com>
 <53C4E767.7070809@rabbitmq.com>
 <OF1285D0BD.AEF60F5C-ON65257D19.0030D6B6-65257D19.00315D78@tcs.com>
 <etPan.53c8e2f8.436c6125.be3d@mercurio.local>
Message-ID: <OF8551CB4B.B3089471-ON65257D19.0032CFE0-65257D19.00330C21@tcs.com>

Thanks , I am going to use a new user. Is it the right way . This time I 
am getting Bad user name or password (4). How to set up a new user ?

[{rabbit,        [{tcp_listeners,    [5672]},{ssl_listeners, [5671]}, 
                        {ssl_options, 
[{cacertfile,"/etc/rabbitmq/testca/cacert.pem"},
                    {certfile,"/etc/rabbitmq/server/cert.pem"},
                    {keyfile,"/etc/rabbitmq/server/key.pem"},
                    {verify,verify_peer},
                        {fail_if_no_peer_cert,false}]}]},
 {rabbitmq_mqtt, [{default_user,     <<"cto">>},
                  {default_pass,     <<"cto">>},
                        {allow_anonymous,  true},
                  {vhost,            <<"/">>},
                  {subscription_ttl, 1800000},
                  {prefetch,         10},
                  {ssl_listeners,    [8883]},
                  {tcp_listeners,    [1883]},
                  {tcp_listen_options, [binary,
                                        {packet,    raw},
                                        {reuseaddr, true},
                                        {backlog,   128},
                                        {nodelay,   true}]}]}
].

Thanks and Regards,
Ankur Chakraborty




From:   Michael Klishin <mklishin at gopivotal.com>
To:     Ankur5 C <ankur5.c at tcs.com>
Cc:     Legacy list about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
Date:   18-07-2014 14:33
Subject:        Re: [rabbitmq-discuss] MQTT login failed for "guest" 
access_refused even after mentioning loopback_users



On 18 July 2014 at 13:00:44, Ankur5 C (ankur5.c at tcs.com) wrote:
> > {loopback_users, []}

loopback_users is a RabbitMQ server config setting, not the MQTT plugin.

The example on http://www.rabbitmq.com/access-control.html includes it in
the "rabbit" app config.

It is also highly recommended to use a new user with non-obvious 
credentials
rather than enabling remote access for "guest". 
-- 
MK 

Staff Software Engineer, Pivotal/RabbitMQ

=====-----=====-----=====
Notice: The information contained in this e-mail
message and/or attachments to it may contain 
confidential or privileged information. If you are 
not the intended recipient, any dissemination, use, 
review, distribution, printing or copying of the 
information contained in this e-mail message 
and/or attachments to it are strictly prohibited. If 
you have received this communication in error, 
please notify us by reply e-mail or telephone and 
immediately and permanently delete the message 
and any attachments. Thank you


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140718/3d436c70/attachment.html>

From mklishin at gopivotal.com  Fri Jul 18 10:19:16 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 18 Jul 2014 13:19:16 +0400
Subject: [rabbitmq-discuss] MQTT login failed for "guest" access_refused
 even after mentioning loopback_users
In-Reply-To: <OF8551CB4B.B3089471-ON65257D19.0032CFE0-65257D19.00330C21@tcs.com>
References: <OF92CBDD5E.BA53B17F-ON65257D16.002508DD-65257D16.0025254A@tcs.com>
 <53C4E767.7070809@rabbitmq.com>
 <OF1285D0BD.AEF60F5C-ON65257D19.0030D6B6-65257D19.00315D78@tcs.com>
 <etPan.53c8e2f8.436c6125.be3d@mercurio.local>
 <OF8551CB4B.B3089471-ON65257D19.0032CFE0-65257D19.00330C21@tcs.com>
Message-ID: <etPan.53c8e6b1.333ab105.be3d@mercurio.local>

?On 18 July 2014 at 13:17:40, Ankur5 C (ankur5.c at tcs.com) wrote:
> > This time I am getting Bad user name or password (4). How to set  
> up a new user ?

rabbitmqctl add_user:
http://www.rabbitmq.com/man/rabbitmqctl.1.man.html

> {rabbitmq_mqtt, [{default_user, <<"cto">>},
> {default_pass, <<"cto">>},

Using the same password as username is a terrible practice.
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From ceri at lshift.net  Fri Jul 18 10:34:27 2014
From: ceri at lshift.net (Ceri Storey)
Date: Fri, 18 Jul 2014 10:34:27 +0100
Subject: [rabbitmq-discuss] MQTT login failed for "guest" access_refused
 even after mentioning loopback_users
In-Reply-To: <OF8551CB4B.B3089471-ON65257D19.0032CFE0-65257D19.00330C21@tcs.com>
References: <OF92CBDD5E.BA53B17F-ON65257D16.002508DD-65257D16.0025254A@tcs.com>
 <53C4E767.7070809@rabbitmq.com>
 <OF1285D0BD.AEF60F5C-ON65257D19.0030D6B6-65257D19.00315D78@tcs.com>
 <etPan.53c8e2f8.436c6125.be3d@mercurio.local>
 <OF8551CB4B.B3089471-ON65257D19.0032CFE0-65257D19.00330C21@tcs.com>
Message-ID: <53C8EA23.8040303@lshift.net>

(18/07/14 10:17), Ankur5 C wrote:
> Thanks , I am going to use a new user. Is it the right way . This time
> I am getting Bad user name or password (4). How to set up a new user ?
>
> [{rabbit,        [{tcp_listeners,    [5672]},{ssl_listeners, [5671]},    
>                         {ssl_options,
> [{cacertfile,"/etc/rabbitmq/testca/cacert.pem"},
>                     {certfile,"/etc/rabbitmq/server/cert.pem"},
>                     {keyfile,"/etc/rabbitmq/server/key.pem"},
>                     {verify,verify_peer},
>                         {fail_if_no_peer_cert,false}]}]},
>  *{rabbitmq_mqtt, [{default_user,     <<"cto">>},*
> *                  {default_pass,     <<"cto">>},*
> ...
Just to throw in my 2c, the default_user/default_pass are only applied
in the broker when it starts up with an empty database, so when it first
starts or after a rabbitmqctl reset. So, whilst you could do that,
Michael's suggestion of using rabbitmqctl add_user is virtually always
what you want.

Hope that's useful.

>
> Thanks and Regards,
> Ankur Chakraborty
>
>
>
>
> From:        Michael Klishin <mklishin at gopivotal.com>
> To:        Ankur5 C <ankur5.c at tcs.com>
> Cc:        Legacy list about RabbitMQ
> <rabbitmq-discuss at lists.rabbitmq.com>
> Date:        18-07-2014 14:33
> Subject:        Re: [rabbitmq-discuss] MQTT login failed for "guest"
> access_refused even after mentioning loopback_users
> ------------------------------------------------------------------------
>
>
>
> On 18 July 2014 at 13:00:44, Ankur5 C (ankur5.c at tcs.com) wrote:
> > > {loopback_users, []}
>
> loopback_users is a RabbitMQ server config setting, not the MQTT plugin.
>
> The example on http://www.rabbitmq.com/access-control.htmlincludes it in
> the "rabbit" app config.
>
> It is also highly recommended to use a new user with non-obvious
> credentials
> rather than enabling remote access for "guest". 
> --  
> MK  
>
> Staff Software Engineer, Pivotal/RabbitMQ
>
> =====-----=====-----=====
> Notice: The information contained in this e-mail
> message and/or attachments to it may contain
> confidential or privileged information. If you are
> not the intended recipient, any dissemination, use,
> review, distribution, printing or copying of the
> information contained in this e-mail message
> and/or attachments to it are strictly prohibited. If
> you have received this communication in error,
> please notify us by reply e-mail or telephone and
> immediately and permanently delete the message
> and any attachments. Thank you
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list has moved to https://groups.google.com/forum/#!forum/rabbitmq-users,
> please subscribe to the new list!
>
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140718/22c65bae/attachment.html>

From ankur5.c at tcs.com  Fri Jul 18 10:42:08 2014
From: ankur5.c at tcs.com (Ankur5 C)
Date: Fri, 18 Jul 2014 15:12:08 +0530
Subject: [rabbitmq-discuss] MQTT login failed for "guest" access_refused
 even after mentioning loopback_users
In-Reply-To: <OF8551CB4B.B3089471-ON65257D19.0032CFE0-65257D19.0032FAB0@LocalDomain>
References: <OF92CBDD5E.BA53B17F-ON65257D16.002508DD-65257D16.0025254A@tcs.com>
 <53C4E767.7070809@rabbitmq.com>
 <OF1285D0BD.AEF60F5C-ON65257D19.0030D6B6-65257D19.00315D78@tcs.com>
 <etPan.53c8e2f8.436c6125.be3d@mercurio.local>
 <OF8551CB4B.B3089471-ON65257D19.0032CFE0-65257D19.0032FAB0@LocalDomain>
Message-ID: <OF94CFA50B.97EF5530-ON65257D19.0035320C-65257D19.00354BDE@tcs.com>

Also sharing my client code : Do I need to use any user name and password
at the client end?

try {

			client = new MqttClient(
"tcp://ec2-54-179-77-171.ap-southeast-1.compute.amazonaws.com:1883",
"AmazonTest");

			client.connect();

			System.out.println("Connection status :: "+client
.isConnected());

			int i=0;
			MqttMessage message = new MqttMessage();
			while(true){
				try {
					i++;
					Thread.sleep(1000);
					message.setPayload(("Hii I am Raspberry
PI!!!"+Integer.toString(i)).getBytes());
					client.publish("Raspberry/test", message);
				} catch (InterruptedException e) {
					// TODO Auto-generated catch block
					e.printStackTrace();
				}
			}


		} catch (MqttException e) {
			e.printStackTrace();
		}
	}

Thanks and Regards,
Ankur Chakraborty
Tata Consultancy Services
Mailto: ankur5.c at tcs.com
Website: http://www.tcs.com
____________________________________________
Experience certainty.	IT Services
			Business Solutions
			Consulting
____________________________________________



From:	Ankur5 C/KOL/TCS
To:	Michael Klishin <mklishin at gopivotal.com>
Cc:	Legacy list about RabbitMQ
            <rabbitmq-discuss at lists.rabbitmq.com>
Date:	18-07-2014 14:46
Subject:	Re: [rabbitmq-discuss] MQTT login failed for "guest"
            access_refused even after mentioning loopback_users


Thanks , I am going to use a new user. Is it the right way . This time I am
getting Bad user name or password (4). How to set up a new user ?

[{rabbit,        [{tcp_listeners,    [5672]},{ssl_listeners, [5671]},
			{ssl_options,
[{cacertfile,"/etc/rabbitmq/testca/cacert.pem"},
                    {certfile,"/etc/rabbitmq/server/cert.pem"},
                    {keyfile,"/etc/rabbitmq/server/key.pem"},
                    {verify,verify_peer},
			{fail_if_no_peer_cert,false}]}]},
 {rabbitmq_mqtt, [{default_user,     <<"cto">>},
                  {default_pass,     <<"cto">>},
			{allow_anonymous,  true},
                  {vhost,            <<"/">>},
                  {subscription_ttl, 1800000},
                  {prefetch,         10},
                  {ssl_listeners,    [8883]},
                  {tcp_listeners,    [1883]},
                  {tcp_listen_options, [binary,
                                        {packet,    raw},
                                        {reuseaddr, true},
                                        {backlog,   128},
                                        {nodelay,   true}]}]}
].

Thanks and Regards,
Ankur Chakraborty





From:	Michael Klishin <mklishin at gopivotal.com>
To:	Ankur5 C <ankur5.c at tcs.com>
Cc:	Legacy list about RabbitMQ
            <rabbitmq-discuss at lists.rabbitmq.com>
Date:	18-07-2014 14:33
Subject:	Re: [rabbitmq-discuss] MQTT login failed for "guest"
            access_refused even after mentioning loopback_users



On 18 July 2014 at 13:00:44, Ankur5 C (ankur5.c at tcs.com) wrote:
> > {loopback_users, []}

loopback_users is a RabbitMQ server config setting, not the MQTT plugin.

The example on http://www.rabbitmq.com/access-control.html includes it in
the "rabbit" app config.

It is also highly recommended to use a new user with non-obvious
credentials
rather than enabling remote access for "guest".
--
MK

Staff Software Engineer, Pivotal/RabbitMQ


=====-----=====-----=====
Notice: The information contained in this e-mail
message and/or attachments to it may contain 
confidential or privileged information. If you are 
not the intended recipient, any dissemination, use, 
review, distribution, printing or copying of the 
information contained in this e-mail message 
and/or attachments to it are strictly prohibited. If 
you have received this communication in error, 
please notify us by reply e-mail or telephone and 
immediately and permanently delete the message 
and any attachments. Thank you




From mklishin at gopivotal.com  Fri Jul 18 10:48:05 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 18 Jul 2014 13:48:05 +0400
Subject: [rabbitmq-discuss] ANN March Hare 2.5.0 is released
Message-ID: <etPan.53c8ed71.721da317.be3d@mercurio.local>

March Hare [1] is a fast JRuby client for RabbitMQ with the API virtually
identical to Bunny.

Release notes:
http://blog.rubyrabbitmq.info/blog/2014/07/18/march-hare-2-dot-5-0-is-released/

I'd like to thank?Chris Heald for contributing all the improvements
in this release.

1.?http://rubymarchhare.info/?
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Fri Jul 18 10:51:25 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 18 Jul 2014 13:51:25 +0400
Subject: [rabbitmq-discuss] MQTT login failed for "guest" access_refused
 even after mentioning loopback_users
In-Reply-To: <OF94CFA50B.97EF5530-ON65257D19.0035320C-65257D19.00354BDE@tcs.com>
References: <OF92CBDD5E.BA53B17F-ON65257D16.002508DD-65257D16.0025254A@tcs.com>
 <53C4E767.7070809@rabbitmq.com>
 <OF1285D0BD.AEF60F5C-ON65257D19.0030D6B6-65257D19.00315D78@tcs.com>
 <etPan.53c8e2f8.436c6125.be3d@mercurio.local>
 <OF8551CB4B.B3089471-ON65257D19.0032CFE0-65257D19.0032FAB0@LocalDomain>
 <OF94CFA50B.97EF5530-ON65257D19.0035320C-65257D19.00354BDE@tcs.com>
Message-ID: <etPan.53c8ee3b.2443a858.be3d@mercurio.local>

?On 18 July 2014 at 13:43:32, Ankur5 C (ankur5.c at tcs.com) wrote:
> > Also sharing my client code : Do I need to use any user name and  
> password
> at the client end?

You can configure MQTT plugin to not perform authentication as authentication
is optional in MQTT:
http://www.rabbitmq.com/mqtt.html

If you ask me, this is a terrible MQTT feature (and in fact
I know that some MQTT-based services reject unauthenticated clients).
But if you use default_user and default_pass, you do not need to provide
any credentials. That's why default_user/default_pass are there.

Again, this is pretty clearly documented in?http://www.rabbitmq.com/mqtt.html.
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From ankur5.c at tcs.com  Fri Jul 18 11:32:57 2014
From: ankur5.c at tcs.com (Ankur5 C)
Date: Fri, 18 Jul 2014 16:02:57 +0530
Subject: [rabbitmq-discuss] MQTT login failed for "guest" access_refused
 even after mentioning loopback_users
In-Reply-To: <etPan.53c8ee3b.2443a858.be3d@mercurio.local>
References: <OF92CBDD5E.BA53B17F-ON65257D16.002508DD-65257D16.0025254A@tcs.com>
 <53C4E767.7070809@rabbitmq.com>
 <OF1285D0BD.AEF60F5C-ON65257D19.0030D6B6-65257D19.00315D78@tcs.com>
 <etPan.53c8e2f8.436c6125.be3d@mercurio.local>
 <OF8551CB4B.B3089471-ON65257D19.0032CFE0-65257D19.0032FAB0@LocalDomain>
 <OF94CFA50B.97EF5530-ON65257D19.0035320C-65257D19.00354BDE@tcs.com>
 <etPan.53c8ee3b.2443a858.be3d@mercurio.local>
Message-ID: <OFE6A6F4E8.6E051EC3-ON65257D19.0039A0A9-65257D19.0039F2A2@tcs.com>

ok , great i will use guest as default user and pass.

This is my rabbit config file :

[{rabbit,        [{tcp_listeners,    [5672]},{ssl_listeners, [5671]}, 
                        {ssl_options, 
[{cacertfile,"/etc/rabbitmq/testca/cacert.pem"},
                    {certfile,"/etc/rabbitmq/server/cert.pem"},
                    {keyfile,"/etc/rabbitmq/server/key.pem"},
                    {verify,verify_peer},
                                {fail_if_no_peer_cert,false}]}]},
 {rabbitmq_mqtt, [{default_user,     <<"guest">>},
                  {default_pass,     <<"guest">>},
                  {allow_anonymous,  true},
                  {vhost,            <<"/">>},
                  {subscription_ttl, 1800000},
                  {prefetch,         10},
                  {ssl_listeners,    [8883]},
                  {tcp_listeners,    [1883]},
                  {tcp_listen_options, [binary,
                                        {packet,    raw},
                                        {reuseaddr, true},
                                        {backlog,   128},
                                        {nodelay,   true}]}]}
].

Please let me know where should I provide the loopback_users ?


Ankur Chakraborty
Tata Consultancy Services
Plot C, Block EP ,
Salt Lake Electronics Complex
Kolkata - 700091,West Bengal
India
Ph:- +913366367304
Buzz:- 4337304
Mailto: ankur5.c at tcs.com
Website: http://www.tcs.com
____________________________________________
Experience certainty.   IT Services
                        Business Solutions
                        Consulting
____________________________________________



From:   Michael Klishin <mklishin at gopivotal.com>
To:     Ankur5 C <ankur5.c at tcs.com>
Cc:     Legacy list about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
Date:   18-07-2014 15:22
Subject:        Re: [rabbitmq-discuss] MQTT login failed for "guest" 
access_refused even after mentioning loopback_users



 On 18 July 2014 at 13:43:32, Ankur5 C (ankur5.c at tcs.com) wrote:
> > Also sharing my client code : Do I need to use any user name and 
> password
> at the client end?

You can configure MQTT plugin to not perform authentication as 
authentication
is optional in MQTT:
http://www.rabbitmq.com/mqtt.html

If you ask me, this is a terrible MQTT feature (and in fact
I know that some MQTT-based services reject unauthenticated clients).
But if you use default_user and default_pass, you do not need to provide
any credentials. That's why default_user/default_pass are there.

Again, this is pretty clearly documented in 
http://www.rabbitmq.com/mqtt.html.
-- 
MK 

Staff Software Engineer, Pivotal/RabbitMQ

=====-----=====-----=====
Notice: The information contained in this e-mail
message and/or attachments to it may contain 
confidential or privileged information. If you are 
not the intended recipient, any dissemination, use, 
review, distribution, printing or copying of the 
information contained in this e-mail message 
and/or attachments to it are strictly prohibited. If 
you have received this communication in error, 
please notify us by reply e-mail or telephone and 
immediately and permanently delete the message 
and any attachments. Thank you


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140718/194005f4/attachment.html>

From mklishin at gopivotal.com  Fri Jul 18 14:03:44 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 18 Jul 2014 17:03:44 +0400
Subject: [rabbitmq-discuss] MQTT login failed for "guest" access_refused
 even after mentioning loopback_users
In-Reply-To: <OFE6A6F4E8.6E051EC3-ON65257D19.0039A0A9-65257D19.0039F2A2@tcs.com>
References: <OF92CBDD5E.BA53B17F-ON65257D16.002508DD-65257D16.0025254A@tcs.com>
 <53C4E767.7070809@rabbitmq.com>
 <OF1285D0BD.AEF60F5C-ON65257D19.0030D6B6-65257D19.00315D78@tcs.com>
 <etPan.53c8e2f8.436c6125.be3d@mercurio.local>
 <OF8551CB4B.B3089471-ON65257D19.0032CFE0-65257D19.0032FAB0@LocalDomain>
 <OF94CFA50B.97EF5530-ON65257D19.0035320C-65257D19.00354BDE@tcs.com>
 <etPan.53c8ee3b.2443a858.be3d@mercurio.local>
 <OFE6A6F4E8.6E051EC3-ON65257D19.0039A0A9-65257D19.0039F2A2@tcs.com>
Message-ID: <etPan.53c91b4d.327b23c6.910@mercurio.local>

?On 18 July 2014 at 14:33:02, Ankur5 C (ankur5.c at tcs.com) wrote:
> > Please let me know where should I provide the loopback_users  
> ?

This is documented with an example in?http://www.rabbitmq.com/access-control.html:
[{rabbit, [{loopback_users, []}]}].

So, in your case it becomes

{rabbit, ? ? ? ?[{loopback_users, []}
? ? ? ? ? ? ? ? ?{tcp_listeners, ?[5672]},
? ? ? ? ? ? ? ? ?{ssl_listeners, ?[5671]}, ? ?
? ? ? ? ? ? ? ? ?{ssl_options, [{cacertfile,"/etc/rabbitmq/testca/cacert.pem"},
? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? {certfile,"/etc/rabbitmq/server/cert.pem"},
? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? {keyfile,"/etc/rabbitmq/server/key.pem"},
? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? {verify,verify_peer}]}
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From hackeron at gmail.com  Fri Jul 18 16:25:02 2014
From: hackeron at gmail.com (Roman Gaufman)
Date: Fri, 18 Jul 2014 16:25:02 +0100
Subject: [rabbitmq-discuss] "reconnect-delay" seems to be ignored for
 Federation Upstreams
In-Reply-To: <53C78B78.7030703@rabbitmq.com>
References: <CAAs9BZM=XUwTb9t9A==fBtyD6PBqL3uK-wVMwrS_+3-1J8XHDA@mail.gmail.com>
 <53C3D0B5.60409@rabbitmq.com> <53C3E058.2080006@rabbitmq.com>
 <CAAs9BZM5fCZvtJrGfJZgk0B-ttUsPjjqx5=EbMbLPxqyMy+QNA@mail.gmail.com>
 <53C78B78.7030703@rabbitmq.com>
Message-ID: <CAAs9BZNTYLxuy6jpf38LkPHWTOtCr8MySRjNecuOCMMCG8FZUg@mail.gmail.com>

Ah, thank you, I will wait for 3.3.5 patiently :) - looking forward to it,
it seems every reconnect attempt causes a bit of CPU spike too which will
be nice to remove.


On 17 July 2014 09:38, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 16/07/2014 1:51PM, Roman Gaufman wrote:
>
>> Any rough estimate for when this can be fixed permanently?
>>
>
> It's in the nightlies and will be in 3.3.5. It requires a small tweak to
> the broker though, so I couldn't just send an updated plugin.
>
> Cheer, Simon
>
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140718/c571470c/attachment.html>

From ask at celeryproject.org  Sat Jul 19 16:28:38 2014
From: ask at celeryproject.org (Ask Solem)
Date: Sat, 19 Jul 2014 16:28:38 +0100
Subject: [rabbitmq-discuss] Lyq
Message-ID: <A3230ACE-29CB-488D-ABF4-15AAD2D15BE6@celeryproject.org>



Sent from my iPhone

From pmaisenovich at blizzard.com  Sat Jul 19 20:15:27 2014
From: pmaisenovich at blizzard.com (Pavel)
Date: Sat, 19 Jul 2014 12:15:27 -0700 (PDT)
Subject: [rabbitmq-discuss] 3.3.4 vs 3.3.4.50711
In-Reply-To: <1405530861739-36817.post@n5.nabble.com>
References: <5346F7AC.2090703@rabbitmq.com>
 <1397171854071-34790.post@n5.nabble.com> <5347F359.7010504@rabbitmq.com>
 <1398805954002-35223.post@n5.nabble.com> <5360DE1D.6080009@rabbitmq.com>
 <1405388360295-36797.post@n5.nabble.com> <53C4E010.80209@rabbitmq.com>
 <1405456189054-36809.post@n5.nabble.com> <53C64D03.3080106@rabbitmq.com>
 <1405530861739-36817.post@n5.nabble.com>
Message-ID: <1405797327212-36851.post@n5.nabble.com>

Run the same test on 3.3.4.50711 (nightly). Statistics indeed consume much
less memory, however amount of garbage produced and collected remains on the
same level as in 3.3.4. That said garbage collection appears to be happening
more frequently and management UI remains responsive (in 3.3.4 the test will
continue to run with no errors, but web UI would become very sluggish). 

Attached is full chart for comparison, below are memory utilization
snapshots from 3.3.4 and 3.3.4.50711 after ~10 hours of test run. You can
see there that while total memory reported is high, individual tables sizes
are drastically different. From there I'm making a conclusion that most of
mgmt_db memory is taken by garbage that hasn't been collected yet.

*Is there an ETA for the next release? I'm definitely recommending my team
to wait for it before enabling detailed stats!*

/usr/sbin/rabbitmqctl eval
'sys:get_status(global:whereis_name(rabbit_mgmt_db)).'
/usr/sbin/rabbitmqctl eval
'{process_info(global:whereis_name(rabbit_mgmt_db),memory),[{T,
ets:info(T,size), ets:info(T,memory)} || T <-lists:sort(ets:all()),
rabbit_mgmt_db <- [ets:info(T, name)]]}.'

3.3.4

                [{channel_stats,5754969},
                 {connection_stats,5750872},
                 {consumers_by_channel,5763163},
                 {consumers_by_queue,5759066},
                 {node_stats,5767260},
                 {queue_stats,5746775}],
                5771357,5775454,5779551,#Ref<5446.0.0.24154>,

{{memory,865689104},
 [{5746775,745,143580},
  {5750872,2,466},
  {5754969,1400,91789},
  {5759066,0,89},
  {5763163,0,89},
  {5767260,1,1029},
  {5771357,495042,79600826},
  {5775454,979998,24119463},
  {5779551,979381,68723058}]}

3.3.4.50711

                 {state,[{channel_stats,397400},
                          {connection_stats,393303},
                          {consumers_by_channel,405594},
                          {consumers_by_queue,401497},
                          {node_stats,409691},
                          {queue_stats,389206}],
                         413788,417885,421982,#Ref<5533.0.3.240216>,

{{memory,829238624},
 [{389206,700,127399},
  {393303,4,853},
  {397400,1402,91930},
  {401497,1,171},
  {405594,1,171},
  {409691,1,1081},
  {413788,4926,18646945},
  {417885,0,89},
  {421982,979998,68734158}]}

Test_6_with_nightly_-_charts.zip
<http://rabbitmq.1065348.n5.nabble.com/file/n36851/Test_6_with_nightly_-_charts.zip>  



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Possible-memory-leak-in-the-management-plugin-tp27414p36851.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From simon at rabbitmq.com  Mon Jul 21 09:50:54 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 21 Jul 2014 09:50:54 +0100
Subject: [rabbitmq-discuss] 3.3.4 vs 3.3.4.50711
In-Reply-To: <1405797327212-36851.post@n5.nabble.com>
References: <5346F7AC.2090703@rabbitmq.com>
 <1397171854071-34790.post@n5.nabble.com> <5347F359.7010504@rabbitmq.com>
 <1398805954002-35223.post@n5.nabble.com> <5360DE1D.6080009@rabbitmq.com>
 <1405388360295-36797.post@n5.nabble.com> <53C4E010.80209@rabbitmq.com>
 <1405456189054-36809.post@n5.nabble.com> <53C64D03.3080106@rabbitmq.com>
 <1405530861739-36817.post@n5.nabble.com>
 <1405797327212-36851.post@n5.nabble.com>
Message-ID: <53CCD46E.1070309@rabbitmq.com>

On 19/07/2014 8:15PM, Pavel wrote:
> *Is there an ETA for the next release? I'm definitely recommending my team
> to wait for it before enabling detailed stats!*

This is a behavioural change, so it will be in 3.4.0, not 3.3.5. And 
3.4.0 is expected September-ish.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From ye.wang.at.bookspan at gmail.com  Mon Jul 21 20:23:46 2014
From: ye.wang.at.bookspan at gmail.com (Ye Wang)
Date: Mon, 21 Jul 2014 12:23:46 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq crash
In-Reply-To: <CAMzJFOSuGC0gYOx8AV2dARVYQ3pwh7ughkgjS6MCexrGrpnK8Q@mail.gmail.com>
References: <CAMzJFOSuGC0gYOx8AV2dARVYQ3pwh7ughkgjS6MCexrGrpnK8Q@mail.gmail.com>
Message-ID: <150d59cd-b25c-4dfa-9dd2-07b0756fef05@googlegroups.com>

I am getting the same crash report today. Not sure what to expect either. 
Can some one help to make sense of it as well?

Thanks.

=CRASH REPORT==== 21-Jul-2014::18:05:09 ===

  crasher:

    initial call: mochiweb_acceptor:init/3

    pid: <0.22386.37>

    registered_name: []

    exception error: no match of right hand side value {error,badarg}

      in function  mochiweb_request:range_parts/2

      in call from mochiweb_request:ok/2

      in call from mochiweb_request:maybe_serve_file/3

      in call from mochiweb_http:headers/5

    ancestors: [rabbit_web_dispatch_sup_15672,rabbit_web_dispatch_sup,

                  <0.247.0>]

    messages: []

    links: [#Port<0.387976>,<0.253.0>,#Port<0.387975>]

    dictionary: [{mochiweb_request_path,"/"}]

    trap_exit: false

    status: running

    heap_size: 1597

    stack_size: 24

    reductions: 8984

  neighbours:



On Friday, June 27, 2014 5:44:26 PM UTC-4, Jayashree Nataraj wrote:
>
>
> Hi All,
>
> Anybody can help what this crash means? 3 instances in a cluster (version 
> 3.3.1) all crashed at the same time.
> But surprisingly on one instance even if the service was down, the port 
> 5672 was still active. which kept the health check active. 
>
> Any help on this is appreciated.  Thanks!
>
>
> =CRASH REPORT==== 27-Jun-2014::20:04:05 ===
>   crasher:
>     initial call: mochiweb_acceptor:init/3
>     pid: <0.21001.388>
>     registered_name: []
>     exception exit: {error,accept_failed}
>       in function  mochiweb_acceptor:init/3
>     ancestors: [rabbit_web_dispatch_sup_15672,rabbit_web_dispatch_sup,
>                   <0.1519.0>]
>     messages: []
>     links: [<0.1526.0>]
>     dictionary: []
>     trap_exit: false
>     status: running
>     heap_size: 610
>     stack_size: 24
>     reductions: 4329
>   neighbours:
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140721/823bf847/attachment.html>

From ben.hsu at criticalmedia.com  Mon Jul 21 20:26:46 2014
From: ben.hsu at criticalmedia.com (Ben Hsu)
Date: Mon, 21 Jul 2014 15:26:46 -0400
Subject: [rabbitmq-discuss] deploying to rackspace cloud -- network
	partitions?
Message-ID: <CA+vhsuuHujQ+TyWM4wnJcMnmY8N-Vm_TfemUkOjREqO9-pWkfA@mail.gmail.com>

Hello,

Does anyone on this list have experience running RabbitMQ in the Rackspace
hosting provider? If so, how have you dealt with network partitions?

We have an cluster of 3 rabbitmq nodes hosted in Rackspace. In the last few
months we've seen two network partitioning events: there will be some kind
of network hiccup, and all 3 rabbit nodes will been partitioned from each
other. This requires manual intervention to restart rabbit.

We've been experimenting with pause-minority and autoheal  (
https://www.rabbitmq.com/partitions.html#automatic-handling ). We've found
that with pause-minority, all 3 nodes end up in a partition with one node,
they each then think they're in the minority, and all 3 nodes stop
accepting messages.

With autoheal we've found some bizarre errors. In one test the cluster fell
into 3 separate parts, and the nodes would not rejoin the cluster. In a
second case two of the nodes became partitioned from each other, and the
third node would not start. Error message was:

"inet_tcp",{{badmatch,{error,ehostunreach}
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140721/17c4ee03/attachment.html>

From mklishin at gopivotal.com  Mon Jul 21 20:31:43 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 21 Jul 2014 23:31:43 +0400
Subject: [rabbitmq-discuss] rabbitmq crash
In-Reply-To: <150d59cd-b25c-4dfa-9dd2-07b0756fef05@googlegroups.com>
References: <CAMzJFOSuGC0gYOx8AV2dARVYQ3pwh7ughkgjS6MCexrGrpnK8Q@mail.gmail.com>
 <150d59cd-b25c-4dfa-9dd2-07b0756fef05@googlegroups.com>
Message-ID: <etPan.53cd6ab9.3d1b58ba.675a@mercurio.local>

On 21 July 2014 at 23:25:59, Ye Wang (ye.wang.at.bookspan at gmail.com) wrote:
> > I am getting the same crash report today. Not sure what to expect  
> either. Can some one help to make sense of it as well?
>  
> Thanks.
>  
>  
> =CRASH REPORT==== 21-Jul-2014(http://airmail.calendar/2014-07-21%2012:00:00%20GMT+4)::18:05:09  
> ===
>  
>  
> crasher:
> initial call: mochiweb_acceptor:init/3
> pid: <0.22386.37>
> registered_name: []
> exception error: no match of right hand side value {error,badarg}  
> in function mochiweb_request:range_parts/2

This is not the same crash.

This one seems like Mochiweb (the HTTP server used by RabbitMQ management UI)
has a problem determining what ranges are available in the requested file
(requested with the Range request header).?
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From ankur5.c at tcs.com  Tue Jul 22 07:50:49 2014
From: ankur5.c at tcs.com (Ankur5 C)
Date: Tue, 22 Jul 2014 12:20:49 +0530
Subject: [rabbitmq-discuss] MQTT login failed for "guest" access_refused
 even after mentioning loopback_users
In-Reply-To: <etPan.53c91b4d.327b23c6.910@mercurio.local>
References: <OF92CBDD5E.BA53B17F-ON65257D16.002508DD-65257D16.0025254A@tcs.com>
 <53C4E767.7070809@rabbitmq.com>
 <OF1285D0BD.AEF60F5C-ON65257D19.0030D6B6-65257D19.00315D78@tcs.com>
 <etPan.53c8e2f8.436c6125.be3d@mercurio.local>
 <OF8551CB4B.B3089471-ON65257D19.0032CFE0-65257D19.0032FAB0@LocalDomain>
 <OF94CFA50B.97EF5530-ON65257D19.0035320C-65257D19.00354BDE@tcs.com>
 <etPan.53c8ee3b.2443a858.be3d@mercurio.local>
 <OFE6A6F4E8.6E051EC3-ON65257D19.0039A0A9-65257D19.0039F2A2@tcs.com>
 <etPan.53c91b4d.327b23c6.910@mercurio.local>
Message-ID: <OF577C2AF6.A6EEBF09-ON65257D1D.00243F1F-65257D1D.00259CE4@tcs.com>

Hi,

Just wanted to know using Paho java client how can I connect a rabbit mq 
mqtt broker using username and password.

At the broker side I have to add user and password and add the user from 
rabbitmq ctl. Then what should be done at the paho java client end ?

Please suggest with example.

Thanks and Regards,
Ankur Chakraborty
=====-----=====-----=====
Notice: The information contained in this e-mail
message and/or attachments to it may contain 
confidential or privileged information. If you are 
not the intended recipient, any dissemination, use, 
review, distribution, printing or copying of the 
information contained in this e-mail message 
and/or attachments to it are strictly prohibited. If 
you have received this communication in error, 
please notify us by reply e-mail or telephone and 
immediately and permanently delete the message 
and any attachments. Thank you


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140722/f2340d6d/attachment.html>

From 584911644 at qq.com  Tue Jul 22 04:07:17 2014
From: 584911644 at qq.com (=?ISO-8859-1?B?QWFyb24=?=)
Date: Tue, 22 Jul 2014 11:07:17 +0800
Subject: [rabbitmq-discuss] Question about Rabbitmq+Haproxy
Message-ID: <tencent_61ADB2CF3A54EF25480BAD2C@qq.com>


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140722/10c5e55b/attachment.html>

From humg.thongit at gmail.com  Tue Jul 22 05:53:11 2014
From: humg.thongit at gmail.com (=?UTF-8?B?VHLhuqduIMSQ4bupYyBUaMO0bmc=?=)
Date: Tue, 22 Jul 2014 11:53:11 +0700
Subject: [rabbitmq-discuss] How to create connection to multiple host using
	RabbitMQ .net Client
Message-ID: <CAAriO7HM-i6AZ06QaqtawLLb-9nek5kKQBT69O2=MSNoB4CqtQ@mail.gmail.com>

Hi!

I have 2 node (2 server) NodeA and NodeB rabbitmq.

I want to switch connection to NodeA when NodeB die.

This is like Bus in EasyNetQ

var bus = RabbitHutch.CreateBus("host=ubuntu:5672,ubuntu:5673");

https://github.com/mikehadlow/EasyNetQ/wiki/Cluster-Support

Please help me.

Thank you.

-------------------------------------------------------------------------------------------------

*Tran Duc Thong*
Software engineering
Mobile: 0989 452 004
Email: humg.thongit at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140722/4abc490a/attachment.html>

From 584911644 at qq.com  Tue Jul 22 08:53:45 2014
From: 584911644 at qq.com (=?utf-8?B?QWFyb24=?=)
Date: Tue, 22 Jul 2014 15:53:45 +0800
Subject: [rabbitmq-discuss] =?utf-8?q?Help=EF=BC=8Cquestion_about_rabbitmq?=
 =?utf-8?q?+Haproxy=EF=BC=8Cclient_java?=
Message-ID: <tencent_6A73B32F04B68D921C89F677@qq.com>

I have let only one node  rabbitmq online in my company in order to decoupling messages.?    This node has not been down for almost one month fortunately?but some basic problem?such as the HA and Load balancing need to be considered?so that  can keep all messages complete no matter when the related server or app is down.Such like?another node will  work still and keep the produce?customer healthy when a node is down.
    So?i have considered a solution to protect from losting messages,it?s rabbitmq?mirrored queue?+Haproxy.
    I have tried two different code?php  plays a role?both HA and load balancing.
    But?java code is not enough fortunately?LOL... Testing for several times?and I get a result?that is java code doesn?t work at all in HA,but only load balancing....?during testing?when I down a random node?producer will throw out a related session error.
    Having troubled me for almost one week this problem?and looking  sincerely forward to ur reply. 
    The environment will be shown below?
Haproxy?192.168.1.61:5670
rabbit at ubuntu ?192.168.1.61:5672?3.1.5?
rabbit at ubuntu2?192.168.1.35:5672?3.1.5?


PHP code? 
 <?php

$n = 100000;
for($i=0;$i<$n;$i++){
echo '<br/>'.$i;
//??RabbitMQ
$conn_args = array( 'host'=>'192.168.1.61' , 'port'=> '5670', 'login'=>'aaron' , 'password'=> '5555','vhost' =>'/');
$conn = new AMQPConnection($conn_args);
$conn->connect();

//??exchange?????
$channel = new AMQPChannel($conn);
$ex = new AMQPExchange($channel);
$ex->setName('direct_exchange_name');
$ex->setType(AMQP_EX_TYPE_DIRECT);
$ex->setFlags(AMQP_DURABLE | AMQP_AUTODELETE);
$ex->declare();

//??queue?????exchange???routingkey
$q = new AMQPQueue($channel);
$q->setName('queue_name');
$q->setFlags(AMQP_DURABLE | AMQP_AUTODELETE);
$q->declare();

$q->bind('direct_exchange_name', 'routingkey_name');

//????
$channel->startTransaction();
$message = json_encode(array('Hello World!','1','2','3','4','DIRECT'));
$ex->publish($message, 'routingkey_name');
$channel->commitTransaction();
$conn->disconnect();
}

?>? 







JAVA code?
ConnectionFactory factory = new ConnectionFactory();// ??????
		factory.setHost("192.168.1.61");
		factory.setUsername("aaron");
		factory.setPassword("5555");
factory.setPort(?5670?);
factory.setAutomaticRecoveryEnabled(true);

		Connection connection = factory.newConnection();// ????
factory.setNetworkRecoveryInterval(10000);?
		for(int i = 0; i < 10000; i++) {
			Channel channel = connection.createChannel();// ??????
			channel.exchangeDeclare(EXCHANGE_NAME, "fanout", durable);// ???????????
			String message = "Hello Wrold " + Math.random();
			// ??????
			channel.basicPublish(EXCHANGE_NAME, "",
					MessageProperties.PERSISTENT_TEXT_PLAIN, message.getBytes());
			System.out.println("[x] Sent '" + message + "'");
			channel.close();
		}
		connection.close();

	}?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140722/27fb9aae/attachment.html>

From mklishin at gopivotal.com  Tue Jul 22 11:10:14 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 22 Jul 2014 14:10:14 +0400
Subject: [rabbitmq-discuss] =?utf-8?Q?Help=EF=BC=8Cquestion_?=about
 =?utf-8?Q?rabbitmq+Haproxy=EF=BC=8Cclient_?=java
In-Reply-To: <tencent_6A73B32F04B68D921C89F677@qq.com>
References: <tencent_6A73B32F04B68D921C89F677@qq.com>
Message-ID: <etPan.53ce38a2.643c9869.60fb@mercurio.local>



On 22 July 2014 at 12:20:46, Aaron (584911644 at qq.com) wrote:
> > so that can keep all messages complete no matter when the related  
> server or app is down.Such like?another node will work still  
> and keep the produce?customer healthy when a node is down.
> So?i have considered a solution to protect from losting messages,it?s  
> rabbitmq?mirrored queue?+Haproxy.

There are *many* things that may fail and HAproxy won't protect you from
many of them. See

http://www.rabbitmq.com/ha.html
http://www.rabbitmq.com/reliability.html
http://www.rabbitmq.com/partitions.html
http://www.rabbitmq.com/nettick.html

You have to use publisher confirms:

http://www.rabbitmq.com/confirms.html

and be ready to reconnect and re-try publishes. In case the client
itself may crash between re-publishes, you may also need to keep a write-ahead log
(WAL) for messages. Yes, 100% guaranteed delivery is much harder than just adding
HAproxy to the mix.

> But?java code is not enough fortunately?LOL... Testing for  
> several times?and I get a result?that is java code doesn?t work  
> at all in HA,but only load balancing....?during testing?when  
> I down a random node?producer will throw out a related session  
> error.
> Having troubled me for almost one week this problem?and looking  
> sincerely forward to ur reply.

Sorry, can you explain what "a related session error" is? If you lose a node,
HAproxy will detect that a backend is down after a moment of time. RabbitMQ
connections have a certain amount of state (e.g. active consumers and delivery tag
counters), so you need to recover them.

This is much easier for consumers, though. In recent RabbitMQ versions, consumers
will be re-subscribed if the queue master node fails. In other words, if you are
not connected to the failed node, you won't have to basic.consume again, RabbitMQ
will do it for you.

Starting with RabbitMQ Java client 3.3, there's an automatic connection/channel/topology recovery
feature:

http://www.rabbitmq.com/api-guide.html

which is usually sufficient for recovering consumers. However, the client itself does not
perform internal queueing of outgoing messages, so in the period of time that the connection
is down, you need to accumulate messages in a collection/queue in memory
and re-send them with confirmation checking.?
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Tue Jul 22 11:17:29 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 22 Jul 2014 14:17:29 +0400
Subject: [rabbitmq-discuss] How to create connection to multiple host
 using RabbitMQ .net Client
In-Reply-To: <CAAriO7HM-i6AZ06QaqtawLLb-9nek5kKQBT69O2=MSNoB4CqtQ@mail.gmail.com>
References: <CAAriO7HM-i6AZ06QaqtawLLb-9nek5kKQBT69O2=MSNoB4CqtQ@mail.gmail.com>
Message-ID: <etPan.53ce3a56.19495cff.60fb@mercurio.local>

On 22 July 2014 at 11:52:24, Tr?n ??c Th?ng (humg.thongit at gmail.com) wrote:
> > I have 2 node (2 server) NodeA and NodeB rabbitmq.
>  
> I want to switch connection to NodeA when NodeB die.
>  
> This is like Bus in EasyNetQ
> var bus = RabbitHutch.CreateBus("host=ubuntu:5672,ubuntu:5673");  
>  
> https://github.com/mikehadlow/EasyNetQ/wiki/Cluster-Support  

RabbitMQ clients connect to just 1 node. You need to use a proxy
and perform connection recovery (the .NET client will eventually support
automatic recovery, much like the Java client does today).

EasyNetQ maintains multiple connections under the hood for you. If that's what
you want, I recommend that you use EasyNetQ and not the bare .NET client.

Note that ensure reliable delivery in the window of time that connection is down,
you need to enqueue messages in the app, use publisher confirms and expect that
re-delivery by the client may be necessary.?
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Tue Jul 22 11:21:55 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 22 Jul 2014 14:21:55 +0400
Subject: [rabbitmq-discuss] MQTT login failed for "guest" access_refused
 even after mentioning loopback_users
In-Reply-To: <OF577C2AF6.A6EEBF09-ON65257D1D.00243F1F-65257D1D.00259CE4@tcs.com>
References: <OF92CBDD5E.BA53B17F-ON65257D16.002508DD-65257D16.0025254A@tcs.com>
 <53C4E767.7070809@rabbitmq.com>
 <OF1285D0BD.AEF60F5C-ON65257D19.0030D6B6-65257D19.00315D78@tcs.com>
 <etPan.53c8e2f8.436c6125.be3d@mercurio.local>
 <OF8551CB4B.B3089471-ON65257D19.0032CFE0-65257D19.0032FAB0@LocalDomain>
 <OF94CFA50B.97EF5530-ON65257D19.0035320C-65257D19.00354BDE@tcs.com>
 <etPan.53c8ee3b.2443a858.be3d@mercurio.local>
 <OFE6A6F4E8.6E051EC3-ON65257D19.0039A0A9-65257D19.0039F2A2@tcs.com>
 <etPan.53c91b4d.327b23c6.910@mercurio.local>
 <OF577C2AF6.A6EEBF09-ON65257D1D.00243F1F-65257D1D.00259CE4@tcs.com>
Message-ID: <etPan.53ce3b61.625558ec.60fb@mercurio.local>

On 22 July 2014 at 10:52:11, Ankur5 C (ankur5.c at tcs.com) wrote:
> > Just wanted to know using Paho java client how can I connect a 
> rabbit mq mqtt broker using username and password.
> 
> At the broker side I have to add user and password and add the user 
> from rabbitmq ctl. Then what should be done at the paho java client 
> end ?
> 
> Please suggest with example.

Ankur,

You don't need to configure anything
in the Paho Java client, just provide a URI, client-id and (possibly) client WAL/persister.

This is what two MqttClient constructors do:
http://www.eclipse.org/paho/files/javadoc/index.html

Also, you do not technically have to add a new user to RabbitMQ but if you connect
from remote hosts and want to use reasonable security practices, that's a good idea.

That said, in the latter case non-authenticated connections is not what you want.
-- 
MK 

Staff Software Engineer, Pivotal/RabbitMQ

From simon at rabbitmq.com  Tue Jul 22 11:36:00 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 22 Jul 2014 11:36:00 +0100
Subject: [rabbitmq-discuss] rabbitmq crash
In-Reply-To: <etPan.53cd6ab9.3d1b58ba.675a@mercurio.local>
References: <CAMzJFOSuGC0gYOx8AV2dARVYQ3pwh7ughkgjS6MCexrGrpnK8Q@mail.gmail.com>
 <150d59cd-b25c-4dfa-9dd2-07b0756fef05@googlegroups.com>
 <etPan.53cd6ab9.3d1b58ba.675a@mercurio.local>
Message-ID: <53CE3E90.3080604@rabbitmq.com>

On 21/07/2014 8:31PM, Michael Klishin wrote:
> This is not the same crash.
>
> This one seems like Mochiweb (the HTTP server used by RabbitMQ management UI)
> has a problem determining what ranges are available in the requested file
> (requested with the Range request header).

Yes, reading the Mochiweb source it looks like the connection closed 
during request processing.

Ye - was this accompanied by any misbehaviour or are you just trying to 
make sense of something you saw in the logs?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From ankur5.c at tcs.com  Tue Jul 22 12:41:34 2014
From: ankur5.c at tcs.com (Ankur5 C)
Date: Tue, 22 Jul 2014 17:11:34 +0530
Subject: [rabbitmq-discuss] MQTT login failed for "guest" access_refused
 even after mentioning loopback_users
In-Reply-To: <etPan.53ce3b61.625558ec.60fb@mercurio.local>
References: <OF92CBDD5E.BA53B17F-ON65257D16.002508DD-65257D16.0025254A@tcs.com>
 <53C4E767.7070809@rabbitmq.com>
 <OF1285D0BD.AEF60F5C-ON65257D19.0030D6B6-65257D19.00315D78@tcs.com>
 <etPan.53c8e2f8.436c6125.be3d@mercurio.local>
 <OF8551CB4B.B3089471-ON65257D19.0032CFE0-65257D19.0032FAB0@LocalDomain>
 <OF94CFA50B.97EF5530-ON65257D19.0035320C-65257D19.00354BDE@tcs.com>
 <etPan.53c8ee3b.2443a858.be3d@mercurio.local>
 <OFE6A6F4E8.6E051EC3-ON65257D19.0039A0A9-65257D19.0039F2A2@tcs.com>
 <etPan.53c91b4d.327b23c6.910@mercurio.local>
 <OF577C2AF6.A6EEBF09-ON65257D1D.00243F1F-65257D1D.00259CE4@tcs.com>
 <etPan.53ce3b61.625558ec.60fb@mercurio.local>
Message-ID: <OFA3AA0936.ADB86FF6-ON65257D1D.003FC4BF-65257D1D.00403AE9@tcs.com>

So if I do not use SSL , in that case how does the authentication occur? 
Anyone who is aware of the uri can post data to a topic with a client id ?

What is the significance of the user and pass (mentioned as default user 
and pass) mentioned in the rabbit config file?

I am using the default one and using the tag   loopback_users, []   for 
connecting from remote host. All is working fine.

Thanks and Regards,
Ankur Chakraborty




From:   Michael Klishin <mklishin at gopivotal.com>
To:     Ankur5 C <ankur5.c at tcs.com>
Cc:     Legacy list about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
Date:   22-07-2014 15:53
Subject:        Re: [rabbitmq-discuss] MQTT login failed for "guest" 
access_refused even after mentioning loopback_users



On 22 July 2014 at 10:52:11, Ankur5 C (ankur5.c at tcs.com) wrote:
> > Just wanted to know using Paho java client how can I connect a 
> rabbit mq mqtt broker using username and password.
> 
> At the broker side I have to add user and password and add the user 
> from rabbitmq ctl. Then what should be done at the paho java client 
> end ?
> 
> Please suggest with example.

Ankur,

You don't need to configure anything
in the Paho Java client, just provide a URI, client-id and (possibly) 
client WAL/persister.

This is what two MqttClient constructors do:
http://www.eclipse.org/paho/files/javadoc/index.html

Also, you do not technically have to add a new user to RabbitMQ but if you 
connect
from remote hosts and want to use reasonable security practices, that's a 
good idea.

That said, in the latter case non-authenticated connections is not what 
you want.
-- 
MK 

Staff Software Engineer, Pivotal/RabbitMQ

=====-----=====-----=====
Notice: The information contained in this e-mail
message and/or attachments to it may contain 
confidential or privileged information. If you are 
not the intended recipient, any dissemination, use, 
review, distribution, printing or copying of the 
information contained in this e-mail message 
and/or attachments to it are strictly prohibited. If 
you have received this communication in error, 
please notify us by reply e-mail or telephone and 
immediately and permanently delete the message 
and any attachments. Thank you


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140722/bd3dbc0f/attachment.html>

From mklishin at gopivotal.com  Tue Jul 22 12:51:39 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 22 Jul 2014 15:51:39 +0400
Subject: [rabbitmq-discuss] MQTT login failed for "guest" access_refused
 even after mentioning loopback_users
In-Reply-To: <OFA3AA0936.ADB86FF6-ON65257D1D.003FC4BF-65257D1D.00403AE9@tcs.com>
References: <OF92CBDD5E.BA53B17F-ON65257D16.002508DD-65257D16.0025254A@tcs.com>
 <53C4E767.7070809@rabbitmq.com>
 <OF1285D0BD.AEF60F5C-ON65257D19.0030D6B6-65257D19.00315D78@tcs.com>
 <etPan.53c8e2f8.436c6125.be3d@mercurio.local>
 <OF8551CB4B.B3089471-ON65257D19.0032CFE0-65257D19.0032FAB0@LocalDomain>
 <OF94CFA50B.97EF5530-ON65257D19.0035320C-65257D19.00354BDE@tcs.com>
 <etPan.53c8ee3b.2443a858.be3d@mercurio.local>
 <OFE6A6F4E8.6E051EC3-ON65257D19.0039A0A9-65257D19.0039F2A2@tcs.com>
 <etPan.53c91b4d.327b23c6.910@mercurio.local>
 <OF577C2AF6.A6EEBF09-ON65257D1D.00243F1F-65257D1D.00259CE4@tcs.com>
 <etPan.53ce3b61.625558ec.60fb@mercurio.local>
 <OFA3AA0936.ADB86FF6-ON65257D1D.003FC4BF-65257D1D.00403AE9@tcs.com>
Message-ID: <etPan.53ce5066.515f007c.60fb@mercurio.local>

On 22 July 2014 at 15:41:40, Ankur5 C (ankur5.c at tcs.com) wrote:
> > So if I do not use SSL , in that case how does the authentication  
> occur?

If you configure RabbitMQ to verify peer, the client will be authenticated.
Paho can be configured to perform TLS verification, too.

http://www.rabbitmq.com/ssl.html

Different clients expose different APIs for enabling/disabling peer verification.
There are 3 examples that demonstrate how MQTT clients can be set up to use TLS
with peer verification, including 2 Paho clients (Java and Python):

https://github.com/michaelklishin/mqtt-tls-playground

> Anyone who is aware of the uri can post data to a topic with  
> a client id ?

You do not post data to URIs in MQTT. You open a long-running connection
using a URI and client-id, then publish messages using a separate protocol
frame (which clients expose as a separate API function/method).

In Paho, the method is MqttClient#publish:
http://www.eclipse.org/paho/files/javadoc/org/eclipse/paho/client/mqttv3/MqttClient.html#publish(java.lang.String, byte[], int, boolean)

Sorry to point this out but this is really basic ?,
a software engineer should be able to figure this out on her own quite quickly.

> What is the significance of the user and pass (mentioned as default  
> user and pass) mentioned in the rabbit config file?

We are going in circles on this. This is documented quite clearly:
http://www.rabbitmq.com/mqtt.html

> I am using the default one and using the tag loopback_users, []  
> for connecting from remote host. All is working fine.

That can work but now it is possible to connect to your RabbitMQ node
using well-known credentials of an administrative user. Doesn't sound incredibly
secure to me.
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From ankur5.c at tcs.com  Tue Jul 22 13:00:03 2014
From: ankur5.c at tcs.com (Ankur5 C)
Date: Tue, 22 Jul 2014 17:30:03 +0530
Subject: [rabbitmq-discuss] MQTT login failed for "guest" access_refused
 even after mentioning loopback_users
In-Reply-To: <etPan.53ce5066.515f007c.60fb@mercurio.local>
References: <OF92CBDD5E.BA53B17F-ON65257D16.002508DD-65257D16.0025254A@tcs.com>
 <53C4E767.7070809@rabbitmq.com>
 <OF1285D0BD.AEF60F5C-ON65257D19.0030D6B6-65257D19.00315D78@tcs.com>
 <etPan.53c8e2f8.436c6125.be3d@mercurio.local>
 <OF8551CB4B.B3089471-ON65257D19.0032CFE0-65257D19.0032FAB0@LocalDomain>
 <OF94CFA50B.97EF5530-ON65257D19.0035320C-65257D19.00354BDE@tcs.com>
 <etPan.53c8ee3b.2443a858.be3d@mercurio.local>
 <OFE6A6F4E8.6E051EC3-ON65257D19.0039A0A9-65257D19.0039F2A2@tcs.com>
 <etPan.53c91b4d.327b23c6.910@mercurio.local>
 <OF577C2AF6.A6EEBF09-ON65257D1D.00243F1F-65257D1D.00259CE4@tcs.com>
 <etPan.53ce3b61.625558ec.60fb@mercurio.local>
 <OFA3AA0936.ADB86FF6-ON65257D1D.003FC4BF-65257D1D.00403AE9@tcs.com>
 <etPan.53ce5066.515f007c.60fb@mercurio.local>
Message-ID: <OFFDBE1D75.ED35DBBF-ON65257D1D.0041B10F-65257D1D.0041EC26@tcs.com>

I guess I am not able to clarify my question. 

Ok let me pose this like , is there any other mode of authentication other 
than TLS ?

When we create topics , is there any feature of role / user based access 
of those topics?

Thanks and Regards,
Ankur Chakraborty




From:   Michael Klishin <mklishin at gopivotal.com>
To:     Ankur5 C <ankur5.c at tcs.com>
Cc:     Legacy list about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
Date:   22-07-2014 17:22
Subject:        Re: [rabbitmq-discuss] MQTT login failed for "guest" 
access_refused even after mentioning loopback_users



On 22 July 2014 at 15:41:40, Ankur5 C (ankur5.c at tcs.com) wrote:
> > So if I do not use SSL , in that case how does the authentication 
> occur?

If you configure RabbitMQ to verify peer, the client will be 
authenticated.
Paho can be configured to perform TLS verification, too.

http://www.rabbitmq.com/ssl.html

Different clients expose different APIs for enabling/disabling peer 
verification.
There are 3 examples that demonstrate how MQTT clients can be set up to 
use TLS
with peer verification, including 2 Paho clients (Java and Python):

https://github.com/michaelklishin/mqtt-tls-playground

> Anyone who is aware of the uri can post data to a topic with 
> a client id ?

You do not post data to URIs in MQTT. You open a long-running connection
using a URI and client-id, then publish messages using a separate protocol
frame (which clients expose as a separate API function/method).

In Paho, the method is MqttClient#publish:
http://www.eclipse.org/paho/files/javadoc/org/eclipse/paho/client/mqttv3/MqttClient.html#publish(java.lang.String
, byte[], int, boolean)

Sorry to point this out but this is really basic  ,
a software engineer should be able to figure this out on her own quite 
quickly.

> What is the significance of the user and pass (mentioned as default 
> user and pass) mentioned in the rabbit config file?

We are going in circles on this. This is documented quite clearly:
http://www.rabbitmq.com/mqtt.html

> I am using the default one and using the tag loopback_users, [] 
> for connecting from remote host. All is working fine.

That can work but now it is possible to connect to your RabbitMQ node
using well-known credentials of an administrative user. Doesn't sound 
incredibly
secure to me.
-- 
MK 

Staff Software Engineer, Pivotal/RabbitMQ

=====-----=====-----=====
Notice: The information contained in this e-mail
message and/or attachments to it may contain 
confidential or privileged information. If you are 
not the intended recipient, any dissemination, use, 
review, distribution, printing or copying of the 
information contained in this e-mail message 
and/or attachments to it are strictly prohibited. If 
you have received this communication in error, 
please notify us by reply e-mail or telephone and 
immediately and permanently delete the message 
and any attachments. Thank you


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140722/5e8f5f56/attachment.html>

From mklishin at gopivotal.com  Tue Jul 22 13:05:13 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 22 Jul 2014 16:05:13 +0400
Subject: [rabbitmq-discuss] MQTT login failed for "guest" access_refused
 even after mentioning loopback_users
In-Reply-To: <OFFDBE1D75.ED35DBBF-ON65257D1D.0041B10F-65257D1D.0041EC26@tcs.com>
References: <OF92CBDD5E.BA53B17F-ON65257D16.002508DD-65257D16.0025254A@tcs.com>
 <53C4E767.7070809@rabbitmq.com>
 <OF1285D0BD.AEF60F5C-ON65257D19.0030D6B6-65257D19.00315D78@tcs.com>
 <etPan.53c8e2f8.436c6125.be3d@mercurio.local>
 <OF8551CB4B.B3089471-ON65257D19.0032CFE0-65257D19.0032FAB0@LocalDomain>
 <OF94CFA50B.97EF5530-ON65257D19.0035320C-65257D19.00354BDE@tcs.com>
 <etPan.53c8ee3b.2443a858.be3d@mercurio.local>
 <OFE6A6F4E8.6E051EC3-ON65257D19.0039A0A9-65257D19.0039F2A2@tcs.com>
 <etPan.53c91b4d.327b23c6.910@mercurio.local>
 <OF577C2AF6.A6EEBF09-ON65257D1D.00243F1F-65257D1D.00259CE4@tcs.com>
 <etPan.53ce3b61.625558ec.60fb@mercurio.local>
 <OFA3AA0936.ADB86FF6-ON65257D1D.003FC4BF-65257D1D.00403AE9@tcs.com>
 <etPan.53ce5066.515f007c.60fb@mercurio.local>
 <OFFDBE1D75.ED35DBBF-ON65257D1D.0041B10F-65257D1D.0041EC26@tcs.com>
Message-ID: <etPan.53ce5396.5bd062c2.60fb@mercurio.local>

On 22 July 2014 at 16:00:08, Ankur5 C (ankur5.c at tcs.com) wrote:
> > Ok let me pose this like , is there any other mode of authentication  
> other than TLS ?

With MQTT you can authenticate using username & password or bypass authentication
and use TLS peer verification. Authentication mechanisms in MQTT (the protocol, not the plugin)
are not pluggable.

RabbitMQ will support TLS certificate authentication [1] for MQTT, too, but currently does not.

> When we create topics , is there any feature of role / user based  
> access of those topics?

RabbitMQ itself has fairly flexible authorization:
http://www.rabbitmq.com/access-control.html

but MQTT (the protocol) does not have the concept of topic authorization as of 3.1.1.
So while you can restrict e.g. publishing for MQTT clients (internally, the amq.topic exchange
is used by the MQTT plugin), there is no good way to indicate authorization failures
to MQTT clients.

This is a subject of ongoing debate in the MQTT community, unfortunately, I'm not aware of
any suggested improvements for the future spec revisions.?

1.?https://github.com/rabbitmq/rabbitmq-auth-mechanism-ssl
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From Ashish.Ojha at gs.com  Tue Jul 22 13:25:41 2014
From: Ashish.Ojha at gs.com (Ojha, Ashish)
Date: Tue, 22 Jul 2014 08:25:41 -0400
Subject: [rabbitmq-discuss] RabbitMQ SSL issue
Message-ID: <980BAC4805366740ABBFA255D60D36A134280E6D9F@GSCMAMP16EX.firmwide.corp.gs.com>

Hi Team,

I am having issues when I have fail_if_no_peer_cert set to "true" in the rabbitmq.config of the broker , I have the JAVA sample code and it always gives the below error ( It works fine when I have fail_if_no_peer_cert set to "false" )

Broker Error :

=INFO REPORT==== 22-Jul-2014::13:17:37 ===
accepting AMQP connection <0.318.0> (10.221.139.177:63560 -> 10.238.104.147:27575)

=ERROR REPORT==== 22-Jul-2014::13:17:38 ===
SSL: certify: tls_connection.erl:509:Fatal error: handshake failure

=ERROR REPORT==== 22-Jul-2014::13:17:43 ===
error on AMQP connection <0.318.0>: {ssl_upgrade_error,{tls_alert,[104,97,110,100,115,104,97,107,101,32,102,97,105,108,117,114,101]}
}...


Java Exception :

Exception in thread "main" javax.net.ssl.SSLHandshakeException: Received fatal alert: handshake_failure
       at com.sun.net.ssl.internal.ssl.Alerts.getSSLException(Alerts.java:174)
       at com.sun.net.ssl.internal.ssl.Alerts.getSSLException(Alerts.java:136)
       at com.sun.net.ssl.internal.ssl.SSLSocketImpl.recvAlert(SSLSocketImpl.java:1657)
       at com.sun.net.ssl.internal.ssl.SSLSocketImpl.readRecord(SSLSocketImpl.java:932)
       at com.sun.net.ssl.internal.ssl.SSLSocketImpl.performInitialHandshake(SSLSocketImpl.java:1096)
       at com.sun.net.ssl.internal.ssl.SSLSocketImpl.writeRecord(SSLSocketImpl.java:623)
       at com.sun.net.ssl.internal.ssl.AppOutputStream.write(AppOutputStream.java:59)
       at java.io.BufferedOutputStream.flushBuffer(BufferedOutputStream.java:65)
       at java.io.BufferedOutputStream.flush(BufferedOutputStream.java:123)
       at java.io.DataOutputStream.flush(DataOutputStream.java:106)
       at com.rabbitmq.client.impl.SocketFrameHandler.sendHeader(SocketFrameHandler.java:129)
       at com.rabbitmq.client.impl.SocketFrameHandler.sendHeader(SocketFrameHandler.java:134)
       at com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:276)
       at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:590)
       at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:612)
       at SSL_Listener.main(SSL_Listener.java:55)


The Goldman Sachs Group, Inc. All rights reserved.
See http://www.gs.com/disclaimer/global_email for important risk disclosures, conflicts of interest and other terms and conditions relating to this e-mail and your reliance on information contained in it.  This message may contain confidential or privileged information.  If you are not the intended recipient, please advise us immediately and delete this message.  See http://www.gs.com/disclaimer/email for further information on confidentiality and the risks of non-secure electronic communication.  If you cannot access these links, please notify us by reply message and we will send the contents to you.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140722/940149db/attachment.html>

From mklishin at gopivotal.com  Tue Jul 22 13:31:31 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 22 Jul 2014 16:31:31 +0400
Subject: [rabbitmq-discuss] RabbitMQ SSL issue
In-Reply-To: <980BAC4805366740ABBFA255D60D36A134280E6D9F@GSCMAMP16EX.firmwide.corp.gs.com>
References: <980BAC4805366740ABBFA255D60D36A134280E6D9F@GSCMAMP16EX.firmwide.corp.gs.com>
Message-ID: <etPan.53ce59c0.216231b.60fb@mercurio.local>

On 22 July 2014 at 16:27:36, Ojha, Ashish (ashish.ojha at gs.com) wrote:
> >
> I am having issues when I have fail_if_no_peer_cert set to ?true?  
> in the rabbitmq.config of the broker , I have the JAVA sample code  
> and it always gives the below error ( It works fine when I have fail_if_no_peer_cert  
> set to ?false? )

Something is wrong with the way you configure TLS in the client (or with the cert/CA used).

See?http://www.rabbitmq.com/troubleshooting-ssl.html.

?In case you need to generate
some development certificates quickly on a UNIX system, consider
https://github.com/michaelklishin/tls-gen/

(this includes the PKCS12 certificates used by JDK's keytool).
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From KGanann at kroll.com  Wed Jul 23 18:39:54 2014
From: KGanann at kroll.com (Ganann, Kale)
Date: Wed, 23 Jul 2014 17:39:54 +0000
Subject: [rabbitmq-discuss] rabbitmqadmin
Message-ID: <6DB033025329784B9280ABD9516177FCA2D1A8A8@USEPX2PMXMBX12.corp.altegrity.com>

So, I'm working on cleaning up some old data and vhosts around a 3.2.1 cluster, and I'm running into some weird things.  When I run rabbitmqadmin delete parameter -component=federation name=local-nodename (or local-username) -V vhostname, if I use the -username -password prompts I get access denied.  So I temporarily re-added guest/guest and gave it access to the vhost in question, and it hung.  Like, over lunch hung.  I hit ctrl-c when I got back and got this traceback:
^CTraceback (most recent call last):
  File "/usr/local/bin/rabbitmqadmin", line 939, in <module>
    main()
  File "/usr/local/bin/rabbitmqadmin", line 380, in main
    method()
  File "/usr/local/bin/rabbitmqadmin", line 560, in invoke_delete
    self.delete(uri)
  File "/usr/local/bin/rabbitmqadmin", line 412, in delete
    return self.http("DELETE", "/api%s" % path, "")
  File "/usr/local/bin/rabbitmqadmin", line 432, in http
    resp = conn.getresponse()
  File "/usr/lib/python2.7/httplib.py", line 1030, in getresponse
    response.begin()
  File "/usr/lib/python2.7/httplib.py", line 407, in begin
    version, status, reason = self._read_status()
  File "/usr/lib/python2.7/httplib.py", line 365, in _read_status
    line = self.fp.readline()
  File "/usr/lib/python2.7/socket.py", line 430, in readline
    data = recv(1)
KeyboardInterrupt

I've seen some issues with deleting vhosts in earlier versions - is that still an issue with this version?  Am I doing something wrong with the command?  Is there a reason I can't feed it an account with similar access to the guest account and have it at least give me the same result?

Thanks for any information or insight you can provide,
Kale

This communication contains information that is confidential,
proprietary in nature, and may also be attorney-client privileged
and/or work product privileged. It is for the exclusive use of the
intended recipient(s). If you are not the intended recipient(s) or
the person responsible for delivering it to the intended
recipient(s), please note that any form of dissemination,
distribution or copying of this communication is strictly
prohibited and may be unlawful. If you have received this
communication in error, please immediately notify the sender by replying
to this message and delete this email immediately. Thank you for your cooperation. 

Please be advised that neither Altegrity, its affiliates, its employees
or agents accept liability for any errors, omissions or damages
caused by delays of receipt or by any virus infection in this
message or its attachments, or which may otherwise arise as a
result of this e-mail transmission.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140723/7cdc5251/attachment.html>

From mklishin at gopivotal.com  Wed Jul 23 20:01:35 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 23 Jul 2014 23:01:35 +0400
Subject: [rabbitmq-discuss] rabbitmqadmin
In-Reply-To: <6DB033025329784B9280ABD9516177FCA2D1A8A8@USEPX2PMXMBX12.corp.altegrity.com>
References: <6DB033025329784B9280ABD9516177FCA2D1A8A8@USEPX2PMXMBX12.corp.altegrity.com>
Message-ID: <etPan.53d006a8.515f007c.11c3b@mercurio.local>

?On 23 July 2014 at 21:41:03, Ganann, Kale (kganann at kroll.com) wrote:
> > I?ve seen some issues with deleting vhosts in earlier versions  
> ? is that still an issue with this version?

It's not possible to tell without seeing what RabbitMQ logs when it happens.

> Am I doing something  
> wrong with the command? Is there a reason I can?t feed it an account  
> with similar access to the guest account and have it at least give  
> me the same result?

You can use any user that has the administrator tag and access to the vhost.
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From KGanann at kroll.com  Wed Jul 23 20:42:28 2014
From: KGanann at kroll.com (Ganann, Kale)
Date: Wed, 23 Jul 2014 19:42:28 +0000
Subject: [rabbitmq-discuss] rabbitmqadmin
In-Reply-To: <etPan.53d006a8.515f007c.11c3b@mercurio.local>
References: <6DB033025329784B9280ABD9516177FCA2D1A8A8@USEPX2PMXMBX12.corp.altegrity.com>
 <etPan.53d006a8.515f007c.11c3b@mercurio.local>
Message-ID: <6DB033025329784B9280ABD9516177FCA2D1AA08@USEPX2PMXMBX12.corp.altegrity.com>

Both users have the administrator tag, and have been give full access to that vhost, yet both get different results.  My usual admin account gets access denied, where guest just hangs.  That's what I'm trying to figure out - the closest I've gotten to an error message is that traceback.

Thanks,
Kale


-----Original Message-----
From: Michael Klishin [mailto:mklishin at gopivotal.com] 
Sent: Wednesday, July 23, 2014 2:02 PM
To: Ganann, Kale; Legacy list about RabbitMQ
Subject: Re: [rabbitmq-discuss] rabbitmqadmin

?On 23 July 2014 at 21:41:03, Ganann, Kale (kganann at kroll.com) wrote:
> > I?ve seen some issues with deleting vhosts in earlier versions
> ? is that still an issue with this version?

It's not possible to tell without seeing what RabbitMQ logs when it happens.

> Am I doing something
> wrong with the command? Is there a reason I can?t feed it an account 
> with similar access to the guest account and have it at least give me 
> the same result?

You can use any user that has the administrator tag and access to the vhost.
--
MK  

Staff Software Engineer, Pivotal/RabbitMQ
This communication contains information that is confidential,
proprietary in nature, and may also be attorney-client privileged
and/or work product privileged. It is for the exclusive use of the
intended recipient(s). If you are not the intended recipient(s) or
the person responsible for delivering it to the intended
recipient(s), please note that any form of dissemination,
distribution or copying of this communication is strictly
prohibited and may be unlawful. If you have received this
communication in error, please immediately notify the sender by replying
to this message and delete this email immediately. Thank you for your cooperation. 

Please be advised that neither Altegrity, its affiliates, its employees
or agents accept liability for any errors, omissions or damages
caused by delays of receipt or by any virus infection in this
message or its attachments, or which may otherwise arise as a
result of this e-mail transmission.

From mklishin at gopivotal.com  Wed Jul 23 21:03:31 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 24 Jul 2014 00:03:31 +0400
Subject: [rabbitmq-discuss] rabbitmqadmin
In-Reply-To: <6DB033025329784B9280ABD9516177FCA2D1AA08@USEPX2PMXMBX12.corp.altegrity.com>
References: <6DB033025329784B9280ABD9516177FCA2D1A8A8@USEPX2PMXMBX12.corp.altegrity.com>
 <etPan.53d006a8.515f007c.11c3b@mercurio.local>
 <6DB033025329784B9280ABD9516177FCA2D1AA08@USEPX2PMXMBX12.corp.altegrity.com>
Message-ID: <etPan.53d01530.6b8b4567.10295@mercurio.local>

On 23 July 2014 at 23:43:38, Ganann, Kale (kganann at kroll.com) wrote:
> > Both users have the administrator tag, and have been give full  
> access to that vhost, yet both get different results. My usual  
> admin account gets access denied, where guest just hangs. That's  
> what I'm trying to figure out - the closest I've gotten to an error  
> message is that traceback.

Kale,

I highly recommend taking a look at RabbitMQ log files and posting the relevant
parts to this list. Guessing usually is not as effective.?
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From Dhinesh.P at saint-gobain.com  Thu Jul 24 07:36:10 2014
From: Dhinesh.P at saint-gobain.com (Dhinesh)
Date: Wed, 23 Jul 2014 23:36:10 -0700 (PDT)
Subject: [rabbitmq-discuss] New Installation Rabbit MQ 3.3.4 with erl6.0
Message-ID: <1406183770500-36879.post@n5.nabble.com>

Hi Team,

 i have installed the rabbitmq 3.3.4 with erl6.0

but when i start the server it is throwing below error..
<http://rabbitmq.1065348.n5.nabble.com/file/n36879/Error.jpg> 
<http://rabbitmq.1065348.n5.nabble.com/file/n36879/Error.jpg> 

any one help me to resolve this issue..

Regards,
Dhinesh P



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/New-Installation-Rabbit-MQ-3-3-4-with-erl6-0-tp36879.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mklishin at gopivotal.com  Thu Jul 24 12:26:21 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 24 Jul 2014 15:26:21 +0400
Subject: [rabbitmq-discuss] New Installation Rabbit MQ 3.3.4 with erl6.0
In-Reply-To: <1406183770500-36879.post@n5.nabble.com>
References: <1406183770500-36879.post@n5.nabble.com>
Message-ID: <etPan.53d0ed79.6b8b4567.48b4@mercurio.local>

On 24 July 2014 at 10:50:40, Dhinesh (dhinesh.p at saint-gobain.com) wrote:
> > i have installed the rabbitmq 3.3.4 with erl6.0
>  
> but when i start the server it is throwing below error..

The link 404s for me.?
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From simon at rabbitmq.com  Thu Jul 24 12:33:12 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 24 Jul 2014 12:33:12 +0100
Subject: [rabbitmq-discuss] New Installation Rabbit MQ 3.3.4 with erl6.0
In-Reply-To: <etPan.53d0ed79.6b8b4567.48b4@mercurio.local>
References: <1406183770500-36879.post@n5.nabble.com>
 <etPan.53d0ed79.6b8b4567.48b4@mercurio.local>
Message-ID: <53D0EEF8.4000708@rabbitmq.com>

On 24/07/14 12:26, Michael Klishin wrote:
> On 24 July 2014 at 10:50:40, Dhinesh (dhinesh.p at saint-gobain.com) wrote:
>>> i have installed the rabbitmq 3.3.4 with erl6.0
>>
>> but when i start the server it is throwing below error..
>
> The link 404s for me.

You have to look at it through the nabble interface :-(

The link shows rabbitmqctl diagnostics when it can connect to the node 
via TCP but Erlang distribution isn't working.

Dhinesh: the most likely issue is that the Erlang cookie is not 
synchronised. This is particularly likely to happen when installing on 
Windows as one user then running it as another. Check the logs for where 
the server is getting the cookie, and copy it to C:\Users\Administrator.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From mklishin at gopivotal.com  Thu Jul 24 12:35:54 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 24 Jul 2014 15:35:54 +0400
Subject: [rabbitmq-discuss] New Installation Rabbit MQ 3.3.4 with erl6.0
In-Reply-To: <etPan.53d0ed79.6b8b4567.48b4@mercurio.local>
References: <1406183770500-36879.post@n5.nabble.com>
 <etPan.53d0ed79.6b8b4567.48b4@mercurio.local>
Message-ID: <etPan.53d0efb4.327b23c6.48b4@mercurio.local>

On 24 July 2014 at 15:26:54, Michael Klishin (michael at rabbitmq.com) wrote:
> > The link 404s for me.

Apparently opening the entire thread on Nable helps:
http://rabbitmq.1065348.n5.nabble.com/New-Installation-Rabbit-MQ-3-3-4-with-erl6-0-td36879.html

You already have a RabbitMQ node running on the host. You can either shut down
the existing node (e.g. the Windows service) or run another with with a different
config file and different nodename/ports.

See?http://rabbitmq.com/configure.html.

RABBITMQ_NODE_PORT (this is the port clients will connect to),?RABBITMQ_DIST_PORT,
and RABBITMQ_NODENAME are of particular interest.?
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Thu Jul 24 12:37:22 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 24 Jul 2014 15:37:22 +0400
Subject: [rabbitmq-discuss] New Installation Rabbit MQ 3.3.4 with erl6.0
In-Reply-To: <etPan.53d0efb4.327b23c6.48b4@mercurio.local>
References: <1406183770500-36879.post@n5.nabble.com>
 <etPan.53d0ed79.6b8b4567.48b4@mercurio.local>
 <etPan.53d0efb4.327b23c6.48b4@mercurio.local>
Message-ID: <etPan.53d0f00f.643c9869.48b4@mercurio.local>



On 24 July 2014 at 15:36:24, Michael Klishin (michael at rabbitmq.com) wrote:
> > You already have a RabbitMQ node running on the host. You can  
> either shut down
> the existing node (e.g. the Windows service) or run another with  
> with a different
> config file and different nodename/ports.

Looks like the real problem is the very first error from rabbitmqctl.
Feel free to ignore my suggestion about starting another node ;)?
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From simon at rabbitmq.com  Thu Jul 24 15:52:36 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 24 Jul 2014 15:52:36 +0100
Subject: [rabbitmq-discuss] rabbitmqadmin
In-Reply-To: <6DB033025329784B9280ABD9516177FCA2D1A8A8@USEPX2PMXMBX12.corp.altegrity.com>
References: <6DB033025329784B9280ABD9516177FCA2D1A8A8@USEPX2PMXMBX12.corp.altegrity.com>
Message-ID: <53D11DB4.3050607@rabbitmq.com>

On 23/07/14 18:39, Ganann, Kale wrote:
> I?ve seen some issues with deleting vhosts in earlier versions ? is that
> still an issue with this version?

http://www.rabbitmq.com/release-notes/README-3.3.0.txt:

26088 fix failure to delete virtual host if a queue in the virtual host
       is deleted concurrently (since 1.0.0) (incorrectly reported
       fixed in 3.2.4)

http://www.rabbitmq.com/release-notes/README-3.3.2.txt:

26176 prevent deadlock deleting virtual host with active federation
       link on single core machine (since 3.0.0)

Could either of those be what you're seeing?

Cheers, Simon

From KGanann at kroll.com  Thu Jul 24 18:46:36 2014
From: KGanann at kroll.com (Ganann, Kale)
Date: Thu, 24 Jul 2014 17:46:36 +0000
Subject: [rabbitmq-discuss] rabbitmqadmin
In-Reply-To: <53D11DB4.3050607@rabbitmq.com>
References: <6DB033025329784B9280ABD9516177FCA2D1A8A8@USEPX2PMXMBX12.corp.altegrity.com>
 <53D11DB4.3050607@rabbitmq.com>
Message-ID: <6DB033025329784B9280ABD9516177FCA2D1B435@USEPX2PMXMBX12.corp.altegrity.com>

Sounds more like B.  It seems to be the federation pieces I can't kill.

Thanks,
Kale


-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: Thursday, July 24, 2014 9:53 AM
To: Legacy list about RabbitMQ; Ganann, Kale
Subject: Re: [rabbitmq-discuss] rabbitmqadmin

On 23/07/14 18:39, Ganann, Kale wrote:
> I've seen some issues with deleting vhosts in earlier versions - is 
> that still an issue with this version?

http://www.rabbitmq.com/release-notes/README-3.3.0.txt:

26088 fix failure to delete virtual host if a queue in the virtual host
       is deleted concurrently (since 1.0.0) (incorrectly reported
       fixed in 3.2.4)

http://www.rabbitmq.com/release-notes/README-3.3.2.txt:

26176 prevent deadlock deleting virtual host with active federation
       link on single core machine (since 3.0.0)

Could either of those be what you're seeing?

Cheers, Simon
This communication contains information that is confidential,
proprietary in nature, and may also be attorney-client privileged
and/or work product privileged. It is for the exclusive use of the
intended recipient(s). If you are not the intended recipient(s) or
the person responsible for delivering it to the intended
recipient(s), please note that any form of dissemination,
distribution or copying of this communication is strictly
prohibited and may be unlawful. If you have received this
communication in error, please immediately notify the sender by replying
to this message and delete this email immediately. Thank you for your cooperation. 

Please be advised that neither Altegrity, its affiliates, its employees
or agents accept liability for any errors, omissions or damages
caused by delays of receipt or by any virus infection in this
message or its attachments, or which may otherwise arise as a
result of this e-mail transmission.


From mklishin at gopivotal.com  Fri Jul 25 16:48:54 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 25 Jul 2014 19:48:54 +0400
Subject: [rabbitmq-discuss] Memory leak in STOMP connector or federation?
In-Reply-To: <E9C4F1C8-BE42-4805-ACA0-50C76B450C77@bobtfish.net>
References: <C57E44EC-429B-41C1-AE34-67F28EF399AF@bobtfish.net>
 <537636A9.5050305@rabbitmq.com>
 <90E2C30E-AAEE-44D2-9145-AF0F4625D7FF@bobtfish.net>
 <537693C0.4070701@rabbitmq.com>
 <0144D4D4-273E-4A6B-9FC3-065637D82F87@bobtfish.net>
 <etPan.5376e598.643c9869.5891@mercurio.local>
 <00CABC3B-0D2F-4002-B84C-FD024393B9A3@bobtfish.net>
 <80CB475E-6F37-478C-A3B4-E4421C5314BE@bobtfish.net>
 <etPan.537c82dc.216231b.8fb9@mercurio.local>
 <etPan.537c8eac.1190cde7.8fb9@mercurio.local>
 <7CE61458-51E9-427A-962B-72B55F4E3306@bobtfish.net>
 <etPan.537c9b05.140e0f76.8fb9@mercurio.local>
 <76B39C42-9AE1-4682-9770-531BDE88A198@bobtfish.net>
 <etPan.537ca7f8.ded7263.8fb9@mercurio.local>
 <etPan.537cc04a.1befd79f.8fb9@mercurio.local>
 <E9C4F1C8-BE42-4805-ACA0-50C76B450C77@bobtfish.net>
Message-ID: <etPan.53d27c80.6b8b4567.14256@mercurio.local>

On 29 May 2014 at 17:57:32, Tomas Doran (bobtfish at bobtfish.net) wrote:
> > Sorry for going dark about this for a while - I got distracted  
> by other more major operational concerns.
>  
> The issue I?m actually seeing in production is (as far as I?ve  
> seen so far) unfortunately not reproduced by the VM I distributed  
> (even though this is AFAICT almost exactly the same config).  
>  
> I?ve done some further measurement and investigation, and I  
> attach a graph of the memory usage on one of my machines over the  
> last 8 days

Tomas,

FYI, we've identified an issue that sounds quite similar to what you've been
observing:

https://groups.google.com/forum/#!topic/rabbitmq-users/yN067q4q3TE?
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From bcliffe at gmail.com  Fri Jul 25 20:08:35 2014
From: bcliffe at gmail.com (brydev)
Date: Fri, 25 Jul 2014 12:08:35 -0700 (PDT)
Subject: [rabbitmq-discuss] MQTT plugin, QoS 1, Android,
	not consuming on reconnect
Message-ID: <1406315315443-36888.post@n5.nabble.com>

Hi,
I've implemented a Paho MQTT service in Android which is currently unable to
consume unacked messages upon reconnect to the RabbitMQ broker with MQTT
plugin. If I force the callback when the connectivity changes, it will
consume the missed messages. 

Sometimes forcing the callback will not work and the messages remain unacked
on the broker. Due to the unusual behaviour of when the message consumes
from the queue makes the service unreliable. The messages are QoS 1.

Also upon reconnect the messages will arrive as normal to the device but the
missed ones never get re-queued.

The application is currently behaving fine when receiving messages from a
mosquitto broker so am I missing any implementation?

Is this a bug or is there a setting I have possible missed for consuming
messages from my topic.

 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/MQTT-plugin-QoS-1-Android-not-consuming-on-reconnect-tp36888.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From not.drew.stevens at gmail.com  Fri Jul 25 20:34:59 2014
From: not.drew.stevens at gmail.com (Not Drew Stevens)
Date: Fri, 25 Jul 2014 12:34:59 -0700
Subject: [rabbitmq-discuss] cluster node "stuck" during start
Message-ID: <53D2B163.7010802@gmail.com>

When a RabbitMQ cluster node starts back up after a server reboot, we
have experienced (more than a few) cases where the RabbitMQ server on
the node does not completely start.

This condition persisted even if the rabbit processes were killed and
rabbit manually restarted.

The only way to get the server to start required a node reset (or
explicit deletion of the mnesia database)

Are there any suggestions about how to handle this without losing the
state of the node?

The system process list looked like this:

# ps aux | grep rabbit
rabbitmq  1005  0.0  0.0   9888  2788 ?        S    Jun13   1:01
/usr/lib/erlang/erts-5.10.2/bin/epmd -daemon
root     15746  0.0  0.0  11232  1708 pts/3    S+   23:26   0:00 /bin/sh
/etc/init.d/rabbitmq-server start
root     15797  0.0  0.0  11036  1468 pts/3    S+   23:26   0:00 /bin/sh
/usr/sbin/rabbitmqctl wait /var/run/rabbitmq/pid
rabbitmq 15799  0.0  0.0  11036  1424 ?        S    23:26   0:00 /bin/sh
/usr/sbin/rabbitmq-server
rabbitmq 15807  3.1  1.2 599876 47728 ?        Sl   23:26   0:03
/usr/lib/erlang/erts-5.10.2/bin/beam -W w -K true -A30 -P 1048576 --
-root /usr/lib/erlang -progname erl -- -home /var/lib/rabbitmq -- -pa
/usr/lib/rabbitmq/lib/rabbitmq_server-3.2.1/sbin/../ebin -noshell
-noinput -s rabbit boot -sname rabbit at my-rmq-server -boot start_sasl
-config /etc/rabbitmq/rabbitmq -kernel inet_default_connect_options
[{nodelay,true}] -sasl errlog_type error -sasl sasl_error_logger false
-rabbit error_logger {file,"/var/log/rabbitmq/rabbit at my-rmq-server.log"}
-rabbit sasl_error_logger
{file,"/var/log/rabbitmq/rabbit at my-rmq-server-sasl.log"} -rabbit
enabled_plugins_file "/etc/rabbitmq/enabled_plugins" rabbit plugins_dir
"/usr/lib/rabbitmq/lib/rabbitmq_server-3.2.1/sbin/../plugins" -rabbit
plugins_expand_dir
"/var/lib/rabbitmq/mnesia/rabbit at my-rmq-server-plugins-expand" -os_mon
start_cpu_sup false -os_mon start_disksup false -os_mon start_memsup
false -mnesia dir "/var/lib/rabbitmq/mnesia/rabbit at my-rmq-server"
rabbitmq 15814  0.0  0.0  94432  2636 pts/3    S+   23:26   0:00 su
rabbitmq -s /bin/sh -c /usr/lib/rabbitmq/bin/rabbitmqctl  "wait"
"/var/run/rabbitmq/pid"
rabbitmq 15819  0.2  0.3 106624 14008 pts/3    Sl+  23:26   0:00
/usr/lib/erlang/erts-5.10.2/bin/beam -- -root /usr/lib/erlang -progname
erl -- -home /var/lib/rabbitmq -- -pa
/usr/lib/rabbitmq/lib/rabbitmq_server-3.2.1/sbin/../ebin -noshell
-noinput -hidden -sname rabbitmqctl15819 -boot start_clean -s
rabbit_control_main -nodename rabbit at my-rmq-server -extra wait
/var/run/rabbitmq/pid

This RabbitMQ node showed as an "up" node in the Nodes list in the
management console of another node in the cluster.

Also, rabbitmqctl returned some results:


# rabbitmqctl status
Status of node 'rabbit at my-rmq-server' ...
[{pid,1114},
 {running_applications,
     [{os_mon,"CPO  CXC 138 46","2.2.12"},
      {inets,"INETS  CXC 138 49","5.9.5"},
      {mnesia,"MNESIA  CXC 138 12","4.9"},
      {amqp_client,"RabbitMQ AMQP Client","3.2.1"},
      {rabbitmq_auth_mechanism_ssl,
          "RabbitMQ SSL authentication (SASL EXTERNAL)","3.2.1"},
      {xmerl,"XML parser","1.3.3"},
      {eldap,"Ldap api","1.0.1"},
      {rfc4627_jsonrpc,"JSON RPC Service","3.2.1-git5e67120"},
      {sasl,"SASL  CXC 138 11","2.3.2"},
      {stdlib,"ERTS  CXC 138 10","1.19.2"},
      {kernel,"ERTS  CXC 138 10","2.16.2"}]},
 {os,{unix,linux}},
 {erlang_version,
     "Erlang R16B01 (erts-5.10.2) [source-bdf5300] [64-bit] [smp:2:2]
[async-threads:30] [hipe] [kernel-poll:true]\n"},
 {memory,
     [{total,44596672},
      {connection_procs,2808},
      {queue_procs,0},
      {plugins,8464},
      {other_proc,15751480},
      {mnesia,1191152},
      {mgmt_db,0},
      {msg_index,0},
      {other_ets,1235896},
      {binary,716136},
      {code,20445199},
      {atom,711569},
      {other_system,4533968}]},
 {file_descriptors,
    
[{total_limit,924},{total_used,0},{sockets_limit,829},{sockets_used,0}]},
 {processes,[{limit,1048576},{used,105}]},
 {run_queue,0},
 {uptime,271}]
...done.

The startup log and rabbitmq log indicated that the node had started to
start up

# cat startup_log

              RabbitMQ 3.2.1. Copyright (C) 2007-2013 GoPivotal, Inc.
  ##  ##      Licensed under the MPL.  See http://www.rabbitmq.com/
  ##  ##
  ##########  Logs: /var/log/rabbitmq/rabbit at my-rmq-server.log
  ######  ##        /var/log/rabbitmq/rabbit at my-rmq-server-sasl.log
  ##########
              Starting broker...


# cat rabbit at my-rmq-server.log

=INFO REPORT==== 25-Jul-2014::17:18:21 ===
Starting RabbitMQ 3.2.1 on Erlang R16B01
Copyright (C) 2007-2013 GoPivotal, Inc.
Licensed under the MPL.  See http://www.rabbitmq.com/

=INFO REPORT==== 25-Jul-2014::17:18:21 ===
node           : rabbit at my-rmq-server
home dir       : /var/lib/rabbitmq
config file(s) : /etc/rabbitmq/rabbitmq.config
cookie hash    : WmWI9mzuXn9u47LQDipY3g==
log            : /var/log/rabbitmq/rabbit at my-rmq-server.log
sasl log       : /var/log/rabbitmq/rabbit at my-rmq-server-sasl.log
database dir   : /var/lib/rabbitmq/mnesia/rabbit at my-rmq-server

=INFO REPORT==== 25-Jul-2014::17:18:23 ===
Limiting to approx 924 file handles (829 sockets)
root at my-rmq-server:/var/log/rabbitmq#


Some time had passed without any activity to either the logs, or files
in the mnesia database

# date
Fri Jul 25 17:23:56 UTC 2014


# ls -lt /var/lib/rabbitmq/mnesia/rabbit at my-rmq-server
total 148
-rw-r--r--   1 rabbitmq rabbitmq   271 Jul 25 17:21 DECISION_TAB.LOG
-rw-r--r--   1 rabbitmq rabbitmq   102 Jul 25 17:21 LATEST.LOG
-rw-r--r--   1 rabbitmq rabbitmq   171 Jul 25 17:18
nodes_running_at_shutdown
-rw-r--r--   1 rabbitmq rabbitmq   317 Jul 25 17:18 cluster_nodes.config
-rw-r--r--   1 rabbitmq rabbitmq   137 Jul 25 17:18 rabbit_vhost.DCD
-rw-r--r--   1 rabbitmq rabbitmq   640 Jul 25 17:18 rabbit_user.DCD
-rw-r--r--   1 rabbitmq rabbitmq 10207 Jul 25 17:18
rabbit_runtime_parameters.DCD
-rw-r--r--   1 rabbitmq rabbitmq 20423 Jul 25 17:18 rabbit_durable_route.DCD
-rw-r--r--   1 rabbitmq rabbitmq 21020 Jul 25 17:18 rabbit_durable_queue.DCD
-rw-r--r--   1 rabbitmq rabbitmq  2724 Jul 25 17:18
rabbit_durable_exchange.DCD
-rw-r--r--   1 rabbitmq rabbitmq   850 Jul 25 17:18
rabbit_user_permission.DCD
drwxr-xr-x   2 rabbitmq rabbitmq  4096 Jul 25 17:16 msg_store_transient
drwxr-xr-x   2 rabbitmq rabbitmq  4096 Jul 25 17:16 msg_store_persistent
drwxr-xr-x 170 rabbitmq rabbitmq 12288 Jul 25 17:16 queues
-rw-r--r--   1 rabbitmq rabbitmq 28983 Jul 24 23:35 schema.DAT
-rw-r--r--   1 rabbitmq rabbitmq     3 Jun 13 09:41 rabbit_serial
-rw-r--r--   1 rabbitmq rabbitmq   238 Jun 13 09:41 schema_version











-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140725/b13b9278/attachment.html>

From mklishin at gopivotal.com  Fri Jul 25 20:41:28 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 25 Jul 2014 23:41:28 +0400
Subject: [rabbitmq-discuss] MQTT plugin, QoS 1, Android,
 not consuming on reconnect
In-Reply-To: <1406315315443-36888.post@n5.nabble.com>
References: <1406315315443-36888.post@n5.nabble.com>
Message-ID: <etPan.53d2b306.6b8b4567.1552e@mercurio.local>

On 25 July 2014 at 23:09:44, brydev (bcliffe at gmail.com) wrote:
> > I've implemented a Paho MQTT service in Android which is currently 
> unable to
> consume unacked messages upon reconnect to the RabbitMQ broker 
> with MQTT
> plugin. If I force the callback when the connectivity changes, 
> it will
> consume the missed messages.
> 
> Sometimes forcing the callback will not work and the messages 
> remain unacked
> on the broker. Due to the unusual behaviour of when the message 
> consumes
> from the queue makes the service unreliable. The messages are 
> QoS 1.

What do you mean by "forcing the callback"?

> Also upon reconnect the messages will arrive as normal to the 
> device but the
> missed ones never get re-queued.
> 
> The application is currently behaving fine when receiving messages 
> from a
> mosquitto broker so am I missing any implementation?
> 
> Is this a bug or is there a setting I have possible missed for consuming 
> messages from my topic.

Can you post some example code that demonstrates the issue? What's in RabbitMQ log
files?
-- 
MK 

Staff Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Fri Jul 25 20:45:31 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 25 Jul 2014 23:45:31 +0400
Subject: [rabbitmq-discuss] cluster node "stuck" during start
In-Reply-To: <53D2B163.7010802@gmail.com>
References: <53D2B163.7010802@gmail.com>
Message-ID: <etPan.53d2b3f6.327b23c6.1552e@mercurio.local>

?On 25 July 2014 at 23:37:17, Not Drew Stevens (not.drew.stevens at gmail.com) wrote:
> > When a RabbitMQ cluster node starts back up after a server reboot,  
> we have experienced (more than a few) cases where the RabbitMQ  
> server on the node does not completely start.
>  
> This condition persisted even if the rabbit processes were killed  
> and rabbit manually restarted.

What do you mean by "does not completely start"?

> {file_descriptors,
> [{total_limit,924},{total_used,0},{sockets_limit,829},{sockets_used,0}]},  

This is a really low limit. I can think of one scenario:

?* ulimit -n was set to a high value manually but not via /etc
?* You have over 1000 queues
?* Node rebooted, ulimit -n was reset
?* RabbitMQ tried to recover durable queues and persistent messages and runs out of file descriptors
? ?in the process

Please bump ulimit -n for the rabbitmq user to 50K and try reproducing the issue.
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From bcliffe at gmail.com  Fri Jul 25 20:53:25 2014
From: bcliffe at gmail.com (brydev)
Date: Fri, 25 Jul 2014 12:53:25 -0700 (PDT)
Subject: [rabbitmq-discuss] MQTT plugin, QoS 1, Android,
	not consuming on reconnect
In-Reply-To: <etPan.53d2b306.6b8b4567.1552e@mercurio.local>
References: <1406315315443-36888.post@n5.nabble.com>
 <etPan.53d2b306.6b8b4567.1552e@mercurio.local>
Message-ID: <CAD34VhOqqvcy8HE3vpBWWc_kp-Mi1hP1vmavY8CedEyds9-oMg@mail.gmail.com>

So the log just has this output from the time of testing,
=INFO REPORT==== 25-Jul-2014::17:08:37 ===
closing AMQP connection <0.447.0> (127.0.0.1:49407 -> 127.0.0.1:5672)

=INFO REPORT==== 25-Jul-2014::17:08:50 ===
accepting MQTT connection (217.114.169.247:50777 -> 143.239.72.239:1883)

=WARNING REPORT==== 25-Jul-2014::17:08:50 ===
MQTT disconnecting duplicate client id "sub1_19c6ee855806c472" ("
10.144.103.154:40335 -> 143.239.72.239:1883")

This gets called after a disconnect, if I call
mClient.setCallback(MqttService.this); it forces the message queue onto the
device but it only works sometimes, usually only on a fresh start.

try {
mClient = new MqttClient(url,mDeviceId,mMemStore);
} catch (MqttException e1) {
// TODO Auto-generated catch block
e1.printStackTrace();
}
mConnHandler.post(new Runnable() {
@Override
public void run() {
try {
mClient.connect(mOpts);

mClient.subscribe("hello.alert", 1);


mClient.setCallback(MqttService.this);


mStarted = true;

startKeepAlives();
} catch(MqttException e) {
e.printStackTrace();
}
}
});
}

Thanks


On Fri, Jul 25, 2014 at 8:43 PM, Michael Klishin-2 [via RabbitMQ] <
ml-node+s1065348n36890h53 at n5.nabble.com> wrote:

> On 25 July 2014 at 23:09:44, brydev ([hidden email]
> <http://user/SendEmail.jtp?type=node&node=36890&i=0>) wrote:
>
> > > I've implemented a Paho MQTT service in Android which is currently
> > unable to
> > consume unacked messages upon reconnect to the RabbitMQ broker
> > with MQTT
> > plugin. If I force the callback when the connectivity changes,
> > it will
> > consume the missed messages.
> >
> > Sometimes forcing the callback will not work and the messages
> > remain unacked
> > on the broker. Due to the unusual behaviour of when the message
> > consumes
> > from the queue makes the service unreliable. The messages are
> > QoS 1.
>
> What do you mean by "forcing the callback"?
>
> > Also upon reconnect the messages will arrive as normal to the
> > device but the
> > missed ones never get re-queued.
> >
> > The application is currently behaving fine when receiving messages
> > from a
> > mosquitto broker so am I missing any implementation?
> >
> > Is this a bug or is there a setting I have possible missed for consuming
> > messages from my topic.
>
> Can you post some example code that demonstrates the issue? What's in
> RabbitMQ log
> files?
> --
> MK
>
> Staff Software Engineer, Pivotal/RabbitMQ
> _______________________________________________
> rabbitmq-discuss mailing list has moved to
> https://groups.google.com/forum/#!forum/rabbitmq-users,
> please subscribe to the new list!
>
> [hidden email] <http://user/SendEmail.jtp?type=node&node=36890&i=1>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> ------------------------------
>  If you reply to this email, your message will be added to the discussion
> below:
>
> http://rabbitmq.1065348.n5.nabble.com/MQTT-plugin-QoS-1-Android-not-consuming-on-reconnect-tp36888p36890.html
>  To unsubscribe from MQTT plugin, QoS 1, Android, not consuming on
> reconnect, click here
> <http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=36888&code=YmNsaWZmZUBnbWFpbC5jb218MzY4ODh8MTQ1NzU4Njg1Mg==>
> .
> NAML
> <http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml>
>




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/MQTT-plugin-QoS-1-Android-not-consuming-on-reconnect-tp36888p36892.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140725/38082bb0/attachment.html>

From mklishin at gopivotal.com  Fri Jul 25 20:55:27 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 25 Jul 2014 23:55:27 +0400
Subject: [rabbitmq-discuss] cluster node "stuck" during start
In-Reply-To: <53D2B163.7010802@gmail.com>
References: <53D2B163.7010802@gmail.com>
Message-ID: <etPan.53d2b648.643c9869.1552e@mercurio.local>

On 25 July 2014 at 23:37:17, Not Drew Stevens (not.drew.stevens at gmail.com) wrote:
> > # cat startup_log
>  
> RabbitMQ 3.2.1. Copyright (C) 2007-2013

So, this is with 3.2.1.?

> # cat rabbit at my-rmq-server.log(mailto:rabbit at my-rmq-server.log)  
>  
> =INFO REPORT==== 25-Jul-2014(http://airmail.calendar/2014-07-25%2012:00:00%20GMT+4)::17:18:21  
> ===
> Starting RabbitMQ 3.2.1 on Erlang R16B01
> Copyright (C) 2007-2013(tel://(C)%202007-2013) GoPivotal,  
> Inc.
> Licensed under the MPL. See http://www.rabbitmq.com/
>  
> =INFO REPORT==== 25-Jul-2014(http://airmail.calendar/2014-07-25%2012:00:00%20GMT+4)::17:18:21  
> ===
> node : rabbit at my-rmq-server
> home dir : /var/lib/rabbitmq
> config file(s) : /etc/rabbitmq/rabbitmq.config
> cookie hash : WmWI9mzuXn9u47LQDipY3g==
> log : /var/log/rabbitmq/rabbit at my-rmq-server.log(mailto:var/log/rabbitmq/rabbit at my-rmq-server.log)  
> sasl log : /var/log/rabbitmq/rabbit at my-rmq-server-sasl.log(mailto:var/log/rabbitmq/rabbit at my-rmq-server-sasl.log)  
> database dir : /var/lib/rabbitmq/mnesia/rabbit at my-rmq-server  
>  
> =INFO REPORT==== 25-Jul-2014(http://airmail.calendar/2014-07-25%2012:00:00%20GMT+4)::17:18:23  
> ===
> Limiting to approx 924 file handles (829 sockets)
> root at my-rmq-server:/var/log/rabbitmq#
>  
>  
> Some time had passed without any activity to either the logs,  
> or files in the mnesia database

This looks like bug?25873, fixed in 3.2.2:

http://www.rabbitmq.com/release-notes/README-3.2.2.txt

and I recall an issue that lead to RabbitMQ taking an unreasonably long time
to start.

Can you please try 3.3.4?
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Fri Jul 25 20:59:11 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 25 Jul 2014 23:59:11 +0400
Subject: [rabbitmq-discuss] MQTT plugin, QoS 1, Android,
 not consuming on reconnect
In-Reply-To: <CAD34VhOqqvcy8HE3vpBWWc_kp-Mi1hP1vmavY8CedEyds9-oMg@mail.gmail.com>
References: <1406315315443-36888.post@n5.nabble.com>
 <etPan.53d2b306.6b8b4567.1552e@mercurio.local>
 <CAD34VhOqqvcy8HE3vpBWWc_kp-Mi1hP1vmavY8CedEyds9-oMg@mail.gmail.com>
Message-ID: <etPan.53d2b72c.66334873.1552e@mercurio.local>

?On 25 July 2014 at 23:54:35, brydev (bcliffe at gmail.com) wrote:
> > =WARNING REPORT==== 25-Jul-2014::17:08:50  
> ===
> MQTT disconnecting duplicate client id "sub1_19c6ee855806c472"  
> ("10.144.103.154:40335(http://10.144.103.154:40335)  
> -> 143.239.72.239:1883(http://143.239.72.239:1883)")  
>  
>  
> This gets called after a disconnect, if I call mClient.setCallback(MqttService.this);  
> it forces the message queue onto the device but it only works sometimes,  
> usually only on a fresh start.

So if I understand it correctly, when a client (Paho Java) loses connection,
you get no deliveries for re-registered subscription with the same client id,
but creating a completely new connection with the same client id makes
things work some of the time?

MQTT spec requires brokers to disconnect existing clients with the same client ID
when handling CONNECT:

?If a client with the same Client ID is already connected to the server, the "older" client
must be disconnected by the server before completing the CONNECT flow of the new
client.?

So I'm curious if the issue may have something to do with lost connections not being
detected fast enough.

How do you simulate lost client connections? What [MQTT] heartbeat value do you use?
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Fri Jul 25 21:22:57 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Sat, 26 Jul 2014 00:22:57 +0400
Subject: [rabbitmq-discuss] MQTT plugin, QoS 1, Android,
 not consuming on reconnect
In-Reply-To: <CAD34VhO3uY9kxF8LdziZR_Bs-9W6Qrxeai4pZ=skvZX=8Vu70Q@mail.gmail.com>
References: <1406315315443-36888.post@n5.nabble.com>
 <etPan.53d2b306.6b8b4567.1552e@mercurio.local>
 <CAD34VhOqqvcy8HE3vpBWWc_kp-Mi1hP1vmavY8CedEyds9-oMg@mail.gmail.com>
 <etPan.53d2b72c.66334873.1552e@mercurio.local>
 <CAD34VhO3uY9kxF8LdziZR_Bs-9W6Qrxeai4pZ=skvZX=8Vu70Q@mail.gmail.com>
Message-ID: <etPan.53d2bcbf.74b0dc51.1552e@mercurio.local>

+rabbitmq-discuss

On 26 July 2014 at 00:18:32, Bryan Cliffe (bcliffe at gmail.com) wrote:
> > I'm disconnecting from wifi and reconnecting through cellular 
> to test the robustness of the connection when the I.P changes. 
> I wanted to see how the paho java client would handle message delivery 
> on QoS 1 to Android. I'm then filling the queue during the handover 
> phase and I can't consume on reconnect. I'm using two different 
> values for the heartbeat which is 240000ms and 30000ms but I'm 
> having the same problem with both. It would be interesting if 
> it's not detecting the change over from wifi to cellular.

I'm not familiar with how exactly switching from WiFi to cellular data affects
TCP connections on Android but in general, this is exactly the kind of issue
heartbeats in MQTT are for.

Try using a value of 5-10 seconds. I'm all for improving RabbitMQ MQTT plugin
for this case but if Rabbit doesn't get a notification from the OS that the peer
disconnected, a low heartbeat interval is the only possible solution.
-- 
MK 

Staff Software Engineer, Pivotal/RabbitMQ

From bobtfish at bobtfish.net  Fri Jul 25 21:37:10 2014
From: bobtfish at bobtfish.net (Tomas Doran)
Date: Fri, 25 Jul 2014 13:37:10 -0700
Subject: [rabbitmq-discuss] Memory leak in STOMP connector or federation?
In-Reply-To: <etPan.53d27c80.6b8b4567.14256@mercurio.local>
References: <C57E44EC-429B-41C1-AE34-67F28EF399AF@bobtfish.net>
 <537636A9.5050305@rabbitmq.com>
 <90E2C30E-AAEE-44D2-9145-AF0F4625D7FF@bobtfish.net>
 <537693C0.4070701@rabbitmq.com>
 <0144D4D4-273E-4A6B-9FC3-065637D82F87@bobtfish.net>
 <etPan.5376e598.643c9869.5891@mercurio.local>
 <00CABC3B-0D2F-4002-B84C-FD024393B9A3@bobtfish.net>
 <80CB475E-6F37-478C-A3B4-E4421C5314BE@bobtfish.net>
 <etPan.537c82dc.216231b.8fb9@mercurio.local>
 <etPan.537c8eac.1190cde7.8fb9@mercurio.local>
 <7CE61458-51E9-427A-962B-72B55F4E3306@bobtfish.net>
 <etPan.537c9b05.140e0f76.8fb9@mercurio.local>
 <76B39C42-9AE1-4682-9770-531BDE88A198@bobtfish.net>
 <etPan.537ca7f8.ded7263.8fb9@mercurio.local>
 <etPan.537cc04a.1befd79f.8fb9@mercurio.local>
 <E9C4F1C8-BE42-4805-ACA0-50C76B450C77@bobtfish.net>
 <etPan.53d27c80.6b8b4567.14256@mercurio.local>
Message-ID: <146C7FB3-A46A-44C4-8E9F-B37AD27F6A3B@bobtfish.net>


On Jul 25, 2014, at 8:48 AM, Michael Klishin <mklishin at gopivotal.com> wrote:
> 
> FYI, we've identified an issue that sounds quite similar to what you've been
> observing:
> 
> https://groups.google.com/forum/#!topic/rabbitmq-users/yN067q4q3TE 

Awesome, thank you for following up!

I made some changes to the way we do a lot of our messaging which massively helped our memory problems, however I will loop back next week to see if I can reproduce my original problem (and verify that the suggested fixes/workarounds also apply to my case).

Cheers
Tom



From bcliffe at gmail.com  Fri Jul 25 21:54:37 2014
From: bcliffe at gmail.com (brydev)
Date: Fri, 25 Jul 2014 13:54:37 -0700 (PDT)
Subject: [rabbitmq-discuss] MQTT plugin, QoS 1, Android,
	not consuming on reconnect
In-Reply-To: <etPan.53d2bcbf.74b0dc51.1552e@mercurio.local>
References: <1406315315443-36888.post@n5.nabble.com>
 <etPan.53d2b306.6b8b4567.1552e@mercurio.local>
 <CAD34VhOqqvcy8HE3vpBWWc_kp-Mi1hP1vmavY8CedEyds9-oMg@mail.gmail.com>
 <etPan.53d2b72c.66334873.1552e@mercurio.local>
 <etPan.53d2bcbf.74b0dc51.1552e@mercurio.local>
Message-ID: <CAD34VhNqK6Tymgw+oAuTmniKvyeRe0Ya08acVmLqWzhnaWBjKw@mail.gmail.com>

Thanks for the help in understanding the issue better.

I won't be testing again for a few days so I will let you know how the 5 -
10 sec heartbeat works out.


On Fri, Jul 25, 2014 at 9:24 PM, Michael Klishin-2 [via RabbitMQ] <
ml-node+s1065348n36895h8 at n5.nabble.com> wrote:

> +rabbitmq-discuss
>
> On 26 July 2014 at 00:18:32, Bryan Cliffe ([hidden email]
> <http://user/SendEmail.jtp?type=node&node=36895&i=0>) wrote:
> > > I'm disconnecting from wifi and reconnecting through cellular
> > to test the robustness of the connection when the I.P changes.
> > I wanted to see how the paho java client would handle message delivery
> > on QoS 1 to Android. I'm then filling the queue during the handover
> > phase and I can't consume on reconnect. I'm using two different
> > values for the heartbeat which is 240000ms and 30000ms but I'm
> > having the same problem with both. It would be interesting if
> > it's not detecting the change over from wifi to cellular.
>
> I'm not familiar with how exactly switching from WiFi to cellular data
> affects
> TCP connections on Android but in general, this is exactly the kind of
> issue
> heartbeats in MQTT are for.
>
> Try using a value of 5-10 seconds. I'm all for improving RabbitMQ MQTT
> plugin
> for this case but if Rabbit doesn't get a notification from the OS that
> the peer
> disconnected, a low heartbeat interval is the only possible solution.
> --
> MK
>
> Staff Software Engineer, Pivotal/RabbitMQ
> _______________________________________________
> rabbitmq-discuss mailing list has moved to
> https://groups.google.com/forum/#!forum/rabbitmq-users,
> please subscribe to the new list!
>
> [hidden email] <http://user/SendEmail.jtp?type=node&node=36895&i=1>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> ------------------------------
>  If you reply to this email, your message will be added to the discussion
> below:
>
> http://rabbitmq.1065348.n5.nabble.com/MQTT-plugin-QoS-1-Android-not-consuming-on-reconnect-tp36888p36895.html
>  To unsubscribe from MQTT plugin, QoS 1, Android, not consuming on
> reconnect, click here
> <http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=36888&code=YmNsaWZmZUBnbWFpbC5jb218MzY4ODh8MTQ1NzU4Njg1Mg==>
> .
> NAML
> <http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml>
>




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/MQTT-plugin-QoS-1-Android-not-consuming-on-reconnect-tp36888p36897.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140725/eb404283/attachment.html>

From scott.kendall.mcfadden at gmail.com  Sat Jul 26 23:02:18 2014
From: scott.kendall.mcfadden at gmail.com (Scott McFadden)
Date: Sat, 26 Jul 2014 15:02:18 -0700 (PDT)
Subject: [rabbitmq-discuss] .NET RabbitMQ.Client version?
Message-ID: <4a9bc514-b625-4563-8e28-d0b167985d9f@googlegroups.com>

We currently use .NET RabbitMQ.Client 3.3.0 along with 3.3.0 rabbit mq 
server.   Does .NET RabbitMQ.Client version have to exactly match the 
rabbit mq server version or is there version tolerance?

Is there a list of  changes / enhancements between rabbit server versions?


scott



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140726/d334a504/attachment.html>

From mklishin at gopivotal.com  Sat Jul 26 23:57:05 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Sun, 27 Jul 2014 02:57:05 +0400
Subject: [rabbitmq-discuss] .NET RabbitMQ.Client version?
In-Reply-To: <4a9bc514-b625-4563-8e28-d0b167985d9f@googlegroups.com>
References: <4a9bc514-b625-4563-8e28-d0b167985d9f@googlegroups.com>
Message-ID: <etPan.53d4325f.6b8b4567.cf3e@mercurio.local>



On 27 July 2014 at 02:04:30, Scott McFadden (scott.kendall.mcfadden at gmail.com) wrote:
> > We currently use .NET RabbitMQ.Client 3.3.0 along with 3.3.0 
> rabbit mq server. Does .NET RabbitMQ.Client version have to 
> exactly match the rabbit mq server version or is there version 
> tolerance?

Any 3.x client requires RabbitMQ server 2.0+. The versions don't have to match exactly.

> Is there a list of changes / enhancements between rabbit server 
> versions?

http://rabbitmq.com/changelog.html
-- 
MK 

Staff Software Engineer, Pivotal/RabbitMQ

From bra at fsn.hu  Sun Jul 27 12:53:23 2014
From: bra at fsn.hu (Nagy, Attila)
Date: Sun, 27 Jul 2014 13:53:23 +0200
Subject: [rabbitmq-discuss] Confirmation IDs
Message-ID: <53D4E833.7070801@fsn.hu>

Hi,

According to https://www.rabbitmq.com/confirms.html:
"Once a channel is in confirm mode, both the broker and the client count 
messages (counting starts at 1 on the first confirm.select)."

Which seems to be easy for the first sight, but I think it may 
unnecessarily increase complexity on the client side.

My case: I process a file, containing multiple records. I do this in a 
FIFO manner: reading the file from its head towards its tail, sending 
each record with AMQP and waiting for confirms.
The problem here is that I have to keep a local delivery tag to file 
pointer table, so I know which delivery tag means which file pointer.

I think it would be much easier and flexible if the confirmation system 
would allow data to be "inherited" from the original message, like its 
properties or headers.
Something like receipts in STOMP.

That way the state information would be in the broker and the client 
code would be clearer.

What do you think?

From bcliffe at gmail.com  Sun Jul 27 14:06:07 2014
From: bcliffe at gmail.com (brydev)
Date: Sun, 27 Jul 2014 06:06:07 -0700 (PDT)
Subject: [rabbitmq-discuss] MQTT plugin, QoS 1, Android,
	not consuming on reconnect
In-Reply-To: <etPan.53d2bcbf.74b0dc51.1552e@mercurio.local>
References: <1406315315443-36888.post@n5.nabble.com>
 <etPan.53d2b306.6b8b4567.1552e@mercurio.local>
 <CAD34VhOqqvcy8HE3vpBWWc_kp-Mi1hP1vmavY8CedEyds9-oMg@mail.gmail.com>
 <etPan.53d2b72c.66334873.1552e@mercurio.local>
 <etPan.53d2bcbf.74b0dc51.1552e@mercurio.local>
Message-ID: <1406466367573-36902.post@n5.nabble.com>

I have tested the lower heartbeat interval, having it as low as 1 second but
the RabbitMQ broker is still disconnecting the new connection after an
attempt in reconnect. Having a heartbeat interval this low also affects the
power usage on the device. I was wondering maybe a possible solution could
be a policy whereby if there is a duplicate connection attempt on the broker
to then disconnect the oldest connection. Would this cause security issues?
But in an environment where the nature of a mobile device is to change
between I.P's regularly require this set up?

Anyway thanks again



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/MQTT-plugin-QoS-1-Android-not-consuming-on-reconnect-tp36888p36902.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mklishin at gopivotal.com  Sun Jul 27 15:23:14 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Sun, 27 Jul 2014 18:23:14 +0400
Subject: [rabbitmq-discuss] MQTT plugin, QoS 1, Android,
 not consuming on reconnect
In-Reply-To: <1406466367573-36902.post@n5.nabble.com>
References: <1406315315443-36888.post@n5.nabble.com>
 <etPan.53d2b306.6b8b4567.1552e@mercurio.local>
 <CAD34VhOqqvcy8HE3vpBWWc_kp-Mi1hP1vmavY8CedEyds9-oMg@mail.gmail.com>
 <etPan.53d2b72c.66334873.1552e@mercurio.local>
 <etPan.53d2bcbf.74b0dc51.1552e@mercurio.local>
 <1406466367573-36902.post@n5.nabble.com>
Message-ID: <etPan.53d50b6c.327b23c6.cf3e@mercurio.local>



On 27 July 2014 at 17:07:14, brydev (bcliffe at gmail.com) wrote:
> > I have tested the lower heartbeat interval, having it as low  
> as 1 second but
> the RabbitMQ broker is still disconnecting the new connection  
> after an
> attempt in reconnect. Having a heartbeat interval this low also  
> affects the
> power usage on the device. I was wondering maybe a possible solution  
> could
> be a policy whereby if there is a duplicate connection attempt  
> on the broker
> to then disconnect the oldest connection.

MQTT 3.1 requires brokers to disconnect an old connection with the same
client id but (as I understand it) only after successful authentication.

Are you saying that it's not what you're observing??
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Sun Jul 27 15:25:46 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Sun, 27 Jul 2014 18:25:46 +0400
Subject: [rabbitmq-discuss] Confirmation IDs
In-Reply-To: <53D4E833.7070801@fsn.hu>
References: <53D4E833.7070801@fsn.hu>
Message-ID: <etPan.53d50c06.643c9869.cf3e@mercurio.local>

On 27 July 2014 at 15:54:44, Nagy, Attila (bra at fsn.hu) wrote:
> > My case: I process a file, containing multiple records. I do  
> this in a
> FIFO manner: reading the file from its head towards its tail,  
> sending
> each record with AMQP and waiting for confirms.
> The problem here is that I have to keep a local delivery tag to file  
> pointer table, so I know which delivery tag means which file pointer.  

Yes, you need to correlate messages with delivery tags.

> I think it would be much easier and flexible if the confirmation  
> system
> would allow data to be "inherited" from the original message,  
> like its
> properties or headers.

So, calculated from the message? That won't work very well if you publish
exactly the same message N times in a row.

Either way, it is probably too late to change how publisher confirms work.
We can't just break things for all the existing users out there.?
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From bcliffe at gmail.com  Sun Jul 27 15:35:03 2014
From: bcliffe at gmail.com (brydev)
Date: Sun, 27 Jul 2014 07:35:03 -0700 (PDT)
Subject: [rabbitmq-discuss] MQTT plugin, QoS 1, Android,
	not consuming on reconnect
In-Reply-To: <etPan.53d50b6c.327b23c6.cf3e@mercurio.local>
References: <1406315315443-36888.post@n5.nabble.com>
 <etPan.53d2b306.6b8b4567.1552e@mercurio.local>
 <CAD34VhOqqvcy8HE3vpBWWc_kp-Mi1hP1vmavY8CedEyds9-oMg@mail.gmail.com>
 <etPan.53d2b72c.66334873.1552e@mercurio.local>
 <etPan.53d2bcbf.74b0dc51.1552e@mercurio.local>
 <1406466367573-36902.post@n5.nabble.com>
 <etPan.53d50b6c.327b23c6.cf3e@mercurio.local>
Message-ID: <CAD34VhPCTcCOzOzNr1KtpG3HBkGUXKQACJ9ye_7DETRjF0A--w@mail.gmail.com>

The service on the application is unable to reconnect again after the
duplicate id is detected. It reconnects sometimes but if it does it doesn't
consume the missed messages on the queue. The log doesn't give me anything
else besides duplicate client id disconnected. And my device is throwing
the following error on loop and is unable to reconnect.

private boolean isConnected() {
if(mStarted && mClient != null && !mClient.isConnected()) {
Log.i(DEBUG_TAG,"Mismatch between what we think is connected and what is
connected");
}

So I can't tell if the old, new or both connections are disconnected from
the broker.


On Sun, Jul 27, 2014 at 3:25 PM, Michael Klishin-2 [via RabbitMQ] <
ml-node+s1065348n36903h56 at n5.nabble.com> wrote:

>
>
> On 27 July 2014 at 17:07:14, brydev ([hidden email]
> <http://user/SendEmail.jtp?type=node&node=36903&i=0>) wrote:
>
> > > I have tested the lower heartbeat interval, having it as low
> > as 1 second but
> > the RabbitMQ broker is still disconnecting the new connection
> > after an
> > attempt in reconnect. Having a heartbeat interval this low also
> > affects the
> > power usage on the device. I was wondering maybe a possible solution
> > could
> > be a policy whereby if there is a duplicate connection attempt
> > on the broker
> > to then disconnect the oldest connection.
>
> MQTT 3.1 requires brokers to disconnect an old connection with the same
> client id but (as I understand it) only after successful authentication.
>
> Are you saying that it's not what you're observing?
> --
> MK
>
> Staff Software Engineer, Pivotal/RabbitMQ
> _______________________________________________
> rabbitmq-discuss mailing list has moved to
> https://groups.google.com/forum/#!forum/rabbitmq-users,
> please subscribe to the new list!
>
> [hidden email] <http://user/SendEmail.jtp?type=node&node=36903&i=1>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> ------------------------------
>  If you reply to this email, your message will be added to the discussion
> below:
>
> http://rabbitmq.1065348.n5.nabble.com/MQTT-plugin-QoS-1-Android-not-consuming-on-reconnect-tp36888p36903.html
>  To unsubscribe from MQTT plugin, QoS 1, Android, not consuming on
> reconnect, click here
> <http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=36888&code=YmNsaWZmZUBnbWFpbC5jb218MzY4ODh8MTQ1NzU4Njg1Mg==>
> .
> NAML
> <http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml>
>




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/MQTT-plugin-QoS-1-Android-not-consuming-on-reconnect-tp36888p36905.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140727/1b4424a1/attachment.html>

From bra at fsn.hu  Sun Jul 27 19:59:58 2014
From: bra at fsn.hu (Nagy, Attila)
Date: Sun, 27 Jul 2014 20:59:58 +0200
Subject: [rabbitmq-discuss] Confirmation IDs
In-Reply-To: <etPan.53d50c06.643c9869.cf3e@mercurio.local>
References: <53D4E833.7070801@fsn.hu>
 <etPan.53d50c06.643c9869.cf3e@mercurio.local>
Message-ID: <53D54C2E.1000802@fsn.hu>

On 07/27/14 16:25, Michael Klishin wrote:
> On 27 July 2014 at 15:54:44, Nagy, Attila (bra at fsn.hu) wrote:
>>> My case: I process a file, containing multiple records. I do
>> this in a
>> FIFO manner: reading the file from its head towards its tail,
>> sending
>> each record with AMQP and waiting for confirms.
>> The problem here is that I have to keep a local delivery tag to file
>> pointer table, so I know which delivery tag means which file pointer.
> Yes, you need to correlate messages with delivery tags.
Yeah, that's my problem. BTW, are confirmations guaranteed to be in the 
order the original messages have been submitted?
I can see no information about that, except the existence of multiple 
field, which I guess would be somewhat meaningless if the confirmations 
wouldn't be in original order.
>
>> I think it would be much easier and flexible if the confirmation
>> system
>> would allow data to be "inherited" from the original message,
>> like its
>> properties or headers.
> So, calculated from the message? That won't work very well if you publish
> exactly the same message N times in a row.
Nope, from the record's identifier. I have an incoming task queue (for 
example a file which is appended with records, or a database which has 
rows), from which I can have a unique identifier which is always 
available and can directly point to the record.
So counting (because publish doesn't give it back) the sent messages 
(and resetting the counter on reconnects) and maintaining 
counter->original message pointers are unnecessary indirections to 
achieve this functionality.

BTW, RabbitMQ's STOMP plugin does this, you can set a receipt string and 
the message will be acknowledged back with that string, whatever it is.
But STOMP is not really an option if you want to do serious things in 
RabbitMQ. :)

>
> Either way, it is probably too late to change how publisher confirms work
Isn't it possible to add additional info in the ACK frame without 
breaking current clients?
Or making it only appear when publish has a given pattern? (like with STOMP)

Thanks,

From mklishin at gopivotal.com  Sun Jul 27 20:30:36 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Sun, 27 Jul 2014 23:30:36 +0400
Subject: [rabbitmq-discuss] Confirmation IDs
In-Reply-To: <53D54C2E.1000802@fsn.hu>
References: <53D4E833.7070801@fsn.hu>
 <etPan.53d50c06.643c9869.cf3e@mercurio.local> <53D54C2E.1000802@fsn.hu>
Message-ID: <etPan.53d5537a.625558ec.cf3e@mercurio.local>

On 27 July 2014 at 23:01:12, Nagy, Attila (bra at fsn.hu) wrote:
> > Yeah, that's my problem. BTW, are confirmations guaranteed  
> to be in the
> order the original messages have been submitted?

Yes.

> Nope, from the record's identifier. I have an incoming task queue  
> (for
> example a file which is appended with records, or a database which  
> has
> rows), from which I can have a unique identifier which is always  
> available and can directly point to the record.
> So counting (because publish doesn't give it back) the sent messages  
> (and resetting the counter on reconnects) and maintaining
> counter->original message pointers are unnecessary indirections  
> to
> achieve this functionality.

Coming up with a good identifier for
an arbitrary message is much harder and there's no consensus on what's the best
way to do this.
Especially if you try to come up with a solution for multiple protocols.

> BTW, RabbitMQ's STOMP plugin does this, you can set a receipt  
> string and
> the message will be acknowledged back with that string, whatever  
> it is.

STOMP has this feature but AMQP 0-9-1 and MQTT do not, unfortunately.

> But STOMP is not really an option if you want to do serious things  
> in
> RabbitMQ. :)

I can't see why not.

> Isn't it possible to add additional info in the ACK frame without?
> breaking current clients?
> Or making it only appear when publish has a given pattern? (like  
> with STOMP)

For AMQP 0-9-1 clients, it is not. STOMP header values can be of arbitrary length and many
headers are optional. AMQP 0-9-1 methods have a fixed (mandatory) attributes
and only *some* have optional ones ("extra arguments", as an attribute table).
Unfortunately, basic.ack is not one of the latter group.
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Mon Jul 28 02:48:46 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 28 Jul 2014 05:48:46 +0400
Subject: [rabbitmq-discuss] MQTT plugin, QoS 1, Android,
 not consuming on reconnect
In-Reply-To: <CAD34VhPCTcCOzOzNr1KtpG3HBkGUXKQACJ9ye_7DETRjF0A--w@mail.gmail.com>
References: <1406315315443-36888.post@n5.nabble.com>
 <etPan.53d2b306.6b8b4567.1552e@mercurio.local>
 <CAD34VhOqqvcy8HE3vpBWWc_kp-Mi1hP1vmavY8CedEyds9-oMg@mail.gmail.com>
 <etPan.53d2b72c.66334873.1552e@mercurio.local>
 <etPan.53d2bcbf.74b0dc51.1552e@mercurio.local>
 <1406466367573-36902.post@n5.nabble.com>
 <etPan.53d50b6c.327b23c6.cf3e@mercurio.local>
 <CAD34VhPCTcCOzOzNr1KtpG3HBkGUXKQACJ9ye_7DETRjF0A--w@mail.gmail.com>
Message-ID: <etPan.53d5ac1b.6b8b4567.fbc2@mercurio.local>

?On 27 July 2014 at 18:36:16, brydev (bcliffe at gmail.com) wrote:
> > The service on the application is unable to reconnect again  
> after the duplicate id is detected. It reconnects sometimes  
> but if it does it doesn't consume the missed messages on the queue.  
> The log doesn't give me anything else besides duplicate client  
> id disconnected. And my device is throwing the following error  
> on loop and is unable to reconnect.
>  
> private boolean isConnected() {
> if(mStarted && mClient != null && !mClient.isConnected())  
> {
> Log.i(DEBUG_TAG,"Mismatch between what we think is connected  
> and what is connected");
> }
>  
>  
> So I can't tell if the old, new or both connections are disconnected  
> from the broker.

We will investigate but the fundamental issue seems to be the same on both ends:
both peers do not notice connection loss.
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From bra at fsn.hu  Mon Jul 28 11:25:38 2014
From: bra at fsn.hu (Nagy, Attila)
Date: Mon, 28 Jul 2014 12:25:38 +0200
Subject: [rabbitmq-discuss] Confirmation IDs
In-Reply-To: <etPan.53d5537a.625558ec.cf3e@mercurio.local>
References: <53D4E833.7070801@fsn.hu>
 <etPan.53d50c06.643c9869.cf3e@mercurio.local> <53D54C2E.1000802@fsn.hu>
 <etPan.53d5537a.625558ec.cf3e@mercurio.local>
Message-ID: <53D62522.4070202@fsn.hu>

On 07/27/14 21:30, Michael Klishin wrote:
>> Nope, from the record's identifier. I have an incoming task queue
>> (for
>> example a file which is appended with records, or a database which
>> has
>> rows), from which I can have a unique identifier which is always
>> available and can directly point to the record.
>> So counting (because publish doesn't give it back) the sent messages
>> (and resetting the counter on reconnects) and maintaining
>> counter->original message pointers are unnecessary indirections
>> to
>> achieve this functionality.
> Coming up with a good identifier for
> an arbitrary message is much harder and there's no consensus on what's the best
> way to do this.
> Especially if you try to come up with a solution for multiple protocols.
I see three approaches:
1. let the server and the client -independently- count the messages and 
use that (the current solution for AMQP in RabbitMQ)
2. let the server count (or otherwise mark them with a unique ID) the 
messages and return it to the client, so it will know about that
3. let the client specify one

I think the first has many problems, it's not flexible, the client has 
to maintain translation tables and has to count exactly the same way as 
the server.
This way the counter must be implemented in the lowest level (in the 
AMQP library, because it's the only one which knows about the connection 
state, which can reset the counter) and higher levels need to sync with 
that, otherwise they won't be able to tell which messages have been 
confirmed.
How do other libraries work in this regard?

Pika's publisher example for example is both wrong (it will die on 
reconnects due to the counter resetting) and ugly. :)
http://pika.readthedocs.org/en/latest/examples/asynchronous_publisher_example.html

I've just made a quick peek into the java client, so I may be wrong. I 
guess it has these problems too, the counter can be queried 
independently of the publishing, therefore it can't be used in multi 
threaded environments (well, at least you have to open one channel per 
thread, or put a lock on the client so there won't be a race condition 
between querying the counter and sending the message).

>> But STOMP is not really an option if you want to do serious things
>> in
>> RabbitMQ. :)
> I can't see why not.
I've tried all STOMP brokers and finally stick with RabbitMQ, because it 
was the best in many ways. But as in most of the other brokers, STOMP 
offers a limited control on what the broker does in the background, 
which is unsuitable for a lot of use cases.
For example, for me serious means exact access control. And because 
STOMP does abritrary bindings and declares, the clients can't have 
strict policies, they will have always more power than it's needed with 
AMQP.
>
>> Isn't it possible to add additional info in the ACK frame without
>> breaking current clients?
>> Or making it only appear when publish has a given pattern? (like
>> with STOMP)
> For AMQP 0-9-1 clients, it is not. STOMP header values can be of arbitrary length and many
> headers are optional. AMQP 0-9-1 methods have a fixed (mandatory) attributes
> and only *some* have optional ones ("extra arguments", as an attribute table).
> Unfortunately, basic.ack is not one of the latter group.
>
OK, then could you please consider the following?
With basic.publish setting a custom header replaces the message's 
confirm sequence number with the header's value (with type 
compatibility, so this will be a limitation, only 64(?) bit unsigned 
ints could be used) and will basic.ack with that.

I mean this would be a normal publish (if confirms are turned on, it 
will have the current counter as the sequence number):

         properties  =  pika.BasicProperties(app_id='example-publisher',
                                           headers={'key':'value'})

         self._channel.basic_publish(self.EXCHANGE,  self.ROUTING_KEY,
                                     message,
                                     properties)
         self._message_number  +=  1


And this will have 123456 as its sequence number:

         properties  =  pika.BasicProperties(app_id='example-publisher',
                                           headers={'key':'value', 'X-RabbitMQ-confirm-seq':123456})

         self._channel.basic_publish(self.EXCHANGE,  self.ROUTING_KEY,
                                     message,
                                     properties)

The consequences are to be borne by the client.

From Andrew.Miller at sentry.com  Mon Jul 28 17:40:30 2014
From: Andrew.Miller at sentry.com (Miller Andrew)
Date: Mon, 28 Jul 2014 11:40:30 -0500
Subject: [rabbitmq-discuss] Loss of durable queues on HA sync
Message-ID: <6DA47758DD70A84CAB1C2A6629FEC4D3898EBFAB@sho-p-excmbx-02.sentry.com>

During some server reboots at our organization over the weekend, several nodes in our non-Prod cluster had some crashes, and in the end, 7 of 84 durable queues in the cluster were gone.  All nodes are running RabbitMQ 3.3.3 on Erlang R16B03-1.  This is a 3-node cluster, with cluster_partition_handling = autoheal.  I'm curious if this is a known issue with autoheal?  I tried recreating the issue this morning by recreating the series of events, but was unable to.  Our other 2-node non-Prod cluster, with no cluster_partition_handling, was also rebootted, but didn't have any problems.

Thanks,
Andrew Miller

08:12:01 - Node DIX-D-EVGAPP-02 (a disk node) saw node STR-D-EVGAPP-02 (a memory node) go down (which had been the master node for many queues), and was promoted to master for 75 queues, including those which later would disappear.

08:13:30 - Node DIX-D-EVGAPP-02 saw node STR-D-EVGAPP-02 come back, and began synchronizing back.  Most queues synchronized fine, but 7 crashed with errors similar to the following - and each of these queues were gone after this.  The third node (another disk node) doesn't have any crashes in its log around this time.

=ERROR REPORT==== 27-Jul-2014::08:13:30 ===
** Generic server <0.332.0> terminating
** Last message in was {add_on_right,{20,<4967.323.0>}}
** When Server state == {q,
                         {amqqueue,
                          {resource,<<"eventing">>,queue,
                           <<"SalesCenter2.BPClaims_ClosedClaim">>},
                          true,false,none,
                          [{<<"x-dead-letter-exchange">>,longstr,
                            <<"EnterpriseEventDeadLetter">>},
                           {<<"x-dead-letter-routing-key">>,longstr,
                            <<"SalesCenter2.BPClaims_ClosedClaim">>}],
                          <0.332.0>,
                          [<8174.310.0>],
                          [<8174.310.0>],
                          [{vhost,<<"eventing">>},
                           {name,<<"ha-all">>},
                           {pattern,<<"^.*">>},
                           {'apply-to',<<"queues">>},
                           {definition,
                            [{<<"ha-mode">>,<<"all">>},
                             {<<"ha-sync-mode">>,<<"automatic">>}]},
                           {priority,0}],
                          [{<8174.311.0>,<8174.310.0>},{<0.333.0>,<0.332.0>}],
                          []},
                         none,false,rabbit_mirror_queue_master,
                         {state,
                          {resource,<<"eventing">>,queue,
                           <<"SalesCenter2.BPClaims_ClosedClaim">>},
                          <0.333.0>,<0.4223.0>,rabbit_variable_queue,
                          {vqstate,
                           {0,{[],[]}},
                           {0,{[],[]}},
                           {delta,undefined,0,undefined},
                           {0,{[],[]}},
                           {0,{[],[]}},
                           0,
                           {0,nil},
                           {0,nil},
                           {qistate,
                            "d:/RabbitMQ/db/rabbit at DIX-D-EVGAPP-02-mnesia/queues/6GQ2ZHJGDF7X2GH1FS0QPJX2O",
                            {{dict,0,16,16,8,80,48,
                              {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                               []},
                              {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []}}},
                             []},
                            undefined,0,65536,
                            #Fun<rabbit_variable_queue.2.51560583>,
                            {0,nil}},
                           {{client_msstate,msg_store_persistent,
                             <<26,131,31,121,222,176,41,144,168,192,42,159,222,
                               13,179,107>>,
                             {dict,0,16,16,8,80,48,
                              {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                               []},
                              {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []}}},
                             {state,311371,
                              "d:/RabbitMQ/db/rabbit at DIX-D-EVGAPP-02-mnesia/msg_store_persistent"},
                             rabbit_msg_store_ets_index,
                             "d:/RabbitMQ/db/rabbit at DIX-D-EVGAPP-02-mnesia/msg_store_persistent",
                             <0.266.0>,315468,307274,319565,323662},
                            {client_msstate,msg_store_transient,
                             <<32,49,130,217,86,65,129,214,32,140,24,34,254,
                               129,171,73>>,
                             {dict,0,16,16,8,80,48,
                              {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                               []},
                              {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []}}},
                             {state,290886,
                              "d:/RabbitMQ/db/rabbit at DIX-D-EVGAPP-02-mnesia/msg_store_transient"},
                             rabbit_msg_store_ets_index,
                             "d:/RabbitMQ/db/rabbit at DIX-D-EVGAPP-02-mnesia/msg_store_transient",
                             <0.261.0>,294983,286789,299080,303177}},
                           true,0,0,0,infinity,0,0,0,0,0,
                           {rates,0.0,0.0,0.0,0.0,{1406,466723,462160}},
                           {0,nil},
                           {0,nil},
                           {0,nil},
                           {0,nil},
                           0,0},
                          {dict,0,16,16,8,80,48,
                           {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                           {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                             []}}},
                          [],
                          {set,0,16,16,8,80,48,
                           {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                           {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                             []}}}},
                         {state,{queue,[],[],0},{active,1406466722448182,1.0}},
                         undefined,undefined,undefined,undefined,
                         {state,fine,5000,undefined},
                         {0,nil},
                         undefined,undefined,undefined,
                         {state,
                          {dict,0,16,16,8,80,48,
                           {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                           {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                             []}}},
                          delegate},
                         {resource,<<"eventing">>,exchange,
                          <<"EnterpriseEventDeadLetter">>},
                         <<"SalesCenter2.BPClaims_ClosedClaim">>,undefined,2,
                         running}
** Reason for termination ==
** {function_clause,
       [{rabbit_amqqueue_process,handle_call,
            [{add_on_right,{20,<4967.323.0>}},
             {<4967.323.0>,#Ref<4967.0.0.2348>},
             {q,{amqqueue,
                    {resource,<<"eventing">>,queue,
                        <<"SalesCenter2.BPClaims_ClosedClaim">>},
                    true,false,none,
                    [{<<"x-dead-letter-exchange">>,longstr,
                      <<"EnterpriseEventDeadLetter">>},
                     {<<"x-dead-letter-routing-key">>,longstr,
                      <<"SalesCenter2.BPClaims_ClosedClaim">>}],
                    <0.332.0>,
                    [<8174.310.0>],
                    [<8174.310.0>],
                    [{vhost,<<"eventing">>},
                     {name,<<"ha-all">>},
                     {pattern,<<"^.*">>},
                     {'apply-to',<<"queues">>},
                     {definition,
                         [{<<"ha-mode">>,<<"all">>},
                          {<<"ha-sync-mode">>,<<"automatic">>}]},
                     {priority,0}],
                    [{<8174.311.0>,<8174.310.0>},{<0.333.0>,<0.332.0>}],
                    []},
                none,false,rabbit_mirror_queue_master,
                {state,
                    {resource,<<"eventing">>,queue,
                        <<"SalesCenter2.BPClaims_ClosedClaim">>},
                    <0.333.0>,<0.4223.0>,rabbit_variable_queue,
                    {vqstate,
                        {0,{[],[]}},
                        {0,{[],[]}},
                        {delta,undefined,0,undefined},
                        {0,{[],[]}},
                        {0,{[],[]}},
                        0,
                        {0,nil},
                        {0,nil},
                        {qistate,
                            "d:/RabbitMQ/db/rabbit at DIX-D-EVGAPP-02-mnesia/queues/6GQ2ZHJGDF7X2GH1FS0QPJX2O",
                            {{dict,0,16,16,8,80,48,
                                 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]},
                                 {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                   [],[]}}},
                             []},
                            undefined,0,65536,
                            #Fun<rabbit_variable_queue.2.51560583>,
                            {0,nil}},
                        {{client_msstate,msg_store_persistent,
                             <<26,131,31,121,222,176,41,144,168,192,42,159,222,
                               13,179,107>>,
                             {dict,0,16,16,8,80,48,
                                 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]},
                                 {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                   [],[]}}},
                             {state,311371,
                                 "d:/RabbitMQ/db/rabbit at DIX-D-EVGAPP-02-mnesia/msg_store_persistent"},
                             rabbit_msg_store_ets_index,
                             "d:/RabbitMQ/db/rabbit at DIX-D-EVGAPP-02-mnesia/msg_store_persistent",
                             <0.266.0>,315468,307274,319565,323662},
                         {client_msstate,msg_store_transient,
                             <<32,49,130,217,86,65,129,214,32,140,24,34,254,
                               129,171,73>>,
                             {dict,0,16,16,8,80,48,
                                 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]},
                                 {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                   [],[]}}},
                             {state,290886,
                                 "d:/RabbitMQ/db/rabbit at DIX-D-EVGAPP-02-mnesia/msg_store_transient"},
                             rabbit_msg_store_ets_index,
                             "d:/RabbitMQ/db/rabbit at DIX-D-EVGAPP-02-mnesia/msg_store_transient",
                             <0.261.0>,294983,286789,299080,303177}},
                        true,0,0,0,infinity,0,0,0,0,0,
                        {rates,0.0,0.0,0.0,0.0,{1406,466723,462160}},
                        {0,nil},
                        {0,nil},
                        {0,nil},
                        {0,nil},
                        0,0},
                    {dict,0,16,16,8,80,48,
                        {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                        {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                    [],
                    {set,0,16,16,8,80,48,
                        {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                        {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}}},
                {state,{queue,[],[],0},{active,1406466722448182,1.0}},
                undefined,undefined,undefined,undefined,
                {state,fine,5000,undefined},
                {0,nil},
                undefined,undefined,undefined,
                {state,
                    {dict,0,16,16,8,80,48,
                        {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                        {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                    delegate},
                {resource,<<"eventing">>,exchange,
                    <<"EnterpriseEventDeadLetter">>},
                <<"SalesCenter2.BPClaims_ClosedClaim">>,undefined,2,running}],
            []},
        {gen_server2,handle_msg,2,[]},
        {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,249}]}]}


08:13:30 - Node STR-D-EVGAPP-02 also recorded crashes involving the same queues:

=ERROR REPORT==== 27-Jul-2014::08:13:30 ===
** Generic server <0.323.0> terminating
** Last message in was {'$gen_cast',join}
** When Server state == {state,
                            {20,<0.323.0>},
                            {{20,<0.323.0>},undefined},
                            {{20,<0.323.0>},undefined},
                            {resource,<<"eventing">>,queue,
                                <<"Insight.BPClaims_ModifiedWorkNotAvailable">>},
                            rabbit_mirror_queue_slave,undefined,-1,undefined,
                            [<0.322.0>],
                            {[],[]},
                            [],0,undefined,
                            #Fun<rabbit_misc.execute_mnesia_transaction.1>}
** Reason for termination ==
** {{function_clause,
        [{rabbit_amqqueue_process,handle_call,
             [{add_on_right,{20,<0.323.0>}},
              {<0.323.0>,#Ref<0.0.0.2348>},
              {q,{amqqueue,
                     {resource,<<"eventing">>,queue,
                         <<"SalesCenter2.BPClaims_ClosedClaim">>},
                     true,false,none,
                     [{<<"x-dead-letter-exchange">>,longstr,
                       <<"EnterpriseEventDeadLetter">>},
                      {<<"x-dead-letter-routing-key">>,longstr,
                       <<"SalesCenter2.BPClaims_ClosedClaim">>}],
                     <5297.332.0>,
                     [<5251.310.0>],
                     [<5251.310.0>],
                     [{vhost,<<"eventing">>},
                      {name,<<"ha-all">>},
                      {pattern,<<"^.*">>},
                      {'apply-to',<<"queues">>},
                      {definition,
                          [{<<"ha-mode">>,<<"all">>},
                           {<<"ha-sync-mode">>,<<"automatic">>}]},
                      {priority,0}],
                     [{<5251.311.0>,<5251.310.0>},{<5297.333.0>,<5297.332.0>}],
                     []},
                 none,false,rabbit_mirror_queue_master,
                 {state,
                     {resource,<<"eventing">>,queue,
                         <<"SalesCenter2.BPClaims_ClosedClaim">>},
                     <5297.333.0>,<5297.4223.0>,rabbit_variable_queue,
                     {vqstate,
                         {0,{[],[]}},
                         {0,{[],[]}},
                         {delta,undefined,0,undefined},
                         {0,{[],[]}},
                         {0,{[],[]}},
                         0,
                         {0,nil},
                         {0,nil},
                         {qistate,
                             "d:/RabbitMQ/db/rabbit at DIX-D-EVGAPP-02-mnesia/queues/6GQ2ZHJGDF7X2GH1FS0QPJX2O",
                             {{dict,0,16,16,8,80,48,
                                  {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                   [],[]},
                                  {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                    [],[]}}},
                              []},
                             undefined,0,65536,
                             #Fun<rabbit_variable_queue.2.51560583>,
                             {0,nil}},
                         {{client_msstate,msg_store_persistent,
                              <<26,131,31,121,222,176,41,144,168,192,42,159,
                                222,13,179,107>>,
                              {dict,0,16,16,8,80,48,
                                  {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                   [],[]},
                                  {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                    [],[]}}},
                              {state,311371,
                                  "d:/RabbitMQ/db/rabbit at DIX-D-EVGAPP-02-mnesia/msg_store_persistent"},
                              rabbit_msg_store_ets_index,
                              "d:/RabbitMQ/db/rabbit at DIX-D-EVGAPP-02-mnesia/msg_store_persistent",
                              <5297.266.0>,315468,307274,319565,323662},
                          {client_msstate,msg_store_transient,
                              <<32,49,130,217,86,65,129,214,32,140,24,34,254,
                                129,171,73>>,
                              {dict,0,16,16,8,80,48,
                                  {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                   [],[]},
                                  {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                    [],[]}}},
                              {state,290886,
                                  "d:/RabbitMQ/db/rabbit at DIX-D-EVGAPP-02-mnesia/msg_store_transient"},
                              rabbit_msg_store_ets_index,
                              "d:/RabbitMQ/db/rabbit at DIX-D-EVGAPP-02-mnesia/msg_store_transient",
                              <5297.261.0>,294983,286789,299080,303177}},
                         true,0,0,0,infinity,0,0,0,0,0,
                         {rates,0.0,0.0,0.0,0.0,{1406,466723,462160}},
                         {0,nil},
                         {0,nil},
                         {0,nil},
                         {0,nil},
                         0,0},
                     {dict,0,16,16,8,80,48,
                         {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                         {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                     [],
                     {set,0,16,16,8,80,48,
                         {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                         {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}}},
                 {state,{queue,[],[],0},{active,1406466722448182,1.0}},
                 undefined,undefined,undefined,undefined,
                 {state,fine,5000,undefined},
                 {0,nil},
                 undefined,undefined,undefined,
                 {state,
                     {dict,0,16,16,8,80,48,
                         {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                         {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                     delegate},
                 {resource,<<"eventing">>,exchange,
                     <<"EnterpriseEventDeadLetter">>},
                 <<"SalesCenter2.BPClaims_ClosedClaim">>,undefined,2,running}],
             []},
         {gen_server2,handle_msg,2,[]},
         {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,249}]}]},
    {gen_server2,call,[<5297.332.0>,{add_on_right,{20,<0.323.0>}},infinity]}}

08:13:31 - And again from node STR-D-EVGAPP-02:

=ERROR REPORT==== 27-Jul-2014::08:13:31 ===
** Generic server <0.322.0> terminating
** Last message in was {'EXIT',<0.323.0>,
                        {{function_clause,
                          [{rabbit_amqqueue_process,handle_call,
                            [{add_on_right,{20,<0.323.0>}},
                             {<0.323.0>,#Ref<0.0.0.2348>},
                             {q,
                              {amqqueue,
                               {resource,<<"eventing">>,queue,
                                <<"SalesCenter2.BPClaims_ClosedClaim">>},
                               true,false,none,
                               [{<<"x-dead-letter-exchange">>,longstr,
                                 <<"EnterpriseEventDeadLetter">>},
                                {<<"x-dead-letter-routing-key">>,longstr,
                                 <<"SalesCenter2.BPClaims_ClosedClaim">>}],
                               <5297.332.0>,
                               [<5251.310.0>],
                               [<5251.310.0>],
                               [{vhost,<<"eventing">>},
                                {name,<<"ha-all">>},
                                {pattern,<<"^.*">>},
                                {'apply-to',<<"queues">>},
                                {definition,
                                 [{<<"ha-mode">>,<<"all">>},
                                  {<<"ha-sync-mode">>,<<"automatic">>}]},
                                {priority,0}],
                               [{<5251.311.0>,<5251.310.0>},
                                {<5297.333.0>,<5297.332.0>}],
                               []},
                              none,false,rabbit_mirror_queue_master,
                              {state,
                               {resource,<<"eventing">>,queue,
                                <<"SalesCenter2.BPClaims_ClosedClaim">>},
                               <5297.333.0>,<5297.4223.0>,
                               rabbit_variable_queue,
                               {vqstate,
                                {0,{[],[]}},
                                {0,{[],[]}},
                                {delta,undefined,0,undefined},
                                {0,{[],[]}},
                                {0,{[],[]}},
                                0,
                                {0,nil},
                                {0,nil},
                                {qistate,
                                 "d:/RabbitMQ/db/rabbit at DIX-D-EVGAPP-02-mnesia/queues/6GQ2ZHJGDF7X2GH1FS0QPJX2O",
                                 {{dict,0,16,16,8,80,48,
                                   {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                    [],[]},
                                   {{[],[],[],[],[],[],[],[],[],[],[],[],[],
                                     [],[],[]}}},
                                  []},
                                 undefined,0,65536,
                                 #Fun<rabbit_variable_queue.2.51560583>,
                                 {0,nil}},
                                {{client_msstate,msg_store_persistent,
                                  <<26,131,31,121,222,176,41,144,168,192,42,
                                    159,222,13,179,107>>,
                                  {dict,0,16,16,8,80,48,
                                   {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                    [],[]},
                                   {{[],[],[],[],[],[],[],[],[],[],[],[],[],
                                     [],[],[]}}},
                                  {state,311371,
                                   "d:/RabbitMQ/db/rabbit at DIX-D-EVGAPP-02-mnesia/msg_store_persistent"},
                                  rabbit_msg_store_ets_index,
                                  "d:/RabbitMQ/db/rabbit at DIX-D-EVGAPP-02-mnesia/msg_store_persistent",
                                  <5297.266.0>,315468,307274,319565,323662},
                                 {client_msstate,msg_store_transient,
                                  <<32,49,130,217,86,65,129,214,32,140,24,34,
                                    254,129,171,73>>,
                                  {dict,0,16,16,8,80,48,
                                   {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                    [],[]},
                                   {{[],[],[],[],[],[],[],[],[],[],[],[],[],
                                     [],[],[]}}},
                                  {state,290886,
                                   "d:/RabbitMQ/db/rabbit at DIX-D-EVGAPP-02-mnesia/msg_store_transient"},
                                  rabbit_msg_store_ets_index,
                                  "d:/RabbitMQ/db/rabbit at DIX-D-EVGAPP-02-mnesia/msg_store_transient",
                                  <5297.261.0>,294983,286789,299080,303177}},
                                true,0,0,0,infinity,0,0,0,0,0,
                                {rates,0.0,0.0,0.0,0.0,{1406,466723,462160}},
                                {0,nil},
                                {0,nil},
                                {0,nil},
                                {0,nil},
                                0,0},
                               {dict,0,16,16,8,80,48,
                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                               [],
                               {set,0,16,16,8,80,48,
                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}}},
                              {state,
                               {queue,[],[],0},
                               {active,1406466722448182,1.0}},
                              undefined,undefined,undefined,undefined,
                              {state,fine,5000,undefined},
                              {0,nil},
                              undefined,undefined,undefined,
                              {state,
                               {dict,0,16,16,8,80,48,
                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                               delegate},
                              {resource,<<"eventing">>,exchange,
                               <<"EnterpriseEventDeadLetter">>},
                              <<"SalesCenter2.BPClaims_ClosedClaim">>,
                              undefined,2,running}],
                            []},
                           {gen_server2,handle_msg,2,[]},
                           {proc_lib,wake_up,3,
                            [{file,"proc_lib.erl"},{line,249}]}]},
                         {gen_server2,call,
                          [<5297.332.0>,
                           {add_on_right,{20,<0.323.0>}},
                           infinity]}}}
** When Server state == {state,
                         {amqqueue,
                          {resource,<<"eventing">>,queue,
                           <<"Insight.BPClaims_ModifiedWorkNotAvailable">>},
                          true,false,none,
                          [{<<"x-dead-letter-exchange">>,longstr,
                            <<"EnterpriseEventDeadLetter">>},
                           {<<"x-dead-letter-routing-key">>,longstr,
                            <<"Insight.BPClaims_ModifiedWorkNotAvailable">>}],
                          <5251.335.0>,
                          [<5297.331.0>],
                          [<5297.331.0>],
                          [{vhost,<<"eventing">>},
                           {name,<<"ha-all">>},
                           {pattern,<<"^.*">>},
                           {'apply-to',<<"queues">>},
                           {definition,
                            [{<<"ha-mode">>,<<"all">>},
                             {<<"ha-sync-mode">>,<<"automatic">>}]},
                           {priority,0}],
                          [{<5297.332.0>,<5297.331.0>},
                           {<5251.336.0>,<5251.335.0>}],
                          []},
                         <0.323.0>,rabbit_variable_queue,
                         {vqstate,
                          {0,{[],[]}},
                          {0,{[],[]}},
                          {delta,undefined,0,undefined},
                          {0,{[],[]}},
                          {0,{[],[]}},
                          0,
                          {0,nil},
                          {0,nil},
                          {qistate,
                           "d:/RabbitMQ/db/rabbit at STR-D-EVGAPP-02-mnesia/queues/11YNGR2UMDIGSF4OWRUUJ2HUX",
                           {{dict,0,16,16,8,80,48,
                             {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                             {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                               []}}},
                            []},
                           undefined,0,65536,
                           #Fun<rabbit_variable_queue.2.51560583>,
                           {0,nil}},
                          {{client_msstate,msg_store_persistent,
                            <<142,49,10,175,39,218,164,74,2,215,253,147,201,
                              168,141,2>>,
                            {dict,0,16,16,8,80,48,
                             {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                             {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                               []}}},
                            {state,303177,
                             "d:/RabbitMQ/db/rabbit at STR-D-EVGAPP-02-mnesia/msg_store_persistent"},
                            rabbit_msg_store_ets_index,
                            "d:/RabbitMQ/db/rabbit at STR-D-EVGAPP-02-mnesia/msg_store_persistent",
                            <0.251.0>,307274,299080,311371,315468},
                           {client_msstate,msg_store_transient,
                            <<18,152,170,252,55,149,243,37,252,234,131,180,53,
                              66,14,182>>,
                            {dict,0,16,16,8,80,48,
                             {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                             {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                               []}}},
                            {state,282692,
                             "d:/RabbitMQ/db/rabbit at STR-D-EVGAPP-02-mnesia/msg_store_transient"},
                            rabbit_msg_store_ets_index,
                            "d:/RabbitMQ/db/rabbit at STR-D-EVGAPP-02-mnesia/msg_store_transient",
                            <0.246.0>,286789,278595,290886,294983}},
                          true,0,0,0,infinity,0,0,0,0,0,
                          {rates,0.0,0.0,0.0,0.0,{1406,466811,43211}},
                          {0,nil},
                          {0,nil},
                          {0,nil},
                          {0,nil},
                          0,0},
                         undefined,undefined,
                         {dict,0,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                          {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                         {dict,0,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                          {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                         {dict,0,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                          {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                         {state,
                          {dict,0,16,16,8,80,48,
                           {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                           {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                             []}}},
                          delegate},
                         undefined}
** Reason for termination ==
** {{function_clause,
        [{rabbit_amqqueue_process,handle_call,
             [{add_on_right,{20,<0.323.0>}},
              {<0.323.0>,#Ref<0.0.0.2348>},
              {q,{amqqueue,
                     {resource,<<"eventing">>,queue,
                         <<"SalesCenter2.BPClaims_ClosedClaim">>},
                     true,false,none,
                     [{<<"x-dead-letter-exchange">>,longstr,
                       <<"EnterpriseEventDeadLetter">>},
                      {<<"x-dead-letter-routing-key">>,longstr,
                       <<"SalesCenter2.BPClaims_ClosedClaim">>}],
                     <5297.332.0>,
                     [<5251.310.0>],
                     [<5251.310.0>],
                     [{vhost,<<"eventing">>},
                      {name,<<"ha-all">>},
                      {pattern,<<"^.*">>},
                      {'apply-to',<<"queues">>},
                      {definition,
                          [{<<"ha-mode">>,<<"all">>},
                           {<<"ha-sync-mode">>,<<"automatic">>}]},
                      {priority,0}],
                     [{<5251.311.0>,<5251.310.0>},{<5297.333.0>,<5297.332.0>}],
                     []},
                 none,false,rabbit_mirror_queue_master,
                 {state,
                     {resource,<<"eventing">>,queue,
                         <<"SalesCenter2.BPClaims_ClosedClaim">>},
                     <5297.333.0>,<5297.4223.0>,rabbit_variable_queue,
                     {vqstate,
                         {0,{[],[]}},
                         {0,{[],[]}},
                         {delta,undefined,0,undefined},
                         {0,{[],[]}},
                         {0,{[],[]}},
                         0,
                         {0,nil},
                         {0,nil},
                         {qistate,
                             "d:/RabbitMQ/db/rabbit at DIX-D-EVGAPP-02-mnesia/queues/6GQ2ZHJGDF7X2GH1FS0QPJX2O",
                             {{dict,0,16,16,8,80,48,
                                  {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                   [],[]},
                                  {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                    [],[]}}},
                              []},
                             undefined,0,65536,
                             #Fun<rabbit_variable_queue.2.51560583>,
                             {0,nil}},
                         {{client_msstate,msg_store_persistent,
                              <<26,131,31,121,222,176,41,144,168,192,42,159,
                                222,13,179,107>>,
                              {dict,0,16,16,8,80,48,
                                  {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                   [],[]},
                                  {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                    [],[]}}},
                              {state,311371,
                                  "d:/RabbitMQ/db/rabbit at DIX-D-EVGAPP-02-mnesia/msg_store_persistent"},
                              rabbit_msg_store_ets_index,
                              "d:/RabbitMQ/db/rabbit at DIX-D-EVGAPP-02-mnesia/msg_store_persistent",
                              <5297.266.0>,315468,307274,319565,323662},
                          {client_msstate,msg_store_transient,
                              <<32,49,130,217,86,65,129,214,32,140,24,34,254,
                                129,171,73>>,
                              {dict,0,16,16,8,80,48,
                                  {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                   [],[]},
                                  {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                    [],[]}}},
                              {state,290886,
                                  "d:/RabbitMQ/db/rabbit at DIX-D-EVGAPP-02-mnesia/msg_store_transient"},
                              rabbit_msg_store_ets_index,
                              "d:/RabbitMQ/db/rabbit at DIX-D-EVGAPP-02-mnesia/msg_store_transient",
                              <5297.261.0>,294983,286789,299080,303177}},
                         true,0,0,0,infinity,0,0,0,0,0,
                         {rates,0.0,0.0,0.0,0.0,{1406,466723,462160}},
                         {0,nil},
                         {0,nil},
                         {0,nil},
                         {0,nil},
                         0,0},
                     {dict,0,16,16,8,80,48,
                         {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                         {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                     [],
                     {set,0,16,16,8,80,48,
                         {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                         {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}}},
                 {state,{queue,[],[],0},{active,1406466722448182,1.0}},
                 undefined,undefined,undefined,undefined,
                 {state,fine,5000,undefined},
                 {0,nil},
                 undefined,undefined,undefined,
                 {state,
                     {dict,0,16,16,8,80,48,
                         {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                         {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                     delegate},
                 {resource,<<"eventing">>,exchange,
                     <<"EnterpriseEventDeadLetter">>},
                 <<"SalesCenter2.BPClaims_ClosedClaim">>,undefined,2,running}],
             []},
         {gen_server2,handle_msg,2,[]},
         {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,249}]}]},
    {gen_server2,call,[<5297.332.0>,{add_on_right,{20,<0.323.0>}},infinity]}}

This e-mail is confidential.  If you are not the intended recipient, you must not disclose or use the information contained in it. If you have received this e-mail in error, please tell us immediately by return e-mail and delete the document. No recipient may use the information in this e-mail in violation of any civil or criminal statute. Sentry disclaims all liability for any unauthorized uses of this e-mail or its contents. Sentry accepts no liability or responsibility for any damage caused by any virus transmitted with this e-mail.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140728/c09ad936/attachment.html>

From simon at rabbitmq.com  Mon Jul 28 19:05:14 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 28 Jul 2014 19:05:14 +0100
Subject: [rabbitmq-discuss] Loss of durable queues on HA sync
In-Reply-To: <6DA47758DD70A84CAB1C2A6629FEC4D3898EBFAB@sho-p-excmbx-02.sentry.com>
References: <6DA47758DD70A84CAB1C2A6629FEC4D3898EBFAB@sho-p-excmbx-02.sentry.com>
Message-ID: <53D690DA.2050702@rabbitmq.com>

Thanks for this. This is not a known issue, and not something we've seen 
before.

In all cases it looks like a queue process crashed because it received a 
message intended for a GM process. That should never be able to happen.

Could you send me full logs from all nodes around the time of the crash? 
It would be useful to see in what order things happened, if anything led 
up to this, when nodes restarted for autoheal (if any autoheal 
happened), etc.

Cheers, Simon

On 28/07/14 17:40, Miller Andrew wrote:
> During some server reboots at our organization over the weekend, several
> nodes in our non-Prod cluster had some crashes, and in the end, 7 of 84
> durable queues in the cluster were gone.  All nodes are running RabbitMQ
> 3.3.3 on Erlang R16B03-1.  This is a 3-node cluster, with
> cluster_partition_handling = autoheal.  I'm curious if this is a known
> issue with autoheal?  I tried recreating the issue this morning by
> recreating the series of events, but was unable to.  Our other 2-node
> non-Prod cluster, with no cluster_partition_handling, was also
> rebootted, but didn't have any problems.
>
> Thanks,
>
> Andrew Miller
>
> 08:12:01 - Node DIX-D-EVGAPP-02 (a disk node) saw node STR-D-EVGAPP-02
> (a memory node) go down (which had been the master node for many
> queues), and was promoted to master for 75 queues, including those which
> later would disappear.
>
> 08:13:30 - Node DIX-D-EVGAPP-02 saw node STR-D-EVGAPP-02 come back, and
> began synchronizing back.  Most queues synchronized fine, but 7 crashed
> with errors similar to the following - and each of these queues were
> gone after this.  The third node (another disk node) doesn't have any
> crashes in its log around this time.
>
> =ERROR REPORT==== 27-Jul-2014::08:13:30 ===
>
> ** Generic server <0.332.0> terminating
>
> ** Last message in was {add_on_right,{20,<4967.323.0>}}
>
> ** When Server state == {q,
>
>                           {amqqueue,
>
>                            {resource,<<"eventing">>,queue,
>
>                             <<"SalesCenter2.BPClaims_ClosedClaim">>},
>
>                            true,false,none,
>
>                            [{<<"x-dead-letter-exchange">>,longstr,
>
>                              <<"EnterpriseEventDeadLetter">>},
>
>                             {<<"x-dead-letter-routing-key">>,longstr,
>
>                              <<"SalesCenter2.BPClaims_ClosedClaim">>}],
>
>                            <0.332.0>,
>
>                            [<8174.310.0>],
>
>                            [<8174.310.0>],
>
>                            [{vhost,<<"eventing">>},
>
>                             {name,<<"ha-all">>},
>
>                             {pattern,<<"^.*">>},
>
>                             {'apply-to',<<"queues">>},
>
>                             {definition,
>
>                              [{<<"ha-mode">>,<<"all">>},
>
>                               {<<"ha-sync-mode">>,<<"automatic">>}]},
>
>                             {priority,0}],
>
>
> [{<8174.311.0>,<8174.310.0>},{<0.333.0>,<0.332.0>}],
>
>                            []},
>
>                           none,false,rabbit_mirror_queue_master,
>
>                           {state,
>
>                            {resource,<<"eventing">>,queue,
>
>                             <<"SalesCenter2.BPClaims_ClosedClaim">>},
>
>                            <0.333.0>,<0.4223.0>,rabbit_variable_queue,
>
>                            {vqstate,
>
>                             {0,{[],[]}},
>
>                             {0,{[],[]}},
>
>                             {delta,undefined,0,undefined},
>
>                             {0,{[],[]}},
>
>                             {0,{[],[]}},
>
>                             0,
>
>                             {0,nil},
>
>                             {0,nil},
>
>                             {qistate,
>
>
> "d:/RabbitMQ/db/rabbit at DIX-D-EVGAPP-02-mnesia/queues/6GQ2ZHJGDF7X2GH1FS0QPJX2O",
>
>                              {{dict,0,16,16,8,80,48,
>
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                 []},
>
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                  []}}},
>
>                               []},
>
>                              undefined,0,65536,
>
>                              #Fun<rabbit_variable_queue.2.51560583>,
>
>                              {0,nil}},
>
>                             {{client_msstate,msg_store_persistent,
>
>
> <<26,131,31,121,222,176,41,144,168,192,42,159,222,
>
>                                 13,179,107>>,
>
>                               {dict,0,16,16,8,80,48,
>
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                 []},
>
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                  []}}},
>
>                               {state,311371,
>
>
> "d:/RabbitMQ/db/rabbit at DIX-D-EVGAPP-02-mnesia/msg_store_persistent"},
>
>                               rabbit_msg_store_ets_index,
>
>
> "d:/RabbitMQ/db/rabbit at DIX-D-EVGAPP-02-mnesia/msg_store_persistent",
>
>                               <0.266.0>,315468,307274,319565,323662},
>
>                              {client_msstate,msg_store_transient,
>
>
>                   <<32,49,130,217,86,65,129,214,32,140,24,34,254,
>
>                                 129,171,73>>,
>
>                               {dict,0,16,16,8,80,48,
>
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                 []},
>
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                  []}}},
>
>                               {state,290886,
>
>
> "d:/RabbitMQ/db/rabbit at DIX-D-EVGAPP-02-mnesia/msg_store_transient"},
>
>                               rabbit_msg_store_ets_index,
>
>
> "d:/RabbitMQ/db/rabbit at DIX-D-EVGAPP-02-mnesia/msg_store_transient",
>
>                               <0.261.0>,294983,286789,299080,303177}},
>
>                             true,0,0,0,infinity,0,0,0,0,0,
>
>                             {rates,0.0,0.0,0.0,0.0,{1406,466723,462160}},
>
>                             {0,nil},
>
>                             {0,nil},
>
>                             {0,nil},
>
>                             {0,nil},
>
>                             0,0},
>
>                            {dict,0,16,16,8,80,48,
>
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>
>                             {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                               []}}},
>
>                            [],
>
>                            {set,0,16,16,8,80,48,
>
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>
>                             {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                               []}}}},
>
>
> {state,{queue,[],[],0},{active,1406466722448182,1.0}},
>
>                           undefined,undefined,undefined,undefined,
>
>                           {state,fine,5000,undefined},
>
>                           {0,nil},
>
>                           undefined,undefined,undefined,
>
>                           {state,
>
>                            {dict,0,16,16,8,80,48,
>
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>
>                             {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                               []}}},
>
>                            delegate},
>
>                           {resource,<<"eventing">>,exchange,
>
>                            <<"EnterpriseEventDeadLetter">>},
>
>
> <<"SalesCenter2.BPClaims_ClosedClaim">>,undefined,2,
>
>                           running}
>
> ** Reason for termination ==
>
> ** {function_clause,
>
>         [{rabbit_amqqueue_process,handle_call,
>
>              [{add_on_right,{20,<4967.323.0>}},
>
>               {<4967.323.0>,#Ref<4967.0.0.2348>},
>
>               {q,{amqqueue,
>
>                      {resource,<<"eventing">>,queue,
>
>                          <<"SalesCenter2.BPClaims_ClosedClaim">>},
>
>                      true,false,none,
>
>                      [{<<"x-dead-letter-exchange">>,longstr,
>
>                        <<"EnterpriseEventDeadLetter">>},
>
>                       {<<"x-dead-letter-routing-key">>,longstr,
>
>                        <<"SalesCenter2.BPClaims_ClosedClaim">>}],
>
>                      <0.332.0>,
>
>                      [<8174.310.0>],
>
>                      [<8174.310.0>],
>
>                      [{vhost,<<"eventing">>},
>
>                       {name,<<"ha-all">>},
>
>                       {pattern,<<"^.*">>},
>
>                       {'apply-to',<<"queues">>},
>
>                       {definition,
>
>                           [{<<"ha-mode">>,<<"all">>},
>
>                            {<<"ha-sync-mode">>,<<"automatic">>}]},
>
>                       {priority,0}],
>
>                      [{<8174.311.0>,<8174.310.0>},{<0.333.0>,<0.332.0>}],
>
>                      []},
>
>                  none,false,rabbit_mirror_queue_master,
>
>                  {state,
>
>                      {resource,<<"eventing">>,queue,
>
>                          <<"SalesCenter2.BPClaims_ClosedClaim">>},
>
>                      <0.333.0>,<0.4223.0>,rabbit_variable_queue,
>
>                      {vqstate,
>
>                          {0,{[],[]}},
>
>                          {0,{[],[]}},
>
>                          {delta,undefined,0,undefined},
>
>                          {0,{[],[]}},
>
>                          {0,{[],[]}},
>
>                          0,
>
>                          {0,nil},
>
>                          {0,nil},
>
>                          {qistate,
>
>
>        "d:/RabbitMQ/db/rabbit at DIX-D-EVGAPP-02-mnesia/queues/6GQ2ZHJGDF7X2GH1FS0QPJX2O",
>
>                              {{dict,0,16,16,8,80,48,
>
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                    [],[]},
>
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                     [],[]}}},
>
>                               []},
>
>                              undefined,0,65536,
>
>                              #Fun<rabbit_variable_queue.2.51560583>,
>
>                              {0,nil}},
>
>                          {{client_msstate,msg_store_persistent,
>
>
> <<26,131,31,121,222,176,41,144,168,192,42,159,222,
>
>                                 13,179,107>>,
>
>                               {dict,0,16,16,8,80,48,
>
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                    [],[]},
>
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                     [],[]}}},
>
>                               {state,311371,
>
>
> "d:/RabbitMQ/db/rabbit at DIX-D-EVGAPP-02-mnesia/msg_store_persistent"},
>
>                               rabbit_msg_store_ets_index,
>
>
>                        "d:/RabbitMQ/db/rabbit at DIX-D-EVGAPP-02-mnesia/msg_store_persistent",
>
>                               <0.266.0>,315468,307274,319565,323662},
>
>                           {client_msstate,msg_store_transient,
>
>
> <<32,49,130,217,86,65,129,214,32,140,24,34,254,
>
>                                 129,171,73>>,
>
>                               {dict,0,16,16,8,80,48,
>
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                    [],[]},
>
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                     [],[]}}},
>
>                               {state,290886,
>
>
> "d:/RabbitMQ/db/rabbit at DIX-D-EVGAPP-02-mnesia/msg_store_transient"},
>
>                               rabbit_msg_store_ets_index,
>
>
> "d:/RabbitMQ/db/rabbit at DIX-D-EVGAPP-02-mnesia/msg_store_transient",
>
>                               <0.261.0>,294983,286789,299080,303177}},
>
>                          true,0,0,0,infinity,0,0,0,0,0,
>
>                          {rates,0.0,0.0,0.0,0.0,{1406,466723,462160}},
>
>                          {0,nil},
>
>                          {0,nil},
>
>                          {0,nil},
>
>                          {0,nil},
>
>                          0,0},
>
>                      {dict,0,16,16,8,80,48,
>
>                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
>
>                      [],
>
>                      {set,0,16,16,8,80,48,
>
>                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}}},
>
>                  {state,{queue,[],[],0},{active,1406466722448182,1.0}},
>
>                  undefined,undefined,undefined,undefined,
>
>                  {state,fine,5000,undefined},
>
>                  {0,nil},
>
>                  undefined,undefined,undefined,
>
>                  {state,
>
>                      {dict,0,16,16,8,80,48,
>
>                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
>
>                      delegate},
>
>                  {resource,<<"eventing">>,exchange,
>
>                      <<"EnterpriseEventDeadLetter">>},
>
>
> <<"SalesCenter2.BPClaims_ClosedClaim">>,undefined,2,running}],
>
>              []},
>
>          {gen_server2,handle_msg,2,[]},
>
>          {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,249}]}]}
>
> 08:13:30 - Node STR-D-EVGAPP-02 also recorded crashes involving the same
> queues:
>
> =ERROR REPORT==== 27-Jul-2014::08:13:30 ===
>
> ** Generic server <0.323.0> terminating
>
> ** Last message in was {'$gen_cast',join}
>
> ** When Server state == {state,
>
>                              {20,<0.323.0>},
>
>                              {{20,<0.323.0>},undefined},
>
>                              {{20,<0.323.0>},undefined},
>
>                              {resource,<<"eventing">>,queue,
>
>
> <<"Insight.BPClaims_ModifiedWorkNotAvailable">>},
>
>
> rabbit_mirror_queue_slave,undefined,-1,undefined,
>
>                              [<0.322.0>],
>
>                              {[],[]},
>
>                              [],0,undefined,
>
>                              #Fun<rabbit_misc.execute_mnesia_transaction.1>}
>
> ** Reason for termination ==
>
> ** {{function_clause,
>
>          [{rabbit_amqqueue_process,handle_call,
>
>               [{add_on_right,{20,<0.323.0>}},
>
>                {<0.323.0>,#Ref<0.0.0.2348>},
>
>                {q,{amqqueue,
>
>                       {resource,<<"eventing">>,queue,
>
>                           <<"SalesCenter2.BPClaims_ClosedClaim">>},
>
>                       true,false,none,
>
>                       [{<<"x-dead-letter-exchange">>,longstr,
>
>                         <<"EnterpriseEventDeadLetter">>},
>
>                        {<<"x-dead-letter-routing-key">>,longstr,
>
>                         <<"SalesCenter2.BPClaims_ClosedClaim">>}],
>
>                       <5297.332.0>,
>
>                       [<5251.310.0>],
>
>                       [<5251.310.0>],
>
>                       [{vhost,<<"eventing">>},
>
>                        {name,<<"ha-all">>},
>
>                        {pattern,<<"^.*">>},
>
>                        {'apply-to',<<"queues">>},
>
>                        {definition,
>
>                            [{<<"ha-mode">>,<<"all">>},
>
>                             {<<"ha-sync-mode">>,<<"automatic">>}]},
>
>                        {priority,0}],
>
>
> [{<5251.311.0>,<5251.310.0>},{<5297.333.0>,<5297.332.0>}],
>
>                       []},
>
>                   none,false,rabbit_mirror_queue_master,
>
>                   {state,
>
>                       {resource,<<"eventing">>,queue,
>
>                           <<"SalesCenter2.BPClaims_ClosedClaim">>},
>
>                       <5297.333.0>,<5297.4223.0>,rabbit_variable_queue,
>
>                       {vqstate,
>
>                           {0,{[],[]}},
>
>                           {0,{[],[]}},
>
>                           {delta,undefined,0,undefined},
>
>                           {0,{[],[]}},
>
>                           {0,{[],[]}},
>
>                           0,
>
>                           {0,nil},
>
>                           {0,nil},
>
>                           {qistate,
>
>
> "d:/RabbitMQ/db/rabbit at DIX-D-EVGAPP-02-mnesia/queues/6GQ2ZHJGDF7X2GH1FS0QPJX2O",
>
>                               {{dict,0,16,16,8,80,48,
>
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                     [],[]},
>
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                      [],[]}}},
>
>                                []},
>
>                               undefined,0,65536,
>
>                               #Fun<rabbit_variable_queue.2.51560583>,
>
>                               {0,nil}},
>
>                           {{client_msstate,msg_store_persistent,
>
>
> <<26,131,31,121,222,176,41,144,168,192,42,159,
>
>                                  222,13,179,107>>,
>
>                                {dict,0,16,16,8,80,48,
>
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                     [],[]},
>
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                      [],[]}}},
>
>                                {state,311371,
>
>
> "d:/RabbitMQ/db/rabbit at DIX-D-EVGAPP-02-mnesia/msg_store_persistent"},
>
>                                rabbit_msg_store_ets_index,
>
>
> "d:/RabbitMQ/db/rabbit at DIX-D-EVGAPP-02-mnesia/msg_store_persistent",
>
>                                <5297.266.0>,315468,307274,319565,323662},
>
>                            {client_msstate,msg_store_transient,
>
>
> <<32,49,130,217,86,65,129,214,32,140,24,34,254,
>
>                                  129,171,73>>,
>
>                                {dict,0,16,16,8,80,48,
>
>
>            {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                     [],[]},
>
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                      [],[]}}},
>
>                                {state,290886,
>
>
> "d:/RabbitMQ/db/rabbit at DIX-D-EVGAPP-02-mnesia/msg_store_transient"},
>
>                                rabbit_msg_store_ets_index,
>
>
> "d:/RabbitMQ/db/rabbit at DIX-D-EVGAPP-02-mnesia/msg_store_transient",
>
>                                <5297.261.0>,294983,286789,299080,303177}},
>
>                           true,0,0,0,infinity,0,0,0,0,0,
>
>                           {rates,0.0,0.0,0.0,0.0,{1406,466723,462160}},
>
>                           {0,nil},
>
>                           {0,nil},
>
>                           {0,nil},
>
>                           {0,nil},
>
>                           0,0},
>
>                       {dict,0,16,16,8,80,48,
>
>                           {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
>
>                       [],
>
>                       {set,0,16,16,8,80,48,
>
>                           {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}}},
>
>                   {state,{queue,[],[],0},{active,1406466722448182,1.0}},
>
>                   undefined,undefined,undefined,undefined,
>
>                   {state,fine,5000,undefined},
>
>                   {0,nil},
>
>                   undefined,undefined,undefined,
>
>                   {state,
>
>                       {dict,0,16,16,8,80,48,
>
>                           {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
>
>                       delegate},
>
>                   {resource,<<"eventing">>,exchange,
>
>                       <<"EnterpriseEventDeadLetter">>},
>
>
> <<"SalesCenter2.BPClaims_ClosedClaim">>,undefined,2,running}],
>
>               []},
>
>           {gen_server2,handle_msg,2,[]},
>
>           {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,249}]}]},
>
>
> {gen_server2,call,[<5297.332.0>,{add_on_right,{20,<0.323.0>}},infinity]}}
>
> 08:13:31 - And again from node STR-D-EVGAPP-02:
>
> =ERROR REPORT==== 27-Jul-2014::08:13:31 ===
>
> ** Generic server <0.322.0> terminating
>
> ** Last message in was {'EXIT',<0.323.0>,
>
>                          {{function_clause,
>
>                            [{rabbit_amqqueue_process,handle_call,
>
>                              [{add_on_right,{20,<0.323.0>}},
>
>                               {<0.323.0>,#Ref<0.0.0.2348>},
>
>                               {q,
>
>                                {amqqueue,
>
>                                 {resource,<<"eventing">>,queue,
>
>                                  <<"SalesCenter2.BPClaims_ClosedClaim">>},
>
>                                 true,false,none,
>
>                                 [{<<"x-dead-letter-exchange">>,longstr,
>
>                                   <<"EnterpriseEventDeadLetter">>},
>
>                                  {<<"x-dead-letter-routing-key">>,longstr,
>
>                                   <<"SalesCenter2.BPClaims_ClosedClaim">>}],
>
>                                 <5297.332.0>,
>
>                                 [<5251.310.0>],
>
>                                 [<5251.310.0>],
>
>                                 [{vhost,<<"eventing">>},
>
>                                  {name,<<"ha-all">>},
>
>                                  {pattern,<<"^.*">>},
>
>                                  {'apply-to',<<"queues">>},
>
>                                  {definition,
>
>                                   [{<<"ha-mode">>,<<"all">>},
>
>                                    {<<"ha-sync-mode">>,<<"automatic">>}]},
>
>                                  {priority,0}],
>
>                                 [{<5251.311.0>,<5251.310.0>},
>
>                                  {<5297.333.0>,<5297.332.0>}],
>
>                                 []},
>
>                                none,false,rabbit_mirror_queue_master,
>
>                                {state,
>
>                                 {resource,<<"eventing">>,queue,
>
>                                  <<"SalesCenter2.BPClaims_ClosedClaim">>},
>
>                                 <5297.333.0>,<5297.4223.0>,
>
>                                 rabbit_variable_queue,
>
>                                 {vqstate,
>
>                                  {0,{[],[]}},
>
>                                  {0,{[],[]}},
>
>                                  {delta,undefined,0,undefined},
>
>                                  {0,{[],[]}},
>
>                                  {0,{[],[]}},
>
>                                  0,
>
>                                  {0,nil},
>
>                                  {0,nil},
>
>                                  {qistate,
>
>
> "d:/RabbitMQ/db/rabbit at DIX-D-EVGAPP-02-mnesia/queues/6GQ2ZHJGDF7X2GH1FS0QPJX2O",
>
>                                   {{dict,0,16,16,8,80,48,
>
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                      [],[]},
>
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                       [],[],[]}}},
>
>                                    []},
>
>                                   undefined,0,65536,
>
>                                   #Fun<rabbit_variable_queue.2.51560583>,
>
>                                   {0,nil}},
>
>                                  {{client_msstate,msg_store_persistent,
>
>
> <<26,131,31,121,222,176,41,144,168,192,42,
>
>                                      159,222,13,179,107>>,
>
>                                    {dict,0,16,16,8,80,48,
>
>
>                      {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                      [],[]},
>
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                       [],[],[]}}},
>
>                                    {state,311371,
>
>
> "d:/RabbitMQ/db/rabbit at DIX-D-EVGAPP-02-mnesia/msg_store_persistent"},
>
>                                    rabbit_msg_store_ets_index,
>
>
> "d:/RabbitMQ/db/rabbit at DIX-D-EVGAPP-02-mnesia/msg_store_persistent",
>
>
> <5297.266.0>,315468,307274,319565,323662},
>
>                                   {client_msstate,msg_store_transient,
>
>
> <<32,49,130,217,86,65,129,214,32,140,24,34,
>
>                                      254,129,171,73>>,
>
>                                    {dict,0,16,16,8,80,48,
>
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                      [],[]},
>
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                       [],[],[]}}},
>
>                                    {state,290886,
>
>
> "d:/RabbitMQ/db/rabbit at DIX-D-EVGAPP-02-mnesia/msg_store_transient"},
>
>                                    rabbit_msg_store_ets_index,
>
>
> "d:/RabbitMQ/db/rabbit at DIX-D-EVGAPP-02-mnesia/msg_store_transient",
>
>
> <5297.261.0>,294983,286789,299080,303177}},
>
>                                  true,0,0,0,infinity,0,0,0,0,0,
>
>
> {rates,0.0,0.0,0.0,0.0,{1406,466723,462160}},
>
>                                  {0,nil},
>
>                                  {0,nil},
>
>                                  {0,nil},
>
>                                  {0,nil},
>
>                                  0,0},
>
>                                 {dict,0,16,16,8,80,48,
>
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                   []},
>
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                    [],[]}}},
>
>                                 [],
>
>                                 {set,0,16,16,8,80,48,
>
>
>                         {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                   []},
>
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                    [],[]}}}},
>
>                                {state,
>
>                                 {queue,[],[],0},
>
>                                 {active,1406466722448182,1.0}},
>
>                                undefined,undefined,undefined,undefined,
>
>                                {state,fine,5000,undefined},
>
>                                {0,nil},
>
>                                undefined,undefined,undefined,
>
>                                {state,
>
>                                 {dict,0,16,16,8,80,48,
>
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                   []},
>
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                    [],[]}}},
>
>                                 delegate},
>
>                                {resource,<<"eventing">>,exchange,
>
>                                 <<"EnterpriseEventDeadLetter">>},
>
>                                <<"SalesCenter2.BPClaims_ClosedClaim">>,
>
>                                undefined,2,running}],
>
>                              []},
>
>                             {gen_server2,handle_msg,2,[]},
>
>                             {proc_lib,wake_up,3,
>
>                              [{file,"proc_lib.erl"},{line,249}]}]},
>
>                           {gen_server2,call,
>
>                            [<5297.332.0>,
>
>                             {add_on_right,{20,<0.323.0>}},
>
>                             infinity]}}}
>
> ** When Server state == {state,
>
>                           {amqqueue,
>
>                            {resource,<<"eventing">>,queue,
>
>
> <<"Insight.BPClaims_ModifiedWorkNotAvailable">>},
>
>                            true,false,none,
>
>                            [{<<"x-dead-letter-exchange">>,longstr,
>
>                              <<"EnterpriseEventDeadLetter">>},
>
>                             {<<"x-dead-letter-routing-key">>,longstr,
>
>
> <<"Insight.BPClaims_ModifiedWorkNotAvailable">>}],
>
>                            <5251.335.0>,
>
>                            [<5297.331.0>],
>
>                            [<5297.331.0>],
>
>                            [{vhost,<<"eventing">>},
>
>                             {name,<<"ha-all">>},
>
>                             {pattern,<<"^.*">>},
>
>                             {'apply-to',<<"queues">>},
>
>                             {definition,
>
>                              [{<<"ha-mode">>,<<"all">>},
>
>                               {<<"ha-sync-mode">>,<<"automatic">>}]},
>
>                             {priority,0}],
>
>                            [{<5297.332.0>,<5297.331.0>},
>
>                             {<5251.336.0>,<5251.335.0>}],
>
>                            []},
>
>                           <0.323.0>,rabbit_variable_queue,
>
>                           {vqstate,
>
>                            {0,{[],[]}},
>
>                            {0,{[],[]}},
>
>                            {delta,undefined,0,undefined},
>
>                            {0,{[],[]}},
>
>                            {0,{[],[]}},
>
>                            0,
>
>                            {0,nil},
>
>                            {0,nil},
>
>                            {qistate,
>
>
> "d:/RabbitMQ/db/rabbit at STR-D-EVGAPP-02-mnesia/queues/11YNGR2UMDIGSF4OWRUUJ2HUX",
>
>                             {{dict,0,16,16,8,80,48,
>
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                 []}}},
>
>                              []},
>
>                             undefined,0,65536,
>
>                             #Fun<rabbit_variable_queue.2.51560583>,
>
>                             {0,nil}},
>
>                            {{client_msstate,msg_store_persistent,
>
>
> <<142,49,10,175,39,218,164,74,2,215,253,147,201,
>
>                                168,141,2>>,
>
>                              {dict,0,16,16,8,80,48,
>
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                 []}}},
>
>                              {state,303177,
>
>
> "d:/RabbitMQ/db/rabbit at STR-D-EVGAPP-02-mnesia/msg_store_persistent"},
>
>                              rabbit_msg_store_ets_index,
>
>
> "d:/RabbitMQ/db/rabbit at STR-D-EVGAPP-02-mnesia/msg_store_persistent",
>
>                              <0.251.0>,307274,299080,311371,315468},
>
>                             {client_msstate,msg_store_transient,
>
>
> <<18,152,170,252,55,149,243,37,252,234,131,180,53,
>
>                                66,14,182>>,
>
>                              {dict,0,16,16,8,80,48,
>
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                 []}}},
>
>                              {state,282692,
>
>
> "d:/RabbitMQ/db/rabbit at STR-D-EVGAPP-02-mnesia/msg_store_transient"},
>
>                              rabbit_msg_store_ets_index,
>
>
> "d:/RabbitMQ/db/rabbit at STR-D-EVGAPP-02-mnesia/msg_store_transient",
>
>                              <0.246.0>,286789,278595,290886,294983}},
>
>                            true,0,0,0,infinity,0,0,0,0,0,
>
>                            {rates,0.0,0.0,0.0,0.0,{1406,466811,43211}},
>
>                            {0,nil},
>
>                            {0,nil},
>
>                            {0,nil},
>
>                            {0,nil},
>
>                            0,0},
>
>                           undefined,undefined,
>
>                           {dict,0,16,16,8,80,48,
>
>
>    {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
>
>                           {dict,0,16,16,8,80,48,
>
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
>
>                           {dict,0,16,16,8,80,48,
>
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
>
>                           {state,
>
>                            {dict,0,16,16,8,80,48,
>
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>
>                             {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                               []}}},
>
>                            delegate},
>
>                           undefined}
>
> ** Reason for termination ==
>
> ** {{function_clause,
>
>          [{rabbit_amqqueue_process,handle_call,
>
>               [{add_on_right,{20,<0.323.0>}},
>
>                {<0.323.0>,#Ref<0.0.0.2348>},
>
>                {q,{amqqueue,
>
>                       {resource,<<"eventing">>,queue,
>
>                           <<"SalesCenter2.BPClaims_ClosedClaim">>},
>
>                       true,false,none,
>
>                       [{<<"x-dead-letter-exchange">>,longstr,
>
>                         <<"EnterpriseEventDeadLetter">>},
>
>                        {<<"x-dead-letter-routing-key">>,longstr,
>
>                         <<"SalesCenter2.BPClaims_ClosedClaim">>}],
>
>                       <5297.332.0>,
>
>                       [<5251.310.0>],
>
>                       [<5251.310.0>],
>
>                       [{vhost,<<"eventing">>},
>
>                        {name,<<"ha-all">>},
>
>                        {pattern,<<"^.*">>},
>
>                        {'apply-to',<<"queues">>},
>
>                        {definition,
>
>                            [{<<"ha-mode">>,<<"all">>},
>
>                             {<<"ha-sync-mode">>,<<"automatic">>}]},
>
>                        {priority,0}],
>
>
> [{<5251.311.0>,<5251.310.0>},{<5297.333.0>,<5297.332.0>}],
>
>                       []},
>
>                   none,false,rabbit_mirror_queue_master,
>
>                   {state,
>
>                       {resource,<<"eventing">>,queue,
>
>                           <<"SalesCenter2.BPClaims_ClosedClaim">>},
>
>                       <5297.333.0>,<5297.4223.0>,rabbit_variable_queue,
>
>                       {vqstate,
>
>                           {0,{[],[]}},
>
>                           {0,{[],[]}},
>
>                           {delta,undefined,0,undefined},
>
>                           {0,{[],[]}},
>
>                           {0,{[],[]}},
>
>                           0,
>
>                           {0,nil},
>
>                           {0,nil},
>
>                           {qistate,
>
>
>           "d:/RabbitMQ/db/rabbit at DIX-D-EVGAPP-02-mnesia/queues/6GQ2ZHJGDF7X2GH1FS0QPJX2O",
>
>                               {{dict,0,16,16,8,80,48,
>
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                     [],[]},
>
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                      [],[]}}},
>
>                                []},
>
>                               undefined,0,65536,
>
>                               #Fun<rabbit_variable_queue.2.51560583>,
>
>                               {0,nil}},
>
>                           {{client_msstate,msg_store_persistent,
>
>
> <<26,131,31,121,222,176,41,144,168,192,42,159,
>
>                                  222,13,179,107>>,
>
>                                {dict,0,16,16,8,80,48,
>
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                     [],[]},
>
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                      [],[]}}},
>
>                                {state,311371,
>
>
> "d:/RabbitMQ/db/rabbit at DIX-D-EVGAPP-02-mnesia/msg_store_persistent"},
>
>                                rabbit_msg_store_ets_index,
>
>
> "d:/RabbitMQ/db/rabbit at DIX-D-EVGAPP-02-mnesia/msg_store_persistent",
>
>                                <5297.266.0>,315468,307274,319565,323662},
>
>                            {client_msstate,msg_store_transient,
>
>
> <<32,49,130,217,86,65,129,214,32,140,24,34,254,
>
>                                  129,171,73>>,
>
>                                {dict,0,16,16,8,80,48,
>
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                     [],[]},
>
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
>                                      [],[]}}},
>
>                                {state,290886,
>
>
>        "d:/RabbitMQ/db/rabbit at DIX-D-EVGAPP-02-mnesia/msg_store_transient"},
>
>                                rabbit_msg_store_ets_index,
>
>
> "d:/RabbitMQ/db/rabbit at DIX-D-EVGAPP-02-mnesia/msg_store_transient",
>
>                                <5297.261.0>,294983,286789,299080,303177}},
>
>                           true,0,0,0,infinity,0,0,0,0,0,
>
>                           {rates,0.0,0.0,0.0,0.0,{1406,466723,462160}},
>
>                           {0,nil},
>
>                           {0,nil},
>
>                           {0,nil},
>
>                           {0,nil},
>
>                           0,0},
>
>                       {dict,0,16,16,8,80,48,
>
>                           {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
>
>                       [],
>
>                       {set,0,16,16,8,80,48,
>
>                           {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}}},
>
>                   {state,{queue,[],[],0},{active,1406466722448182,1.0}},
>
>                   undefined,undefined,undefined,undefined,
>
>                   {state,fine,5000,undefined},
>
>                   {0,nil},
>
>                   undefined,undefined,undefined,
>
>                   {state,
>
>                       {dict,0,16,16,8,80,48,
>
>                           {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
>
>                       delegate},
>
>                   {resource,<<"eventing">>,exchange,
>
>                       <<"EnterpriseEventDeadLetter">>},
>
>
> <<"SalesCenter2.BPClaims_ClosedClaim">>,undefined,2,running}],
>
>               []},
>
>           {gen_server2,handle_msg,2,[]},
>
>           {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,249}]}]},
>
>
> {gen_server2,call,[<5297.332.0>,{add_on_right,{20,<0.323.0>}},infinity]}}
>
> This e-mail is confidential.  If you are not the intended recipient, you
> must not disclose or use the information contained in it.  If you have
> received this e-mail in error, please tell us immediately by return
> e-mail and delete the document. No recipient may use the information in
> this e-mail in violation of any civil or criminal statute. Sentry
> disclaims all liability for any unauthorized uses of this e-mail or its
> contents. Sentry accepts no liability or responsibility for any damage
> caused by any virus transmitted with this e-mail.
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list has moved to https://groups.google.com/forum/#!forum/rabbitmq-users,
> please subscribe to the new list!
>
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From ankur5.c at tcs.com  Tue Jul 29 06:24:19 2014
From: ankur5.c at tcs.com (Ankur5 C)
Date: Tue, 29 Jul 2014 10:54:19 +0530
Subject: [rabbitmq-discuss] Topic authorization and authentication
In-Reply-To: <etPan.53ce5396.5bd062c2.60fb@mercurio.local>
References: <OF92CBDD5E.BA53B17F-ON65257D16.002508DD-65257D16.0025254A@tcs.com>
 <etPan.53c8e2f8.436c6125.be3d@mercurio.local>
 <OF8551CB4B.B3089471-ON65257D19.0032CFE0-65257D19.0032FAB0@LocalDomain>
 <OF94CFA50B.97EF5530-ON65257D19.0035320C-65257D19.00354BDE@tcs.com>
 <etPan.53c8ee3b.2443a858.be3d@mercurio.local>
 <OFE6A6F4E8.6E051EC3-ON65257D19.0039A0A9-65257D19.0039F2A2@tcs.com>
 <etPan.53c91b4d.327b23c6.910@mercurio.local>
 <OF577C2AF6.A6EEBF09-ON65257D1D.00243F1F-65257D1D.00259CE4@tcs.com>
 <etPan.53ce3b61.625558ec.60fb@mercurio.local>
 <OFA3AA0936.ADB86FF6-ON65257D1D.003FC4BF-65257D1D.00403AE9@tcs.com>
 <etPan.53ce5066.515f007c.60fb@mercurio.local>
 <OFFDBE1D75.ED35DBBF-ON65257D1D.0041B10F-65257D1D.0041EC2
 <etPan.53ce5396.5bd062c2.60fb@mercurio.local>
Message-ID: <OFD562E7D9.F2A49548-ON65257D24.001D522E-65257D24.001DB1EE@tcs.com>

Hi,

Is there any plan to implement rabbitmq's topic authorization and 
authentication ? Our requirement is the same as mentioned in :

https://stormpath.com/blog/lightweight-authentication-and-authorization-for-mqtt-with-stormpath/

Topic based authorization and authentication is required against the MQTT 
plugin of rabbitmq.



Thanks and Regards,
Ankur Chakraborty
=====-----=====-----=====
Notice: The information contained in this e-mail
message and/or attachments to it may contain 
confidential or privileged information. If you are 
not the intended recipient, any dissemination, use, 
review, distribution, printing or copying of the 
information contained in this e-mail message 
and/or attachments to it are strictly prohibited. If 
you have received this communication in error, 
please notify us by reply e-mail or telephone and 
immediately and permanently delete the message 
and any attachments. Thank you


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140729/604e8229/attachment.html>

From mklishin at gopivotal.com  Tue Jul 29 06:27:06 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 29 Jul 2014 09:27:06 +0400
Subject: [rabbitmq-discuss] Topic authorization and authentication
In-Reply-To: <OFD562E7D9.F2A49548-ON65257D24.001D522E-65257D24.001DB1EE@tcs.com>
References: <OFD562E7D9.F2A49548-ON65257D24.001D522E-65257D24.001DB1EE@tcs.com>
Message-ID: <etPan.53d730c8.327b23c6.16c8c@mercurio.local>

On 29 July 2014 at 09:25:39, Ankur5 C (ankur5.c at tcs.com) wrote:
> > Is there any plan to implement rabbitmq's topic authorization 
> and authentication ? Our requirement is the same as mentioned 
> in :
> 
> https://stormpath.com/blog/lightweight-authentication-and-authorization-for-mqtt-with-stormpath/ 
> 
> Topic based authorization and authentication is required against 
> the MQTT plugin of rabbitmq.

MQTT 3.1.1 (the protocol) does not have a concept of topic authorization.
As soon as it does, we'll look into adding it to RabbitMQ MQTT plugin.
-- 
MK 

Staff Software Engineer, Pivotal/RabbitMQ

From mklishin at pivotal.io  Tue Jul 29 06:22:24 2014
From: mklishin at pivotal.io (Michael Klishin)
Date: Tue, 29 Jul 2014 09:22:24 +0400
Subject: [rabbitmq-discuss] ANN March Hare 2.5.1 is released
Message-ID: <etPan.53d72fa9.6b8b4567.16c8c@mercurio.local>

March Hare [1] is a fast, feature rich RabbitMQ client for JRuby.

Release notes:
http://blog.rubyrabbitmq.info/blog/2014/07/25/march-hare-2-dot-5-1-is-released/?

1. http://rubymarchhare.info
--  
MK

Staff Software Engineer, Pivotal/RabbitMQ

From mklishin at pivotal.io  Tue Jul 29 07:30:48 2014
From: mklishin at pivotal.io (Michael Klishin)
Date: Tue, 29 Jul 2014 10:30:48 +0400
Subject: [rabbitmq-discuss] ANN Bunny 1.4.0 is released
Message-ID: <etPan.53d73fb6.74b0dc51.16c8c@mercurio.local>

Bunny [1] is a Ruby RabbitMQ client built for ease of use.

Release notes:
http://blog.rubyrabbitmq.info/blog/2014/07/29/bunny-1-dot-4-0-is-released/?

1. http://rubybunny.info
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From scott.kendall.mcfadden at gmail.com  Tue Jul 29 16:37:39 2014
From: scott.kendall.mcfadden at gmail.com (Scott McFadden)
Date: Tue, 29 Jul 2014 08:37:39 -0700 (PDT)
Subject: [rabbitmq-discuss] Side by side support for 2.8.6 / 3.3.0?
Message-ID: <669b713a-2fa9-46d5-a707-893aa2d667e6@googlegroups.com>

Can two instances of RabbitMQ server be run side by side (v2.8.6 and 
v3.3.0) on Windows Server 2008?

thanks

scott
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140729/7a93a0be/attachment.html>

From simon at rabbitmq.com  Tue Jul 29 16:48:12 2014
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 29 Jul 2014 16:48:12 +0100
Subject: [rabbitmq-discuss] Side by side support for 2.8.6 / 3.3.0?
In-Reply-To: <669b713a-2fa9-46d5-a707-893aa2d667e6@googlegroups.com>
References: <669b713a-2fa9-46d5-a707-893aa2d667e6@googlegroups.com>
Message-ID: <53D7C23C.2000906@rabbitmq.com>

On 29/07/14 16:37, Scott McFadden wrote:
> Can two instances of RabbitMQ server be run side by side (v2.8.6 and
> v3.3.0) on Windows Server 2008?

Yes. It's a bit fiddly though.

You'll need to install at least one of the versions manually, the .exe 
installer assumes there's only one installation on the machine:

http://www.rabbitmq.com/install-windows-manual.html

You'll need to set various environment variables to separate the two:

http://www.rabbitmq.com/configure.html
http://www.rabbitmq.com/relocate.html

I would think you'd need at least RABBITMQ_BASE, RABBITMQ_NODE_PORT, 
RABBITMQ_NODENAME, RABBITMQ_PLUGINS_DIR and RABBITMQ_PLUGINS_EXPAND_DIR. 
Also RABBITMQ_SERVICENAME if you want to install both as services.

At least 2.8.6 and 3.3.4 use different ports for the management plugin 
by default, so you don't have to reconfigure that.

Cheers, Simon

From scott.kendall.mcfadden at gmail.com  Tue Jul 29 16:57:53 2014
From: scott.kendall.mcfadden at gmail.com (Scott McFadden)
Date: Tue, 29 Jul 2014 08:57:53 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ store location?
Message-ID: <a2dd84b0-cea8-4561-b2fe-bcc4a3a689a7@googlegroups.com>

Where is the default message store location for RabbitMQ 3.x for Windows? 
 How can you change this from C drive to point to a SAN drive?

thanks

scott
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140729/b261afeb/attachment.html>

From scott.kendall.mcfadden at gmail.com  Wed Jul 30 02:42:53 2014
From: scott.kendall.mcfadden at gmail.com (Scott McFadden)
Date: Tue, 29 Jul 2014 18:42:53 -0700 (PDT)
Subject: [rabbitmq-discuss] Relocate Rabbit log files on Windows 2008R2
Message-ID: <693b2751-0d17-4f9d-b698-29a250e41587@googlegroups.com>

I installed RabbitMQ 3.3.0 on our dev Win2008R2 box as my domain user 
acme\smcfadden.  After install was complete, I changed the Windows service 
identity
from amce\smcfadden to acme\rabbitservice (acme\rabbitservice is a local 
admin).  Also, I added the following system level environment variable:

RABBITMQ_LOG_BASE = C:\Logs\RabbitMQ

I then restarted the RabbitMQ service via the MMC snapin for services.

Unfortunately, the log files still write to 
C:\Users\smcfadden\AppData\Roaming\RabbitMQ instead of C:\Logs\RabbitMQ

Please advise how to change log file location.



scott
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140729/ff92cd2b/attachment.html>

From mklishin at gopivotal.com  Wed Jul 30 04:11:37 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 30 Jul 2014 07:11:37 +0400
Subject: [rabbitmq-discuss] Relocate Rabbit log files on Windows 2008R2
In-Reply-To: <693b2751-0d17-4f9d-b698-29a250e41587@googlegroups.com>
References: <693b2751-0d17-4f9d-b698-29a250e41587@googlegroups.com>
Message-ID: <etPan.53d86284.46e87ccd.16c8c@mercurio.local>

On 30 July 2014 at 05:45:03, Scott McFadden (scott.kendall.mcfadden at gmail.com) wrote:
> > I then restarted the RabbitMQ service via the MMC snapin for  
> services.
>  
> Unfortunately, the log files still write to C:\Users\smcfadden\AppData\Roaming\RabbitMQ  
> instead of C:\Logs\RabbitMQ

From?http://www.rabbitmq.com/configure.html:

?Create or edit the system variable name and value. For environment changes to take effect on Windows, the service must be re-installed. It is not sufficient to restart the service.?

?
As a side note, the official RabbitMQ mailing list is rabbitmq-users. rabbitmq-discuss
is an unofficial mirror to the legacy list.

Please use?groups.google.com/forum/#!forum/rabbitmq-users as rabbitmq-discuss will be
completely discontinued on Oct 1st.
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From mariusz.wojcik at hotmail.co.uk  Wed Jul 30 09:05:45 2014
From: mariusz.wojcik at hotmail.co.uk (Mariusz Wojcik)
Date: Wed, 30 Jul 2014 01:05:45 -0700 (PDT)
Subject: [rabbitmq-discuss] Relocate Rabbit log files on Windows 2008R2
In-Reply-To: <693b2751-0d17-4f9d-b698-29a250e41587@googlegroups.com>
References: <693b2751-0d17-4f9d-b698-29a250e41587@googlegroups.com>
Message-ID: <5282e9be-66df-4faa-afdc-c39c35bc044e@googlegroups.com>

This is a wild guess, but try reinstalling RabbitMQ server.
I haven't changed log file location, but I had issues with config file 
location on windows 2012, where RabbitMQ was reporting it couldn't find the 
file even though the file was there and was accessible. Also changing 
config file location in env. variable didn't help. But reinstalling 
RabbitMQ service worked.

Cheers,

Mariusz

On Wednesday, 30 July 2014 02:42:53 UTC+1, Scott McFadden wrote:
>
> I installed RabbitMQ 3.3.0 on our dev Win2008R2 box as my domain user 
> acme\smcfadden.  After install was complete, I changed the Windows service 
> identity
> from amce\smcfadden to acme\rabbitservice (acme\rabbitservice is a local 
> admin).  Also, I added the following system level environment variable:
>
> RABBITMQ_LOG_BASE = C:\Logs\RabbitMQ
>
> I then restarted the RabbitMQ service via the MMC snapin for services.
>
> Unfortunately, the log files still write to 
> C:\Users\smcfadden\AppData\Roaming\RabbitMQ instead of C:\Logs\RabbitMQ
>
> Please advise how to change log file location.
>
>
>
> scott
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140730/24080608/attachment.html>

From ankur5.c at tcs.com  Wed Jul 30 13:26:20 2014
From: ankur5.c at tcs.com (Ankur5 C)
Date: Wed, 30 Jul 2014 17:56:20 +0530
Subject: [rabbitmq-discuss] Rabbitmq ssl error
In-Reply-To: <etPan.53d730c8.327b23c6.16c8c@mercurio.local>
References: <OFD562E7D9.F2A49548-ON65257D24.001D522E-65257D24.001DB1EE@tcs.com>
 <etPan.53d730c8.327b23c6.16c8c@mercurio.local>
Message-ID: <OF2677A811.C35C623D-ON65257D25.00441D70-65257D25.004454D5@tcs.com>

Hi,

I am trying to connect rabbitmq over the ssl port but I am getting :

accepting AMQP connection <0.231.0> (192.168.161.171:65208 -> 
192.168.161.197:5671)

=ERROR REPORT==== 30-Jul-2014::17:53:07 ===
error on AMQP connection <0.231.0>:
{ssl_upgrade_error,timeout}

My config file is :

[{rabbit,        [{tcp_listeners,    [5672]},{ssl_listeners, [5671]}, 
                        {ssl_options, 
[{cacertfile,"/etc/rabbitmq/testca/cacert.pem"},
                    {certfile,"/etc/rabbitmq/server/cert.pem"},
                    {keyfile,"/etc/rabbitmq/server/key.pem"},
                    {verify,verify_peer},
                    {fail_if_no_peer_cert,false}]}]}
].

I am using the example https://www.rabbitmq.com/ssl.html , Connecting 
without validating certificates.

Please suggest.

Thanks and Regards,
Ankur Chakraborty




From:   Michael Klishin <mklishin at gopivotal.com>
To:     Ankur5 C <ankur5.c at tcs.com>
Cc:     Legacy list about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
Date:   29-07-2014 10:57
Subject:        Re: [rabbitmq-discuss] Topic authorization and 
authentication



On 29 July 2014 at 09:25:39, Ankur5 C (ankur5.c at tcs.com) wrote:
> > Is there any plan to implement rabbitmq's topic authorization 
> and authentication ? Our requirement is the same as mentioned 
> in :
> 
> 
https://stormpath.com/blog/lightweight-authentication-and-authorization-for-mqtt-with-stormpath/ 

> 
> Topic based authorization and authentication is required against 
> the MQTT plugin of rabbitmq.

MQTT 3.1.1 (the protocol) does not have a concept of topic authorization.
As soon as it does, we'll look into adding it to RabbitMQ MQTT plugin.
-- 
MK 

Staff Software Engineer, Pivotal/RabbitMQ

=====-----=====-----=====
Notice: The information contained in this e-mail
message and/or attachments to it may contain 
confidential or privileged information. If you are 
not the intended recipient, any dissemination, use, 
review, distribution, printing or copying of the 
information contained in this e-mail message 
and/or attachments to it are strictly prohibited. If 
you have received this communication in error, 
please notify us by reply e-mail or telephone and 
immediately and permanently delete the message 
and any attachments. Thank you


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140730/9c0e5f63/attachment.html>

From mklishin at gopivotal.com  Wed Jul 30 15:04:01 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 30 Jul 2014 18:04:01 +0400
Subject: [rabbitmq-discuss] Rabbitmq ssl error
In-Reply-To: <OF2677A811.C35C623D-ON65257D25.00441D70-65257D25.004454D5@tcs.com>
References: <OFD562E7D9.F2A49548-ON65257D24.001D522E-65257D24.001DB1EE@tcs.com>
 <etPan.53d730c8.327b23c6.16c8c@mercurio.local>
 <OF2677A811.C35C623D-ON65257D25.00441D70-65257D25.004454D5@tcs.com>
Message-ID: <etPan.53d8fb6f.327b23c6.5dac@mercurio.local>



On 30 July 2014 at 16:27:30, Ankur5 C (ankur5.c at tcs.com) wrote:
> > I am trying to connect rabbitmq over the ssl port but I am getting  
> :
>  
> accepting AMQP connection <0.231.0> (192.168.161.171:65208  
> -> 192.168.161.197:5671)
>  
> =ERROR REPORT==== 30-Jul-2014(http://airmail.calendar/2014-07-30%2012:00:00%20GMT+4)::17:53:07  
> ===
> error on AMQP connection <0.231.0>:
> {ssl_upgrade_error,timeout}

SSL upgrade timeout means, a TCP connection was open but never proceeded to perform
the TLS handshake.

So you somehow end up connecting with a non-TLS client on the TLS port.

As a side note, please *always* start a new thread for a new problem, instead of
replying to an existing one. It is incredibly confusing to see messages from 2 unrelated
threads in the same archive thread.?
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From bloodbaronofvizkopa at gmail.com  Wed Jul 30 20:53:29 2014
From: bloodbaronofvizkopa at gmail.com (bloodBaron)
Date: Wed, 30 Jul 2014 12:53:29 -0700 (PDT)
Subject: [rabbitmq-discuss] Drop new received messages when a queue is full
Message-ID: <1406750009013-36925.post@n5.nabble.com>

According to http://www.rabbitmq.com/maxlength.html,
"Messages will be dropped or dead-lettered from the front of the queue to
make room for new messages once the limit is reached."

Is there a way to drop/reject the new messages instead of dropping the old
messages on the queue?

Thx!

Tom



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Drop-new-received-messages-when-a-queue-is-full-tp36925.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mklishin at gopivotal.com  Wed Jul 30 21:05:19 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 31 Jul 2014 00:05:19 +0400
Subject: [rabbitmq-discuss] Drop new received messages when a queue is
 full
In-Reply-To: <1406750009013-36925.post@n5.nabble.com>
References: <1406750009013-36925.post@n5.nabble.com>
Message-ID: <etPan.53d95019.6b8b4567.127c1@mercurio.local>

?On 30 July 2014 at 23:54:42, bloodBaron (bloodbaronofvizkopa at gmail.com) wrote:
> > Is there a way to drop/reject the new messages instead of dropping  
> the old
> messages on the queue?

There is no.
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From bloodbaronofvizkopa at gmail.com  Wed Jul 30 21:26:23 2014
From: bloodbaronofvizkopa at gmail.com (bloodBaron)
Date: Wed, 30 Jul 2014 13:26:23 -0700 (PDT)
Subject: [rabbitmq-discuss] Drop new received messages when a queue is
	full
In-Reply-To: <etPan.53d95019.6b8b4567.127c1@mercurio.local>
References: <1406750009013-36925.post@n5.nabble.com>
 <etPan.53d95019.6b8b4567.127c1@mercurio.local>
Message-ID: <1406751983579-36927.post@n5.nabble.com>

Michael Klishin-2 wrote
> ?On 30 July 2014 at 23:54:42, bloodBaron (

> bloodbaronofvizkopa@

> ) wrote:
>> > Is there a way to drop/reject the new messages instead of dropping  
>> the old
>> messages on the queue?
> 
> There is no.
> --  
> MK  
> 
> Staff Software Engineer, Pivotal/RabbitMQ
> _______________________________________________
> rabbitmq-discuss mailing list has moved to
> https://groups.google.com/forum/#!forum/rabbitmq-users,
> please subscribe to the new list!

> rabbitmq-discuss at .rabbitmq

> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

So that also means it's impossible to unbind a queue from an exchange when
the queue is full, isn't it?

Thanks a lot!




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Drop-new-received-messages-when-a-queue-is-full-tp36925p36927.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From videlalvaro at gmail.com  Wed Jul 30 21:34:52 2014
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 30 Jul 2014 22:34:52 +0200
Subject: [rabbitmq-discuss] Drop new received messages when a queue is
	full
In-Reply-To: <1406751983579-36927.post@n5.nabble.com>
References: <1406750009013-36925.post@n5.nabble.com>
 <etPan.53d95019.6b8b4567.127c1@mercurio.local>
 <1406751983579-36927.post@n5.nabble.com>
Message-ID: <CAMcAHLU2yx-PbWPvBY+fBY-axXXeOh5hir8MccaV_jBJ+ExqfQ@mail.gmail.com>

Hi,

On Wed, Jul 30, 2014 at 10:26 PM, bloodBaron <bloodbaronofvizkopa at gmail.com>
wrote:

> Michael Klishin-2 wrote
> >  On 30 July 2014 at 23:54:42, bloodBaron (
>
> > bloodbaronofvizkopa@
>
> > ) wrote:
> >> > Is there a way to drop/reject the new messages instead of dropping
> >> the old
> >> messages on the queue?
>
>
Queue contents and bindings are not related. You can bind/unbind queues
with messages, or bind/unbind empty queues as well.

If you want to drop new messages, then use a per-queue-TTL  = 0, see:
https://www.rabbitmq.com/blog/2014/01/23/preventing-unbounded-buffers-with-rabbitmq/#noqueueingatall

Cheers,

-Alvaro
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140730/660b82b8/attachment.html>

From ankur5.c at tcs.com  Thu Jul 31 06:16:02 2014
From: ankur5.c at tcs.com (Ankur5 C)
Date: Thu, 31 Jul 2014 10:46:02 +0530
Subject: [rabbitmq-discuss] Error connecting an SSL port in Rabbitmq without
	validating certificates
In-Reply-To: <OF2677A811.C35C623D-ON65257D25.00441D70-65257D25.00445033@LocalDomain>
References: <OFD562E7D9.F2A49548-ON65257D24.001D522E-65257D24.001DB1EE@tcs.com>
 <etPan.53d730c8.327b23c6.16c8c@mercurio.local>
 <OF2677A811.C35C623D-ON65257D25.00441D70-65257D25.00445033@LocalDomain>
Message-ID: <OF8FA6AB8C.1A3E0204-ON65257D26.001CD08E-65257D26.001CEF60@tcs.com>

Hi,

I am trying to connect rabbitmq over the ssl port but I am getting :

accepting AMQP connection <0.231.0> (192.168.161.171:65208 ->
192.168.161.197:5671)

=ERROR REPORT==== 30-Jul-2014::17:53:07 ===
error on AMQP connection <0.231.0>:
{ssl_upgrade_error,timeout}

My config file is :

[{rabbit,        [{tcp_listeners,    [5672]},{ssl_listeners, [5671]},
			{ssl_options,
[{cacertfile,"/etc/rabbitmq/testca/cacert.pem"},
                    {certfile,"/etc/rabbitmq/server/cert.pem"},
                    {keyfile,"/etc/rabbitmq/server/key.pem"},
                    {verify,verify_peer},
                    {fail_if_no_peer_cert,false}]}]}
].

I am using the example https://www.rabbitmq.com/ssl.html , Connecting
without validating certificates.

Can you help me in this regard? Is there something which I am missing?

Thanks and Regards,
Ankur Chakraborty

=====-----=====-----=====
Notice: The information contained in this e-mail
message and/or attachments to it may contain 
confidential or privileged information. If you are 
not the intended recipient, any dissemination, use, 
review, distribution, printing or copying of the 
information contained in this e-mail message 
and/or attachments to it are strictly prohibited. If 
you have received this communication in error, 
please notify us by reply e-mail or telephone and 
immediately and permanently delete the message 
and any attachments. Thank you




From mklishin at pivotal.io  Thu Jul 31 06:20:47 2014
From: mklishin at pivotal.io (Michael Klishin)
Date: Thu, 31 Jul 2014 09:20:47 +0400
Subject: [rabbitmq-discuss] Error connecting an SSL port in Rabbitmq
 without validating certificates
In-Reply-To: <OF8FA6AB8C.1A3E0204-ON65257D26.001CD08E-65257D26.001CFCF4@tcs.com>
References: <OFD562E7D9.F2A49548-ON65257D24.001D522E-65257D24.001DB1EE@tcs.com>
 <etPan.53d730c8.327b23c6.16c8c@mercurio.local>
 <OF2677A811.C35C623D-ON65257D25.00441D70-65257D25.00445033@LocalDomain>
 <OF8FA6AB8C.1A3E0204-ON65257D26.001CD08E-65257D26.001CFCF4@tcs.com>
Message-ID: <etPan.53d9d249.625558ec.127c1@mercurio.local>

On 31 July 2014 at 09:16:43, Ankur5 C (ankur5.c at tcs.com) wrote:
> > I am trying to connect rabbitmq over the ssl port but I am getting  
> :
>  
> accepting AMQP connection <0.231.0> (192.168.161.171:65208  
> -> 192.168.161.197:5671)
>  
> =ERROR REPORT==== 30-Jul-2014::17:53:07  
> ===
> error on AMQP connection <0.231.0>:
> {ssl_upgrade_error,timeout}
>  
> My config file is :
>  
> [{rabbit, [{tcp_listeners, [5672]},{ssl_listeners, [5671]},  
> {ssl_options, [{cacertfile,"/etc/rabbitmq/testca/cacert.pem"},  
> {certfile,"/etc/rabbitmq/server/cert.pem"},
> {keyfile,"/etc/rabbitmq/server/key.pem"},
> {verify,verify_peer},
> {fail_if_no_peer_cert,false}]}]}
> ].
>  
> I am using the example https://www.rabbitmq.com/ssl.html,  
> Connecting without validating certificates.
>  
> Can you help me in this regard? Is there something which I am missing?  

Answered in?http://markmail.org/thread/b2di5s2b57ptv45n.

?lease stop using existing threads to ask new questions.
Start new threads instead.
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From ankur5.c at tcs.com  Thu Jul 31 06:32:54 2014
From: ankur5.c at tcs.com (Ankur5 C)
Date: Thu, 31 Jul 2014 11:02:54 +0530
Subject: [rabbitmq-discuss] Create an encrypted SSL connection without
	having to verify certificate
In-Reply-To: <etPan.53d9d249.625558ec.127c1@mercurio.local>
References: <OFD562E7D9.F2A49548-ON65257D24.001D522E-65257D24.001DB1EE@tcs.com>
 <etPan.53d730c8.327b23c6.16c8c@mercurio.local>
 <OF2677A811.C35C623D-ON65257D25.00441D70-65257D25.00445033@LocalDomain>
 <OF8FA6AB8C.1A3E0204-ON65257D26.001CD08E-65257D26.001CFCF4@tcs.com>
 <etPan.53d9d249.625558ec.127c1@mercurio.local>
Message-ID: <OFE69E352B.508C36BF-ON65257D26.001E0C7C-65257D26.001E7B0D@tcs.com>

Hi,

The example given in https://www.rabbitmq.com/ssl.html for connecting a 
TLS port 5671 is not working.

Exception:
 accepting AMQP connection <0.231.0> (192.168.161.171:65208   -> 
192.168.161.197:5671)
 =ERROR REPORT==== 30-Jul-2014::17:53:07 
 error on AMQP connection <0.231.0>:
 {ssl_upgrade_error,timeout}

In one of the solution you said "somehow end up connecting with a non-TLS 
client on the TLS port. "

So the example in https://www.rabbitmq.com/ssl.html for "Connecting 
without validating certificates", what is that? Is it a non TLS client? 
How to make it TLS?
I simply need to execute the java code right ? Or something more I have to 
do?

Please suggest how to resolve this.

Thanks and Regards,
Ankur Chakraborty
Tata Consultancy Services
Mailto: ankur5.c at tcs.com
Website: http://www.tcs.com
____________________________________________
Experience certainty.   IT Services
                        Business Solutions
                        Consulting
____________________________________________
=====-----=====-----=====
Notice: The information contained in this e-mail
message and/or attachments to it may contain 
confidential or privileged information. If you are 
not the intended recipient, any dissemination, use, 
review, distribution, printing or copying of the 
information contained in this e-mail message 
and/or attachments to it are strictly prohibited. If 
you have received this communication in error, 
please notify us by reply e-mail or telephone and 
immediately and permanently delete the message 
and any attachments. Thank you


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140731/5c133e58/attachment.html>

From mklishin at pivotal.io  Thu Jul 31 06:42:12 2014
From: mklishin at pivotal.io (Michael Klishin)
Date: Thu, 31 Jul 2014 09:42:12 +0400
Subject: [rabbitmq-discuss] Create an encrypted SSL connection without
 having to verify certificate
In-Reply-To: <OFE69E352B.508C36BF-ON65257D26.001E0C7C-65257D26.001E7B0D@tcs.com>
References: <OFD562E7D9.F2A49548-ON65257D24.001D522E-65257D24.001DB1EE@tcs.com>
 <etPan.53d730c8.327b23c6.16c8c@mercurio.local>
 <OF2677A811.C35C623D-ON65257D25.00441D70-65257D25.00445033@LocalDomain>
 <OF8FA6AB8C.1A3E0204-ON65257D26.001CD08E-65257D26.001CFCF4@tcs.com>
 <etPan.53d9d249.625558ec.127c1@mercurio.local>
 <OFE69E352B.508C36BF-ON65257D26.001E0C7C-65257D26.001E7B0D@tcs.com>
Message-ID: <etPan.53d9d74e.238e1f29.127c1@mercurio.local>

On 31 July 2014 at 09:33:17, Ankur5 C (ankur5.c at tcs.com) wrote:
> > The example given in https://www.rabbitmq.com/ssl.htmlfor  
> connecting a TLS port 5671 is not working.
>  
> Exception:
> accepting AMQP connection <0.231.0> (192.168.161.171:65208  
> -> 192.168.161.197:5671)
> =ERROR REPORT==== 30-Jul-2014::17:53:07  
> error on AMQP connection <0.231.0>:
> {ssl_upgrade_error,timeout}
>  
> In one of the solution you said "somehow end up connecting with  
> a non-TLS client on the TLS port. "

It is not a solution, it is the problem. A client connects to RabbitMQ on
port 5671, RabbitMQ expects the client to perform a TLS upgrade (this is
the default TLS connections port) but the client is not instructed to do it,
so it never does. After waiting for some time, RabbitMQ declares that
TLS upgrade has timed out and drops the TCP connection.

> So the example in https://www.rabbitmq.com/ssl.htmlfor "Connecting  
> without validating certificates", what is that? Is it a non TLS  
> client? How to make it TLS?

It demonstrates how to make the Java client use TLS connections, yes.

> I simply need to execute the java code right ? Or something more  
> I have to do?
>  
> Please suggest how to resolve this.

The "Connecting without validating certificates"
example on?https://www.rabbitmq.com/ssl.html demonstrates the bare
minimum you have to do but because you instructed RabbitMQ to perform
peer verification, you need to use the second example,
"Presenting and validating certificates".

The guide at?https://www.rabbitmq.com/ssl.html goes into a lot of detail
on every step you need to take to connect with TLS encryption from Java.

You can generate a bunch of certificates (including PCSK12 certificates used
by JDK's keytool) using tls-gen:
https://github.com/michaelklishin/tls-gen/

Unless a new thread is started (I've asked you to do so twice )
and you post your actual code, I'll refrain from replying to this thread.
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From ankur5.c at tcs.com  Thu Jul 31 06:59:19 2014
From: ankur5.c at tcs.com (Ankur5 C)
Date: Thu, 31 Jul 2014 11:29:19 +0530
Subject: [rabbitmq-discuss] Create an encrypted SSL connection without
	having to verify certificate
In-Reply-To: <etPan.53d9d74e.238e1f29.127c1@mercurio.local>
References: <OFD562E7D9.F2A49548-ON65257D24.001D522E-65257D24.001DB1EE@tcs.com>
 <etPan.53d730c8.327b23c6.16c8c@mercurio.local>
 <OF2677A811.C35C623D-ON65257D25.00441D70-65257D25.00445033@LocalDomain>
 <OF8FA6AB8C.1A3E0204-ON65257D26.001CD08E-65257D26.001CFCF4@tcs.com>
 <etPan.53d9d249.625558ec.127c1@mercurio.local>
 <OFE69E352B.508C36BF-ON65257D26.001E0C7C-65257D26.001E7B0D@tcs.com>
 <etPan.53d9d74e.238e1f29.127c1@mercurio.local>
Message-ID: <OF5E324DB9.FAEAFAB5-ON65257D26.0020534B-65257D26.0020E60D@tcs.com>

Applogies.

Will do that for sure. Currently there are some technical issues, and 
getting some messages of there are some request processing issues .

Would request you to please let me know how one can instruct rabbitmq not 
verify peer and use the one connect without validating certificates ?

My config file:

[{rabbit,        [{tcp_listeners,    [5672]},{ssl_listeners, [5671]}, 
                        {ssl_options, 
[{cacertfile,"/etc/rabbitmq/testca/cacert.pem"},
                    {certfile,"/etc/rabbitmq/server/cert.pem"},
                    {keyfile,"/etc/rabbitmq/server/key.pem"},
                    {verify,verify_none},
                    {fail_if_no_peer_cert,false}]}]}
].

I have already mentioned verify none.
Restarted the server , but nothing happened.Still getting some ssl upgrade 
error.

Thanks and Regards,
Ankur Chakraborty
_



From:   Michael Klishin <mklishin at pivotal.io>
To:     Ankur5 C <ankur5.c at tcs.com>
Cc:     Legacy list about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
Date:   31-07-2014 11:12
Subject:        Re: Create an encrypted SSL connection without having to 
verify certificate



On 31 July 2014 at 09:33:17, Ankur5 C (ankur5.c at tcs.com) wrote:
> > The example given in https://www.rabbitmq.com/ssl.htmlfor 
> connecting a TLS port 5671 is not working.
> 
> Exception:
> accepting AMQP connection <0.231.0> (192.168.161.171:65208 
> -> 192.168.161.197:5671)
> =ERROR REPORT==== 30-Jul-2014::17:53:07 
> error on AMQP connection <0.231.0>:
> {ssl_upgrade_error,timeout}
> 
> In one of the solution you said "somehow end up connecting with 
> a non-TLS client on the TLS port. "

It is not a solution, it is the problem. A client connects to RabbitMQ on
port 5671, RabbitMQ expects the client to perform a TLS upgrade (this is
the default TLS connections port) but the client is not instructed to do 
it,
so it never does. After waiting for some time, RabbitMQ declares that
TLS upgrade has timed out and drops the TCP connection.

> So the example in https://www.rabbitmq.com/ssl.htmlfor "Connecting 
> without validating certificates", what is that? Is it a non TLS 
> client? How to make it TLS?

It demonstrates how to make the Java client use TLS connections, yes.

> I simply need to execute the java code right ? Or something more 
> I have to do?
> 
> Please suggest how to resolve this.

The "Connecting without validating certificates"
example on https://www.rabbitmq.com/ssl.html demonstrates the bare
minimum you have to do but because you instructed RabbitMQ to perform
peer verification, you need to use the second example,
"Presenting and validating certificates".

The guide at https://www.rabbitmq.com/ssl.html goes into a lot of detail
on every step you need to take to connect with TLS encryption from Java.

You can generate a bunch of certificates (including PCSK12 certificates 
used
by JDK's keytool) using tls-gen:
https://github.com/michaelklishin/tls-gen/

Unless a new thread is started (I've asked you to do so twice )
and you post your actual code, I'll refrain from replying to this thread.
-- 
MK 

Staff Software Engineer, Pivotal/RabbitMQ

=====-----=====-----=====
Notice: The information contained in this e-mail
message and/or attachments to it may contain 
confidential or privileged information. If you are 
not the intended recipient, any dissemination, use, 
review, distribution, printing or copying of the 
information contained in this e-mail message 
and/or attachments to it are strictly prohibited. If 
you have received this communication in error, 
please notify us by reply e-mail or telephone and 
immediately and permanently delete the message 
and any attachments. Thank you


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140731/847b00b0/attachment.html>

From mklishin at pivotal.io  Thu Jul 31 07:02:46 2014
From: mklishin at pivotal.io (Michael Klishin)
Date: Thu, 31 Jul 2014 10:02:46 +0400
Subject: [rabbitmq-discuss] Create an encrypted SSL connection without
 having to verify certificate
In-Reply-To: <OF5E324DB9.FAEAFAB5-ON65257D26.0020534B-65257D26.0020E60D@tcs.com>
References: <OFD562E7D9.F2A49548-ON65257D24.001D522E-65257D24.001DB1EE@tcs.com>
 <etPan.53d730c8.327b23c6.16c8c@mercurio.local>
 <OF2677A811.C35C623D-ON65257D25.00441D70-65257D25.00445033@LocalDomain>
 <OF8FA6AB8C.1A3E0204-ON65257D26.001CD08E-65257D26.001CFCF4@tcs.com>
 <etPan.53d9d249.625558ec.127c1@mercurio.local>
 <OFE69E352B.508C36BF-ON65257D26.001E0C7C-65257D26.001E7B0D@tcs.com>
 <etPan.53d9d74e.238e1f29.127c1@mercurio.local>
 <OF5E324DB9.FAEAFAB5-ON65257D26.0020534B-65257D26.0020E60D@tcs.com>
Message-ID: <etPan.53d9dc22.46e87ccd.127c1@mercurio.local>

On 31 July 2014 at 09:59:23, Ankur5 C (ankur5.c at tcs.com) wrote:
> > Would request you to please let me know how one can instruct rabbitmq  
> not verify peer and use the one connect without validating certificates  
> ?
>  
> My config file:
>  
> [{rabbit, [{tcp_listeners, [5672]},{ssl_listeners, [5671]},  
> {ssl_options, [{cacertfile,"/etc/rabbitmq/testca/cacert.pem"},  
> {certfile,"/etc/rabbitmq/server/cert.pem"},
> {keyfile,"/etc/rabbitmq/server/key.pem"},
> {verify,verify_none},
> {fail_if_no_peer_cert,false}]}]}
> ].

This is all you need.

This line
{verify,verify_none},

means "perform no peer verification" (don't check that the client
is who it claims to be), while

{fail_if_no_peer_cert,false}

means "don't even bother checking if the client has a certificate".

With this configuration

factory.setPort(5671);
factory.useSslProtocol();

is all you need to do in the Java client to make it use TLS (technically, SSLv3).?
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From ankur5.c at tcs.com  Thu Jul 31 07:09:24 2014
From: ankur5.c at tcs.com (Ankur5 C)
Date: Thu, 31 Jul 2014 11:39:24 +0530
Subject: [rabbitmq-discuss] Create an encrypted SSL connection without
	having to verify certificate
In-Reply-To: <etPan.53d9dc22.46e87ccd.127c1@mercurio.local>
References: <OFD562E7D9.F2A49548-ON65257D24.001D522E-65257D24.001DB1EE@tcs.com>
 <etPan.53d730c8.327b23c6.16c8c@mercurio.local>
 <OF2677A811.C35C623D-ON65257D25.00441D70-65257D25.00445033@LocalDomain>
 <OF8FA6AB8C.1A3E0204-ON65257D26.001CD08E-65257D26.001CFCF4@tcs.com>
 <etPan.53d9d249.625558ec.127c1@mercurio.local>
 <OFE69E352B.508C36BF-ON65257D26.001E0C7C-65257D26.001E7B0D@tcs.com>
 <etPan.53d9d74e.238e1f29.127c1@mercurio.local>
 <OF5E324DB9.FAEAFAB5-ON65257D26.0020534B-65257D26.0020E60D@tcs.com>
 <etPan.53d9dc22.46e87ccd.127c1@mercurio.local>
Message-ID: <OFBDE3AEE9.05CA4376-ON65257D26.002173A7-65257D26.0021D277@tcs.com>

Yes .

I am doing the same :

Config file :

 [{rabbit,        [{tcp_listeners,    [5672]},{ssl_listeners, [5671]}, 
                        {ssl_options, [{verify,verify_none},
                    {fail_if_no_peer_cert,false}]}]}
].

But still the same error.

Using the same example in https://www.rabbitmq.com/ssl.html , Connecting 
without validating certificates

Thanks and Regards,
Ankur Chakraborty




From:   Michael Klishin <mklishin at pivotal.io>
To:     Ankur5 C <ankur5.c at tcs.com>
Cc:     Legacy list about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
Date:   31-07-2014 11:33
Subject:        Re: Create an encrypted SSL connection without having to 
verify certificate



On 31 July 2014 at 09:59:23, Ankur5 C (ankur5.c at tcs.com) wrote:
> > Would request you to please let me know how one can instruct rabbitmq 
> not verify peer and use the one connect without validating certificates 
> ?
> 
> My config file:
> 
> [{rabbit, [{tcp_listeners, [5672]},{ssl_listeners, [5671]}, 
> {ssl_options, [{cacertfile,"/etc/rabbitmq/testca/cacert.pem"}, 
> {certfile,"/etc/rabbitmq/server/cert.pem"},
> {keyfile,"/etc/rabbitmq/server/key.pem"},
> {verify,verify_none},
> {fail_if_no_peer_cert,false}]}]}
> ].

This is all you need.

This line
{verify,verify_none},

means "perform no peer verification" (don't check that the client
is who it claims to be), while

{fail_if_no_peer_cert,false}

means "don't even bother checking if the client has a certificate".

With this configuration

factory.setPort(5671);
factory.useSslProtocol();

is all you need to do in the Java client to make it use TLS (technically, 
SSLv3). 
-- 
MK 

Staff Software Engineer, Pivotal/RabbitMQ

=====-----=====-----=====
Notice: The information contained in this e-mail
message and/or attachments to it may contain 
confidential or privileged information. If you are 
not the intended recipient, any dissemination, use, 
review, distribution, printing or copying of the 
information contained in this e-mail message 
and/or attachments to it are strictly prohibited. If 
you have received this communication in error, 
please notify us by reply e-mail or telephone and 
immediately and permanently delete the message 
and any attachments. Thank you


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140731/ca63432a/attachment.html>

From mklishin at pivotal.io  Thu Jul 31 07:12:12 2014
From: mklishin at pivotal.io (Michael Klishin)
Date: Thu, 31 Jul 2014 10:12:12 +0400
Subject: [rabbitmq-discuss] Create an encrypted SSL connection without
 having to verify certificate
In-Reply-To: <OFBDE3AEE9.05CA4376-ON65257D26.002173A7-65257D26.0021D277@tcs.com>
References: <OFD562E7D9.F2A49548-ON65257D24.001D522E-65257D24.001DB1EE@tcs.com>
 <etPan.53d730c8.327b23c6.16c8c@mercurio.local>
 <OF2677A811.C35C623D-ON65257D25.00441D70-65257D25.00445033@LocalDomain>
 <OF8FA6AB8C.1A3E0204-ON65257D26.001CD08E-65257D26.001CFCF4@tcs.com>
 <etPan.53d9d249.625558ec.127c1@mercurio.local>
 <OFE69E352B.508C36BF-ON65257D26.001E0C7C-65257D26.001E7B0D@tcs.com>
 <etPan.53d9d74e.238e1f29.127c1@mercurio.local>
 <OF5E324DB9.FAEAFAB5-ON65257D26.0020534B-65257D26.0020E60D@tcs.com>
 <etPan.53d9dc22.46e87ccd.127c1@mercurio.local>
 <OFBDE3AEE9.05CA4376-ON65257D26.002173A7-65257D26.0021D277@tcs.com>
Message-ID: <etPan.53d9de5a.3d1b58ba.127c1@mercurio.local>

On 31 July 2014 at 10:10:13, Ankur5 C (ankur5.c at tcs.com) wrote:
> > Config file :
>  
> [{rabbit, [{tcp_listeners, [5672]},{ssl_listeners, [5671]},  
> {ssl_options, [{verify,verify_none},
> {fail_if_no_peer_cert,false}]}]}
> ].
>  
> But still the same error.

See?http://www.rabbitmq.com/troubleshooting-ssl.html, in particular the section
on openssl s_client.?
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From ankur5.c at tcs.com  Thu Jul 31 07:23:31 2014
From: ankur5.c at tcs.com (Ankur5 C)
Date: Thu, 31 Jul 2014 11:53:31 +0530
Subject: [rabbitmq-discuss] Create an encrypted SSL connection without
	having to verify certificate
In-Reply-To: <etPan.53d9de5a.3d1b58ba.127c1@mercurio.local>
References: <OFD562E7D9.F2A49548-ON65257D24.001D522E-65257D24.001DB1EE@tcs.com>
 <etPan.53d730c8.327b23c6.16c8c@mercurio.local>
 <OF2677A811.C35C623D-ON65257D25.00441D70-65257D25.00445033@LocalDomain>
 <OF8FA6AB8C.1A3E0204-ON65257D26.001CD08E-65257D26.001CFCF4@tcs.com>
 <etPan.53d9d249.625558ec.127c1@mercurio.local>
 <OFE69E352B.508C36BF-ON65257D26.001E0C7C-65257D26.001E7B0D@tcs.com>
 <etPan.53d9d74e.238e1f29.127c1@mercurio.local>
 <OF5E324DB9.FAEAFAB5-ON65257D26.0020534B-65257D26.0020E60D@tcs.com>
 <etPan.53d9dc22.46e87ccd.127c1@mercurio.local>
 <OFBDE3AEE9.05CA4376-ON65257D26.002173A7-65257D26.0021D277@tcs.com>
 <etPan.53d9de5a.3d1b58ba.127c1@mercurio.local>
Message-ID: <OF11F8D870.462A9C87-ON65257D26.0022C5AE-65257D26.00231D5E@tcs.com>

I have successfully tested the ssl with validating certificates , but this 
one which is ssl without validating certificates hardly works , inspite of 
the fact that I have mentioned 

{ssl_options, [{verify,verify_none},
> {fail_if_no_peer_cert,false}]}]}

and restarted the server.

Could you please try and execute this one at your end once. I guess there 
are some issues.

Thanks and Regards,
Ankur Chakraborty



From:   Michael Klishin <mklishin at pivotal.io>
To:     Ankur5 C <ankur5.c at tcs.com>
Cc:     Legacy list about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
Date:   31-07-2014 11:42
Subject:        Re: Create an encrypted SSL connection without having to 
verify certificate



On 31 July 2014 at 10:10:13, Ankur5 C (ankur5.c at tcs.com) wrote:
> > Config file :
> 
> [{rabbit, [{tcp_listeners, [5672]},{ssl_listeners, [5671]}, 
> {ssl_options, [{verify,verify_none},
> {fail_if_no_peer_cert,false}]}]}
> ].
> 
> But still the same error.

See http://www.rabbitmq.com/troubleshooting-ssl.html, in particular the 
section
on openssl s_client. 
-- 
MK 

Staff Software Engineer, Pivotal/RabbitMQ

=====-----=====-----=====
Notice: The information contained in this e-mail
message and/or attachments to it may contain 
confidential or privileged information. If you are 
not the intended recipient, any dissemination, use, 
review, distribution, printing or copying of the 
information contained in this e-mail message 
and/or attachments to it are strictly prohibited. If 
you have received this communication in error, 
please notify us by reply e-mail or telephone and 
immediately and permanently delete the message 
and any attachments. Thank you


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140731/39a36053/attachment.html>

From mklishin at pivotal.io  Thu Jul 31 07:38:39 2014
From: mklishin at pivotal.io (Michael Klishin)
Date: Thu, 31 Jul 2014 10:38:39 +0400
Subject: [rabbitmq-discuss] Create an encrypted SSL connection without
 having to verify certificate
In-Reply-To: <OF11F8D870.462A9C87-ON65257D26.0022C5AE-65257D26.00231D5E@tcs.com>
References: <OFD562E7D9.F2A49548-ON65257D24.001D522E-65257D24.001DB1EE@tcs.com>
 <etPan.53d730c8.327b23c6.16c8c@mercurio.local>
 <OF2677A811.C35C623D-ON65257D25.00441D70-65257D25.00445033@LocalDomain>
 <OF8FA6AB8C.1A3E0204-ON65257D26.001CD08E-65257D26.001CFCF4@tcs.com>
 <etPan.53d9d249.625558ec.127c1@mercurio.local>
 <OFE69E352B.508C36BF-ON65257D26.001E0C7C-65257D26.001E7B0D@tcs.com>
 <etPan.53d9d74e.238e1f29.127c1@mercurio.local>
 <OF5E324DB9.FAEAFAB5-ON65257D26.0020534B-65257D26.0020E60D@tcs.com>
 <etPan.53d9dc22.46e87ccd.127c1@mercurio.local>
 <OFBDE3AEE9.05CA4376-ON65257D26.002173A7-65257D26.0021D277@tcs.com>
 <etPan.53d9de5a.3d1b58ba.127c1@mercurio.local>
 <OF11F8D870.462A9C87-ON65257D26.0022C5AE-65257D26.00231D5E@tcs.com>
Message-ID: <etPan.53d9e489.507ed7ab.127c1@mercurio.local>

On 31 July 2014 at 10:23:35, Ankur5 C (ankur5.c at tcs.com) wrote:
> > I have successfully tested the ssl with validating certificates  
> , but this one which is ssl without validating certificates hardly  
> works , inspite of the fact that I have mentioned
>  
> {ssl_options, [{verify,verify_none},
> > {fail_if_no_peer_cert,false}]}]}
>  
> and restarted the server.
>  
> Could you please try and execute this one at your end once. I guess  
> there are some issues.

Honestly, I have doubts it is a RabbitMQ issue.

Test config:
https://gist.github.com/michaelklishin/574fac0a6bf8edbf74e7

Connection info (no certificate, using Bunny as a client):
https://gist.github.com/michaelklishin/a8b1c9437db4f4faebf2

Connection info (no certificate, using March Hare, which uses Java client under the hood):
https://gist.github.com/michaelklishin/f33cf7bf731b531ef842

Connection info (no certificate, using Langohr, which uses Java client under the hood):
https://gist.github.com/michaelklishin/d2c945087d4277880a6c

openssl s_client:
https://gist.github.com/michaelklishin/2b6d2724f0812de67224

4 different clients (2 base on the Java one), all successfully connect without
client certificates. Only one of them (s_client) performs peer verification.?
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From mklishin at gopivotal.com  Thu Jul 31 07:45:57 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 31 Jul 2014 10:45:57 +0400
Subject: [rabbitmq-discuss] Create an encrypted SSL connection without
 having to verify certificate
In-Reply-To: <etPan.53d9e489.507ed7ab.127c1@mercurio.local>
References: <OFD562E7D9.F2A49548-ON65257D24.001D522E-65257D24.001DB1EE@tcs.com>
 <etPan.53d730c8.327b23c6.16c8c@mercurio.local>
 <OF2677A811.C35C623D-ON65257D25.00441D70-65257D25.00445033@LocalDomain>
 <OF8FA6AB8C.1A3E0204-ON65257D26.001CD08E-65257D26.001CFCF4@tcs.com>
 <etPan.53d9d249.625558ec.127c1@mercurio.local>
 <OFE69E352B.508C36BF-ON65257D26.001E0C7C-65257D26.001E7B0D@tcs.com>
 <etPan.53d9d74e.238e1f29.127c1@mercurio.local>
 <OF5E324DB9.FAEAFAB5-ON65257D26.0020534B-65257D26.0020E60D@tcs.com>
 <etPan.53d9dc22.46e87ccd.127c1@mercurio.local>
 <OFBDE3AEE9.05CA4376-ON65257D26.002173A7-65257D26.0021D277@tcs.com>
 <etPan.53d9de5a.3d1b58ba.127c1@mercurio.local>
 <OF11F8D870.462A9C87-ON65257D26.0022C5AE-65257D26.00231D5E@tcs.com>
 <etPan.53d9e489.507ed7ab.127c1@mercurio.local>
Message-ID: <etPan.53d9e63e.2eb141f2.127c1@mercurio.local>

On 31 July 2014 at 10:40:14, Michael Klishin (mklishin at pivotal.io) wrote:
> > Test config:
> https://gist.github.com/michaelklishin/574fac0a6bf8edbf74e7  
>  
> Connection info (no certificate, using Bunny as a client):
> https://gist.github.com/michaelklishin/a8b1c9437db4f4faebf2  
>  
> Connection info (no certificate, using March Hare, which uses  
> Java client under the hood):
> https://gist.github.com/michaelklishin/f33cf7bf731b531ef842  
>  
> Connection info (no certificate, using Langohr, which uses  
> Java client under the hood):
> https://gist.github.com/michaelklishin/d2c945087d4277880a6c  
>  
> openssl s_client:
> https://gist.github.com/michaelklishin/2b6d2724f0812de67224  
>  
> 4 different clients (2 base on the Java one), all successfully  
> connect without
> client certificates. Only one of them (s_client) performs peer  
> verification.

plus the Java client directly (from a Clojure REPL):
https://gist.github.com/michaelklishin/83b0fe6f904a1fa2ab82

using the following (very minimalistic) code:
https://gist.github.com/michaelklishin/4146cec261f0fd30cc07

RabbitMQ log when I create connections with the code above:
https://gist.github.com/michaelklishin/1a9fdf990f4f6de44901?
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From ankur5.c at tcs.com  Thu Jul 31 08:03:59 2014
From: ankur5.c at tcs.com (Ankur5 C)
Date: Thu, 31 Jul 2014 12:33:59 +0530
Subject: [rabbitmq-discuss] Create an encrypted SSL connection without
 having to verify certificate
In-Reply-To: <etPan.53d9e63e.2eb141f2.127c1@mercurio.local>
References: <OFD562E7D9.F2A49548-ON65257D24.001D522E-65257D24.001DB1EE@tcs.com>
 <OF2677A811.C35C623D-ON65257D25.00441D70-65257D25.00445033@LocalDomain>
 <OF8FA6AB8C.1A3E0204-ON65257D26.001CD08E-65257D26.001CFCF4@tcs.com>
 <etPan.53d9d249.625558ec.127c1@mercurio.local>
 <OFE69E352B.508C36BF-ON65257D26.001E0C7C-65257D26.001E7B0D@tcs.com>
 <etPan.53d9d74e.238e1f29.127c1@mercurio.local>
 <OF5E324DB9.FAEAFAB5-ON65257D26.0020534B-65257D26.0020E60D@tcs.com>
 <etPan.53d9dc22.46e87ccd.127c1@mercurio.local>
 <OFBDE3AEE9.05CA4376-ON65257D26.002173A7-65257D26.0021D277@tcs.com>
 <etPan.53d9de5a.3d1b58ba.127c1@mercurio.local>
 <OF11F8D870.462A9C87-ON65257D26.0022C5AE-65257D26.00231D5E@tcs.com>
 <etPan.53d9e489.507ed7ab.127c1@mercurio.local>
 <etPan.53d9e63e.2eb141f2.127c1@mercurio.local>
Message-ID: <OFA25BB64A.50824CD7-ON65257D26.00267BB3-65257D26.0026D1BF@tcs.com>

Thanks .

But could you please try once with the example given in :

https://www.rabbitmq.com/ssl.html : Connecting without validating 
certificates

Thanks and Regards,
Ankur Chakraborty



From:   Michael Klishin <mklishin at gopivotal.com>
To:     Ankur5 C <ankur5.c at tcs.com>
Cc:     Legacy list about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
Date:   31-07-2014 12:16
Subject:        Re: [rabbitmq-discuss] Create an encrypted SSL connection 
without having to verify certificate



On 31 July 2014 at 10:40:14, Michael Klishin (mklishin at pivotal.io) wrote:
> > Test config:
> https://gist.github.com/michaelklishin/574fac0a6bf8edbf74e7 
> 
> Connection info (no certificate, using Bunny as a client):
> https://gist.github.com/michaelklishin/a8b1c9437db4f4faebf2 
> 
> Connection info (no certificate, using March Hare, which uses 
> Java client under the hood):
> https://gist.github.com/michaelklishin/f33cf7bf731b531ef842 
> 
> Connection info (no certificate, using Langohr, which uses 
> Java client under the hood):
> https://gist.github.com/michaelklishin/d2c945087d4277880a6c 
> 
> openssl s_client:
> https://gist.github.com/michaelklishin/2b6d2724f0812de67224 
> 
> 4 different clients (2 base on the Java one), all successfully 
> connect without
> client certificates. Only one of them (s_client) performs peer 
> verification.

plus the Java client directly (from a Clojure REPL):
https://gist.github.com/michaelklishin/83b0fe6f904a1fa2ab82

using the following (very minimalistic) code:
https://gist.github.com/michaelklishin/4146cec261f0fd30cc07

RabbitMQ log when I create connections with the code above:
https://gist.github.com/michaelklishin/1a9fdf990f4f6de44901 
-- 
MK 

Staff Software Engineer, Pivotal/RabbitMQ

=====-----=====-----=====
Notice: The information contained in this e-mail
message and/or attachments to it may contain 
confidential or privileged information. If you are 
not the intended recipient, any dissemination, use, 
review, distribution, printing or copying of the 
information contained in this e-mail message 
and/or attachments to it are strictly prohibited. If 
you have received this communication in error, 
please notify us by reply e-mail or telephone and 
immediately and permanently delete the message 
and any attachments. Thank you


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140731/d384e39e/attachment.html>

From mklishin at pivotal.io  Thu Jul 31 08:09:20 2014
From: mklishin at pivotal.io (Michael Klishin)
Date: Thu, 31 Jul 2014 11:09:20 +0400
Subject: [rabbitmq-discuss] Create an encrypted SSL connection without
 having to verify certificate
In-Reply-To: <OFA25BB64A.50824CD7-ON65257D26.00267BB3-65257D26.0026D1BF@tcs.com>
References: <OFD562E7D9.F2A49548-ON65257D24.001D522E-65257D24.001DB1EE@tcs.com>
 <OF2677A811.C35C623D-ON65257D25.00441D70-65257D25.00445033@LocalDomain>
 <OF8FA6AB8C.1A3E0204-ON65257D26.001CD08E-65257D26.001CFCF4@tcs.com>
 <etPan.53d9d249.625558ec.127c1@mercurio.local>
 <OFE69E352B.508C36BF-ON65257D26.001E0C7C-65257D26.001E7B0D@tcs.com>
 <etPan.53d9d74e.238e1f29.127c1@mercurio.local>
 <OF5E324DB9.FAEAFAB5-ON65257D26.0020534B-65257D26.0020E60D@tcs.com>
 <etPan.53d9dc22.46e87ccd.127c1@mercurio.local>
 <OFBDE3AEE9.05CA4376-ON65257D26.002173A7-65257D26.0021D277@tcs.com>
 <etPan.53d9de5a.3d1b58ba.127c1@mercurio.local>
 <OF11F8D870.462A9C87-ON65257D26.0022C5AE-65257D26.00231D5E@tcs.com>
 <etPan.53d9e489.507ed7ab.127c1@mercurio.local>
 <etPan.53d9e63e.2eb141f2.127c1@mercurio.local>
 <OFA25BB64A.50824CD7-ON65257D26.00267BB3-65257D26.0026D1BF@tcs.com>
Message-ID: <etPan.53d9ebbb.41b71efb.127c1@mercurio.local>

On 31 July 2014 at 11:04:07, Ankur5 C (ankur5.c at tcs.com) wrote:
> >
> But could you please try once with the example given in :
>  
> https://www.rabbitmq.com/ssl.html: Connecting without  
> validating certificates

Ankur,

The example in?https://gist.github.com/michaelklishin/4146cec261f0fd30cc07
is no different from "Connecting without validating certificates" on
https://www.rabbitmq.com/ssl.html in the key part: how it sets up
a ConnectionFactory instance.

I assure you it is *not* a RabbitMQ issue, there's enough evidence
of that in this thread alone. Something is wrong with your code
(which you never posted) or your local environment.?

Please proceed to investigate the issue on your own.

If this still seems too hard, Pivotal offers professional services around RabbitMQ. Email info at rabbitmq.com to find out more.
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From ankur5.c at tcs.com  Thu Jul 31 09:06:09 2014
From: ankur5.c at tcs.com (Ankur5 C)
Date: Thu, 31 Jul 2014 13:36:09 +0530
Subject: [rabbitmq-discuss] Create an encrypted SSL connection without
 having to verify certificate
In-Reply-To: <etPan.53d9ebbb.41b71efb.127c1@mercurio.local>
References: <OFD562E7D9.F2A49548-ON65257D24.001D522E-65257D24.001DB1EE@tcs.com>
 <OF8FA6AB8C.1A3E0204-ON65257D26.001CD08E-65257D26.001CFCF4@tcs.com>
 <etPan.53d9d249.625558ec.127c1@mercurio.local>
 <OFE69E352B.508C36BF-ON65257D26.001E0C7C-65257D26.001E7B0D@tcs.com>
 <etPan.53d9d74e.238e1f29.127c1@mercurio.local>
 <OF5E324DB9.FAEAFAB5-ON65257D26.0020534B-65257D26.0020E60D@tcs.com>
 <etPan.53d9dc22.46e87ccd.127c1@mercurio.local>
 <OFBDE3AEE9.05CA4376-ON65257D26.002173A7-65257D26.0021D277@tcs.com>
 <etPan.53d9de5a.3d1b58ba.127c1@mercurio.local>
 <OF11F8D870.462A9C87-ON65257D26.0022C5AE-65257D26.00231D5E@tcs.com>
 <etPan.53d9e489.507ed7ab.127c1@mercurio.local>
 <etPan.53d9e63e.2eb141f2.127c1@mercurio.local>
 <OFA25BB64A.50824CD7-ON65257D26.0026
 <etPan.53d9ebbb.41b71efb.127c1@mercurio.local>
Message-ID: <OF5A21C646.BB4A4EC8-ON65257D26.002C4660-65257D26.002C8290@tcs.com>

Here is my code:

The same one which has been given in your example. 

import java.io.*;
import java.security.*;


import com.rabbitmq.client.*;

public class Example1
{
    public static void main(String[] args) throws Exception
    {

        ConnectionFactory factory = new ConnectionFactory();
        factory.setHost("192.168.161.197");
        factory.setPort(5671);

        factory.useSslProtocol();
        // Tells the library to setup the default Key and Trust managers 
for you
        // which do not do any form of remote server trust verification

        Connection conn = factory.newConnection();
        Channel channel = conn.createChannel();

        //non-durable, exclusive, auto-delete queue
        channel.queueDeclare("rabbitmq-java-test", false, true, true, 
null);
        channel.basicPublish("", "rabbitmq-java-test", null, "Hello, 
World".getBytes());


        GetResponse chResponse = channel.basicGet("rabbitmq-java-test", 
false);
        if(chResponse == null) {
            System.out.println("No message retrieved");
        } else {
            byte[] body = chResponse.getBody();
            System.out.println("Recieved: " + new String(body));
        }


        channel.close();
        conn.close();
    }
}

Thanks and Regards,
Ankur Chakraborty
Mailto: ankur5.c at tcs.com
Website: http://www.tcs.com
____________________________________________
Experience certainty.   IT Services
                        Business Solutions
                        Consulting
____________________________________________



From:   Michael Klishin <mklishin at pivotal.io>
To:     Ankur5 C <ankur5.c at tcs.com>
Cc:     Legacy list about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
Date:   31-07-2014 12:39
Subject:        Re: [rabbitmq-discuss] Create an encrypted SSL connection 
without having to verify certificate



On 31 July 2014 at 11:04:07, Ankur5 C (ankur5.c at tcs.com) wrote:
> >
> But could you please try once with the example given in :
> 
> https://www.rabbitmq.com/ssl.html: Connecting without 
> validating certificates

Ankur,

The example in https://gist.github.com/michaelklishin/4146cec261f0fd30cc07
is no different from "Connecting without validating certificates" on
https://www.rabbitmq.com/ssl.html in the key part: how it sets up
a ConnectionFactory instance.

I assure you it is *not* a RabbitMQ issue, there's enough evidence
of that in this thread alone. Something is wrong with your code
(which you never posted) or your local environment. 

Please proceed to investigate the issue on your own.

If this still seems too hard, Pivotal offers professional services around 
RabbitMQ. Email info at rabbitmq.com to find out more.
-- 
MK 

Staff Software Engineer, Pivotal/RabbitMQ

=====-----=====-----=====
Notice: The information contained in this e-mail
message and/or attachments to it may contain 
confidential or privileged information. If you are 
not the intended recipient, any dissemination, use, 
review, distribution, printing or copying of the 
information contained in this e-mail message 
and/or attachments to it are strictly prohibited. If 
you have received this communication in error, 
please notify us by reply e-mail or telephone and 
immediately and permanently delete the message 
and any attachments. Thank you


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140731/f026ad12/attachment.html>

From mklishin at gopivotal.com  Thu Jul 31 09:15:33 2014
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 31 Jul 2014 12:15:33 +0400
Subject: [rabbitmq-discuss] Create an encrypted SSL connection without
 having to verify certificate
In-Reply-To: <OFBDE3AEE9.05CA4376-ON65257D26.002173A7-65257D26.0021D277@tcs.com>
References: <OFD562E7D9.F2A49548-ON65257D24.001D522E-65257D24.001DB1EE@tcs.com>
 <etPan.53d730c8.327b23c6.16c8c@mercurio.local>
 <OF2677A811.C35C623D-ON65257D25.00441D70-65257D25.00445033@LocalDomain>
 <OF8FA6AB8C.1A3E0204-ON65257D26.001CD08E-65257D26.001CFCF4@tcs.com>
 <etPan.53d9d249.625558ec.127c1@mercurio.local>
 <OFE69E352B.508C36BF-ON65257D26.001E0C7C-65257D26.001E7B0D@tcs.com>
 <etPan.53d9d74e.238e1f29.127c1@mercurio.local>
 <OF5E324DB9.FAEAFAB5-ON65257D26.0020534B-65257D26.0020E60D@tcs.com>
 <etPan.53d9dc22.46e87ccd.127c1@mercurio.local>
 <OFBDE3AEE9.05CA4376-ON65257D26.002173A7-65257D26.0021D277@tcs.com>
Message-ID: <etPan.53d9fb42.79e2a9e3.127c1@mercurio.local>

On 31 July 2014 at 10:11:19, Ankur5 C (ankur5.c at tcs.com) wrote:
> > [{rabbit, [{tcp_listeners, [5672]},{ssl_listeners, [5671]},  
> {ssl_options, [{verify,verify_none},
> {fail_if_no_peer_cert,false}]}]}
> ].

You must provide server CA/key/certificate files. There example on
http://www.rabbitmq.com/ssl.html is pretty indicative of that:

[
? {rabbit, [
? ? ?{ssl_listeners, [5671]},
? ? ?{ssl_options, [{cacertfile,"/path/to/testca/cacert.pem"},
? ? ? ? ? ? ? ? ? ? {certfile,"/path/to/server/cert.pem"},
? ? ? ? ? ? ? ? ? ? {keyfile,"/path/to/server/key.pem"},
? ? ? ? ? ? ? ? ? ? {verify,verify_peer},
? ? ? ? ? ? ? ? ? ? {fail_if_no_peer_cert,false}]}
? ?]}
].

and there are no examples that configure RabbitMQ to use TLS but do not specify
CA/key/certificate files.

Please spend some time learning the basics of TLS. It really doesn't make much
sense if neither peer has a certificate/key pair.?
--  
MK  

Staff Software Engineer, Pivotal/RabbitMQ

From mklishin at pivotal.io  Thu Jul 31 09:29:04 2014
From: mklishin at pivotal.io (Michael Klishin)
Date: Thu, 31 Jul 2014 12:29:04 +0400
Subject: [rabbitmq-discuss] Create an encrypted SSL connection without
 having to verify certificate
In-Reply-To: <OFD646FD14.D4F9A725-ON65257D26.002DCD8A-65257D26.002E3561@tcs.com>
References: <OFD562E7D9.F2A49548-ON65257D24.001D522E-65257D24.001DB1EE@tcs.com>
 <etPan.53d730c8.327b23c6.16c8c@mercurio.local>
 <OF2677A811.C35C623D-ON65257D25.00441D70-65257D25.00445033@LocalDomain>
 <OF8FA6AB8C.1A3E0204-ON65257D26.001CD08E-65257D26.001CFCF4@tcs.com>
 <etPan.53d9d249.625558ec.127c1@mercurio.local>
 <OFE69E352B.508C36BF-ON65257D26.001E0C7C-65257D26.001E7B0D@tcs.com>
 <etPan.53d9d74e.238e1f29.127c1@mercurio.local>
 <OF5E324DB9.FAEAFAB5-ON65257D26.0020534B-65257D26.0020E60D@tcs.com>
 <etPan.53d9dc22.46e87ccd.127c1@mercurio.local>
 <OFBDE3AEE9.05CA4376-ON65257D26.002173A7-65257D26.0021D277@tcs.com>
 <etPan.53d9fb42.79e2a9e3.127c1@mercurio.local>
 <OFD646FD14.D4F9A725-ON65257D26.002DCD8A-65257D26.002E3561@tcs.com>
Message-ID: <etPan.53d9fe6e.7545e146.127c1@mercurio.local>

On 31 July 2014 at 12:24:48, Ankur5 C (ankur5.c at tcs.com) wrote:
> > Was my client code ok?

I don't see anything wrong with it.

> 
> And the rabbitmq config file is :
> 
> [{rabbit, [{ssl_listeners, [5671]},
> {ssl_options, [{cacertfile,"/etc/rabbitmq/testca/cacert.pem"}, 
> {certfile,"/etc/rabbitmq/server/cert.pem"},
> {keyfile,"/etc/rabbitmq/server/key.pem"},
> {verify,verify_none},
> {fail_if_no_peer_cert,false}]}]}
> ].
> 
> I have already mentioned the files in my config file.

Then I cannot reproduce your issue with 5 clients (including openssl) and 3 variations of
the config file.

> I am really not getting the issue! Will I get a solution ?

You have to figure this one out on your own. This is something environment-specific.

I recommend switching to the most recent RabbitMQ and Erlang (17.1) releases,
3.3.4 is the version I've used.
-- 
MK 

Staff Software Engineer, Pivotal/RabbitMQ

From emiel.bruijntjes at gmail.com  Tue Jul 29 10:07:33 2014
From: emiel.bruijntjes at gmail.com (Emiel Bruijntjes)
Date: Tue, 29 Jul 2014 02:07:33 -0700 (PDT)
Subject: [rabbitmq-discuss] exclusive queues and dead lettering
Message-ID: <74daeee0-9d18-473b-ba9b-6ef61e299a14@googlegroups.com>


Hi,

We'd like to use exclusive queues, but we do not want to lose any messages 
in case our consumer crashes. I thought the dead-letter mechanism would be 
a good solution for this: when our application unexpectedly crashes, all 
the exclusive queues that are used by the application will then 
automatically be removed (which is good), and the messages in these queues 
are dead-lettered to a special dead-letter queue where they can later be 
picked up and be further processed.

However, it turns out that dead-lettering does not work that way. When the 
application is killed, the queues are indeed removed, but the messages in 
these queues are lost as well. They are not dead-lettered.

Another (possibly related) issue: according to the online documentation 
(https://www.rabbitmq.com/amqp-0-9-1-reference.html#queue.delete) the 
queue.delete function should do the following:

"This method deletes a queue. When a queue is deleted any pending messages 
are sent to a dead-letter queue if this is defined in the server 
configuration, and all consumers on the queue are cancelled."

This does not seem to happen. When I explicitly remove an exclusive 
(possibly true for non-exclusive queues as well) queue, the pending 
messages are not sent to the dead letter queue or dead letter exchange, but 
they are lost.

A work-around for our software that I now can think of is using 
non-exclusive queues, so that the queues will not be removed when the 
application crashes or gets killed. For this work-around we will have to 
find out which queues were active at the time the previous program crashed, 
so that they can be picked up by the restarted process. There is as far as 
I know no AMQP call to retrieve all active queues, or is there?

To summarize:

1. The documentation of the queue.delete function says that pending 
messages are dead-lettered, but they are (as far as I know) not.

2. An exclusive queue that gets deleted because of a broken connection does 
not dead-letter its messages (although it would be very convenient if it 
did)

3. Is there any way how we can find out which queues are still active, so 
that a restarted process can recover from an earlier crash or kill?

Thanks,

Emiel Bruijntjes
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140729/2770b637/attachment.html>

From bronstein.victor at gmail.com  Thu Jul 31 17:02:55 2014
From: bronstein.victor at gmail.com (victorbr)
Date: Thu, 31 Jul 2014 09:02:55 -0700 (PDT)
Subject: [rabbitmq-discuss] Pause minority cluster with publisher
	confirms losing messages
In-Reply-To: <CA+b0Eje2Vx+9Tqv95GPSLncGcjuvZ-Frk8XfCtQ0mTSa9VnL7A@mail.gmail.com>
References: <1b4ee2df-5c26-4f07-b333-3fec610af48a@googlegroups.com>
 <etPan.538ed640.4db127f8.e723@mercurio.local>
 <CA+b0Ejf3tmAr5ZXHFOdyM7-DgSyAJ-efPUxXMikcmSEAVYo3mQ@mail.gmail.com>
 <etPan.538efbc7.7fdcc233.e723@mercurio.local>
 <CA+b0Eje2Vx+9Tqv95GPSLncGcjuvZ-Frk8XfCtQ0mTSa9VnL7A@mail.gmail.com>
Message-ID: <1406822575623-36946.post@n5.nabble.com>

Hi Miguel!
I seem to be observing exactly the same behavior you describe - when the
network partition happens, at first the sender is blocked waiting for
acknowledgement, then it finally gets it but then there are 6-7 seconds
before the partitioned node shuts itself down when the sender can happily
send messages to it and get immediate acknowledgements. Naturally, nothing
of these messages enter the queue.
Have you been able to understand why it happens and how one could work
around it?
Thanks,
Victor



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Pause-minority-cluster-with-publisher-confirms-losing-messages-tp36021p36946.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

