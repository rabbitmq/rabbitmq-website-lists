From raphael at rightscale.com  Sat Oct  1 05:54:17 2011
From: raphael at rightscale.com (Raphael Simon)
Date: Fri, 30 Sep 2011 21:54:17 -0700
Subject: [rabbitmq-discuss] Number of connections and memory usage
In-Reply-To: <4E856295.4040908@rabbitmq.com>
References: <CAD7X3-nscg5ZB_A2V_PYNs271FC+hQVQQxTynsMj8BhibOZvXA@mail.gmail.com>
	<4E7CDB6D.1080902@rabbitmq.com>
	<CAD7X3-kXKHCqPVBW0PkUXZRunMGE3B_put+9zAY3S7qmx5vrwg@mail.gmail.com>
	<4E856295.4040908@rabbitmq.com>
Message-ID: <CAD7X3-kR5VG6X+cVDPwBVmuPG5Df4m_J_Wgq+CffdWRYeDS+iA@mail.gmail.com>

Thank you, the log file being used is the right one, I was wondering though
if there was a way to double check the 'sndbuf' and 'recbuf' values used to
initialize the listeners (sanity check). We are still seeing 200KB /
connection memory usage...

--
Raphael.

On Thu, Sep 29, 2011 at 11:32 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Raphael,
>
>
> On 30/09/11 01:29, Raphael Simon wrote:
>
>> Thank you Matthias. We deployed that config to production but haven't
>> seen any real change... How can we tell if RabbitMQ is indeed using
>> these settings?
>>
>
> See http://www.rabbitmq.com/**configure.html#verify-**configuration<http://www.rabbitmq.com/configure.html#verify-configuration>
>
> When rabbit starts up it tells you what config file it is using, e.g.
>
> +---+   +---+
> |   |   |   |
> |   |   |   |
> |   |   |   |
> |   +---+   +-------+
> |                   |
> | RabbitMQ  +---+   |
> |           |   |   |
> | v%%VSN%%  +---+   |
> |                   |
> +-------------------+
> AMQP 0-9-1 / 0-9 / 0-8
> Copyright (C) 2007-2011 VMware, Inc.
> Licensed under the MPL.  See http://www.rabbitmq.com/
>
> node           : rabbit at i
> app descriptor : /home/matthias/projects/**rabbitmq-umbrella/rabbitmq-**
> server/scripts/../ebin/rabbit.**app
> home dir       : /home/matthias
> config file(s) : (none)
> cookie hash    : FtUD/+++wj4PBf6gRlNEsA==
> log            : /tmp/rabbit at i.log
> sasl log       : /tmp/rabbit at i-sasl.log
> database dir   : /tmp/rabbitmq-rabbit-mnesia
> erlang version : 5.8.4
>
>
> Note the "config files" line above - in your case that should contain the
> filename of the config file.
>
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110930/94a56796/attachment.htm>

From matthias at rabbitmq.com  Sat Oct  1 08:36:35 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 01 Oct 2011 08:36:35 +0100
Subject: [rabbitmq-discuss] Number of connections and memory usage
In-Reply-To: <CAD7X3-kR5VG6X+cVDPwBVmuPG5Df4m_J_Wgq+CffdWRYeDS+iA@mail.gmail.com>
References: <CAD7X3-nscg5ZB_A2V_PYNs271FC+hQVQQxTynsMj8BhibOZvXA@mail.gmail.com>	<4E7CDB6D.1080902@rabbitmq.com>	<CAD7X3-kXKHCqPVBW0PkUXZRunMGE3B_put+9zAY3S7qmx5vrwg@mail.gmail.com>	<4E856295.4040908@rabbitmq.com>
	<CAD7X3-kR5VG6X+cVDPwBVmuPG5Df4m_J_Wgq+CffdWRYeDS+iA@mail.gmail.com>
Message-ID: <4E86C303.7000508@rabbitmq.com>

Raphael,

On 01/10/11 05:54, Raphael Simon wrote:
> Thank you, the log file being used is the right one, I was wondering
> though if there was a way to double check the 'sndbuf' and 'recbuf'
> values used to initialize the listeners (sanity check). We are still
> seeing 200KB / connection memory usage...

You can also run 'rabbitmqctl environment'.

You are connecting via AMQP, right, rather than, say, STOMP?

It's possible that the O/S is configured with large buffer sizes. Check

sysctl net.ipv4.tcp_rmem
sysctl net.ipv4.tcp_wmem

and perhaps adjust the settings.


Regards,

Matthias.

From alex.gronholm at nextday.fi  Sat Oct  1 13:57:26 2011
From: alex.gronholm at nextday.fi (=?UTF-8?Q?Alex_Gr=C3=B6nholm?=)
Date: Sat, 1 Oct 2011 05:57:26 -0700 (PDT)
Subject: [rabbitmq-discuss] Problem setting up a RabbitMQ cluster
Message-ID: <4783914.719.1317473846323.JavaMail.geo-discussion-forums@yqnk41>

I'm trying to set up a cluster between two nodes in a LAN, and I'm not 
getting anywhere.

On node 1 (lenovo) I have a rabbitmq 2.6.1 instance running:
$ sudo rabbitmqctl cluster_status
Cluster status of node rabbit at lenovo ...
[{nodes,[{disc,[rabbit at lenovo]}]},{running_nodes,[rabbit at lenovo]}]
...done.

One node 2 (posti) I have a stopped rabbitmq 2.6.1 instance:
$ sudo rabbitmqctl cluster_status
Cluster status of node rabbit at posti ...
[{nodes,[{unknown,[rabbit at posti]}]},{running_nodes,[]}]
...done.

Then I attempt to join node 2 to node 1:
$ sudo rabbitmqctl cluster rabbit at lenovo
Clustering node rabbit at posti with [rabbit at lenovo] ...
Error: {no_running_cluster_nodes,[rabbit at lenovo],[rabbit at lenovo]}

What am I doing wrong? The instructions on the official site weren't that 
complicated.
Attempting the automatic cluster configuration proved equally fruitless.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111001/58beed3b/attachment.htm>

From alexandru at rabbitmq.com  Sat Oct  1 14:12:24 2011
From: alexandru at rabbitmq.com (Alexandru Scvortov)
Date: Sat, 1 Oct 2011 14:12:24 +0100
Subject: [rabbitmq-discuss] Problem setting up a RabbitMQ cluster
In-Reply-To: <4783914.719.1317473846323.JavaMail.geo-discussion-forums@yqnk41>
References: <4783914.719.1317473846323.JavaMail.geo-discussion-forums@yqnk41>
Message-ID: <20111001131223.GA3511@southbank.Home>

> Then I attempt to join node 2 to node 1:
> $ sudo rabbitmqctl cluster rabbit at lenovo
> Clustering node rabbit at posti with [rabbit at lenovo] ...
> Error: {no_running_cluster_nodes,[rabbit at lenovo],[rabbit at lenovo]}


From alex.gronholm at nextday.fi  Sat Oct  1 15:45:22 2011
From: alex.gronholm at nextday.fi (=?UTF-8?Q?Alex_Gr=C3=B6nholm?=)
Date: Sat, 1 Oct 2011 07:45:22 -0700 (PDT)
Subject: [rabbitmq-discuss] Problem setting up a RabbitMQ cluster
In-Reply-To: <20111001131223.GA3511@southbank.Home>
References: <4783914.719.1317473846323.JavaMail.geo-discussion-forums@yqnk41>
	<20111001131223.GA3511@southbank.Home>
Message-ID: <27405593.2.1317480322908.JavaMail.geo-discussion-forums@yqmn40>

It was an issue about not having identical Erlang cookies. Thanks for the 
help! Next time I might have to study the instructions more carefully =D
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111001/c86dc16d/attachment.htm>

From alex.gronholm at nextday.fi  Sat Oct  1 17:18:17 2011
From: alex.gronholm at nextday.fi (=?UTF-8?Q?Alex_Gr=C3=B6nholm?=)
Date: Sat, 1 Oct 2011 09:18:17 -0700 (PDT)
Subject: [rabbitmq-discuss] HA Client for RabbitMQ?
Message-ID: <19691872.1093.1317485897379.JavaMail.geo-discussion-forums@yqmw31>

I noticed that the hot new feature in RabbitMQ 2.6 is Active/Active HA on 
the server side. How can I take advantage of this on the client side? AFAIK 
the client only knows how to connect to a single server -- you can't give it 
a list of servers for failover purposes.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111001/3d0b4577/attachment.htm>

From alain at kno.com  Sat Oct  1 01:25:08 2011
From: alain at kno.com (Alain Dazzi)
Date: Fri, 30 Sep 2011 17:25:08 -0700
Subject: [rabbitmq-discuss] rabbitmq 2.6.1 cluster failure recovery
Message-ID: <CAL5nA3zrVKVb+7yr52XzZ3LEjS_z7LOiPCKDVp3dwe4orbPbyQ@mail.gmail.com>

Hi,

I can't get my rabbitmq cluster to recover from a dead node. So
perhaps someone can help ...

node-1 (cumulonimbus)
Linux cumulonimbus 2.6.38-11-server #50-Ubuntu SMP Mon Sep 12 21:34:27
UTC 2011 x86_64 x86_64 x86_64 GNU/Linux
ii  rabbitmq-server                       2.6.1-1
root at cumulonimbus:~# ls -1 /usr/lib/rabbitmq/lib/rabbitmq_server-2.6.1/plugins/
amqp_client-2.6.1.ez
mochiweb-1.3-rmq2.6.1-git9a53dbd.ez
rabbitmq_management-2.6.1.ez
rabbitmq_management_agent-2.6.1.ez
rabbitmq_management_visualiser-2.6.1.ez
rabbitmq_mochiweb-2.6.1.ez
README
webmachine-1.7.0-rmq2.6.1-hg0c4b60a.ez


node-2 (nuage-informatique)
Linux nuage-informatique 2.6.38-11-generic #50-Ubuntu SMP Mon Sep 12
21:17:25 UTC 2011 x86_64 x86_64 x86_64 GNU/Linux
ii  rabbitmq-server                       2.6.1-1

1/ stop both servers and set-up same .erlang_cookie value; restart nodes

2/ on node1 I create a cluster
    rabbitmqctl stop_app
    rabbitmqctl reset
    rabbitmqctl cluster rabbit at nuage-informatique rabbit at cumulonimbus
Clustering node rabbit at cumulonimbus with ['rabbit at nuage-informatique',
                                          rabbit at cumulonimbus] ...
...done.

3/ This creates 2 disc nodes !!!

4/ run a test and pass data successfully

5/ restart node-2 (service rabbitmq-server stop)
service rabbitmq-server start ... fails with ...
root at nuage-informatique:~/Desktop# service rabbitmq-server start
Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/startup_{log, _err}
rabbitmq-server.
Erlang has closed
^M
Crash dump was written to: erl_crash.dump^M
Kernel pid terminated (application_controller)
({application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}})^M

Activating RabbitMQ plugins ...
1 plugins activated:
* rabbitmq_management_agent-2.6.1


+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
|   v2.6.1  +---+   |
|                   |
+-------------------+
AMQP 0-9-1 / 0-9 / 0-8
Copyright (C) 2007-2011 VMware, Inc.
Licensed under the MPL.  See http://www.rabbitmq.com/

node           : rabbit at nuage-informatique
app descriptor :
/usr/lib/rabbitmq/lib/rabbitmq_server-2.6.1/sbin/../ebin/rabbit.app
home dir       : /var/lib/rabbitmq
config file(s) : (none)
cookie hash    : qHpvLciGsi5o4f8ScVzyWg==
log            : /var/log/rabbitmq/rabbit at nuage-informatique.log
sasl log       : /var/log/rabbitmq/rabbit at nuage-informatique-sasl.log
database dir   : /var/lib/rabbitmq/mnesia/rabbit at nuage-informatique
erlang version : 5.7.4

-- rabbit boot start
starting file handle cache server                                     ...done
starting worker pool                                                  ...done
starting database
...BOOT ERROR: FAILED
Reason: {error,
            {timeout_waiting_for_tables,
                [rabbit_user,rabbit_user_permission,rabbit_vhost,
                 rabbit_durable_route,rabbit_durable_exchange,
                 rabbit_durable_queue]}}
Stacktrace: [{rabbit_mnesia,wait_for_tables,1},
             {rabbit_mnesia,check_schema_integrity,0},
             {rabbit_mnesia,ensure_schema_integrity,0},
             {rabbit_mnesia,init,0},
             {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
             {rabbit,run_boot_step,1},
             {rabbit,'-start/2-lc$^0/1-0-',1},
             {rabbit,start,2}]
{"Kernel pid terminated",application_controller,"{application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}}"}^M

At this point I have to re-install node-2 to recover.

Any idea why?

Thank you,

next I would like to test mirrored q but obviously this has to work first...

-Alain

From lngphp at gmail.com  Sat Oct  1 08:32:01 2011
From: lngphp at gmail.com (Roman Borisenko)
Date: Sat, 1 Oct 2011 15:32:01 +0800
Subject: [rabbitmq-discuss] Routing Key issue
Message-ID: <CAGFE3TAYSdzSwbahKBqk4feGrE=zbsZsGnGTPZ88VYsU7jhsWA@mail.gmail.com>

Hi

I'm trying to figure out how RabbitMQ/php-amqplib work and have issue with
Routing Keys.
Two messages are sent to 'Queue' queue using Routing Keys: 'server1.info'
and 'server1.error':

$server = 1;
$conn = new AMQPConnection(HOST, PORT, USER, PASS, VHOST);
$channel = $conn->channel();
$channel->exchange_declare(XCHANGE_NAME, 'topic', false, true, false);
$msg = new AMQPMessage('Server '.$server.' INFO'
, array('content_type' => 'text/plain'));
$channel->basic_publish($msg, XCHANGE_NAME
, 'server'.$server.'.info');
$msg = new AMQPMessage('Server '.$server.' ERROR'
, array('content_type' => 'text/plain'));
$channel->basic_publish($msg, XCHANGE_NAME
, 'server'.$server.'.error');

On the other end, I use '#.error' in consumer-error.php and '#.info' in
consumer-info.php, but both messages are appeared if I run any of the
consumers:

$conn = new AMQPConnection(HOST, PORT, USER, PASS, VHOST);
$channel = $conn->channel();
$channel->exchange_declare(XCHANGE_NAME, 'topic', false, true, false);
$channel->queue_declare(QUEUE_NAME, false, true, false, false);
$channel->queue_bind(QUEUE_NAME, XCHANGE_NAME, '#.info');
function process_message($msg) {
echo $msg->body."\n";
$msg->delivery_info['channel']->
basic_ack($msg->delivery_info['delivery_tag']);
}
$channel->basic_consume(QUEUE_NAME, 'consumer', false, false, false, false,
'process_message');
while(count($channel->callbacks)) {
$channel->wait();
}

I'm expecting the separation by this key, but it doesn't happen. What am I
doing wrong?



-- 
Regards,
Roman B.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111001/17734f88/attachment.htm>

From lngphp at gmail.com  Sat Oct  1 08:34:15 2011
From: lngphp at gmail.com (lngphp)
Date: Sat, 1 Oct 2011 00:34:15 -0700 (PDT)
Subject: [rabbitmq-discuss] Routing Key issue
Message-ID: <f64d4f6e-8d6f-47fe-bd9d-746e08f0dbc7@gd10g2000vbb.googlegroups.com>

Hi

I'm trying to figure out how RabbitMQ/php-amqplib work and have issue
with Routing Keys.
Two messages are sent to 'Queue' queue using Routing Keys:
'server1.info' and 'server1.error':

$server = 1;
$conn = new AMQPConnection(HOST, PORT, USER, PASS, VHOST);
$channel = $conn->channel();
$channel->exchange_declare(XCHANGE_NAME, 'topic', false, true, false);
$msg = new AMQPMessage('Server '.$server.' INFO'
, array('content_type' => 'text/plain'));
$channel->basic_publish($msg, XCHANGE_NAME
, 'server'.$server.'.info');
$msg = new AMQPMessage('Server '.$server.' ERROR'
, array('content_type' => 'text/plain'));
$channel->basic_publish($msg, XCHANGE_NAME
, 'server'.$server.'.error');

On the other end, I use '#.error' in consumer-error.php and '#.info'
in consumer-info.php, but both messages are appeared if I run any of
the consumers:

$conn = new AMQPConnection(HOST, PORT, USER, PASS, VHOST);
$channel = $conn->channel();
$channel->exchange_declare(XCHANGE_NAME, 'topic', false, true, false);
$channel->queue_declare(QUEUE_NAME, false, true, false, false);
$channel->queue_bind(QUEUE_NAME, XCHANGE_NAME, '#.info');
function process_message($msg) {
echo $msg->body."\n";
$msg->delivery_info['channel']->
basic_ack($msg->delivery_info['delivery_tag']);
}
$channel->basic_consume(QUEUE_NAME, 'consumer', false, false, false,
false, 'process_message');
while(count($channel->callbacks)) {
$channel->wait();
}

I'm expecting the separation by this key, but it doesn't happen. What
am I doing wrong?

Regards,
Roman

From lngphp at gmail.com  Sun Oct  2 06:06:43 2011
From: lngphp at gmail.com (lngphp)
Date: Sat, 1 Oct 2011 22:06:43 -0700 (PDT)
Subject: [rabbitmq-discuss] Routing Key issue
In-Reply-To: <f64d4f6e-8d6f-47fe-bd9d-746e08f0dbc7@gd10g2000vbb.googlegroups.com>
References: <f64d4f6e-8d6f-47fe-bd9d-746e08f0dbc7@gd10g2000vbb.googlegroups.com>
Message-ID: <42280918-2137-4303-a351-55d48a8378a9@v9g2000vbp.googlegroups.com>

Resolved - I needed to have different Queues...

On Oct 1, 3:34?pm, lngphp <lng... at gmail.com> wrote:
> Hi
>
> I'm trying to figure out how RabbitMQ/php-amqplib work and have issue
> with Routing Keys.
> Two messages are sent to 'Queue' queue using Routing Keys:
> 'server1.info' and 'server1.error':
>
> $server = 1;
> $conn = new AMQPConnection(HOST, PORT, USER, PASS, VHOST);
> $channel = $conn->channel();
> $channel->exchange_declare(XCHANGE_NAME, 'topic', false, true, false);
> $msg = new AMQPMessage('Server '.$server.' INFO'
> , array('content_type' => 'text/plain'));
> $channel->basic_publish($msg, XCHANGE_NAME
> , 'server'.$server.'.info');
> $msg = new AMQPMessage('Server '.$server.' ERROR'
> , array('content_type' => 'text/plain'));
> $channel->basic_publish($msg, XCHANGE_NAME
> , 'server'.$server.'.error');
>
> On the other end, I use '#.error' in consumer-error.php and '#.info'
> in consumer-info.php, but both messages are appeared if I run any of
> the consumers:
>
> $conn = new AMQPConnection(HOST, PORT, USER, PASS, VHOST);
> $channel = $conn->channel();
> $channel->exchange_declare(XCHANGE_NAME, 'topic', false, true, false);
> $channel->queue_declare(QUEUE_NAME, false, true, false, false);
> $channel->queue_bind(QUEUE_NAME, XCHANGE_NAME, '#.info');
> function process_message($msg) {
> echo $msg->body."\n";
> $msg->delivery_info['channel']->
> basic_ack($msg->delivery_info['delivery_tag']);}
>
> $channel->basic_consume(QUEUE_NAME, 'consumer', false, false, false,
> false, 'process_message');
> while(count($channel->callbacks)) {
> $channel->wait();
>
> }
>
> I'm expecting the separation by this key, but it doesn't happen. What
> am I doing wrong?
>
> Regards,
> Roman
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From lngphp at gmail.com  Sun Oct  2 06:06:54 2011
From: lngphp at gmail.com (lngphp)
Date: Sat, 1 Oct 2011 22:06:54 -0700 (PDT)
Subject: [rabbitmq-discuss] Routing Key issue
In-Reply-To: <CAGFE3TAYSdzSwbahKBqk4feGrE=zbsZsGnGTPZ88VYsU7jhsWA@mail.gmail.com>
References: <CAGFE3TAYSdzSwbahKBqk4feGrE=zbsZsGnGTPZ88VYsU7jhsWA@mail.gmail.com>
Message-ID: <167864d4-959a-4f0f-978e-df4de30d96b5@b6g2000vbz.googlegroups.com>

Resolved - I needed to have different Queues...

On Oct 1, 3:32?pm, Roman Borisenko <lng... at gmail.com> wrote:
> Hi
>
> I'm trying to figure out how RabbitMQ/php-amqplib work and have issue with
> Routing Keys.
> Two messages are sent to 'Queue' queue using Routing Keys: 'server1.info'
> and 'server1.error':
>
> $server = 1;
> $conn = new AMQPConnection(HOST, PORT, USER, PASS, VHOST);
> $channel = $conn->channel();
> $channel->exchange_declare(XCHANGE_NAME, 'topic', false, true, false);
> $msg = new AMQPMessage('Server '.$server.' INFO'
> , array('content_type' => 'text/plain'));
> $channel->basic_publish($msg, XCHANGE_NAME
> , 'server'.$server.'.info');
> $msg = new AMQPMessage('Server '.$server.' ERROR'
> , array('content_type' => 'text/plain'));
> $channel->basic_publish($msg, XCHANGE_NAME
> , 'server'.$server.'.error');
>
> On the other end, I use '#.error' in consumer-error.php and '#.info' in
> consumer-info.php, but both messages are appeared if I run any of the
> consumers:
>
> $conn = new AMQPConnection(HOST, PORT, USER, PASS, VHOST);
> $channel = $conn->channel();
> $channel->exchange_declare(XCHANGE_NAME, 'topic', false, true, false);
> $channel->queue_declare(QUEUE_NAME, false, true, false, false);
> $channel->queue_bind(QUEUE_NAME, XCHANGE_NAME, '#.info');
> function process_message($msg) {
> echo $msg->body."\n";
> $msg->delivery_info['channel']->
> basic_ack($msg->delivery_info['delivery_tag']);}
>
> $channel->basic_consume(QUEUE_NAME, 'consumer', false, false, false, false,
> 'process_message');
> while(count($channel->callbacks)) {
> $channel->wait();
>
> }
>
> I'm expecting the separation by this key, but it doesn't happen. What am I
> doing wrong?
>
> --
> Regards,
> Roman B.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthew at rabbitmq.com  Sun Oct  2 18:12:20 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Sun, 2 Oct 2011 18:12:20 +0100
Subject: [rabbitmq-discuss] HA Client for RabbitMQ?
In-Reply-To: <19691872.1093.1317485897379.JavaMail.geo-discussion-forums@yqmw31>
References: <19691872.1093.1317485897379.JavaMail.geo-discussion-forums@yqmw31>
Message-ID: <20111002171219.GG27797@wellquite.org>

On Sat, Oct 01, 2011 at 09:18:17AM -0700, Alex Gr?nholm wrote:
> I noticed that the hot new feature in RabbitMQ 2.6 is Active/Active HA on 
> the server side. How can I take advantage of this on the client side? AFAIK 
> the client only knows how to connect to a single server -- you can't give it 
> a list of servers for failover purposes.

Correct. The Active/Active HA work does not address the issue of client
connectivity. There are a number of solutions that you could use:

o) Change the DNS on failure
o) a plain TCP load balancer like haproxy or a router-based one
o) mobile IP addresses as can be done with something like pacemaker

Matthew

From simon at rabbitmq.com  Mon Oct  3 12:13:44 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 03 Oct 2011 12:13:44 +0100
Subject: [rabbitmq-discuss] (no subject)
In-Reply-To: <1829082.840.1317385909498.JavaMail.geo-discussion-forums@yqgn17>
References: <32420913.455.1317385257776.JavaMail.geo-discussion-forums@yqnv12>
	<1829082.840.1317385909498.JavaMail.geo-discussion-forums@yqgn17>
Message-ID: <4E8998E8.60906@rabbitmq.com>

On 30/09/11 13:31, Cheremukhin Andrey wrote:
> I'm asking because really my consumer gets ALL messages, but rabbitmq
> has other statistics.

I'm sure you are getting all your messages eventually, but the 
statistics you're showing say that messages are backing up - at the 
moment you show, roughly 2000 messages per second were entering the 
queue and only 250 per second were being consumed - so messages will 
back up, and indeed they have.

So I'm not really sure what you're asking here.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Mon Oct  3 12:26:55 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 03 Oct 2011 12:26:55 +0100
Subject: [rabbitmq-discuss] rabbitmq 2.6.1 cluster failure recovery
In-Reply-To: <CAL5nA3zrVKVb+7yr52XzZ3LEjS_z7LOiPCKDVp3dwe4orbPbyQ@mail.gmail.com>
References: <CAL5nA3zrVKVb+7yr52XzZ3LEjS_z7LOiPCKDVp3dwe4orbPbyQ@mail.gmail.com>
Message-ID: <4E899BFF.6060303@rabbitmq.com>

Hi Alain.

When you see timeout_waiting_for_tables, that should mean that the node 
you're trying to start:

* Could not find any other cluster nodes running

* Was not the last node to shut down

 From your explanation it sounds like node-1 *is* running while you 
restart node-2 - is that correct? In that case, can node-2 definitely 
see node-1? (i.e. it can ping cumulonimbus)

Cheers, Simon

On 01/10/11 01:25, Alain Dazzi wrote:
> Hi,
>
> I can't get my rabbitmq cluster to recover from a dead node. So
> perhaps someone can help ...
>
> node-1 (cumulonimbus)
> Linux cumulonimbus 2.6.38-11-server #50-Ubuntu SMP Mon Sep 12 21:34:27
> UTC 2011 x86_64 x86_64 x86_64 GNU/Linux
> ii  rabbitmq-server                       2.6.1-1
> root at cumulonimbus:~# ls -1 /usr/lib/rabbitmq/lib/rabbitmq_server-2.6.1/plugins/
> amqp_client-2.6.1.ez
> mochiweb-1.3-rmq2.6.1-git9a53dbd.ez
> rabbitmq_management-2.6.1.ez
> rabbitmq_management_agent-2.6.1.ez
> rabbitmq_management_visualiser-2.6.1.ez
> rabbitmq_mochiweb-2.6.1.ez
> README
> webmachine-1.7.0-rmq2.6.1-hg0c4b60a.ez
>
>
> node-2 (nuage-informatique)
> Linux nuage-informatique 2.6.38-11-generic #50-Ubuntu SMP Mon Sep 12
> 21:17:25 UTC 2011 x86_64 x86_64 x86_64 GNU/Linux
> ii  rabbitmq-server                       2.6.1-1
>
> 1/ stop both servers and set-up same .erlang_cookie value; restart nodes
>
> 2/ on node1 I create a cluster
>      rabbitmqctl stop_app
>      rabbitmqctl reset
>      rabbitmqctl cluster rabbit at nuage-informatique rabbit at cumulonimbus
> Clustering node rabbit at cumulonimbus with ['rabbit at nuage-informatique',
>                                            rabbit at cumulonimbus] ...
> ...done.
>
> 3/ This creates 2 disc nodes !!!
>
> 4/ run a test and pass data successfully
>
> 5/ restart node-2 (service rabbitmq-server stop)
> service rabbitmq-server start ... fails with ...
> root at nuage-informatique:~/Desktop# service rabbitmq-server start
> Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/startup_{log, _err}
> rabbitmq-server.
> Erlang has closed
> ^M
> Crash dump was written to: erl_crash.dump^M
> Kernel pid terminated (application_controller)
> ({application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}})^M
>
> Activating RabbitMQ plugins ...
> 1 plugins activated:
> * rabbitmq_management_agent-2.6.1
>
>
> +---+   +---+
> |   |   |   |
> |   |   |   |
> |   |   |   |
> |   +---+   +-------+
> |                   |
> | RabbitMQ  +---+   |
> |           |   |   |
> |   v2.6.1  +---+   |
> |                   |
> +-------------------+
> AMQP 0-9-1 / 0-9 / 0-8
> Copyright (C) 2007-2011 VMware, Inc.
> Licensed under the MPL.  See http://www.rabbitmq.com/
>
> node           : rabbit at nuage-informatique
> app descriptor :
> /usr/lib/rabbitmq/lib/rabbitmq_server-2.6.1/sbin/../ebin/rabbit.app
> home dir       : /var/lib/rabbitmq
> config file(s) : (none)
> cookie hash    : qHpvLciGsi5o4f8ScVzyWg==
> log            : /var/log/rabbitmq/rabbit at nuage-informatique.log
> sasl log       : /var/log/rabbitmq/rabbit at nuage-informatique-sasl.log
> database dir   : /var/lib/rabbitmq/mnesia/rabbit at nuage-informatique
> erlang version : 5.7.4
>
> -- rabbit boot start
> starting file handle cache server                                     ...done
> starting worker pool                                                  ...done
> starting database
> ...BOOT ERROR: FAILED
> Reason: {error,
>              {timeout_waiting_for_tables,
>                  [rabbit_user,rabbit_user_permission,rabbit_vhost,
>                   rabbit_durable_route,rabbit_durable_exchange,
>                   rabbit_durable_queue]}}
> Stacktrace: [{rabbit_mnesia,wait_for_tables,1},
>               {rabbit_mnesia,check_schema_integrity,0},
>               {rabbit_mnesia,ensure_schema_integrity,0},
>               {rabbit_mnesia,init,0},
>               {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
>               {rabbit,run_boot_step,1},
>               {rabbit,'-start/2-lc$^0/1-0-',1},
>               {rabbit,start,2}]
> {"Kernel pid terminated",application_controller,"{application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}}"}^M
>
> At this point I have to re-install node-2 to recover.
>
> Any idea why?
>
> Thank you,
>
> next I would like to test mirrored q but obviously this has to work first...
>
> -Alain
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Mon Oct  3 13:13:22 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 03 Oct 2011 13:13:22 +0100
Subject: [rabbitmq-discuss] HA queue seems never to get fully created
In-Reply-To: <1bd216ff-02b7-47ed-bbdd-1b157941382e@i9g2000yqe.googlegroups.com>
References: <1bd216ff-02b7-47ed-bbdd-1b157941382e@i9g2000yqe.googlegroups.com>
Message-ID: <4E89A6E2.3030605@rabbitmq.com>

On 23/09/11 23:55, Chip Salzenberg wrote:
> 2. I used the Perl API to create an HA queue.  This reported success
> via the AMQP, and the management plugin sees the queue and its
> parameters correctly.  When I hover over HA I see "x-ha-policy:
> nodes", and when I hover over Args I see "x-ha-policy-params:
> [rabbit at ps7,rabbit at ps8]".

Well, this is awkward.

Upon a bit of investigation it would seem that "x-ha-policy: nodes" 
basically does not work. The queue is crashing on startup, which is why 
you're seeing ? ? ? in mgmt, and why consumers are getting NOT_FOUND.

I would suggest that you use "x-ha-policy: all" instead for the time being.

Cheers, Simon

(who is now cursing surprisingly loudly...)

-- 
Simon MacMullen
RabbitMQ, VMware

From alain.dazzi at gmail.com  Tue Oct  4 00:04:47 2011
From: alain.dazzi at gmail.com (alain)
Date: Mon, 3 Oct 2011 16:04:47 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq 2.6.1 cluster failure recovery
In-Reply-To: <4E899BFF.6060303@rabbitmq.com>
References: <CAL5nA3zrVKVb+7yr52XzZ3LEjS_z7LOiPCKDVp3dwe4orbPbyQ@mail.gmail.com>
	<4E899BFF.6060303@rabbitmq.com>
Message-ID: <a01c6aff-47b2-4dd9-b383-f19fed6c688a@5g2000yqo.googlegroups.com>

Hi Simon,

Well I got it to work this time... It is unclear what was causing the
issue because I could ping the other node
and nmap would report that port 5672 was opened. I ended switching to
a different cluster of Ubuntu machines
running 10.04 rather than 11.04 (also the 2 machines I am using are
now on the same subnet). I wired the node ips in
/etc/hosts and bind producer/consumer by names.

I was able to create a mirrored-Q, push messages between a producer
and multiple consumers. The set-up seems to survive
when either one of the nodes goes down and comes back on line. Worked
with 1 disc node + 1 ram node as well as 2 disc nodes.

In my pika producer, receiver code I added ...

ha = {}
ha["x-ha-policy"]="all"
...
# declare queue
channel.queue_declare(queue=qname, passive=False, durable=True,
                            exclusive=False, auto_delete=False,
arguments=ha)

Thanks!

-A



On Oct 3, 4:26?am, Simon MacMullen <si... at rabbitmq.com> wrote:
> Hi Alain.
>
> When you see timeout_waiting_for_tables, that should mean that the node
> you're trying to start:
>
> * Could not find any other cluster nodes running
>
> * Was not the last node to shut down
>
> ?From your explanation it sounds like node-1 *is* running while you
> restart node-2 - is that correct? In that case, can node-2 definitely
> see node-1? (i.e. it can ping cumulonimbus)
>
> Cheers, Simon
>
> On 01/10/11 01:25, Alain Dazzi wrote:
>
>
>
>
>
>
>
>
>
> > Hi,
>
> > I can't get my rabbitmq cluster to recover from a dead node. So
> > perhaps someone can help ...
>
> > node-1 (cumulonimbus)
> > Linux cumulonimbus 2.6.38-11-server #50-Ubuntu SMP Mon Sep 12 21:34:27
> > UTC 2011 x86_64 x86_64 x86_64 GNU/Linux
> > ii ?rabbitmq-server ? ? ? ? ? ? ? ? ? ? ? 2.6.1-1
> > root at cumulonimbus:~# ls -1 /usr/lib/rabbitmq/lib/rabbitmq_server-2.6.1/plugins/
> > amqp_client-2.6.1.ez
> > mochiweb-1.3-rmq2.6.1-git9a53dbd.ez
> > rabbitmq_management-2.6.1.ez
> > rabbitmq_management_agent-2.6.1.ez
> > rabbitmq_management_visualiser-2.6.1.ez
> > rabbitmq_mochiweb-2.6.1.ez
> > README
> > webmachine-1.7.0-rmq2.6.1-hg0c4b60a.ez
>
> > node-2 (nuage-informatique)
> > Linux nuage-informatique 2.6.38-11-generic #50-Ubuntu SMP Mon Sep 12
> > 21:17:25 UTC 2011 x86_64 x86_64 x86_64 GNU/Linux
> > ii ?rabbitmq-server ? ? ? ? ? ? ? ? ? ? ? 2.6.1-1
>
> > 1/ stop both servers and set-up same .erlang_cookie value; restart nodes
>
> > 2/ on node1 I create a cluster
> > ? ? ?rabbitmqctl stop_app
> > ? ? ?rabbitmqctl reset
> > ? ? ?rabbitmqctl cluster rabbit at nuage-informatique rabbit at cumulonimbus
> > Clustering node rabbit at cumulonimbus with ['rabbit at nuage-informatique',
> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?rabbit at cumulonimbus] ...
> > ...done.
>
> > 3/ This creates 2 disc nodes !!!
>
> > 4/ run a test and pass data successfully
>
> > 5/ restart node-2 (service rabbitmq-server stop)
> > service rabbitmq-server start ... fails with ...
> > root at nuage-informatique:~/Desktop# service rabbitmq-server start
> > Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/startup_{log, _err}
> > rabbitmq-server.
> > Erlang has closed
> > ^M
> > Crash dump was written to: erl_crash.dump^M
> > Kernel pid terminated (application_controller)
> > ({application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}})^M
>
> > Activating RabbitMQ plugins ...
> > 1 plugins activated:
> > * rabbitmq_management_agent-2.6.1
>
> > +---+ ? +---+
> > | ? | ? | ? |
> > | ? | ? | ? |
> > | ? | ? | ? |
> > | ? +---+ ? +-------+
> > | ? ? ? ? ? ? ? ? ? |
> > | RabbitMQ ?+---+ ? |
> > | ? ? ? ? ? | ? | ? |
> > | ? v2.6.1 ?+---+ ? |
> > | ? ? ? ? ? ? ? ? ? |
> > +-------------------+
> > AMQP 0-9-1 / 0-9 / 0-8
> > Copyright (C) 2007-2011 VMware, Inc.
> > Licensed under the MPL. ?Seehttp://www.rabbitmq.com/
>
> > node ? ? ? ? ? : rabbit at nuage-informatique
> > app descriptor :
> > /usr/lib/rabbitmq/lib/rabbitmq_server-2.6.1/sbin/../ebin/rabbit.app
> > home dir ? ? ? : /var/lib/rabbitmq
> > config file(s) : (none)
> > cookie hash ? ?: qHpvLciGsi5o4f8ScVzyWg==
> > log ? ? ? ? ? ?: /var/log/rabbitmq/rab... at nuage-informatique.log
> > sasl log ? ? ? : /var/log/rabbitmq/rab... at nuage-informatique-sasl.log
> > database dir ? : /var/lib/rabbitmq/mnesia/rabbit at nuage-informatique
> > erlang version : 5.7.4
>
> > -- rabbit boot start
> > starting file handle cache server ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ...done
> > starting worker pool ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?...done
> > starting database
> > ...BOOT ERROR: FAILED
> > Reason: {error,
> > ? ? ? ? ? ? ?{timeout_waiting_for_tables,
> > ? ? ? ? ? ? ? ? ?[rabbit_user,rabbit_user_permission,rabbit_vhost,
> > ? ? ? ? ? ? ? ? ? rabbit_durable_route,rabbit_durable_exchange,
> > ? ? ? ? ? ? ? ? ? rabbit_durable_queue]}}
> > Stacktrace: [{rabbit_mnesia,wait_for_tables,1},
> > ? ? ? ? ? ? ? {rabbit_mnesia,check_schema_integrity,0},
> > ? ? ? ? ? ? ? {rabbit_mnesia,ensure_schema_integrity,0},
> > ? ? ? ? ? ? ? {rabbit_mnesia,init,0},
> > ? ? ? ? ? ? ? {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
> > ? ? ? ? ? ? ? {rabbit,run_boot_step,1},
> > ? ? ? ? ? ? ? {rabbit,'-start/2-lc$^0/1-0-',1},
> > ? ? ? ? ? ? ? {rabbit,start,2}]
> > {"Kernel pid terminated",application_controller,"{application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}}"}^M
>
> > At this point I have to re-install node-2 to recover.
>
> > Any idea why?
>
> > Thank you,
>
> > next I would like to test mirrored q but obviously this has to work first...
>
> > -Alain
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From chris.dollmont at skunkworks.vn  Tue Oct  4 05:02:08 2011
From: chris.dollmont at skunkworks.vn (Chris Dollmont)
Date: Tue, 4 Oct 2011 11:02:08 +0700
Subject: [rabbitmq-discuss] RabbitMQ did not send messages to AMQP consumers
Message-ID: <52CB53CAA4BA47898E92355F3D029FD3@skunkworks.vn>

 We send a message from a web application to the RabbitMQ queue. As far as we can see, the send operation is successful and RabbitMQ has the message in the queue.  

We have amqp listeners on another server that act on the messages from the queue. Sometimes, seemingly at random, the messages that we know were sent don't arrive--the listeners never get them.

This happens intermittently. The messages go into the queue and appear to be dispatched, but don't arrive at the consumers. There's a sporadic period in which this happens, then the situation resolves itself.

Status of node rabbit at amqp1 ...
[{pid,22068},
{running_applications,[{rabbit,"RabbitMQ","2.4.1"},
 {os_mon,"CPO CXC 138 46","2.1.6"},
 {sasl,"SASL CXC 138 11","2.1.5.3"},
 {mnesia,"MNESIA CXC 138 12","4.4.3"},
 {stdlib,"ERTS CXC 138 10","1.15.3"},
 {kernel,"ERTS CXC 138 10","2.12.3"}]},
{nodes,[{disc,[rabbit at amqp1]}]},
{running_nodes,[rabbit at amqp1]}]
?done.

Running on Debian (Lenny), installed from the RabbitMQ Debian repo.

Chris  

--  
Chris Dollmont
Systems Admin | skunkworks.vn


From tim.yen at gmail.com  Tue Oct  4 08:10:27 2011
From: tim.yen at gmail.com (Tim Yen)
Date: Tue, 4 Oct 2011 07:10:27 +0000 (UTC)
Subject: [rabbitmq-discuss] Can a Publish be acknowledged.
References: <CAL_6-TPc=kmd--uM9L6RJP7+eBk9ZnGG=Q8oOtiFoPiRmsqCCA@mail.gmail.com>
	<20110909003401.GD3410@southbank.Home>
Message-ID: <loom.20111004T085828-484@post.gmane.org>

Alexandru Scvor?ov <alexandru at ...> writes:

> 
> > I'd effectively like an acknowledgment to say "this message was put on to at
> > least one queue".

> To get the acknowledgement you want, you need to publish both with
> mandatory set and to a confirm channel.  If you get a basic.return and
> an acknowledgement, that means the message was not delivered to any
> queues; if you get just an acknowledgement, that means the broker has
> handled the message somehow; if you get a nack, that means the message
> was probably lost in some way, so you need to resend it or something.
> The broker guarantees that it will eventually acknowledge or nack all
> messages published to confirm channels.
>  

> Alternatively, if you're feeling lazy, you can use the new (introduced
> in 2.6.0) IModel.WaitForConfirms.  The function waits for all messages
> 
> Hope this helps.
> 
> Cheers,
> Alex
> 

Thanks Alex,

After enabling confirm select how can I know which message is being confirmed or
nacked by the various callbacks assuming that its all asynchronous?

The BasicAckEvent and Nack event handlers have the DeliveryTag but how do i get
this number on BasicPublish?

Also the BasicReturnEventArgs has no DeliveryTag.  Can I just ignore the
BasicReturn and rely on only the Ack and Nack event handlers?

As I dont need the performance WaitForConfirms seems to be the go but it doesn't
appear to be implemented in the .net code.  It seems to
be Java only.  Maybe its hidden somewhere anybody know?

Maybe someone can post the Java for the WaitForConfirms and I can morph it to c#





From matthias at rabbitmq.com  Tue Oct  4 08:31:34 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 04 Oct 2011 08:31:34 +0100
Subject: [rabbitmq-discuss] Can a Publish be acknowledged.
In-Reply-To: <loom.20111004T085828-484@post.gmane.org>
References: <CAL_6-TPc=kmd--uM9L6RJP7+eBk9ZnGG=Q8oOtiFoPiRmsqCCA@mail.gmail.com>	<20110909003401.GD3410@southbank.Home>
	<loom.20111004T085828-484@post.gmane.org>
Message-ID: <4E8AB656.9030505@rabbitmq.com>

Tim,

On 04/10/11 08:10, Tim Yen wrote:
> After enabling confirm select how can I know which message is being confirmed or
> nacked by the various callbacks assuming that its all asynchronous?
>
> The BasicAckEvent and Nack event handlers have the DeliveryTag but how do i get
> this number on BasicPublish?

Publishes are numbered sequentially. The BasicAck/Nack delivery tag 
contains that sequence number.

In the RabbitMQ clients the channel ("IModel" in the .net client 
terminology) keeps track of the sequence number. See 
http://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v2.6.1/rabbitmq-dotnet-client-2.6.1-client-htmldoc/html/type-RabbitMQ.Client.IModel.html#property-P:RabbitMQ.Client.IModel.NextPublishSeqNo

> Also the BasicReturnEventArgs has no DeliveryTag.  Can I just ignore the
> BasicReturn and rely on only the Ack and Nack event handlers?

You cannot. When a broker confirms a message it is telling the client 
that it has taken responsibility for it. One way the broker can 
discharge its responsibility is by returning the message. Hence messages 
returned with basic.return are *ack*ed, not nack'ed.

> As I dont need the performance WaitForConfirms seems to be the go but it doesn't
> appear to be implemented in the .net code.  It seems to
> be Java only.  Maybe its hidden somewhere anybody know?

It's not exactly hidden:

http://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v2.6.1/rabbitmq-dotnet-client-2.6.1-client-htmldoc/html/type-RabbitMQ.Client.IModel.html#method-M:RabbitMQ.Client.IModel.WaitForConfirms


Matthias.

From matthias at rabbitmq.com  Tue Oct  4 09:37:55 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 04 Oct 2011 09:37:55 +0100
Subject: [rabbitmq-discuss] Is there a channel publish throughput limit
 to a	queue?
In-Reply-To: <CAAA518F.CD1D%allen.kim@epicadvertising.com>
References: <CAAA518F.CD1D%allen.kim@epicadvertising.com>
Message-ID: <4E8AC5E3.5070701@rabbitmq.com>

On 29/09/11 21:47, Allen Kim wrote:
> I checked the channel, and found out that the channel was still
> publishing to a queue.

Looks like the queues couldn't keep up with the inbound publishing rate, 
so rabbit ended up buffering messages in the channel.

> The speed of publishing was around 700/s to 800/s, which is definitely
> not 2000/s.

...which is another indication of the above.

> I was wondering if there is limit that affects publishing speed.

Well, obviously rabbit cannot process messages at an infinite rate, so 
clearly there has to be a limit ;)

However, 700Hz sounds quite low. On my desktop I can get more than 20 
times that. But there are many factors which can reduce that rate:
- persistent messages
- large messages
- routing messages to lots of queues
- using transactions
- having lots of consumers with basic.qos prefetch
etc.


Matthias.

From emile at rabbitmq.com  Tue Oct  4 10:20:45 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 04 Oct 2011 10:20:45 +0100
Subject: [rabbitmq-discuss] RabbitMQ did not send messages to AMQP
	consumers
In-Reply-To: <52CB53CAA4BA47898E92355F3D029FD3@skunkworks.vn>
References: <52CB53CAA4BA47898E92355F3D029FD3@skunkworks.vn>
Message-ID: <4E8ACFED.1000600@rabbitmq.com>

Hi Chris,

On 04/10/11 05:02, Chris Dollmont wrote:
> We send a message from a web application to the RabbitMQ queue. As
> far as we can see, the send operation is successful and RabbitMQ has
> the message in the queue.
> 
> We have amqp listeners on another server that act on the messages
> from the queue. Sometimes, seemingly at random, the messages that we
> know were sent don't arrive--the listeners never get them.
> 
> This happens intermittently. The messages go into the queue and
> appear to be dispatched, but don't arrive at the consumers. There's a
> sporadic period in which this happens, then the situation resolves
> itself.

When you say the message appears to be dispatched, how did you determine
this? Does "rabbitmqctl list_queues" report the queue to be non-empty?
You should also confirm that "rabbitmqctl list_bindings" and
"rabbitmqctl list_consumers" return the expected results and don't
change throughout the period of your test.

Can you reproduce the problem when only a single consumer is subscribed
to the queue? Can you confirm that no consumers retrieve messages
synchronously? I would suggest trying to reproduce the problem with a
minimal client implementation.

Are there any entries in the broker logfile at the time when you expect
the message goes missing?

Have you tried to reproduce the problem while registering a return
listener and publishing messages with the mandatory or immediate flags
turned on?



-Emile

From gli.work at gmail.com  Tue Oct  4 12:10:43 2011
From: gli.work at gmail.com (Ivan Glushkov)
Date: Tue, 4 Oct 2011 04:10:43 -0700 (PDT)
Subject: [rabbitmq-discuss] upgrade rabbitmq from 1.7.1 without loosing any
	messages
Message-ID: <11222305.1636.1317726643909.JavaMail.geo-discussion-forums@yqjw35>

Hi all.

We have several separate rabbitmq nodes with version "1.7.1" and we want to 
upgrade them to the newest version.
As I've read on this forum we can't do this just updating rabbitmq version 
as db schema has changed (so we will have all our messages lost)

The only possibility I see is the following sequence:
1. Create new server with the newest rabbitmq version.
2. For every subscriber in old_rmq_server create new subscriber with the 
same characteristics in new_rmq_server. Pause them all.
3. Switch publishers to use new_rmq_server.  
    At this point all new messages go to the new_rmq_server, but they are 
not processed as all readers are paused. While old subscribers process 
messages from the old_rmq_server
4. When all queues in old_rmq_server are empty turn old subscribers off
Done.


But it's quite a difficult process as it requires a lot of code changes, 
manual work, etc.

Is there any other option to switch from the old version to the newest one?

Best,
Ivan.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111004/23580ceb/attachment.htm>

From simon at rabbitmq.com  Tue Oct  4 12:17:01 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 04 Oct 2011 12:17:01 +0100
Subject: [rabbitmq-discuss] upgrade rabbitmq from 1.7.1 without loosing
 any	messages
In-Reply-To: <11222305.1636.1317726643909.JavaMail.geo-discussion-forums@yqjw35>
References: <11222305.1636.1317726643909.JavaMail.geo-discussion-forums@yqjw35>
Message-ID: <4E8AEB2D.2010904@rabbitmq.com>

On 04/10/11 12:10, Ivan Glushkov wrote:
> Is there any other option to switch from the old version to the newest one?

I'm afraid not.

The good news is that more recent versions of RabbitMQ will upgrade the 
DB schema automatically so you should only have to go through this 
process once.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From stastny at 101ideas.cz  Tue Oct  4 16:04:46 2011
From: stastny at 101ideas.cz (=?UTF-8?B?SmFrdWIgxaDFpWFzdG7DvQ==?=)
Date: Tue, 4 Oct 2011 16:04:46 +0100
Subject: [rabbitmq-discuss] SockJS protocol documentation?
Message-ID: <CA+1R4g4OhPyS8ajMYaw5AQupr4t00QycEk8CTQhwDnzRf0FNdA@mail.gmail.com>

Just a quick update to this topic:

SockJS protocol:

- https://github.com/sockjs/sockjs-protocol

- http://sockjs.github.com/sockjs-protocol/sockjs-protocol-0.0.4-incomplete.html

+ I'm working on the Ruby version
https://github.com/sockjs/sockjs-ruby now, it's not there yet, but I'm
on it :) For chunking I'll probably go for
http://rack.rubyforge.org/doc/Rack/Chunked.html (Unicorn web server
supports this middleware), so we can stay Rack-compatible (which is
quite a big deal in Ruby).

Jakub

http://twitter.com/botanicus

El 29 Sep 2011, a las 22:58, Tim Fox escribi?:

On 14/09/2011 12:35, Michael Klishin wrote:

2011/9/14 Alexis Richardson <alexis at rabbitmq.com>

I think that would be great

Have you looked at node.x? ?That might be a good place to do some hacking....

https://github.com/purplefox/node.x

Or (eg) https://github.com/purplefox/node.x/blob/master/src/examples/java/org/nodex/java/examples/websockets/WebsocketsExample.java

Alexis,

I am aware of Node.x. My plan right now is to use Netty directly but
thanks for the suggestion. I don't have enough understanding of the
existing implementation to really judge if Node.x or libraries like
Aleph and Finagle will really help me over plain Netty, we will see.

We plan to implement sock-js in node.x anyway.

--

MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin

_______________________________________________

rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

Jakub

http://www.flickr.com/photos/jakub-stastny
http://twitter.com/botanicus

From ranmizrachi at gmail.com  Tue Oct  4 16:29:52 2011
From: ranmizrachi at gmail.com (ran mizrachi)
Date: Tue, 4 Oct 2011 17:29:52 +0200
Subject: [rabbitmq-discuss] Queues creation in cluster
In-Reply-To: <CAOQFjYNTz_eCVDbDr_rwoJYn1dd6g3RqvfJ9wcxuvApg45Wsmg@mail.gmail.com>
References: <CAOQFjYNTz_eCVDbDr_rwoJYn1dd6g3RqvfJ9wcxuvApg45Wsmg@mail.gmail.com>
Message-ID: <CAOQFjYMaUE2EgNDbNiD4wvgmpU9R0EgnhDUYDS-gV73x+V4=Jg@mail.gmail.com>

"Rabbit creates the queue on the node to which you're connecting, unless it
already exists on another node."

I am setting a cluster of two nodes, creating queues on demand, how can I
make sure queues are created equally on both nodes.

If I need to load balance queues creation equally between the two nodes
myself, does anyone know of any plugging to do that ?

Thanks,
Ran.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111004/cc75c513/attachment.htm>

From steve.rehrauer at gmail.com  Tue Oct  4 18:05:11 2011
From: steve.rehrauer at gmail.com (Steve Rehrauer)
Date: Tue, 4 Oct 2011 13:05:11 -0400
Subject: [rabbitmq-discuss] Are publisher confirms at all aware of HA
	(replicated) durable queues?
Message-ID: <CADUq8CzZW9P4zmy9+XvK__OMYVbX_bqD+eFYQNZOWy8Zv8=Gug@mail.gmail.com>

If I'm asking the broker for publisher confirms, and I have a cluster
of nodes, and I have durable queues that are replicated (x-ha-policy:
"all"), does the broker send the confirm as soon as a message is
persisted in the queues of the master node?  It doesn't wait for those
queues to be replicated to the slaves?

Is there a mechanism, or any there any plans to add one, to ask the
broker to wait until replication has happened, to at least one slave
if not to all of them?  (I'm thinking of Apache Cassandra's
client-selectable consistency levels here, where I could ask that a
write return as soon as any single node persisted it, or wait for a
quorum, or for all.)

Thanks, --Steve

From ekirpichov at gmail.com  Tue Oct  4 18:49:55 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Tue, 4 Oct 2011 21:49:55 +0400
Subject: [rabbitmq-discuss] Bug in SessionManager.AutoCloseConnection()
	(race condition, crashes program)
Message-ID: <CANVKUrW4dqENnMRA4bQOX9p5TRu=S-jRH5Yk-pFC0=9n+YEiUg@mail.gmail.com>

Hi,

SessionManager.AutoCloseConnection can crash with the following stacktrace:
RabbitMQ.Client.Exceptions.AlreadyClosedException
  at RabbitMQ.Client.Impl.SessionBase.Transmit(RabbitMQ.Client.Impl.Command)
  at RabbitMQ.Client.Impl.MainSession.Transmit(RabbitMQ.Client.Impl.Command)
  at RabbitMQ.Client.Impl.ConnectionBase.Close(RabbitMQ.Client.ShutdownEventArgs,
Boolean, Int32)
  at RabbitMQ.Client.Impl.SessionManager.AutoCloseConnection()
  at System.Threading.ExecutionContext.Run(System.Threading.ExecutionContext,
System.Threading.ContextCallback, System.Object, Boolean)
  at System.Threading.ExecutionContext.Run(System.Threading.ExecutionContext,
System.Threading.ContextCallback, System.Object)
  at System.Threading.ThreadHelper.ThreadStart()

This happens if you close the client yourself at the same time that
it's due to be autoclosed (a strange but apparently possible
situation).

I haven't yet investigated further why this happened, but in any case
I think that the RabbitMQ internal threads must absolutely never
crash, even if that implies wrapping them in dumb try/catch/ignore,
'cause they take down the whole .NET process with them.

-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/

From allen.kim at epicadvertising.com  Tue Oct  4 19:00:32 2011
From: allen.kim at epicadvertising.com (Allen Kim)
Date: Tue, 4 Oct 2011 13:00:32 -0500
Subject: [rabbitmq-discuss] Is there a channel publish throughput limit
 to a queue?
In-Reply-To: <4E8AC5E3.5070701@rabbitmq.com>
Message-ID: <CAB0C112.DF28%allen.kim@epicadvertising.com>


Thanks for your reply. I have been waiting for someone to reply.

1. They are persistent messages (disk writing speed could slow down that
much?)
2. NOT large message (it's around two lines 200-400 bytes)
3. routing to only one queue
4. NO transaction
5. 3-4 consumers with basic.qos prefetch to 100.

So, #1 and #5 matters?

Allen



On 11-10-04 4:37 AM, "Matthias Radestock" <matthias at rabbitmq.com> wrote:

>On 29/09/11 21:47, Allen Kim wrote:
>> I checked the channel, and found out that the channel was still
>> publishing to a queue.
>
>Looks like the queues couldn't keep up with the inbound publishing rate,
>so rabbit ended up buffering messages in the channel.
>
>> The speed of publishing was around 700/s to 800/s, which is definitely
>> not 2000/s.
>
>...which is another indication of the above.
>
>> I was wondering if there is limit that affects publishing speed.
>
>Well, obviously rabbit cannot process messages at an infinite rate, so
>clearly there has to be a limit ;)
>
>However, 700Hz sounds quite low. On my desktop I can get more than 20
>times that. But there are many factors which can reduce that rate:
>- persistent messages
>- large messages
>- routing messages to lots of queues
>- using transactions
>- having lots of consumers with basic.qos prefetch
>etc.
>
>
>Matthias.


From bmurphy1976 at gmail.com  Tue Oct  4 21:57:09 2011
From: bmurphy1976 at gmail.com (Bryan Murphy)
Date: Tue, 4 Oct 2011 15:57:09 -0500
Subject: [rabbitmq-discuss] HA active/active cluster in a bad state
Message-ID: <CAP+1M2cL8G99Pj1+VF3HG=eLTTXTSFE5gcifXRDY4xQJfW4ESw@mail.gmail.com>

I have a 3-node HA active/active cluster in our integration environment that
is currently in a bad state.

I logged into one node, and did an /etc/init.d/rabbitmq-server restart.
 This never returned.  I logged into another terminal, kill -9 ALL rabbitmq
processes and then ran /etc/init.d/rabbitmq-server start.

This brought the server back up.  However, it's not functioning correctly.
 For example, sudo rabbitmqctl cluster_status works fine:

Cluster status of node 'rabbit at domU-12-31-38-07-18-A6' ...
[{nodes,[{disc,['rabbit at domU-12-31-38-07-18-A6','rabbit at ip-10-202-209-83',
                'rabbit at domU-12-31-39-06-72-50']}]},
 {running_nodes,['rabbit at domU-12-31-39-06-72-50','rabbit at ip-10-202-209-83',
                 'rabbit at domU-12-31-38-07-18-A6']}]
...done.

however, sudo rabbitmqctl list_queues blocks and never returns.

I'm not touching anything else while the cluster is in this state.  What
diagnostics can I provide to help track down this problem?

Thanks,
Bryan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111004/28303e43/attachment.htm>

From matthew at rabbitmq.com  Tue Oct  4 22:59:17 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 4 Oct 2011 22:59:17 +0100
Subject: [rabbitmq-discuss] HA active/active cluster in a bad state
In-Reply-To: <CAP+1M2cL8G99Pj1+VF3HG=eLTTXTSFE5gcifXRDY4xQJfW4ESw@mail.gmail.com>
References: <CAP+1M2cL8G99Pj1+VF3HG=eLTTXTSFE5gcifXRDY4xQJfW4ESw@mail.gmail.com>
Message-ID: <20111004215916.GA23024@wellquite.org>

Hi Bryan,

On Tue, Oct 04, 2011 at 03:57:09PM -0500, Bryan Murphy wrote:
> This brought the server back up.  However, it's not functioning correctly.
>  For example, sudo rabbitmqctl cluster_status works fine:
> 
> Cluster status of node 'rabbit at domU-12-31-38-07-18-A6' ...
> [{nodes,[{disc,['rabbit at domU-12-31-38-07-18-A6','rabbit at ip-10-202-209-83',
>                 'rabbit at domU-12-31-39-06-72-50']}]},
>  {running_nodes,['rabbit at domU-12-31-39-06-72-50','rabbit at ip-10-202-209-83',
>                  'rabbit at domU-12-31-38-07-18-A6']}]
> ...done.
> 
> however, sudo rabbitmqctl list_queues blocks and never returns.
> 
> I'm not touching anything else while the cluster is in this state.  What
> diagnostics can I provide to help track down this problem?

Ok, well you can Ctl-C the list_queues. On one of the other nodes, what
does rabbitmqctl cluster_status return?

How big were the queues? We recently fixed some bugs which had
previously been causing queue recovery to take a _very_ long time so it
might be one of those that's afflicting you. What is the CPU/disk doing
of the "stuck" node? If it's spinning then it's probably just taking a
very long time to recover.

Matthew

From bmurphy1976 at gmail.com  Wed Oct  5 02:10:09 2011
From: bmurphy1976 at gmail.com (Bryan Murphy)
Date: Tue, 4 Oct 2011 20:10:09 -0500
Subject: [rabbitmq-discuss] HA active/active cluster in a bad state
In-Reply-To: <20111004215916.GA23024@wellquite.org>
References: <CAP+1M2cL8G99Pj1+VF3HG=eLTTXTSFE5gcifXRDY4xQJfW4ESw@mail.gmail.com>
	<20111004215916.GA23024@wellquite.org>
Message-ID: <CAP+1M2eAWFJM7BXH1do2e=DtzbfxiCegaL=jiBBX6DE9tXxfVA@mail.gmail.com>

On Tue, Oct 4, 2011 at 4:59 PM, Matthew Sackman <matthew at rabbitmq.com>wrote:

> Ok, well you can Ctl-C the list_queues. On one of the other nodes, what
> does rabbitmqctl cluster_status return?
>


From tim at rabbitmq.com  Wed Oct  5 10:13:21 2011
From: tim at rabbitmq.com (Tim Fox)
Date: Wed, 05 Oct 2011 10:13:21 +0100
Subject: [rabbitmq-discuss] Is there a channel publish throughput limit
 to a queue?
In-Reply-To: <CAB0C112.DF28%allen.kim@epicadvertising.com>
References: <CAB0C112.DF28%allen.kim@epicadvertising.com>
Message-ID: <4E8C1FB1.9090307@rabbitmq.com>

On 04/10/11 19:00, Allen Kim wrote:
> Thanks for your reply. I have been waiting for someone to reply.
>
> 1. They are persistent messages (disk writing speed could slow down that
> much?)

A good disk can sync at about 200-300 syncs per second. If each 
published message is being synced to disk you should expect that level 
of performance. That's a hardware limit, not RabbitMQ related.

If you want to go above that and still have your data actually persisted 
when you think it is (i.e. when the confirm is returned), then you 
either need to get a solid state disk, SAN, or disks with non volatile 
cache.

Most desktop setups have disk write cache enabled by default, so you can 
get falsely highly rates of several thousand "syncs" per second when 
running on your cheap desktop/laptop only to be surprised when the rate 
goes down when you deploy to your production servers (since prod servers 
generally don't have cache enabled by default).

> 2. NOT large message (it's around two lines 200-400 bytes)
> 3. routing to only one queue
> 4. NO transaction
> 5. 3-4 consumers with basic.qos prefetch to 100.
>
> So, #1 and #5 matters?
>
> Allen
>
>
>
> On 11-10-04 4:37 AM, "Matthias Radestock"<matthias at rabbitmq.com>  wrote:
>
>> On 29/09/11 21:47, Allen Kim wrote:
>>> I checked the channel, and found out that the channel was still
>>> publishing to a queue.
>> Looks like the queues couldn't keep up with the inbound publishing rate,
>> so rabbit ended up buffering messages in the channel.
>>
>>> The speed of publishing was around 700/s to 800/s, which is definitely
>>> not 2000/s.
>> ...which is another indication of the above.
>>
>>> I was wondering if there is limit that affects publishing speed.
>> Well, obviously rabbit cannot process messages at an infinite rate, so
>> clearly there has to be a limit ;)
>>
>> However, 700Hz sounds quite low. On my desktop I can get more than 20
>> times that. But there are many factors which can reduce that rate:
>> - persistent messages
>> - large messages
>> - routing messages to lots of queues
>> - using transactions
>> - having lots of consumers with basic.qos prefetch
>> etc.
>>
>>
>> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From matthias at rabbitmq.com  Wed Oct  5 10:18:47 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 05 Oct 2011 10:18:47 +0100
Subject: [rabbitmq-discuss] Are publisher confirms at all aware of HA
 (replicated) durable queues?
In-Reply-To: <CADUq8CzZW9P4zmy9+XvK__OMYVbX_bqD+eFYQNZOWy8Zv8=Gug@mail.gmail.com>
References: <CADUq8CzZW9P4zmy9+XvK__OMYVbX_bqD+eFYQNZOWy8Zv8=Gug@mail.gmail.com>
Message-ID: <4E8C20F7.3040703@rabbitmq.com>

Steve,

On 04/10/11 18:05, Steve Rehrauer wrote:
> If I'm asking the broker for publisher confirms, and I have a cluster
> of nodes, and I have durable queues that are replicated (x-ha-policy:
> "all"), does the broker send the confirm as soon as a message is
> persisted in the queues of the master node?  It doesn't wait for those
> queues to be replicated to the slaves?

 From http://www.rabbitmq.com/ha.html#behaviour

<quote>
As the chosen slave becomes the master, no messages that are published 
to the mirrored-queue during this time will be lost: messages published 
to a mirrored-queue are always published directly to the master and all 
slaves. Thus should the master fail, the messages continue to be sent to 
the slaves and will be added to the queue once the promotion of a slave 
to the master completes.

Similarly, messages published by clients using publisher confirms will 
still be confirmed correctly even if the master (or any slaves) fail 
between the message being published and the message being able to be 
confirmed to the publisher.
</quote>

Matthias.

From matthias at rabbitmq.com  Wed Oct  5 10:35:48 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 05 Oct 2011 10:35:48 +0100
Subject: [rabbitmq-discuss] Is there a channel publish throughput limit
 to a queue?
In-Reply-To: <4E8C1FB1.9090307@rabbitmq.com>
References: <CAB0C112.DF28%allen.kim@epicadvertising.com>
	<4E8C1FB1.9090307@rabbitmq.com>
Message-ID: <4E8C24F4.4020903@rabbitmq.com>

Allen,

On 05/10/11 10:13, Tim Fox wrote:
> On 04/10/11 19:00, Allen Kim wrote:
>> Thanks for your reply. I have been waiting for someone to reply.
>>
>> 1. They are persistent messages (disk writing speed could slow down that
>> much?)
>
> A good disk can sync at about 200-300 syncs per second. If each
> published message is being synced to disk you should expect that level
> of performance.

Alas rabbit doesn't generally fsync per message. Except when using tx 
and committing after every message, or using confirms and waiting for 
confirmation after every message. Or when the sending rate is quite low.

On my desktop I can get >7kHz persistent messages routed.

>> 2. NOT large message (it's around two lines 200-400 bytes)
>> 3. routing to only one queue
>> 4. NO transaction
>> 5. 3-4 consumers with basic.qos prefetch to 100.
>>
>> So, #1 and #5 matters?

Possibly. Though I'd still expect to see significantly higher rates.

You can approximate the above setup by running the MulticastMain test 
program we ship with the java client and invoking it with the options

-f persistent -s 400 -y 3 -u q -q 100 -r 3000

The last figure is the target send rate. Watch the reported latencies. 
If they are stable, try a higher rate. The max rate at which the 
latencies are stable is the max throughput Rabbit can handle in that 
configuration.

On my machine the above test can easily get 6kHz with RabbitMQ 2.6.1.


Matthias.

From emile at rabbitmq.com  Wed Oct  5 11:35:56 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 05 Oct 2011 11:35:56 +0100
Subject: [rabbitmq-discuss] Bug in SessionManager.AutoCloseConnection()
 (race condition, crashes program)
In-Reply-To: <CANVKUrW4dqENnMRA4bQOX9p5TRu=S-jRH5Yk-pFC0=9n+YEiUg@mail.gmail.com>
References: <CANVKUrW4dqENnMRA4bQOX9p5TRu=S-jRH5Yk-pFC0=9n+YEiUg@mail.gmail.com>
Message-ID: <4E8C330C.5010906@rabbitmq.com>

Hi Eugene,

On 04/10/11 18:49, Eugene Kirpichov wrote:
> Hi,
> 
> SessionManager.AutoCloseConnection can crash with the following stacktrace:

Thanks for reporting the problem. I will file a bug to investigate.
There certainly appears to be a problem there, though I would expect it
to be an exceedingly rare occurrence. Please let us know if you discover
any further relevant information.


-Emile


From allen.kim at epicadvertising.com  Wed Oct  5 14:38:57 2011
From: allen.kim at epicadvertising.com (Allen Kim)
Date: Wed, 5 Oct 2011 08:38:57 -0500
Subject: [rabbitmq-discuss] Is there a channel publish throughput limit
 to a queue?
In-Reply-To: <4E8C1FB1.9090307@rabbitmq.com>
Message-ID: <CAB1D619.DFA9%allen.kim@epicadvertising.com>

Thanks for your reply. that explains a lot.

Allen Kim





On 11-10-05 5:13 AM, "Tim Fox" <tim at rabbitmq.com> wrote:

>On 04/10/11 19:00, Allen Kim wrote:
>> Thanks for your reply. I have been waiting for someone to reply.
>>
>> 1. They are persistent messages (disk writing speed could slow down that
>> much?)
>
>A good disk can sync at about 200-300 syncs per second. If each
>published message is being synced to disk you should expect that level
>of performance. That's a hardware limit, not RabbitMQ related.
>
>If you want to go above that and still have your data actually persisted
>when you think it is (i.e. when the confirm is returned), then you
>either need to get a solid state disk, SAN, or disks with non volatile
>cache.
>
>Most desktop setups have disk write cache enabled by default, so you can
>get falsely highly rates of several thousand "syncs" per second when
>running on your cheap desktop/laptop only to be surprised when the rate
>goes down when you deploy to your production servers (since prod servers
>generally don't have cache enabled by default).
>
>> 2. NOT large message (it's around two lines 200-400 bytes)
>> 3. routing to only one queue
>> 4. NO transaction
>> 5. 3-4 consumers with basic.qos prefetch to 100.
>>
>> So, #1 and #5 matters?
>>
>> Allen
>>
>>
>>
>> On 11-10-04 4:37 AM, "Matthias Radestock"<matthias at rabbitmq.com>  wrote:
>>
>>> On 29/09/11 21:47, Allen Kim wrote:
>>>> I checked the channel, and found out that the channel was still
>>>> publishing to a queue.
>>> Looks like the queues couldn't keep up with the inbound publishing
>>>rate,
>>> so rabbit ended up buffering messages in the channel.
>>>
>>>> The speed of publishing was around 700/s to 800/s, which is definitely
>>>> not 2000/s.
>>> ...which is another indication of the above.
>>>
>>>> I was wondering if there is limit that affects publishing speed.
>>> Well, obviously rabbit cannot process messages at an infinite rate, so
>>> clearly there has to be a limit ;)
>>>
>>> However, 700Hz sounds quite low. On my desktop I can get more than 20
>>> times that. But there are many factors which can reduce that rate:
>>> - persistent messages
>>> - large messages
>>> - routing messages to lots of queues
>>> - using transactions
>>> - having lots of consumers with basic.qos prefetch
>>> etc.
>>>
>>>
>>> Matthias.
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>_______________________________________________
>rabbitmq-discuss mailing list
>rabbitmq-discuss at lists.rabbitmq.com
>https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From steve.rehrauer at gmail.com  Wed Oct  5 14:54:36 2011
From: steve.rehrauer at gmail.com (Steve Rehrauer)
Date: Wed, 5 Oct 2011 09:54:36 -0400
Subject: [rabbitmq-discuss] Are publisher confirms at all aware of HA
 (replicated) durable queues?
In-Reply-To: <4E8C20F7.3040703@rabbitmq.com>
References: <CADUq8CzZW9P4zmy9+XvK__OMYVbX_bqD+eFYQNZOWy8Zv8=Gug@mail.gmail.com>
	<4E8C20F7.3040703@rabbitmq.com>
Message-ID: <CADUq8CwXi6fABUJsXB=bAONJZ80_c2yGerJPwBfV62ak8rJCiQ@mail.gmail.com>

Okay, thanks.

I'm trying to chase down why I'm not seeing all the events I've
published, in a test that shuts down the master node while events are
being produced.  Am trying to understand what I might be doing wrong.
Good to know that I can rely on robust publisher confirms!

I've pruned the test back to a very simple thing now.  I have two
nodes in the cluster.

1. With both nodes running, I produce an event.
2. I verify that I can consume this event.  I verify that I get a
publisher confirmation from the broker.
3. Using Alice, I stop the master node.
4. I produce another event.
5. I verify that I can consume this event.

I'm not seeing the event from step 5.  I wonder if I'm not properly
setting up the consumer?

When I stop the master node in step 3, I see the consumer catch a
ShutdownSignalException, with "reason:
{#method<connection.close>(reply-code=320,
reply-text=CONNECTION_FORCED - broker forced connection closure with
reason 'shutdown'".  The consumer reconnects to the broker,
successfully as far as I can tell.

When I try to produce another event in step 4, the producer also
catches a ShutdownSignalException, with "clean connection shutdown;
reason: Attempt to use closed channel".  The producer also reconnects
to the broker, successfully as far as I can tell.

After the producer reconnects, I see it succeed in basicPublish().  I
also see a publish confirmation from the broker for this event.

However, the consumer is never seeing it.

Q1: Is it surprising that the producer sees this in step 4?  I assumed
that it would be the same for the producer as for the consumer; if the
master node goes down, both sides must reconnect to the broker?

Q2: I think I am asking for consumer cancellation notification in the
consumer, but I never see the callback happen.  Should I expect to, in
the scenario I've outlined above?  I'm now a little concerned I'm not
setting it up properly, and this is why my consumer never sees this
event.  Here's the Java code that I use, which is in a class that
derives from RabbitMQ's ConnectionFactory.

   public DerivedConnectionFactory() {
      super();

      ...

        Map<String, Object> clientProperties = new HashMap<String, Object>();
        clientProperties.put(
               "consumer_cancel_notify",
                Boolean.valueOf(true)
                );
        this.setClientProperties(clientProperties);
   }

Thanks, --Steve

On Wed, Oct 5, 2011 at 5:18 AM, Matthias Radestock
<matthias at rabbitmq.com> wrote:
> Steve,
>
> On 04/10/11 18:05, Steve Rehrauer wrote:
>>
>> If I'm asking the broker for publisher confirms, and I have a cluster
>> of nodes, and I have durable queues that are replicated (x-ha-policy:
>> "all"), does the broker send the confirm as soon as a message is
>> persisted in the queues of the master node? ?It doesn't wait for those
>> queues to be replicated to the slaves?
>
> From http://www.rabbitmq.com/ha.html#behaviour
>
> <quote>
> As the chosen slave becomes the master, no messages that are published to
> the mirrored-queue during this time will be lost: messages published to a
> mirrored-queue are always published directly to the master and all slaves.
> Thus should the master fail, the messages continue to be sent to the slaves
> and will be added to the queue once the promotion of a slave to the master
> completes.
>
> Similarly, messages published by clients using publisher confirms will still
> be confirmed correctly even if the master (or any slaves) fail between the
> message being published and the message being able to be confirmed to the
> publisher.
> </quote>
>
> Matthias.
>

From harvey.robin at gmail.com  Wed Oct  5 15:02:14 2011
From: harvey.robin at gmail.com (Robin Harvey)
Date: Wed, 5 Oct 2011 15:02:14 +0100
Subject: [rabbitmq-discuss] Regex field validation as per Amqp spec
Message-ID: <CAOvN6FCVNfujJLwOn2=Ab5yAjGtTY+qpvGo4=LE=mqfjJ5zcHw@mail.gmail.com>

Hi,

I've been playing around with some RPC implementations and I've come across
a problem with validation of outgoing message fields.

I've re-implemented the "thumper" RPC demos (
https://github.com/videlalvaro/Thumper), the RPC client uses an
auto-generated queue name for the response queue (from queue.declare-ok),
these look something like this:

amq.gen-IuK1REOUDF8MxpANaTQWXQ==

However, when I pass this to the basic.consume, my library complains that
this breaks validation of the amqp "queue-name" domain, which has the
following regex validation rule:

^[a-zA-Z0-9-_.:]*$

I've changed my library to ignore the error and everything works great.

Does RabbitMQ ignore these regex rules, or have I mis-interpreted the spec?
Should I remove the regex validation feature from my library?


Thanks!
--Robin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111005/6081d849/attachment.htm>

From steve.rehrauer at gmail.com  Wed Oct  5 15:16:37 2011
From: steve.rehrauer at gmail.com (Steve Rehrauer)
Date: Wed, 5 Oct 2011 10:16:37 -0400
Subject: [rabbitmq-discuss] Are publisher confirms at all aware of HA
 (replicated) durable queues?
In-Reply-To: <CADUq8CwXi6fABUJsXB=bAONJZ80_c2yGerJPwBfV62ak8rJCiQ@mail.gmail.com>
References: <CADUq8CzZW9P4zmy9+XvK__OMYVbX_bqD+eFYQNZOWy8Zv8=Gug@mail.gmail.com>
	<4E8C20F7.3040703@rabbitmq.com>
	<CADUq8CwXi6fABUJsXB=bAONJZ80_c2yGerJPwBfV62ak8rJCiQ@mail.gmail.com>
Message-ID: <CADUq8CwJg3Djh9cQgsTXTBFX8vNrpi8oWgC79-0=L+xrDbS85Q@mail.gmail.com>

Hmm.  While I do see a publisher confirmation from the broker, I don't
actually see the message in the queues.  (When I say "event" below, I
really mean "message", sorry.)  Any idea what I should suspect that I
could be doing wrong on the producer side?

Thanks, --Steve

On Wed, Oct 5, 2011 at 9:54 AM, Steve Rehrauer <steve.rehrauer at gmail.com> wrote:
> Okay, thanks.
>
> I'm trying to chase down why I'm not seeing all the events I've
> published, in a test that shuts down the master node while events are
> being produced. ?Am trying to understand what I might be doing wrong.
> Good to know that I can rely on robust publisher confirms!
>
> I've pruned the test back to a very simple thing now. ?I have two
> nodes in the cluster.
>
> 1. With both nodes running, I produce an event.
> 2. I verify that I can consume this event. ?I verify that I get a
> publisher confirmation from the broker.
> 3. Using Alice, I stop the master node.
> 4. I produce another event.
> 5. I verify that I can consume this event.
>
> I'm not seeing the event from step 5. ?I wonder if I'm not properly
> setting up the consumer?
>
> When I stop the master node in step 3, I see the consumer catch a
> ShutdownSignalException, with "reason:
> {#method<connection.close>(reply-code=320,
> reply-text=CONNECTION_FORCED - broker forced connection closure with
> reason 'shutdown'". ?The consumer reconnects to the broker,
> successfully as far as I can tell.
>
> When I try to produce another event in step 4, the producer also
> catches a ShutdownSignalException, with "clean connection shutdown;
> reason: Attempt to use closed channel". ?The producer also reconnects
> to the broker, successfully as far as I can tell.
>
> After the producer reconnects, I see it succeed in basicPublish(). ?I
> also see a publish confirmation from the broker for this event.
>
> However, the consumer is never seeing it.
>
> Q1: Is it surprising that the producer sees this in step 4? ?I assumed
> that it would be the same for the producer as for the consumer; if the
> master node goes down, both sides must reconnect to the broker?
>
> Q2: I think I am asking for consumer cancellation notification in the
> consumer, but I never see the callback happen. ?Should I expect to, in
> the scenario I've outlined above? ?I'm now a little concerned I'm not
> setting it up properly, and this is why my consumer never sees this
> event. ?Here's the Java code that I use, which is in a class that
> derives from RabbitMQ's ConnectionFactory.
>
> ? public DerivedConnectionFactory() {
> ? ? ?super();
>
> ? ? ?...
>
> ? ? ? ?Map<String, Object> clientProperties = new HashMap<String, Object>();
> ? ? ? ?clientProperties.put(
> ? ? ? ? ? ? ? "consumer_cancel_notify",
> ? ? ? ? ? ? ? ?Boolean.valueOf(true)
> ? ? ? ? ? ? ? ?);
> ? ? ? ?this.setClientProperties(clientProperties);
> ? }
>
> Thanks, --Steve
>
> On Wed, Oct 5, 2011 at 5:18 AM, Matthias Radestock
> <matthias at rabbitmq.com> wrote:
>> Steve,
>>
>> On 04/10/11 18:05, Steve Rehrauer wrote:
>>>
>>> If I'm asking the broker for publisher confirms, and I have a cluster
>>> of nodes, and I have durable queues that are replicated (x-ha-policy:
>>> "all"), does the broker send the confirm as soon as a message is
>>> persisted in the queues of the master node? ?It doesn't wait for those
>>> queues to be replicated to the slaves?
>>
>> From http://www.rabbitmq.com/ha.html#behaviour
>>
>> <quote>
>> As the chosen slave becomes the master, no messages that are published to
>> the mirrored-queue during this time will be lost: messages published to a
>> mirrored-queue are always published directly to the master and all slaves.
>> Thus should the master fail, the messages continue to be sent to the slaves
>> and will be added to the queue once the promotion of a slave to the master
>> completes.
>>
>> Similarly, messages published by clients using publisher confirms will still
>> be confirmed correctly even if the master (or any slaves) fail between the
>> message being published and the message being able to be confirmed to the
>> publisher.
>> </quote>
>>
>> Matthias.
>>
>

From pierre-marie.padiou at morpho.com  Wed Oct  5 18:04:21 2011
From: pierre-marie.padiou at morpho.com (PADIOU Pierre-Marie (MORPHO))
Date: Wed, 5 Oct 2011 19:04:21 +0200
Subject: [rabbitmq-discuss] autodelete exchanges and queues
Message-ID: <E9FBE39960CDBF4A8CD9DE7E9D14C5091276143870@Y000IMRV01.rd1.rf1>

Hello,

I am wondering what is the life cycle of autodelete exchanges and queues.

What if :

1)      Channel A declares an autodelete exchange

2)      Channel B declares the same autodelete exchange (passive=false)

3)      Channel A disconnects

4)      Channel B disconnects

I was under the impression that rabbitmq would delete the exchange between step 3) and 4) (which I btw do not find very logical), no matter if B was still alive. Is that true? What about queues?

In other words, autodelete = "delete when last declaring-channel leaves" OR "delete when first-declaring-channel leaves"?

Thanks,

Pierre-Marie
#
" Ce courriel et les documents qui lui sont joints peuvent contenir des informations confidentielles ou ayant un caract?re priv?. S'ils ne vous sont pas destin?s, nous vous signalons qu'il est strictement interdit de les divulguer, de les reproduire ou d'en utiliser de quelque mani?re que ce soit le contenu. Si ce message vous a ?t? transmis par erreur, merci d'en informer l'exp?diteur et de supprimer imm?diatement de votre syst?me informatique ce courriel ainsi que tous les documents qui y sont attach?s."
******
" This e-mail and any attached documents may contain confidential or proprietary information. If you are not the intended recipient, you are notified that any dissemination, copying of this e-mail and any attachments thereto or use of their contents by any means whatsoever is strictly prohibited. If you have received this e-mail in error, please advise the sender immediately and delete this e-mail and all attached documents from your computer system."
#
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111005/27422ed6/attachment.htm>

From simon at rabbitmq.com  Wed Oct  5 18:25:56 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 05 Oct 2011 18:25:56 +0100
Subject: [rabbitmq-discuss] autodelete exchanges and queues
In-Reply-To: <E9FBE39960CDBF4A8CD9DE7E9D14C5091276143870@Y000IMRV01.rd1.rf1>
References: <E9FBE39960CDBF4A8CD9DE7E9D14C5091276143870@Y000IMRV01.rd1.rf1>
Message-ID: <4E8C9324.6050102@rabbitmq.com>

On 05/10/11 18:04, PADIOU Pierre-Marie (MORPHO) wrote:
> Hello,
>
> I am wondering what is the life cycle of autodelete exchanges and queues.
>
> What if :
>
> 1)Channel A declares an autodelete exchange
>
> 2)Channel B declares the same autodelete exchange (passive=false)
>
> 3)Channel A disconnects
>
> 4)Channel B disconnects
>
> I was under the impression that rabbitmq would delete the exchange
> between step 3) and 4) (which I btw do not find very logical), no matter
> if B was still alive. Is that true? What about queues?
>
> In other words, autodelete = ?delete when last declaring-channel leaves?
> OR ?delete when first-declaring-channel leaves??

Hi Pierre-Marie. autodelete and exclusive frequently get confused.

exclusive = delete when declaring *connection* closes. No other 
connection can even access this. Only queues can be exclusive.

autodelete = delete when the *last* downstream thing (i.e. consumers for 
a queue, or queues for an exchange) goes away. Note that this isn't 
bound to channels or connections at all really.

exclusive is more frequently useful than autodelete.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From tpletch001 at gmail.com  Wed Oct  5 15:08:46 2011
From: tpletch001 at gmail.com (p2w)
Date: Wed, 5 Oct 2011 07:08:46 -0700 (PDT)
Subject: [rabbitmq-discuss] move to 2.6.1 on ubuntu 11
Message-ID: <91119453-e11a-4226-8485-c1196ebc566e@g29g2000yqh.googlegroups.com>

running ubuntu 11 ami on ec2 with rabbitmq 2.3.1 installed.

have run into issues with getting the management plugins to work and
thinking probably best to roll up to 2.6.1 before i start digging
around trying to make the web admin console run..

however, the apt-get deb repos appear to be still at 2.3.1. what is
best way to move to 2.6.1 at this point?

thansk in advance for any info/tips.

From marc at lynxconsultants.com  Thu Oct  6 10:45:52 2011
From: marc at lynxconsultants.com (Marc Cluet)
Date: Thu, 6 Oct 2011 10:45:52 +0100
Subject: [rabbitmq-discuss] move to 2.6.1 on ubuntu 11
In-Reply-To: <91119453-e11a-4226-8485-c1196ebc566e@g29g2000yqh.googlegroups.com>
References: <91119453-e11a-4226-8485-c1196ebc566e@g29g2000yqh.googlegroups.com>
Message-ID: <921BBF94-B670-460B-BDB5-1814AD0FA857@lynxconsultants.com>

Hi,

rabbitmq 2.6.1 won't be available until ubuntu-p at least, but you can try it on 11.10 (oneiric) using my private ppa (https://launchpad.net/~lynxman/+archive/ppa)

Let me know how it works for you and if there's anything you'd like to be added to it ;)

Regards,

On 5 Oct 2011, at 15:08, p2w wrote:

> running ubuntu 11 ami on ec2 with rabbitmq 2.3.1 installed.
> 
> have run into issues with getting the management plugins to work and
> thinking probably best to roll up to 2.6.1 before i start digging
> around trying to make the web admin console run..
> 
> however, the apt-get deb repos appear to be still at 2.3.1. what is
> best way to move to 2.6.1 at this point?
> 
> thansk in advance for any info/tips.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111006/295a5c96/attachment.htm>

From emile at rabbitmq.com  Thu Oct  6 11:35:57 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 06 Oct 2011 11:35:57 +0100
Subject: [rabbitmq-discuss] Regex field validation as per Amqp spec
In-Reply-To: <CAOvN6FCVNfujJLwOn2=Ab5yAjGtTY+qpvGo4=LE=mqfjJ5zcHw@mail.gmail.com>
References: <CAOvN6FCVNfujJLwOn2=Ab5yAjGtTY+qpvGo4=LE=mqfjJ5zcHw@mail.gmail.com>
Message-ID: <4E8D848D.9060209@rabbitmq.com>

Hi Robin,

On 05/10/11 15:02, Robin Harvey wrote:
> (https://github.com/videlalvaro/Thumper), the RPC client uses an
> auto-generated queue name for the response queue (from
> queue.declare-ok), these look something like this:
> 
> amq.gen-IuK1REOUDF8MxpANaTQWXQ==
> 
> However, when I pass this to the basic.consume, my library complains
> that this breaks validation of the amqp "queue-name" domain, which has
> the following regex validation rule:
> 
> ^[a-zA-Z0-9-_.:]*$

This expression won't match queues that are auto-generated by rabbit.
Queue names are "shortstr" in the AMQP 0-9-1 spec, which says:

"""
Short strings, stored as an 8-bit unsigned integer length followed by
zero or more octets of data. Short strings can carry up to 255 octets of
UTF-8 data, but may not contain binary zero octets.
"""

I see little need for validation beyond checking of length. You can
probably ignore validation errors from your library. You might even
request that the library author relax the validation, depending on what
that validation is attempting to achieve.


-Emil


From matthew at rabbitmq.com  Tue Oct  4 18:07:31 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 4 Oct 2011 18:07:31 +0100
Subject: [rabbitmq-discuss] Are publisher confirms at all aware of HA
 (replicated) durable queues?
In-Reply-To: <CADUq8CzZW9P4zmy9+XvK__OMYVbX_bqD+eFYQNZOWy8Zv8=Gug@mail.gmail.com>
References: <CADUq8CzZW9P4zmy9+XvK__OMYVbX_bqD+eFYQNZOWy8Zv8=Gug@mail.gmail.com>
Message-ID: <20111004170730.GA4827@rabbitmq.com>

On Tue, Oct 04, 2011 at 01:05:11PM -0400, Steve Rehrauer wrote:
> If I'm asking the broker for publisher confirms, and I have a cluster
> of nodes, and I have durable queues that are replicated (x-ha-policy:
> "all"), does the broker send the confirm as soon as a message is
> persisted in the queues of the master node?  It doesn't wait for those
> queues to be replicated to the slaves?

It waits for all mirrors of the queue. It's the same as a message which
is just routed to multiple queues.

Matthew

From simon at rabbitmq.com  Thu Oct  6 12:18:07 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 06 Oct 2011 12:18:07 +0100
Subject: [rabbitmq-discuss] move to 2.6.1 on ubuntu 11
In-Reply-To: <91119453-e11a-4226-8485-c1196ebc566e@g29g2000yqh.googlegroups.com>
References: <91119453-e11a-4226-8485-c1196ebc566e@g29g2000yqh.googlegroups.com>
Message-ID: <4E8D8E6F.5020603@rabbitmq.com>

On 05/10/11 15:08, p2w wrote:
> however, the apt-get deb repos appear to be still at 2.3.1. what is
> best way to move to 2.6.1 at this point?

You can use our apt repository:

http://www.rabbitmq.com/debian.html

The dependencies for RabbitMQ are pretty simple, so the repository works 
all modern versions of Ubuntu and Debian.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Thu Oct  6 12:29:55 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 06 Oct 2011 12:29:55 +0100
Subject: [rabbitmq-discuss] Regex field validation as per Amqp spec
In-Reply-To: <4E8D848D.9060209@rabbitmq.com>
References: <CAOvN6FCVNfujJLwOn2=Ab5yAjGtTY+qpvGo4=LE=mqfjJ5zcHw@mail.gmail.com>
	<4E8D848D.9060209@rabbitmq.com>
Message-ID: <4E8D9133.4030206@rabbitmq.com>

Hi Robin,

On 06/10/11 11:35, Emile Joubert wrote:
> On 05/10/11 15:02, Robin Harvey wrote:
>> (https://github.com/videlalvaro/Thumper), the RPC client uses an
>> auto-generated queue name for the response queue (from
>> queue.declare-ok), these look something like this:
>>
>> amq.gen-IuK1REOUDF8MxpANaTQWXQ==
>>
>> However, when I pass this to the basic.consume, my library complains
>> that this breaks validation of the amqp "queue-name" domain, which has
>> the following regex validation rule:
>>
>> ^[a-zA-Z0-9-_.:]*$
> 
> This expression won't match queues that are auto-generated by rabbit.
> Queue names are "shortstr" in the AMQP 0-9-1 spec, which says:

Ignore everything I said. The library is correct to apply this
validation. It has just been pointed out to me that this validation rule
appears in the XML version of the specification:

https://www.amqp.org/confluence/download/attachments/720900/amqp0-9-1.xml

I will file a bug to restrict the range of characters that appear in
auto-generated queue names. Thanks for reporting this problem.



-Emile

From tpletch001 at gmail.com  Thu Oct  6 14:57:53 2011
From: tpletch001 at gmail.com (p2w)
Date: Thu, 6 Oct 2011 06:57:53 -0700 (PDT)
Subject: [rabbitmq-discuss] move to 2.6.1 on ubuntu 11
In-Reply-To: <4E8D8E6F.5020603@rabbitmq.com>
References: <91119453-e11a-4226-8485-c1196ebc566e@g29g2000yqh.googlegroups.com>
	<4E8D8E6F.5020603@rabbitmq.com>
Message-ID: <0b084646-f1d9-463b-aad7-8d73e8265c1b@i9g2000yqe.googlegroups.com>

Simon,

Thanks, using the rabbitmq repos worked for me. That and I must come
clean and admit a total brain-fart in trying to get the 2.6.1 plugins
to work against a 2.3.1 server, duh!!!! Wish i'd realized that mistake
much earlier in the day yesterday...

I do have one question though regarding erlang versions. I am using
ubuntu 11.04, and the erlang version in that build is R13B03. Is this
going to be a problem when using the 2.6.1 version of rabbitmq?


On Oct 6, 6:18?am, Simon MacMullen <si... at rabbitmq.com> wrote:
> On 05/10/11 15:08, p2w wrote:
>
> > however, the apt-get deb repos appear to be still at 2.3.1. what is
> > best way to move to 2.6.1 at this point?
>
> You can use our apt repository:
>
> http://www.rabbitmq.com/debian.html
>
> The dependencies for RabbitMQ are pretty simple, so the repository works
> all modern versions of Ubuntu and Debian.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simon at rabbitmq.com  Thu Oct  6 15:00:51 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 06 Oct 2011 15:00:51 +0100
Subject: [rabbitmq-discuss] move to 2.6.1 on ubuntu 11
In-Reply-To: <0b084646-f1d9-463b-aad7-8d73e8265c1b@i9g2000yqe.googlegroups.com>
References: <91119453-e11a-4226-8485-c1196ebc566e@g29g2000yqh.googlegroups.com>	<4E8D8E6F.5020603@rabbitmq.com>
	<0b084646-f1d9-463b-aad7-8d73e8265c1b@i9g2000yqe.googlegroups.com>
Message-ID: <4E8DB493.1040204@rabbitmq.com>

On 06/10/11 14:57, p2w wrote:
> I do have one question though regarding erlang versions. I am using
> ubuntu 11.04, and the erlang version in that build is R13B03. Is this
> going to be a problem when using the 2.6.1 version of rabbitmq?

There is some discussion of Erlang versions here:

http://www.rabbitmq.com/which-erlang.html

Summary: I wouldn't hope for reliable SSL, everything else should be OK.

In practice the Erlang version requirements for RabbitMQ haven't changed 
since before 2.3.1 and probably won't for a while.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From matthew at rabbitmq.com  Thu Oct  6 15:23:14 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 6 Oct 2011 15:23:14 +0100
Subject: [rabbitmq-discuss] move to 2.6.1 on ubuntu 11
In-Reply-To: <0b084646-f1d9-463b-aad7-8d73e8265c1b@i9g2000yqe.googlegroups.com>
References: <91119453-e11a-4226-8485-c1196ebc566e@g29g2000yqh.googlegroups.com>
	<4E8D8E6F.5020603@rabbitmq.com>
	<0b084646-f1d9-463b-aad7-8d73e8265c1b@i9g2000yqe.googlegroups.com>
Message-ID: <20111006142314.GG18542@rabbitmq.com>

On Thu, Oct 06, 2011 at 06:57:53AM -0700, p2w wrote:
> I do have one question though regarding erlang versions. I am using
> ubuntu 11.04, and the erlang version in that build is R13B03. Is this
> going to be a problem when using the 2.6.1 version of rabbitmq?

Recent benchmarking has shown that on EC2, R14B03 is rather a lot better
than R13B03 on EC2. *If* you start encountering performance issues, you
may want to start considering upgrading your version of Erlang on EC2.

Matthew

From james.r.carr at gmail.com  Thu Oct  6 16:20:04 2011
From: james.r.carr at gmail.com (James Carr)
Date: Thu, 6 Oct 2011 10:20:04 -0500
Subject: [rabbitmq-discuss] compiling librabbitmq on ubuntu?
Message-ID: <CAJreXKCt+ARcfzk=Ab-SpsQ198i0nq-31=tdzBvJFRrFjGhZ5g@mail.gmail.com>

I did a fresh clone of http://hg.rabbitmq.com/rabbitmq-c/ to my laptop
this morning and tried to compile it, however I seem to have issues
running ./configure as stated in the INSTALL document. It says no such
file or directory.

I'm a little baffled... I'm used to the "./configure && make && make
install" cycle quite well and I have numerous applications on my
laptop that I've compiled in this fashion. Am I missing something?

From tonygarnockjones+rabbitmq at gmail.com  Thu Oct  6 16:39:49 2011
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Thu, 6 Oct 2011 11:39:49 -0400
Subject: [rabbitmq-discuss] compiling librabbitmq on ubuntu?
In-Reply-To: <CAJreXKCt+ARcfzk=Ab-SpsQ198i0nq-31=tdzBvJFRrFjGhZ5g@mail.gmail.com>
References: <CAJreXKCt+ARcfzk=Ab-SpsQ198i0nq-31=tdzBvJFRrFjGhZ5g@mail.gmail.com>
Message-ID: <CAM8fPiQRLgZpsM5i+sqSmYw=j=EirPni8kQgYKK2uxxkN_enJw@mail.gmail.com>

The issue is that you have a checkout from source control rather than a
released tarball. The hg-controlled sources have configure.ac, which is
compiled by autoconf to ./configure. Try running "autoreconf -fvi", which
should perform the requisite rubber-chicken-waving to get a ./configure you
can then run.

Regards,
  Tony

On 6 October 2011 11:20, James Carr <james.r.carr at gmail.com> wrote:

> I did a fresh clone of http://hg.rabbitmq.com/rabbitmq-c/ to my laptop
> this morning and tried to compile it, however I seem to have issues
> running ./configure as stated in the INSTALL document. It says no such
> file or directory.
>
> I'm a little baffled... I'm used to the "./configure && make && make
> install" cycle quite well and I have numerous applications on my
> laptop that I've compiled in this fashion. Am I missing something?
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111006/d1a9ee23/attachment.htm>

From david at rabbitmq.com  Thu Oct  6 16:41:10 2011
From: david at rabbitmq.com (David Wragg)
Date: Thu, 06 Oct 2011 16:41:10 +0100
Subject: [rabbitmq-discuss] compiling librabbitmq on ubuntu?
In-Reply-To: <CAJreXKCt+ARcfzk=Ab-SpsQ198i0nq-31=tdzBvJFRrFjGhZ5g@mail.gmail.com>
	(James Carr's message of "Thu, 6 Oct 2011 10:20:04 -0500")
References: <CAJreXKCt+ARcfzk=Ab-SpsQ198i0nq-31=tdzBvJFRrFjGhZ5g@mail.gmail.com>
Message-ID: <yrv4cvcs25drd.fsf@dwragg.eng.vmware.com>

Hi James,

James Carr <james.r.carr at gmail.com> writes:
> I did a fresh clone of http://hg.rabbitmq.com/rabbitmq-c/ to my laptop
> this morning and tried to compile it, however I seem to have issues
> running ./configure as stated in the INSTALL document. It says no such
> file or directory.

Could you let us see the full configure output?

David

-- 
David Wragg
Staff Engineer, RabbitMQ
VMware, Inc.

From andrea.rosa at hp.com  Fri Oct  7 09:08:54 2011
From: andrea.rosa at hp.com (Rosa, Andrea)
Date: Fri, 7 Oct 2011 08:08:54 +0000
Subject: [rabbitmq-discuss] Rabbitmq Crash and number of consumers
Message-ID: <5F389C517756284F80239F55BCA5DDDD05C0EF@G9W0721.americas.hpqcorp.net>

Hi all,

We are using Rabbitmq 2.5 version and yesterday we found (a number of time) in the log file this entry:

=INFO REPORT==== 6-Oct-2011::14:58:13 ===
    alarm_handler: {set,{file_descriptor_limit,[]}}

Finally it hit an error:

=ERROR REPORT==== 6-Oct-2011::14:58:13 ===
** Generic server msg_store_persistent terminating
** Last message in was {'$gen_cast',
                           {client_dying,
                               <<199,5,182,196,129,67,147,182,61,201,143,0,
                                 51,197,190,234>>}}
** When Server state == {msstate,
                            "/var/lib/rabbitmq/mnesia/nodename/msg_store_persistent",
                            rabbit_msg_store_ets_index,
                            {state,520256,
                                "/var/lib/rabbitmq/mnesia/nodename/msg_store_persistent"},
                            22,#Ref<0.0.0.1817>,
                            {dict,0,16,16,8,80,48,
                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                            [],undefined,589,5530342,[],<0.296.0>,524353,
                            516159,528450,
                            {set,19,16,16,8,80,48,
                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                        ....
** Reason for termination ==
** {{badmatch,false},
    [{rabbit_msg_store_ets_index,insert,2},
     {rabbit_msg_store,write_message,3},
     {rabbit_msg_store,handle_cast,2},
     {gen_server2,handle_msg,2},
     {proc_lib,wake_up,3}]}

=INFO REPORT==== 6-Oct-2011::14:58:14 ===
stopped TCP Listener on [::]:5672

Right after this, rabbitmq closed the listener socket and did not recover. The service kept running without accepting any connections, to fix the problem we needed to restart the service.
What can be happened?

I have got another question: when I run the rabbitmqctl list_queues consumers the number of the consumers how is it calculate?
There is a "live" calculation or the information are stored somewhere and refreshed after "n" seconds?
I've got a queue with a single consumer and sometimes (I don't know why!) the consumer disappears, to detect that there is a script running which uses rabbitmqctl list_queues command but It can detect this situation with a delay of about 10-15 minutes even if the script  runs every minute.

Best Regards
--
Andrea Rosa



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111007/cc49608b/attachment.htm>

From matthias at rabbitmq.com  Fri Oct  7 09:12:20 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 07 Oct 2011 09:12:20 +0100
Subject: [rabbitmq-discuss] Are publisher confirms at all aware of HA
 (replicated) durable queues?
In-Reply-To: <CADUq8CwJg3Djh9cQgsTXTBFX8vNrpi8oWgC79-0=L+xrDbS85Q@mail.gmail.com>
References: <CADUq8CzZW9P4zmy9+XvK__OMYVbX_bqD+eFYQNZOWy8Zv8=Gug@mail.gmail.com>	<4E8C20F7.3040703@rabbitmq.com>	<CADUq8CwXi6fABUJsXB=bAONJZ80_c2yGerJPwBfV62ak8rJCiQ@mail.gmail.com>
	<CADUq8CwJg3Djh9cQgsTXTBFX8vNrpi8oWgC79-0=L+xrDbS85Q@mail.gmail.com>
Message-ID: <4E8EB464.4030403@rabbitmq.com>

Steve,

On 05/10/11 15:16, Steve Rehrauer wrote:
> Hmm.  While I do see a publisher confirmation from the broker, I don't
> actually see the message in the queues.  (When I say "event" below, I
> really mean "message", sorry.)  Any idea what I should suspect that I
> could be doing wrong on the producer side?

To debug this, perhaps leave out the consumers to start with, and use 
rabbitmqctl or rabbitmq-management to verify that messages make it into 
the queues the way you expect.

Matthias.

From ekirpichov at gmail.com  Fri Oct  7 09:41:09 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Fri, 7 Oct 2011 12:41:09 +0400
Subject: [rabbitmq-discuss] Rabbitmq Crash and number of consumers
In-Reply-To: <5F389C517756284F80239F55BCA5DDDD05C0EF@G9W0721.americas.hpqcorp.net>
References: <5F389C517756284F80239F55BCA5DDDD05C0EF@G9W0721.americas.hpqcorp.net>
Message-ID: <CANVKUrVTXMfMmH-GJKaddQ2J-b0Kwqgh0=8O-QgDKnruX4sB7A@mail.gmail.com>

Hi Andrea,

I had exactly the same problem once. Search the mailing list.
I believe it has since been fixed in later versions of RabbitMQ.

On Fri, Oct 7, 2011 at 12:08 PM, Rosa, Andrea <andrea.rosa at hp.com> wrote:
> Hi all,
>
>
>
> We are using Rabbitmq 2.5 version and yesterday we found (a number of time)
> in the log file this entry:
>
> =INFO REPORT==== 6-Oct-2011::14:58:13 ===
> ????alarm_handler: {set,{file_descriptor_limit,[]}}
>
> Finally it hit an error:
>
> =ERROR REPORT==== 6-Oct-2011::14:58:13 ===
> ** Generic server msg_store_persistent terminating
> ** Last message in was {'$gen_cast',
> ???????????????????????????{client_dying,
> ???????????????????????????????<<199,5,182,196,129,67,147,182,61,201,143,0,
> ?????????????????????????????????51,197,190,234>>}}
> ** When Server state == {msstate,
> ????????????????????????????"/var/lib/rabbitmq/mnesia/nodename/msg_store_persistent",
> ????????????????????????????rabbit_msg_store_ets_index,
> ????????????????????????????{state,520256,
> ????????????????????????????????"/var/lib/rabbitmq/mnesia/nodename/msg_store_persistent"},
> ????????????????????????????22,#Ref<0.0.0.1817>,
> ????????????????????????????{dict,0,16,16,8,80,48,
> ????????????????????????????????{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
> ?????????????????????????????????[]},
> ????????????????????????????????{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
> ??????????????????????????????????[],[]}}},
> ????????????????????????????[],undefined,589,5530342,[],<0.296.0>,524353,
> ????????????????????????????516159,528450,
> ????????????????????????????{set,19,16,16,8,80,48,
> ????????????????????????????????{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
> ????????????????????????....
> ** Reason for termination ==
> ** {{badmatch,false},
> ????[{rabbit_msg_store_ets_index,insert,2},
> ?????{rabbit_msg_store,write_message,3},
> ?????{rabbit_msg_store,handle_cast,2},
> ?????{gen_server2,handle_msg,2},
> ?????{proc_lib,wake_up,3}]}
>
> =INFO REPORT==== 6-Oct-2011::14:58:14 ===
> stopped TCP Listener on [::]:5672
>
>
>
> Right after this, rabbitmq closed the listener socket and did not recover.
> The service kept running without accepting any connections, to fix the
> problem we needed to restart the service.
>
> What can be happened?
>
>
>
> I have got another question: when I run the rabbitmqctl list_queues
> consumers the number of the consumers how is it calculate?
>
> There is a ?live? calculation or the information are stored somewhere and
> refreshed after ?n? seconds?
>
> I?ve got a queue with a single consumer and sometimes (I don?t know why!)
> the consumer disappears, to detect that there is a script running which uses
> rabbitmqctl list_queues command but It can detect this situation with a
> delay of about 10-15 minutes even if the script ?runs every minute.
>
>
>
> Best Regards
>
> --
>
> Andrea Rosa
>
>
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/

From ekirpichov at gmail.com  Fri Oct  7 09:41:38 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Fri, 7 Oct 2011 12:41:38 +0400
Subject: [rabbitmq-discuss] Rabbitmq Crash and number of consumers
In-Reply-To: <CANVKUrVTXMfMmH-GJKaddQ2J-b0Kwqgh0=8O-QgDKnruX4sB7A@mail.gmail.com>
References: <5F389C517756284F80239F55BCA5DDDD05C0EF@G9W0721.americas.hpqcorp.net>
	<CANVKUrVTXMfMmH-GJKaddQ2J-b0Kwqgh0=8O-QgDKnruX4sB7A@mail.gmail.com>
Message-ID: <CANVKUrUQht4Du3MQ9uCTNvatttp-qQw59qboajAkAMnkvXmSPg@mail.gmail.com>

You can search for ets_index insert, I believe.

On Fri, Oct 7, 2011 at 12:41 PM, Eugene Kirpichov <ekirpichov at gmail.com> wrote:
> Hi Andrea,
>
> I had exactly the same problem once. Search the mailing list.
> I believe it has since been fixed in later versions of RabbitMQ.
>
> On Fri, Oct 7, 2011 at 12:08 PM, Rosa, Andrea <andrea.rosa at hp.com> wrote:
>> Hi all,
>>
>>
>>
>> We are using Rabbitmq 2.5 version and yesterday we found (a number of time)
>> in the log file this entry:
>>
>> =INFO REPORT==== 6-Oct-2011::14:58:13 ===
>> ????alarm_handler: {set,{file_descriptor_limit,[]}}
>>
>> Finally it hit an error:
>>
>> =ERROR REPORT==== 6-Oct-2011::14:58:13 ===
>> ** Generic server msg_store_persistent terminating
>> ** Last message in was {'$gen_cast',
>> ???????????????????????????{client_dying,
>> ???????????????????????????????<<199,5,182,196,129,67,147,182,61,201,143,0,
>> ?????????????????????????????????51,197,190,234>>}}
>> ** When Server state == {msstate,
>> ????????????????????????????"/var/lib/rabbitmq/mnesia/nodename/msg_store_persistent",
>> ????????????????????????????rabbit_msg_store_ets_index,
>> ????????????????????????????{state,520256,
>> ????????????????????????????????"/var/lib/rabbitmq/mnesia/nodename/msg_store_persistent"},
>> ????????????????????????????22,#Ref<0.0.0.1817>,
>> ????????????????????????????{dict,0,16,16,8,80,48,
>> ????????????????????????????????{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>> ?????????????????????????????????[]},
>> ????????????????????????????????{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>> ??????????????????????????????????[],[]}}},
>> ????????????????????????????[],undefined,589,5530342,[],<0.296.0>,524353,
>> ????????????????????????????516159,528450,
>> ????????????????????????????{set,19,16,16,8,80,48,
>> ????????????????????????????????{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>> ????????????????????????....
>> ** Reason for termination ==
>> ** {{badmatch,false},
>> ????[{rabbit_msg_store_ets_index,insert,2},
>> ?????{rabbit_msg_store,write_message,3},
>> ?????{rabbit_msg_store,handle_cast,2},
>> ?????{gen_server2,handle_msg,2},
>> ?????{proc_lib,wake_up,3}]}
>>
>> =INFO REPORT==== 6-Oct-2011::14:58:14 ===
>> stopped TCP Listener on [::]:5672
>>
>>
>>
>> Right after this, rabbitmq closed the listener socket and did not recover.
>> The service kept running without accepting any connections, to fix the
>> problem we needed to restart the service.
>>
>> What can be happened?
>>
>>
>>
>> I have got another question: when I run the rabbitmqctl list_queues
>> consumers the number of the consumers how is it calculate?
>>
>> There is a ?live? calculation or the information are stored somewhere and
>> refreshed after ?n? seconds?
>>
>> I?ve got a queue with a single consumer and sometimes (I don?t know why!)
>> the consumer disappears, to detect that there is a script running which uses
>> rabbitmqctl list_queues command but It can detect this situation with a
>> delay of about 10-15 minutes even if the script ?runs every minute.
>>
>>
>>
>> Best Regards
>>
>> --
>>
>> Andrea Rosa
>>
>>
>>
>>
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
>
>
> --
> Eugene Kirpichov
> Principal Engineer, Mirantis Inc. http://www.mirantis.com/
> Editor, http://fprog.ru/
>



-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/

From matthias at rabbitmq.com  Fri Oct  7 09:47:46 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 07 Oct 2011 09:47:46 +0100
Subject: [rabbitmq-discuss] Rabbitmq Crash and number of consumers
In-Reply-To: <CANVKUrUQht4Du3MQ9uCTNvatttp-qQw59qboajAkAMnkvXmSPg@mail.gmail.com>
References: <5F389C517756284F80239F55BCA5DDDD05C0EF@G9W0721.americas.hpqcorp.net>	<CANVKUrVTXMfMmH-GJKaddQ2J-b0Kwqgh0=8O-QgDKnruX4sB7A@mail.gmail.com>
	<CANVKUrUQht4Du3MQ9uCTNvatttp-qQw59qboajAkAMnkvXmSPg@mail.gmail.com>
Message-ID: <4E8EBCB2.3060501@rabbitmq.com>

On 07/10/11 09:41, Eugene Kirpichov wrote:
> You can search for ets_index insert, I believe.

Indeed.

http://old.nabble.com/RabbitMQ-crashed-in-ets%3Ainsert_new---looks-like-a-genuine-bug...-td32246609.html#a32247878

Fixed in 2.6.x


Matthias.

From pshomov at gmail.com  Fri Oct  7 09:48:08 2011
From: pshomov at gmail.com (Petar Shomov)
Date: Fri, 7 Oct 2011 01:48:08 -0700 (PDT)
Subject: [rabbitmq-discuss] upgrading message consumers
Message-ID: <11683688.39.1317977288046.JavaMail.geo-discussion-forums@vbac9>

Hi guys,

I have a message that takes relatively long to process. I have a few 
instances of this message consumer running and processing messages. Next I 
have a new version of the consumer that I would like to deploy. I would like 
to upgrade the consumers (one by one or all at the same time, not a big 
difference to me) without crashing whatever they might be doing at the 
moment. Are there any best practices around this process?

I was thinking about writing a file in a well known location which each 
consumers will check for after they are done processing a message and before 
they accept the next one. Something along those lines.

Any ideas are welcome!

Regards,

Petar
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111007/fff53bad/attachment.htm>

From matthias at rabbitmq.com  Fri Oct  7 09:53:25 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 07 Oct 2011 09:53:25 +0100
Subject: [rabbitmq-discuss] upgrading message consumers
In-Reply-To: <11683688.39.1317977288046.JavaMail.geo-discussion-forums@vbac9>
References: <11683688.39.1317977288046.JavaMail.geo-discussion-forums@vbac9>
Message-ID: <4E8EBE05.1060704@rabbitmq.com>

Petar,

On 07/10/11 09:48, Petar Shomov wrote:
> I have a message that takes relatively long to process. I have a few
> instances of this message consumer running and processing messages. Next
> I have a new version of the consumer that I would like to deploy. I
> would like to upgrade the consumers (one by one or all at the same time,
> not a big difference to me) without crashing whatever they might be
> doing at the moment. Are there any best practices around this process?
>
> I was thinking about writing a file in a well known location which each
> consumers will check for after they are done processing a message and
> before they accept the next one. Something along those lines.
>
> Any ideas are welcome!

Use rabbit! ...to broadcast a message to the consumers telling them to 
stop/upgrade.

Matthias.

From pshomov at gmail.com  Fri Oct  7 10:03:08 2011
From: pshomov at gmail.com (Petar Shomov)
Date: Fri, 7 Oct 2011 02:03:08 -0700 (PDT)
Subject: [rabbitmq-discuss] upgrading message consumers
In-Reply-To: <4E8EBE05.1060704@rabbitmq.com>
References: <11683688.39.1317977288046.JavaMail.geo-discussion-forums@vbac9>
	<4E8EBE05.1060704@rabbitmq.com>
Message-ID: <72230.187.1317978188088.JavaMail.geo-discussion-forums@yqmn40>

Hi Matthias,

Thank you for your suggestion!
So this means the upgrade functionality has to be in the message consumer 
program. This also means the consumer program has to know where to find its 
upgrade. I can see this work although I would prefer if I keep most of the 
upgrade functionality in my central upgrade/management tool/script.

Best regards,

Petar
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111007/6e1279ec/attachment.htm>

From matthias at rabbitmq.com  Fri Oct  7 10:30:46 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 07 Oct 2011 10:30:46 +0100
Subject: [rabbitmq-discuss] upgrading message consumers
In-Reply-To: <72230.187.1317978188088.JavaMail.geo-discussion-forums@yqmn40>
References: <11683688.39.1317977288046.JavaMail.geo-discussion-forums@vbac9>	<4E8EBE05.1060704@rabbitmq.com>
	<72230.187.1317978188088.JavaMail.geo-discussion-forums@yqmn40>
Message-ID: <4E8EC6C6.6020003@rabbitmq.com>

Petar,

On 07/10/11 10:03, Petar Shomov wrote:
> So this means the upgrade functionality has to be in the message
> consumer program. This also means the consumer program has to know where
> to find its upgrade.

The upgrade message could tell the consumer where to find the upgrade.

Matthias.

From alfonso.pantoja at gmail.com  Fri Oct  7 10:36:46 2011
From: alfonso.pantoja at gmail.com (Alfonso Pantoja)
Date: Fri, 7 Oct 2011 02:36:46 -0700 (PDT)
Subject: [rabbitmq-discuss] Using .NET API 2.4.0 with RabbitMQ 2.6.1. No
	problems?
Message-ID: <ee357892-b726-4bf9-b734-cf2caaf89938@d28g2000vby.googlegroups.com>

Hi,
We are running RabbitMQ 2.2.0 and our publishers/consumers are
using .NET API 2.4.0.
Because we are planning to upgrade to RabbitMQ 2.6.1 I'm wondering if
we could use API 2.6.1 with RabbitMQ 2.2.0 during the migration phases
(update all consumers/services with 2.6.1 and after the broker will be
upgraded)

I'm testing the 2.6.1 API against RabbitMQ 2.2.0 and it seems
everything is ok, however I don't know if I'm missing something
important that could lead to a malfunction or to unexpected client
behaviors.
(for example, we are publishing this way txSelect; BasicPublish;
txCommit -which still works-)

Thank you in advance.


Regards,

Alfonso

From simon at rabbitmq.com  Fri Oct  7 10:43:10 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 07 Oct 2011 10:43:10 +0100
Subject: [rabbitmq-discuss] Using .NET API 2.4.0 with RabbitMQ 2.6.1.
 No	problems?
In-Reply-To: <ee357892-b726-4bf9-b734-cf2caaf89938@d28g2000vby.googlegroups.com>
References: <ee357892-b726-4bf9-b734-cf2caaf89938@d28g2000vby.googlegroups.com>
Message-ID: <4E8EC9AE.4080607@rabbitmq.com>

On 07/10/11 10:36, Alfonso Pantoja wrote:
> I'm wondering if
> we could use API 2.6.1 with RabbitMQ 2.2.0 during the migration phases
> (update all consumers/services with 2.6.1 and after the broker will be
> upgraded)

Yes, that should be fine; in general everything 2.x should be mix-and-match.

There is a bug with older (2.3.1 and lower) versions of the management 
plugin that causes connection listing to fail when used with newer 
clients, but that's hopefully pretty minor.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From pshomov at gmail.com  Fri Oct  7 10:53:45 2011
From: pshomov at gmail.com (Petar Shomov)
Date: Fri, 7 Oct 2011 02:53:45 -0700 (PDT)
Subject: [rabbitmq-discuss] upgrading message consumers
In-Reply-To: <4E8EC6C6.6020003@rabbitmq.com>
References: <11683688.39.1317977288046.JavaMail.geo-discussion-forums@vbac9>	<4E8EBE05.1060704@rabbitmq.com>
	<72230.187.1317978188088.JavaMail.geo-discussion-forums@yqmn40>
	<4E8EC6C6.6020003@rabbitmq.com>
Message-ID: <27314999.1034.1317981225819.JavaMail.geo-discussion-forums@yqnv12>

Hi Matthias,

Good point.

Best regards,

Petar
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111007/c58cc42a/attachment.htm>

From andrea.rosa at hp.com  Fri Oct  7 11:00:48 2011
From: andrea.rosa at hp.com (Rosa, Andrea)
Date: Fri, 7 Oct 2011 10:00:48 +0000
Subject: [rabbitmq-discuss] Rabbitmq Crash and number of consumers
In-Reply-To: <4E8EBCB2.3060501@rabbitmq.com>
References: <5F389C517756284F80239F55BCA5DDDD05C0EF@G9W0721.americas.hpqcorp.net>
	<CANVKUrVTXMfMmH-GJKaddQ2J-b0Kwqgh0=8O-QgDKnruX4sB7A@mail.gmail.com>
	<CANVKUrUQht4Du3MQ9uCTNvatttp-qQw59qboajAkAMnkvXmSPg@mail.gmail.com>
	<4E8EBCB2.3060501@rabbitmq.com>
Message-ID: <5F389C517756284F80239F55BCA5DDDD05C515@G9W0721.americas.hpqcorp.net>

Thank you for your kind reply!
Someone can give me more information about consumers issue:
I have got another question: when I run the rabbitmqctl list_queues consumers the number of the consumers how is it calculate?
There is a "live" calculation or the information are stored somewhere and refreshed after "n" seconds?
I've got a queue with a single consumer and sometimes (I don't know why!) the consumer disappears, to detect that there is a script running which uses rabbitmqctl list_queues command but It can detect this situation with a delay of about 10-15 minutes even if the script  runs every minute.

Cheers
--
Andrea 

> -----Original Message-----
> From: Matthias Radestock [mailto:matthias at rabbitmq.com]
> Sent: 07 October 2011 09:48
> To: Eugene Kirpichov
> Cc: Rosa, Andrea; rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] Rabbitmq Crash and number of consumers
> 
> On 07/10/11 09:41, Eugene Kirpichov wrote:
> > You can search for ets_index insert, I believe.
> 
> Indeed.
> 
> http://old.nabble.com/RabbitMQ-crashed-in-ets%3Ainsert_new---looks-
> like-a-genuine-bug...-td32246609.html#a32247878
> 
> Fixed in 2.6.x
> 
> 
> Matthias.

From matthias at rabbitmq.com  Fri Oct  7 11:05:11 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 07 Oct 2011 11:05:11 +0100
Subject: [rabbitmq-discuss] Rabbitmq Crash and number of consumers
In-Reply-To: <5F389C517756284F80239F55BCA5DDDD05C515@G9W0721.americas.hpqcorp.net>
References: <5F389C517756284F80239F55BCA5DDDD05C0EF@G9W0721.americas.hpqcorp.net>	<CANVKUrVTXMfMmH-GJKaddQ2J-b0Kwqgh0=8O-QgDKnruX4sB7A@mail.gmail.com>
	<CANVKUrUQht4Du3MQ9uCTNvatttp-qQw59qboajAkAMnkvXmSPg@mail.gmail.com>
	<4E8EBCB2.3060501@rabbitmq.com>
	<5F389C517756284F80239F55BCA5DDDD05C515@G9W0721.americas.hpqcorp.net>
Message-ID: <4E8ECED7.8010709@rabbitmq.com>

On 07/10/11 11:00, Rosa, Andrea wrote:
> when I run the rabbitmqctl list_queues consumers the number of the
> consumers how is it calculate? There is a "live" calculation or the
> information are stored somewhere and refreshed after "n" seconds?

It's "live".

Matthias.

From alfonso.pantoja at gmail.com  Fri Oct  7 11:05:14 2011
From: alfonso.pantoja at gmail.com (Alfonso Pantoja)
Date: Fri, 7 Oct 2011 03:05:14 -0700 (PDT)
Subject: [rabbitmq-discuss] Using .NET API 2.4.0 with RabbitMQ 2.6.1. No
	problems?
In-Reply-To: <4E8EC9AE.4080607@rabbitmq.com>
References: <ee357892-b726-4bf9-b734-cf2caaf89938@d28g2000vby.googlegroups.com>
	<4E8EC9AE.4080607@rabbitmq.com>
Message-ID: <4f4abd2a-3921-4cf9-aba2-905ae3624d9d@dk6g2000vbb.googlegroups.com>

On 7 oct, 11:43, Simon MacMullen <si... at rabbitmq.com> wrote:

> Yes, that should be fine; in general everything 2.x should be mix-and-match.

Perfect :)

>
> There is a bug with older (2.3.1 and lower) versions of the management
> plugin that causes connection listing to fail when used with newer
> clients, but that's hopefully pretty minor.
>

I agree, we are having currently that issue but currently is a minor
one.
We are willing to use the new broker on product as soon as possible :)

Regards,


Alfonso

From alfonso.pantoja at gmail.com  Fri Oct  7 11:27:10 2011
From: alfonso.pantoja at gmail.com (Alfonso Pantoja)
Date: Fri, 7 Oct 2011 03:27:10 -0700 (PDT)
Subject: [rabbitmq-discuss] Migration from 2.2.0 to 2.6.1 and cluster
Message-ID: <f1d4477d-8641-416a-a7df-a47c098882ec@q17g2000yqn.googlegroups.com>

Hi,

On our RabbitMQ server we have created hundreds of durable queues.
We are planning to migrate the broker to the lastest version 2.6.1 and
after the migration process we want to use the new clustering
features.
I've been told that a queue reclaration must be done in order to have
high available queues. Is that correct?
(is it  related to x-ha-policy parameter?)


Thank you in advance.


Alfonso

From matthew at rabbitmq.com  Fri Oct  7 11:29:57 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 7 Oct 2011 11:29:57 +0100
Subject: [rabbitmq-discuss] Migration from 2.2.0 to 2.6.1 and cluster
In-Reply-To: <f1d4477d-8641-416a-a7df-a47c098882ec@q17g2000yqn.googlegroups.com>
References: <f1d4477d-8641-416a-a7df-a47c098882ec@q17g2000yqn.googlegroups.com>
Message-ID: <20111007102957.GA9090@rabbitmq.com>

On Fri, Oct 07, 2011 at 03:27:10AM -0700, Alfonso Pantoja wrote:
> On our RabbitMQ server we have created hundreds of durable queues.
> We are planning to migrate the broker to the lastest version 2.6.1 and
> after the migration process we want to use the new clustering
> features.
> I've been told that a queue reclaration must be done in order to have
> high available queues. Is that correct?
> (is it  related to x-ha-policy parameter?)

Yes, that is correct. Sadly, and this is probably a wart of AMQP, there
is no consideration of mutable queue probperties.

Matthew

> 
> 
> Thank you in advance.
> 
> 
> Alfonso
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From alfonso.pantoja at gmail.com  Fri Oct  7 13:33:45 2011
From: alfonso.pantoja at gmail.com (Alfonso Pantoja)
Date: Fri, 7 Oct 2011 05:33:45 -0700 (PDT)
Subject: [rabbitmq-discuss] Migration from 2.2.0 to 2.6.1 and cluster
In-Reply-To: <20111007102957.GA9090@rabbitmq.com>
References: <f1d4477d-8641-416a-a7df-a47c098882ec@q17g2000yqn.googlegroups.com>
	<20111007102957.GA9090@rabbitmq.com>
Message-ID: <17d64dda-8c4d-4464-a90c-0c140aa8f7b3@j19g2000vbn.googlegroups.com>



On 7 oct, 12:29, Matthew Sackman <matt... at rabbitmq.com> wrote:

>
> Yes, that is correct. Sadly, and this is probably a wart of AMQP, there
> is no consideration of mutable queue probperties.
>

True, mutable properties will be very useful when durable queues are
used.
Thank you for the info


Cheers,

Alfonso

From john at ibiblio.org  Fri Oct  7 13:49:51 2011
From: john at ibiblio.org (John Reuning)
Date: Fri, 7 Oct 2011 08:49:51 -0400
Subject: [rabbitmq-discuss] Pika disconnects
Message-ID: <CACDr4icoabgjk_Pf1EvpBU-ERyr5WiaS73jSCV_pJvJNBEbcVQ@mail.gmail.com>

I have a multi-threaded python application using pika to publish
messages to rabbitmq (all centos 6).  It works most of the time,
except for intermittent disconnects and bad file descriptor socket
errors.  The disconnects manifest as the ioloop exiting.  I registered
a custom on_connection_close callback function, as well as a custom
reconnection strategy object.  Neither is triggered when a disconnect
occurs and the ioloop exists.  The socket EBADF exceptions come from
calling basic_publish on a channel object after the rabbitmq
connection has terminated.

I read that pika isn't thread safe, so I've tried adding a
threading.RLock around the basic_publish call.  This reduces the
frequency of the disconnects but doesn't eliminate them.  I could wrap
the pika functionality in another layer, check for a disconnect, and
recycle everything.  However, it would be nice to know why this
happens.  Anyone have suggestions?

Thanks,

-John

From ekirpichov at gmail.com  Fri Oct  7 16:30:42 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Fri, 7 Oct 2011 19:30:42 +0400
Subject: [rabbitmq-discuss] Fairness wrt queues under heavy load
Message-ID: <CANVKUrWC=q6GipDRtWEiUOpL0yo_yjxVBzTOPU_C2kWkADfYUA@mail.gmail.com>

Hello,

I've got a large cluster with many consumers, and several producers
who publish a very intense steady stream of messages in
publish/confirm mode.

Some components occasionally submit a single but very important and
urgent message in transactional mode, which takes up to 5-10 minutes
to be delivered.

Is this expected behavior?

How can I avoid these obscenely large delays?

-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/

From majek04 at gmail.com  Sat Oct  8 11:03:28 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Sat, 8 Oct 2011 11:03:28 +0100
Subject: [rabbitmq-discuss] Pika disconnects
In-Reply-To: <CACDr4icoabgjk_Pf1EvpBU-ERyr5WiaS73jSCV_pJvJNBEbcVQ@mail.gmail.com>
References: <CACDr4icoabgjk_Pf1EvpBU-ERyr5WiaS73jSCV_pJvJNBEbcVQ@mail.gmail.com>
Message-ID: <CABzX+qyRzu4EccWo3_imN7uxGP6Q3oqcDX65F8RHrFV8JLCvrw@mail.gmail.com>

On Fri, Oct 7, 2011 at 13:49, John Reuning <john at ibiblio.org> wrote:
> I read that pika isn't thread safe, so I've tried adding a
> threading.RLock around the basic_publish call. ?This reduces the
> frequency of the disconnects but doesn't eliminate them. ?I could wrap
> the pika functionality in another layer, check for a disconnect, and
> recycle everything. ?However, it would be nice to know why this
> happens. ?Anyone have suggestions?

John,

Pika doesn't support multi threading. Wrapping single basic_publish
isn't good enough - the side effect of this command (network buffer)
is going to affect different thread (the thread with event loop).

I'm afraid there isn't a simple workaround. You can try to wrap
everything (including event loop) in a lock - and thus allow only
one thread at a time to use connection/network socket/buffers.
But doing that will be rather hard (how to stop event loop
if other thread wants to publish?)

Or, maybe a better solution would be to use multiple connections,
one connection per thread.

Does it sound reasonable?


Cheers,
   Marek

From majek04 at gmail.com  Sat Oct  8 13:50:45 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Sat, 8 Oct 2011 13:50:45 +0100
Subject: [rabbitmq-discuss] Pika disconnects
In-Reply-To: <CACDr4icaKePRhHm1+MgzBgUfuisT0wNCHHt-2XrKjHJUsyuE9Q@mail.gmail.com>
References: <CACDr4icoabgjk_Pf1EvpBU-ERyr5WiaS73jSCV_pJvJNBEbcVQ@mail.gmail.com>
	<CABzX+qyRzu4EccWo3_imN7uxGP6Q3oqcDX65F8RHrFV8JLCvrw@mail.gmail.com>
	<CACDr4icaKePRhHm1+MgzBgUfuisT0wNCHHt-2XrKjHJUsyuE9Q@mail.gmail.com>
Message-ID: <CABzX+qybvkw8nobazKaXj4U82=VGD-jhxspG71-Oc0eP1Chgbg@mail.gmail.com>

On Sat, Oct 8, 2011 at 13:06, John Reuning <john at ibiblio.org> wrote:
> Marek,
>
> Your note about the event loop and socket buffers makes sense. ?The
> application in question is multi threaded, but only one thread
> accesses the pika objects. ?Code in the main thread creates several
> objects in separate threads. ?One of these second-layer threads
> watches for events in the application and publishes messages to
> rabbitmq.

Assuming that the same thread does:
 * event loop
 * consuming
 * publishing

It should be fine :)

> The current implementation has another threaded object spawned by the
> event watcher, which contains the pika event loop and connection to
> rabbitmq. The event watcher is the only object/thread that calls
> basic_publish on the pika channel object. Do problems occur when
> merely crossing a thread boundary using pika?

It doesn't matter which thread handles pika connection.
But it matters a lot that when you're doing anything
related to amqp connection, no other thread should
be doing anything on that connection.
(including waiting in event loop).

In other words:
 - you can't have blocking event loop in one thread
 - and publish from other thread.

If you want to publish, you need to stop event loop,
publish, and restart event loop. It doesn't matter
which thread does what, but it matters that only
one thread accesses pika stuff at a time.

(I hope that Gavin, pika maintainer, will fix me if I'm wrong)

Cheers,
    Marek


>?Or should this approach
> work as long as the pika objects are only ever used by one thread?
>
> Thanks,
>
> -John
>
> On Sat, Oct 8, 2011 at 6:03 AM, Marek Majkowski <majek04 at gmail.com> wrote:
>> John,
>>
>> Pika doesn't support multi threading. Wrapping single basic_publish
>> isn't good enough - the side effect of this command (network buffer)
>> is going to affect different thread (the thread with event loop).
>>
>> I'm afraid there isn't a simple workaround. You can try to wrap
>> everything (including event loop) in a lock - and thus allow only
>> one thread at a time to use connection/network socket/buffers.
>> But doing that will be rather hard (how to stop event loop
>> if other thread wants to publish?)
>>
>> Or, maybe a better solution would be to use multiple connections,
>> one connection per thread.
>>
>> Does it sound reasonable?
>>
>>
>> Cheers,
>> ? Marek
>>
>

From hedelson at vmware.com  Sat Oct  8 16:55:24 2011
From: hedelson at vmware.com (Helena Edelson)
Date: Sat, 8 Oct 2011 08:55:24 -0700
Subject: [rabbitmq-discuss] Query for Binding with similar topic routing
 keys returns all similar vs the one matching
Message-ID: <BDE140BF4C952041931EF8CAAC83341D026B6B8E83@exch-mbx-111.vmware.com>

Hi,

Given
/api/bindings/vhost/e/exchange/q/queue/props  	An individual binding between an exchange and a queue. 

I find that if I create multiple bindings of different but similar patterns between Q1 and E1, say foo.bar.* and #.bar.*, that when querying the broker via http mgmt api to GET one binding between Q1 and E1 where the pattern I pass in is foo.bar.*, that I get 2 bindings back vs one, foo.bar.* and #.bar.*, which makes sense but it would be nice if the mgmt api returned only the one I requested, i.e. the binding foo.bar.* 

Bug? or am I misinterpreting?

Thanks,
Helena  

From hedelson at vmware.com  Sat Oct  8 17:10:46 2011
From: hedelson at vmware.com (Helena Edelson)
Date: Sat, 8 Oct 2011 09:10:46 -0700
Subject: [rabbitmq-discuss] Query for Binding with similar topic routing
 keys returns all similar vs the one matching
In-Reply-To: <BDE140BF4C952041931EF8CAAC83341D026B6B8E83@exch-mbx-111.vmware.com>
References: <BDE140BF4C952041931EF8CAAC83341D026B6B8E83@exch-mbx-111.vmware.com>
Message-ID: <BDE140BF4C952041931EF8CAAC83341D026B6B8E84@exch-mbx-111.vmware.com>

Updating my earlier message -  I see in the returned properties_key a difference one can leverage.

My sample patterns - foo.bar.* and #.bar.*

The 2 bindings returned from querying for one binging included:
"properties_key":"%23.bar.%2A" => #.bar.*
"properties_key":"foo.bar.%2A"   => foo.bar.*

I have something to parse for if multiple bindings are returned.
-H

Hi,

Given
/api/bindings/vhost/e/exchange/q/queue/props    An individual binding between an exchange and a queue.

I find that if I create multiple bindings of different but similar patterns between Q1 and E1, say foo.bar.* and #.bar.*, that when querying the broker via http mgmt api to GET one binding between Q1 and E1 where the pattern I pass in is foo.bar.*, that I get 2 bindings back vs one, foo.bar.* and #.bar.*, which makes sense but it would be nice if the mgmt api returned only the one I requested, i.e. the binding foo.bar.*

Bug? or am I misinterpreting?

Thanks,
Helena

From hedelson at vmware.com  Sat Oct  8 17:20:57 2011
From: hedelson at vmware.com (Helena Edelson)
Date: Sat, 8 Oct 2011 09:20:57 -0700
Subject: [rabbitmq-discuss] Query for Binding with similar topic routing
 keys returns all similar vs the one matching
In-Reply-To: <BDE140BF4C952041931EF8CAAC83341D026B6B8E83@exch-mbx-111.vmware.com>
References: <BDE140BF4C952041931EF8CAAC83341D026B6B8E83@exch-mbx-111.vmware.com>
Message-ID: <BDE140BF4C952041931EF8CAAC83341D026B6B8E85@exch-mbx-111.vmware.com>

Perhaps my query is wrong but the docs are not specific in how to format the pattern for props: /api/bindings/vhost/e/exchange/q/queue/props

I tried a few such as:
/api/bindings/vhost/e/exchange/q/queue/{"routing_key":"my_routing_key","arguments":[]}
/api/bindings/vhost/e/some_exchange/q/some_queue/some_pattern

Can you offer a sample perhaps to explicitly pass this where props go?

Thanks,
Helena
________________________________________
From: Helena Edelson
Sent: Saturday, October 08, 2011 11:55 AM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Query for Binding with similar topic routing keys returns all similar vs the one matching

Hi,

Given
/api/bindings/vhost/e/exchange/q/queue/props    An individual binding between an exchange and a queue.

I find that if I create multiple bindings of different but similar patterns between Q1 and E1, say foo.bar.* and #.bar.*, that when querying the broker via http mgmt api to GET one binding between Q1 and E1 where the pattern I pass in is foo.bar.*, that I get 2 bindings back vs one, foo.bar.* and #.bar.*, which makes sense but it would be nice if the mgmt api returned only the one I requested, i.e. the binding foo.bar.*

Bug? or am I misinterpreting?

Thanks,
Helena

From hedelson at vmware.com  Sat Oct  8 17:34:54 2011
From: hedelson at vmware.com (Helena Edelson)
Date: Sat, 8 Oct 2011 09:34:54 -0700
Subject: [rabbitmq-discuss] Query for Binding with similar topic routing
 keys returns all similar vs the one matching
In-Reply-To: <BDE140BF4C952041931EF8CAAC83341D026B6B8E85@exch-mbx-111.vmware.com>
References: <BDE140BF4C952041931EF8CAAC83341D026B6B8E83@exch-mbx-111.vmware.com>,
	<BDE140BF4C952041931EF8CAAC83341D026B6B8E85@exch-mbx-111.vmware.com>
Message-ID: <BDE140BF4C952041931EF8CAAC83341D026B6B8E86@exch-mbx-111.vmware.com>

This works (below). My confusion was over the relationship between 'name' and 'props' in the sample

/api/bindings/some_vhost/e/some_exchange/q/some_queue/name/some_pattern 

Thanks,
Helena
________________________________________
From: Helena Edelson
Sent: Saturday, October 08, 2011 12:20 PM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: RE: Query for Binding with similar topic routing keys returns all similar vs the one matching

Perhaps my query is wrong but the docs are not specific in how to format the pattern for props: /api/bindings/vhost/e/exchange/q/queue/props

I tried a few such as:
/api/bindings/vhost/e/exchange/q/queue/{"routing_key":"my_routing_key","arguments":[]}
/api/bindings/vhost/e/some_exchange/q/some_queue/some_pattern

Can you offer a sample perhaps to explicitly pass this where props go?

Thanks,
Helena
________________________________________
From: Helena Edelson
Sent: Saturday, October 08, 2011 11:55 AM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Query for Binding with similar topic routing keys returns all similar vs the one matching

Hi,

Given
/api/bindings/vhost/e/exchange/q/queue/props    An individual binding between an exchange and a queue.

I find that if I create multiple bindings of different but similar patterns between Q1 and E1, say foo.bar.* and #.bar.*, that when querying the broker via http mgmt api to GET one binding between Q1 and E1 where the pattern I pass in is foo.bar.*, that I get 2 bindings back vs one, foo.bar.* and #.bar.*, which makes sense but it would be nice if the mgmt api returned only the one I requested, i.e. the binding foo.bar.*

Bug? or am I misinterpreting?

Thanks,
Helena

From svet_my at yahoo.com  Sun Oct  9 10:56:17 2011
From: svet_my at yahoo.com (Slava Miropolsky)
Date: Sun, 9 Oct 2011 02:56:17 -0700 (PDT)
Subject: [rabbitmq-discuss] windows AppFabric, Workflow service and RabbitMQ
Message-ID: <1318154177.51076.YahooMailClassic@web112605.mail.gq1.yahoo.com>

Hi,
I'm trying to configure WCF rabbitMQBinding for AppFabric (IIS) hosted Workflow WCF service, configured to Auto-Start.
does anyone have positive experience configuring rabbitmq in his hosted wcf service?
Thanks in advance,Slava
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111009/a61335c6/attachment.htm>

From atisback at yahoo.com  Sun Oct  9 08:28:22 2011
From: atisback at yahoo.com (Nadavgg)
Date: Sun, 9 Oct 2011 00:28:22 -0700 (PDT)
Subject: [rabbitmq-discuss]  erl.exe crashing occasionally
Message-ID: <32618230.post@talk.nabble.com>


Hi,
I am running RabbitMQ on a single server and here is an error I get

Faulting application erl.exe, version 0.0.0.0, time stamp 0x491190a3,
faulting module beam.smp.dll, version 0.0.0.0, time stamp 0x49118fbd,
exception code 0x40000015, fault offset 0x00010831, process id 0x6e0,
application start time 0x01ca5ce1246bff61.

Here is some line (I suspect it might help from the the erl dump log

=erl_crash_dump:0.1
Sat Oct 08 13:48:58 2011
Slogan: eheap_alloc: Cannot allocate 10517700 bytes of memory (of type
"heap").
System version: Erlang R14B04 (erts-5.8.5) [smp:2:2] [rq:2]
[async-threads:30]
Compiled: Mon Oct  3 19:19:39 2011
Taints: 
Atoms: 16203
=memory
total: 136084752
processes: 77161004
processes_used: 77082972
system: 58923748
atom: 742229
atom_used: 735322
binary: 45475272
code: 5943058
ets: 5498580
=hash_table:atom_tab
size: 12853
used: 9216
objs: 16203
depth: 8
=index_table:atom_tab
size: 16384
limit: 1048576
entries: 16203

Does it mean I lack the memory to allocate more mem-space to the rabbit?

Thanks
-- 
View this message in context: http://old.nabble.com/erl.exe-crashing-occasionally-tp32618230p32618230.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From paulcarlisle at comcast.net  Sun Oct  9 19:28:15 2011
From: paulcarlisle at comcast.net (SixDegrees)
Date: Sun, 9 Oct 2011 11:28:15 -0700 (PDT)
Subject: [rabbitmq-discuss]  RabbitMQ Completely Unusable
Message-ID: <32619934.post@talk.nabble.com>


I had Celery/RabbitMQ running perfectly on Friday. After a reboot, none of
the rabbitmqctl commands work; they all return the message:

Status of node rabbit at basalt ...
Error: unable to connect to node rabbit at basalt: nodedown
diagnostics:
- nodes and their ports on basalt: [{rabbitmqctl4119,39973}]
- current node: rabbitmqctl4119 at basalt
- current node home dir: /var/lib/rabbitmq
- current node cookie hash: 21qdNRGvqYUEWK3+aXB7wA==

The port and nodename suffix are different each time, and the cookie hash
does not correspond to the one in /var/lib/rabbitmq/.erlang.cookie, nor can
I find any other instance of the cookie file on the machine. Hostname
'basalt' is listed in /etc/hosts under '127.0.0.1  basalt'; this has not
been changed since Friday.

I have tried starting rabbitmq-server at runtime as a service; and at the
command line with no arguments and with the '-detached' argument, all with
similar results.

What do I have to do to recover my previously working system? Failing that,
what do I have to delete to get RabbitMQ back to a working, uninitialized
state?
-- 
View this message in context: http://old.nabble.com/RabbitMQ-Completely-Unusable-tp32619934p32619934.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From dreyemi at gmail.com  Sun Oct  9 20:35:46 2011
From: dreyemi at gmail.com (Kayode Odeyemi)
Date: Sun, 9 Oct 2011 20:35:46 +0100
Subject: [rabbitmq-discuss] RabbitMQ Completely Unusable
In-Reply-To: <32619934.post@talk.nabble.com>
References: <32619934.post@talk.nabble.com>
Message-ID: <CAPbrmCvp=LP=ioNmrz6FSQjJL7pt547jkQaJ-_EJ6LkVYKKJsw@mail.gmail.com>

On Sun, Oct 9, 2011 at 7:28 PM, SixDegrees <paulcarlisle at comcast.net> wrote:

>
> I had Celery/RabbitMQ running perfectly on Friday. After a reboot, none of
> the rabbitmqctl commands work; they all return the message:
>
> Status of node rabbit at basalt ...
> Error: unable to connect to node rabbit at basalt: nodedown
> diagnostics:
> - nodes and their ports on basalt: [{rabbitmqctl4119,39973}]
> - current node: rabbitmqctl4119 at basalt
> - current node home dir: /var/lib/rabbitmq
> - current node cookie hash: 21qdNRGvqYUEWK3+aXB7wA==
>
> The port and nodename suffix are different each time, and the cookie hash
> does not correspond to the one in /var/lib/rabbitmq/.erlang.cookie, nor can
> I find any other instance of the cookie file on the machine. Hostname
> 'basalt' is listed in /etc/hosts under '127.0.0.1  basalt'; this has not
> been changed since Friday.
>
> This looks like environment and configuration problem. I once had this
problem,
and the help I got from this list is to make sure the cookie files are
in-sync.

In your initial setup, were the cookie files in sync?


> I have tried starting rabbitmq-server at runtime as a service; and at the
> command line with no arguments and with the '-detached' argument, all with
> similar results.
>
> What do I have to do to recover my previously working system? Failing that,
> what do I have to delete to get RabbitMQ back to a working, uninitialized
> state?
> --
> View this message in context:
> http://old.nabble.com/RabbitMQ-Completely-Unusable-tp32619934p32619934.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Odeyemi 'Kayode O.
http://www.sinati.com. t: @charyorde
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111009/f37b4437/attachment.htm>

From mnkpdon.32 at gmail.com  Sun Oct  9 21:24:39 2011
From: mnkpdon.32 at gmail.com (mayank)
Date: Sun, 9 Oct 2011 13:24:39 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ with WCF binding
Message-ID: <00e4a188-9885-4ab7-97a7-b36f4f5f86e1@d18g2000yql.googlegroups.com>

Hi

I am new to rabbitMQ. I am building an application where using
rabbitmq wcf binding, where the publisher calls the service method and
the message gets queued. When the service starts running it consumes
the messages and acknowledges them. The problem here is I want my
service to acknowledge messages on certain conditions.
I am able to achieve this when i am using the rabbitmq APIs to send
and receive message(not using WCF, just simple c#). But I am not able
to find how to do this with WCF.

From paulcarlisle at comcast.net  Sun Oct  9 23:13:50 2011
From: paulcarlisle at comcast.net (SixDegrees)
Date: Sun, 9 Oct 2011 15:13:50 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ Completely Unusable
In-Reply-To: <CAPbrmCvp=LP=ioNmrz6FSQjJL7pt547jkQaJ-_EJ6LkVYKKJsw@mail.gmail.com>
References: <32619934.post@talk.nabble.com>
	<CAPbrmCvp=LP=ioNmrz6FSQjJL7pt547jkQaJ-_EJ6LkVYKKJsw@mail.gmail.com>
Message-ID: <32621210.post@talk.nabble.com>


Yes; I synced both cookie files immediately after they were created, before
any clustering or other communication was attempted. As noted, this worked
fine on initially.


Kayode Odeyemi wrote:
> 
> On Sun, Oct 9, 2011 at 7:28 PM, SixDegrees <paulcarlisle at comcast.net>
> wrote:
> 
>>
>> I had Celery/RabbitMQ running perfectly on Friday. After a reboot, none
>> of
>> the rabbitmqctl commands work; they all return the message:
>>
>> Status of node rabbit at basalt ...
>> Error: unable to connect to node rabbit at basalt: nodedown
>> diagnostics:
>> - nodes and their ports on basalt: [{rabbitmqctl4119,39973}]
>> - current node: rabbitmqctl4119 at basalt
>> - current node home dir: /var/lib/rabbitmq
>> - current node cookie hash: 21qdNRGvqYUEWK3+aXB7wA==
>>
>> The port and nodename suffix are different each time, and the cookie hash
>> does not correspond to the one in /var/lib/rabbitmq/.erlang.cookie, nor
>> can
>> I find any other instance of the cookie file on the machine. Hostname
>> 'basalt' is listed in /etc/hosts under '127.0.0.1  basalt'; this has not
>> been changed since Friday.
>>
>> This looks like environment and configuration problem. I once had this
> problem,
> and the help I got from this list is to make sure the cookie files are
> in-sync.
> 
> In your initial setup, were the cookie files in sync?
> 
> 
>> I have tried starting rabbitmq-server at runtime as a service; and at the
>> command line with no arguments and with the '-detached' argument, all
>> with
>> similar results.
>>
>> What do I have to do to recover my previously working system? Failing
>> that,
>> what do I have to delete to get RabbitMQ back to a working, uninitialized
>> state?
>> --
>> View this message in context:
>> http://old.nabble.com/RabbitMQ-Completely-Unusable-tp32619934p32619934.html
>> Sent from the RabbitMQ mailing list archive at Nabble.com.
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
> 
> 
> 
> -- 
> Odeyemi 'Kayode O.
> http://www.sinati.com. t: @charyorde
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://old.nabble.com/RabbitMQ-Completely-Unusable-tp32619934p32621210.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From john at ibiblio.org  Mon Oct 10 14:42:29 2011
From: john at ibiblio.org (John Reuning)
Date: Mon, 10 Oct 2011 09:42:29 -0400
Subject: [rabbitmq-discuss] Pika disconnects
In-Reply-To: <CABzX+qybvkw8nobazKaXj4U82=VGD-jhxspG71-Oc0eP1Chgbg@mail.gmail.com>
References: <CACDr4icoabgjk_Pf1EvpBU-ERyr5WiaS73jSCV_pJvJNBEbcVQ@mail.gmail.com>
	<CABzX+qyRzu4EccWo3_imN7uxGP6Q3oqcDX65F8RHrFV8JLCvrw@mail.gmail.com>
	<CACDr4icaKePRhHm1+MgzBgUfuisT0wNCHHt-2XrKjHJUsyuE9Q@mail.gmail.com>
	<CABzX+qybvkw8nobazKaXj4U82=VGD-jhxspG71-Oc0eP1Chgbg@mail.gmail.com>
Message-ID: <CACDr4idmB2YBDSE-Lu_0eMa8SGhoSNQCU6tLX+XgWfVfFVNbcw@mail.gmail.com>

On Sat, Oct 8, 2011 at 8:50 AM, Marek Majkowski <majek04 at gmail.com> wrote:
>
> If you want to publish, you need to stop event loop,
> publish, and restart event loop. It doesn't matter
> which thread does what, but it matters that only
> one thread accesses pika stuff at a time.

I'm really only concerned with publishing.  Consuming happens using
another rabbitmq connection.  When you say stop the event loop, do you
mean the poll loop in IOLoop?  The reason I implemented multiple
threads for publishing was that the ioloop start() call doesn't
return.  Calling ioloop.start() seemed to be the only way to initiate
a rabbitmq connection for publishing.  Is there a non-blocking way to
establish a connection?  Should I call ioloop.start(), wait for the
channel/exchange/queue callbacks to occur, then call ioloop.stop()?  I
tried this, but the stop() call hangs.

Thanks,

-John

From p3consulting at gmail.com  Mon Oct 10 15:19:56 2011
From: p3consulting at gmail.com (Pascal Pochet)
Date: Mon, 10 Oct 2011 16:19:56 +0200
Subject: [rabbitmq-discuss] SSL support
Message-ID: <724FE847-067C-48DE-B2DC-6B1C8540CFCE@gmail.com>

After some time trying why the explanations at http://www.rabbitmq.com/ssl.html
didn't work for me without any error message, just the 

started SSL Listener on ?:5671

never appearing in the log, 

I eventually discovered that the working syntax for the 
ssl_listeners in rabbitmq.config is the one specifying the interface explicitly:

                {ssl_listeners, [{"127.0.0.1", 5671}] },

and not

                {ssl_listeners, [5671] },

Env. : OpenSuse LE 11.3 (in VM under OS X 10.6)

Could be useful to update the documentation:

"Some Linux config may require the interface to be explicitly specified".

("Why" is still an opened question, if somebody knows?)









From simon at rabbitmq.com  Mon Oct 10 15:28:21 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 10 Oct 2011 15:28:21 +0100
Subject: [rabbitmq-discuss] SSL support
In-Reply-To: <724FE847-067C-48DE-B2DC-6B1C8540CFCE@gmail.com>
References: <724FE847-067C-48DE-B2DC-6B1C8540CFCE@gmail.com>
Message-ID: <4E930105.1000303@rabbitmq.com>

On 10/10/11 15:19, Pascal Pochet wrote:
> After some time trying why the explanations at http://www.rabbitmq.com/ssl.html
> didn't work for me without any error message, just the
>
> started SSL Listener on ?:5671
>
> never appearing in the log,
>
> I eventually discovered that the working syntax for the
> ssl_listeners in rabbitmq.config is the one specifying the interface explicitly:
>
>                  {ssl_listeners, [{"127.0.0.1", 5671}] },
>
> and not
>
>                  {ssl_listeners, [5671] },

Is this with a recent RabbitMQ version? Older versions require the first 
variant.

> Env. : OpenSuse LE 11.3 (in VM under OS X 10.6)
>
> Could be useful to update the documentation:
>
> "Some Linux config may require the interface to be explicitly specified".
>
> ("Why" is still an opened question, if somebody knows?)

I'd rather fix the problem, assuming we can find out what it is...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From majek04 at gmail.com  Mon Oct 10 15:38:30 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Mon, 10 Oct 2011 15:38:30 +0100
Subject: [rabbitmq-discuss] Pika disconnects
In-Reply-To: <CACDr4idmB2YBDSE-Lu_0eMa8SGhoSNQCU6tLX+XgWfVfFVNbcw@mail.gmail.com>
References: <CACDr4icoabgjk_Pf1EvpBU-ERyr5WiaS73jSCV_pJvJNBEbcVQ@mail.gmail.com>
	<CABzX+qyRzu4EccWo3_imN7uxGP6Q3oqcDX65F8RHrFV8JLCvrw@mail.gmail.com>
	<CACDr4icaKePRhHm1+MgzBgUfuisT0wNCHHt-2XrKjHJUsyuE9Q@mail.gmail.com>
	<CABzX+qybvkw8nobazKaXj4U82=VGD-jhxspG71-Oc0eP1Chgbg@mail.gmail.com>
	<CACDr4idmB2YBDSE-Lu_0eMa8SGhoSNQCU6tLX+XgWfVfFVNbcw@mail.gmail.com>
Message-ID: <CABzX+qxwgsWsNWUHHdOWMq51O5axDQwFEsUiQjVvKZiQNdxx8A@mail.gmail.com>

On Mon, Oct 10, 2011 at 14:42, John Reuning <john at ibiblio.org> wrote:
> On Sat, Oct 8, 2011 at 8:50 AM, Marek Majkowski <majek04 at gmail.com> wrote:
>>
>> If you want to publish, you need to stop event loop,
>> publish, and restart event loop. It doesn't matter
>> which thread does what, but it matters that only
>> one thread accesses pika stuff at a time.
>
> I'm really only concerned with publishing. ?Consuming happens using
> another rabbitmq connection. ?When you say stop the event loop, do you
> mean the poll loop in IOLoop? ?The reason I implemented multiple
> threads for publishing was that the ioloop start() call doesn't
> return. ?Calling ioloop.start() seemed to be the only way to initiate
> a rabbitmq connection for publishing. ?Is there a non-blocking way to
> establish a connection? ?Should I call ioloop.start(), wait for the
> channel/exchange/queue callbacks to occur, then call ioloop.stop()? ?I
> tried this, but the stop() call hangs.

Understood. But I don't know how to do it in Pika. You may try using
blocking connection, but I don't know what actually basic_publish
does, if it blocks and for how long. See:
https://github.com/pika/pika/blob/master/examples/blocking/demo_send.py#L46

It may be possible to do some kind of synchronization trick
that could break event loop in other thread, but I don't know how.

Gavin CC'ed.

Cheers,
   Marek

From emile at rabbitmq.com  Mon Oct 10 15:48:22 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 10 Oct 2011 15:48:22 +0100
Subject: [rabbitmq-discuss] RabbitMQ Completely Unusable
In-Reply-To: <32619934.post@talk.nabble.com>
References: <32619934.post@talk.nabble.com>
Message-ID: <4E9305B6.3030408@rabbitmq.com>

Hi Paul,

On 09/10/11 19:28, SixDegrees wrote:
> 
> I had Celery/RabbitMQ running perfectly on Friday. After a reboot, none of
> the rabbitmqctl commands work; they all return the message:
> 
> Status of node rabbit at basalt ...
> Error: unable to connect to node rabbit at basalt: nodedown
> diagnostics:
> - nodes and their ports on basalt: [{rabbitmqctl4119,39973}]
> - current node: rabbitmqctl4119 at basalt
> - current node home dir: /var/lib/rabbitmq
> - current node cookie hash: 21qdNRGvqYUEWK3+aXB7wA==

Are you sure the broker is running at the time when you execute
rabbitmqctl? Are there any entries in the broker logfile at the same
time as these messages get logged?

The broker startup banner contains the cookie hash. Is this the same as
the one reported by rabbitmqctl?

> The port and nodename suffix are different each time, and the cookie hash
> does not correspond to the one in /var/lib/rabbitmq/.erlang.cookie, nor can
> I find any other instance of the cookie file on the machine. Hostname
> 'basalt' is listed in /etc/hosts under '127.0.0.1  basalt'; this has not
> been changed since Friday.
> 
> I have tried starting rabbitmq-server at runtime as a service; and at the
> command line with no arguments and with the '-detached' argument, all with
> similar results.
> 
> What do I have to do to recover my previously working system? Failing that,
> what do I have to delete to get RabbitMQ back to a working, uninitialized
> state?

If you move or remove the contents of the mnesia directory then rabbit
will startup in a default state.



-Emile

From pdezwart at rubiconproject.com  Mon Oct 10 18:02:20 2011
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Mon, 10 Oct 2011 12:02:20 -0500
Subject: [rabbitmq-discuss] Queuing fundamentals.
In-Reply-To: <CA5F30D2.1D42A%pdezwart@rubiconproject.com>
Message-ID: <CAB871AF.2436B%pdezwart@rubiconproject.com>

I am trying to modify the behavior of the php-amqp consume method to be
more accurate. The consume method allows for the setting of a minimum and
maximum number of desired messages. The "correct" (and optimal) behavior
would therefore be to set the prefetch count to the max messages value. I
would gladly do this, except I don?t know how. We are using:
amqp_basic_consume(cnn->conn, AMQP_CHANNEL, amqp_cstring_bytes(ctx->name),
AMQP_EMPTY_BYTES, 0, 0, 0, AMQP_EMPTY_TABLE);
To get data out of the queue. Is this a parameter I should be passing into
amqp_basic_consume, or do I need to do some other tomfoolery to make this
work?
I looked through the examples but found nothing =(

Thanks!
me





On 8/3/11 5:08 PM, "Pieter de Zwart" <pdezwart at rubiconproject.com> wrote:

>I don?t actually think we support pre-fetch. If it is in the rabbitmq-c
>library, then we can support it relatively easily. Andrew, can you please
>file a bug and I will see if we can address this quickly.
>me 
>
>
>
>
>
>
>
>On 8/2/11 2:04 AM, "Eugene Kirpichov" <ekirpichov at gmail.com> wrote:
>
>>Hi,
>>
>>I'm not sure how to set the prefetch size with the PHP library, and I
>>don't know whether the 'min' and 'max' parameters are related to it.
>>I believe that in theory, your scenario should work as you wished, if
>>you set prefetch to 1. It did for me at least, with the .NET client.
>>
>>2011/8/1 Andrew <aph at repido.co.uk>:
>>> Hi Eugene ,
>>>
>>> My code is written in PHP and is using the PHP AMQP library (http://
>>> www.php.net/manual/en/book.amqp.php) and in my calls to the consume()
>>> method I am setting parameters that specify a minimum delivery of zero
>>> messages and a maximum of one. This I had hoped would just get one
>>> message from the queue at a time for me to process.
>>>
>>> Certainly what you suggest would explain the behaviour so perhaps my
>>> understanding of the parameters to the consume() method is wrong.
>>>
>>> Do you think that what I am trying to achieve should in theory work?
>>> If so, what should happen to message 3 after it's failed ACK? i.e.
>>> should my next request to the queue retrieve it, or will it always be
>>> delivered out of sequence after a failed ACK? If the latter is the
>>> case, how do I achieve ordered delivery of my messages even when my
>>> consume process dies and restarts?
>>>
>>> Thanks,
>>> Andrew
>>>
>>> On Aug 1, 5:41 pm, Eugene Kirpichov <ekirpic... at gmail.com> wrote:
>>>> I suppose that you haven't set the prefetch count to 1.
>>>>
>>>> So in fact you had messages 3,4,5,6 all delivered to you (so thought
>>>> the broker) and when the consumer died, the broker requeued all of
>>>> them in no particular sequence.
>>>>
>>>> 2011/8/1 Andrew <a... at repido.co.uk>:
>>>>
>>>>
>>>>
>>>>
>>>>
>>>>
>>>>
>>>>
>>>>
>>>> > Hi everybody,
>>>>
>>>> > I wondered if somebody might be able to clarify some behaviour for
>>>>me
>>>> > as I am getting confused about whether the scenario I am
>>>>experiencing
>>>> > is due to a lack of understanding of how RabbitMQ works or something
>>>> > else.
>>>>
>>>> > I have one reader process which may die due to system failure and at
>>>> > restart I'd like the same single consumer process to start up again
>>>> > and pick up where it left off. So a summary of what I'd like to
>>>>happen
>>>> > is:
>>>>
>>>> > (1) My transmitter process sends and queues up messages 1, 2, 3, 4,
>>>>5
>>>> > & 6.
>>>> > (2) My single consumer process reads and acknowledges messages 1 and
>>>>2
>>>> > in sequence.
>>>> > (3) My consumer process reads message 3 and then dies without
>>>> > acknowledging.
>>>> > (4) I restart my consumer process which will request the next
>>>>message,
>>>> > which should be the unacknowledged message (3).
>>>> > (5) My consumer process would then continue reading messages from
>>>>the
>>>> > queue (4, 5, & 6) in sequence.
>>>>
>>>> > What I am experiencing is that when my consumer process is restarted
>>>> > messages 3, 4, 5 & 6 are delivered out of sequence and all with a
>>>> > redelivery count of 1. I understand that message 3 might be out of
>>>> > sequence because it was unacknowledged and from what I have read,
>>>>when
>>>> > a message is redelivered then it's sequence is no longer guaranteed.
>>>> > However I'm not clear as to why the remaining queued messages are
>>>>out
>>>> > of sequence too.
>>>>
>>>> > More importantly is what I am trying to do is something that is
>>>> > contrary to how RabbitMQ works, or am I just going about it the
>>>>wrong
>>>> > way?
>>>>
>>>> > Many thanks for your help,
>>>> > Andrew
>>>>
>>>> > _______________________________________________
>>>> > rabbitmq-discuss mailing list
>>>> > rabbitmq-disc... at lists.rabbitmq.com
>>>> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>
>>>> --
>>>> Eugene Kirpichov
>>>> Principal Engineer, Mirantis Inc.http://www.mirantis.com/
>>>> Editor,http://fprog.ru/
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> 
>>>>rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/m
>>>>a
>>>>ilman/listinfo/rabbitmq-discuss
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>
>>
>>
>>-- 
>>Eugene Kirpichov
>>Principal Engineer, Mirantis Inc. http://www.mirantis.com/
>>Editor, http://fprog.ru/
>>_______________________________________________
>>rabbitmq-discuss mailing list
>>rabbitmq-discuss at lists.rabbitmq.com
>>https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>_______________________________________________
>rabbitmq-discuss mailing list
>rabbitmq-discuss at lists.rabbitmq.com
>https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From marv_lush at yahoo.com  Mon Oct 10 22:13:46 2011
From: marv_lush at yahoo.com (Marv Lush)
Date: Mon, 10 Oct 2011 14:13:46 -0700 (PDT)
Subject: [rabbitmq-discuss] HTTP Plugin?
Message-ID: <1318281226.81323.YahooMailNeo@web65709.mail.ac4.yahoo.com>

Hello all. I'm looking for the easiest way to push JSON messages to my broker?from a shell script,?without installing erlang on my producers. The most *?convenient* way I can think of doing this is curl and HTTP.

I looked at MochiWeb...but unless the documentation is incomplete...it doesn't seem to support something like:

POST http://mybroker:1234/myRoutingKey
{
? ?"key1":"value1",
? ?"key2":"value2"
}


I also looked at JSONRPC, but that doesn't seem to do the trick either. Is there another plugin that would allow this??Preferably?(but not required), one that would also allow me to consume from a queue by doing something like:

GET http://mybroker:1234/queueName/consume



Or something, like that...you get the idea...


thanks,
/m
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111010/30ecf7f4/attachment.htm>

From adamrabung at gmail.com  Tue Oct 11 02:48:45 2011
From: adamrabung at gmail.com (Adam Rabung)
Date: Mon, 10 Oct 2011 21:48:45 -0400
Subject: [rabbitmq-discuss] Round-robin exchanges?
Message-ID: <CAAN_EDocROkkNTR3RjzBVSeMUfUuaHOtJYjR-B6DCsv=o5Rkaw@mail.gmail.com>

Hello,
I am trying to implement a work queue in RabbitMQ.  I have several machines
that will act as worker pools for consuming my queues.  I would like each
job to be processed only once.  Some jobs have environmental requirements,
ie must be executed on a machine with an SSD.  Not all worker pools will
meet these requirements.  A first approach would be to have a queue for
every permutation of requirements: "No Requirements", "Requires SSD",
"Requires Certificate", etc and have each worker pool subscribe to all
queues which it can handle.

A majority of the jobs will have no requirements, so many worker pools will
be underutilized.  To fight this, I am hoping to distribute jobs in a
round-robin fashion to all queues that can handle them.  For example, a
no-requirements job can be handled by any worker pool, and therefore should
be distributed equally to all of them.  That is, jobs w/ no requirements
will be evenly distributed to "No Requirements", "Requires SSD", "Requires
Certificate", etc.

I tried this with topic exchanges, but of course they will distribute the
job to ALL matching queues, rather than a single arbitrary queue.

Some terrible alternative approaches I have so far:
1. Have producers submit to a single queue, and have a home-grown "load
balancer" consumer on the other end which distributes jobs to appropriate
queues.
2. When a worker pool spins up, rather than have each worker consume a
dedicate queue, have at least some of them hop between queues in an attempt
to keep them busy.
3. Hacks with timestamps/modulo arithmetic in the routing key to trick the
exchange into being round robin.

Being new to RabbitMQ, my intuition tells me #1 will be a big performance
problem, #2 will be a performance and maintenance problem, and #3 just won't
end up working.  I suspect I'm missing something big here :)

Has anyone successfully load-balanced their workers in a situation like
this?

Any advice much appreciated.
Adam
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111010/031ba60c/attachment.htm>

From alexis at rabbitmq.com  Tue Oct 11 07:05:12 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Tue, 11 Oct 2011 07:05:12 +0100
Subject: [rabbitmq-discuss] Round-robin exchanges?
In-Reply-To: <CAAN_EDocROkkNTR3RjzBVSeMUfUuaHOtJYjR-B6DCsv=o5Rkaw@mail.gmail.com>
References: <CAAN_EDocROkkNTR3RjzBVSeMUfUuaHOtJYjR-B6DCsv=o5Rkaw@mail.gmail.com>
Message-ID: <CACOPnvc93wvXH_kMEwnKUCVDq1QXLH5HCoVDxYxJz1hj0zEhvg@mail.gmail.com>

Adam

Would this solve your problem?

http://twitter.com/#!/hylomorphism/status/117667626880221184

Apologies if I misunderstood.

a


On Tue, Oct 11, 2011 at 2:48 AM, Adam Rabung <adamrabung at gmail.com> wrote:
> Hello,
> I am trying to implement a work queue in RabbitMQ. ?I have several machines
> that will act as worker pools for consuming my queues. ?I would like each
> job to be processed only once. ?Some jobs have?environmental?requirements,
> ie must be executed on a machine with an SSD. ?Not all worker pools will
> meet these requirements. ?A first approach would be to have a queue for
> every permutation of requirements: "No Requirements", "Requires SSD",
> "Requires Certificate", etc and have each worker pool subscribe to all
> queues which it can handle.
> A majority of the jobs will have no requirements, so many worker pools will
> be underutilized. ?To fight this, I am hoping to distribute jobs in a
> round-robin fashion to all queues that can handle them. ?For example, a
> no-requirements job can be handled by any worker pool, and therefore should
> be distributed equally to all of them. ?That is, jobs w/ no requirements
> will be evenly distributed to?"No Requirements", "Requires SSD", "Requires
> Certificate", etc.
> I tried this with topic exchanges, but of course they will distribute the
> job to ALL matching queues, rather than a single arbitrary queue.
> Some terrible alternative approaches I have so far:
> 1. Have producers submit to a single queue, and have a home-grown "load
> balancer" consumer on the other end which distributes jobs to appropriate
> queues.
> 2. When a worker pool spins up, rather than have each worker consume a
> dedicate queue, have at least some of them hop between queues in an attempt
> to keep them busy.
> 3. Hacks with timestamps/modulo arithmetic in the routing key to trick the
> exchange into being round robin.
> Being new to RabbitMQ, my intuition tells me #1 will be a big performance
> problem, #2 will be a performance and maintenance problem, and #3 just won't
> end up working. ?I suspect I'm missing something big here :)
> Has anyone successfully load-balanced their workers in a situation like
> this?
> Any advice much appreciated.
> Adam
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From matthias at rabbitmq.com  Tue Oct 11 07:19:38 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 11 Oct 2011 07:19:38 +0100
Subject: [rabbitmq-discuss] Round-robin exchanges?
In-Reply-To: <CAAN_EDocROkkNTR3RjzBVSeMUfUuaHOtJYjR-B6DCsv=o5Rkaw@mail.gmail.com>
References: <CAAN_EDocROkkNTR3RjzBVSeMUfUuaHOtJYjR-B6DCsv=o5Rkaw@mail.gmail.com>
Message-ID: <4E93DFFA.5080004@rabbitmq.com>

Adam,

On 11/10/11 02:48, Adam Rabung wrote:
> Hello,
> I am trying to implement a work queue in RabbitMQ.  I have several
> machines that will act as worker pools for consuming my queues.  I would
> like each job to be processed only once.  Some jobs
> have environmental requirements, ie must be executed on a machine with
> an SSD.  Not all worker pools will meet these requirements.  A first
> approach would be to have a queue for every permutation of requirements:
> "No Requirements", "Requires SSD", "Requires Certificate", etc and have
> each worker pool subscribe to all queues which it can handle.

That is a sound approach.

> A majority of the jobs will have no requirements, so many worker pools
> will be underutilized.

As you say, the worker pools would subscribe to all the queues with 
combinations of requirements they can handle. That includes the "No 
Requirements" queue. The subscriptions can be active *simultaneously*, 
so work in the "No Requirements" queue would be round-robin routed to 
all workers, jobs in the "Require SSD" queue will be routed to all 
workers that have SSDs, etc.

If each worker uses a single channel with a basic.qos prefetch setting 
of 1 and subscribes to all the relevant queues on that channel, it will 
be fed work items one at a time from the subset of all these queues that 
have messages in them. There's some logic at the server that ensures 
this is reasonably fair, though you will most likely find that queues 
which can be handled by many workers drain faster than others.

Regards,

Matthias.

From pdezwart at rubiconproject.com  Tue Oct 11 07:37:31 2011
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Tue, 11 Oct 2011 01:37:31 -0500
Subject: [rabbitmq-discuss] Queue.declare arguments
Message-ID: <CAB9323B.2475A%pdezwart@rubiconproject.com>

Hey everyone,

I am trying to implement support for passing arguments to queue.declare in the PHP extension for AMQP. Based on the docs, arguments are up to the server to implement, but are based on an amqp_table_t structure. Based on previous email threads and some basic research, the full list of supported keys for the table seem to be: x-expires, x-message-ttl, x-ha-policy and x-ha-policy-params. Is this still the complete list? It seems like I should just give people the ability to set any key they want.

The definition of an amqp_table_entry is a key (amqp_bytes) and value (amqp_field_value_t). The latter has a definition of:

typedef struct amqp_field_value_t_ { char kind; union { amqp_boolean_t boolean; int8_t i8; uint8_t u8; int16_t i16; uint16_t u16; int32_t i32; uint32_t u32; int64_t i64; uint64_t u64; float f32; double f64; amqp_decimal_t decimal; amqp_bytes_t bytes; amqp_table_t table; amqp_array_t array; } value; } amqp_field_value_t;

Im assuming therefore that I can shove any kind/value combo for any key, and let the rabbitmq-c client/broker figure out the details. Is that correct?

Thank you for your help.

Pieter
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111011/066f830b/attachment.htm>

From matthias at rabbitmq.com  Tue Oct 11 08:47:54 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 11 Oct 2011 08:47:54 +0100
Subject: [rabbitmq-discuss] Queues creation in cluster
In-Reply-To: <CAOQFjYMaUE2EgNDbNiD4wvgmpU9R0EgnhDUYDS-gV73x+V4=Jg@mail.gmail.com>
References: <CAOQFjYNTz_eCVDbDr_rwoJYn1dd6g3RqvfJ9wcxuvApg45Wsmg@mail.gmail.com>
	<CAOQFjYMaUE2EgNDbNiD4wvgmpU9R0EgnhDUYDS-gV73x+V4=Jg@mail.gmail.com>
Message-ID: <4E93F4AA.7030101@rabbitmq.com>

Ran,

On 04/10/11 16:29, ran mizrachi wrote:
> I am setting a cluster of two nodes, creating queues on demand, how can
> I make sure queues are created equally on both nodes.

Option 1) stick a load balancer in front of the nodes.

Option 2) get your clients to select a node at random.


Matthias.

From sameek at arosys.com  Tue Oct 11 09:00:53 2011
From: sameek at arosys.com (sameekmishra)
Date: Tue, 11 Oct 2011 01:00:53 -0700 (PDT)
Subject: [rabbitmq-discuss]  getting  authentication failure Exception?
Message-ID: <32629116.post@talk.nabble.com>


Hi 

I am using Rabbitmq server 2.5 is install on machine IP -192.168.1.64.when i
try to get connected with machine i got the error:" java.io.IOException:
Possibly caused by authentication failure".used code to connect with server:

      ConnectionFactory factory = new ConnectionFactory();
      factory.setUsername("guest");
      factory.setPassword("guest");
      factory.setVirtualHost("/");
      factory.setHost("192.168.1.64");
      factory.setPort("5672");
      conn = factory.newConnection();

please help me to get resolve above problem.

Thanks 


-- 
View this message in context: http://old.nabble.com/getting--authentication-failure-Exception--tp32629116p32629116.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From matthias at rabbitmq.com  Tue Oct 11 09:09:22 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 11 Oct 2011 09:09:22 +0100
Subject: [rabbitmq-discuss] Fairness wrt queues under heavy load
In-Reply-To: <CANVKUrWC=q6GipDRtWEiUOpL0yo_yjxVBzTOPU_C2kWkADfYUA@mail.gmail.com>
References: <CANVKUrWC=q6GipDRtWEiUOpL0yo_yjxVBzTOPU_C2kWkADfYUA@mail.gmail.com>
Message-ID: <4E93F9B2.1060605@rabbitmq.com>

Eugene,

On 07/10/11 16:30, Eugene Kirpichov wrote:
> I've got a large cluster with many consumers, and several producers
> who publish a very intense steady stream of messages in
> publish/confirm mode.
>
> Some components occasionally submit a single but very important and
> urgent message in transactional mode, which takes up to 5-10 minutes
> to be delivered.
>
> Is this expected behavior?

Depends.

> How can I avoid these obscenely large delays?

Most likely due to backlogs. The cure depends on where the backlog is. 
Let's follow the path of a message from producer to consumer...

If the producer publishes at a high rate then backlogs will arise in the 
client buffers, network buffers, server-side network buffers and buffers 
inside rabbit. These backlogs can be substantial, though unlikely 
minutes worth. The way to avoid them is to ensure that high-priority 
messages are published on a separate connection from ordinary messages.

If the publishing rate exceeds the rabbit capacity, the broker will 
eventually hit its memory threshold and throttle producers. The logs 
will tell you when that happens. Memory pressure can take a while to 
dissipate, sometimes several minutes. The cure for this is to set up a 
bigger rabbit.

Messages pile up in queues when consumers don't consume them fast 
enough. Since queues are FIFO structures that manifests itself as a 
delay. To avoid this delay for high priority messages, make sure they 
get routed to a separate queue and code consumers s.t. they consume from 
that queue in addition to the regular queues.

At the consuming end messages can pile up in network buffers and, 
depending on the client library and its use, in client-side buffers. To 
avoid that set a basic.qos prefetch limit on the consuming channels.


Regards,

Matthias.

From matthias at rabbitmq.com  Tue Oct 11 09:11:07 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 11 Oct 2011 09:11:07 +0100
Subject: [rabbitmq-discuss] getting  authentication failure Exception?
In-Reply-To: <32629116.post@talk.nabble.com>
References: <32629116.post@talk.nabble.com>
Message-ID: <4E93FA1B.50100@rabbitmq.com>

On 11/10/11 09:00, sameekmishra wrote:
> I am using Rabbitmq server 2.5 is install on machine IP -192.168.1.64.when i
> try to get connected with machine i got the error:" java.io.IOException:
> Possibly caused by authentication failure".used code to connect with server:
>
>        ConnectionFactory factory = new ConnectionFactory();
>        factory.setUsername("guest");
>        factory.setPassword("guest");
>        factory.setVirtualHost("/");
>        factory.setHost("192.168.1.64");
>        factory.setPort("5672");
>        conn = factory.newConnection();
>
> please help me to get resolve above problem.

What does rabbit's log say?

Matthias.

From matthias at rabbitmq.com  Tue Oct 11 09:18:56 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 11 Oct 2011 09:18:56 +0100
Subject: [rabbitmq-discuss] erl.exe crashing occasionally
In-Reply-To: <32618230.post@talk.nabble.com>
References: <32618230.post@talk.nabble.com>
Message-ID: <4E93FBF0.1090102@rabbitmq.com>

On 09/10/11 08:28, Nadavgg wrote:
> I am running RabbitMQ on a single server and here is an error I get
> [...]
> Slogan: eheap_alloc: Cannot allocate 10517700 bytes of memory (of type
> "heap").
> [...]
> =memory
> total: 136084752
 > [...]
> Does it mean I lack the memory to allocate more mem-space to the rabbit?

Rabbit is using 136MB of memory and failed to allocate an additional 
10MB. Are you running rabbit in a very memory constrained environment? 
What memory limit does rabbit report in its logs?

Rabbit should in fact run ok with little memory, but its ability to cope 
with high loads and spikes is severely compromised in such a setting and 
the default value of the memory threshold 
(http://www.rabbitmq.com/admin-guide.html#memsup-usage) might need lowering.

Regards,

Matthias.

From matthias at rabbitmq.com  Tue Oct 11 09:27:45 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 11 Oct 2011 09:27:45 +0100
Subject: [rabbitmq-discuss] Queuing fundamentals.
In-Reply-To: <CAB871AF.2436B%pdezwart@rubiconproject.com>
References: <CAB871AF.2436B%pdezwart@rubiconproject.com>
Message-ID: <4E93FE01.20908@rabbitmq.com>

Pieter,

On 10/10/11 18:02, Pieter de Zwart wrote:
> set the prefetch count [...] Is this a parameter I should be passing
> into amqp_basic_consume, or do I need to do some other tomfoolery to
> make this work? I looked through the examples but found nothing =(

This is a *channel* setting. See
http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.qos and the
"Fair dispatch" section in
http://www.rabbitmq.com/tutorials/tutorial-two-python.html.

Matthias.

From andrea.rosa at hp.com  Tue Oct 11 09:59:37 2011
From: andrea.rosa at hp.com (Rosa, Andrea)
Date: Tue, 11 Oct 2011 08:59:37 +0000
Subject: [rabbitmq-discuss] Fairness wrt queues under heavy load
In-Reply-To: <CANVKUrWC=q6GipDRtWEiUOpL0yo_yjxVBzTOPU_C2kWkADfYUA@mail.gmail.com>
References: <CANVKUrWC=q6GipDRtWEiUOpL0yo_yjxVBzTOPU_C2kWkADfYUA@mail.gmail.com>
Message-ID: <5F389C517756284F80239F55BCA5DDDD068C12@G9W0721.americas.hpqcorp.net>

Hi Eugene,



> -----Original Message-----
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-
> discuss-bounces at lists.rabbitmq.com] On Behalf Of Eugene Kirpichov
> Sent: 07 October 2011 16:31
> To: rabbitmq-discuss at lists.rabbitmq.com
> Subject: [rabbitmq-discuss] Fairness wrt queues under heavy load
> 
> Hello,
> 
> I've got a large cluster with many consumers, and several producers
> who publish a very intense steady stream of messages in
> publish/confirm mode.

What do you mean with "very intense steady stream of messages"?
Can you give me an estimation in terms of number and size of messages?
I am facing with the same problem, I'd like to compare your scenario with mine.

Best Regards
--
Andrea Rosa


From simon at rabbitmq.com  Tue Oct 11 10:38:20 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 11 Oct 2011 10:38:20 +0100
Subject: [rabbitmq-discuss] SSL support
In-Reply-To: <37F6F378-3E83-4E5F-B78F-25643BCDBDFF@gmail.com>
References: <724FE847-067C-48DE-B2DC-6B1C8540CFCE@gmail.com>
	<4E930105.1000303@rabbitmq.com>
	<37F6F378-3E83-4E5F-B78F-25643BCDBDFF@gmail.com>
Message-ID: <4E940E8C.1000408@rabbitmq.com>

On 10/10/11 19:19, Pascal Pochet wrote:
> Yes it's a recent version:
>
> otp R14B03
> Rabbit 2.2.0-2.2

Not recent enough I'm afraid - we changed the way that configuration 
parameter worked when we added IPv6 support in 2.3.0. Before that it 
needed the {IPAddress, Port} tuple.

> (don't miss the point: without the host address the server runs fine, but only on non-SSL port 5672)

I suspect the broker is failing to read the tcp_listeners configuration 
and defaulting to {"0.0.0.0", 5672}.

Cheers, Simon

> to find out what it is, it will probably require logging at low level in Erlang itself,
> I suspect low level Unix functions to return something weird when running under a VM
> (currently a Parallels-one but I will try converting to VMWare format and compare?)
> (or a bzero of inet struct missing somewhere? )
>
> Note also the VM runs with bridged Ethernet-2 port assigned to it (MacPro has 2 Ethernet ports)
> while the Mac OS X host itself is connected to network thru Ethernet-1.
>
> Anyway even if the solution is trivial, the cause should be found
> to be sure no subtle problem may further prevent hassle-free deployment on VMs in general.
>
> So sharing of experiences of SSL deployment under VMs of different distribution/different host hardware and OS is welcome?
>
>
> Pascal P. Pochet
> P3 Consulting
>
>
>
> Le 10 oct. 2011 ? 16:28, Simon MacMullen a ?crit :
>
>> On 10/10/11 15:19, Pascal Pochet wrote:
>>> After some time trying why the explanations at http://www.rabbitmq.com/ssl.html
>>> didn't work for me without any error message, just the
>>>
>>> started SSL Listener on ?:5671
>>>
>>> never appearing in the log,
>>>
>>> I eventually discovered that the working syntax for the
>>> ssl_listeners in rabbitmq.config is the one specifying the interface explicitly:
>>>
>>>                  {ssl_listeners, [{"127.0.0.1", 5671}] },
>>>
>>> and not
>>>
>>>                  {ssl_listeners, [5671] },
>>
>> Is this with a recent RabbitMQ version? Older versions require the first variant.
>>
>>> Env. : OpenSuse LE 11.3 (in VM under OS X 10.6)
>>>
>>> Could be useful to update the documentation:
>>>
>>> "Some Linux config may require the interface to be explicitly specified".
>>>
>>> ("Why" is still an opened question, if somebody knows?)
>>
>> I'd rather fix the problem, assuming we can find out what it is...
>>
>> Cheers, Simon
>>
>> --
>> Simon MacMullen
>> RabbitMQ, VMware
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From ekirpichov at gmail.com  Tue Oct 11 10:47:00 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Tue, 11 Oct 2011 13:47:00 +0400
Subject: [rabbitmq-discuss] Fairness wrt queues under heavy load
In-Reply-To: <4E93F9B2.1060605@rabbitmq.com>
References: <CANVKUrWC=q6GipDRtWEiUOpL0yo_yjxVBzTOPU_C2kWkADfYUA@mail.gmail.com>
	<4E93F9B2.1060605@rabbitmq.com>
Message-ID: <CANVKUrUsJteZxAzpD78EhimydEH_gu5bTjzS7j2V=TOSmg+t4A@mail.gmail.com>

Hi Matthias,

On Tue, Oct 11, 2011 at 12:09 PM, Matthias Radestock
<matthias at rabbitmq.com> wrote:
> Eugene,
>
> On 07/10/11 16:30, Eugene Kirpichov wrote:
>>
>> I've got a large cluster with many consumers, and several producers
>> who publish a very intense steady stream of messages in
>> publish/confirm mode.
>>
>> Some components occasionally submit a single but very important and
>> urgent message in transactional mode, which takes up to 5-10 minutes
>> to be delivered.
>>
>> Is this expected behavior?
>
> Depends.
>
>> How can I avoid these obscenely large delays?
>
> Most likely due to backlogs. The cure depends on where the backlog is. Let's
> follow the path of a message from producer to consumer...
>
> If the producer publishes at a high rate then backlogs will arise in the
> client buffers, network buffers, server-side network buffers and buffers
> inside rabbit. These backlogs can be substantial, though unlikely minutes
> worth. The way to avoid them is to ensure that high-priority messages are
> published on a separate connection from ordinary messages.
>
> If the publishing rate exceeds the rabbit capacity, the broker will
> eventually hit its memory threshold and throttle producers. The logs will
> tell you when that happens. Memory pressure can take a while to dissipate,
> sometimes several minutes. The cure for this is to set up a bigger rabbit.
This could be the case, actually, though I'm limiting the number of
unconfirmed publishes on each queue, but I don't limit it on a global
level. Thanks, I'll look at the logs.

What somewhat disproves this is that this *only* happens with
transactional messages (establish channel, start transaction, publish
message, commit, close channel - though the connection may be shared).

>
> Messages pile up in queues when consumers don't consume them fast enough.
> Since queues are FIFO structures that manifests itself as a delay. To avoid
> this delay for high priority messages, make sure they get routed to a
> separate queue and code consumers s.t. they consume from that queue in
> addition to the regular queues.
I am routing to a separate queue already.

>
> At the consuming end messages can pile up in network buffers and, depending
> on the client library and its use, in client-side buffers. To avoid that set
> a basic.qos prefetch limit on the consuming channels.
I have prefetch = 1.

>
>
> Regards,
>
> Matthias.
>



-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/

From simon at rabbitmq.com  Tue Oct 11 10:51:05 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 11 Oct 2011 10:51:05 +0100
Subject: [rabbitmq-discuss] Queue.declare arguments
In-Reply-To: <CAB9323B.2475A%pdezwart@rubiconproject.com>
References: <CAB9323B.2475A%pdezwart@rubiconproject.com>
Message-ID: <4E941189.8000408@rabbitmq.com>

On 11/10/11 07:37, Pieter de Zwart wrote:
> I am trying to implement support for passing arguments to queue.declare
> in the PHP extension for AMQP. Based on the docs, arguments are up to
> the server to implement, but are based on an amqp_table_t structure.
> Based on previous email threads and some basic research, the full list
> of supported keys for the table seem to be: x-expires, x-message-ttl,
> x-ha-policyand x-ha-policy-params. Is this still the complete list?

It is today. And I don't think any more arguments are on the drawing 
board right now, but we may well introduce more in the future.

It's worth pointing out that arguments matter for more than just queues, 
they can be used with exchanges (we implement one extension argument, 
"alternate-exchange") and also as part of routing with the headers 
exchange type (for which you need to be able to set arbitrary arguments 
on bindings).

> It
> seems like I should just give people the ability to set any key they want.

That is the right thing to do, and it's what we do in our clients.

> The definition of an amqp_table_entry is a key (amqp_bytes) and value
> (amqp_field_value_t). The latter has a definition of:
>
> typedef struct amqp_field_value_t_ { char kind; union { amqp_boolean_t
> boolean; int8_t i8; uint8_t u8; int16_t i16; uint16_t u16; int32_t i32;
> uint32_t u32; int64_t i64; uint64_t u64; float f32; double f64;
> amqp_decimal_t decimal; amqp_bytes_t bytes; amqp_table_t table;
> amqp_array_t array; } value; } amqp_field_value_t;
>
> Im assuming therefore that I can shove any kind/value combo for any key,
> and let the rabbitmq-c client/broker figure out the details. Is that
> correct?

Not really - the values in AMQP are typed. These types will be pushed 
through unchanged by the C client, but the broker will want you to set 
sensible types. We try to be reasonably flexible, but if you're setting 
the x-expires argument for example then we'll expect one of the integer 
types; we won't just parse a string.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From david at rabbitmq.com  Tue Oct 11 10:55:38 2011
From: david at rabbitmq.com (David Wragg)
Date: Tue, 11 Oct 2011 10:55:38 +0100
Subject: [rabbitmq-discuss] Queue.declare arguments
In-Reply-To: <CAB9323B.2475A%pdezwart@rubiconproject.com> (Pieter de Zwart's
	message of "Tue, 11 Oct 2011 01:37:31 -0500")
References: <CAB9323B.2475A%pdezwart@rubiconproject.com>
Message-ID: <yrv4c39ezkg2t.fsf@dwragg.eng.vmware.com>

Hi Pieter,

Pieter de Zwart <pdezwart at rubiconproject.com> writes:
> I am trying to implement support for passing arguments to
> queue.declare in the PHP extension for AMQP. Based on the docs,
> arguments are up to the server to implement, but are based on an
> amqp_table_t structure. Based on previous email threads and some basic
> research, the full list of supported keys for the table seem to be:
> x-expires, x-message-ttl, x-ha-policy and x-ha-policy-params. Is this
> still the complete list? It seems like I should just give people the
> ability to set any key they want.

Yes.  Even if that list is complete today, it might not be complete in
the future.

> The definition of an amqp_table_entry is a key (amqp_bytes) and value
>(amqp_field_value_t). The latter has a definition of:
>
> typedef struct amqp_field_value_t_ { char kind; union { amqp_boolean_t
> boolean; int8_t i8; uint8_t u8; int16_t i16; uint16_t u16; int32_t
> i32; uint32_t u32; int64_t i64; uint64_t u64; float f32; double f64;
> amqp_decimal_t decimal; amqp_bytes_t bytes; amqp_table_t table;
> amqp_array_t array; } value; } amqp_field_value_t;
>
> Im assuming therefore that I can shove any kind/value combo for any
> key, and let the rabbitmq-c client/broker figure out the details. Is
> that correct?

Yes.  AMQP tables are just name -> typed value dictionaries.  In certain
contexts (such as queue.declare arguments) the broker defines a
particular meaning for them.  In others (e.g. message headers) the
interpretation is up to applications. (Actually, this is not entirely
true for message headers any more - there are RabbitMQ protocol
extensions that involve certain message headers influencing broker
behaviour).

See
<https://github.com/rabbitmq/rabbitmq-c/blob/master/tests/test_tables.c>
for rabbitmq-c code that constructs tables.

-- 
David Wragg
Staff Engineer, RabbitMQ
VMware, Inc.

From matthias at rabbitmq.com  Tue Oct 11 11:20:38 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 11 Oct 2011 11:20:38 +0100
Subject: [rabbitmq-discuss] Fairness wrt queues under heavy load
In-Reply-To: <CANVKUrUsJteZxAzpD78EhimydEH_gu5bTjzS7j2V=TOSmg+t4A@mail.gmail.com>
References: <CANVKUrWC=q6GipDRtWEiUOpL0yo_yjxVBzTOPU_C2kWkADfYUA@mail.gmail.com>	<4E93F9B2.1060605@rabbitmq.com>
	<CANVKUrUsJteZxAzpD78EhimydEH_gu5bTjzS7j2V=TOSmg+t4A@mail.gmail.com>
Message-ID: <4E941876.3090105@rabbitmq.com>

On 11/10/11 10:47, Eugene Kirpichov wrote:
> On Tue, Oct 11, 2011 at 12:09 PM, Matthias Radestock
> <matthias at rabbitmq.com>  wrote:
>> If the publishing rate exceeds the rabbit capacity, the broker will
>> eventually hit its memory threshold and throttle producers. The logs will
>> tell you when that happens. Memory pressure can take a while to dissipate,
>> sometimes several minutes. The cure for this is to set up a bigger rabbit.
> This could be the case, actually, though I'm limiting the number of
> unconfirmed publishes on each queue, but I don't limit it on a global
> level. Thanks, I'll look at the logs.
>
> What somewhat disproves this is that this *only* happens with
> transactional messages (establish channel, start transaction, publish
> message, commit, close channel - though the connection may be shared).

Hmm. It should be quite difficult to hit the memory limit when 
publishing in tx or confirm mode and committing/waiting after every message.

Anyway, check the logs for memory alarms.

Also, you should avoid sharing connections between producers and 
consumers. Otherwise the throttling of producers will also starve consumers.

>> Messages pile up in queues when consumers don't consume them fast enough.
>> Since queues are FIFO structures that manifests itself as a delay. To avoid
>> this delay for high priority messages, make sure they get routed to a
>> separate queue and code consumers s.t. they consume from that queue in
>> addition to the regular queues.
> I am routing to a separate queue already.

When you experience the delay for a high priority message, check whether 
the message is sitting in the queue. If it is then there is a problem at 
the consuming side, i.e. rabbit thinks there is no consumer ready to 
accept the message.


Matthias.

From matthias at rabbitmq.com  Tue Oct 11 12:05:24 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 11 Oct 2011 12:05:24 +0100
Subject: [rabbitmq-discuss] Query for Binding with similar topic routing
 keys returns all similar vs the one matching
In-Reply-To: <BDE140BF4C952041931EF8CAAC83341D026B6B8E86@exch-mbx-111.vmware.com>
References: <BDE140BF4C952041931EF8CAAC83341D026B6B8E83@exch-mbx-111.vmware.com>,
	<BDE140BF4C952041931EF8CAAC83341D026B6B8E85@exch-mbx-111.vmware.com>
	<BDE140BF4C952041931EF8CAAC83341D026B6B8E86@exch-mbx-111.vmware.com>
Message-ID: <4E9422F4.2070007@rabbitmq.com>

Helena,

On 08/10/11 17:34, Helena Edelson wrote:
> This works (below). My confusion was over the relationship between
> 'name' and 'props' in the sample
>
> /api/bindings/some_vhost/e/some_exchange/q/some_queue/name/some_pattern

So did you get everything working in the end? Or do you
still have some questions?

Matthias.

From simon at rabbitmq.com  Tue Oct 11 12:11:26 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 11 Oct 2011 12:11:26 +0100
Subject: [rabbitmq-discuss] HTTP Plugin?
In-Reply-To: <1318281226.81323.YahooMailNeo@web65709.mail.ac4.yahoo.com>
References: <1318281226.81323.YahooMailNeo@web65709.mail.ac4.yahoo.com>
Message-ID: <4E94245E.1010509@rabbitmq.com>

On 10/10/11 22:13, Marv Lush wrote:
> Hello all. I'm looking for the easiest way to push JSON messages to my
> broker from a shell script, without installing erlang on my producers.
> The most * convenient* way I can think of doing this is curl and HTTP.
>
> I looked at MochiWeb...but unless the documentation is incomplete...it
> doesn't seem to support something like:
>
> POST http://mybroker:1234/myRoutingKey
> {
> "key1":"value1",
> "key2":"value2"
> }

Well, Mochiweb is a general purpose web server, it doesn't do anything 
rabbit-y by itself.

> I also looked at JSONRPC, but that doesn't seem to do the trick either.
> Is there another plugin that would allow this? Preferably(but not
> required), one that would also allow me to consume from a queue by doing
> something like:
>
> GET http://mybroker:1234/queueName/consume
>
>
> Or something, like that...you get the idea...

The closest thing to what you're looking for is currently in the 
management plugin - see /api/exchanges/[vhost]/[name]/publish and 
/api/queues/[vhost]/[name]/get, documented at:

http://hg.rabbitmq.com/rabbitmq-management/raw-file/rabbitmq_v2_6_1/priv/www/api/index.html

If you want to publish from a shell script, the rabbitmqadmin tool that 
ships with mgmt should be more convenient than curl for talking to this API.

http://www.rabbitmq.com/management-cli.html

But bear in mind that this API doesn't make any attempt to deal with 
acking in either direction - if your HTTP connection is interrupted you 
could lose messages. I don't know if this is a big deal for you. If it 
is, I would write some little script with one of the Python or Ruby APIs 
to do the right thing over AMQP.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From andrea.rosa at hp.com  Tue Oct 11 12:15:25 2011
From: andrea.rosa at hp.com (Rosa, Andrea)
Date: Tue, 11 Oct 2011 11:15:25 +0000
Subject: [rabbitmq-discuss] Fairness wrt queues under heavy load
In-Reply-To: <4E941876.3090105@rabbitmq.com>
References: <CANVKUrWC=q6GipDRtWEiUOpL0yo_yjxVBzTOPU_C2kWkADfYUA@mail.gmail.com>
	<4E93F9B2.1060605@rabbitmq.com>
	<CANVKUrUsJteZxAzpD78EhimydEH_gu5bTjzS7j2V=TOSmg+t4A@mail.gmail.com>
	<4E941876.3090105@rabbitmq.com>
Message-ID: <5F389C517756284F80239F55BCA5DDDD069254@G9W0721.americas.hpqcorp.net>

Hi Matthias

> When you experience the delay for a high priority message, check
> whether
> the message is sitting in the queue. If it is then there is a problem
> at
> the consuming side, i.e. rabbit thinks there is no consumer ready to
> accept the message.

This is an interesting point for me. I experienced with delay and messages sitting in the queue
with 0 consumers but from the consumer side there are no errors so maybe rabbit thinks there is no consumer
ready...how is it possible?
Under which circumstances rabbit "can think" in this (wrong) way?
> 
> 
> Matthias.

--
Andrea

From matthias at rabbitmq.com  Tue Oct 11 12:22:00 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 11 Oct 2011 12:22:00 +0100
Subject: [rabbitmq-discuss] Fairness wrt queues under heavy load
In-Reply-To: <5F389C517756284F80239F55BCA5DDDD069254@G9W0721.americas.hpqcorp.net>
References: <CANVKUrWC=q6GipDRtWEiUOpL0yo_yjxVBzTOPU_C2kWkADfYUA@mail.gmail.com>	<4E93F9B2.1060605@rabbitmq.com>	<CANVKUrUsJteZxAzpD78EhimydEH_gu5bTjzS7j2V=TOSmg+t4A@mail.gmail.com>
	<4E941876.3090105@rabbitmq.com>
	<5F389C517756284F80239F55BCA5DDDD069254@G9W0721.americas.hpqcorp.net>
Message-ID: <4E9426D8.5090500@rabbitmq.com>

Andrea,

On 11/10/11 12:15, Rosa, Andrea wrote:
> This is an interesting point for me. I experienced with delay and
> messages sitting in the queue with 0 consumers but from the consumer
> side there are no errors so maybe rabbit thinks there is no consumer
> ready...how is it possible? Under which circumstances rabbit "can
> think" in this (wrong) way?

Rabbit is never wrong ;) If the management ui / rabbitmqctl show that a 
queue has no consumers then it really has no consumers.

It is possible that consumer programs may think they are still connected 
to rabbit when in fact their connection has been closed.

Check the rabbit logs for disconnect events, and list the connections 
with the management ui / rabbitmqctl and correlate that with any 
consumer programs you think you should be connected.


Matthias.

From matti.linnanvuori at portalify.com  Tue Oct 11 13:31:46 2011
From: matti.linnanvuori at portalify.com (Matti Linnanvuori)
Date: Tue, 11 Oct 2011 15:31:46 +0300
Subject: [rabbitmq-discuss] Session terminated, killing shell... ...killed.
Message-ID: <F9144FF9-2874-473A-BDFD-3442A6E5F930@portalify.com>

startup_err has only the following content:

Session terminated, killing shell... ...killed.

Any idea what went wrong? The RabbitMQ server has version 2.5.1 and is running in SUSE Linux Enterprise Server 11 SP1 High Availability Extension. From reading web search results, I think it may have been a timeout. Why does it take so long for RabbitMQ server to start?

Matti Linnanvuori


From matthew at rabbitmq.com  Tue Oct 11 13:43:10 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 11 Oct 2011 13:43:10 +0100
Subject: [rabbitmq-discuss] Session terminated,
 killing shell... ...killed.
In-Reply-To: <F9144FF9-2874-473A-BDFD-3442A6E5F930@portalify.com>
References: <F9144FF9-2874-473A-BDFD-3442A6E5F930@portalify.com>
Message-ID: <20111011124309.GA13229@rabbitmq.com>

On Tue, Oct 11, 2011 at 03:31:46PM +0300, Matti Linnanvuori wrote:
> startup_err has only the following content:
> 
> Session terminated, killing shell... ...killed.
> 
> Any idea what went wrong? The RabbitMQ server has version 2.5.1 and is running in SUSE Linux Enterprise Server 11 SP1 High Availability Extension. From reading web search results, I think it may have been a timeout. Why does it take so long for RabbitMQ server to start?

Recovering from a non-polite shutdown of RabbitMQ can take a long time.
We've recently fixed improved this which should make a bit of a
difference in the next release but there's still more work that could be
done in this regard. In short, if you have thousands of queues, or if
you have millions of messages on disk, then recovery from a kill of
Rabbit can take many minutes.

Matthew

From hedelson at vmware.com  Tue Oct 11 14:15:37 2011
From: hedelson at vmware.com (Helena Edelson)
Date: Tue, 11 Oct 2011 06:15:37 -0700
Subject: [rabbitmq-discuss] Query for Binding with similar topic routing
 keys returns all similar vs the one matching
In-Reply-To: <4E9422F4.2070007@rabbitmq.com>
References: <BDE140BF4C952041931EF8CAAC83341D026B6B8E83@exch-mbx-111.vmware.com>,
	<BDE140BF4C952041931EF8CAAC83341D026B6B8E85@exch-mbx-111.vmware.com>
	<BDE140BF4C952041931EF8CAAC83341D026B6B8E86@exch-mbx-111.vmware.com>,
	<4E9422F4.2070007@rabbitmq.com>
Message-ID: <BDE140BF4C952041931EF8CAAC83341D026B6B8E94@exch-mbx-111.vmware.com>

Hi Matthias,

I found the user of the # character in the pattern of the binding, given the number and type of binding patterns between queues and exchanges, consistently returns multiple results vs the * character which Rabbit can return a singular match. So I had to write a work around :-)

Thanks,
Helena
________________________________________
From: Matthias Radestock [matthias at rabbitmq.com]
Sent: Tuesday, October 11, 2011 7:05 AM
To: Helena Edelson
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Query for Binding with similar topic routing keys returns all similar vs the one matching

Helena,

On 08/10/11 17:34, Helena Edelson wrote:
> This works (below). My confusion was over the relationship between
> 'name' and 'props' in the sample
>
> /api/bindings/some_vhost/e/some_exchange/q/some_queue/name/some_pattern

So did you get everything working in the end? Or do you
still have some questions?

Matthias.

From adamrabung at gmail.com  Tue Oct 11 15:52:16 2011
From: adamrabung at gmail.com (Adam Rabung)
Date: Tue, 11 Oct 2011 10:52:16 -0400
Subject: [rabbitmq-discuss] Round-robin exchanges?
In-Reply-To: <4E93DFFA.5080004@rabbitmq.com>
References: <CAAN_EDocROkkNTR3RjzBVSeMUfUuaHOtJYjR-B6DCsv=o5Rkaw@mail.gmail.com>
	<4E93DFFA.5080004@rabbitmq.com>
Message-ID: <CAAN_EDqxqM2cEGZZJWF_w4vqEusG1jQcBurXzoHTTOLfJFD+8g@mail.gmail.com>

That was the big thing I was missing - channels can be subscribed to more
than one queue!  Thank you so much, that was a nice breakthrough.
Adam

On Tue, Oct 11, 2011 at 2:19 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Adam,
>
>
> On 11/10/11 02:48, Adam Rabung wrote:
>
>> Hello,
>> I am trying to implement a work queue in RabbitMQ.  I have several
>> machines that will act as worker pools for consuming my queues.  I would
>> like each job to be processed only once.  Some jobs
>> have environmental requirements, ie must be executed on a machine with
>> an SSD.  Not all worker pools will meet these requirements.  A first
>> approach would be to have a queue for every permutation of requirements:
>> "No Requirements", "Requires SSD", "Requires Certificate", etc and have
>> each worker pool subscribe to all queues which it can handle.
>>
>
> That is a sound approach.
>
>
>  A majority of the jobs will have no requirements, so many worker pools
>> will be underutilized.
>>
>
> As you say, the worker pools would subscribe to all the queues with
> combinations of requirements they can handle. That includes the "No
> Requirements" queue. The subscriptions can be active *simultaneously*, so
> work in the "No Requirements" queue would be round-robin routed to all
> workers, jobs in the "Require SSD" queue will be routed to all workers that
> have SSDs, etc.
>
> If each worker uses a single channel with a basic.qos prefetch setting of 1
> and subscribes to all the relevant queues on that channel, it will be fed
> work items one at a time from the subset of all these queues that have
> messages in them. There's some logic at the server that ensures this is
> reasonably fair, though you will most likely find that queues which can be
> handled by many workers drain faster than others.
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111011/22e1fc5c/attachment.htm>

From marv_lush at yahoo.com  Tue Oct 11 16:10:41 2011
From: marv_lush at yahoo.com (Marv Lush)
Date: Tue, 11 Oct 2011 08:10:41 -0700 (PDT)
Subject: [rabbitmq-discuss] HTTP Plugin?
Message-ID: <1318345841.90670.YahooMailMobile@web65710.mail.ac4.yahoo.com>

 Ahhh, thanks. RabbitMQAdmin seems to be the right thing in my case.

Cheers, 
/m
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111011/bdcd90f4/attachment.htm>

From james.r.carr at gmail.com  Tue Oct 11 17:51:45 2011
From: james.r.carr at gmail.com (James Carr)
Date: Tue, 11 Oct 2011 11:51:45 -0500
Subject: [rabbitmq-discuss] Shovel Plugin For HA
Message-ID: <CAJreXKDwNDT-LfMKhZJVikmTsjgY9d19gSsq3T8K-f_-TgjZ+g@mail.gmail.com>

Hi All,

During my investigations for designing a completely fail safe messaging
scenario the ideal option was to have local brokers that shovel to a central
broker. That way if the central brokers ever went down messages would just
be queued locally for delivery later.

I finally got around to using the shovel plugin and while it had everything
I was looking for, there were some drawbacks (for me at least).  It seems
that whenever I want to create a queue that gets pushed to an exchange on
another server I have to edit the rabbitmq.config for this and then restart
the service. I'm just curious if there is a softer way to handle this that
allows for more dynamic forwarding (one feature I always liked about AMQP is
that client apps can define exchanges and queues rather than having an admin
set them up).


I'm also open to other possibilities for HA that handle when the main broker
cluster goes offline or is unreachable. :)

Thanks,
James
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111011/e1ff03fc/attachment.htm>

From paulcarlisle at comcast.net  Tue Oct 11 22:24:15 2011
From: paulcarlisle at comcast.net (SixDegrees)
Date: Tue, 11 Oct 2011 14:24:15 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ Completely Unusable
In-Reply-To: <4E9305B6.3030408@rabbitmq.com>
References: <32619934.post@talk.nabble.com> <4E9305B6.3030408@rabbitmq.com>
Message-ID: <32631973.post@talk.nabble.com>


Thanks. This got me up and running again.


Emile Joubert-2 wrote:
> 
> Hi Paul,
> 
> On 09/10/11 19:28, SixDegrees wrote:
>> 
>> I had Celery/RabbitMQ running perfectly on Friday. After a reboot, none
>> of
>> the rabbitmqctl commands work; they all return the message:
>> 
>> Status of node rabbit at basalt ...
>> Error: unable to connect to node rabbit at basalt: nodedown
>> diagnostics:
>> - nodes and their ports on basalt: [{rabbitmqctl4119,39973}]
>> - current node: rabbitmqctl4119 at basalt
>> - current node home dir: /var/lib/rabbitmq
>> - current node cookie hash: 21qdNRGvqYUEWK3+aXB7wA==
> 
> Are you sure the broker is running at the time when you execute
> rabbitmqctl? Are there any entries in the broker logfile at the same
> time as these messages get logged?
> 
> The broker startup banner contains the cookie hash. Is this the same as
> the one reported by rabbitmqctl?
> 
>> The port and nodename suffix are different each time, and the cookie hash
>> does not correspond to the one in /var/lib/rabbitmq/.erlang.cookie, nor
>> can
>> I find any other instance of the cookie file on the machine. Hostname
>> 'basalt' is listed in /etc/hosts under '127.0.0.1  basalt'; this has not
>> been changed since Friday.
>> 
>> I have tried starting rabbitmq-server at runtime as a service; and at the
>> command line with no arguments and with the '-detached' argument, all
>> with
>> similar results.
>> 
>> What do I have to do to recover my previously working system? Failing
>> that,
>> what do I have to delete to get RabbitMQ back to a working, uninitialized
>> state?
> 
> If you move or remove the contents of the mnesia directory then rabbit
> will startup in a default state.
> 
> 
> 
> -Emile
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://old.nabble.com/RabbitMQ-Completely-Unusable-tp32619934p32631973.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From paulcarlisle at comcast.net  Tue Oct 11 22:28:55 2011
From: paulcarlisle at comcast.net (SixDegrees)
Date: Tue, 11 Oct 2011 14:28:55 -0700 (PDT)
Subject: [rabbitmq-discuss]  Hands-Free Configuration
Message-ID: <32631974.post@talk.nabble.com>


All of the examples I've seen for using RabbitMQ show the vhost, user and
permissions being set using rabbitmqctl at the command line. I'm not clear
on whether these setting persist across machine reboots or service restarts;
they don't seems to, although its possible I managed to muck something else
up while checking.

In any case, is it possible to configure these settings and any others
needed by way of a configuration file that would be read when RabbitMQ is
started? We will ultimately be clustering several machines, and resetting
all of these by hand each time something cycles is not going to work well in
a production environment.

-- 
View this message in context: http://old.nabble.com/Hands-Free-Configuration-tp32631974p32631974.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From james.r.carr at gmail.com  Wed Oct 12 03:02:56 2011
From: james.r.carr at gmail.com (James Carr)
Date: Tue, 11 Oct 2011 22:02:56 -0400
Subject: [rabbitmq-discuss] Hands-Free Configuration
In-Reply-To: <32631974.post@talk.nabble.com>
References: <32631974.post@talk.nabble.com>
Message-ID: <CAJreXKDo0xd14jogit_8zfxHQU3ue6w3fQM9eq-um=Tw3VQ9cQ@mail.gmail.com>

yes. Take a look at the documentation for rabbitmq.config.

You can configure anything there afaik. I even declare queues and
exchanges in it.

On Tue, Oct 11, 2011 at 5:28 PM, SixDegrees <paulcarlisle at comcast.net> wrote:
>
> All of the examples I've seen for using RabbitMQ show the vhost, user and
> permissions being set using rabbitmqctl at the command line. I'm not clear
> on whether these setting persist across machine reboots or service restarts;
> they don't seems to, although its possible I managed to muck something else
> up while checking.
>
> In any case, is it possible to configure these settings and any others
> needed by way of a configuration file that would be read when RabbitMQ is
> started? We will ultimately be clustering several machines, and resetting
> all of these by hand each time something cycles is not going to work well in
> a production environment.
>
> --
> View this message in context: http://old.nabble.com/Hands-Free-Configuration-tp32631974p32631974.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From ekirpichov at gmail.com  Wed Oct 12 06:19:33 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Wed, 12 Oct 2011 09:19:33 +0400
Subject: [rabbitmq-discuss] Fairness wrt queues under heavy load
In-Reply-To: <4E941876.3090105@rabbitmq.com>
References: <CANVKUrWC=q6GipDRtWEiUOpL0yo_yjxVBzTOPU_C2kWkADfYUA@mail.gmail.com>
	<4E93F9B2.1060605@rabbitmq.com>
	<CANVKUrUsJteZxAzpD78EhimydEH_gu5bTjzS7j2V=TOSmg+t4A@mail.gmail.com>
	<4E941876.3090105@rabbitmq.com>
Message-ID: <CANVKUrU=358iaydYmNE+HSWQkeuyxwx7PXcY7dQ12HxMxpDn_Q@mail.gmail.com>

Hello,

I have some more information to share.

* The messages taking long to deliver are sitting in the queues
("ready"), according to the management interface.
* I looked in the logs for the scenario where my "high-priority"
messages were taking ages to deliver. There was absolutely nothing
suspicious; not a single warning report.
* I replaced usage of transactions with a simple
WaitForConfirmsOrDie() call after publishing the message. This didn't
change anything, the message was still taking ages to deliver, and
still nothing in the logs.
* However, moving the queues for high-priority messages to a different
server solved the problem immediately. So the problem is *not* in my
consumers or producers of these messages - it's probably really in
rabbit.
* To add information about producers/consumers - producers shared a
connection (though not a channel) with the activity of publishing a
lot of other messages; the consumer only listened to the high-priority
messages.

On Tue, Oct 11, 2011 at 2:20 PM, Matthias Radestock
<matthias at rabbitmq.com> wrote:
> On 11/10/11 10:47, Eugene Kirpichov wrote:
>>
>> On Tue, Oct 11, 2011 at 12:09 PM, Matthias Radestock
>> <matthias at rabbitmq.com> ?wrote:
>>>
>>> If the publishing rate exceeds the rabbit capacity, the broker will
>>> eventually hit its memory threshold and throttle producers. The logs will
>>> tell you when that happens. Memory pressure can take a while to
>>> dissipate,
>>> sometimes several minutes. The cure for this is to set up a bigger
>>> rabbit.
>>
>> This could be the case, actually, though I'm limiting the number of
>> unconfirmed publishes on each queue, but I don't limit it on a global
>> level. Thanks, I'll look at the logs.
>>
>> What somewhat disproves this is that this *only* happens with
>> transactional messages (establish channel, start transaction, publish
>> message, commit, close channel - though the connection may be shared).
>
> Hmm. It should be quite difficult to hit the memory limit when publishing in
> tx or confirm mode and committing/waiting after every message.
>
> Anyway, check the logs for memory alarms.
>
> Also, you should avoid sharing connections between producers and consumers.
> Otherwise the throttling of producers will also starve consumers.
>
>>> Messages pile up in queues when consumers don't consume them fast enough.
>>> Since queues are FIFO structures that manifests itself as a delay. To
>>> avoid
>>> this delay for high priority messages, make sure they get routed to a
>>> separate queue and code consumers s.t. they consume from that queue in
>>> addition to the regular queues.
>>
>> I am routing to a separate queue already.
>
> When you experience the delay for a high priority message, check whether the
> message is sitting in the queue. If it is then there is a problem at the
> consuming side, i.e. rabbit thinks there is no consumer ready to accept the
> message.
>
>
> Matthias.
>



-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/

From matthias at rabbitmq.com  Wed Oct 12 06:51:40 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 12 Oct 2011 06:51:40 +0100
Subject: [rabbitmq-discuss] Fairness wrt queues under heavy load
In-Reply-To: <CANVKUrU=358iaydYmNE+HSWQkeuyxwx7PXcY7dQ12HxMxpDn_Q@mail.gmail.com>
References: <CANVKUrWC=q6GipDRtWEiUOpL0yo_yjxVBzTOPU_C2kWkADfYUA@mail.gmail.com>	<4E93F9B2.1060605@rabbitmq.com>	<CANVKUrUsJteZxAzpD78EhimydEH_gu5bTjzS7j2V=TOSmg+t4A@mail.gmail.com>	<4E941876.3090105@rabbitmq.com>
	<CANVKUrU=358iaydYmNE+HSWQkeuyxwx7PXcY7dQ12HxMxpDn_Q@mail.gmail.com>
Message-ID: <4E952AEC.20002@rabbitmq.com>

Eugene,

On 12/10/11 06:19, Eugene Kirpichov wrote:
> * The messages taking long to deliver are sitting in the queues
> ("ready"), according to the management interface.

Hmm. The plot thickens. When the broker is in that state, please run 
'rabbitmqctl report' and send us the output.

HOWEVER, going back through the emails I notice that I never asked what 
version you are running. So before you do the above please make sure you 
are running the latest and greatest - 2.6.1 at this point in time.

Regards,

Matthias.

From ekirpichov at gmail.com  Wed Oct 12 06:52:54 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Wed, 12 Oct 2011 09:52:54 +0400
Subject: [rabbitmq-discuss] Fairness wrt queues under heavy load
In-Reply-To: <4E952AEC.20002@rabbitmq.com>
References: <CANVKUrWC=q6GipDRtWEiUOpL0yo_yjxVBzTOPU_C2kWkADfYUA@mail.gmail.com>
	<4E93F9B2.1060605@rabbitmq.com>
	<CANVKUrUsJteZxAzpD78EhimydEH_gu5bTjzS7j2V=TOSmg+t4A@mail.gmail.com>
	<4E941876.3090105@rabbitmq.com>
	<CANVKUrU=358iaydYmNE+HSWQkeuyxwx7PXcY7dQ12HxMxpDn_Q@mail.gmail.com>
	<4E952AEC.20002@rabbitmq.com>
Message-ID: <CANVKUrUGGVjfZUp4jRB0DKp5HcvD26H=RE02m3rYd3fxYuiteQ@mail.gmail.com>

Yes, I'm running 2.6.1.

Thanks, I'll get the rabbitmqctl report and send it here.

On Wed, Oct 12, 2011 at 9:51 AM, Matthias Radestock
<matthias at rabbitmq.com> wrote:
> Eugene,
>
> On 12/10/11 06:19, Eugene Kirpichov wrote:
>>
>> * The messages taking long to deliver are sitting in the queues
>> ("ready"), according to the management interface.
>
> Hmm. The plot thickens. When the broker is in that state, please run
> 'rabbitmqctl report' and send us the output.
>
> HOWEVER, going back through the emails I notice that I never asked what
> version you are running. So before you do the above please make sure you are
> running the latest and greatest - 2.6.1 at this point in time.
>
> Regards,
>
> Matthias.
>



-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/

From ekirpichov at gmail.com  Wed Oct 12 06:53:24 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Wed, 12 Oct 2011 09:53:24 +0400
Subject: [rabbitmq-discuss] Fairness wrt queues under heavy load
In-Reply-To: <CANVKUrUGGVjfZUp4jRB0DKp5HcvD26H=RE02m3rYd3fxYuiteQ@mail.gmail.com>
References: <CANVKUrWC=q6GipDRtWEiUOpL0yo_yjxVBzTOPU_C2kWkADfYUA@mail.gmail.com>
	<4E93F9B2.1060605@rabbitmq.com>
	<CANVKUrUsJteZxAzpD78EhimydEH_gu5bTjzS7j2V=TOSmg+t4A@mail.gmail.com>
	<4E941876.3090105@rabbitmq.com>
	<CANVKUrU=358iaydYmNE+HSWQkeuyxwx7PXcY7dQ12HxMxpDn_Q@mail.gmail.com>
	<4E952AEC.20002@rabbitmq.com>
	<CANVKUrUGGVjfZUp4jRB0DKp5HcvD26H=RE02m3rYd3fxYuiteQ@mail.gmail.com>
Message-ID: <CANVKUrVBFSy35Pj26KdsNhjhM+ZAgMX47m57AvS25QZawYOH1g@mail.gmail.com>

...And, it's 2.6.1 on Windows Server 2008 R2 x64 (though on a 32-bit
Erlang of course, since there's no 64-bit Erlang for Windows).

On Wed, Oct 12, 2011 at 9:52 AM, Eugene Kirpichov <ekirpichov at gmail.com> wrote:
> Yes, I'm running 2.6.1.
>
> Thanks, I'll get the rabbitmqctl report and send it here.
>
> On Wed, Oct 12, 2011 at 9:51 AM, Matthias Radestock
> <matthias at rabbitmq.com> wrote:
>> Eugene,
>>
>> On 12/10/11 06:19, Eugene Kirpichov wrote:
>>>
>>> * The messages taking long to deliver are sitting in the queues
>>> ("ready"), according to the management interface.
>>
>> Hmm. The plot thickens. When the broker is in that state, please run
>> 'rabbitmqctl report' and send us the output.
>>
>> HOWEVER, going back through the emails I notice that I never asked what
>> version you are running. So before you do the above please make sure you are
>> running the latest and greatest - 2.6.1 at this point in time.
>>
>> Regards,
>>
>> Matthias.
>>
>
>
>
> --
> Eugene Kirpichov
> Principal Engineer, Mirantis Inc. http://www.mirantis.com/
> Editor, http://fprog.ru/
>



-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/

From matthias at rabbitmq.com  Wed Oct 12 06:58:30 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 12 Oct 2011 06:58:30 +0100
Subject: [rabbitmq-discuss] Fairness wrt queues under heavy load
In-Reply-To: <CANVKUrVBFSy35Pj26KdsNhjhM+ZAgMX47m57AvS25QZawYOH1g@mail.gmail.com>
References: <CANVKUrWC=q6GipDRtWEiUOpL0yo_yjxVBzTOPU_C2kWkADfYUA@mail.gmail.com>	<4E93F9B2.1060605@rabbitmq.com>	<CANVKUrUsJteZxAzpD78EhimydEH_gu5bTjzS7j2V=TOSmg+t4A@mail.gmail.com>	<4E941876.3090105@rabbitmq.com>	<CANVKUrU=358iaydYmNE+HSWQkeuyxwx7PXcY7dQ12HxMxpDn_Q@mail.gmail.com>	<4E952AEC.20002@rabbitmq.com>	<CANVKUrUGGVjfZUp4jRB0DKp5HcvD26H=RE02m3rYd3fxYuiteQ@mail.gmail.com>
	<CANVKUrVBFSy35Pj26KdsNhjhM+ZAgMX47m57AvS25QZawYOH1g@mail.gmail.com>
Message-ID: <4E952C86.2060109@rabbitmq.com>

Eugene,

On 12/10/11 06:53, Eugene Kirpichov wrote:
> ...And, it's 2.6.1 on Windows Server 2008 R2 x64 (though on a 32-bit
> Erlang of course, since there's no 64-bit Erlang for Windows).

That should be fine.

Btw, please also include the rabbit.log and rabbit-sasl.log going back 
to the last server restart.

If the report + logs turn out to be rather long, feel free to send them 
off-list to info at rabbitmq.com. Thanks.

Matthias.

From paulcarlisle at comcast.net  Wed Oct 12 08:16:23 2011
From: paulcarlisle at comcast.net (SixDegrees)
Date: Wed, 12 Oct 2011 00:16:23 -0700 (PDT)
Subject: [rabbitmq-discuss] Hands-Free Configuration
In-Reply-To: <CAJreXKDo0xd14jogit_8zfxHQU3ue6w3fQM9eq-um=Tw3VQ9cQ@mail.gmail.com>
References: <32631974.post@talk.nabble.com>
	<CAJreXKDo0xd14jogit_8zfxHQU3ue6w3fQM9eq-um=Tw3VQ9cQ@mail.gmail.com>
Message-ID: <32636426.post@talk.nabble.com>


OK. I had already read through that documentation, and I didn't see anything
about configuring users or vhosts, but I'll look again.


James Carr wrote:
> 
> yes. Take a look at the documentation for rabbitmq.config.
> 
> You can configure anything there afaik. I even declare queues and
> exchanges in it.
> 
> On Tue, Oct 11, 2011 at 5:28 PM, SixDegrees <paulcarlisle at comcast.net>
> wrote:
>>
>> All of the examples I've seen for using RabbitMQ show the vhost, user and
>> permissions being set using rabbitmqctl at the command line. I'm not
>> clear
>> on whether these setting persist across machine reboots or service
>> restarts;
>> they don't seems to, although its possible I managed to muck something
>> else
>> up while checking.
>>
>> In any case, is it possible to configure these settings and any others
>> needed by way of a configuration file that would be read when RabbitMQ is
>> started? We will ultimately be clustering several machines, and resetting
>> all of these by hand each time something cycles is not going to work well
>> in
>> a production environment.
>>
>> --
>> View this message in context:
>> http://old.nabble.com/Hands-Free-Configuration-tp32631974p32631974.html
>> Sent from the RabbitMQ mailing list archive at Nabble.com.
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://old.nabble.com/Hands-Free-Configuration-tp32631974p32636426.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From andrea.rosa at hp.com  Wed Oct 12 08:56:18 2011
From: andrea.rosa at hp.com (Rosa, Andrea)
Date: Wed, 12 Oct 2011 07:56:18 +0000
Subject: [rabbitmq-discuss] Hands-Free Configuration
In-Reply-To: <32631974.post@talk.nabble.com>
References: <32631974.post@talk.nabble.com>
Message-ID: <5F389C517756284F80239F55BCA5DDDD06C454@G9W0721.americas.hpqcorp.net>

Hi

> -----Original Message-----
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-
> discuss-bounces at lists.rabbitmq.com] On Behalf Of SixDegrees
> Sent: 11 October 2011 22:29
> To: rabbitmq-discuss at lists.rabbitmq.com
> Subject: [rabbitmq-discuss] Hands-Free Configuration
> 
> 
> All of the examples I've seen for using RabbitMQ show the vhost, user
> and
> permissions being set using rabbitmqctl at the command line. I'm not
> clear
> on whether these setting persist across machine reboots or service
> restarts;
> they don't seems to, although its possible I managed to muck something
> else
> up while checking.
> 

In my experience vhost, user and permission settings persist across reboot and service restars as well.
Cheers
--
Andrea

From simon at rabbitmq.com  Wed Oct 12 10:37:36 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 12 Oct 2011 10:37:36 +0100
Subject: [rabbitmq-discuss] Hands-Free Configuration
In-Reply-To: <32631974.post@talk.nabble.com>
References: <32631974.post@talk.nabble.com>
Message-ID: <4E955FE0.8020502@rabbitmq.com>

On 11/10/11 22:28, SixDegrees wrote:
> All of the examples I've seen for using RabbitMQ show the vhost, user and
> permissions being set using rabbitmqctl at the command line. I'm not clear
> on whether these setting persist across machine reboots or service restarts;
> they don't seems to, although its possible I managed to muck something else
> up while checking.

They really *really* should; if these are going away something is badly 
wrong. From your previous message ("RabbitMQ completely unusable") I 
wonder if something is blowing away the Mnesia directory or something. 
How did you install Rabbit? Have you relocated anything?

> In any case, is it possible to configure these settings and any others
> needed by way of a configuration file that would be read when RabbitMQ is
> started?

No. We've wondered about adding such a feature but it's not obvious what 
the use case is, given that you should just be able to set things up how 
you want them and leave it.

> We will ultimately be clustering several machines, and resetting
> all of these by hand each time something cycles is not going to work well in
> a production environment.

Absolutely.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From milan.tarantelli at morpho.com  Wed Oct 12 11:11:08 2011
From: milan.tarantelli at morpho.com (TARANTELLI Milan (MORPHO))
Date: Wed, 12 Oct 2011 12:11:08 +0200
Subject: [rabbitmq-discuss] SHOVEL PLUGIN + RABBITMQ ACTIVE-ACTIVE ACCROSS A
	WAN
Message-ID: <5771CC721874D84ABB21F48859D38BEE1010BAA227@Y000IQGV01.rd1.rf1>

Hello,

I need to implement an ACTIVE/ACTIVE system based on Messaging that is able to survive to network failures over a WAN.

The idea is to use RabbitMQ locally (at data center level) looking for a framework to load balance messages to every sites (data centers) that are geo-delocalized across a WAN (200km and more distant) and to automatically manage failovers and group memberships.

I supposed initially to use the last version of RabbitMQ that supports mirrored queues but I've been noticed that this solution is really aimed at providing HA within the same data-center where network splits are rarer and latencies are lower.

Finally I've been noticed of Shovel plug-in, a RabbitMQ plug-in that seems to be able to manage load balancing with RabbitMQ across a WAN.
This solution seems to be the answer to all my questions. Is there something I am missing? So the question is:

Is message acknowledge/delivery guaranteed using Shovel and RabbitMQ across a WAN where we can face network disconnection issues?

Many thanks,

Milan

#
" Ce courriel et les documents qui lui sont joints peuvent contenir des informations confidentielles ou ayant un caract?re priv?. S'ils ne vous sont pas destin?s, nous vous signalons qu'il est strictement interdit de les divulguer, de les reproduire ou d'en utiliser de quelque mani?re que ce soit le contenu. Si ce message vous a ?t? transmis par erreur, merci d'en informer l'exp?diteur et de supprimer imm?diatement de votre syst?me informatique ce courriel ainsi que tous les documents qui y sont attach?s."
******
" This e-mail and any attached documents may contain confidential or proprietary information. If you are not the intended recipient, you are notified that any dissemination, copying of this e-mail and any attachments thereto or use of their contents by any means whatsoever is strictly prohibited. If you have received this e-mail in error, please advise the sender immediately and delete this e-mail and all attached documents from your computer system."
#

From matthias at rabbitmq.com  Wed Oct 12 12:21:49 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 12 Oct 2011 12:21:49 +0100
Subject: [rabbitmq-discuss] Query for Binding with similar topic routing
 keys returns all similar vs the one matching
In-Reply-To: <BDE140BF4C952041931EF8CAAC83341D026B6B8E94@exch-mbx-111.vmware.com>
References: <BDE140BF4C952041931EF8CAAC83341D026B6B8E83@exch-mbx-111.vmware.com>,
	<BDE140BF4C952041931EF8CAAC83341D026B6B8E85@exch-mbx-111.vmware.com>
	<BDE140BF4C952041931EF8CAAC83341D026B6B8E86@exch-mbx-111.vmware.com>,
	<4E9422F4.2070007@rabbitmq.com>
	<BDE140BF4C952041931EF8CAAC83341D026B6B8E94@exch-mbx-111.vmware.com>
Message-ID: <4E95784D.6020508@rabbitmq.com>

Helena,

On 11/10/11 14:15, Helena Edelson wrote:
> I found the user of the # character in the pattern of the binding,
> given the number and type of binding patterns between queues and
> exchanges, consistently returns multiple results vs the * character
> which Rabbit can return a singular match. So I had to write a work
> around :-)

So do you think there is something broken there in rabbit? Or perhaps 
less obvious than it could be? If so, an example of the form "I tried X 
and was expecting to see Y but instead got Z" would help to shed light 
on the problem.

Matthias.

From sathishkumar64 at gmail.com  Wed Oct 12 14:27:39 2011
From: sathishkumar64 at gmail.com (sathish kumar)
Date: Wed, 12 Oct 2011 18:57:39 +0530
Subject: [rabbitmq-discuss] Regarding SMTP Configuration
Message-ID: <CAAaRZaUhb9sCWzhypE8e+c7dK7vZSWSWzx2pm9UXXmaCbKKvVQ@mail.gmail.com>

Hi Team,

  This is SathishKumar from India. I'm working in top mnc, We are trying to
rabbitmq application. I done the installation and ran the some samples also.
But i'm trying to integrated with mail service. so i added rabbitmq-smtp.ez
and rabbitmq-erlang.ez plugins, after that i cant process that feature. so
can you give me some support for this. like smtp configuration with
"rabbitmq.config" file and some examples via spring.Please can you reply me
as soon as possible.




-- 
Sathish Kumar.V +91 95007 88165
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111012/ca03d4cc/attachment.htm>

From hedelson at vmware.com  Wed Oct 12 15:48:16 2011
From: hedelson at vmware.com (Helena Edelson)
Date: Wed, 12 Oct 2011 07:48:16 -0700
Subject: [rabbitmq-discuss] Query for Binding with similar topic routing
 keys returns all similar vs the one matching
In-Reply-To: <4E95784D.6020508@rabbitmq.com>
References: <BDE140BF4C952041931EF8CAAC83341D026B6B8E83@exch-mbx-111.vmware.com>,
	<BDE140BF4C952041931EF8CAAC83341D026B6B8E85@exch-mbx-111.vmware.com>
	<BDE140BF4C952041931EF8CAAC83341D026B6B8E86@exch-mbx-111.vmware.com>,
	<4E9422F4.2070007@rabbitmq.com>
	<BDE140BF4C952041931EF8CAAC83341D026B6B8E94@exch-mbx-111.vmware.com>,
	<4E95784D.6020508@rabbitmq.com>
Message-ID: <BDE140BF4C952041931EF8CAAC83341D026B6B8E9F@exch-mbx-111.vmware.com>

Matthias,

Given the following precondition:
Bindings exist that routing keys such as #.foo.bar and *.foo.bar would match.
Where objOption is the Option returned from GET /api/bindings/vhost/e/exchange/q/queue/routingKey  which unfortunately is either a binding or an array of bindings matching the #etc pattern

Case 1: If I pass in binding pattern #.foo.bar, I get an array of Bindings
Case 2: If I pass in binding pattern *.foo.bar, I consistently get a single matching Binding

Here is what I am doing, in scala, where I want to extract one binding given one pattern (routing key).

if (objOption.isDefined) objOption.get match {
   
   case bindings: Array[Binding] => for { b <- bindings if b.getRoutingKey == pattern } binding = b

   case b: Binding => binding = objOption.get.asInstanceOf[Binding] 
}
 

Helena
________________________________________
From: Matthias Radestock [matthias at rabbitmq.com]
Sent: Wednesday, October 12, 2011 7:21 AM
To: Helena Edelson
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Query for Binding with similar topic routing keys returns all similar vs the one matching

Helena,

On 11/10/11 14:15, Helena Edelson wrote:
> I found the user of the # character in the pattern of the binding,
> given the number and type of binding patterns between queues and
> exchanges, consistently returns multiple results vs the * character
> which Rabbit can return a singular match. So I had to write a work
> around :-)

So do you think there is something broken there in rabbit? Or perhaps
less obvious than it could be? If so, an example of the form "I tried X
and was expecting to see Y but instead got Z" would help to shed light
on the problem.

Matthias.

From videlalvaro at gmail.com  Wed Oct 12 16:59:13 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 12 Oct 2011 17:59:13 +0200
Subject: [rabbitmq-discuss] Bitcask Message Store Index
Message-ID: <7667EFC7-3277-46B5-B29F-21317A694C53@gmail.com>

Hi,

I've implemented an experimental plugin providing a message store index using Basho's Bitcask.

More details here: https://github.com/videlalvaro/msg_store_bitcask_index

Here you can find more details about Bitcask implementation and motivation: http://downloads.basho.com/papers/bitcask-intro.pdf

I have a question for the RabbitMQ devs? how  could I run rabbit's test suite to include this plugin instead of the default msg_store_index?

Please share your thoughts and feedback. 

Cheers,

Alvaro

From simon at rabbitmq.com  Wed Oct 12 18:22:04 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 12 Oct 2011 18:22:04 +0100
Subject: [rabbitmq-discuss] Regarding SMTP Configuration
In-Reply-To: <CAAaRZaUhb9sCWzhypE8e+c7dK7vZSWSWzx2pm9UXXmaCbKKvVQ@mail.gmail.com>
References: <CAAaRZaUhb9sCWzhypE8e+c7dK7vZSWSWzx2pm9UXXmaCbKKvVQ@mail.gmail.com>
Message-ID: <4E95CCBC.6080502@rabbitmq.com>

On 12/10/11 14:27, sathish kumar wrote:
>    This is SathishKumar from India. I'm working in top mnc, We are
> trying to rabbitmq application. I done the installation and ran the some
> samples also. But i'm trying to integrated with mail service. so i added
> rabbitmq-smtp.ez and rabbitmq-erlang.ez plugins, after that i cant
> process that feature. so can you give me some support for this. like
> smtp configuration with "rabbitmq.config" file and some examples via
> spring.Please can you reply me as soon as possible.

Hi Sathish.

We stopped releasing rabbitmq-smtp some time ago as it didn't seem like 
anyone was using it and its original author had moved on. so I'm not 
sure it works at all.

If there's interest from the community in an SMTP gateway then I guess 
we could revive it - is that the sort of thing people would find 
interesting?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From baldgoth at gmail.com  Wed Oct 12 20:29:42 2011
From: baldgoth at gmail.com (TrueWill)
Date: Wed, 12 Oct 2011 12:29:42 -0700 (PDT)
Subject: [rabbitmq-discuss] IModel thread safety in.NET client
Message-ID: <65584f48-a6ac-48ea-b433-312b5a06bf3c@j34g2000prb.googlegroups.com>

The .NET client user guide (v2.6.1) states that IModel should not be
shared between threads.

Apparently BasicAck must be called on the same channel on which the
message was received.

When asynchronously consuming messages with IBasicConsumer, is it safe
to call BasicAck on the original channel (created on the application
thread) in the handler without locking?

I'm assuming that the handler runs on the connection thread.

I realize that publish should not be called in the handler. If publish
can be called by the application thread, should that be done on a
separate channel from the consuming one?

(There's a similar question on the Java client here:
http://groups.google.com/group/rabbitmq-discuss/browse_thread/thread/6a0b05b598f308cf/cbbd7a0c9f9b4dd3?lnk=gst&q=channel+thread+ack#cbbd7a0c9f9b4dd3)

From michael.s.klishin at gmail.com  Wed Oct 12 22:28:27 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 13 Oct 2011 01:28:27 +0400
Subject: [rabbitmq-discuss] [announcement] amqp gem 0.8.1 is released
Message-ID: <CAE3HoVTdbNuWKO=OJA0ZuuzYK=ebdEPEsx5MU2LesG9-Ro5YFw@mail.gmail.com>

amqp gem 0.8.1 is released to rubygems.org. This is a bug fix release:

* AMQP::Queue#status can no longer modify queue instance state. This
eliminates potential unexpected side effects during automatic recovery.


https://rubygems.org/gems/amqp/versions/0.8.1
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111013/e5bbacd7/attachment.htm>

From matthew at rabbitmq.com  Wed Oct 12 23:32:36 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 12 Oct 2011 23:32:36 +0100
Subject: [rabbitmq-discuss] Bitcask Message Store Index
In-Reply-To: <7667EFC7-3277-46B5-B29F-21317A694C53@gmail.com>
References: <7667EFC7-3277-46B5-B29F-21317A694C53@gmail.com>
Message-ID: <20111012223235.GA4258@wellquite.org>

Hi Alvaro,

On Wed, Oct 12, 2011 at 05:59:13PM +0200, Alvaro Videla wrote:
> I've implemented an experimental plugin providing a message store index using Basho's Bitcask.
> More details here: https://github.com/videlalvaro/msg_store_bitcask_index
> 
> Here you can find more details about Bitcask implementation and motivation: http://downloads.basho.com/papers/bitcask-intro.pdf

Huh, that's interesting. I'm curious though - how do the properties of
your implementation differ from our default? - I'm not trying to
discourage you at all, just curious. Even if it's just for gaining
understanding and experience of implementing Rabbit's internal APIs,
it's still valuable.

> I have a question for the RabbitMQ devs? how  could I run rabbit's
> test suite to include this plugin instead of the default
> msg_store_index?

Simplest way is to set the msg_store_index_module param in your
rabbitmq.config file - check the rabbit.app to see how it's set, but
there's nothing unusual there. Also check rabbitmq-toke which
(re-)implements the same interface and probably changes the env slightly
differently... ;)

Matthew

From pdezwart at rubiconproject.com  Thu Oct 13 01:51:00 2011
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Wed, 12 Oct 2011 19:51:00 -0500
Subject: [rabbitmq-discuss] Debugging queue.declare
Message-ID: <CABB835F.24AA4%pdezwart@rubiconproject.com>

I am trying to add support for queue.declare arguments in the PHP PECL extension. I have managed to get it to work for x-ha-policy, but x-expires is stumping me. When I try to declare a brand new queue with the x-ha-policy, it works: command returns success and I see the queue in the rabbitmqctl list_queues listing:

!dude002:~/src/pecl/amqp/trunk$ sudo /usr/sbin/rabbitmqctl list_queues name arguments
queue1318463573   [{"x-ha-policy",<<"all">>}]

However, if I replace x-ha-policy with x-expires in the arguments declaration, the queue declaration succeeds (function response is AMQP_RESPONSE_NORMAL) but the queue does not show up in the broker queue listing. The rabbitmq logs show nothing? well, they show that I connected and then disconnected. Nothing else of interest. I don?t know if this is because I am doing something wrong with passing arguments with int values instead of strings (debugging shows the appropriate struct values, but I could be missing something) or because I am doing some other random thing wrong.

How can I debug this behavior? Must I use the Java tools listed here: http://www.rabbitmq.com/examples.html#tracer

Thanks,
Pieter
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111012/5b681aab/attachment.htm>

From michael.s.klishin at gmail.com  Thu Oct 13 02:32:35 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 13 Oct 2011 05:32:35 +0400
Subject: [rabbitmq-discuss] Debugging queue.declare
In-Reply-To: <CABB835F.24AA4%pdezwart@rubiconproject.com>
References: <CABB835F.24AA4%pdezwart@rubiconproject.com>
Message-ID: <5C8B491C-C223-4171-A66C-D7E6A70EF1A3@gmail.com>

Le 13/ott/2011 ? 04:51, Pieter de Zwart a ?crit :

> How can I debug this behavior? Must I use the Java tools listed here: http://www.rabbitmq.com/examples.html#tracer

I recommend Wireshark (just go with the GUI version and filter by "amqp"). Tracer works great but it has very little documentation and to understand how to use it you need to look into the source. Also, it does not do traffic capturing.

MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin


From benrady at gmail.com  Thu Oct 13 04:41:25 2011
From: benrady at gmail.com (Ben Rady)
Date: Wed, 12 Oct 2011 22:41:25 -0500
Subject: [rabbitmq-discuss] System CPU spikes, multi-second latency
Message-ID: <CAK5JfkgZEXBN5sPMVE+ePAoPtBV08fqS6_J2yZrvpdkQYLekZg@mail.gmail.com>

We've been having some latency problems with RabbitMQ that seem kinda out of
the ordinary given what I've read on this list and in the documentation
about it's capabilities. In some cases, the message rate for multiple
exchanges simultaneously drops for up to a minute. This is followed by a
giant spike as the messages finally rush through. Although no messages
appear to be lost, the latency is a problem for us, and any help would be
much appreciated.

== About the environment ==

- RabbitMQ 2.5.1 (Compiled from source tarball), web admin plugin installed,
otherwise out of the box configuration
- erlang-otp R14B03
- Redhat Enterprise 6.0
- IBM 3550, 12 cores, 192G memory (no, that's not a typo)
- A single instance of RabbitMQ, receiving roughly 1200 messages per second
across 70 (or so) fanout exchanges. Each exchange has 2 queues with one
associated consumer per queue. The queues are non-persistant and non-ack.
- There is one publisher per exchange, a Ruby process using the AMQP gem.
The consumers also use ruby with the AMQP gem (one is JRuby, the other MRI).

== What we're seeing ==

I've been able to capture a lot of stats during once of these events, and
I've attached some of the resulting data from one that lasted about 12
seconds. What happens (in roughly temporal order) is this:

1) As reported by top, one of the RabbitMQ threads (shown individually in
top using the 'H' option) spikes to 100% CPU. By comparing the last used CPU
in top to the per-cpu user/system/wait breakdown, it appears the thread is
spending all it's time in system calls (see attached screenshot).
2) As reported by netstat, TCP receive queues build up on the incoming
RabbitMQ socket connections. This happens in just a few seconds. See the
attached netstat.txt file for detailed stats from a particular episode.
3) The web admin plugin stops responding to API requests.
4) The incoming message rate across multiple exchanges drops dramatically.
The system can stay in this state for 10-30 seconds or more.
5) The CPU levels return to normal (sometimes a bit above normal), and the
message rate jumps. Some queuing on the consumers happens as they try to
catch up with flood of messages.
6) The consumers work off the extra messages, and the system returns to
normal (40%, or so, cpu for rabbit, < 5% for the consumers).

These episodes last from just a couple of seconds up to a minute, and seem
to happen randomly, sometimes coming one right after another, sometimes
hours apart. We've never seen it less than once a day.

==What we've already done==

1) Troubleshooting using strace
Since the thread seems to be pegged in system calls, we've been using strace
to try and capture the system call made by the offending thread during the
event. Unfortunately, the best we've been able to do is capture the system
calls immediately following the event. For example, here are the first
system calls captured for two threads, once of which can be seen with a
pegged CPU in the attached screenshot (pid 21860).

$ head rabbit-thread.21860
21:13:53.109706 futex(0x1f2bc20, FUTEX_WAKE_PRIVATE, 1) = 1 <0.000021>
21:13:53.109805 futex(0x1f2bb60, FUTEX_WAKE_PRIVATE, 1) = 1 <0.000018>
21:13:53.109853 futex(0x899240, FUTEX_WAIT_PRIVATE, 2, NULL) = 0 <0.006322>

$ head rabbit-thread.21862
21:13:48.663530 futex(0x1f2bce0, FUTEX_WAIT_PRIVATE, 4294967295, NULL)
  = 0 <4.446544>
21:13:53.110118 sched_yield() = 0 <0.000102>
21:13:53.110334 futex(0x1f856e8, FUTEX_WAIT_PRIVATE, 2, NULL) = 0 <0.006364>
21:13:53.116735 futex(0x1f856e8, FUTEX_WAKE_PRIVATE, 1) = 1 <0.000092>
21:13:53.117139 recvfrom(204, "

The first system call logged for 21860 occurs at 21:13:53. However, notice
the timestamp and 4.4 second execution time for the futex call in the other
thread (21862). All of the straces for the threads were started at the same
time (using the -ff option) and a number of other threads have a similar
call around 21:13:48.6635 as their first logged system call (within a few
milliseconds). This leads me to believe that whatever 21860 is doing during
this time, it's working in a single system call rather
than repeatedly calling in a loop.

2) Reproducing the problem in a controlled environment

This problem only seems to occur in our production environments, but not in
any test environments. The software and hardware in the two environments are
identical. We've used data recorded from our prod environment to try and
reproduce the problem in test (with higher load, even), but no luck so far.

3) Monitoring message rates through the web API

In the second attached screenshot, you can see a graph generated from data
pulled from the web API for this episode. Each trace in the graph represents
the incoming message rate for an individual exchange as reported by the API.
For example, the green line at the top shows the message rate dropping from
223 messages/sec to 32 messages per second. Not all the exchanges

Note that the sample rate for this query is every 5 seconds, and the
straight line between the points at 21:13:40 and 21:13:53 indicate that the
script pulling the data was unable to get a response from rabbit during this
time.

4) Restarting Rabbit

It's not clear that restarting rabbit has any effect on this problem.
Because it's so random, it's hard to tell if a rabbit restart makes things
better.


I've got more data on this if anyone wants to hear it. Thanks in advance for
your help.

Ben
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111012/591902e5/attachment.htm>
-------------- next part --------------
Proto Recv-Q Send-Q Local Address               Foreign Address             State
Wed Oct 12 21:13:01 CDT 2011
Wed Oct 12 21:13:04 CDT 2011
Wed Oct 12 21:13:06 CDT 2011
Wed Oct 12 21:13:08 CDT 2011
Wed Oct 12 21:13:10 CDT 2011
Wed Oct 12 21:13:13 CDT 2011
tcp     1581      0 localhost.localdomain:amqp  localhost.localdomain:47506 ESTABLISHED 
Wed Oct 12 21:13:15 CDT 2011
Wed Oct 12 21:13:17 CDT 2011
tcp      733      0 localhost.localdomain:amqp  localhost.localdomain:47756 ESTABLISHED 
Wed Oct 12 21:13:20 CDT 2011
tcp     1467      0 localhost.localdomain:amqp  localhost.localdomain:47628 ESTABLISHED 
Wed Oct 12 21:13:22 CDT 2011
Wed Oct 12 21:13:24 CDT 2011
Wed Oct 12 21:13:26 CDT 2011
tcp     1053      0 localhost.localdomain:47508 localhost.localdomain:amqp  ESTABLISHED 
Wed Oct 12 21:13:29 CDT 2011
Wed Oct 12 21:13:32 CDT 2011
Wed Oct 12 21:13:34 CDT 2011
tcp      352      0 localhost.localdomain:47591 localhost.localdomain:amqp  ESTABLISHED 
Wed Oct 12 21:13:37 CDT 2011
Wed Oct 12 21:13:39 CDT 2011
Wed Oct 12 21:13:41 CDT 2011
Wed Oct 12 21:13:44 CDT 2011
tcp    15936      0 localhost.localdomain:amqp  localhost.localdomain:47736 ESTABLISHED 
tcp    21679      0 localhost.localdomain:amqp  localhost.localdomain:47761 ESTABLISHED 
tcp    74232      0 localhost.localdomain:amqp  localhost.localdomain:47506 ESTABLISHED 
tcp      600      0 localhost.localdomain:amqp  localhost.localdomain:47792 ESTABLISHED 
tcp     3640      0 localhost.localdomain:amqp  localhost.localdomain:47592 ESTABLISHED 
tcp    13376      0 localhost.localdomain:amqp  localhost.localdomain:47623 ESTABLISHED 
tcp     4235      0 localhost.localdomain:amqp  localhost.localdomain:47756 ESTABLISHED 
tcp      259      0 localhost.localdomain:amqp  localhost.localdomain:47459 ESTABLISHED 
tcp      954      0 localhost.localdomain:amqp  localhost.localdomain:47566 ESTABLISHED 
tcp    40460      0 localhost.localdomain:amqp  localhost.localdomain:47826 ESTABLISHED 
tcp    18722      0 localhost.localdomain:amqp  localhost.localdomai:bacnet ESTABLISHED 
tcp    32314      0 localhost.localdomain:amqp  localhost.localdomain:47655 ESTABLISHED 
tcp    10383      0 localhost.localdomain:amqp  localhost.localdomain:47878 ESTABLISHED 
tcp    10947      0 localhost.localdomain:amqp  localhost.localdomain:47573 ESTABLISHED 
tcp     5798      0 localhost.localdomain:amqp  localhost.localdomain:47850 ESTABLISHED 
tcp    14231      0 localhost.localdomain:amqp  localhost.localdomain:47872 ESTABLISHED 
tcp    13748      0 localhost.localdomain:amqp  localhost.localdomain:47814 ESTABLISHED 
tcp     2916      0 localhost.localdomain:amqp  localhost.localdomain:47626 ESTABLISHED 
tcp    65939      0 localhost.localdomain:amqp  localhost.localdomain:47628 ESTABLISHED 
tcp     4018      0 localhost.localdomain:amqp  localhost.localdomain:47812 ESTABLISHED 
tcp    36104      0 localhost.localdomain:amqp  localhost.localdomain:47583 ESTABLISHED 
tcp     2656      0 localhost.localdomain:amqp  localhost.localdomain:47787 ESTABLISHED 
tcp    11890      0 localhost.localdomain:amqp  localhost.localdomain:47844 ESTABLISHED 
tcp     3441      0 localhost.localdomain:amqp  localhost.localdomain:47619 ESTABLISHED 
tcp    41800      0 localhost.localdomain:amqp  localhost.localdomain:47671 ESTABLISHED 
tcp      270      0 localhost.localdomain:amqp  localhost.localdomain:47638 ESTABLISHED 
tcp    46458      0 localhost.localdomain:amqp  localhost.localdomain:47871 ESTABLISHED 
tcp     5460      0 localhost.localdomain:amqp  localhost.localdomain:47784 ESTABLISHED 
tcp     2917      0 localhost.localdomain:amqp  localhost.localdomain:47480 ESTABLISHED 
tcp    20745      0 localhost.localdomain:amqp  localhost.localdomain:47767 ESTABLISHED 
tcp     7536      0 localhost.localdomain:amqp  localhost.localdomain:47837 ESTABLISHED 
Wed Oct 12 21:13:46 CDT 2011
tcp    28460      0 localhost.localdomain:amqp  localhost.localdomain:47736 ESTABLISHED 
tcp    48715      0 localhost.localdomain:amqp  localhost.localdomain:47761 ESTABLISHED 
tcp   209606      0 localhost.localdomain:amqp  localhost.localdomain:47506 ESTABLISHED 
tcp     2400      0 localhost.localdomain:amqp  localhost.localdomain:47792 ESTABLISHED 
tcp     7839      0 localhost.localdomain:amqp  localhost.localdomain:47592 ESTABLISHED 
tcp    29473      0 localhost.localdomain:amqp  localhost.localdomain:47623 ESTABLISHED 
tcp    11309      0 localhost.localdomain:amqp  localhost.localdomain:47756 ESTABLISHED 
tcp      518      0 localhost.localdomain:amqp  localhost.localdomain:47459 ESTABLISHED 
tcp     1908      0 localhost.localdomain:amqp  localhost.localdomain:47566 ESTABLISHED 
tcp   102870      0 localhost.localdomain:amqp  localhost.localdomain:47826 ESTABLISHED 
tcp    64155      0 localhost.localdomain:amqp  localhost.localdomai:bacnet ESTABLISHED 
tcp    84905      0 localhost.localdomain:amqp  localhost.localdomain:47655 ESTABLISHED 
tcp    25611      0 localhost.localdomain:amqp  localhost.localdomain:47878 ESTABLISHED 
tcp    25791      0 localhost.localdomain:amqp  localhost.localdomain:47573 ESTABLISHED 
tcp    12454      0 localhost.localdomain:amqp  localhost.localdomain:47850 ESTABLISHED 
tcp    43832      0 localhost.localdomain:amqp  localhost.localdomain:47872 ESTABLISHED 
tcp    41396      0 localhost.localdomain:amqp  localhost.localdomain:47814 ESTABLISHED 
tcp     7078      0 localhost.localdomain:amqp  localhost.localdomain:47626 ESTABLISHED 
tcp   170929      0 localhost.localdomain:amqp  localhost.localdomain:47628 ESTABLISHED 
tcp     9673      0 localhost.localdomain:amqp  localhost.localdomain:47812 ESTABLISHED 
tcp    88569      0 localhost.localdomain:amqp  localhost.localdomain:47583 ESTABLISHED 
tcp     5251      0 localhost.localdomain:amqp  localhost.localdomain:47787 ESTABLISHED 
tcp    41544      0 localhost.localdomain:amqp  localhost.localdomain:47844 ESTABLISHED 
tcp    10038      0 localhost.localdomain:amqp  localhost.localdomain:47619 ESTABLISHED 
tcp    91198      0 localhost.localdomain:amqp  localhost.localdomain:47671 ESTABLISHED 
tcp      809      0 localhost.localdomain:amqp  localhost.localdomain:47638 ESTABLISHED 
tcp   144476      0 localhost.localdomain:amqp  localhost.localdomain:47871 ESTABLISHED 
tcp     7878      0 localhost.localdomain:amqp  localhost.localdomain:47784 ESTABLISHED 
tcp     5829      0 localhost.localdomain:amqp  localhost.localdomain:47480 ESTABLISHED 
tcp    64986      0 localhost.localdomain:amqp  localhost.localdomain:47767 ESTABLISHED 
tcp    10902      0 localhost.localdomain:amqp  localhost.localdomain:47837 ESTABLISHED 
Wed Oct 12 21:13:49 CDT 2011
tcp    44641      0 localhost.localdomain:amqp  localhost.localdomain:47736 ESTABLISHED 
tcp    91471      0 localhost.localdomain:amqp  localhost.localdomain:47761 ESTABLISHED 
tcp   427156      0 localhost.localdomain:amqp  localhost.localdomain:47506 ESTABLISHED 
tcp     3600      0 localhost.localdomain:amqp  localhost.localdomain:47792 ESTABLISHED 
tcp    14675      0 localhost.localdomain:amqp  localhost.localdomain:47592 ESTABLISHED 
tcp    45688      0 localhost.localdomain:amqp  localhost.localdomain:47623 ESTABLISHED 
tcp    17949      0 localhost.localdomain:amqp  localhost.localdomain:47756 ESTABLISHED 
tcp      777      0 localhost.localdomain:amqp  localhost.localdomain:47459 ESTABLISHED 
tcp     3339      0 localhost.localdomain:amqp  localhost.localdomain:47566 ESTABLISHED 
tcp   176459      0 localhost.localdomain:amqp  localhost.localdomain:47826 ESTABLISHED 
tcp   116508      0 localhost.localdomain:amqp  localhost.localdomai:bacnet ESTABLISHED 
tcp   158258      0 localhost.localdomain:amqp  localhost.localdomain:47655 ESTABLISHED 
tcp    45869      0 localhost.localdomain:amqp  localhost.localdomain:47878 ESTABLISHED 
tcp    49992      0 localhost.localdomain:amqp  localhost.localdomain:47573 ESTABLISHED 
tcp    20884      0 localhost.localdomain:amqp  localhost.localdomain:47850 ESTABLISHED 
tcp    69021      0 localhost.localdomain:amqp  localhost.localdomain:47872 ESTABLISHED 
tcp    71917      0 localhost.localdomain:amqp  localhost.localdomain:47814 ESTABLISHED 
tcp     7795      0 localhost.localdomain:amqp  localhost.localdomain:47626 ESTABLISHED 
tcp   363634      0 localhost.localdomain:amqp  localhost.localdomain:47628 ESTABLISHED 
tcp    18200      0 localhost.localdomain:amqp  localhost.localdomain:47812 ESTABLISHED 
tcp   182609      0 localhost.localdomain:amqp  localhost.localdomain:47583 ESTABLISHED 
tcp    19031      0 localhost.localdomain:amqp  localhost.localdomain:47787 ESTABLISHED 
tcp    62316      0 localhost.localdomain:amqp  localhost.localdomain:47844 ESTABLISHED 
tcp    13194      0 localhost.localdomain:amqp  localhost.localdomain:47619 ESTABLISHED 
tcp   156987      0 localhost.localdomain:amqp  localhost.localdomain:47671 ESTABLISHED 
tcp     1348      0 localhost.localdomain:amqp  localhost.localdomain:47638 ESTABLISHED 
tcp   283881      0 localhost.localdomain:amqp  localhost.localdomain:47871 ESTABLISHED 
tcp     9492      0 localhost.localdomain:amqp  localhost.localdomain:47784 ESTABLISHED 
tcp    10333      0 localhost.localdomain:amqp  localhost.localdomain:47480 ESTABLISHED 
tcp   105166      0 localhost.localdomain:amqp  localhost.localdomain:47767 ESTABLISHED 
tcp      346      0 localhost.localdomain:amqp  localhost.localdomain:47706 ESTABLISHED 
tcp    17632      0 localhost.localdomain:amqp  localhost.localdomain:47837 ESTABLISHED 
Wed Oct 12 21:13:51 CDT 2011
tcp    57163      0 localhost.localdomain:amqp  localhost.localdomain:47736 ESTABLISHED 
tcp   120173      0 localhost.localdomain:amqp  localhost.localdomain:47761 ESTABLISHED 
tcp   604265      0 localhost.localdomain:amqp  localhost.localdomain:47506 ESTABLISHED 
tcp     4800      0 localhost.localdomain:amqp  localhost.localdomain:47792 ESTABLISHED 
tcp    19344      0 localhost.localdomain:amqp  localhost.localdomain:47592 ESTABLISHED 
tcp    64057      0 localhost.localdomain:amqp  localhost.localdomain:47623 ESTABLISHED 
tcp    25192      0 localhost.localdomain:amqp  localhost.localdomain:47756 ESTABLISHED 
tcp     1036      0 localhost.localdomain:amqp  localhost.localdomain:47459 ESTABLISHED 
tcp     4293      0 localhost.localdomain:amqp  localhost.localdomain:47566 ESTABLISHED 
tcp   242307      0 localhost.localdomain:amqp  localhost.localdomain:47826 ESTABLISHED 
tcp   159940      0 localhost.localdomain:amqp  localhost.localdomai:bacnet ESTABLISHED 
tcp   225302      0 localhost.localdomain:amqp  localhost.localdomain:47655 ESTABLISHED 
tcp    60735      0 localhost.localdomain:amqp  localhost.localdomain:47878 ESTABLISHED 
tcp    68294      0 localhost.localdomain:amqp  localhost.localdomain:47573 ESTABLISHED 
tcp    26739      0 localhost.localdomain:amqp  localhost.localdomain:47850 ESTABLISHED 
tcp    98622      0 localhost.localdomain:amqp  localhost.localdomain:47872 ESTABLISHED 
tcp    96540      0 localhost.localdomain:amqp  localhost.localdomain:47814 ESTABLISHED 
tcp    10084      0 localhost.localdomain:amqp  localhost.localdomain:47626 ESTABLISHED 
tcp   516585      0 localhost.localdomain:amqp  localhost.localdomain:47628 ESTABLISHED 
tcp    23854      0 localhost.localdomain:amqp  localhost.localdomain:47812 ESTABLISHED 
tcp   257739      0 localhost.localdomain:amqp  localhost.localdomain:47583 ESTABLISHED 
tcp    26798      0 localhost.localdomain:amqp  localhost.localdomain:47787 ESTABLISHED 
tcp    93474      0 localhost.localdomain:amqp  localhost.localdomain:47844 ESTABLISHED 
tcp    16635      0 localhost.localdomain:amqp  localhost.localdomain:47619 ESTABLISHED 
tcp   210562      0 localhost.localdomain:amqp  localhost.localdomain:47671 ESTABLISHED 
tcp     1887      0 localhost.localdomain:amqp  localhost.localdomain:47638 ESTABLISHED 
tcp   402725      0 localhost.localdomain:amqp  localhost.localdomain:47871 ESTABLISHED 
tcp    11396      0 localhost.localdomain:amqp  localhost.localdomain:47784 ESTABLISHED 
tcp    13210      0 localhost.localdomain:amqp  localhost.localdomain:47480 ESTABLISHED 
tcp   149404      0 localhost.localdomain:amqp  localhost.localdomain:47767 ESTABLISHED 
tcp      698      0 localhost.localdomain:amqp  localhost.localdomain:47706 ESTABLISHED 
tcp    21076      0 localhost.localdomain:amqp  localhost.localdomain:47837 ESTABLISHED 
Wed Oct 12 21:13:53 CDT 2011
tcp    33430      0 localhost.localdomain:amqp  localhost.localdomain:47736 ESTABLISHED 
tcp   113449      0 localhost.localdomain:amqp  localhost.localdomain:47761 ESTABLISHED 
tcp   862376      0 localhost.localdomain:amqp  localhost.localdomain:47506 ESTABLISHED 
tcp    40638      0 localhost.localdomain:amqp  localhost.localdomain:47623 ESTABLISHED 
tcp   266511      0 localhost.localdomain:amqp  localhost.localdomain:47826 ESTABLISHED 
tcp   168676      0 localhost.localdomain:amqp  localhost.localdomai:bacnet ESTABLISHED 
tcp   380701      0 localhost.localdomain:amqp  localhost.localdomain:47655 ESTABLISHED 
tcp    36208      0 localhost.localdomain:amqp  localhost.localdomain:47878 ESTABLISHED 
tcp   264931      0 localhost.localdomain:amqp  localhost.localdomain:47573 ESTABLISHED 
tcp    78198      0 localhost.localdomain:amqp  localhost.localdomain:47872 ESTABLISHED 
tcp    80677      0 localhost.localdomain:amqp  localhost.localdomain:47814 ESTABLISHED 
tcp   758881      0 localhost.localdomain:amqp  localhost.localdomain:47628 ESTABLISHED 
tcp   411550      0 localhost.localdomain:amqp  localhost.localdomain:47583 ESTABLISHED 
tcp    71906      0 localhost.localdomain:amqp  localhost.localdomain:47844 ESTABLISHED 
tcp   212783      0 localhost.localdomain:amqp  localhost.localdomain:47671 ESTABLISHED 
tcp   623353      0 localhost.localdomain:amqp  localhost.localdomain:47871 ESTABLISHED 
tcp   139246      0 localhost.localdomain:amqp  localhost.localdomain:47767 ESTABLISHED 
Wed Oct 12 21:13:55 CDT 2011
tcp   879697      0 localhost.localdomain:amqp  localhost.localdomain:47506 ESTABLISHED 
tcp    76291      0 localhost.localdomain:amqp  localhost.localdomain:47826 ESTABLISHED 
tcp      289      0 localhost.localdomain:amqp  localhost.localdomai:bacnet ESTABLISHED 
tcp   824278      0 localhost.localdomain:amqp  localhost.localdomain:47655 ESTABLISHED 
tcp   224023      0 localhost.localdomain:amqp  localhost.localdomain:47573 ESTABLISHED 
tcp   1187576      0 localhost.localdomain:amqp  localhost.localdomain:47628 ESTABLISHED 
tcp   529432      0 localhost.localdomain:amqp  localhost.localdomain:47583 ESTABLISHED 
tcp     1048    323 localhost.localdomain:amqp  localhost.localdomain:47676 ESTABLISHED 
tcp     6040      0 localhost.localdomain:amqp  localhost.localdomain:47671 ESTABLISHED 
tcp      270      0 localhost.localdomain:amqp  localhost.localdomain:47638 ESTABLISHED 
tcp   1080443      0 localhost.localdomain:amqp  localhost.localdomain:47871 ESTABLISHED 
Wed Oct 12 21:13:58 CDT 2011
tcp   952681      0 localhost.localdomain:amqp  localhost.localdomain:47506 ESTABLISHED 
tcp   483169      0 localhost.localdomain:amqp  localhost.localdomain:47655 ESTABLISHED 
tcp      441      0 localhost.localdomain:amqp  localhost.localdomain:47573 ESTABLISHED 
tcp   1368987      0 localhost.localdomain:amqp  localhost.localdomain:47628 ESTABLISHED 
tcp   376058      0 localhost.localdomain:amqp  localhost.localdomain:47583 ESTABLISHED 
tcp   1089092      0 localhost.localdomain:amqp  localhost.localdomain:47871 ESTABLISHED 
Wed Oct 12 21:14:00 CDT 2011
tcp   953637      0 localhost.localdomain:amqp  localhost.localdomain:47506 ESTABLISHED 
tcp      733      0 localhost.localdomain:amqp  localhost.localdomain:47756 ESTABLISHED 
tcp   238139      0 localhost.localdomain:amqp  localhost.localdomain:47655 ESTABLISHED 
tcp     2350      0 localhost.localdomain:amqp  localhost.localdomain:47573 ESTABLISHED 
tcp   1268676      0 localhost.localdomain:amqp  localhost.localdomain:47628 ESTABLISHED 
tcp   175759      0 localhost.localdomain:amqp  localhost.localdomain:47583 ESTABLISHED 
tcp   755472      0 localhost.localdomain:amqp  localhost.localdomain:47871 ESTABLISHED 
Wed Oct 12 21:14:02 CDT 2011
tcp   950537      0 localhost.localdomain:amqp  localhost.localdomain:47506 ESTABLISHED 
tcp      342      0 localhost.localdomain:amqp  localhost.localdomain:47826 ESTABLISHED 
tcp     1713      0 localhost.localdomain:amqp  localhost.localdomain:47655 ESTABLISHED 
tcp     2083      0 localhost.localdomain:amqp  localhost.localdomain:47573 ESTABLISHED 
tcp   930418      0 localhost.localdomain:amqp  localhost.localdomain:47628 ESTABLISHED 
tcp      314      0 localhost.localdomain:amqp  localhost.localdomain:47583 ESTABLISHED 
tcp   538627      0 localhost.localdomain:amqp  localhost.localdomain:47871 ESTABLISHED 
Wed Oct 12 21:14:05 CDT 2011
tcp   965601      0 localhost.localdomain:amqp  localhost.localdomain:47506 ESTABLISHED 
tcp   802603      0 localhost.localdomain:amqp  localhost.localdomain:47628 ESTABLISHED 
tcp   229943      0 localhost.localdomain:amqp  localhost.localdomain:47871 ESTABLISHED 
Wed Oct 12 21:14:07 CDT 2011
tcp   957953      0 localhost.localdomain:amqp  localhost.localdomain:47506 ESTABLISHED 
tcp      130      0 localhost.localdomain:amqp  localhost.localdomain:47655 ESTABLISHED 
tcp     2383      0 localhost.localdomain:amqp  localhost.localdomain:47872 ESTABLISHED 
tcp   470143      0 localhost.localdomain:amqp  localhost.localdomain:47628 ESTABLISHED 
Wed Oct 12 21:14:09 CDT 2011
tcp   951273      0 localhost.localdomain:amqp  localhost.localdomain:47506 ESTABLISHED 
tcp     1631      0 localhost.localdomain:amqp  localhost.localdomai:bacnet ESTABLISHED 
tcp    61814      0 localhost.localdomain:amqp  localhost.localdomain:47628 ESTABLISHED 
Wed Oct 12 21:14:11 CDT 2011
tcp    11763      0 localhost.localdomain:amqp  localhost.localdomain:47736 ESTABLISHED 
tcp    33022      0 localhost.localdomain:amqp  localhost.localdomain:47761 ESTABLISHED 
tcp   970902      0 localhost.localdomain:amqp  localhost.localdomain:47506 ESTABLISHED 
tcp     1200      0 localhost.localdomain:amqp  localhost.localdomain:47792 ESTABLISHED 
tcp     4667      0 localhost.localdomain:amqp  localhost.localdomain:47592 ESTABLISHED 
tcp    15576      0 localhost.localdomain:amqp  localhost.localdomain:47623 ESTABLISHED 
tcp     6331      0 localhost.localdomain:amqp  localhost.localdomain:47756 ESTABLISHED 
tcp      259      0 localhost.localdomain:amqp  localhost.localdomain:47459 ESTABLISHED 
tcp     1431      0 localhost.localdomain:amqp  localhost.localdomain:47566 ESTABLISHED 
tcp    61176      0 localhost.localdomain:amqp  localhost.localdomain:47826 ESTABLISHED 
tcp    39199      0 localhost.localdomain:amqp  localhost.localdomai:bacnet ESTABLISHED 
tcp    45894      0 localhost.localdomain:amqp  localhost.localdomain:47655 ESTABLISHED 
tcp    11861      0 localhost.localdomain:amqp  localhost.localdomain:47878 ESTABLISHED 
tcp    23041      0 localhost.localdomain:amqp  localhost.localdomain:47573 ESTABLISHED 
tcp     6448      0 localhost.localdomain:amqp  localhost.localdomain:47850 ESTABLISHED 
tcp    21916      0 localhost.localdomain:amqp  localhost.localdomain:47872 ESTABLISHED 
tcp    24337      0 localhost.localdomain:amqp  localhost.localdomain:47814 ESTABLISHED 
tcp     3553      0 localhost.localdomain:amqp  localhost.localdomain:47626 ESTABLISHED 
tcp   109572      0 localhost.localdomain:amqp  localhost.localdomain:47628 ESTABLISHED 
tcp     6152      0 localhost.localdomain:amqp  localhost.localdomain:47812 ESTABLISHED 
tcp    48431      0 localhost.localdomain:amqp  localhost.localdomain:47583 ESTABLISHED 
tcp     9145      0 localhost.localdomain:amqp  localhost.localdomain:47787 ESTABLISHED 
tcp    20772      0 localhost.localdomain:amqp  localhost.localdomain:47844 ESTABLISHED 
tcp     3156      0 localhost.localdomain:amqp  localhost.localdomain:47619 ESTABLISHED 
tcp    51892      0 localhost.localdomain:amqp  localhost.localdomain:47671 ESTABLISHED 
tcp      539      0 localhost.localdomain:amqp  localhost.localdomain:47638 ESTABLISHED 
tcp    70331      0 localhost.localdomain:amqp  localhost.localdomain:47871 ESTABLISHED 
tcp      261      0 localhost.localdomain:amqp  localhost.localdomain:47784 ESTABLISHED 
tcp     2893      0 localhost.localdomain:amqp  localhost.localdomain:47480 ESTABLISHED 
tcp    38389      0 localhost.localdomain:amqp  localhost.localdomain:47767 ESTABLISHED 
tcp      352      0 localhost.localdomain:amqp  localhost.localdomain:47706 ESTABLISHED 
tcp     3436      0 localhost.localdomain:amqp  localhost.localdomain:47837 ESTABLISHED 
Wed Oct 12 21:14:14 CDT 2011
tcp    25682      0 localhost.localdomain:amqp  localhost.localdomain:47736 ESTABLISHED 
tcp    74742      0 localhost.localdomain:amqp  localhost.localdomain:47761 ESTABLISHED 
tcp   970902      0 localhost.localdomain:amqp  localhost.localdomain:47506 ESTABLISHED 
tcp     2400      0 localhost.localdomain:amqp  localhost.localdomain:47792 ESTABLISHED 
tcp    10642      0 localhost.localdomain:amqp  localhost.localdomain:47592 ESTABLISHED 
tcp    31060      0 localhost.localdomain:amqp  localhost.localdomain:47623 ESTABLISHED 
tcp    12133      0 localhost.localdomain:amqp  localhost.localdomain:47756 ESTABLISHED 
tcp      518      0 localhost.localdomain:amqp  localhost.localdomain:47459 ESTABLISHED 
tcp     2385      0 localhost.localdomain:amqp  localhost.localdomain:47566 ESTABLISHED 
tcp   120723      0 localhost.localdomain:amqp  localhost.localdomain:47826 ESTABLISHED 
tcp    77975      0 localhost.localdomain:amqp  localhost.localdomai:bacnet ESTABLISHED 
tcp    98046      0 localhost.localdomain:amqp  localhost.localdomain:47655 ESTABLISHED 
tcp    29099      0 localhost.localdomain:amqp  localhost.localdomain:47878 ESTABLISHED 
tcp    40974      0 localhost.localdomain:amqp  localhost.localdomain:47573 ESTABLISHED 
tcp    16055      0 localhost.localdomain:amqp  localhost.localdomain:47850 ESTABLISHED 
tcp    47105      0 localhost.localdomain:amqp  localhost.localdomain:47872 ESTABLISHED 
tcp    48952      0 localhost.localdomain:amqp  localhost.localdomain:47814 ESTABLISHED 
tcp     4237      0 localhost.localdomain:amqp  localhost.localdomain:47626 ESTABLISHED 
tcp   246403      0 localhost.localdomain:amqp  localhost.localdomain:47628 ESTABLISHED 
tcp    14179      0 localhost.localdomain:amqp  localhost.localdomain:47812 ESTABLISHED 
tcp   126854      0 localhost.localdomain:amqp  localhost.localdomain:47583 ESTABLISHED 
tcp    11803      0 localhost.localdomain:amqp  localhost.localdomain:47787 ESTABLISHED 
tcp    41544      0 localhost.localdomain:amqp  localhost.localdomain:47844 ESTABLISHED 
tcp     6914      0 localhost.localdomain:amqp  localhost.localdomain:47619 ESTABLISHED 
tcp   108956      0 localhost.localdomain:amqp  localhost.localdomain:47671 ESTABLISHED 
tcp      808      0 localhost.localdomain:amqp  localhost.localdomain:47638 ESTABLISHED 
tcp   174661      0 localhost.localdomain:amqp  localhost.localdomain:47871 ESTABLISHED 
tcp     5721      0 localhost.localdomain:amqp  localhost.localdomain:47784 ESTABLISHED 
tcp     5787      0 localhost.localdomain:amqp  localhost.localdomain:47480 ESTABLISHED 
tcp    71406      0 localhost.localdomain:amqp  localhost.localdomain:47767 ESTABLISHED 
tcp      352      0 localhost.localdomain:amqp  localhost.localdomain:47706 ESTABLISHED 
tcp    10185      0 localhost.localdomain:amqp  localhost.localdomain:47837 ESTABLISHED 
Wed Oct 12 21:14:16 CDT 2011
tcp     1170      0 localhost.localdomain:amqp  localhost.localdomain:47578 ESTABLISHED 
tcp    37767      0 localhost.localdomain:amqp  localhost.localdomain:47736 ESTABLISHED 
tcp   117706      0 localhost.localdomain:amqp  localhost.localdomain:47761 ESTABLISHED 
tcp   970902      0 localhost.localdomain:amqp  localhost.localdomain:47506 ESTABLISHED 
tcp     3900      0 localhost.localdomain:amqp  localhost.localdomain:47792 ESTABLISHED 
tcp    14838      0 localhost.localdomain:amqp  localhost.localdomain:47592 ESTABLISHED 
tcp    46320      0 localhost.localdomain:amqp  localhost.localdomain:47623 ESTABLISHED 
tcp    18206      0 localhost.localdomain:amqp  localhost.localdomain:47756 ESTABLISHED 
tcp     1036      0 localhost.localdomain:amqp  localhost.localdomain:47459 ESTABLISHED 
tcp     3339      0 localhost.localdomain:amqp  localhost.localdomain:47566 ESTABLISHED 
tcp   186578      0 localhost.localdomain:amqp  localhost.localdomain:47826 ESTABLISHED 
tcp   121427      0 localhost.localdomain:amqp  localhost.localdomai:bacnet ESTABLISHED 
tcp   160900      0 localhost.localdomain:amqp  localhost.localdomain:47655 ESTABLISHED 
tcp    46592      0 localhost.localdomain:amqp  localhost.localdomain:47878 ESTABLISHED 
tcp    58943      0 localhost.localdomain:amqp  localhost.localdomain:47573 ESTABLISHED 
tcp    22513      0 localhost.localdomain:amqp  localhost.localdomain:47850 ESTABLISHED 
tcp    72864      0 localhost.localdomain:amqp  localhost.localdomain:47872 ESTABLISHED 
tcp    73951      0 localhost.localdomain:amqp  localhost.localdomain:47814 ESTABLISHED 
tcp     5667      0 localhost.localdomain:amqp  localhost.localdomain:47626 ESTABLISHED 
tcp   395569      0 localhost.localdomain:amqp  localhost.localdomain:47628 ESTABLISHED 
tcp    19831      0 localhost.localdomain:amqp  localhost.localdomain:47812 ESTABLISHED 
tcp   198582      0 localhost.localdomain:amqp  localhost.localdomain:47583 ESTABLISHED 
tcp    14401      0 localhost.localdomain:amqp  localhost.localdomain:47787 ESTABLISHED 
tcp    72702      0 localhost.localdomain:amqp  localhost.localdomain:47844 ESTABLISHED 
tcp    13511      0 localhost.localdomain:amqp  localhost.localdomain:47619 ESTABLISHED 
tcp   163556      0 localhost.localdomain:amqp  localhost.localdomain:47671 ESTABLISHED 
tcp     1347      0 localhost.localdomain:amqp  localhost.localdomain:47638 ESTABLISHED 
tcp   296571      0 localhost.localdomain:amqp  localhost.localdomain:47871 ESTABLISHED 
tcp     7868      0 localhost.localdomain:amqp  localhost.localdomain:47784 ESTABLISHED 
tcp     9428      0 localhost.localdomain:amqp  localhost.localdomain:47480 ESTABLISHED 
tcp   105453      0 localhost.localdomain:amqp  localhost.localdomain:47767 ESTABLISHED 
tcp      352      0 localhost.localdomain:amqp  localhost.localdomain:47706 ESTABLISHED 
tcp    14360      0 localhost.localdomain:amqp  localhost.localdomain:47837 ESTABLISHED 
Wed Oct 12 21:14:18 CDT 2011
tcp     1170      0 localhost.localdomain:amqp  localhost.localdomain:47578 ESTABLISHED 
tcp    51258      0 localhost.localdomain:amqp  localhost.localdomain:47736 ESTABLISHED 
tcp   153314      0 localhost.localdomain:amqp  localhost.localdomain:47761 ESTABLISHED 
tcp   970902      0 localhost.localdomain:amqp  localhost.localdomain:47506 ESTABLISHED 
tcp     5100      0 localhost.localdomain:amqp  localhost.localdomain:47792 ESTABLISHED 
tcp    19811      0 localhost.localdomain:amqp  localhost.localdomain:47592 ESTABLISHED 
tcp    64777      0 localhost.localdomain:amqp  localhost.localdomain:47623 ESTABLISHED 
tcp    23957      0 localhost.localdomain:amqp  localhost.localdomain:47756 ESTABLISHED 
tcp     1295      0 localhost.localdomain:amqp  localhost.localdomain:47459 ESTABLISHED 
tcp     4293      0 localhost.localdomain:amqp  localhost.localdomain:47566 ESTABLISHED 
tcp   243685      0 localhost.localdomain:amqp  localhost.localdomain:47826 ESTABLISHED 
tcp   169201      0 localhost.localdomain:amqp  localhost.localdomai:bacnet ESTABLISHED 
tcp   231517      0 localhost.localdomain:amqp  localhost.localdomain:47655 ESTABLISHED 
tcp    62584      0 localhost.localdomain:amqp  localhost.localdomain:47878 ESTABLISHED 
tcp    76915      0 localhost.localdomain:amqp  localhost.localdomain:47573 ESTABLISHED 
tcp    29885      0 localhost.localdomain:amqp  localhost.localdomain:47850 ESTABLISHED 
tcp    98622      0 localhost.localdomain:amqp  localhost.localdomain:47872 ESTABLISHED 
tcp   100245      0 localhost.localdomain:amqp  localhost.localdomain:47814 ESTABLISHED 
tcp     5667      0 localhost.localdomain:amqp  localhost.localdomain:47626 ESTABLISHED 
tcp   544151      0 localhost.localdomain:amqp  localhost.localdomain:47628 ESTABLISHED 
tcp    27355      0 localhost.localdomain:amqp  localhost.localdomain:47812 ESTABLISHED 
tcp   271094      0 localhost.localdomain:amqp  localhost.localdomain:47583 ESTABLISHED 
tcp    15669      0 localhost.localdomain:amqp  localhost.localdomain:47787 ESTABLISHED 
tcp    93474      0 localhost.localdomain:amqp  localhost.localdomain:47844 ESTABLISHED 
tcp    16350      0 localhost.localdomain:amqp  localhost.localdomain:47619 ESTABLISHED 
tcp   215103      0 localhost.localdomain:amqp  localhost.localdomain:47671 ESTABLISHED 
tcp     1886      0 localhost.localdomain:amqp  localhost.localdomain:47638 ESTABLISHED 
tcp   419203      0 localhost.localdomain:amqp  localhost.localdomain:47871 ESTABLISHED 
tcp     9494      0 localhost.localdomain:amqp  localhost.localdomain:47784 ESTABLISHED 
tcp    12871      0 localhost.localdomain:amqp  localhost.localdomain:47480 ESTABLISHED 
tcp   149655      0 localhost.localdomain:amqp  localhost.localdomain:47767 ESTABLISHED 
tcp      698      0 localhost.localdomain:amqp  localhost.localdomain:47706 ESTABLISHED 
tcp    22846      0 localhost.localdomain:amqp  localhost.localdomain:47837 ESTABLISHED 
Wed Oct 12 21:14:20 CDT 2011
tcp    17883      0 localhost.localdomain:amqp  localhost.localdomain:47736 ESTABLISHED 
tcp   177245      0 localhost.localdomain:amqp  localhost.localdomain:47761 ESTABLISHED 
tcp   958410      0 localhost.localdomain:amqp  localhost.localdomain:47506 ESTABLISHED 
tcp    36263      0 localhost.localdomain:amqp  localhost.localdomain:47623 ESTABLISHED 
tcp   259518      0 localhost.localdomain:amqp  localhost.localdomain:47826 ESTABLISHED 
tcp   155674      0 localhost.localdomain:amqp  localhost.localdomai:bacnet ESTABLISHED 
tcp   425744      0 localhost.localdomain:amqp  localhost.localdomain:47655 ESTABLISHED 
tcp    26357      0 localhost.localdomain:amqp  localhost.localdomain:47878 ESTABLISHED 
tcp   256227      0 localhost.localdomain:amqp  localhost.localdomain:47573 ESTABLISHED 
tcp    70898      0 localhost.localdomain:amqp  localhost.localdomain:47872 ESTABLISHED 
tcp    73109      0 localhost.localdomain:amqp  localhost.localdomain:47814 ESTABLISHED 
tcp   761979      0 localhost.localdomain:amqp  localhost.localdomain:47628 ESTABLISHED 
tcp   473563      0 localhost.localdomain:amqp  localhost.localdomain:47583 ESTABLISHED 
tcp      530    577 localhost.localdomain:amqp  localhost.localdomain:47676 ESTABLISHED 
tcp    61686      0 localhost.localdomain:amqp  localhost.localdomain:47844 ESTABLISHED 
tcp   214324      0 localhost.localdomain:amqp  localhost.localdomain:47671 ESTABLISHED 
tcp   691459      0 localhost.localdomain:amqp  localhost.localdomain:47871 ESTABLISHED 
tcp   121978      0 localhost.localdomain:amqp  localhost.localdomain:47767 ESTABLISHED 
Wed Oct 12 21:14:23 CDT 2011
tcp   996686      0 localhost.localdomain:amqp  localhost.localdomain:47506 ESTABLISHED 
tcp    41877      0 localhost.localdomain:amqp  localhost.localdomain:47826 ESTABLISHED 
tcp   823505      0 localhost.localdomain:amqp  localhost.localdomain:47655 ESTABLISHED 
tcp   216406      0 localhost.localdomain:amqp  localhost.localdomain:47573 ESTABLISHED 
tcp   1212223      0 localhost.localdomain:amqp  localhost.localdomain:47628 ESTABLISHED 
tcp   838518      0 localhost.localdomain:amqp  localhost.localdomain:47583 ESTABLISHED 
tcp   1109464      0 localhost.localdomain:amqp  localhost.localdomain:47871 ESTABLISHED 
Wed Oct 12 21:14:25 CDT 2011
tcp   1030094      0 localhost.localdomain:amqp  localhost.localdomain:47506 ESTABLISHED 
tcp   596756      0 localhost.localdomain:amqp  localhost.localdomain:47655 ESTABLISHED 
tcp    32166      0 localhost.localdomain:amqp  localhost.localdomain:47573 ESTABLISHED 
tcp   1427227      0 localhost.localdomain:amqp  localhost.localdomain:47628 ESTABLISHED 
tcp   638147      0 localhost.localdomain:amqp  localhost.localdomain:47583 ESTABLISHED 
tcp   1260456      0 localhost.localdomain:amqp  localhost.localdomain:47871 ESTABLISHED 
Wed Oct 12 21:14:27 CDT 2011
tcp   1069334      0 localhost.localdomain:amqp  localhost.localdomain:47506 ESTABLISHED 
tcp   327272      0 localhost.localdomain:amqp  localhost.localdomain:47655 ESTABLISHED 
tcp     1120      0 localhost.localdomain:amqp  localhost.localdomain:47878 ESTABLISHED 
tcp   1405311      0 localhost.localdomain:amqp  localhost.localdomain:47628 ESTABLISHED 
tcp   260070      0 localhost.localdomain:amqp  localhost.localdomain:47583 ESTABLISHED 
tcp   954564      0 localhost.localdomain:amqp  localhost.localdomain:47871 ESTABLISHED 
Wed Oct 12 21:14:29 CDT 2011
tcp   1067210      0 localhost.localdomain:amqp  localhost.localdomain:47506 ESTABLISHED 
tcp    98646      0 localhost.localdomain:amqp  localhost.localdomain:47655 ESTABLISHED 
tcp   1105244      0 localhost.localdomain:amqp  localhost.localdomain:47628 ESTABLISHED 
tcp    50081      0 localhost.localdomain:amqp  localhost.localdomain:47583 ESTABLISHED 
tcp   695523      0 localhost.localdomain:amqp  localhost.localdomain:47871 ESTABLISHED 
Wed Oct 12 21:14:32 CDT 2011
tcp   1069462      0 localhost.localdomain:amqp  localhost.localdomain:47506 ESTABLISHED 
tcp   912047      0 localhost.localdomain:amqp  localhost.localdomain:47628 ESTABLISHED 
tcp     1461      0 localhost.localdomain:amqp  localhost.localdomain:47583 ESTABLISHED 
tcp   633875      0 localhost.localdomain:amqp  localhost.localdomain:47871 ESTABLISHED 
Wed Oct 12 21:14:34 CDT 2011
tcp   1067010      0 localhost.localdomain:amqp  localhost.localdomain:47506 ESTABLISHED 
tcp      320      0 localhost.localdomain:amqp  localhost.localdomain:47623 ESTABLISHED 
tcp      259      0 localhost.localdomain:amqp  localhost.localdomain:47459 ESTABLISHED 
tcp      918      0 localhost.localdomain:amqp  localhost.localdomain:47826 ESTABLISHED 
tcp      450      0 localhost.localdomain:amqp  localhost.localdomain:47655 ESTABLISHED 
tcp      313      0 localhost.localdomain:amqp  localhost.localdomain:47573 ESTABLISHED 
tcp     3843      0 localhost.localdomain:amqp  localhost.localdomain:47872 ESTABLISHED 
tcp   919325      0 localhost.localdomain:amqp  localhost.localdomain:47628 ESTABLISHED 
tcp   664134      0 localhost.localdomain:47649 localhost.localdomain:amqp  ESTABLISHED 
tcp   606917      0 localhost.localdomain:47508 localhost.localdomain:amqp  ESTABLISHED 
Wed Oct 12 21:14:36 CDT 2011
Wed Oct 12 21:14:38 CDT 2011
Wed Oct 12 21:14:41 CDT 2011
tcp     1997      0 localhost.localdomain:47877 localhost.localdomain:amqp  ESTABLISHED 
tcp      307      0 localhost.localdomain:47766 localhost.localdomain:amqp  ESTABLISHED 
Wed Oct 12 21:14:43 CDT 2011
Wed Oct 12 21:14:45 CDT 2011
Wed Oct 12 21:14:47 CDT 2011
Wed Oct 12 21:14:50 CDT 2011
-------------- next part --------------
A non-text attachment was scrubbed...
Name: incoming-messages-per-exchange.png
Type: image/png
Size: 266627 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111012/591902e5/attachment.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit-threads-top.png
Type: image/png
Size: 74431 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111012/591902e5/attachment-0001.png>

From shammi at wso2.com  Thu Oct 13 05:07:08 2011
From: shammi at wso2.com (Shammi Jayasinghe)
Date: Thu, 13 Oct 2011 09:37:08 +0530
Subject: [rabbitmq-discuss] Configure RabbitMQ for persistent mode
Message-ID: <CA+w4V8e=DioNdk3YU149bgq-8hBO0yjoP+mM0wQZUg7yxo+AEg@mail.gmail.com>

Hi,

    We are carrying out a performance comparison test on RabbitMQ, HornetQ
and Qpid. For that test,
we would like to run the servers on persistence mode. We could configure
HornetQ and Qpid to run on
persistent mode. Unfortunately , we could not found the way to configure
RabbitMQ to run in persistent
mode.

Can you please explain whether there is a configuration that can be done to
run RabbitMQ on
pure persistent mode (Not in memory mode) or It's default mode is persistent
?

We are using Ubuntu 10.04 and we could install rabbitMQ with Synaptic
package manager.

Thank you very much,
Best Regards,*

Shammi Jayasinghe*
Senior Software Engineer; WSO2, Inc.; http://wso2.com,
mobile: +94 71 4493085
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111013/b5e09344/attachment.htm>

From pdezwart at rubiconproject.com  Thu Oct 13 07:03:34 2011
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Thu, 13 Oct 2011 01:03:34 -0500
Subject: [rabbitmq-discuss] Debugging queue.declare
In-Reply-To: <5C8B491C-C223-4171-A66C-D7E6A70EF1A3@gmail.com>
Message-ID: <CABBCD1F.24C29%pdezwart@rubiconproject.com>

Im building this on a remote unix box, so I would first have to get X
setup before I go all GUI on it. Ill give the command line a shot I guess.
Thanks for the suggestion!
me



On 10/12/11 6:32 PM, "Michael Klishin" <michael.s.klishin at gmail.com> wrote:

>Le 13/ott/2011 ? 04:51, Pieter de Zwart a ?crit :
>
>> How can I debug this behavior? Must I use the Java tools listed here:
>>http://www.rabbitmq.com/examples.html#tracer
>
>I recommend Wireshark (just go with the GUI version and filter by
>"amqp"). Tracer works great but it has very little documentation and to
>understand how to use it you need to look into the source. Also, it does
>not do traffic capturing.
>
>MK
>
>http://github.com/michaelklishin
>http://twitter.com/michaelklishin
>


From matthias at rabbitmq.com  Thu Oct 13 07:23:57 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 13 Oct 2011 07:23:57 +0100
Subject: [rabbitmq-discuss] Debugging queue.declare
In-Reply-To: <CABB835F.24AA4%pdezwart@rubiconproject.com>
References: <CABB835F.24AA4%pdezwart@rubiconproject.com>
Message-ID: <4E9683FD.6020007@rabbitmq.com>

Pieter,

On 13/10/11 01:51, Pieter de Zwart wrote:
> However, if I replace x-ha-policy with x-expires in the arguments
> declaration, the queue declaration succeeds (function response is
> AMQP_RESPONSE_NORMAL) but the queue does not show up in the broker queue
> listing.

Could that be because the queue is, er, expiring?

Matthias.

From videlalvaro at gmail.com  Thu Oct 13 08:57:37 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Thu, 13 Oct 2011 09:57:37 +0200
Subject: [rabbitmq-discuss] Bitcask Message Store Index
In-Reply-To: <20111012223235.GA4258@wellquite.org>
References: <7667EFC7-3277-46B5-B29F-21317A694C53@gmail.com>
	<20111012223235.GA4258@wellquite.org>
Message-ID: <2AD90A84-516E-4718-94E2-4BC1E0FE4FB6@gmail.com>

Hi Matthew,

On Oct 13, 2011, at 12:32 AM, Matthew Sackman wrote:

> Huh, that's interesting. I'm curious though - how do the properties of
> your implementation differ from our default? - I'm not trying to
> discourage you at all, just curious. Even if it's just for gaining
> understanding and experience of implementing Rabbit's internal APIs,
> it's still valuable.

So my first goal was to learn more about the Rabbit's internal APIs. Besides that I haven't conducted any benchmarks to see what could be the advantage of using Bitcask over ETS.

According to the Basho devs they wanted to achieve this out of Bitcask:

- low latency per item read or written
- high throughput, especially when writing an incoming stream of random items
- ability to handle datasets much larger than RAM w/o degradation
- crash friendliness, both in terms of fast recovery and not losing data
- ease of backup and restore
- a relatively simple, understandable (and thus supportable) code structure and data format
- predictable behavior under heavy access load or large volume 
- a license that allowed for easy default use in Riak

From those items I think that the ability to handle datasets much larger than RAM w/o degradation could be an advantage over ETS. Still? If I understand correctly the datastore implementation I think when Rabbit start to get pressure on RAM usage it does some flushes to disk. Perhaps there could be a benefit there? not sure.

What I liked from this experiment is that there's no much code needed to have a different index implementation. Basho also created a LevelDB Erlang/C++ NIF, I think that can also be made a index quite easy. I've created a wrapper for it for the umbrella but didn't had time to also implement the index behaviour.

> Simplest way is to set the msg_store_index_module param in your
> rabbitmq.config file - check the rabbit.app to see how it's set, but
> there's nothing unusual there. Also check rabbitmq-toke which
> (re-)implements the same interface and probably changes the env slightly
> differently... ;)

Yes? in my plugin I'm using the rabbit_boot_step thing to set my plugin as the default index.

Cheers,

Alvaro
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111013/fe14444d/attachment.htm>

From matthias at rabbitmq.com  Thu Oct 13 09:46:06 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 13 Oct 2011 09:46:06 +0100
Subject: [rabbitmq-discuss] Bitcask Message Store Index
In-Reply-To: <2AD90A84-516E-4718-94E2-4BC1E0FE4FB6@gmail.com>
References: <7667EFC7-3277-46B5-B29F-21317A694C53@gmail.com>	<20111012223235.GA4258@wellquite.org>
	<2AD90A84-516E-4718-94E2-4BC1E0FE4FB6@gmail.com>
Message-ID: <4E96A54E.1000806@rabbitmq.com>

Alvaro,

On 13/10/11 08:57, Alvaro Videla wrote:
> So my first goal was to learn more about the Rabbit's internal APIs.
>  [...] What I liked from this experiment is that there's no much code
> needed tohave a different index implementation.

This has been a great test of the msg_store_index API and its docs - you 
managed to implement the bitcask index relatively straightforwardly. And 
without needing to ask any questions ;)

> Besides that I haven't conducted any benchmarks to see what could be the
> advantage of using Bitcask over ETS.

The ets index is not a bottleneck performance wise. Its main shortcoming 
is the per-message RAM cost.

> According to the Basho devs they wanted to achieve this out of Bitcask:
>  [...]
> - ability to handle datasets much larger than RAM w/o degradation
> [...]
>  From those items I think that the ability to handle datasets much
> larger than RAM w/o degradation could be an advantage over ETS.

For that to be effective the msg_store itself, not just the index, would 
have to sit on top of bitcask.

bitcask has an in-memory index, very much like the 
rabbit_msg_store_ets_index, so there would still be a per-message memory 
cost. That cost might be a bit lower with bitcask, but not by more than 
50%, since that's the total overhead.

I doubt bitcask would perform any better than the default msg_store, 
since the latter has been highly tuned for queue-like access patterns. 
One area where bitcask might excel is recovery time, particularly after 
an unclean shutdown / crash.


Regards,

Matthias.

From andrea.rosa at hp.com  Thu Oct 13 10:59:13 2011
From: andrea.rosa at hp.com (Rosa, Andrea)
Date: Thu, 13 Oct 2011 09:59:13 +0000
Subject: [rabbitmq-discuss] Fairness wrt queues under heavy load
In-Reply-To: <4E952C86.2060109@rabbitmq.com>
References: <CANVKUrWC=q6GipDRtWEiUOpL0yo_yjxVBzTOPU_C2kWkADfYUA@mail.gmail.com>
	<4E93F9B2.1060605@rabbitmq.com>
	<CANVKUrUsJteZxAzpD78EhimydEH_gu5bTjzS7j2V=TOSmg+t4A@mail.gmail.com>
	<4E941876.3090105@rabbitmq.com>
	<CANVKUrU=358iaydYmNE+HSWQkeuyxwx7PXcY7dQ12HxMxpDn_Q@mail.gmail.com>
	<4E952AEC.20002@rabbitmq.com>
	<CANVKUrUGGVjfZUp4jRB0DKp5HcvD26H=RE02m3rYd3fxYuiteQ@mail.gmail.com>
	<CANVKUrVBFSy35Pj26KdsNhjhM+ZAgMX47m57AvS25QZawYOH1g@mail.gmail.com>
	<4E952C86.2060109@rabbitmq.com>
Message-ID: <5F389C517756284F80239F55BCA5DDDD17B731EC@G4W3209.americas.hpqcorp.net>

Hi

If you have found something interesting about this issue, please back it to the list.
Thanks
--
Andrea

> -----Original Message-----
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-
> discuss-bounces at lists.rabbitmq.com] On Behalf Of Matthias Radestock
> Sent: 12 October 2011 06:59
> To: Eugene Kirpichov
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] Fairness wrt queues under heavy load
> 
> Eugene,
> 
> On 12/10/11 06:53, Eugene Kirpichov wrote:
> > ...And, it's 2.6.1 on Windows Server 2008 R2 x64 (though on a 32-bit
> > Erlang of course, since there's no 64-bit Erlang for Windows).
> 
> That should be fine.
> 
> Btw, please also include the rabbit.log and rabbit-sasl.log going back
> to the last server restart.
> 
> If the report + logs turn out to be rather long, feel free to send them
> off-list to info at rabbitmq.com. Thanks.
> 
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simon at rabbitmq.com  Thu Oct 13 11:24:07 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 13 Oct 2011 11:24:07 +0100
Subject: [rabbitmq-discuss] Debugging queue.declare
In-Reply-To: <CABB835F.24AA4%pdezwart@rubiconproject.com>
References: <CABB835F.24AA4%pdezwart@rubiconproject.com>
Message-ID: <4E96BC47.9020002@rabbitmq.com>

On 13/10/11 01:51, Pieter de Zwart wrote:
> The rabbitmq logs show nothing? well, they show that I
> connected and then disconnected. Nothing else of interest.

Really? Wow. Is your code accessible somewhere and runnable by someone 
who knows nothing about PHP? We should definitely be logging something.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Oct 13 11:32:41 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 13 Oct 2011 11:32:41 +0100
Subject: [rabbitmq-discuss] Debugging queue.declare
In-Reply-To: <4E96BC47.9020002@rabbitmq.com>
References: <CABB835F.24AA4%pdezwart@rubiconproject.com>
	<4E96BC47.9020002@rabbitmq.com>
Message-ID: <4E96BE49.80104@rabbitmq.com>

On 13/10/11 11:24, Simon MacMullen wrote:
> On 13/10/11 01:51, Pieter de Zwart wrote:
>> The rabbitmq logs show nothing? well, they show that I
>> connected and then disconnected. Nothing else of interest.
>
> Really? Wow. Is your code accessible somewhere and runnable by someone
> who knows nothing about PHP? We should definitely be logging something.

...unless, as Matthias points out, the queue is simply expiring before 
you see it and everything is working as designed. Bear in mind that the 
expiry time you provide must be in *milliseconds*.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Oct 13 11:32:47 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 13 Oct 2011 11:32:47 +0100
Subject: [rabbitmq-discuss] Configure RabbitMQ for persistent mode
In-Reply-To: <CA+w4V8e=DioNdk3YU149bgq-8hBO0yjoP+mM0wQZUg7yxo+AEg@mail.gmail.com>
References: <CA+w4V8e=DioNdk3YU149bgq-8hBO0yjoP+mM0wQZUg7yxo+AEg@mail.gmail.com>
Message-ID: <4E96BE4F.3030005@rabbitmq.com>

On 13/10/11 05:07, Shammi Jayasinghe wrote:
> Can you please explain whether there is a configuration that can be done
> to run RabbitMQ on
> pure persistent mode (Not in memory mode) or It's default mode is
> persistent ?

There is only one "mode", and it's mixed. Depends what you ask for.

Declare queues and exchanges with durable=true. Publish with 
deliveryMode=2 in the properties (depending on the client there may be a 
more intuitive way to do this, e.g. MessageProperties.PERSISTENT_BASIC 
in our Java client).

You can mix persistent and transient messages in the same queue.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From jamesdear at gmail.com  Thu Oct 13 12:17:38 2011
From: jamesdear at gmail.com (James Dear)
Date: Thu, 13 Oct 2011 12:17:38 +0100
Subject: [rabbitmq-discuss] Implementing Prioritised Queues
Message-ID: <CAEo4zpckgE2pN6d+J0NuC2XJPQduiF2C6rzFcgq8GOcYVR8Ttw@mail.gmail.com>

Hi,

Referring back to a thread active in Feb, it seems the recommended way
to implement a priority queue is to have multiple queues, one for each
priority level:

> The usual way of implementing priorities is to use separate queues for
> each priority. So if you need two priority levels then declare queues Q1
> and Q2. Route messages to those queues based on priority and have
> clients consume from queues in that order. So Q2 messages won't be
> consumed unless Q1 is empty.

How do you actually implement the logic "consume Q2 iff Q1 empty else
consume Q1"? I've read through much of the docs but can't see anything
other than using GET, but I thought I read somewhere that GET was much
slower than CONSUME.

Can anyone help me with this? By the way, I'm writing in python/pika,
although any language example would help me.

Thanks

James

From videlalvaro at gmail.com  Thu Oct 13 12:18:40 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Thu, 13 Oct 2011 13:18:40 +0200
Subject: [rabbitmq-discuss] Bitcask Message Store Index
In-Reply-To: <4E96A54E.1000806@rabbitmq.com>
References: <7667EFC7-3277-46B5-B29F-21317A694C53@gmail.com>	<20111012223235.GA4258@wellquite.org>
	<2AD90A84-516E-4718-94E2-4BC1E0FE4FB6@gmail.com>
	<4E96A54E.1000806@rabbitmq.com>
Message-ID: <2B4DE461-0E85-423F-A5A0-7481D2761100@gmail.com>

Matthias,

On Oct 13, 2011, at 10:46 AM, Matthias Radestock wrote:

> I doubt bitcask would perform any better than the default msg_store, since the latter has been highly tuned for queue-like access patterns. One area where bitcask might excel is recovery time, particularly after an unclean shutdown / crash.

I totally agree regarding the implementation of the msg_store. I think that putting another database(MySQL, Redis, Riak) behind a queue could bring a severe performance problem. Having said that what do you think of putting a layer on top of the rabbit_msg_store that could add replication/clustering a la riak_core? So the idea here is to use the same storage backend that the variable queue uses but coordinating read/writes using riak_core. (Keep in mind this is not riak_kv the database known as Riak). 

Regards,

Alvaro

From ekirpichov at gmail.com  Thu Oct 13 12:23:09 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Thu, 13 Oct 2011 15:23:09 +0400
Subject: [rabbitmq-discuss] Implementing Prioritised Queues
In-Reply-To: <CAEo4zpckgE2pN6d+J0NuC2XJPQduiF2C6rzFcgq8GOcYVR8Ttw@mail.gmail.com>
References: <CAEo4zpckgE2pN6d+J0NuC2XJPQduiF2C6rzFcgq8GOcYVR8Ttw@mail.gmail.com>
Message-ID: <CANVKUrVKpoWEnrqcKLyp7zx9RWD5=WgtACi0kL+a4kKLfBva0Q@mail.gmail.com>

Just consume both queues and internally, in your application,
implement "getting next message" as "next from your application's
buffer associated with Q1 if it's nonempty, otherwise next from Q2's
buffer".

On Thu, Oct 13, 2011 at 3:17 PM, James Dear <jamesdear at gmail.com> wrote:
> Hi,
>
> Referring back to a thread active in Feb, it seems the recommended way
> to implement a priority queue is to have multiple queues, one for each
> priority level:
>
>> The usual way of implementing priorities is to use separate queues for
>> each priority. So if you need two priority levels then declare queues Q1
>> and Q2. Route messages to those queues based on priority and have
>> clients consume from queues in that order. So Q2 messages won't be
>> consumed unless Q1 is empty.
>
> How do you actually implement the logic "consume Q2 iff Q1 empty else
> consume Q1"? I've read through much of the docs but can't see anything
> other than using GET, but I thought I read somewhere that GET was much
> slower than CONSUME.
>
> Can anyone help me with this? By the way, I'm writing in python/pika,
> although any language example would help me.
>
> Thanks
>
> James
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/

From emile at rabbitmq.com  Thu Oct 13 13:35:50 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 13 Oct 2011 13:35:50 +0100
Subject: [rabbitmq-discuss] IModel thread safety in.NET client
In-Reply-To: <65584f48-a6ac-48ea-b433-312b5a06bf3c@j34g2000prb.googlegroups.com>
References: <65584f48-a6ac-48ea-b433-312b5a06bf3c@j34g2000prb.googlegroups.com>
Message-ID: <4E96DB26.5080206@rabbitmq.com>

Hi,

On 12/10/11 20:29, TrueWill wrote:
> The .NET client user guide (v2.6.1) states that IModel should not be
> shared between threads.
> 
> Apparently BasicAck must be called on the same channel on which the
> message was received.
> 
> When asynchronously consuming messages with IBasicConsumer, is it safe
> to call BasicAck on the original channel (created on the application
> thread) in the handler without locking?

Yes, asynchronous methods such as ack and publish are safe.

> I'm assuming that the handler runs on the connection thread.
> 
> I realize that publish should not be called in the handler. If publish
> can be called by the application thread, should that be done on a
> separate channel from the consuming one?

You can use publish from the same channel or from a separate channel.
You must ensure that you do not invoke blocking methods (that wait for a
reply from the broker) in a handler. QueueDeclare and BasicCancel are
examples of methods that will cause deadlock.


-Emile

From jamesdear at gmail.com  Thu Oct 13 13:55:03 2011
From: jamesdear at gmail.com (James Dear)
Date: Thu, 13 Oct 2011 13:55:03 +0100
Subject: [rabbitmq-discuss] Implementing Prioritised Queues
In-Reply-To: <CANVKUrVKpoWEnrqcKLyp7zx9RWD5=WgtACi0kL+a4kKLfBva0Q@mail.gmail.com>
References: <CAEo4zpckgE2pN6d+J0NuC2XJPQduiF2C6rzFcgq8GOcYVR8Ttw@mail.gmail.com>
	<CANVKUrVKpoWEnrqcKLyp7zx9RWD5=WgtACi0kL+a4kKLfBva0Q@mail.gmail.com>
Message-ID: <CAEo4zpdZztoEL20TJW3aTaF85+BLAKOdr4j2Z4L_h7E0XuQO_Q@mail.gmail.com>

Thanks.

But if the application buffer is of bounded size (say < N messages),
and the buffer is fed at equal rate from Q1 & Q2, then over a
time-horizon >> N the buffer will become saturated with lower-priority
Q2 messages and the application will start receiving Q1 and Q2 at an
equal rate again. To solve this you could do one of:
1. Have an unlimited buffer or
2. Ensure the buffer receives Q1 more rapidly than Q2 or
3. Allow the buffer to reject/requeue when it gets saturated with Q2 or
4. Something else?

1. is not really feasible, 2. means there's no longer a need for a
buffer anyway, not sure about 3. but it seems inefficient.

Is there some other way?


On 13 October 2011 12:23, Eugene Kirpichov <ekirpichov at gmail.com> wrote:
> Just consume both queues and internally, in your application,
> implement "getting next message" as "next from your application's
> buffer associated with Q1 if it's nonempty, otherwise next from Q2's
> buffer".
>
> On Thu, Oct 13, 2011 at 3:17 PM, James Dear <jamesdear at gmail.com> wrote:
>> Hi,
>>
>> Referring back to a thread active in Feb, it seems the recommended way
>> to implement a priority queue is to have multiple queues, one for each
>> priority level:
>>
>>> The usual way of implementing priorities is to use separate queues for
>>> each priority. So if you need two priority levels then declare queues Q1
>>> and Q2. Route messages to those queues based on priority and have
>>> clients consume from queues in that order. So Q2 messages won't be
>>> consumed unless Q1 is empty.
>>
>> How do you actually implement the logic "consume Q2 iff Q1 empty else
>> consume Q1"? I've read through much of the docs but can't see anything
>> other than using GET, but I thought I read somewhere that GET was much
>> slower than CONSUME.
>>
>> Can anyone help me with this? By the way, I'm writing in python/pika,
>> although any language example would help me.
>>
>> Thanks
>>
>> James
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
>
> --
> Eugene Kirpichov
> Principal Engineer, Mirantis Inc. http://www.mirantis.com/
> Editor, http://fprog.ru/
>

From emile at rabbitmq.com  Thu Oct 13 13:55:33 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 13 Oct 2011 13:55:33 +0100
Subject: [rabbitmq-discuss] RabbitMQ with WCF binding
In-Reply-To: <00e4a188-9885-4ab7-97a7-b36f4f5f86e1@d18g2000yql.googlegroups.com>
References: <00e4a188-9885-4ab7-97a7-b36f4f5f86e1@d18g2000yql.googlegroups.com>
Message-ID: <4E96DFC5.6010009@rabbitmq.com>

Hi,

On 09/10/11 21:24, mayank wrote:
> Hi
> 
> I am new to rabbitMQ. I am building an application where using
> rabbitmq wcf binding, where the publisher calls the service method and
> the message gets queued. When the service starts running it consumes
> the messages and acknowledges them. The problem here is I want my
> service to acknowledge messages on certain conditions.

What should happen in cases where your service declines to acknowledge a
request? Will the caller be left waiting for a reply that never arrives?

There is no scope for conditional message acknowledgement in the
rabbitmq WCF binding (see RabbitMQInputChannel for the relevant
implementation). If you want a service reply differently to some
messages then you should build that into the service contract exposed to
clients.

> I am able to achieve this when i am using the rabbitmq APIs to send
> and receive message(not using WCF, just simple c#). But I am not able
> to find how to do this with WCF.

If the flexibility you gain by using the rabbitmq .NET library directly
solves your problem, and you are not constrained to use WCF then I would
encourage you to do so.


Emile



From paulcarlisle at comcast.net  Thu Oct 13 14:02:04 2011
From: paulcarlisle at comcast.net (SixDegrees)
Date: Thu, 13 Oct 2011 06:02:04 -0700 (PDT)
Subject: [rabbitmq-discuss]  Frustrated
Message-ID: <32645140.post@talk.nabble.com>


I've been trying to get two machines to talk to each other using
Django/Celery/RabbitMQ for several days now, without success. I can get the
simple 'add' task to run on the local machine, but when I shut down the
celery daemon locally and only run it on the remote machine, requests for
the task do nothing. No messages in server or rabbitmq logs on either
machine. No messages in the terminal window where celeryd is running via
manage.py. The web page connected to the task just hangs.

The RabbitMQ infrastructure seems to be working just fine. I set up vhosts
on each machine, and 'rabbitmqctl status' shows both, and reports that each
machine belongs to the cluster I set up. 'list_vhosts' shows both machines. 

I am at a loss here. What do I have to do to get this working? How can I
test if Celery sees both machines? Any suggestions, or pointers to
instructions on what seems like a simple setup, will be greatly appreciated.
-- 
View this message in context: http://old.nabble.com/Frustrated-tp32645140p32645140.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From emile at rabbitmq.com  Thu Oct 13 14:02:44 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 13 Oct 2011 14:02:44 +0100
Subject: [rabbitmq-discuss] windows AppFabric,
	Workflow service and RabbitMQ
In-Reply-To: <1318154177.51076.YahooMailClassic@web112605.mail.gq1.yahoo.com>
References: <1318154177.51076.YahooMailClassic@web112605.mail.gq1.yahoo.com>
Message-ID: <4E96E174.3000106@rabbitmq.com>

Hi Slava,

On 09/10/11 10:56, Slava Miropolsky wrote:
> Hi,
> 
> I'm trying to configure WCF rabbitMQBinding for AppFabric (IIS) hosted
> Workflow WCF service, configured to Auto-Start.
> 
> does anyone have positive experience configuring rabbitmq in his hosted
> wcf service?

I don't know of anybody using the rabbitmq WCF binding in this specific
context. Have you run into any specific problems that we can help with?
Feel free to report back any insights or issues that arise.


-Emile


From simon at rabbitmq.com  Thu Oct 13 14:30:27 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 13 Oct 2011 14:30:27 +0100
Subject: [rabbitmq-discuss] Query for Binding with similar topic routing
 keys returns all similar vs the one matching
In-Reply-To: <BDE140BF4C952041931EF8CAAC83341D026B6B8E9F@exch-mbx-111.vmware.com>
References: <BDE140BF4C952041931EF8CAAC83341D026B6B8E83@exch-mbx-111.vmware.com>,
	<BDE140BF4C952041931EF8CAAC83341D026B6B8E85@exch-mbx-111.vmware.com>	<BDE140BF4C952041931EF8CAAC83341D026B6B8E86@exch-mbx-111.vmware.com>,
	<4E9422F4.2070007@rabbitmq.com>	<BDE140BF4C952041931EF8CAAC83341D026B6B8E94@exch-mbx-111.vmware.com>,
	<4E95784D.6020508@rabbitmq.com>
	<BDE140BF4C952041931EF8CAAC83341D026B6B8E9F@exch-mbx-111.vmware.com>
Message-ID: <4E96E7F3.5010508@rabbitmq.com>

On 12/10/11 15:48, Helena Edelson wrote:
> Matthias,

Hi Helena. I've figured out what's happening.

> Given the following precondition:
> Bindings exist that routing keys such as #.foo.bar and *.foo.bar would match.
> Where objOption is the Option returned from GET /api/bindings/vhost/e/exchange/q/queue/routingKey  which unfortunately is either a binding or an array of bindings matching the #etc pattern

There are a couple of issues here. One is that the path should not be 
/api/bindings/<vhost>/e/<exchange>/q/<queue>/<routing_key>, it's 
/api/bindings/<vhost>/e/<exchange>/q/<queue>/<properties_key>, where 
properties_key is a name for the binding the management plugin generates 
from the routing key *and the arguments*. The properties key will often 
look like the routing key in simple cases, but as soon as there are 
arguments in the binding, or the routing key contains some special 
characters, it will differ. This is all to get round the fact that 
bindings don't have names, unlike everything else in AMQP.

You can see the properties key for a given binding when retrieving its 
details from mgmt.

The other issue is that in general any names that are in the URI need to 
be URI-escaped - in the same way as the vhost "/" needs to be referred 
to as "%2F", since some characters that are valid in AMQP cannot appear 
in URIs.

...and of course '#' is such a character - it marks the start of the 
fragment in a URI, so when you request:

/api/bindings/vhost/e/exchange/q/queue/#.foo.bar

You're really asking for the document 
"/api/bindings/vhost/e/exchange/q/queue/" (i.e. the list) and asserting 
that you're going to look at the bit of it identified by ".foo.bar". I'm 
not sure whether your HTTP client or Mochiweb / Webmachine strip the 
fragment part out, but that's what's happening.

Anyway: tl;dr - use the properties key. If you need to generate such a 
key then it has the form:

enc(routing_key) + "_" + enc(args_key_n) + "_" + enc(args_value_n) + "_" 
+ enc(args_key_2) + "_" + enc(args_value_2) ... etc

where enc() means 'URI encode, additionally encoding "_" as "%5F"'.

Cheers, Simon

> Case 1: If I pass in binding pattern #.foo.bar, I get an array of Bindings
> Case 2: If I pass in binding pattern *.foo.bar, I consistently get a single matching Binding
>
> Here is what I am doing, in scala, where I want to extract one binding given one pattern (routing key).
>
> if (objOption.isDefined) objOption.get match {
>
>     case bindings: Array[Binding] =>  for { b<- bindings if b.getRoutingKey == pattern } binding = b
>
>     case b: Binding =>  binding = objOption.get.asInstanceOf[Binding]
> }
>
>
> Helena
> ________________________________________
> From: Matthias Radestock [matthias at rabbitmq.com]
> Sent: Wednesday, October 12, 2011 7:21 AM
> To: Helena Edelson
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] Query for Binding with similar topic routing keys returns all similar vs the one matching
>
> Helena,
>
> On 11/10/11 14:15, Helena Edelson wrote:
>> I found the user of the # character in the pattern of the binding,
>> given the number and type of binding patterns between queues and
>> exchanges, consistently returns multiple results vs the * character
>> which Rabbit can return a singular match. So I had to write a work
>> around :-)
>
> So do you think there is something broken there in rabbit? Or perhaps
> less obvious than it could be? If so, an example of the form "I tried X
> and was expecting to see Y but instead got Z" would help to shed light
> on the problem.
>
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Oct 13 14:58:47 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 13 Oct 2011 14:58:47 +0100
Subject: [rabbitmq-discuss] Shovel Plugin For HA
In-Reply-To: <CAJreXKDwNDT-LfMKhZJVikmTsjgY9d19gSsq3T8K-f_-TgjZ+g@mail.gmail.com>
References: <CAJreXKDwNDT-LfMKhZJVikmTsjgY9d19gSsq3T8K-f_-TgjZ+g@mail.gmail.com>
Message-ID: <4E96EE97.7090503@rabbitmq.com>

On 11/10/11 17:51, James Carr wrote:
>  I'm just curious
> if there is a softer way to handle this that allows for more dynamic
> forwarding (one feature I always liked about AMQP is that client apps
> can define exchanges and queues rather than having an admin set them up).

You could check out the federation plugin:

http://www.rabbitmq.com/plugins.html#rabbitmq_federation
http://hg.rabbitmq.com/rabbitmq-federation/file/default/README
http://www.rabbitmq.com/blog/2011/06/22/federation-plugin-preview-release/

That's intended to be a slightly higher-level thing than the shovel.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Oct 13 15:00:54 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 13 Oct 2011 15:00:54 +0100
Subject: [rabbitmq-discuss] SHOVEL PLUGIN + RABBITMQ ACTIVE-ACTIVE
 ACCROSS A	WAN
In-Reply-To: <5771CC721874D84ABB21F48859D38BEE1010BAA227@Y000IQGV01.rd1.rf1>
References: <5771CC721874D84ABB21F48859D38BEE1010BAA227@Y000IQGV01.rd1.rf1>
Message-ID: <4E96EF16.10205@rabbitmq.com>

On 12/10/11 11:11, TARANTELLI Milan (MORPHO) wrote:
> So the question is:
>
> Is message acknowledge/delivery guaranteed using Shovel and RabbitMQ across a WAN where we can face network disconnection issues?

Yes, as long as you leave ack_mode set to 'on_confirm' (it's the default).

The shovel just uses regular AMQP to send messages across the WAN, with 
acking and confirms by default, so you get the same delivery guarantees.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From jon at jbrisbin.com  Thu Oct 13 16:10:21 2011
From: jon at jbrisbin.com (Jon Brisbin)
Date: Thu, 13 Oct 2011 10:10:21 -0500 (CDT)
Subject: [rabbitmq-discuss] Bitcask Message Store Index
In-Reply-To: <2B4DE461-0E85-423F-A5A0-7481D2761100@gmail.com>
Message-ID: <40cf73f7-f4d9-4074-87a6-aedcea05d5f5@jbrisbin.local>

FWIW- I've gotten riak_core to run inside RabbitMQ as a plugin. I had thought I might experiment with a riak_core-backed queue. I never really got time to fiddle with it. 

There's lots of things you can use riak_core inside RabbitMQ for. I was thinking particularly of using the riak_core snowflake unique id generator among other things... 

Thanks! 

Jon Brisbin 
http//jbrisbin.com 

----- Original Message -----

> From: "Alvaro Videla" <videlalvaro at gmail.com>
> To: "Matthias Radestock" <matthias at rabbitmq.com>
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Sent: Thursday, October 13, 2011 6:18:40 AM
> Subject: Re: [rabbitmq-discuss] Bitcask Message Store Index

> Matthias,

> On Oct 13, 2011, at 10:46 AM, Matthias Radestock wrote:

> > I doubt bitcask would perform any better than the default
> > msg_store, since the latter has been highly tuned for queue-like
> > access patterns. One area where bitcask might excel is recovery
> > time, particularly after an unclean shutdown / crash.

> I totally agree regarding the implementation of the msg_store. I
> think that putting another database(MySQL, Redis, Riak) behind a
> queue could bring a severe performance problem. Having said that
> what do you think of putting a layer on top of the rabbit_msg_store
> that could add replication/clustering a la riak_core? So the idea
> here is to use the same storage backend that the variable queue uses
> but coordinating read/writes using riak_core. (Keep in mind this is
> not riak_kv the database known as Riak).

> Regards,

> Alvaro
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111013/4c23b0ae/attachment.htm>

From videlalvaro at gmail.com  Thu Oct 13 16:13:59 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Thu, 13 Oct 2011 17:13:59 +0200
Subject: [rabbitmq-discuss] Bitcask Message Store Index
In-Reply-To: <40cf73f7-f4d9-4074-87a6-aedcea05d5f5@jbrisbin.local>
References: <40cf73f7-f4d9-4074-87a6-aedcea05d5f5@jbrisbin.local>
Message-ID: <967AC52C-8881-4F0F-BD11-A58A54701067@gmail.com>

Jon,

Do you have a riak_core wrapper for the rabbitmq-public-umbrella?

Cheers,

Alvaro

On Oct 13, 2011, at 5:10 PM, Jon Brisbin wrote:

> FWIW- I've gotten riak_core to run inside RabbitMQ as a plugin. I had thought I might experiment with a riak_core-backed queue. I never really got time to fiddle with it.
> 
> There's lots of things you can use riak_core inside RabbitMQ for. I was thinking particularly of using the riak_core snowflake unique id generator among other things...
> 
> 
> Thanks!
> 
> Jon Brisbin
> http//jbrisbin.com
> 
> From: "Alvaro Videla" <videlalvaro at gmail.com>
> To: "Matthias Radestock" <matthias at rabbitmq.com>
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Sent: Thursday, October 13, 2011 6:18:40 AM
> Subject: Re: [rabbitmq-discuss] Bitcask Message Store Index
> 
> Matthias,
> 
> On Oct 13, 2011, at 10:46 AM, Matthias Radestock wrote:
> 
> > I doubt bitcask would perform any better than the default msg_store, since the latter has been highly tuned for queue-like access patterns. One area where bitcask might excel is recovery time, particularly after an unclean shutdown / crash.
> 
> I totally agree regarding the implementation of the msg_store. I think that putting another database(MySQL, Redis, Riak) behind a queue could bring a severe performance problem. Having said that what do you think of putting a layer on top of the rabbit_msg_store that could add replication/clustering a la riak_core? So the idea here is to use the same storage backend that the variable queue uses but coordinating read/writes using riak_core. (Keep in mind this is not riak_kv the database known as Riak). 
> 
> Regards,
> 
> Alvaro
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

Sent form my Nokia 1100



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111013/2888a5f0/attachment.htm>

From dougbarth at gmail.com  Thu Oct 13 16:24:53 2011
From: dougbarth at gmail.com (Doug Barth)
Date: Thu, 13 Oct 2011 08:24:53 -0700 (PDT)
Subject: [rabbitmq-discuss] Implementing Prioritised Queues
In-Reply-To: <CAEo4zpdZztoEL20TJW3aTaF85+BLAKOdr4j2Z4L_h7E0XuQO_Q@mail.gmail.com>
References: <CAEo4zpckgE2pN6d+J0NuC2XJPQduiF2C6rzFcgq8GOcYVR8Ttw@mail.gmail.com>
	<CANVKUrVKpoWEnrqcKLyp7zx9RWD5=WgtACi0kL+a4kKLfBva0Q@mail.gmail.com>
	<CAEo4zpdZztoEL20TJW3aTaF85+BLAKOdr4j2Z4L_h7E0XuQO_Q@mail.gmail.com>
Message-ID: <50a1cb16-acef-4712-943f-9f2e758a777a@u18g2000yqb.googlegroups.com>

I wrote up a blog post a while ago explaining how we approximate
priority using separate queues in our application. We've had this
setup in production for over 2 years now, and it works great.

  http://dougbarth.github.com/2011/07/01/approximating-priority-with-rabbitmq.html

Hope that helps!


From matthew at rabbitmq.com  Thu Oct 13 16:24:54 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 13 Oct 2011 16:24:54 +0100
Subject: [rabbitmq-discuss] Bitcask Message Store Index
In-Reply-To: <2B4DE461-0E85-423F-A5A0-7481D2761100@gmail.com>
References: <7667EFC7-3277-46B5-B29F-21317A694C53@gmail.com>
	<20111012223235.GA4258@wellquite.org>
	<2AD90A84-516E-4718-94E2-4BC1E0FE4FB6@gmail.com>
	<4E96A54E.1000806@rabbitmq.com>
	<2B4DE461-0E85-423F-A5A0-7481D2761100@gmail.com>
Message-ID: <20111013152454.GA22178@rabbitmq.com>

Hi Alvaro,

On Thu, Oct 13, 2011 at 01:18:40PM +0200, Alvaro Videla wrote:
> On Oct 13, 2011, at 10:46 AM, Matthias Radestock wrote:
> > I doubt bitcask would perform any better than the default msg_store,
> > since the latter has been highly tuned for queue-like access
> > patterns. One area where bitcask might excel is recovery time,
> > particularly after an unclean shutdown / crash.
> 
> I totally agree regarding the implementation of the msg_store. I think
> that putting another database(MySQL, Redis, Riak) behind a queue could
> bring a severe performance problem. Having said that what do you think
> of putting a layer on top of the rabbit_msg_store that could add
> replication/clustering a la riak_core? So the idea here is to use the
> same storage backend that the variable queue uses but coordinating
> read/writes using riak_core. (Keep in mind this is not riak_kv the
> database known as Riak).

Well, you could do that. But then you'd a) pick up only the messages
which are sent to disk anyway, and b) whilst you'd pick up the messages
themselves, you'd have no idea which queues they belong to or what order
they appear in those queues.

What properties are you after which are not provided by Rabbit's new HA
features that appeared in 2.6.0? - http://www.rabbitmq.com/ha.html

Matthew

From jamesdear at gmail.com  Thu Oct 13 16:25:58 2011
From: jamesdear at gmail.com (James Dear)
Date: Thu, 13 Oct 2011 16:25:58 +0100
Subject: [rabbitmq-discuss] Implementing Prioritised Queues
In-Reply-To: <CAEo4zpdZztoEL20TJW3aTaF85+BLAKOdr4j2Z4L_h7E0XuQO_Q@mail.gmail.com>
References: <CAEo4zpckgE2pN6d+J0NuC2XJPQduiF2C6rzFcgq8GOcYVR8Ttw@mail.gmail.com>
	<CANVKUrVKpoWEnrqcKLyp7zx9RWD5=WgtACi0kL+a4kKLfBva0Q@mail.gmail.com>
	<CAEo4zpdZztoEL20TJW3aTaF85+BLAKOdr4j2Z4L_h7E0XuQO_Q@mail.gmail.com>
Message-ID: <CAEo4zpeNRc5N5EzruQ+O5iouo5H2obuaugPpg6LiVHXknLU2kw@mail.gmail.com>

I notice that RabbitMQ QoS does some kind of probabilistic
load-balancing between queues in a channel. If the client could
specify a priority factor (or even better a probabilistic priority
factor) for each queue it subscribes to, and the server would then
load-balance according to the supplied factors, then this would solve
the problem entirely.

It would also add great flexibility for running clustered computing.
For example, suppose Alice and Bob both work for BigCorp, and each
have a cluster of 1000 cores. The comp resources required are not
uniform over time - there's lots of head-scratching time when Alice is
figuring out what calculation to do next and same for Bob. Hence Alice
is fine with Bob using her cores when they are inactive (ie when
Alice's queue is empty) but wants immediate access when she happens to
want to run her own numbers. Likewise for Bob. So they both ensure
that their clients subscribe to both queues, but Alice's cores
prioritize Alice's queue and Bob's cores prioritize Bob's queue.

I used to work in a large bank where they had this problem big time.
There were literally dozens of 500+ core 'silos' that were idle most
of the time, but were required to be that large so that when they
*were* needed they could kick out an answer rapidly. The different
groups didn't trust each other enough to give each other symmetric
access (for good reason - in reality groups never cared about other
groups), and siloization was the only alternative.

On 13 October 2011 13:55, James Dear <jamesdear at gmail.com> wrote:
> Thanks.
>
> But if the application buffer is of bounded size (say < N messages),
> and the buffer is fed at equal rate from Q1 & Q2, then over a
> time-horizon >> N the buffer will become saturated with lower-priority
> Q2 messages and the application will start receiving Q1 and Q2 at an
> equal rate again. To solve this you could do one of:
> 1. Have an unlimited buffer or
> 2. Ensure the buffer receives Q1 more rapidly than Q2 or
> 3. Allow the buffer to reject/requeue when it gets saturated with Q2 or
> 4. Something else?
>
> 1. is not really feasible, 2. means there's no longer a need for a
> buffer anyway, not sure about 3. but it seems inefficient.
>
> Is there some other way?
>
>
> On 13 October 2011 12:23, Eugene Kirpichov <ekirpichov at gmail.com> wrote:
>> Just consume both queues and internally, in your application,
>> implement "getting next message" as "next from your application's
>> buffer associated with Q1 if it's nonempty, otherwise next from Q2's
>> buffer".
>>
>> On Thu, Oct 13, 2011 at 3:17 PM, James Dear <jamesdear at gmail.com> wrote:
>>> Hi,
>>>
>>> Referring back to a thread active in Feb, it seems the recommended way
>>> to implement a priority queue is to have multiple queues, one for each
>>> priority level:
>>>
>>>> The usual way of implementing priorities is to use separate queues for
>>>> each priority. So if you need two priority levels then declare queues Q1
>>>> and Q2. Route messages to those queues based on priority and have
>>>> clients consume from queues in that order. So Q2 messages won't be
>>>> consumed unless Q1 is empty.
>>>
>>> How do you actually implement the logic "consume Q2 iff Q1 empty else
>>> consume Q1"? I've read through much of the docs but can't see anything
>>> other than using GET, but I thought I read somewhere that GET was much
>>> slower than CONSUME.
>>>
>>> Can anyone help me with this? By the way, I'm writing in python/pika,
>>> although any language example would help me.
>>>
>>> Thanks
>>>
>>> James
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>
>>
>>
>> --
>> Eugene Kirpichov
>> Principal Engineer, Mirantis Inc. http://www.mirantis.com/
>> Editor, http://fprog.ru/
>>
>

From matthew at rabbitmq.com  Thu Oct 13 16:33:29 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 13 Oct 2011 16:33:29 +0100
Subject: [rabbitmq-discuss] HA active/active cluster in a bad state
In-Reply-To: <CAP+1M2eAWFJM7BXH1do2e=DtzbfxiCegaL=jiBBX6DE9tXxfVA@mail.gmail.com>
References: <CAP+1M2cL8G99Pj1+VF3HG=eLTTXTSFE5gcifXRDY4xQJfW4ESw@mail.gmail.com>
	<20111004215916.GA23024@wellquite.org>
	<CAP+1M2eAWFJM7BXH1do2e=DtzbfxiCegaL=jiBBX6DE9tXxfVA@mail.gmail.com>
Message-ID: <20111013153328.GB22178@rabbitmq.com>

Hi Bryan,

Sorry it's taken so long to get back to you... been swamped with other
things.

On Tue, Oct 04, 2011 at 08:10:09PM -0500, Bryan Murphy wrote:
> From another node:
> 
> Cluster status of node 'rabbit at domU-12-31-39-06-72-50' ...
> [{nodes,[{disc,['rabbit at domU-12-31-38-07-18-A6','rabbit at ip-10-202-209-83',
>                 'rabbit at domU-12-31-39-06-72-50']}]},
>  {running_nodes,['rabbit at domU-12-31-38-07-18-A6','rabbit at ip-10-202-209-83',
>                  'rabbit at domU-12-31-39-06-72-50']}]
> ...done.
> 
> rabbitmqctl list_queues has the same behavior on the other nodes (never
> returns).

Ok, that most likely suggests the master queue is stuck for some reason,
which is remarkably odd.

> > How big were the queues? We recently fixed some bugs which had
> > previously been causing queue recovery to take a _very_ long time so it
> > might be one of those that's afflicting you. What is the CPU/disk doing
> > of the "stuck" node? If it's spinning then it's probably just taking a
> > very long time to recover.
> 
> Maybe 10-20 queues, probably about 15 messages queued at the time.  This
> environment is a very *low* volume but very *critical* part of our
> application.  I'd be surprised if the production servers saw more than a
> couple hundred messages total per day and this was our test environment.
> 
> Right now the node is idle and it's been sitting there for four hours:
> 
>  01:08:33 up 8 days,  5:33,  1 user,  load average: 0.00, 0.01, 0.05
> 
> A bunch of messages were in an allocated but not-acked state as I was
> testing some of our server processes at the time and they were crashing
> before they could ack the messages.  I originally went to restart the node
> to try and get those messages flowing again.

Right, there's nothing there that could possibly offer any explanation
as to why this has gone wrong. How repeatable is this, and is there a
simple set of steps that would allow us to recreate this? Failing that,
if you can repeat this, is there any way you could grant me (or one of
my colleagues) access to the machines running Rabbit so that we can
probe your rabbits in a variety of ways?

Best wishes,

Matthew

From bmurphy1976 at gmail.com  Thu Oct 13 16:44:43 2011
From: bmurphy1976 at gmail.com (Bryan Murphy)
Date: Thu, 13 Oct 2011 10:44:43 -0500
Subject: [rabbitmq-discuss] HA active/active cluster in a bad state
In-Reply-To: <20111013153328.GB22178@rabbitmq.com>
References: <CAP+1M2cL8G99Pj1+VF3HG=eLTTXTSFE5gcifXRDY4xQJfW4ESw@mail.gmail.com>
	<20111004215916.GA23024@wellquite.org>
	<CAP+1M2eAWFJM7BXH1do2e=DtzbfxiCegaL=jiBBX6DE9tXxfVA@mail.gmail.com>
	<20111013153328.GB22178@rabbitmq.com>
Message-ID: <CAP+1M2dLO2mmRMWXk_9PJu4rW04TVHYa++FTVm6rAvj92xXeuQ@mail.gmail.com>

On Thu, Oct 13, 2011 at 10:33 AM, Matthew Sackman <matthew at rabbitmq.com>wrote:

> Hi Bryan,
>
> Sorry it's taken so long to get back to you... been swamped with other
> things.
>

Not a problem.  I understand.


> Right, there's nothing there that could possibly offer any explanation
> as to why this has gone wrong. How repeatable is this, and is there a
> simple set of steps that would allow us to recreate this? Failing that,
> if you can repeat this, is there any way you could grant me (or one of
> my colleagues) access to the machines running Rabbit so that we can
> probe your rabbits in a variety of ways?
>
> Best wishes,
>
> Matthew
>

Well, it's not consistently repeatable.  I've broken our integration cluster
a few times, but each time the behavior is subtly different.  Most of the
time it fails gracefully, but every once in awhile something goes bonk.

I'll try to get it into a bad state later today.  If I can manage that, I
can easily grant temporary remote access to anybody who needs it.

Thanks,
Bryan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111013/7c6c4b92/attachment.htm>

From matthew at rabbitmq.com  Thu Oct 13 16:48:01 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 13 Oct 2011 16:48:01 +0100
Subject: [rabbitmq-discuss] HA active/active cluster in a bad state
In-Reply-To: <CAP+1M2dLO2mmRMWXk_9PJu4rW04TVHYa++FTVm6rAvj92xXeuQ@mail.gmail.com>
References: <CAP+1M2cL8G99Pj1+VF3HG=eLTTXTSFE5gcifXRDY4xQJfW4ESw@mail.gmail.com>
	<20111004215916.GA23024@wellquite.org>
	<CAP+1M2eAWFJM7BXH1do2e=DtzbfxiCegaL=jiBBX6DE9tXxfVA@mail.gmail.com>
	<20111013153328.GB22178@rabbitmq.com>
	<CAP+1M2dLO2mmRMWXk_9PJu4rW04TVHYa++FTVm6rAvj92xXeuQ@mail.gmail.com>
Message-ID: <20111013154800.GC22178@rabbitmq.com>

On Thu, Oct 13, 2011 at 10:44:43AM -0500, Bryan Murphy wrote:
> I'll try to get it into a bad state later today.  If I can manage that, I
> can easily grant temporary remote access to anybody who needs it.

That'd be great, many thanks. However, please note that almost all of
the Rabbit team is in London, UK, and so there's the usual fun-and-games
with timezones...

Matthew

From baldgoth at gmail.com  Thu Oct 13 17:17:58 2011
From: baldgoth at gmail.com (TrueWill)
Date: Thu, 13 Oct 2011 09:17:58 -0700 (PDT)
Subject: [rabbitmq-discuss] IModel thread safety in.NET client
In-Reply-To: <4E96DB26.5080206@rabbitmq.com>
References: <65584f48-a6ac-48ea-b433-312b5a06bf3c@j34g2000prb.googlegroups.com>
	<4E96DB26.5080206@rabbitmq.com>
Message-ID: <32993492.1448.1318522678417.JavaMail.geo-discussion-forums@vbat14>

Thank you for your response.

I'm still confused, though. The rabbitmq-dotnet-client-2.6.1-user-guide 
states (p. 11):

"Application callback handlers *must not* invoke blocking AMQP operations 
(such as
IModel.QueueDeclare, IModel.BasicCancel or IModel.BasicPublish). If they do, 
the channel
will deadlock."

Could you please clarify?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111013/5c8f668e/attachment.htm>

From emile at rabbitmq.com  Thu Oct 13 18:15:06 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 13 Oct 2011 18:15:06 +0100
Subject: [rabbitmq-discuss] IModel thread safety in.NET client
In-Reply-To: <32993492.1448.1318522678417.JavaMail.geo-discussion-forums@vbat14>
References: <65584f48-a6ac-48ea-b433-312b5a06bf3c@j34g2000prb.googlegroups.com>	<4E96DB26.5080206@rabbitmq.com>
	<32993492.1448.1318522678417.JavaMail.geo-discussion-forums@vbat14>
Message-ID: <4E971C9A.5050801@rabbitmq.com>

Hi,

On 13/10/11 17:17, TrueWill wrote:
> Thank you for your response.
> 
> I'm still confused, though. The rabbitmq-dotnet-client-2.6.1-user-guide
> states (p. 11):
> 
> "Application callback handlers /must not/ invoke blocking AMQP
> operations (such as
> IModel.QueueDeclare, IModel.BasicCancel or IModel.BasicPublish). If they
> do, the channel
> will deadlock."
> 
> Could you please clarify?

Yes. If you issue any synchronous commands from a handler then the
channel will immediately deadlock. Publish could deadlock only if
channel flow was asserted by the broker, but recent versions of the
broker (since 2.0.0) use TCP back pressure instead of channel
flow-control. If you want interoperability with other brokers that might
use channel flow-control then you should avoid publish within a handler.

Be aware that TCP back pressure will block asynchronous methods like
ack, without causing the channel to deadlock, and back pressure affects
all channels sharing the connection.

The safest approach is to use the QueueingBasicConsumer with BasicQos to
prevent the client from receiving too many messages at once.



-Emile

From maxjwarnock at gmail.com  Thu Oct 13 18:17:40 2011
From: maxjwarnock at gmail.com (Max Warnock)
Date: Thu, 13 Oct 2011 13:17:40 -0400
Subject: [rabbitmq-discuss] problems updating to new client library
Message-ID: <CAApCF478UBc1T-Z-vhov3S23qG9sOwLU+=wPraA4T702vdkD6g@mail.gmail.com>

I've just swapped out the whole amqp_client infrastructure in my erlang
application to the latest release. It looks like there were significant
changes to the infrastructure but the api remains almost identical (the
network vs direct connection being the only exception I've found).  But now
I'm getting an error in code that used to work about my subscription.  My
code looks like this:


%% Queue is a binary name, Listener is a PID and State is a dictionary
containing various things including the channel PID
subscribe(Queue,Listener,State) ->
    Sub = #'basic.consume'{queue = Queue},
    #'basic.consume_ok'{consumer_tag = Tag} =
amqp_channel:subscribe(State:fetch(amqp_channel_pid), Sub, Listener),
    {ok, Tag}.


This worked with the previous version of the library and I don't see any
difference in the docs (
http://www.rabbitmq.com/erlang-client-user-guide.html) now it produces the
following error:

 {{function_clause,
                      [{amqp_selective_consumer,handle_consume_ok,
                           [{'basic.consume_ok',
                                <<"amq.ctag-yC9CxaknYwPrAYj5hCChPQ==">>},

 {'basic.consume',0,<<"harbinger-dm-hipaa">>,<<>>,
                                false,false,false,false,[]},
                            {state,
                                {dict,0,16,16,8,80,48,
                                    {[],[],[],[],[],[],[],[],[],[],[],[],[],
                                     [],[],[]},

 {{[],[],[],[],[],[],[],[],[],[],[],[],[],
                                      [],[],[]}}},
                                hipaa,
                                {dict,0,16,16,8,80,48,
                                    {[],[],[],[],[],[],[],[],[],[],[],[],[],
                                     [],[],[]},

 {{[],[],[],[],[],[],[],[],[],[],[],[],[],
                                      [],[],[]}}},
                                none}]},
                       {amqp_gen_consumer,handle_call,3},
                       {gen_server2,handle_msg,2},
                       {proc_lib,init_p_do_apply,3}]},
                  {gen_server2,call,
                      [<0.181.0>,
                       {consumer_call,
                           {'basic.consume_ok',
                               <<"amq.ctag-yC9CxaknYwPrAYj5hCChPQ==">>},
                           {'basic.consume',0,<<"harbinger-dm-hipaa">>,<<>>,
                               false,false,false,false,[]}},
                       infinity]}}

There is a clause in the new docs that explains the difference between the
selective consumer and the direct consumer. Based on that description it
seems like everything used to be a direct consumer and that's what I should
be using, but I don't see any docs on how to use it. I explored the rabbit
headers and couldn't find anything that would let me select it. The only
mention of it I found was when selective consumer is set as the default.

Thanks,
-Max
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111013/f2ec2be1/attachment.htm>

From jon at jbrisbin.com  Thu Oct 13 18:20:58 2011
From: jon at jbrisbin.com (Jon Brisbin)
Date: Thu, 13 Oct 2011 12:20:58 -0500 (CDT)
Subject: [rabbitmq-discuss] Bitcask Message Store Index
In-Reply-To: <967AC52C-8881-4F0F-BD11-A58A54701067@gmail.com>
Message-ID: <6c825090-3319-4d6d-95a3-d0767bb5d23d@jbrisbin.local>

----- Original Message -----

> Do you have a riak_core wrapper for the rabbitmq-public-umbrella?
No. I used rebar and the rebar-ized fork of rabbit-common and created a plugin that way. There was also some manual mucking around to get the riak_core deps into managable .ez files. 

Thanks! 

Jon Brisbin 
http//jbrisbin.com 

> Cheers,

> Alvaro

> On Oct 13, 2011, at 5:10 PM, Jon Brisbin wrote:

> > FWIW- I've gotten riak_core to run inside RabbitMQ as a plugin. I
> > had
> > thought I might experiment with a riak_core-backed queue. I never
> > really got time to fiddle with it.
> 

> > There's lots of things you can use riak_core inside RabbitMQ for. I
> > was thinking particularly of using the riak_core snowflake unique
> > id
> > generator among other things...
> 

> > Thanks!
> 

> > Jon Brisbin
> 
> > http//jbrisbin.com
> 

> > ----- Original Message -----
> 

> > > From: "Alvaro Videla" < videlalvaro at gmail.com >
> > 
> 
> > > To: "Matthias Radestock" < matthias at rabbitmq.com >
> > 
> 
> > > Cc: rabbitmq-discuss at lists.rabbitmq.com
> > 
> 
> > > Sent: Thursday, October 13, 2011 6:18:40 AM
> > 
> 
> > > Subject: Re: [rabbitmq-discuss] Bitcask Message Store Index
> > 
> 

> > > Matthias,
> > 
> 

> > > On Oct 13, 2011, at 10:46 AM, Matthias Radestock wrote:
> > 
> 

> > > > I doubt bitcask would perform any better than the default
> > > > msg_store, since the latter has been highly tuned for
> > > > queue-like
> > > > access patterns. One area where bitcask might excel is recovery
> > > > time, particularly after an unclean shutdown / crash.
> > 
> 

> > > I totally agree regarding the implementation of the msg_store. I
> > > think that putting another database(MySQL, Redis, Riak) behind a
> > > queue could bring a severe performance problem. Having said that
> > > what do you think of putting a layer on top of the
> > > rabbit_msg_store
> > > that could add replication/clustering a la riak_core? So the idea
> > > here is to use the same storage backend that the variable queue
> > > uses
> > > but coordinating read/writes using riak_core. (Keep in mind this
> > > is
> > > not riak_kv the database known as Riak).
> > 
> 

> > > Regards,
> > 
> 

> > > Alvaro
> > 
> 
> > > _______________________________________________
> > 
> 
> > > rabbitmq-discuss mailing list
> > 
> 
> > > rabbitmq-discuss at lists.rabbitmq.com
> > 
> 
> > > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > 
> 

> Sent form my Nokia 1100
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111013/4dde17c7/attachment.htm>

From pdezwart at rubiconproject.com  Thu Oct 13 18:31:48 2011
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Thu, 13 Oct 2011 12:31:48 -0500
Subject: [rabbitmq-discuss] Debugging queue.declare
In-Reply-To: <4E96BE49.80104@rabbitmq.com>
Message-ID: <CABC6E49.24CE0%pdezwart@rubiconproject.com>

Wow. I thought it was in seconds for some reason. That?s 2hrs of my life I
wont get back =)

I guess it all works just fine then.
Thanks!
me

On 10/13/11 3:32 AM, "Simon MacMullen" <simon at rabbitmq.com> wrote:

>On 13/10/11 11:24, Simon MacMullen wrote:
>> On 13/10/11 01:51, Pieter de Zwart wrote:
>>> The rabbitmq logs show nothing? well, they show that I
>>> connected and then disconnected. Nothing else of interest.
>>
>> Really? Wow. Is your code accessible somewhere and runnable by someone
>> who knows nothing about PHP? We should definitely be logging something.
>
>...unless, as Matthias points out, the queue is simply expiring before
>you see it and everything is working as designed. Bear in mind that the
>expiry time you provide must be in *milliseconds*.
>
>Cheers, Simon
>
>-- 
>Simon MacMullen
>RabbitMQ, VMware
>_______________________________________________
>rabbitmq-discuss mailing list
>rabbitmq-discuss at lists.rabbitmq.com
>https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From yluppo at leads360.com  Thu Oct 13 20:00:18 2011
From: yluppo at leads360.com (Yann Luppo)
Date: Thu, 13 Oct 2011 12:00:18 -0700
Subject: [rabbitmq-discuss] Consume
Message-ID: <8882CFE4FFAF3F4E8814F0E61F2919A30ABF7B2D@l360xch01.office.leads360.com>

Hi,

 

I'm currently trying to setup RabbitMQ for my company and we have 1
publisher pushing to 1 queue, pretty simple so far. 

But we have lots of consumers, potentially up to a hundred, reading that
queue. Reason being the processing of each of those messages can take a
long time.

 

To clarify, in our current scenario after processing, the consumer logic
requeues the message. The goal is to have a given set of messages being
processed over and over again in a cycle.

 

We're using the .Net client library and we quickly favored the consumer
approach:

 

QueueingBasicConsumer consumer = new
QueueingBasicConsumer(this.channel);

string consumerTag = this.channel.BasicConsume(this.queueName, noAck,
consumer);

 

But we ran into issues where the messages were getting dropped. I payed
attention to make sure we were doing the necessary ACK and/or NACK to
make sure a message always gets processed.

After a while I decided that my implementation was flawed somewhere, so
for a test I simplified the code and started using the Subscription
object:

 

Subscription subscription = new Subscription(this.channel,
this.queueName, false);

 

foreach (BasicDeliverEventArgs e in subscription)
{
  if (!e.Redelivered)
    ...
}
 
 

The problem w/ this approach is all our consumers read all the
messages.... Instead of just dequeuing in a round-robin fashion.

 

Could someone point me in the right direction for using RabbitMQ to do a
round-robin-like distribution?

 

Thanks,

Yann

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111013/66544771/attachment.htm>

From bmurphy1976 at gmail.com  Thu Oct 13 21:28:39 2011
From: bmurphy1976 at gmail.com (Bryan Murphy)
Date: Thu, 13 Oct 2011 15:28:39 -0500
Subject: [rabbitmq-discuss] HA active/active cluster in a bad state
In-Reply-To: <20111013154800.GC22178@rabbitmq.com>
References: <CAP+1M2cL8G99Pj1+VF3HG=eLTTXTSFE5gcifXRDY4xQJfW4ESw@mail.gmail.com>
	<20111004215916.GA23024@wellquite.org>
	<CAP+1M2eAWFJM7BXH1do2e=DtzbfxiCegaL=jiBBX6DE9tXxfVA@mail.gmail.com>
	<20111013153328.GB22178@rabbitmq.com>
	<CAP+1M2dLO2mmRMWXk_9PJu4rW04TVHYa++FTVm6rAvj92xXeuQ@mail.gmail.com>
	<20111013154800.GC22178@rabbitmq.com>
Message-ID: <CAP+1M2dKnBfAx2+V6d6b-HenDAyq0mdu2c7dx+Pyb0B00U232g@mail.gmail.com>

On Thu, Oct 13, 2011 at 10:48 AM, Matthew Sackman <matthew at rabbitmq.com>wrote:

> On Thu, Oct 13, 2011 at 10:44:43AM -0500, Bryan Murphy wrote:
> > I'll try to get it into a bad state later today.  If I can manage that, I
> > can easily grant temporary remote access to anybody who needs it.
>
> That'd be great, many thanks. However, please note that almost all of
> the Rabbit team is in London, UK, and so there's the usual fun-and-games
> with timezones...
>
> Matthew
>

I've managed to get it into a bad state, but yet again the behavior is
inconsistent with what I've seen before.  Now, I've got the following
behavior:

/etc/init.d/rabbitmq-server stop works
/etc/init.d/rabbitmq-server start never exits

rabbitmqctl list_queues works
rabbitmqctl cluster_status works

Sending messages to the server fails:

WARNING:root:Traceback (most recent call last):
  File "/usr/local/lib/python2.7/dist-packages/mediafly/bus/__init__.py",
line 111, in publish
    connection = pika.BlockingConnection(host)
  File
"/usr/local/lib/python2.7/dist-packages/pika/adapters/blocking_connection.py",
line 32, in __init__
    BaseConnection.__init__(self, parameters, None, reconnection_strategy)
  File
"/usr/local/lib/python2.7/dist-packages/pika/adapters/base_connection.py",
line 50, in __init__
    reconnection_strategy)
  File "/usr/local/lib/python2.7/dist-packages/pika/connection.py", line
170, in __init__
    self._connect()
  File "/usr/local/lib/python2.7/dist-packages/pika/connection.py", line
228, in _connect
    self.parameters.port or  spec.PORT)
  File
"/usr/local/lib/python2.7/dist-packages/pika/adapters/blocking_connection.py",
line 36, in _adapter_connect
    BaseConnection._adapter_connect(self, host, port)
  File
"/usr/local/lib/python2.7/dist-packages/pika/adapters/base_connection.py",
line 58, in _adapter_connect
    self.socket.connect((host, port))
  File "/usr/lib/python2.7/socket.py", line 224, in meth
    return getattr(self._sock,name)(*args)
error: [Errno 111] Connection refused

I was able to get it into this state by repeatedly stopping and/or killing
the first node in the cluster and restarting it while simultaneously trying
various ways of tickling it with our application.

startup_log is getting stuck at "starting database" but there's no activity
going on in the cluster and I'd be surprised if I've sent >100 messages
since I provisioned it.

I can provide remote access to whomever needs it, I just need their public
ssh key.

Thanks,
Bryan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111013/b5f13bcf/attachment.htm>

From kvs at sigterm.ru  Thu Oct 13 22:29:16 2011
From: kvs at sigterm.ru (Konstantin Sorokin)
Date: Thu, 13 Oct 2011 14:29:16 -0700 (PDT)
Subject: [rabbitmq-discuss] Debugging queue.declare
In-Reply-To: <CABBCD1F.24C29%pdezwart@rubiconproject.com>
References: <5C8B491C-C223-4171-A66C-D7E6A70EF1A3@gmail.com>
	<CABBCD1F.24C29%pdezwart@rubiconproject.com>
Message-ID: <21798826.2213.1318541356868.JavaMail.geo-discussion-forums@vbmh5>

Actually you can use tcpdump to capture and save (look up for the -w 
argument) network stream into the file and then examine it on the machine 
with GUI.

On Thursday, October 13, 2011 10:03:34 AM UTC+4, Pieter de Zwart wrote:
>
> Im building this on a remote unix box, so I would first have to get X
> setup before I go all GUI on it. Ill give the command line a shot I guess.
> Thanks for the suggestion!
>
 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111013/130d0036/attachment.htm>

From matthew at rabbitmq.com  Thu Oct 13 23:07:31 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 13 Oct 2011 23:07:31 +0100
Subject: [rabbitmq-discuss] HA active/active cluster in a bad state
In-Reply-To: <CAP+1M2dKnBfAx2+V6d6b-HenDAyq0mdu2c7dx+Pyb0B00U232g@mail.gmail.com>
References: <CAP+1M2cL8G99Pj1+VF3HG=eLTTXTSFE5gcifXRDY4xQJfW4ESw@mail.gmail.com>
	<20111004215916.GA23024@wellquite.org>
	<CAP+1M2eAWFJM7BXH1do2e=DtzbfxiCegaL=jiBBX6DE9tXxfVA@mail.gmail.com>
	<20111013153328.GB22178@rabbitmq.com>
	<CAP+1M2dLO2mmRMWXk_9PJu4rW04TVHYa++FTVm6rAvj92xXeuQ@mail.gmail.com>
	<20111013154800.GC22178@rabbitmq.com>
	<CAP+1M2dKnBfAx2+V6d6b-HenDAyq0mdu2c7dx+Pyb0B00U232g@mail.gmail.com>
Message-ID: <20111013220730.GA31224@wellquite.org>

On Thu, Oct 13, 2011 at 03:28:39PM -0500, Bryan Murphy wrote:
> startup_log is getting stuck at "starting database" but there's no activity
> going on in the cluster and I'd be surprised if I've sent >100 messages
> since I provisioned it.
> 
> I can provide remote access to whomever needs it, I just need their public
> ssh key.

Ok, well I've just got home now and am about to turn in for the night.
I'll try and be in touch tomorrow and see if we can sort this out. I
might be able to reproduce it tomorrow anyway, given your description -
actually sounds more like mnesia might be refusing to rejoin rather than
anything specific to do with HA.

Matthew

From manoj.uid at gmail.com  Fri Oct 14 07:45:48 2011
From: manoj.uid at gmail.com (manojbarot1)
Date: Thu, 13 Oct 2011 23:45:48 -0700 (PDT)
Subject: [rabbitmq-discuss]  Getting Error with management plugin
Message-ID: <32650454.post@talk.nabble.com>


Hi,

I have install rabbitmq vesion 2.6.1 and downloaded all the required
plugins, however when i restart rabbitmq it fails, please help.

[root at xxxxxxxx plugins]# cat /var/log/rabbitmq/startup_log 
Activating RabbitMQ plugins ...

********************************************************************************
*WARNING* Undefined function erlang:max/2
*WARNING* Undefined function mochihex:to_hex/1
*WARNING* Undefined function mochijson:encode/1
*WARNING* Undefined function mochijson2:decode/1
*WARNING* Undefined function mochijson2:encode/1
*WARNING* Undefined function mochiweb_cookies:parse_cookie/1
*WARNING* Undefined function mochiweb_headers:empty/0
*WARNING* Undefined function mochiweb_headers:enter/3
*WARNING* Undefined function mochiweb_headers:from_list/1
*WARNING* Undefined function mochiweb_headers:get_value/2
*WARNING* Undefined function mochiweb_headers:insert/3
*WARNING* Undefined function mochiweb_headers:make/1
*WARNING* Undefined function mochiweb_headers:to_list/1
*WARNING* Undefined function mochiweb_html:escape/1
*WARNING* Undefined function mochiweb_http:start/1
*WARNING* Undefined function mochiweb_http:stop/1
*WARNING* Undefined function mochiweb_io:iodevice_size/1
*WARNING* Undefined function mochiweb_socket:peername/1
*WARNING* Undefined function mochiweb_socket:recv/3
*WARNING* Undefined function mochiweb_socket:send/2
*WARNING* Undefined function mochiweb_socket:setopts/2
*WARNING* Undefined function mochiweb_util:make_io/1
*WARNING* Undefined function mochiweb_util:parse_qs/1
*WARNING* Undefined function mochiweb_util:quote_plus/1
*WARNING* Undefined function mochiweb_util:rand_bytes/1
*WARNING* Undefined function mochiweb_util:unquote/1
*WARNING* Undefined function mochiweb_util:urlsplit_path/1
*WARNING* Undefined function ssl:ssl_accept/3
*WARNING* Undefined function unicode:characters_to_binary/3
********************************************************************************

5 plugins activated:
* amqp_client-2.6.1
* rabbitmq_management-2.6.1.jquery-fix
* rabbitmq_management_agent-2.6.1
* rabbitmq_mochiweb-2.6.1
* webmachine-1.7.0-rmq2.6.1-hg0c4b60a


+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
|   v2.6.1  +---+   |
|                   |
+-------------------+
AMQP 0-9-1 / 0-9 / 0-8
Copyright (C) 2007-2011 VMware, Inc.
Licensed under the MPL.  See http://www.rabbitmq.com/

node           : rabbit at xxxxxxx
app descriptor :
/usr/lib/rabbitmq/lib/rabbitmq_server-2.6.1/sbin/../ebin/rabbit.app
home dir       : /var/lib/rabbitmq
config file(s) : (none)
cookie hash    : pEejRRSrvjjMJTV/Di0BDA==
log            : /var/log/rabbitmq/rabbit at xxxxxxx.log
sasl log       : /var/log/rabbitmq/rabbit at xxxxxxx-sasl.log
database dir   : /var/lib/rabbitmq/mnesia/rabbit at xxxxxxx
erlang version : 5.6.5

-- rabbit boot start
starting file handle cache server                                    
...done
starting worker pool                                                 
...done
starting database                                                    
...done
starting codec correctness check                                     
...done
-- external infrastructure ready
starting statistics event manager                                    
...done
starting logging server                                              
...done
starting plugin registry                                             
...done
starting auth mechanism amqplain                                     
...done
starting auth mechanism cr-demo                                      
...done
starting auth mechanism plain                                        
...done
starting exchange type direct                                        
...done
starting exchange type fanout                                        
...done
starting exchange type headers                                       
...done
starting exchange type topic                                         
...done
-- kernel ready
starting node monitor                                                
...done
starting cluster delegate                                            
...done
starting guid generator                                              
...done
starting alarm handler                                               
...done
starting memory monitor                                              
...done
-- core initialized
starting empty DB check                                              
...done
starting management agent                                            
...done
starting exchange, queue and binding recovery                        
...done
starting mirror queue slave sup                                      
...done
starting adding mirrors to queues                                    
...done
-- message delivery logic ready
starting error log relay                                             
...done
starting networking                                                  
...done
starting notify cluster nodes                                        
...done
starting direct_client                                               
...done

broker running
** Found 0 name clashes in code paths 
{"Kernel pid
terminated",application_controller,"{application_start_failure,rabbitmq_management,{bad_return,{{rabbit_mgmt_app,start,[normal,[]]},{'EXIT',{{{case_clause,{error,{{'EXIT',{undef,[{mochiweb_http,start,[[{name,rabbit_mochiweb_web_mgmt},{loop,#Fun<rabbit_mochiweb_web.0.41935527>},{port,55672}]]},{supervisor,do_start_child,2},{supervisor,handle_start_child,2},{supervisor,handle_call,3},{gen_server,handle_msg,5},{proc_lib,init_p_do_apply,3}]}},{child,undefined,{rabbit_mochiweb_web,mgmt},{rabbit_mochiweb_web,start,[{mgmt,[{port,55672}]}]},permanent,5000,worker,dynamic}}}},[{rabbit_mochiweb_sup,ensure_listener,1},{rabbit_mochiweb_registry,handle_call,3},{gen_server,handle_msg,5},{proc_lib,init_p_do_apply,3}]},{gen_server,call,[rabbit_mochiweb_registry,{add,rabbit_mgmt,#Fun<rabbit_mochiweb.2.38440353>,#Fun<rabbit_mochiweb.0.117123974>,{[],[82,97,98,98,105,116,77,81,32,77,97,110,97,103,101,109,101,110,116]}},infinity]}}}}}}"}

Regards,
Manoj
-- 
View this message in context: http://old.nabble.com/Getting-Error-with-management-plugin-tp32650454p32650454.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From matthias at rabbitmq.com  Fri Oct 14 10:14:35 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 14 Oct 2011 10:14:35 +0100
Subject: [rabbitmq-discuss] Getting Error with management plugin
In-Reply-To: <32650454.post@talk.nabble.com>
References: <32650454.post@talk.nabble.com>
Message-ID: <4E97FD7B.6060408@rabbitmq.com>

Manoj,

On 14/10/11 07:45, manojbarot1 wrote:
  > I have install rabbitmq vesion 2.6.1 and downloaded all the required
> plugins, however when i restart rabbitmq it fails, please help.

There are two problems...

> *WARNING* Undefined function erlang:max/2

1) Your version of Erlang is too old. As shown by ...

> erlang version : 5.6.5

... which is R12B-5. You need at least R13B01 in order to run the 
management plug-in. See http://www.rabbitmq.com/which-erlang.html.

> *WARNING* Undefined function mochihex:to_hex/1
> [etc]

2) You did not install the 'mochiweb' plug-in, only 'rabbitmq_mochiweb'. 
The latter depends on the former.


Regards,

Matthias.

From manoj.uid at gmail.com  Fri Oct 14 10:17:08 2011
From: manoj.uid at gmail.com (manojbarot1)
Date: Fri, 14 Oct 2011 02:17:08 -0700 (PDT)
Subject: [rabbitmq-discuss] Getting Error with management plugin
In-Reply-To: <4E97FD7B.6060408@rabbitmq.com>
References: <32650454.post@talk.nabble.com> <4E97FD7B.6060408@rabbitmq.com>
Message-ID: <32651116.post@talk.nabble.com>


Got it,

Thanks for your help.

Regards,
Manoj


Matthias Radestock-3 wrote:
> 
> Manoj,
> 
> On 14/10/11 07:45, manojbarot1 wrote:
>   > I have install rabbitmq vesion 2.6.1 and downloaded all the required
>> plugins, however when i restart rabbitmq it fails, please help.
> 
> There are two problems...
> 
>> *WARNING* Undefined function erlang:max/2
> 
> 1) Your version of Erlang is too old. As shown by ...
> 
>> erlang version : 5.6.5
> 
> ... which is R12B-5. You need at least R13B01 in order to run the 
> management plug-in. See http://www.rabbitmq.com/which-erlang.html.
> 
>> *WARNING* Undefined function mochihex:to_hex/1
>> [etc]
> 
> 2) You did not install the 'mochiweb' plug-in, only 'rabbitmq_mochiweb'. 
> The latter depends on the former.
> 
> 
> Regards,
> 
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://old.nabble.com/Getting-Error-with-management-plugin-tp32650454p32651116.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From emile at rabbitmq.com  Fri Oct 14 10:33:03 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 14 Oct 2011 10:33:03 +0100
Subject: [rabbitmq-discuss] Consume
In-Reply-To: <8882CFE4FFAF3F4E8814F0E61F2919A30ABF7B2D@l360xch01.office.leads360.com>
References: <8882CFE4FFAF3F4E8814F0E61F2919A30ABF7B2D@l360xch01.office.leads360.com>
Message-ID: <4E9801CF.8080607@rabbitmq.com>

Hi Yann,

On 13/10/11 20:00, Yann Luppo wrote:

> To clarify, in our current scenario after processing, the consumer logic
> requeues the message. The goal is to have a given set of messages being
> processed over and over again in a cycle.

That sounds unusual. What is the criteria for stopping processing? A
different pattern for multiple rounds of processing is to have a queue
for each round of processing and for consumers to republish the message
to the next queue in a chain.

You should also avoid relying on the current (v 2.6.1) requeue behaviour
of rabbit which requeues messages at the back of the queue. To guarantee
that messages return to the back of the queue you should acknowledge and
republish instead of requeue.

> After a while I decided that my implementation was flawed somewhere, so
> for a test I simplified the code and started using the Subscription object:

[...]

> The problem w/ this approach is all our consumers read all the
> messages?. Instead of just dequeuing in a round-robin fashion.
> 
> Could someone point me in the right direction for using RabbitMQ to do a
> round-robin-like distribution?

If you have multiple subscriptions to the same queue then consider
setting qos on the channel before creating the Subscription (see
IModel.BasicQos). Internally Subscription uses a QueueingBasicConsumer
which will receive all the messages in the queue unless qos is set.



-Emile

From jamesdear at gmail.com  Fri Oct 14 10:36:23 2011
From: jamesdear at gmail.com (James Dear)
Date: Fri, 14 Oct 2011 10:36:23 +0100
Subject: [rabbitmq-discuss] Implementing Prioritised Queues
In-Reply-To: <50a1cb16-acef-4712-943f-9f2e758a777a@u18g2000yqb.googlegroups.com>
References: <CAEo4zpckgE2pN6d+J0NuC2XJPQduiF2C6rzFcgq8GOcYVR8Ttw@mail.gmail.com>
	<CANVKUrVKpoWEnrqcKLyp7zx9RWD5=WgtACi0kL+a4kKLfBva0Q@mail.gmail.com>
	<CAEo4zpdZztoEL20TJW3aTaF85+BLAKOdr4j2Z4L_h7E0XuQO_Q@mail.gmail.com>
	<50a1cb16-acef-4712-943f-9f2e758a777a@u18g2000yqb.googlegroups.com>
Message-ID: <CAEo4zpfe=Z1s0QSMPNcGDx5QkgoKyXs+RRP_Myb0qAg8STvGBA@mail.gmail.com>

Thanks Doug, that's really helpful.

It's kind of a pity that you have to go to such an elaborate setup
client-side when I guess it (prioritizing different queues within a
channel) would be a small feature to add server side. Can anyone
familiar with the rabbitmq source comment on how difficult this might
be to do?

James

On 13 October 2011 16:24, Doug Barth <dougbarth at gmail.com> wrote:
> I wrote up a blog post a while ago explaining how we approximate
> priority using separate queues in our application. We've had this
> setup in production for over 2 years now, and it works great.
>
> ?http://dougbarth.github.com/2011/07/01/approximating-priority-with-rabbitmq.html
>
> Hope that helps!
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From matthias at rabbitmq.com  Fri Oct 14 10:43:34 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 14 Oct 2011 10:43:34 +0100
Subject: [rabbitmq-discuss] Implementing Prioritised Queues
In-Reply-To: <CAEo4zpfe=Z1s0QSMPNcGDx5QkgoKyXs+RRP_Myb0qAg8STvGBA@mail.gmail.com>
References: <CAEo4zpckgE2pN6d+J0NuC2XJPQduiF2C6rzFcgq8GOcYVR8Ttw@mail.gmail.com>	<CANVKUrVKpoWEnrqcKLyp7zx9RWD5=WgtACi0kL+a4kKLfBva0Q@mail.gmail.com>	<CAEo4zpdZztoEL20TJW3aTaF85+BLAKOdr4j2Z4L_h7E0XuQO_Q@mail.gmail.com>	<50a1cb16-acef-4712-943f-9f2e758a777a@u18g2000yqb.googlegroups.com>
	<CAEo4zpfe=Z1s0QSMPNcGDx5QkgoKyXs+RRP_Myb0qAg8STvGBA@mail.gmail.com>
Message-ID: <4E980446.5060202@rabbitmq.com>

James,

On 14/10/11 10:36, James Dear wrote:
> It's kind of a pity that you have to go to such an elaborate setup
> client-side when I guess it (prioritizing different queues within a
> channel) would be a small feature to add server side. Can anyone
> familiar with the rabbitmq source comment on how difficult this might
> be to do?

Very difficult indeed.

Channels do not pull messages off queues. Queues send messages to channels.

Matthias.

From jamesdear at gmail.com  Fri Oct 14 11:09:22 2011
From: jamesdear at gmail.com (James Dear)
Date: Fri, 14 Oct 2011 11:09:22 +0100
Subject: [rabbitmq-discuss] Implementing Prioritised Queues
In-Reply-To: <4E980446.5060202@rabbitmq.com>
References: <CAEo4zpckgE2pN6d+J0NuC2XJPQduiF2C6rzFcgq8GOcYVR8Ttw@mail.gmail.com>
	<CANVKUrVKpoWEnrqcKLyp7zx9RWD5=WgtACi0kL+a4kKLfBva0Q@mail.gmail.com>
	<CAEo4zpdZztoEL20TJW3aTaF85+BLAKOdr4j2Z4L_h7E0XuQO_Q@mail.gmail.com>
	<50a1cb16-acef-4712-943f-9f2e758a777a@u18g2000yqb.googlegroups.com>
	<CAEo4zpfe=Z1s0QSMPNcGDx5QkgoKyXs+RRP_Myb0qAg8STvGBA@mail.gmail.com>
	<4E980446.5060202@rabbitmq.com>
Message-ID: <CAEo4zpdE8cyD-CNcLqyhHHobQ+o4gxKdhZK7Sc1ctZ_mWV1FMg@mail.gmail.com>

Oh I see :(

How does QoS manage to load-balance multiple queues within a channel?
I thought the queue consulted the limiter before delivering a new
message...in that case could one add a little bit of logic to the
limiter to prefer one queue over another? I believe there is already
some logic in the limiter that tracks rejection rates per
queue...could this be implemented as an extension to that?

James

On 14 October 2011 10:43, Matthias Radestock <matthias at rabbitmq.com> wrote:
> James,
>
> On 14/10/11 10:36, James Dear wrote:
>>
>> It's kind of a pity that you have to go to such an elaborate setup
>> client-side when I guess it (prioritizing different queues within a
>> channel) would be a small feature to add server side. Can anyone
>> familiar with the rabbitmq source comment on how difficult this might
>> be to do?
>
> Very difficult indeed.
>
> Channels do not pull messages off queues. Queues send messages to channels.
>
> Matthias.
>

From simon at rabbitmq.com  Fri Oct 14 11:25:55 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 14 Oct 2011 11:25:55 +0100
Subject: [rabbitmq-discuss] problems updating to new client library
In-Reply-To: <CAApCF478UBc1T-Z-vhov3S23qG9sOwLU+=wPraA4T702vdkD6g@mail.gmail.com>
References: <CAApCF478UBc1T-Z-vhov3S23qG9sOwLU+=wPraA4T702vdkD6g@mail.gmail.com>
Message-ID: <4E980E33.60007@rabbitmq.com>

Hi Max.

On 13/10/11 18:17, Max Warnock wrote:
> I've just swapped out the whole amqp_client infrastructure in my erlang
> application to the latest release. It looks like there were significant
> changes to the infrastructure but the api remains almost identical (the
> network vs direct connection being the only exception I've found).  But
> now I'm getting an error in code that used to work about my
> subscription.  My code looks like this:
>
>
> %% Queue is a binary name, Listener is a PID and State is a dictionary
> containing various things including the channel PID
> subscribe(Queue,Listener,State) ->
>      Sub = #'basic.consume'{queue = Queue},
>      #'basic.consume_ok'{consumer_tag = Tag} =
> amqp_channel:subscribe(State:fetch(amqp_channel_pid), Sub, Listener),
>      {ok, Tag}.
>
>
> This worked with the previous version of the library and I don't see any
> difference in the docs
> (http://www.rabbitmq.com/erlang-client-user-guide.html)

It should work the same.

> now it produces the following error:
>
>   {{function_clause,
<snip>

So it looks like amqp_selective_consumer is getting into a state where 
it thinks your consumer (which should be a pid) is the atom 'hipaa'. 
This is just what gets passed in to the third argument of 
amqp_channel:subscribe/3. Unfortunately nothing enforces this until we 
get a consume_ok back from the server. Are you sure you are passing in a 
pid there?

> There is a clause in the new docs that explains the difference between
> the selective consumer and the direct consumer. Based on that
> description it seems like everything used to be a direct consumer and
> that's what I should be using,

No, it used to be a selective consumer and that's what I should be using 
(if you don't want to change anything). Selective is the default.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From matthias at rabbitmq.com  Fri Oct 14 11:42:37 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 14 Oct 2011 11:42:37 +0100
Subject: [rabbitmq-discuss] Implementing Prioritised Queues
In-Reply-To: <CAEo4zpdE8cyD-CNcLqyhHHobQ+o4gxKdhZK7Sc1ctZ_mWV1FMg@mail.gmail.com>
References: <CAEo4zpckgE2pN6d+J0NuC2XJPQduiF2C6rzFcgq8GOcYVR8Ttw@mail.gmail.com>	<CANVKUrVKpoWEnrqcKLyp7zx9RWD5=WgtACi0kL+a4kKLfBva0Q@mail.gmail.com>	<CAEo4zpdZztoEL20TJW3aTaF85+BLAKOdr4j2Z4L_h7E0XuQO_Q@mail.gmail.com>	<50a1cb16-acef-4712-943f-9f2e758a777a@u18g2000yqb.googlegroups.com>	<CAEo4zpfe=Z1s0QSMPNcGDx5QkgoKyXs+RRP_Myb0qAg8STvGBA@mail.gmail.com>	<4E980446.5060202@rabbitmq.com>
	<CAEo4zpdE8cyD-CNcLqyhHHobQ+o4gxKdhZK7Sc1ctZ_mWV1FMg@mail.gmail.com>
Message-ID: <4E98121D.2070309@rabbitmq.com>

James,

On 14/10/11 11:09, James Dear wrote:
> Oh I see :(
>
> How does QoS manage to load-balance multiple queues within a channel?
> I thought the queue consulted the limiter before delivering a new
> message

indeed they do, but only when qos is enabled.

> ...in that case could one add a little bit of logic to the
> limiter to prefer one queue over another?

Then the feature would only work for qos channels. Such 
non-orthogonality is usually a bad idea.

And it's not clear how this would work even in the restricted qos-only 
case. For one, the limiter has no idea whether a queue contains more 
messages. I can think of a few other complications too.

It would probably be easier to implement priority queues instead. And 
yes, that's quite difficult too.


Matthias.

From mikeb at rabbitmq.com  Fri Oct 14 12:07:14 2011
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Fri, 14 Oct 2011 12:07:14 +0100
Subject: [rabbitmq-discuss] Implementing Prioritised Queues
In-Reply-To: <CAEo4zpdE8cyD-CNcLqyhHHobQ+o4gxKdhZK7Sc1ctZ_mWV1FMg@mail.gmail.com>
References: <CAEo4zpckgE2pN6d+J0NuC2XJPQduiF2C6rzFcgq8GOcYVR8Ttw@mail.gmail.com>	<CANVKUrVKpoWEnrqcKLyp7zx9RWD5=WgtACi0kL+a4kKLfBva0Q@mail.gmail.com>	<CAEo4zpdZztoEL20TJW3aTaF85+BLAKOdr4j2Z4L_h7E0XuQO_Q@mail.gmail.com>	<50a1cb16-acef-4712-943f-9f2e758a777a@u18g2000yqb.googlegroups.com>	<CAEo4zpfe=Z1s0QSMPNcGDx5QkgoKyXs+RRP_Myb0qAg8STvGBA@mail.gmail.com>	<4E980446.5060202@rabbitmq.com>
	<CAEo4zpdE8cyD-CNcLqyhHHobQ+o4gxKdhZK7Sc1ctZ_mWV1FMg@mail.gmail.com>
Message-ID: <4E9817E2.9020708@rabbitmq.com>

> How does QoS manage to load-balance multiple queues within a channel?
> I thought the queue consulted the limiter before delivering a new
> message...in that case could one add a little bit of logic to the
> limiter to prefer one queue over another? I believe there is already
> some logic in the limiter that tracks rejection rates per
> queue...could this be implemented as an extension to that?

Not really, it's "one phase commit" -- the queue says "will you take 
this message?" and the limiter either commits and gets the message, or 
doesn't and is thereafter considered blocked.  Thus there's no 
opportunity to defer acceptance.

Prioritising consumers for a queue would be easier I think, but sadly 
that is the one permutation that no-one seems to need.

-Michael


> On 14 October 2011 10:43, Matthias Radestock<matthias at rabbitmq.com>  wrote:
>> James,
>>
>> On 14/10/11 10:36, James Dear wrote:
>>>
>>> It's kind of a pity that you have to go to such an elaborate setup
>>> client-side when I guess it (prioritizing different queues within a
>>> channel) would be a small feature to add server side. Can anyone
>>> familiar with the rabbitmq source comment on how difficult this might
>>> be to do?
>>
>> Very difficult indeed.
>>
>> Channels do not pull messages off queues. Queues send messages to channels.
>>
>> Matthias.
>>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From videlalvaro at gmail.com  Fri Oct 14 12:38:25 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 14 Oct 2011 13:38:25 +0200
Subject: [rabbitmq-discuss] Enabling plugins with latest umbrella
Message-ID: <061D5E1A-564E-40B9-9E73-A1AD35B5D2B8@gmail.com>

Hi,

Is there anything to declare in plugins using the latest umbrella? Whenever I run make run-in-broker with my 'msg_store_bitcask_index' plugin it failes with this error:

{"init terminating in do_boot",{badarg,[{io_lib,format,["Error: ~s~n",[{'EXIT',{{badmatch,{error,{edge,{bad_edge,[msg_store_bitcask_index,msg_store_bitcask_index]},msg_store_bitcask_index,msg_store_bitcask_index}}},[{rabbit_plugins,calculate_dependencies,3},{rabbit_plugins,action,5},{rabbit_plugins,start,0},{init,start_it,1},{init,start_em,1}]}}]]},{rabbit_misc,format_stderr,2},{rabbit_plugins,start,0},{init,start_it,1},{init,start_em,1}]}}

But if I build the .ez files and drop them inside the plugins folder of a Rabbit 2.6.1 installation the plugin works.

Any ideas what do I need to change?

Cheers,

Alvaro

From simon at rabbitmq.com  Fri Oct 14 12:49:20 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 14 Oct 2011 12:49:20 +0100
Subject: [rabbitmq-discuss] Enabling plugins with latest umbrella
In-Reply-To: <061D5E1A-564E-40B9-9E73-A1AD35B5D2B8@gmail.com>
References: <061D5E1A-564E-40B9-9E73-A1AD35B5D2B8@gmail.com>
Message-ID: <4E9821C0.2080901@rabbitmq.com>

On 14/10/11 12:38, Alvaro Videla wrote:
> Is there anything to declare in plugins using the latest umbrella?

No, however there quite a bit of plugins stuff has changed. In 
particular, plugins now need to be "enabled" in order to start. "make 
run-in-broker" will do this for you, but one thing that happens as a 
consequence is rabbit will figure out the transitive dependencies of 
your plugin and try to activate them.

And that's what's breaking. Unfortunately our error reporting here seems 
slightly broken, which needs a bit of attention. But the fundamental 
problem is that your plugin declares:

   {applications, [kernel, stdlib, msg_store_bitcask_index]}

in its app file - i.e. it depends on itself. Which is not going to work.

Cheers, Simon

> Whenever I run make run-in-broker with my 'msg_store_bitcask_index'
> plugin it failes with this error:
>
> {"init terminating in do_boot",{badarg,[{io_lib,format,["Error:
> ~s~n",[{'EXIT',{{badmatch,{error,{edge,{bad_edge,[msg_store_bitcask_index,msg_store_bitcask_index]},msg_store_bitcask_index,msg_store_bitcask_index}}},[{rabbit_plugins,calculate_dependencies,3},{rabbit_plugins,action,5},{rabbit_plugins,start,0},{init,start_it,1},{init,start_em,1}]}}]]},{rabbit_misc,format_stderr,2},{rabbit_plugins,start,0},{init,start_it,1},{init,start_em,1}]}}
>
>  But if I build the .ez files and drop them inside the plugins folder
> of a Rabbit 2.6.1 installation the plugin works.
>
> Any ideas what do I need to change?
>
> Cheers,
>
> Alvaro _______________________________________________
> rabbitmq-discuss mailing list rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From videlalvaro at gmail.com  Fri Oct 14 13:00:02 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 14 Oct 2011 14:00:02 +0200
Subject: [rabbitmq-discuss] Enabling plugins with latest umbrella
In-Reply-To: <4E9821C0.2080901@rabbitmq.com>
References: <061D5E1A-564E-40B9-9E73-A1AD35B5D2B8@gmail.com>
	<4E9821C0.2080901@rabbitmq.com>
Message-ID: <40BCC9AE-61EB-4222-A68E-81E2399A6A07@gmail.com>

Hi Simon,

On Oct 14, 2011, at 1:49 PM, Simon MacMullen wrote:

> And that's what's breaking. Unfortunately our error reporting here seems slightly broken, which needs a bit of attention. But the fundamental problem is that your plugin declares:
> 
>  {applications, [kernel, stdlib, msg_store_bitcask_index]}
> 
> in its app file - i.e. it depends on itself. Which is not going to work.

Well, that's a bit embarrassing on my side. I think I meant to put this {applications, [kernel, stdlib, bitcask]}. 

Anyway now it's fixed and it works.

Cheers,

Alvaro

From matthew at rabbitmq.com  Fri Oct 14 13:27:51 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 14 Oct 2011 13:27:51 +0100
Subject: [rabbitmq-discuss] System CPU spikes, multi-second latency
In-Reply-To: <CAK5JfkgZEXBN5sPMVE+ePAoPtBV08fqS6_J2yZrvpdkQYLekZg@mail.gmail.com>
References: <CAK5JfkgZEXBN5sPMVE+ePAoPtBV08fqS6_J2yZrvpdkQYLekZg@mail.gmail.com>
Message-ID: <20111014122750.GA19481@rabbitmq.com>

Hi Ben,

[ liberally snipped ]

Many thanks for the detailed report and your thorough investigation.

On Wed, Oct 12, 2011 at 10:41:25PM -0500, Ben Rady wrote:
> These episodes last from just a couple of seconds up to a minute, and seem
> to happen randomly, sometimes coming one right after another, sometimes
> hours apart. We've never seen it less than once a day.

Very odd - we've not seen anything like that before. Are there any
entries in the Rabbit logs during this period?

> ==What we've already done==
> 
> 1) Troubleshooting using strace
...
> The first system call logged for 21860 occurs at 21:13:53. However, notice
> the timestamp and 4.4 second execution time for the futex call in the other
> thread (21862). All of the straces for the threads were started at the same
> time (using the -ff option) and a number of other threads have a similar
> call around 21:13:48.6635 as their first logged system call (within a few
> milliseconds). This leads me to believe that whatever 21860 is doing during
> this time, it's working in a single system call rather
> than repeatedly calling in a loop.

This is really very odd indeed. When Rabbit is blocking on IO, I
normally expect to see top showing that the CPU is blocking waiting, not
in system. Other than reading and writing to files and sockets, Rabbit
doesn't really do a great deal more *explicitly* that will result in
system calls - thus it's very likely this is something odd happening
with the Erlang VM itself.

The fact that apparently the whole Erlang VM blocks during this
operation is deeply worrying.

> 2) Reproducing the problem in a controlled environment
> 
> This problem only seems to occur in our production environments, but not in
> any test environments. The software and hardware in the two environments are
> identical. We've used data recorded from our prod environment to try and
> reproduce the problem in test (with higher load, even), but no luck so far.

Just in case it's a hardware issue then, are you able to try swapping
the machines over?

I'd also suggest running for a few days without the web API just to see
if that makes any difference. I'd also suggest using your own
self-compiled Erlang just in case there's some issue with the
Erlang-from-RPM that you're using. Also, R14B04 has just come out, and
it would be good to verify the problem still occurs with that.

During these pauses, is the rest of the machine responsive? Can you
generally do things that access the disks of the machine?

One thing that I've seen several times over the last couple of years
(and it now fills me with dread whenever I see it) is when a hard disk
starts to fail, the machine starts exhibiting pauses of several seconds
whilst it resets the drive controller and starts again. That said
though, that a) tends to produce a very very high load average (over
100 very quickly), and b) top shows blocked on waiting, not blocked on
system.

If it is some futex though that's taking a long time to return (maybe
associated with some core part of the erlang scheduler), I wonder if
that points to some bad RAM somewhere. I take it there are no
corresponding entries in dmesg or such like?

> I've got more data on this if anyone wants to hear it. Thanks in advance for
> your help.

Definitely - as I say, we've not seen this before, and it smells to me
like a problem that may lie outside of Rabbit itself - especially given
the fact it seems reticent to occur in your testing env.

It's also been suggested that you might just have too much RAM, and too
many cores, and should send some to us instead. ;)

Best wishes,

Matthew

From jamesdear at gmail.com  Fri Oct 14 13:39:49 2011
From: jamesdear at gmail.com (James Dear)
Date: Fri, 14 Oct 2011 13:39:49 +0100
Subject: [rabbitmq-discuss] Implementing Prioritised Queues
In-Reply-To: <4E98121D.2070309@rabbitmq.com>
References: <CAEo4zpckgE2pN6d+J0NuC2XJPQduiF2C6rzFcgq8GOcYVR8Ttw@mail.gmail.com>
	<CANVKUrVKpoWEnrqcKLyp7zx9RWD5=WgtACi0kL+a4kKLfBva0Q@mail.gmail.com>
	<CAEo4zpdZztoEL20TJW3aTaF85+BLAKOdr4j2Z4L_h7E0XuQO_Q@mail.gmail.com>
	<50a1cb16-acef-4712-943f-9f2e758a777a@u18g2000yqb.googlegroups.com>
	<CAEo4zpfe=Z1s0QSMPNcGDx5QkgoKyXs+RRP_Myb0qAg8STvGBA@mail.gmail.com>
	<4E980446.5060202@rabbitmq.com>
	<CAEo4zpdE8cyD-CNcLqyhHHobQ+o4gxKdhZK7Sc1ctZ_mWV1FMg@mail.gmail.com>
	<4E98121D.2070309@rabbitmq.com>
Message-ID: <CAEo4zpeYgkMtUsaNNsJBh-4KJ_3N7Wpe-=qJTApdEf=aJpCJHg@mail.gmail.com>

> Then the feature would only work for qos channels. Such non-orthogonality is usually a bad idea.

Not too sure about this, but I can't see any reason why you *would*
want prioritization between queues and *wouldn't* want rate limiting
(QoS). With no rate limiting you would just suck up all of both queues
anyway(?), rendering prioritization irrelevant.

> It would probably be easier to implement priority queues instead.

Also I don't see prioritization *between queues* as solving the same
problem as prioritizing *within a single queue*. The former allows
recipient-defined priorities whereas the latter allows sender-defined
priority. The global 1-10 priority feature of AMQP looks kind of
deficient in this respect. Both Alice and Bob should be able to
prioritize their own messages as higher than their colleagues',
allowing them to share their compute resources while not surrendering
burst capacity and not suffering tragedy-of-commons. This isn't
possible with 'global' single-queue priorities, but is easily achieved
with 'subjective' prioritization between queues.

> And yes, that's quite difficult too.

I imagine that prioritization within a single queue is difficult to
implement efficiently because you are (very roughly speaking) doing a
kind of sort operation (or at least some kind of compare) on
potentially millions of items. By prioritizing between queues you are
only comparing between a handful of different queues (in this case
only two).

It's admittedly a bit of a hack, but you could (?) implement this
through the limiter by way of a prefetch *per queue*, similar in style
to Doug's client-side solution. If your low priority queue has a
prefetch of 1 and your high priority queue has a prefetch of 2 (or
higher), then low priority messages will be blocked until all the high
priority messages have gone through.

James

On 14 October 2011 11:42, Matthias Radestock <matthias at rabbitmq.com> wrote:
> James,
>
> On 14/10/11 11:09, James Dear wrote:
>>
>> Oh I see :(
>>
>> How does QoS manage to load-balance multiple queues within a channel?
>> I thought the queue consulted the limiter before delivering a new
>> message
>
> indeed they do, but only when qos is enabled.
>
>> ...in that case could one add a little bit of logic to the
>> limiter to prefer one queue over another?
>
> Then the feature would only work for qos channels. Such non-orthogonality is
> usually a bad idea.
>
> And it's not clear how this would work even in the restricted qos-only case.
> For one, the limiter has no idea whether a queue contains more messages. I
> can think of a few other complications too.
>
> It would probably be easier to implement priority queues instead. And yes,
> that's quite difficult too.
>
>
> Matthias.
>

From yluppo at leads360.com  Fri Oct 14 17:40:28 2011
From: yluppo at leads360.com (Yann Luppo)
Date: Fri, 14 Oct 2011 09:40:28 -0700
Subject: [rabbitmq-discuss] Consume
In-Reply-To: <4E9801CF.8080607@rabbitmq.com>
References: <8882CFE4FFAF3F4E8814F0E61F2919A30ABF7B2D@l360xch01.office.leads360.com>
	<4E9801CF.8080607@rabbitmq.com>
Message-ID: <8882CFE4FFAF3F4E8814F0E61F2919A30ABF7E27@l360xch01.office.leads360.com>

Perfect! Merci Emile! :)

-----Original Message-----
From: Emile Joubert [mailto:emile at rabbitmq.com] 
Sent: Friday, October 14, 2011 2:33 AM
To: Yann Luppo
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Consume

Hi Yann,

On 13/10/11 20:00, Yann Luppo wrote:

> To clarify, in our current scenario after processing, the consumer
logic
> requeues the message. The goal is to have a given set of messages
being
> processed over and over again in a cycle.

That sounds unusual. What is the criteria for stopping processing? A
different pattern for multiple rounds of processing is to have a queue
for each round of processing and for consumers to republish the message
to the next queue in a chain.

You should also avoid relying on the current (v 2.6.1) requeue behaviour
of rabbit which requeues messages at the back of the queue. To guarantee
that messages return to the back of the queue you should acknowledge and
republish instead of requeue.

> After a while I decided that my implementation was flawed somewhere,
so
> for a test I simplified the code and started using the Subscription
object:

[...]

> The problem w/ this approach is all our consumers read all the
> messages.... Instead of just dequeuing in a round-robin fashion.
> 
> Could someone point me in the right direction for using RabbitMQ to do
a
> round-robin-like distribution?

If you have multiple subscriptions to the same queue then consider
setting qos on the channel before creating the Subscription (see
IModel.BasicQos). Internally Subscription uses a QueueingBasicConsumer
which will receive all the messages in the queue unless qos is set.



-Emile

From shenyute at gmail.com  Sat Oct 15 07:22:25 2011
From: shenyute at gmail.com (Yu-Teh Shen)
Date: Sat, 15 Oct 2011 14:22:25 +0800
Subject: [rabbitmq-discuss] Pika add x-ha-policy with nodes arguments
Message-ID: <CABWH_X4FR=TE_8hK-T0KKM+xqWDq=ceiLd2AejnRBUBUETR8gw@mail.gmail.com>

Hello, I try to use HA feature with pika python client API>

But it will not success when I tried to use "nodes" instead of "all" as the
arguments in "x-ha-policy".

The code is like the following:
=======================================
    channel.queue_declare(queue="test_topic", durable=True,
                          exclusive=False, auto_delete=False,
                          arguments={'x-ha-policy': 'nodes',
'x-ha-policy-params':
                            ['rabbit at test1', 'rabbit at test2']},
                          callback=on_queue_declared)

=======================================

How do I do if I want to use "x-ha-policy" with "nodes"?

It works when I set "x-ha-policy" to "all" and I didn't use
"x-ha-policy-params" at all.

Thanks

Shen, Yu-Teh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111015/6f838b72/attachment.htm>

From shenyute at gmail.com  Sat Oct 15 10:11:44 2011
From: shenyute at gmail.com (Yu-Teh Shen)
Date: Sat, 15 Oct 2011 17:11:44 +0800
Subject: [rabbitmq-discuss] RabbitMQ HA queue declaration fail
Message-ID: <CABWH_X79JKgZ5n3UXguQn0QQDyAOGKTH0mxLRHkk7EiXPv9dYA@mail.gmail.com>

Hello, I got the following error when I tried to declare mirror-queue with
"nodes" on "x-ha-policy" argument.

I have run cluster with 3 nodes from rabbit at lab001 to lab003.

I run the following java code.
============================================
           Connection conn = test.CreateConn("guest", "guest", "/test",
"127.0.0.1", 5672);
            Channel chl = conn.createChannel();
            chl.exchangeDeclare(exchangeName, "direct", true);

            Map<String, Object> args = new HashMap<String, Object>();
            args.put("x-ha-policy", "nodes");
            args.put("x-ha-policy-params", Arrays.asList("rabbit at lab001",
"rabbit at lab002"));
            chl.queueDeclare(queueName, false, false, false, args);
            chl.queueBind(queueName, exchangeName, routingKey);

============================================

=ERROR REPORT==== 15-Oct-2011::15:46:07 ===
** Generic server <0.6599.4> terminating
** Last message in was {init,false}
** When Server state == {q,{amqqueue,

 {resource,<<"/test">>,queue,<<"test.queue2">>},
                               false,false,none,
                               [{<<"x-ha-policy-params">>,array,
                                 [{longstr,<<"rabbit at lab001">>},
                                  {longstr,<<"rabbit at lab002">>}]},
                                {<<"x-ha-policy">>,longstr,<<"nodes">>}],
                               <0.6599.4>,[],
                               [rabbit at lab002]},
                           none,false,rabbit_mirror_queue_master,undefined,
                           {[],[]},
                           {[],[]},
                           undefined,undefined,undefined,undefined,
                           {state,fine,5000,undefined},
                           {dict,0,16,16,8,80,48,

 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []},

 {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []}}},
                           undefined,undefined}
** Reason for termination ==
** {badarg,[{erlang,binary_to_list,[rabbit at lab002]},
            {rabbit_mirror_queue_master,'-init/3-lc$^0/1-0-',1},
            {rabbit_mirror_queue_master,init,3},
            {rabbit_amqqueue_process,declare,3},
            {gen_server2,handle_msg,2},
            {proc_lib,init_p_do_apply,3}]}


Shen, Yu-Teh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111015/6a1f88d0/attachment.htm>

From matthew at rabbitmq.com  Sat Oct 15 12:51:53 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Sat, 15 Oct 2011 12:51:53 +0100
Subject: [rabbitmq-discuss] Pika add x-ha-policy with nodes arguments
In-Reply-To: <CABWH_X4FR=TE_8hK-T0KKM+xqWDq=ceiLd2AejnRBUBUETR8gw@mail.gmail.com>
References: <CABWH_X4FR=TE_8hK-T0KKM+xqWDq=ceiLd2AejnRBUBUETR8gw@mail.gmail.com>
Message-ID: <20111015115152.GA23216@wellquite.org>

On Sat, Oct 15, 2011 at 02:22:25PM +0800, Yu-Teh Shen wrote:
> But it will not success when I tried to use "nodes" instead of "all" as the
> arguments in "x-ha-policy".

Yes, apparently that's broken in 2.6.0 and 2.6.1. There'll be a fix in
the next release. Until then, it's "all" only, I'm afraid, unless you
are comfortable compiling the broker from source.

Matthew

From matthias at rabbitmq.com  Sat Oct 15 13:00:09 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 15 Oct 2011 13:00:09 +0100
Subject: [rabbitmq-discuss] Pika add x-ha-policy with nodes arguments
In-Reply-To: <20111015115152.GA23216@wellquite.org>
References: <CABWH_X4FR=TE_8hK-T0KKM+xqWDq=ceiLd2AejnRBUBUETR8gw@mail.gmail.com>
	<20111015115152.GA23216@wellquite.org>
Message-ID: <4E9975C9.7050305@rabbitmq.com>

On 15/10/11 12:51, Matthew Sackman wrote:
> On Sat, Oct 15, 2011 at 02:22:25PM +0800, Yu-Teh Shen wrote:
>> But it will not success when I tried to use "nodes" instead of "all" as the
>> arguments in "x-ha-policy".
>
> Yes, apparently that's broken in 2.6.0 and 2.6.1.

See 
http://old.nabble.com/HA-queue-seems-never-to-get-fully-created-td32529015.html#a32582000

Matthias.

From shenyute at gmail.com  Sat Oct 15 16:13:31 2011
From: shenyute at gmail.com (Yu-Teh Shen)
Date: Sat, 15 Oct 2011 23:13:31 +0800
Subject: [rabbitmq-discuss] Pika add x-ha-policy with nodes arguments
In-Reply-To: <4E9975C9.7050305@rabbitmq.com>
References: <CABWH_X4FR=TE_8hK-T0KKM+xqWDq=ceiLd2AejnRBUBUETR8gw@mail.gmail.com>
	<20111015115152.GA23216@wellquite.org>
	<4E9975C9.7050305@rabbitmq.com>
Message-ID: <CABWH_X7iM3HANgGCAX7B=q_PCZOUszVRWK7DQufYXXNuj1ryCg@mail.gmail.com>

Thanks!

Is there any issue tracker for RabbitMQ?

Maybe next time I can check on this at first.

Shen, Yu-Teh


On Sat, Oct 15, 2011 at 8:00 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> On 15/10/11 12:51, Matthew Sackman wrote:
>
>> On Sat, Oct 15, 2011 at 02:22:25PM +0800, Yu-Teh Shen wrote:
>>
>>> But it will not success when I tried to use "nodes" instead of "all" as
>>> the
>>> arguments in "x-ha-policy".
>>>
>>
>> Yes, apparently that's broken in 2.6.0 and 2.6.1.
>>
>
> See http://old.nabble.com/HA-**queue-seems-never-to-get-**
> fully-created-td32529015.html#**a32582000<http://old.nabble.com/HA-queue-seems-never-to-get-fully-created-td32529015.html#a32582000>
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111015/a57c2fb9/attachment.htm>

From matthias at rabbitmq.com  Sat Oct 15 16:17:03 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 15 Oct 2011 16:17:03 +0100
Subject: [rabbitmq-discuss] Pika add x-ha-policy with nodes arguments
In-Reply-To: <CABWH_X7iM3HANgGCAX7B=q_PCZOUszVRWK7DQufYXXNuj1ryCg@mail.gmail.com>
References: <CABWH_X4FR=TE_8hK-T0KKM+xqWDq=ceiLd2AejnRBUBUETR8gw@mail.gmail.com>	<20111015115152.GA23216@wellquite.org>	<4E9975C9.7050305@rabbitmq.com>
	<CABWH_X7iM3HANgGCAX7B=q_PCZOUszVRWK7DQufYXXNuj1ryCg@mail.gmail.com>
Message-ID: <4E99A3EF.8050700@rabbitmq.com>

On 15/10/11 16:13, Yu-Teh Shen wrote:
> Is there any issue tracker for RabbitMQ?

Yes, but it's not public.

> Maybe next time I can check on this at first.

It is usually a good idea to search the mailing list archives. That way 
you'll also find answers to problems that aren't bugs.

Matthias.

From kyleo at 0b10.mx  Sat Oct 15 17:07:53 2011
From: kyleo at 0b10.mx (Kyle O'Donnell)
Date: Sat, 15 Oct 2011 12:07:53 -0400 (EDT)
Subject: [rabbitmq-discuss] clustering behind a firewall
In-Reply-To: <07f98928-ee87-499b-a090-f0878a8bd9c5@mx1.0b10.mx>
Message-ID: <feeb0490-455f-4d3a-8c23-504aace07fce@mx1.0b10.mx>

Hi,

I just moved one of my rabbit nodes into a firewalled network and am trying to figure out why the communication between the nodes is happening on ports that I haven't configured.  The cluster appears to be functioning normally now that I've opened all the appropriate ports, but still seeing ports used that I haven't defined. 

(ports 5672,4369 and range 58000-62000 are opened in both directions between all nodes)

Here is my config file:
[
  {kernel,
        [{inet_dist_listen_min, 58000},
        {inet_dist_listen_max, 62000}
        ]
  },
  {rabbit,
        [{cluster_nodes,                ['rabbit at node1', 'rabbit at node2', 'rabbit at node3','rabbit at node4', 'rabbit at node5', 'rabbit at node6', 'rabbit at node7', 'rabbit at node8']}
        ]
  }
].


Here is the traffic I am seeing on node2, watching for traffic from node1:

10:34:38.024623 IP node2.33420 > node1.4369: Flags [S], seq 1878005646, win 5840, options [mss 1460,nop,nop,sackOK,nop,wscale 10], length 0
10:34:38.025325 IP node1.4369 > node2.33420: Flags [S.], seq 2356457984, ack 1878005647, win 5840, options [mss 1380,nop,nop,sackOK,nop,wscale 10], length 0
10:34:38.025347 IP node2.33420 > node1.4369: Flags [.], ack 1, win 6, length 0
10:34:38.025414 IP node2.33420 > node1.4369: Flags [P.], seq 1:10, ack 1, win 6, length 9
10:34:38.026103 IP node1.4369 > node2.33420: Flags [.], ack 10, win 6, length 0
10:34:38.026254 IP node1.4369 > node2.33420: Flags [P.], seq 1:21, ack 10, win 6, length 20
10:34:38.026261 IP node2.33420 > node1.4369: Flags [.], ack 21, win 6, length 0
10:34:38.026279 IP node1.4369 > node2.33420: Flags [F.], seq 21, ack 10, win 6, length 010:34:38.026528 IP node2.33420 > node1.4369: Flags [F.], seq 10, ack 22, win 6, length 0
10:34:38.026622 IP node2.45073 > node1.58000: Flags [S], seq 1877745630, win 5840, options [mss 1460,nop,nop,sackOK,nop,wscale 10], length 0
10:34:38.026855 IP node1.4369 > node2.33420: Flags [.], ack 11, win 6, length 010:34:41.026136 IP node2.45073 > node1.58000: Flags [S], seq 1877745630, win 5840, options [mss 1460,nop,nop,sackOK,nop,wscale 10], length 0


I see the attempt on port 58000 (as specified), but I also see ports in the 30000 range.  I've restarted rabbit on both nodes and find that that the 30000 is a randomized port (I've seen it in the 30000,40000,50000, and 60000 range).

Is that normal?

Thanks,
Kyle

From benbennett at gmail.com  Sat Oct 15 22:52:16 2011
From: benbennett at gmail.com (Benjamin Bennett)
Date: Sat, 15 Oct 2011 16:52:16 -0500
Subject: [rabbitmq-discuss] Windows Server 2003 Server Cluster Hack Active
	/Passive
Message-ID: <CAGnU7ujhz=SbfUqff2QqTh1wVaJUv=Q-modvby5=ozamGgOzmg@mail.gmail.com>

I seen this older posting about rabbitmq in windows server
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2010-August/008559.html
 .

I just wanted to pass it along if it hasn't been done already. I am
pretty sure I know what the user was trying to do .

In a Windows Server Cluster , there is a Cluster Administrator that
allows adding generic windows services to the cluster.

The only hang up in with default service installer is the actual
service name has a guid appended to the name.

So trying to add it as a Generic Cluster Service fails because it
needs to have the exact same service name on all nodes.

So in our cluster we have shared disk that the rabbitmq data is stored
on (scsi multi path between the two machines) .

I had to hack by calling the erlsrv directly just adding the rabbitmq
service and then calling the service installer .

So my steps were :

1) Set the RABBITMQ_BASE to a shared disk path that is cluster
resource in the windows clustering admin tool
2) Install erlang on all nodes in the active passive cluster
3) Set the RABBITMQ_NODE_IP_ADDRESS to the clustered ip address .
4) Set the RABBITMQ_NODENAME to the some form of the cluster hostname
example node0 at cluster_dns_name
5) Hack probably better way to do this but call the erlsrv add
RabbitMq -i RabbitMq
6) Call the rabbitmq windows service installer
7) Shut down rabbitmq on the current node
8) Fail over the shared hostname,disk resources  to the next node to
install on , repeat the steps above
9) After all nodes have the RabbitMq service installed , add a generic
service in the cluster administrator , set the dependencies on the
shared ip, hostname and disk, call it RabbitMq

That is what I got Active / Passive clustering to work on a two node
Windows 2003 Server cluster . It is failing over back and forth as
expected.

From yoavglazner at gmail.com  Sat Oct 15 23:16:50 2011
From: yoavglazner at gmail.com (yoav glazner)
Date: Sun, 16 Oct 2011 00:16:50 +0200
Subject: [rabbitmq-discuss] rabbitmq-discuss Digest, Vol 53, Issue 15
In-Reply-To: <mailman.1.1318676401.19509.rabbitmq-discuss@lists.rabbitmq.com>
References: <mailman.1.1318676401.19509.rabbitmq-discuss@lists.rabbitmq.com>
Message-ID: <CAJ78kjNLGNcHKG8c5jA-t9e_3FQ59obrEbg_eqPZ5pefh8ULCA@mail.gmail.com>

>
> > How does QoS manage to load-balance multiple queues within a channel?
> > I thought the queue consulted the limiter before delivering a new
> > message...in that case could one add a little bit of logic to the
> > limiter to prefer one queue over another? I believe there is already
> > some logic in the limiter that tracks rejection rates per
> > queue...could this be implemented as an extension to that?
>
> Not really, it's "one phase commit" -- the queue says "will you take
> this message?" and the limiter either commits and gets the message, or
> doesn't and is thereafter considered blocked.  Thus there's no
> opportunity to defer acceptance.
>
> Prioritising consumers for a queue would be easier I think, but sadly
> that is the one permutation that no-one seems to need.
>
> -Michael
>

Can one create a Prioritised "topic exchange"?
msg1 topic= 0.0.0.1 #first
msg2 topic= 0.0.0.3 #4th
msg3 topic= 0.0.0.2 #2nd
msg4 topic= 0.0.0.4 #3rd
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111016/3c130798/attachment.htm>

From kyle.burton at gmail.com  Sun Oct 16 16:25:33 2011
From: kyle.burton at gmail.com (Kyle R. Burton)
Date: Sun, 16 Oct 2011 11:25:33 -0400
Subject: [rabbitmq-discuss] Configuration: rabbitmq_mochiweb should be
	rabbitmq_mochiweb_web?
Message-ID: <CANP+8r=QBfZ--iQ5btOPR2f6A-Viv3cGSRo+GEr3bDkmE4JrWA@mail.gmail.com>

Hello,

I think there is a documentation inconsistency on:
http://www.rabbitmq.com/management.html#http-api related to setting
the http port the management api listens on.  It says to use:

   {rabbitmq_mochiweb, [{listeners, [{mgmt, [{port, 55555}]}]}]},


That didn't work for me.  I'm running 2 rabbitmq servers on the same
host, when I changed the above to:

   {rabbitmq_mochiweb_web, [{listeners, [{mgmt, [{port, 55555}]}]}]},

The two instances ran.

Is this the correct configuration or am I mis-reading the documentation?

Best Regards,

Kyle

-- 
Twitter: @kyleburton
Blog: http://asymmetrical-view.com/
Fun: http://snapclean.me/

From gil.strauss at gmail.com  Sun Oct 16 17:25:52 2011
From: gil.strauss at gmail.com (Gil Strauss)
Date: Sun, 16 Oct 2011 09:25:52 -0700 (PDT)
Subject: [rabbitmq-discuss] Durable Queue
Message-ID: <319bdd71-74a8-4e3a-8603-d8dbb2f612eb@b10g2000vbc.googlegroups.com>

Hello

If the queue is configured to be durable - is it being written to disk
every single enqueue/dequeue operation or a snapshot is taken every
configurable period of time?

Thanks,

Gil

From matthew at rabbitmq.com  Sun Oct 16 18:08:50 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Sun, 16 Oct 2011 18:08:50 +0100
Subject: [rabbitmq-discuss] Durable Queue
In-Reply-To: <319bdd71-74a8-4e3a-8603-d8dbb2f612eb@b10g2000vbc.googlegroups.com>
References: <319bdd71-74a8-4e3a-8603-d8dbb2f612eb@b10g2000vbc.googlegroups.com>
Message-ID: <20111016170849.GA24713@wellquite.org>

On Sun, Oct 16, 2011 at 09:25:52AM -0700, Gil Strauss wrote:
> If the queue is configured to be durable - is it being written to disk
> every single enqueue/dequeue operation or a snapshot is taken every
> configurable period of time?

Persistent msgs sent to durable queues may be written to disk. In
practise, unless the queue is empty and has non-blocked consumers who
are consuming with noAck=true, they'll probably be written to disk quite
promptly. If you use transactions or publisher confirms then you'll
actually get an indication back to the publisher when they have fully
been written to disk.

It's more on a batched-per-msg thing, rather than a snapshot thing.

Matthew

From matthias at rabbitmq.com  Sun Oct 16 22:52:56 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 16 Oct 2011 22:52:56 +0100
Subject: [rabbitmq-discuss] Configuration: rabbitmq_mochiweb should be
 rabbitmq_mochiweb_web?
In-Reply-To: <CANP+8r=QBfZ--iQ5btOPR2f6A-Viv3cGSRo+GEr3bDkmE4JrWA@mail.gmail.com>
References: <CANP+8r=QBfZ--iQ5btOPR2f6A-Viv3cGSRo+GEr3bDkmE4JrWA@mail.gmail.com>
Message-ID: <4E9B5238.1030301@rabbitmq.com>

Kyle,

On 16/10/11 16:25, Kyle R. Burton wrote:
> I think there is a documentation inconsistency on:
> http://www.rabbitmq.com/management.html#http-api related to setting
> the http port the management api listens on.  It says to use:
>
>     {rabbitmq_mochiweb, [{listeners, [{mgmt, [{port, 55555}]}]}]},

That is correct.

> That didn't work for me.  I'm running 2 rabbitmq servers on the same
> host, when I changed the above to:
>
>     {rabbitmq_mochiweb_web, [{listeners, [{mgmt, [{port, 55555}]}]}]},

That is incorrect. Where did you come across that? The only reference 
thrown up by google is this thread.

I suspect the reason the first config didn't work is that in order to 
avoid conflicts you'll also need to change the default_listener. See 
http://www.rabbitmq.com/mochiweb.html.

Regards,

Matthias.

From wangbin777 at gmail.com  Mon Oct 17 04:47:21 2011
From: wangbin777 at gmail.com (Wang Bin)
Date: Sun, 16 Oct 2011 20:47:21 -0700 (PDT)
Subject: [rabbitmq-discuss] [help] Why erlang client's connection has not
 timeout, but Java client does.
Message-ID: <8ace78f3-0b81-415c-b83a-89ece894058e@y22g2000pri.googlegroups.com>

In RabbitMQ java client, we can configure heartbeat or connection
timeout in ConnectionFactory class.

But in erlang client, #amqp_params_network only has heartbeat, and we
can't configure the connection timeout.

Could someone explain to me?

In fact, I met a serious problem in my system recently.
When the network card is broken down in my rabbitmq server, my client
is blocked in trying to setup the connection. This is because we don't
set the connection timeout.

When we try to fix this issue, we just find the timout is only
available in Java client. So we don't know how to fix the same issue
in Erlang client.

Thank you very much!

From alfonso.pantoja at gmail.com  Mon Oct 17 08:59:41 2011
From: alfonso.pantoja at gmail.com (Alfonso Pantoja)
Date: Mon, 17 Oct 2011 00:59:41 -0700 (PDT)
Subject: [rabbitmq-discuss] Migration from 2.2.0 to 2.6.1 and cluster
In-Reply-To: <17d64dda-8c4d-4464-a90c-0c140aa8f7b3@j19g2000vbn.googlegroups.com>
References: <f1d4477d-8641-416a-a7df-a47c098882ec@q17g2000yqn.googlegroups.com>
	<20111007102957.GA9090@rabbitmq.com>
	<17d64dda-8c4d-4464-a90c-0c140aa8f7b3@j19g2000vbn.googlegroups.com>
Message-ID: <5443a64b-8c86-4498-8836-b69338c47a41@v15g2000vbm.googlegroups.com>

Matthew,

One more question.
Is enough to set the argument x-ha-policy to "all" for all the queues
or does the exchange require an argument too?

Thank you

Alfonso


On 7 oct, 14:33, Alfonso Pantoja <alfonso.pant... at gmail.com> wrote:
> On 7 oct, 12:29, Matthew Sackman <matt... at rabbitmq.com> wrote:
>
>
>
> > Yes, that is correct. Sadly, and this is probably a wart of AMQP, there
> > is no consideration of mutable queue probperties.
>
> True, mutable properties will be very useful when durable queues are
> used.
> Thank you for the info
>
> Cheers,
>
> Alfonso
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthias at rabbitmq.com  Mon Oct 17 09:02:24 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 17 Oct 2011 09:02:24 +0100
Subject: [rabbitmq-discuss] Migration from 2.2.0 to 2.6.1 and cluster
In-Reply-To: <5443a64b-8c86-4498-8836-b69338c47a41@v15g2000vbm.googlegroups.com>
References: <f1d4477d-8641-416a-a7df-a47c098882ec@q17g2000yqn.googlegroups.com>	<20111007102957.GA9090@rabbitmq.com>	<17d64dda-8c4d-4464-a90c-0c140aa8f7b3@j19g2000vbn.googlegroups.com>
	<5443a64b-8c86-4498-8836-b69338c47a41@v15g2000vbm.googlegroups.com>
Message-ID: <4E9BE110.2070200@rabbitmq.com>

Alfonso,

On 17/10/11 08:59, Alfonso Pantoja wrote:
> Is enough to set the argument x-ha-policy to "all" for all the queues
> or does the exchange require an argument too?

Just the queues. Exchanges are always mirrored across a cluster anyway.

Matthias.

From alfonso.pantoja at gmail.com  Mon Oct 17 09:09:37 2011
From: alfonso.pantoja at gmail.com (Alfonso Pantoja)
Date: Mon, 17 Oct 2011 01:09:37 -0700 (PDT)
Subject: [rabbitmq-discuss] Migration from 2.2.0 to 2.6.1 and cluster
In-Reply-To: <4E9BE110.2070200@rabbitmq.com>
References: <f1d4477d-8641-416a-a7df-a47c098882ec@q17g2000yqn.googlegroups.com>
	<20111007102957.GA9090@rabbitmq.com>
	<17d64dda-8c4d-4464-a90c-0c140aa8f7b3@j19g2000vbn.googlegroups.com>
	<5443a64b-8c86-4498-8836-b69338c47a41@v15g2000vbm.googlegroups.com>
	<4E9BE110.2070200@rabbitmq.com>
Message-ID: <3dc1538a-74e2-41a6-8679-3786bb704b84@u2g2000yqi.googlegroups.com>


Ok, perfect.
Thank you Matthew.

On 17 oct, 10:02, Matthias Radestock <matth... at rabbitmq.com> wrote:
> Alfonso,
>
> On 17/10/11 08:59, Alfonso Pantoja wrote:
>
> > Is enough to set the argument x-ha-policy to "all" for all the queues
> > or does the exchange require an argument too?
>
> Just the queues. Exchanges are always mirrored across aclusteranyway.
>
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From michael.s.klishin at gmail.com  Mon Oct 17 09:44:10 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 17 Oct 2011 12:44:10 +0400
Subject: [rabbitmq-discuss] [announcement] Introducing Langohr,
 a Clojure wrapper around RabbitMQ Java client
Message-ID: <CAE3HoVTk3V5-3zYT+XS=_cbZmxoX7kbMwqxX28b5-Qfs2KiYoQ@mail.gmail.com>

Hi!

For a couple of months I have been actively using and working on a [yet
another] Clojure library built on top of the RabbitMQ Java client. I think
it is time to announce it, even though it is not 1.0 yet and documentation
site is not yet public/finished. It is available on github at

https://github.com/michaelklishin/langohr

and is licensed under the Eclipse Public License.


As the README explains, the goal was to combine my experience of using Java
client for over a year with 3+ years of experience with Ruby amqp gem, both
as a user and now as a maintainer. So Langohr has features and ideas from
both, packaged in a library that is especially easy to use from Clojure.

Langohr supports all RabbitMQ extensions, has been in very active use since
August, used to interoperate with applications that use Ruby (amqp gem) and
C
(librabbitmq), has its own test suite (mostly to have examples, although it
did reveal some changes between RabbitMQ client 2.5 and 2.6 that I don't
believe
were announced in the 2.6.0 release notes) and documentation site is in the
works.

Langohr is certainly not the first Java client wrapper available for Clojure
but the most complete and one of the most polished ones. If you use RabbitMQ
with Clojure,
give it a try!
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111017/72db6ca4/attachment.htm>

From matthias at rabbitmq.com  Mon Oct 17 09:52:19 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 17 Oct 2011 09:52:19 +0100
Subject: [rabbitmq-discuss] [announcement] Introducing Langohr,
 a Clojure wrapper around RabbitMQ Java client
In-Reply-To: <CAE3HoVTk3V5-3zYT+XS=_cbZmxoX7kbMwqxX28b5-Qfs2KiYoQ@mail.gmail.com>
References: <CAE3HoVTk3V5-3zYT+XS=_cbZmxoX7kbMwqxX28b5-Qfs2KiYoQ@mail.gmail.com>
Message-ID: <4E9BECC3.4060207@rabbitmq.com>

Michael,

great choice of project name :)

On 17/10/11 09:44, Michael Klishin wrote:
> it did reveal some changes between RabbitMQ client 2.5 and 2.6 that I
> don't believe were announced in the 2.6.0 release notes

Please elaborate so we can figure out what went wrong when compiling the 
release notes.

Regards,

Matthias.

From emile at rabbitmq.com  Mon Oct 17 09:59:28 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 17 Oct 2011 09:59:28 +0100
Subject: [rabbitmq-discuss] clustering behind a firewall
In-Reply-To: <feeb0490-455f-4d3a-8c23-504aace07fce@mx1.0b10.mx>
References: <feeb0490-455f-4d3a-8c23-504aace07fce@mx1.0b10.mx>
Message-ID: <4E9BEE70.8050400@rabbitmq.com>

Hi Kyle,

On 15/10/11 17:07, Kyle O'Donnell wrote:
> 10:34:38.024623 IP node2.33420 > node1.4369:

> 10:34:38.026622 IP node2.45073 > node1.58000:

> I see the attempt on port 58000 (as specified), but I also see ports
> in the 30000 range.  I've restarted rabbit on both nodes and find
> that that the 30000 is a randomized port (I've seen it in the
> 30000,40000,50000, and 60000 range).
> 
> Is that normal?

Random source ports are normal. From your trace 33420 and 45073 were
allocated from the ephemeral port range. They should be allowed if your
firewall allows established connections. Different operating systems use
different ephemeral port ranges and the range might be configurable.

You may also find this useful:
http://www.rabbitmq.com/clustering.html#firewall


Emile

From michael.s.klishin at gmail.com  Mon Oct 17 10:03:30 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 17 Oct 2011 13:03:30 +0400
Subject: [rabbitmq-discuss] [announcement] Introducing Langohr,
 a Clojure wrapper around RabbitMQ Java client
In-Reply-To: <4E9BECC3.4060207@rabbitmq.com>
References: <CAE3HoVTk3V5-3zYT+XS=_cbZmxoX7kbMwqxX28b5-Qfs2KiYoQ@mail.gmail.com>
	<4E9BECC3.4060207@rabbitmq.com>
Message-ID: <CAE3HoVTpuG=HEmeqH1xKd9JWpZwVjsNoL2x8VEiJXGCv98yF6g@mail.gmail.com>

2011/10/17 Matthias Radestock <matthias at rabbitmq.com>

>
> Please elaborate so we can figure out what went wrong when compiling the
> release notes.
>
>
(re-sending to the list)
   I am talking about this API change:
https://github.com/michaelklishin/langohr/commit/1ec139dcc9151de23db84976400937efbfabcedb

It easily may be that I overlooked the announcement.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111017/20231579/attachment.htm>

From Waseem_Hawaldar at mindtree.com  Mon Oct 17 10:05:47 2011
From: Waseem_Hawaldar at mindtree.com (Waseem Hawaldar)
Date: Mon, 17 Oct 2011 09:05:47 +0000
Subject: [rabbitmq-discuss] Broken-pipe Exception
Message-ID: <192E282CAB256F41A2161A9E1BAA7C5EA9A9BA@MTW02MBX01.mindtree.com>

Hi Emile,

               I am using rabbitmq-server-2.2.0 and observing the below exception. This exception has occurred only after firing some 35000 messages to rabbitmq server, were around 30000 got processed successfully after which the following exception occurred. So, can you please provide me details on the below exception :


[ERROR] Caught exception in Exception Strategy: Broken pipe [connector.http.0.receiver.17] [DefaultExceptionStrategy]
java.net.SocketException: Broken pipe
at java.net.SocketOutputStream.socketWrite0(Native Method)
at java.net.SocketOutputStream.socketWrite(Unknown Source)
at java.net.SocketOutputStream.write(Unknown Source)
at java.io.DataOutputStream.write(Unknown Source)
at org.apache.commons.httpclient.ChunkedOutputStream.flushCache(ChunkedOutputStream.java:98)
at org.apache.commons.httpclient.ChunkedOutputStream.finish(ChunkedOutputStream.java:142)
at org.mule.transport.http.HttpServerConnection.writeResponse(HttpServerConnection.java:297)
at org.mule.transport.http.HttpMessageReceiver$HttpWorker.run(HttpMessageReceiver.java:190)
at org.mule.work.WorkerContext.run(WorkerContext.java:310)
at edu.emory.mathcs.backport.java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1061)
at edu.emory.mathcs.backport.java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:575)
at java.lang.Thread.run(Unknown Source)"



Thanks & Regards,
Waseem
    [Description: images.jpg]    91-9900588758
[Description: email-icon.jpg]waseem_hawaldar at mindtree.com<mailto:waseem_hawaldar at mindtree.com>


________________________________

http://www.mindtree.com/email/disclaimer.html
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111017/39d451a0/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.jpg
Type: image/jpeg
Size: 406 bytes
Desc: image001.jpg
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111017/39d451a0/attachment.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.jpg
Type: image/jpeg
Size: 1502 bytes
Desc: image002.jpg
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111017/39d451a0/attachment-0001.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image003.jpg
Type: image/jpeg
Size: 445 bytes
Desc: image003.jpg
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111017/39d451a0/attachment-0002.jpg>

From emile at rabbitmq.com  Mon Oct 17 10:20:26 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 17 Oct 2011 10:20:26 +0100
Subject: [rabbitmq-discuss] Broken-pipe Exception
In-Reply-To: <192E282CAB256F41A2161A9E1BAA7C5EA9A9BA@MTW02MBX01.mindtree.com>
References: <192E282CAB256F41A2161A9E1BAA7C5EA9A9BA@MTW02MBX01.mindtree.com>
Message-ID: <4E9BF35A.2030505@rabbitmq.com>

Hi Waseem,

On 17/10/11 10:05, Waseem Hawaldar wrote:

> I am using rabbitmq-server-2.2.0 and observing the below exception.
> This exception has occurred only after firing some 35000 messages to
> rabbitmq server, were around 30000 got processed successfully after
> which the following exception occurred. So, can you please provide me
> details on the below exception :

There is no RabbitMQ library code in the stack trace you provided. Are
you sure this problem was caused by the RabbitMQ java library? Are you
able to reproduce the problem using only the RabbitMQ java library?


-Emile

From simon at rabbitmq.com  Mon Oct 17 10:39:50 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 17 Oct 2011 10:39:50 +0100
Subject: [rabbitmq-discuss] Configuration: rabbitmq_mochiweb should be
 rabbitmq_mochiweb_web?
In-Reply-To: <4E9B5238.1030301@rabbitmq.com>
References: <CANP+8r=QBfZ--iQ5btOPR2f6A-Viv3cGSRo+GEr3bDkmE4JrWA@mail.gmail.com>
	<4E9B5238.1030301@rabbitmq.com>
Message-ID: <4E9BF7E6.40403@rabbitmq.com>

On 16/10/11 22:52, Matthias Radestock wrote:
>
> I suspect the reason the first config didn't work is that in order to
> avoid conflicts you'll also need to change the default_listener. See
> http://www.rabbitmq.com/mochiweb.html.

Depends which version the OP is running. In 2.6.x the default listener 
does not need to be reconfigured to avoid conflicts unless it's actually 
in use. (e.g for JSON-RPC)

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From matthias at rabbitmq.com  Mon Oct 17 10:56:50 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 17 Oct 2011 10:56:50 +0100
Subject: [rabbitmq-discuss] [announcement] Introducing Langohr,
 a Clojure wrapper around RabbitMQ Java client
In-Reply-To: <CAE3HoVTpuG=HEmeqH1xKd9JWpZwVjsNoL2x8VEiJXGCv98yF6g@mail.gmail.com>
References: <CAE3HoVTk3V5-3zYT+XS=_cbZmxoX7kbMwqxX28b5-Qfs2KiYoQ@mail.gmail.com>
	<4E9BECC3.4060207@rabbitmq.com>
	<CAE3HoVTpuG=HEmeqH1xKd9JWpZwVjsNoL2x8VEiJXGCv98yF6g@mail.gmail.com>
Message-ID: <4E9BFBE2.8080408@rabbitmq.com>

On 17/10/11 10:03, Michael Klishin wrote:
> 2011/10/17 Matthias Radestock <matthias at rabbitmq.com
> <mailto:matthias at rabbitmq.com>>
>     Please elaborate so we can figure out what went wrong when compiling
>     the release notes.
>
> (re-sending to the list)
> I am talking about this API change:
> https://github.com/michaelklishin/langohr/commit/1ec139dcc9151de23db84976400937efbfabcedb
>
> It easily may be that I overlooked the announcement.

"- cater for multiple listeners in all APIs". I guess we could have been 
clearer that this is an API change.

Matthias.

From paulcarlisle at comcast.net  Mon Oct 17 11:43:35 2011
From: paulcarlisle at comcast.net (SixDegrees)
Date: Mon, 17 Oct 2011 03:43:35 -0700 (PDT)
Subject: [rabbitmq-discuss]  How To Set User Celeryd Workers Run As
Message-ID: <32666069.post@talk.nabble.com>


Still slogging away at this stuff, still despairing that it will ever work.

Our latest problem: tasks launched via Django are expected to write to
various directories where normally only the apache user has permission. I am
getting a huge dump of 'Permission denied' errors in the celeryd log. I have
changed CELERYD_USER to 'apache' in both settings.py and
/etc/default/celeryd, and changed the user celeryd runs as to 'apache' in
the supervisord celeryd.ini file, restarting celeryd and apache after each
change, all to no avail.

I really don't want to open up permissions on these directories; up until
now, we've simply been using a system call to launch background tasks, and
that has worked perfectly with access granted only to apache.
-- 
View this message in context: http://old.nabble.com/How-To-Set-User-Celeryd-Workers-Run-As-tp32666069p32666069.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From paulcarlisle at comcast.net  Mon Oct 17 11:57:17 2011
From: paulcarlisle at comcast.net (SixDegrees)
Date: Mon, 17 Oct 2011 03:57:17 -0700 (PDT)
Subject: [rabbitmq-discuss] How To Set User Celeryd Workers Run As
In-Reply-To: <32666069.post@talk.nabble.com>
References: <32666069.post@talk.nabble.com>
Message-ID: <32666159.post@talk.nabble.com>


Additional note: I'm also restarting supervisord between changes, along with
everything else.


SixDegrees wrote:
> 
> Still slogging away at this stuff, still despairing that it will ever
> work.
> 
> Our latest problem: tasks launched via Django are expected to write to
> various directories where normally only the apache user has permission. I
> am getting a huge dump of 'Permission denied' errors in the celeryd log. I
> have changed CELERYD_USER to 'apache' in both settings.py and
> /etc/default/celeryd, and changed the user celeryd runs as to 'apache' in
> the supervisord celeryd.ini file, restarting celeryd and apache after each
> change, all to no avail.
> 
> I really don't want to open up permissions on these directories; up until
> now, we've simply been using a system call to launch background tasks, and
> that has worked perfectly with access granted only to apache.
> 

-- 
View this message in context: http://old.nabble.com/How-To-Set-User-Celeryd-Workers-Run-As-tp32666069p32666159.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From ask at celeryproject.org  Mon Oct 17 12:34:13 2011
From: ask at celeryproject.org (Ask Solem)
Date: Mon, 17 Oct 2011 12:34:13 +0100
Subject: [rabbitmq-discuss] How To Set User Celeryd Workers Run As
In-Reply-To: <32666069.post@talk.nabble.com>
References: <32666069.post@talk.nabble.com>
Message-ID: <4ACB4788-6DA4-4D69-A856-EF92B36A0FCF@celeryproject.org>



On Oct 17, 2011, at 11:43 AM, SixDegrees <paulcarlisle at comcast.net> wrote:

> 
> Still slogging away at this stuff, still despairing that it will ever work.
> 
> Our latest problem: tasks launched via Django are expected to write to
> various directories where normally only the apache user has permission. I am
> getting a huge dump of 'Permission denied' errors in the celeryd log. I have
> changed CELERYD_USER to 'apache' in both settings.py and
> /etc/default/celeryd, and changed the user celeryd runs as to 'apache' in
> the supervisord celeryd.ini file, restarting celeryd and apache after each
> change, all to no avail.
> 
> I really don't want to open up permissions on these directories; up ?until
> now, we've simply been using a system call to launch background tasks, and
> that has worked perfectly with access granted only to apache.

I'm sorry, CELERYD_USER is not a configuration option, it is however an environment variable read by the celeryd init scripts, but since you mention you're using supervisord, then this won't have any effect.

I'd bet there is an option for this in supervisord, which is what you would have to use.

Also, this isn't related to RabbitMQ, so it would be nice if you moved such discussion to the celery-users mailing list, which is the appropriate fora.

http://groups.google.com/group/celery-users

Cheers,
Ask

From simon at rabbitmq.com  Mon Oct 17 14:46:01 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 17 Oct 2011 14:46:01 +0100
Subject: [rabbitmq-discuss] [help] Why erlang client's connection has
 not timeout, but Java client does.
In-Reply-To: <8ace78f3-0b81-415c-b83a-89ece894058e@y22g2000pri.googlegroups.com>
References: <8ace78f3-0b81-415c-b83a-89ece894058e@y22g2000pri.googlegroups.com>
Message-ID: <4E9C3199.4040002@rabbitmq.com>

On 17/10/11 04:47, Wang Bin wrote:
> But in erlang client, #amqp_params_network only has heartbeat, and we
> can't configure the connection timeout.

Huh. You're right. I'll file a bug.

If you want to work around it in the meantime, change the uses of 
gen_tcp:connect/3 to gen_tcp:connect/4 in 
amqp_network_connection:do_connect/5.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From jon at jbrisbin.com  Mon Oct 17 15:05:17 2011
From: jon at jbrisbin.com (Jon Brisbin)
Date: Mon, 17 Oct 2011 09:05:17 -0500 (CDT)
Subject: [rabbitmq-discuss] Weird compile error on latest 2.6.1 code
In-Reply-To: <3d04f82e-04ae-49af-915d-3862df0ab404@jbrisbin.local>
Message-ID: <98fa4f07-3440-4907-a9fd-fe5b3434905f@jbrisbin.local>

I updated my rebar-ized fork of the erlang client and rabbit_common dependencies to 2.6.1. When I compile the amqp_client by itself, it compiles okay (well, I get one warning). But when I include that in another project and compile it, I get some errors that seem to indicate multiple inclusion: 

https://gist.github.com/1292660 

So why don't I get these errors when compiling this module by itself, and what order do I need to compile things in to make this go away? 

Here's the projects I'm referring to: 

(the project these errors come from): 
https://github.com/jbrisbin/riak-rabbitmq-commit-hooks 

(the rebar-ized fork of amqp_client and rabbit_common that compiles okay on its own): 
https://github.com/jbrisbin/amqp_client 
https://github.com/jbrisbin/rabbit_common 



Thanks! 

Jon Brisbin 
http//jbrisbin.com 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111017/05c89463/attachment.htm>

From zedhm at yahoo.co.uk  Mon Oct 17 16:19:13 2011
From: zedhm at yahoo.co.uk (E Hope-Morley)
Date: Mon, 17 Oct 2011 16:19:13 +0100 (BST)
Subject: [rabbitmq-discuss] transactions
Message-ID: <1318864753.7514.YahooMailNeo@web26508.mail.ukl.yahoo.com>

Is it possible for a message to be delivered to a consumer before the sender has received a Tx.CommitOk?
?i.e. if i do the following:

Producer:

??? tx.select
? ? publish(queue=foo)
??? tx.commit

Consumer:
??? cosume(foo)



Is it possible that the consumer will receive a basic.deliver before the tx.commit returns tx.CommitOk?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111017/17ee6c68/attachment.htm>

From emile at rabbitmq.com  Mon Oct 17 17:02:01 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 17 Oct 2011 17:02:01 +0100
Subject: [rabbitmq-discuss] transactions
In-Reply-To: <1318864753.7514.YahooMailNeo@web26508.mail.ukl.yahoo.com>
References: <1318864753.7514.YahooMailNeo@web26508.mail.ukl.yahoo.com>
Message-ID: <4E9C5179.4020505@rabbitmq.com>

Hi,

On 17/10/11 16:19, E Hope-Morley wrote:
> Is it possible for a message to be delivered to a consumer before the
> sender has received a Tx.CommitOk?

Yes, if the link between the broker and publisher is congested then the
consumer might receive the message before the publisher receives the
commit-ok, so you shouldn't rely on the ordering of those events. If you
explain more about your problem we may be able to suggest some alternatives.


-Emile

From simon at rabbitmq.com  Mon Oct 17 17:05:40 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 17 Oct 2011 17:05:40 +0100
Subject: [rabbitmq-discuss] Weird compile error on latest 2.6.1 code
In-Reply-To: <98fa4f07-3440-4907-a9fd-fe5b3434905f@jbrisbin.local>
References: <98fa4f07-3440-4907-a9fd-fe5b3434905f@jbrisbin.local>
Message-ID: <4E9C5254.6060608@rabbitmq.com>

On 17/10/11 15:05, Jon Brisbin wrote:
> I updated my rebar-ized fork of the erlang client and rabbit_common
> dependencies to 2.6.1. When I compile the amqp_client by itself, it
> compiles okay (well, I get one warning). But when I include that in
> another project and compile it, I get some errors that seem to indicate
> multiple inclusion:
>
> https://gist.github.com/1292660

Hmm. Yes. It seems that amqp_selective_consumer.erl includes 
amqp_gen_consumer_spec.hrl and amqp_client.hrl. But 
amqp_gen_consumer_spec.hrl also includes amqp_client.hrl. Oops.

I have fixed this in hg; you could wait for the next release or patch it 
yourself.

> So why don't I get these errors when compiling this module by itself,

Well that is a fascinating question :-) I could also only replicate this 
using your rebarised build and dependencies. As far as I can see it 
really should break everywhere. It clearly doesn't though.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Mon Oct 17 17:16:58 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 17 Oct 2011 17:16:58 +0100
Subject: [rabbitmq-discuss] Weird compile error on latest 2.6.1 code
In-Reply-To: <4E9C5254.6060608@rabbitmq.com>
References: <98fa4f07-3440-4907-a9fd-fe5b3434905f@jbrisbin.local>
	<4E9C5254.6060608@rabbitmq.com>
Message-ID: <4E9C54FA.4090402@rabbitmq.com>

On 17/10/11 17:05, Simon MacMullen wrote:
> As far as I can see it really should break everywhere.

D'oh! amqp_client.hrl is the only one of our header files protected with 
-ifndef() magic. So that's why it works normally. I don't know why the 
-ifndef() thing doesn't work under rebar-with-dependencies, but the fix 
I just committed should sort you out anyway.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From rasadoll at gmail.com  Mon Oct 17 17:07:15 2011
From: rasadoll at gmail.com (rasadoll)
Date: Mon, 17 Oct 2011 09:07:15 -0700 (PDT)
Subject: [rabbitmq-discuss] Fail to run the broker as a service or app -
 erl_crash.dump is created every time
Message-ID: <c624cad3-66fc-4986-95ea-ff07039b0ace@x25g2000yqb.googlegroups.com>

Hello,
I have installation issue on a VM (windows platform) using rabbitmq
2.6.x and erlang 5.8.4 or 5.8.5, while it works very well on my local
machine.

No error is observed during the installation process but when I try to
start the service, run it as an application or even running any batch
file in sbin folder an erl_crash.dump is created with the following
error message.

=erl_crash_dump:0.1
Fri Oct 14 17:03:57 2011
Slogan: Kernel pid terminated (application_controller)
({application_start_failure,kernel,{shutdown,{kernel,start,[normal,
[]]}}})
System version: Erlang R14B04 (erts-5.8.5) [rq:1] [async-threads:0]
....

There is no name conflict as no other instance of RabbitMQ is running.

I install and run rabbitmq with an administrator user.

Thanks for your help

Reza



From emile at rabbitmq.com  Mon Oct 17 19:34:20 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 17 Oct 2011 19:34:20 +0100
Subject: [rabbitmq-discuss] Fail to run the broker as a service or app -
 erl_crash.dump is created every time
In-Reply-To: <c624cad3-66fc-4986-95ea-ff07039b0ace@x25g2000yqb.googlegroups.com>
References: <c624cad3-66fc-4986-95ea-ff07039b0ace@x25g2000yqb.googlegroups.com>
Message-ID: <4E9C752C.8000007@rabbitmq.com>

Hi,

Op 17/10/11 17:07, het rasadoll geskryf:
> Hello,
> I have installation issue on a VM (windows platform) using rabbitmq
> 2.6.x and erlang 5.8.4 or 5.8.5, while it works very well on my local
> machine.

I'm not able to reproduce this. Are you able to launch Erlang alone
(werl.exe or erl.exe) or does this only happen when you start rabbit?
What appears on the console when you attempt to start rabbit as an
application?


-Emile

From rasadoll at gmail.com  Mon Oct 17 19:59:53 2011
From: rasadoll at gmail.com (rasadoll)
Date: Mon, 17 Oct 2011 11:59:53 -0700 (PDT)
Subject: [rabbitmq-discuss] Fail to run the broker as a service or app -
 erl_crash.dump is created every time
In-Reply-To: <4E9C752C.8000007@rabbitmq.com>
References: <c624cad3-66fc-4986-95ea-ff07039b0ace@x25g2000yqb.googlegroups.com>
	<4E9C752C.8000007@rabbitmq.com>
Message-ID: <a0ca1264-0806-4d70-a28e-284c26aa0fdb@u2g2000yqc.googlegroups.com>

running erl seems ok.

If I run erl.exe, I get erl command prompt like this:
Eshell V5.8.5  (abort with ^G)
1>

running werl.exe also opens a command prompt window.

And here is my rabbitmq start output:

C:\RabbitMQ\rabbitmq_server-2.6.0\sbin>rabbitmq-server.bat
C:\RabbitMQ\rabbitmq_server-2.6.0\sbin\..\ebin
{error_logger,{{2011,10,17},{14,57,4}},"Protocol: ~p: register error:
~p~n",["inet_tcp",{{badmatch,{
error,econnrefused}},[{inet_tcp_dist,listen,1},
{net_kernel,start_protos,4},{net_kernel,start_protos,
3},{net_kernel,init_node,2},{net_kernel,init,1},{gen_server,init_it,6},
{proc_lib,init_p_do_apply,3}]
}]}
{error_logger,{{2011,10,17},{14,57,4}},crash_report,[[{initial_call,
{net_kernel,init,['Argument__1']
}},{pid,<0.19.0>},{registered_name,[]},{error_info,{exit,
{error,badarg},[{gen_server,init_it,6},{pro
c_lib,init_p_do_apply,3}]}},{ancestors,[net_sup,kernel_sup,<0.9.0>]},
{messages,[]},{links,[#Port<0.8
4>,<0.16.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},
{status,running},{heap_size,377},{st
ack_size,24},{reductions,531}],[]]}
{error_logger,{{2011,10,17},{14,57,4}},supervisor_report,[{supervisor,
{local,net_sup}},{errorContext
,start_error},{reason,{'EXIT',nodistribution}},{offender,
[{pid,undefined},{name,net_kernel},{mfargs,
{net_kernel,start_link,[[rabbitmqprelaunch4963,shortnames]]}},
{restart_type,permanent},{shutdown,200
0},{child_type,worker}]}]}
{error_logger,{{2011,10,17},{14,57,4}},supervisor_report,[{supervisor,
{local,kernel_sup}},{errorCont
ext,start_error},{reason,shutdown},{offender,[{pid,undefined},
{name,net_sup},{mfargs,{erl_distributi
on,start_link,[]}},{restart_type,permanent},{shutdown,infinity},
{child_type,supervisor}]}]}
{error_logger,{{2011,10,17},{14,57,4}},std_info,[{application,kernel},
{exited,{shutdown,{kernel,star
t,[normal,[]]}}},{type,permanent}]}
{"Kernel pid
terminated",application_controller,"{application_start_failure,kernel,
{shutdown,{kernel
,start,[normal,[]]}}}"}

Crash dump was written to: erl_crash.dump
Kernel pid terminated (application_controller)
({application_start_failure,kernel,{shutdown,{kernel,
start,[normal,[]]}}})

C:\RabbitMQ\rabbitmq_server-2.6.0\sbin>


On Oct 17, 2:34?pm, Emile Joubert <em... at rabbitmq.com> wrote:
> Hi,
>
> Op 17/10/11 17:07, het rasadoll geskryf:
>
> > Hello,
> > I have installation issue on a VM (windows platform) using rabbitmq
> > 2.6.x and erlang 5.8.4 or 5.8.5, while it works very well on my local
> > machine.
>
> I'm not able to reproduce this. Are you able to launch Erlang alone
> (werl.exe or erl.exe) or does this only happen when you start rabbit?
> What appears on the console when you attempt to start rabbit as an
> application?
>
> -Emile
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthias at rabbitmq.com  Mon Oct 17 20:17:56 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 17 Oct 2011 20:17:56 +0100
Subject: [rabbitmq-discuss] Fail to run the broker as a service or app -
 erl_crash.dump is created every time
In-Reply-To: <a0ca1264-0806-4d70-a28e-284c26aa0fdb@u2g2000yqc.googlegroups.com>
References: <c624cad3-66fc-4986-95ea-ff07039b0ace@x25g2000yqb.googlegroups.com>	<4E9C752C.8000007@rabbitmq.com>
	<a0ca1264-0806-4d70-a28e-284c26aa0fdb@u2g2000yqc.googlegroups.com>
Message-ID: <4E9C7F64.4070408@rabbitmq.com>

On 17/10/11 19:59, rasadoll wrote:
> running erl seems ok.
>
> If I run erl.exe, I get erl command prompt like this:
> Eshell V5.8.5  (abort with ^G)
> 1>

What happens when you run 'erl.exe -sname foo'?

Matthias.

From rasadoll at gmail.com  Mon Oct 17 20:22:22 2011
From: rasadoll at gmail.com (rasadoll)
Date: Mon, 17 Oct 2011 12:22:22 -0700 (PDT)
Subject: [rabbitmq-discuss] Fail to run the broker as a service or app -
 erl_crash.dump is created every time
In-Reply-To: <4E9C7F64.4070408@rabbitmq.com>
References: <c624cad3-66fc-4986-95ea-ff07039b0ace@x25g2000yqb.googlegroups.com>
	<4E9C752C.8000007@rabbitmq.com>
	<a0ca1264-0806-4d70-a28e-284c26aa0fdb@u2g2000yqc.googlegroups.com>
	<4E9C7F64.4070408@rabbitmq.com>
Message-ID: <bffe53bf-cd36-40e6-9453-09834d427adf@h5g2000vbf.googlegroups.com>

OH, I get exactly the same error that I posted before with erl crash
dump.


On Oct 17, 3:17?pm, Matthias Radestock <matth... at rabbitmq.com> wrote:
> On 17/10/11 19:59, rasadoll wrote:
>
> > running erl seems ok.
>
> > If I run erl.exe, I get erl command prompt like this:
> > Eshell V5.8.5 ?(abort with ^G)
> > 1>
>
> What happens when you run 'erl.exe -sname foo'?
>
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthias at rabbitmq.com  Mon Oct 17 20:26:01 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 17 Oct 2011 20:26:01 +0100
Subject: [rabbitmq-discuss] Fail to run the broker as a service or app -
 erl_crash.dump is created every time
In-Reply-To: <bffe53bf-cd36-40e6-9453-09834d427adf@h5g2000vbf.googlegroups.com>
References: <c624cad3-66fc-4986-95ea-ff07039b0ace@x25g2000yqb.googlegroups.com>	<4E9C752C.8000007@rabbitmq.com>	<a0ca1264-0806-4d70-a28e-284c26aa0fdb@u2g2000yqc.googlegroups.com>	<4E9C7F64.4070408@rabbitmq.com>
	<bffe53bf-cd36-40e6-9453-09834d427adf@h5g2000vbf.googlegroups.com>
Message-ID: <4E9C8149.1050409@rabbitmq.com>

On 17/10/11 20:22, rasadoll wrote:
> OH, I get exactly the same error that I posted before with erl crash
> dump.

I'd put the Windows (or other) firewall on top of the list of suspected 
causes. Try disabling it.

Matthias.

From rasadoll at gmail.com  Mon Oct 17 20:56:51 2011
From: rasadoll at gmail.com (rasadoll)
Date: Mon, 17 Oct 2011 12:56:51 -0700 (PDT)
Subject: [rabbitmq-discuss] Fail to run the broker as a service or app -
 erl_crash.dump is created every time
In-Reply-To: <4E9C8149.1050409@rabbitmq.com>
References: <c624cad3-66fc-4986-95ea-ff07039b0ace@x25g2000yqb.googlegroups.com>
	<4E9C752C.8000007@rabbitmq.com>
	<a0ca1264-0806-4d70-a28e-284c26aa0fdb@u2g2000yqc.googlegroups.com>
	<4E9C7F64.4070408@rabbitmq.com>
	<bffe53bf-cd36-40e6-9453-09834d427adf@h5g2000vbf.googlegroups.com>
	<4E9C8149.1050409@rabbitmq.com>
Message-ID: <0c5af771-87f2-46d5-96ee-78d5b555884d@m4g2000yqm.googlegroups.com>

Thanks Matthias. RbbitMQ works fine now.

For me it was not actually the firewall. I just stopped a scheduler
service on the VM and that fixed the problem. Right now, even after
restarting the scheduler service, rabbitmq is still fine. I don't know
what was wrong at that time with the scheduler service.

Anyway thanks or directions.


On Oct 17, 3:26?pm, Matthias Radestock <matth... at rabbitmq.com> wrote:
> On 17/10/11 20:22, rasadoll wrote:
>
> > OH, I get exactly the same error that I posted before with erl crash
> > dump.
>
> I'd put the Windows (or other) firewall on top of the list of suspected
> causes. Try disabling it.
>
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From gil.strauss at gmail.com  Mon Oct 17 20:57:49 2011
From: gil.strauss at gmail.com (Gil Strauss)
Date: Mon, 17 Oct 2011 12:57:49 -0700 (PDT)
Subject: [rabbitmq-discuss] Durable Queue
In-Reply-To: <20111016170849.GA24713@wellquite.org>
References: <319bdd71-74a8-4e3a-8603-d8dbb2f612eb@b10g2000vbc.googlegroups.com>
	<20111016170849.GA24713@wellquite.org>
Message-ID: <7db07b5d-ac95-4070-a926-7e29126f1e74@e37g2000yqa.googlegroups.com>

Thank you for the reply.

If I configure durable mirror queue, does any incoming message is
being written on the master and mirror disks?

Another question - is it possible that a subscriber that configured to
send an acknowledgement will receive the same message twice?

Thanks,

Gil


On Oct 16, 7:08?pm, Matthew Sackman <matt... at rabbitmq.com> wrote:
> On Sun, Oct 16, 2011 at 09:25:52AM -0700, Gil Strauss wrote:
> > If the queue is configured to be durable - is it being written to disk
> > every single enqueue/dequeue operation or a snapshot is taken every
> > configurable period of time?
>
> Persistent msgs sent to durable queues may be written to disk. In
> practise, unless the queue is empty and has non-blocked consumers who
> are consuming with noAck=true, they'll probably be written to disk quite
> promptly. If you use transactions or publisher confirms then you'll
> actually get an indication back to the publisher when they have fully
> been written to disk.
>
> It's more on a batched-per-msg thing, rather than a snapshot thing.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthew at rabbitmq.com  Mon Oct 17 23:37:29 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 17 Oct 2011 23:37:29 +0100
Subject: [rabbitmq-discuss] Durable Queue
In-Reply-To: <7db07b5d-ac95-4070-a926-7e29126f1e74@e37g2000yqa.googlegroups.com>
References: <319bdd71-74a8-4e3a-8603-d8dbb2f612eb@b10g2000vbc.googlegroups.com>
	<20111016170849.GA24713@wellquite.org>
	<7db07b5d-ac95-4070-a926-7e29126f1e74@e37g2000yqa.googlegroups.com>
Message-ID: <20111017223728.GB16997@wellquite.org>

On Mon, Oct 17, 2011 at 12:57:49PM -0700, Gil Strauss wrote:
> If I configure durable mirror queue, does any incoming message is
> being written on the master and mirror disks?

No, not on disk. Replication is largely done in a safe but asynchronous
way - the master can get "ahead" of the slaves, but only in such a way
that if the master dies and the slaves then take different decisions, no
observable difference is possible anyway.

> Another question - is it possible that a subscriber that configured to
> send an acknowledgement will receive the same message twice?

Yes. Given there is no "ack" to an "ack", the ack can always be lost in
flight. Active/active HA actually extends the flight-time of an ack and
presents more possibilities of loss of ack. Thus as usual, you should be
prepared to deal with duplicates on consumers.

Matthew

From matthew at rabbitmq.com  Mon Oct 17 23:41:32 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 17 Oct 2011 23:41:32 +0100
Subject: [rabbitmq-discuss] Durable Queue
In-Reply-To: <20111017223728.GB16997@wellquite.org>
References: <319bdd71-74a8-4e3a-8603-d8dbb2f612eb@b10g2000vbc.googlegroups.com>
	<20111016170849.GA24713@wellquite.org>
	<7db07b5d-ac95-4070-a926-7e29126f1e74@e37g2000yqa.googlegroups.com>
	<20111017223728.GB16997@wellquite.org>
Message-ID: <20111017224131.GC16997@wellquite.org>

On Mon, Oct 17, 2011 at 11:37:29PM +0100, Matthew Sackman wrote:
> On Mon, Oct 17, 2011 at 12:57:49PM -0700, Gil Strauss wrote:
> > If I configure durable mirror queue, does any incoming message is
> > being written on the master and mirror disks?
> 
> No, not on disk. Replication is largely done in a safe but asynchronous
> way - the master can get "ahead" of the slaves, but only in such a way
> that if the master dies and the slaves then take different decisions, no
> observable difference is possible anyway.

Oh wait, I missed out another sentence or eight:

IF the msg sent to such a durable+mirrored queue are persistent, then
yes, they'll be written to disks on all the mirrored nodes. However,
again, they'll be written to disk largely in an async way. If you want
confirmation that they've been written to disk on all mirrored nodes
then please use publisher confirms, or, on clients that still need
updating to support such things, transactions.

Matthew

From oyvind at tjervaag.com  Tue Oct 18 07:28:33 2011
From: oyvind at tjervaag.com (Oyvind Tjervaag)
Date: Tue, 18 Oct 2011 08:28:33 +0200
Subject: [rabbitmq-discuss] AMQP 1.0 Specifications
Message-ID: <1DF917B8-1131-49DF-B16F-826B648EEF94@tjervaag.com>

Hi!

Is anyone able to reach http://www.amqp.org/confluence/ ?

I'm trying to download the 1.0 AMQP Specifications, but the site seems to be down :( If anyone have the collections of PDFs listed here: http://amqp.org/resources/specifications , could you zip it up and mail it to me? The contact form on the amqp site doesn't work either?

thanks!

?yvind

From mikeb at rabbitmq.com  Tue Oct 18 09:50:13 2011
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Tue, 18 Oct 2011 09:50:13 +0100
Subject: [rabbitmq-discuss] AMQP 1.0 Specifications
In-Reply-To: <1DF917B8-1131-49DF-B16F-826B648EEF94@tjervaag.com>
References: <1DF917B8-1131-49DF-B16F-826B648EEF94@tjervaag.com>
Message-ID: <4E9D3DC5.2070706@rabbitmq.com>

> Is anyone able to reach http://www.amqp.org/confluence/ ?

It appears to be down. I'll send you the specification PDF directly.

By the way, other than the core protocol, none of the specifications are 
"GA", and some are probably rather out of date (for instance the "broker 
behaviour" document).

-Michael

> I'm trying to download the 1.0 AMQP Specifications, but the site
> seems to be down :( If anyone have the collections of PDFs listed
> here: http://amqp.org/resources/specifications , could you zip it up
> and mail it to me? The contact form on the amqp site doesn't work
> either?
>
> thanks!
>
> ?yvind _______________________________________________
> rabbitmq-discuss mailing list rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From hongsgo at gmail.com  Tue Oct 18 11:23:21 2011
From: hongsgo at gmail.com (hongsgo)
Date: Tue, 18 Oct 2011 03:23:21 -0700 (PDT)
Subject: [rabbitmq-discuss] AMQP 1.0 Specifications
In-Reply-To: <4E9D3DC5.2070706@rabbitmq.com>
References: <1DF917B8-1131-49DF-B16F-826B648EEF94@tjervaag.com>
	<4E9D3DC5.2070706@rabbitmq.com>
Message-ID: <cb6d4ce0-42ec-4f75-84bb-19a01184b105@27g2000prq.googlegroups.com>

plz give to me spec pdf.
thanks


On Oct 18, 5:50?pm, Michael Bridgen <mi... at rabbitmq.com> wrote:
> > Is anyone able to reachhttp://www.amqp.org/confluence/?
>
> It appears to be down. I'll send you the specification PDF directly.
>
> By the way, other than the core protocol, none of the specifications are
> "GA", and some are probably rather out of date (for instance the "broker
> behaviour" document).
>
> -Michael
>
> > I'm trying to download the 1.0 AMQP Specifications, but the site
> > seems to be down :( If anyone have the collections of PDFs listed
> > here:http://amqp.org/resources/specifications, could you zip it up
> > and mail it to me? The contact form on the amqp site doesn't work
> > either?
>
> > thanks!
>
> > ?yvind _______________________________________________
> > rabbitmq-discuss mailing list rabbitmq-disc... at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simon at rabbitmq.com  Tue Oct 18 13:22:41 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 18 Oct 2011 13:22:41 +0100
Subject: [rabbitmq-discuss] rabbitmq-discuss Digest, Vol 53, Issue 15
In-Reply-To: <CAJ78kjNLGNcHKG8c5jA-t9e_3FQ59obrEbg_eqPZ5pefh8ULCA@mail.gmail.com>
References: <mailman.1.1318676401.19509.rabbitmq-discuss@lists.rabbitmq.com>
	<CAJ78kjNLGNcHKG8c5jA-t9e_3FQ59obrEbg_eqPZ5pefh8ULCA@mail.gmail.com>
Message-ID: <4E9D6F91.5020600@rabbitmq.com>

On 15/10/11 23:16, yoav glazner wrote:
> Can one create a Prioritised "topic exchange"?

I'm not sure what that would even look like. The exchange would have to 
contain a priority queue in order to do this, but how can a priority 
queue really exist there since exchanges are meant to be (conceptually) 
stateless? At what point does the exchange deliver messages?

> msg1 topic= 0.0.0.1 #first
> msg2 topic= 0.0.0.3 #4th

Supposing we experience a pause here - can the exchange forward these 
messages on to the queue in that order? If not, how long is it supposed 
to wait for msg3?

> msg3 topic= 0.0.0.2 #2nd
> msg4 topic= 0.0.0.4 #3rd

(Or is that not what you're asking?)

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From mikeb at rabbitmq.com  Tue Oct 18 14:53:44 2011
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Tue, 18 Oct 2011 14:53:44 +0100
Subject: [rabbitmq-discuss] AMQP 1.0 Specifications
In-Reply-To: <4E9D3DC5.2070706@rabbitmq.com>
References: <1DF917B8-1131-49DF-B16F-826B648EEF94@tjervaag.com>
	<4E9D3DC5.2070706@rabbitmq.com>
Message-ID: <4E9D84E8.2040909@rabbitmq.com>

>> Is anyone able to reach http://www.amqp.org/confluence/ ?

http://www.amqp.org/confluence/display/AMQP/AMQP+Specification is back 
up and links to the "GA" specification.

NB the page at http://www.amqp.org/resources/download has broken links. 
Ignore it.

-Michael

>> I'm trying to download the 1.0 AMQP Specifications, but the site
>> seems to be down :( If anyone have the collections of PDFs listed
>> here: http://amqp.org/resources/specifications , could you zip it up
>> and mail it to me? The contact form on the amqp site doesn't work
>> either?
>>
>> thanks!
>>
>> ?yvind _______________________________________________
>> rabbitmq-discuss mailing list rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From mattgurney at gmail.com  Tue Oct 18 15:16:24 2011
From: mattgurney at gmail.com (Matt G)
Date: Tue, 18 Oct 2011 07:16:24 -0700 (PDT)
Subject: [rabbitmq-discuss] Highest Reliability simple publish to a queue
Message-ID: <0b4cc204-d344-4735-9cd4-fc5108263db3@e25g2000pri.googlegroups.com>

Hi,

I have a simple scenario where a web service will receive a http
request and I would like to insert the request into a queue, and be
sure the message has arrived on the queue before synchronously
responding to the http request.

Ideally I would like RMQ to "guarantee" that the message has been
delivered to the queue. I have been using IBM MQ and TIBCO EMS (JMS
implementation) for many years, but I am new to RMQ.

Performance is not an issue, the volume will not be an issue.

I am using c# with latest AMQ versions on Windows and Linux.

So far it appears to me that I should use the following, can you
review my list and edit as necessary:
Durable exchange
ExchangeType.Direct
Durable queue
Persistent message (Delivery Mode = 2)
Mandatory message
Model/Channel.ConfirmSelect &  Model.WaitForConfirmsOrDie();

I also setup event handlers BasicAcks, BasicNacks & BasicReturn.
If for testing purposes I unbind the queue from the exchange, and send
a single message,  I get a BasicAck and a BasicReturn(NO_ROUTE) back,
however the Model.WaitForConfirmsOrDie() returns without error. This
seems inconsistent in that my message has been lost as there is no
queue bound to the exchange and I have specified mandatory and every
persistent option I can find. Is this correct, or am I doing something
wrong? Do I need to do/check both (WaitForConfirms & BasicReturn event
msg) to be sure the message was successfully delivered to the queue?

Where is the documentation for API calls which are not documented in
the API doc, an example is WaitForConfirmsOrDie, but there are many
others?

I read one of the other posts directing people away from transactions
and towards the Model/Channel.ConfirmSelect &
Model.WaitForConfirmsOrDie() model, so I have not investigated
transactions.

What about connection heart beating? I know from my experience with
other products HB's are good way to keep the client and server in-sync
and aware if the other party has gone off line. Should I overwrite the
default which appears to be no heartbeats?

I am not currently using any of the helper/pattern classes, would one
of those be suitable for my requirements for high reliability.

Thanks,
Matt.

From vdevadhar at salesforce.com  Tue Oct 18 18:19:13 2011
From: vdevadhar at salesforce.com (Vijay Devadhar)
Date: Tue, 18 Oct 2011 10:19:13 -0700
Subject: [rabbitmq-discuss] Round robin dispatch between N queues
Message-ID: <21C30947FEC99B4D9FCEEC893D5E2BB21B933CCB@EXSFM-MB03.internal.salesforce.com>

Dear RabbitMQ Users,

I am likely to setup a RabbitMQ node with multiple queues; The traffic rate on each
Queue is not predictable and will vary based on the time of the day. If there are
100 queues in the system, and 50 threads listening to them, I would like the dispatcher
to fairly allocate resources to all queues with messages ready to be processed at any given time.

I do not want to pre-allocate threads to queues by restricting what they listen on;
I want to be able to allow all threads to work on a single queue if that is the only one with traffic.

Is that doable? If yes, how?

Thanks
Vijay


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111018/a19238b3/attachment.htm>

From simone.busoli at gmail.com  Tue Oct 18 20:35:19 2011
From: simone.busoli at gmail.com (Simone Busoli)
Date: Tue, 18 Oct 2011 21:35:19 +0200
Subject: [rabbitmq-discuss] Highest Reliability simple publish to a queue
In-Reply-To: <0b4cc204-d344-4735-9cd4-fc5108263db3@e25g2000pri.googlegroups.com>
References: <0b4cc204-d344-4735-9cd4-fc5108263db3@e25g2000pri.googlegroups.com>
Message-ID: <CAOn7oW9MNhC6AY_B4YXtqxJzc3on_KOrEYEkw_ubohOY9-ersw@mail.gmail.com>

Hi Mike, this has been asked several times on the list recently, I think you
will find your answer by searching the archives.
By the way, I am curious why you want to do everything synchronously as you
wouldn't need Rabbit for that.
On Oct 18, 2011 4:32 PM, "Matt G" <mattgurney at gmail.com> wrote:

> Hi,
>
> I have a simple scenario where a web service will receive a http
> request and I would like to insert the request into a queue, and be
> sure the message has arrived on the queue before synchronously
> responding to the http request.
>
> Ideally I would like RMQ to "guarantee" that the message has been
> delivered to the queue. I have been using IBM MQ and TIBCO EMS (JMS
> implementation) for many years, but I am new to RMQ.
>
> Performance is not an issue, the volume will not be an issue.
>
> I am using c# with latest AMQ versions on Windows and Linux.
>
> So far it appears to me that I should use the following, can you
> review my list and edit as necessary:
> Durable exchange
> ExchangeType.Direct
> Durable queue
> Persistent message (Delivery Mode = 2)
> Mandatory message
> Model/Channel.ConfirmSelect &  Model.WaitForConfirmsOrDie();
>
> I also setup event handlers BasicAcks, BasicNacks & BasicReturn.
> If for testing purposes I unbind the queue from the exchange, and send
> a single message,  I get a BasicAck and a BasicReturn(NO_ROUTE) back,
> however the Model.WaitForConfirmsOrDie() returns without error. This
> seems inconsistent in that my message has been lost as there is no
> queue bound to the exchange and I have specified mandatory and every
> persistent option I can find. Is this correct, or am I doing something
> wrong? Do I need to do/check both (WaitForConfirms & BasicReturn event
> msg) to be sure the message was successfully delivered to the queue?
>
> Where is the documentation for API calls which are not documented in
> the API doc, an example is WaitForConfirmsOrDie, but there are many
> others?
>
> I read one of the other posts directing people away from transactions
> and towards the Model/Channel.ConfirmSelect &
> Model.WaitForConfirmsOrDie() model, so I have not investigated
> transactions.
>
> What about connection heart beating? I know from my experience with
> other products HB's are good way to keep the client and server in-sync
> and aware if the other party has gone off line. Should I overwrite the
> default which appears to be no heartbeats?
>
> I am not currently using any of the helper/pattern classes, would one
> of those be suitable for my requirements for high reliability.
>
> Thanks,
> Matt.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111018/59f3b838/attachment.htm>

From matthias at rabbitmq.com  Wed Oct 19 01:55:00 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 19 Oct 2011 01:55:00 +0100
Subject: [rabbitmq-discuss] Fairness wrt queues under heavy load
In-Reply-To: <4E952AEC.20002@rabbitmq.com>
References: <CANVKUrWC=q6GipDRtWEiUOpL0yo_yjxVBzTOPU_C2kWkADfYUA@mail.gmail.com>	<4E93F9B2.1060605@rabbitmq.com>	<CANVKUrUsJteZxAzpD78EhimydEH_gu5bTjzS7j2V=TOSmg+t4A@mail.gmail.com>	<4E941876.3090105@rabbitmq.com>
	<CANVKUrU=358iaydYmNE+HSWQkeuyxwx7PXcY7dQ12HxMxpDn_Q@mail.gmail.com>
	<4E952AEC.20002@rabbitmq.com>
Message-ID: <4E9E1FE4.2000805@rabbitmq.com>

Eugene,

On 12/10/11 06:51, Matthias Radestock wrote:
> On 12/10/11 06:19, Eugene Kirpichov wrote:
>> * The messages taking long to deliver are sitting in the queues
>> ("ready"), according to the management interface.
>
> Hmm. The plot thickens. When the broker is in that state, please run
> 'rabbitmqctl report' and send us the output.

Is the problem you reported still occurring?

Matthias.

From thadeurc at gmail.com  Wed Oct 19 01:05:34 2011
From: thadeurc at gmail.com (Thadeu Russo)
Date: Tue, 18 Oct 2011 17:05:34 -0700 (PDT)
Subject: [rabbitmq-discuss] getting authentication failure Exception?
In-Reply-To: <4E93FA1B.50100@rabbitmq.com>
References: <32629116.post@talk.nabble.com> <4E93FA1B.50100@rabbitmq.com>
Message-ID: <69c5e156-ea08-430c-8146-f0ce7b0fcc79@v15g2000vbm.googlegroups.com>

Hello,

I am facing the same problem. Here are some details about it:

1- Both computers have the firewall off (I am using Ubuntu 11 in both)
2- The log says 'accepting connection'; 'starting connection' and then
a handshake error caused by a timeout. I assume the server is not
receiving the response from the client for the handshake.

It is really weird cause it was working pretty fine a couple weeks
ago. Also, I am sure there is no network issue. If I start the
rabbitmq server in a single node and try to connect with a simple java
client using localhost it works fine. When I use the ip address of the
node it bombs. Additionally, using network tools from remote nodes to
scan the open ports in the rabbitmq node, I can 'see' the port 5672 as
an open port. The same problem happens in Mac OS too.

I did a big investigation over the internet where I found other people
complaining about this problem but no solution. Any help is really
appreciated.

Thanks in advance,

On Oct 11, 6:11?am, Matthias Radestock <matth... at rabbitmq.com> wrote:
> On 11/10/11 09:00, sameekmishra wrote:
>
> > I am using Rabbitmq server 2.5 is install on machine IP -192.168.1.64.when i
> > try to get connected with machine i got the error:" java.io.IOException:
> >Possiblycausedbyauthenticationfailure".used code to connect with server:
>
> > ? ? ? ?ConnectionFactory factory = new ConnectionFactory();
> > ? ? ? ?factory.setUsername("guest");
> > ? ? ? ?factory.setPassword("guest");
> > ? ? ? ?factory.setVirtualHost("/");
> > ? ? ? ?factory.setHost("192.168.1.64");
> > ? ? ? ?factory.setPort("5672");
> > ? ? ? ?conn = factory.newConnection();
>
> > please help me to get resolve above problem.
>
> What does rabbit's log say?
>
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From lists at fukawi2.nl  Wed Oct 19 05:37:32 2011
From: lists at fukawi2.nl (Phillip Smith)
Date: Wed, 19 Oct 2011 15:37:32 +1100
Subject: [rabbitmq-discuss] Architecture for Handling Orders
Message-ID: <CAKAE9iTJ2TSkk6fRqaz6bezYLKe5sA68KahZPedwKNqgkjGHEQ@mail.gmail.com>

Hi all,

I've been reading about RabbitMQ for the last couple of weeks, got it
installed and been having a play with the tutorials etc.

I'm stuck maintaining some legacy (read: disparate) systems at my job,
but we have requirements to interact with some contemporary EDI
systems. I'm thinking RabbitMQ/AMQP would help tie this all together
in a flexible way.


From ekirpichov at gmail.com  Wed Oct 19 07:54:30 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Wed, 19 Oct 2011 10:54:30 +0400
Subject: [rabbitmq-discuss] Fairness wrt queues under heavy load
In-Reply-To: <4E9E1FE4.2000805@rabbitmq.com>
References: <CANVKUrWC=q6GipDRtWEiUOpL0yo_yjxVBzTOPU_C2kWkADfYUA@mail.gmail.com>
	<4E93F9B2.1060605@rabbitmq.com>
	<CANVKUrUsJteZxAzpD78EhimydEH_gu5bTjzS7j2V=TOSmg+t4A@mail.gmail.com>
	<4E941876.3090105@rabbitmq.com>
	<CANVKUrU=358iaydYmNE+HSWQkeuyxwx7PXcY7dQ12HxMxpDn_Q@mail.gmail.com>
	<4E952AEC.20002@rabbitmq.com> <4E9E1FE4.2000805@rabbitmq.com>
Message-ID: <68993AD9-4985-482C-9B0E-CF94FF960871@gmail.com>

Hi Matthias,

I didn't yet have a chance to reproduce it, as I've simply moved the urgent messages to a separate broker for now.

I still remember the problem, however, and will try reproducing it next time some time frees up on our testing cluster, or on my machine.



19.10.2011, ? 4:55, Matthias Radestock <matthias at rabbitmq.com> ???????(?):

> Eugene,
> 
> On 12/10/11 06:51, Matthias Radestock wrote:
>> On 12/10/11 06:19, Eugene Kirpichov wrote:
>>> * The messages taking long to deliver are sitting in the queues
>>> ("ready"), according to the management interface.
>> 
>> Hmm. The plot thickens. When the broker is in that state, please run
>> 'rabbitmqctl report' and send us the output.
> 
> Is the problem you reported still occurring?
> 
> Matthias.

From mattgurney at gmail.com  Wed Oct 19 11:16:29 2011
From: mattgurney at gmail.com (Matt G)
Date: Wed, 19 Oct 2011 03:16:29 -0700 (PDT)
Subject: [rabbitmq-discuss] Highest Reliability simple publish to a queue
In-Reply-To: <CAOn7oW9MNhC6AY_B4YXtqxJzc3on_KOrEYEkw_ubohOY9-ersw@mail.gmail.com>
References: <0b4cc204-d344-4735-9cd4-fc5108263db3@e25g2000pri.googlegroups.com>
	<CAOn7oW9MNhC6AY_B4YXtqxJzc3on_KOrEYEkw_ubohOY9-ersw@mail.gmail.com>
Message-ID: <ce50ee6d-cd59-4741-9282-60ac7a8e88fd@p27g2000prp.googlegroups.com>

Thanks Simone, Which of my six questions do you think I can find the
answer for in the archives, I am not finding the answers I am after.
If anyone else can have a quick look at my questions it would be much
appreciated, I am a new comer to RMQ and I think my questions may be
simple for anyone with some experience.

Our requirement is to reliably persist the web service payload into a
RMQ as per the "Responsibility Transfer" pattern on page 21 of the
RabbitMQ .Net Client Library User Guide. I have implemented the
options as described in that section, I am just checking if there is
anything else I need.

The lack of any documentation on WaitForConfirmsOrDie() bothers me,
currently I am assuming that it blocks program execution until all
confirm/nack/ack/reply due to the Model/Channel.ConfirmSelect are
received. But I can not find this documented anywhere. I mean, is that
what it does, how long does it wait before the "Die" and what happens
when it "Dies" etc.

On Oct 19, 6:35?am, Simone Busoli <simone.bus... at gmail.com> wrote:
> Hi Mike, this has been asked several times on the list recently, I think you
> will find your answer by searching the archives.
> By the way, I am curious why you want to do everything synchronously as you
> wouldn't need Rabbit for that.
> On Oct 18, 2011 4:32 PM, "Matt G" <mattgur... at gmail.com> wrote:
>
>
>
>
>
>
>
> > Hi,
>
> > I have a simple scenario where a web service will receive a http
> > request and I would like to insert the request into a queue, and be
> > sure the message has arrived on the queue before synchronously
> > responding to the http request.
>
> > Ideally I would like RMQ to "guarantee" that the message has been
> > delivered to the queue. I have been using IBM MQ and TIBCO EMS (JMS
> > implementation) for many years, but I am new to RMQ.
>
> > Performance is not an issue, the volume will not be an issue.
>
> > I am using c# with latest AMQ versions on Windows and Linux.
>
> > So far it appears to me that I should use the following, can you
> > review my list and edit as necessary:
> > Durable exchange
> > ExchangeType.Direct
> > Durable queue
> > Persistent message (Delivery Mode = 2)
> > Mandatory message
> > Model/Channel.ConfirmSelect & ?Model.WaitForConfirmsOrDie();
>
> > I also setup event handlers BasicAcks, BasicNacks & BasicReturn.
> > If for testing purposes I unbind the queue from the exchange, and send
> > a single message, ?I get a BasicAck and a BasicReturn(NO_ROUTE) back,
> > however the Model.WaitForConfirmsOrDie() returns without error. This
> > seems inconsistent in that my message has been lost as there is no
> > queue bound to the exchange and I have specified mandatory and every
> > persistent option I can find. Is this correct, or am I doing something
> > wrong? Do I need to do/check both (WaitForConfirms & BasicReturn event
> > msg) to be sure the message was successfully delivered to the queue?
>
> > Where is the documentation for API calls which are not documented in
> > the API doc, an example is WaitForConfirmsOrDie, but there are many
> > others?
>
> > I read one of the other posts directing people away from transactions
> > and towards the Model/Channel.ConfirmSelect &
> > Model.WaitForConfirmsOrDie() model, so I have not investigated
> > transactions.
>
> > What about connection heart beating? I know from my experience with
> > other products HB's are good way to keep the client and server in-sync
> > and aware if the other party has gone off line. Should I overwrite the
> > default which appears to be no heartbeats?
>
> > I am not currently using any of the helper/pattern classes, would one
> > of those be suitable for my requirements for high reliability.
>
> > Thanks,
> > Matt.
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From Simone.Busoli at ferrari.com  Wed Oct 19 11:25:38 2011
From: Simone.Busoli at ferrari.com (Busoli, Simone)
Date: Wed, 19 Oct 2011 10:25:38 +0000
Subject: [rabbitmq-discuss] Highest Reliability simple publish to a queue
In-Reply-To: <ce50ee6d-cd59-4741-9282-60ac7a8e88fd@p27g2000prp.googlegroups.com>
References: <0b4cc204-d344-4735-9cd4-fc5108263db3@e25g2000pri.googlegroups.com><CAOn7oW9MNhC6AY_B4YXtqxJzc3on_KOrEYEkw_ubohOY9-ersw@mail.gmail.com>
	<ce50ee6d-cd59-4741-9282-60ac7a8e88fd@p27g2000prp.googlegroups.com>
Message-ID: <88E590DC4586974D825FC82AE798294E5206892B@GSVCLU03.ges.ferlan.it>

https://groups.google.com/d/topic/rabbitmq-discuss/3gfagTaY97k/discussion

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Matt G
Sent: mercoled? 19 ottobre 2011 12:16
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Highest Reliability simple publish to a queue

Thanks Simone, Which of my six questions do you think I can find the answer for in the archives, I am not finding the answers I am after.
If anyone else can have a quick look at my questions it would be much appreciated, I am a new comer to RMQ and I think my questions may be simple for anyone with some experience.

Our requirement is to reliably persist the web service payload into a RMQ as per the "Responsibility Transfer" pattern on page 21 of the RabbitMQ .Net Client Library User Guide. I have implemented the options as described in that section, I am just checking if there is anything else I need.

The lack of any documentation on WaitForConfirmsOrDie() bothers me, currently I am assuming that it blocks program execution until all confirm/nack/ack/reply due to the Model/Channel.ConfirmSelect are received. But I can not find this documented anywhere. I mean, is that what it does, how long does it wait before the "Die" and what happens when it "Dies" etc.

On Oct 19, 6:35?am, Simone Busoli <simone.bus... at gmail.com> wrote:
> Hi Mike, this has been asked several times on the list recently, I 
> think you will find your answer by searching the archives.
> By the way, I am curious why you want to do everything synchronously 
> as you wouldn't need Rabbit for that.
> On Oct 18, 2011 4:32 PM, "Matt G" <mattgur... at gmail.com> wrote:
>
>
>
>
>
>
>
> > Hi,
>
> > I have a simple scenario where a web service will receive a http 
> > request and I would like to insert the request into a queue, and be 
> > sure the message has arrived on the queue before synchronously 
> > responding to the http request.
>
> > Ideally I would like RMQ to "guarantee" that the message has been 
> > delivered to the queue. I have been using IBM MQ and TIBCO EMS (JMS
> > implementation) for many years, but I am new to RMQ.
>
> > Performance is not an issue, the volume will not be an issue.
>
> > I am using c# with latest AMQ versions on Windows and Linux.
>
> > So far it appears to me that I should use the following, can you 
> > review my list and edit as necessary:
> > Durable exchange
> > ExchangeType.Direct
> > Durable queue
> > Persistent message (Delivery Mode = 2) Mandatory message 
> > Model/Channel.ConfirmSelect & ?Model.WaitForConfirmsOrDie();
>
> > I also setup event handlers BasicAcks, BasicNacks & BasicReturn.
> > If for testing purposes I unbind the queue from the exchange, and 
> > send a single message, ?I get a BasicAck and a BasicReturn(NO_ROUTE) 
> > back, however the Model.WaitForConfirmsOrDie() returns without 
> > error. This seems inconsistent in that my message has been lost as 
> > there is no queue bound to the exchange and I have specified 
> > mandatory and every persistent option I can find. Is this correct, 
> > or am I doing something wrong? Do I need to do/check both 
> > (WaitForConfirms & BasicReturn event
> > msg) to be sure the message was successfully delivered to the queue?
>
> > Where is the documentation for API calls which are not documented in 
> > the API doc, an example is WaitForConfirmsOrDie, but there are many 
> > others?
>
> > I read one of the other posts directing people away from 
> > transactions and towards the Model/Channel.ConfirmSelect &
> > Model.WaitForConfirmsOrDie() model, so I have not investigated 
> > transactions.
>
> > What about connection heart beating? I know from my experience with 
> > other products HB's are good way to keep the client and server 
> > in-sync and aware if the other party has gone off line. Should I 
> > overwrite the default which appears to be no heartbeats?
>
> > I am not currently using any of the helper/pattern classes, would 
> > one of those be suitable for my requirements for high reliability.
>
> > Thanks,
> > Matt.
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/
> mailman/listinfo/rabbitmq-discuss
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

_________________________________________________________________________________________________________________
Questo messaggio ? da intendersi esclusivamente ad uso del destinatario e pu? contenere informazioni che sono di natura privilegiata, confidenziale
o non divulgabile secondo le leggi vigenti. Se il lettore del presente messaggio non ? il destinatario designato, o il dipendente/agente responsabile
per la consegna del messaggio al destinatario designato, si informa che ogni disseminazione, distribuzione o copiatura di questa comunicazione ? 
strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
immediatamente a mezzo e-mail di risposta e successivamente di procedere alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
_________________________________________________________________________________________________________________
This message is intended only for the use of the addressee and may contain information that is privileged, confidential and exempt from 
disclosure under applicable law. If the reader of this message is not the intended recipient, or the employee or agent responsible for delivering the 
message to the intended recipient, you are hereby notified that any dissemination, distribution or copying of this communication is strictly 
prohibited. If you have received this e-mail in error, please notify us immediately by return e-mail and delete this e-mail and all attachments from 
your system.
_________________________________________________________________________________________________________________



From matt at cloud-integrations.com  Wed Oct 19 11:28:21 2011
From: matt at cloud-integrations.com (Matt Gurney - Cloud Integration)
Date: Wed, 19 Oct 2011 21:28:21 +1100
Subject: [rabbitmq-discuss] Connection remains valid but disappears from
	rabbitmqctl list_connections & RMQ Admin HTTP Interface
Message-ID: <00ba01cc8e49$d5accc10$81066430$@cloud-integrations.com>

I was doing some testing today and I noticed that dormant connections
disappear from the rabbitmqctl list_connections & the RMQ Admin HTTP
Interface screen.

 

If I create a new connection, model, exchange, queue and send a message,
then sleep for 30 seconds typically after about 10 seconds I will see the
connection disappear from the rabbitmqctl list_connections & the RMQ Admin
HTTP Interface screen. If the application then sends another message, the
connection is still valid and the message is delivered. Is this expected
behaviour.

 

Thanks,

Matt.

 

 

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111019/d69d5ac8/attachment.htm>

From simon at rabbitmq.com  Wed Oct 19 11:43:18 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 19 Oct 2011 11:43:18 +0100
Subject: [rabbitmq-discuss] Highest Reliability simple publish to a queue
In-Reply-To: <0b4cc204-d344-4735-9cd4-fc5108263db3@e25g2000pri.googlegroups.com>
References: <0b4cc204-d344-4735-9cd4-fc5108263db3@e25g2000pri.googlegroups.com>
Message-ID: <4E9EA9C6.10809@rabbitmq.com>

On 18/10/11 15:16, Matt G wrote:
> So far it appears to me that I should use the following, can you
> review my list and edit as necessary:
> Durable exchange
> ExchangeType.Direct
> Durable queue
> Persistent message (Delivery Mode = 2)
> Mandatory message
> Model/Channel.ConfirmSelect&   Model.WaitForConfirmsOrDie();

Sure, makes sense. The only thing that's unusual in your case is the use 
of mandatory in order to test if the queue has been unbound. Normally I 
would say "well, don't unbind it then", this is not the sort of thing 
that will happen spontaneously :)

If you know the name of the queue you want to publish to then an 
alternative would be to publish via the default exchange. Since queues 
are always implicitly bound to the default exchange you could lose the 
use of "mandatory" there. Assuming you are not going to delete the queue 
in question...

> I also setup event handlers BasicAcks, BasicNacks&  BasicReturn.
> If for testing purposes I unbind the queue from the exchange, and send
> a single message,  I get a BasicAck and a BasicReturn(NO_ROUTE) back,
> however the Model.WaitForConfirmsOrDie() returns without error.

Yes, WaitForConfirmsOrDie() is just counting acks aka confirms. 
Basic.return is a different thing. RabbitMQ will ensure that by the time 
you get an ack back, you will have received a basic.return if one was 
going to be sent.

> This
> seems inconsistent in that my message has been lost as there is no
> queue bound to the exchange and I have specified mandatory and every
> persistent option I can find. Is this correct, or am I doing something
> wrong? Do I need to do/check both (WaitForConfirms&  BasicReturn event
> msg) to be sure the message was successfully delivered to the queue?

Yes.

The meaning of a confirm is "RabbitMQ has taken responsibility for the 
message, and handled it in whatever way it was meant to be handled". If 
that means dropping it on the floor as unrouted then so be it - the 
assumption is that the routing is set up how you wanted it. manadtory / 
basic.return then adds on top of that the ability to check that a 
message got routed somewhere.

> Where is the documentation for API calls which are not documented in
> the API doc, an example is WaitForConfirmsOrDie, but there are many
> others?

Hmm. The HTMLdoc for those is not coming through. Looks like invalid 
XML. Will file a bug.

It's in the source:
http://hg.rabbitmq.com/rabbitmq-dotnet-client/file/rabbitmq_v2_6_1/projects/client/RabbitMQ.Client/src/client/api/IModel.cs#l320

> I read one of the other posts directing people away from transactions
> and towards the Model/Channel.ConfirmSelect&
> Model.WaitForConfirmsOrDie() model, so I have not investigated
> transactions.

That's reasonable.

> What about connection heart beating? I know from my experience with
> other products HB's are good way to keep the client and server in-sync
> and aware if the other party has gone off line. Should I overwrite the
> default which appears to be no heartbeats?

Yes, that would be reasonable. Depends on whether you're more concerned 
about a short connectivity loss killing your connections or a long one 
going undetected...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From mattgurney at gmail.com  Wed Oct 19 11:44:28 2011
From: mattgurney at gmail.com (Matt Gurney - gmail)
Date: Wed, 19 Oct 2011 21:44:28 +1100
Subject: [rabbitmq-discuss] Highest Reliability simple publish to a queue
In-Reply-To: <88E590DC4586974D825FC82AE798294E5206892B@GSVCLU03.ges.ferlan.it>
References: <0b4cc204-d344-4735-9cd4-fc5108263db3@e25g2000pri.googlegroups.com><CAOn7oW9MNhC6AY_B4YXtqxJzc3on_KOrEYEkw_ubohOY9-ersw@mail.gmail.com>
	<ce50ee6d-cd59-4741-9282-60ac7a8e88fd@p27g2000prp.googlegroups.com>
	<88E590DC4586974D825FC82AE798294E5206892B@GSVCLU03.ges.ferlan.it>
Message-ID: <00c701cc8e4c$17245ee0$456d1ca0$@gmail.com>

Thanks Simone, I found some good info on the link you provided which was
useful:
https://groups.google.com/d/topic/rabbitmq-discuss/3gfagTaY97k/discussion,
it describes the use of WaitForConfirms() but I cannot see any explanation
of WaitForConfirmsOrDie() anywhere. I have checked the .Net API doc, .Net
Client Library User Guide and the archives of this email list.

Matt.

-----Original Message-----
From: Busoli, Simone [mailto:Simone.Busoli at ferrari.com] 
Sent: Wednesday, 19 October 2011 9:26 PM
To: Matt G; rabbitmq-discuss at lists.rabbitmq.com
Subject: RE: [rabbitmq-discuss] Highest Reliability simple publish to a
queue

https://groups.google.com/d/topic/rabbitmq-discuss/3gfagTaY97k/discussion

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com
[mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Matt G
Sent: mercoled? 19 ottobre 2011 12:16
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Highest Reliability simple publish to a
queue

Thanks Simone, Which of my six questions do you think I can find the answer
for in the archives, I am not finding the answers I am after.
If anyone else can have a quick look at my questions it would be much
appreciated, I am a new comer to RMQ and I think my questions may be simple
for anyone with some experience.

Our requirement is to reliably persist the web service payload into a RMQ as
per the "Responsibility Transfer" pattern on page 21 of the RabbitMQ .Net
Client Library User Guide. I have implemented the options as described in
that section, I am just checking if there is anything else I need.

The lack of any documentation on WaitForConfirmsOrDie() bothers me,
currently I am assuming that it blocks program execution until all
confirm/nack/ack/reply due to the Model/Channel.ConfirmSelect are received.
But I can not find this documented anywhere. I mean, is that what it does,
how long does it wait before the "Die" and what happens when it "Dies" etc.

On Oct 19, 6:35?am, Simone Busoli <simone.bus... at gmail.com> wrote:
> Hi Mike, this has been asked several times on the list recently, I 
> think you will find your answer by searching the archives.
> By the way, I am curious why you want to do everything synchronously 
> as you wouldn't need Rabbit for that.
> On Oct 18, 2011 4:32 PM, "Matt G" <mattgur... at gmail.com> wrote:
>
>
>
>
>
>
>
> > Hi,
>
> > I have a simple scenario where a web service will receive a http 
> > request and I would like to insert the request into a queue, and be 
> > sure the message has arrived on the queue before synchronously 
> > responding to the http request.
>
> > Ideally I would like RMQ to "guarantee" that the message has been 
> > delivered to the queue. I have been using IBM MQ and TIBCO EMS (JMS
> > implementation) for many years, but I am new to RMQ.
>
> > Performance is not an issue, the volume will not be an issue.
>
> > I am using c# with latest AMQ versions on Windows and Linux.
>
> > So far it appears to me that I should use the following, can you 
> > review my list and edit as necessary:
> > Durable exchange
> > ExchangeType.Direct
> > Durable queue
> > Persistent message (Delivery Mode = 2) Mandatory message 
> > Model/Channel.ConfirmSelect & ?Model.WaitForConfirmsOrDie();
>
> > I also setup event handlers BasicAcks, BasicNacks & BasicReturn.
> > If for testing purposes I unbind the queue from the exchange, and 
> > send a single message, ?I get a BasicAck and a BasicReturn(NO_ROUTE) 
> > back, however the Model.WaitForConfirmsOrDie() returns without 
> > error. This seems inconsistent in that my message has been lost as 
> > there is no queue bound to the exchange and I have specified 
> > mandatory and every persistent option I can find. Is this correct, 
> > or am I doing something wrong? Do I need to do/check both 
> > (WaitForConfirms & BasicReturn event
> > msg) to be sure the message was successfully delivered to the queue?
>
> > Where is the documentation for API calls which are not documented in 
> > the API doc, an example is WaitForConfirmsOrDie, but there are many 
> > others?
>
> > I read one of the other posts directing people away from 
> > transactions and towards the Model/Channel.ConfirmSelect &
> > Model.WaitForConfirmsOrDie() model, so I have not investigated 
> > transactions.
>
> > What about connection heart beating? I know from my experience with 
> > other products HB's are good way to keep the client and server 
> > in-sync and aware if the other party has gone off line. Should I 
> > overwrite the default which appears to be no heartbeats?
>
> > I am not currently using any of the helper/pattern classes, would 
> > one of those be suitable for my requirements for high reliability.
>
> > Thanks,
> > Matt.
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/
> mailman/listinfo/rabbitmq-discuss
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

____________________________________________________________________________
_____________________________________
Questo messaggio ? da intendersi esclusivamente ad uso del destinatario e
pu? contenere informazioni che sono di natura privilegiata, confidenziale o
non divulgabile secondo le leggi vigenti. Se il lettore del presente
messaggio non ? il destinatario designato, o il dipendente/agente
responsabile per la consegna del messaggio al destinatario designato, si
informa che ogni disseminazione, distribuzione o copiatura di questa
comunicazione ? strettamente proibita anche ai sensi del decreto legislativo
196/03 . Se avete ricevuto questo messaggio per errore, vi preghiamo di
notificarcelo immediatamente a mezzo e-mail di risposta e successivamente di
procedere alla cancellazione di questa e-mail e relativi allegati dal vostro
sistema.
____________________________________________________________________________
_____________________________________
This message is intended only for the use of the addressee and may contain
information that is privileged, confidential and exempt from disclosure
under applicable law. If the reader of this message is not the intended
recipient, or the employee or agent responsible for delivering the message
to the intended recipient, you are hereby notified that any dissemination,
distribution or copying of this communication is strictly prohibited. If you
have received this e-mail in error, please notify us immediately by return
e-mail and delete this e-mail and all attachments from your system.
____________________________________________________________________________
_____________________________________




From simon at rabbitmq.com  Wed Oct 19 11:45:56 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 19 Oct 2011 11:45:56 +0100
Subject: [rabbitmq-discuss] Connection remains valid but disappears from
 rabbitmqctl list_connections & RMQ Admin HTTP Interface
In-Reply-To: <00ba01cc8e49$d5accc10$81066430$@cloud-integrations.com>
References: <00ba01cc8e49$d5accc10$81066430$@cloud-integrations.com>
Message-ID: <4E9EAA64.8060807@rabbitmq.com>

On 19/10/11 11:28, Matt Gurney - Cloud Integration wrote:
> I was doing some testing today and I noticed that dormant connections
> disappear from the rabbitmqctl list_connections & the RMQ Admin HTTP
> Interface screen.
>
> If I create a new connection, model, exchange, queue and send a message,
> then sleep for 30 seconds typically after about 10 seconds I will see
> the connection disappear from the rabbitmqctl list_connections & the RMQ
> Admin HTTP Interface screen. If the application then sends another
> message, the connection is still valid and the message is delivered. Is
> this expected behaviour.

No, that should definitely not be happening - you're using the .net 
client? Can you post some code that demonstrates this?

Cheers, Simon
-- 
Simon MacMullen
RabbitMQ, VMware

From mattgurney at gmail.com  Wed Oct 19 14:35:10 2011
From: mattgurney at gmail.com (Matt G)
Date: Wed, 19 Oct 2011 06:35:10 -0700 (PDT)
Subject: [rabbitmq-discuss] Connection remains valid but disappears from
 rabbitmqctl list_connections & RMQ Admin HTTP Interface
In-Reply-To: <4E9EAA64.8060807@rabbitmq.com>
References: <00ba01cc8e49$d5accc10$81066430$@cloud-integrations.com>
	<4E9EAA64.8060807@rabbitmq.com>
Message-ID: <fa0b08a8-f13d-4a9e-b0d8-be49b427f007@u13g2000prm.googlegroups.com>

Yes, I am using the .net client. I can see what my issue was now. I
was using the VS IDE to debug and I had put a break point into my
code, however I had also set connectionFactory.RequestedHeartbeat to 5
seconds, so after 5 seconds the channel stopped. I don't know why I
thought the messages continued to be delivered after I resumed the
debug session/removed the break point, when I try that now my model &
connection shutdown handlers immediately fire reporting
"System.IO.IOException: Unable to read data from the transport
connection: An established connection was aborted by the software in
your host machine. ". So I guess it is working the way it should,
thanks for the quick reply and sorry for raising a false alarm.

Matt.

On Oct 19, 9:45?pm, Simon MacMullen <si... at rabbitmq.com> wrote:
> On 19/10/11 11:28, Matt Gurney - Cloud Integration wrote:
>
> > I was doing some testing today and I noticed that dormant connections
> > disappear from the rabbitmqctl list_connections & the RMQ Admin HTTP
> > Interface screen.
>
> > If I create a new connection, model, exchange, queue and send a message,
> > then sleep for 30 seconds typically after about 10 seconds I will see
> > the connection disappear from the rabbitmqctl list_connections & the RMQ
> > Admin HTTP Interface screen. If the application then sends another
> > message, the connection is still valid and the message is delivered. Is
> > this expected behaviour.
>
> No, that should definitely not be happening - you're using the .net
> client? Can you post some code that demonstrates this?
>
> Cheers, Simon
> --
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From adamrabung at gmail.com  Wed Oct 19 14:39:54 2011
From: adamrabung at gmail.com (Adam Rabung)
Date: Wed, 19 Oct 2011 09:39:54 -0400
Subject: [rabbitmq-discuss] Possible clustering layout
Message-ID: <CAAN_EDokGK05tWaiP_2S9MxhmzR+n=VoiP4JN7EgZ6G15ULNhg@mail.gmail.com>

Hello,
I am thinking through how to lay out a rabbit cluster.  One possible
clustering approach would be have all exchanges/queues duplicated across
each node in the cluster.  Publishers load balance which node they publish
to, and consumers subscribe to their applicable queues on all nodes.  Each
node is completely independent.

This approach seems to have the benefit of avoiding unforeseen hops when a
publisher or consumer connects to a node that does not hold the queue.  It
also seems beneficial from a fault tolerance standpoint to have messages for
a logical queue spread evenly across n nodes.

One downside I see is the maintenance of these nodes: changing a binding
means changing it in n places.

Is this an acceptable approach, or am I barking up the wrong tree?

Thanks,
Adam
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111019/79bbcb40/attachment.htm>

From majek04 at gmail.com  Wed Oct 19 14:57:53 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 19 Oct 2011 14:57:53 +0100
Subject: [rabbitmq-discuss] Invitation to Keeping It Realtime conference,
	Portland, OR
Message-ID: <CABzX+qzspCmodgsB7_LThHmi7VtAeu2o-ijHabK75d0HbM_vqQ@mail.gmail.com>

Good news everyone!

I?m delighted to announce that I?ll be giving a talk about SockJS at
the Keeping It Realtime conference (Portland, OR; 7-8 Nov 2011)

For more details see the post on our blog:
 * http://www.rabbitmq.com/blog/2011/10/19/keeping-it-realtime-conference-portland-or/

And the conference website:
 * http://krtconf.com/

See you there!

Cheers,
  Marek

From mattgurney at gmail.com  Wed Oct 19 15:27:46 2011
From: mattgurney at gmail.com (Matt G)
Date: Wed, 19 Oct 2011 07:27:46 -0700 (PDT)
Subject: [rabbitmq-discuss] Highest Reliability simple publish to a queue
In-Reply-To: <4E9EA9C6.10809@rabbitmq.com>
References: <0b4cc204-d344-4735-9cd4-fc5108263db3@e25g2000pri.googlegroups.com>
	<4E9EA9C6.10809@rabbitmq.com>
Message-ID: <7ed78015-8608-4d7b-aec3-8efbb856f1ca@u10g2000prl.googlegroups.com>

Thanks Simon, that answers all my questions.

Matt.

On Oct 19, 9:43?pm, Simon MacMullen <si... at rabbitmq.com> wrote:
> On 18/10/11 15:16, Matt G wrote:
>
> > So far it appears to me that I should use the following, can you
> > review my list and edit as necessary:
> > Durable exchange
> > ExchangeType.Direct
> > Durable queue
> > Persistent message (Delivery Mode = 2)
> > Mandatory message
> > Model/Channel.ConfirmSelect& ? Model.WaitForConfirmsOrDie();
>
> Sure, makes sense. The only thing that's unusual in your case is the use
> of mandatory in order to test if the queue has been unbound. Normally I
> would say "well, don't unbind it then", this is not the sort of thing
> that will happen spontaneously :)
>
> If you know the name of the queue you want to publish to then an
> alternative would be to publish via the default exchange. Since queues
> are always implicitly bound to the default exchange you could lose the
> use of "mandatory" there. Assuming you are not going to delete the queue
> in question...
>
> > I also setup event handlers BasicAcks, BasicNacks& ?BasicReturn.
> > If for testing purposes I unbind the queue from the exchange, and send
> > a single message, ?I get a BasicAck and a BasicReturn(NO_ROUTE) back,
> > however the Model.WaitForConfirmsOrDie() returns without error.
>
> Yes, WaitForConfirmsOrDie() is just counting acks aka confirms.
> Basic.return is a different thing. RabbitMQ will ensure that by the time
> you get an ack back, you will have received a basic.return if one was
> going to be sent.
>
> > This
> > seems inconsistent in that my message has been lost as there is no
> > queue bound to the exchange and I have specified mandatory and every
> > persistent option I can find. Is this correct, or am I doing something
> > wrong? Do I need to do/check both (WaitForConfirms& ?BasicReturn event
> > msg) to be sure the message was successfully delivered to the queue?
>
> Yes.
>
> The meaning of a confirm is "RabbitMQ has taken responsibility for the
> message, and handled it in whatever way it was meant to be handled". If
> that means dropping it on the floor as unrouted then so be it - the
> assumption is that the routing is set up how you wanted it. manadtory /
> basic.return then adds on top of that the ability to check that a
> message got routed somewhere.
>
> > Where is the documentation for API calls which are not documented in
> > the API doc, an example is WaitForConfirmsOrDie, but there are many
> > others?
>
> Hmm. The HTMLdoc for those is not coming through. Looks like invalid
> XML. Will file a bug.
>
> It's in the source:http://hg.rabbitmq.com/rabbitmq-dotnet-client/file/rabbitmq_v2_6_1/pr...
>
> > I read one of the other posts directing people away from transactions
> > and towards the Model/Channel.ConfirmSelect&
> > Model.WaitForConfirmsOrDie() model, so I have not investigated
> > transactions.
>
> That's reasonable.
>
> > What about connection heart beating? I know from my experience with
> > other products HB's are good way to keep the client and server in-sync
> > and aware if the other party has gone off line. Should I overwrite the
> > default which appears to be no heartbeats?
>
> Yes, that would be reasonable. Depends on whether you're more concerned
> about a short connectivity loss killing your connections or a long one
> going undetected...
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From jerryk at vmware.com  Wed Oct 19 18:38:17 2011
From: jerryk at vmware.com (Jerry Kuch)
Date: Wed, 19 Oct 2011 10:38:17 -0700 (PDT)
Subject: [rabbitmq-discuss] Possible clustering layout
In-Reply-To: <CAAN_EDokGK05tWaiP_2S9MxhmzR+n=VoiP4JN7EgZ6G15ULNhg@mail.gmail.com>
Message-ID: <b9b22583-c63e-48fa-b5bf-cc559641b2b6@CoachZ.local>

Hi, Adam...

I'm perhaps a bit confused.  I assume your goal is tolerating the failure of
individual nodes?

Have you looked at the new active/active HA that debuted in RabbitMQ 2.6.x?
It allows for queues to be replicated automatically across the nodes of a 
cluster with a user-selectable number of replicas.

Older Rabbits also support an active/passive HA using shared storage.

As you suggest, you might find building the sort of logic you're talking about 
entirely outside of the broker daunting and surprisingly difficult to get 
quite what you want out of, as well as being difficult to administer.

Best regards,
Jerry

----- Original Message -----
From: "Adam Rabung" <adamrabung at gmail.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Wednesday, October 19, 2011 6:39:54 AM
Subject: [rabbitmq-discuss] Possible clustering layout



Hello, I am thinking through how to lay out a rabbit cluster. One possible clustering approach would be have all exchanges/queues duplicated across each node in the cluster. Publishers load balance which node they publish to, and consumers subscribe to their applicable queues on all nodes. Each node is completely independent. 


This approach seems to have the benefit of avoiding unforeseen hops when a publisher or consumer connects to a node that does not hold the queue. It also seems beneficial from a fault tolerance standpoint to have messages for a logical queue spread evenly across n nodes. 


One downside I see is the maintenance of these nodes: changing a binding means changing it in n places. 


Is this an acceptable approach, or am I barking up the wrong tree? 


Thanks, 
Adam 
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From james.r.carr at gmail.com  Wed Oct 19 19:02:03 2011
From: james.r.carr at gmail.com (James Carr)
Date: Wed, 19 Oct 2011 13:02:03 -0500
Subject: [rabbitmq-discuss] Upgrading...
Message-ID: <CAJreXKB2AR=f6vyn8FsVVq1urUCWkyX=wv_zQXCJz+A=h8HQvQ@mail.gmail.com>

Is there a nice simple way to upgrade rabbitMQ and have all of the
queues. exchanges, and users ported over?

I just upgraded on our test servers using the noarch RPM on Oracle
Enterprise Linux and noticed that all of the users, queues, and
exchanges  are now gone.

Thanks,
James

From adamrabung at gmail.com  Wed Oct 19 19:16:24 2011
From: adamrabung at gmail.com (Adam Rabung)
Date: Wed, 19 Oct 2011 14:16:24 -0400
Subject: [rabbitmq-discuss] Possible clustering layout
In-Reply-To: <b9b22583-c63e-48fa-b5bf-cc559641b2b6@CoachZ.local>
References: <CAAN_EDokGK05tWaiP_2S9MxhmzR+n=VoiP4JN7EgZ6G15ULNhg@mail.gmail.com>
	<b9b22583-c63e-48fa-b5bf-cc559641b2b6@CoachZ.local>
Message-ID: <CAAN_EDo-LFQJJNAOrztDKAR-WNZD-kAoTinWCY9ZQMbroQtz1g@mail.gmail.com>

Don't worry, I'm definitely the confused one :)

I'm having a hard time finding info on the Active/Active HA in 2.6.  The FAQ
and Clustering Guide led me to believe this feature didn't exist yet.  Do
you know where I can find good info on this new feature?

I'd say our main goal is horizontal scalability for performance sake.  We've
come to the conclusion that we can RAID disks, and if a queue node goes
down, we can bring up a new node with the old disk in human-scale times.

What do you think?  Thank you for any feedback.

Adam

On Wed, Oct 19, 2011 at 1:38 PM, Jerry Kuch <jerryk at vmware.com> wrote:

> Hi, Adam...
>
> I'm perhaps a bit confused.  I assume your goal is tolerating the failure
> of
> individual nodes?
>
> Have you looked at the new active/active HA that debuted in RabbitMQ 2.6.x?
> It allows for queues to be replicated automatically across the nodes of a
> cluster with a user-selectable number of replicas.
>
> Older Rabbits also support an active/passive HA using shared storage.
>
> As you suggest, you might find building the sort of logic you're talking
> about
> entirely outside of the broker daunting and surprisingly difficult to get
> quite what you want out of, as well as being difficult to administer.
>
> Best regards,
> Jerry
>
> ----- Original Message -----
> From: "Adam Rabung" <adamrabung at gmail.com>
> To: rabbitmq-discuss at lists.rabbitmq.com
> Sent: Wednesday, October 19, 2011 6:39:54 AM
> Subject: [rabbitmq-discuss] Possible clustering layout
>
>
>
> Hello, I am thinking through how to lay out a rabbit cluster. One possible
> clustering approach would be have all exchanges/queues duplicated across
> each node in the cluster. Publishers load balance which node they publish
> to, and consumers subscribe to their applicable queues on all nodes. Each
> node is completely independent.
>
>
> This approach seems to have the benefit of avoiding unforeseen hops when a
> publisher or consumer connects to a node that does not hold the queue. It
> also seems beneficial from a fault tolerance standpoint to have messages for
> a logical queue spread evenly across n nodes.
>
>
> One downside I see is the maintenance of these nodes: changing a binding
> means changing it in n places.
>
>
> Is this an acceptable approach, or am I barking up the wrong tree?
>
>
> Thanks,
> Adam
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111019/90310b3b/attachment.htm>

From matthew at rabbitmq.com  Wed Oct 19 19:20:27 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 19 Oct 2011 19:20:27 +0100
Subject: [rabbitmq-discuss] Upgrading...
In-Reply-To: <CAJreXKB2AR=f6vyn8FsVVq1urUCWkyX=wv_zQXCJz+A=h8HQvQ@mail.gmail.com>
References: <CAJreXKB2AR=f6vyn8FsVVq1urUCWkyX=wv_zQXCJz+A=h8HQvQ@mail.gmail.com>
Message-ID: <20111019182026.GA26298@wellquite.org>

On Wed, Oct 19, 2011 at 01:02:03PM -0500, James Carr wrote:
> Is there a nice simple way to upgrade rabbitMQ and have all of the
> queues. exchanges, and users ported over?
> 
> I just upgraded on our test servers using the noarch RPM on Oracle
> Enterprise Linux and noticed that all of the users, queues, and
> exchanges  are now gone.

Between which versions did you upgrade? Upgrading from a 2.1.0 broker
upwards should be lossless.

Matthew

From jerryk at vmware.com  Wed Oct 19 19:24:07 2011
From: jerryk at vmware.com (Jerry Kuch)
Date: Wed, 19 Oct 2011 11:24:07 -0700 (PDT)
Subject: [rabbitmq-discuss] Upgrading...
In-Reply-To: <CAJreXKB2AR=f6vyn8FsVVq1urUCWkyX=wv_zQXCJz+A=h8HQvQ@mail.gmail.com>
Message-ID: <e8588f29-4e6c-45c5-9e21-35da12172431@CoachZ.local>

Rabbit's generally pretty smart (at least with upgrades between modern
versions) about migrating over and updating Mnesia contents and the
like.  What probably happened with the RPM upgrade is that the RPM
install process blew away the directories where that stuff lives.

I think one could make note of where all that stuff is, move it aside 
for safekeeping before doing the RPM upgrade/install, and then move it
back, and allow the broker to up-version the stuff at its next start up.
Rabbit's logic for doing the right thing is fairly sophisticated and I'd
think it should work in that scenario, although I've not tried it
myself.

Somebody else on the Rabbit team with more day to day experience on that
stuff is likely able to comment more authoritatively, or at least refute
what I just said if it's obviously wrongheaded...?

Best regards,
Jerry

----- Original Message -----
From: "James Carr" <james.r.carr at gmail.com>
To: "rabbitmq-discuss" <rabbitmq-discuss at lists.rabbitmq.com>
Sent: Wednesday, October 19, 2011 11:02:03 AM
Subject: [rabbitmq-discuss] Upgrading...

Is there a nice simple way to upgrade rabbitMQ and have all of the
queues. exchanges, and users ported over?

I just upgraded on our test servers using the noarch RPM on Oracle
Enterprise Linux and noticed that all of the users, queues, and
exchanges  are now gone.

Thanks,
James
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From jerryk at vmware.com  Wed Oct 19 19:35:52 2011
From: jerryk at vmware.com (Jerry Kuch)
Date: Wed, 19 Oct 2011 11:35:52 -0700 (PDT)
Subject: [rabbitmq-discuss] Possible clustering layout
In-Reply-To: <CAAN_EDo-LFQJJNAOrztDKAR-WNZD-kAoTinWCY9ZQMbroQtz1g@mail.gmail.com>
Message-ID: <71b8d207-e108-46e6-aea0-c99f9df58d37@CoachZ.local>

> From: "Adam Rabung" <adamrabung at gmail.com>
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Sent: Wednesday, October 19, 2011 11:16:24 AM
> Subject: Re: [rabbitmq-discuss] Possible clustering layout
>
> Don't worry, I'm definitely the confused one :)

Hi, Adam... no worries.  The language around the words "clustering"
and "HA" in the Rabbit world is tricky and has a complex history. :-)

> I'm having a hard time finding info on the Active/Active HA in
> 2.6. The FAQ and Clustering Guide led me to believe this feature
> didn't exist yet. Do you know where I can find good info on this new
> feature?

It's pretty much brand new, having appeared in the most recent
releases.  You can read details here:

http://www.rabbitmq.com/ha.html

This describes the mirrored queue functionality and how to request and
specify mirroring for your queues.

Release notes for RabbitMQ 2.6.1 are here:

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110912/35da167c/attachment.txt

The active/active, mirrored queues flavor of HA actually first
appeared immediately previous in 2.6.0, with release notes here:

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110831/36015373/attachment.txt

Look for the word "mirrored" in that write up.

> I'd say our main goal is horizontal scalability for performance
> sake. We've come to the conclusion that we can RAID disks, and if a
> queue node goes down, we can bring up a new node with the old disk in
> human-scale times.
>
> What do you think? Thank you for any feedback.

The new active/active, mirrored queue HA is something you likely want
to investigate.  The older RabbitMQ clustering for capacity involved
building a cluster of RabbitMQ nodes, although for implementation
reasons each queue really only existed on one of the nodes, and would
become unavailable with that node's failure.  Thus, you could get greater
throughput overall, but not greater throughput through any particular
queue, which is probably roughly the type of horizontal scalability
you're after.  On the downside, with clustering alone you'd be
vulnerable to that queue's host node failing.  The remedy in those
times was to back queues by shared storage (preferably a decent SAN
solution or the like) and run a hot standby of each node, using
something like Pacemaker to detect failure and do the switch over from
passive to active.  Should you prefer that approach to the new one,
you can still do it, but the new model has fewer moving parts to set
up.

Also, be mindful that with the new active/active HA being so recently
released, you'll have to apply a careful eye to any documentation you
read, since most of it will still refer to the old model.

Best regards,
Jerry

From jerryk at vmware.com  Wed Oct 19 19:37:12 2011
From: jerryk at vmware.com (Jerry Kuch)
Date: Wed, 19 Oct 2011 11:37:12 -0700 (PDT)
Subject: [rabbitmq-discuss] Upgrading...
In-Reply-To: <e8588f29-4e6c-45c5-9e21-35da12172431@CoachZ.local>
Message-ID: <c8884141-d44e-40ff-bad3-96e10ab66cc1@CoachZ.local>

Also:  with some further consideration a straight out RPM upgrade
really shouldn't have destroyed your existing data.  Can you
reproduce that on a test system somewhere and let us know what
versions of everything you used and what you saw?  It may have
been some other mishap on the system, but if you have a cut and
dried case of an RPM upgrade hosing away existing data, I'd like
to look into that...

Best regards,
Jerry

----- Original Message -----
From: "Jerry Kuch" <jerryk at vmware.com>
To: "James Carr" <james.r.carr at gmail.com>
Cc: "rabbitmq-discuss" <rabbitmq-discuss at lists.rabbitmq.com>
Sent: Wednesday, October 19, 2011 11:24:07 AM
Subject: Re: [rabbitmq-discuss] Upgrading...

Rabbit's generally pretty smart (at least with upgrades between modern
versions) about migrating over and updating Mnesia contents and the
like.  What probably happened with the RPM upgrade is that the RPM
install process blew away the directories where that stuff lives.

I think one could make note of where all that stuff is, move it aside 
for safekeeping before doing the RPM upgrade/install, and then move it
back, and allow the broker to up-version the stuff at its next start up.
Rabbit's logic for doing the right thing is fairly sophisticated and I'd
think it should work in that scenario, although I've not tried it
myself.

Somebody else on the Rabbit team with more day to day experience on that
stuff is likely able to comment more authoritatively, or at least refute
what I just said if it's obviously wrongheaded...?

Best regards,
Jerry

----- Original Message -----
From: "James Carr" <james.r.carr at gmail.com>
To: "rabbitmq-discuss" <rabbitmq-discuss at lists.rabbitmq.com>
Sent: Wednesday, October 19, 2011 11:02:03 AM
Subject: [rabbitmq-discuss] Upgrading...

Is there a nice simple way to upgrade rabbitMQ and have all of the
queues. exchanges, and users ported over?

I just upgraded on our test servers using the noarch RPM on Oracle
Enterprise Linux and noticed that all of the users, queues, and
exchanges  are now gone.

Thanks,
James
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From james.r.carr at gmail.com  Wed Oct 19 19:38:01 2011
From: james.r.carr at gmail.com (James Carr)
Date: Wed, 19 Oct 2011 13:38:01 -0500
Subject: [rabbitmq-discuss] Upgrading...
In-Reply-To: <e8588f29-4e6c-45c5-9e21-35da12172431@CoachZ.local>
References: <CAJreXKB2AR=f6vyn8FsVVq1urUCWkyX=wv_zQXCJz+A=h8HQvQ@mail.gmail.com>
	<e8588f29-4e6c-45c5-9e21-35da12172431@CoachZ.local>
Message-ID: <CAJreXKCnX=Kw503RSx-WeoKb-N0N=Oeotat-fErwZueSD8eGeg@mail.gmail.com>

I'm stupid... as part of upgrading our test environment we added a new
node to the test cluster. I was viewing that node's management panel
and hadn't joined it yet. :)


On Wed, Oct 19, 2011 at 1:24 PM, Jerry Kuch <jerryk at vmware.com> wrote:
> Rabbit's generally pretty smart (at least with upgrades between modern
> versions) about migrating over and updating Mnesia contents and the
> like. ?What probably happened with the RPM upgrade is that the RPM
> install process blew away the directories where that stuff lives.
>
> I think one could make note of where all that stuff is, move it aside
> for safekeeping before doing the RPM upgrade/install, and then move it
> back, and allow the broker to up-version the stuff at its next start up.
> Rabbit's logic for doing the right thing is fairly sophisticated and I'd
> think it should work in that scenario, although I've not tried it
> myself.
>
> Somebody else on the Rabbit team with more day to day experience on that
> stuff is likely able to comment more authoritatively, or at least refute
> what I just said if it's obviously wrongheaded...?
>
> Best regards,
> Jerry
>
> ----- Original Message -----
> From: "James Carr" <james.r.carr at gmail.com>
> To: "rabbitmq-discuss" <rabbitmq-discuss at lists.rabbitmq.com>
> Sent: Wednesday, October 19, 2011 11:02:03 AM
> Subject: [rabbitmq-discuss] Upgrading...
>
> Is there a nice simple way to upgrade rabbitMQ and have all of the
> queues. exchanges, and users ported over?
>
> I just upgraded on our test servers using the noarch RPM on Oracle
> Enterprise Linux and noticed that all of the users, queues, and
> exchanges ?are now gone.
>
> Thanks,
> James
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From jerryk at vmware.com  Wed Oct 19 19:39:07 2011
From: jerryk at vmware.com (Jerry Kuch)
Date: Wed, 19 Oct 2011 11:39:07 -0700 (PDT)
Subject: [rabbitmq-discuss] Upgrading...
In-Reply-To: <CAJreXKCnX=Kw503RSx-WeoKb-N0N=Oeotat-fErwZueSD8eGeg@mail.gmail.com>
Message-ID: <b50f8cc4-e8c8-462f-8de3-7f6a3db7809e@CoachZ.local>

Hi, James...

Ah, good to hear that you didn't lose any data!

Best regards,
Jerry

----- Original Message -----
From: "James Carr" <james.r.carr at gmail.com>
To: "Jerry Kuch" <jerryk at vmware.com>
Cc: "rabbitmq-discuss" <rabbitmq-discuss at lists.rabbitmq.com>
Sent: Wednesday, October 19, 2011 11:38:01 AM
Subject: Re: [rabbitmq-discuss] Upgrading...

I'm stupid... as part of upgrading our test environment we added a new
node to the test cluster. I was viewing that node's management panel
and hadn't joined it yet. :)


On Wed, Oct 19, 2011 at 1:24 PM, Jerry Kuch <jerryk at vmware.com> wrote:
> Rabbit's generally pretty smart (at least with upgrades between modern
> versions) about migrating over and updating Mnesia contents and the
> like. ?What probably happened with the RPM upgrade is that the RPM
> install process blew away the directories where that stuff lives.
>
> I think one could make note of where all that stuff is, move it aside
> for safekeeping before doing the RPM upgrade/install, and then move it
> back, and allow the broker to up-version the stuff at its next start up.
> Rabbit's logic for doing the right thing is fairly sophisticated and I'd
> think it should work in that scenario, although I've not tried it
> myself.
>
> Somebody else on the Rabbit team with more day to day experience on that
> stuff is likely able to comment more authoritatively, or at least refute
> what I just said if it's obviously wrongheaded...?
>
> Best regards,
> Jerry
>
> ----- Original Message -----
> From: "James Carr" <james.r.carr at gmail.com>
> To: "rabbitmq-discuss" <rabbitmq-discuss at lists.rabbitmq.com>
> Sent: Wednesday, October 19, 2011 11:02:03 AM
> Subject: [rabbitmq-discuss] Upgrading...
>
> Is there a nice simple way to upgrade rabbitMQ and have all of the
> queues. exchanges, and users ported over?
>
> I just upgraded on our test servers using the noarch RPM on Oracle
> Enterprise Linux and noticed that all of the users, queues, and
> exchanges ?are now gone.
>
> Thanks,
> James
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From james.r.carr at gmail.com  Wed Oct 19 19:57:16 2011
From: james.r.carr at gmail.com (James Carr)
Date: Wed, 19 Oct 2011 13:57:16 -0500
Subject: [rabbitmq-discuss] Upgrading...
In-Reply-To: <b50f8cc4-e8c8-462f-8de3-7f6a3db7809e@CoachZ.local>
References: <CAJreXKCnX=Kw503RSx-WeoKb-N0N=Oeotat-fErwZueSD8eGeg@mail.gmail.com>
	<b50f8cc4-e8c8-462f-8de3-7f6a3db7809e@CoachZ.local>
Message-ID: <CAJreXKCrZ61BQJQNCwZ-b26nfGo4BeDi56oaVT24VCqDexiySw@mail.gmail.com>

So I upgraded to 2.6.1 and clustered it by adding another node to it.
I was experimenting with 2.6.1 because we're looking to have
replicated queues in our cluster since it's one thing that currently
kills us. :)

I noticed that when I go to node2 and view the queues, I see the
queues that were created on node1. However, if I bring node1 down the
queues just go away.

Is there something special I need to setup for replicated queues?

Thanks,
James

On Wed, Oct 19, 2011 at 1:39 PM, Jerry Kuch <jerryk at vmware.com> wrote:
> Hi, James...
>
> Ah, good to hear that you didn't lose any data!
>
> Best regards,
> Jerry
>
> ----- Original Message -----
> From: "James Carr" <james.r.carr at gmail.com>
> To: "Jerry Kuch" <jerryk at vmware.com>
> Cc: "rabbitmq-discuss" <rabbitmq-discuss at lists.rabbitmq.com>
> Sent: Wednesday, October 19, 2011 11:38:01 AM
> Subject: Re: [rabbitmq-discuss] Upgrading...
>
> I'm stupid... as part of upgrading our test environment we added a new
> node to the test cluster. I was viewing that node's management panel
> and hadn't joined it yet. :)
>
>
> On Wed, Oct 19, 2011 at 1:24 PM, Jerry Kuch <jerryk at vmware.com> wrote:
>> Rabbit's generally pretty smart (at least with upgrades between modern
>> versions) about migrating over and updating Mnesia contents and the
>> like. ?What probably happened with the RPM upgrade is that the RPM
>> install process blew away the directories where that stuff lives.
>>
>> I think one could make note of where all that stuff is, move it aside
>> for safekeeping before doing the RPM upgrade/install, and then move it
>> back, and allow the broker to up-version the stuff at its next start up.
>> Rabbit's logic for doing the right thing is fairly sophisticated and I'd
>> think it should work in that scenario, although I've not tried it
>> myself.
>>
>> Somebody else on the Rabbit team with more day to day experience on that
>> stuff is likely able to comment more authoritatively, or at least refute
>> what I just said if it's obviously wrongheaded...?
>>
>> Best regards,
>> Jerry
>>
>> ----- Original Message -----
>> From: "James Carr" <james.r.carr at gmail.com>
>> To: "rabbitmq-discuss" <rabbitmq-discuss at lists.rabbitmq.com>
>> Sent: Wednesday, October 19, 2011 11:02:03 AM
>> Subject: [rabbitmq-discuss] Upgrading...
>>
>> Is there a nice simple way to upgrade rabbitMQ and have all of the
>> queues. exchanges, and users ported over?
>>
>> I just upgraded on our test servers using the noarch RPM on Oracle
>> Enterprise Linux and noticed that all of the users, queues, and
>> exchanges ?are now gone.
>>
>> Thanks,
>> James
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>

From jerryk at vmware.com  Wed Oct 19 20:00:42 2011
From: jerryk at vmware.com (Jerry Kuch)
Date: Wed, 19 Oct 2011 12:00:42 -0700 (PDT)
Subject: [rabbitmq-discuss] Upgrading...
In-Reply-To: <CAJreXKCrZ61BQJQNCwZ-b26nfGo4BeDi56oaVT24VCqDexiySw@mail.gmail.com>
Message-ID: <a727545a-d7aa-4168-8082-c2d56a92a738@CoachZ.local>

Hi, James:

Are your queues declared durable?

See the section "Starting and stopping nodes" for a
discussion of the behavior you should expect:

http://www.rabbitmq.com/ha.html

Jerry

----- Original Message -----
From: "James Carr" <james.r.carr at gmail.com>
To: "Jerry Kuch" <jerryk at vmware.com>
Cc: "rabbitmq-discuss" <rabbitmq-discuss at lists.rabbitmq.com>
Sent: Wednesday, October 19, 2011 11:57:16 AM
Subject: Re: [rabbitmq-discuss] Upgrading...

So I upgraded to 2.6.1 and clustered it by adding another node to it.
I was experimenting with 2.6.1 because we're looking to have
replicated queues in our cluster since it's one thing that currently
kills us. :)

I noticed that when I go to node2 and view the queues, I see the
queues that were created on node1. However, if I bring node1 down the
queues just go away.

Is there something special I need to setup for replicated queues?

Thanks,
James

On Wed, Oct 19, 2011 at 1:39 PM, Jerry Kuch <jerryk at vmware.com> wrote:
> Hi, James...
>
> Ah, good to hear that you didn't lose any data!
>
> Best regards,
> Jerry
>
> ----- Original Message -----
> From: "James Carr" <james.r.carr at gmail.com>
> To: "Jerry Kuch" <jerryk at vmware.com>
> Cc: "rabbitmq-discuss" <rabbitmq-discuss at lists.rabbitmq.com>
> Sent: Wednesday, October 19, 2011 11:38:01 AM
> Subject: Re: [rabbitmq-discuss] Upgrading...
>
> I'm stupid... as part of upgrading our test environment we added a new
> node to the test cluster. I was viewing that node's management panel
> and hadn't joined it yet. :)
>
>
> On Wed, Oct 19, 2011 at 1:24 PM, Jerry Kuch <jerryk at vmware.com> wrote:
>> Rabbit's generally pretty smart (at least with upgrades between modern
>> versions) about migrating over and updating Mnesia contents and the
>> like. ?What probably happened with the RPM upgrade is that the RPM
>> install process blew away the directories where that stuff lives.
>>
>> I think one could make note of where all that stuff is, move it aside
>> for safekeeping before doing the RPM upgrade/install, and then move it
>> back, and allow the broker to up-version the stuff at its next start up.
>> Rabbit's logic for doing the right thing is fairly sophisticated and I'd
>> think it should work in that scenario, although I've not tried it
>> myself.
>>
>> Somebody else on the Rabbit team with more day to day experience on that
>> stuff is likely able to comment more authoritatively, or at least refute
>> what I just said if it's obviously wrongheaded...?
>>
>> Best regards,
>> Jerry
>>
>> ----- Original Message -----
>> From: "James Carr" <james.r.carr at gmail.com>
>> To: "rabbitmq-discuss" <rabbitmq-discuss at lists.rabbitmq.com>
>> Sent: Wednesday, October 19, 2011 11:02:03 AM
>> Subject: [rabbitmq-discuss] Upgrading...
>>
>> Is there a nice simple way to upgrade rabbitMQ and have all of the
>> queues. exchanges, and users ported over?
>>
>> I just upgraded on our test servers using the noarch RPM on Oracle
>> Enterprise Linux and noticed that all of the users, queues, and
>> exchanges ?are now gone.
>>
>> Thanks,
>> James
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>

From james.r.carr at gmail.com  Wed Oct 19 20:09:09 2011
From: james.r.carr at gmail.com (James Carr)
Date: Wed, 19 Oct 2011 14:09:09 -0500
Subject: [rabbitmq-discuss] Upgrading...
In-Reply-To: <a727545a-d7aa-4168-8082-c2d56a92a738@CoachZ.local>
References: <CAJreXKCrZ61BQJQNCwZ-b26nfGo4BeDi56oaVT24VCqDexiySw@mail.gmail.com>
	<a727545a-d7aa-4168-8082-c2d56a92a738@CoachZ.local>
Message-ID: <CAJreXKAxAN7gyR02NuaFTX04ZUL4MafVFOsyympeyZJf_k-oMw@mail.gmail.com>

Thanks for the quick reply.

All of the queues on the master node are durable.

However I noticed when creating new queues from the management console
I'm given the option to mirror the queue across all nodes or not. I'm
assuming that the defult for existing queues from 2.5.0 is to not
mirror them. Is there anyway to change this besides deleting and
re-declaring the queue?

Thanks,
James


On Wed, Oct 19, 2011 at 2:00 PM, Jerry Kuch <jerryk at vmware.com> wrote:
> Hi, James:
>
> Are your queues declared durable?
>
> See the section "Starting and stopping nodes" for a
> discussion of the behavior you should expect:
>
> http://www.rabbitmq.com/ha.html
>
> Jerry
>
> ----- Original Message -----
> From: "James Carr" <james.r.carr at gmail.com>
> To: "Jerry Kuch" <jerryk at vmware.com>
> Cc: "rabbitmq-discuss" <rabbitmq-discuss at lists.rabbitmq.com>
> Sent: Wednesday, October 19, 2011 11:57:16 AM
> Subject: Re: [rabbitmq-discuss] Upgrading...
>
> So I upgraded to 2.6.1 and clustered it by adding another node to it.
> I was experimenting with 2.6.1 because we're looking to have
> replicated queues in our cluster since it's one thing that currently
> kills us. :)
>
> I noticed that when I go to node2 and view the queues, I see the
> queues that were created on node1. However, if I bring node1 down the
> queues just go away.
>
> Is there something special I need to setup for replicated queues?
>
> Thanks,
> James
>
> On Wed, Oct 19, 2011 at 1:39 PM, Jerry Kuch <jerryk at vmware.com> wrote:
>> Hi, James...
>>
>> Ah, good to hear that you didn't lose any data!
>>
>> Best regards,
>> Jerry
>>
>> ----- Original Message -----
>> From: "James Carr" <james.r.carr at gmail.com>
>> To: "Jerry Kuch" <jerryk at vmware.com>
>> Cc: "rabbitmq-discuss" <rabbitmq-discuss at lists.rabbitmq.com>
>> Sent: Wednesday, October 19, 2011 11:38:01 AM
>> Subject: Re: [rabbitmq-discuss] Upgrading...
>>
>> I'm stupid... as part of upgrading our test environment we added a new
>> node to the test cluster. I was viewing that node's management panel
>> and hadn't joined it yet. :)
>>
>>
>> On Wed, Oct 19, 2011 at 1:24 PM, Jerry Kuch <jerryk at vmware.com> wrote:
>>> Rabbit's generally pretty smart (at least with upgrades between modern
>>> versions) about migrating over and updating Mnesia contents and the
>>> like. ?What probably happened with the RPM upgrade is that the RPM
>>> install process blew away the directories where that stuff lives.
>>>
>>> I think one could make note of where all that stuff is, move it aside
>>> for safekeeping before doing the RPM upgrade/install, and then move it
>>> back, and allow the broker to up-version the stuff at its next start up.
>>> Rabbit's logic for doing the right thing is fairly sophisticated and I'd
>>> think it should work in that scenario, although I've not tried it
>>> myself.
>>>
>>> Somebody else on the Rabbit team with more day to day experience on that
>>> stuff is likely able to comment more authoritatively, or at least refute
>>> what I just said if it's obviously wrongheaded...?
>>>
>>> Best regards,
>>> Jerry
>>>
>>> ----- Original Message -----
>>> From: "James Carr" <james.r.carr at gmail.com>
>>> To: "rabbitmq-discuss" <rabbitmq-discuss at lists.rabbitmq.com>
>>> Sent: Wednesday, October 19, 2011 11:02:03 AM
>>> Subject: [rabbitmq-discuss] Upgrading...
>>>
>>> Is there a nice simple way to upgrade rabbitMQ and have all of the
>>> queues. exchanges, and users ported over?
>>>
>>> I just upgraded on our test servers using the noarch RPM on Oracle
>>> Enterprise Linux and noticed that all of the users, queues, and
>>> exchanges ?are now gone.
>>>
>>> Thanks,
>>> James
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>
>

From james.r.carr at gmail.com  Wed Oct 19 20:29:41 2011
From: james.r.carr at gmail.com (James Carr)
Date: Wed, 19 Oct 2011 14:29:41 -0500
Subject: [rabbitmq-discuss] Upgrading...
In-Reply-To: <CAJreXKAxAN7gyR02NuaFTX04ZUL4MafVFOsyympeyZJf_k-oMw@mail.gmail.com>
References: <CAJreXKCrZ61BQJQNCwZ-b26nfGo4BeDi56oaVT24VCqDexiySw@mail.gmail.com>
	<a727545a-d7aa-4168-8082-c2d56a92a738@CoachZ.local>
	<CAJreXKAxAN7gyR02NuaFTX04ZUL4MafVFOsyympeyZJf_k-oMw@mail.gmail.com>
Message-ID: <CAJreXKCM5JQiApjt8OO0wuoK4pRM81pLd4EGK-NGpBt7LqTY0g@mail.gmail.com>

nevermind... I think we're just going to redeclare all the queues in
production anyway since the apps using them will be stopped for a
brief outage.Seems to be the easiest route :)

Thanks,
James

On Wed, Oct 19, 2011 at 2:09 PM, James Carr <james.r.carr at gmail.com> wrote:
> Thanks for the quick reply.
>
> All of the queues on the master node are durable.
>
> However I noticed when creating new queues from the management console
> I'm given the option to mirror the queue across all nodes or not. I'm
> assuming that the defult for existing queues from 2.5.0 is to not
> mirror them. Is there anyway to change this besides deleting and
> re-declaring the queue?
>
> Thanks,
> James
>
>
> On Wed, Oct 19, 2011 at 2:00 PM, Jerry Kuch <jerryk at vmware.com> wrote:
>> Hi, James:
>>
>> Are your queues declared durable?
>>
>> See the section "Starting and stopping nodes" for a
>> discussion of the behavior you should expect:
>>
>> http://www.rabbitmq.com/ha.html
>>
>> Jerry
>>
>> ----- Original Message -----
>> From: "James Carr" <james.r.carr at gmail.com>
>> To: "Jerry Kuch" <jerryk at vmware.com>
>> Cc: "rabbitmq-discuss" <rabbitmq-discuss at lists.rabbitmq.com>
>> Sent: Wednesday, October 19, 2011 11:57:16 AM
>> Subject: Re: [rabbitmq-discuss] Upgrading...
>>
>> So I upgraded to 2.6.1 and clustered it by adding another node to it.
>> I was experimenting with 2.6.1 because we're looking to have
>> replicated queues in our cluster since it's one thing that currently
>> kills us. :)
>>
>> I noticed that when I go to node2 and view the queues, I see the
>> queues that were created on node1. However, if I bring node1 down the
>> queues just go away.
>>
>> Is there something special I need to setup for replicated queues?
>>
>> Thanks,
>> James
>>
>> On Wed, Oct 19, 2011 at 1:39 PM, Jerry Kuch <jerryk at vmware.com> wrote:
>>> Hi, James...
>>>
>>> Ah, good to hear that you didn't lose any data!
>>>
>>> Best regards,
>>> Jerry
>>>
>>> ----- Original Message -----
>>> From: "James Carr" <james.r.carr at gmail.com>
>>> To: "Jerry Kuch" <jerryk at vmware.com>
>>> Cc: "rabbitmq-discuss" <rabbitmq-discuss at lists.rabbitmq.com>
>>> Sent: Wednesday, October 19, 2011 11:38:01 AM
>>> Subject: Re: [rabbitmq-discuss] Upgrading...
>>>
>>> I'm stupid... as part of upgrading our test environment we added a new
>>> node to the test cluster. I was viewing that node's management panel
>>> and hadn't joined it yet. :)
>>>
>>>
>>> On Wed, Oct 19, 2011 at 1:24 PM, Jerry Kuch <jerryk at vmware.com> wrote:
>>>> Rabbit's generally pretty smart (at least with upgrades between modern
>>>> versions) about migrating over and updating Mnesia contents and the
>>>> like. ?What probably happened with the RPM upgrade is that the RPM
>>>> install process blew away the directories where that stuff lives.
>>>>
>>>> I think one could make note of where all that stuff is, move it aside
>>>> for safekeeping before doing the RPM upgrade/install, and then move it
>>>> back, and allow the broker to up-version the stuff at its next start up.
>>>> Rabbit's logic for doing the right thing is fairly sophisticated and I'd
>>>> think it should work in that scenario, although I've not tried it
>>>> myself.
>>>>
>>>> Somebody else on the Rabbit team with more day to day experience on that
>>>> stuff is likely able to comment more authoritatively, or at least refute
>>>> what I just said if it's obviously wrongheaded...?
>>>>
>>>> Best regards,
>>>> Jerry
>>>>
>>>> ----- Original Message -----
>>>> From: "James Carr" <james.r.carr at gmail.com>
>>>> To: "rabbitmq-discuss" <rabbitmq-discuss at lists.rabbitmq.com>
>>>> Sent: Wednesday, October 19, 2011 11:02:03 AM
>>>> Subject: [rabbitmq-discuss] Upgrading...
>>>>
>>>> Is there a nice simple way to upgrade rabbitMQ and have all of the
>>>> queues. exchanges, and users ported over?
>>>>
>>>> I just upgraded on our test servers using the noarch RPM on Oracle
>>>> Enterprise Linux and noticed that all of the users, queues, and
>>>> exchanges ?are now gone.
>>>>
>>>> Thanks,
>>>> James
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>
>>>
>>
>

From james.r.carr at gmail.com  Wed Oct 19 20:53:35 2011
From: james.r.carr at gmail.com (James Carr)
Date: Wed, 19 Oct 2011 14:53:35 -0500
Subject: [rabbitmq-discuss] Shovel Plugin For HA
In-Reply-To: <4E96EE97.7090503@rabbitmq.com>
References: <CAJreXKDwNDT-LfMKhZJVikmTsjgY9d19gSsq3T8K-f_-TgjZ+g@mail.gmail.com>
	<4E96EE97.7090503@rabbitmq.com>
Message-ID: <CAJreXKCB2-bRJEO1Equ1rTmrYWe+GcvKNuuse4yTGcBYOE4+UA@mail.gmail.com>

Hi,

Reading the documentation, I noticed this statement:

"There are of course limitations, since this is a preview release. The
worst is that federation is not compatible with clustering. You
shouldn?t use the federation plugin in a cluster. This is the first
thing we?re going to fix."

Just so I can be sure I parsed that statement correctly, it's not
compatible when used as part of a cluster, not if the upstream is a
cluster. Is that correct?

Thanks,
James


On Thu, Oct 13, 2011 at 8:58 AM, Simon MacMullen <simon at rabbitmq.com> wrote:
> On 11/10/11 17:51, James Carr wrote:
>>
>> ?I'm just curious
>> if there is a softer way to handle this that allows for more dynamic
>> forwarding (one feature I always liked about AMQP is that client apps
>> can define exchanges and queues rather than having an admin set them up).
>
> You could check out the federation plugin:
>
> http://www.rabbitmq.com/plugins.html#rabbitmq_federation
> http://hg.rabbitmq.com/rabbitmq-federation/file/default/README
> http://www.rabbitmq.com/blog/2011/06/22/federation-plugin-preview-release/
>
> That's intended to be a slightly higher-level thing than the shovel.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From rasadoll at gmail.com  Wed Oct 19 21:02:11 2011
From: rasadoll at gmail.com (rasadoll)
Date: Wed, 19 Oct 2011 13:02:11 -0700 (PDT)
Subject: [rabbitmq-discuss] Message is delivered to all queue consumers when
	rabbitmq crashes
Message-ID: <67adaf50-e0a7-49f2-9868-4a362ab1333e@k35g2000yqh.googlegroups.com>

Hi,

I have multiple queue consumers running at the same time. They all
listen to one single queue. Messages are sent to the default exchange
with queue name as the routing key. When one of the consumers is busy
processing a message, before acking the message if RabbitMQ service
crashes (simply by stopping the service), the message is sent to all
other consumers immediately which results in processing the same
message multiple times concurrently. Is this the right behavior for
RabbitMQ?

Here is my queue design:

Map<String, Object> args = new HashMap<String, Object>();
args.put("x-ha-policy", "all");
channel.queueDeclare(JOB_EXEC_QUEUE, true, false, false, args);

I use durable HA queue but I am not running in a clustered
environment.
===========================
Message publishing:

channel.basicPublish("", JOB_EXEC_QUEUE,
MessageProperties.PERSISTENT_BASIC, message.getBytes());
===========================
Consumer Code:

channel.basicQos(1);
QueueingConsumer consumer = new QueueingConsumer(channel);
channel.basicConsume(JOB_EXEC_QUEUE, consumer);

QueueingConsumer.Delivery delivery;
while (true) {
        try {
          delivery = consumer.nextDelivery();
        } catch (InterruptedException ie) {
          continue;
        }

// process the message

       channel.basicAck(delivery.getEnvelope().getDeliveryTag(),
false);
}

I stop the service when one consumer is in the process message phase.

Am I doing something wrong? Is this an expected behavior for RabbitMQ?

Thanks,
Reza

From jerryk at vmware.com  Wed Oct 19 21:09:33 2011
From: jerryk at vmware.com (Jerry Kuch)
Date: Wed, 19 Oct 2011 13:09:33 -0700 (PDT)
Subject: [rabbitmq-discuss] Upgrading...
In-Reply-To: <CAJreXKCM5JQiApjt8OO0wuoK4pRM81pLd4EGK-NGpBt7LqTY0g@mail.gmail.com>
Message-ID: <ecda99db-6ddc-4f08-a192-06208bc39eb5@CoachZ.local>

James:  You should be quite safe doing that...

Jerry

----- Original Message -----
From: "James Carr" <james.r.carr at gmail.com>
To: "Jerry Kuch" <jerryk at vmware.com>
Cc: "rabbitmq-discuss" <rabbitmq-discuss at lists.rabbitmq.com>
Sent: Wednesday, October 19, 2011 12:29:41 PM
Subject: Re: [rabbitmq-discuss] Upgrading...

nevermind... I think we're just going to redeclare all the queues in
production anyway since the apps using them will be stopped for a
brief outage.Seems to be the easiest route :)

Thanks,
James

On Wed, Oct 19, 2011 at 2:09 PM, James Carr <james.r.carr at gmail.com> wrote:
> Thanks for the quick reply.
>
> All of the queues on the master node are durable.
>
> However I noticed when creating new queues from the management console
> I'm given the option to mirror the queue across all nodes or not. I'm
> assuming that the defult for existing queues from 2.5.0 is to not
> mirror them. Is there anyway to change this besides deleting and
> re-declaring the queue?
>
> Thanks,
> James
>
>
> On Wed, Oct 19, 2011 at 2:00 PM, Jerry Kuch <jerryk at vmware.com> wrote:
>> Hi, James:
>>
>> Are your queues declared durable?
>>
>> See the section "Starting and stopping nodes" for a
>> discussion of the behavior you should expect:
>>
>> http://www.rabbitmq.com/ha.html
>>
>> Jerry
>>
>> ----- Original Message -----
>> From: "James Carr" <james.r.carr at gmail.com>
>> To: "Jerry Kuch" <jerryk at vmware.com>
>> Cc: "rabbitmq-discuss" <rabbitmq-discuss at lists.rabbitmq.com>
>> Sent: Wednesday, October 19, 2011 11:57:16 AM
>> Subject: Re: [rabbitmq-discuss] Upgrading...
>>
>> So I upgraded to 2.6.1 and clustered it by adding another node to it.
>> I was experimenting with 2.6.1 because we're looking to have
>> replicated queues in our cluster since it's one thing that currently
>> kills us. :)
>>
>> I noticed that when I go to node2 and view the queues, I see the
>> queues that were created on node1. However, if I bring node1 down the
>> queues just go away.
>>
>> Is there something special I need to setup for replicated queues?
>>
>> Thanks,
>> James
>>
>> On Wed, Oct 19, 2011 at 1:39 PM, Jerry Kuch <jerryk at vmware.com> wrote:
>>> Hi, James...
>>>
>>> Ah, good to hear that you didn't lose any data!
>>>
>>> Best regards,
>>> Jerry
>>>
>>> ----- Original Message -----
>>> From: "James Carr" <james.r.carr at gmail.com>
>>> To: "Jerry Kuch" <jerryk at vmware.com>
>>> Cc: "rabbitmq-discuss" <rabbitmq-discuss at lists.rabbitmq.com>
>>> Sent: Wednesday, October 19, 2011 11:38:01 AM
>>> Subject: Re: [rabbitmq-discuss] Upgrading...
>>>
>>> I'm stupid... as part of upgrading our test environment we added a new
>>> node to the test cluster. I was viewing that node's management panel
>>> and hadn't joined it yet. :)
>>>
>>>
>>> On Wed, Oct 19, 2011 at 1:24 PM, Jerry Kuch <jerryk at vmware.com> wrote:
>>>> Rabbit's generally pretty smart (at least with upgrades between modern
>>>> versions) about migrating over and updating Mnesia contents and the
>>>> like. ?What probably happened with the RPM upgrade is that the RPM
>>>> install process blew away the directories where that stuff lives.
>>>>
>>>> I think one could make note of where all that stuff is, move it aside
>>>> for safekeeping before doing the RPM upgrade/install, and then move it
>>>> back, and allow the broker to up-version the stuff at its next start up.
>>>> Rabbit's logic for doing the right thing is fairly sophisticated and I'd
>>>> think it should work in that scenario, although I've not tried it
>>>> myself.
>>>>
>>>> Somebody else on the Rabbit team with more day to day experience on that
>>>> stuff is likely able to comment more authoritatively, or at least refute
>>>> what I just said if it's obviously wrongheaded...?
>>>>
>>>> Best regards,
>>>> Jerry
>>>>
>>>> ----- Original Message -----
>>>> From: "James Carr" <james.r.carr at gmail.com>
>>>> To: "rabbitmq-discuss" <rabbitmq-discuss at lists.rabbitmq.com>
>>>> Sent: Wednesday, October 19, 2011 11:02:03 AM
>>>> Subject: [rabbitmq-discuss] Upgrading...
>>>>
>>>> Is there a nice simple way to upgrade rabbitMQ and have all of the
>>>> queues. exchanges, and users ported over?
>>>>
>>>> I just upgraded on our test servers using the noarch RPM on Oracle
>>>> Enterprise Linux and noticed that all of the users, queues, and
>>>> exchanges ?are now gone.
>>>>
>>>> Thanks,
>>>> James
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>
>>>
>>
>

From dagda1 at scotalt.net  Wed Oct 19 21:23:53 2011
From: dagda1 at scotalt.net (Paul Cowan)
Date: Wed, 19 Oct 2011 21:23:53 +0100
Subject: [rabbitmq-discuss] WebSockets and Rabbit-mq
Message-ID: <CAEBV8YRi8o88juekkoYujBxwHsO18UxUXq0=dxUA0hO0K=1J4w@mail.gmail.com>

Hi,

I am struggling to work out how I can communicate between rabbitmq and
em-websocet.

My are requirements for the piece of work are this.

   1. I want a user to be able to kick off from a web page a long running
   process that could take at least 20 minutes to finish.
   2. I want the process to complete even if the user closes down the
   browser.
   3. While the user still has the browser open, I want the user to be able
   to get real time updates of the long running process displayed in the
   browser.

   My thoughts are that the client script on the page will create a
   websocket connection that will kick off an EventMachine-Websocket instance
   on the server (I am using Ruby on Rails).
   The websocket instance will subscribe to an AMQP queue that will complete
   the long running process even if the browser is closed down.

   I am struggling with how the em-websocket instance will receive updates
   of the work that is being done which is effectively inserts into a database.

   Do I need 2 queues?  One to start the process and one to receive updates
   or is there a better way?

   Can anybody shed any advice on this situation?  Has anybody done anything
   similar?


Cheers

Paul Cowan

Cutting-Edge Solutions (Scotland)

http://thesoftwaresimpleton.com/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111019/b860249c/attachment.htm>

From jasonjwwilliams at gmail.com  Wed Oct 19 21:50:19 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Wed, 19 Oct 2011 14:50:19 -0600
Subject: [rabbitmq-discuss] WebSockets and Rabbit-mq
In-Reply-To: <CAEBV8YRi8o88juekkoYujBxwHsO18UxUXq0=dxUA0hO0K=1J4w@mail.gmail.com>
References: <CAEBV8YRi8o88juekkoYujBxwHsO18UxUXq0=dxUA0hO0K=1J4w@mail.gmail.com>
Message-ID: <CAHZAEpdSajescg9Mh1RZoW-xQTH3fq1cG4SpiDLcTuo4XtLUiw@mail.gmail.com>

Hi Paul,

You'll need to create (and subscribe to) an anonymous queue to receive
replies. Then take the random name assigned by Rabbit to that queue
and stick it into the "replyto" header field of the messages your app
is publishing. When your backend processes the message it should use
the value of the "replyto" on the received message as the routing key
for the reply (published into the empty '' exchange). Publishing with
an empty exchange name will cause Rabbit to directly route the reply
message to the queue with the same name as the routing key.

-J

On Wed, Oct 19, 2011 at 2:23 PM, Paul Cowan <dagda1 at scotalt.net> wrote:
> Hi,
>
> I?am struggling to work out how I can communicate between rabbitmq and
> em-websocet.
>
> My are requirements for the piece of work are this.
>
> I want a user to be able to kick off?from a web page?a long running process
> that could take at least 20 minutes to finish.
> I want the process to complete even if the user closes down the browser.
> While the user still has the browser open, I want the user to be able to get
> real time updates of the long running process displayed in the browser.
>
> My thoughts are that the client script on the page will create a websocket
> connection that will kick off an EventMachine-Websocket instance on the
> server (I am using Ruby on Rails).
> The websocket instance will subscribe to an AMQP queue that will complete
> the long running process even if the browser is closed down.
>
> I am struggling with how the em-websocket instance will receive updates of
> the work that is being done which is effectively inserts into a database.
>
> Do I need 2 queues? ?One to start the process and one to receive updates or
> is there a better way?
>
> Can anybody shed any advice on this situation? ?Has anybody done anything
> similar?
>
> Cheers
>
> Paul Cowan
>
> Cutting-Edge Solutions (Scotland)
>
> http://thesoftwaresimpleton.com/
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From jasonjwwilliams at gmail.com  Wed Oct 19 21:59:24 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Wed, 19 Oct 2011 14:59:24 -0600
Subject: [rabbitmq-discuss] WebSockets and Rabbit-mq
In-Reply-To: <CAEBV8YRi8o88juekkoYujBxwHsO18UxUXq0=dxUA0hO0K=1J4w@mail.gmail.com>
References: <CAEBV8YRi8o88juekkoYujBxwHsO18UxUXq0=dxUA0hO0K=1J4w@mail.gmail.com>
Message-ID: <CAHZAEpdv=KdPWOX9cm1Lkf40f6p5MFYvB+R2-V2PxqjkPG-k0g@mail.gmail.com>

Hi Paul,

Meant to paste these links in. The Rabbit guys have a good tutorial on
RPC here: http://www.rabbitmq.com/tutorials/tutorial-six-python.html

Also, if you're interested Alvaro and my book have a big section on
replies and RPC: http://manning.com/videla.

-J

On Wed, Oct 19, 2011 at 2:23 PM, Paul Cowan <dagda1 at scotalt.net> wrote:
> Hi,
>
> I?am struggling to work out how I can communicate between rabbitmq and
> em-websocet.
>
> My are requirements for the piece of work are this.
>
> I want a user to be able to kick off?from a web page?a long running process
> that could take at least 20 minutes to finish.
> I want the process to complete even if the user closes down the browser.
> While the user still has the browser open, I want the user to be able to get
> real time updates of the long running process displayed in the browser.
>
> My thoughts are that the client script on the page will create a websocket
> connection that will kick off an EventMachine-Websocket instance on the
> server (I am using Ruby on Rails).
> The websocket instance will subscribe to an AMQP queue that will complete
> the long running process even if the browser is closed down.
>
> I am struggling with how the em-websocket instance will receive updates of
> the work that is being done which is effectively inserts into a database.
>
> Do I need 2 queues? ?One to start the process and one to receive updates or
> is there a better way?
>
> Can anybody shed any advice on this situation? ?Has anybody done anything
> similar?
>
> Cheers
>
> Paul Cowan
>
> Cutting-Edge Solutions (Scotland)
>
> http://thesoftwaresimpleton.com/
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From toby.corkindale at strategicdata.com.au  Thu Oct 20 01:10:19 2011
From: toby.corkindale at strategicdata.com.au (Toby Corkindale)
Date: Thu, 20 Oct 2011 11:10:19 +1100
Subject: [rabbitmq-discuss] STOMP & expiration
In-Reply-To: <4E521D9E.7000503@rabbitmq.com>
References: <20110822110436.7786.abe10f7e5afbbb3a79ce619739541149@cern.ch>
	<4E521D9E.7000503@rabbitmq.com>
Message-ID: <4E9F66EB.3000008@strategicdata.com.au>

On 22/08/11 19:13, Matthias Radestock wrote:
> Lionel,
>
> On 22/08/11 10:07, Lionel Cons wrote:
>> It seems that RabbitMQ does not handle the "expires" STOMP header.
>>
>> Although this is not in the STOMP spec, it's commonly used in
>> JMS-compliant brokers to handle expiration.
>>
>> Is there any plan to support message expiration via STOMP?
>
> Is that header set on a per-message basis? If so then Rabbit won't
> support that any time soon.
>
> With AMQP we support a per-queue setting that controls message expiry.
> See http://www.rabbitmq.com/extensions.html#queue-ttl.



I'm using the STOMP plugin for RabbitMQ, which is auto-vivifying the 
queues for me; is there an easy way to tell it to also pass the 
x-message-ttl header along?

(I'm happy to use the per-queue setting since the per-message stuff 
isn't implemented)

Cheers,
Toby

From lefthandmagic at gmail.com  Thu Oct 20 01:55:34 2011
From: lefthandmagic at gmail.com (Praveen M)
Date: Wed, 19 Oct 2011 17:55:34 -0700
Subject: [rabbitmq-discuss] channel.txCommit() gets hung/blocks
Message-ID: <CAEqX17MrBRS-SPSZCNeQhwV+zxewVgu4LfpvL+J7G7vTrOsxYg@mail.gmail.com>

Hi,
   I'm faced a weird case,

I started using transacted channels. I had set my channels with
channel.txSelect();

In the consumer that I defined (please see code below) , whenever my code
reaches the point where this.getChannel().txCommit() the thread just hangs
and doesn't move forward. I'm using a rabbit server and client (java) of
 2.6.1 version.

Any help will be great.

Thank you,
Praveen



import java.io.IOException;

import com.rabbitmq.client.*;

public class SmartQConsumer extends DefaultConsumer {

    RabbitMqHandler rabbitHandler;

    public SmartQConsumer(Channel channel, RabbitMqHandler rabbitHandler) {
        super(channel);
        this.rabbitHandler = rabbitHandler;
    }

    @Override
    public void handleDelivery(String consumerTag, Envelope envelope,
AMQP.BasicProperties properties, byte[] body) {
       try {
        rabbitHandler.onMessage(1000, body);
        this.getChannel().basicAck(envelope.getDeliveryTag(), false);
        this.getChannel().txCommit(); *//hangs/blocks here*
    } catch (Exception x) {
        try {
            this.getChannel().txRollback();
        } catch (IOException x1) {
            x1.printStackTrace();
        }

        x.printStackTrace();
    }
    }

}

-- 
-Praveen
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111019/58e45555/attachment.htm>

From toby.corkindale at strategicdata.com.au  Thu Oct 20 02:08:51 2011
From: toby.corkindale at strategicdata.com.au (Toby Corkindale)
Date: Thu, 20 Oct 2011 12:08:51 +1100
Subject: [rabbitmq-discuss] Creating mirrored queues via STOMP
Message-ID: <4E9F74A3.3000507@strategicdata.com.au>

Hi,
The RabbitMQ STOMP plugin auto-creates queues.

Is there a way to set the x-ha-policy setting on them, so that they can 
be created as mirrored queues?

Thansk,
Toby

From lefthandmagic at gmail.com  Thu Oct 20 02:24:54 2011
From: lefthandmagic at gmail.com (Praveen M)
Date: Wed, 19 Oct 2011 18:24:54 -0700
Subject: [rabbitmq-discuss] retry count and retry delay?
Message-ID: <CAEqX17N+kyrZFnZ64UK_gUmcBry0QLbM8B4QZZJ-uZvX2Wkwaw@mail.gmail.com>

Hi,

   Sorry for the repeated question. I know that this question has come up
earlier, and i'm wondering whats the current update on this.

   I'm trying to find out if there is a mechanism in rabbit to set the
maximum number of times that a retry should happen,

and also the time delay that should be introduced between retries?. From
what I understand right now, if there is a consumer error the retries
happen indefinite number of times..and also the retries happen immediately.
There is no time delay before which a retry is kicked off.




Thanks,
Praveen
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111019/e44bf96d/attachment.htm>

From dusura at gmail.com  Thu Oct 20 07:52:48 2011
From: dusura at gmail.com (dusura)
Date: Wed, 19 Oct 2011 23:52:48 -0700 (PDT)
Subject: [rabbitmq-discuss] How to tell Java Client running in a separate
	thread to stop consuming
Message-ID: <109bc404-24f5-423b-a3c5-2af3ab5bf713@13g2000prp.googlegroups.com>

Hi,

I would like to tell a Java Client to stop consuming. The client is
running in a separate thread. How can I do this?

I tried interrupting the thread but the RabbitMQ impl swallows
InterruptedException.

Any suggestions would be appreciated.

Cheers.

My thread looks like this:

"Thread-1" prio=6 tid=0x03766400 nid=0x738 in Object.wait()
[0x03f0f000]
   java.lang.Thread.State: WAITING (on object monitor)
	at java.lang.Object.wait(Native Method)
	at java.lang.Object.wait(Object.java:485)
	at com.rabbitmq.utility.BlockingCell.get(BlockingCell.java:50)
	- locked <0x22ce4fd8> (a
com.rabbitmq.utility.BlockingValueOrException)
	at
com.rabbitmq.utility.BlockingCell.uninterruptibleGet(BlockingCell.java:
89)
	- locked <0x22ce4fd8> (a
com.rabbitmq.utility.BlockingValueOrException)
	at
com.rabbitmq.utility.BlockingValueOrException.uninterruptibleGetValue(BlockingValueOrException.java:
33)
	at com.rabbitmq.client.impl.AMQChannel
$BlockingRpcContinuation.getReply(AMQChannel.java:337)
	at com.rabbitmq.client.impl.AMQChannel.privateRpc(AMQChannel.java:
210)
	at com.rabbitmq.client.impl.AMQChannel.exnWrappingRpc(AMQChannel.java:
128)
	at com.rabbitmq.client.impl.ChannelN.basicGet(ChannelN.java:808)
	at sun.reflect.GeneratedMethodAccessor8.invoke(Unknown Source)
	at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:
25)
	at java.lang.reflect.Method.invoke(Method.java:597)
..............


From matthew at rabbitmq.com  Thu Oct 20 08:43:19 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 20 Oct 2011 08:43:19 +0100
Subject: [rabbitmq-discuss] channel.txCommit() gets hung/blocks
In-Reply-To: <CAEqX17MrBRS-SPSZCNeQhwV+zxewVgu4LfpvL+J7G7vTrOsxYg@mail.gmail.com>
References: <CAEqX17MrBRS-SPSZCNeQhwV+zxewVgu4LfpvL+J7G7vTrOsxYg@mail.gmail.com>
Message-ID: <20111020074318.GA6964@wellquite.org>

On Wed, Oct 19, 2011 at 05:55:34PM -0700, Praveen M wrote:
> I started using transacted channels. I had set my channels with
> channel.txSelect();
> 
> In the consumer that I defined (please see code below) , whenever my code
> reaches the point where this.getChannel().txCommit() the thread just hangs
> and doesn't move forward. I'm using a rabbit server and client (java) of
>  2.6.1 version.

You can't do any blocking call from the delivery callback - you're
already in the connection thread and it's not re-entrant so you can't
make a call from there. Please use something like the QueuingConsumer
which safely gets deliveries into a different thread, from where you can
safely make calls on the channel.

Matthew

From simon at rabbitmq.com  Thu Oct 20 09:25:33 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 20 Oct 2011 09:25:33 +0100
Subject: [rabbitmq-discuss] Shovel Plugin For HA
In-Reply-To: <CAJreXKCB2-bRJEO1Equ1rTmrYWe+GcvKNuuse4yTGcBYOE4+UA@mail.gmail.com>
References: <CAJreXKDwNDT-LfMKhZJVikmTsjgY9d19gSsq3T8K-f_-TgjZ+g@mail.gmail.com>
	<4E96EE97.7090503@rabbitmq.com>
	<CAJreXKCB2-bRJEO1Equ1rTmrYWe+GcvKNuuse4yTGcBYOE4+UA@mail.gmail.com>
Message-ID: <4E9FDAFD.20102@rabbitmq.com>

On 19/10/2011 8:53PM, James Carr wrote:
> Reading the documentation, I noticed this statement:
>
> "There are of course limitations, since this is a preview release. The
> worst is that federation is not compatible with clustering. You
> shouldn?t use the federation plugin in a cluster. This is the first
> thing we?re going to fix."

Hmm. That's actually part of the blog post about the 2.5.0 preview 
release. This is already fixed in 2.6.x. I wonder how I could make that 
clearer.

(But for the record it was the downstream that couldn't be a cluster.)

Cheers, Simon

From simon at rabbitmq.com  Thu Oct 20 09:52:20 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 20 Oct 2011 09:52:20 +0100
Subject: [rabbitmq-discuss] retry count and retry delay?
In-Reply-To: <CAEqX17N+kyrZFnZ64UK_gUmcBry0QLbM8B4QZZJ-uZvX2Wkwaw@mail.gmail.com>
References: <CAEqX17N+kyrZFnZ64UK_gUmcBry0QLbM8B4QZZJ-uZvX2Wkwaw@mail.gmail.com>
Message-ID: <4E9FE144.3040009@rabbitmq.com>

On 20/10/2011 2:24AM, Praveen M wrote:
>     I'm trying to find out if there is a mechanism in rabbit to set the
> maximum number of times that a retry should happen,

At the moment, no. We just keep trying to deliver the message, without 
delay.

Cheers, Simon

From michael.justin at gmx.net  Thu Oct 20 11:26:19 2011
From: michael.justin at gmx.net (Michael Justin)
Date: Thu, 20 Oct 2011 12:26:19 +0200
Subject: [rabbitmq-discuss] ANN: Habari RabbitMQ Client 1.1 - message broker
	client for Delphi
Message-ID: <j7ot0e$1ub$1@dough.gmane.org>

October 18, 2011 - Habarisoft announces release 1.1 of Habari RabbitMQ 
Client, a library for Delphi and Free Pascal which provides easy access 
to RabbitMQ, the open source enterprise messaging system based on the 
AMQP standard.
With this library, developers can build integrated solutions, using the 
peer-to-peer or the publish and subscribe communication model. Habari 
RabbitMQ Client uses the RabbitMQ STOMP plugin and supports RabbitMQ 
versions 2.6.1 and higher, Delphi 2009 to XE2, and Free Pascal. (Limited 
support for older Delphi versions is available)

This release introduces support for durable subscriptions. Durable 
subscriptions can receive messages sent while the subscribers are not 
active. Durable subscriptions provide the flexibility and reliability of 
queues but still allow clients to send messages to many recipients.

Habari Client Libraries: http://www.habarisoft.com/habari.html


The library already has received very good feedback from the Delphi 
community. I would like to take the opportunity and thank the RabbitMQ 
team for creating a very attractive messaging solution, which can be 
used reliably in cross-platform/cross language integration projects over 
the RabbitMQ STOMP plug-in.


Regards
-- 
Michael Justin
habarisoft - Enterprise Messaging Software for Delphi?
http://www.habarisoft.com/


From zedhm at yahoo.co.uk  Thu Oct 20 11:55:22 2011
From: zedhm at yahoo.co.uk (E Hope-Morley)
Date: Thu, 20 Oct 2011 11:55:22 +0100 (BST)
Subject: [rabbitmq-discuss] Pika IOLoop issue
Message-ID: <1319108122.39394.YahooMailNeo@web26505.mail.ukl.yahoo.com>

Hi,

??? I am using Pika on Ubuntu 11.04. When I call SelectConnection.ioloop.stop() following a connection drop on my connection, it sometimes fails to actually stop the ioloop i.e. following the call to stop(), a callback may sometimes be called in response to a pending event. Any ideas?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111020/a53e4719/attachment.htm>

From majek04 at gmail.com  Thu Oct 20 12:00:52 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Thu, 20 Oct 2011 12:00:52 +0100
Subject: [rabbitmq-discuss] WebSockets and Rabbit-mq
In-Reply-To: <CAEBV8YRi8o88juekkoYujBxwHsO18UxUXq0=dxUA0hO0K=1J4w@mail.gmail.com>
References: <CAEBV8YRi8o88juekkoYujBxwHsO18UxUXq0=dxUA0hO0K=1J4w@mail.gmail.com>
Message-ID: <CABzX+qzXEmvESSjWE+1yLCMCgHYqmGs6mcXz2MJV2jGfrm0u5Q@mail.gmail.com>

On Wed, Oct 19, 2011 at 21:23, Paul Cowan <dagda1 at scotalt.net> wrote:
> I?am struggling to work out how I can communicate between rabbitmq and
> em-websocet.
>
> My are requirements for the piece of work are this.
>
> I want a user to be able to kick off?from a web page?a long running process
> that could take at least 20 minutes to finish.
> I want the process to complete even if the user closes down the browser.
> While the user still has the browser open, I want the user to be able to get
> real time updates of the long running process displayed in the browser.
>
> My thoughts are that the client script on the page will create a websocket
> connection that will kick off an EventMachine-Websocket instance on the
> server (I am using Ruby on Rails).
> The websocket instance will subscribe to an AMQP queue that will complete
> the long running process even if the browser is closed down.
>
> I am struggling with how the em-websocket instance will receive updates of
> the work that is being done which is effectively inserts into a database.
>
> Do I need 2 queues? ?One to start the process and one to receive updates or
> is there a better way?

Yes. You need one queue on which the consumer (that does the job)
will listen. And another, possibly anonymous, queue that will be created
for every user/browser. (and quickly destroyed when the user goes away).

> Can anybody shed any advice on this situation? ?Has anybody done anything
> similar?

It is quite a simple scenario, I'm sure many people did something like that,
for example:
http://jamesburkhart.com/building-a-nodejs-events-app-using-rabbitmq-w

Also, this may be of interest: http://sockjs.org

Cheers,
   Marek

From simon at rabbitmq.com  Thu Oct 20 10:12:30 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 20 Oct 2011 10:12:30 +0100
Subject: [rabbitmq-discuss] Architecture for Handling Orders
In-Reply-To: <CAKAE9iTJ2TSkk6fRqaz6bezYLKe5sA68KahZPedwKNqgkjGHEQ@mail.gmail.com>
References: <CAKAE9iTJ2TSkk6fRqaz6bezYLKe5sA68KahZPedwKNqgkjGHEQ@mail.gmail.com>
Message-ID: <4E9FE5FE.4010105@rabbitmq.com>

On 19/10/2011 5:37AM, Phillip Smith wrote:
> Do those with more experience than me agree that a Topic Exchange is
> the "correct" way to do this?  Is there anything I'm missing or is it
> really this easy? ;)

 From what I can see you don't even need a topic exchange, it looks like 
all the messages will go to all the queues anyway, so you could use a 
fanout exchange. But a topic exchange would allow for more flexibility 
in the future.

Cheers, Simon

From gmr at myyearbook.com  Thu Oct 20 14:29:26 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Thu, 20 Oct 2011 15:29:26 +0200
Subject: [rabbitmq-discuss] Pika IOLoop issue
In-Reply-To: <1319108122.39394.YahooMailNeo@web26505.mail.ukl.yahoo.com>
References: <1319108122.39394.YahooMailNeo@web26505.mail.ukl.yahoo.com>
Message-ID: <AE85BD8C56FB4699A40A032C6403BD9C@myyearbook.com>

 That is peculiar. What is the duration of time between the stop and pending event? Is an exception being thrown? Do you have a traceback?

Gavin


On Thursday, October 20, 2011 at 12:55 PM, E Hope-Morley wrote: 
> Hi,
>     I am using Pika on Ubuntu 11.04. When I call SelectConnection.ioloop.stop() following a connection drop on my connection, it sometimes fails to actually stop the ioloop i.e. following the call to stop(), a callback may sometimes be called in response to a pending event. Any ideas?
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111020/c5aaf387/attachment.htm>

From steve at rabbitmq.com  Thu Oct 20 15:09:39 2011
From: steve at rabbitmq.com (Steve Powell)
Date: Thu, 20 Oct 2011 15:09:39 +0100
Subject: [rabbitmq-discuss] How to tell Java Client running in a
	separate thread to stop consuming
In-Reply-To: <109bc404-24f5-423b-a3c5-2af3ab5bf713@13g2000prp.googlegroups.com>
References: <109bc404-24f5-423b-a3c5-2af3ab5bf713@13g2000prp.googlegroups.com>
Message-ID: <60778BB2-58CE-456E-9713-850F3D59C31B@rabbitmq.com>

I cannot tell from where you wish to stop the client.
I will assume you mean from another Java thread.

To start consuming, you issued basicConsume(...) and either 
supplied a tag (java.lang.String) to or had one returned
from this call.  The tag identifies the consumer.  To stop 
consuming you issue basicCancel(tag) on the same channel.  
This stops just this one Consumer. It can be issued from 
another thread.

The Consumer will be called once before it stops: 
handleCancelOk() is the last callback it receives.

But you asked about stopping a >client< from consuming; in
general there is no general and reliable Java way of stopping 
a thread, and a client may in any case have several threads 
running. To stop a whole client from consuming would require
application specific code.

Of course closing the channel will stop all the consumers
but I guess you want something less draconian.

I hope this helps you. If not, please supply more details 
of your application and requirement.

Steve Powell  (a happy bunny)
----------some definitions from the SPD----------
Rigatoni n. A prime-ministerial grin.
Nigella n. The next bottle-size up from a Nebuchadnezzar.
Homily adv. Rather like a frenchman.

On 20 Oct 2011, at 07:52, dusura wrote:

> Hi,
> 
> I would like to tell a Java Client to stop consuming. The client is
> running in a separate thread. How can I do this?
> 
> I tried interrupting the thread but the RabbitMQ impl swallows
> InterruptedException.
> 
> Any suggestions would be appreciated.
> 
> Cheers.
> 
> My thread looks like this:
> 
> "Thread-1" prio=6 tid=0x03766400 nid=0x738 in Object.wait()
> [0x03f0f000]
>   java.lang.Thread.State: WAITING (on object monitor)
> 	at java.lang.Object.wait(Native Method)
> 	at java.lang.Object.wait(Object.java:485)
> 	at com.rabbitmq.utility.BlockingCell.get(BlockingCell.java:50)
> 	- locked <0x22ce4fd8> (a
> com.rabbitmq.utility.BlockingValueOrException)
> 	at
> com.rabbitmq.utility.BlockingCell.uninterruptibleGet(BlockingCell.java:
> 89)
> 	- locked <0x22ce4fd8> (a
> com.rabbitmq.utility.BlockingValueOrException)
> 	at
> com.rabbitmq.utility.BlockingValueOrException.uninterruptibleGetValue(BlockingValueOrException.java:
> 33)
> 	at com.rabbitmq.client.impl.AMQChannel
> $BlockingRpcContinuation.getReply(AMQChannel.java:337)
> 	at com.rabbitmq.client.impl.AMQChannel.privateRpc(AMQChannel.java:
> 210)
> 	at com.rabbitmq.client.impl.AMQChannel.exnWrappingRpc(AMQChannel.java:
> 128)
> 	at com.rabbitmq.client.impl.ChannelN.basicGet(ChannelN.java:808)
> 	at sun.reflect.GeneratedMethodAccessor8.invoke(Unknown Source)
> 	at
> sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:
> 25)
> 	at java.lang.reflect.Method.invoke(Method.java:597)
> ..............
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111020/888702cd/attachment.htm>

From james.r.carr at gmail.com  Thu Oct 20 15:24:05 2011
From: james.r.carr at gmail.com (James Carr)
Date: Thu, 20 Oct 2011 09:24:05 -0500
Subject: [rabbitmq-discuss] Shovel Plugin For HA
In-Reply-To: <4E9FDAFD.20102@rabbitmq.com>
References: <CAJreXKDwNDT-LfMKhZJVikmTsjgY9d19gSsq3T8K-f_-TgjZ+g@mail.gmail.com>
	<4E96EE97.7090503@rabbitmq.com>
	<CAJreXKCB2-bRJEO1Equ1rTmrYWe+GcvKNuuse4yTGcBYOE4+UA@mail.gmail.com>
	<4E9FDAFD.20102@rabbitmq.com>
Message-ID: <CAJreXKCADdzsQdXt76MBuchHyBZ-tsJURAcfOEPe9JOyLvmUJg@mail.gmail.com>

Thanks, I tried it and it works advertised, but I feel like I may have
misunderstood it.

I've set it up and have messages published to a local exchange being
routed to an exchange on a central broker. however when the central
broker is down there's no local queuing of messages until it comes
back up.

Of course, maybe I am just designing my topology wrong. Maybe instead
of separate exchanges per application I should just have one exchange,
shoveled out to the remote exchange and then multiple queues bound to
that exchange. The exchange per app was going to make things
heavyweight with the shovel plugin since I'd have to restart local
brokers for each new exchange, but with a single exchange, single
local queue and multiple remote queues might make things more
effecient.

Maybe the federation plugin includes a backing queue that can be
switched on or am I  missing something?

Thanks,
James


On Thu, Oct 20, 2011 at 3:25 AM, Simon MacMullen <simon at rabbitmq.com> wrote:
> On 19/10/2011 8:53PM, James Carr wrote:
>>
>> Reading the documentation, I noticed this statement:
>>
>> "There are of course limitations, since this is a preview release. The
>> worst is that federation is not compatible with clustering. You
>> shouldn?t use the federation plugin in a cluster. This is the first
>> thing we?re going to fix."
>
> Hmm. That's actually part of the blog post about the 2.5.0 preview release.
> This is already fixed in 2.6.x. I wonder how I could make that clearer.
>
> (But for the record it was the downstream that couldn't be a cluster.)
>
> Cheers, Simon
>

From steve at rabbitmq.com  Thu Oct 20 15:53:13 2011
From: steve at rabbitmq.com (Steve Powell)
Date: Thu, 20 Oct 2011 15:53:13 +0100
Subject: [rabbitmq-discuss] Creating mirrored queues via STOMP
In-Reply-To: <4E9F74A3.3000507@strategicdata.com.au>
References: <4E9F74A3.3000507@strategicdata.com.au>
Message-ID: <EFE507B3-FA08-423B-8253-1227C08CFBFE@rabbitmq.com>

Hi Toby,

Unfortunately it is not possible to set ha policy or ttl
settings on a rabbit STOMP-created queue. [1] [2]

However, it is possible to send to and subscribe from
a queue created in AMQP using /amq/queue/<name>
destinations in STOMP.  These queues can have any of the
rabbit-supported properties.

We currently have an enhancement under discussion that
puts these headers on SUBSCRIBE or SEND, so that the 
STOMP adapter can create the right sort of queue; but
we are not sure what to do if the header values disagree
on two commands referring to the "same" queue.

The STOMP protocol design makes it hard to define queue
properties, as opposed to message properties, since
queue-creation is implicit and conditional.  It would be
a surprise if one application sets a queue property and 
another removes it or resets it (or fails if the property
is different).

A description of your application which requires this
would help us with future design.

Steve Powell  (a happy bunny)
----------some definitions from the SPD----------
Rigatoni n. A prime-ministerial grin.
Nigella n. The next bottle-size up from a Nebuchadnezzar.
Homily adv. Rather like a frenchman.

> [1] [rabbitmq-discuss] STOMP & expiration
> [2] [rabbitmq-discuss] Creating mirrored queues via STOMP

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111020/e26eaec3/attachment.htm>

From olivier.gehin at atos.net  Thu Oct 20 14:48:16 2011
From: olivier.gehin at atos.net (GEHIN Olivier)
Date: Thu, 20 Oct 2011 13:48:16 +0000
Subject: [rabbitmq-discuss] Access rights with rabbit_auth_backend_ldap
	plugin
Message-ID: <54B5C3987269804CAC12632B59DC9656837A7D@AOFRWMBXRSC002.resources.atosorigin.local>

Hello,

I have well configurate the rabbit_auth_backend_ldap plugin with my LDAP directory and the connexion works.

Now, I would limit access for a user to write access for a specific exchange and read access for a specific queue.
With internal database, we could use regular expression to define access rights for a user.
Can we define similar access rights with this plugin?

Best regards,
Olivier
________________________________

Ce message et les pi?ces jointes sont confidentiels et r?serv?s ? l'usage exclusif de ses destinataires. Il peut ?galement ?tre prot?g? par le secret professionnel. Si vous recevez ce message par erreur, merci d'en avertir imm?diatement l'exp?diteur et de le d?truire. L'int?grit? du message ne pouvant ?tre assur?e sur Internet, la responsabilit? du groupe Atos ne pourra ?tre engag?e quant au contenu de ce message. Bien que les meilleurs efforts soient faits pour maintenir cette transmission exempte de tout virus, l'exp?diteur ne donne aucune garantie ? cet ?gard et sa responsabilit? ne saurait ?tre engag?e pour tout dommage r?sultant d'un virus transmis.

This e-mail and the documents attached are confidential and intended solely for the addressee; it may also be privileged. If you receive this e-mail in error, please notify the sender immediately and destroy it. As its integrity cannot be secured on the Internet, the Atos group liability cannot be triggered for the message content. Although the sender endeavors to maintain a computer virus-free network, the sender does not warrant that this transmission is virus-free and will not be liable for any damages resulting from any virus transmitted.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111020/e77d76db/attachment.htm>

From smetj.net at gmail.com  Thu Oct 20 16:51:10 2011
From: smetj.net at gmail.com (Jelle Smet)
Date: Thu, 20 Oct 2011 08:51:10 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ Shovel Connections
In-Reply-To: <20110926115420.GC31944@rabbitmq.com>
References: <4E7929EC.1070906@omc-international.com.au>
	<4E7A7266.5050800@omc-international.com.au>
	<20110926115420.GC31944@rabbitmq.com>
Message-ID: <13456440.173.1319125870200.JavaMail.geo-discussion-forums@yqja14>

Hi,

I have a newly installed setup running RabbitMQ version 2.6.1 and the Shovel 
plugin downloaded from: 
http://www.rabbitmq.com/releases/plugins/v2.6.1/rabbitmq_shovel-2.6.1.ez.
I came across a few occasions which look similar to Mihir's situation.
On my side no messages are lost, but they just keep sitting unacknowledged 
in the source broker. Restarting the source broker RabbitMQ the solves the 
problem.
When the broker is in such a situation, I have found that restarting 
RabbitMQ with the init scripts is not possible.  I have to sigkill it and 
start it again after which everything works again.

Which output and information I can submit to further troubleshoot this?

Thanks,

Jelle


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111020/24eeacd1/attachment.htm>

From ricardo.brizido at gmail.com  Thu Oct 20 16:55:58 2011
From: ricardo.brizido at gmail.com (=?ISO-8859-1?Q?Ricardo_Br=EDzido?=)
Date: Thu, 20 Oct 2011 16:55:58 +0100
Subject: [rabbitmq-discuss] pika and node.amqp interop
Message-ID: <CAPB1POWjR6GzQgBP1FWHDtG4QPM8ECtbEVHJrX5Netu0Wa5kYA@mail.gmail.com>

For some reason I can't get this example to work:


[sender]
var sys = require('sys');
var amqp = require('./amqp');

var connection = amqp.createConnection({ host: 'localhost' });

// Wait for connection to become established.
connection.addListener('ready', function () {
    var x = connection.exchange()
    var q = connection.queue("aqueuename",
             { autoDelete: true, durable: false, exclusive: false });
    x.publish('aqueuename', {foo: "bar"});
});

[receiver]
#!/usr/bin/env python
import pika

connection = pika.AsyncoreConnection(pika.ConnectionParameters(
        host='localhost'))
channel = connection.channel()

q = channel.queue_declare(queue='aqueuename',
                         auto_delete=True,
                         durable=False,
                         exclusive=False)

print ' [*] Waiting for messages. To exit press CTRL+C'

def callback(ch, method, properties, body):
    print " [x] Received %r" % (body,)

channel.basic_consume(callback,
                      queue='aqueuename',
                      no_ack=True)

pika.asyncore_loop()


I wanted to used a BlockingConnection. Do you know if this works with
a BlockingConnection?


Thanks

Ricardo


-- 
Ricardo Br?zido
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111020/154fc577/attachment.htm>

From zedhm at yahoo.co.uk  Thu Oct 20 17:11:51 2011
From: zedhm at yahoo.co.uk (E Hope-Morley)
Date: Thu, 20 Oct 2011 17:11:51 +0100 (BST)
Subject: [rabbitmq-discuss] Pika IOLoop issue
In-Reply-To: <AE85BD8C56FB4699A40A032C6403BD9C@myyearbook.com>
References: <1319108122.39394.YahooMailNeo@web26505.mail.ukl.yahoo.com>
	<AE85BD8C56FB4699A40A032C6403BD9C@myyearbook.com>
Message-ID: <1319127111.42857.YahooMailNeo@web26508.mail.ukl.yahoo.com>

Hi Gavin, I do not have a trace and this is not an easy issue to trigger but I think I have understood what is going on. This issue happens, in my case, when the connection drops and Pika handles the error. This results in the on_connection_closed callback getting called which I have instructed to stop the connection.ioloop. I think the problem is that if you have a nested poll()s you end up with nested handlers so even if the poller (i.e. the while loop in poller.start())is stopped, when the call stack unwinds you can end up with calls to poll() getting executed as a result of a transport.rpc(). Does this make any sense?



________________________________
From: Gavin M. Roy <gmr at myyearbook.com>
To: E Hope-Morley <zedhm at yahoo.co.uk>
Cc: "rabbitmq-discuss at lists.rabbitmq.com" <rabbitmq-discuss at lists.rabbitmq.com>
Sent: Thursday, 20 October 2011, 14:29
Subject: Re: [rabbitmq-discuss] Pika IOLoop issue


That is peculiar. What is the duration of time between the stop and pending event? Is an exception being thrown? Do you have a traceback?

Gavin


On Thursday, October 20, 2011 at 12:55 PM, E Hope-Morley wrote:
Hi,
>
>??? I am using Pika on Ubuntu 11.04. When I call SelectConnection.ioloop.stop() following a connection drop on my connection, it sometimes fails to actually stop the ioloop i.e. following the call to stop(), a callback may sometimes be called in response to a pending event. Any ideas?
>
>_______________________________________________
>rabbitmq-discuss mailing list
>rabbitmq-discuss at lists.rabbitmq.com
>https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111020/befec880/attachment.htm>

From simon at rabbitmq.com  Thu Oct 20 17:20:22 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 20 Oct 2011 17:20:22 +0100
Subject: [rabbitmq-discuss] Access rights with rabbit_auth_backend_ldap
 plugin
In-Reply-To: <54B5C3987269804CAC12632B59DC9656837A7D@AOFRWMBXRSC002.resources.atosorigin.local>
References: <54B5C3987269804CAC12632B59DC9656837A7D@AOFRWMBXRSC002.resources.atosorigin.local>
Message-ID: <4EA04A46.9000600@rabbitmq.com>

Hi Olivier.

At the moment there's no support for regular expressions in the LDAP 
plugin. This might get added in the future though; I'm looking into how 
the existing queries could be enhanced.

At the moment the sort of thing you can do is to use an in_group query 
and have a groupOfNames per object you want to control access to - but 
there's no pattern matching.

If you could describe on or off list how your LDAP database is 
structured and what you're trying to do, that would be a help.

Cheers, Simon

On 20/10/11 14:48, GEHIN Olivier wrote:
> Hello,
>
> I have well configurate the rabbit_auth_backend_ldap plugin with my LDAP
> directory and the connexion works.
>
> Now, I would limit access for a user to write access for a specific
> exchange and read access for a specific queue.
>
> With internal database, we could use regular expression to define access
> rights for a user.
>
> Can we define similar access rights with this plugin?
>
> Best regards,
>
> Olivier
>
> ------------------------------------------------------------------------
>
> Ce message et les pi?ces jointes sont confidentiels et r?serv?s ?
> l'usage exclusif de ses destinataires. Il peut ?galement ?tre prot?g?
> par le secret professionnel. Si vous recevez ce message par erreur,
> merci d'en avertir imm?diatement l'exp?diteur et de le d?truire.
> L'int?grit? du message ne pouvant ?tre assur?e sur Internet, la
> responsabilit? du groupe Atos ne pourra ?tre engag?e quant au contenu de
> ce message. Bien que les meilleurs efforts soient faits pour maintenir
> cette transmission exempte de tout virus, l'exp?diteur ne donne aucune
> garantie ? cet ?gard et sa responsabilit? ne saurait ?tre engag?e pour
> tout dommage r?sultant d'un virus transmis.
>
> This e-mail and the documents attached are confidential and intended
> solely for the addressee; it may also be privileged. If you receive this
> e-mail in error, please notify the sender immediately and destroy it. As
> its integrity cannot be secured on the Internet, the Atos group
> liability cannot be triggered for the message content. Although the
> sender endeavors to maintain a computer virus-free network, the sender
> does not warrant that this transmission is virus-free and will not be
> liable for any damages resulting from any virus transmitted.
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From thadeurc at gmail.com  Thu Oct 20 17:22:07 2011
From: thadeurc at gmail.com (Thadeu Russo)
Date: Thu, 20 Oct 2011 09:22:07 -0700 (PDT)
Subject: [rabbitmq-discuss] getting authentication failure Exception?
In-Reply-To: <69c5e156-ea08-430c-8146-f0ce7b0fcc79@v15g2000vbm.googlegroups.com>
References: <32629116.post@talk.nabble.com> <4E93FA1B.50100@rabbitmq.com>
	<69c5e156-ea08-430c-8146-f0ce7b0fcc79@v15g2000vbm.googlegroups.com>
Message-ID: <9f5cbb49-ab84-4186-9773-bb5bf9f38207@f16g2000yqk.googlegroups.com>

Hi, I could make it work with a simple approach, but I think this is
something that requires some attention from the rabbitmq dev team.

My computers were connected using a wireless router that had no
connection to the internet. I assume it was giving me 'fake' ips. When
I plugged the internet cable everything was working fine. So here is
my question to rabbitmq dev team: Is rabbitmq not accepting 'fake' ip
addresses?

A simple test case is: have a computer without internet or any network
connection and force a static ip. Start rabbitmq and try to connect a
client running in the same node using the static ip and not localhost
or 127.0.0.1.

Regards,

On Oct 18, 10:05?pm, Thadeu Russo <thade... at gmail.com> wrote:
> Hello,
>
> I am facing the same problem. Here are some details about it:
>
> 1- Both computers have the firewall off (I am using Ubuntu 11 in both)
> 2- The log says 'accepting connection'; 'starting connection' and then
> a handshake error caused by a timeout. I assume the server is not
> receiving the response from the client for the handshake.
>
> It is really weird cause it was working pretty fine a couple weeks
> ago. Also, I am sure there is no network issue. If I start the
> rabbitmq server in a single node and try to connect with a simple java
> client using localhost it works fine. When I use the ip address of the
> node it bombs. Additionally, using network tools from remote nodes to
> scan the open ports in the rabbitmq node, I can 'see' the port 5672 as
> an open port. The same problem happens in Mac OS too.
>
> I did a big investigation over the internet where I found other people
> complaining about this problem but no solution. Any help is really
> appreciated.
>
> Thanks in advance,
>
> On Oct 11, 6:11?am, Matthias Radestock <matth... at rabbitmq.com> wrote:
>
>
>
>
>
>
>
> > On 11/10/11 09:00, sameekmishra wrote:
>
> > > I am using Rabbitmq server 2.5 is install on machine IP -192.168.1.64.when i
> > > try to get connected with machine i got the error:" java.io.IOException:
> > >Possiblycausedbyauthenticationfailure".used code to connect with server:
>
> > > ? ? ? ?ConnectionFactory factory = new ConnectionFactory();
> > > ? ? ? ?factory.setUsername("guest");
> > > ? ? ? ?factory.setPassword("guest");
> > > ? ? ? ?factory.setVirtualHost("/");
> > > ? ? ? ?factory.setHost("192.168.1.64");
> > > ? ? ? ?factory.setPort("5672");
> > > ? ? ? ?conn = factory.newConnection();
>
> > > please help me to get resolve above problem.
>
> > What does rabbit's log say?
>
> > Matthias.
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simon at rabbitmq.com  Thu Oct 20 17:26:23 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 20 Oct 2011 17:26:23 +0100
Subject: [rabbitmq-discuss] Shovel Plugin For HA
In-Reply-To: <CAJreXKCADdzsQdXt76MBuchHyBZ-tsJURAcfOEPe9JOyLvmUJg@mail.gmail.com>
References: <CAJreXKDwNDT-LfMKhZJVikmTsjgY9d19gSsq3T8K-f_-TgjZ+g@mail.gmail.com>	<4E96EE97.7090503@rabbitmq.com>	<CAJreXKCB2-bRJEO1Equ1rTmrYWe+GcvKNuuse4yTGcBYOE4+UA@mail.gmail.com>	<4E9FDAFD.20102@rabbitmq.com>
	<CAJreXKCADdzsQdXt76MBuchHyBZ-tsJURAcfOEPe9JOyLvmUJg@mail.gmail.com>
Message-ID: <4EA04BAF.3080209@rabbitmq.com>

On 20/10/11 15:24, James Carr wrote:
> Thanks, I tried it and it works advertised, but I feel like I may have
> misunderstood it.

Just to be clear, we are still talking about the federation exchange, right?

> I've set it up and have messages published to a local exchange being
> routed to an exchange on a central broker. however when the central
> broker is down there's no local queuing of messages until it comes
> back up.

That should really be happening. I am assuming your local exchange is 
the upstream and the central exchange is the downstream. When the 
downstream connects to the upstream it should create a queue (with a 
name beginning "federation: " on the upstream. Can you see this in mgmt 
/ rabbitmqctl? Of course, if you use the queue_expires parameter the 
upstream queue will expire eventually.

> Of course, maybe I am just designing my topology wrong. Maybe instead
> of separate exchanges per application I should just have one exchange,
> shoveled out to the remote exchange and then multiple queues bound to
> that exchange. The exchange per app was going to make things
> heavyweight with the shovel plugin since I'd have to restart local
> brokers for each new exchange, but with a single exchange, single
> local queue and multiple remote queues might make things more
> effecient.
>
> Maybe the federation plugin includes a backing queue that can be
> switched on or am I  missing something?

It is always on - even if the downstream does not disconnect then the 
upstream might publish messages faster than they can get sent across the 
link.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From adamrabung at gmail.com  Thu Oct 20 18:58:07 2011
From: adamrabung at gmail.com (Adam Rabung)
Date: Thu, 20 Oct 2011 13:58:07 -0400
Subject: [rabbitmq-discuss] How to tell Java Client running in a
 separate thread to stop consuming
In-Reply-To: <60778BB2-58CE-456E-9713-850F3D59C31B@rabbitmq.com>
References: <109bc404-24f5-423b-a3c5-2af3ab5bf713@13g2000prp.googlegroups.com>
	<60778BB2-58CE-456E-9713-850F3D59C31B@rabbitmq.com>
Message-ID: <CAAN_EDr5Kd4rjCJRQFWrLFng2E0Pa3OTh3o=93eLSpO1CS9Bug@mail.gmail.com>

Hi,
Along these same lines, is it considered thread-safe to call
channel.basicAck from a separate thread while the "host thread" for the
channel is blocked on QueueingConsumer#nextDeliver?  Better yet, when is it
not thread-safe to call basicAck from a separate thread?

Thanks,
Adam

On Thu, Oct 20, 2011 at 10:09 AM, Steve Powell <steve at rabbitmq.com> wrote:

> I cannot tell from where you wish to stop the client.
> I will assume you mean from another Java thread.
>
> To start consuming, you issued basicConsume(...) and either
> supplied a tag (java.lang.String) to or had one returned
> from this call.  The tag identifies the consumer.  To stop
> consuming you issue basicCancel(tag) on the same channel.
> This stops just this one Consumer. It can be issued from
> another thread.
>
> The Consumer will be called once before it stops:
> handleCancelOk() is the last callback it receives.
>
> But you asked about stopping a >client< from consuming; in
> general there is no general and reliable Java way of stopping
> a thread, and a client may in any case have several threads
> running. To stop a whole client from consuming would require
> application specific code.
>
> Of course closing the channel will stop all the consumers
> but I guess you want something less draconian.
>
> I hope this helps you. If not, please supply more details
> of your application and requirement.
>
> Steve Powell  (*a happy bunny*)
> *----------some definitions from the SPD----------*
> *Rigatoni* *n.* A prime-ministerial grin.
> *Nigella* *n.* The next bottle-size up from a Nebuchadnezzar.
> *Homily* *adv.* Rather like a frenchman.
>
> On 20 Oct 2011, at 07:52, dusura wrote:
>
> Hi,
>
> I would like to tell a Java Client to stop consuming. The client is
> running in a separate thread. How can I do this?
>
> I tried interrupting the thread but the RabbitMQ impl swallows
> InterruptedException.
>
> Any suggestions would be appreciated.
>
> Cheers.
>
> My thread looks like this:
>
> "Thread-1" prio=6 tid=0x03766400 nid=0x738 in Object.wait()
> [0x03f0f000]
>   java.lang.Thread.State: WAITING (on object monitor)
> at java.lang.Object.wait(Native Method)
> at java.lang.Object.wait(Object.java:485)
> at com.rabbitmq.utility.BlockingCell.get(BlockingCell.java:50)
> - locked <0x22ce4fd8> (a
> com.rabbitmq.utility.BlockingValueOrException)
> at
> com.rabbitmq.utility.BlockingCell.uninterruptibleGet(BlockingCell.java:
> 89)
> - locked <0x22ce4fd8> (a
> com.rabbitmq.utility.BlockingValueOrException)
> at
>
> com.rabbitmq.utility.BlockingValueOrException.uninterruptibleGetValue(BlockingValueOrException.java:
> 33)
> at com.rabbitmq.client.impl.AMQChannel
> $BlockingRpcContinuation.getReply(AMQChannel.java:337)
> at com.rabbitmq.client.impl.AMQChannel.privateRpc(AMQChannel.java:
> 210)
> at com.rabbitmq.client.impl.AMQChannel.exnWrappingRpc(AMQChannel.java:
> 128)
> at com.rabbitmq.client.impl.ChannelN.basicGet(ChannelN.java:808)
> at sun.reflect.GeneratedMethodAccessor8.invoke(Unknown Source)
> at
>
> sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:
> 25)
> at java.lang.reflect.Method.invoke(Method.java:597)
> ..............
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111020/136424cb/attachment.htm>

From zedhm at yahoo.co.uk  Thu Oct 20 19:32:55 2011
From: zedhm at yahoo.co.uk (E Hope-Morley)
Date: Thu, 20 Oct 2011 19:32:55 +0100 (BST)
Subject: [rabbitmq-discuss] Pika basic.recover brokern?
Message-ID: <1319135575.88637.YahooMailNeo@web26507.mail.ukl.yahoo.com>

Hi, when I do a basic.recover with no requeue arg i.e. requeue=False my channel closes with the following error:

code: 540
text: NOT_IMPLEMENTED - requeue=false

It works fine if I do requeue=True. Any ideas?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111020/c145e549/attachment.htm>

From james.r.carr at gmail.com  Thu Oct 20 19:37:42 2011
From: james.r.carr at gmail.com (James Carr)
Date: Thu, 20 Oct 2011 13:37:42 -0500
Subject: [rabbitmq-discuss] Shovel Plugin For HA
In-Reply-To: <4EA04BAF.3080209@rabbitmq.com>
References: <CAJreXKDwNDT-LfMKhZJVikmTsjgY9d19gSsq3T8K-f_-TgjZ+g@mail.gmail.com>
	<4E96EE97.7090503@rabbitmq.com>
	<CAJreXKCB2-bRJEO1Equ1rTmrYWe+GcvKNuuse4yTGcBYOE4+UA@mail.gmail.com>
	<4E9FDAFD.20102@rabbitmq.com>
	<CAJreXKCADdzsQdXt76MBuchHyBZ-tsJURAcfOEPe9JOyLvmUJg@mail.gmail.com>
	<4EA04BAF.3080209@rabbitmq.com>
Message-ID: <CAJreXKCkGO0Oy7wdnd0jzmGN1ERPB5J=Obg=X4wfY2UYGdHgaA@mail.gmail.com>

Maybe I misunderstand? :)

Given that I have a cluster of brokers used for a single geographical
location and each machine that publishes messages has a local broker
that pushes messages out to the central cluster:

The cluster is the upstream
The local brokers are the downstream


Or is it the other way around?


Thanks,
James

On Thu, Oct 20, 2011 at 11:26 AM, Simon MacMullen <simon at rabbitmq.com> wrote:
> On 20/10/11 15:24, James Carr wrote:
>>
>> Thanks, I tried it and it works advertised, but I feel like I may have
>> misunderstood it.
>
> Just to be clear, we are still talking about the federation exchange, right?
>
>> I've set it up and have messages published to a local exchange being
>> routed to an exchange on a central broker. however when the central
>> broker is down there's no local queuing of messages until it comes
>> back up.
>
> That should really be happening. I am assuming your local exchange is the
> upstream and the central exchange is the downstream. When the downstream
> connects to the upstream it should create a queue (with a name beginning
> "federation: " on the upstream. Can you see this in mgmt / rabbitmqctl? Of
> course, if you use the queue_expires parameter the upstream queue will
> expire eventually.
>
>> Of course, maybe I am just designing my topology wrong. Maybe instead
>> of separate exchanges per application I should just have one exchange,
>> shoveled out to the remote exchange and then multiple queues bound to
>> that exchange. The exchange per app was going to make things
>> heavyweight with the shovel plugin since I'd have to restart local
>> brokers for each new exchange, but with a single exchange, single
>> local queue and multiple remote queues might make things more
>> effecient.
>>
>> Maybe the federation plugin includes a backing queue that can be
>> switched on or am I ?missing something?
>
> It is always on - even if the downstream does not disconnect then the
> upstream might publish messages faster than they can get sent across the
> link.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>

From matthew at rabbitmq.com  Thu Oct 20 23:34:54 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 20 Oct 2011 23:34:54 +0100
Subject: [rabbitmq-discuss] Pika basic.recover brokern?
In-Reply-To: <1319135575.88637.YahooMailNeo@web26507.mail.ukl.yahoo.com>
References: <1319135575.88637.YahooMailNeo@web26507.mail.ukl.yahoo.com>
Message-ID: <20111020223453.GA25125@wellquite.org>

On Thu, Oct 20, 2011 at 07:32:55PM +0100, E Hope-Morley wrote:
> Hi, when I do a basic.recover with no requeue arg i.e. requeue=False my channel closes with the following error:
> 
> code: 540
> text: NOT_IMPLEMENTED - requeue=false
> 
> It works fine if I do requeue=True. Any ideas?

Rabbit does not implement recover with requeue=false. It's not a client
thing, it's the server.

Matthew

From dusura at gmail.com  Fri Oct 21 01:17:34 2011
From: dusura at gmail.com (dusura)
Date: Thu, 20 Oct 2011 17:17:34 -0700 (PDT)
Subject: [rabbitmq-discuss] How to tell Java Client running in a
	separate thread to stop consuming
In-Reply-To: <60778BB2-58CE-456E-9713-850F3D59C31B@rabbitmq.com>
References: <109bc404-24f5-423b-a3c5-2af3ab5bf713@13g2000prp.googlegroups.com>
	<60778BB2-58CE-456E-9713-850F3D59C31B@rabbitmq.com>
Message-ID: <4d4ea5e9-1dca-421c-9837-d692312b9113@p14g2000pra.googlegroups.com>

Hi Steve,

thanks for your reply. Yes, I am trying to cancel a consumer from
another thread.

I am using Spring AMQP. I guess this is an issue for the Spring guys
so I will raise it there. There doesn't seem to be any way to do this
with the current Spring APIs.


From dusura at gmail.com  Fri Oct 21 01:28:17 2011
From: dusura at gmail.com (dusura)
Date: Thu, 20 Oct 2011 17:28:17 -0700 (PDT)
Subject: [rabbitmq-discuss] How to tell Java Client running in a
	separate thread to stop consuming
In-Reply-To: <4d4ea5e9-1dca-421c-9837-d692312b9113@p14g2000pra.googlegroups.com>
References: <109bc404-24f5-423b-a3c5-2af3ab5bf713@13g2000prp.googlegroups.com>
	<60778BB2-58CE-456E-9713-850F3D59C31B@rabbitmq.com>
	<4d4ea5e9-1dca-421c-9837-d692312b9113@p14g2000pra.googlegroups.com>
Message-ID: <cfb1626e-1bb9-470f-ad3d-fefb9999d2d3@d33g2000prb.googlegroups.com>

Of course, if RabbitMQ didn't swallow InterruptedException that would
solve my problem.

On Oct 21, 11:17?am, dusura <dus... at gmail.com> wrote:
> Hi Steve,
>
> thanks for your reply. Yes, I am trying to cancel a consumer from
> another thread.
>
> I am using Spring AMQP. I guess this is an issue for the Spring guys
> so I will raise it there. There doesn't seem to be any way to do this
> with the current Spring APIs.
>
> From the Spring API I am using
> AmqpTemplate.receiveAndConvert(queueName) and there no way to cancel
> this.
>
> The closest I could get was some dodgy digging into the Spring
> AmqpAdmin implementation to grab the channel and make a bad call which
> stopped my consumption by throwing
> org.springframework.amqp.AmqpIOException.
>
> e.g.
>
> ? ? ? ? ((RabbitAdmin)amqpAdmin).getRabbitTemplate().execute(new
> ChannelCallback<Object>() {
> ? ? ? ? ? ? @Override
> ? ? ? ? ? ? public Object doInRabbit(Channel channel) throws Exception
> {
>
> channel.basicCancel("spring_probably_knows_this_but_i_dont");
> ? ? ? ? ? ? ? ? return null;
> ? ? ? ? ? ? }
> ? ? ? ? });
>
> Thanks,
> Dave
>
> On Oct 21, 1:09?am, Steve Powell <st... at rabbitmq.com> wrote:
>
>
>
>
>
>
>
> > I cannot tell from where you wish to stop the client.
> > I will assume you mean from another Java thread.
>
> > To start consuming, you issued basicConsume(...) and either
> > supplied a tag (java.lang.String) to or had one returned
> > from this call. ?The tag identifies the consumer. ?To stop
> > consuming you issue basicCancel(tag) on the same channel. ?
> > This stops just this one Consumer. It can be issued from
> > another thread.
>
> > The Consumer will be called once before it stops:
> > handleCancelOk() is the last callback it receives.
>
> > But you asked about stopping a >client< from consuming; in
> > general there is no general and reliable Java way of stopping
> > a thread, and a client may in any case have several threads
> > running. To stop a whole client from consuming would require
> > application specific code.
>
> > Of course closing the channel will stop all the consumers
> > but I guess you want something less draconian.
>
> > I hope this helps you. If not, please supply more details
> > of your application and requirement.
>
> > Steve Powell ?(a happy bunny)
> > ----------some definitions from the SPD----------
> > Rigatoni n. A prime-ministerial grin.
> > Nigella n. The next bottle-size up from a Nebuchadnezzar.
> > Homily adv. Rather like a frenchman.
>
> > On 20 Oct 2011, at 07:52, dusura wrote:
>
> > > Hi,
>
> > > I would like to tell a Java Client to stop consuming. The client is
> > > running in a separate thread. How can I do this?
>
> > > I tried interrupting the thread but the RabbitMQ impl swallows
> > > InterruptedException.
>
> > > Any suggestions would be appreciated.
>
> > > Cheers.
>
> > > My thread looks like this:
>
> > > "Thread-1" prio=6 tid=0x03766400 nid=0x738 in Object.wait()
> > > [0x03f0f000]
> > > ? java.lang.Thread.State: WAITING (on object monitor)
> > > ? ?at java.lang.Object.wait(Native Method)
> > > ? ?at java.lang.Object.wait(Object.java:485)
> > > ? ?at com.rabbitmq.utility.BlockingCell.get(BlockingCell.java:50)
> > > ? ?- locked <0x22ce4fd8> (a
> > > com.rabbitmq.utility.BlockingValueOrException)
> > > ? ?at
> > > com.rabbitmq.utility.BlockingCell.uninterruptibleGet(BlockingCell.java:
> > > 89)
> > > ? ?- locked <0x22ce4fd8> (a
> > > com.rabbitmq.utility.BlockingValueOrException)
> > > ? ?at
> > > com.rabbitmq.utility.BlockingValueOrException.uninterruptibleGetValue(Block ingValueOrException.java:
> > > 33)
> > > ? ?at com.rabbitmq.client.impl.AMQChannel
> > > $BlockingRpcContinuation.getReply(AMQChannel.java:337)
> > > ? ?at com.rabbitmq.client.impl.AMQChannel.privateRpc(AMQChannel.java:
> > > 210)
> > > ? ?at com.rabbitmq.client.impl.AMQChannel.exnWrappingRpc(AMQChannel.java:
> > > 128)
> > > ? ?at com.rabbitmq.client.impl.ChannelN.basicGet(ChannelN.java:808)
> > > ? ?at sun.reflect.GeneratedMethodAccessor8.invoke(Unknown Source)
> > > ? ?at
> > > sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImp l.java:
> > > 25)
> > > ? ?at java.lang.reflect.Method.invoke(Method.java:597)
> > > ..............
>
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-disc... at lists.rabbitmq.com
> > >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From toby.corkindale at strategicdata.com.au  Fri Oct 21 08:24:29 2011
From: toby.corkindale at strategicdata.com.au (Toby Corkindale)
Date: Fri, 21 Oct 2011 18:24:29 +1100
Subject: [rabbitmq-discuss] Creating mirrored queues via STOMP
In-Reply-To: <EFE507B3-FA08-423B-8253-1227C08CFBFE@rabbitmq.com>
References: <4E9F74A3.3000507@strategicdata.com.au>
	<EFE507B3-FA08-423B-8253-1227C08CFBFE@rabbitmq.com>
Message-ID: <4EA11E2D.4070700@strategicdata.com.au>

On 21/10/11 01:53, Steve Powell wrote:
> Hi Toby,
>
> Unfortunately it is not possible to set ha policy or ttl
> settings on a rabbit STOMP-created queue. [1] [2]
>
> However, it is possible to send to and subscribe from
> a queue created in AMQP using /amq/queue/<name>
> destinations inSTOMP. These queues can have any of the
> rabbit-supported properties.
>
> We currently have an enhancement under discussion that
> puts these headers on SUBSCRIBE or SEND, so that the
> STOMP adapter can create the right sort of queue; but
> we are not sure what to do if the header values disagree
> on two commands referring to the "same" queue.
>
> The STOMP protocol design makes it hard to define queue
> properties, as opposed to message properties, since
> queue-creation is implicit and conditional. It would be
> a surprise if one application sets a queue property and
> another removes it or resets it (or fails if the property
> is different).
>
> A description of your application which requires this
> would help us with future design.

Hi Steve,
It's nothing terribly complex.

There are several applications which generate task requests; they 
generate hundreds of these very rapidly, but only from time to time.

The tasks go through several stages. Each stage has some application 
servers that are subscribed to a queue to process precisely one request, 
then enqueue a new message for the next stage.

RabbitMQ works to hold the queue of pending tasks at each stage. Each 
stage has a separate queue. The backlog of messages surges up to a few 
hundred, then back down to zero as they get processed.

It all works quite nicely, but if I power off one of the two nodes in 
our rabbitmq cluster, then there's a 50% chance we have just lost all 
the messages in some queues. The messages are all marked as persistent, 
so as long as the machine recovers, they'll be safe.. but there's still 
a pause until you fix the machine.

So I was thinking the mirrored queues would work well for us - if a 
machine dies, then it's OK, messages will still carry on being processed 
out of the backlog.

Cheers,
Toby

From olivier.gehin at atos.net  Fri Oct 21 09:04:53 2011
From: olivier.gehin at atos.net (GEHIN Olivier)
Date: Fri, 21 Oct 2011 08:04:53 +0000
Subject: [rabbitmq-discuss] Access rights with rabbit_auth_backend_ldap
 plugin
In-Reply-To: <4EA04A46.9000600@rabbitmq.com>
References: <54B5C3987269804CAC12632B59DC9656837A7D@AOFRWMBXRSC002.resources.atosorigin.local>
	<4EA04A46.9000600@rabbitmq.com>
Message-ID: <54B5C3987269804CAC12632B59DC9656837BEB@AOFRWMBXRSC002.resources.atosorigin.local>

Hi Simon,

Thank you for your answer.

Today, we have not fully design our LDAP structur.
However, I could explain more what we try to implement:
We are developping a service platform, with communication based on rabbitMQ.
On this platform, we have dynamic users : each user has got this own queue to listen messages and has write access to a common exchange.
Our problem is the following: we will limit user to have read access only for this own queue.

I think that the solution to use in_group query is not working, because users and queue can be created dynamically, instead rabbit_auth_backend_ldap plugin configuration.

Best regards,
Olivier

-----Message d'origine-----
De : rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] De la part de Simon MacMullen
Envoy? : jeudi 20 octobre 2011 18:20
? : rabbitmq-discuss at lists.rabbitmq.com
Objet : Re: [rabbitmq-discuss] Access rights with rabbit_auth_backend_ldap plugin

Hi Olivier.

At the moment there's no support for regular expressions in the LDAP
plugin. This might get added in the future though; I'm looking into how
the existing queries could be enhanced.

At the moment the sort of thing you can do is to use an in_group query
and have a groupOfNames per object you want to control access to - but
there's no pattern matching.

If you could describe on or off list how your LDAP database is
structured and what you're trying to do, that would be a help.

Cheers, Simon

On 20/10/11 14:48, GEHIN Olivier wrote:
> Hello,
>
> I have well configurate the rabbit_auth_backend_ldap plugin with my LDAP
> directory and the connexion works.
>
> Now, I would limit access for a user to write access for a specific
> exchange and read access for a specific queue.
>
> With internal database, we could use regular expression to define access
> rights for a user.
>
> Can we define similar access rights with this plugin?
>
> Best regards,
>
> Olivier
>
> ------------------------------------------------------------------------
>
> Ce message et les pi?ces jointes sont confidentiels et r?serv?s ?
> l'usage exclusif de ses destinataires. Il peut ?galement ?tre prot?g?
> par le secret professionnel. Si vous recevez ce message par erreur,
> merci d'en avertir imm?diatement l'exp?diteur et de le d?truire.
> L'int?grit? du message ne pouvant ?tre assur?e sur Internet, la
> responsabilit? du groupe Atos ne pourra ?tre engag?e quant au contenu de
> ce message. Bien que les meilleurs efforts soient faits pour maintenir
> cette transmission exempte de tout virus, l'exp?diteur ne donne aucune
> garantie ? cet ?gard et sa responsabilit? ne saurait ?tre engag?e pour
> tout dommage r?sultant d'un virus transmis.
>
> This e-mail and the documents attached are confidential and intended
> solely for the addressee; it may also be privileged. If you receive this
> e-mail in error, please notify the sender immediately and destroy it. As
> its integrity cannot be secured on the Internet, the Atos group
> liability cannot be triggered for the message content. Although the
> sender endeavors to maintain a computer virus-free network, the sender
> does not warrant that this transmission is virus-free and will not be
> liable for any damages resulting from any virus transmitted.
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


--
Simon MacMullen
RabbitMQ, VMware
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

________________________________


Ce message et les pi?ces jointes sont confidentiels et r?serv?s ? l'usage exclusif de ses destinataires. Il peut ?galement ?tre prot?g? par le secret professionnel. Si vous recevez ce message par erreur, merci d'en avertir imm?diatement l'exp?diteur et de le d?truire. L'int?grit? du message ne pouvant ?tre assur?e sur Internet, la responsabilit? du groupe Atos ne pourra ?tre engag?e quant au contenu de ce message. Bien que les meilleurs efforts soient faits pour maintenir cette transmission exempte de tout virus, l'exp?diteur ne donne aucune garantie ? cet ?gard et sa responsabilit? ne saurait ?tre engag?e pour tout dommage r?sultant d'un virus transmis.

This e-mail and the documents attached are confidential and intended solely for the addressee; it may also be privileged. If you receive this e-mail in error, please notify the sender immediately and destroy it. As its integrity cannot be secured on the Internet, the Atos group liability cannot be triggered for the message content. Although the sender endeavors to maintain a computer virus-free network, the sender does not warrant that this transmission is virus-free and will not be liable for any damages resulting from any virus transmitted.


From zedhm at yahoo.co.uk  Fri Oct 21 09:45:33 2011
From: zedhm at yahoo.co.uk (Edward Hope-Morley)
Date: Fri, 21 Oct 2011 09:45:33 +0100
Subject: [rabbitmq-discuss] Pika basic.recover broken?
Message-ID: <4EA1312D.7000807@yahoo.co.uk>


So does that mean that RabbitMQ mandates a requeue for basic.recover? I
am unclear as to what the implications of a requeue are. How does the
server chose which queue to requeue too and under what circumstances
will it do so?

On 20/10/11 23:34, Matthew Sackman wrote:
>  On Thu, Oct 20, 2011 at 07:32:55PM +0100, E Hope-Morley wrote:
>>  Hi, when I do a basic.recover with no requeue arg i.e. requeue=False my channel closes with the following error:
>>
>>  code: 540
>>  text: NOT_IMPLEMENTED - requeue=false
>>
>>  It works fine if I do requeue=True. Any ideas?
>  Rabbit does not implement recover with requeue=false. It's not a client
>  thing, it's the server.
>
>  Matthew
>  _______________________________________________
>  rabbitmq-discuss mailing list
>  rabbitmq-discuss at lists.rabbitmq.com
>  https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



From simon at rabbitmq.com  Fri Oct 21 10:26:59 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 21 Oct 2011 10:26:59 +0100
Subject: [rabbitmq-discuss] Shovel Plugin For HA
In-Reply-To: <CAJreXKCkGO0Oy7wdnd0jzmGN1ERPB5J=Obg=X4wfY2UYGdHgaA@mail.gmail.com>
References: <CAJreXKDwNDT-LfMKhZJVikmTsjgY9d19gSsq3T8K-f_-TgjZ+g@mail.gmail.com>	<4E96EE97.7090503@rabbitmq.com>	<CAJreXKCB2-bRJEO1Equ1rTmrYWe+GcvKNuuse4yTGcBYOE4+UA@mail.gmail.com>	<4E9FDAFD.20102@rabbitmq.com>	<CAJreXKCADdzsQdXt76MBuchHyBZ-tsJURAcfOEPe9JOyLvmUJg@mail.gmail.com>	<4EA04BAF.3080209@rabbitmq.com>
	<CAJreXKCkGO0Oy7wdnd0jzmGN1ERPB5J=Obg=X4wfY2UYGdHgaA@mail.gmail.com>
Message-ID: <4EA13AE3.6090905@rabbitmq.com>

On 20/10/11 19:37, James Carr wrote:
> Maybe I misunderstand? :)
>
> Given that I have a cluster of brokers used for a single geographical
> location and each machine that publishes messages has a local broker
> that pushes messages out to the central cluster:
>
> The cluster is the upstream
> The local brokers are the downstream
>
>
> Or is it the other way around?

It is. Upstream and downstream refer to message flow.

(Of course you can set it up in both directions too, but it sounds like 
that's not what you want.)

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From matthew at rabbitmq.com  Fri Oct 21 10:32:41 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 21 Oct 2011 10:32:41 +0100
Subject: [rabbitmq-discuss] Pika basic.recover broken?
In-Reply-To: <4EA1312D.7000807@yahoo.co.uk>
References: <4EA1312D.7000807@yahoo.co.uk>
Message-ID: <20111021093240.GA30463@wellquite.org>

On Fri, Oct 21, 2011 at 09:45:33AM +0100, Edward Hope-Morley wrote:
> So does that mean that RabbitMQ mandates a requeue for basic.recover?

Yes. basic.recover with requeue = false is non-sensical if it's async,
which is the default in the 0-9-1 spec (IIRC). If you use the sync
version (which may be a RMQ extension - again IIRC), then that'll work
with requeue = false. Not all clients support this though.

> I
> am unclear as to what the implications of a requeue are. How does the
> server chose which queue to requeue too and under what circumstances
> will it do so?

All msgs delivered to the channel and unacknowledged will be requeued to
the queues from which they came.

Matthew

From simon at rabbitmq.com  Fri Oct 21 10:59:33 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 21 Oct 2011 10:59:33 +0100
Subject: [rabbitmq-discuss] Round robin dispatch between N queues
In-Reply-To: <21C30947FEC99B4D9FCEEC893D5E2BB21B933CCB@EXSFM-MB03.internal.salesforce.com>
References: <21C30947FEC99B4D9FCEEC893D5E2BB21B933CCB@EXSFM-MB03.internal.salesforce.com>
Message-ID: <4EA14285.3040700@rabbitmq.com>

If I understand you correctly you want to have every channel receive 
messages from every queue?

In that case just have every channel issue a basic.consume for every 
queue, and use a lowish prefetch count with basic.qos. Each queue will 
round-robin to each channel that has capacity to consume.

Cheers, Simon

On 18/10/11 18:19, Vijay Devadhar wrote:
> Dear RabbitMQ Users,
>
> I am likely to setup a RabbitMQ node with multiple queues; The traffic
> rate on each
>
> Queue is not predictable and will vary based on the time of the day. If
> there are
>
> 100 queues in the system, and 50 threads listening to them, I would like
> the dispatcher
>
> to fairly allocate resources to all queues with messages ready to be
> processed at any given time.
>
> I do not want to pre-allocate threads to queues by restricting what they
> listen on;
>
> I want to be able to allow all threads to work on a single queue if that
> is the only one with traffic.
>
> Is that doable? If yes, how?
>
> Thanks
>
> Vijay
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Fri Oct 21 12:15:32 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 21 Oct 2011 12:15:32 +0100
Subject: [rabbitmq-discuss] Access rights with rabbit_auth_backend_ldap
 plugin
In-Reply-To: <54B5C3987269804CAC12632B59DC9656837BEB@AOFRWMBXRSC002.resources.atosorigin.local>
References: <54B5C3987269804CAC12632B59DC9656837A7D@AOFRWMBXRSC002.resources.atosorigin.local>	<4EA04A46.9000600@rabbitmq.com>
	<54B5C3987269804CAC12632B59DC9656837BEB@AOFRWMBXRSC002.resources.atosorigin.local>
Message-ID: <4EA15454.3020408@rabbitmq.com>

Ah right, thanks for the feedback.

Cheers, Simon

On 21/10/11 09:04, GEHIN Olivier wrote:
> Hi Simon,
>
> Thank you for your answer.
>
> Today, we have not fully design our LDAP structur.
> However, I could explain more what we try to implement:
> We are developping a service platform, with communication based on rabbitMQ.
> On this platform, we have dynamic users : each user has got this own queue to listen messages and has write access to a common exchange.
> Our problem is the following: we will limit user to have read access only for this own queue.
>
> I think that the solution to use in_group query is not working, because users and queue can be created dynamically, instead rabbit_auth_backend_ldap plugin configuration.
>
> Best regards,
> Olivier
>
> -----Message d'origine-----
> De : rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] De la part de Simon MacMullen
> Envoy? : jeudi 20 octobre 2011 18:20
> ? : rabbitmq-discuss at lists.rabbitmq.com
> Objet : Re: [rabbitmq-discuss] Access rights with rabbit_auth_backend_ldap plugin
>
> Hi Olivier.
>
> At the moment there's no support for regular expressions in the LDAP
> plugin. This might get added in the future though; I'm looking into how
> the existing queries could be enhanced.
>
> At the moment the sort of thing you can do is to use an in_group query
> and have a groupOfNames per object you want to control access to - but
> there's no pattern matching.
>
> If you could describe on or off list how your LDAP database is
> structured and what you're trying to do, that would be a help.
>
> Cheers, Simon
>
> On 20/10/11 14:48, GEHIN Olivier wrote:
>> Hello,
>>
>> I have well configurate the rabbit_auth_backend_ldap plugin with my LDAP
>> directory and the connexion works.
>>
>> Now, I would limit access for a user to write access for a specific
>> exchange and read access for a specific queue.
>>
>> With internal database, we could use regular expression to define access
>> rights for a user.
>>
>> Can we define similar access rights with this plugin?
>>
>> Best regards,
>>
>> Olivier
>>
>> ------------------------------------------------------------------------
>>
>> Ce message et les pi?ces jointes sont confidentiels et r?serv?s ?
>> l'usage exclusif de ses destinataires. Il peut ?galement ?tre prot?g?
>> par le secret professionnel. Si vous recevez ce message par erreur,
>> merci d'en avertir imm?diatement l'exp?diteur et de le d?truire.
>> L'int?grit? du message ne pouvant ?tre assur?e sur Internet, la
>> responsabilit? du groupe Atos ne pourra ?tre engag?e quant au contenu de
>> ce message. Bien que les meilleurs efforts soient faits pour maintenir
>> cette transmission exempte de tout virus, l'exp?diteur ne donne aucune
>> garantie ? cet ?gard et sa responsabilit? ne saurait ?tre engag?e pour
>> tout dommage r?sultant d'un virus transmis.
>>
>> This e-mail and the documents attached are confidential and intended
>> solely for the addressee; it may also be privileged. If you receive this
>> e-mail in error, please notify the sender immediately and destroy it. As
>> its integrity cannot be secured on the Internet, the Atos group
>> liability cannot be triggered for the message content. Although the
>> sender endeavors to maintain a computer virus-free network, the sender
>> does not warrant that this transmission is virus-free and will not be
>> liable for any damages resulting from any virus transmitted.
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> ________________________________
>
>
> Ce message et les pi?ces jointes sont confidentiels et r?serv?s ? l'usage exclusif de ses destinataires. Il peut ?galement ?tre prot?g? par le secret professionnel. Si vous recevez ce message par erreur, merci d'en avertir imm?diatement l'exp?diteur et de le d?truire. L'int?grit? du message ne pouvant ?tre assur?e sur Internet, la responsabilit? du groupe Atos ne pourra ?tre engag?e quant au contenu de ce message. Bien que les meilleurs efforts soient faits pour maintenir cette transmission exempte de tout virus, l'exp?diteur ne donne aucune garantie ? cet ?gard et sa responsabilit? ne saurait ?tre engag?e pour tout dommage r?sultant d'un virus transmis.
>
> This e-mail and the documents attached are confidential and intended solely for the addressee; it may also be privileged. If you receive this e-mail in error, please notify the sender immediately and destroy it. As its integrity cannot be secured on the Internet, the Atos group liability cannot be triggered for the message content. Although the sender endeavors to maintain a computer virus-free network, the sender does not warrant that this transmission is virus-free and will not be liable for any damages resulting from any virus transmitted.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From pavankumar.manikonda at schneider-electric.com  Fri Oct 21 11:15:03 2011
From: pavankumar.manikonda at schneider-electric.com (pavuuu)
Date: Fri, 21 Oct 2011 03:15:03 -0700 (PDT)
Subject: [rabbitmq-discuss] BrokerUnrechableException after sending 16366
 messages
Message-ID: <32695317.post@talk.nabble.com>


Hello All,

I am trying to send 1million messages into the message broker queue. I've
observed a weird error in sending these messages. After sending 16366
messages, I am getting a BrokerUnrechableException.

Can someone tell me what is the reason for this exception.

Thanks in advance.
-- 
View this message in context: http://old.nabble.com/BrokerUnrechableException-after-sending-16366-messages-tp32695317p32695317.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From simon at rabbitmq.com  Fri Oct 21 12:29:14 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 21 Oct 2011 12:29:14 +0100
Subject: [rabbitmq-discuss] BrokerUnrechableException after sending
 16366 messages
In-Reply-To: <32695317.post@talk.nabble.com>
References: <32695317.post@talk.nabble.com>
Message-ID: <4EA1578A.70806@rabbitmq.com>

On 21/10/11 11:15, pavuuu wrote:
> I am trying to send 1million messages into the message broker queue. I've
> observed a weird error in sending these messages. After sending 16366
> messages, I am getting a BrokerUnrechableException.
>
> Can someone tell me what is the reason for this exception.

BrokerUnreachableException means that the broker is unreachable. It is 
only ever thrown while trying to initially connect to the broker. Look 
in the ConnectionErrors field to see why connection failed.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Fri Oct 21 12:37:48 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 21 Oct 2011 12:37:48 +0100
Subject: [rabbitmq-discuss] Message is delivered to all queue consumers
 when	rabbitmq crashes
In-Reply-To: <67adaf50-e0a7-49f2-9868-4a362ab1333e@k35g2000yqh.googlegroups.com>
References: <67adaf50-e0a7-49f2-9868-4a362ab1333e@k35g2000yqh.googlegroups.com>
Message-ID: <4EA1598C.9040604@rabbitmq.com>

On 19/10/11 21:02, rasadoll wrote:
> I have multiple queue consumers running at the same time. They all
> listen to one single queue. Messages are sent to the default exchange
> with queue name as the routing key. When one of the consumers is busy
> processing a message, before acking the message if RabbitMQ service
> crashes (simply by stopping the service), the message is sent to all
> other consumers immediately which results in processing the same
> message multiple times concurrently. Is this the right behavior for
> RabbitMQ?

No. RabbitMQ should really only deliver a given message from a queue to 
a single consumer.

I haven't been able to replicate the behaviour you describe.

Cheers, Simon

> Here is my queue design:
>
> Map<String, Object>  args = new HashMap<String, Object>();
> args.put("x-ha-policy", "all");
> channel.queueDeclare(JOB_EXEC_QUEUE, true, false, false, args);
>
> I use durable HA queue but I am not running in a clustered
> environment.
> ===========================
> Message publishing:
>
> channel.basicPublish("", JOB_EXEC_QUEUE,
> MessageProperties.PERSISTENT_BASIC, message.getBytes());
> ===========================
> Consumer Code:
>
> channel.basicQos(1);
> QueueingConsumer consumer = new QueueingConsumer(channel);
> channel.basicConsume(JOB_EXEC_QUEUE, consumer);
>
> QueueingConsumer.Delivery delivery;
> while (true) {
>          try {
>            delivery = consumer.nextDelivery();
>          } catch (InterruptedException ie) {
>            continue;
>          }
>
> // process the message
>
>         channel.basicAck(delivery.getEnvelope().getDeliveryTag(),
> false);
> }
>
> I stop the service when one consumer is in the process message phase.
>
> Am I doing something wrong? Is this an expected behavior for RabbitMQ?
>
> Thanks,
> Reza
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From madhuchannama at gmail.com  Fri Oct 21 13:33:51 2011
From: madhuchannama at gmail.com (Maddy C)
Date: Fri, 21 Oct 2011 18:03:51 +0530
Subject: [rabbitmq-discuss] Video streaming over AMQP using RabbitMQ via
	Java Client API
Message-ID: <CAJ=8oL1Ok0HTBbEtYXj82bsDv8qXwqb2ks6aragLGQuePiXaXw@mail.gmail.com>

I am looking for a simple example that illustrates the sending of a
video file to a queue and another on retrieving the video file. Please can
you
give some basic examples on this streaming video on Rabbitmq. please mail me
to
below Email Id.

Thanks and Regards,
Madhusudhan C



-- 
Thanks & Regards,
Madhusudhan

 (?`?.???) Always
`?.?(?`?.???) Keep
(?`?.???)?.?? Smiling!!
`?.?.??
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111021/5517ed5d/attachment.htm>

From gabrieladgeg at gmail.com  Fri Oct 21 14:19:02 2011
From: gabrieladgeg at gmail.com (gabriel adgeg)
Date: Fri, 21 Oct 2011 15:19:02 +0200
Subject: [rabbitmq-discuss] pika and node.amqp interop
Message-ID: <CAE+5KB02nEoyZiO8tyGTQw7ZSR9kc=kC+=OhC_aZn3C_8dwuVg@mail.gmail.com>

Hi Ricardo,

There are several problems in your code, both on the sender and on the
receiver side.

[sender]

If you use the library node-amqp provided here
https://github.com/postwait/node-amqp,
you may install it with npm  (the node package manager), using the following
command in a shell:
$ npm install -g amqp
This will install the amqp library in the directory /lib/node_modules of
your node installation directory.
Now, check that you have properly added  /lib/node_modules to your
NODE_PATH.
If it is the case, your import is require('amqp') and not require('./amqp')

So here is the code you should use:

var amqp = require('amqp');

var connection = amqp.createConnection({ host: 'localhost' });

// Wait for connection to become established.
connection.on('ready', function () {
   var x = connection.exchange()
   var q = connection.queue("aqueuename",
            { autoDelete: true, durable: false, exclusive: false });
   // Wait for the queue to be declared.
   q.on('queueDeclareOk', function(){
x.publish('aqueuename', "bar");
connection.end();
   });
});


[receiver]

I hadn't ever use AsyncoreConnection, but you can use BlockingConnection :


#!/usr/bin/env python
import pika

connection =
pika.BlockingConnection(pika.ConnectionParameters(host='localhost'))
channel = connection.channel()

q = channel.queue_declare(queue='aqueuename',
                        auto_delete=True,
                        durable=False,
                        exclusive=False)

print ' [*] Waiting for messages. To exit press CTRL+C'

def callback(ch, method, properties, body):
   print " [x] Received %r" % (body,)

channel.basic_consume(callback,
                     queue='aqueuename',
                     no_ack=True)

channel.start_consuming()


Cheers,
Gabriel


On 20/10/11 16:55, Ricardo Brizido wrote:


> For some reason I can't get this example to work:
>
>
> [sender]
> var sys = require('sys');
> var amqp = require('./amqp');
>
> var connection = amqp.createConnection({ host: 'localhost' });
>
> // Wait for connection to become established.
> connection.addListener('ready', function () {
>    var x = connection.exchange()
>    var q = connection.queue("aqueuename",
>             { autoDelete: true, durable: false, exclusive: false });
>    x.publish('aqueuename', {foo: "bar"});
> });
>
> [receiver]
> #!/usr/bin/env python
> import pika
>
> connection = pika.AsyncoreConnection(pika.ConnectionParameters(
>        host='localhost'))
> channel = connection.channel()
>
> q = channel.queue_declare(queue='aqueuename',
>                         auto_delete=True,
>                         durable=False,
>                         exclusive=False)
>
> print ' [*] Waiting for messages. To exit press CTRL+C'
>
> def callback(ch, method, properties, body):
>    print " [x] Received %r" % (body,)
>
> channel.basic_consume(callback,
>                      queue='aqueuename',
>                      no_ack=True)
>
> pika.asyncore_loop()
>
>
> I wanted to used a BlockingConnection. Do you know if this works with
> a BlockingConnection?
>
>
> Thanks
>
> Ricardo
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111021/f7f5399c/attachment.htm>

From bozhidar.bozhanov at gmail.com  Fri Oct 21 14:26:48 2011
From: bozhidar.bozhanov at gmail.com (Bozhidar Bozhanov)
Date: Fri, 21 Oct 2011 06:26:48 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ basic.get and acknowledgement
Message-ID: <b1cab362-594b-4c6a-83b9-326e802f3e9e@p1g2000yqk.googlegroups.com>

I'm invoking:

GetResponse response = channel.basicGet("some.queue", false); // no
auto-ack
....
channel.basicAck(deliveryTag, ...);

However, when I invoke basicGet, the messages in the queue stay in
"Ready", rather than in "Unacknowledged". I want them to be in
unacknowledged, so that I can either basic.ack them (thus discarding
them from the queue), or basic.nack them

From majek04 at gmail.com  Fri Oct 21 14:46:12 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 21 Oct 2011 14:46:12 +0100
Subject: [rabbitmq-discuss] Video streaming over AMQP using RabbitMQ via
 Java Client API
In-Reply-To: <CAJ=8oL1Ok0HTBbEtYXj82bsDv8qXwqb2ks6aragLGQuePiXaXw@mail.gmail.com>
References: <CAJ=8oL1Ok0HTBbEtYXj82bsDv8qXwqb2ks6aragLGQuePiXaXw@mail.gmail.com>
Message-ID: <CABzX+qw0x4xx+psh2aWoB1S38yNoGPO8=pB5T2L+dOfG7HOn_Q@mail.gmail.com>

Maddy,

Take a look at our examples from here:
http://www.rabbitmq.com/getstarted.html

And adapt them to your need.

Cheers,
  Marek

On Fri, Oct 21, 2011 at 13:33, Maddy C <madhuchannama at gmail.com> wrote:
> I am looking for a simple example that illustrates the sending of a
> video file to a queue and another on retrieving the video file. Please can
> you
> give some basic examples on this streaming video on Rabbitmq. please mail me
> to
> below Email Id.
>
> Thanks and Regards,
> Madhusudhan C
>
>
>
> --
> Thanks & Regards,
> Madhusudhan
>
> ?(?`?.???) Always
> `?.?(?`?.???) Keep
> (?`?.???)?.?? Smiling!!
> `?.?.??
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From majek04 at gmail.com  Fri Oct 21 14:49:03 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 21 Oct 2011 14:49:03 +0100
Subject: [rabbitmq-discuss] RabbitMQ basic.get and acknowledgement
In-Reply-To: <b1cab362-594b-4c6a-83b9-326e802f3e9e@p1g2000yqk.googlegroups.com>
References: <b1cab362-594b-4c6a-83b9-326e802f3e9e@p1g2000yqk.googlegroups.com>
Message-ID: <CABzX+qxweYEWLcmPFLwk+=FaMW2UR-MiR+wVC8g_47cARfbu+w@mail.gmail.com>

Hi,

basicGet gets only one message. Last message.
And this message will be marked as 'unacknowledged'
until you ack it (or unmark it in the other way, like
abruptly closing a connection).

Cheers,
  Marek

On Fri, Oct 21, 2011 at 14:26, Bozhidar Bozhanov
<bozhidar.bozhanov at gmail.com> wrote:
> I'm invoking:
>
> GetResponse response = channel.basicGet("some.queue", false); // no
> auto-ack
> ....
> channel.basicAck(deliveryTag, ...);
>
> However, when I invoke basicGet, the messages in the queue stay in
> "Ready", rather than in "Unacknowledged". I want them to be in
> unacknowledged, so that I can either basic.ack them (thus discarding
> them from the queue), or basic.nack them
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From bozhidar.bozhanov at gmail.com  Fri Oct 21 15:07:24 2011
From: bozhidar.bozhanov at gmail.com (Bozhidar Bozhanov)
Date: Fri, 21 Oct 2011 17:07:24 +0300
Subject: [rabbitmq-discuss] RabbitMQ basic.get and acknowledgement
In-Reply-To: <CABzX+qxweYEWLcmPFLwk+=FaMW2UR-MiR+wVC8g_47cARfbu+w@mail.gmail.com>
References: <b1cab362-594b-4c6a-83b9-326e802f3e9e@p1g2000yqk.googlegroups.com>
	<CABzX+qxweYEWLcmPFLwk+=FaMW2UR-MiR+wVC8g_47cARfbu+w@mail.gmail.com>
Message-ID: <CACGcny8YfjTMuX7-VNNCo7gLBtb4BH9EW_719EOXiLKWq7Maig@mail.gmail.com>

Well, I expected it to work like that, but it doesn't. The message
stays "Ready".


On Fri, Oct 21, 2011 at 4:49 PM, Marek Majkowski <majek04 at gmail.com> wrote:
> Hi,
>
> basicGet gets only one message. Last message.
> And this message will be marked as 'unacknowledged'
> until you ack it (or unmark it in the other way, like
> abruptly closing a connection).
>
> Cheers,
> ?Marek
>
> On Fri, Oct 21, 2011 at 14:26, Bozhidar Bozhanov
> <bozhidar.bozhanov at gmail.com> wrote:
>> I'm invoking:
>>
>> GetResponse response = channel.basicGet("some.queue", false); // no
>> auto-ack
>> ....
>> channel.basicAck(deliveryTag, ...);
>>
>> However, when I invoke basicGet, the messages in the queue stay in
>> "Ready", rather than in "Unacknowledged". I want them to be in
>> unacknowledged, so that I can either basic.ack them (thus discarding
>> them from the queue), or basic.nack them
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>

From majek04 at gmail.com  Fri Oct 21 15:27:48 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 21 Oct 2011 15:27:48 +0100
Subject: [rabbitmq-discuss] RabbitMQ basic.get and acknowledgement
In-Reply-To: <CACGcny8YfjTMuX7-VNNCo7gLBtb4BH9EW_719EOXiLKWq7Maig@mail.gmail.com>
References: <b1cab362-594b-4c6a-83b9-326e802f3e9e@p1g2000yqk.googlegroups.com>
	<CABzX+qxweYEWLcmPFLwk+=FaMW2UR-MiR+wVC8g_47cARfbu+w@mail.gmail.com>
	<CACGcny8YfjTMuX7-VNNCo7gLBtb4BH9EW_719EOXiLKWq7Maig@mail.gmail.com>
Message-ID: <CABzX+qwXpsVU0MKjYW+ckv50OQgXMrj1ye2sep3AoZhGP2rsFA@mail.gmail.com>

On Fri, Oct 21, 2011 at 15:07, Bozhidar Bozhanov
<bozhidar.bozhanov at gmail.com> wrote:
> Well, I expected it to work like that, but it doesn't. The message
> stays "Ready".

You must be doing something wrong.



>
>
> On Fri, Oct 21, 2011 at 4:49 PM, Marek Majkowski <majek04 at gmail.com> wrote:
>> Hi,
>>
>> basicGet gets only one message. Last message.
>> And this message will be marked as 'unacknowledged'
>> until you ack it (or unmark it in the other way, like
>> abruptly closing a connection).
>>
>> Cheers,
>> ?Marek
>>
>> On Fri, Oct 21, 2011 at 14:26, Bozhidar Bozhanov
>> <bozhidar.bozhanov at gmail.com> wrote:
>>> I'm invoking:
>>>
>>> GetResponse response = channel.basicGet("some.queue", false); // no
>>> auto-ack
>>> ....
>>> channel.basicAck(deliveryTag, ...);
>>>
>>> However, when I invoke basicGet, the messages in the queue stay in
>>> "Ready", rather than in "Unacknowledged". I want them to be in
>>> unacknowledged, so that I can either basic.ack them (thus discarding
>>> them from the queue), or basic.nack them
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>
>

From steve at rabbitmq.com  Fri Oct 21 15:28:26 2011
From: steve at rabbitmq.com (Steve Powell)
Date: Fri, 21 Oct 2011 15:28:26 +0100
Subject: [rabbitmq-discuss] Creating mirrored queues via STOMP
In-Reply-To: <4EA11E2D.4070700@strategicdata.com.au>
References: <4E9F74A3.3000507@strategicdata.com.au>
	<EFE507B3-FA08-423B-8253-1227C08CFBFE@rabbitmq.com>
	<4EA11E2D.4070700@strategicdata.com.au>
Message-ID: <FE11CEF9-AEE7-4D43-983C-C5E99CA29346@rabbitmq.com>

Toby,

If the queue structure is fixed then the STOMP adapter 
need not create them, and so it might be sensible to 
create them beforehand, and use STOMP destinations of 
/amq/queue/<name> as I suggested.  

Instead of using STOMP to create them, create some 
shared queues using a richer protocol, say with the 
Java Client, or the Erlang Client, or even Python 
(gasp). The queue headers are then arbitrary and the 
STOMP applications will only have to SEND and 
SUBSCRIBE to the /amq/destinations and not be 
concerned with any operational characteristics of the 
queues.

The (slight) downside is that the queues are managed
separately from the main apps, and you might have some
more operational steps at restart/backup/upgrade
events to consider. I'm morally certain you already 
have a place to put those extra steps.
 
Steve Powell  (a happy bunny)
----------some definitions from the SPD----------
Rigatoni n. A prime-ministerial grin.
Nigella n. The next bottle-size up from a Nebuchadnezzar.
Homily adv. Rather like a frenchman.

On 21 Oct 2011, at 08:24, Toby Corkindale wrote:

> On 21/10/11 01:53, Steve Powell wrote:
>> Hi Toby,
>> 
>> Unfortunately it is not possible to set ha policy or ttl
>> settings on a rabbit STOMP-created queue. [1] [2]
>> 
>> However, it is possible to send to and subscribe from
>> a queue created in AMQP using /amq/queue/<name>
>> destinations inSTOMP. These queues can have any of the
>> rabbit-supported properties.
>> 
>> We currently have an enhancement under discussion that
>> puts these headers on SUBSCRIBE or SEND, so that the
>> STOMP adapter can create the right sort of queue; but
>> we are not sure what to do if the header values disagree
>> on two commands referring to the "same" queue.
>> 
>> The STOMP protocol design makes it hard to define queue
>> properties, as opposed to message properties, since
>> queue-creation is implicit and conditional. It would be
>> a surprise if one application sets a queue property and
>> another removes it or resets it (or fails if the property
>> is different).
>> 
>> A description of your application which requires this
>> would help us with future design.
> 
> Hi Steve,
> It's nothing terribly complex.
> 
> There are several applications which generate task requests; they generate hundreds of these very rapidly, but only from time to time.
> 
> The tasks go through several stages. Each stage has some application servers that are subscribed to a queue to process precisely one request, then enqueue a new message for the next stage.
> 
> RabbitMQ works to hold the queue of pending tasks at each stage. Each stage has a separate queue. The backlog of messages surges up to a few hundred, then back down to zero as they get processed.
> 
> It all works quite nicely, but if I power off one of the two nodes in our rabbitmq cluster, then there's a 50% chance we have just lost all the messages in some queues. The messages are all marked as persistent, so as long as the machine recovers, they'll be safe.. but there's still a pause until you fix the machine.
> 
> So I was thinking the mirrored queues would work well for us - if a machine dies, then it's OK, messages will still carry on being processed out of the backlog.
> 
> Cheers,
> Toby

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111021/4b5ea5f5/attachment.htm>

From bozhidar.bozhanov at gmail.com  Fri Oct 21 15:39:43 2011
From: bozhidar.bozhanov at gmail.com (Bozhidar Bozhanov)
Date: Fri, 21 Oct 2011 17:39:43 +0300
Subject: [rabbitmq-discuss] RabbitMQ basic.get and acknowledgement
In-Reply-To: <CABzX+qwXpsVU0MKjYW+ckv50OQgXMrj1ye2sep3AoZhGP2rsFA@mail.gmail.com>
References: <b1cab362-594b-4c6a-83b9-326e802f3e9e@p1g2000yqk.googlegroups.com>
	<CABzX+qxweYEWLcmPFLwk+=FaMW2UR-MiR+wVC8g_47cARfbu+w@mail.gmail.com>
	<CACGcny8YfjTMuX7-VNNCo7gLBtb4BH9EW_719EOXiLKWq7Maig@mail.gmail.com>
	<CABzX+qwXpsVU0MKjYW+ckv50OQgXMrj1ye2sep3AoZhGP2rsFA@mail.gmail.com>
Message-ID: <CACGcny9GZzBjrR814kEQZ8vSeh6JadxLqnShM0V2S9f2Acf0Gw@mail.gmail.com>

That one I figured out myself :) but what could it be, given default
setup, and the above code?

On Fri, Oct 21, 2011 at 5:27 PM, Marek Majkowski <majek04 at gmail.com> wrote:
> On Fri, Oct 21, 2011 at 15:07, Bozhidar Bozhanov
> <bozhidar.bozhanov at gmail.com> wrote:
>> Well, I expected it to work like that, but it doesn't. The message
>> stays "Ready".
>
> You must be doing something wrong.
>
>
>
>>
>>
>> On Fri, Oct 21, 2011 at 4:49 PM, Marek Majkowski <majek04 at gmail.com> wrote:
>>> Hi,
>>>
>>> basicGet gets only one message. Last message.
>>> And this message will be marked as 'unacknowledged'
>>> until you ack it (or unmark it in the other way, like
>>> abruptly closing a connection).
>>>
>>> Cheers,
>>> ?Marek
>>>
>>> On Fri, Oct 21, 2011 at 14:26, Bozhidar Bozhanov
>>> <bozhidar.bozhanov at gmail.com> wrote:
>>>> I'm invoking:
>>>>
>>>> GetResponse response = channel.basicGet("some.queue", false); // no
>>>> auto-ack
>>>> ....
>>>> channel.basicAck(deliveryTag, ...);
>>>>
>>>> However, when I invoke basicGet, the messages in the queue stay in
>>>> "Ready", rather than in "Unacknowledged". I want them to be in
>>>> unacknowledged, so that I can either basic.ack them (thus discarding
>>>> them from the queue), or basic.nack them
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>
>>>
>>
>

From majek04 at gmail.com  Fri Oct 21 15:57:48 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 21 Oct 2011 15:57:48 +0100
Subject: [rabbitmq-discuss] RabbitMQ basic.get and acknowledgement
In-Reply-To: <CACGcny9GZzBjrR814kEQZ8vSeh6JadxLqnShM0V2S9f2Acf0Gw@mail.gmail.com>
References: <b1cab362-594b-4c6a-83b9-326e802f3e9e@p1g2000yqk.googlegroups.com>
	<CABzX+qxweYEWLcmPFLwk+=FaMW2UR-MiR+wVC8g_47cARfbu+w@mail.gmail.com>
	<CACGcny8YfjTMuX7-VNNCo7gLBtb4BH9EW_719EOXiLKWq7Maig@mail.gmail.com>
	<CABzX+qwXpsVU0MKjYW+ckv50OQgXMrj1ye2sep3AoZhGP2rsFA@mail.gmail.com>
	<CACGcny9GZzBjrR814kEQZ8vSeh6JadxLqnShM0V2S9f2Acf0Gw@mail.gmail.com>
Message-ID: <CABzX+qzhhx2Bre_=J9ysf5i=LYOMhnZ+dfu_GWpK-bBSbaf8rg@mail.gmail.com>

On Fri, Oct 21, 2011 at 15:39, Bozhidar Bozhanov
<bozhidar.bozhanov at gmail.com> wrote:
> That one I figured out myself :) but what could it be, given default
> setup, and the above code?

There is not much to be said about given code.
Can you supply us with a runnable code?



> On Fri, Oct 21, 2011 at 5:27 PM, Marek Majkowski <majek04 at gmail.com> wrote:
>> On Fri, Oct 21, 2011 at 15:07, Bozhidar Bozhanov
>> <bozhidar.bozhanov at gmail.com> wrote:
>>> Well, I expected it to work like that, but it doesn't. The message
>>> stays "Ready".
>>
>> You must be doing something wrong.
>>
>>
>>
>>>
>>>
>>> On Fri, Oct 21, 2011 at 4:49 PM, Marek Majkowski <majek04 at gmail.com> wrote:
>>>> Hi,
>>>>
>>>> basicGet gets only one message. Last message.
>>>> And this message will be marked as 'unacknowledged'
>>>> until you ack it (or unmark it in the other way, like
>>>> abruptly closing a connection).
>>>>
>>>> Cheers,
>>>> ?Marek
>>>>
>>>> On Fri, Oct 21, 2011 at 14:26, Bozhidar Bozhanov
>>>> <bozhidar.bozhanov at gmail.com> wrote:
>>>>> I'm invoking:
>>>>>
>>>>> GetResponse response = channel.basicGet("some.queue", false); // no
>>>>> auto-ack
>>>>> ....
>>>>> channel.basicAck(deliveryTag, ...);
>>>>>
>>>>> However, when I invoke basicGet, the messages in the queue stay in
>>>>> "Ready", rather than in "Unacknowledged". I want them to be in
>>>>> unacknowledged, so that I can either basic.ack them (thus discarding
>>>>> them from the queue), or basic.nack them
>>>>> _______________________________________________
>>>>> rabbitmq-discuss mailing list
>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>>
>>>>
>>>
>>
>

From james.r.carr at gmail.com  Fri Oct 21 16:14:01 2011
From: james.r.carr at gmail.com (James Carr)
Date: Fri, 21 Oct 2011 10:14:01 -0500
Subject: [rabbitmq-discuss] BrokerUnrechableException after sending
	16366 messages
In-Reply-To: <4EA1578A.70806@rabbitmq.com>
References: <32695317.post@talk.nabble.com>
	<4EA1578A.70806@rabbitmq.com>
Message-ID: <CAJreXKDSRF5hcYs3dn4ES+uL3k_aR=N5xawQu+vQpeZkEhu-Ww@mail.gmail.com>

One "newb" mistake I often see when devs are initially testing out our
dev cluster is they open a connection for each message they send
rather than opening one connection and re-using it. This will quickly
use up all the connections on the box and rabbitmq will begin refusing
additional requests to connect.

Once you have one connection and multiplex multiple channels, you
shouldn't see such problems. We've pushed upwards of 10,000 messges
per second so far on a single box and it hasn't missed a beat. :)

Thanks,
James


On Fri, Oct 21, 2011 at 6:29 AM, Simon MacMullen <simon at rabbitmq.com> wrote:
> On 21/10/11 11:15, pavuuu wrote:
>>
>> I am trying to send 1million messages into the message broker queue. I've
>> observed a weird error in sending these messages. After sending 16366
>> messages, I am getting a BrokerUnrechableException.
>>
>> Can someone tell me what is the reason for this exception.
>
> BrokerUnreachableException means that the broker is unreachable. It is only
> ever thrown while trying to initially connect to the broker. Look in the
> ConnectionErrors field to see why connection failed.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From james.r.carr at gmail.com  Fri Oct 21 16:16:12 2011
From: james.r.carr at gmail.com (James Carr)
Date: Fri, 21 Oct 2011 10:16:12 -0500
Subject: [rabbitmq-discuss] Video streaming over AMQP using RabbitMQ via
 Java Client API
In-Reply-To: <CABzX+qw0x4xx+psh2aWoB1S38yNoGPO8=pB5T2L+dOfG7HOn_Q@mail.gmail.com>
References: <CAJ=8oL1Ok0HTBbEtYXj82bsDv8qXwqb2ks6aragLGQuePiXaXw@mail.gmail.com>
	<CABzX+qw0x4xx+psh2aWoB1S38yNoGPO8=pB5T2L+dOfG7HOn_Q@mail.gmail.com>
Message-ID: <CAJreXKCygmnq+ggPsLDUo36het9FwKPrcupLuRhjvdkU98uP3Q@mail.gmail.com>

This actually brings up a good question. So far I haven't actually
pushed binary files through rabbitMQ but I'm about to. Correct me if
I'm wrong but sending a large binary file might make rabbitMQ croak
(granted, this result would be bound to memory and disk resources on
the machine) and would probably require chunking and resequencing,
correct?


Thanks,
James


On Fri, Oct 21, 2011 at 8:46 AM, Marek Majkowski <majek04 at gmail.com> wrote:
> Maddy,
>
> Take a look at our examples from here:
> http://www.rabbitmq.com/getstarted.html
>
> And adapt them to your need.
>
> Cheers,
> ?Marek
>
> On Fri, Oct 21, 2011 at 13:33, Maddy C <madhuchannama at gmail.com> wrote:
>> I am looking for a simple example that illustrates the sending of a
>> video file to a queue and another on retrieving the video file. Please can
>> you
>> give some basic examples on this streaming video on Rabbitmq. please mail me
>> to
>> below Email Id.
>>
>> Thanks and Regards,
>> Madhusudhan C
>>
>>
>>
>> --
>> Thanks & Regards,
>> Madhusudhan
>>
>> ?(?`?.???) Always
>> `?.?(?`?.???) Keep
>> (?`?.???)?.?? Smiling!!
>> `?.?.??
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From simon at rabbitmq.com  Fri Oct 21 16:22:55 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 21 Oct 2011 16:22:55 +0100
Subject: [rabbitmq-discuss] BrokerUnrechableException after sending
 16366 messages
In-Reply-To: <CAJreXKDSRF5hcYs3dn4ES+uL3k_aR=N5xawQu+vQpeZkEhu-Ww@mail.gmail.com>
References: <32695317.post@talk.nabble.com>	<4EA1578A.70806@rabbitmq.com>
	<CAJreXKDSRF5hcYs3dn4ES+uL3k_aR=N5xawQu+vQpeZkEhu-Ww@mail.gmail.com>
Message-ID: <4EA18E4F.7000205@rabbitmq.com>

On 21/10/11 16:14, James Carr wrote:
> One "newb" mistake I often see when devs are initially testing out our
> dev cluster is they open a connection for each message they send
> rather than opening one connection and re-using it.  This will quickly
> use up all the connections on the box and rabbitmq will begin refusing
> additional requests to connect.

You should be fine of course as long as you are *closing* those 
connections too. RabbitMQ will only refuse connections when you have too 
many active ones.

But.

If you churn through connections at a frantic rate, you can get into a 
state where the entire *client* box can't make outgoing connections for 
a while, as all your ports in the ephemeral port range still have the 
remains of an old connection sitting there in the TCP_WAIT state.

If you run into this it's usually a sign that you should be a bit more 
economical with connections (to put it mildly), but on Linux at least 
you can work around it with:

# echo "1" >/proc/sys/net/ipv4/tcp_tw_reuse
# echo "1" >/proc/sys/net/ipv4/tcp_tw_recycle

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Fri Oct 21 16:25:23 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 21 Oct 2011 16:25:23 +0100
Subject: [rabbitmq-discuss] Video streaming over AMQP using RabbitMQ via
 Java Client API
In-Reply-To: <CAJreXKCygmnq+ggPsLDUo36het9FwKPrcupLuRhjvdkU98uP3Q@mail.gmail.com>
References: <CAJ=8oL1Ok0HTBbEtYXj82bsDv8qXwqb2ks6aragLGQuePiXaXw@mail.gmail.com>	<CABzX+qw0x4xx+psh2aWoB1S38yNoGPO8=pB5T2L+dOfG7HOn_Q@mail.gmail.com>
	<CAJreXKCygmnq+ggPsLDUo36het9FwKPrcupLuRhjvdkU98uP3Q@mail.gmail.com>
Message-ID: <4EA18EE3.20408@rabbitmq.com>

On 21/10/11 16:16, James Carr wrote:
> This actually brings up a good question. So far I haven't actually
> pushed binary files through rabbitMQ but I'm about to. Correct me if
> I'm wrong but sending a large binary file might make rabbitMQ croak
> (granted, this result would be bound to memory and disk resources on
> the machine) and would probably require chunking and resequencing,
> correct?

Depends what you mean by "large". (And "croak"). But we don't make any 
attempt to split up or stream messages within the broker; the message is 
just treated as a binary.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From james.r.carr at gmail.com  Fri Oct 21 16:27:42 2011
From: james.r.carr at gmail.com (James Carr)
Date: Fri, 21 Oct 2011 10:27:42 -0500
Subject: [rabbitmq-discuss] Video streaming over AMQP using RabbitMQ via
 Java Client API
In-Reply-To: <4EA18EE3.20408@rabbitmq.com>
References: <CAJ=8oL1Ok0HTBbEtYXj82bsDv8qXwqb2ks6aragLGQuePiXaXw@mail.gmail.com>
	<CABzX+qw0x4xx+psh2aWoB1S38yNoGPO8=pB5T2L+dOfG7HOn_Q@mail.gmail.com>
	<CAJreXKCygmnq+ggPsLDUo36het9FwKPrcupLuRhjvdkU98uP3Q@mail.gmail.com>
	<4EA18EE3.20408@rabbitmq.com>
Message-ID: <CAJreXKAPCZVJEDGCVh9e2x3tmcyHq93mmadfGij5=+KyOuw39g@mail.gmail.com>

Yeah, I meant the splitting and resequencing being done by client
apps, not rabbit.

On Fri, Oct 21, 2011 at 10:25 AM, Simon MacMullen <simon at rabbitmq.com> wrote:
> On 21/10/11 16:16, James Carr wrote:
>>
>> This actually brings up a good question. So far I haven't actually
>> pushed binary files through rabbitMQ but I'm about to. Correct me if
>> I'm wrong but sending a large binary file might make rabbitMQ croak
>> (granted, this result would be bound to memory and disk resources on
>> the machine) and would probably require chunking and resequencing,
>> correct?
>
> Depends what you mean by "large". (And "croak"). But we don't make any
> attempt to split up or stream messages within the broker; the message is
> just treated as a binary.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From rasadoll at gmail.com  Fri Oct 21 17:53:37 2011
From: rasadoll at gmail.com (rasadoll)
Date: Fri, 21 Oct 2011 09:53:37 -0700 (PDT)
Subject: [rabbitmq-discuss] Message is delivered to all queue consumers
	when rabbitmq crashes
In-Reply-To: <4EA1598C.9040604@rabbitmq.com>
References: <67adaf50-e0a7-49f2-9868-4a362ab1333e@k35g2000yqh.googlegroups.com>
	<4EA1598C.9040604@rabbitmq.com>
Message-ID: <c40dd4c2-bd92-4738-a215-4a6b413560e7@f36g2000vbm.googlegroups.com>

Hi Simon,

This problem happens only if consumers run as separate processes (in
different jvms). If they all run in the same jvm everything works
fine.

Thanks,
Reza

On Oct 21, 7:37?am, Simon MacMullen <si... at rabbitmq.com> wrote:
> On 19/10/11 21:02, rasadoll wrote:
>
> > I have multiple queue consumers running at the same time. They all
> > listen to one single queue. Messages are sent to the default exchange
> > with queue name as the routing key. When one of the consumers is busy
> > processing a message, before acking the message if RabbitMQ service
> > crashes (simply by stopping the service), the message is sent to all
> > other consumers immediately which results in processing the same
> > message multiple times concurrently. Is this the right behavior for
> > RabbitMQ?
>
> No. RabbitMQ should really only deliver a given message from a queue to
> a single consumer.
>
> I haven't been able to replicate the behaviour you describe.
>
> Cheers, Simon
>
>
>
>
>
>
>
>
>
> > Here is my queue design:
>
> > Map<String, Object> ?args = new HashMap<String, Object>();
> > args.put("x-ha-policy", "all");
> > channel.queueDeclare(JOB_EXEC_QUEUE, true, false, false, args);
>
> > I use durable HA queue but I am not running in a clustered
> > environment.
> > ===========================
> > Message publishing:
>
> > channel.basicPublish("", JOB_EXEC_QUEUE,
> > MessageProperties.PERSISTENT_BASIC, message.getBytes());
> > ===========================
> > Consumer Code:
>
> > channel.basicQos(1);
> > QueueingConsumer consumer = new QueueingConsumer(channel);
> > channel.basicConsume(JOB_EXEC_QUEUE, consumer);
>
> > QueueingConsumer.Delivery delivery;
> > while (true) {
> > ? ? ? ? ?try {
> > ? ? ? ? ? ?delivery = consumer.nextDelivery();
> > ? ? ? ? ?} catch (InterruptedException ie) {
> > ? ? ? ? ? ?continue;
> > ? ? ? ? ?}
>
> > // process the message
>
> > ? ? ? ? channel.basicAck(delivery.getEnvelope().getDeliveryTag(),
> > false);
> > }
>
> > I stop the service when one consumer is in the process message phase.
>
> > Am I doing something wrong? Is this an expected behavior for RabbitMQ?
>
> > Thanks,
> > Reza
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From andrea.rosa at hp.com  Fri Oct 21 18:10:54 2011
From: andrea.rosa at hp.com (Andrea Rosa)
Date: Fri, 21 Oct 2011 18:10:54 +0100
Subject: [rabbitmq-discuss] Supervisor report
Message-ID: <1319217054.31207.2.camel@vicbristol6.hpl.hp.com>

Hi

I found this entry (many times with different values and timestam) in
the sasl log file, what does it means?



=SUPERVISOR REPORT==== 10-Oct-2011::14:31:35 ===
     Supervisor: {<0.20756.1688>,
                                           rabbit_channel_sup_sup}
     Context:    shutdown_error
     Reason:     shutdown
     Offender:   [{pid,<0.20758.1688>},
                  {name,channel_sup},
                  {mfa,{rabbit_channel_sup,start_link,[]}},
                  {restart_type,temporary},
                  {shutdown,infinity},
                  {child_type,supervisor}]


thanks
--
andrea 


From oleksandr.petrov at gmail.com  Fri Oct 21 18:14:22 2011
From: oleksandr.petrov at gmail.com (Alex P)
Date: Fri, 21 Oct 2011 10:14:22 -0700 (PDT)
Subject: [rabbitmq-discuss] Rabbitmq & Expiration basic property,
 is it implemented/working and what's the format?
Message-ID: <20299252.210.1319217262265.JavaMail.geo-discussion-forums@yqhp35>

Hi, 

While working on docs for one of Rabbimq libs, I stumbled upon the 
BasicProperties, but I can't seem to find the answer for that, since all the 
information available dated last year or even a couple of years ago.

That's what's said on Rabbimq FAQ page (
https://dev.rabbitmq.com/wiki/FrequentlyAskedQuestions):
Does Rabbitmq support the expiration property on Basic.Publish? 
No, not for the 0-8 spec, because the definition is ambiguous and the format 
not clearly defined. Hopefully this will corrected in 0-9 SP1.

Is it still relevant? I couldn't find much information about that header in 
spec (unfortunately). What's the best way to handle that? If there's an 
example in any language, i'd be really happy to see it.

Thanks!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111021/0afeb870/attachment.htm>

From matthew at rabbitmq.com  Fri Oct 21 18:47:51 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 21 Oct 2011 18:47:51 +0100
Subject: [rabbitmq-discuss] Supervisor report
In-Reply-To: <1319217054.31207.2.camel@vicbristol6.hpl.hp.com>
References: <1319217054.31207.2.camel@vicbristol6.hpl.hp.com>
Message-ID: <20111021174751.GA5821@wellquite.org>

On Fri, Oct 21, 2011 at 06:10:54PM +0100, Andrea Rosa wrote:
> =SUPERVISOR REPORT==== 10-Oct-2011::14:31:35 ===
>      Supervisor: {<0.20756.1688>,
>                                            rabbit_channel_sup_sup}
>      Context:    shutdown_error
>      Reason:     shutdown
>      Offender:   [{pid,<0.20758.1688>},
>                   {name,channel_sup},
>                   {mfa,{rabbit_channel_sup,start_link,[]}},
>                   {restart_type,temporary},
>                   {shutdown,infinity},
>                   {child_type,supervisor}]

It means nothing. There was a race condition internally that could cause
this. It wasn't actually a bug - nothing was going wrong - but it could
produce this in the logs. I think we think we've fixed it, but I also
think I saw it again the other day so it's possible we've not fully
fixed it. Did you see this in 2.6.1 or some earlier version?

Matthew

From matthew at rabbitmq.com  Fri Oct 21 18:48:55 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 21 Oct 2011 18:48:55 +0100
Subject: [rabbitmq-discuss] Rabbitmq & Expiration basic property,
 is it implemented/working and what's the format?
In-Reply-To: <20299252.210.1319217262265.JavaMail.geo-discussion-forums@yqhp35>
References: <20299252.210.1319217262265.JavaMail.geo-discussion-forums@yqhp35>
Message-ID: <20111021174855.GB5821@wellquite.org>

Hi Alex,

We don't implement a per-msg expiry at all, in any version.

The closest you can get is the per-queue msg expiry timer - see
http://rabbitmq.com/extensions.html

Matthew

From rasadoll at gmail.com  Fri Oct 21 18:50:18 2011
From: rasadoll at gmail.com (rasadoll)
Date: Fri, 21 Oct 2011 10:50:18 -0700 (PDT)
Subject: [rabbitmq-discuss] Message is delivered to all queue consumers
	when rabbitmq crashes
In-Reply-To: <c40dd4c2-bd92-4738-a215-4a6b413560e7@f36g2000vbm.googlegroups.com>
References: <67adaf50-e0a7-49f2-9868-4a362ab1333e@k35g2000yqh.googlegroups.com>
	<4EA1598C.9040604@rabbitmq.com>
	<c40dd4c2-bd92-4738-a215-4a6b413560e7@f36g2000vbm.googlegroups.com>
Message-ID: <b2c1d632-f978-4439-ab75-cbc587e4c0d8@u13g2000vbx.googlegroups.com>

It's strange because I cannot reproduce it anymore. I'll post more
info if I could figure out under what circumstances it happens.
Thanks,

On Oct 21, 12:53?pm, rasadoll <rasad... at gmail.com> wrote:
> Hi Simon,
>
> This problem happens only if consumers run as separate processes (in
> different jvms). If they all run in the same jvm everything works
> fine.
>
> Thanks,
> Reza
>
> On Oct 21, 7:37?am, Simon MacMullen <si... at rabbitmq.com> wrote:
>
>
>
>
>
>
>
> > On 19/10/11 21:02, rasadoll wrote:
>
> > > I have multiple queue consumers running at the same time. They all
> > > listen to one single queue. Messages are sent to the default exchange
> > > with queue name as the routing key. When one of the consumers is busy
> > > processing a message, before acking the message if RabbitMQ service
> > > crashes (simply by stopping the service), the message is sent to all
> > > other consumers immediately which results in processing the same
> > > message multiple times concurrently. Is this the right behavior for
> > > RabbitMQ?
>
> > No. RabbitMQ should really only deliver a given message from a queue to
> > a single consumer.
>
> > I haven't been able to replicate the behaviour you describe.
>
> > Cheers, Simon
>
> > > Here is my queue design:
>
> > > Map<String, Object> ?args = new HashMap<String, Object>();
> > > args.put("x-ha-policy", "all");
> > > channel.queueDeclare(JOB_EXEC_QUEUE, true, false, false, args);
>
> > > I use durable HA queue but I am not running in a clustered
> > > environment.
> > > ===========================
> > > Message publishing:
>
> > > channel.basicPublish("", JOB_EXEC_QUEUE,
> > > MessageProperties.PERSISTENT_BASIC, message.getBytes());
> > > ===========================
> > > Consumer Code:
>
> > > channel.basicQos(1);
> > > QueueingConsumer consumer = new QueueingConsumer(channel);
> > > channel.basicConsume(JOB_EXEC_QUEUE, consumer);
>
> > > QueueingConsumer.Delivery delivery;
> > > while (true) {
> > > ? ? ? ? ?try {
> > > ? ? ? ? ? ?delivery = consumer.nextDelivery();
> > > ? ? ? ? ?} catch (InterruptedException ie) {
> > > ? ? ? ? ? ?continue;
> > > ? ? ? ? ?}
>
> > > // process the message
>
> > > ? ? ? ? channel.basicAck(delivery.getEnvelope().getDeliveryTag(),
> > > false);
> > > }
>
> > > I stop the service when one consumer is in the process message phase.
>
> > > Am I doing something wrong? Is this an expected behavior for RabbitMQ?
>
> > > Thanks,
> > > Reza
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-disc... at lists.rabbitmq.com
> > >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> > --
> > Simon MacMullen
> > RabbitMQ, VMware
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From jasonjwwilliams at gmail.com  Sat Oct 22 21:42:19 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Sat, 22 Oct 2011 14:42:19 -0600
Subject: [rabbitmq-discuss] Active-Active & Consumer Cancellation
	Notifications
Message-ID: <CAHZAEpceyA82YrUH89g-1m3cN-MQdNNuqHa4cPt5_CFxdZ8oUw@mail.gmail.com>

If a consumer attached to a mirrored queue is using a client that
doesn't support consumer cancellation notifications, will the consumer
end up with a dead connection that it thinks is live? That is if the
consumer is not attached to the node that dies, and it doesn't
understand the consumer cancellation, will it's subscription still
receive new messages after the failover event?

-J

From jvhiemer at googlemail.com  Sat Oct 22 22:08:40 2011
From: jvhiemer at googlemail.com (jhiemer)
Date: Sat, 22 Oct 2011 14:08:40 -0700 (PDT)
Subject: [rabbitmq-discuss] Limiting the number of non-ack messages cause of
	subsystem
Message-ID: <52b1c94b-b1ca-4687-90d1-eca6d99434ec@o19g2000vbk.googlegroups.com>

Hi,
I am currently facing the following situation:
My setup has a Topic Exchange, wherein all messages are stored. The
problem is: the messages consumed are limited by the backend-system.
The backend-system is only able to process 10 message at the same
time. Each of this messages is bound to a separate thread and I need
to wait for its execution until a "slot" is free again. The execution
time may vary between 10 seconds and 10 minutes. Is it reasonable to
send ACKs just after this amount of time, for acceptance of new
messages?

I am using Spring and RabbitMQ. But up to know, it would be enough for
me to know, how to solve that solely with RabbitMQ. Any ideas and
suggestions? (I am using the Java Client Library)

Thanks!

From eqbal.quran at gmail.com  Sat Oct 22 22:09:29 2011
From: eqbal.quran at gmail.com (Eki)
Date: Sat, 22 Oct 2011 14:09:29 -0700 (PDT)
Subject: [rabbitmq-discuss] How to use AMQP inside Rails ActiveRecord to
	publish some messages
Message-ID: <378f8a6a-9543-4ddb-9abd-20691a697bc0@c1g2000vbw.googlegroups.com>

Hi there,

I'm using Rails (3.0.5), Would love to know the best way to publish a
messages from inside my rails application .

To be more specific, lets say, I have a model called Bet, and I wanna
trigger the event after create a record to publish something in the
queue called test for example .

class Bet < ActiveRecord::Base

 after_create :do_some_cool_stuff

 private

 def do_some_cool_stuff
   users = User.all

   users.each do |user|
     MQ.queue("test").publish("some cool message here")
   end
 end

end

What is the best way inside rails to do that ? where to load AMQP ?
inside model ? inside Environment ? and how to use it more
efficiently ?

Thanks in advance .

From m.nacos at gmail.com  Sat Oct 22 23:32:49 2011
From: m.nacos at gmail.com (Michael Nacos)
Date: Sat, 22 Oct 2011 23:32:49 +0100
Subject: [rabbitmq-discuss] ruby amqp gem AMQP::Rebroadcaster feature
Message-ID: <CA+JR6zPxR1jkvxVD8xcUyvdLS_Qj-v82qFEQrk2fqR2e36Rpeg@mail.gmail.com>

Hi guys,

at https://leemail.me we use RabbitMQ for feeding messages to our email
processing daemons, but we'll soon need more complex workflows. A while ago
Michael suggested an AMQP::Rebroadcaster feature in the gem for easy/safe
resubmission of messages to a different queue. (
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-July/013773.html)
Has there been any progress? Is this still in the roadmap?

regards,

Michael

-- 
Want to sign up for websites without giving your email? Ask me for a leemail
.me invite.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111022/03e01e15/attachment.htm>

From matthew at rabbitmq.com  Sat Oct 22 23:39:12 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Sat, 22 Oct 2011 23:39:12 +0100
Subject: [rabbitmq-discuss] Active-Active & Consumer Cancellation
 Notifications
In-Reply-To: <CAHZAEpceyA82YrUH89g-1m3cN-MQdNNuqHa4cPt5_CFxdZ8oUw@mail.gmail.com>
References: <CAHZAEpceyA82YrUH89g-1m3cN-MQdNNuqHa4cPt5_CFxdZ8oUw@mail.gmail.com>
Message-ID: <20111022223911.GA3861@rabbitmq.com>

On Sat, Oct 22, 2011 at 02:42:19PM -0600, Jason J. W. Williams wrote:
> That is if the
> consumer is not attached to the node that dies, and it doesn't
> understand the consumer cancellation, will it's subscription still
> receive new messages after the failover event?

The connection will still be live, as will be the channel. But the
consumption will have died silently. Thus it will not get any further
messages after the fail over event. Thus clients really need to support
this extension for consumers to have a chance of coping. Pester the
author of your favourite client if they don't already support this ;)

Matthew

From matthew at rabbitmq.com  Sat Oct 22 23:42:29 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Sat, 22 Oct 2011 23:42:29 +0100
Subject: [rabbitmq-discuss] Limiting the number of non-ack messages
 cause of subsystem
In-Reply-To: <52b1c94b-b1ca-4687-90d1-eca6d99434ec@o19g2000vbk.googlegroups.com>
References: <52b1c94b-b1ca-4687-90d1-eca6d99434ec@o19g2000vbk.googlegroups.com>
Message-ID: <20111022224228.GB3861@rabbitmq.com>

On Sat, Oct 22, 2011 at 02:08:40PM -0700, jhiemer wrote:
> I am currently facing the following situation:
> My setup has a Topic Exchange, wherein all messages are stored. The
> problem is: the messages consumed are limited by the backend-system.
> The backend-system is only able to process 10 message at the same
> time. Each of this messages is bound to a separate thread and I need
> to wait for its execution until a "slot" is free again. The execution
> time may vary between 10 seconds and 10 minutes. Is it reasonable to
> send ACKs just after this amount of time, for acceptance of new
> messages?

Yes, that will be fine, but you might want to consider some other
approaches. You could cancel the consumer, then ack all of the msgs. At
that point you'll receive no further msgs. Then, when you're ready
again, recreate the consumer and grab the next 10 msgs. This will only
work effectively if you set basic.qos prefetch count to 10 also.

However, thinking about it, there may not really be much advantage
between what I'm suggesting and just delaying the acks. Especially if
you still do the basic.qos prefetch = 10 even in the ack-only version.

Matthew

From jvhiemer at googlemail.com  Sun Oct 23 10:59:25 2011
From: jvhiemer at googlemail.com (jhiemer)
Date: Sun, 23 Oct 2011 02:59:25 -0700 (PDT)
Subject: [rabbitmq-discuss] Limiting the number of non-ack messages
	cause of subsystem
In-Reply-To: <20111022224228.GB3861@rabbitmq.com>
References: <52b1c94b-b1ca-4687-90d1-eca6d99434ec@o19g2000vbk.googlegroups.com>
	<20111022224228.GB3861@rabbitmq.com>
Message-ID: <587c2f4f-7ea6-4f49-97f0-4d19a2a14bbd@j20g2000vby.googlegroups.com>

Hi Matthew,
yeah that's the other way I was thinking about. The problem is, that
there might be different execution times for each thread. So imagine
the following situation:

- 3 Threads runtime 10 seconds
- 4 Threads runtime 25 seconds
- 3 Threats runtime 200 seconds

Discarding the Consumer for the time till all the Threads are finally
executed would result in an waiting time of 200 seconds. With the ACK
approach I could automatically assign an new thread after 10 seconds.
So from your side, that would be proper way? Are there any samples for
it?

Regards Johannes

On Oct 23, 12:42?am, Matthew Sackman <matt... at rabbitmq.com> wrote:
> On Sat, Oct 22, 2011 at 02:08:40PM -0700, jhiemer wrote:
> > I am currently facing the following situation:
> > My setup has a Topic Exchange, wherein all messages are stored. The
> > problem is: the messages consumed are limited by the backend-system.
> > The backend-system is only able to process 10 message at the same
> > time. Each of this messages is bound to a separate thread and I need
> > to wait for its execution until a "slot" is free again. The execution
> > time may vary between 10 seconds and 10 minutes. Is it reasonable to
> > send ACKs just after this amount of time, for acceptance of new
> > messages?
>
> Yes, that will be fine, but you might want to consider some other
> approaches. You could cancel the consumer, then ack all of the msgs. At
> that point you'll receive no further msgs. Then, when you're ready
> again, recreate the consumer and grab the next 10 msgs. This will only
> work effectively if you set basic.qos prefetch count to 10 also.
>
> However, thinking about it, there may not really be much advantage
> between what I'm suggesting and just delaying the acks. Especially if
> you still do the basic.qos prefetch = 10 even in the ack-only version.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From gil.strauss at gmail.com  Sun Oct 23 17:03:16 2011
From: gil.strauss at gmail.com (Gil Strauss)
Date: Sun, 23 Oct 2011 09:03:16 -0700 (PDT)
Subject: [rabbitmq-discuss] Temp Queues
Message-ID: <d71a2b8e-4a2b-44b9-b711-6937e7338292@o19g2000vbk.googlegroups.com>

Hello

I'm using exchange for pub-sub method and noticed that it uses temp
queues, hence if a publisher propagates a message before a listener is
subscribing to it, the latter won't receive that message.

What I need for my application is to keep published message for a
period of time and send the to new subscriber even after the message
was originally published.

Is it doable without doing it manually programmatically?

Thanks,

Gil

From videlalvaro at gmail.com  Sun Oct 23 17:11:58 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Sun, 23 Oct 2011 18:11:58 +0200
Subject: [rabbitmq-discuss] Temp Queues
In-Reply-To: <d71a2b8e-4a2b-44b9-b711-6937e7338292@o19g2000vbk.googlegroups.com>
References: <d71a2b8e-4a2b-44b9-b711-6937e7338292@o19g2000vbk.googlegroups.com>
Message-ID: <AEBABA09-AB55-4AAF-96E6-DBB79448F3FF@gmail.com>

Hi,

When you publish to an AMQP exchange it doesn't uses "temp queues". 

An AMQP Exchange will check the bindings it has and then it will route messages to the destinations that match those bindings. So if you want that your messages to go somewhere then you need to have queues bound to the exchange _before_ you publish messages through it.

See http://docs.redhat.com/docs/en-US/Red_Hat_Enterprise_MRG/1.3/html-single/Messaging_User_Guide/images/producer-consumer.png

So if you have exchanges but you don't have any queues bound to it, then the exchange will act as a black hole for the messages you publish through it.

Cheers,

Alvaro

On Oct 23, 2011, at 6:03 PM, Gil Strauss wrote:

> Hello
> 
> I'm using exchange for pub-sub method and noticed that it uses temp
> queues, hence if a publisher propagates a message before a listener is
> subscribing to it, the latter won't receive that message.
> 
> What I need for my application is to keep published message for a
> period of time and send the to new subscriber even after the message
> was originally published.
> 
> Is it doable without doing it manually programmatically?
> 
> Thanks,
> 
> Gil
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

Sent form my Nokia 1100




From gil.strauss at gmail.com  Sun Oct 23 19:31:09 2011
From: gil.strauss at gmail.com (Gil Strauss)
Date: Sun, 23 Oct 2011 11:31:09 -0700 (PDT)
Subject: [rabbitmq-discuss] Temp Queues
In-Reply-To: <AEBABA09-AB55-4AAF-96E6-DBB79448F3FF@gmail.com>
References: <d71a2b8e-4a2b-44b9-b711-6937e7338292@o19g2000vbk.googlegroups.com>
	<AEBABA09-AB55-4AAF-96E6-DBB79448F3FF@gmail.com>
Message-ID: <914b51ba-a2f7-42c0-b3c2-f7cc28b56490@m1g2000vbm.googlegroups.com>

Hi

Thank you for the very quick reply.

I ran the following scenario:

On publisher:
1.
    channel.exchangeDeclare(exchangeName, "direct")

    val queueName = channel.queueDeclare().getQueue()

    channel.queueBind(queueName, exchangeName, routingKey)
2.
 Publish message

3.
On subscriber:
    channel.exchangeDeclare(exchangeName, "direct")

    val queueName = channel.queueDeclare().getQueue()

    channel.queueBind(queueName, exchangeName, routingKey)

4.
Result: Subscriber is not getting the message

On the other hand, if I do 3 and only then 1 and 2: the subscriber is
getting the message.

So the questions are:
a. Am I doing something wrong
b. How can I ensure that the subscriber gets the message even if it
was published before it subscribed to it?

Thanks again.

Gil






On Oct 23, 6:11?pm, Alvaro Videla <videlalv... at gmail.com> wrote:
> Hi,
>
> When you publish to an AMQP exchange it doesn't uses "temp queues".
>
> An AMQP Exchange will check the bindings it has and then it will route messages to the destinations that match those bindings. So if you want that your messages to go somewhere then you need to have queues bound to the exchange _before_ you publish messages through it.
>
> Seehttp://docs.redhat.com/docs/en-US/Red_Hat_Enterprise_MRG/1.3/html-sin...
>
> So if you have exchanges but you don't have any queues bound to it, then the exchange will act as a black hole for the messages you publish through it.
>
> Cheers,
>
> Alvaro
>
> On Oct 23, 2011, at 6:03 PM, Gil Strauss wrote:
>
>
>
>
>
>
>
>
>
> > Hello
>
> > I'm using exchange for pub-sub method and noticed that it uses temp
> > queues, hence if a publisher propagates a message before a listener is
> > subscribing to it, the latter won't receive that message.
>
> > What I need for my application is to keep published message for a
> > period of time and send the to new subscriber even after the message
> > was originally published.
>
> > Is it doable without doing it manually programmatically?
>
> > Thanks,
>
> > Gil
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> Sent form my Nokia 1100
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From videlalvaro at gmail.com  Sun Oct 23 19:36:46 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Sun, 23 Oct 2011 20:36:46 +0200
Subject: [rabbitmq-discuss] Temp Queues
In-Reply-To: <914b51ba-a2f7-42c0-b3c2-f7cc28b56490@m1g2000vbm.googlegroups.com>
References: <d71a2b8e-4a2b-44b9-b711-6937e7338292@o19g2000vbk.googlegroups.com>
	<AEBABA09-AB55-4AAF-96E6-DBB79448F3FF@gmail.com>
	<914b51ba-a2f7-42c0-b3c2-f7cc28b56490@m1g2000vbm.googlegroups.com>
Message-ID: <C8CB86D1-6FD0-4FCF-83AE-D77D8B2A02EC@gmail.com>

Hi,

I don't know which client are you using but this call: 

> val queueName = channel.queueDeclare().getQueue()


On the subscriber suggests that you are creating a new queue. So that queue won't have the message sent by the publisher.

Make sure you are declaring the same queue on both sides.

Cheers,

Alvaro

From gil.strauss at gmail.com  Sun Oct 23 19:45:48 2011
From: gil.strauss at gmail.com (Gil Strauss)
Date: Sun, 23 Oct 2011 11:45:48 -0700 (PDT)
Subject: [rabbitmq-discuss] Temp Queues
In-Reply-To: <C8CB86D1-6FD0-4FCF-83AE-D77D8B2A02EC@gmail.com>
References: <d71a2b8e-4a2b-44b9-b711-6937e7338292@o19g2000vbk.googlegroups.com>
	<AEBABA09-AB55-4AAF-96E6-DBB79448F3FF@gmail.com>
	<914b51ba-a2f7-42c0-b3c2-f7cc28b56490@m1g2000vbm.googlegroups.com>
	<C8CB86D1-6FD0-4FCF-83AE-D77D8B2A02EC@gmail.com>
Message-ID: <c7d31abb-86e8-4d6d-8c77-15de6e8457c5@v15g2000vbm.googlegroups.com>


I'm using the same Java client as the one being used in the tutorials.

How can I get a reference in the client to the queue I've published
the message to?


Thanks,

Gil

On Oct 23, 8:36?pm, Alvaro Videla <videlalv... at gmail.com> wrote:
> Hi,
>
> I don't know which client are you using but this call:
>
> > val queueName = channel.queueDeclare().getQueue()
>
> On the subscriber suggests that you are creating a new queue. So that queue won't have the message sent by the publisher.
>
> Make sure you are declaring the same queue on both sides.
>
> Cheers,
>
> Alvaro
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From michael.s.klishin at gmail.com  Sun Oct 23 22:29:13 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 24 Oct 2011 00:29:13 +0300
Subject: [rabbitmq-discuss] ruby amqp gem AMQP::Rebroadcaster feature
In-Reply-To: <CA+JR6zPxR1jkvxVD8xcUyvdLS_Qj-v82qFEQrk2fqR2e36Rpeg@mail.gmail.com>
References: <CA+JR6zPxR1jkvxVD8xcUyvdLS_Qj-v82qFEQrk2fqR2e36Rpeg@mail.gmail.com>
Message-ID: <CAE3HoVSb_jUbW_DhqTy6oaY0jvcWxinUAMrxjFRbDgzT_aM11A@mail.gmail.com>

2011/10/23 Michael Nacos <m.nacos at gmail.com>

> Has there been any progress? Is this still in the roadmap?


I don't mind adding this but in practice exchange-to-exchange bindings [1]
is a better solution. So I think support for that will come first.

1. http://www.rabbitmq.com/extensions.html#exchange-bindings

-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111024/b80129f8/attachment.htm>

From michael.s.klishin at gmail.com  Sun Oct 23 22:31:09 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 24 Oct 2011 00:31:09 +0300
Subject: [rabbitmq-discuss] How to use AMQP inside Rails ActiveRecord to
 publish some messages
In-Reply-To: <378f8a6a-9543-4ddb-9abd-20691a697bc0@c1g2000vbw.googlegroups.com>
References: <378f8a6a-9543-4ddb-9abd-20691a697bc0@c1g2000vbw.googlegroups.com>
Message-ID: <CAE3HoVRhHBM2Q4BaDgrS6X3t+MnSdQOzcSbUBxq4ONMvOj6KNQ@mail.gmail.com>

2011/10/23 Eki <eqbal.quran at gmail.com>

> To be more specific, lets say, I have a model called Bet, and I wanna
> trigger the event after create a record to publish something in the
> queue called test for example
>

You need to connect to the broker when your app boots and then use a shared
(or not) AMQP::Exchange instance.

See
http://rdoc.info/github/ruby-amqp/amqp/master/file/docs/ConnectingToTheBroker.textile
,
http://rdoc.info/github/ruby-amqp/amqp/master/file/docs/GettingStarted.textile#Integration_with_objects

and https://github.com/michaelklishin/rubyonrails23_unicorn_amqp_gem_example

-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111024/4d4cd397/attachment.htm>

From pavankumar.manikonda at schneider-electric.com  Mon Oct 24 07:53:56 2011
From: pavankumar.manikonda at schneider-electric.com (pavuuu)
Date: Sun, 23 Oct 2011 23:53:56 -0700 (PDT)
Subject: [rabbitmq-discuss] BrokerUnrechableException after sending
 16366 messages
In-Reply-To: <4EA18E4F.7000205@rabbitmq.com>
References: <32695317.post@talk.nabble.com> <4EA1578A.70806@rabbitmq.com>
	<CAJreXKDSRF5hcYs3dn4ES+uL3k_aR=N5xawQu+vQpeZkEhu-Ww@mail.gmail.com>
	<4EA18E4F.7000205@rabbitmq.com>
Message-ID: <32708315.post@talk.nabble.com>


Reusing the open connections on client side solved my issue. 

Thanks guys... :)

Does it mean that server doesn't close the connection immediately after it
has been used ??


Simon MacMullen-2 wrote:
> 
> On 21/10/11 16:14, James Carr wrote:
>> One "newb" mistake I often see when devs are initially testing out our
>> dev cluster is they open a connection for each message they send
>> rather than opening one connection and re-using it.  This will quickly
>> use up all the connections on the box and rabbitmq will begin refusing
>> additional requests to connect.
> 
> You should be fine of course as long as you are *closing* those 
> connections too. RabbitMQ will only refuse connections when you have too 
> many active ones.
> 
> But.
> 
> If you churn through connections at a frantic rate, you can get into a 
> state where the entire *client* box can't make outgoing connections for 
> a while, as all your ports in the ephemeral port range still have the 
> remains of an old connection sitting there in the TCP_WAIT state.
> 
> If you run into this it's usually a sign that you should be a bit more 
> economical with connections (to put it mildly), but on Linux at least 
> you can work around it with:
> 
> # echo "1" >/proc/sys/net/ipv4/tcp_tw_reuse
> # echo "1" >/proc/sys/net/ipv4/tcp_tw_recycle
> 
> Cheers, Simon
> 
> -- 
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://old.nabble.com/BrokerUnrechableException-after-sending-16366-messages-tp32695317p32708315.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From m.nacos at gmail.com  Mon Oct 24 08:28:13 2011
From: m.nacos at gmail.com (Michael Nacos)
Date: Mon, 24 Oct 2011 08:28:13 +0100
Subject: [rabbitmq-discuss] ruby amqp gem AMQP::Rebroadcaster feature
In-Reply-To: <CAE3HoVSb_jUbW_DhqTy6oaY0jvcWxinUAMrxjFRbDgzT_aM11A@mail.gmail.com>
References: <CA+JR6zPxR1jkvxVD8xcUyvdLS_Qj-v82qFEQrk2fqR2e36Rpeg@mail.gmail.com>
	<CAE3HoVSb_jUbW_DhqTy6oaY0jvcWxinUAMrxjFRbDgzT_aM11A@mail.gmail.com>
Message-ID: <CA+JR6zPNBse2gw6sxcXm-CoZj37Ttd=HzgbdBGBfWZZ+G_t8=w@mail.gmail.com>

exchange-to-exchange bindings are great for complex topic routing -- but
this assumes the routing key for each message is (a) decided on entry and
(b) stays the same throughout a message's flow through the system.

so, what happens if a consumer needs to affect a particular message's route?
e.g. to reinject/rebroadcast invalid/malformed/unauthorized messages into a
different queue/pipeline. Sure, it could change the routing key, but it'd
still need to rebroadcast/reinject, right?

is this kind of flow so exotic? I'd imagine it's a pretty common scenario.

Michael

On 23 October 2011 22:29, Michael Klishin <michael.s.klishin at gmail.com>wrote:

> 2011/10/23 Michael Nacos <m.nacos at gmail.com>
>
>> Has there been any progress? Is this still in the roadmap?
>
>
> I don't mind adding this but in practice exchange-to-exchange bindings [1]
> is a better solution. So I think support for that will come first.
>
> 1. http://www.rabbitmq.com/extensions.html#exchange-bindings
>
> --
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>



-- 
Want to sign up for websites without giving your email? Ask me for a leemail
.me invite.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111024/6260d8a1/attachment.htm>

From andrea.rosa at hp.com  Mon Oct 24 09:31:22 2011
From: andrea.rosa at hp.com (Rosa, Andrea)
Date: Mon, 24 Oct 2011 08:31:22 +0000
Subject: [rabbitmq-discuss] Supervisor report
In-Reply-To: <20111021174751.GA5821@wellquite.org>
References: <1319217054.31207.2.camel@vicbristol6.hpl.hp.com>
	<20111021174751.GA5821@wellquite.org>
Message-ID: <5F389C517756284F80239F55BCA5DDDD17BB4B7D@G9W0721.americas.hpqcorp.net>

Hi Matthew

> 
> It means nothing. There was a race condition internally that could
> cause
> this. It wasn't actually a bug - nothing was going wrong - but it could
> produce this in the logs. I think we think we've fixed it, but I also
> think I saw it again the other day so it's possible we've not fully
> fixed it. Did you see this in 2.6.1 or some earlier version?

I saw this in 2.5.1 version.
Cheers
--
Andrea 

> 
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simon at rabbitmq.com  Mon Oct 24 10:35:28 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 24 Oct 2011 10:35:28 +0100
Subject: [rabbitmq-discuss] BrokerUnrechableException after sending
 16366 messages
In-Reply-To: <32708315.post@talk.nabble.com>
References: <32695317.post@talk.nabble.com>
	<4EA1578A.70806@rabbitmq.com>	<CAJreXKDSRF5hcYs3dn4ES+uL3k_aR=N5xawQu+vQpeZkEhu-Ww@mail.gmail.com>	<4EA18E4F.7000205@rabbitmq.com>
	<32708315.post@talk.nabble.com>
Message-ID: <4EA53160.60306@rabbitmq.com>

On 24/10/11 07:53, pavuuu wrote:
> Does it mean that server doesn't close the connection immediately after it
> has been used ??

It will. But check the TIME-WAIT thing. (Oops, said TCP_WAIT earlier, typo).

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Mon Oct 24 10:51:23 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 24 Oct 2011 10:51:23 +0100
Subject: [rabbitmq-discuss] Temp Queues
In-Reply-To: <914b51ba-a2f7-42c0-b3c2-f7cc28b56490@m1g2000vbm.googlegroups.com>
References: <d71a2b8e-4a2b-44b9-b711-6937e7338292@o19g2000vbk.googlegroups.com>	<AEBABA09-AB55-4AAF-96E6-DBB79448F3FF@gmail.com>
	<914b51ba-a2f7-42c0-b3c2-f7cc28b56490@m1g2000vbm.googlegroups.com>
Message-ID: <4EA5351B.9060903@rabbitmq.com>

On 23/10/11 19:31, Gil Strauss wrote:
> On publisher:
> 1.
>      channel.exchangeDeclare(exchangeName, "direct")
>
>      val queueName = channel.queueDeclare().getQueue()
>
>      channel.queueBind(queueName, exchangeName, routingKey)

The zero-args version of queueDeclare() creates a server-named exclusive 
queue - this is one that is owned by the connection and will be deleted 
when it is closed.

Here you are declaring such an exclusive queue and then binding it in 
your publisher - if you are only going to publish then you don't need to 
do this.

> 2.
>   Publish message
>
> 3.
> On subscriber:
>      channel.exchangeDeclare(exchangeName, "direct")
>
>      val queueName = channel.queueDeclare().getQueue()
>
>      channel.queueBind(queueName, exchangeName, routingKey)
>
> 4.
> Result: Subscriber is not getting the message
>
> On the other hand, if I do 3 and only then 1 and 2: the subscriber is
> getting the message.
>
> So the questions are:
> a. Am I doing something wrong
> b. How can I ensure that the subscriber gets the message even if it
> was published before it subscribed to it?

The queue must exist before the message is published to it. You'll want 
to create queues which are non-exclusive and probably durable, and 
probably have your subscribers create names for them so they always 
connect to the same one (alternately have each subscriber declare a 
server-named queue the first time it starts up, then stash the name 
somewhere so it can connect again later).

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From majek04 at gmail.com  Mon Oct 24 10:56:18 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Mon, 24 Oct 2011 10:56:18 +0100
Subject: [rabbitmq-discuss] RabbitMQ basic.get and acknowledgement
In-Reply-To: <CABzX+qzhhx2Bre_=J9ysf5i=LYOMhnZ+dfu_GWpK-bBSbaf8rg@mail.gmail.com>
References: <b1cab362-594b-4c6a-83b9-326e802f3e9e@p1g2000yqk.googlegroups.com>
	<CABzX+qxweYEWLcmPFLwk+=FaMW2UR-MiR+wVC8g_47cARfbu+w@mail.gmail.com>
	<CACGcny8YfjTMuX7-VNNCo7gLBtb4BH9EW_719EOXiLKWq7Maig@mail.gmail.com>
	<CABzX+qwXpsVU0MKjYW+ckv50OQgXMrj1ye2sep3AoZhGP2rsFA@mail.gmail.com>
	<CACGcny9GZzBjrR814kEQZ8vSeh6JadxLqnShM0V2S9f2Acf0Gw@mail.gmail.com>
	<CABzX+qzhhx2Bre_=J9ysf5i=LYOMhnZ+dfu_GWpK-bBSbaf8rg@mail.gmail.com>
Message-ID: <CABzX+qxsW-SSYjRBnZViObEhiF9taJpRBqHL3Q1b5AuZiYYsHQ@mail.gmail.com>

On Fri, Oct 21, 2011 at 15:57, Marek Majkowski <majek04 at gmail.com> wrote:
> On Fri, Oct 21, 2011 at 15:39, Bozhidar Bozhanov
> <bozhidar.bozhanov at gmail.com> wrote:
>> That one I figured out myself :) but what could it be, given default
>> setup, and the above code?
>
> There is not much to be said about given code.
> Can you supply us with a runnable code?

Bozhidar,

Were you able to locate the problem?

If not, let me elaborate my previous email :)

Take a look at the this tutorial:
    http://www.rabbitmq.com/tutorials/tutorial-two-python.html
    https://github.com/rabbitmq/rabbitmq-tutorials/blob/master/python/worker.py

Although it doesn't use `basic.get` (it uses `basic.consume`) and it
uses `basic.ack`.

Here is an example with `basic.get`:
   https://github.com/pika/pika/blob/master/examples/blocking/demo_get.py

This examples do work.

In order to help you we need to see a wider context of your
app. It would be great if you could reduce your app
to few dozen lines and supply us with the code. Only
then we would be able to give you a hand.

Cheers,
   Marek

From mejozn at 163.com  Mon Oct 24 10:19:26 2011
From: mejozn at 163.com (=?GBK?Q?=5F-=5E=C3=F7_z--?=)
Date: Mon, 24 Oct 2011 17:19:26 +0800 (CST)
Subject: [rabbitmq-discuss] about server start
Message-ID: <4292ad5a.11d1e.133353a3274.Coremail.mejozn@163.com>

Hello,I am start the rabbitmq-server in my centos5.6 , when i execute rabbitmq-server script(without add  -detached argument) ,the script stop here "0 plugins activated", i must type 'Ctrl+C' , the script go on execute ..... ,why??
Picture1.  execute ./rabbitmq-server ,always stop here  .

Picture2 . type 'Ctrl+C' abort ,then the rabbitmq-server go on ....



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111024/eba325eb/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 1.jpg
Type: image/jpeg
Size: 14291 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111024/eba325eb/attachment.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 2.jpg
Type: image/jpeg
Size: 30015 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111024/eba325eb/attachment-0001.jpg>

From bozhidar.bozhanov at gmail.com  Mon Oct 24 11:13:47 2011
From: bozhidar.bozhanov at gmail.com (Bozhidar Bozhanov)
Date: Mon, 24 Oct 2011 13:13:47 +0300
Subject: [rabbitmq-discuss] RabbitMQ basic.get and acknowledgement
In-Reply-To: <CABzX+qxsW-SSYjRBnZViObEhiF9taJpRBqHL3Q1b5AuZiYYsHQ@mail.gmail.com>
References: <b1cab362-594b-4c6a-83b9-326e802f3e9e@p1g2000yqk.googlegroups.com>
	<CABzX+qxweYEWLcmPFLwk+=FaMW2UR-MiR+wVC8g_47cARfbu+w@mail.gmail.com>
	<CACGcny8YfjTMuX7-VNNCo7gLBtb4BH9EW_719EOXiLKWq7Maig@mail.gmail.com>
	<CABzX+qwXpsVU0MKjYW+ckv50OQgXMrj1ye2sep3AoZhGP2rsFA@mail.gmail.com>
	<CACGcny9GZzBjrR814kEQZ8vSeh6JadxLqnShM0V2S9f2Acf0Gw@mail.gmail.com>
	<CABzX+qzhhx2Bre_=J9ysf5i=LYOMhnZ+dfu_GWpK-bBSbaf8rg@mail.gmail.com>
	<CABzX+qxsW-SSYjRBnZViObEhiF9taJpRBqHL3Q1b5AuZiYYsHQ@mail.gmail.com>
Message-ID: <CACGcny_1f293hFw6PtNcZN7rDyGwN1cWGJsptg0UiVZcs7wOfQ@mail.gmail.com>

Yes. It turned out spring-amqp closes the channel on each operation, and
that automatically rejects messages.
On Oct 24, 2011 12:56 PM, "Marek Majkowski" <majek04 at gmail.com> wrote:

> On Fri, Oct 21, 2011 at 15:57, Marek Majkowski <majek04 at gmail.com> wrote:
> > On Fri, Oct 21, 2011 at 15:39, Bozhidar Bozhanov
> > <bozhidar.bozhanov at gmail.com> wrote:
> >> That one I figured out myself :) but what could it be, given default
> >> setup, and the above code?
> >
> > There is not much to be said about given code.
> > Can you supply us with a runnable code?
>
> Bozhidar,
>
> Were you able to locate the problem?
>
> If not, let me elaborate my previous email :)
>
> Take a look at the this tutorial:
>    http://www.rabbitmq.com/tutorials/tutorial-two-python.html
>
> https://github.com/rabbitmq/rabbitmq-tutorials/blob/master/python/worker.py
>
> Although it doesn't use `basic.get` (it uses `basic.consume`) and it
> uses `basic.ack`.
>
> Here is an example with `basic.get`:
>   https://github.com/pika/pika/blob/master/examples/blocking/demo_get.py
>
> This examples do work.
>
> In order to help you we need to see a wider context of your
> app. It would be great if you could reduce your app
> to few dozen lines and supply us with the code. Only
> then we would be able to give you a hand.
>
> Cheers,
>   Marek
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111024/3727046a/attachment.htm>

From majek04 at gmail.com  Mon Oct 24 11:31:56 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Mon, 24 Oct 2011 11:31:56 +0100
Subject: [rabbitmq-discuss] about server start
In-Reply-To: <4292ad5a.11d1e.133353a3274.Coremail.mejozn@163.com>
References: <4292ad5a.11d1e.133353a3274.Coremail.mejozn@163.com>
Message-ID: <CABzX+qyRJe284ypxpYo7V2T=SpYeHEsGm93p-0HAZsoGYENinw@mail.gmail.com>

2011/10/24 _-^? z-- <mejozn at 163.com>
>
> Hello,I am start the rabbitmq-server in my centos5.6 , when i execute rabbitmq-server script(without add ?-detached argument) ,the script stop here "0 plugins activated", i must type 'Ctrl+C' , the script go on execute ..... ,why??

`rabbitmq-server` command is a bash script that is responsible for
running Erlang virtual machine.

What you see is a erlang vm behaviour. It's actually pretty cool, try typing
something like
> 5 + 2.
or
> io:format("asd~n").

Yes... This is an interactive prompt.

Although in most situations you don't need it. That's why -detached option
allows you to run the vm in the background.

Generally, you shouldn't need to run `rabbitmq-server`. You should
use packaged rabbitmq server release and let your operating
system to run and manage it.
On linux startup and stop is often managed by
/etc/init.d/rabbitmq-server script.

Hope that helps.

Cheers,
   Marek

From majek04 at gmail.com  Mon Oct 24 12:01:58 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Mon, 24 Oct 2011 12:01:58 +0100
Subject: [rabbitmq-discuss] about server start
In-Reply-To: <CABzX+qyRJe284ypxpYo7V2T=SpYeHEsGm93p-0HAZsoGYENinw@mail.gmail.com>
References: <4292ad5a.11d1e.133353a3274.Coremail.mejozn@163.com>
	<CABzX+qyRJe284ypxpYo7V2T=SpYeHEsGm93p-0HAZsoGYENinw@mail.gmail.com>
Message-ID: <CABzX+qwW23QCTrM7YocxfxaYEWfeOVTpwYMX0wx5GeXG5eiw4A@mail.gmail.com>

On Mon, Oct 24, 2011 at 11:31, Marek Majkowski <majek04 at gmail.com> wrote:
> 2011/10/24 _-^? z-- <mejozn at 163.com>
>>
>> Hello,I am start the rabbitmq-server in my centos5.6 , when i execute rabbitmq-server script(without add ?-detached argument) ,the script stop here "0 plugins activated", i must type 'Ctrl+C' , the script go on execute ..... ,why??

Right, I answered the wrong question. Let me try again.

`rabbitmq-server` runs erlang interpreter twice. First as
'prelaunch' and later usual 'rabbitmq' stuff.

What you see is an erlang getting stuck at first run.

This is quite weird. It shouldn't happen. My gut feeling is that
you have something wrong with epmd/dns/hostname settings.

Are you able to run $ ping `hostname` command?

Take a look here: http://cms02.phys.ntu.edu.tw/tracs/env/ticket/317

Cheers,
  Marek

From pavankumar.manikonda at schneider-electric.com  Mon Oct 24 12:51:35 2011
From: pavankumar.manikonda at schneider-electric.com (pavuuu)
Date: Mon, 24 Oct 2011 04:51:35 -0700 (PDT)
Subject: [rabbitmq-discuss] asynchronous fetching messages from rabbitMQ
 queues
Message-ID: <32709671.post@talk.nabble.com>


Is it possible to fetch messages asynchronously from rabbitMQ queues ?

Colz when I do two consecutive BasicConsume's on any particular queue, I get
the same message twice.

If I have to fetch the first two messages, I have to do

BasicConsume -- BasicAck -- BasicConsume -- BasicAck


Also, will the client library supports fetching, say top 100, messages of
any particular queue. ?
-- 
View this message in context: http://old.nabble.com/asynchronous-fetching-messages-from-rabbitMQ-queues-tp32709671p32709671.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From matthew at rabbitmq.com  Mon Oct 24 13:57:38 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 24 Oct 2011 13:57:38 +0100
Subject: [rabbitmq-discuss] asynchronous fetching messages from rabbitMQ
 queues
In-Reply-To: <32709671.post@talk.nabble.com>
References: <32709671.post@talk.nabble.com>
Message-ID: <20111024125737.GA4565@rabbitmq.com>

On Mon, Oct 24, 2011 at 04:51:35AM -0700, pavuuu wrote:
> Is it possible to fetch messages asynchronously from rabbitMQ queues ?

Yes. Basic.consume will deliver msgs asynchronously to the client.

> Colz when I do two consecutive BasicConsume's on any particular queue, I get
> the same message twice.

Please provide code that demonstrates this - this should not happen.
Multiple basic.consumes on the _same_ queue will make the queue deliver
each message to one consumer (in the absence of requeuings).

> If I have to fetch the first two messages, I have to do
> 
> BasicConsume -- BasicAck -- BasicConsume -- BasicAck

No.

BasicConsume -> BasicDeliver -> BasicAck -> BasicDeliver -> BasicAck ...

> Also, will the client library supports fetching, say top 100, messages of
> any particular queue. ?

Yes, you want want to use basic.qos and set the msg prefetch count to
100.

Matthew

From slfritchie at snookles.com  Mon Oct 24 19:20:45 2011
From: slfritchie at snookles.com (Scott Lystig Fritchie)
Date: Mon, 24 Oct 2011 13:20:45 -0500
Subject: [rabbitmq-discuss] DTrace and Erlang: an update
Message-ID: <32803.1319480445@snookles.snookles.com>

Hi, all.  I've been a lurker on this list since January 2009.  I thought
it might be time to post something.

I've been working with Dustin Sallings and Michal Ptaszek to expand the
work that they've done on adding DTrace probes to the Erlang virtual
machine.  We have started preliminary, *informal*, **no-promises-yet**
talks with Ericsson's OTP team.  Our goal (and not yet the OTP team's, I
*cannot* speak for them) is to get these probes & NIF code into the R15
release cycle.

I'll be speaking about this DTrace work at the Erlang User Conference in
Stockholm, Sweden on Thursday, November 4th.  If you're going to be at
the EUC and you're interested in DTrace, I'd love to talk to you.  If
you have a war story about RabbitMQ that you'd like me to share at the
EUC (perhaps as part of my presentation), please contact me directly.
FWIW, I'll also be attending the tutorial & hack-a-thon day on Friday
05 November.

If you like DTrace but you're not going to be at EUC, then ... I'd like
to start some email correspondence.  Specifically, what do you need to
make RabbitMQ's workings visible to the outside world via DTrace?

If we actually meet our goal of getting the probes + NIF into the
official R15 source distribution ... then the evolution of the probes
will probably be slow.  Why?  Because it'll be tied to Ericsson's
release schedule.  The more input we get from users of *real* apps
(RabbitMQ, Riak, Ejabberd, et al.) now, the better the initial probes
will be, and the fewer iterations it will take to make them "perfect".

-Scott

P.S.  Sorry like sounding like a telethon fundraiser.  ("We need your
pledge of support *now*.")  But the Erlang/OTP R15 release schedule is
Ericsson's, not mine.  If we want full support for this DTrace work, we
need to play by Ericsson's rules and schedules.

P.P.S. Here's a summary of recent coding developments:

A list of the probes now available is at:

    https://github.com/slfritchie/otp/blob/dtrace-experiment+michal2/erts/emulator/beam/erlang_dtrace.d

... and a set of small example D scripts:

    https://github.com/slfritchie/otp/tree/dtrace-experiment+michal2/lib/dtrace/examples

In addition, I've added a NIF that allows Erlang code to trigger a
probe.  See the EDoc comments at the top of this source file for some
background:

    https://github.com/slfritchie/otp/blob/dtrace-experiment+michal2/lib/dtrace/src/dtrace.erl

I've created a "shar"-like shell script that will automagically patch
your otp_src_R14B04.tar.gz source tarball with all this DTrace stuff.
See here for details:

    http://erlang.org/pipermail/erlang-questions/2011-October/061933.html

Over the weekend, I added the ability to trace the "sequential trace
token" via DTrace.  That work isn't available in the patch above, but it
is available if you wish by checking out the underlying repo from
GitHub, git://github.com/slfritchie/otp.git, and using the
"dtrace-experiment+michal2" branch.


From jasonjwwilliams at gmail.com  Mon Oct 24 19:30:27 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Mon, 24 Oct 2011 12:30:27 -0600
Subject: [rabbitmq-discuss] DTrace and Erlang: an update
In-Reply-To: <32803.1319480445@snookles.snookles.com>
References: <32803.1319480445@snookles.snookles.com>
Message-ID: <CAHZAEpeVJv_RBCB-mwx+oKA=wxGG5J4YRGZ02mQYth8DEevKXA@mail.gmail.com>

Hi Scott,

This would be awesome. It would be great to be able to get better
visibility into Rabbit via DTrace. We'd be using the probes on
OpenIndiana.

-J

On Mon, Oct 24, 2011 at 12:20 PM, Scott Lystig Fritchie
<slfritchie at snookles.com> wrote:
> Hi, all. ?I've been a lurker on this list since January 2009. ?I thought
> it might be time to post something.
>
> I've been working with Dustin Sallings and Michal Ptaszek to expand the
> work that they've done on adding DTrace probes to the Erlang virtual
> machine. ?We have started preliminary, *informal*, **no-promises-yet**
> talks with Ericsson's OTP team. ?Our goal (and not yet the OTP team's, I
> *cannot* speak for them) is to get these probes & NIF code into the R15
> release cycle.
>
> I'll be speaking about this DTrace work at the Erlang User Conference in
> Stockholm, Sweden on Thursday, November 4th. ?If you're going to be at
> the EUC and you're interested in DTrace, I'd love to talk to you. ?If
> you have a war story about RabbitMQ that you'd like me to share at the
> EUC (perhaps as part of my presentation), please contact me directly.
> FWIW, I'll also be attending the tutorial & hack-a-thon day on Friday
> 05 November.
>
> If you like DTrace but you're not going to be at EUC, then ... I'd like
> to start some email correspondence. ?Specifically, what do you need to
> make RabbitMQ's workings visible to the outside world via DTrace?
>
> If we actually meet our goal of getting the probes + NIF into the
> official R15 source distribution ... then the evolution of the probes
> will probably be slow. ?Why? ?Because it'll be tied to Ericsson's
> release schedule. ?The more input we get from users of *real* apps
> (RabbitMQ, Riak, Ejabberd, et al.) now, the better the initial probes
> will be, and the fewer iterations it will take to make them "perfect".
>
> -Scott
>
> P.S. ?Sorry like sounding like a telethon fundraiser. ?("We need your
> pledge of support *now*.") ?But the Erlang/OTP R15 release schedule is
> Ericsson's, not mine. ?If we want full support for this DTrace work, we
> need to play by Ericsson's rules and schedules.
>
> P.P.S. Here's a summary of recent coding developments:
>
> A list of the probes now available is at:
>
> ? ?https://github.com/slfritchie/otp/blob/dtrace-experiment+michal2/erts/emulator/beam/erlang_dtrace.d
>
> ... and a set of small example D scripts:
>
> ? ?https://github.com/slfritchie/otp/tree/dtrace-experiment+michal2/lib/dtrace/examples
>
> In addition, I've added a NIF that allows Erlang code to trigger a
> probe. ?See the EDoc comments at the top of this source file for some
> background:
>
> ? ?https://github.com/slfritchie/otp/blob/dtrace-experiment+michal2/lib/dtrace/src/dtrace.erl
>
> I've created a "shar"-like shell script that will automagically patch
> your otp_src_R14B04.tar.gz source tarball with all this DTrace stuff.
> See here for details:
>
> ? ?http://erlang.org/pipermail/erlang-questions/2011-October/061933.html
>
> Over the weekend, I added the ability to trace the "sequential trace
> token" via DTrace. ?That work isn't available in the patch above, but it
> is available if you wish by checking out the underlying repo from
> GitHub, git://github.com/slfritchie/otp.git, and using the
> "dtrace-experiment+michal2" branch.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From jerryk at vmware.com  Mon Oct 24 19:50:47 2011
From: jerryk at vmware.com (Jerry Kuch)
Date: Mon, 24 Oct 2011 11:50:47 -0700 (PDT)
Subject: [rabbitmq-discuss] DTrace and Erlang: an update
In-Reply-To: <32803.1319480445@snookles.snookles.com>
Message-ID: <0b4cd3e0-41d1-405d-a199-86e1033360d3@CoachZ.local>

Hi, Scott... 



I've been working with Dustin Sallings and Michal Ptaszek to expand the 
work that they've done on adding DTrace probes to the Erlang virtual 
machine. We have started preliminary, *informal*, **no-promises-yet** 
talks with Ericsson's OTP team. Our goal (and not yet the OTP team's, I 
*cannot* speak for them) is to get these probes & NIF code into the R15 
release cycle. 

I've recently started messing with DTrace on Erlang/OTP in the context of 
RabbitMQ performance and am very interested in learning more about what 
you're doing. 


I'll be speaking about this DTrace work at the Erlang User Conference in 
Stockholm, Sweden on Thursday, November 4th. If you're going to be at 
the EUC and you're interested in DTrace, I'd love to talk to you. If 
you have a war story about RabbitMQ that you'd like me to share at the 
EUC (perhaps as part of my presentation), please contact me directly. 
FWIW, I'll also be attending the tutorial & hack-a-thon day on Friday 
05 November. 

Alas, I'm in North America and won't be there... will your presentation be 
recorded and put on the web afterward? 


If you like DTrace but you're not going to be at EUC, then ... I'd like 
to start some email correspondence. Specifically, what do you need to 
make RabbitMQ's workings visible to the outside world via DTrace? 

Great... I've just recently returned to the perf stuff after some product launch 
related turbulence that had vacuumed my attention entirely away from it. I'm 
currently messing around with the OTP fork that's on Github and trying to get 
a sense for what the existing family of probes can tell me about Rabbit behavior. 
I'm also sort of learning how to use DTrace in a grown-up manner as I go, so 
it's likely that my intuition for what is possible and what should be attempted 
is very poorly honed at this point. 


If we actually meet our goal of getting the probes + NIF into the 
official R15 source distribution ... then the evolution of the probes 
will probably be slow. Why? Because it'll be tied to Ericsson's 
release schedule. The more input we get from users of *real* apps 
(RabbitMQ, Riak, Ejabberd, et al.) now, the better the initial probes 
will be, and the fewer iterations it will take to make them "perfect". 

Are you up for phone or Skype chat on this sometime in the next week or so? 
I'd be curious to learn more about the probe wish lists for non-Rabbit apps is, 
assuming that picture has started to come together? 


In addition, I've added a NIF that allows Erlang code to trigger a 
probe. See the EDoc comments at the top of this source file for some 
background: 

https://github.com/slfritchie/otp/blob/dtrace-experiment+michal2/lib/dtrace/src/dtrace.erl 

Ah this piece looks very interesting... 

Jerry 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111024/d891aaf3/attachment.htm>

From Roger.Fischer at abb.ventyx.com  Mon Oct 24 21:05:40 2011
From: Roger.Fischer at abb.ventyx.com (Roger Fischer)
Date: Mon, 24 Oct 2011 16:05:40 -0400
Subject: [rabbitmq-discuss] Queue Clustering and Sequencing
Message-ID: <B925600E2C563A4FA33FA9CF64A455B5031DE82D@LITEXCHEVS1.ventyx.org>

Hello, 

 

I am curious if RabbitMQ addresses the following use case.

 

A single queue. Persistent.

 

A producer creates messages fast (average 10 msg/sec).

 

Consumers process messages slow (average 1 msg/sec). Thus 10 consumers
are required to keep up.

 

Challenge 1: Some messages (< 1%) are related and need to be processed
in order. If two dependent messages are less than 10 messages apart,
they are processed in parallel. That's a problem.

 

Obvious solution: create 10 queues, each with a different key, and each
with only one consumer. But:

* Non-related messages are unnecessarily sequenced. When the key
distribution is not exactly even, one queue may have a backup while
another is idle.

* Complex to configure for differently sized systems.

 

Challenge 1+: earlier message could fail processing and be re-queued
with a delay. Obvious solution doesn't fix that.

 

Desired solution: Queue knows what messages are being processed /
re-queued and holds messages with the same key.

 

But that's not all. Consumers are clustered, with load balancing
(scalability) and failover (availability).

 

Challenge 2a: related messages must still be processed by the same
consumer (and thus loadbalanced to the same node).

 

Challenge 2b: related messages must be processed in order across node
failures.

 

Obvious solution: Solution to 1 and migrate file store and consumer from
failed node to another node. But:

* Need external system to manage migration.

* Very complex to configure for differently sized systems (different
workloads, different node sizes and different cluster sizes).

 

Desired solution: Solution 1 queues, and coordinate across nodes what
keys have messages being processed or re-queued. Will affect throughput
(we need only 250 msg/sec).

 

Thanks...

 

Roger

 

PS: Please copy the response to my email (roger dot fischer at abb dot
Ventyx dot com) as I am not a subscriber of the list.

 



Mindshare 2012 | May 8-10 | Orlando, FL
More details coming soon. 

Dates and location for European Mindshare coming soon.

DISCLAIMER:
**************************************************************************** 
This email message and all attachments transmitted with it are for the sole 
use of the intended recipient(s) and may contain confidential and privileged 
information. Please DO NOT forward this email outside of the recipient's 
Company unless expressly authorized to do so herein. Any unauthorized review, 
use, disclosure or distribution is prohibited. If you are not the intended 
recipient, please contact the sender by reply email and destroy all copies 
of the original message.

Any views expressed in this email message are those of the individual sender 
except where the sender specifically states them to be the views of Ventyx.
****************************************************************************

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111024/891cd7ad/attachment.htm>

From slfritchie at snookles.com  Mon Oct 24 21:24:44 2011
From: slfritchie at snookles.com (Scott Lystig Fritchie)
Date: Mon, 24 Oct 2011 15:24:44 -0500
Subject: [rabbitmq-discuss] DTrace and Erlang: an update
In-Reply-To: Message of "Mon, 24 Oct 2011 11:50:47 PDT."
	<0b4cd3e0-41d1-405d-a199-86e1033360d3@CoachZ.local> 
Message-ID: <39628.1319487884@snookles.snookles.com>

Jerry Kuch <jerryk at vmware.com> wrote:

> Alas, I'm in North America and won't be there... will your presentation be
> recorded and put on the web 

I'm assuming that the recording will be made available eventually on
the Erlang Factory webathingie, like the slide and video links (icons
only, look for the camera icon & the easel icons) at
https://www.erlang-factory.com/conference/London2011/talks

>> https://github.com/slfritchie/otp/blob/dtrace-experiment+michal2/lib/dtrace/src/dtrace.erl
>
> Ah this piece looks very interesting...

It's an attempt to create a multi-purpose function.  The normal way
of creating new USDT probes is to run through the standard C
compiler +DTrace cycle to create a new shared library.  Not really
feasible for most app deployments.  The dtrace:p/1 function is
an attempt to create a flexible multi-blade pocket knife single
function, rather than create a function for 1 int and 1 string, 1 int
and 2 strings, 0 ints and 3 strings, etc.

However, it *is* possible to create new DTrace probes by talking
directly to the /dev/dtrace* directly.  There's code in the Node.js
repo to do exactly that, see
https://github.com/chrisa/node-dtrace-provider.  Porting that code
(if the license is agreeable) to the Erlang project would be a very
handy thing.

-Scott

From jasonjwwilliams at gmail.com  Mon Oct 24 22:38:31 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Mon, 24 Oct 2011 15:38:31 -0600
Subject: [rabbitmq-discuss] Cluster Join Failure
Message-ID: <CAHZAEpduFnvuOtZ=FfatrCOwO56afVPEXEb5chTuvMwbD5BGMg@mail.gmail.com>

Hello,

I've got a 2.5.1 cluster that was running on my laptop (OS X 10.7.2).
I upgraded to 2.6.1 and Mnesia locked up during the database upgrade
process. Restarting Rabbit caused a failure due to half-finished
upgrade (not sure why it was taking so long as there were no messages
in Mnesia at the time). Since there was no valuable data in Mnesia, I
went ahead and wiped out /var/lib/rabbitmq and restarted both nodes.
Both nodes came up correctly now, however now when I try to join
rabbit2 at Phantome to rabbit at Phantome, I get the following schema merge
error:

Clustering node rabbit2 at Phantome with [rabbit at Phantome,rabbit2 at Phantome] ...
Error: {unable_to_join_cluster,
           [rabbit at Phantome,rabbit2 at Phantome],
           {merge_schema_failed,
               "Incompatible schema cookies. Please, restart from old
backup.rabbit at Phantome =
[{name,schema},{type,set},{ram_copies,[]},{disc_copies,[rabbit at Phantome]},{disc_only_copies,[]},{load_order,0},{access_mode,read_write},{majority,false},{index,[]},{snmp,[]},{local_content,false},{record_name,schema},{attributes,[table,cstruct]},{user_properties,[]},{frag_properties,[]},{cookie,{{1319,492091,286375},rabbit at Phantome}},{version,{{3,0},{rabbit at Phantome,{1319,492118,596284}}}}],
rabbit2 at Phantome =
[{name,schema},{type,set},{ram_copies,[]},{disc_copies,[rabbit2 at Phantome]},{disc_only_copies,[]},{load_order,0},{access_mode,read_write},{majority,false},{index,[]},{snmp,[]},{local_content,false},{record_name,schema},{attributes,[table,cstruct]},{user_properties,[]},{frag_properties,[]},{cookie,{{1319,492095,479659},rabbit2 at Phantome}},{version,{{2,0},[]}}]\n"}}

I'm a little confused since both nodes should be empty and their
Mnesia recreated from scratch by Rabbit before the join. Thank you in
advance for your help.

-J

From jasonjwwilliams at gmail.com  Mon Oct 24 22:45:30 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Mon, 24 Oct 2011 15:45:30 -0600
Subject: [rabbitmq-discuss] Cluster Join Failure
In-Reply-To: <CAHZAEpduFnvuOtZ=FfatrCOwO56afVPEXEb5chTuvMwbD5BGMg@mail.gmail.com>
References: <CAHZAEpduFnvuOtZ=FfatrCOwO56afVPEXEb5chTuvMwbD5BGMg@mail.gmail.com>
Message-ID: <CAHZAEpfg77eRFms8EtZkBd=D3wT_f5v0UCHmxmLWeWXkwHwuTA@mail.gmail.com>

Nevermind. Due to the Mnesia upgrade failure and a lack of coffee...I
forgot to do a "reset" before the cluster command.

-J

On Mon, Oct 24, 2011 at 3:38 PM, Jason J. W. Williams
<jasonjwwilliams at gmail.com> wrote:
> Hello,
>
> I've got a 2.5.1 cluster that was running on my laptop (OS X 10.7.2).
> I upgraded to 2.6.1 and Mnesia locked up during the database upgrade
> process. Restarting Rabbit caused a failure due to half-finished
> upgrade (not sure why it was taking so long as there were no messages
> in Mnesia at the time). Since there was no valuable data in Mnesia, I
> went ahead and wiped out /var/lib/rabbitmq and restarted both nodes.
> Both nodes came up correctly now, however now when I try to join
> rabbit2 at Phantome to rabbit at Phantome, I get the following schema merge
> error:
>
> Clustering node rabbit2 at Phantome with [rabbit at Phantome,rabbit2 at Phantome] ...
> Error: {unable_to_join_cluster,
> ? ? ? ? ? [rabbit at Phantome,rabbit2 at Phantome],
> ? ? ? ? ? {merge_schema_failed,
> ? ? ? ? ? ? ? "Incompatible schema cookies. Please, restart from old
> backup.rabbit at Phantome =
> [{name,schema},{type,set},{ram_copies,[]},{disc_copies,[rabbit at Phantome]},{disc_only_copies,[]},{load_order,0},{access_mode,read_write},{majority,false},{index,[]},{snmp,[]},{local_content,false},{record_name,schema},{attributes,[table,cstruct]},{user_properties,[]},{frag_properties,[]},{cookie,{{1319,492091,286375},rabbit at Phantome}},{version,{{3,0},{rabbit at Phantome,{1319,492118,596284}}}}],
> rabbit2 at Phantome =
> [{name,schema},{type,set},{ram_copies,[]},{disc_copies,[rabbit2 at Phantome]},{disc_only_copies,[]},{load_order,0},{access_mode,read_write},{majority,false},{index,[]},{snmp,[]},{local_content,false},{record_name,schema},{attributes,[table,cstruct]},{user_properties,[]},{frag_properties,[]},{cookie,{{1319,492095,479659},rabbit2 at Phantome}},{version,{{2,0},[]}}]\n"}}
>
> I'm a little confused since both nodes should be empty and their
> Mnesia recreated from scratch by Rabbit before the join. Thank you in
> advance for your help.
>
> -J
>

From jasonjwwilliams at gmail.com  Mon Oct 24 23:52:57 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Mon, 24 Oct 2011 16:52:57 -0600
Subject: [rabbitmq-discuss] Interesting Active-Active error
Message-ID: <CAHZAEpceFDohaB6Pf0vBTBW-W8O8dURJ2mmabrejyi0NfN4HRg@mail.gmail.com>

Hello,

Been messing around with mirrored queues in 2.6.1 on OS X 10.7.2
today. I initially created a queue called "hello-queue" with an
"x-ha-policy" of "all". This worked as expected. I then deleted the
queue through the management web UI and tried recreating it now with
the following arg dict:

{"x-ha-policy" : "nodes", "x-ha-policy-params" , ["rabbit at Phantome,
"rabbit2 at Phantome"]}

This triggered an AMQP 404 error when trying to create the queue:
pika.exceptions.AMQPChannelError: (404, "NOT_FOUND - no queue
'hello-queue' in vhost '/'")

I've attached the sample program. What was more curious however, is
that the web UI shows the queue existing but in some sort of broken
state, to the effect that when you try to delete the queue through the
web UI you get the same AMQP 404 error. Here is a screencast showing
the state of the queue in the web UI and the effect of trying to
delete it: http://screencast.com/t/f7PVpPflyUu4

Any pointers are greatly appreciated.

-J
-------------- next part --------------
A non-text attachment was scrubbed...
Name: hello_world_mirrored_queue_consumer.py
Type: application/octet-stream
Size: 1984 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111024/f5bbb21c/attachment.obj>

From matthew at rabbitmq.com  Tue Oct 25 00:05:38 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 25 Oct 2011 00:05:38 +0100
Subject: [rabbitmq-discuss] Interesting Active-Active error
In-Reply-To: <CAHZAEpceFDohaB6Pf0vBTBW-W8O8dURJ2mmabrejyi0NfN4HRg@mail.gmail.com>
References: <CAHZAEpceFDohaB6Pf0vBTBW-W8O8dURJ2mmabrejyi0NfN4HRg@mail.gmail.com>
Message-ID: <20111024230538.GA26191@wellquite.org>

Hi Jason,

On Mon, Oct 24, 2011 at 04:52:57PM -0600, Jason J. W. Williams wrote:
> Been messing around with mirrored queues in 2.6.1 on OS X 10.7.2
> today. I initially created a queue called "hello-queue" with an
> "x-ha-policy" of "all". This worked as expected. I then deleted the
> queue through the management web UI and tried recreating it now with
> the following arg dict:
> 
> {"x-ha-policy" : "nodes", "x-ha-policy-params" , ["rabbit at Phantome,
> "rabbit2 at Phantome"]}
> 
> This triggered an AMQP 404 error when trying to create the queue:
> pika.exceptions.AMQPChannelError: (404, "NOT_FOUND - no queue
> 'hello-queue' in vhost '/'")

"nodes" is currently broken. Only "all" works. This will be fixed in the
next release.

Matthew

From natester at gmail.com  Tue Oct 25 00:24:33 2011
From: natester at gmail.com (Nathaniel Haggard)
Date: Mon, 24 Oct 2011 17:24:33 -0600
Subject: [rabbitmq-discuss] sslv3 alert handshake failure for TLS Web Server
	certificates
Message-ID: <CAAbnaHaScyuvzWmjyJrwDko3F=N7K=tfJrs5Ot-QvBn7M7qJaQ@mail.gmail.com>

A certificate with X509v3 Extended Key Usage of "TLS Web Client
Authentication" will connect to our rabbitmq-2.4.1 server, but a
certificate with "TLS Web Server Authentication" will not.

It fails like this:
$ openssl s_client -host 127.0.0.1 -port 5671 -key my.key -cert my.crt
CONNECTED(00000003)
depth=1 /C=US/ST=../L=...../O=.../CN=testingCA2/emailAddress=me at myhost.mydomain
verify error:num=19:self signed certificate in certificate chain
verify return:0
6837:error:14094410:SSL routines:SSL3_READ_BYTES:sslv3 alert handshake
failure:s3_pkt.c:1102:SSL alert number 40
6837:error:140790E5:SSL routines:SSL23_WRITE:ssl handshake
failure:s23_lib.c:188:


However, both types of certificate work with rabbitmq-1.7.2.

Is there a configuration option to accept  "TLS Web Server
Authentication" certificates in rabbitmq-2.4.1?

-Nate

From alexandru at rabbitmq.com  Tue Oct 25 00:36:32 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Tue, 25 Oct 2011 00:36:32 +0100
Subject: [rabbitmq-discuss] sslv3 alert handshake failure for TLS Web
 Server certificates
In-Reply-To: <CAAbnaHaScyuvzWmjyJrwDko3F=N7K=tfJrs5Ot-QvBn7M7qJaQ@mail.gmail.com>
References: <CAAbnaHaScyuvzWmjyJrwDko3F=N7K=tfJrs5Ot-QvBn7M7qJaQ@mail.gmail.com>
Message-ID: <20111024233632.GA3367@southbank.Home>

Hi Nate,

> A certificate with X509v3 Extended Key Usage of "TLS Web Client
> Authentication" will connect to our rabbitmq-2.4.1 server, but a
> certificate with "TLS Web Server Authentication" will not.

The broker does not and, to the extent of my knowledge, never did
inspect those fields in the certificate.  It normally relies on the
Erlang's interpretation of a valid certificate (configured via the
verify and fail_if_no_peer_cert options in rabbitmq.config).

So, are you using the same version of Erlang in both tests?  What's the
error in the 2.4.1 broker's log for the failed connection attempt?

> Is there a configuration option to accept  "TLS Web Server
> Authentication" certificates in rabbitmq-2.4.1?

As previously mentioned, RabbitMQ doesn't care about those fields.
AFAIK, Erlang doesn't either, so something else may be happening.

Cheers,
Alex

On Mon, Oct 24, 2011 at 05:24:33PM -0600, Nathaniel Haggard wrote:
> A certificate with X509v3 Extended Key Usage of "TLS Web Client
> Authentication" will connect to our rabbitmq-2.4.1 server, but a
> certificate with "TLS Web Server Authentication" will not.
> 
> It fails like this:
> $ openssl s_client -host 127.0.0.1 -port 5671 -key my.key -cert my.crt
> CONNECTED(00000003)
> depth=1 /C=US/ST=../L=...../O=.../CN=testingCA2/emailAddress=me at myhost.mydomain
> verify error:num=19:self signed certificate in certificate chain
> verify return:0
> 6837:error:14094410:SSL routines:SSL3_READ_BYTES:sslv3 alert handshake
> failure:s3_pkt.c:1102:SSL alert number 40
> 6837:error:140790E5:SSL routines:SSL23_WRITE:ssl handshake
> failure:s23_lib.c:188:
> 
> 
> However, both types of certificate work with rabbitmq-1.7.2.
> 
> Is there a configuration option to accept  "TLS Web Server
> Authentication" certificates in rabbitmq-2.4.1?
> 
> -Nate
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From lgreg.meredith at gmail.com  Tue Oct 25 00:50:07 2011
From: lgreg.meredith at gmail.com (Meredith Gregory)
Date: Mon, 24 Oct 2011 16:50:07 -0700
Subject: [rabbitmq-discuss] getting node.js to talk to scala over rabbitmq
Message-ID: <CAG7cANS5tiOVCq_aj-HDw8gsk+5TF-r=+abnnCkC9T8ZgGSvsA@mail.gmail.com>

Dear Rabbiters,

i'm running into a problem getting node.js to talk to scala over
rabbitmq. i'm using the node-amqp package with node.js. i installed it using
npm install amqp. i'm using the java client for rabbitmq 2.5.1 on the scala
side. i've successfully gotten scala to talk to scala and node.js to talk to
node.js. However, when i attempt to get node.js to talk to scala there
appears to be a disagreement regarding queue declaration. Thus, if i fire up
node.js first and look at the queue it creates with the rabbitmq management
plugin i see


node-simple-direct_queue<http://localhost:55672/mgmt/#/queues/%2F/node-simple-direct_queue>
ADIdle000


i then attempt to accomplish a connection from the scala side (with code
that works on scala-to-scala) and i see an exception when the code calls the
queueDeclare method.

            channel.exchangeDeclare( exQNameRoot, "direct" )
            //channel.queueDeclare(qname, true, false, false, null);
    channel.queueDeclare(qname, true, false, true, null); // <-- here we
throw an exception

java.io.IOException
at com.rabbitmq.client.impl.AMQChannel.wrap(AMQChannel.java:107)
at com.rabbitmq.client.impl.AMQChannel.exnWrappingRpc(AMQChannel.java:131)
at com.rabbitmq.client.impl.ChannelN.queueDeclare(ChannelN.java:627)
at com.rabbitmq.client.impl.ChannelN.queueDeclare(ChannelN.java:59)
at
com.biosimilarity.lift.lib.AMQPBrokerScope$StdMonadicAMQPSndrRcvr.sender(AMQPMnd.scala:53)

Any help would be most welcome!

Best wishes,

--greg

-- 
L.G. Meredith
Managing Partner
Biosimilarity LLC
7329 39th Ave SW
Seattle, WA 98136

+1 206.650.3740

http://biosimilarity.blogspot.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111024/2c84946a/attachment.htm>

From videlalvaro at gmail.com  Tue Oct 25 00:56:44 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Tue, 25 Oct 2011 01:56:44 +0200
Subject: [rabbitmq-discuss] getting node.js to talk to scala over
	rabbitmq
In-Reply-To: <CAG7cANS5tiOVCq_aj-HDw8gsk+5TF-r=+abnnCkC9T8ZgGSvsA@mail.gmail.com>
References: <CAG7cANS5tiOVCq_aj-HDw8gsk+5TF-r=+abnnCkC9T8ZgGSvsA@mail.gmail.com>
Message-ID: <8BBB308C-C2C2-4754-AB63-6D0D5B6A3F45@gmail.com>

Hi,

On Oct 25, 2011, at 1:50 AM, Meredith Gregory wrote:

> 	    channel.queueDeclare(qname, true, false, true, null); // <-- here we throw an exception


As a first look it seems that you are declaring the same queue but with different options. I think your node.js declared queue is "auto_delete" and "durable". I don't know what the Scala code options are but make sure they are the same.

Cheers,

Alvaro

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111025/2681e08f/attachment.htm>

From jasonjwwilliams at gmail.com  Tue Oct 25 01:50:47 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Mon, 24 Oct 2011 18:50:47 -0600
Subject: [rabbitmq-discuss] Interesting Active-Active error
In-Reply-To: <20111024230538.GA26191@wellquite.org>
References: <CAHZAEpceFDohaB6Pf0vBTBW-W8O8dURJ2mmabrejyi0NfN4HRg@mail.gmail.com>
	<20111024230538.GA26191@wellquite.org>
Message-ID: <B8A2250B-5D8D-4070-8308-F95853340823@gmail.com>

Thanks for the quick reply Matthew. 

-J

Sent via iPhone

Is your email Premiere?

On Oct 24, 2011, at 17:05, Matthew Sackman <matthew at rabbitmq.com> wrote:

> Hi Jason,
> 
> On Mon, Oct 24, 2011 at 04:52:57PM -0600, Jason J. W. Williams wrote:
>> Been messing around with mirrored queues in 2.6.1 on OS X 10.7.2
>> today. I initially created a queue called "hello-queue" with an
>> "x-ha-policy" of "all". This worked as expected. I then deleted the
>> queue through the management web UI and tried recreating it now with
>> the following arg dict:
>> 
>> {"x-ha-policy" : "nodes", "x-ha-policy-params" , ["rabbit at Phantome,
>> "rabbit2 at Phantome"]}
>> 
>> This triggered an AMQP 404 error when trying to create the queue:
>> pika.exceptions.AMQPChannelError: (404, "NOT_FOUND - no queue
>> 'hello-queue' in vhost '/'")
> 
> "nodes" is currently broken. Only "all" works. This will be fixed in the
> next release.
> 
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From raphael at rightscale.com  Tue Oct 25 02:07:52 2011
From: raphael at rightscale.com (Raphael Simon)
Date: Mon, 24 Oct 2011 18:07:52 -0700
Subject: [rabbitmq-discuss] RabbitMQ writes non stop to disk
Message-ID: <CAD7X3-nRLHv+uEf0Vy3JTzW8WRNvUW4vSszykU4F=WCEouM5SA@mail.gmail.com>

Hello all,

We are seeing an issue on a production broker where the RabbitMQ process
writes non stop to files in mnesia/<node>/msg_store_persistent. It keeps
creating new files and the problem seems to be getting worse. Listing the
files in that directory shows that it's creating a new 16 MB file every 2 to
4 minutes [1].

The throughput of persistent messages in this broker is orders of magnitude
less (maybe 20 msg/sec at the most, each being in the 10s of KB) .

Attaching a shell to the broker process I can retrieve the process status of
the msg_store_persistent server which is the process causing all the writes,
not sure what to look for though [2].

There are about 100 messages sitting in queues on that broker so that should
not cause that many writes, iostat shows about 6000 writes/s.

Any pointers to where we should be looking would be greatly appreciated.

Thanks!

--
Raphael.

[1]
# ls -alt /mnt/rabbitmq/mnesia/rabbit at broker1-1/msg_store_persistent
total 453196
-rw-r--r-- 1 rabbitmq rabbitmq  2973011 2011-10-25 00:55 706.rdq
drwxr-xr-x 5 rabbitmq rabbitmq     4096 2011-10-25 00:54 ..
drwxr-xr-x 2 rabbitmq rabbitmq     4096 2011-10-25 00:53 .
-rw-r--r-- 1 rabbitmq rabbitmq 16779002 2011-10-25 00:49 704.rdq
-rw-r--r-- 1 rabbitmq rabbitmq 16779064 2011-10-25 00:44 703.rdq
-rw-r--r-- 1 rabbitmq rabbitmq 16778786 2011-10-25 00:39 702.rdq
-rw-r--r-- 1 rabbitmq rabbitmq 16780428 2011-10-25 00:33 701.rdq
-rw-r--r-- 1 rabbitmq rabbitmq 16779981 2011-10-25 00:28 700.rdq
-rw-r--r-- 1 rabbitmq rabbitmq 16779550 2011-10-25 00:24 699.rdq
-rw-r--r-- 1 rabbitmq rabbitmq 16780493 2011-10-25 00:21 698.rdq
-rw-r--r-- 1 rabbitmq rabbitmq 16777711 2011-10-25 00:17 697.rdq
-rw-r--r-- 1 rabbitmq rabbitmq 16782704 2011-10-25 00:13 696.rdq
-rw-r--r-- 1 rabbitmq rabbitmq     8991 2011-10-25 00:10 669.rdq
-rw-r--r-- 1 rabbitmq rabbitmq     8861 2011-10-25 00:10 667.rdq
-rw-r--r-- 1 rabbitmq rabbitmq    10469 2011-10-25 00:10 665.rdq
-rw-r--r-- 1 rabbitmq rabbitmq    54123 2011-10-25 00:10 662.rdq
-rw-r--r-- 1 rabbitmq rabbitmq    61457 2011-10-25 00:10 658.rdq
-rw-r--r-- 1 rabbitmq rabbitmq     6040 2011-10-25 00:10 654.rdq
-rw-r--r-- 1 rabbitmq rabbitmq 13115149 2011-10-25 00:10 634.rdq
-rw-r--r-- 1 rabbitmq rabbitmq 16779265 2011-10-25 00:09 695.rdq
-rw-r--r-- 1 rabbitmq rabbitmq 16808918 2011-10-25 00:03 694.rdq
-rw-r--r-- 1 rabbitmq rabbitmq 16802844 2011-10-24 23:55 690.rdq
-rw-r--r-- 1 rabbitmq rabbitmq 16793271 2011-10-24 23:55 689.rdq
-rw-r--r-- 1 rabbitmq rabbitmq 16810749 2011-10-24 23:54 688.rdq
-rw-r--r-- 1 rabbitmq rabbitmq 16780809 2011-10-24 23:51 683.rdq
-rw-r--r-- 1 rabbitmq rabbitmq 16779742 2011-10-24 23:49 682.rdq
-rw-r--r-- 1 rabbitmq rabbitmq 16778746 2011-10-24 23:44 681.rdq
-rw-r--r-- 1 rabbitmq rabbitmq 16793650 2011-10-24 23:40 680.rdq
-rw-r--r-- 1 rabbitmq rabbitmq 16782092 2011-10-24 23:35 679.rdq
-rw-r--r-- 1 rabbitmq rabbitmq 16788239 2011-10-24 23:31 678.rdq
-rw-r--r-- 1 rabbitmq rabbitmq 16780959 2011-10-24 23:26 677.rdq
-rw-r--r-- 1 rabbitmq rabbitmq 16779952 2011-10-24 23:17 675.rdq
-rw-r--r-- 1 rabbitmq rabbitmq 16777823 2011-10-24 23:05 672.rdq
-rw-r--r-- 1 rabbitmq rabbitmq 16779687 2011-10-24 23:02 671.rdq
-rw-r--r-- 1 rabbitmq rabbitmq 17559554 2011-10-24 20:52 633.rdq
-rw-r--r-- 1 rabbitmq rabbitmq    11847 2011-10-24 20:41 612.rdq
-rw-r--r-- 1 rabbitmq rabbitmq 16100804 2011-10-24 20:41 523.rdq
-rw-r--r-- 1 rabbitmq rabbitmq    11314 2011-10-24 18:39 576.rdq
-rw-r--r-- 1 rabbitmq rabbitmq    28514 2011-10-24 18:16 565.rdq
-rw-r--r-- 1 rabbitmq rabbitmq    17823 2011-10-24 17:24 561.rdq
-rw-r--r-- 1 rabbitmq rabbitmq    14774 2011-10-24 13:25 528.rdq
-rw-r--r-- 1 rabbitmq rabbitmq 10864262 2011-10-24 13:25 0.rdq
-rw-r--r-- 1 rabbitmq rabbitmq    35908 2011-10-24 13:15 491.rdq
-rw-r--r-- 1 rabbitmq rabbitmq    48383 2011-10-24 13:06 487.rdq
-rw-r--r-- 1 rabbitmq rabbitmq    11912 2011-10-24 12:50 484.rdq
-rw-r--r-- 1 rabbitmq rabbitmq    23881 2011-10-24 06:06 437.rdq

[2]
{status,<0.237.0>,
        {module,gen_server2},
        [[{{#Ref<0.0.3588.227656>,fhc_handle},
           {handle,{file_descriptor,prim_file,{#Port<0.712982>,109}},
                   14469207,14469207,false,0,1048576,[],true,
                   "/mnt/rabbitmq/mnesia/rabbit at broker1-1
/msg_store_persistent/702.rdq",
                   [raw,binary,write],
                   [{write_buffer,1048576}],
                   true,false,
                   {1319,503146,31340}}},
          {'$ancestors',[rabbit_sup,<0.73.0>]},
          {{"/mnt/rabbitmq/mnesia/rabbit at broker1-1
/msg_store_persistent/702.rdq",
            fhc_file},
           {file,0,true}},
          {fhc_age_tree,{1,

 {{1319,503146,31340},#Ref<0.0.3588.227656>,nil,nil}}},
          {'$initial_call',{gen,init_it,7}}],
         running,<0.74.0>,[],
         [{header,"Status for generic server msg_store_persistent"},
          {data,[{"Status",running},
                 {"Parent",<0.74.0>},
                 {"Logged events",[]},
                 {"Queued messages",[]}]},
          {data,[{"State",
                  {msstate,"/mnt/rabbitmq/mnesia/rabbit at broker1-1
/msg_store_persistent",
                           rabbit_msg_store_ets_index,
                           {state,262201,
                                  "/mnt/rabbitmq/mnesia/rabbit at broker1-1
/msg_store_persistent"},
                           702,#Ref<0.0.3588.227656>,
                           {dict,0,16,16,8,80,48,
                                 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]},

 {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                   [],[]}}},
                           [],undefined,53527675,424756530,[],<0.240.0>,
                           266298,258104,270395,
                           {set,0,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                           {dict,24974,6019,8192,4096,30095,18057,
                                 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]},

 {{[[<<109,81,35,172,101,10,100,5,139,235,37,
                                       207,134,159,97,123>>|
                                     {#Fun<rabbit_variable_queue.1.360644>,

#Fun<rabbit_variable_queue.20.77393657>}],

[<<98,60,3,61,105,99,34,128,158,37,55,121,
                                       53,68,253,77>>|
                                     {#Fun<rabbit_variable_queue.1.360644>,

#Fun<rabbit_variable_queue.20.77393657>}],
                                    [<<224,253,10,145,132,16,186,61,192,63,
..... lots of stuff snipped ....

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                   [],[]},

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                   [],[]}}},
                           false,16777216,
                           {dict,0,16,16,8,80,48,
                                 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]},

 {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                   [],[]}}}}}]}]]}
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111024/62de372f/attachment.htm>

From loki77 at gmail.com  Tue Oct 25 05:04:38 2011
From: loki77 at gmail.com (Michael Barrett)
Date: Mon, 24 Oct 2011 21:04:38 -0700
Subject: [rabbitmq-discuss] maximum connections
Message-ID: <C759BE58-3C73-40AC-9092-C3F0EEC31C5A@gmail.com>

I'm testing out a new rabbitMQ system and noticed that the system seems to stop accepting new connections after around 830 get opened.  Can anyone tell me what would cause it to stop at that point?  The system ulimit on open files is 4096 (soft & hard) and the rabbitMQ user isn't anywhere near using that many.  Is there anything else that could be responsible for this limit?

Thanks!

--
Michael Barrett
loki77 at gmail.com





From alexandru at rabbitmq.com  Tue Oct 25 08:17:52 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Tue, 25 Oct 2011 08:17:52 +0100
Subject: [rabbitmq-discuss] maximum connections
In-Reply-To: <C759BE58-3C73-40AC-9092-C3F0EEC31C5A@gmail.com>
References: <C759BE58-3C73-40AC-9092-C3F0EEC31C5A@gmail.com>
Message-ID: <20111025071752.GC3367@southbank.Home>

> I'm testing out a new rabbitMQ system and noticed that the system seems to stop accepting new connections after around 830 get opened.  Can anyone tell me what would cause it to stop at that point? 

It ran out of socket descriptors probably (or was getting close to the
limit and the internal descriptor limiter kicked in).  On my system,
this limit is 829, by default, so this is likely the cause.

This is calculated as a fixed fraction of the file descriptor limit.

> The system ulimit on open files is 4096 (soft & hard) and the rabbitMQ user isn't anywhere near using that many.  Is there anything else that could be responsible for this limit?

Huh.  Are you sure?  A 830 socket limit corresponds to a 1024 file
descriptor limit.

Try enabling the management plugin to see if what the limits are what
you think they are (the overview page gives a breakdown of the limits
RabbitMQ knows about).

What is the output of `ulimit -a`?  What happens if you do a `ulimit -n
4096` in the shell before starting rabbitmq-server in the same shell?
That should increase the maximum number of connection to 3594.

Cheers,
Alex

On Mon, Oct 24, 2011 at 09:04:38PM -0700, Michael Barrett wrote:
> I'm testing out a new rabbitMQ system and noticed that the system seems to stop accepting new connections after around 830 get opened.  Can anyone tell me what would cause it to stop at that point?  The system ulimit on open files is 4096 (soft & hard) and the rabbitMQ user isn't anywhere near using that many.  Is there anything else that could be responsible for this limit?
> 
> Thanks!
> 
> --
> Michael Barrett
> loki77 at gmail.com
> 
> 
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From michael.s.klishin at gmail.com  Tue Oct 25 08:22:28 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 25 Oct 2011 11:22:28 +0400
Subject: [rabbitmq-discuss] ruby amqp gem AMQP::Rebroadcaster feature
In-Reply-To: <CA+JR6zPNBse2gw6sxcXm-CoZj37Ttd=HzgbdBGBfWZZ+G_t8=w@mail.gmail.com>
References: <CA+JR6zPxR1jkvxVD8xcUyvdLS_Qj-v82qFEQrk2fqR2e36Rpeg@mail.gmail.com>
	<CAE3HoVSb_jUbW_DhqTy6oaY0jvcWxinUAMrxjFRbDgzT_aM11A@mail.gmail.com>
	<CA+JR6zPNBse2gw6sxcXm-CoZj37Ttd=HzgbdBGBfWZZ+G_t8=w@mail.gmail.com>
Message-ID: <CAE3HoVTVH9KR7o7oX0EbuerKzjP+CzoBkD5h1n+Xr2m1cXEqSg@mail.gmail.com>

2011/10/24 Michael Nacos <m.nacos at gmail.com>

> is this kind of flow so exotic? I'd imagine it's a pretty common scenario.



No, it is not exotic. But not having higher priority that a couple of bug
fixes for the next 0.8.x release.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111025/f3e49670/attachment.htm>

From matthias at rabbitmq.com  Tue Oct 25 09:20:09 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 25 Oct 2011 09:20:09 +0100
Subject: [rabbitmq-discuss] maximum connections
In-Reply-To: <20111025071752.GC3367@southbank.Home>
References: <C759BE58-3C73-40AC-9092-C3F0EEC31C5A@gmail.com>
	<20111025071752.GC3367@southbank.Home>
Message-ID: <4EA67139.2010203@rabbitmq.com>

On 25/10/11 08:17, Alexandru Scvor?ov wrote:
> Try enabling the management plugin to see if what the limits are what
> you think they are (the overview page gives a breakdown of the limits
> RabbitMQ knows about).

Rabbit also records this information in its log, for example...

=INFO REPORT==== 24-Oct-2011::15:55:41 ===
Limiting to approx 16284 file handles (14653 sockets)


Matthias.

From emile at rabbitmq.com  Tue Oct 25 09:39:36 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 25 Oct 2011 09:39:36 +0100
Subject: [rabbitmq-discuss] RabbitMQ writes non stop to disk
In-Reply-To: <CAD7X3-nRLHv+uEf0Vy3JTzW8WRNvUW4vSszykU4F=WCEouM5SA@mail.gmail.com>
References: <CAD7X3-nRLHv+uEf0Vy3JTzW8WRNvUW4vSszykU4F=WCEouM5SA@mail.gmail.com>
Message-ID: <4EA675C8.70903@rabbitmq.com>

Hi Raphael,

On 25/10/11 02:07, Raphael Simon wrote:
> Hello all,
> 
> We are seeing an issue on a production broker where the RabbitMQ process
> writes non stop to files in mnesia/<node>/msg_store_persistent. It keeps
> creating new files and the problem seems to be getting worse. Listing
> the files in that directory shows that it's creating a new 16 MB file
> every 2 to 4 minutes [1].
> 
> The throughput of persistent messages in this broker is orders of
> magnitude less (maybe 20 msg/sec at the most, each being in the 10s of KB) .

> There are about 100 messages sitting in queues on that broker so that
> should not cause that many writes, iostat shows about 6000 writes/s.

How did you determine this number? Is it constant? I would expect the
behaviour you describe when some queues keep growing or when the broker
needs to free up alot of memory.

If the broker is running rabbit version 2.5.0 or later, could you please
supply the result of "rabbitmqctl report"?

If it is an older version please run "rabbitmqctl list_queues" with all
queueinfoitems, and supply both the query and the result. The result of
"erlang:memory()." from the Erlang shell will also be helpful, as well
as a copy of the rabbit configuration file, if you have made any
relevant changes.

Are there any unusual entries in the broker logfile? How often does the
memory alarm trigger? Are there any entries that appear at the onset of
the disk activity?


-Emile


From simon at rabbitmq.com  Tue Oct 25 10:47:27 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 25 Oct 2011 10:47:27 +0100
Subject: [rabbitmq-discuss] getting node.js to talk to scala over
	rabbitmq
In-Reply-To: <CAG7cANS5tiOVCq_aj-HDw8gsk+5TF-r=+abnnCkC9T8ZgGSvsA@mail.gmail.com>
References: <CAG7cANS5tiOVCq_aj-HDw8gsk+5TF-r=+abnnCkC9T8ZgGSvsA@mail.gmail.com>
Message-ID: <4EA685AF.4070505@rabbitmq.com>

On 25/10/11 00:50, Meredith Gregory wrote:
> Dear Rabbiters,
>
> i'm running into a problem getting node.js to talk to scala over
> rabbitmq. i'm using the node-amqp package with node.js. i installed it
> using npm install amqp. i'm using the java client for rabbitmq 2.5.1 on
> the scala side. i've successfully gotten scala to talk to scala
> and node.js to talk to node.js. However, when i attempt to get node.js
> to talk to scala there appears to be a disagreement regarding
> queue declaration. Thus, if i fire up node.js first and look at the
> queue it creates with the rabbitmq management plugin i see
>
>
> 	
> node-simple-direct_queue
> <http://localhost:55672/mgmt/#/queues/%2F/node-simple-direct_queue>	
> AD 	Idle 	0	0	0

So this looks like a transient autodelete queue.

> i then attempt to accomplish a connection from the scala side (with code
> that works on scala-to-scala) and i see an exception when the code calls
> the queueDeclare method.
>
>              channel.exchangeDeclare( exQNameRoot, "direct" )
>              //channel.queueDeclare(qname, true, false, false, null);
>     channel.queueDeclare(qname, true, false, true, null); // <-- here we
> throw an exception

And here you are declaring a durable autodelete queue. That's probably 
your problem.

> java.io.IOException
> at com.rabbitmq.client.impl.AMQChannel.wrap(AMQChannel.java:107)
> at com.rabbitmq.client.impl.AMQChannel.exnWrappingRpc(AMQChannel.java:131)
> at com.rabbitmq.client.impl.ChannelN.queueDeclare(ChannelN.java:627)
> at com.rabbitmq.client.impl.ChannelN.queueDeclare(ChannelN.java:59)
> at
> com.biosimilarity.lift.lib.AMQPBrokerScope$StdMonadicAMQPSndrRcvr.sender(AMQPMnd.scala:53)

...but you can unwrap this exception and check, or look in the broker 
logs to see what it's complaining about.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From stammailbox at gmail.com  Tue Oct 25 10:58:58 2011
From: stammailbox at gmail.com (mysurf mail)
Date: Tue, 25 Oct 2011 10:58:58 +0100
Subject: [rabbitmq-discuss] JSonRpc Client/Server - when exception occurs...
Message-ID: <CAJ2-Vrnj0JbA6GjCm28qqWXqdw+_wWHKHN5j1sHa-YZFKMvD=w@mail.gmail.com>

Hi,
I am using JSonRpc Client/Server successfully for a year now.
I have one major problem that I have eventually succeeded reproducing.

I have noticed that when the JsonRPCServer is throwing
an  uncaught exception
 ( one that nakes the  RPCServer not return an answer).
the rabbitmq rpc queue becomes unusable.
(new client cant connect unless I restart the rabbitmq)

I know that the obvious solution is  to surround every call to the server
with a try catch
but since the rabbit stops functioning I thought it would be nice to take
care of it through the rabbitmq infrastructure.

Maybe there is already a solution ?

Thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111025/2df425ef/attachment.htm>

From irmo.manie at gmail.com  Tue Oct 25 11:05:43 2011
From: irmo.manie at gmail.com (Irmo Manie)
Date: Tue, 25 Oct 2011 12:05:43 +0200
Subject: [rabbitmq-discuss] Clustered queues and bindings dropped when
	sending large messages
Message-ID: <CAAcXTObGjA8xcxPrYH1caxDOf5L=u4QSJVnysFSdJpU+G6Xx5g@mail.gmail.com>

We run a small 5 node (1 disk) cluster with verion 2.6.1 and erlang R14B04.

Whenever we send a large message, ~100MB, the clustered nodes loose
all remote queues and bindings.
The queues and bindings are left just on the node where they were created.

Has anybody else experienced the sudden drop of queues and bindings on
clustered nodes?

- Irmo

From simon at rabbitmq.com  Tue Oct 25 11:21:18 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 25 Oct 2011 11:21:18 +0100
Subject: [rabbitmq-discuss] Clustered queues and bindings dropped when
 sending large messages
In-Reply-To: <CAAcXTObGjA8xcxPrYH1caxDOf5L=u4QSJVnysFSdJpU+G6Xx5g@mail.gmail.com>
References: <CAAcXTObGjA8xcxPrYH1caxDOf5L=u4QSJVnysFSdJpU+G6Xx5g@mail.gmail.com>
Message-ID: <4EA68D9E.9090204@rabbitmq.com>

On 25/10/11 11:05, Irmo Manie wrote:
> Whenever we send a large message, ~100MB, the clustered nodes loose
> all remote queues and bindings.
> The queues and bindings are left just on the node where they were created.
>
> Has anybody else experienced the sudden drop of queues and bindings on
> clustered nodes?

No, really not. That sounds almost like the cluster is getting 
partitioned, which really should not happen. What, if any, error 
messages are you seeing in the logs?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From chris1adkin at yahoo.co.uk  Tue Oct 25 11:10:33 2011
From: chris1adkin at yahoo.co.uk (ChrisAdkin)
Date: Tue, 25 Oct 2011 03:10:33 -0700 (PDT)
Subject: [rabbitmq-discuss]  asynchronous RPC / activation with RabbitMQ
Message-ID: <32716352.post@talk.nabble.com>


Is it possible with RabbitMQ to implement asynchronous remote procedure calls
and throttle the rate at which these are called ?, I ask this as a complete
newbie to RabbitMQ. 
-- 
View this message in context: http://old.nabble.com/asynchronous-RPC---activation-with-RabbitMQ-tp32716352p32716352.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From chrisadkin97 at googlemail.com  Tue Oct 25 11:17:39 2011
From: chrisadkin97 at googlemail.com (Chris Adkin)
Date: Tue, 25 Oct 2011 03:17:39 -0700 (PDT)
Subject: [rabbitmq-discuss] asychronous activation
Message-ID: <c75c1dac-f11a-48dd-a6d7-86fc866ca0a9@m19g2000vbm.googlegroups.com>

Is it possible to use RabbitMq for asynchronous RPCs, if so is it also
possible to throttle the number of RPCs that are called so they dont
swamp the machine at the receiving end of the queue.

From simon at rabbitmq.com  Tue Oct 25 11:36:57 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 25 Oct 2011 11:36:57 +0100
Subject: [rabbitmq-discuss] Clustered queues and bindings dropped when
 sending large messages
In-Reply-To: <4EA68D9E.9090204@rabbitmq.com>
References: <CAAcXTObGjA8xcxPrYH1caxDOf5L=u4QSJVnysFSdJpU+G6Xx5g@mail.gmail.com>
	<4EA68D9E.9090204@rabbitmq.com>
Message-ID: <4EA69149.3040006@rabbitmq.com>

On 25/10/11 11:21, Simon MacMullen wrote:
> That sounds almost like the cluster is getting partitioned

Matthias points out that this can indeed happen, if transmitting one 
message across the cluster takes longer than the configured ticktime 
(see net_ticktime at http://www.erlang.org/doc/man/kernel_app.html). But 
by default that's 60s, and we don't change it. Is your cluster that slow?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From alexandru at rabbitmq.com  Tue Oct 25 11:44:53 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Tue, 25 Oct 2011 11:44:53 +0100
Subject: [rabbitmq-discuss] asynchronous RPC / activation with RabbitMQ
In-Reply-To: <32716352.post@talk.nabble.com>
References: <32716352.post@talk.nabble.com>
Message-ID: <20111025104453.GD3231@southbank>

> Is it possible with RabbitMQ to implement asynchronous remote procedure calls
> and throttle the rate at which these are called ?,

Probably.  You can certainly do RPC, asynchronous messaging and
rate throttling with RabbitMQ.

Have a look at the examples in your preferred language:
  http://hg.rabbitmq.com/rabbitmq-java-client/file/default/test/src/com/rabbitmq/examples/
  http://hg.rabbitmq.com/rabbitmq-dotnet-client/file/default/projects/examples/client/
You'll be looking for the client/server pairs.

I'm not sure what you mean by *asynchronous* RPC.  I think you mean
"send a message"/"a bit later, a reply comes back".

> throttle the rate at which these are called 

Depending on what you mean, that may be a bit hard.  There's no way in
RabbitMQ to throttle producers (you can certainly write throttling into
your clients, but a rogue producer will still be able to dump a lot of
messages onto RabbitMQ).  The consumer can still throttle the broker,
though.  So, the broker is going to be the one overloaded with
messages; in this case, it will start writing messages to disk; only if
it is really having problems with lack of memory, will it throttle
publishers.

Hope this helps.

Cheers,
Alex

On Tue, Oct 25, 2011 at 03:10:33AM -0700, ChrisAdkin wrote:
> 
> Is it possible with RabbitMQ to implement asynchronous remote procedure calls
> and throttle the rate at which these are called ?, I ask this as a complete
> newbie to RabbitMQ. 
> -- 
> View this message in context: http://old.nabble.com/asynchronous-RPC---activation-with-RabbitMQ-tp32716352p32716352.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From alexandru at rabbitmq.com  Tue Oct 25 11:49:36 2011
From: alexandru at rabbitmq.com (Alexandru Scvortov)
Date: Tue, 25 Oct 2011 11:49:36 +0100
Subject: [rabbitmq-discuss] asynchronous RPC / activation with RabbitMQ
In-Reply-To: <20111025104453.GD3231@southbank>
References: <32716352.post@talk.nabble.com> <20111025104453.GD3231@southbank>
Message-ID: <20111025104936.GE3231@southbank>

> Have a look at the examples in your preferred language:
>   http://hg.rabbitmq.com/rabbitmq-java-client/file/default/test/src/com/rabbitmq/examples/
>   http://hg.rabbitmq.com/rabbitmq-dotnet-client/file/default/projects/examples/client/
> You'll be looking for the client/server pairs.

Actually, it seems we have a Python tutorial for RPC:
  http://www.rabbitmq.com/tutorials/tutorial-six-python.html

On Tue, Oct 25, 2011 at 11:44:53AM +0100, Alexandru Scvor?ov wrote:
> > Is it possible with RabbitMQ to implement asynchronous remote procedure calls
> > and throttle the rate at which these are called ?,
> 
> Probably.  You can certainly do RPC, asynchronous messaging and
> rate throttling with RabbitMQ.
> 
> Have a look at the examples in your preferred language:
>   http://hg.rabbitmq.com/rabbitmq-java-client/file/default/test/src/com/rabbitmq/examples/
>   http://hg.rabbitmq.com/rabbitmq-dotnet-client/file/default/projects/examples/client/
> You'll be looking for the client/server pairs.
> 
> I'm not sure what you mean by *asynchronous* RPC.  I think you mean
> "send a message"/"a bit later, a reply comes back".
> 
> > throttle the rate at which these are called 
> 
> Depending on what you mean, that may be a bit hard.  There's no way in
> RabbitMQ to throttle producers (you can certainly write throttling into
> your clients, but a rogue producer will still be able to dump a lot of
> messages onto RabbitMQ).  The consumer can still throttle the broker,
> though.  So, the broker is going to be the one overloaded with
> messages; in this case, it will start writing messages to disk; only if
> it is really having problems with lack of memory, will it throttle
> publishers.
> 
> Hope this helps.
> 
> Cheers,
> Alex
> 
> On Tue, Oct 25, 2011 at 03:10:33AM -0700, ChrisAdkin wrote:
> > 
> > Is it possible with RabbitMQ to implement asynchronous remote procedure calls
> > and throttle the rate at which these are called ?, I ask this as a complete
> > newbie to RabbitMQ. 
> > -- 
> > View this message in context: http://old.nabble.com/asynchronous-RPC---activation-with-RabbitMQ-tp32716352p32716352.html
> > Sent from the RabbitMQ mailing list archive at Nabble.com.
> > 
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From irmo.manie at gmail.com  Tue Oct 25 11:54:06 2011
From: irmo.manie at gmail.com (Irmo Manie)
Date: Tue, 25 Oct 2011 12:54:06 +0200
Subject: [rabbitmq-discuss] Clustered queues and bindings dropped when
 sending large messages
In-Reply-To: <4EA69149.3040006@rabbitmq.com>
References: <CAAcXTObGjA8xcxPrYH1caxDOf5L=u4QSJVnysFSdJpU+G6Xx5g@mail.gmail.com>
	<4EA68D9E.9090204@rabbitmq.com> <4EA69149.3040006@rabbitmq.com>
Message-ID: <CAAcXTOYbE8=XsT1gqsn15MV9iA+QcXDaMrOdxjHpLPRVsdRjcA@mail.gmail.com>

It does take more than 60 seconds yes.
For testing we use some remote virtual machines which are a bit
sluggish (read: horribly slow) on the I/O.
But the nodes already get partitioned in about 15-20 seconds which
doesn't really match the default earliest possibility of 45 seconds.

Next to this, there is no way that the cluster will try to
re-partition after such incident?

- Irmo

Any reason why it won't re-partition after the message is finally delivered

On Tue, Oct 25, 2011 at 12:36 PM, Simon MacMullen <simon at rabbitmq.com> wrote:
> On 25/10/11 11:21, Simon MacMullen wrote:
>>
>> That sounds almost like the cluster is getting partitioned
>
> Matthias points out that this can indeed happen, if transmitting one message
> across the cluster takes longer than the configured ticktime (see
> net_ticktime at http://www.erlang.org/doc/man/kernel_app.html). But by
> default that's 60s, and we don't change it. Is your cluster that slow?
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From alexandru at rabbitmq.com  Tue Oct 25 12:06:26 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Tue, 25 Oct 2011 12:06:26 +0100
Subject: [rabbitmq-discuss] asynchronous RPC / activation with RabbitMQ
In-Reply-To: <1319539765.443.YahooMailNeo@web24104.mail.ird.yahoo.com>
References: <32716352.post@talk.nabble.com> <20111025104453.GD3231@southbank>
	<1319539765.443.YahooMailNeo@web24104.mail.ird.yahoo.com>
Message-ID: <20111025110624.GF3231@southbank>

Hi Chris,

> By "Asynchronous?RPC" what I am after is the ability for a task to fire off when an item is enqueued without the client having to hang around for any response. Also by throttling, what I was referring to was the ability to limit the number of RPCs that are fired off?concurrently. Please forgive me?explanation, as it may have caused some confusion.

There isn't any automatic way to limit the number of messages a
producer can publish without its cooperation.  You'll have to write that
on top of RabbitMQ; the producers will have to keep track of how many
unanswered requests they've made.  It's not hard to do; several of our
example programs (in particular MulticastMain.java) do this sort of
throttling.

There are a bunch of tutorials that build up to an RPC system:
  http://www.rabbitmq.com/getstarted.html
On top of that, you'll just need to do the throttling.

Cheers,
Alex

On Tue, Oct 25, 2011 at 11:49:25AM +0100, Chris Adkin wrote:
> Hi Alexandru,
> 
> By "Asynchronous?RPC" what I am after is the ability for a task to fire off when an item is enqueued without the client having to hang around for any response. Also by throttling, what I was referring to was the ability to limit the number of RPCs that are fired off?concurrently. Please forgive me?explanation, as it may have caused some confusion.
> 
> Regards,
> 
> Chris
> 
> 
> 
> 
> ________________________________
> From: Alexandru Scvor?ov <alexandru at rabbitmq.com>
> To: ChrisAdkin <chris1adkin at yahoo.co.uk>
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Sent: Tuesday, 25 October 2011, 11:44
> Subject: Re: [rabbitmq-discuss]  asynchronous RPC / activation with RabbitMQ
> 
> > Is it possible with RabbitMQ to implement asynchronous remote procedure calls
> > and throttle the rate at which these are called ?,
> 
> Probably.? You can certainly do RPC, asynchronous messaging and
> rate throttling with RabbitMQ.
> 
> Have a look at the examples in your preferred language:
> ? http://hg.rabbitmq.com/rabbitmq-java-client/file/default/test/src/com/rabbitmq/examples/
> ? http://hg.rabbitmq.com/rabbitmq-dotnet-client/file/default/projects/examples/client/
> You'll be looking for the client/server pairs.
> 
> I'm not sure what you mean by *asynchronous* RPC.? I think you mean
> "send a message"/"a bit later, a reply comes back".
> 
> > throttle the rate at which these are called 
> 
> Depending on what you mean, that may be a bit hard.? There's no way in
> RabbitMQ to throttle producers (you can certainly write throttling into
> your clients, but a rogue producer will still be able to dump a lot of
> messages onto RabbitMQ).? The consumer can still throttle the broker,
> though.? So, the broker is going to be the one overloaded with
> messages; in this case, it will start writing messages to disk; only if
> it is really having problems with lack of memory, will it throttle
> publishers.
> 
> Hope this helps.
> 
> Cheers,
> Alex
> 
> On Tue, Oct 25, 2011 at 03:10:33AM -0700, ChrisAdkin wrote:
> > 
> > Is it possible with RabbitMQ to implement asynchronous remote procedure calls
> > and throttle the rate at which these are called ?, I ask this as a complete
> > newbie to RabbitMQ. 
> > -- 
> > View this message in context: http://old.nabble.com/asynchronous-RPC---activation-with-RabbitMQ-tp32716352p32716352.html
> > Sent from the RabbitMQ mailing list archive at Nabble.com.
> > 
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simon at rabbitmq.com  Tue Oct 25 12:26:49 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 25 Oct 2011 12:26:49 +0100
Subject: [rabbitmq-discuss] RabbitMQ writes non stop to disk
In-Reply-To: <CAD7X3-nRLHv+uEf0Vy3JTzW8WRNvUW4vSszykU4F=WCEouM5SA@mail.gmail.com>
References: <CAD7X3-nRLHv+uEf0Vy3JTzW8WRNvUW4vSszykU4F=WCEouM5SA@mail.gmail.com>
Message-ID: <4EA69CF9.7010809@rabbitmq.com>

On 25/10/11 02:07, Raphael Simon wrote:
> Hello all,
>
> We are seeing an issue on a production broker where the RabbitMQ process
> writes non stop to files in mnesia/<node>/msg_store_persistent. It keeps
> creating new files and the problem seems to be getting worse. Listing
> the files in that directory shows that it's creating a new 16 MB file
> every 2 to 4 minutes [1].
>
> The throughput of persistent messages in this broker is orders of
> magnitude less (maybe 20 msg/sec at the most, each being in the 10s of KB) .

Umm, if you average 10 msg/s and 30kB each (picking figures out of the 
air), that's 300kB/s. 16MB takes less than a minute to write at that 
speed. What were you expecting to see?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From maxjwarnock at gmail.com  Tue Oct 25 15:12:22 2011
From: maxjwarnock at gmail.com (Max Warnock)
Date: Tue, 25 Oct 2011 10:12:22 -0400
Subject: [rabbitmq-discuss] Frequently getting {badmatch, {error,
 einval} from one of my rabbimq nodes
In-Reply-To: <CAApCF472FzOurxA2G1wRJakmSoxi_JfrLamNd_jLgOE74Bp9zg@mail.gmail.com>
References: <bb1ddfc2-0886-485e-8a02-09434ce92c53@t8g2000prm.googlegroups.com>
	<20110720211414.GB12886@dakota>
	<73926954-e458-4bc2-90e6-a490c69ce8f3@v11g2000prn.googlegroups.com>
	<67be1e43-db8e-4069-9354-502a1c04d294@p29g2000pre.googlegroups.com>
	<20110727163850.GC3188@dakota.eng.vmware.com>
	<CAApCF467P8bPu41NPzmNpxnvNFc8bgNiaRZbXVdD1=19PvW4HA@mail.gmail.com>
	<CAApCF472FzOurxA2G1wRJakmSoxi_JfrLamNd_jLgOE74Bp9zg@mail.gmail.com>
Message-ID: <CAApCF44MQjEn+sDUJJJoeuXbaRCHdtnT5BFE-DkWQ=TA7xv2bw@mail.gmail.com>

I believe I've figured out how to duplicate this problem. It manifests when
many connections and channels are opened, send a few messages (around 20),
and are closed very fast (around 100 a second). Obviously this is not
advisable behavior for the library. It was a quick hack in my code that
worked in testing and so was forgotten about. As soon as I went back and
made a persistent connection and channel for sending messages the problem
went away.

-Max

On Fri, Sep 30, 2011 at 8:57 AM, Max Warnock <maxjwarnock at gmail.com> wrote:

> Has anyone had any more thoughts on this? I'm still getting this error and
> it's making my software queue up about 10 for every 100,000 messages in the
> unacked queue. If I restart my server it will process those messages just
> fine.
> -Max
>
>
> On Thu, Aug 18, 2011 at 4:26 PM, Max Warnock <maxjwarnock at gmail.com>wrote:
>
>> I have been getting the same error, you're not crazy Chak.  The exact
>> message for me is:
>>
>> =ERROR REPORT==== 18-Aug-2011::16:17:35 ===
>> ** Generic server <0.28256.0> terminating
>> ** Last message in was {inet_async,#Port<0.29961>,47384,
>>                                    {ok,<<0,10,0,51,206>>}}
>> ** When Server state == {state,#Port<0.29961>,<0.28252.0>,<0.28253.0>,
>>                                 {method,rabbit_framing_amqp_0_9_1},
>>                                {1,0,4}}
>> ** Reason for termination ==
>> ** {{badmatch,{error,einval}},
>>     [{amqp_main_reader,handle_inet_async,2},
>>      {gen_server,handle_msg,5},
>>      {proc_lib,init_p_do_apply,3}]}
>>
>> I get this when I have a large number of messages going over a single
>> connection and channel (topic exchange, subscription based pulling).  I'm
>> running
>> Erlang R13B04 (erts-5.7.5).
>>
>> Regards,
>> -Max
>>
>>
>> On Wed, Jul 27, 2011 at 12:38 PM, Alexandru Scvor?ov <
>> alexandru at rabbitmq.com> wrote:
>>
>>> Hi Chak,
>>>
>>> I've been trying for a while, but I can't reproduce this.
>>>
>>> That error is coming from deep inside Erlang's inet driver.  As far as I
>>> can tell, the only way to get that error would be to call
>>> prim_inet:async_recv/3 on a socket with a {packet, Packet} setting
>>> different from 'raw'.  But this can't happen on any version of rabbit.
>>>
>>> Could you give us a more detailed description of the program?  Is it a
>>> plugin?  Is it doing anything special with the connection? (like setting
>>> socket options after the connection is established) Is there any chance
>>> we could see the code?
>>>
>>> You mentioned it starts at the very beginning.  Does this mean the
>>> problem goes away after some time?
>>>
>>> Cheers,
>>> Alex
>>>
>>>
>>> On Thu, Jul 21, 2011 at 07:48:29PM -0700, Chak Hedik wrote:
>>> > Hi Alex,
>>> >
>>> > Seems like this error is still there and it seems like either it
>>> > occurred when worker entering the loop and send another message to the
>>> > same queue within the loop or occurred when function retry, means
>>> > function call itself for a retry (pretty much like loop also).
>>> >
>>> > Thanks,
>>> > Chak
>>> >
>>> > On Jul 21, 6:40 am, Chak Hedik <chakhe... at gmail.com> wrote:
>>> > > Hi Alex,
>>> > >
>>> > > *Ubuntu Server 11.04 64-Bit
>>> > > *RabbitMQ 2.3.1 (Default ubuntu package)
>>> > > *Erlang Client 2.3.1 (Default ubuntu package)
>>> > > *Erlang R13B03 (Default ubuntu package)
>>> > >
>>> > > Is there something in the server logs that corresponds to this error?
>>> > > - That's the only thing appeared in the logs.
>>> > >
>>> > > You say your other nodes don't have similar issues.  Is there
>>> > > something
>>> > > special about this node?
>>> > > - Nothing special, pretty much the same but handle more messages than
>>> > > others. 1 worker handling 1 queue.
>>> > >
>>> > > It is strange behaviour and it happen at the very beginning where the
>>> > > worker up for the first time (no message in queue yet). I've created
>>> > > another node and put this worker there and will wait and see if
>>> > > similar error appear again or not today.
>>> > >
>>> > > Thanks for your reply.
>>> > >
>>> > > Chak
>>> > >
>>> > > On Jul 21, 5:14 am, Alexandru Scvor?ov <alexan... at rabbitmq.com>
>>> wrote:
>>> > >
>>> > >
>>> > >
>>> > >
>>> > >
>>> > >
>>> > >
>>> > > > Hi Chak,
>>> > >
>>> > > > Could you please answer the following questions:
>>> > > > * What OS are you using?
>>> > > > * What version of RabbitMQ?
>>> > > > * What version of the Erlang client?
>>> > > > * What version of Erlang?
>>> > >
>>> > > > > ** Reason for termination ==
>>> > > > > ** {{badmatch,{error,einval}},
>>> > > > >     [{amqp_main_reader,handle_inet_async,2},
>>> > > > >      {gen_server,handle_msg,5},
>>> > > > >      {proc_lib,init_p_do_apply,3}]}
>>> > >
>>> > > > Looks like something strange is taking down the socket, which in
>>> turn is
>>> > > > taking down the entire connection.  If you have more than one
>>> > > > connection, the others should be fine.
>>> > >
>>> > > > Is there something in the server logs that corresponds to this
>>> error?
>>> > >
>>> > > > You say your other nodes don't have similar issues.  Is there
>>> something
>>> > > > special about this node?
>>> > >
>>> > > > Cheers,
>>> > > > Alex
>>> > >
>>> > > > On Wed, Jul 20, 2011 at 12:12:32AM -0700, Chak Hedik wrote:
>>> > > > > Hi,
>>> > >
>>> > > > > I frequently getting this terminating error from one of my nodes
>>> :
>>> > >
>>> > > > > ** Generic server <0.28067.2> terminating
>>> > > > > ** Last message in was {inet_async,#Port<0.15349>,9049,
>>> > > > > {ok,<<0,10,0,51,206>>}}
>>> > > > > ** When Server state ==
>>> {state,#Port<0.15349>,<0.28063.2>,<0.28064.2>,
>>> > > > >
>>>  {method,rabbit_framing_amqp_0_9_1},
>>> > > > >                                {1,0,4}}
>>> > > > > ** Reason for termination ==
>>> > > > > ** {{badmatch,{error,einval}},
>>> > > > >     [{amqp_main_reader,handle_inet_async,2},
>>> > > > >      {gen_server,handle_msg,5},
>>> > > > >      {proc_lib,init_p_do_apply,3}]}
>>> > >
>>> > > > > While several other nodes with the same setup didn't have the
>>> same
>>> > > > > issue. May I know what it means and willl it affect my queues?How
>>> do I
>>> > > > > fix this?
>>> > >
>>> > > > > Thank,
>>> > > > > Chak
>>> > > > > _______________________________________________
>>> > > > > rabbitmq-discuss mailing list
>>> > > > > rabbitmq-disc... at lists.rabbitmq.com
>>> > > > >
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> > >
>>> > > > _______________________________________________
>>> > > > rabbitmq-discuss mailing list
>>> > > > rabbitmq-disc... at lists.rabbitmq.comhttps://
>>> lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> > >
>>> > > _______________________________________________
>>> > > rabbitmq-discuss mailing list
>>> > > rabbitmq-disc... at lists.rabbitmq.comhttps://
>>> lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> > _______________________________________________
>>> > rabbitmq-discuss mailing list
>>> > rabbitmq-discuss at lists.rabbitmq.com
>>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111025/3eb1cd20/attachment.htm>

From alexandru at rabbitmq.com  Tue Oct 25 16:14:33 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Tue, 25 Oct 2011 16:14:33 +0100
Subject: [rabbitmq-discuss] RabbitMQ Shovel Connections
In-Reply-To: <13456440.173.1319125870200.JavaMail.geo-discussion-forums@yqja14>
References: <4E7929EC.1070906@omc-international.com.au>
	<4E7A7266.5050800@omc-international.com.au>
	<20110926115420.GC31944@rabbitmq.com>
	<13456440.173.1319125870200.JavaMail.geo-discussion-forums@yqja14>
Message-ID: <20111025151433.GG3231@southbank>

Hi Jelle,

Sorry for the late reply.

> When the broker is in such a situation, I have found that restarting 
> RabbitMQ with the init scripts is not possible. 

That's interesting.

When the broker reaches the situation, could you try running:
  > rabbitmqctl status
  > rabbitmqclt report
and post the output here?

Could you also check if any errors are being reported in the rabbit and
sasl logs?

Once you do this, could you try stopping rabbit with
  > rabbitmqctl stop
?

All of the above is geared towards finding out why the broker isn't
shutting down.

Cheers,
Alex

On Thu, Oct 20, 2011 at 08:51:10AM -0700, Jelle Smet wrote:
> Hi,
> 
> I have a newly installed setup running RabbitMQ version 2.6.1 and the Shovel 
> plugin downloaded from: 
> http://www.rabbitmq.com/releases/plugins/v2.6.1/rabbitmq_shovel-2.6.1.ez.
> I came across a few occasions which look similar to Mihir's situation.
> On my side no messages are lost, but they just keep sitting unacknowledged 
> in the source broker. Restarting the source broker RabbitMQ the solves the 
> problem.
> When the broker is in such a situation, I have found that restarting 
> RabbitMQ with the init scripts is not possible.  I have to sigkill it and 
> start it again after which everything works again.
> 
> Which output and information I can submit to further troubleshoot this?
> 
> Thanks,
> 
> Jelle
> 
> 

> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From simon at rabbitmq.com  Tue Oct 25 16:22:04 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 25 Oct 2011 16:22:04 +0100
Subject: [rabbitmq-discuss] How to tell Java Client running in a
 separate thread to stop consuming
In-Reply-To: <CAAN_EDr5Kd4rjCJRQFWrLFng2E0Pa3OTh3o=93eLSpO1CS9Bug@mail.gmail.com>
References: <109bc404-24f5-423b-a3c5-2af3ab5bf713@13g2000prp.googlegroups.com>	<60778BB2-58CE-456E-9713-850F3D59C31B@rabbitmq.com>
	<CAAN_EDr5Kd4rjCJRQFWrLFng2E0Pa3OTh3o=93eLSpO1CS9Bug@mail.gmail.com>
Message-ID: <4EA6D41C.3020102@rabbitmq.com>

On 20/10/11 18:58, Adam Rabung wrote:
> Along these same lines, is it considered thread-safe to call
> channel.basicAck from a separate thread while the "host thread" for the
> channel is blocked on QueueingConsumer#nextDeliver?

As far as the client is concerned, there isn't a "host thread" for a 
channel, but Channel is in general not thread-safe. This will be 
addressed in the next release however.

>  Better yet, when is
> it not thread-safe to call basicAck from a separate thread?

Umm, all the time right now.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Tue Oct 25 16:46:34 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 25 Oct 2011 16:46:34 +0100
Subject: [rabbitmq-discuss] Queue Clustering and Sequencing
In-Reply-To: <B925600E2C563A4FA33FA9CF64A455B5031DE82D@LITEXCHEVS1.ventyx.org>
References: <B925600E2C563A4FA33FA9CF64A455B5031DE82D@LITEXCHEVS1.ventyx.org>
Message-ID: <4EA6D9DA.4070701@rabbitmq.com>

It's not completely obvious what you're asking. Are you saying that only 
(all?) messages with the same key are dependent on each other or is it 
something else? Are the messages just in dependent pairs or are they 
streams?

Also, please subscribe to the list if you want to ask questions here.

Cheers, Simon

On 24/10/11 21:05, Roger Fischer wrote:
> Hello,
>
> I am curious if RabbitMQ addresses the following use case.
>
> A single queue. Persistent.
>
> A producer creates messages fast (average 10 msg/sec).
>
> Consumers process messages slow (average 1 msg/sec). Thus 10 consumers
> are required to keep up.
>
> Challenge 1: Some messages (< 1%) are related and need to be processed
> in order. If two dependent messages are less than 10 messages apart,
> they are processed in parallel. That?s a problem.
>
> Obvious solution: create 10 queues, each with a different key, and each
> with only one consumer. But:
>
> * Non-related messages are unnecessarily sequenced. When the key
> distribution is not exactly even, one queue may have a backup while
> another is idle.
>
> * Complex to configure for differently sized systems.
>
> Challenge 1+: earlier message could fail processing and be re-queued
> with a delay. Obvious solution doesn?t fix that.
>
> Desired solution: Queue knows what messages are being processed /
> re-queued and holds messages with the same key.
>
> But that?s not all. Consumers are clustered, with load balancing
> (scalability) and failover (availability).
>
> Challenge 2a: related messages must still be processed by the same
> consumer (and thus loadbalanced to the same node).
>
> Challenge 2b: related messages must be processed in order across node
> failures.
>
> Obvious solution: Solution to 1 and migrate file store and consumer from
> failed node to another node. But:
>
> * Need external system to manage migration.
>
> * Very complex to configure for differently sized systems (different
> workloads, different node sizes and different cluster sizes).
>
> Desired solution: Solution 1 queues, and coordinate across nodes what
> keys have messages being processed or re-queued. Will affect throughput
> (we need only 250 msg/sec).
>
> Thanks?
>
> Roger
>
> PS: Please copy the response to my email (roger dot fischer at abb dot
> Ventyx dot com) as I am not a subscriber of the list.
>
>
>
>
> *Mindshare 2012 | May 8-10 | Orlando, FL *
> *More details coming soon. *
>
> *Dates and location for European Mindshare coming soon. *
>
> DISCLAIMER:
> ------------------------------------------------------------------------
> This email message and all attachments transmitted with it are for the
> sole use of the intended recipient(s) and may contain confidential and
> privileged information. Please DO NOT forward this email outside of the
> recipient's Company unless expressly authorized to do so herein. Any
> unauthorized review, use, disclosure or distribution is prohibited. If
> you are not the intended recipient, please contact the sender by reply
> email and destroy all copies of the original message.
>
> Any views expressed in this email message are those of the individual
> sender except where the sender specifically states them to be the views
> of Ventyx.
>
> ------------------------------------------------------------------------
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From aaron at agoragames.com  Tue Oct 25 16:57:11 2011
From: aaron at agoragames.com (Aaron Westendorf)
Date: Tue, 25 Oct 2011 11:57:11 -0400
Subject: [rabbitmq-discuss] RabbitMQ writes non stop to disk
In-Reply-To: <CAD7X3-nRLHv+uEf0Vy3JTzW8WRNvUW4vSszykU4F=WCEouM5SA@mail.gmail.com>
References: <CAD7X3-nRLHv+uEf0Vy3JTzW8WRNvUW4vSszykU4F=WCEouM5SA@mail.gmail.com>
Message-ID: <CAHiEoM6A0uUx8je9tz_9xvazvwUznQd6pH7KnikV1zPdJPiMqw@mail.gmail.com>

Did you disable vm_memory_high_watermark ?  I've attached graphs of
our disk usage before and after we enabled it.

-Aaron


On Mon, Oct 24, 2011 at 9:07 PM, Raphael Simon <raphael at rightscale.com> wrote:
> Hello all,
> We are seeing an issue on a production broker where the RabbitMQ process
> writes non stop to files in mnesia/<node>/msg_store_persistent. It keeps
> creating new files and the problem seems to be getting worse. Listing the
> files in that directory shows that it's creating a new 16 MB file every 2 to
> 4 minutes [1].
> The throughput of persistent messages in this broker is orders of magnitude
> less (maybe 20 msg/sec at the most, each being in the 10s of KB) .
> Attaching a shell to the broker process I can retrieve the process status of
> the msg_store_persistent server which is the process causing all the writes,
> not sure what to look for though [2].
> There are about 100 messages sitting in queues on that broker so that should
> not cause that many writes, iostat shows about 6000 writes/s.
> Any pointers to where we should be looking would be greatly appreciated.
> Thanks!
> --
> Raphael.
> [1]
> # ls -alt /mnt/rabbitmq/mnesia/rabbit at broker1-1/msg_store_persistent
> total 453196
> -rw-r--r-- 1 rabbitmq rabbitmq ?2973011 2011-10-25 00:55 706.rdq
> drwxr-xr-x 5 rabbitmq rabbitmq ? ? 4096 2011-10-25 00:54 ..
> drwxr-xr-x 2 rabbitmq rabbitmq ? ? 4096 2011-10-25 00:53 .
> -rw-r--r-- 1 rabbitmq rabbitmq 16779002 2011-10-25 00:49 704.rdq
> -rw-r--r-- 1 rabbitmq rabbitmq 16779064 2011-10-25 00:44 703.rdq
> -rw-r--r-- 1 rabbitmq rabbitmq 16778786 2011-10-25 00:39 702.rdq
> -rw-r--r-- 1 rabbitmq rabbitmq 16780428 2011-10-25 00:33 701.rdq
> -rw-r--r-- 1 rabbitmq rabbitmq 16779981 2011-10-25 00:28 700.rdq
> -rw-r--r-- 1 rabbitmq rabbitmq 16779550 2011-10-25 00:24 699.rdq
> -rw-r--r-- 1 rabbitmq rabbitmq 16780493 2011-10-25 00:21 698.rdq
> -rw-r--r-- 1 rabbitmq rabbitmq 16777711 2011-10-25 00:17 697.rdq
> -rw-r--r-- 1 rabbitmq rabbitmq 16782704 2011-10-25 00:13 696.rdq
> -rw-r--r-- 1 rabbitmq rabbitmq ? ? 8991 2011-10-25 00:10 669.rdq
> -rw-r--r-- 1 rabbitmq rabbitmq ? ? 8861 2011-10-25 00:10 667.rdq
> -rw-r--r-- 1 rabbitmq rabbitmq ? ?10469 2011-10-25 00:10 665.rdq
> -rw-r--r-- 1 rabbitmq rabbitmq ? ?54123 2011-10-25 00:10 662.rdq
> -rw-r--r-- 1 rabbitmq rabbitmq ? ?61457 2011-10-25 00:10 658.rdq
> -rw-r--r-- 1 rabbitmq rabbitmq ? ? 6040 2011-10-25 00:10 654.rdq
> -rw-r--r-- 1 rabbitmq rabbitmq 13115149 2011-10-25 00:10 634.rdq
> -rw-r--r-- 1 rabbitmq rabbitmq 16779265 2011-10-25 00:09 695.rdq
> -rw-r--r-- 1 rabbitmq rabbitmq 16808918 2011-10-25 00:03 694.rdq
> -rw-r--r-- 1 rabbitmq rabbitmq 16802844 2011-10-24 23:55 690.rdq
> -rw-r--r-- 1 rabbitmq rabbitmq 16793271 2011-10-24 23:55 689.rdq
> -rw-r--r-- 1 rabbitmq rabbitmq 16810749 2011-10-24 23:54 688.rdq
> -rw-r--r-- 1 rabbitmq rabbitmq 16780809 2011-10-24 23:51 683.rdq
> -rw-r--r-- 1 rabbitmq rabbitmq 16779742 2011-10-24 23:49 682.rdq
> -rw-r--r-- 1 rabbitmq rabbitmq 16778746 2011-10-24 23:44 681.rdq
> -rw-r--r-- 1 rabbitmq rabbitmq 16793650 2011-10-24 23:40 680.rdq
> -rw-r--r-- 1 rabbitmq rabbitmq 16782092 2011-10-24 23:35 679.rdq
> -rw-r--r-- 1 rabbitmq rabbitmq 16788239 2011-10-24 23:31 678.rdq
> -rw-r--r-- 1 rabbitmq rabbitmq 16780959 2011-10-24 23:26 677.rdq
> -rw-r--r-- 1 rabbitmq rabbitmq 16779952 2011-10-24 23:17 675.rdq
> -rw-r--r-- 1 rabbitmq rabbitmq 16777823 2011-10-24 23:05 672.rdq
> -rw-r--r-- 1 rabbitmq rabbitmq 16779687 2011-10-24 23:02 671.rdq
> -rw-r--r-- 1 rabbitmq rabbitmq 17559554 2011-10-24 20:52 633.rdq
> -rw-r--r-- 1 rabbitmq rabbitmq ? ?11847 2011-10-24 20:41 612.rdq
> -rw-r--r-- 1 rabbitmq rabbitmq 16100804 2011-10-24 20:41 523.rdq
> -rw-r--r-- 1 rabbitmq rabbitmq ? ?11314 2011-10-24 18:39 576.rdq
> -rw-r--r-- 1 rabbitmq rabbitmq ? ?28514 2011-10-24 18:16 565.rdq
> -rw-r--r-- 1 rabbitmq rabbitmq ? ?17823 2011-10-24 17:24 561.rdq
> -rw-r--r-- 1 rabbitmq rabbitmq ? ?14774 2011-10-24 13:25 528.rdq
> -rw-r--r-- 1 rabbitmq rabbitmq 10864262 2011-10-24 13:25 0.rdq
> -rw-r--r-- 1 rabbitmq rabbitmq ? ?35908 2011-10-24 13:15 491.rdq
> -rw-r--r-- 1 rabbitmq rabbitmq ? ?48383 2011-10-24 13:06 487.rdq
> -rw-r--r-- 1 rabbitmq rabbitmq ? ?11912 2011-10-24 12:50 484.rdq
> -rw-r--r-- 1 rabbitmq rabbitmq ? ?23881 2011-10-24 06:06 437.rdq
> [2]
> {status,<0.237.0>,
> ? ? ? ? {module,gen_server2},
> ? ? ? ? [[{{#Ref<0.0.3588.227656>,fhc_handle},
> ? ? ? ? ? ?{handle,{file_descriptor,prim_file,{#Port<0.712982>,109}},
> ? ? ? ? ? ? ? ? ? ?14469207,14469207,false,0,1048576,[],true,
>
> ?"/mnt/rabbitmq/mnesia/rabbit at broker1-1/msg_store_persistent/702.rdq",
> ? ? ? ? ? ? ? ? ? ?[raw,binary,write],
> ? ? ? ? ? ? ? ? ? ?[{write_buffer,1048576}],
> ? ? ? ? ? ? ? ? ? ?true,false,
> ? ? ? ? ? ? ? ? ? ?{1319,503146,31340}}},
> ? ? ? ? ? {'$ancestors',[rabbit_sup,<0.73.0>]},
>
> {{"/mnt/rabbitmq/mnesia/rabbit at broker1-1/msg_store_persistent/702.rdq",
> ? ? ? ? ? ? fhc_file},
> ? ? ? ? ? ?{file,0,true}},
> ? ? ? ? ? {fhc_age_tree,{1,
>
> ?{{1319,503146,31340},#Ref<0.0.3588.227656>,nil,nil}}},
> ? ? ? ? ? {'$initial_call',{gen,init_it,7}}],
> ? ? ? ? ?running,<0.74.0>,[],
> ? ? ? ? ?[{header,"Status for generic server msg_store_persistent"},
> ? ? ? ? ? {data,[{"Status",running},
> ? ? ? ? ? ? ? ? ?{"Parent",<0.74.0>},
> ? ? ? ? ? ? ? ? ?{"Logged events",[]},
> ? ? ? ? ? ? ? ? ?{"Queued messages",[]}]},
> ? ? ? ? ? {data,[{"State",
>
> {msstate,"/mnt/rabbitmq/mnesia/rabbit at broker1-1/msg_store_persistent",
> ? ? ? ? ? ? ? ? ? ? ? ? ? ?rabbit_msg_store_ets_index,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ?{state,262201,
>
> "/mnt/rabbitmq/mnesia/rabbit at broker1-1/msg_store_persistent"},
> ? ? ? ? ? ? ? ? ? ? ? ? ? ?702,#Ref<0.0.3588.227656>,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ?{dict,0,16,16,8,80,48,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? [],[]},
>
> ?{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?[],[]}}},
> ? ? ? ? ? ? ? ? ? ? ? ? ? ?[],undefined,53527675,424756530,[],<0.240.0>,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ?266298,258104,270395,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ?{set,0,16,16,8,80,48,
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?[]},
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? [],[]}}},
> ? ? ? ? ? ? ? ? ? ? ? ? ? ?{dict,24974,6019,8192,4096,30095,18057,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? [],[]},
>
> ?{{[[<<109,81,35,172,101,10,100,5,139,235,37,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?207,134,159,97,123>>|
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?{#Fun<rabbit_variable_queue.1.360644>,
>
> #Fun<rabbit_variable_queue.20.77393657>}],
>
> [<<98,60,3,61,105,99,34,128,158,37,55,121,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?53,68,253,77>>|
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?{#Fun<rabbit_variable_queue.1.360644>,
>
> #Fun<rabbit_variable_queue.20.77393657>}],
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? [<<224,253,10,145,132,16,186,61,192,63,
> ..... lots of stuff snipped ....
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?[],[]},
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?[],[]}}},
> ? ? ? ? ? ? ? ? ? ? ? ? ? ?false,16777216,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ?{dict,0,16,16,8,80,48,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? [],[]},
>
> ?{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?[],[]}}}}}]}]]}
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com
-------------- next part --------------
A non-text attachment was scrubbed...
Name: diskstats_throughput-week.png
Type: image/png
Size: 23154 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111025/35d5180c/attachment.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: diskstats_iops-week.png
Type: image/png
Size: 22542 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111025/35d5180c/attachment-0001.png>

From simon at rabbitmq.com  Tue Oct 25 16:59:28 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 25 Oct 2011 16:59:28 +0100
Subject: [rabbitmq-discuss] JSonRpc Client/Server - when exception
	occurs...
In-Reply-To: <CAJ2-Vrnj0JbA6GjCm28qqWXqdw+_wWHKHN5j1sHa-YZFKMvD=w@mail.gmail.com>
References: <CAJ2-Vrnj0JbA6GjCm28qqWXqdw+_wWHKHN5j1sHa-YZFKMvD=w@mail.gmail.com>
Message-ID: <4EA6DCE0.8090702@rabbitmq.com>

On 25/10/11 10:58, mysurf mail wrote:
> Hi,
> I am using JSonRpc Client/Server successfully for a year now.
> I have one major problem that I have eventually succeeded reproducing.
>
> I have noticed that when the JsonRPCServer is throwing
> an  uncaught exception
>   ( one that nakes the  RPCServer not return an answer).
> the rabbitmq rpc queue becomes unusable.
> (new client cant connect unless I restart the rabbitmq)

I can't replicate this. I tried putting "throw new 
NullPointerException();" in the HelloJsonService impl inside the example 
HelloJsonServer and things happen correctly - the server stays up, an 
error message is transferred to the client, and the broker stays working.

It's hard to see how a crashing client could wedge the server like that. 
Can you show some example code?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Tue Oct 25 17:01:39 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 25 Oct 2011 17:01:39 +0100
Subject: [rabbitmq-discuss] getting authentication failure Exception?
In-Reply-To: <9f5cbb49-ab84-4186-9773-bb5bf9f38207@f16g2000yqk.googlegroups.com>
References: <32629116.post@talk.nabble.com>
	<4E93FA1B.50100@rabbitmq.com>	<69c5e156-ea08-430c-8146-f0ce7b0fcc79@v15g2000vbm.googlegroups.com>
	<9f5cbb49-ab84-4186-9773-bb5bf9f38207@f16g2000yqk.googlegroups.com>
Message-ID: <4EA6DD63.8080806@rabbitmq.com>

Hi Thadeu,

On 20/10/11 17:22, Thadeu Russo wrote:
> Hi, I could make it work with a simple approach, but I think this is
> something that requires some attention from the rabbitmq dev team.
> 
> My computers were connected using a wireless router that had no
> connection to the internet. I assume it was giving me 'fake' ips. When
> I plugged the internet cable everything was working fine. So here is
> my question to rabbitmq dev team: Is rabbitmq not accepting 'fake' ip
> addresses?

RabbitMQ treats private IP addresses (RFC1918) the same way as any other
IP address. You should have no problem using public or private addresses.

If you required an internet connection then you were possibly relying on
a DNS server. Try adding entries to the hosts file or using IP numbers
instead.



Emile

From simon at rabbitmq.com  Tue Oct 25 17:04:45 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 25 Oct 2011 17:04:45 +0100
Subject: [rabbitmq-discuss] RabbitMQ writes non stop to disk
In-Reply-To: <CAHiEoM6A0uUx8je9tz_9xvazvwUznQd6pH7KnikV1zPdJPiMqw@mail.gmail.com>
References: <CAD7X3-nRLHv+uEf0Vy3JTzW8WRNvUW4vSszykU4F=WCEouM5SA@mail.gmail.com>
	<CAHiEoM6A0uUx8je9tz_9xvazvwUznQd6pH7KnikV1zPdJPiMqw@mail.gmail.com>
Message-ID: <4EA6DE1D.7060804@rabbitmq.com>

On 25/10/11 16:57, Aaron Westendorf wrote:
> Did you disable vm_memory_high_watermark ?  I've attached graphs of
> our disk usage before and after we enabled it.

Presumably you are using transient messages? If changing 
vm_memory_high_watermark causes a drop in disk usage presumably you are 
no longer paging transient messages out. But persistent messages will 
always get paged out ;) [0]

Cheers, Simon

[0] Inevitably, there are exceptions:

* Persistent messages to transient queues aren't really persistent for 
obvious reasons.

* Persistent messages that go straight out to consumers in no-ack mode 
without being enqueued will not be persisted (why would you?)

* In the future, persistent messages that are consumed then acked before 
they get to the disk will have their writes eliminated. (At the moment 
they get written anyway, even though they're no longer relevant.)

-- 
Simon MacMullen
RabbitMQ, VMware

From steve at rabbitmq.com  Tue Oct 25 17:02:43 2011
From: steve at rabbitmq.com (Steve Powell)
Date: Tue, 25 Oct 2011 17:02:43 +0100
Subject: [rabbitmq-discuss] How to tell Java Client running in a
	separate thread to stop consuming
In-Reply-To: <cfb1626e-1bb9-470f-ad3d-fefb9999d2d3@d33g2000prb.googlegroups.com>
References: <109bc404-24f5-423b-a3c5-2af3ab5bf713@13g2000prp.googlegroups.com>
	<60778BB2-58CE-456E-9713-850F3D59C31B@rabbitmq.com>
	<4d4ea5e9-1dca-421c-9837-d692312b9113@p14g2000pra.googlegroups.com>
	<cfb1626e-1bb9-470f-ad3d-fefb9999d2d3@d33g2000prb.googlegroups.com>
Message-ID: <57B0E637-F358-4C18-B13B-9DAAB9524F3A@rabbitmq.com>

dusura,

As I said, there is no 'safe' general mechanism for stopping
one Java Thread from another.  The Interrupt mechanism in Java is
simply a convenience for *very simple cases*, or for debugging,
and cannot be regarded as safe on public interfaces.

In particular:

* changes to the design of a service might involve invoking more
  or fewer other threads (in which case you might be interrupting
  the wrong one);
* services might be invoked which themselves quietly consume
  interrupts;
* interrupts which fail to be trapped (due to timing considerations)
  can contaminate the thread for the next time it is run;
* it is not possible to tell the difference between spurious interrupts
  (part of the Java VM rules for wait(timeout)) and deliberate
  external interrupts.

It is much better to architect a solution. For example, in your case,
send a message to your client application which causes it to perform 
an orderly shutdown (including, one would expect, cancelling consumers 
and closing connections as we have discussed).  The client might
already have such a message architected, or if not, design one.

In the next release of RabbitMQ the thread upon which consumers
perform their callbacks need neither be the client thread, nor the 
connection thread, nor a thread dedicated to a particular channel.

In these circumstances, you are much better off calling a standard
interface like basicCancel().

Steve Powell  (a happy bunny)
----------some definitions from the SPD----------
Rigatoni n. A prime-ministerial grin.
Nigella n. The next bottle-size up from a Nebuchadnezzar.
Homily adv. Rather like a frenchman.

On 21 Oct 2011, at 01:28, dusura wrote:
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-October/015649.html

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111025/7dcc704e/attachment.htm>

From matthew at rabbitmq.com  Tue Oct 25 17:11:32 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 25 Oct 2011 17:11:32 +0100
Subject: [rabbitmq-discuss] RabbitMQ writes non stop to disk
In-Reply-To: <4EA6DE1D.7060804@rabbitmq.com>
References: <CAD7X3-nRLHv+uEf0Vy3JTzW8WRNvUW4vSszykU4F=WCEouM5SA@mail.gmail.com>
	<CAHiEoM6A0uUx8je9tz_9xvazvwUznQd6pH7KnikV1zPdJPiMqw@mail.gmail.com>
	<4EA6DE1D.7060804@rabbitmq.com>
Message-ID: <20111025161131.GC8536@rabbitmq.com>

On Tue, Oct 25, 2011 at 05:04:45PM +0100, Simon MacMullen wrote:
> * In the future, persistent messages that are consumed then acked
> before they get to the disk will have their writes eliminated. (At
> the moment they get written anyway, even though they're no longer
> relevant.)

Ahh, but they potentially only get /some/ of their writes written.
Whereas in the future they potentially get /none/ of their writes
written. ;)

Matthew

From raphael at rightscale.com  Tue Oct 25 17:22:23 2011
From: raphael at rightscale.com (Raphael Simon)
Date: Tue, 25 Oct 2011 09:22:23 -0700
Subject: [rabbitmq-discuss] RabbitMQ writes non stop to disk
In-Reply-To: <4EA675C8.70903@rabbitmq.com>
References: <CAD7X3-nRLHv+uEf0Vy3JTzW8WRNvUW4vSszykU4F=WCEouM5SA@mail.gmail.com>
	<4EA675C8.70903@rabbitmq.com>
Message-ID: <CAD7X3-kZnpheaBwkpBWX0bBJS6LyS2i0v8O9ygTPGGfxBbKEtw@mail.gmail.com>

Hello Emile, thanks for the reply, comments inline.

--
Raphael.

On Tue, Oct 25, 2011 at 1:39 AM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi Raphael,
>
> On 25/10/11 02:07, Raphael Simon wrote:
> > Hello all,
> >
> > We are seeing an issue on a production broker where the RabbitMQ process
> > writes non stop to files in mnesia/<node>/msg_store_persistent. It keeps
> > creating new files and the problem seems to be getting worse. Listing
> > the files in that directory shows that it's creating a new 16 MB file
> > every 2 to 4 minutes [1].
> >
> > The throughput of persistent messages in this broker is orders of
> > magnitude less (maybe 20 msg/sec at the most, each being in the 10s of
> KB) .
>
> > There are about 100 messages sitting in queues on that broker so that
> > should not cause that many writes, iostat shows about 6000 writes/s.
>
> How did you determine this number? Is it constant? I would expect the
> behaviour you describe when some queues keep growing or when the broker
> needs to free up alot of memory.
>

We use collectd in combination with rabbitmqctl (not great for performance
but allows us to know what's going on in the brokers at a glance). So these
numbers are directly reported from a combination of rabbitmqctl and iostat
in this case over the course of days. They are fairly constant.


>
> If the broker is running rabbit version 2.5.0 or later, could you please
> supply the result of "rabbitmqctl report"?
>

We are running rabbit 2.4.1

>
> If it is an older version please run "rabbitmqctl list_queues" with all
> queueinfoitems, and supply both the query and the result. The result of
> "erlang:memory()." from the Erlang shell will also be helpful, as well
> as a copy of the rabbit configuration file, if you have made any
> relevant changes.
>

So as mentioned above the result of rabbitmqctl list_queues is what we
graph/monitor. The box still has plenty of memory (7G free). Here is the
output of erlang:memory():

(rabbit at broker1-1)1> erlang:memory().
[{total,3240343872},
 {processes,1558984664},
 {processes_used,1545242416},
 {system,1681359208},
 {atom,1924057},
 {atom_used,1908273},
 {binary,1456029912},
 {code,12256962},
 {ets,101781296}]

And here is our config:

[{rabbit, [{vm_memory_high_watermark, 0.5}]}].


> Are there any unusual entries in the broker logfile? How often does the
> memory alarm trigger? Are there any entries that appear at the onset of
> the disk activity?
>

Nothing unusual in the logs (sasl log is empty, rabbit log just has the
usual connection starting / stopping).


>
>
> -Emile
>
>
Something I didn't mention in my first email is that we have about 8
brokers running in production and only one is showing these symptoms, the
throughput is about the same through all brokers.

I've dug deeper using an erlang shell and see that two queue processes seem
to be causing most of the reductions. Looking at the corresponding variable
queue state I see that the target_ram_count of the vqstate record is 0.
This is reminiscent of a couple of bugs we had identified with Matthew
Sackman that he fixed in 2.4. I'm happy to provide more information on the
queue processes state if needed.

--
Raphael.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111025/d85b1185/attachment.htm>

From raphael at rightscale.com  Tue Oct 25 17:23:48 2011
From: raphael at rightscale.com (Raphael Simon)
Date: Tue, 25 Oct 2011 09:23:48 -0700
Subject: [rabbitmq-discuss] RabbitMQ writes non stop to disk
In-Reply-To: <4EA69CF9.7010809@rabbitmq.com>
References: <CAD7X3-nRLHv+uEf0Vy3JTzW8WRNvUW4vSszykU4F=WCEouM5SA@mail.gmail.com>
	<4EA69CF9.7010809@rabbitmq.com>
Message-ID: <CAD7X3-nrsELeXAS3=q79Jss_6=cWS3VXEtJ7QBBRnU6wyNy8ew@mail.gmail.com>

All the messages are consumed pretty much immediately. I cannot believe
that our throughput would cause a sustained 6000 writes/s. It doesn't on
all the other brokers (sorry forgot to mention this only happens on one
broker).

--
Raphael.

On Tue, Oct 25, 2011 at 4:26 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 25/10/11 02:07, Raphael Simon wrote:
>
>> Hello all,
>>
>> We are seeing an issue on a production broker where the RabbitMQ process
>> writes non stop to files in mnesia/<node>/msg_store_**persistent. It
>> keeps
>> creating new files and the problem seems to be getting worse. Listing
>> the files in that directory shows that it's creating a new 16 MB file
>> every 2 to 4 minutes [1].
>>
>> The throughput of persistent messages in this broker is orders of
>> magnitude less (maybe 20 msg/sec at the most, each being in the 10s of
>> KB) .
>>
>
> Umm, if you average 10 msg/s and 30kB each (picking figures out of the
> air), that's 300kB/s. 16MB takes less than a minute to write at that speed.
> What were you expecting to see?
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111025/95cb60e7/attachment.htm>

From jasonjwwilliams at gmail.com  Tue Oct 25 17:25:33 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Tue, 25 Oct 2011 10:25:33 -0600
Subject: [rabbitmq-discuss] rabbitmqctl not showing owner_pid for mirrored
	queues
Message-ID: <CAHZAEpeATw+MYS6qAkeB-tbODkBaGEaLhiAg_sijCVNdjsqb2g@mail.gmail.com>

Hey Guys,

When I run `rabbitmqctl list_queues` and spec owner_pid as a field,
mirrored queues don't seem to show that field:

Phantome:jasonjwwilliams  $ /opt/rabbitmq-server/sbin/rabbitmqctl -n
rabbit2 at Phantome list_queues name owner_pid slave_pids
Listing queues ...
hello-queue		[<rabbit2 at Phantome.1.1904.0>]
...done.


How can you determine the owner/master of a mirrored queue from the
command line?

-J

From raphael at rightscale.com  Tue Oct 25 17:26:54 2011
From: raphael at rightscale.com (Raphael Simon)
Date: Tue, 25 Oct 2011 09:26:54 -0700
Subject: [rabbitmq-discuss] RabbitMQ writes non stop to disk
In-Reply-To: <CAHiEoM6A0uUx8je9tz_9xvazvwUznQd6pH7KnikV1zPdJPiMqw@mail.gmail.com>
References: <CAD7X3-nRLHv+uEf0Vy3JTzW8WRNvUW4vSszykU4F=WCEouM5SA@mail.gmail.com>
	<CAHiEoM6A0uUx8je9tz_9xvazvwUznQd6pH7KnikV1zPdJPiMqw@mail.gmail.com>
Message-ID: <CAD7X3-kA0DZGgdh2U95oFx-FoVPHes-Bq5bSQ9CfVBzacHzxQQ@mail.gmail.com>

Interesting we did not disable it. What is the flip side of doing this?

--
Raphael.

On Tue, Oct 25, 2011 at 8:57 AM, Aaron Westendorf <aaron at agoragames.com>wrote:

> Did you disable vm_memory_high_watermark ?  I've attached graphs of
> our disk usage before and after we enabled it.
>
> -Aaron
>
>
> On Mon, Oct 24, 2011 at 9:07 PM, Raphael Simon <raphael at rightscale.com>
> wrote:
> > Hello all,
> > We are seeing an issue on a production broker where the RabbitMQ process
> > writes non stop to files in mnesia/<node>/msg_store_persistent. It keeps
> > creating new files and the problem seems to be getting worse. Listing the
> > files in that directory shows that it's creating a new 16 MB file every
> 2 to
> > 4 minutes [1].
> > The throughput of persistent messages in this broker is orders of
> magnitude
> > less (maybe 20 msg/sec at the most, each being in the 10s of KB) .
> > Attaching a shell to the broker process I can retrieve the process
> status of
> > the msg_store_persistent server which is the process causing all the
> writes,
> > not sure what to look for though [2].
> > There are about 100 messages sitting in queues on that broker so that
> should
> > not cause that many writes, iostat shows about 6000 writes/s.
> > Any pointers to where we should be looking would be greatly appreciated.
> > Thanks!
> > --
> > Raphael.
> > [1]
> > # ls -alt /mnt/rabbitmq/mnesia/rabbit at broker1-1/msg_store_persistent
> > total 453196
> > -rw-r--r-- 1 rabbitmq rabbitmq  2973011 2011-10-25 00:55 706.rdq
> > drwxr-xr-x 5 rabbitmq rabbitmq     4096 2011-10-25 00:54 ..
> > drwxr-xr-x 2 rabbitmq rabbitmq     4096 2011-10-25 00:53 .
> > -rw-r--r-- 1 rabbitmq rabbitmq 16779002 2011-10-25 00:49 704.rdq
> > -rw-r--r-- 1 rabbitmq rabbitmq 16779064 2011-10-25 00:44 703.rdq
> > -rw-r--r-- 1 rabbitmq rabbitmq 16778786 2011-10-25 00:39 702.rdq
> > -rw-r--r-- 1 rabbitmq rabbitmq 16780428 2011-10-25 00:33 701.rdq
> > -rw-r--r-- 1 rabbitmq rabbitmq 16779981 2011-10-25 00:28 700.rdq
> > -rw-r--r-- 1 rabbitmq rabbitmq 16779550 2011-10-25 00:24 699.rdq
> > -rw-r--r-- 1 rabbitmq rabbitmq 16780493 2011-10-25 00:21 698.rdq
> > -rw-r--r-- 1 rabbitmq rabbitmq 16777711 2011-10-25 00:17 697.rdq
> > -rw-r--r-- 1 rabbitmq rabbitmq 16782704 2011-10-25 00:13 696.rdq
> > -rw-r--r-- 1 rabbitmq rabbitmq     8991 2011-10-25 00:10 669.rdq
> > -rw-r--r-- 1 rabbitmq rabbitmq     8861 2011-10-25 00:10 667.rdq
> > -rw-r--r-- 1 rabbitmq rabbitmq    10469 2011-10-25 00:10 665.rdq
> > -rw-r--r-- 1 rabbitmq rabbitmq    54123 2011-10-25 00:10 662.rdq
> > -rw-r--r-- 1 rabbitmq rabbitmq    61457 2011-10-25 00:10 658.rdq
> > -rw-r--r-- 1 rabbitmq rabbitmq     6040 2011-10-25 00:10 654.rdq
> > -rw-r--r-- 1 rabbitmq rabbitmq 13115149 2011-10-25 00:10 634.rdq
> > -rw-r--r-- 1 rabbitmq rabbitmq 16779265 2011-10-25 00:09 695.rdq
> > -rw-r--r-- 1 rabbitmq rabbitmq 16808918 2011-10-25 00:03 694.rdq
> > -rw-r--r-- 1 rabbitmq rabbitmq 16802844 2011-10-24 23:55 690.rdq
> > -rw-r--r-- 1 rabbitmq rabbitmq 16793271 2011-10-24 23:55 689.rdq
> > -rw-r--r-- 1 rabbitmq rabbitmq 16810749 2011-10-24 23:54 688.rdq
> > -rw-r--r-- 1 rabbitmq rabbitmq 16780809 2011-10-24 23:51 683.rdq
> > -rw-r--r-- 1 rabbitmq rabbitmq 16779742 2011-10-24 23:49 682.rdq
> > -rw-r--r-- 1 rabbitmq rabbitmq 16778746 2011-10-24 23:44 681.rdq
> > -rw-r--r-- 1 rabbitmq rabbitmq 16793650 2011-10-24 23:40 680.rdq
> > -rw-r--r-- 1 rabbitmq rabbitmq 16782092 2011-10-24 23:35 679.rdq
> > -rw-r--r-- 1 rabbitmq rabbitmq 16788239 2011-10-24 23:31 678.rdq
> > -rw-r--r-- 1 rabbitmq rabbitmq 16780959 2011-10-24 23:26 677.rdq
> > -rw-r--r-- 1 rabbitmq rabbitmq 16779952 2011-10-24 23:17 675.rdq
> > -rw-r--r-- 1 rabbitmq rabbitmq 16777823 2011-10-24 23:05 672.rdq
> > -rw-r--r-- 1 rabbitmq rabbitmq 16779687 2011-10-24 23:02 671.rdq
> > -rw-r--r-- 1 rabbitmq rabbitmq 17559554 2011-10-24 20:52 633.rdq
> > -rw-r--r-- 1 rabbitmq rabbitmq    11847 2011-10-24 20:41 612.rdq
> > -rw-r--r-- 1 rabbitmq rabbitmq 16100804 2011-10-24 20:41 523.rdq
> > -rw-r--r-- 1 rabbitmq rabbitmq    11314 2011-10-24 18:39 576.rdq
> > -rw-r--r-- 1 rabbitmq rabbitmq    28514 2011-10-24 18:16 565.rdq
> > -rw-r--r-- 1 rabbitmq rabbitmq    17823 2011-10-24 17:24 561.rdq
> > -rw-r--r-- 1 rabbitmq rabbitmq    14774 2011-10-24 13:25 528.rdq
> > -rw-r--r-- 1 rabbitmq rabbitmq 10864262 2011-10-24 13:25 0.rdq
> > -rw-r--r-- 1 rabbitmq rabbitmq    35908 2011-10-24 13:15 491.rdq
> > -rw-r--r-- 1 rabbitmq rabbitmq    48383 2011-10-24 13:06 487.rdq
> > -rw-r--r-- 1 rabbitmq rabbitmq    11912 2011-10-24 12:50 484.rdq
> > -rw-r--r-- 1 rabbitmq rabbitmq    23881 2011-10-24 06:06 437.rdq
> > [2]
> > {status,<0.237.0>,
> >         {module,gen_server2},
> >         [[{{#Ref<0.0.3588.227656>,fhc_handle},
> >            {handle,{file_descriptor,prim_file,{#Port<0.712982>,109}},
> >                    14469207,14469207,false,0,1048576,[],true,
> >
> >  "/mnt/rabbitmq/mnesia/rabbit at broker1-1/msg_store_persistent/702.rdq",
> >                    [raw,binary,write],
> >                    [{write_buffer,1048576}],
> >                    true,false,
> >                    {1319,503146,31340}}},
> >           {'$ancestors',[rabbit_sup,<0.73.0>]},
> >
> > {{"/mnt/rabbitmq/mnesia/rabbit at broker1-1/msg_store_persistent/702.rdq",
> >             fhc_file},
> >            {file,0,true}},
> >           {fhc_age_tree,{1,
> >
> >  {{1319,503146,31340},#Ref<0.0.3588.227656>,nil,nil}}},
> >           {'$initial_call',{gen,init_it,7}}],
> >          running,<0.74.0>,[],
> >          [{header,"Status for generic server msg_store_persistent"},
> >           {data,[{"Status",running},
> >                  {"Parent",<0.74.0>},
> >                  {"Logged events",[]},
> >                  {"Queued messages",[]}]},
> >           {data,[{"State",
> >
> > {msstate,"/mnt/rabbitmq/mnesia/rabbit at broker1-1/msg_store_persistent",
> >                            rabbit_msg_store_ets_index,
> >                            {state,262201,
> >
> > "/mnt/rabbitmq/mnesia/rabbit at broker1-1/msg_store_persistent"},
> >                            702,#Ref<0.0.3588.227656>,
> >                            {dict,0,16,16,8,80,48,
> >
>  {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
> >                                   [],[]},
> >
> >  {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
> >                                    [],[]}}},
> >                            [],undefined,53527675,424756530,[],<0.240.0>,
> >                            266298,258104,270395,
> >                            {set,0,16,16,8,80,48,
> >
> > {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
> >                                  []},
> >
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
> >                                   [],[]}}},
> >                            {dict,24974,6019,8192,4096,30095,18057,
> >
>  {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
> >                                   [],[]},
> >
> >  {{[[<<109,81,35,172,101,10,100,5,139,235,37,
> >                                        207,134,159,97,123>>|
> >
>  {#Fun<rabbit_variable_queue.1.360644>,
> >
> > #Fun<rabbit_variable_queue.20.77393657>}],
> >
> > [<<98,60,3,61,105,99,34,128,158,37,55,121,
> >                                        53,68,253,77>>|
> >
>  {#Fun<rabbit_variable_queue.1.360644>,
> >
> > #Fun<rabbit_variable_queue.20.77393657>}],
> >
> [<<224,253,10,145,132,16,186,61,192,63,
> > ..... lots of stuff snipped ....
> >
> > {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
> >                                    [],[]},
> >
> > {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
> >                                    [],[]}}},
> >                            false,16777216,
> >                            {dict,0,16,16,8,80,48,
> >
>  {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
> >                                   [],[]},
> >
> >  {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
> >                                    [],[]}}}}}]}]]}
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
>
>
>
> --
> Aaron Westendorf
> Senior Software Engineer
> Agora Games
> 359 Broadway
> Troy, NY 12180
> Phone: 518.268.1000
> aaron at agoragames.com
> www.agoragames.com
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111025/82fbd4df/attachment.htm>

From matthew at rabbitmq.com  Tue Oct 25 17:28:35 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 25 Oct 2011 17:28:35 +0100
Subject: [rabbitmq-discuss] rabbitmqctl not showing owner_pid for
 mirrored queues
In-Reply-To: <CAHZAEpeATw+MYS6qAkeB-tbODkBaGEaLhiAg_sijCVNdjsqb2g@mail.gmail.com>
References: <CAHZAEpeATw+MYS6qAkeB-tbODkBaGEaLhiAg_sijCVNdjsqb2g@mail.gmail.com>
Message-ID: <20111025162834.GD8536@rabbitmq.com>

On Tue, Oct 25, 2011 at 10:25:33AM -0600, Jason J. W. Williams wrote:
> When I run `rabbitmqctl list_queues` and spec owner_pid as a field,
> mirrored queues don't seem to show that field:
> 
> Phantome:jasonjwwilliams  $ /opt/rabbitmq-server/sbin/rabbitmqctl -n
> rabbit2 at Phantome list_queues name owner_pid slave_pids
> Listing queues ...
> hello-queue		[<rabbit2 at Phantome.1.1904.0>]
> ...done.
> 
> 
> How can you determine the owner/master of a mirrored queue from the
> command line?

Owner is not the same as master. Owner refers to the connection that
created the exclusive queue. If the queue was not declared exclusive, it
won't have an owner.

Other queue info items allow you to inspect the various pids of an HA
queue.

Matthew

From simon at rabbitmq.com  Tue Oct 25 17:29:25 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 25 Oct 2011 17:29:25 +0100
Subject: [rabbitmq-discuss] rabbitmqctl not showing owner_pid for
 mirrored queues
In-Reply-To: <CAHZAEpeATw+MYS6qAkeB-tbODkBaGEaLhiAg_sijCVNdjsqb2g@mail.gmail.com>
References: <CAHZAEpeATw+MYS6qAkeB-tbODkBaGEaLhiAg_sijCVNdjsqb2g@mail.gmail.com>
Message-ID: <4EA6E3E5.9050205@rabbitmq.com>

On 25/10/11 17:25, Jason J. W. Williams wrote:
 > When I run `rabbitmqctl list_queues` and spec owner_pid as a field,
 > mirrored queues don't seem to show that field:

You want just "pid".

"owner_pid" is the pid of the connection which owns the queue if the 
queue is exclusive. Otherwise it is absent.

Cheers, Simon
-- 
Simon MacMullen
RabbitMQ, VMware

From majek04 at gmail.com  Tue Oct 25 17:29:45 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Tue, 25 Oct 2011 17:29:45 +0100
Subject: [rabbitmq-discuss] asychronous activation
In-Reply-To: <c75c1dac-f11a-48dd-a6d7-86fc866ca0a9@m19g2000vbm.googlegroups.com>
References: <c75c1dac-f11a-48dd-a6d7-86fc866ca0a9@m19g2000vbm.googlegroups.com>
Message-ID: <CABzX+qyjXOEO464Q-no2US7HQhZ6B46=awJx+B0h_dHrPiik9Q@mail.gmail.com>

On Tue, Oct 25, 2011 at 11:17, Chris Adkin <chrisadkin97 at googlemail.com> wrote:
> Is it possible to use RabbitMq for asynchronous RPCs,

Chris

I'm not sure what you mean by saying "asynchronous RPC".

Take a look at this tutorial:
http://www.rabbitmq.com/tutorials/tutorial-six-python.html

And feel free to modify the code as you wish.

> if so is it also
> possible to throttle the number of RPCs that are called so they dont
> swamp the machine at the receiving end of the queue.

The usual way of making sure that the consumer isn't swamped
is by using AMQP flow control: `channel.flow` command.

If you want the consumer to slow down, you can reduce
`channel.flow` prefetch to one and introduce a delay before
acknowledging a received message. Though I dont think
the latter is generally a good idea.

We could help more if you explained what you're trying to do.

Cheers,
  Marek

From jasonjwwilliams at gmail.com  Tue Oct 25 17:35:43 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Tue, 25 Oct 2011 10:35:43 -0600
Subject: [rabbitmq-discuss] rabbitmqctl not showing owner_pid for
	mirrored queues
In-Reply-To: <4EA6E3E5.9050205@rabbitmq.com>
References: <CAHZAEpeATw+MYS6qAkeB-tbODkBaGEaLhiAg_sijCVNdjsqb2g@mail.gmail.com>
	<4EA6E3E5.9050205@rabbitmq.com>
Message-ID: <CAHZAEpc_UsscwvqJYeEi0-1iLvHz8PfAjeO9SRVMJHYQX-HMgA@mail.gmail.com>

Thanks guys. :)

-J

On Tue, Oct 25, 2011 at 10:29 AM, Simon MacMullen <simon at rabbitmq.com> wrote:
> On 25/10/11 17:25, Jason J. W. Williams wrote:
>> When I run `rabbitmqctl list_queues` and spec owner_pid as a field,
>> mirrored queues don't seem to show that field:
>
> You want just "pid".
>
> "owner_pid" is the pid of the connection which owns the queue if the queue
> is exclusive. Otherwise it is absent.
>
> Cheers, Simon
> --
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From lgreg.meredith at gmail.com  Tue Oct 25 17:45:37 2011
From: lgreg.meredith at gmail.com (Meredith Gregory)
Date: Tue, 25 Oct 2011 09:45:37 -0700
Subject: [rabbitmq-discuss] getting node.js to talk to scala over
	rabbitmq
In-Reply-To: <4EA685AF.4070505@rabbitmq.com>
References: <CAG7cANS5tiOVCq_aj-HDw8gsk+5TF-r=+abnnCkC9T8ZgGSvsA@mail.gmail.com>
	<4EA685AF.4070505@rabbitmq.com>
Message-ID: <CAG7cANSLNkO6VXxNMgVFNY+W_R3kpj3BtUJc2__PJGw_xKAifw@mail.gmail.com>

Dear Simon, et al,

Thanks! Yes, i spotted it almost immediately after i sent the email. ;-) The
two are happily chatting, now.

Best wishes,

--greg

On Tue, Oct 25, 2011 at 2:47 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 25/10/11 00:50, Meredith Gregory wrote:
>
>> Dear Rabbiters,
>>
>> i'm running into a problem getting node.js to talk to scala over
>> rabbitmq. i'm using the node-amqp package with node.js. i installed it
>> using npm install amqp. i'm using the java client for rabbitmq 2.5.1 on
>> the scala side. i've successfully gotten scala to talk to scala
>> and node.js to talk to node.js. However, when i attempt to get node.js
>> to talk to scala there appears to be a disagreement regarding
>> queue declaration. Thus, if i fire up node.js first and look at the
>> queue it creates with the rabbitmq management plugin i see
>>
>>
>>
>> node-simple-direct_queue
>> <http://localhost:55672/mgmt/#**/queues/%2F/node-simple-**direct_queue<http://localhost:55672/mgmt/#/queues/%2F/node-simple-direct_queue>>
>>
>> AD      Idle    0       0       0
>>
>
> So this looks like a transient autodelete queue.
>
>
>  i then attempt to accomplish a connection from the scala side (with code
>> that works on scala-to-scala) and i see an exception when the code calls
>> the queueDeclare method.
>>
>>             channel.exchangeDeclare( exQNameRoot, "direct" )
>>             //channel.queueDeclare(qname, true, false, false, null);
>>    channel.queueDeclare(qname, true, false, true, null); // <-- here we
>> throw an exception
>>
>
> And here you are declaring a durable autodelete queue. That's probably your
> problem.
>
>
>  java.io.IOException
>> at com.rabbitmq.client.impl.**AMQChannel.wrap(AMQChannel.**java:107)
>> at com.rabbitmq.client.impl.**AMQChannel.exnWrappingRpc(**
>> AMQChannel.java:131)
>> at com.rabbitmq.client.impl.**ChannelN.queueDeclare(**ChannelN.java:627)
>> at com.rabbitmq.client.impl.**ChannelN.queueDeclare(**ChannelN.java:59)
>> at
>> com.biosimilarity.lift.lib.**AMQPBrokerScope$**
>> StdMonadicAMQPSndrRcvr.sender(**AMQPMnd.scala:53)
>>
>
> ...but you can unwrap this exception and check, or look in the broker logs
> to see what it's complaining about.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>



-- 
L.G. Meredith
Managing Partner
Biosimilarity LLC
7329 39th Ave SW
Seattle, WA 98136

+1 206.650.3740

http://biosimilarity.blogspot.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111025/9a577430/attachment.htm>

From natester at gmail.com  Tue Oct 25 17:52:20 2011
From: natester at gmail.com (Nathaniel Haggard)
Date: Tue, 25 Oct 2011 10:52:20 -0600
Subject: [rabbitmq-discuss] sslv3 alert handshake failure for TLS Web
 Server certificates
In-Reply-To: <20111024233632.GA3367@southbank.Home>
References: <CAAbnaHaScyuvzWmjyJrwDko3F=N7K=tfJrs5Ot-QvBn7M7qJaQ@mail.gmail.com>
	<20111024233632.GA3367@southbank.Home>
Message-ID: <CAAbnaHafoU54unpbbR_W31XFzkJHDBikyQM=3yj-vd=CnH==+w@mail.gmail.com>

On Mon, Oct 24, 2011 at 5:36 PM, Alexandru Scvor?ov
<alexandru at rabbitmq.com> wrote:
> Hi Nate,
>
>> A certificate with X509v3 Extended Key Usage of "TLS Web Client
>> Authentication" will connect to our rabbitmq-2.4.1 server, but a
>> certificate with "TLS Web Server Authentication" will not.
>
> The broker does not and, to the extent of my knowledge, never did
> inspect those fields in the certificate. ?It normally relies on the
> Erlang's interpretation of a valid certificate (configured via the
> verify and fail_if_no_peer_cert options in rabbitmq.config).
>
> So, are you using the same version of Erlang in both tests?

Yes.

>?What's the
> error in the 2.4.1 broker's log for the failed connection attempt?

=INFO REPORT==== 25-Oct-2011::16:30:06 ===
accepted TCP connection on 0.0.0.0:5671 from 127.0.0.1:50640

=INFO REPORT==== 25-Oct-2011::16:30:06 ===
starting TCP connection <0.20472.193> from 127.0.0.1:50640

=ERROR REPORT==== 25-Oct-2011::16:30:06 ===
SSL: certify_certificate: ./ssl_handshake.erl:566:Fatal error: handshake failure

=ERROR REPORT==== 25-Oct-2011::16:30:06 ===
error on TCP connection <0.20472.193>:{ssl_upgrade_error,esslaccept}

=INFO REPORT==== 25-Oct-2011::16:30:06 ===
closing TCP connection <0.20472.193>


>
>> Is there a configuration option to accept ?"TLS Web Server
>> Authentication" certificates in rabbitmq-2.4.1?
>
> As previously mentioned, RabbitMQ doesn't care about those fields.
> AFAIK, Erlang doesn't either, so something else may be happening.

The tests I'm do go like this:

1. openssl s_client -host 127.0.0.1 -port 5671 -key
keys/serverlike.key -cert keys/serverlike.crt
2. openssl s_client -host 127.0.0.1 -port 5671 -key
keys/clientlike.key -cert keys/clientlike.crt
3. openssl s_client -host myrabbit172 -port 5671 -key
keys/serverlike.key -cert keys/serverlike.crt
4. openssl s_client -host myrabbit172 -port 5671 -key
keys/clientlike.key -cert keys/clientlike.crt

1 fails and 2 passes on rabbitmq-2.4.1 with erlang R14B03.

3 and 4 pass on rabbitmq-1.7.2 with erlang R13B04.



>
> Cheers,
> Alex
>
> On Mon, Oct 24, 2011 at 05:24:33PM -0600, Nathaniel Haggard wrote:
>> A certificate with X509v3 Extended Key Usage of "TLS Web Client
>> Authentication" will connect to our rabbitmq-2.4.1 server, but a
>> certificate with "TLS Web Server Authentication" will not.
>>
>> It fails like this:
>> $ openssl s_client -host 127.0.0.1 -port 5671 -key my.key -cert my.crt
>> CONNECTED(00000003)
>> depth=1 /C=US/ST=../L=...../O=.../CN=testingCA2/emailAddress=me at myhost.mydomain
>> verify error:num=19:self signed certificate in certificate chain
>> verify return:0
>> 6837:error:14094410:SSL routines:SSL3_READ_BYTES:sslv3 alert handshake
>> failure:s3_pkt.c:1102:SSL alert number 40
>> 6837:error:140790E5:SSL routines:SSL23_WRITE:ssl handshake
>> failure:s23_lib.c:188:
>>
>>
>> However, both types of certificate work with rabbitmq-1.7.2.
>>
>> Is there a configuration option to accept ?"TLS Web Server
>> Authentication" certificates in rabbitmq-2.4.1?
>>
>> -Nate
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From roger.fischer at abb.ventyx.com  Tue Oct 25 18:32:26 2011
From: roger.fischer at abb.ventyx.com (RogerF)
Date: Tue, 25 Oct 2011 10:32:26 -0700 (PDT)
Subject: [rabbitmq-discuss] Queue Clustering and Sequencing
In-Reply-To: <4EA6D9DA.4070701@rabbitmq.com>
References: <B925600E2C563A4FA33FA9CF64A455B5031DE82D@LITEXCHEVS1.ventyx.org>
	<4EA6D9DA.4070701@rabbitmq.com>
Message-ID: <5679e3c6-8288-4fb6-9705-e7a2261d2f88@v5g2000vbh.googlegroups.com>

Yes, only messages with the same key depend on each other. The
messages cause a state change of the object identified by the key. A
subsequent message must see the state change maded by the preceeding
message.

Here is an example.

Incoming message sequence (with key):

M1(a), M2(b), M3(b), M4(c), M5(b), M6(d), M7(e), ..., M99(b), ...

M1, M2, M4, M6 and M7 can be processed in any sequence. They have
different keys, and are thus independent.

M3 must only be processed after M2 has complered processing. They have
the same key, and thus are related. The state change effected by M2 in
the database must be visible to M3.

Similar, M5 must only be processed after M3 has completed processing.

M99 also has the same key as M2, M3 and M5. However. M99 arrives so
much after M5 that there is no risk that the state change effected by
M5 is not already committed in the database. Thus M99 can be
arbitrarily load balanced.

Essentially what we want is key-based load balancing with time-limited
affinity.

Roger


From loki77 at gmail.com  Tue Oct 25 18:43:43 2011
From: loki77 at gmail.com (Michael Barrett)
Date: Tue, 25 Oct 2011 10:43:43 -0700
Subject: [rabbitmq-discuss] maximum connections
In-Reply-To: <20111025071752.GC3367@southbank.Home>
References: <C759BE58-3C73-40AC-9092-C3F0EEC31C5A@gmail.com>
	<20111025071752.GC3367@southbank.Home>
Message-ID: <EA9A89D5-DDBE-4592-902F-7E06038BA4E1@gmail.com>

Ahh, sorry - you're correct.  The ulimit for that user wasn't following what was declared in /etc/security/limits.conf (Ubuntu).  It looks like this is because pam isn't enabling limits for that user.

Thanks!

On Oct 25, 2011, at 12:17 AM, Alexandru Scvor?ov wrote:

>> I'm testing out a new rabbitMQ system and noticed that the system seems to stop accepting new connections after around 830 get opened.  Can anyone tell me what would cause it to stop at that point? 
> 
> It ran out of socket descriptors probably (or was getting close to the
> limit and the internal descriptor limiter kicked in).  On my system,
> this limit is 829, by default, so this is likely the cause.
> 
> This is calculated as a fixed fraction of the file descriptor limit.
> 
>> The system ulimit on open files is 4096 (soft & hard) and the rabbitMQ user isn't anywhere near using that many.  Is there anything else that could be responsible for this limit?
> 
> Huh.  Are you sure?  A 830 socket limit corresponds to a 1024 file
> descriptor limit.
> 
> Try enabling the management plugin to see if what the limits are what
> you think they are (the overview page gives a breakdown of the limits
> RabbitMQ knows about).
> 
> What is the output of `ulimit -a`?  What happens if you do a `ulimit -n
> 4096` in the shell before starting rabbitmq-server in the same shell?
> That should increase the maximum number of connection to 3594.
> 
> Cheers,
> Alex
> 
> On Mon, Oct 24, 2011 at 09:04:38PM -0700, Michael Barrett wrote:
>> I'm testing out a new rabbitMQ system and noticed that the system seems to stop accepting new connections after around 830 get opened.  Can anyone tell me what would cause it to stop at that point?  The system ulimit on open files is 4096 (soft & hard) and the rabbitMQ user isn't anywhere near using that many.  Is there anything else that could be responsible for this limit?
>> 
>> Thanks!
>> 
>> --
>> Michael Barrett
>> loki77 at gmail.com
>> 
>> 
>> 
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

--
Michael Barrett
loki77 at gmail.com





From mspetrovic at gmail.com  Tue Oct 25 21:51:26 2011
From: mspetrovic at gmail.com (Mark Petrovic)
Date: Tue, 25 Oct 2011 13:51:26 -0700
Subject: [rabbitmq-discuss] Initial Questions on RabbitMQ and AMQP
Message-ID: <CABMnSbFtaVSja_XutLP9LhCyJYT2K=3h8mt3L5XDrhrYOz=pbg@mail.gmail.com>

Good day.  I have read the RabbitMQ docs and the EAP RabbitMQ in
Action book.  And I'm in the process of evaluating AMQP and Rabbit
specifically for use in a major project.

I generally like what I see in Rabbit, but in the course of my
research, I have run across some statements about it that I would like
to understand better.  For example, this blog post

http://bhavin.directi.com/rabbitmq-vs-apache-activemq-vs-apache-qpid/

makes the following assertions about Rabbit:

1) No ONCE-ONLY semantics. Messages may be sent twice by RabbitMQ to
the consumer(s)

2) Unordered; not FIFO delivery

I'm actually not certain (1) is a criticism of AMQP or Rabbit.  On its
face, it seems morally neutral, yet at the same time it appears to
make an important point.  Some interpretation from people in the know
here would still be helpful and much appreciated.

As for (2), I recognize it as an oversimplication, after reading this
thread in this group:

http://groups.google.com/group/rabbitmq-discuss/browse_thread/thread/19066ba6f2944df8/f9d7d4bea18f2b5a?lnk=gst&q=fifo#

The explanation by Matthias Radestock is helpful, but even after
reading his citation of the AMQP spec with respect to channels and
"single paths", I am still left with the sense that somehow AMQP
recognizes and codes to a world that is not quite so simple as "is- or
isNot-FIFO".  But I cannot put my finger on why, or what exactly is
being said.

Would someone here be kind enough to talk about why section 4.7 of the
0.9.1 spec reads ever so slightly tortured?

And a short discussion of (1) would be very helpful, too.

Thank you very kindly.

Mark P.

-- 
Mark

From mspetrovic at gmail.com  Tue Oct 25 21:09:39 2011
From: mspetrovic at gmail.com (ae6rt)
Date: Tue, 25 Oct 2011 13:09:39 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ and AMQP questions
Message-ID: <f19493fc-9ab0-4cf2-9326-2bb3a380ef07@j15g2000prn.googlegroups.com>

Good day.  I have read the RabbitMQ docs and the EAP RabbitMQ in
Action book.  And I'm in the process of evaluating AMQP and Rabbit
specifically for use in a major project.

I generally like what I see in Rabbit, but in the course of my
research, I have run across some statements about it that I would like
to understand better.  For example, this blog post

http://bhavin.directi.com/rabbitmq-vs-apache-activemq-vs-apache-qpid/

makes the following assertions about Rabbit:

1) No ONCE-ONLY semantics. Messages may be sent twice by RabbitMQ to
the consumer(s)

2) Unordered; not FIFO delivery

I'm actually not certain (1) is a criticism of AMQP or Rabbit.  On its
face, it seems morally neutral, yet at the same time it appears to
make an important point.  Some interpretation from people in the know
here would still be helpful and much appreciated.

As for (2), I recognize it as an oversimplication, after reading this
thread in this group:

http://groups.google.com/group/rabbitmq-discuss/browse_thread/thread/19066ba6f2944df8/f9d7d4bea18f2b5a?lnk=gst&q=fifo#

The explanation by Matthias Radestock is helpful, but even after
reading his citation of the AMQP spec with respect to channels and
"single paths", I am still left with the sense that somehow AMQP
recognizes and codes to a world that is not quite so simple as "is- or
isNot-FIFO".  But I cannot put my finger on why, or what exactly is
being said.

Would someone here be kind enough to talk about why section 4.7 of the
0.9.1 spec reads ever so slightly tortured?

And a short discussion of (1) would be very helpful, too.

Thank you very kindly.

Mark P.




From matthias at rabbitmq.com  Tue Oct 25 22:25:47 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 25 Oct 2011 22:25:47 +0100
Subject: [rabbitmq-discuss] Initial Questions on RabbitMQ and AMQP
In-Reply-To: <CABMnSbFtaVSja_XutLP9LhCyJYT2K=3h8mt3L5XDrhrYOz=pbg@mail.gmail.com>
References: <CABMnSbFtaVSja_XutLP9LhCyJYT2K=3h8mt3L5XDrhrYOz=pbg@mail.gmail.com>
Message-ID: <4EA7295B.1040806@rabbitmq.com>

Mark,

On 25/10/11 21:51, Mark Petrovic wrote:
> 1) No ONCE-ONLY semantics. Messages may be sent twice by RabbitMQ to
> the consumer(s)

That only happens if something went wrong and, in effect, the message is 
"retried".

Once-only / exactly-once are tricky to define, and impossible to 
implement if taken literally. There has been some previous discussion on 
the subject. A quick search of the archives brings up


../rabbitmq-server/scripts/rabbitmqctl delete_user test_user_no_perm
Deleting user "test_user_no_perm" ...
Error: {no_such_user,<<"test_user_no_perm">>}
make[3]: [start_test_broker_node] Error 2 (ignored)


>
> 2) Unordered; not FIFO delivery
>
> I'm actually not certain (1) is a criticism of AMQP or Rabbit.  On its
> face, it seems morally neutral, yet at the same time it appears to
> make an important point.  Some interpretation from people in the know
> here would still be helpful and much appreciated.
>
> As for (2), I recognize it as an oversimplication, after reading this
> thread in this group:
>
> http://groups.google.com/group/rabbitmq-discuss/browse_thread/thread/19066ba6f2944df8/f9d7d4bea18f2b5a?lnk=gst&q=fifo#
>
> The explanation by Matthias Radestock is helpful, but even after
> reading his citation of the AMQP spec with respect to channels and
> "single paths", I am still left with the sense that somehow AMQP
> recognizes and codes to a world that is not quite so simple as "is- or
> isNot-FIFO".  But I cannot put my finger on why, or what exactly is
> being said.
>
> Would someone here be kind enough to talk about why section 4.7 of the
> 0.9.1 spec reads ever so slightly tortured?
>
> And a short discussion of (1) would be very helpful, too.
>
> Thank you very kindly.
>
> Mark P.
>


From alexis at rabbitmq.com  Tue Oct 25 22:28:12 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Tue, 25 Oct 2011 22:28:12 +0100
Subject: [rabbitmq-discuss] Initial Questions on RabbitMQ and AMQP
In-Reply-To: <4EA7295B.1040806@rabbitmq.com>
References: <CABMnSbFtaVSja_XutLP9LhCyJYT2K=3h8mt3L5XDrhrYOz=pbg@mail.gmail.com>
	<4EA7295B.1040806@rabbitmq.com>
Message-ID: <CACOPnver=hnvkmF+OnsMjjtCNAn5M_GQ+WJ+dMO0=oNyVfmZHg@mail.gmail.com>

Mark

Queues are FIFO.

Think of email - under what circumstances would you expect ordering to
be preserved?

alexis


On Tue, Oct 25, 2011 at 10:25 PM, Matthias Radestock
<matthias at rabbitmq.com> wrote:
> Mark,
>
> On 25/10/11 21:51, Mark Petrovic wrote:
>>
>> 1) No ONCE-ONLY semantics. Messages may be sent twice by RabbitMQ to
>> the consumer(s)
>
> That only happens if something went wrong and, in effect, the message is
> "retried".
>
> Once-only / exactly-once are tricky to define, and impossible to implement
> if taken literally. There has been some previous discussion on the subject.
> A quick search of the archives brings up
>
>
> ../rabbitmq-server/scripts/rabbitmqctl delete_user test_user_no_perm
> Deleting user "test_user_no_perm" ...
> Error: {no_such_user,<<"test_user_no_perm">>}
> make[3]: [start_test_broker_node] Error 2 (ignored)
>
>
>>
>> 2) Unordered; not FIFO delivery
>>
>> I'm actually not certain (1) is a criticism of AMQP or Rabbit. ?On its
>> face, it seems morally neutral, yet at the same time it appears to
>> make an important point. ?Some interpretation from people in the know
>> here would still be helpful and much appreciated.
>>
>> As for (2), I recognize it as an oversimplication, after reading this
>> thread in this group:
>>
>>
>> http://groups.google.com/group/rabbitmq-discuss/browse_thread/thread/19066ba6f2944df8/f9d7d4bea18f2b5a?lnk=gst&q=fifo#
>>
>> The explanation by Matthias Radestock is helpful, but even after
>> reading his citation of the AMQP spec with respect to channels and
>> "single paths", I am still left with the sense that somehow AMQP
>> recognizes and codes to a world that is not quite so simple as "is- or
>> isNot-FIFO". ?But I cannot put my finger on why, or what exactly is
>> being said.
>>
>> Would someone here be kind enough to talk about why section 4.7 of the
>> 0.9.1 spec reads ever so slightly tortured?
>>
>> And a short discussion of (1) would be very helpful, too.
>>
>> Thank you very kindly.
>>
>> Mark P.
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From matthias at rabbitmq.com  Tue Oct 25 22:37:48 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 25 Oct 2011 22:37:48 +0100
Subject: [rabbitmq-discuss] Initial Questions on RabbitMQ and AMQP
In-Reply-To: <CABMnSbFtaVSja_XutLP9LhCyJYT2K=3h8mt3L5XDrhrYOz=pbg@mail.gmail.com>
References: <CABMnSbFtaVSja_XutLP9LhCyJYT2K=3h8mt3L5XDrhrYOz=pbg@mail.gmail.com>
Message-ID: <4EA72C2C.70800@rabbitmq.com>

Mark,

(since we are having a discussion about reliable message delivery, I 
figured I'd illustrate the point by sending a garbled message first ;)

On 25/10/11 21:51, Mark Petrovic wrote:
> 1) No ONCE-ONLY semantics. Messages may be sent twice by RabbitMQ to
> the consumer(s)

That only happens if something went wrong and, in effect, the message is 
"retried".

Once-only / exactly-once are tricky to define, and impossible to 
implement if taken literally. There has been some previous discussion on 
the subject. A quick search of the archives brings up

http://old.nabble.com/Exactly-Once-Delivery-td29333136.html
and
http://old.nabble.com/Cluster-failover-behaviour-td26785946.html#a26786952

> 2) Unordered; not FIFO delivery
> Would someone here be kind enough to talk about why section 4.7 of the
> 0.9.1 spec reads ever so slightly tortured?

The language in the spec is a bit tortured because it needs to define 
things in terms of observable/testable behaviours.

As Alexis said, think of email. Or even snail mail. And the 
circumstances under which you would expect order to be preserved.

One aspect not easily explained by these analogies is retries i.e. when, 
due to a failure or explicit rejection, a message that has been 
delivered to a client is re-queued and subsequently re-delivered. The 
spec says that no ordering guarantees hold at that point. And indeed it 
is difficult to define the guarantees here for all possible scenarios. 
But for common scenarios, say a single consumer that has received a 
bunch of messages and dies before acknowledging them, the ordering could 
be maintained. Currently RabbitMQ does not do that, but this will change 
in the next release.

Regards,

Matthias.

From pdezwart at rubiconproject.com  Tue Oct 25 23:25:23 2011
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Tue, 25 Oct 2011 17:25:23 -0500
Subject: [rabbitmq-discuss] RabbitMQ-C library: channel_max
Message-ID: <CACC8563.26E11%pdezwart@rubiconproject.com>

Hey everyone,

Dumb question alert, sorry. In the rabbitmq-c library, there are a few parameters to the amqp_login function that confuse me: channel_max and frame_max. Are these essentially the global QOS settings (how many channels can be on this connection, 0 being unlimited AND maximum window frame size, within which the client will try to tune the connection)?

What are legitimate values for these? Should I expose them in the PHP extension, and allow people to change them prior to connecting?

Thanks,
Pieter
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111025/4c8c420d/attachment.htm>

From dusura at gmail.com  Wed Oct 26 06:57:54 2011
From: dusura at gmail.com (dusura)
Date: Tue, 25 Oct 2011 22:57:54 -0700 (PDT)
Subject: [rabbitmq-discuss] How to tell Java Client running in a
	separate thread to stop consuming
In-Reply-To: <57B0E637-F358-4C18-B13B-9DAAB9524F3A@rabbitmq.com>
References: <109bc404-24f5-423b-a3c5-2af3ab5bf713@13g2000prp.googlegroups.com>
	<60778BB2-58CE-456E-9713-850F3D59C31B@rabbitmq.com>
	<4d4ea5e9-1dca-421c-9837-d692312b9113@p14g2000pra.googlegroups.com>
	<cfb1626e-1bb9-470f-ad3d-fefb9999d2d3@d33g2000prb.googlegroups.com>
	<57B0E637-F358-4C18-B13B-9DAAB9524F3A@rabbitmq.com>
Message-ID: <9bc29974-f079-4aed-a2f1-f6b805dce220@z22g2000prd.googlegroups.com>

Hi Steve,

thanks for your reply. What you are saying makes a lot of sense.

I guess if I want this kind of design I will have to abandon Spring
AMQP in favour of using the RabbitMQ Java client libraries directly as
they give me access to channel.basicCancel().

Cheers.

On Oct 26, 3:02?am, Steve Powell <st... at rabbitmq.com> wrote:
> dusura,
>
> As I said, there is no 'safe' general mechanism for stopping
> one Java Thread from another. ?The Interrupt mechanism in Java is
> simply a convenience for *very simple cases*, or for debugging,
> and cannot be regarded as safe on public interfaces.
>
> In particular:
>
> * changes to the design of a service might involve invoking more
> ? or fewer other threads (in which case you might be interrupting
> ? the wrong one);
> * services might be invoked which themselves quietly consume
> ? interrupts;
> * interrupts which fail to be trapped (due to timing considerations)
> ? can contaminate the thread for the next time it is run;
> * it is not possible to tell the difference between spurious interrupts
> ? (part of the Java VM rules for wait(timeout)) and deliberate
> ? external interrupts.
>
> It is much better to architect a solution. For example, in your case,
> send a message to your client application which causes it to perform
> an orderly shutdown (including, one would expect, cancelling consumers
> and closing connections as we have discussed). ?The client might
> already have such a message architected, or if not, design one.
>
> In the next release of RabbitMQ the thread upon which consumers
> perform their callbacks need neither be the client thread, nor the
> connection thread, nor a thread dedicated to a particular channel.
>
> In these circumstances, you are much better off calling a standard
> interface like basicCancel().
>
> Steve Powell ?(a happy bunny)
> ----------some definitions from the SPD----------
> Rigatoni n. A prime-ministerial grin.
> Nigella n. The next bottle-size up from a Nebuchadnezzar.
> Homily adv. Rather like a frenchman.
>
> On 21 Oct 2011, at 01:28, dusura wrote:
>
>
>
>
>
>
>
> >http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-October/015...
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthias at rabbitmq.com  Wed Oct 26 09:48:43 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 26 Oct 2011 09:48:43 +0100
Subject: [rabbitmq-discuss] sslv3 alert handshake failure for TLS Web
 Server certificates
In-Reply-To: <CAAbnaHafoU54unpbbR_W31XFzkJHDBikyQM=3yj-vd=CnH==+w@mail.gmail.com>
References: <CAAbnaHaScyuvzWmjyJrwDko3F=N7K=tfJrs5Ot-QvBn7M7qJaQ@mail.gmail.com>	<20111024233632.GA3367@southbank.Home>
	<CAAbnaHafoU54unpbbR_W31XFzkJHDBikyQM=3yj-vd=CnH==+w@mail.gmail.com>
Message-ID: <4EA7C96B.1070901@rabbitmq.com>

Nate,

On 25/10/11 17:52, Nathaniel Haggard wrote:
> On Mon, Oct 24, 2011 at 5:36 PM, Alexandru Scvor?ov
>> So, are you using the same version of Erlang in both tests?
>
> Yes.

ok. But...

> The tests I'm do go like this:
>
> 1. openssl s_client -host 127.0.0.1 -port 5671 -key
> keys/serverlike.key -cert keys/serverlike.crt
> 2. openssl s_client -host 127.0.0.1 -port 5671 -key
> keys/clientlike.key -cert keys/clientlike.crt
> 3. openssl s_client -host myrabbit172 -port 5671 -key
> keys/serverlike.key -cert keys/serverlike.crt
> 4. openssl s_client -host myrabbit172 -port 5671 -key
> keys/clientlike.key -cert keys/clientlike.crt
>
> 1 fails and 2 passes on rabbitmq-2.4.1 with erlang R14B03.
>
> 3 and 4 pass on rabbitmq-1.7.2 with erlang R13B04.

...that's two different versions of Erlang.

Matthias.

From videlalvaro at gmail.com  Wed Oct 26 10:02:28 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 26 Oct 2011 11:02:28 +0200
Subject: [rabbitmq-discuss] sslv3 alert handshake failure for TLS Web
 Server certificates
In-Reply-To: <4EA7C96B.1070901@rabbitmq.com>
References: <CAAbnaHaScyuvzWmjyJrwDko3F=N7K=tfJrs5Ot-QvBn7M7qJaQ@mail.gmail.com>
	<20111024233632.GA3367@southbank.Home>
	<CAAbnaHafoU54unpbbR_W31XFzkJHDBikyQM=3yj-vd=CnH==+w@mail.gmail.com>
	<4EA7C96B.1070901@rabbitmq.com>
Message-ID: <CAMcAHLXo6MO5rb2FibxVjDyaLinbat3Ra5gSLr5xL7m92G2A2g@mail.gmail.com>

Maybe this is related with what is described here:

http://www.rabbitmq.com/ssl.html#bugs-in-new_ssl

-Alvaro

On Wed, Oct 26, 2011 at 10:48 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Nate,
>
>
> On 25/10/11 17:52, Nathaniel Haggard wrote:
>
>> On Mon, Oct 24, 2011 at 5:36 PM, Alexandru Scvor?ov
>>
>>> So, are you using the same version of Erlang in both tests?
>>>
>>
>> Yes.
>>
>
> ok. But...
>
>
>  The tests I'm do go like this:
>>
>> 1. openssl s_client -host 127.0.0.1 -port 5671 -key
>> keys/serverlike.key -cert keys/serverlike.crt
>> 2. openssl s_client -host 127.0.0.1 -port 5671 -key
>> keys/clientlike.key -cert keys/clientlike.crt
>> 3. openssl s_client -host myrabbit172 -port 5671 -key
>> keys/serverlike.key -cert keys/serverlike.crt
>> 4. openssl s_client -host myrabbit172 -port 5671 -key
>> keys/clientlike.key -cert keys/clientlike.crt
>>
>> 1 fails and 2 passes on rabbitmq-2.4.1 with erlang R14B03.
>>
>> 3 and 4 pass on rabbitmq-1.7.2 with erlang R13B04.
>>
>
> ...that's two different versions of Erlang.
>
> Matthias.
>
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111026/6c11be04/attachment.htm>

From simon at rabbitmq.com  Wed Oct 26 10:28:32 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 26 Oct 2011 10:28:32 +0100
Subject: [rabbitmq-discuss] RabbitMQ-C library: channel_max
In-Reply-To: <CACC8563.26E11%pdezwart@rubiconproject.com>
References: <CACC8563.26E11%pdezwart@rubiconproject.com>
Message-ID: <4EA7D2C0.5070004@rabbitmq.com>

On 25/10/11 23:25, Pieter de Zwart wrote:
>
> Dumb question alert, sorry. In the rabbitmq-c library, there are a few
> parameters to the amqp_login function that confuse me: channel_max and
> frame_max. Are these essentially the global QOS settings (how many
> channels can be on this connection, 0 being unlimited AND maximum window
> frame size, within which the client will try to tune the connection)?

No, not at all.

See http://www.rabbitmq.com/amqp-0-9-1-reference.html#connection.tune

frame_max is the maximum AMQP frame size the client should accept when 
negotiating a frame size with the server. Zero is unlimited.

channel_max is the maximum number of channels per connection that the 
client will use. Zero is unlimited.

RabbitMQ really doesn't care much about this, but conceivably other 
server implementations might require your client to agree to a low value.

> What are legitimate values for these? Should I expose them in the PHP
> extension, and allow people to change them prior to connecting?

Depends how completist you feel. Tuning frame_max can make differences 
to throughput in some situations. channel_max is not very interesting 
when connecting to RabbitMQ.

Cheers, Simon
-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Wed Oct 26 10:33:04 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 26 Oct 2011 10:33:04 +0100
Subject: [rabbitmq-discuss] RabbitMQ-C library: channel_max
In-Reply-To: <CACC8563.26E11%pdezwart@rubiconproject.com>
References: <CACC8563.26E11%pdezwart@rubiconproject.com>
Message-ID: <4EA7D3D0.9080506@rabbitmq.com>

On 25/10/11 23:25, Pieter de Zwart wrote:
> Hey everyone,
> 
> Dumb question alert, sorry. In the rabbitmq-c library, there are a few
> parameters to the amqp_login function that confuse me: channel_max and
> frame_max. Are these essentially the global QOS settings (how many
> channels can be on this connection, 0 being unlimited AND maximum window
> frame size, within which the client will try to tune the connection)?
> 
> What are legitimate values for these? Should I expose them in the PHP
> extension, and allow people to change them prior to connecting?

You can find details of those parameters here:
http://www.rabbitmq.com/amqp-0-9-1-reference.html#connection.tune

channel-max
Specifies highest channel number that the server permits.

frame-max
The largest frame size that the server proposes for the connection

Zero is a good default for both on the client, meaning no limit. The
protocol specifies a minimum frame-max of 4kb, and the server will
suggest a default of 128kb, but this can be changed in the configuration
file - see details for the frame_max variable here:
http://www.rabbitmq.com/configure.html#config-items .

It is reasonable to expose these in the client. See the
ConnectionFactory classes in the rabbit Java and .net clients for a
possible way of doing so.



Emile



From smetj.net at gmail.com  Wed Oct 26 12:24:37 2011
From: smetj.net at gmail.com (Jelle Smet)
Date: Wed, 26 Oct 2011 04:24:37 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ not starting anymore after removing
 federation configuration
Message-ID: <2648974.199.1319628277692.JavaMail.geo-discussion-forums@yqja14>

Hi,

I ran into a situation that RabbitMQ refuses to start when I have removed 
the "federation" configuration used to start RabbitMQ initially.
The only way to recover from that situation is:

- restoring your original configuration
- start RabbitMQ
- delete the federation exchange
- stop RabbitMQ 
- remove configuration
- start RabbitMQ again.

startup_log contains following information:

... snip ...
starting exchange, queue and binding recovery                         
...BOOT ERROR: FAILED
Reason: {badmatch,{error,set_not_found}}
Stacktrace: [{rabbit_federation_exchange,create,2},
             {rabbit_misc,'-table_filter/3-fun-1-',4},
             {rabbit_misc,'-table_filter/3-fun-2-',5},
             {lists,foldl,3},
             {rabbit_exchange,recover,0},
             {rabbit,recover,0},
             {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
             {rabbit,run_boot_step,1}]
{"Kernel pid 
terminated",application_controller,"{application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}}"}

startup_err contains following information:

Erlang has closed

Crash dump was written to: erl_crash.dump
Kernel pid terminated (application_controller) 
({application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}})


I can forward a copy of the erl_crash.dump if required.

Thanks,

Jelle
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111026/9baa8139/attachment.htm>

From simon at rabbitmq.com  Wed Oct 26 16:44:01 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 26 Oct 2011 16:44:01 +0100
Subject: [rabbitmq-discuss] RabbitMQ not starting anymore after removing
 federation configuration
In-Reply-To: <2648974.199.1319628277692.JavaMail.geo-discussion-forums@yqja14>
References: <2648974.199.1319628277692.JavaMail.geo-discussion-forums@yqja14>
Message-ID: <4EA82AC1.3050401@rabbitmq.com>

On 26/10/11 12:24, Jelle Smet wrote:
> Hi,

Hi.

> I ran into a situation that RabbitMQ refuses to start when I have
> removed the "federation" configuration used to start RabbitMQ initially.
> The only way to recover from that situation is:
>
> - restoring your original configuration
> - start RabbitMQ
> - delete the federation exchange
> - stop RabbitMQ
> - remove configuration
> - start RabbitMQ again.

Yeah. It's not completely obvious what RabbitMQ should do in this 
situation - it's found a federation exchange in Mnesia, but it doesn't 
know what a federation exchange is any more.

We could just delete the exchange, but what if that wasn't what you 
wanted? You might have accidentally started without the plugin, so 
deleting exchanges as a result is not helpful.

In future we might have some fallback exchange implementation that could 
be used, but whatever it does, it could still take people by surprise.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From majek04 at gmail.com  Wed Oct 26 17:19:03 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 26 Oct 2011 17:19:03 +0100
Subject: [rabbitmq-discuss] Pika IOLoop issue
In-Reply-To: <1319127111.42857.YahooMailNeo@web26508.mail.ukl.yahoo.com>
References: <1319108122.39394.YahooMailNeo@web26505.mail.ukl.yahoo.com>
	<AE85BD8C56FB4699A40A032C6403BD9C@myyearbook.com>
	<1319127111.42857.YahooMailNeo@web26508.mail.ukl.yahoo.com>
Message-ID: <CABzX+qwxFPR+S2xSK0jz1oMukb+5RniVUSWM_8xv6ovw27P9yw@mail.gmail.com>

Hi,

On Thu, Oct 20, 2011 at 17:11, E Hope-Morley <zedhm at yahoo.co.uk> wrote:
> Hi Gavin, I do not have a trace and this is not an easy issue to trigger but
> I think I have understood what is going on. This issue happens, in my case,
> when the connection drops and Pika handles the error. This results in the
> on_connection_closed callback getting called which I have instructed to stop
> the connection.ioloop. I think the problem is that if you have a nested
> poll()s you end up with nested handlers so even if the poller (i.e. the
> while loop in poller.start()) is stopped, when the call stack unwinds you
> can end up with calls to poll() getting executed as a result of a
> transport.rpc(). Does this make any sense?

That sounds like a genuine bug report. Fancy filing a bug on pika
issue tracker?
https://github.com/pika/pika/issues

Or maybe even submit a patch?

Cheers,
   Marek



> ________________________________
> From: Gavin M. Roy <gmr at myyearbook.com>
> To: E Hope-Morley <zedhm at yahoo.co.uk>
> Cc: "rabbitmq-discuss at lists.rabbitmq.com"
> <rabbitmq-discuss at lists.rabbitmq.com>
> Sent: Thursday, 20 October 2011, 14:29
> Subject: Re: [rabbitmq-discuss] Pika IOLoop issue
>
> That is peculiar. What is the duration of time between the stop and pending
> event? Is an exception being thrown? Do you have a traceback?
> Gavin
>
> On Thursday, October 20, 2011 at 12:55 PM, E Hope-Morley wrote:
>
> Hi,
> ??? I am using Pika on Ubuntu 11.04. When I call
> SelectConnection.ioloop.stop() following a connection drop on my connection,
> it sometimes fails to actually stop the ioloop i.e. following the call to
> stop(), a callback may sometimes be called in response to a pending event.
> Any ideas?
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From matthew at rabbitmq.com  Wed Oct 26 17:32:26 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 26 Oct 2011 17:32:26 +0100
Subject: [rabbitmq-discuss] Limiting the number of non-ack messages
 cause of subsystem
In-Reply-To: <587c2f4f-7ea6-4f49-97f0-4d19a2a14bbd@j20g2000vby.googlegroups.com>
References: <52b1c94b-b1ca-4687-90d1-eca6d99434ec@o19g2000vbk.googlegroups.com>
	<20111022224228.GB3861@rabbitmq.com>
	<587c2f4f-7ea6-4f49-97f0-4d19a2a14bbd@j20g2000vby.googlegroups.com>
Message-ID: <20111026163226.GA9730@rabbitmq.com>

Hi Johannes,

On Sun, Oct 23, 2011 at 02:59:25AM -0700, jhiemer wrote:
> yeah that's the other way I was thinking about. The problem is, that
> there might be different execution times for each thread. So imagine
> the following situation:
> 
> - 3 Threads runtime 10 seconds
> - 4 Threads runtime 25 seconds
> - 3 Threats runtime 200 seconds
> 
> Discarding the Consumer for the time till all the Threads are finally
> executed would result in an waiting time of 200 seconds. With the ACK
> approach I could automatically assign an new thread after 10 seconds.
> So from your side, that would be proper way? Are there any samples for
> it?

Erm, I'm afraid you've lost me. Does a new thread result in a new "slot"
immediately?

Matthew

From james.r.carr at gmail.com  Wed Oct 26 17:46:49 2011
From: james.r.carr at gmail.com (James Carr)
Date: Wed, 26 Oct 2011 11:46:49 -0500
Subject: [rabbitmq-discuss] SMTP Plugin
Message-ID: <CAJreXKD2EqzPBMxK1k9wyatYVe6Qw80sH4ym0Y9P6Wyj+bu2zg@mail.gmail.com>

I know this isn't even listed on the site and even the author states
"Tests pass. I make no guarantees.", but I'm curious if anyone has
used the SMTP plugin (https://github.com/rabbitmq/rabbitmq-smtp) and
if they have had any success with it? It seems to fit the bill for
exactly what I'm looking for with a particular client and I plan to
give it a try tomorrow.

Thanks,
James

From natester at gmail.com  Wed Oct 26 17:49:09 2011
From: natester at gmail.com (Nathaniel Haggard)
Date: Wed, 26 Oct 2011 10:49:09 -0600
Subject: [rabbitmq-discuss] sslv3 alert handshake failure for TLS Web
 Server certificates
In-Reply-To: <4EA7C96B.1070901@rabbitmq.com>
References: <CAAbnaHaScyuvzWmjyJrwDko3F=N7K=tfJrs5Ot-QvBn7M7qJaQ@mail.gmail.com>
	<20111024233632.GA3367@southbank.Home>
	<CAAbnaHafoU54unpbbR_W31XFzkJHDBikyQM=3yj-vd=CnH==+w@mail.gmail.com>
	<4EA7C96B.1070901@rabbitmq.com>
Message-ID: <CAAbnaHa=hr4HmFWLigqqbkLL4GuzqfivsP=43bO9HO5ETYpErg@mail.gmail.com>

On Wed, Oct 26, 2011 at 2:48 AM, Matthias Radestock
<matthias at rabbitmq.com> wrote:
> Nate,
>
> On 25/10/11 17:52, Nathaniel Haggard wrote:
>>
>> On Mon, Oct 24, 2011 at 5:36 PM, Alexandru Scvor?ov
>>>
>>> So, are you using the same version of Erlang in both tests?
>>
>> Yes.
>
> ok. But...
>
>> The tests I'm do go like this:
>>
>> 1. openssl s_client -host 127.0.0.1 -port 5671 -key
>> keys/serverlike.key -cert keys/serverlike.crt
>> 2. openssl s_client -host 127.0.0.1 -port 5671 -key
>> keys/clientlike.key -cert keys/clientlike.crt
>> 3. openssl s_client -host myrabbit172 -port 5671 -key
>> keys/serverlike.key -cert keys/serverlike.crt
>> 4. openssl s_client -host myrabbit172 -port 5671 -key
>> keys/clientlike.key -cert keys/clientlike.crt
>>
>> 1 fails and 2 passes on rabbitmq-2.4.1 with erlang R14B03.
>>
>> 3 and 4 pass on rabbitmq-1.7.2 with erlang R13B04.
>
> ...that's two different versions of Erlang.

Yes, I used the same version of erlang for both 1. and 2. and a
different version of erlang for both 3 and 4.


It looks like erlang does care about extended key usage since OTP-8554
 "Ssl now correctly verifies the extended_key_usage extension and also
allows the user to verify application specific extensions by supplying
an appropriate fun."
-http://www.erlang.org/download/otp_src_R14A.readme

From c_showers at hotmail.com  Wed Oct 26 18:13:40 2011
From: c_showers at hotmail.com (Cory Showers)
Date: Wed, 26 Oct 2011 17:13:40 +0000
Subject: [rabbitmq-discuss] AMQP protocol version mismatch problem on linux
Message-ID: <COL115-W443356763E1FB3FFA61D0194ED0@phx.gbl>


Can someone help me out with this.

I've been using RabbitMQ locally on my windows box successfully for sometime.  But when I try to run on linux with server and client on different linux machines I get this error

AMQP protocol version mismatch; we are version 0-9-1, server sent signature 1,1,0,9

I am using RabbitMQ version 2.5.1 server and client which supports 0-9-1 but I dont know why the server signature says 1,1,0,9.

To narrow down the problem the java client build I'm running I first ran on Windows and pointed the host to the Linux Rabbit server.  And it worked fined when I passed some messages.

But using the same client build deployed on a Linux box I get the above error.  Only when it tries to send a message not on startup.  Here is the exact stacktrace

Exception in thread "pub-sub-pool-2" org.springframework.amqp.AmqpIOException: java.io.IOException
        at org.springframework.amqp.rabbit.connection.RabbitUtils.convertRabbitAccessException(RabbitUtils.java:109)
        at org.springframework.amqp.rabbit.connection.AbstractConnectionFactory.createBareConnection(AbstractConnectionFactory.java:118)
        at org.springframework.amqp.rabbit.connection.CachingConnectionFactory.createConnection(CachingConnectionFactory.java:179)
        at org.springframework.amqp.rabbit.connection.ConnectionFactoryUtils$1.createConnection(ConnectionFactoryUtils.java:77)
        at org.springframework.amqp.rabbit.connection.ConnectionFactoryUtils.doGetTransactionalResourceHolder(ConnectionFactoryUtils.java:121)
        at org.springframework.amqp.rabbit.connection.ConnectionFactoryUtils.getTransactionalResourceHolder(ConnectionFactoryUtils.java:67)
        at org.springframework.amqp.rabbit.connection.RabbitAccessor.getTransactionalResourceHolder(RabbitAccessor.java:100)
        at org.springframework.amqp.rabbit.core.RabbitTemplate.execute(RabbitTemplate.java:402)
        at org.springframework.amqp.rabbit.core.RabbitTemplate.send(RabbitTemplate.java:225)
        at org.springframework.amqp.rabbit.core.RabbitTemplate.convertAndSend(RabbitTemplate.java:242)
        at org.springframework.amqp.rabbit.core.RabbitTemplate.convertAndSend(RabbitTemplate.java:238)
        at com.comp.transports.fix.handlers.Sender$1.run(Sender.java:115)
        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)
        at java.lang.Thread.run(Thread.java:619)
Caused by: java.io.IOException
        at com.rabbitmq.client.impl.AMQChannel.wrap(AMQChannel.java:107)
        at com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:261)
        at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:403)
        at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:423)
        at org.springframework.amqp.rabbit.connection.AbstractConnectionFactory.createBareConnection(AbstractConnectionFactory.java:116)
        ... 13 more
Caused by: com.rabbitmq.client.ShutdownSignalException: connection error; reason: com.rabbitmq.client.MalformedFrameException: AMQP protocol version mismatch; we are version 0-9-1, server sent signature 1,1,0,9
        at com.rabbitmq.utility.ValueOrException.getValue(ValueOrException.java:67)
        at com.rabbitmq.utility.BlockingValueOrException.uninterruptibleGetValue(BlockingValueOrException.java:33)
        at com.rabbitmq.client.impl.AMQChannel$BlockingRpcContinuation.getReply(AMQChannel.java:328)
        at com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:246)
        ... 16 more
Caused by: com.rabbitmq.client.MalformedFrameException: AMQP protocol version mismatch; we are version 0-9-1, server sent signature 1,1,0,9
        at com.rabbitmq.client.impl.Frame.protocolVersionMismatch(Frame.java:183)
        at com.rabbitmq.client.impl.Frame.readFrom(Frame.java:120)
        at com.rabbitmq.client.impl.SocketFrameHandler.readFrame(SocketFrameHandler.java:140)
        at com.rabbitmq.client.impl.AMQConnection.readFrame(AMQConnection.java:397)
        at com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:425)

Thanks,
Cory


 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111026/9365f05e/attachment.htm>

From alexis.richardson at gmail.com  Wed Oct 26 18:44:49 2011
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Wed, 26 Oct 2011 18:44:49 +0100
Subject: [rabbitmq-discuss] SMTP Plugin
In-Reply-To: <CAJreXKD2EqzPBMxK1k9wyatYVe6Qw80sH4ym0Y9P6Wyj+bu2zg@mail.gmail.com>
References: <CAJreXKD2EqzPBMxK1k9wyatYVe6Qw80sH4ym0Y9P6Wyj+bu2zg@mail.gmail.com>
Message-ID: <CACOPnve-DrCktPfgbEKEPdpQ7hMavuZaN9mDGH7vLTGBAbCKxw@mail.gmail.com>

Some people used it a while back. It needs a refresh to work with recent
versions of rabbit
 On Oct 26, 2011 5:47 PM, "James Carr" <james.r.carr at gmail.com> wrote:

> I know this isn't even listed on the site and even the author states
> "Tests pass. I make no guarantees.", but I'm curious if anyone has
> used the SMTP plugin (https://github.com/rabbitmq/rabbitmq-smtp) and
> if they have had any success with it? It seems to fit the bill for
> exactly what I'm looking for with a particular client and I plan to
> give it a try tomorrow.
>
> Thanks,
> James
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111026/2560d13d/attachment.htm>

From gmr at myyearbook.com  Wed Oct 26 18:52:22 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Wed, 26 Oct 2011 13:52:22 -0400
Subject: [rabbitmq-discuss] AMQP protocol version mismatch problem on
	linux
In-Reply-To: <COL115-W443356763E1FB3FFA61D0194ED0@phx.gbl>
References: <COL115-W443356763E1FB3FFA61D0194ED0@phx.gbl>
Message-ID: <CAL_e=0ry7g0L4_Gq1+vRCpZn-gz+-GL0z0VnY3ui2rF+Ykg_FQ@mail.gmail.com>

I would run tcpdump on the conversation on see if it's actually sending
that. Unless you're running a modified RabbitMQ server, that's *very*
strange to me.

It seems more likely to me that the client is messing up somehow.

Regards,

Gavin

On Wed, Oct 26, 2011 at 1:13 PM, Cory Showers <c_showers at hotmail.com> wrote:

>  Can someone help me out with this.
>
> I've been using RabbitMQ locally on my windows box successfully for
> sometime.  But when I try to run on linux with server and client on
> different linux machines I get this error
>
> AMQP protocol version mismatch; we are version 0-9-1, server sent signature
> 1,1,0,9
>
> I am using RabbitMQ version 2.5.1 server and client which supports 0-9-1
> but I dont know why the server signature says 1,1,0,9.
>
> To narrow down the problem the java client build I'm running I first ran on
> Windows and pointed the host to the Linux Rabbit server.  And it worked
> fined when I passed some messages.
>
> But using the same client build deployed on a Linux box I get the above
> error.  Only when it tries to send a message not on startup.  Here is the
> exact stacktrace
>
> Exception in thread "pub-sub-pool-2"
> org.springframework.amqp.AmqpIOException: java.io.IOException
>         at
> org.springframework.amqp.rabbit.connection.RabbitUtils.convertRabbitAccessException(RabbitUtils.java:109)
>         at
> org.springframework.amqp.rabbit.connection.AbstractConnectionFactory.createBareConnection(AbstractConnectionFactory.java:118)
>         at
> org.springframework.amqp.rabbit.connection.CachingConnectionFactory.createConnection(CachingConnectionFactory.java:179)
>         at
> org.springframework.amqp.rabbit.connection.ConnectionFactoryUtils$1.createConnection(ConnectionFactoryUtils.java:77)
>         at
> org.springframework.amqp.rabbit.connection.ConnectionFactoryUtils.doGetTransactionalResourceHolder(ConnectionFactoryUtils.java:121)
>         at
> org.springframework.amqp.rabbit.connection.ConnectionFactoryUtils.getTransactionalResourceHolder(ConnectionFactoryUtils.java:67)
>         at
> org.springframework.amqp.rabbit.connection.RabbitAccessor.getTransactionalResourceHolder(RabbitAccessor.java:100)
>         at
> org.springframework.amqp.rabbit.core.RabbitTemplate.execute(RabbitTemplate.java:402)
>         at
> org.springframework.amqp.rabbit.core.RabbitTemplate.send(RabbitTemplate.java:225)
>         at
> org.springframework.amqp.rabbit.core.RabbitTemplate.convertAndSend(RabbitTemplate.java:242)
>         at
> org.springframework.amqp.rabbit.core.RabbitTemplate.convertAndSend(RabbitTemplate.java:238)
>         at com.comp.transports.fix.handlers.Sender$1.run(Sender.java:115)
>         at
> java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)
>         at
> java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)
>         at java.lang.Thread.run(Thread.java:619)
> Caused by: java.io.IOException
>         at com.rabbitmq.client.impl.AMQChannel.wrap(AMQChannel.java:107)
>         at
> com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:261)
>         at
> com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:403)
>         at
> com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:423)
>         at
> org.springframework.amqp.rabbit.connection.AbstractConnectionFactory.createBareConnection(AbstractConnectionFactory.java:116)
>         ... 13 more
> Caused by: com.rabbitmq.client.ShutdownSignalException: connection error;
> reason: com.rabbitmq.client.MalformedFrameException: AMQP protocol version
> mismatch; we are version 0-9-1, server sent signature 1,1,0,9
>         at
> com.rabbitmq.utility.ValueOrException.getValue(ValueOrException.java:67)
>         at
> com.rabbitmq.utility.BlockingValueOrException.uninterruptibleGetValue(BlockingValueOrException.java:33)
>         at
> com.rabbitmq.client.impl.AMQChannel$BlockingRpcContinuation.getReply(AMQChannel.java:328)
>         at
> com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:246)
>         ... 16 more
> Caused by: com.rabbitmq.client.MalformedFrameException: AMQP protocol
> version mismatch; we are version 0-9-1, server sent signature 1,1,0,9
>         at
> com.rabbitmq.client.impl.Frame.protocolVersionMismatch(Frame.java:183)
>         at com.rabbitmq.client.impl.Frame.readFrom(Frame.java:120)
>         at
> com.rabbitmq.client.impl.SocketFrameHandler.readFrame(SocketFrameHandler.java:140)
>         at
> com.rabbitmq.client.impl.AMQConnection.readFrame(AMQConnection.java:397)
>         at
> com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:425)
>
> Thanks,
> Cory
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111026/72563522/attachment.htm>

From matthias at rabbitmq.com  Wed Oct 26 18:58:43 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 26 Oct 2011 18:58:43 +0100
Subject: [rabbitmq-discuss] AMQP protocol version mismatch problem on
 linux
In-Reply-To: <CAL_e=0ry7g0L4_Gq1+vRCpZn-gz+-GL0z0VnY3ui2rF+Ykg_FQ@mail.gmail.com>
References: <COL115-W443356763E1FB3FFA61D0194ED0@phx.gbl>
	<CAL_e=0ry7g0L4_Gq1+vRCpZn-gz+-GL0z0VnY3ui2rF+Ykg_FQ@mail.gmail.com>
Message-ID: <4EA84A53.7080804@rabbitmq.com>

On 26/10/11 18:52, Gavin M. Roy wrote:
> It seems more likely to me that the client is messing up somehow.

...or that the server is in fact not RabbitMQ.

Matthias.

From alexandru at rabbitmq.com  Wed Oct 26 19:33:31 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Wed, 26 Oct 2011 19:33:31 +0100
Subject: [rabbitmq-discuss] sslv3 alert handshake failure for TLS Web
 Server certificates
In-Reply-To: <CAAbnaHa=hr4HmFWLigqqbkLL4GuzqfivsP=43bO9HO5ETYpErg@mail.gmail.com>
References: <CAAbnaHaScyuvzWmjyJrwDko3F=N7K=tfJrs5Ot-QvBn7M7qJaQ@mail.gmail.com>
	<20111024233632.GA3367@southbank.Home>
	<CAAbnaHafoU54unpbbR_W31XFzkJHDBikyQM=3yj-vd=CnH==+w@mail.gmail.com>
	<4EA7C96B.1070901@rabbitmq.com>
	<CAAbnaHa=hr4HmFWLigqqbkLL4GuzqfivsP=43bO9HO5ETYpErg@mail.gmail.com>
Message-ID: <20111026183331.GA13028@southbank>

> Yes, I used the same version of erlang for both 1. and 2. and a
> different version of erlang for both 3 and 4.
> 
> 
> It looks like erlang does care about extended key usage since OTP-8554
>  "Ssl now correctly verifies the extended_key_usage extension and also
> allows the user to verify application specific extensions by supplying
> an appropriate fun."
> -http://www.erlang.org/download/otp_src_R14A.readme

So, you tried RabbitMQ 1.7.2 on R13B04 and RabbitMQ 2.4.1 on R14B03.

RabbitMQ uses Erlang's definition of what a valid certificate is.  So,
you can either run 2.4.1 on R13B04, or you could go the way of
"supplying an appropriate fun", but that's fairly complicated and
involves writing and compiling a bit of Erlang.

On Wed, Oct 26, 2011 at 10:49:09AM -0600, Nathaniel Haggard wrote:
> On Wed, Oct 26, 2011 at 2:48 AM, Matthias Radestock
> <matthias at rabbitmq.com> wrote:
> > Nate,
> >
> > On 25/10/11 17:52, Nathaniel Haggard wrote:
> >>
> >> On Mon, Oct 24, 2011 at 5:36 PM, Alexandru Scvor?ov
> >>>
> >>> So, are you using the same version of Erlang in both tests?
> >>
> >> Yes.
> >
> > ok. But...
> >
> >> The tests I'm do go like this:
> >>
> >> 1. openssl s_client -host 127.0.0.1 -port 5671 -key
> >> keys/serverlike.key -cert keys/serverlike.crt
> >> 2. openssl s_client -host 127.0.0.1 -port 5671 -key
> >> keys/clientlike.key -cert keys/clientlike.crt
> >> 3. openssl s_client -host myrabbit172 -port 5671 -key
> >> keys/serverlike.key -cert keys/serverlike.crt
> >> 4. openssl s_client -host myrabbit172 -port 5671 -key
> >> keys/clientlike.key -cert keys/clientlike.crt
> >>
> >> 1 fails and 2 passes on rabbitmq-2.4.1 with erlang R14B03.
> >>
> >> 3 and 4 pass on rabbitmq-1.7.2 with erlang R13B04.
> >
> > ...that's two different versions of Erlang.
> 
> Yes, I used the same version of erlang for both 1. and 2. and a
> different version of erlang for both 3 and 4.
> 
> 
> It looks like erlang does care about extended key usage since OTP-8554
>  "Ssl now correctly verifies the extended_key_usage extension and also
> allows the user to verify application specific extensions by supplying
> an appropriate fun."
> -http://www.erlang.org/download/otp_src_R14A.readme
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From c_showers at hotmail.com  Wed Oct 26 21:05:34 2011
From: c_showers at hotmail.com (Cory Showers)
Date: Wed, 26 Oct 2011 20:05:34 +0000
Subject: [rabbitmq-discuss] AMQP protocol version mismatch problem on
 linux
In-Reply-To: <CAL_e=0ry7g0L4_Gq1+vRCpZn-gz+-GL0z0VnY3ui2rF+Ykg_FQ@mail.gmail.com>
References: <COL115-W443356763E1FB3FFA61D0194ED0@phx.gbl>,
	<CAL_e=0ry7g0L4_Gq1+vRCpZn-gz+-GL0z0VnY3ui2rF+Ykg_FQ@mail.gmail.com>
Message-ID: <COL115-W533AF64AA2D93B2AB9068394ED0@phx.gbl>


Ok problem solved.  The reason why this only appeared on the linux 
machines was because a tunnel was not setup correctly from the client 
machine to the server machine.


From: gmr at myyearbook.com
Date: Wed, 26 Oct 2011 13:52:22 -0400
Subject: Re: [rabbitmq-discuss] AMQP protocol version mismatch problem on linux
To: c_showers at hotmail.com
CC: rabbitmq-discuss at lists.rabbitmq.com

I would run tcpdump on the conversation on see if it's actually sending that. Unless you're running a modified RabbitMQ server, that's *very* strange to me.
It seems more likely to me that the client is messing up somehow.


Regards,
Gavin

On Wed, Oct 26, 2011 at 1:13 PM, Cory Showers <c_showers at hotmail.com> wrote:







Can someone help me out with this.

I've been using RabbitMQ locally on my windows box successfully for sometime.  But when I try to run on linux with server and client on different linux machines I get this error



AMQP protocol version mismatch; we are version 0-9-1, server sent signature 1,1,0,9

I am using RabbitMQ version 2.5.1 server and client which supports 0-9-1 but I dont know why the server signature says 1,1,0,9.



To narrow down the problem the java client build I'm running I first ran on Windows and pointed the host to the Linux Rabbit server.  And it worked fined when I passed some messages.

But using the same client build deployed on a Linux box I get the above error.  Only when it tries to send a message not on startup.  Here is the exact stacktrace



Exception in thread "pub-sub-pool-2" org.springframework.amqp.AmqpIOException: java.io.IOException
        at org.springframework.amqp.rabbit.connection.RabbitUtils.convertRabbitAccessException(RabbitUtils.java:109)


        at org.springframework.amqp.rabbit.connection.AbstractConnectionFactory.createBareConnection(AbstractConnectionFactory.java:118)
        at org.springframework.amqp.rabbit.connection.CachingConnectionFactory.createConnection(CachingConnectionFactory.java:179)


        at org.springframework.amqp.rabbit.connection.ConnectionFactoryUtils$1.createConnection(ConnectionFactoryUtils.java:77)
        at org.springframework.amqp.rabbit.connection.ConnectionFactoryUtils.doGetTransactionalResourceHolder(ConnectionFactoryUtils.java:121)


        at org.springframework.amqp.rabbit.connection.ConnectionFactoryUtils.getTransactionalResourceHolder(ConnectionFactoryUtils.java:67)
        at org.springframework.amqp.rabbit.connection.RabbitAccessor.getTransactionalResourceHolder(RabbitAccessor.java:100)


        at org.springframework.amqp.rabbit.core.RabbitTemplate.execute(RabbitTemplate.java:402)
        at org.springframework.amqp.rabbit.core.RabbitTemplate.send(RabbitTemplate.java:225)
        at org.springframework.amqp.rabbit.core.RabbitTemplate.convertAndSend(RabbitTemplate.java:242)


        at org.springframework.amqp.rabbit.core.RabbitTemplate.convertAndSend(RabbitTemplate.java:238)
        at com.comp.transports.fix.handlers.Sender$1.run(Sender.java:115)
        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)


        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)
        at java.lang.Thread.run(Thread.java:619)
Caused by: java.io.IOException
        at com.rabbitmq.client.impl.AMQChannel.wrap(AMQChannel.java:107)


        at com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:261)
        at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:403)
        at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:423)


        at org.springframework.amqp.rabbit.connection.AbstractConnectionFactory.createBareConnection(AbstractConnectionFactory.java:116)
        ... 13 more
Caused by: com.rabbitmq.client.ShutdownSignalException: connection error; reason: com.rabbitmq.client.MalformedFrameException: AMQP protocol version mismatch; we are version 0-9-1, server sent signature 1,1,0,9


        at com.rabbitmq.utility.ValueOrException.getValue(ValueOrException.java:67)
        at com.rabbitmq.utility.BlockingValueOrException.uninterruptibleGetValue(BlockingValueOrException.java:33)
        at com.rabbitmq.client.impl.AMQChannel$BlockingRpcContinuation.getReply(AMQChannel.java:328)


        at com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:246)
        ... 16 more
Caused by: com.rabbitmq.client.MalformedFrameException: AMQP protocol version mismatch; we are version 0-9-1, server sent signature 1,1,0,9


        at com.rabbitmq.client.impl.Frame.protocolVersionMismatch(Frame.java:183)
        at com.rabbitmq.client.impl.Frame.readFrom(Frame.java:120)
        at com.rabbitmq.client.impl.SocketFrameHandler.readFrame(SocketFrameHandler.java:140)


        at com.rabbitmq.client.impl.AMQConnection.readFrame(AMQConnection.java:397)
        at com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:425)

Thanks,
Cory




 		 	   		  

_______________________________________________

rabbitmq-discuss mailing list

rabbitmq-discuss at lists.rabbitmq.com

https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111026/cf67ab68/attachment.htm>

From james.r.carr at gmail.com  Wed Oct 26 21:41:59 2011
From: james.r.carr at gmail.com (James Carr)
Date: Wed, 26 Oct 2011 15:41:59 -0500
Subject: [rabbitmq-discuss] SMTP Plugin
In-Reply-To: <CACOPnve-DrCktPfgbEKEPdpQ7hMavuZaN9mDGH7vLTGBAbCKxw@mail.gmail.com>
References: <CAJreXKD2EqzPBMxK1k9wyatYVe6Qw80sH4ym0Y9P6Wyj+bu2zg@mail.gmail.com>
	<CACOPnve-DrCktPfgbEKEPdpQ7hMavuZaN9mDGH7vLTGBAbCKxw@mail.gmail.com>
Message-ID: <CAJreXKBMhEhvcZMeF9iQTUGU_rHe=r6pS+9NHN3rkPd1emwPNw@mail.gmail.com>

Cool... I'll fork it and poke around. My business case is I'm
automating some manual emails to small brokerage firms to get quotes
and it seems like it'd be a pretty slick solution to send an automated
email to the small firms and then route the reply through rabbitmq to
pull the quotes in.

Of course if the smtp plugin doesn't work I'll just have to do it
myself, but it'd be cool if the plugin does it. :)

Thanks,
James


On Wed, Oct 26, 2011 at 12:44 PM, Alexis Richardson
<alexis.richardson at gmail.com> wrote:
> Some people used it a while back. It needs a refresh to work with recent
> versions of rabbit
>
> On Oct 26, 2011 5:47 PM, "James Carr" <james.r.carr at gmail.com> wrote:
>>
>> I know this isn't even listed on the site and even the author states
>> "Tests pass. I make no guarantees.", but I'm curious if anyone has
>> used the SMTP plugin (https://github.com/rabbitmq/rabbitmq-smtp) and
>> if they have had any success with it? It seems to fit the bill for
>> exactly what I'm looking for with a particular client and I plan to
>> give it a try tomorrow.
>>
>> Thanks,
>> James
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From alexis.richardson at gmail.com  Wed Oct 26 21:47:48 2011
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Wed, 26 Oct 2011 21:47:48 +0100
Subject: [rabbitmq-discuss] SMTP Plugin
In-Reply-To: <CAJreXKBMhEhvcZMeF9iQTUGU_rHe=r6pS+9NHN3rkPd1emwPNw@mail.gmail.com>
References: <CAJreXKD2EqzPBMxK1k9wyatYVe6Qw80sH4ym0Y9P6Wyj+bu2zg@mail.gmail.com>
	<CACOPnve-DrCktPfgbEKEPdpQ7hMavuZaN9mDGH7vLTGBAbCKxw@mail.gmail.com>
	<CAJreXKBMhEhvcZMeF9iQTUGU_rHe=r6pS+9NHN3rkPd1emwPNw@mail.gmail.com>
Message-ID: <CACOPnvcHTUs3OWv3wxPgtNOvEeoi91w1LFPyZR8bF0NpEiYGQA@mail.gmail.com>

Great ... And please share your findings here if you can.  the original
author is subscribed to this list
On Oct 26, 2011 9:41 PM, "James Carr" <james.r.carr at gmail.com> wrote:

> Cool... I'll fork it and poke around. My business case is I'm
> automating some manual emails to small brokerage firms to get quotes
> and it seems like it'd be a pretty slick solution to send an automated
> email to the small firms and then route the reply through rabbitmq to
> pull the quotes in.
>
> Of course if the smtp plugin doesn't work I'll just have to do it
> myself, but it'd be cool if the plugin does it. :)
>
> Thanks,
> James
>
>
> On Wed, Oct 26, 2011 at 12:44 PM, Alexis Richardson
> <alexis.richardson at gmail.com> wrote:
> > Some people used it a while back. It needs a refresh to work with recent
> > versions of rabbit
> >
> > On Oct 26, 2011 5:47 PM, "James Carr" <james.r.carr at gmail.com> wrote:
> >>
> >> I know this isn't even listed on the site and even the author states
> >> "Tests pass. I make no guarantees.", but I'm curious if anyone has
> >> used the SMTP plugin (https://github.com/rabbitmq/rabbitmq-smtp) and
> >> if they have had any success with it? It seems to fit the bill for
> >> exactly what I'm looking for with a particular client and I plan to
> >> give it a try tomorrow.
> >>
> >> Thanks,
> >> James
> >> _______________________________________________
> >> rabbitmq-discuss mailing list
> >> rabbitmq-discuss at lists.rabbitmq.com
> >> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111026/7ce633fd/attachment.htm>

From andrew.rendell at gmail.com  Wed Oct 26 22:10:46 2011
From: andrew.rendell at gmail.com (Anderew)
Date: Wed, 26 Oct 2011 14:10:46 -0700 (PDT)
Subject: [rabbitmq-discuss] Mirror queues and poor write performance
Message-ID: <448858bd-6a94-4677-aa89-34506deed3ec@m19g2000vbm.googlegroups.com>

Hi,

I have been using RabbitMQ in high volume applications for over a
year. The new mirror queues feature in 2.6 is very exciting for my
client and I am keen to compare performance with a normal queue
setup.

I have been doing a very simple test and have found that in a two node
cluster write performance where the exchange is bound to a mirrored
queue is amazingly slow (orders of magnitude slower) compared to a non-
mirrored queue in an otherwise identical configuration. Dequeue
performance appears unaffected (i.e. very fast). The queues and
exchanges are non-durable in both cases. Both nodes in the cluster are
on the same machine so network latency will not be an factor.

What are the expectations for mirror queue write performance? I
appreciate there is no such thing as a free lunch and that inevitably
there would be a runtime cost for mirroring.

Andrew.


From chris1adkin at yahoo.co.uk  Wed Oct 26 22:46:13 2011
From: chris1adkin at yahoo.co.uk (ChrisAdkin)
Date: Wed, 26 Oct 2011 14:46:13 -0700 (PDT)
Subject: [rabbitmq-discuss]  "sockets module" for rabbitmq.js example
Message-ID: <32727898.post@talk.nabble.com>


I'm trying to get the example working as per the rabbitmq + node.js posting
(http://www.rabbitmq.com/blog/2010/11/12/rabbitmq-nodejs-rabbitjs/). I
follow the example, but when I run node example/socketio.js it falls down
with:-


The "sys" module is now called "util". It should have a similar interface.

node.js:202
        throw e; // process.nextTick error, or 'error' event on first tick
              ^
Error: Cannot find module 'sockets'
    at Function._resolveFilename (module.js:334:11)
    at Function._load (module.js:279:25)
    at Module.require (module.js:357:17)
    at require (module.js:368:17)
    at Object.<anonymous> (/home/chris/rabbit.js/example/socketio.js:8:13)
    at Module._compile (module.js:432:26)
    at Object..js (module.js:450:10)
    at Module.load (module.js:351:31)
    at Function._load (module.js:310:12)
    at Array.<anonymous> (module.js:470:10)

this implies that sockets is a node js module, however the article only
refers to this as being a JavaScript file, nor can I find any reference to a
node.js sockets module on github. Can someone please point me in the right
direction.
-- 
View this message in context: http://old.nabble.com/%22sockets-module%22-for-rabbitmq.js-example-tp32727898p32727898.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From matthew at rabbitmq.com  Wed Oct 26 23:42:23 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 26 Oct 2011 23:42:23 +0100
Subject: [rabbitmq-discuss] Mirror queues and poor write performance
In-Reply-To: <448858bd-6a94-4677-aa89-34506deed3ec@m19g2000vbm.googlegroups.com>
References: <448858bd-6a94-4677-aa89-34506deed3ec@m19g2000vbm.googlegroups.com>
Message-ID: <20111026224223.GA4602@wellquite.org>

On Wed, Oct 26, 2011 at 02:10:46PM -0700, Anderew wrote:
> I have been doing a very simple test and have found that in a two node
> cluster write performance where the exchange is bound to a mirrored
> queue is amazingly slow (orders of magnitude slower) compared to a non-
> mirrored queue in an otherwise identical configuration. Dequeue
> performance appears unaffected (i.e. very fast). The queues and
> exchanges are non-durable in both cases. Both nodes in the cluster are
> on the same machine so network latency will not be an factor.

How are you measuring publishing performance? Publishing is asynchronous
so unless there's some sort of TCP backpressure going on (not impossible
at all), I wouldn't have expected publishing performance to be affected.
That said, it definitely is the case that much much more CPU is being
spent per message and thus if you watch the queue length grow, it'll
grow at a much slower rate than with a non-mirrored queue.

When publishing to a single plain queue on a remote node, the msg is
sent between the nodes (between the node to which you're connected, and
the node upon which the queue resides) once.

When publishing to a mirrored queue where the master is on the node to
which you're connected, the msg will make at least 3 inter-node hops,
and there are further msgs associated with each msg that'll have to go
between nodes. This work alone (serialisation and de) adds substantial
cost.

> What are the expectations for mirror queue write performance? I
> appreciate there is no such thing as a free lunch and that inevitably
> there would be a runtime cost for mirroring.

I can't remember what the last figures were last time I benchmarked.
I'll try and find time to do some quick tests tomorrow and report back.
But my recollection is that the cost is fairly substantial. I have made
some attempts to minimise this cost - batching in a few places goes on
to try and maximise gain from serialising fewer bigger structures rather
than loads of little ones, but there are probably further opportunities
for optimisations yet to be made. That said, inevitably, there is an
awful lot more work that has to get done per message.

Matthew

From matthew at rabbitmq.com  Wed Oct 26 23:45:44 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 26 Oct 2011 23:45:44 +0100
Subject: [rabbitmq-discuss] Mirror queues and poor write performance
In-Reply-To: <20111026224223.GA4602@wellquite.org>
References: <448858bd-6a94-4677-aa89-34506deed3ec@m19g2000vbm.googlegroups.com>
	<20111026224223.GA4602@wellquite.org>
Message-ID: <20111026224544.GB4602@wellquite.org>

On Wed, Oct 26, 2011 at 11:42:23PM +0100, Matthew Sackman wrote:
> When publishing to a mirrored queue where the master is on the node to
> which you're connected, the msg will make at least 3 inter-node hops,

Oh, that 3 is assuming there's just one other node. For each additional
node that's a member of the mirrored queue add another 2 inter-node
copies of the actual message being published. Plus further associated
msgs.

Matthew

From matthias at rabbitmq.com  Wed Oct 26 23:45:54 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 26 Oct 2011 23:45:54 +0100
Subject: [rabbitmq-discuss] RabbitMQ writes non stop to disk
In-Reply-To: <CAD7X3-nrsELeXAS3=q79Jss_6=cWS3VXEtJ7QBBRnU6wyNy8ew@mail.gmail.com>
References: <CAD7X3-nRLHv+uEf0Vy3JTzW8WRNvUW4vSszykU4F=WCEouM5SA@mail.gmail.com>	<4EA69CF9.7010809@rabbitmq.com>
	<CAD7X3-nrsELeXAS3=q79Jss_6=cWS3VXEtJ7QBBRnU6wyNy8ew@mail.gmail.com>
Message-ID: <4EA88DA2.6020108@rabbitmq.com>

Raphael,

On 25/10/11 17:23, Raphael Simon wrote:
> All the messages are consumed pretty much immediately.

That is irrelevant. Persistent messages sent to durable queues *always* 
get written to disk unless they can be sent to an auto-ack'ing consumer 
immediately.

The next rabbit release contains an optimisation s.t. when messages get 
ack'ed before they have been written to disk then they won't be written 
to disk.

The only thing slightly strange about what you have reported is the high 
write count. Any chance you could give RabbitMQ 2.6.1 a try?

Regards,

Matthias.

From baldgoth at gmail.com  Wed Oct 26 23:47:50 2011
From: baldgoth at gmail.com (TrueWill)
Date: Wed, 26 Oct 2011 15:47:50 -0700 (PDT)
Subject: [rabbitmq-discuss] .NET client with multiple hosts - connecting to
 one of the nodes in the cluster with failover
Message-ID: <18935634.1852.1319669270113.JavaMail.geo-discussion-forums@yqhp35>

We know in advance what hosts are in our cluster (say, HostA and HostB). 
Initially our client has to try to connect to one of them (HostA, for 
instance). We'd like it to try HostA and, if that doesn't work, HostB (then 
throw an exception on failure).

RabbitMQ.Client.ConnectionFactory.CreateConnection has a protected overload 
that accepts an array of AmqpTcpEndpoint objects. Is this exposed anywhere? 
Are we supposed to descend from the standard factory?

Or is there a better way? We can certainly solve this by catching 
BrokerUnreachableException and trying the next one, but this seems like a 
problem that others must have solved.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111026/0352f458/attachment.htm>

From matthias at rabbitmq.com  Thu Oct 27 00:00:23 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 27 Oct 2011 00:00:23 +0100
Subject: [rabbitmq-discuss] RabbitMQ writes non stop to disk
In-Reply-To: <CAD7X3-kZnpheaBwkpBWX0bBJS6LyS2i0v8O9ygTPGGfxBbKEtw@mail.gmail.com>
References: <CAD7X3-nRLHv+uEf0Vy3JTzW8WRNvUW4vSszykU4F=WCEouM5SA@mail.gmail.com>	<4EA675C8.70903@rabbitmq.com>
	<CAD7X3-kZnpheaBwkpBWX0bBJS6LyS2i0v8O9ygTPGGfxBbKEtw@mail.gmail.com>
Message-ID: <4EA89107.1010607@rabbitmq.com>

Raphael,

On 25/10/11 17:22, Raphael Simon wrote:
> Something I didn't mention in my first email is that we have about 8
> brokers running in production and only one is showing these symptoms,
> the throughput is about the same through all brokers.

And there is nothing different to all the other brokers? In particular, 
do the other brokers also have two slow-moving durable queues and other, 
faster-moving queues?

Upgrading to 2.6.1 and getting us the output of 'rabbitmqctl report' 
from all brokers might allow us to spot any abnormalities. Failing that, 
the output of 'rabbitmqctl list_queues name durable arguments pid 
messages_ready messages_unacknowledged consumers memory 
backing_queue_status' would help.

Btw, what is it that you are concerned about? That one of your rabbits 
is doing a lot of disk i/o?

Regards,

Matthias.

From matthew at rabbitmq.com  Thu Oct 27 00:01:14 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 27 Oct 2011 00:01:14 +0100
Subject: [rabbitmq-discuss] RabbitMQ writes non stop to disk
In-Reply-To: <CAD7X3-nrsELeXAS3=q79Jss_6=cWS3VXEtJ7QBBRnU6wyNy8ew@mail.gmail.com>
References: <CAD7X3-nRLHv+uEf0Vy3JTzW8WRNvUW4vSszykU4F=WCEouM5SA@mail.gmail.com>
	<4EA69CF9.7010809@rabbitmq.com>
	<CAD7X3-nrsELeXAS3=q79Jss_6=cWS3VXEtJ7QBBRnU6wyNy8ew@mail.gmail.com>
Message-ID: <20111026230113.GC4602@wellquite.org>

Raphael,

Rabbit uses a somewhat sophisticated mechanism to allocate RAM to
queues. The allocation of RAM to queues is extremely difficult to do -
what are the criteria that you should use to decide to prioritise one
queue over another? Furthermore, if the same msg ends up in multiple
queues then that msg will exist just once in RAM but be shared by all
those queues. So it's actually nonsensical to ask how much memory a
queue is using.

The approach we adopt results in Rabbit telling all the queues on a node
to achieve the same *duration* in RAM. I.e. if that duration is, for
example, 10 seconds, then every queue should ensure that given their
individual current ingress and egress rates, the number of messages they
hold in RAM does not represent more than 10 seconds. Messages beyond
that count will be written to disk.

The effect of this strategy is that very fast queues find that an awful
lot of messages make up that duration, and very slow queues find that
very few messages make up that duration. Thus very slow queues can end
up with a "target_ram_count" of 0 or small numbers, whilst fast queues
have much higher "target_ram_counts".

This is desireable because a slow queue is far more likely to withstand
having to write everything to disk and read from disk than a fast queue
can. As I have blogged about,
( http://www.rabbitmq.com/blog/2011/09/24/sizing-your-rabbits/ ), as a
queue gets longer, its CPU-per-msg goes up. As it starts having to write
to disk, the CPU-per-msg goes up even faster. Plus disks have much lower
bandwidth than RAM. Thus a fast queue is likely to catastrophically
consume CPU and disk bandwidth if it starts getting forced out to disk.
But for a slow queue, this is absolutely fine.

Thus in the case of a slow queue receiving a lot rate of messages, what
is the problem with Rabbit deciding to write these out to disk? It's
doing it deliberately because it believes that queue can cope with being
pushed to disk (which it seems to be able to - ingress and egress rates
match), and in order to free up vital resources (RAM) for other queues
which can not cope with being sent to disk.

Rabbit works hard to avoid crowbars - sudden events where it decides to
write out millions of messages. In order to avoid this on a queue that
slowly grows and forces RAM usage to head towards the limit, Rabbit
starts writing out to disk very early on so that the transition to
fully-on-disk operation is as smooth and unnoticable as possible. Thus
even when Rabbit is some way away from its memory limit, it can still
choose to start to push msgs out to disk so to reduce the chances of
hitting the memory limit and then realising that there are millions of
msgs that need writing out causing a massive burst to the disk which'll
disrupt performance substantially.

I hope that helps explain a little more.

Matthew

From raphael at rightscale.com  Thu Oct 27 00:04:27 2011
From: raphael at rightscale.com (Raphael Simon)
Date: Wed, 26 Oct 2011 16:04:27 -0700
Subject: [rabbitmq-discuss] RabbitMQ writes non stop to disk
In-Reply-To: <CAD7X3-=12rzaFEQ6YpdWux8GR+baqPd2BmLVKEhk1-SA=-8YVQ@mail.gmail.com>
References: <CAD7X3-nRLHv+uEf0Vy3JTzW8WRNvUW4vSszykU4F=WCEouM5SA@mail.gmail.com>
	<4EA69CF9.7010809@rabbitmq.com>
	<CAD7X3-nrsELeXAS3=q79Jss_6=cWS3VXEtJ7QBBRnU6wyNy8ew@mail.gmail.com>
	<4EA88DA2.6020108@rabbitmq.com>
	<CAD7X3-mnCd3DZcp2x4rGR5mQ2m=R_FFK09s2SbiQwQO3yoD34Q@mail.gmail.com>
	<CAD7X3-=12rzaFEQ6YpdWux8GR+baqPd2BmLVKEhk1-SA=-8YVQ@mail.gmail.com>
Message-ID: <CAD7X3-=Ug2ehxe34uD2m=SGpZCFnj_42pGxbJ1JkbTs-iQLnZQ@mail.gmail.com>

Hi Matthias, so just to re-iterate: we see this behavior only on one broker,
other brokers with similar load don't exhibit the issue. We've never see
that much i/o apart from when we hit the issues Matthew fixed for 2.4.
Trying RabbitMQ 2.6 will take time as we have custom code and plugin we need
to migrate. This issue only appears on production so there is no way for us
to quickly try it.

Here is the CPU graph on the broker exhibiting the issue:

[image: cpu_overview.png]

And the load on a broker that does not:

[image: cpu_overview2.png]

The spikes every minute is because we run rabbitmqctl list_queues every
minute to monitor the queues. The spikes every 4 hours is due to a cleanup
daemon that cleans up stale queues every 4 hours.

--
Raphael.


On Wed, Oct 26, 2011 at 3:45 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Raphael,
>
>
> On 25/10/11 17:23, Raphael Simon wrote:
>
>> All the messages are consumed pretty much immediately.
>>
>
> That is irrelevant. Persistent messages sent to durable queues *always* get
> written to disk unless they can be sent to an auto-ack'ing consumer
> immediately.
>
> The next rabbit release contains an optimisation s.t. when messages get
> ack'ed before they have been written to disk then they won't be written to
> disk.
>
> The only thing slightly strange about what you have reported is the high
> write count. Any chance you could give RabbitMQ 2.6.1 a try?
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111026/20ef3208/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 29096 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111026/20ef3208/attachment.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 28962 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111026/20ef3208/attachment-0001.png>

From matthias at rabbitmq.com  Thu Oct 27 00:11:22 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 27 Oct 2011 00:11:22 +0100
Subject: [rabbitmq-discuss] RabbitMQ writes non stop to disk
In-Reply-To: <CAD7X3-kA0DZGgdh2U95oFx-FoVPHes-Bq5bSQ9CfVBzacHzxQQ@mail.gmail.com>
References: <CAD7X3-nRLHv+uEf0Vy3JTzW8WRNvUW4vSszykU4F=WCEouM5SA@mail.gmail.com>	<CAHiEoM6A0uUx8je9tz_9xvazvwUznQd6pH7KnikV1zPdJPiMqw@mail.gmail.com>
	<CAD7X3-kA0DZGgdh2U95oFx-FoVPHes-Bq5bSQ9CfVBzacHzxQQ@mail.gmail.com>
Message-ID: <4EA8939A.3020109@rabbitmq.com>

On 25/10/11 17:26, Raphael Simon wrote:
> Interesting we did not disable it.

Don't do it.

> What is the flip side of doing this?

It will disable memory alarms, so producers will no longer get blocked 
when memory gets tight.

It will also cause rabbit to assume that there is only 1G of memory, and 
do queue paging based on that.


Matthias.

From raphael at rightscale.com  Thu Oct 27 00:26:38 2011
From: raphael at rightscale.com (Raphael Simon)
Date: Wed, 26 Oct 2011 16:26:38 -0700
Subject: [rabbitmq-discuss] RabbitMQ writes non stop to disk
In-Reply-To: <20111026230113.GC4602@wellquite.org>
References: <CAD7X3-nRLHv+uEf0Vy3JTzW8WRNvUW4vSszykU4F=WCEouM5SA@mail.gmail.com>
	<4EA69CF9.7010809@rabbitmq.com>
	<CAD7X3-nrsELeXAS3=q79Jss_6=cWS3VXEtJ7QBBRnU6wyNy8ew@mail.gmail.com>
	<20111026230113.GC4602@wellquite.org>
Message-ID: <CAD7X3-=9u-GyAPoEiC8QR9OriKE2OCETGsSqNPTOZGNf5ZXQgw@mail.gmail.com>

Thank you for the long explanation Matthew, you had already explained this
to me once and I have a vague understanding of how the memory allocation
algorithm works at a high level. I don't think what we are seeing is normal
though and can be explained by this. From what I could gather looking at the
files written by rabbit they contain messages addressed to queues that are
part of the "active" group. Also even if rabbit was to write every single
message it gets through all the queues it would not result in that many
writes. We don't have a throughput of 6000 msg/sec which is the number of
writes iostat reports (spikes at 17,000/s). Our rate is more like 20 msg/sec
across all queues.

We'll leave it running as is but I'm worried that like in the past it will
keep getting worst until the machine simply can't handle the load.

--
Raphael.

On Wed, Oct 26, 2011 at 4:01 PM, Matthew Sackman <matthew at rabbitmq.com>wrote:

> Raphael,
>
> Rabbit uses a somewhat sophisticated mechanism to allocate RAM to
> queues. The allocation of RAM to queues is extremely difficult to do -
> what are the criteria that you should use to decide to prioritise one
> queue over another? Furthermore, if the same msg ends up in multiple
> queues then that msg will exist just once in RAM but be shared by all
> those queues. So it's actually nonsensical to ask how much memory a
> queue is using.
>
> The approach we adopt results in Rabbit telling all the queues on a node
> to achieve the same *duration* in RAM. I.e. if that duration is, for
> example, 10 seconds, then every queue should ensure that given their
> individual current ingress and egress rates, the number of messages they
> hold in RAM does not represent more than 10 seconds. Messages beyond
> that count will be written to disk.
>
> The effect of this strategy is that very fast queues find that an awful
> lot of messages make up that duration, and very slow queues find that
> very few messages make up that duration. Thus very slow queues can end
> up with a "target_ram_count" of 0 or small numbers, whilst fast queues
> have much higher "target_ram_counts".
>
> This is desireable because a slow queue is far more likely to withstand
> having to write everything to disk and read from disk than a fast queue
> can. As I have blogged about,
> ( http://www.rabbitmq.com/blog/2011/09/24/sizing-your-rabbits/ ), as a
> queue gets longer, its CPU-per-msg goes up. As it starts having to write
> to disk, the CPU-per-msg goes up even faster. Plus disks have much lower
> bandwidth than RAM. Thus a fast queue is likely to catastrophically
> consume CPU and disk bandwidth if it starts getting forced out to disk.
> But for a slow queue, this is absolutely fine.
>
> Thus in the case of a slow queue receiving a lot rate of messages, what
> is the problem with Rabbit deciding to write these out to disk? It's
> doing it deliberately because it believes that queue can cope with being
> pushed to disk (which it seems to be able to - ingress and egress rates
> match), and in order to free up vital resources (RAM) for other queues
> which can not cope with being sent to disk.
>
> Rabbit works hard to avoid crowbars - sudden events where it decides to
> write out millions of messages. In order to avoid this on a queue that
> slowly grows and forces RAM usage to head towards the limit, Rabbit
> starts writing out to disk very early on so that the transition to
> fully-on-disk operation is as smooth and unnoticable as possible. Thus
> even when Rabbit is some way away from its memory limit, it can still
> choose to start to push msgs out to disk so to reduce the chances of
> hitting the memory limit and then realising that there are millions of
> msgs that need writing out causing a massive burst to the disk which'll
> disrupt performance substantially.
>
> I hope that helps explain a little more.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111026/49bb87c5/attachment.htm>

From matthew at rabbitmq.com  Thu Oct 27 00:36:02 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 27 Oct 2011 00:36:02 +0100
Subject: [rabbitmq-discuss] RabbitMQ writes non stop to disk
In-Reply-To: <CAD7X3-=9u-GyAPoEiC8QR9OriKE2OCETGsSqNPTOZGNf5ZXQgw@mail.gmail.com>
References: <CAD7X3-nRLHv+uEf0Vy3JTzW8WRNvUW4vSszykU4F=WCEouM5SA@mail.gmail.com>
	<4EA69CF9.7010809@rabbitmq.com>
	<CAD7X3-nrsELeXAS3=q79Jss_6=cWS3VXEtJ7QBBRnU6wyNy8ew@mail.gmail.com>
	<20111026230113.GC4602@wellquite.org>
	<CAD7X3-=9u-GyAPoEiC8QR9OriKE2OCETGsSqNPTOZGNf5ZXQgw@mail.gmail.com>
Message-ID: <20111026233601.GD4602@wellquite.org>

On Wed, Oct 26, 2011 at 04:26:38PM -0700, Raphael Simon wrote:
> Thank you for the long explanation Matthew, you had already explained this
> to me once and I have a vague understanding of how the memory allocation
> algorithm works at a high level. I don't think what we are seeing is normal
> though and can be explained by this. From what I could gather looking at the
> files written by rabbit they contain messages addressed to queues that are
> part of the "active" group. Also even if rabbit was to write every single
> message it gets through all the queues it would not result in that many
> writes. We don't have a throughput of 6000 msg/sec which is the number of
> writes iostat reports (spikes at 17,000/s). Our rate is more like 20 msg/sec
> across all queues.

For a persistent msg to a durable queue, each message will result in the
following writes:

1. The message itself. This is heavily buffered and should be done in
one write. However, I've no idea what iostat actually reports (pages
written? or syscalls to writev? or...?)

2. The fact that the msg has been published to the queue.

3. When the msg is delivered, the fact that the msg has been delivered
by the queue.

4. When the msg is ack'd, the fact that the msg has been ack'd.

2, 3 and 4 are journalled on a per queue basis. They are tiny writes (3
and 4 especially) and should again be heavily buffered, but I think we
have some timers going on that are forcing fsyncs of this journal very
often and thus may be resulting in vastly higher numbers of writes than
necessary. However, thinking about it, I don't think that existed back
in 2.4.1.

The journal involved in 2, 3 and 4 periodically gets written out which
could result in further writes for this msg in this queue.

So I would say that for each message, you're looking at a maximum of 7
"writes". Whether these writes gets coalesced or even cancelled out
entirely is difficult to say. The average should be much lower than 7
though for your use case.

Matthew

From matthias at rabbitmq.com  Thu Oct 27 00:44:02 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 27 Oct 2011 00:44:02 +0100
Subject: [rabbitmq-discuss] RabbitMQ writes non stop to disk
In-Reply-To: <CAD7X3-=9u-GyAPoEiC8QR9OriKE2OCETGsSqNPTOZGNf5ZXQgw@mail.gmail.com>
References: <CAD7X3-nRLHv+uEf0Vy3JTzW8WRNvUW4vSszykU4F=WCEouM5SA@mail.gmail.com>	<4EA69CF9.7010809@rabbitmq.com>	<CAD7X3-nrsELeXAS3=q79Jss_6=cWS3VXEtJ7QBBRnU6wyNy8ew@mail.gmail.com>	<20111026230113.GC4602@wellquite.org>
	<CAD7X3-=9u-GyAPoEiC8QR9OriKE2OCETGsSqNPTOZGNf5ZXQgw@mail.gmail.com>
Message-ID: <4EA89B42.60309@rabbitmq.com>

Raphael,

On 27/10/11 00:26, Raphael Simon wrote:
> We don't have a throughput of
> 6000 msg/sec which is the number of writes iostat reports (spikes at
> 17,000/s).

You also said (off list) that you had 22k open file descriptors. 
Assuming that they are not all sockets and that you don't have thousands 
of queues that is quite strange.

If you cannot upgrade to 2.6.1, please send us the output of
'rabbitmqctl list_queues name durable arguments pid messages_ready 
messages_unacknowledged consumers memory backing_queue_status'.

Matthias.

From raphael at rightscale.com  Thu Oct 27 00:47:39 2011
From: raphael at rightscale.com (Raphael Simon)
Date: Wed, 26 Oct 2011 16:47:39 -0700
Subject: [rabbitmq-discuss] RabbitMQ writes non stop to disk
In-Reply-To: <4EA89B42.60309@rabbitmq.com>
References: <CAD7X3-nRLHv+uEf0Vy3JTzW8WRNvUW4vSszykU4F=WCEouM5SA@mail.gmail.com>
	<4EA69CF9.7010809@rabbitmq.com>
	<CAD7X3-nrsELeXAS3=q79Jss_6=cWS3VXEtJ7QBBRnU6wyNy8ew@mail.gmail.com>
	<20111026230113.GC4602@wellquite.org>
	<CAD7X3-=9u-GyAPoEiC8QR9OriKE2OCETGsSqNPTOZGNf5ZXQgw@mail.gmail.com>
	<4EA89B42.60309@rabbitmq.com>
Message-ID: <CAD7X3-nNO0TY-4BKz3_Gxbr8Yp_vkKAoXu5SzSKz3s1wkqSinQ@mail.gmail.com>

Hi Matthias, we do have low throughput but lots of queues (~ 20k currently).
I'll send you the output in a separate email.

--
Raphael.

On Wed, Oct 26, 2011 at 4:44 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Raphael,
>
>
> On 27/10/11 00:26, Raphael Simon wrote:
>
>> We don't have a throughput of
>> 6000 msg/sec which is the number of writes iostat reports (spikes at
>> 17,000/s).
>>
>
> You also said (off list) that you had 22k open file descriptors. Assuming
> that they are not all sockets and that you don't have thousands of queues
> that is quite strange.
>
> If you cannot upgrade to 2.6.1, please send us the output of
> 'rabbitmqctl list_queues name durable arguments pid messages_ready
> messages_unacknowledged consumers memory backing_queue_status'.
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111026/d9694402/attachment.htm>

From matthias at rabbitmq.com  Thu Oct 27 01:07:00 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 27 Oct 2011 01:07:00 +0100
Subject: [rabbitmq-discuss] RabbitMQ writes non stop to disk
In-Reply-To: <CAD7X3-nNO0TY-4BKz3_Gxbr8Yp_vkKAoXu5SzSKz3s1wkqSinQ@mail.gmail.com>
References: <CAD7X3-nRLHv+uEf0Vy3JTzW8WRNvUW4vSszykU4F=WCEouM5SA@mail.gmail.com>	<4EA69CF9.7010809@rabbitmq.com>	<CAD7X3-nrsELeXAS3=q79Jss_6=cWS3VXEtJ7QBBRnU6wyNy8ew@mail.gmail.com>	<20111026230113.GC4602@wellquite.org>	<CAD7X3-=9u-GyAPoEiC8QR9OriKE2OCETGsSqNPTOZGNf5ZXQgw@mail.gmail.com>	<4EA89B42.60309@rabbitmq.com>
	<CAD7X3-nNO0TY-4BKz3_Gxbr8Yp_vkKAoXu5SzSKz3s1wkqSinQ@mail.gmail.com>
Message-ID: <4EA8A0A4.8060909@rabbitmq.com>

On 27/10/11 00:47, Raphael Simon wrote:
> Hi Matthias, we do have low throughput but lots of queues (~ 20k
> currently). I'll send you the output in a separate email.

Thanks. Can't see anything unusual at first glance. All but a dozen 
queues are idle, and the rest are very slow-moving.

We really need to get you onto a more recent rabbit. What causes 
difficulties in updating your custom plug-in?

Matthias.

From raphael at rightscale.com  Thu Oct 27 01:16:01 2011
From: raphael at rightscale.com (Raphael Simon)
Date: Wed, 26 Oct 2011 17:16:01 -0700
Subject: [rabbitmq-discuss] RabbitMQ writes non stop to disk
In-Reply-To: <4EA8A0A4.8060909@rabbitmq.com>
References: <CAD7X3-nRLHv+uEf0Vy3JTzW8WRNvUW4vSszykU4F=WCEouM5SA@mail.gmail.com>
	<4EA69CF9.7010809@rabbitmq.com>
	<CAD7X3-nrsELeXAS3=q79Jss_6=cWS3VXEtJ7QBBRnU6wyNy8ew@mail.gmail.com>
	<20111026230113.GC4602@wellquite.org>
	<CAD7X3-=9u-GyAPoEiC8QR9OriKE2OCETGsSqNPTOZGNf5ZXQgw@mail.gmail.com>
	<4EA89B42.60309@rabbitmq.com>
	<CAD7X3-nNO0TY-4BKz3_Gxbr8Yp_vkKAoXu5SzSKz3s1wkqSinQ@mail.gmail.com>
	<4EA8A0A4.8060909@rabbitmq.com>
Message-ID: <CAD7X3-=TV-WuhoUpjNM1suM=j-tHwicD+GffzbAkz78dd73Rng@mail.gmail.com>

It's not that it is necessarily difficult, it just that it takes time to
make sure everything is OK before we can deploy to production. For some
reason customers don't like it when the system doesn't work ;) There is also
a release train we have to adhere to, anyway we will plan on upgrading but I
wish we could do it without a gun pointed at our heads.

--
Raphael.

On Wed, Oct 26, 2011 at 5:07 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> On 27/10/11 00:47, Raphael Simon wrote:
>
>> Hi Matthias, we do have low throughput but lots of queues (~ 20k
>> currently). I'll send you the output in a separate email.
>>
>
> Thanks. Can't see anything unusual at first glance. All but a dozen queues
> are idle, and the rest are very slow-moving.
>
> We really need to get you onto a more recent rabbit. What causes
> difficulties in updating your custom plug-in?
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111026/f3d6158e/attachment.htm>

From matthias at rabbitmq.com  Thu Oct 27 01:47:42 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 27 Oct 2011 01:47:42 +0100
Subject: [rabbitmq-discuss] RabbitMQ writes non stop to disk
In-Reply-To: <CAD7X3-=TV-WuhoUpjNM1suM=j-tHwicD+GffzbAkz78dd73Rng@mail.gmail.com>
References: <CAD7X3-nRLHv+uEf0Vy3JTzW8WRNvUW4vSszykU4F=WCEouM5SA@mail.gmail.com>	<4EA69CF9.7010809@rabbitmq.com>	<CAD7X3-nrsELeXAS3=q79Jss_6=cWS3VXEtJ7QBBRnU6wyNy8ew@mail.gmail.com>	<20111026230113.GC4602@wellquite.org>	<CAD7X3-=9u-GyAPoEiC8QR9OriKE2OCETGsSqNPTOZGNf5ZXQgw@mail.gmail.com>	<4EA89B42.60309@rabbitmq.com>	<CAD7X3-nNO0TY-4BKz3_Gxbr8Yp_vkKAoXu5SzSKz3s1wkqSinQ@mail.gmail.com>	<4EA8A0A4.8060909@rabbitmq.com>
	<CAD7X3-=TV-WuhoUpjNM1suM=j-tHwicD+GffzbAkz78dd73Rng@mail.gmail.com>
Message-ID: <4EA8AA2E.5090603@rabbitmq.com>

On 27/10/11 01:16, Raphael Simon wrote:
> It's not that it is necessarily difficult, it just that it takes time to
> make sure everything is OK before we can deploy to production.

ok.

Can you find out what files the 6k/s writes are going to? It can't be 
just the persistent message store since, as you observed, that's only 
writing 16M about every couple of minutes. And while I would expect to 
see some writes to the queue index journal files, these shouldn't add up 
to anywhere near 6k/s with the traffic levels you are reporting.

Matthias.

From matthias at rabbitmq.com  Thu Oct 27 02:29:55 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 27 Oct 2011 02:29:55 +0100
Subject: [rabbitmq-discuss] RabbitMQ writes non stop to disk
In-Reply-To: <4EA8AA2E.5090603@rabbitmq.com>
References: <CAD7X3-nRLHv+uEf0Vy3JTzW8WRNvUW4vSszykU4F=WCEouM5SA@mail.gmail.com>	<4EA69CF9.7010809@rabbitmq.com>	<CAD7X3-nrsELeXAS3=q79Jss_6=cWS3VXEtJ7QBBRnU6wyNy8ew@mail.gmail.com>	<20111026230113.GC4602@wellquite.org>	<CAD7X3-=9u-GyAPoEiC8QR9OriKE2OCETGsSqNPTOZGNf5ZXQgw@mail.gmail.com>	<4EA89B42.60309@rabbitmq.com>	<CAD7X3-nNO0TY-4BKz3_Gxbr8Yp_vkKAoXu5SzSKz3s1wkqSinQ@mail.gmail.com>	<4EA8A0A4.8060909@rabbitmq.com>	<CAD7X3-=TV-WuhoUpjNM1suM=j-tHwicD+GffzbAkz78dd73Rng@mail.gmail.com>
	<4EA8AA2E.5090603@rabbitmq.com>
Message-ID: <4EA8B413.70908@rabbitmq.com>

Raphael,

On 27/10/11 01:47, Matthias Radestock wrote:
> Can you find out what files the 6k/s writes are going to? It can't be
> just the persistent message store since, as you observed, that's only
> writing 16M about every couple of minutes. And while I would expect to
> see some writes to the queue index journal files, these shouldn't add up
> to anywhere near 6k/s with the traffic levels you are reporting.

Btw, are you definitely looking at the correct column in the iostat output?

As a test I ran 'MulticastMain -f persistent -q 1 -r 17 -s 50000' (i.e. 
17msg/s, persistent, qos=1, 50k message size), and the same with "-r 8" 
- which roughly corresponds to the rates I saw reported on the two 
queues in the system with non-negligible traffic. I adjusted rabbit's 
memory thresholds s.t. the target_ram_count of the queues dropped to 
zero but w/o raising the memory alarm. 'iostat -d -x 10' shows:

Device:         rrqm/s   wrqm/s     r/s     w/s   rsec/s   wsec/s 
avgrq-sz avgqu-sz   await  svctm  %util
sda               0.00   219.70    0.00   57.70     0.00  2219.20 
38.46     0.61   10.57  10.55  60.90

So that's just 57.70 writes/s.


Matthias.

From raphael at rightscale.com  Thu Oct 27 05:18:56 2011
From: raphael at rightscale.com (Raphael Simon)
Date: Wed, 26 Oct 2011 21:18:56 -0700
Subject: [rabbitmq-discuss] RabbitMQ writes non stop to disk
In-Reply-To: <4EA8B413.70908@rabbitmq.com>
References: <CAD7X3-nRLHv+uEf0Vy3JTzW8WRNvUW4vSszykU4F=WCEouM5SA@mail.gmail.com>
	<4EA69CF9.7010809@rabbitmq.com>
	<CAD7X3-nrsELeXAS3=q79Jss_6=cWS3VXEtJ7QBBRnU6wyNy8ew@mail.gmail.com>
	<20111026230113.GC4602@wellquite.org>
	<CAD7X3-=9u-GyAPoEiC8QR9OriKE2OCETGsSqNPTOZGNf5ZXQgw@mail.gmail.com>
	<4EA89B42.60309@rabbitmq.com>
	<CAD7X3-nNO0TY-4BKz3_Gxbr8Yp_vkKAoXu5SzSKz3s1wkqSinQ@mail.gmail.com>
	<4EA8A0A4.8060909@rabbitmq.com>
	<CAD7X3-=TV-WuhoUpjNM1suM=j-tHwicD+GffzbAkz78dd73Rng@mail.gmail.com>
	<4EA8AA2E.5090603@rabbitmq.com> <4EA8B413.70908@rabbitmq.com>
Message-ID: <CAD7X3-kSMz490m3iSW8d6UPqiNON2+oaiHKyEi-ijSHKqxejxw@mail.gmail.com>

This is the output of the same command line on the broker with high i/o:

Device:         rrqm/s   wrqm/s     r/s     w/s   rsec/s   wsec/s avgrq-sz
avgqu-sz   await  svctm  %util
dm-0              0.00     0.00    0.00   83.62     0.00  6217.08    74.35
  0.06    0.78   0.50   4.20

So you're right I was looking at blocks written per second. Is there a way
to easily retrieve the average ingress rate across all queues for a broker?
Maybe what's happening is a rogue client is spamming that specific server.
I'd like to see the average ingress rate across all our brokers to validate
that theory.

Thanks for the help troubleshooting!

--
Raphael.

On Wed, Oct 26, 2011 at 6:29 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Raphael,
>
>
> On 27/10/11 01:47, Matthias Radestock wrote:
>
>> Can you find out what files the 6k/s writes are going to? It can't be
>> just the persistent message store since, as you observed, that's only
>> writing 16M about every couple of minutes. And while I would expect to
>> see some writes to the queue index journal files, these shouldn't add up
>> to anywhere near 6k/s with the traffic levels you are reporting.
>>
>
> Btw, are you definitely looking at the correct column in the iostat output?
>
> As a test I ran 'MulticastMain -f persistent -q 1 -r 17 -s 50000' (i.e.
> 17msg/s, persistent, qos=1, 50k message size), and the same with "-r 8" -
> which roughly corresponds to the rates I saw reported on the two queues in
> the system with non-negligible traffic. I adjusted rabbit's memory
> thresholds s.t. the target_ram_count of the queues dropped to zero but w/o
> raising the memory alarm. 'iostat -d -x 10' shows:
>
> Device:         rrqm/s   wrqm/s     r/s     w/s   rsec/s   wsec/s avgrq-sz
> avgqu-sz   await  svctm  %util
> sda               0.00   219.70    0.00   57.70     0.00  2219.20 38.46
> 0.61   10.57  10.55  60.90
>
> So that's just 57.70 writes/s.
>
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111026/27933598/attachment.htm>

From andrew.rendell at gmail.com  Thu Oct 27 07:02:13 2011
From: andrew.rendell at gmail.com (Anderew)
Date: Wed, 26 Oct 2011 23:02:13 -0700 (PDT)
Subject: [rabbitmq-discuss] Mirror queues and poor write performance
In-Reply-To: <20111026224544.GB4602@wellquite.org>
References: <448858bd-6a94-4677-aa89-34506deed3ec@m19g2000vbm.googlegroups.com>
	<20111026224223.GA4602@wellquite.org>
	<20111026224544.GB4602@wellquite.org>
Message-ID: <c58cd0e6-6efa-417b-b6f1-bf4525cd5420@o19g2000vbk.googlegroups.com>

It sounds from your description that what I am seeing is unexpected
and therefore probably an error somewhere on my part. I will go back
to my test code and re-investigate. Thanks for the response!

Andrew.

On Oct 26, 11:45?pm, Matthew Sackman <matt... at rabbitmq.com> wrote:
> On Wed, Oct 26, 2011 at 11:42:23PM +0100, Matthew Sackman wrote:
> > When publishing to a mirrored queue where the master is on the node to
> > which you're connected, the msg will make at least 3 inter-node hops,
>
> Oh, that 3 is assuming there's just one other node. For each additional
> node that's a member of the mirrored queue add another 2 inter-node
> copies of the actual message being published. Plus further associated
> msgs.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthias at rabbitmq.com  Thu Oct 27 07:19:25 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 27 Oct 2011 07:19:25 +0100
Subject: [rabbitmq-discuss] RabbitMQ writes non stop to disk
In-Reply-To: <CAD7X3-kSMz490m3iSW8d6UPqiNON2+oaiHKyEi-ijSHKqxejxw@mail.gmail.com>
References: <CAD7X3-nRLHv+uEf0Vy3JTzW8WRNvUW4vSszykU4F=WCEouM5SA@mail.gmail.com>	<4EA69CF9.7010809@rabbitmq.com>	<CAD7X3-nrsELeXAS3=q79Jss_6=cWS3VXEtJ7QBBRnU6wyNy8ew@mail.gmail.com>	<20111026230113.GC4602@wellquite.org>	<CAD7X3-=9u-GyAPoEiC8QR9OriKE2OCETGsSqNPTOZGNf5ZXQgw@mail.gmail.com>	<4EA89B42.60309@rabbitmq.com>	<CAD7X3-nNO0TY-4BKz3_Gxbr8Yp_vkKAoXu5SzSKz3s1wkqSinQ@mail.gmail.com>	<4EA8A0A4.8060909@rabbitmq.com>	<CAD7X3-=TV-WuhoUpjNM1suM=j-tHwicD+GffzbAkz78dd73Rng@mail.gmail.com>	<4EA8AA2E.5090603@rabbitmq.com>	<4EA8B413.70908@rabbitmq.com>
	<CAD7X3-kSMz490m3iSW8d6UPqiNON2+oaiHKyEi-ijSHKqxejxw@mail.gmail.com>
Message-ID: <4EA8F7ED.6080607@rabbitmq.com>

Raphael,

On 27/10/11 05:18, Raphael Simon wrote:
> Is there a way to easily retrieve the average ingress rate across all
> queues for a broker?  Maybe what's happening is a rogue client is spamming that
> specific server. I'd like to see the average ingress rate across all our
> brokers to validate that theory.

The avg queue ingress rate should be easy to calculate by extracting the 
rate information for all queues through the management API.

Wouldn't it be better to look at inbound connection data rates for 
though, e.g. identify the connection with the highest inbound rate? Or 
perhaps look at per-channel message stats. You can get at all of these 
through the management API.

Regards,

Matthias.

From gil.strauss at gmail.com  Thu Oct 27 07:40:21 2011
From: gil.strauss at gmail.com (Gil Strauss)
Date: Wed, 26 Oct 2011 23:40:21 -0700 (PDT)
Subject: [rabbitmq-discuss] Durable Queue
Message-ID: <889cc13c-7085-493d-b9f9-fa59f1ddcc0f@j39g2000yqc.googlegroups.com>

Hello

I have an a durable exchange and a queue that is bound to it in the
publisher code which its also defined as durable.

What will be the behavior if I'll bind a non durable queue with that
exchange in the subscriber code in a case the exchange's server fails?

Thanks,

Gil

From matthias at rabbitmq.com  Thu Oct 27 08:07:36 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 27 Oct 2011 08:07:36 +0100
Subject: [rabbitmq-discuss] Clustered queues and bindings dropped when
 sending large messages
In-Reply-To: <CAAcXTOYbE8=XsT1gqsn15MV9iA+QcXDaMrOdxjHpLPRVsdRjcA@mail.gmail.com>
References: <CAAcXTObGjA8xcxPrYH1caxDOf5L=u4QSJVnysFSdJpU+G6Xx5g@mail.gmail.com>	<4EA68D9E.9090204@rabbitmq.com>
	<4EA69149.3040006@rabbitmq.com>
	<CAAcXTOYbE8=XsT1gqsn15MV9iA+QcXDaMrOdxjHpLPRVsdRjcA@mail.gmail.com>
Message-ID: <4EA90338.6060202@rabbitmq.com>

Irmo,

On 25/10/11 11:54, Irmo Manie wrote:
> It does take more than 60 seconds yes.
> For testing we use some remote virtual machines which are a bit
> sluggish (read: horribly slow) on the I/O.
> But the nodes already get partitioned in about 15-20 seconds which
> doesn't really match the default earliest possibility of 45 seconds.

Depends on when the last tick was sent, e.g. it may have been sent 30 
seconds before the large message is sent.

Btw, 
http://erlang.2086793.n4.nabble.com/node-to-node-message-passing-td2536251.html 
describes the issue.

> Next to this, there is no way that the cluster will try to
> re-partition after such incident?

It should join up again when one node attempts to talk to the other. Not 
sure what would trigger that in rabbit; queue/exchange/binding 
creation/deletion perhaps (due to the mnesia synchronisation that needs 
to happen as part of that).

Regards,

Matthias.

From matthias at rabbitmq.com  Thu Oct 27 08:39:05 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 27 Oct 2011 08:39:05 +0100
Subject: [rabbitmq-discuss] Queue Clustering and Sequencing
In-Reply-To: <5679e3c6-8288-4fb6-9705-e7a2261d2f88@v5g2000vbh.googlegroups.com>
References: <B925600E2C563A4FA33FA9CF64A455B5031DE82D@LITEXCHEVS1.ventyx.org>	<4EA6D9DA.4070701@rabbitmq.com>
	<5679e3c6-8288-4fb6-9705-e7a2261d2f88@v5g2000vbh.googlegroups.com>
Message-ID: <4EA90A99.8070700@rabbitmq.com>

Roger,

On 25/10/11 18:32, RogerF wrote:
> Essentially what we want is key-based load balancing with
> time-limited affinity.

have you tried the obvious approach suggested in your first post, i.e.
have one queue per consumer and ensure that messages for the same key
always end up in the same queue?

You mentioned that you were concerned about...

> Non-related messages are unnecessarily sequenced. When the key
> distribution is not exactly even, one queue may have a backup while
> another is idle.

...but is that really an issue in practice?

Also...

> Complex to configure for differently sized systems.

Take a look at https://github.com/rabbitmq/rabbitmq-consistent-hash-exchange

Regards,

Matthias.

From irmo.manie at gmail.com  Thu Oct 27 08:59:05 2011
From: irmo.manie at gmail.com (Irmo Manie)
Date: Thu, 27 Oct 2011 09:59:05 +0200
Subject: [rabbitmq-discuss] Clustered queues and bindings dropped when
 sending large messages
In-Reply-To: <4EA90338.6060202@rabbitmq.com>
References: <CAAcXTObGjA8xcxPrYH1caxDOf5L=u4QSJVnysFSdJpU+G6Xx5g@mail.gmail.com>
	<4EA68D9E.9090204@rabbitmq.com> <4EA69149.3040006@rabbitmq.com>
	<CAAcXTOYbE8=XsT1gqsn15MV9iA+QcXDaMrOdxjHpLPRVsdRjcA@mail.gmail.com>
	<4EA90338.6060202@rabbitmq.com>
Message-ID: <CAAcXTOY5NVgmj8+GXSybNPKbW3=c5AhvK_PWXnv7A_7vn6fhpA@mail.gmail.com>

Matthias,

On Thu, Oct 27, 2011 at 9:07 AM, Matthias Radestock
<matthias at rabbitmq.com> wrote:
> Irmo,

> Depends on when the last tick was sent, e.g. it may have been sent 30
> seconds before the large message is sent.
>
> Btw,
> http://erlang.2086793.n4.nabble.com/node-to-node-message-passing-td2536251.html
> describes the issue.

Ok thanks, that clarifies the behavior then. I'll prepare our internal
communication tooling  to auto multi-part big messages to prevent all
this.

>
> It should join up again when one node attempts to talk to the other. Not
> sure what would trigger that in rabbit; queue/exchange/binding
> creation/deletion perhaps (due to the mnesia synchronisation that needs to
> happen as part of that).
>

I haven't tested or tried what triggers a full rejoin to the cluster,
including getting all queue and binding info again.
I actually expected this to happen automatically and I think it should, right?

Cheers,
Irmo

From matthias at rabbitmq.com  Thu Oct 27 09:15:42 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 27 Oct 2011 09:15:42 +0100
Subject: [rabbitmq-discuss] Clustered queues and bindings dropped when
 sending large messages
In-Reply-To: <CAAcXTOY5NVgmj8+GXSybNPKbW3=c5AhvK_PWXnv7A_7vn6fhpA@mail.gmail.com>
References: <CAAcXTObGjA8xcxPrYH1caxDOf5L=u4QSJVnysFSdJpU+G6Xx5g@mail.gmail.com>	<4EA68D9E.9090204@rabbitmq.com>
	<4EA69149.3040006@rabbitmq.com>	<CAAcXTOYbE8=XsT1gqsn15MV9iA+QcXDaMrOdxjHpLPRVsdRjcA@mail.gmail.com>	<4EA90338.6060202@rabbitmq.com>
	<CAAcXTOY5NVgmj8+GXSybNPKbW3=c5AhvK_PWXnv7A_7vn6fhpA@mail.gmail.com>
Message-ID: <4EA9132E.1080507@rabbitmq.com>

Irmo,

On 27/10/11 08:59, Irmo Manie wrote:
> I haven't tested or tried what triggers a full rejoin to the cluster,
> including getting all queue and binding info again.

That just results in local reads. Try creating or deleting an 
exchange/binding/queue.

> I actually expected this to happen automatically and I think it
> should, right?

Erlang/OTP doesn't do this for us. So it would have to be done in rabbit 
code.


Matthias.

From ilya at classmetric.com  Thu Oct 27 05:40:12 2011
From: ilya at classmetric.com (Ilya Volodarsky)
Date: Wed, 26 Oct 2011 21:40:12 -0700 (PDT)
Subject: [rabbitmq-discuss] Consuming one queue versus many queues
Message-ID: <97baced7-1d1e-42df-8145-255049bd13cf@g7g2000vbv.googlegroups.com>

Hi,

I am thinking about the RabbitMQ topology for my new API. Each API
call has an API key, and can be one of three calls. I'll have the
three controllers parse / validate the arguments, and then enqueue the
tasks in RabbitMQ. I will then have a service that consumes this
queue(s), and process each of the tasks.

Each API calls will take different times to process.

The question is, should I have

1. One queue where all API calls are fed into (1 queue)
2. One queue per API call (3 queues)
3. One queue per API key (N queueswhere N is the number of customers)
4. One queue per APi key / API operations (3*N queues)

Is there a performance advantage to dequeuing from multiple queues
versus just one? I know that each queue has around 4kb of extra
information with it, so we don't want to make too many. Is there any
sort of locking disadvantage to just having one queue with a lot of
traffic?

Thanks for your help!

From simon at rabbitmq.com  Thu Oct 27 11:31:04 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 27 Oct 2011 11:31:04 +0100
Subject: [rabbitmq-discuss] Durable Queue
In-Reply-To: <889cc13c-7085-493d-b9f9-fa59f1ddcc0f@j39g2000yqc.googlegroups.com>
References: <889cc13c-7085-493d-b9f9-fa59f1ddcc0f@j39g2000yqc.googlegroups.com>
Message-ID: <4EA932E8.5050808@rabbitmq.com>

On 27/10/11 07:40, Gil Strauss wrote:
> I have an a durable exchange and a queue that is bound to it in the
> publisher code which its also defined as durable.
>
> What will be the behavior if I'll bind a non durable queue with that
> exchange in the subscriber code in a case the exchange's server fails?

The transient queue will be removed if the server it is on fails.

If we're talking about a cluster, then the exchange does not live on any 
one node; it lives on all of them.

If we're not talking about a cluster, then the exchange's server is by 
definition the same as the transient queue's server and so the queue 
will be removed.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Oct 27 11:36:11 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 27 Oct 2011 11:36:11 +0100
Subject: [rabbitmq-discuss] Consuming one queue versus many queues
In-Reply-To: <97baced7-1d1e-42df-8145-255049bd13cf@g7g2000vbv.googlegroups.com>
References: <97baced7-1d1e-42df-8145-255049bd13cf@g7g2000vbv.googlegroups.com>
Message-ID: <4EA9341B.9080107@rabbitmq.com>

On 27/10/11 05:40, Ilya Volodarsky wrote:
> Is there a performance advantage to dequeuing from multiple queues
> versus just one? I know that each queue has around 4kb of extra
> information with it, so we don't want to make too many. Is there any
> sort of locking disadvantage to just having one queue with a lot of
> traffic?

Well, each queue needs to maintain ordering for the messages that pass 
through it, so each queue is a single process. If you have a machine 
with lots of cores, or a cluster, you can get more performance out of 
several queues than a single one. The overhead per queue is not huge.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From james.r.carr at gmail.com  Thu Oct 27 12:25:40 2011
From: james.r.carr at gmail.com (James Carr)
Date: Thu, 27 Oct 2011 07:25:40 -0400
Subject: [rabbitmq-discuss] High I/O On RHEL?
Message-ID: <CAJreXKDMsxr9xKijqY8o3jpGeKdfLFHhFu33PG217HcND7nMiA@mail.gmail.com>

One of my clients has been having a recurring problem of the
filesystems on their brokers randomly becoming readonly. Their admin
investigated the errors and determined it was related to this issue
(http://kb.vmware.com/selfservice/microsites/search.do?language=en_US&cmd=displayKC&externalId=51306)
with their running Oracle Enterprise Linux on top of VMWare.

I'm a little confounded and how there could even be too high I/O
interaction for the filesystem to keep up. At most, the brokers only
see 400 messages per second and usually average around 180 messages
per second. This is way below the rates I see on a cluster I run on
Rackspace for another client and I've never seen this happen before.

It's pretty annoying because the filesystem goes readonly randomly in
middle of the night and causes rabbitMQ to shutdown (since having /var
read only screws a lot of things up) and whoever is on call gets paged
(usually at 2am). I've suggested moving the brokers to physical boxes
or using Ubuntu instead of Oracle Enterprise Linux, but I feel like
I'm just making the later suggestion out of spite (I don't like Oracle
Enterprise Linux). :)

Any ideas?


Thanks,
James

From majek04 at gmail.com  Thu Oct 27 13:44:47 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Thu, 27 Oct 2011 13:44:47 +0100
Subject: [rabbitmq-discuss] "sockets module" for rabbitmq.js example
In-Reply-To: <32727898.post@talk.nabble.com>
References: <32727898.post@talk.nabble.com>
Message-ID: <CABzX+qx0Kh8detAkP_LC7Vy28mDfG20hwDMMDUf6Y0AmnTOOAQ@mail.gmail.com>

On Wed, Oct 26, 2011 at 22:46, ChrisAdkin <chris1adkin at yahoo.co.uk> wrote:
> I'm trying to get the example working as per the rabbitmq + node.js posting
> (http://www.rabbitmq.com/blog/2010/11/12/rabbitmq-nodejs-rabbitjs/). I
> follow the example, but when I run node example/socketio.js it falls down
> with:-
>
> node.js:202
> ? ? ? ?throw e; // process.nextTick error, or 'error' event on first tick
> ? ? ? ? ? ? ?^
> Error: Cannot find module 'sockets'
> ? ?at Function._resolveFilename (module.js:334:11)

This looks like a path problem. Try adding this to js files in
examples directory:
require.paths.unshift('..');

Cheers,
  Marek

From majek04 at gmail.com  Thu Oct 27 14:00:44 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Thu, 27 Oct 2011 14:00:44 +0100
Subject: [rabbitmq-discuss] "sockets module" for rabbitmq.js example
In-Reply-To: <CABzX+qx0Kh8detAkP_LC7Vy28mDfG20hwDMMDUf6Y0AmnTOOAQ@mail.gmail.com>
References: <32727898.post@talk.nabble.com>
	<CABzX+qx0Kh8detAkP_LC7Vy28mDfG20hwDMMDUf6Y0AmnTOOAQ@mail.gmail.com>
Message-ID: <CABzX+qyWxdMky74h6wGUUQGwPe4ekGo6LTkq9=ogrdbQ3xctpQ@mail.gmail.com>

On Thu, Oct 27, 2011 at 13:44, Marek Majkowski <majek04 at gmail.com> wrote:
> On Wed, Oct 26, 2011 at 22:46, ChrisAdkin <chris1adkin at yahoo.co.uk> wrote:
>> I'm trying to get the example working as per the rabbitmq + node.js posting
>> (http://www.rabbitmq.com/blog/2010/11/12/rabbitmq-nodejs-rabbitjs/). I
>> follow the example, but when I run node example/socketio.js it falls down
>> with:-
>>
>> node.js:202
>> ? ? ? ?throw e; // process.nextTick error, or 'error' event on first tick
>> ? ? ? ? ? ? ?^
>> Error: Cannot find module 'sockets'
>> ? ?at Function._resolveFilename (module.js:334:11)
>
> This looks like a path problem. Try adding this to js files in
> examples directory:
> require.paths.unshift('..');

You also need `socket.io` version `0.6.18`.

Marek

From matthew at rabbitmq.com  Thu Oct 27 14:37:47 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 27 Oct 2011 14:37:47 +0100
Subject: [rabbitmq-discuss] Mirror queues and poor write performance
In-Reply-To: <c58cd0e6-6efa-417b-b6f1-bf4525cd5420@o19g2000vbk.googlegroups.com>
References: <448858bd-6a94-4677-aa89-34506deed3ec@m19g2000vbm.googlegroups.com>
	<20111026224223.GA4602@wellquite.org>
	<20111026224544.GB4602@wellquite.org>
	<c58cd0e6-6efa-417b-b6f1-bf4525cd5420@o19g2000vbk.googlegroups.com>
Message-ID: <20111027133746.GA22379@rabbitmq.com>

Hi Andrew,

On Wed, Oct 26, 2011 at 11:02:13PM -0700, Anderew wrote:
> It sounds from your description that what I am seeing is unexpected
> and therefore probably an error somewhere on my part. I will go back
> to my test code and re-investigate. Thanks for the response!

Ok, I've been doing some testing.

Everything on one box (no VMs) which is a 4-core (8 thread) CPU.

With a cluster of 2 nodes, simultaneously publishing and consuming,
0-length transient msgs to non-durable queues. I can do a sustained rate
(i.e. the queue pretty much stays empty) of 2500 msgs/second. It's a
little slower if the master is not on the node to which I connect
(around 2300Hz). I'm not using publisher confirms in those tests, but
some quick testing with confirms on (and a fairly large window of 1000)
shows that there's apparently no impact by using confirms.

Yes, this is around an order of magnitude (base 10) slower than without
HA for the same scenario.

It does absorb spikes fairly well though - throwing various spikes of
publishes at it do get absorbed - the consumer just sees slightly more
messages for a while and then the queue again returns to being empty.

At least in the first instance, HA has been designed to be write
rather than fast. There may well be a number of opportunities for
optimisations further down the line.

Matthew

From matthew at rabbitmq.com  Thu Oct 27 14:41:35 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 27 Oct 2011 14:41:35 +0100
Subject: [rabbitmq-discuss] Mirror queues and poor write performance
In-Reply-To: <20111027133746.GA22379@rabbitmq.com>
References: <448858bd-6a94-4677-aa89-34506deed3ec@m19g2000vbm.googlegroups.com>
	<20111026224223.GA4602@wellquite.org>
	<20111026224544.GB4602@wellquite.org>
	<c58cd0e6-6efa-417b-b6f1-bf4525cd5420@o19g2000vbk.googlegroups.com>
	<20111027133746.GA22379@rabbitmq.com>
Message-ID: <20111027134135.GB22379@rabbitmq.com>

On Thu, Oct 27, 2011 at 02:37:47PM +0100, Matthew Sackman wrote:
> At least in the first instance, HA has been designed to be write

write => right.

I shall have to have myself flogged for that one.

Matthew.

From emile at rabbitmq.com  Thu Oct 27 15:21:08 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 27 Oct 2011 15:21:08 +0100
Subject: [rabbitmq-discuss] .NET client with multiple hosts - connecting
 to one of the nodes in the cluster with failover
In-Reply-To: <18935634.1852.1319669270113.JavaMail.geo-discussion-forums@yqhp35>
References: <18935634.1852.1319669270113.JavaMail.geo-discussion-forums@yqhp35>
Message-ID: <4EA968D4.1080104@rabbitmq.com>

Hi,

On 26/10/11 23:47, TrueWill wrote:
> We know in advance what hosts are in our cluster (say, HostA and HostB).
> Initially our client has to try to connect to one of them (HostA, for
> instance). We'd like it to try HostA and, if that doesn't work, HostB
> (then throw an exception on failure).
> 
> RabbitMQ.Client.ConnectionFactory.CreateConnection has a protected
> overload that accepts an array of AmqpTcpEndpoint objects. Is this
> exposed anywhere? Are we supposed to descend from the standard factory?

The .net library supports multiple protocols, including AMQP 0-8.
Brokers supporting 0.8 have the ability to redirect connections and for
clients to attempt connections to a list of brokers. Much of this
support was dropped from the .net client when the broker reached 0-9-1,
in particular, it is only possible to specify a single target broker.

> Or is there a better way? We can certainly solve this by catching
> BrokerUnreachableException and trying the next one, but this seems like
> a problem that others must have solved.

Rabbit client libraries leave room for improvement in this regard,
especially with the introduction of high availability
(http://www.rabbitmq.com/ha.html) on the broker. The approach you
suggest sounds like a reasonable one to take at present.




-Emile

From majek04 at gmail.com  Thu Oct 27 15:24:12 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Thu, 27 Oct 2011 15:24:12 +0100
Subject: [rabbitmq-discuss] "sockets module" for rabbitmq.js example
In-Reply-To: <1319725103.83776.YahooMailNeo@web24102.mail.ird.yahoo.com>
References: <32727898.post@talk.nabble.com>
	<CABzX+qx0Kh8detAkP_LC7Vy28mDfG20hwDMMDUf6Y0AmnTOOAQ@mail.gmail.com>
	<CABzX+qyWxdMky74h6wGUUQGwPe4ekGo6LTkq9=ogrdbQ3xctpQ@mail.gmail.com>
	<1319725103.83776.YahooMailNeo@web24102.mail.ird.yahoo.com>
Message-ID: <CABzX+qwWSc=SjjqHHkd28Ngcsz9BfGBfuk7Mg3Nwc_0OfMTstg@mail.gmail.com>

On Thu, Oct 27, 2011 at 15:18, Chris Adkin <chris1adkin at yahoo.co.uk> wrote:
> Thanks for responding to my question.
> I did have the line you mentioned in one of my js files, however I removed
> it because I was getting an error stack something like this:-
>
>  Error: require.paths is removed. Use node_modules folders, or the NODE_PATH
> environment variable instead.
>         at Function.<anonymous> (module.js:360:11)
>         at Object.<anonymous>
> (/home/olostan/node_modules/less/lib/less/index.js:5:8)
>         at Module._compile (module.js:420:26)
>
> I understand that this is nuance of certain version of node.js, which
> version are you using, because I'm guessing that you do not encounter this
> problem ?.

Yes, I'm running node.js 0.4.x.
I don't know how it works in 0.5. Try googling for NODE_PATH.

Marek

> From: Marek Majkowski <majek04 at gmail.com>
> To: ChrisAdkin <chris1adkin at yahoo.co.uk>
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Sent: Thursday, 27 October 2011, 14:00
> Subject: Re: [rabbitmq-discuss] "sockets module" for rabbitmq.js example
>
> On Thu, Oct 27, 2011 at 13:44, Marek Majkowski <majek04 at gmail.com> wrote:
>> On Wed, Oct 26, 2011 at 22:46, ChrisAdkin <chris1adkin at yahoo.co.uk> wrote:
>>> I'm trying to get the example working as per the rabbitmq + node.js
>>> posting
>>> (http://www.rabbitmq.com/blog/2010/11/12/rabbitmq-nodejs-rabbitjs/). I
>>> follow the example, but when I run node example/socketio.js it falls down
>>> with:-
>>>
>>> node.js:202
>>> ? ? ? ?throw e; // process.nextTick error, or 'error' event on first tick
>>> ? ? ? ? ? ? ?^
>>> Error: Cannot find module 'sockets'
>>> ? ?at Function._resolveFilename (module.js:334:11)
>>
>> This looks like a path problem. Try adding this to js files in
>> examples directory:
>> require.paths.unshift('..');
>
> You also need `socket.io` version `0.6.18`.
>
> Marek
>
>
>

From lianlupeng at gmail.com  Thu Oct 27 15:43:15 2011
From: lianlupeng at gmail.com (=?GB2312?B?xKe45w==?=)
Date: Thu, 27 Oct 2011 22:43:15 +0800
Subject: [rabbitmq-discuss] ok
Message-ID: <CAAmu3Q8oUzHPC1ffLRTSQeEhzoHax8ysS45H-AqkYnkEtuKhbw@mail.gmail.com>

thanks?
-- 
by lianlupeng.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111027/343e4e85/attachment.htm>

From james.r.carr at gmail.com  Thu Oct 27 15:53:58 2011
From: james.r.carr at gmail.com (James Carr)
Date: Thu, 27 Oct 2011 09:53:58 -0500
Subject: [rabbitmq-discuss] "sockets module" for rabbitmq.js example
In-Reply-To: <CABzX+qwWSc=SjjqHHkd28Ngcsz9BfGBfuk7Mg3Nwc_0OfMTstg@mail.gmail.com>
References: <32727898.post@talk.nabble.com>
	<CABzX+qx0Kh8detAkP_LC7Vy28mDfG20hwDMMDUf6Y0AmnTOOAQ@mail.gmail.com>
	<CABzX+qyWxdMky74h6wGUUQGwPe4ekGo6LTkq9=ogrdbQ3xctpQ@mail.gmail.com>
	<1319725103.83776.YahooMailNeo@web24102.mail.ird.yahoo.com>
	<CABzX+qwWSc=SjjqHHkd28Ngcsz9BfGBfuk7Mg3Nwc_0OfMTstg@mail.gmail.com>
Message-ID: <CAJreXKAs=Mst5koP-GyP4CeUp-ABqs0zCvniNVWtG2SPorGGsg@mail.gmail.com>

in node 0.5 (and all version going forward) you're not allowed to
manipulate require.paths.

Another option is to just include sockets.js directly using the path
it is located at.


On Thu, Oct 27, 2011 at 9:24 AM, Marek Majkowski <majek04 at gmail.com> wrote:
> On Thu, Oct 27, 2011 at 15:18, Chris Adkin <chris1adkin at yahoo.co.uk> wrote:
>> Thanks for responding to my question.
>> I did have the line you mentioned in one of my js files, however I removed
>> it because I was getting an error stack something like this:-
>>
>> ?Error: require.paths is removed. Use node_modules folders, or the NODE_PATH
>> environment variable instead.
>> ? ? ? ? at Function.<anonymous> (module.js:360:11)
>> ? ? ? ? at Object.<anonymous>
>> (/home/olostan/node_modules/less/lib/less/index.js:5:8)
>> ? ? ? ? at Module._compile (module.js:420:26)
>>
>> I understand that this is nuance of certain version of node.js, which
>> version are you using, because I'm guessing that you do not encounter this
>> problem ?.
>
> Yes, I'm running node.js 0.4.x.
> I don't know how it works in 0.5. Try googling for NODE_PATH.
>
> Marek
>
>> From: Marek Majkowski <majek04 at gmail.com>
>> To: ChrisAdkin <chris1adkin at yahoo.co.uk>
>> Cc: rabbitmq-discuss at lists.rabbitmq.com
>> Sent: Thursday, 27 October 2011, 14:00
>> Subject: Re: [rabbitmq-discuss] "sockets module" for rabbitmq.js example
>>
>> On Thu, Oct 27, 2011 at 13:44, Marek Majkowski <majek04 at gmail.com> wrote:
>>> On Wed, Oct 26, 2011 at 22:46, ChrisAdkin <chris1adkin at yahoo.co.uk> wrote:
>>>> I'm trying to get the example working as per the rabbitmq + node.js
>>>> posting
>>>> (http://www.rabbitmq.com/blog/2010/11/12/rabbitmq-nodejs-rabbitjs/). I
>>>> follow the example, but when I run node example/socketio.js it falls down
>>>> with:-
>>>>
>>>> node.js:202
>>>> ? ? ? ?throw e; // process.nextTick error, or 'error' event on first tick
>>>> ? ? ? ? ? ? ?^
>>>> Error: Cannot find module 'sockets'
>>>> ? ?at Function._resolveFilename (module.js:334:11)
>>>
>>> This looks like a path problem. Try adding this to js files in
>>> examples directory:
>>> require.paths.unshift('..');
>>
>> You also need `socket.io` version `0.6.18`.
>>
>> Marek
>>
>>
>>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From mleyton at niclabs.cl  Thu Oct 27 15:41:01 2011
From: mleyton at niclabs.cl (Mario Leyton)
Date: Thu, 27 Oct 2011 11:41:01 -0300
Subject: [rabbitmq-discuss] Java RabbitMQ API bug in response.getHeaders()?
Message-ID: <4EA96D7D.8090004@niclabs.cl>

Hello,

We are using rabbitmq java client and I believe the following is a bug:

GetResponse response = ...;
AMQP.BasicProperties props = response.getProps();
Map<String, Object> headers = props.getHeaders();

If no headers are set, then headers variable is null when it should be
an empty Map.

We are using the following rabbitmq libraries and versions:

'com.rabbitmq:amqp-client:jar:2.3.1',
'org.apache.commons:commons-io:jar:1.3.2',
'commons-pool:commons-pool:jar:1.5.6'

Mario Leyton
--
NIC Chile Research Labs

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111027/f955554d/attachment.htm>

From tonygarnockjones+rabbitmq at gmail.com  Thu Oct 27 17:06:48 2011
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Thu, 27 Oct 2011 12:06:48 -0400
Subject: [rabbitmq-discuss] Java RabbitMQ API bug in
	response.getHeaders()?
In-Reply-To: <4EA96D7D.8090004@niclabs.cl>
References: <4EA96D7D.8090004@niclabs.cl>
Message-ID: <CAM8fPiQoXGuPX3W8z3Wzc9u7NP4m6K_7TjUJwgmRv8M9WK9Fbg@mail.gmail.com>

On 27 October 2011 10:41, Mario Leyton <mleyton at niclabs.cl> wrote:

>  We are using rabbitmq java client and I believe the following is a bug:
>

Nope, it's deliberate. null, here, represents that no headers were sent.
This is distinct from an empty map being sent. AMQP's basic properties
structure includes "absent/present" bits for all of the fields; we chose to
use "null" to represent "missing", as in this instance it is unambiguous.
In languages like ML and Haskell we'd use 'whatever option and Maybe
whatever, respectively. In C, we use a bitmap stored separately from the
struct members concerned.

So when reading (or writing!) basic properties in Java,

   - null means "missing value" or "no value"
   - empty map, empty string etc. is a *present* value but is otherwise
   just itself
   - non-empty maps, strings, etc are present values

Regards,
  Tony
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111027/9726c0c2/attachment.htm>

From vbernard42 at gmail.com  Thu Oct 27 17:00:41 2011
From: vbernard42 at gmail.com (Valentin BERNARD)
Date: Thu, 27 Oct 2011 09:00:41 -0700 (PDT)
Subject: [rabbitmq-discuss] Java RabbitMQ API bug in
	response.getHeaders()?
In-Reply-To: <4EA96D7D.8090004@niclabs.cl>
References: <4EA96D7D.8090004@niclabs.cl>
Message-ID: <5204c265-2f04-44de-a5c2-b5fdf988e3ac@m19g2000yqh.googlegroups.com>

Hi Mario,

I think this is the correct behavior, according to the javadoc:
http://www.rabbitmq.com/releases/rabbitmq-java-client/v2.3.1/rabbitmq-java-client-javadoc-2.3.1/com/rabbitmq/client/AMQP.BasicProperties.html#getHeaders()

Cheers,

Valentin.

On 27 oct, 16:41, Mario Leyton <mley... at niclabs.cl> wrote:
> Hello,
>
> We are using rabbitmq java client and I believe the following is a bug:
>
> GetResponse response = ...;
> AMQP.BasicProperties props = response.getProps();
> Map<String, Object> headers = props.getHeaders();
>
> If no headers are set, then headers variable is null when it should be
> an empty Map.
>
> We are using the following rabbitmq libraries and versions:
>
> 'com.rabbitmq:amqp-client:jar:2.3.1',
> 'org.apache.commons:commons-io:jar:1.3.2',
> 'commons-pool:commons-pool:jar:1.5.6'
>
> Mario Leyton
> --
> NIC Chile Research Labs
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From mleyton at niclabs.cl  Thu Oct 27 17:23:47 2011
From: mleyton at niclabs.cl (Mario Leyton)
Date: Thu, 27 Oct 2011 13:23:47 -0300
Subject: [rabbitmq-discuss] Java RabbitMQ API bug in
	response.getHeaders()?
In-Reply-To: <CAM8fPiQoXGuPX3W8z3Wzc9u7NP4m6K_7TjUJwgmRv8M9WK9Fbg@mail.gmail.com>
References: <4EA96D7D.8090004@niclabs.cl>
	<CAM8fPiQoXGuPX3W8z3Wzc9u7NP4m6K_7TjUJwgmRv8M9WK9Fbg@mail.gmail.com>
Message-ID: <4EA98593.8030207@niclabs.cl>

Thanks for your quick reply Tony but I completely disagree with your
implementation choice ;-)

If there are no headers, it doesn't matter why, a good API should always
return an empty Map o List and not null because it contaminates the API
user's code.  Instead of simply doing:

Map headers = response.getHeaders();
for(String k: headers.getKeys(){ ... }

The API user has to add the code:

if(headers != null){
   for(String k: headers.getKeys(){ ... }
}

This if(headers != null) has to be added by all API users, even if they
don't care to distinguish between the empty header or unsent header. If
an API user doesn't  add the if, the code actually breaks with a null
pointer exception depending on the message!

If the API user is actually concerned on why the set is empty you can
provide additional info like headerWasSent() to distinguish the
difference. This is actually a lot clearer for maintaining the API
user's code because it is evident that he is testing if the header was
sent or not instead of simply checking as not to through the
nullpointer  exception.

If you are still not convinced, I was convinced myself after reading
Joshua Bloch's Effective Java Programming:

http://java.sun.com/docs/books/effective/toc.html

Item 43: Return empty arrays or collections, not nulls

Mario Leyton
--
NIC Chile Research Labs


On 10/27/11 1:06 PM, Tony Garnock-Jones wrote:
> On 27 October 2011 10:41, Mario Leyton <mleyton at niclabs.cl> wrote:
>
>>  We are using rabbitmq java client and I believe the following is a bug:
>>
> Nope, it's deliberate. null, here, represents that no headers were sent.
> This is distinct from an empty map being sent. AMQP's basic properties
> structure includes "absent/present" bits for all of the fields; we chose to
> use "null" to represent "missing", as in this instance it is unambiguous.
> In languages like ML and Haskell we'd use 'whatever option and Maybe
> whatever, respectively. In C, we use a bitmap stored separately from the
> struct members concerned.
>
> So when reading (or writing!) basic properties in Java,
>
>    - null means "missing value" or "no value"
>    - empty map, empty string etc. is a *present* value but is otherwise
>    just itself
>    - non-empty maps, strings, etc are present values
>
> Regards,
>   Tony
>


From tonygarnockjones+rabbitmq at gmail.com  Thu Oct 27 17:51:31 2011
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Thu, 27 Oct 2011 12:51:31 -0400
Subject: [rabbitmq-discuss] Java RabbitMQ API bug in
	response.getHeaders()?
In-Reply-To: <4EA98593.8030207@niclabs.cl>
References: <4EA96D7D.8090004@niclabs.cl>
	<CAM8fPiQoXGuPX3W8z3Wzc9u7NP4m6K_7TjUJwgmRv8M9WK9Fbg@mail.gmail.com>
	<4EA98593.8030207@niclabs.cl>
Message-ID: <CAM8fPiRnLhL2zgEj1nkeBMFpbX7gFdu3QniagHY4b4ZL6B26wA@mail.gmail.com>

On 27 October 2011 12:23, Mario Leyton <mleyton at niclabs.cl> wrote:

> If there are no headers, it doesn't matter why, a good API should always
> return an empty Map o List and not null because it contaminates the API
> user's code.


It may do so for Java. Other languages do things like this differently.
AMQP is language-neutral, and has its own semantics. The API should make it
easy for the user to work with AMQP semantics, and should not, for example,
lull the user into a false sense that all the world is a Java program. If a
sender sent a message with a missing username header, for instance, that
should be hard to misinterpret as the sender having sent a message with an
empty-string username header. IMO, the same applies to maps, integers,
booleans, timestamps etc. (I'm not even sure what a sensible
"default"/"missing" value for a timestamp would be.)

You're right that we could do what the C library does, and use a separate
flag, but I believe this would make it more likely that subtle
interoperability issues would arise. At least with the NPE you get rapid
feedback that someone isn't following the communication contract; either
the local Java code, in which case adding a null check lets you conform to
the language being spoken by the remote party, or the remote party's code,
in which case you can either choose to work around the difference locally
or get the remote party to change. Papering over the difference at the API
level masks the underlying problem.

If you are working in an all-java environment, a good choice for your code
might be to abstract away the difference between a missing map and an empty
map.

Regards,
  Tony
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111027/3601f689/attachment.htm>

From michael.s.klishin at gmail.com  Thu Oct 27 18:04:11 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 27 Oct 2011 21:04:11 +0400
Subject: [rabbitmq-discuss] [announcement] amq-client 0.8.4 is released
Message-ID: <497F6B5E-16D7-4C8C-BD6E-F07F3B4239C6@gmail.com>

amq-client 0.8.4 is released to rubygems.org [1]. This is a bug fix release:

 * basic.cancel-ok callback is now invoked correctly.


1. https://rubygems.org/gems/amq-client/versions/0.8.4

All amqp gem users are recommended to upgrade.

MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin


From mleyton at niclabs.cl  Thu Oct 27 18:36:31 2011
From: mleyton at niclabs.cl (Mario Leyton)
Date: Thu, 27 Oct 2011 14:36:31 -0300
Subject: [rabbitmq-discuss] Java RabbitMQ API bug in
	response.getHeaders()?
In-Reply-To: <CAM8fPiRnLhL2zgEj1nkeBMFpbX7gFdu3QniagHY4b4ZL6B26wA@mail.gmail.com>
References: <4EA96D7D.8090004@niclabs.cl>
	<CAM8fPiQoXGuPX3W8z3Wzc9u7NP4m6K_7TjUJwgmRv8M9WK9Fbg@mail.gmail.com>
	<4EA98593.8030207@niclabs.cl>
	<CAM8fPiRnLhL2zgEj1nkeBMFpbX7gFdu3QniagHY4b4ZL6B26wA@mail.gmail.com>
Message-ID: <4EA9969F.70906@niclabs.cl>

This is a nice discussion, though I want to remark that I am
specifically discussing the List/Map issues, not the single attributes.

The core of it I think is reduced into whether one would:

A. Want all client library (C, Java, Erlang, etc... ) to operate more or
less the same, or
B. Want all client library users to feel "at home" with the library's "API".

As a Java programmer, I don't really care if the library are used in
exactly the same way in C, Python or Erlang. I actually don't expect it.
For me it is very strange to have this semantic overload in the null
reference, which, as I mentioned in the previous post is actually very
annoying as  does not depend on the coding style but on the message
being sent and pollutes the user's code.

My feeling is that the rabbitmq teams is trying to aim for option A,
while for me, as a user of the java client library it is easier to adopt
rabbitmq client if it where built in terms of B.

Finally I just want to quote that I believe the RabbitMQ Team is doing a
good job and I'm happy to provide feedback as one of their users.

Mario Leyton
--
NIC Chile Research Labs
 
On 10/27/11 1:51 PM, Tony Garnock-Jones wrote:
> On 27 October 2011 12:23, Mario Leyton <mleyton at niclabs.cl> wrote:
>
>> If there are no headers, it doesn't matter why, a good API should always
>> return an empty Map o List and not null because it contaminates the API
>> user's code.
>
> It may do so for Java. Other languages do things like this differently.
> AMQP is language-neutral, and has its own semantics. The API should make it
> easy for the user to work with AMQP semantics, and should not, for example,
> lull the user into a false sense that all the world is a Java program. If a
> sender sent a message with a missing username header, for instance, that
> should be hard to misinterpret as the sender having sent a message with an
> empty-string username header. IMO, the same applies to maps, integers,
> booleans, timestamps etc. (I'm not even sure what a sensible
> "default"/"missing" value for a timestamp would be.)
>
> You're right that we could do what the C library does, and use a separate
> flag, but I believe this would make it more likely that subtle
> interoperability issues would arise. At least with the NPE you get rapid
> feedback that someone isn't following the communication contract; either
> the local Java code, in which case adding a null check lets you conform to
> the language being spoken by the remote party, or the remote party's code,
> in which case you can either choose to work around the difference locally
> or get the remote party to change. Papering over the difference at the API
> level masks the underlying problem.
>
> If you are working in an all-java environment, a good choice for your code
> might be to abstract away the difference between a missing map and an empty
> map.
>
> Regards,
>   Tony
>


From tonygarnockjones+rabbitmq at gmail.com  Thu Oct 27 18:49:01 2011
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Thu, 27 Oct 2011 13:49:01 -0400
Subject: [rabbitmq-discuss] Java RabbitMQ API bug in
	response.getHeaders()?
In-Reply-To: <4EA9969F.70906@niclabs.cl>
References: <4EA96D7D.8090004@niclabs.cl>
	<CAM8fPiQoXGuPX3W8z3Wzc9u7NP4m6K_7TjUJwgmRv8M9WK9Fbg@mail.gmail.com>
	<4EA98593.8030207@niclabs.cl>
	<CAM8fPiRnLhL2zgEj1nkeBMFpbX7gFdu3QniagHY4b4ZL6B26wA@mail.gmail.com>
	<4EA9969F.70906@niclabs.cl>
Message-ID: <CAM8fPiQ90a_T00qsxpXt2RqCGTUMu7uNCFxNCjU_mgHAb=nxUw@mail.gmail.com>

On 27 October 2011 13:36, Mario Leyton <mleyton at niclabs.cl> wrote:

> My feeling is that the rabbitmq teams is trying to aim for option A,
> while for me, as a user of the java client library it is easier to adopt
> rabbitmq client if it where built in terms of B.
>

I don't speak for the RabbitMQ team anymore, of course, but the philosophy
has in the past been that the client libraries should express the semantics
of AMQP, no more, no less, in as natural a way for the host language as
possible given the constraint of expressing exactly AMQP as she is spoke.
On top of that, where people figure out good patterns for working with AMQP
in a given host language, some of those have been included too in some
cases. Perhaps a wrapper that has an interface along the lines you suggest
would be a worthwhile inclusion.

Regarding the issue of the null check, I'd suggest looking at it
differently: instead of seeing the null check as *polluting* your code,
look at it as *paying attention to what the sender actually said*. The
check is necessary to fully understand the intention of the sender as
expressed using the facilities AMQP offers.

Regards,
  Tony
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111027/575b3abc/attachment.htm>

From roger.fischer at abb.ventyx.com  Thu Oct 27 18:59:33 2011
From: roger.fischer at abb.ventyx.com (RogerF)
Date: Thu, 27 Oct 2011 10:59:33 -0700 (PDT)
Subject: [rabbitmq-discuss] Queue Clustering and Sequencing
In-Reply-To: <4EA90A99.8070700@rabbitmq.com>
References: <B925600E2C563A4FA33FA9CF64A455B5031DE82D@LITEXCHEVS1.ventyx.org>
	<4EA6D9DA.4070701@rabbitmq.com>
	<5679e3c6-8288-4fb6-9705-e7a2261d2f88@v5g2000vbh.googlegroups.com>
	<4EA90A99.8070700@rabbitmq.com>
Message-ID: <b89a44ba-69a4-4463-a61e-fd1f08328e7c@l19g2000yqm.googlegroups.com>

Hi Mathias,

thanks for your reply.

> have you tried the obvious approach suggested in your first post, i.e.
> have one queue per consumer and ensure that messages for the same key
> always end up in the same queue?

Yes, that is what we currently are doing (in the single instance
environment).

> > Non-related messages are unnecessarily sequenced. When the key
> > distribution is not exactly even, one queue may have a backup while
> > another is idle.
>
> ...but is that really an issue in practice?

Yes. But a bigger problem is a slow messages. Most messages are
processed in a few hundred milliseconds. But occasionally a message
takes a few seconds to process. That delays the following, unrelaed
messages that happen to be in the same queue. The other queues would
have capacity to process these messages with minimal delay.

> Take a look athttps://github.com/rabbitmq/rabbitmq-consistent-hash-exchange

That helps a lot.

Though one problem remains. When a node fails, the messages on that
node's queues are still stuck there. The consistent-hash-exchange will
re-route future messages to a different queue, avoiding the need to
migrate the consumer. But the message already delivered to the
original queue will not be processed until the node recovers, at which
time they are out of sequence.

Roger

From mleyton at niclabs.cl  Thu Oct 27 19:44:10 2011
From: mleyton at niclabs.cl (Mario Leyton)
Date: Thu, 27 Oct 2011 15:44:10 -0300
Subject: [rabbitmq-discuss] Java RabbitMQ API bug in
	response.getHeaders()?
In-Reply-To: <CAM8fPiQ90a_T00qsxpXt2RqCGTUMu7uNCFxNCjU_mgHAb=nxUw@mail.gmail.com>
References: <4EA96D7D.8090004@niclabs.cl>
	<CAM8fPiQoXGuPX3W8z3Wzc9u7NP4m6K_7TjUJwgmRv8M9WK9Fbg@mail.gmail.com>
	<4EA98593.8030207@niclabs.cl>
	<CAM8fPiRnLhL2zgEj1nkeBMFpbX7gFdu3QniagHY4b4ZL6B26wA@mail.gmail.com>
	<4EA9969F.70906@niclabs.cl>
	<CAM8fPiQ90a_T00qsxpXt2RqCGTUMu7uNCFxNCjU_mgHAb=nxUw@mail.gmail.com>
Message-ID: <4EA9A67A.1010603@niclabs.cl>

On 10/27/11 2:49 PM, Tony Garnock-Jones wrote:
> Regarding the issue of the null check, I'd suggest looking at it
> differently: instead of seeing the null check as *polluting* your code,
> look at it as *paying attention to what the sender actually said*. The
> check is necessary to fully understand the intention of the sender as
> expressed using the facilities AMQP offers.
In that case I suggest you don't force your library users to assigning a
non-explicit semantic to Java's "null", and have to document this
non-explicit behavior in their code.

If you really think that checking the headers before accessing them is
an essential part of the AMQP specification (which I don't),  then an
alternative way could be to explicitly enforce this as:

Map getSentHeaders() throws HeadersNotSentException{...}

Which will throw a HeadersNotSentException  when the headers are not
present. This will still force me to add more code, but at least there
won't be an overloading of null, which is really unconfortable, and the
correct error message will be raised instead of the cryptic
NullPointerException later on the code when I actually use the header
reference.

To satisfy both users (those concerned or not with the distinction of
empty versus unsent headers you could actually provide two such methods
to access the headers:

public Map getHeaders() {}
public Map getSentHeaders() throws HeadersNotSentException{...}

Neither of them returning null.

Mario Leyton


From mikeb at rabbitmq.com  Thu Oct 27 21:35:31 2011
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Thu, 27 Oct 2011 21:35:31 +0100
Subject: [rabbitmq-discuss] Java RabbitMQ API bug
	in	response.getHeaders()?
In-Reply-To: <4EA9A67A.1010603@niclabs.cl>
References: <4EA96D7D.8090004@niclabs.cl>	<CAM8fPiQoXGuPX3W8z3Wzc9u7NP4m6K_7TjUJwgmRv8M9WK9Fbg@mail.gmail.com>	<4EA98593.8030207@niclabs.cl>	<CAM8fPiRnLhL2zgEj1nkeBMFpbX7gFdu3QniagHY4b4ZL6B26wA@mail.gmail.com>	<4EA9969F.70906@niclabs.cl>	<CAM8fPiQ90a_T00qsxpXt2RqCGTUMu7uNCFxNCjU_mgHAb=nxUw@mail.gmail.com>
	<4EA9A67A.1010603@niclabs.cl>
Message-ID: <4EA9C093.40105@rabbitmq.com>

Mario,

> If you really think that checking the headers before accessing them is
> an essential part of the AMQP specification (which I don't),  then an
> alternative way could be to explicitly enforce this as:
>
> Map getSentHeaders() throws HeadersNotSentException{...}
>
> Which will throw a HeadersNotSentException  when the headers are not
> present. This will still force me to add more code, but at least there
> won't be an overloading of null, which is really unconfortable, and the
> correct error message will be raised instead of the cryptic
> NullPointerException later on the code when I actually use the header
> reference.

I happen to agree the null isn't very convenient in the API. However I 
am curious to know what you mean by null being "overloaded": what are 
the two (or more?) meanings you think are being ascribed it?

Throwing an exception is an awful solution. Much better I think to have 
a known, immutable, empty value that can be used in an equality test.

-Michael

From lgreg.meredith at gmail.com  Thu Oct 27 21:46:27 2011
From: lgreg.meredith at gmail.com (Meredith Gregory)
Date: Thu, 27 Oct 2011 13:46:27 -0700
Subject: [rabbitmq-discuss] getting node.js to talk to scala over
	rabbitmq
In-Reply-To: <CAG7cANSLNkO6VXxNMgVFNY+W_R3kpj3BtUJc2__PJGw_xKAifw@mail.gmail.com>
References: <CAG7cANS5tiOVCq_aj-HDw8gsk+5TF-r=+abnnCkC9T8ZgGSvsA@mail.gmail.com>
	<4EA685AF.4070505@rabbitmq.com>
	<CAG7cANSLNkO6VXxNMgVFNY+W_R3kpj3BtUJc2__PJGw_xKAifw@mail.gmail.com>
Message-ID: <CAG7cANQjtVPqHVm5hhuf5MVtAEhXvt9g8YQ5wYvpT0J8t249=g@mail.gmail.com>

Dear Rabbiters,

A follow on query. It appears that with the node.js node-amqp client i need
only set the content type to have the content encoding handled more or less
appropriately. In the java client the default seems to be octet stream. Is
there an encoding service underneath basicPublish / basicConsume that is
utilizing the info on the content type properties or is that a feature of a
given client offering (such as node-amqp)?

Best wishes,

--greg

On Tue, Oct 25, 2011 at 9:45 AM, Meredith Gregory
<lgreg.meredith at gmail.com>wrote:

> Dear Simon, et al,
>
> Thanks! Yes, i spotted it almost immediately after i sent the email. ;-)
> The two are happily chatting, now.
>
> Best wishes,
>
> --greg
>
>
> On Tue, Oct 25, 2011 at 2:47 AM, Simon MacMullen <simon at rabbitmq.com>wrote:
>
>> On 25/10/11 00:50, Meredith Gregory wrote:
>>
>>> Dear Rabbiters,
>>>
>>> i'm running into a problem getting node.js to talk to scala over
>>> rabbitmq. i'm using the node-amqp package with node.js. i installed it
>>> using npm install amqp. i'm using the java client for rabbitmq 2.5.1 on
>>> the scala side. i've successfully gotten scala to talk to scala
>>> and node.js to talk to node.js. However, when i attempt to get node.js
>>> to talk to scala there appears to be a disagreement regarding
>>> queue declaration. Thus, if i fire up node.js first and look at the
>>> queue it creates with the rabbitmq management plugin i see
>>>
>>>
>>>
>>> node-simple-direct_queue
>>> <http://localhost:55672/mgmt/#**/queues/%2F/node-simple-**direct_queue<http://localhost:55672/mgmt/#/queues/%2F/node-simple-direct_queue>>
>>>
>>> AD      Idle    0       0       0
>>>
>>
>> So this looks like a transient autodelete queue.
>>
>>
>>  i then attempt to accomplish a connection from the scala side (with code
>>> that works on scala-to-scala) and i see an exception when the code calls
>>> the queueDeclare method.
>>>
>>>             channel.exchangeDeclare( exQNameRoot, "direct" )
>>>             //channel.queueDeclare(qname, true, false, false, null);
>>>    channel.queueDeclare(qname, true, false, true, null); // <-- here we
>>> throw an exception
>>>
>>
>> And here you are declaring a durable autodelete queue. That's probably
>> your problem.
>>
>>
>>  java.io.IOException
>>> at com.rabbitmq.client.impl.**AMQChannel.wrap(AMQChannel.**java:107)
>>> at com.rabbitmq.client.impl.**AMQChannel.exnWrappingRpc(**
>>> AMQChannel.java:131)
>>> at com.rabbitmq.client.impl.**ChannelN.queueDeclare(**ChannelN.java:627)
>>> at com.rabbitmq.client.impl.**ChannelN.queueDeclare(**ChannelN.java:59)
>>> at
>>> com.biosimilarity.lift.lib.**AMQPBrokerScope$**
>>> StdMonadicAMQPSndrRcvr.sender(**AMQPMnd.scala:53)
>>>
>>
>> ...but you can unwrap this exception and check, or look in the broker logs
>> to see what it's complaining about.
>>
>> Cheers, Simon
>>
>> --
>> Simon MacMullen
>> RabbitMQ, VMware
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>
>
>
> --
> L.G. Meredith
> Managing Partner
> Biosimilarity LLC
> 7329 39th Ave SW
> Seattle, WA 98136
>
> +1 206.650.3740
>
> http://biosimilarity.blogspot.com
>
>


-- 
L.G. Meredith
Managing Partner
Biosimilarity LLC
7329 39th Ave SW
Seattle, WA 98136

+1 206.650.3740

http://biosimilarity.blogspot.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111027/3e729b8c/attachment.htm>

From michael.s.klishin at gmail.com  Thu Oct 27 22:29:51 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 28 Oct 2011 01:29:51 +0400
Subject: [rabbitmq-discuss] getting node.js to talk to scala over
	rabbitmq
In-Reply-To: <CAG7cANQjtVPqHVm5hhuf5MVtAEhXvt9g8YQ5wYvpT0J8t249=g@mail.gmail.com>
References: <CAG7cANS5tiOVCq_aj-HDw8gsk+5TF-r=+abnnCkC9T8ZgGSvsA@mail.gmail.com>
	<4EA685AF.4070505@rabbitmq.com>
	<CAG7cANSLNkO6VXxNMgVFNY+W_R3kpj3BtUJc2__PJGw_xKAifw@mail.gmail.com>
	<CAG7cANQjtVPqHVm5hhuf5MVtAEhXvt9g8YQ5wYvpT0J8t249=g@mail.gmail.com>
Message-ID: <0A5C4BE0-DDAF-4053-A11F-786A6A9D382C@gmail.com>

Meredith Gregory:

> Is there an encoding service underneath basicPublish / basicConsume that is utilizing the info on the content type properties or is that a feature of a given client offering (such as node-amqp)? 

It is a feature offered by node-amqp (and an opinionated one). You can subclass com.rabbitmq.client.DefaultConsumer and 
make your implementation assume all message payloads are JSON and thus can be deserialized automatically. As far as AMQP clients are concerned, message payloads are just collections of bytes, your applications decide how to interpret them.

MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin


From raphael at rightscale.com  Thu Oct 27 22:46:44 2011
From: raphael at rightscale.com (Raphael Simon)
Date: Thu, 27 Oct 2011 14:46:44 -0700
Subject: [rabbitmq-discuss] RabbitMQ writes non stop to disk
In-Reply-To: <4EA8F7ED.6080607@rabbitmq.com>
References: <CAD7X3-nRLHv+uEf0Vy3JTzW8WRNvUW4vSszykU4F=WCEouM5SA@mail.gmail.com>
	<4EA69CF9.7010809@rabbitmq.com>
	<CAD7X3-nrsELeXAS3=q79Jss_6=cWS3VXEtJ7QBBRnU6wyNy8ew@mail.gmail.com>
	<20111026230113.GC4602@wellquite.org>
	<CAD7X3-=9u-GyAPoEiC8QR9OriKE2OCETGsSqNPTOZGNf5ZXQgw@mail.gmail.com>
	<4EA89B42.60309@rabbitmq.com>
	<CAD7X3-nNO0TY-4BKz3_Gxbr8Yp_vkKAoXu5SzSKz3s1wkqSinQ@mail.gmail.com>
	<4EA8A0A4.8060909@rabbitmq.com>
	<CAD7X3-=TV-WuhoUpjNM1suM=j-tHwicD+GffzbAkz78dd73Rng@mail.gmail.com>
	<4EA8AA2E.5090603@rabbitmq.com> <4EA8B413.70908@rabbitmq.com>
	<CAD7X3-kSMz490m3iSW8d6UPqiNON2+oaiHKyEi-ijSHKqxejxw@mail.gmail.com>
	<4EA8F7ED.6080607@rabbitmq.com>
Message-ID: <CAD7X3-kmq3Rho+TWsr94j6MUXQDr+VV+kvQuGdTjS0SjGAwcAw@mail.gmail.com>

We finally found the issue: a bug in our code was causing most traffic to
go to that one broker. Sorry for the false alarm and thanks for the help
troubleshooting!

--
Raphael.

On Wed, Oct 26, 2011 at 11:19 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Raphael,
>
>
> On 27/10/11 05:18, Raphael Simon wrote:
>
>> Is there a way to easily retrieve the average ingress rate across all
>> queues for a broker?  Maybe what's happening is a rogue client is
>> spamming that
>> specific server. I'd like to see the average ingress rate across all our
>> brokers to validate that theory.
>>
>
> The avg queue ingress rate should be easy to calculate by extracting the
> rate information for all queues through the management API.
>
> Wouldn't it be better to look at inbound connection data rates for though,
> e.g. identify the connection with the highest inbound rate? Or perhaps look
> at per-channel message stats. You can get at all of these through the
> management API.
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111027/ff0959ee/attachment.htm>

From julio at hawaii.edu  Thu Oct 27 23:17:28 2011
From: julio at hawaii.edu (Julio Polo)
Date: Thu, 27 Oct 2011 12:17:28 -1000
Subject: [rabbitmq-discuss] Protecting a queue from other users
Message-ID: <CA+0gB9nws843j_TN1qXenq1CxeNyLNBzqC2iCT2_wDJdEjM3oA@mail.gmail.com>

I'm new to RabbitMQ.  Are queues only readable to the user that
declared it?  In other words, if UserA declares QueueA, and UserB
declares QueueB, both under the same vhost and same exchange, can
UserB subscribe to QueueA if he guesses the name of QueueA correctly?

Julio Polo
University of Hawaii

From andrew.rendell at gmail.com  Thu Oct 27 23:18:14 2011
From: andrew.rendell at gmail.com (Anderew)
Date: Thu, 27 Oct 2011 15:18:14 -0700 (PDT)
Subject: [rabbitmq-discuss] Mirror queues and poor write performance
In-Reply-To: <20111027134135.GB22379@rabbitmq.com>
References: <448858bd-6a94-4677-aa89-34506deed3ec@m19g2000vbm.googlegroups.com>
	<20111026224223.GA4602@wellquite.org>
	<20111026224544.GB4602@wellquite.org>
	<c58cd0e6-6efa-417b-b6f1-bf4525cd5420@o19g2000vbk.googlegroups.com>
	<20111027133746.GA22379@rabbitmq.com>
	<20111027134135.GB22379@rabbitmq.com>
Message-ID: <45cb8656-53c9-40e8-83ca-dfa4bd926d69@1g2000vbx.googlegroups.com>

Thanks for the information, that is very useful.

The problem was my test. I had a large pool of consumers but was
single threading the producer on the theory that whilst TPS is very
important for the application I work with, the latency if an
individual operation is also critical. With a small change to use a
pool of producers I can get a far more acceptable rate.

Using multiple producers and consumers, running on a single processor,
dual core i7 I was able to achieve close to 850 transactional messages
per second with the consumer emptying the queues quickly enough that
queues lengths as you describe were always very close to zero. For the
same setup with a non-mirrored queue I was able to get 1400 messages
per second. This is much closer to the kind of performance difference
I was expecting. Given the relatively low power of the test machine
this is very good.

(At the risk of exposing my stupidity) I still don't quite understand
why the single threaded test was so poor with the mirror queue
compared to the non mirrored queue. My timings indicated that a single
threaded producer, with no concurrent consumers, would publish one
(transacted) message every five milliseconds for non-mirrored and one
per forty milliseconds for mirrored.

Thanks again for your help and for an excellent product!

Regards, Andrew.

On Oct 27, 2:41?pm, Matthew Sackman <matt... at rabbitmq.com> wrote:
> On Thu, Oct 27, 2011 at 02:37:47PM +0100, Matthew Sackman wrote:
> > At least in the first instance, HA has been designed to be write
>
> write => right.
>
> I shall have to have myself flogged for that one.
>
> Matthew.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From alexandru at rabbitmq.com  Thu Oct 27 23:32:45 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Thu, 27 Oct 2011 23:32:45 +0100
Subject: [rabbitmq-discuss] Protecting a queue from other users
In-Reply-To: <CA+0gB9nws843j_TN1qXenq1CxeNyLNBzqC2iCT2_wDJdEjM3oA@mail.gmail.com>
References: <CA+0gB9nws843j_TN1qXenq1CxeNyLNBzqC2iCT2_wDJdEjM3oA@mail.gmail.com>
Message-ID: <20111027223245.GC3566@southbank.Home>

You should read:
  http://www.rabbitmq.com/admin-guide.html#access-control

In short, access to queues (and to a few other things) is controlled by
three permission strings that each user has.  So, UserB can subscribe to
QueueA, provided he guesses the queue's name correctly and that he has
read access to broker-named queues.

You can protect UserA's queues from being read by UserB, but you
have to name them yourself (and make sure that UserB does not have
access to queues named that way).  A simple way to do this would be to
name UserX's queues "userx.<something random>" and to only grant him
access to "userx\..*" (i.e. all names beginning with the string
"userx.").

Hope this helps.

Cheers,
Alex

On Thu, Oct 27, 2011 at 12:17:28PM -1000, Julio Polo wrote:
> I'm new to RabbitMQ.  Are queues only readable to the user that
> declared it?  In other words, if UserA declares QueueA, and UserB
> declares QueueB, both under the same vhost and same exchange, can
> UserB subscribe to QueueA if he guesses the name of QueueA correctly?
> 
> Julio Polo
> University of Hawaii
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From julio at hawaii.edu  Thu Oct 27 23:59:52 2011
From: julio at hawaii.edu (Julio Polo)
Date: Thu, 27 Oct 2011 12:59:52 -1000
Subject: [rabbitmq-discuss] Protecting a queue from other users
In-Reply-To: <20111027223245.GC3566@southbank.Home>
References: <CA+0gB9nws843j_TN1qXenq1CxeNyLNBzqC2iCT2_wDJdEjM3oA@mail.gmail.com>
	<20111027223245.GC3566@southbank.Home>
Message-ID: <CA+0gB9m57Ar5JYZpNirwPrmtooVOVT0dHzC87MbUwZKy+6q6Hg@mail.gmail.com>

Thanks, that's exactly what I need!  I saw the same permissions table
on a RabbitMQ book, but it wasn't immediately obvious that I could use
regular expressions to specify the resources.

-Julio

On Thu, Oct 27, 2011 at 12:32 PM, Alexandru Scvor?ov
<alexandru at rabbitmq.com> wrote:
> You should read:
> ?http://www.rabbitmq.com/admin-guide.html#access-control
>
> In short, access to queues (and to a few other things) is controlled by
> three permission strings that each user has. ?So, UserB can subscribe to
> QueueA, provided he guesses the queue's name correctly and that he has
> read access to broker-named queues.
>
> You can protect UserA's queues from being read by UserB, but you
> have to name them yourself (and make sure that UserB does not have
> access to queues named that way). ?A simple way to do this would be to
> name UserX's queues "userx.<something random>" and to only grant him
> access to "userx\..*" (i.e. all names beginning with the string
> "userx.").
>
> Hope this helps.
>
> Cheers,
> Alex
>
> On Thu, Oct 27, 2011 at 12:17:28PM -1000, Julio Polo wrote:
>> I'm new to RabbitMQ. ?Are queues only readable to the user that
>> declared it? ?In other words, if UserA declares QueueA, and UserB
>> declares QueueB, both under the same vhost and same exchange, can
>> UserB subscribe to QueueA if he guesses the name of QueueA correctly?
>>
>> Julio Polo
>> University of Hawaii
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From matthias at rabbitmq.com  Fri Oct 28 00:24:46 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 28 Oct 2011 00:24:46 +0100
Subject: [rabbitmq-discuss] Protecting a queue from other users
In-Reply-To: <20111027223245.GC3566@southbank.Home>
References: <CA+0gB9nws843j_TN1qXenq1CxeNyLNBzqC2iCT2_wDJdEjM3oA@mail.gmail.com>
	<20111027223245.GC3566@southbank.Home>
Message-ID: <4EA9E83E.20006@rabbitmq.com>

On 27/10/11 23:32, Alexandru Scvor?ov wrote:
> You should read:
>    http://www.rabbitmq.com/admin-guide.html#access-control
>
> In short, access to queues (and to a few other things) is controlled by
> three permission strings that each user has.  So, UserB can subscribe to
> QueueA, provided he guesses the queue's name correctly and that he has
> read access to broker-named queues.

note though that auto-generated queue names (i.e. ad returned by the 
server when the client leaves the queue name field empty in a queue 
declaration) are cryptographically quite strong, i.e. not guessable.

Matthias.

From mihirm at omc-international.com.au  Fri Oct 28 07:37:17 2011
From: mihirm at omc-international.com.au (Mihir Mone)
Date: Fri, 28 Oct 2011 14:37:17 +0800
Subject: [rabbitmq-discuss] RabbitMQ upgrade 2.4.1 to 2.6.1 Shovel config
	ignored
Message-ID: <00a601cc953c$098f89c0$1cae9d40$@omc-international.com.au>

Hi,

 

Earlier today I updated my rabbitmq server from v2.4.1 to v2.6.1. Now the
shovel plugin does not work at all. I have download all the necessary files
and there are no errors in the startup and run logs of the server. Any idea
why this would happen ? It seems that the broker is reading configuration
from the rabbitmq.config file but the rabbit_shovel configuration is getting
completely ignored for some reason ! I know this because if I change one of
the listeners and restart the server the new config does get picked up and
the broker listener is no longer present. 

 

Been struggling with this for the past hour or so and am finally ready to
give up and get help before I proceed. I am running Debian Squeeze with
Erlang OTP R14B14.

 

--

Regards,

Mihir Mone | Software Engineer

OMC-International 
6 Paterson St 
Abbotsford,
VIC 3067 Melbourne | Australia 

Phone +61 (3) 9412 6525 
Fax +61 (3) 9415 9105 
 <http://www.omc-international.com.au/> http://www.omc-international.com.au/


Smarter Ports | Safer Shipping. 

CONFIDENTIAL COMMUNICATIONS. The information contained in this e-mail is
confidential and may be subject to legal professional privilege. It is
intended solely for the addressee. If you received this correspondence by
mistake, please promptly inform us by reply e-mail or by telephoning +61 3
9412 6500 and then delete the e-mail and destroy any printed copy. You must
not disclose, copy or rely on any part of this correspondence if you are not
the intended recipient.

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111028/fc40622b/attachment.htm>

From mrraymondbarlow at gmail.com  Thu Oct 27 23:31:52 2011
From: mrraymondbarlow at gmail.com (Raymond Barlow)
Date: Thu, 27 Oct 2011 15:31:52 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq-server ignoring
	/etc/rabbitmq/rabbitmq-env.conf
Message-ID: <31693613.338.1319754712973.JavaMail.geo-discussion-forums@yqja14>

Hi,

After a day of pain, I finally managed to get rabbitmq installed, via 
homebrew, on my mac (lion).

Now, I'm having trouble with starting the server. It hangs (I guess trying 
to resolve the hostname). If I ctrl-c during the hang, the broker seems to 
start anyway.

So, I thought I'd add NODENAME=localhost to /etc/rabbitmq/rabbitmq-env.conf 
(as suggested in other posts).
But, even after I have created this file, and put the above in it, 
rabbitmq-server still fails connect (just hangs). 

If I ctrl-c, the broker still starts, and it shows that it hasn't picked up 
the config file (I think):

+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
|   v2.6.1  +---+   |
|                   |
+-------------------+
AMQP 0-9-1 / 0-9 / 0-8
Copyright (C) 2007-2011 VMware, Inc.
Licensed under the MPL.  See http://www.rabbitmq.com/

node           : rabbit at agentdarkbooty
app descriptor : 
/usr/local/Cellar/rabbitmq/2.6.1/lib/rabbitmq/erlang/lib/rabbitmq-2.6.1/ebin/rabbit.app
home dir       : /Users/rbarlow
config file(s) : (none)
(etc)

Any suggestions?

Regards,
Raymond Barlow
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111027/cd4a6203/attachment.htm>

From dagda1 at scotalt.net  Fri Oct 28 08:00:03 2011
From: dagda1 at scotalt.net (Paul Cowan)
Date: Fri, 28 Oct 2011 08:00:03 +0100
Subject: [rabbitmq-discuss] JRUBY
	java.nio.channels.UnresolvedAddressException:
Message-ID: <CAEBV8YR1Kd7BYBVDbAS7TENZ_uEnzB2m=uLgRdud2p1HjtFKoA@mail.gmail.com>

Hi,

I am trying to start a queue consumer from JRuby 1.6.5, I have the
following thor task that I want to use to start the queue:

desc "start_consumer", "start the test consumer"
def start_consumer
  puts "Running #{AMQP::VERSION} version of the gem"

  AMQP.start(:host => "dev.rabbitmq.com") do |connection|

    ch = AMQP::Channel.new(connection)

    ch.queue("one", :auto_delete =>
true).subscribe(&method(:handle_message))
  end
end

I start the rabbitmq-server with the *rabbitmq-server --detachced* command.

When I run the task, it cannot connect to the host and I get the following
error:

NativeException: java.nio.channels.UnresolvedAddressException: null
  bind_connect_server at
/Users/paulcowan/.rvm/gems/jruby-1.6.5/gems/eventmachine-1.0.0.beta.4-java/lib/jeventmachine.rb:136

I can't find anything on this in google.

Can anyone see anything obvious that I am missing?

Cheers

Paul Cowan

Cutting-Edge Solutions (Scotland)

http://thesoftwaresimpleton.com/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111028/79335d73/attachment.htm>

From matthias at rabbitmq.com  Fri Oct 28 08:19:30 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 28 Oct 2011 08:19:30 +0100
Subject: [rabbitmq-discuss] RabbitMQ upgrade 2.4.1 to 2.6.1 Shovel
 config ignored
In-Reply-To: <00a601cc953c$098f89c0$1cae9d40$@omc-international.com.au>
References: <00a601cc953c$098f89c0$1cae9d40$@omc-international.com.au>
Message-ID: <4EAA5782.4030107@rabbitmq.com>

Mihir,

On 28/10/11 07:37, Mihir Mone wrote:
> Earlier today I updated my rabbitmq server from v2.4.1 to v2.6.1. Now
> the shovel plugin does not work at all. I have download all the
> necessary files and there are no errors in the startup and run logs of
> the server. Any idea why this would happen ?

The tag for the config entries has changed from rabbit_shovel to 
rabbitmq_shovel.

Matthias.

From matti.linnanvuori at portalify.com  Fri Oct 28 08:19:37 2011
From: matti.linnanvuori at portalify.com (Matti Linnanvuori)
Date: Fri, 28 Oct 2011 10:19:37 +0300
Subject: [rabbitmq-discuss] BOOT ERROR: FAILED
Message-ID: <1E30DD69-512E-4EEB-82A8-ECDF0C387CBD@portalify.com>

RabbitMQ 2.5.1 server on SUSE Linux Enterprise Server 11 SP1 failed to start. When I tried to start it again, it started successfully.

Below are some files of the failed start up:

cat /var/log/rabbitmq/startup_err 
Erlang has closed

cat /var/log/rabbitmq/startup_log
Activating RabbitMQ plugins ...
0 plugins activated:


+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
|   v2.5.1  +---+   |
|                   |
+-------------------+
AMQP 0-9-1 / 0-9 / 0-8
Copyright (C) 2007-2011 VMware, Inc.
Licensed under the MPL.  See http://www.rabbitmq.com/

node           : rabbit at iac-pgis
app descriptor : /usr/lib/rabbitmq/lib/rabbitmq_server-2.5.1/sbin/../ebin/rabbit.app
home dir       : /var/lib/rabbitmq
config file(s) : (none)
cookie hash    : Q6gFuwANTK79hr/vMOmpWg==
log            : /var/log/rabbitmq/rabbit at iac-pgis.log
sasl log       : /var/log/rabbitmq/rabbit at iac-pgis-sasl.log
database dir   : /var/lib/rabbitmq/mnesia/rabbit at iac-pgis
erlang version : 5.8.4

-- rabbit boot start
starting file handle cache server                                     ...done
starting worker pool                                                  ...done
starting database                                                     ...done
starting codec correctness check                                      ...done
-- external infrastructure ready
starting statistics event manager                                     ...done
starting logging server                                               ...done
starting plugin registry                                              ...done
starting auth mechanism amqplain                                      ...done
starting auth mechanism cr-demo                                       ...done
starting auth mechanism plain                                         ...done
starting exchange type direct                                         ...done
starting exchange type fanout                                         ...done
starting exchange type headers                                        ...done
starting exchange type topic                                          ...done
-- kernel ready
starting node monitor                                                 ...done
starting cluster delegate                                             ...done
starting guid generator                                               ...done
starting alarm handler                                                ...done
starting memory monitor                                               ...done
-- core initialized
starting empty DB check                                               ...done
starting exchange, queue and binding recovery                         ...BOOT ERROR: FAILED
Reason: {{bad_return_value,{error,{node_not_running,'rabbit at iac-pgis'}}},
         {gen_server2,call,[<0.219.0>,{init,true},infinity]}}
Stacktrace: [{gen_server2,call,3},
             {rabbit_amqqueue,'-recover_durable_queues/1-lc$^1/1-1-',1},
             {rabbit,recover,0},
             {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
             {rabbit,run_boot_step,1},
             {rabbit,'-start/2-lc$^0/1-0-',1},
             {rabbit,start,2},
             {application_master,start_it_old,4}]


Matti Linnanvuori


From mihirm at omc-international.com.au  Fri Oct 28 08:42:56 2011
From: mihirm at omc-international.com.au (Mihir Mone)
Date: Fri, 28 Oct 2011 15:42:56 +0800
Subject: [rabbitmq-discuss] RabbitMQ upgrade 2.4.1 to 2.6.1 Shovel
	config ignored
In-Reply-To: <4EAA5782.4030107@rabbitmq.com>
References: <00a601cc953c$098f89c0$1cae9d40$@omc-international.com.au>
	<4EAA5782.4030107@rabbitmq.com>
Message-ID: <00ca01cc9545$35151d40$9f3f57c0$@omc-international.com.au>

Matthias,

I saw that in the new example configuration file and have changed it. Still
no joy.

Mihir

-----Original Message-----
From: Matthias Radestock [mailto:matthias at rabbitmq.com] 
Sent: Friday, 28 October 2011 3:20 PM
To: Mihir Mone
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] RabbitMQ upgrade 2.4.1 to 2.6.1 Shovel
config ignored

Mihir,

On 28/10/11 07:37, Mihir Mone wrote:
> Earlier today I updated my rabbitmq server from v2.4.1 to v2.6.1. Now 
> the shovel plugin does not work at all. I have download all the 
> necessary files and there are no errors in the startup and run logs of 
> the server. Any idea why this would happen ?

The tag for the config entries has changed from rabbit_shovel to
rabbitmq_shovel.

Matthias.


From matthias at rabbitmq.com  Fri Oct 28 09:18:35 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 28 Oct 2011 09:18:35 +0100
Subject: [rabbitmq-discuss] RabbitMQ upgrade 2.4.1 to 2.6.1 Shovel
 config ignored
In-Reply-To: <00ca01cc9545$35151d40$9f3f57c0$@omc-international.com.au>
References: <00a601cc953c$098f89c0$1cae9d40$@omc-international.com.au>
	<4EAA5782.4030107@rabbitmq.com>
	<00ca01cc9545$35151d40$9f3f57c0$@omc-international.com.au>
Message-ID: <4EAA655B.3050901@rabbitmq.com>

Mihir,

On 28/10/11 08:42, Mihir Mone wrote:
> I saw that in the new example configuration file and have changed it.
> Still no joy.

Ah few things to check...

Does the startup log indicate that the shovel plug-in is getting loaded?

Does the config file location shown in the startup log point to the
right place?

If the answer is 'yes' to the above then please post your rabbitmq.config

Regards,

Matthias.

From simon at rabbitmq.com  Fri Oct 28 11:13:44 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 28 Oct 2011 11:13:44 +0100
Subject: [rabbitmq-discuss] BOOT ERROR: FAILED
In-Reply-To: <1E30DD69-512E-4EEB-82A8-ECDF0C387CBD@portalify.com>
References: <1E30DD69-512E-4EEB-82A8-ECDF0C387CBD@portalify.com>
Message-ID: <4EAA8058.3080500@rabbitmq.com>

On 28/10/11 08:19, Matti Linnanvuori wrote:
> Reason: {{bad_return_value,{error,{node_not_running,'rabbit at iac-pgis'}}},
>           {gen_server2,call,[<0.219.0>,{init,true},infinity]}}

Hmm. So during startup the node decided it was not running any more.

So either:

a) Someone else got it to shut down while you were starting it up, or
b) It shut down for some reason that didn't end up in the startup log.

If a) sounds wrong then can you send us / upload somewhere the contents 
of the log directory on that machine?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From matthias at rabbitmq.com  Fri Oct 28 11:28:18 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 28 Oct 2011 11:28:18 +0100
Subject: [rabbitmq-discuss] Queue Clustering and Sequencing
In-Reply-To: <b89a44ba-69a4-4463-a61e-fd1f08328e7c@l19g2000yqm.googlegroups.com>
References: <B925600E2C563A4FA33FA9CF64A455B5031DE82D@LITEXCHEVS1.ventyx.org>	<4EA6D9DA.4070701@rabbitmq.com>	<5679e3c6-8288-4fb6-9705-e7a2261d2f88@v5g2000vbh.googlegroups.com>	<4EA90A99.8070700@rabbitmq.com>
	<b89a44ba-69a4-4463-a61e-fd1f08328e7c@l19g2000yqm.googlegroups.com>
Message-ID: <4EAA83C2.8070105@rabbitmq.com>

Roger,

On 27/10/11 18:59, RogerF wrote:
> Though one problem remains. When a node fails, the messages on that
> node's queues are still stuck there.

This could be addressed by mirroring the queues with active-active HA 
(http://www.rabbitmq.com/ha.html).

Matthias.

From madtrick at gmail.com  Fri Oct 28 11:29:28 2011
From: madtrick at gmail.com (Farruco Sanjurjo)
Date: Fri, 28 Oct 2011 12:29:28 +0200
Subject: [rabbitmq-discuss] Erlang strings and binstrings (newbie question)
Message-ID: <CAPujxtiuXDf0Jem46hnTBy2-1=z-oPmcu4ZOVj_TeMjQFdQOXw@mail.gmail.com>

Hi,

I'm using this (
https://github.com/rabbitmq/rabbitmq-tutorials/tree/master/erlang)  erlang
examples as an entry point to RabbitMQ and due to the fact that I'm also a
newbie to erlang there's something I don't get.

In the send.erl example, when you connect to the RabbitMQ server you specify
the host with a string ("localhost") but ,for example, when you specify the
routing_key you use a bitstring (<<"hello">>).

I know the differences between strings and bitstrings but, why don't we
allways use one of them? why sometimes strings and others bitstrings?

Thanks,
Farruco Sanjurjo
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111028/d050f906/attachment.htm>

From alexandru at rabbitmq.com  Fri Oct 28 11:52:28 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Fri, 28 Oct 2011 11:52:28 +0100
Subject: [rabbitmq-discuss] Erlang strings and binstrings (newbie
 question)
In-Reply-To: <CAPujxtiuXDf0Jem46hnTBy2-1=z-oPmcu4ZOVj_TeMjQFdQOXw@mail.gmail.com>
References: <CAPujxtiuXDf0Jem46hnTBy2-1=z-oPmcu4ZOVj_TeMjQFdQOXw@mail.gmail.com>
Message-ID: <20111028105228.GD3473@southbank>

> I know the differences between strings and bitstrings but, why don't we
> allways use one of them? why sometimes strings and others bitstrings?

Because some of the fields are part of the actual AMQP methods and some
are just used by the client.  The fields in the AMQP methods are going
to be sent over the network, and the client will not inspect them, so
they're binaries.

So, host is a string because the client uses that to open the
connection, but routing_key is a binary because it's a parameter in the
methods and is blindly sent over the network.

You have to use the right one (string or binary), of course, otherwise,
you get errors from deep inside the client.

Hope this helps.

Cheers,
Alex

On Fri, Oct 28, 2011 at 12:29:28PM +0200, Farruco Sanjurjo wrote:
> Hi,
> 
> I'm using this (
> https://github.com/rabbitmq/rabbitmq-tutorials/tree/master/erlang)  erlang
> examples as an entry point to RabbitMQ and due to the fact that I'm also a
> newbie to erlang there's something I don't get.
> 
> In the send.erl example, when you connect to the RabbitMQ server you specify
> the host with a string ("localhost") but ,for example, when you specify the
> routing_key you use a bitstring (<<"hello">>).
> 
> I know the differences between strings and bitstrings but, why don't we
> allways use one of them? why sometimes strings and others bitstrings?
> 
> Thanks,
> Farruco Sanjurjo

> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From simon at rabbitmq.com  Fri Oct 28 12:25:52 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 28 Oct 2011 12:25:52 +0100
Subject: [rabbitmq-discuss] rabbitmq-server
	ignoring	/etc/rabbitmq/rabbitmq-env.conf
In-Reply-To: <31693613.338.1319754712973.JavaMail.geo-discussion-forums@yqja14>
References: <31693613.338.1319754712973.JavaMail.geo-discussion-forums@yqja14>
Message-ID: <4EAA9140.5060608@rabbitmq.com>

On 27/10/11 23:31, Raymond Barlow wrote:
> After a day of pain, I finally managed to get rabbitmq installed, via
> homebrew, on my mac (lion).

What was painful installing on homebrew? Not that we do the packaging, 
but if there's anything we can help make easier that would be cool.

> Now, I'm having trouble with starting the server. It hangs (I guess
> trying to resolve the hostname). If I ctrl-c during the hang, the broker
> seems to start anyway.
>
> So, I thought I'd add NODENAME=localhost to
> /etc/rabbitmq/rabbitmq-env.conf (as suggested in other posts).
> But, even after I have created this file, and put the above in it,
> rabbitmq-server still fails connect (just hangs).

I think you need:

RABBITMQ_NODENAME=rabbit at localhost

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From steve at rabbitmq.com  Fri Oct 28 12:30:13 2011
From: steve at rabbitmq.com (Steve Powell)
Date: Fri, 28 Oct 2011 12:30:13 +0100
Subject: [rabbitmq-discuss] STOMP & expiration
In-Reply-To: <4E9F66EB.3000008@strategicdata.com.au>
References: <20110822110436.7786.abe10f7e5afbbb3a79ce619739541149@cern.ch>
	<4E521D9E.7000503@rabbitmq.com>
	<4E9F66EB.3000008@strategicdata.com.au>
Message-ID: <CBC2436D-2C71-4373-9787-4DA165C183AA@rabbitmq.com>

Toby,
See the post:
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-October/015635.html
and subsequent posts on that thread.

Steve Powell
steve at rabbitmq.com
[wrk: +44-2380-111-528] [mob: +44-7815-838-558]

On 20 Oct 2011, at 01:10, Toby Corkindale wrote:

> On 22/08/11 19:13, Matthias Radestock wrote:
>> Lionel,
>> 
>> On 22/08/11 10:07, Lionel Cons wrote:
>>> It seems that RabbitMQ does not handle the "expires" STOMP header.
>>> 
>>> Although this is not in the STOMP spec, it's commonly used in
>>> JMS-compliant brokers to handle expiration.
>>> 
>>> Is there any plan to support message expiration via STOMP?
>> 
>> Is that header set on a per-message basis? If so then Rabbit won't
>> support that any time soon.
>> 
>> With AMQP we support a per-queue setting that controls message expiry.
>> See http://www.rabbitmq.com/extensions.html#queue-ttl.
> 
> 
> 
> I'm using the STOMP plugin for RabbitMQ, which is auto-vivifying the queues for me; is there an easy way to tell it to also pass the x-message-ttl header along?
> 
> (I'm happy to use the per-queue setting since the per-message stuff isn't implemented)
> 
> Cheers,
> Toby
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111028/df9caa3b/attachment.htm>

From cyberdotnl at gmail.com  Fri Oct 28 12:53:09 2011
From: cyberdotnl at gmail.com (||M||)
Date: Fri, 28 Oct 2011 04:53:09 -0700 (PDT)
Subject: [rabbitmq-discuss] Queue size of the mirrored queue
Message-ID: <8ca9ed0e-1a68-4906-aeb2-cdea750b8dc1@4g2000yqu.googlegroups.com>

Hi,

At this moment I'm testing the HA active/active setup of rabbitMQ to
see if we can replace or current messagging solution with it. I
created the clustered on 2virutal machines and I must say I like what
I see so far.

I just have 1 question. Is it correct that I can't see the number of
messages that are in my durable queue when is processing. When I sent
(for example) 1.000.000 messages to the queue (using the fanout
exchange with 1 queue bind) with my publisher it will take some time,
but when it's done the subscribers are still receiving, because this
is not so fast as the publishing it will take much more time. But the
queue size is 3 messages at most.

It's not very imported because it just the interface, but I'm a little
bit concurred about where this message are if the management interface
(and the command line tool) can see them anywhere.

Does anyone have the same issue or have some more information about
is.

Tnx,

Melvin

From meem.ok at gmail.com  Fri Oct 28 13:06:24 2011
From: meem.ok at gmail.com (michael neidhardt)
Date: Fri, 28 Oct 2011 05:06:24 -0700 (PDT)
Subject: [rabbitmq-discuss] Queue depth and no. of consumers.
Message-ID: <10f27f82-2e92-4758-bf60-f4755bc9e817@1g2000vbx.googlegroups.com>

Hi,
I have a setup with 20 consumers to a single queue. I push approx. 600
msgs on the queue,
and all 20 consumers start running at full speed.
After, say, 20 minutes, I run "rabbitmqctl list_queues name messages
messages_unacknowledged consumers"
and see this:
queuename 540 540 20

This is as expected.

When I get the stats from a queue_declare with passive=True (using
py_amqplib), I am told that
there are no messages in queue, and 20 consumers. This is not what I
expected.

If I kill all consumers and run the python script again, I am told
that there are 540 messages and 0 consumers.

When I start the 20 consumers again, only 2 of them appear to be
getting msgs and actually doing anything,
i.e. iotop and top only list two processes as working.

Anybody has any clues?

I am using RabbitMQ 1.8.1-1  (Debian/Squeeze).

Regards,
Michael.

From lgreg.meredith at gmail.com  Fri Oct 28 13:37:06 2011
From: lgreg.meredith at gmail.com (Meredith Gregory)
Date: Fri, 28 Oct 2011 05:37:06 -0700
Subject: [rabbitmq-discuss] AMQP.BasicProperties
Message-ID: <CAG7cANQ3TnqakQ2-awRoBvfeSf2kOp1QRjkQqHvDYhyK2DebpA@mail.gmail.com>

Dear Rabbiters,

i find that i need to set some values on the AMQP.BasicProperties passed to
basicPublish. (The API is so basic, i wonder if we need to inject some acid
to restore neutral pH...) When i attempt to use the
AMQP.BasicProperties.builder scala informs me that it's not available --
either with rabbitmq java client 2.5.1 or 2.6.1

[ERROR]
 /Users/lgm/work/src/projex/stellar/mdp4tw/SpecialK/src/main/scala/com/biosimilarity/lift/lib/node/NodeAdapter.scala:103:
            error: value builder is not a member of object
            com.rabbitmq.client.AMQP.BasicProperties
[INFO]   AMQP.BasicProperties.builder()
[INFO]

and the set methods have been deprecated. What's the preferred method of
setting just a few fields of the AMQP.BasicProperties?

Best wishes,

--greg

-- 
L.G. Meredith
Managing Partner
Biosimilarity LLC
7329 39th Ave SW
Seattle, WA 98136

+1 206.650.3740

http://biosimilarity.blogspot.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111028/dad4e3c5/attachment.htm>

From michael.s.klishin at gmail.com  Fri Oct 28 14:13:28 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 28 Oct 2011 17:13:28 +0400
Subject: [rabbitmq-discuss] AMQP.BasicProperties
In-Reply-To: <CAG7cANQ3TnqakQ2-awRoBvfeSf2kOp1QRjkQqHvDYhyK2DebpA@mail.gmail.com>
References: <CAG7cANQ3TnqakQ2-awRoBvfeSf2kOp1QRjkQqHvDYhyK2DebpA@mail.gmail.com>
Message-ID: <80969792-220F-4781-8691-16D0517B8008@gmail.com>


Le 28/ott/2011 ? 16:37, Meredith Gregory a ?crit :

> and the set methods have been deprecated. What's the preferred method of setting just a few fields of the AMQP.BasicProperties?

You can instantiate AMQP.BasicProperties.Builder using new. AMQP.BasicProperties#builder is an instance method and is used to obtain a builder for the particular set of properties you already have (or at least this is my understanding).

In my Clojure and (J)Ruby libraries I instantiate AMQP.BasicProperties.Builder and go from there.

MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin


From adamrabung at gmail.com  Fri Oct 28 14:54:46 2011
From: adamrabung at gmail.com (Adam Rabung)
Date: Fri, 28 Oct 2011 09:54:46 -0400
Subject: [rabbitmq-discuss] AMQP.BasicProperties
In-Reply-To: <80969792-220F-4781-8691-16D0517B8008@gmail.com>
References: <CAG7cANQ3TnqakQ2-awRoBvfeSf2kOp1QRjkQqHvDYhyK2DebpA@mail.gmail.com>
	<80969792-220F-4781-8691-16D0517B8008@gmail.com>
Message-ID: <CAAN_EDot4VvWrECByA8m56db8Udf9rb0o6K9gsiTvBCRhG_m0g@mail.gmail.com>

Hi,
Are there any pros/cons to using BasicProperties for storing your own
message metadata vs. encoding it in the payload?

Thanks,
Adam

On Fri, Oct 28, 2011 at 9:13 AM, Michael Klishin <
michael.s.klishin at gmail.com> wrote:

>
> Le 28/ott/2011 ? 16:37, Meredith Gregory a ?crit :
>
> > and the set methods have been deprecated. What's the preferred method of
> setting just a few fields of the AMQP.BasicProperties?
>
> You can instantiate AMQP.BasicProperties.Builder using new.
> AMQP.BasicProperties#builder is an instance method and is used to obtain a
> builder for the particular set of properties you already have (or at least
> this is my understanding).
>
> In my Clojure and (J)Ruby libraries I instantiate
> AMQP.BasicProperties.Builder and go from there.
>
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111028/d6ce1f6b/attachment.htm>

From michael.s.klishin at gmail.com  Fri Oct 28 15:03:54 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 28 Oct 2011 18:03:54 +0400
Subject: [rabbitmq-discuss] AMQP.BasicProperties
In-Reply-To: <CAAN_EDot4VvWrECByA8m56db8Udf9rb0o6K9gsiTvBCRhG_m0g@mail.gmail.com>
References: <CAG7cANQ3TnqakQ2-awRoBvfeSf2kOp1QRjkQqHvDYhyK2DebpA@mail.gmail.com>
	<80969792-220F-4781-8691-16D0517B8008@gmail.com>
	<CAAN_EDot4VvWrECByA8m56db8Udf9rb0o6K9gsiTvBCRhG_m0g@mail.gmail.com>
Message-ID: <1689CF15-165C-43AF-B33F-76C7534FFB89@gmail.com>

Le 28/ott/2011 ? 17:54, Adam Rabung a ?crit :

> Are there any pros/cons to using BasicProperties for storing your own message metadata vs. encoding it in the payload?

Properties set has headers exactly for storing metadata in it. However, some clients may decode headers slightly differently (some languages/clients do not distinguish between Int and Long, for example) or not support certain types: Pika does not seem to support floats; one of popular Ruby clients, bunny, does not support arrays nested in attribute tables and so on.

So unless some piece of information is obviously metadata, encoding it into payload is a safer bet in multi-platform/polyglot systems.

MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin


From matthew at rabbitmq.com  Fri Oct 28 15:38:12 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 28 Oct 2011 15:38:12 +0100
Subject: [rabbitmq-discuss] Queue size of the mirrored queue
In-Reply-To: <8ca9ed0e-1a68-4906-aeb2-cdea750b8dc1@4g2000yqu.googlegroups.com>
References: <8ca9ed0e-1a68-4906-aeb2-cdea750b8dc1@4g2000yqu.googlegroups.com>
Message-ID: <20111028143812.GB30623@rabbitmq.com>

Hi Melvin,

On Fri, Oct 28, 2011 at 04:53:09AM -0700, ||M|| wrote:
> At this moment I'm testing the HA active/active setup of rabbitMQ to
> see if we can replace or current messagging solution with it. I
> created the clustered on 2virutal machines and I must say I like what
> I see so far.

That's great to hear!

> I just have 1 question. Is it correct that I can't see the number of
> messages that are in my durable queue when is processing. When I sent
> (for example) 1.000.000 messages to the queue (using the fanout
> exchange with 1 queue bind) with my publisher it will take some time,
> but when it's done the subscribers are still receiving, because this
> is not so fast as the publishing it will take much more time. But the
> queue size is 3 messages at most.

Ahh, what's going on is that the messages will be being buffered
internally before they get to the queue. Messages within Rabbit pass
between a number of different erlang processes. The process that spends
the most CPU per message will have the biggest backlog of these
messages. In the case of mirrored queues, it's definitely the queue
itself that'll be spending the most CPU per message.

Thus the queue will be receiving each message, processing it (including
all the HA gubbins), and then sending it out to the consumers as fast as
it can, but "as fast as it can" will still be slower than any other
process dealing with those messages within Rabbit. Thus there'll be a
backlog of messages building up immediately before the queue.

If you disable the consumers then you'll see the queue grow in length,
but again, your publisher may well report that it's published all 1e6
msgs before 1e6 msgs make it into the queue proper. This is the same
thing.

> It's not very imported because it just the interface, but I'm a little
> bit concurred about where this message are if the management interface
> (and the command line tool) can see them anywhere.

The numbers in the mgmt and command line are the numbers each actual
queue reports, thus precludes any internal backlog.

Hope that helps,

Matthew

From simon at rabbitmq.com  Fri Oct 28 15:53:23 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 28 Oct 2011 15:53:23 +0100
Subject: [rabbitmq-discuss] Queue depth and no. of consumers.
In-Reply-To: <10f27f82-2e92-4758-bf60-f4755bc9e817@1g2000vbx.googlegroups.com>
References: <10f27f82-2e92-4758-bf60-f4755bc9e817@1g2000vbx.googlegroups.com>
Message-ID: <4EAAC1E3.1010204@rabbitmq.com>

On 28/10/11 13:06, michael neidhardt wrote:
> Hi,
> I have a setup with 20 consumers to a single queue. I push approx. 600
> msgs on the queue,
> and all 20 consumers start running at full speed.
> After, say, 20 minutes, I run "rabbitmqctl list_queues name messages
> messages_unacknowledged consumers"
> and see this:
> queuename 540 540 20
>
> This is as expected.

So: you have 540 messages in the queue, *all of which are 
unacknowledged*. That is, they've been consumed but not acked.

> When I get the stats from a queue_declare with passive=True (using
> py_amqplib), I am told that
> there are no messages in queue, and 20 consumers. This is not what I
> expected.

The number returned in queue_declare is the number of messages that 
could be consumed - it's equivalent to messages_ready in rabbitmqctl.

> If I kill all consumers and run the python script again, I am told
> that there are 540 messages and 0 consumers.

When you do this, all the unacknowledged messages get requeued - so now 
they show up as ready again.

> When I start the 20 consumers again, only 2 of them appear to be
> getting msgs and actually doing anything,
> i.e. iotop and top only list two processes as working.

If you're not using basic.qos then the messages will get pushed out to 
whichever consumers will take them - it's not guaranteed to be fair.

> Anybody has any clues?

tl;dr: ack your messages, or use autoack mode.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From michael.s.klishin at gmail.com  Fri Oct 28 16:16:17 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 28 Oct 2011 19:16:17 +0400
Subject: [rabbitmq-discuss] [announcement] amq-client 0.8.5 is released
Message-ID: <DD725600-6A97-43C9-8C95-3493D3B73A41@gmail.com>

amq-client 0.8.5 is released to rubygems.org [1]. This is a bug fix release:

* "In-flight" messages that are delivered right after consumer is cancelled are now dropped and will not result
    in obscure exceptions.


1. https://rubygems.org/gems/amq-client/versions/0.8.5

All amqp gem users are recommended to upgrade.


MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin


From matthew at rabbitmq.com  Fri Oct 28 16:20:25 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 28 Oct 2011 16:20:25 +0100
Subject: [rabbitmq-discuss] [announcement] amq-client 0.8.5 is released
In-Reply-To: <DD725600-6A97-43C9-8C95-3493D3B73A41@gmail.com>
References: <DD725600-6A97-43C9-8C95-3493D3B73A41@gmail.com>
Message-ID: <20111028152025.GC30623@rabbitmq.com>

Hi Michael,

On Fri, Oct 28, 2011 at 07:16:17PM +0400, Michael Klishin wrote:
> amq-client 0.8.5 is released to rubygems.org [1]. This is a bug fix release:
> 
> * "In-flight" messages that are delivered right after consumer is cancelled are now dropped and will not result
>     in obscure exceptions.

Interesting. In the other clients we tend to go down the route of having
a "default" consumer which receives such messages. Someone receiving
these messages is important because if they're not acknowledged then
they can form a memory leak on the broker for the lifetime of the
channel that consumed the messages.

Not saying that all clients should be the same, of course, just that
there are implications to silently discarding those messages - you're
preventing any other consumer of that queue from receiving them.

Matthew

From matthias at rabbitmq.com  Fri Oct 28 16:29:49 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 28 Oct 2011 16:29:49 +0100
Subject: [rabbitmq-discuss] [announcement] amq-client 0.8.5 is released
In-Reply-To: <20111028152025.GC30623@rabbitmq.com>
References: <DD725600-6A97-43C9-8C95-3493D3B73A41@gmail.com>
	<20111028152025.GC30623@rabbitmq.com>
Message-ID: <4EAACA6D.3070504@rabbitmq.com>

On 28/10/11 16:20, Matthew Sackman wrote:
> Hi Michael,
>
> On Fri, Oct 28, 2011 at 07:16:17PM +0400, Michael Klishin wrote:
>> amq-client 0.8.5 is released to rubygems.org [1]. This is a bug fix release:
>>
>> * "In-flight" messages that are delivered right after consumer is cancelled are now dropped and will not result
>>      in obscure exceptions.
>
> Interesting. In the other clients we tend to go down the route of having
> a "default" consumer which receives such messages. Someone receiving
> these messages is important because if they're not acknowledged then
> they can form a memory leak on the broker for the lifetime of the
> channel that consumed the messages.
>
> Not saying that all clients should be the same, of course, just that
> there are implications to silently discarding those messages - you're
> preventing any other consumer of that queue from receiving them.

Also note that a client is guaranteed not to receive any messages for a 
consumer after receiving the basic.cancel_ok. I see from the ruby code 
that the callbacks/consumers are cleared prior to sending the 
basic.cancel. You may want to delay that until after receiving the 
cancel_ok. Though you'll have to handle the nowait case somehow too.

Matthias.

From michael.s.klishin at gmail.com  Fri Oct 28 16:30:05 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 28 Oct 2011 19:30:05 +0400
Subject: [rabbitmq-discuss] [announcement] amq-client 0.8.5 is released
In-Reply-To: <20111028152025.GC30623@rabbitmq.com>
References: <DD725600-6A97-43C9-8C95-3493D3B73A41@gmail.com>
	<20111028152025.GC30623@rabbitmq.com>
Message-ID: <3F776E99-5563-4CE7-A010-1F71EF908C7C@gmail.com>

Le 28/ott/2011 ? 19:20, Matthew Sackman a ?crit :

> Interesting. In the other clients we tend to go down the route of having
> a "default" consumer which receives such messages. Someone receiving
> these messages is important because if they're not acknowledged then
> they can form a memory leak on the broker for the lifetime of the
> channel that consumed the messages.
> 
> Not saying that all clients should be the same, of course, just that
> there are implications to silently discarding those messages - you're
> preventing any other consumer of that queue from receiving them.

Matthew,

I am aware of that but adding some kind of "catch all" consumer will take more time to fix and in many situations
there is not enough information about the context for default consumer to actually do something useful (besides logging warnings).

So we evaluated a few solutions decided to go with this one for now.

MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin


From matthias at rabbitmq.com  Fri Oct 28 16:33:10 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 28 Oct 2011 16:33:10 +0100
Subject: [rabbitmq-discuss] [announcement] amq-client 0.8.5 is released
In-Reply-To: <3F776E99-5563-4CE7-A010-1F71EF908C7C@gmail.com>
References: <DD725600-6A97-43C9-8C95-3493D3B73A41@gmail.com>	<20111028152025.GC30623@rabbitmq.com>
	<3F776E99-5563-4CE7-A010-1F71EF908C7C@gmail.com>
Message-ID: <4EAACB36.3040703@rabbitmq.com>

On 28/10/11 16:30, Michael Klishin wrote:
> So we evaluated a few solutions decided to go with this one for now.

Haven't you just introduced a server-side leak, assuming clients stay 
around for long enough? In which case the cure may be worse than the 
disease.

Matthias.

From michael.s.klishin at gmail.com  Fri Oct 28 16:34:42 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 28 Oct 2011 19:34:42 +0400
Subject: [rabbitmq-discuss] [announcement] amq-client 0.8.5 is released
In-Reply-To: <4EAACA6D.3070504@rabbitmq.com>
References: <DD725600-6A97-43C9-8C95-3493D3B73A41@gmail.com>
	<20111028152025.GC30623@rabbitmq.com>
	<4EAACA6D.3070504@rabbitmq.com>
Message-ID: <13E49BD0-ACC8-4A61-8B01-EF56DA5040CD@gmail.com>

Le 28/ott/2011 ? 19:29, Matthias Radestock a ?crit :

> Also note that a client is guaranteed not to receive any messages for a consumer after receiving the basic.cancel_ok. I see from the ruby code that the callbacks/consumers are cleared prior to sending the basic.cancel. You may want to delay that until after receiving the cancel_ok. Though you'll have to handle the nowait case somehow too.

Matthias,

This is a good idea but here's the catch: amqp gem has had nowait set to true by default for basic.cancel since very early days and it may be too late to change that.

That said, I am all for improving the situation over time but right now we needed to release something that does not result in exceptions killing the entire connection.

MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin


From michael.s.klishin at gmail.com  Fri Oct 28 16:40:15 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 28 Oct 2011 19:40:15 +0400
Subject: [rabbitmq-discuss] [announcement] amq-client 0.8.5 is released
In-Reply-To: <4EAACB36.3040703@rabbitmq.com>
References: <DD725600-6A97-43C9-8C95-3493D3B73A41@gmail.com>	<20111028152025.GC30623@rabbitmq.com>
	<3F776E99-5563-4CE7-A010-1F71EF908C7C@gmail.com>
	<4EAACB36.3040703@rabbitmq.com>
Message-ID: <72E0F796-7345-4C0F-A075-98B74F0768C8@gmail.com>


Le 28/ott/2011 ? 19:33, Matthias Radestock a ?crit :

> Haven't you just introduced a server-side leak, assuming clients stay around for long enough? In which case the cure may be worse than the disease.

I understand this. Switching to some kind of default consumer later won't break any existing code so we almost certainly will do that. I am not sure what such consumer would do with messages that require explicit acknowledgements but I guess I can easily find that out in the Java client source and do the same thing.

Given that this scenario only happens when consumers are added and removed aggressively and explicit acknowledgements are used, to me it sounds like a reasonable trade-off that wins us time.

MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin


From matthias at rabbitmq.com  Fri Oct 28 16:45:10 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 28 Oct 2011 16:45:10 +0100
Subject: [rabbitmq-discuss] [announcement] amq-client 0.8.5 is released
In-Reply-To: <72E0F796-7345-4C0F-A075-98B74F0768C8@gmail.com>
References: <DD725600-6A97-43C9-8C95-3493D3B73A41@gmail.com>	<20111028152025.GC30623@rabbitmq.com>
	<3F776E99-5563-4CE7-A010-1F71EF908C7C@gmail.com>
	<4EAACB36.3040703@rabbitmq.com>
	<72E0F796-7345-4C0F-A075-98B74F0768C8@gmail.com>
Message-ID: <4EAACE06.3000809@rabbitmq.com>

On 28/10/11 16:40, Michael Klishin wrote:
> Given that this scenario only happens when consumers are added and
> removed aggressively and explicit acknowledgements are used, to me it
> sounds like a reasonable trade-off that wins us time.

Except you have turned a problem that is reported against the amqp gem 
(which is indeed where the problem resides) into one that will likely be 
reported against rabbitmq (which is not at fault).

Matthias.

From awitbrock at vmware.com  Fri Oct 28 18:24:56 2011
From: awitbrock at vmware.com (Ann Witbrock (c))
Date: Fri, 28 Oct 2011 10:24:56 -0700 (PDT)
Subject: [rabbitmq-discuss] questions
In-Reply-To: <CAAmu3Q-dpAkhJZ2O6xZD6_xwGvROKqcL=XqfxSZmWpDb1pR1+g@mail.gmail.com>
Message-ID: <924854130.712525.1319822696823.JavaMail.root@zimbra-prod-mbox-4.vmware.com>


??, 

If you look at the Documentation page http://www.rabbitmq.com/documentation.html in the Clients section, 
you will find?info on the Java client. 
? 
For example, from the javadocs: 
http://www.rabbitmq.com/releases/rabbitmq-java-client/v2.6.1/rabbitmq-java-client-javadoc-2.6.1/com/rabbitmq/client/Channel.html 
? 
and more generally 
http://www.rabbitmq.com/api-guide.html 

Ann 

----- Original Message -----

From: "??" <lianlupeng at gmail.com> 
To: "Ann Witbrock (c)" <awitbrock at vmware.com> 
Sent: Friday, 28 October, 2011 12:38:59 PM 
Subject: Re: questions 

hi 

?? thanks ! i have already resoled the problrm. 


? i am newer ,and i am not familiar with RabbitMQ,but i really know it is a good framework,i use it in my project. 

? i found it is not easy to use it ,for example,when i use the com.rabbitmq.client.Channel,to send message from a client to a server ,i have to search the document as you provide,but the problem comes 
i can not find com.rabbitmq.client.Channel in the document? 

and in my project it is very important for me to user channel to send objects ,how should i do? 


best regards! 


2011/10/28 Ann Witbrock (c) < awitbrock at vmware.com > 





Hi lianlupeng, 
I agree, your service hasn't started. 
? 
First question, did you install the erlang first? 
http://www.rabbitmq.com/install.html#windows 

Second question, if you installed the latest Erlang first, did you?change any?options in the installer? 
? 
Third question, do you have write permissions for the relevant folders? 
e.g. Did you run as an administrator? 
? 
I recommend you use our discussion list for any further questions. 
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss 
? 
Regards, 
Ann Witbrock 




From: "??" < lianlupeng at gmail.com > 
To: legitimategrievance at rabbitmq.com 
Sent: Thursday, 27 October, 2011 2:19:24 PM 
Subject: questions 





hi 

?? i have a question in installing rabbitmq-server-2.6.1.exe,and the result is rabbitserver is not start.and it lead to the question below 


Exception in thread "main" java.net.ConnectException: Connection refused: connect 
??? at java.net.DualStackPlainSocketImpl.connect0(Native Method) 
??? at java.net.DualStackPlainSocketImpl.socketConnect(DualStackPlainSocketImpl.java:69) 
??? at java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:337) 
??? at java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:198) 
??? at java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:180) 
??? at java.net.PlainSocketImpl.connect(PlainSocketImpl.java:157) 
??? at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:391) 
??? at java.net.Socket.connect(Socket.java:579) 
??? at com.rabbitmq.client.ConnectionFactory.createFrameHandler(ConnectionFactory.java:362) 
??? at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:400) 
??? at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:423) 
??? at org.llp.iamq.server.Recv.main(Recv.java:16) 
?how can i resolve the problem ? 

best regards! 
-- 
by lianlupeng. 






-- 
by lianlupeng. 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111028/0b12d679/attachment.htm>

From kot.begemot at gmail.com  Fri Oct 28 20:46:28 2011
From: kot.begemot at gmail.com (Vadim Chekan)
Date: Fri, 28 Oct 2011 12:46:28 -0700
Subject: [rabbitmq-discuss] HA Client for RabbitMQ?
In-Reply-To: <20111002171219.GG27797@wellquite.org>
References: <19691872.1093.1317485897379.JavaMail.geo-discussion-forums@yqmw31>
	<20111002171219.GG27797@wellquite.org>
Message-ID: <CAFWGgNEP6fOSWSToOWWO6q4vmQgXbtmL43p79SXcAyfY1tQFnQ@mail.gmail.com>

Hmm I don't quite understand than when documentation on active/active is
trying to say:
> All actions other than publishes go only to the master, and the master
then broadcasts the effect of the actions to the slaves

Does it mean that slaves are acting as proxies to master? Which means that
for performance reason it is better for the clients to connect to master if
possible?
And why publishes are exception to this rule?

Vadim.


On Sun, Oct 2, 2011 at 10:12 AM, Matthew Sackman <matthew at rabbitmq.com>wrote:

> On Sat, Oct 01, 2011 at 09:18:17AM -0700, Alex Gr?nholm wrote:
> > I noticed that the hot new feature in RabbitMQ 2.6 is Active/Active HA on
> > the server side. How can I take advantage of this on the client side?
> AFAIK
> > the client only knows how to connect to a single server -- you can't give
> it
> > a list of servers for failover purposes.
>
> Correct. The Active/Active HA work does not address the issue of client
> connectivity. There are a number of solutions that you could use:
>
> o) Change the DNS on failure
> o) a plain TCP load balancer like haproxy or a router-based one
> o) mobile IP addresses as can be done with something like pacemaker
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 

From roger.fischer at abb.ventyx.com  Fri Oct 28 20:48:25 2011
From: roger.fischer at abb.ventyx.com (RogerF)
Date: Fri, 28 Oct 2011 12:48:25 -0700 (PDT)
Subject: [rabbitmq-discuss] Queue Clustering and Sequencing
In-Reply-To: <4EAA83C2.8070105@rabbitmq.com>
References: <B925600E2C563A4FA33FA9CF64A455B5031DE82D@LITEXCHEVS1.ventyx.org>
	<4EA6D9DA.4070701@rabbitmq.com>
	<5679e3c6-8288-4fb6-9705-e7a2261d2f88@v5g2000vbh.googlegroups.com>
	<4EA90A99.8070700@rabbitmq.com>
	<b89a44ba-69a4-4463-a61e-fd1f08328e7c@l19g2000yqm.googlegroups.com>
	<4EAA83C2.8070105@rabbitmq.com>
Message-ID: <fac9e486-199b-4cd3-a83c-62d50c2c5f41@s11g2000yqi.googlegroups.com>

Thanks again, Matthias.

> This could be addressed by mirroring the queues with active-active HA
> (http://www.rabbitmq.com/ha.html).

That gets us very close to what we need.

It still leaves us with a small sequence problem on failover. The
documentation states:

"... it requeues (at the rear of the queue) ..."

Roger

From matthias at rabbitmq.com  Fri Oct 28 20:55:22 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 28 Oct 2011 20:55:22 +0100
Subject: [rabbitmq-discuss] Queue Clustering and Sequencing
In-Reply-To: <fac9e486-199b-4cd3-a83c-62d50c2c5f41@s11g2000yqi.googlegroups.com>
References: <B925600E2C563A4FA33FA9CF64A455B5031DE82D@LITEXCHEVS1.ventyx.org>	<4EA6D9DA.4070701@rabbitmq.com>	<5679e3c6-8288-4fb6-9705-e7a2261d2f88@v5g2000vbh.googlegroups.com>	<4EA90A99.8070700@rabbitmq.com>	<b89a44ba-69a4-4463-a61e-fd1f08328e7c@l19g2000yqm.googlegroups.com>	<4EAA83C2.8070105@rabbitmq.com>
	<fac9e486-199b-4cd3-a83c-62d50c2c5f41@s11g2000yqi.googlegroups.com>
Message-ID: <4EAB08AA.2050001@rabbitmq.com>

Roger,

On 28/10/11 20:48, RogerF wrote:
> It still leaves us with a small sequence problem on failover. The
> documentation states:
>
> "... it requeues (at the rear of the queue) ..."

That changes in the upcoming release.

Matthias.

From chiappone at gmail.com  Fri Oct 28 18:59:27 2011
From: chiappone at gmail.com (Chris Chiappone)
Date: Fri, 28 Oct 2011 10:59:27 -0700 (PDT)
Subject: [rabbitmq-discuss]   consumers and vhosts
Message-ID: <10540083.2870.1319824767560.JavaMail.geo-discussion-forums@prog16>

I am new to rabbitmq and was wondering if there is any way for a certain 
consumer to consume all messages from multiple vhosts?

thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111028/e0f8c9a5/attachment.htm>

From chiappone at gmail.com  Fri Oct 28 20:45:54 2011
From: chiappone at gmail.com (Chris Chiappone)
Date: Fri, 28 Oct 2011 12:45:54 -0700 (PDT)
Subject: [rabbitmq-discuss]   New to RabbitMq questions
Message-ID: <26746218.2946.1319831154087.JavaMail.geo-discussion-forums@prog16>

I am trying to decide if rabbitmq is something that would fit well in our 
architecture.  I have a question on what is the best way to approach/design 
should be used if I wanted to be able to consume messages from multiple 
clients.

My use case is basically:

Unlimited number of clients that can publish and subscribe to messages to 
their own queues or exchanges.

An admin client that can subscribe or publish on to any queue or exchange.
The admin client would always be connected.  I realize that a client can 
have access to any queue or exchange but I want to be able to dynamically 
bind to new exchanges/queues as they are added by other users so I 
can receive all messages.

Is there a good way to do this?

Thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111028/5ad2f3ca/attachment.htm>

From adamrabung at gmail.com  Sat Oct 29 03:04:40 2011
From: adamrabung at gmail.com (Adam Rabung)
Date: Fri, 28 Oct 2011 22:04:40 -0400
Subject: [rabbitmq-discuss] Big backlogs
Message-ID: <CAAN_EDoezdr=RydpEgWovK=amncU8pMvH-Qfq-=2Waw7jyrH8Q@mail.gmail.com>

Hello,
I have come to understand that a happy Rabbit is a nearly-empty Rabbit.
 Obviously, no matter how you lay things out, the publish rate will outpace
the consumption rate, sometimes for sustained periods of time.  My first
reaction is to throttle producers, but due to the number and behavior of
producers in my system, this seems difficult.

Another approach would be to re-route backlogs to a "throttling consumer".
 This consumer quickly drains the queue, storing messages to a durable
store.  At a prescribed rate, it pulls these messages out in FIFO order and
feeds them back in to the general queue.  In general, it seems useful in
many cases to move time-insensitive messages aside temporarily when
resources are tight.

My question is: would another RabbitMQ broker be appropriate "durable store"
for storing these throttled messages?  We can assume there will be far too
many message to store in memory.  I realize Rabbit will page large queues
off to Mnesia, but will it perform reasonably if only 10% of messages can be
stored in memory?  1%?  While this is a FIFO structure, it seems to have
many characteristics that are different from a typical queue: very large
footprint, very low throughput, very few consumers.

Thank you for any feedback.
Adam
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111028/93791edb/attachment.htm>

From james.r.carr at gmail.com  Sat Oct 29 13:40:39 2011
From: james.r.carr at gmail.com (James Carr)
Date: Sat, 29 Oct 2011 08:40:39 -0400
Subject: [rabbitmq-discuss] HA Client for RabbitMQ?
In-Reply-To: <20111002171219.GG27797@wellquite.org>
References: <19691872.1093.1317485897379.JavaMail.geo-discussion-forums@yqmw31>
	<20111002171219.GG27797@wellquite.org>
Message-ID: <CAJreXKDB=Qgb_dB9Qjt0JV=CtNd0ZB0b0QN9ehJDByyKJ5kZUg@mail.gmail.com>

I haven't had luck with load balancers on consumers. Publishers work
fine when load balanced while consumers, for reasons that elude me,
seem to run slower when behind a load balancer.

On Sun, Oct 2, 2011 at 1:12 PM, Matthew Sackman <matthew at rabbitmq.com> wrote:
> On Sat, Oct 01, 2011 at 09:18:17AM -0700, Alex Gr?nholm wrote:
>> I noticed that the hot new feature in RabbitMQ 2.6 is Active/Active HA on
>> the server side. How can I take advantage of this on the client side? AFAIK
>> the client only knows how to connect to a single server -- you can't give it
>> a list of servers for failover purposes.
>
> Correct. The Active/Active HA work does not address the issue of client
> connectivity. There are a number of solutions that you could use:
>
> o) Change the DNS on failure
> o) a plain TCP load balancer like haproxy or a router-based one
> o) mobile IP addresses as can be done with something like pacemaker
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From michael.justin at gmx.net  Sat Oct 29 18:50:34 2011
From: michael.justin at gmx.net (Michael Justin)
Date: Sat, 29 Oct 2011 19:50:34 +0200
Subject: [rabbitmq-discuss] Amazon EC2 AMI with current RabbitMQ disappeared?
Message-ID: <j8hedb$p1m$2@dough.gmane.org>

The AMI "ami-6b32612e" with RabbitMQ 2.4.0 mentioned on 
http://old.nabble.com/Ubuntu-%2B-RabbitMQ-2.4.0-EC2-AMI-td31280970.html 
(link found on http://www.rabbitmq.com/devtools.html#ec2-dev) seems to 
be pulled from EC2 - only older versions 1.6.0 and 1.7.0 of RabbitMQ are 
listed in the AMI directory.

Maybe there is an Ubuntu AMI which already has a recent RabbitMQ version 
(2.4 or 2.6) on EC2 or? I have found two Ubuntu 11.10 AMIs
I would like to run it on demand for demo purposes only.

Am I understanding correctly that Ubuntu 11.10 ships with RabbitMQ 2.3.1?

Regards
Michael Justin




From shenyute at gmail.com  Sun Oct 30 03:26:56 2011
From: shenyute at gmail.com (Yu-Teh Shen)
Date: Sun, 30 Oct 2011 11:26:56 +0800
Subject: [rabbitmq-discuss] RabbitMQ network issue (IP change) on cluster
Message-ID: <CABWH_X6DNiw=zXQw4NvLHdr1-qu6jnuLssQ6jSWvpa97BMFVwg@mail.gmail.com>

Hello all.

I have 3 nodes running the cluster.

It works fine at beginning, but when I run /etc/init.d/networking restart
(the command can lead to some node with different IP).

The cluster may not to find the node which change the ip.

For example, after the command, node 2 change the ip.
Now node 1 and node 3 are in cluster and can not find node2, but they still
have the information about the cluster.
Node 2 can not find node 1 and node 3 either.

root at lab002:/home/ooo# rabbitmqctl cluster_status
Cluster status of node rabbit at lab002 ...
[{nodes,[{disc,[rabbit at lab003,rabbit at lab002,rabbit at lab001]}]},
 {running_nodes,[rabbit at lab002]}]
...done.


In this case I need to restart the node 2 to make it find node 1 and node 3.

Is the cause that the erlang VM can not detect the ip change on nodes when
running?

Thanks

Shen, Yu-Teh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111030/efe71025/attachment.htm>

From moseley at hank.org  Sun Oct 30 05:55:47 2011
From: moseley at hank.org (Bill Moseley)
Date: Sun, 30 Oct 2011 11:25:47 +0530
Subject: [rabbitmq-discuss] Prevent queue flooding
Message-ID: <CAKhN_m7-V8MFCo-beZe7zkc4PwuMo-is68UPV6L+7a_NTNMfjg@mail.gmail.com>

I have two usage questions;

First, we have customers submitting jobs (via a web app) at a pretty even
rate, and as such any individual customer's job gets done on a pretty
regular basis.  But, it's possible for a single customer to flood the queue
with requests, which leads to everyone else waiting on that one customer's
jobs to complete.  I would like it to reduce the effect of one customer's
actions on everyone else.

My plan was to use Memcached to track submission rates per customer and
when they exceed some rate publish their jobs to a secondary (low priority)
queue.  Then assign fewer workers to the low priority queue.

Is this a good approach?


Second, when the web app queues a message (to process some "backend" job)
the web app sets a "pending" state in the database.  What normally happens
is one worker processes the job, then this worker sends a new message that
a second worker picks up and completes the job on the web app side.  In the
most simple case "completing" the job means the state in the database is
changed from "pending" to "complete".

Is this a common use pattern?

My question is how to handle failures and detect stale jobs.  For example,
what if the first worker dies and never sends the completed (or failed)
message to the second worker?  The database is then left indicating
"pending".   I would tend to use cron for this. That is, have cron look for
old "pending" states and either re-queue the request or mark it as failed
(say after a few failed retry attempts).

Are there other approaches I should consider?

Thanks,



-- 
Bill Moseley
moseley at hank.org
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111030/c1cd2eb3/attachment.htm>

From matthew at rabbitmq.com  Sun Oct 30 07:29:34 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Sun, 30 Oct 2011 07:29:34 +0000
Subject: [rabbitmq-discuss] RabbitMQ network issue (IP change) on cluster
In-Reply-To: <CABWH_X6DNiw=zXQw4NvLHdr1-qu6jnuLssQ6jSWvpa97BMFVwg@mail.gmail.com>
References: <CABWH_X6DNiw=zXQw4NvLHdr1-qu6jnuLssQ6jSWvpa97BMFVwg@mail.gmail.com>
Message-ID: <20111030072933.GA7731@rabbitmq.com>

On Sun, Oct 30, 2011 at 11:26:56AM +0800, Yu-Teh Shen wrote:
> Is the cause that the erlang VM can not detect the ip change on nodes when
> running?

Hmm, not sure, but very possible. Once the IP has changed and you've
restarted the network, try finding epmd, killing it, and restarting that
too. That might help.

Matthew

From majek04 at gmail.com  Sun Oct 30 16:34:19 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Sun, 30 Oct 2011 16:34:19 +0000
Subject: [rabbitmq-discuss] Amazon EC2 AMI with current RabbitMQ
	disappeared?
In-Reply-To: <j8hedb$p1m$2@dough.gmane.org>
References: <j8hedb$p1m$2@dough.gmane.org>
Message-ID: <CABzX+qyxw-ztz6AxPU46ZvB2SDcEZYt4d71YJwotDLLY7Sj7JA@mail.gmail.com>

On Sat, Oct 29, 2011 at 18:50, Michael Justin <michael.justin at gmx.net> wrote:
> The AMI "ami-6b32612e" with RabbitMQ 2.4.0 mentioned on
> http://old.nabble.com/Ubuntu-%2B-RabbitMQ-2.4.0-EC2-AMI-td31280970.html
> (link found on http://www.rabbitmq.com/devtools.html#ec2-dev) seems to be
> pulled from EC2 - only older versions 1.6.0 and 1.7.0 of RabbitMQ are listed
> in the AMI directory.
>
> Maybe there is an Ubuntu AMI which already has a recent RabbitMQ version
> (2.4 or 2.6) on EC2 or? I have found two Ubuntu 11.10 AMIs
> I would like to run it on demand for demo purposes only.
>
> Am I understanding correctly that Ubuntu 11.10 ships with RabbitMQ 2.3.1?


Michael,

Ubuntu is generally shipping with a bit outdated rabbitmq.

If you need RabbitMQ on EC2, you probably should install newest Ubuntu
LTS from http://uec-images.ubuntu.com/releases/

Add rabbitmq deb repo to the apt-sources and install newest rabbitmq.

Follow this instructions:
http://www.rabbitmq.com/ec2.html

Cheers,
 Marek

From mihirm at omc-international.com.au  Sun Oct 30 22:44:55 2011
From: mihirm at omc-international.com.au (Mihir Mone)
Date: Mon, 31 Oct 2011 06:44:55 +0800
Subject: [rabbitmq-discuss] RabbitMQ Shovel Connections
In-Reply-To: <20111025151433.GG3231@southbank>
References: <4E7929EC.1070906@omc-international.com.au>	<4E7A7266.5050800@omc-international.com.au>	<20110926115420.GC31944@rabbitmq.com>	<13456440.173.1319125870200.JavaMail.geo-discussion-forums@yqja14>
	<20111025151433.GG3231@southbank>
Message-ID: <005401cc9755$8bc06d40$a34147c0$@omc-international.com.au>

Hey guys,

I have just updated rabbit from 2.4.1 to 2.6.1 and this issue seems to have
been addressed. It looks like now the shovel plugin only establishes
connections if there are any messages on the queue to be shovelled. This is
exactly what I was looking for.

Kudos and thanks to the rabbiters.

Regards,
Mihir

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com
[mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Alexandru
Scvortov
Sent: Tuesday, 25 October 2011 11:15 PM
To: Jelle Smet
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] RabbitMQ Shovel Connections

Hi Jelle,

Sorry for the late reply.

> When the broker is in such a situation, I have found that restarting 
> RabbitMQ with the init scripts is not possible.

That's interesting.

When the broker reaches the situation, could you try running:
  > rabbitmqctl status
  > rabbitmqclt report
and post the output here?

Could you also check if any errors are being reported in the rabbit and sasl
logs?

Once you do this, could you try stopping rabbit with
  > rabbitmqctl stop
?

All of the above is geared towards finding out why the broker isn't shutting
down.

Cheers,
Alex

On Thu, Oct 20, 2011 at 08:51:10AM -0700, Jelle Smet wrote:
> Hi,
> 
> I have a newly installed setup running RabbitMQ version 2.6.1 and the 
> Shovel plugin downloaded from:
> http://www.rabbitmq.com/releases/plugins/v2.6.1/rabbitmq_shovel-2.6.1.ez.
> I came across a few occasions which look similar to Mihir's situation.
> On my side no messages are lost, but they just keep sitting 
> unacknowledged in the source broker. Restarting the source broker 
> RabbitMQ the solves the problem.
> When the broker is in such a situation, I have found that restarting 
> RabbitMQ with the init scripts is not possible.  I have to sigkill it 
> and start it again after which everything works again.
> 
> Which output and information I can submit to further troubleshoot this?
> 
> Thanks,
> 
> Jelle
> 
> 

> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From acheremukhin.digitalguard at gmail.com  Mon Oct 31 05:03:41 2011
From: acheremukhin.digitalguard at gmail.com (Cheremukhin Andrey)
Date: Sun, 30 Oct 2011 22:03:41 -0700 (PDT)
Subject: [rabbitmq-discuss]  Problem with RAM
Message-ID: <32287654.406.1320037421256.JavaMail.geo-discussion-forums@yqbl36>

Hi all.
I am having problem with using RAM of rabbitmq.
I have set vm_memory_high_watermark in 0.7.
But in logs, i am seeing


=INFO REPORT==== 28-Oct-2011::23:30:34 ===
vm_memory_high_watermark set. Memory used:29758910864 allowed:17447482572

=INFO REPORT==== 28-Oct-2011::23:30:34 ===
    alarm_handler: {set,
                       
{{vm_memory_high_watermark,'rabbit at ksn-backend3_jail1'},
                        []}}


Is it normal case? Why do rabbitmq use more memory than limit?

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111030/28578523/attachment.htm>

From wangxf at hundsun.com  Mon Oct 31 08:39:13 2011
From: wangxf at hundsun.com (=?gb2312?B?zfXRp7fJ?=)
Date: Mon, 31 Oct 2011 08:39:13 +0000
Subject: [rabbitmq-discuss]   Failed during starting up rabbitmq
Message-ID: <BCDA1FDAD4F49A42B7A93C11B4C46FB50430FB@HSMAILBOX02.hs.handsome.com.cn>

Hi,

I can?t start up rabbitmq server. Check the startup_log and find some reason. But I can?t understand it. Could anybody help me figure it out?


Here is startup_log:

starting exchange, queue and binding recovery                         ...BOOT ERROR: FAILED
Reason: {badmatch,
            {error,
                {{{badmatch,
                      {error,
                          {"/var/lib/rabbitmq/mnesia/rabbit at hscbu-tx22/msg_store_transient/0.rdq",
                           eacces}}},
                  [{rabbit_msg_store,init,1},
                   {gen_server2,init_it,6},
                   {proc_lib,init_p_do_apply,3}]},
                 {child,undefined,msg_store_transient,
                     {rabbit_msg_store,start_link,
                         [msg_store_transient,
                          "/var/lib/rabbitmq/mnesia/rabbit at hscbu-tx22",
                          undefined,
                          {#Fun<rabbit_variable_queue.0.104219162>,ok}]},
                     transient,4294967295,worker,
                     [rabbit_msg_store]}}}}
Stacktrace: [{rabbit_sup,start_child,3},
             {rabbit_variable_queue,start_msg_store,2},
             {rabbit_amqqueue,start,0},
             {rabbit,recover,0},
             {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
             {rabbit,run_boot_step,1},
             {rabbit,'-start/2-lc$^0/1-0-',1},
             {rabbit,start,2}]


Thanks,

Wright
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111031/f448df59/attachment.htm>

From alexandru at rabbitmq.com  Mon Oct 31 08:59:36 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Mon, 31 Oct 2011 08:59:36 +0000
Subject: [rabbitmq-discuss] Failed during starting up rabbitmq
In-Reply-To: <BCDA1FDAD4F49A42B7A93C11B4C46FB50430FB@HSMAILBOX02.hs.handsome.com.cn>
References: <BCDA1FDAD4F49A42B7A93C11B4C46FB50430FB@HSMAILBOX02.hs.handsome.com.cn>
Message-ID: <20111031085935.GA6187@southbank.Home>

>             {error,
>                 {{{badmatch,
>                       {error,
>                           {"/var/lib/rabbitmq/mnesia/rabbit at hscbu-tx22/msg_store_transient/0.rdq",
>                            eacces}}},

EACCES: Looks like the broker doesn't have enough permissions to that
file.  Are you starting it as the correct user? (did you, by any chance,
start it manually as root, and are now trying to run it as rabbit?)

Simple solution: if you don't have anything interesting in the broker
(configuration or messages), uninstall and reinstall.

Cheers,
Alex

On Mon, Oct 31, 2011 at 08:39:13AM +0000, ??? wrote:
> Hi,
> 
> I can?t start up rabbitmq server. Check the startup_log and find some reason. But I can?t understand it. Could anybody help me figure it out?
> 
> 
> Here is startup_log:
> 
> starting exchange, queue and binding recovery                         ...BOOT ERROR: FAILED
> Reason: {badmatch,
>             {error,
>                 {{{badmatch,
>                       {error,
>                           {"/var/lib/rabbitmq/mnesia/rabbit at hscbu-tx22/msg_store_transient/0.rdq",
>                            eacces}}},
>                   [{rabbit_msg_store,init,1},
>                    {gen_server2,init_it,6},
>                    {proc_lib,init_p_do_apply,3}]},
>                  {child,undefined,msg_store_transient,
>                      {rabbit_msg_store,start_link,
>                          [msg_store_transient,
>                           "/var/lib/rabbitmq/mnesia/rabbit at hscbu-tx22",
>                           undefined,
>                           {#Fun<rabbit_variable_queue.0.104219162>,ok}]},
>                      transient,4294967295,worker,
>                      [rabbit_msg_store]}}}}
> Stacktrace: [{rabbit_sup,start_child,3},
>              {rabbit_variable_queue,start_msg_store,2},
>              {rabbit_amqqueue,start,0},
>              {rabbit,recover,0},
>              {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
>              {rabbit,run_boot_step,1},
>              {rabbit,'-start/2-lc$^0/1-0-',1},
>              {rabbit,start,2}]
> 
> 
> Thanks,
> 
> Wright

> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From alexandru at rabbitmq.com  Mon Oct 31 09:25:38 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Mon, 31 Oct 2011 09:25:38 +0000
Subject: [rabbitmq-discuss] consumers and vhosts
In-Reply-To: <10540083.2870.1319824767560.JavaMail.geo-discussion-forums@prog16>
References: <10540083.2870.1319824767560.JavaMail.geo-discussion-forums@prog16>
Message-ID: <20111031092538.GB6187@southbank.Home>

It depends on what you mean by a consumer.  In the AMQP sense, a
consumer can only consume from one queue.  In addition, AMQP connections
are limited to one vhost each.  So you could have a single application
consuming from queues from multiple vhosts, but you'll have to start a
separate connection for each vhost, and a separate consumer for each
queue.

Also, the way you ask the question is a bit strange.  You consume from
*queues*, not from vhosts.  Vhosts are, practically, namespaces.  So,
you declare queues/exchanges/bindings in them, and you set user
permissions for them, but you don't consume from them.

Does this answer your question?

Cheers,
Alex

On Fri, Oct 28, 2011 at 10:59:27AM -0700, Chris Chiappone wrote:
> I am new to rabbitmq and was wondering if there is any way for a certain 
> consumer to consume all messages from multiple vhosts?
> 
> thanks.

> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From hanxu at x6game.cn  Mon Oct 31 09:58:18 2011
From: hanxu at x6game.cn (=?gb18030?B?uqvQ8Q==?=)
Date: Mon, 31 Oct 2011 17:58:18 +0800
Subject: [rabbitmq-discuss] some simple questions about rabbitmq server
Message-ID: <tencent_539E192F69103E005E55EB19@qq.com>

1.As we know, a cluster may have two types of node:ram and disc. When I have only one broker and one node, what is the type of this node? ram or disk?  I type cluster_status command at the terminal:


[root at test ~]# rabbitmqctl cluster_status
Cluster status of node rabbit at test ...
[{nodes,[{disc,[rabbit at test]}]},{running_nodes,[rabbit at test]}]
...done.



it shows that the node is "disc". so, is it means that the only one node has the type of 'disc'?Can it be changed to 'ram'?if yes,how?


2.If a rabbitmq cluster has a number of nodes, such as test1 at test, test2 at test, test3 at test...so how can i visit the cluster by java client api?
i know  the way to connect a broker by method "setHost(String host)".if I need to connect to a cluster,i just use this method and set the argument to the ip address of one node in the cluster, is it ok? If not ,any other solutions?




Thanks everyone.I am just a beginner for rabbitmq and i want to learn more.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111031/5686b8a4/attachment.htm>

From simon at rabbitmq.com  Mon Oct 31 11:07:39 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 31 Oct 2011 11:07:39 +0000
Subject: [rabbitmq-discuss] some simple questions about rabbitmq server
In-Reply-To: <tencent_539E192F69103E005E55EB19@qq.com>
References: <tencent_539E192F69103E005E55EB19@qq.com>
Message-ID: <4EAE817B.7080701@rabbitmq.com>

On 31/10/11 09:58, ?? wrote:
> 1.As we know, a cluster may have two types of node:ram and disc. When I
> have only one broker and one node, what is the type of this node? ram or
> disk?

Disc.

> I type cluster_status command at the terminal:
>
> [root at test ~]# rabbitmqctl cluster_status
> Cluster status of node rabbit at test ...
> [{nodes,[{disc,[rabbit at test]}]},{running_nodes,[rabbit at test]}]
> ...done.
>
> it shows that the node is "disc". so, is it means that the only one node
> has the type of 'disc'?Can it be changed to 'ram'?if yes,how?

You can't convert a single node directly to a ram node, since that's 
unlikely to be what most people want - shut down the node and you've 
lost everything. You could probably do this by creating a cluster with 
one disc and one ram node, then removing the disc node.

> 2.If a rabbitmq cluster has a number of nodes, such as test1 at test,
> test2 at test, test3 at test...so how can i visit the cluster by java client api?
> i know the way to connect a broker by method "setHost(String host)".if I
> need to connect to a cluster,i just use this method and set the argument
> to the ip address of one node in the cluster, is it ok? If not ,any
> other solutions?

Yes, you can connect to any node in the cluster.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Mon Oct 31 11:12:52 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 31 Oct 2011 11:12:52 +0000
Subject: [rabbitmq-discuss] Problem with RAM
In-Reply-To: <32287654.406.1320037421256.JavaMail.geo-discussion-forums@yqbl36>
References: <32287654.406.1320037421256.JavaMail.geo-discussion-forums@yqbl36>
Message-ID: <4EAE82B4.9010202@rabbitmq.com>

On 31/10/11 05:03, Cheremukhin Andrey wrote:
> Is it normal case? Why do rabbitmq use more memory than limit?

Yes. When the memory alarm goes off, we just start exerting TCP 
backpressure on producers. This is usually enough to start reducing the 
memory used, but it can take a while to propagate and other things than 
publishing messages can increase use memory anyway.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Mon Oct 31 11:42:50 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 31 Oct 2011 11:42:50 +0000
Subject: [rabbitmq-discuss] New to RabbitMq questions
In-Reply-To: <26746218.2946.1319831154087.JavaMail.geo-discussion-forums@prog16>
References: <26746218.2946.1319831154087.JavaMail.geo-discussion-forums@prog16>
Message-ID: <4EAE89BA.3070508@rabbitmq.com>

On 28/10/11 20:45, Chris Chiappone wrote:
> I am trying to decide if rabbitmq is something that would fit well in
> our architecture. I have a question on what is the best way to
> approach/design should be used if I wanted to be able to consume
> messages from multiple clients.
>
> My use case is basically:
>
> Unlimited number of clients that can publish and subscribe to messages
> to their own queues or exchanges.
>
> An admin client that can subscribe or publish on to any queue or exchange.
> The admin client would always be connected. I realize that a client can
> have access to any queue or exchange but I want to be able to
> dynamically bind to new exchanges/queues as they are added by other
> users so I can receive all messages.
>
> Is there a good way to do this?

The problem with having your admin user subscribe to everything in the 
general case is how it should know that a new exchange has appeared. 
There are some solutions to this but then you have a race between the 
exchange being declared and the admin user binding to it.

Of course, depending on your topology this may not be a problem - there 
may be a fixed set of exchanges for example.

If this *is* a problem then maybe the firehose could be what you're 
looking for:

http://www.rabbitmq.com/firehose.html

although your admin app would have to unpack the messages it produces 
slightly.

Cheers, Simon
-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Mon Oct 31 12:15:07 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 31 Oct 2011 12:15:07 +0000
Subject: [rabbitmq-discuss] Prevent queue flooding
In-Reply-To: <CAKhN_m7-V8MFCo-beZe7zkc4PwuMo-is68UPV6L+7a_NTNMfjg@mail.gmail.com>
References: <CAKhN_m7-V8MFCo-beZe7zkc4PwuMo-is68UPV6L+7a_NTNMfjg@mail.gmail.com>
Message-ID: <4EAE914B.2090206@rabbitmq.com>

Hi Bill,

On 30/10/11 05:55, Bill Moseley wrote:
> My plan was to use Memcached to track submission rates per customer and
> when they exceed some rate publish their jobs to a secondary (low
> priority) queue.  Then assign fewer workers to the low priority queue.

Another possible approach is to publish all jobs for each customer to
their own queue. This gives you the opportunity to allocate resources
more fairly, but it does entail a bit more complexity. You will still
need to publish job notifications in a master jobs queue, to enable
workers to find the customer-specific queues.

> Second, when the web app queues a message (to process some "backend"
> job) the web app sets a "pending" state in the database.  What normally
> happens is one worker processes the job, then this worker sends a new
> message that a second worker picks up and completes the job on the web
> app side.  In the most simple case "completing" the job means the state
> in the database is changed from "pending" to "complete".
> 
> Is this a common use pattern?

I'm not sure how common that is, because it sounds very specific to the
needs of your application.

> My question is how to handle failures and detect stale jobs.  For
> example, what if the first worker dies and never sends the completed (or
> failed) message to the second worker?  The database is then left
> indicating "pending".   I would tend to use cron for this. That is, have
> cron look for old "pending" states and either re-queue the request or
> mark it as failed (say after a few failed retry attempts).
> 
> Are there other approaches I should consider?

You could use acknowledgements. Workers should only acknowledge a job
once it is complete. If the worker fails before completion and drops the
connection to the broker then unacknowledged messages will be requeued
for other workers to pick up.



-Emile

From emile at rabbitmq.com  Mon Oct 31 12:31:31 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 31 Oct 2011 12:31:31 +0000
Subject: [rabbitmq-discuss] Big backlogs
In-Reply-To: <CAAN_EDoezdr=RydpEgWovK=amncU8pMvH-Qfq-=2Waw7jyrH8Q@mail.gmail.com>
References: <CAAN_EDoezdr=RydpEgWovK=amncU8pMvH-Qfq-=2Waw7jyrH8Q@mail.gmail.com>
Message-ID: <4EAE9523.10603@rabbitmq.com>

Hi Adam,

On 29/10/11 03:04, Adam Rabung wrote:
> Hello,
> I have come to understand that a happy Rabbit is a nearly-empty Rabbit.
>  Obviously, no matter how you lay things out, the publish rate will
> outpace the consumption rate, sometimes for sustained periods of time.

If that was always true then it would not be possible for a queue to
ever get shorter. In the general case it should be possible for
consumers to catch up with producers.

> Another approach would be to re-route backlogs to a "throttling
> consumer".  This consumer quickly drains the queue, storing messages to
> a durable store.  At a prescribed rate, it pulls these messages out in
> FIFO order and feeds them back in to the general queue.  In general, it
> seems useful in many cases to move time-insensitive messages aside
> temporarily when resources are tight.  

Rabbit internally allocates RAM in a way that favours fast moving
queues, and is more likely to place messages from slow moving queues on
disk. Your description sounds somewhat similar.

> My question is: would another RabbitMQ broker be appropriate "durable
> store" for storing these throttled messages?  We can assume there will
> be far too many message to store in memory.  I realize Rabbit will page
> large queues off to Mnesia, but will it perform reasonably if only 10%
> of messages can be stored in memory?  1%?  While this is a FIFO
> structure, it seems to have many characteristics that are different from
> a typical queue: very large footprint, very low throughput, very few
> consumers.

If you have distinct streams of messages that have different
requirements and characteristics then you should consider using
different brokers. From your description some messages are
time-insensitive. If you want to provide better guarantees that
time-sensitive messages are processed quickly then you should consider a
dedicated broker with adequate RAM.


-Emile

From shenyute at gmail.com  Mon Oct 31 12:34:04 2011
From: shenyute at gmail.com (Yu-Teh Shen)
Date: Mon, 31 Oct 2011 20:34:04 +0800
Subject: [rabbitmq-discuss] RabbitMQ network issue (IP change) on cluster
In-Reply-To: <20111030072933.GA7731@rabbitmq.com>
References: <CABWH_X6DNiw=zXQw4NvLHdr1-qu6jnuLssQ6jSWvpa97BMFVwg@mail.gmail.com>
	<20111030072933.GA7731@rabbitmq.com>
Message-ID: <CABWH_X6Sk5+zBfTfR+XLtq-_g3B73izzun8s8LBN9uX77rqO-Q@mail.gmail.com>

Hello Matthew.

I got the following log after I restart three machines in cluster.

=ERROR REPORT==== 31-Oct-2011::20:26:36 ===
Mnesia(rabbit at lab002): ** ERROR ** mnesia_event got {inconsistent_database,
starting_partitioned_network, rabbit at lab001}

=ERROR REPORT==== 31-Oct-2011::20:26:36 ===
Mnesia(rabbit at lab002): ** ERROR ** mnesia_event got {inconsistent_database,
starting_partitioned_network, rabbit at lab003}

And this make each node in the cluster can only see itself.

I need to restart one node to make the cluster back to normal state.

Thanks

Shen, Yu-Teh


On Sun, Oct 30, 2011 at 3:29 PM, Matthew Sackman <matthew at rabbitmq.com>wrote:

> On Sun, Oct 30, 2011 at 11:26:56AM +0800, Yu-Teh Shen wrote:
> > Is the cause that the erlang VM can not detect the ip change on nodes
> when
> > running?
>
> Hmm, not sure, but very possible. Once the IP has changed and you've
> restarted the network, try finding epmd, killing it, and restarting that
> too. That might help.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111031/3561faea/attachment.htm>

From stammailbox at gmail.com  Mon Oct 31 12:51:56 2011
From: stammailbox at gmail.com (Mysurf Mail)
Date: Mon, 31 Oct 2011 12:51:56 +0000
Subject: [rabbitmq-discuss] JSonRPC Encoding
Message-ID: <CAJ2-VrnCX-4RmUY_aQLEZdwSfwy4AExAjVVR_x6UFnc9+4Ee6A@mail.gmail.com>

Hi,
I have asked this before but I couldnt solve my problem . So I will try
once more.
On JSonRPC  -
It seems that when I send a hebrew strings with rabbitmq - I get squares
instead of strings in the other side.
It is not the way when I send it with regular publishing.

I send a String .
It is the Json of an object.
In the client - I see hebrew.
In the first method of the server Side  I see Squares instead of hebrew
letters..
both clients are on the same computer.

in the answer once given to me here -

if you are seeing differences then the problem is
probably in your encoding or decoding process.


My Question:
Can I control the encoding when I use JSON RPC?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111031/0ec281c2/attachment.htm>

From emile at rabbitmq.com  Mon Oct 31 13:16:58 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 31 Oct 2011 13:16:58 +0000
Subject: [rabbitmq-discuss] JSonRPC Encoding
In-Reply-To: <CAJ2-VrnCX-4RmUY_aQLEZdwSfwy4AExAjVVR_x6UFnc9+4Ee6A@mail.gmail.com>
References: <CAJ2-VrnCX-4RmUY_aQLEZdwSfwy4AExAjVVR_x6UFnc9+4Ee6A@mail.gmail.com>
Message-ID: <4EAE9FCA.6030408@rabbitmq.com>

Hi,

On 31/10/11 12:51, Mysurf Mail wrote:
> Hi, 
> I have asked this before but I couldnt solve my problem . So I will try
> once more. 
> On JSonRPC  - 
> It seems that when I send a hebrew strings with rabbitmq - I get squares
> instead of strings in the other side. 
> It is not the way when I send it with regular publishing. 

This was the previous reply to the question:

---
Rabbit treats the message body as an opaque blob of bytes. This remains
true regardless of whether you use RPC. The message won't be modified by
the broker, so if you are seeing differences then the problem is
probably in your encoding or decoding process.
---

This information is still correct. I've just performed a short test with
JSonRPC, confirming that the payload is not modified, preserving Hebrew
characters.


-Emile

From stammailbox at gmail.com  Mon Oct 31 13:19:39 2011
From: stammailbox at gmail.com (Mysurf Mail)
Date: Mon, 31 Oct 2011 13:19:39 +0000
Subject: [rabbitmq-discuss] JSonRPC Encoding
In-Reply-To: <4EAE9FCA.6030408@rabbitmq.com>
References: <CAJ2-VrnCX-4RmUY_aQLEZdwSfwy4AExAjVVR_x6UFnc9+4Ee6A@mail.gmail.com>
	<4EAE9FCA.6030408@rabbitmq.com>
Message-ID: <CAJ2-VrmtVxpg7qVag+eycYJg4bgfFO=x0F+N_ToEZ=JH8Te7GA@mail.gmail.com>

Thanks for the answer.
Any suggestions how  should I  do some further  investigations?
Thank you

On Mon, Oct 31, 2011 at 1:16 PM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi,
>
> On 31/10/11 12:51, Mysurf Mail wrote:
> > Hi,
> > I have asked this before but I couldnt solve my problem . So I will try
> > once more.
> > On JSonRPC  -
> > It seems that when I send a hebrew strings with rabbitmq - I get squares
> > instead of strings in the other side.
> > It is not the way when I send it with regular publishing.
>
> This was the previous reply to the question:
>
> ---
> Rabbit treats the message body as an opaque blob of bytes. This remains
> true regardless of whether you use RPC. The message won't be modified by
> the broker, so if you are seeing differences then the problem is
> probably in your encoding or decoding process.
> ---
>
> This information is still correct. I've just performed a short test with
> JSonRPC, confirming that the payload is not modified, preserving Hebrew
> characters.
>
>
> -Emile
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111031/7ef4c024/attachment.htm>

From pkelly at gmail.com  Mon Oct 31 13:20:13 2011
From: pkelly at gmail.com (Pete Kelly)
Date: Mon, 31 Oct 2011 13:20:13 +0000
Subject: [rabbitmq-discuss] Clustering RabbitMQ between Datacentres
Message-ID: <CAEWH9M_mK2Wkpu_P826=fLAgqr0UbHP_N6X16BMPmzN7yah+xA@mail.gmail.com>

Hi

We are looking at clustering our RabbitMQ setup at the moment - however we
are looking to do it across 2 data centres, one in Europe and one in the
USA. There is a VPN between the 2 DC's so packets can be routed between the
2 networks directly over the VPN.

Is this a good idea, or would it be classed as one of the "WAN" scenarios
which is warned against in the Clustering guide?

If it's is a good idea, great! However if not, we will look into having
clusters at each end with mod shovel or take another approach.

Are there any further docs or explanations anyone can point me to to
describe the specific problems RabbitMQ has over a "WAN" ?

Thanks

Pete
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111031/3d38b8b2/attachment.htm>

From simon at rabbitmq.com  Mon Oct 31 13:26:28 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 31 Oct 2011 13:26:28 +0000
Subject: [rabbitmq-discuss] Clustering RabbitMQ between Datacentres
In-Reply-To: <CAEWH9M_mK2Wkpu_P826=fLAgqr0UbHP_N6X16BMPmzN7yah+xA@mail.gmail.com>
References: <CAEWH9M_mK2Wkpu_P826=fLAgqr0UbHP_N6X16BMPmzN7yah+xA@mail.gmail.com>
Message-ID: <4EAEA204.6060003@rabbitmq.com>

On 31/10/11 13:20, Pete Kelly wrote:
> We are looking at clustering our RabbitMQ setup at the moment - however
> we are looking to do it across 2 data centres, one in Europe and one in
> the USA. There is a VPN between the 2 DC's so packets can be routed
> between the 2 networks directly over the VPN.
>
> Is this a good idea, or would it be classed as one of the "WAN"
> scenarios which is warned against in the Clustering guide?

No and yes, unfortunately.

> If it's is a good idea, great! However if not, we will look into having
> clusters at each end with mod shovel or take another approach.

Another approach would be the federation plugin.

> Are there any further docs or explanations anyone can point me to to
> describe the specific problems RabbitMQ has over a "WAN" ?

It's discussed a bit in this blog post:

http://www.rabbitmq.com/blog/2011/06/22/federation-plugin-preview-release/

but the short version is that its the CAP theorem. RabbitMQ clustering 
chooses Consistency and Availability and thus loses Partition Tolerance 
- which doesn't work out so well if the links between nodes can go down.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Mon Oct 31 13:32:50 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 31 Oct 2011 13:32:50 +0000
Subject: [rabbitmq-discuss] JSonRPC Encoding
In-Reply-To: <CAJ2-VrmtVxpg7qVag+eycYJg4bgfFO=x0F+N_ToEZ=JH8Te7GA@mail.gmail.com>
References: <CAJ2-VrnCX-4RmUY_aQLEZdwSfwy4AExAjVVR_x6UFnc9+4Ee6A@mail.gmail.com>	<4EAE9FCA.6030408@rabbitmq.com>
	<CAJ2-VrmtVxpg7qVag+eycYJg4bgfFO=x0F+N_ToEZ=JH8Te7GA@mail.gmail.com>
Message-ID: <4EAEA382.30506@rabbitmq.com>

Hi,

On 31/10/11 13:19, Mysurf Mail wrote:
> Thanks for the answer.
> Any suggestions how  should I  do some further  investigations?
> Thank you  

I seem to recall that you were using a different JSON library than the
one provided in the com.rabbitmq.tools.json namespace. If that is the
case then you should check the documentation of your library. RFC4627
supports any Unicode encoding, defaulting to UTF-8.

If you are using the default JSON code in com.rabbitmq.tools.json
namespace then you only have the option of using UTF-8. JsonRpcServer is
based on StringRpcServer which only supports UTF-8.


-Emile


From stammailbox at gmail.com  Mon Oct 31 13:46:38 2011
From: stammailbox at gmail.com (Mysurf Mail)
Date: Mon, 31 Oct 2011 13:46:38 +0000
Subject: [rabbitmq-discuss] JSonRPC Encoding
In-Reply-To: <4EAEA382.30506@rabbitmq.com>
References: <CAJ2-VrnCX-4RmUY_aQLEZdwSfwy4AExAjVVR_x6UFnc9+4Ee6A@mail.gmail.com>
	<4EAE9FCA.6030408@rabbitmq.com>
	<CAJ2-VrmtVxpg7qVag+eycYJg4bgfFO=x0F+N_ToEZ=JH8Te7GA@mail.gmail.com>
	<4EAEA382.30506@rabbitmq.com>
Message-ID: <CAJ2-Vr=bc1FS=c_7WEnwxsbEi1yv5PZawqOpbT99iQf0GYp+ZQ@mail.gmail.com>

Hi,
Thanks.
I am using Gson (google).

When I Gson in the client side - it passes to a correct json string .
then I send it through the interface of jsomRpc Client server and in the
server side the string is with squares.

gsoning alone works fine in the client side.
Again,
thank you for your time.

On Mon, Oct 31, 2011 at 1:32 PM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi,
>
> On 31/10/11 13:19, Mysurf Mail wrote:
> > Thanks for the answer.
> > Any suggestions how  should I  do some further  investigations?
> > Thank you
>
> I seem to recall that you were using a different JSON library than the
> one provided in the com.rabbitmq.tools.json namespace. If that is the
> case then you should check the documentation of your library. RFC4627
> supports any Unicode encoding, defaulting to UTF-8.
>
> If you are using the default JSON code in com.rabbitmq.tools.json
> namespace then you only have the option of using UTF-8. JsonRpcServer is
> based on StringRpcServer which only supports UTF-8.
>
>
> -Emile
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111031/8e2696e3/attachment.htm>

From pkelly at gmail.com  Mon Oct 31 13:53:19 2011
From: pkelly at gmail.com (Pete Kelly)
Date: Mon, 31 Oct 2011 13:53:19 +0000
Subject: [rabbitmq-discuss] Clustering RabbitMQ between Datacentres
In-Reply-To: <4EAEA204.6060003@rabbitmq.com>
References: <CAEWH9M_mK2Wkpu_P826=fLAgqr0UbHP_N6X16BMPmzN7yah+xA@mail.gmail.com>
	<4EAEA204.6060003@rabbitmq.com>
Message-ID: <CAEWH9M8W3RLBj0DQBXAC0Urk=7s_fT8CY6Q6+Q0vnjYi2pyO=A@mail.gmail.com>

On 31 October 2011 13:26, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 31/10/11 13:20, Pete Kelly wrote:
>
>> We are looking at clustering our RabbitMQ setup at the moment - however
>> we are looking to do it across 2 data centres, one in Europe and one in
>> the USA. There is a VPN between the 2 DC's so packets can be routed
>> between the 2 networks directly over the VPN.
>>
>> Is this a good idea, or would it be classed as one of the "WAN"
>> scenarios which is warned against in the Clustering guide?
>>
>
> No and yes, unfortunately.
>
>
>  If it's is a good idea, great! However if not, we will look into having
>> clusters at each end with mod shovel or take another approach.
>>
>
> Another approach would be the federation plugin.


Thanks, it mentions federation is incompatible with clusters at release 2.5
(I assume), is this still the case?


>
>
>  Are there any further docs or explanations anyone can point me to to
>> describe the specific problems RabbitMQ has over a "WAN" ?
>>
>
> It's discussed a bit in this blog post:
>
> http://www.rabbitmq.com/blog/**2011/06/22/federation-plugin-**
> preview-release/<http://www.rabbitmq.com/blog/2011/06/22/federation-plugin-preview-release/>
>
> but the short version is that its the CAP theorem. RabbitMQ clustering
> chooses Consistency and Availability and thus loses Partition Tolerance -
> which doesn't work out so well if the links between nodes can go down.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111031/8098816d/attachment.htm>

From simon at rabbitmq.com  Mon Oct 31 13:54:24 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 31 Oct 2011 13:54:24 +0000
Subject: [rabbitmq-discuss] Clustering RabbitMQ between Datacentres
In-Reply-To: <CAEWH9M8W3RLBj0DQBXAC0Urk=7s_fT8CY6Q6+Q0vnjYi2pyO=A@mail.gmail.com>
References: <CAEWH9M_mK2Wkpu_P826=fLAgqr0UbHP_N6X16BMPmzN7yah+xA@mail.gmail.com>	<4EAEA204.6060003@rabbitmq.com>
	<CAEWH9M8W3RLBj0DQBXAC0Urk=7s_fT8CY6Q6+Q0vnjYi2pyO=A@mail.gmail.com>
Message-ID: <4EAEA890.9050605@rabbitmq.com>

On 31/10/11 13:53, Pete Kelly wrote:
 > Thanks, it mentions federation is incompatible with clusters at release
> 2.5 (I assume), is this still the case?

It's fixed in 2.6.0.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From pkelly at gmail.com  Mon Oct 31 14:02:32 2011
From: pkelly at gmail.com (Pete Kelly)
Date: Mon, 31 Oct 2011 14:02:32 +0000
Subject: [rabbitmq-discuss] Clustering RabbitMQ between Datacentres
In-Reply-To: <4EAEA890.9050605@rabbitmq.com>
References: <CAEWH9M_mK2Wkpu_P826=fLAgqr0UbHP_N6X16BMPmzN7yah+xA@mail.gmail.com>
	<4EAEA204.6060003@rabbitmq.com>
	<CAEWH9M8W3RLBj0DQBXAC0Urk=7s_fT8CY6Q6+Q0vnjYi2pyO=A@mail.gmail.com>
	<4EAEA890.9050605@rabbitmq.com>
Message-ID: <CAEWH9M-hHVJvx94FM5LELH1TdnY_Y_0_+pO0zYwOadOr+HsR2g@mail.gmail.com>

On 31 October 2011 13:54, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 31/10/11 13:53, Pete Kelly wrote:
> > Thanks, it mentions federation is incompatible with clusters at release
>
>> 2.5 (I assume), is this still the case?
>>
>
> It's fixed in 2.6.0.


Cool, so a simple scenario could be:

Cluster A (USA) <------> Cluster B (Europe)

which would allow systems in the USA to publish to Cluster A, and systems
in Europe to publish to Cluster B.

Cluster A then federates its messages to Cluster B, which is where all the
subscribers/consumers live.

So essentially it's a reliable way to allow the USA to publish messages to
RabbitMQ whilst still allowing Europe to subscribe to and consume the
messages.

Can it work bi-directionally too? So Europe could federate to the USA too
(for the same exchange)? That way we could potentially do it without the
cluster at each end.


>
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111031/4a5817e2/attachment.htm>

From simon at rabbitmq.com  Mon Oct 31 14:05:54 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 31 Oct 2011 14:05:54 +0000
Subject: [rabbitmq-discuss] Clustering RabbitMQ between Datacentres
In-Reply-To: <CAEWH9M-hHVJvx94FM5LELH1TdnY_Y_0_+pO0zYwOadOr+HsR2g@mail.gmail.com>
References: <CAEWH9M_mK2Wkpu_P826=fLAgqr0UbHP_N6X16BMPmzN7yah+xA@mail.gmail.com>	<4EAEA204.6060003@rabbitmq.com>	<CAEWH9M8W3RLBj0DQBXAC0Urk=7s_fT8CY6Q6+Q0vnjYi2pyO=A@mail.gmail.com>	<4EAEA890.9050605@rabbitmq.com>
	<CAEWH9M-hHVJvx94FM5LELH1TdnY_Y_0_+pO0zYwOadOr+HsR2g@mail.gmail.com>
Message-ID: <4EAEAB42.70800@rabbitmq.com>

On 31/10/11 14:02, Pete Kelly wrote:
> Can it work bi-directionally too? So Europe could federate to the USA
> too (for the same exchange)? That way we could potentially do it without
> the cluster at each end.

Yes, the links are unidirectional but you can set up EU -> US and US -> 
EU links without messages looping (by default federated messages will 
only travel one hop).

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From pkelly at gmail.com  Mon Oct 31 14:25:46 2011
From: pkelly at gmail.com (Pete Kelly)
Date: Mon, 31 Oct 2011 14:25:46 +0000
Subject: [rabbitmq-discuss] Clustering RabbitMQ between Datacentres
In-Reply-To: <4EAEAB42.70800@rabbitmq.com>
References: <CAEWH9M_mK2Wkpu_P826=fLAgqr0UbHP_N6X16BMPmzN7yah+xA@mail.gmail.com>
	<4EAEA204.6060003@rabbitmq.com>
	<CAEWH9M8W3RLBj0DQBXAC0Urk=7s_fT8CY6Q6+Q0vnjYi2pyO=A@mail.gmail.com>
	<4EAEA890.9050605@rabbitmq.com>
	<CAEWH9M-hHVJvx94FM5LELH1TdnY_Y_0_+pO0zYwOadOr+HsR2g@mail.gmail.com>
	<4EAEAB42.70800@rabbitmq.com>
Message-ID: <CAEWH9M_41NK28QBkk=iL4nt8PM0mb5TkuYuO6_OanvDxN2wNcw@mail.gmail.com>

On 31 October 2011 14:05, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 31/10/11 14:02, Pete Kelly wrote:
>
>> Can it work bi-directionally too? So Europe could federate to the USA
>> too (for the same exchange)? That way we could potentially do it without
>> the cluster at each end.
>>
>
> Yes, the links are unidirectional but you can set up EU -> US and US -> EU
> links without messages looping (by default federated messages will only
> travel one hop).


Brilliant, thanks very much for your help

btw, have you noticed the rabbitmq module for opensips now:

http://lists.opensips.org/pipermail/news/2011-October/000155.html


>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111031/06b53956/attachment.htm>

From meem.ok at gmail.com  Mon Oct 31 14:31:26 2011
From: meem.ok at gmail.com (michael neidhardt)
Date: Mon, 31 Oct 2011 07:31:26 -0700 (PDT)
Subject: [rabbitmq-discuss] Queue depth and no. of consumers.
In-Reply-To: <4EAAC1E3.1010204@rabbitmq.com>
References: <10f27f82-2e92-4758-bf60-f4755bc9e817@1g2000vbx.googlegroups.com>
	<4EAAC1E3.1010204@rabbitmq.com>
Message-ID: <4f057906-233b-4748-8a1d-610b1a2fb932@g21g2000yqc.googlegroups.com>

Hi and thanks for the quick reply.

I do use ack, but not QoS. My program is as follows, using Perl and
Net::RabbitMQ:

-----------------------
my ($exchange, $queue, $routing_key) = ('myx', 'isi', 'isi');
my $mq = Net::RabbitMQ->new();
my $channel = 1;
$mq->connect($mqhost, { user => "guest", password => "guest" });
$mq->channel_open($channel);
$mq->exchange_declare( $channel, $exchange, { exchange_type =>
'direct',
                                              auto_delete => 0,
                                              durable => 0});

$mq->queue_declare( $channel, $queue, { auto_delete => 0, durable =>
0});
$mq->queue_bind( $channel, $queue, $exchange, $routing_key);
$mq->consume($channel, $queue, { no_ack => 0 } );

while (1) {
    my $msg = $mq->recv();

    handle_file($msg->{body});
    $mq->ack($channel, $msg->{delivery_tag});
}
-----------------------

With no QoS set, I assume each consumer fetches as many messages as
possible (whatever that means),
and 'queues' them itself. I will try to set QoS/prefetch_count to 1,
though I seem to remember
having read that this can cause trouble. I would assume that it would
be no problem, have you got any thoughts on whether it's a good idea?

As I wrote earlier, we have a number (several thousand) of files to
process, each of which may contain up to several hundred thousand
records (around 2KB each).

In an earlier test, I let the processes handling files push the ID of
each record to a queue.
(Simply add a publish to the above code after the ack). The consumer
for this queue (which uses autoack) would do a lookup in a Postgresql
DB, and nothing else.
After about 50 million records, the vm_memory_high_watermark would be
set, and shortly after
that, I got <"timeout waiting for channel.flow_ok{active=false}",none}
>. Eventually the whole system froze.
I guess this timeout is caused by my client not reacting to the flow
control from the RabbitMQ server. Is that correct? Unfortunately, the
client I use does not have methods for that. Should I expect to handle
this in normal operation, or could it be handled by a client for me?

Oh, and the big question: Is it out of the question to handle approx.
300 mill. messages (where payload is essentially a bigint) over a few
days?

Regards,
Michael.

From james.r.carr at gmail.com  Mon Oct 31 14:31:29 2011
From: james.r.carr at gmail.com (James Carr)
Date: Mon, 31 Oct 2011 09:31:29 -0500
Subject: [rabbitmq-discuss] Visio Stencils (or whatever else)?
Message-ID: <CAJreXKAYB2j2mDj+w7-imv+8U6KGMsY881BBnB_5XU8Hv5-BFA@mail.gmail.com>

I really like the illustrations used for queues and exchanges on the
rabbitMQ site (http://www.rabbitmq.com/getstarted.html). Is there a
visio stencil (or something similar) I could use?



Thanks,
James

From james.r.carr at gmail.com  Mon Oct 31 14:32:03 2011
From: james.r.carr at gmail.com (James Carr)
Date: Mon, 31 Oct 2011 09:32:03 -0500
Subject: [rabbitmq-discuss] Visio Stencils (or whatever else)?
In-Reply-To: <CAJreXKAYB2j2mDj+w7-imv+8U6KGMsY881BBnB_5XU8Hv5-BFA@mail.gmail.com>
References: <CAJreXKAYB2j2mDj+w7-imv+8U6KGMsY881BBnB_5XU8Hv5-BFA@mail.gmail.com>
Message-ID: <CAJreXKDtCEPWLtBoe1AjQ2Bf_z6HpLjf++Et9AWsOsb1Skav_g@mail.gmail.com>

nevermind. As soon as I asked, I found it.
http://www.joshdevins.net/2010/04/20/amqp-graffle-stencil/

On Mon, Oct 31, 2011 at 9:31 AM, James Carr <james.r.carr at gmail.com> wrote:
> I really like the illustrations used for queues and exchanges on the
> rabbitMQ site (http://www.rabbitmq.com/getstarted.html). Is there a
> visio stencil (or something similar) I could use?
>
>
>
> Thanks,
> James
>

From chiappone at gmail.com  Mon Oct 31 16:00:13 2011
From: chiappone at gmail.com (Chris Chiappone)
Date: Mon, 31 Oct 2011 09:00:13 -0700 (PDT)
Subject: [rabbitmq-discuss] New to RabbitMq questions
In-Reply-To: <4EAE89BA.3070508@rabbitmq.com>
References: <26746218.2946.1319831154087.JavaMail.geo-discussion-forums@prog16>
	<4EAE89BA.3070508@rabbitmq.com>
Message-ID: <14478903.984.1320076813625.JavaMail.geo-discussion-forums@prgt40>

I had figured that could be the case.  I don't think firehose is probably 
the answer for us since I don't want to worry about performance issues.  I 
think we can set up exchanges for clients and bind to them before they even 
connect so that may be the way to go.  Is there limits to the number of 
exchanges a client can bind to?  

thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111031/abd2f9a3/attachment.htm>

From simon at rabbitmq.com  Mon Oct 31 16:13:09 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 31 Oct 2011 16:13:09 +0000
Subject: [rabbitmq-discuss] New to RabbitMq questions
In-Reply-To: <14478903.984.1320076813625.JavaMail.geo-discussion-forums@prgt40>
References: <26746218.2946.1319831154087.JavaMail.geo-discussion-forums@prog16>	<4EAE89BA.3070508@rabbitmq.com>
	<14478903.984.1320076813625.JavaMail.geo-discussion-forums@prgt40>
Message-ID: <4EAEC915.1080405@rabbitmq.com>

On 31/10/11 16:00, Chris Chiappone wrote:
> I had figured that could be the case. I don't think firehose is probably
> the answer for us since I don't want to worry about performance issues.

Hmm, that warning is perhaps rather strongly worded...

> I think we can set up exchanges for clients and bind to them before they
> even connect so that may be the way to go. Is there limits to the number
> of exchanges a client can bind to?

Well, queues bind to exchanges. But there's no hard limit on that.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From majek04 at gmail.com  Mon Oct 31 16:23:31 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Mon, 31 Oct 2011 16:23:31 +0000
Subject: [rabbitmq-discuss] Visio Stencils (or whatever else)?
In-Reply-To: <CAJreXKDtCEPWLtBoe1AjQ2Bf_z6HpLjf++Et9AWsOsb1Skav_g@mail.gmail.com>
References: <CAJreXKAYB2j2mDj+w7-imv+8U6KGMsY881BBnB_5XU8Hv5-BFA@mail.gmail.com>
	<CAJreXKDtCEPWLtBoe1AjQ2Bf_z6HpLjf++Et9AWsOsb1Skav_g@mail.gmail.com>
Message-ID: <CABzX+qyaG8H-xn3AxU7m+Zbj1fMgvqfkscCQxT6MOk26jzAE=A@mail.gmail.com>

Diagrams for rabbitmq tutorials, often referenced as ugly, are
in fact generated by dot/graphviz.

Peek at the html source to see relevant code, for example:
     <div class="diagram_source">
     digraph {
       bgcolor=transparent;
       truecolor=true;
       rankdir=LR;
       node [style="filled"];
       //
       P1 [label="P", fillcolor="#00ffff"];
     }
     </div>



On Mon, Oct 31, 2011 at 14:32, James Carr <james.r.carr at gmail.com> wrote:
> nevermind. As soon as I asked, I found it.
> http://www.joshdevins.net/2010/04/20/amqp-graffle-stencil/
>
> On Mon, Oct 31, 2011 at 9:31 AM, James Carr <james.r.carr at gmail.com> wrote:
>> I really like the illustrations used for queues and exchanges on the
>> rabbitMQ site (http://www.rabbitmq.com/getstarted.html). Is there a
>> visio stencil (or something similar) I could use?
>>
>>
>>
>> Thanks,
>> James
>>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From simon at rabbitmq.com  Mon Oct 31 16:27:46 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 31 Oct 2011 16:27:46 +0000
Subject: [rabbitmq-discuss] Queue depth and no. of consumers.
In-Reply-To: <4f057906-233b-4748-8a1d-610b1a2fb932@g21g2000yqc.googlegroups.com>
References: <10f27f82-2e92-4758-bf60-f4755bc9e817@1g2000vbx.googlegroups.com>	<4EAAC1E3.1010204@rabbitmq.com>
	<4f057906-233b-4748-8a1d-610b1a2fb932@g21g2000yqc.googlegroups.com>
Message-ID: <4EAECC82.4060004@rabbitmq.com>

On 31/10/11 14:31, michael neidhardt wrote:
> With no QoS set, I assume each consumer fetches as many messages as
> possible (whatever that means),
> and 'queues' them itself.

Yes, although the "queueing" doesn't mean there's an explicit queue in 
the client. But messages can back up in networking buffers etc.

> I will try to set QoS/prefetch_count to 1,
> though I seem to remember
> having read that this can cause trouble. I would assume that it would
> be no problem, have you got any thoughts on whether it's a good idea?

I don't see why it should cause trouble. Setting prefetch to 1 does mean 
that throughput will drop since the broker cannot deliver another 
message until the previous one has been acknowledged, so if throughput 
is a concern then you might set the prefetch to some larger number for 
less fairness but more performance.

In general setting the prefetch count is a good idea if you're concerned 
with fair distribution of messages.

> As I wrote earlier, we have a number (several thousand) of files to
> process, each of which may contain up to several hundred thousand
> records (around 2KB each).
>
> In an earlier test, I let the processes handling files push the ID of
> each record to a queue.
> (Simply add a publish to the above code after the ack). The consumer
> for this queue (which uses autoack)

(Of course, setting prefetch doesn't do anything in noack mode since the 
server has no way to know how many messages have made it all the way to 
the client.)

> would do a lookup in a Postgresql
> DB, and nothing else.
> After about 50 million records, the vm_memory_high_watermark would be
> set, and shortly after
> that, I got<"timeout waiting for channel.flow_ok{active=false}",none}
>> . Eventually the whole system froze.
> I guess this timeout is caused by my client not reacting to the flow
> control from the RabbitMQ server. Is that correct? Unfortunately, the
> client I use does not have methods for that. Should I expect to handle
> this in normal operation, or could it be handled by a client for me?

I think you said you were using 1.8.1. Much has changed since then:

* We no longer use channel.flow to throttle producers since as you're 
seeing many clients did not implement it correctly / at all. We now use 
TCP backpressure instead.

* Prior to 2.0 all messages in all queues had to fit in memory. Messages 
are now paged to disk when memory is low.

So I would strongly advise you to upgrade to 2.6.1. It's available in 
our apt repository:

http://www.rabbitmq.com/debian.html

> Oh, and the big question: Is it out of the question to handle approx.
> 300 mill. messages (where payload is essentially a bigint) over a few
> days?

That should be no big deal. My workstation can churn through that in a 
few hours.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From james.r.carr at gmail.com  Mon Oct 31 18:21:48 2011
From: james.r.carr at gmail.com (James Carr)
Date: Mon, 31 Oct 2011 13:21:48 -0500
Subject: [rabbitmq-discuss] Visio Stencils (or whatever else)?
In-Reply-To: <CABzX+qyaG8H-xn3AxU7m+Zbj1fMgvqfkscCQxT6MOk26jzAE=A@mail.gmail.com>
References: <CAJreXKAYB2j2mDj+w7-imv+8U6KGMsY881BBnB_5XU8Hv5-BFA@mail.gmail.com>
	<CAJreXKDtCEPWLtBoe1AjQ2Bf_z6HpLjf++Et9AWsOsb1Skav_g@mail.gmail.com>
	<CABzX+qyaG8H-xn3AxU7m+Zbj1fMgvqfkscCQxT6MOk26jzAE=A@mail.gmail.com>
Message-ID: <CAJreXKCyJGxZ34KRNVRi080LF3-v_o26-JBYWBvPVjyeEkkBdA@mail.gmail.com>

Yikes.

So the ones I found were from omniGaffle, while my company has visio.
Anyone know if there are any visio shapes out there?

Thanks,
James


On Mon, Oct 31, 2011 at 11:23 AM, Marek Majkowski <majek04 at gmail.com> wrote:
> Diagrams for rabbitmq tutorials, often referenced as ugly, are
> in fact generated by dot/graphviz.
>
> Peek at the html source to see relevant code, for example:
> ? ? <div class="diagram_source">
> ? ? digraph {
> ? ? ? bgcolor=transparent;
> ? ? ? truecolor=true;
> ? ? ? rankdir=LR;
> ? ? ? node [style="filled"];
> ? ? ? //
> ? ? ? P1 [label="P", fillcolor="#00ffff"];
> ? ? }
> ? ? </div>
>
>
>
> On Mon, Oct 31, 2011 at 14:32, James Carr <james.r.carr at gmail.com> wrote:
>> nevermind. As soon as I asked, I found it.
>> http://www.joshdevins.net/2010/04/20/amqp-graffle-stencil/
>>
>> On Mon, Oct 31, 2011 at 9:31 AM, James Carr <james.r.carr at gmail.com> wrote:
>>> I really like the illustrations used for queues and exchanges on the
>>> rabbitMQ site (http://www.rabbitmq.com/getstarted.html). Is there a
>>> visio stencil (or something similar) I could use?
>>>
>>>
>>>
>>> Thanks,
>>> James
>>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>

From jerryk at vmware.com  Mon Oct 31 18:38:41 2011
From: jerryk at vmware.com (Jerry Kuch)
Date: Mon, 31 Oct 2011 11:38:41 -0700 (PDT)
Subject: [rabbitmq-discuss]
	JRUBY	java.nio.channels.UnresolvedAddressException:
In-Reply-To: <CAEBV8YR1Kd7BYBVDbAS7TENZ_uEnzB2m=uLgRdud2p1HjtFKoA@mail.gmail.com>
Message-ID: <5932b557-21a2-4121-bd1e-b780e203d379@CoachZ.local>

Hi, Paul...

Perhaps I misunderstand the snippet you've attached, but are you 
really trying to connect to "dev.rabbitmq.com?"  You might
want to try using your actual Rabbit broker, either by IP or 
by a name that actually resolves for you, in AMQP.start(...)...

Best regards,
Jerry


----- Original Message -----
From: "Paul Cowan" <dagda1 at scotalt.net>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Friday, October 28, 2011 12:00:03 AM
Subject: [rabbitmq-discuss] JRUBY	java.nio.channels.UnresolvedAddressException:


Hi, 


I am trying to start a queue consumer from JRuby 1.6.5, I have the following thor task that I want to use to start the queue: 



desc "start_consumer", "start the test consumer" 
def start_consumer 
puts "Running #{AMQP::VERSION} version of the gem" 

AMQP.start(:host => " dev.rabbitmq.com ") do |connection| 

ch = AMQP::Channel.new(connection) 

ch.queue("one", :auto_delete => true).subscribe(&method(:handle_message)) 
end 
end 


I start the rabbitmq-server with the rabbitmq-server --detachced command. 


When I run the task, it cannot connect to the host and I get the following error: 



NativeException: java.nio.channels.UnresolvedAddressException: null 
bind_connect_server at /Users/paulcowan/.rvm/gems/jruby-1.6.5/gems/eventmachine-1.0.0.beta.4-java/lib/jeventmachine.rb:136 


I can't find anything on this in google. 


Can anyone see anything obvious that I am missing? 

Cheers 

Paul Cowan 

Cutting-Edge Solutions (Scotland) 

http://thesoftwaresimpleton.com/ 


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From michael.s.klishin at gmail.com  Mon Oct 31 19:55:48 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 31 Oct 2011 22:55:48 +0300
Subject: [rabbitmq-discuss] JRUBY
	java.nio.channels.UnresolvedAddressException:
In-Reply-To: <CAEBV8YR1Kd7BYBVDbAS7TENZ_uEnzB2m=uLgRdud2p1HjtFKoA@mail.gmail.com>
References: <CAEBV8YR1Kd7BYBVDbAS7TENZ_uEnzB2m=uLgRdud2p1HjtFKoA@mail.gmail.com>
Message-ID: <CAE3HoVRK57mO3YZL-79WoNE3y-uA+BBjFH8mLN3HmL_CAeysTw@mail.gmail.com>

2011/10/28 Paul Cowan <dagda1 at scotalt.net>

> I start the rabbitmq-server with the *rabbitmq-server --detachced*command.
>

You seem to both start RabbitMQ locally and try to connect to
dev.rabbitmq.com. So which one is your intent?

I cannot tell why dev.rabbitmq.com may not resolve for you, try
setting  java.net.preferIPv4Stack
JVM option to true ( java.net.preferIPv4Stack=true).

In addition, if you use JRuby, then using HotBunnies may be a good idea.
All the concepts explained in the amqp documentation still apply and API is
that that different.

github.com/ruby-amqp/hot_bunnies
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111031/8678593e/attachment.htm>

From dgress at vmware.com  Mon Oct 31 20:41:18 2011
From: dgress at vmware.com (Dave Gress)
Date: Mon, 31 Oct 2011 13:41:18 -0700
Subject: [rabbitmq-discuss] Disconnect
Message-ID: <CAD4802E.4E7F1%dgress@vmware.com>

I have a server set up

Activating RabbitMQ plugins ...
6 plugins activated:
* amqp_client-2.6.1
* mochiweb-1.3-rmq2.6.1-git9a53dbd
* rabbitmq_management-2.6.1
* rabbitmq_management_agent-2.6.1
* rabbitmq_mochiweb-2.6.1
* webmachine-1.7.0-rmq2.6.1-hg0c4b60a



A simple java reciever on a channel

on Oct 31 11:57:41 EDT 2011 Info: Connect start Host[xxx.xxx.xxx.xxx] timeout [5000]

 [*] Waiting for messages. To exit press CTRL+C



When I try to send a message, I get a "fast" disconnect "FIN" from my send java app.

import com.rabbitmq.client.ConnectionFactory;
import com.rabbitmq.client.Connection;
import com.rabbitmq.client.Channel;
//Set up the class and name the queue:

public class Send {

  private final static String QUEUE_NAME = "hello";

  public static void main(String[] argv)
      throws java.io.IOException {

    ConnectionFactory factory = new ConnectionFactory();
    factory.setHost("xxx.xxx.xxx.xxx");
    Connection connection = factory.newConnection();
    Channel channel = connection.createChannel();


No firewall exists





From dgress at vmware.com  Mon Oct 31 20:53:33 2011
From: dgress at vmware.com (Dave Gress)
Date: Mon, 31 Oct 2011 13:53:33 -0700
Subject: [rabbitmq-discuss] Disconnect
In-Reply-To: <CAD4802E.4E7F1%dgress@vmware.com>
Message-ID: <CAD482E0.4E806%dgress@vmware.com>

bash-3.2$ cat rabbit.txt
No.     Time        Source                Destination           Protocol Info
    157 3.822646    172.31.254.6          172.16.34.11          TCP      54762 > amqp [SYN] Seq=0 Win=65535 Len=0 MSS=1204 WS=3 TSV=529697948 TSER=0 SACK_PERM=1
    158 3.822702    172.16.34.11          172.31.254.6          TCP      amqp > 54762 [SYN, ACK] Seq=0 Ack=1 Win=14480 Len=0 MSS=1460 SACK_PERM=1 TSV=120630303 TSER=529697948 WS=5
    159 3.913714    172.31.254.6          172.16.34.11          TCP      54762 > amqp [ACK] Seq=1 Ack=1 Win=524280 Len=0 TSV=529697949 TSER=120630303
    162 3.928155    172.31.254.6          172.16.34.11          AMQP
    163 3.928183    172.16.34.11          172.31.254.6          TCP      amqp > 54762 [ACK] Seq=1 Ack=9 Win=14496 Len=0 TSV=120630314 TSER=529697949
    164 3.928369    172.16.34.11          172.31.254.6          AMQP
    169 4.019260    172.31.254.6          172.16.34.11          TCP      54762 > amqp [ACK] Seq=9 Ack=336 Win=524144 Len=0 TSV=529697950 TSER=120630314
    176 4.057658    172.31.254.6          172.16.34.11          TCP      54762 > amqp [FIN, ACK] Seq=9 Ack=336 Win=524280 Len=0 TSV=529697950 TSER=120630314     <---- Immediate FIN from send app ??
    177 4.057744    172.16.34.11          172.31.254.6          TCP      amqp > 54762 [FIN, ACK] Seq=336 Ack=10 Win=14496 Len=0 TSV=120630327 TSER=529697950
    182 4.148849    172.31.254.6          172.16.34.11          TCP      54762 > amqp [ACK] Seq=10 Ack=337 Win=524280 Len=0 TSV=529697951 TSER=120630327


From: David Gress <dgress at vmware.com<mailto:dgress at vmware.com>>
Date: Mon, 31 Oct 2011 13:41:18 -0700
To: "rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>" <rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>>
Subject: [rabbitmq-discuss] Disconnect

I have a server set up

Activating RabbitMQ plugins ...
6 plugins activated:
* amqp_client-2.6.1
* mochiweb-1.3-rmq2.6.1-git9a53dbd
* rabbitmq_management-2.6.1
* rabbitmq_management_agent-2.6.1
* rabbitmq_mochiweb-2.6.1
* webmachine-1.7.0-rmq2.6.1-hg0c4b60a



A simple java reciever on a channel

on Oct 31 11:57:41 EDT 2011 Info: Connect start Host[xxx.xxx.xxx.xxx] timeout [5000]

 [*] Waiting for messages. To exit press CTRL+C



When I try to send a message, I get a "fast" disconnect "FIN" from my send java app.

import com.rabbitmq.client.ConnectionFactory;
import com.rabbitmq.client.Connection;
import com.rabbitmq.client.Channel;
//Set up the class and name the queue:

public class Send {

  private final static String QUEUE_NAME = "hello";

  public static void main(String[] argv)
      throws java.io.IOException {

    ConnectionFactory factory = new ConnectionFactory();
    factory.setHost("xxx.xxx.xxx.xxx");
    Connection connection = factory.newConnection();
    Channel channel = connection.createChannel();


No firewall exists





From dagda1 at scotalt.net  Mon Oct 31 21:21:26 2011
From: dagda1 at scotalt.net (Paul Cowan)
Date: Mon, 31 Oct 2011 21:21:26 +0000
Subject: [rabbitmq-discuss] PossibleAuthenticationFailureError
Message-ID: <CAEBV8YTbLShTU2wxjmuWBD4aRGY0fU1Q5CEyeGndnL=dACziqw@mail.gmail.com>

Hi,

I am trying to connect to my local rabbitmq-server with the following code:

          AMQP.start(:host => "localhost") do |connection|

I get the following error when I use the default parameters of
username=guest and password=guest.

Below is the full exception:

AMQP::PossibleAuthenticationFailureError: AMQP broker closed TCP connection
before authentication succeeded: this usually means authentication failure
due to misconfiguration. Settings are {:host=>"localhost", :port=>5672,
:user=>"guest", :pass=>"guest", :vhost=>"/", :timeout=>nil,
:logging=>false, :ssl=>false, :broker=>nil, :frame_max=>131072

Do I need to add this guest account to the local rabbitmq-server?

Thanks

Paul



Cheers

Paul Cowan

Cutting-Edge Solutions (Scotland)

http://thesoftwaresimpleton.com/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111031/618924c3/attachment.htm>

From cameron.davison at gmail.com  Mon Oct 31 23:24:02 2011
From: cameron.davison at gmail.com (Cameron Davison)
Date: Mon, 31 Oct 2011 18:24:02 -0500
Subject: [rabbitmq-discuss] Publisher Confirms stop occurring when Consumer
 is present and queue is large
Message-ID: <CAGWz9vUwmOdg9TibndZ+UE4Vz1Btyz95CmTf1Xu=m0H4ONe6qw@mail.gmail.com>

I am using RabbitMQ version 2.6.1 of the server.

I created a durable direct exchange with the java client and then
declared a durable, not exclusive, not autoDelete queue and then bound
the exchange and the queue together. Then I set confirm select to true
to start writing messages to the queue. I am publishing messages to
the broker in batches of 2000 as MINIMAL_PERSISTENT_BASIC and the
calling channel.waitForConfirms() to block until all the messages have
been confirmed. This works rather well with an empty queue with a
consumer, and when there is no consumer present. I then setup a
basicConsumer as a QueueingConsumer with ack=true. I am acking every
1k messages I receive with multiple set to true. I am reading and
writing basically as fast as possible, not much code in the critical
path, just to test that RabbitMQ works as I would expect.

I start the writer process to start writing and waiting for confirms
from rabbit and it starts fine. After about 30 seconds, so at this
point many messages have been queued up in the queue, I start the
reader. As soon as I start the reader the writer process stops
receiving confirms. I can even see in the management console that it
shows the 2000 confirms that the writer channel is waiting on. I tried
restarting the writer but it still does not get any confirms while the
reader process is reading from rabbitmq. It will stay like this until
the reader empties the queue and I assume starts acking things that
were written so the confirms are coming from the consumer ack rather
than the writes to disk. Is this expected behavior? Do I have it
configured to not fsync to disk while there is a consumer reading the
messages, would that even possible?

Thanks,
Cameron

From michael.s.klishin at gmail.com  Mon Oct 31 23:35:48 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 1 Nov 2011 03:35:48 +0400
Subject: [rabbitmq-discuss] PossibleAuthenticationFailureError
In-Reply-To: <CAEBV8YTbLShTU2wxjmuWBD4aRGY0fU1Q5CEyeGndnL=dACziqw@mail.gmail.com>
References: <CAEBV8YTbLShTU2wxjmuWBD4aRGY0fU1Q5CEyeGndnL=dACziqw@mail.gmail.com>
Message-ID: <CAE3HoVRF5+Ptg=e-sambUHvKuEqPwmxeda3ntZ-L4WiQrTgPOQ@mail.gmail.com>

2011/11/1 Paul Cowan <dagda1 at scotalt.net>

> Do I need to add this guest account to the local rabbitmq-server?


RabbitMQ should have guest:guest user after installation. That exception is
raised when broker closes TCP connection before AMQP connection is
negotiated and open.
Per AMQP 0.9.1 spec, if authentication fails broker should close connection
immediately and not send any more data. This is why the "Possible" part.

Possibly for whatever reason your RabbitMQ installation does not have guest
user, you can check it or add it using rabbitmqctl.

The exception for unsuccessful TCP connection is different so it must be
the missing user.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111101/b4d2a2bc/attachment.htm>

