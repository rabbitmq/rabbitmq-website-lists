<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Lightweight query for queues?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Lightweight%20query%20for%20queues%3F&In-Reply-To=%3C3E9663CE-24D6-4207-9209-3A75EAE0A870%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012659.html">
   <LINK REL="Next"  HREF="012672.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Lightweight query for queues?</H1>
    <B>Ian Ragsdale</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Lightweight%20query%20for%20queues%3F&In-Reply-To=%3C3E9663CE-24D6-4207-9209-3A75EAE0A870%40gmail.com%3E"
       TITLE="[rabbitmq-discuss] Lightweight query for queues?">ian.ragsdale at gmail.com
       </A><BR>
    <I>Tue May  3 20:09:12 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="012659.html">[rabbitmq-discuss] Lightweight query for queues?
</A></li>
        <LI>Next message: <A HREF="012672.html">[rabbitmq-discuss] Lightweight query for queues?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12660">[ date ]</a>
              <a href="thread.html#12660">[ thread ]</a>
              <a href="subject.html#12660">[ subject ]</a>
              <a href="author.html#12660">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>If this is helpful for anyone, I've developed a small ruby script that just calls rabbitmqctl list_queues and returns the output in the same format as the management plugin API.  It listens on one port higher than the management plugin, so it can run alongside it.  Using this instead has really helped with the load on my server.

- Ian

-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbitmqapi.rb
Type: text/x-ruby-script
Size: 467 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110503/772a1cac/attachment.bin">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110503/772a1cac/attachment.bin</A>&gt;
-------------- next part --------------

On May 3, 2011, at 1:18 PM, Ian Ragsdale wrote:

&gt;<i> So the updated management plugin seems to have gotten rid of the crashes I was seeing, which is great - thanks to the rabbitmq devs for a quick response!
</I>&gt;<i> 
</I>&gt;<i> One useful thing about that thread was figuring out just how resource-intensive the management plugin is when querying the API for queues.  On my server with around 6000 queues, I can run 'rabbitmqctl list_queues' and get results in a second, but if I query the API for the list of queues it pegs one of the CPUs for upwards of 30 seconds, returning over 8MB of data.
</I>&gt;<i> 
</I>&gt;<i> I know all of this data is useful for the web interface you have built, but for my purposes I really just need to pull the data returned by 'rabbitmqctl list_queues name messages messages_unacknowledged', which seems like it should be really quick to gather and return, based on the performance of that command.  In addition, I generally don't need this information for every queue, but for a subset of queues, which can generally be described with a simple regex on the name.
</I>&gt;<i> 
</I>&gt;<i> So, what I'd like to be able to do is:
</I>&gt;<i> 
</I>&gt;<i> 1. Allow specifying which data needs to be returned, so that more expensive statistics can be avoided if necessary.
</I>&gt;<i> 2. Allow filtering the list of queues to return data for with a search term
</I>&gt;<i> 
</I>&gt;<i> I can't find anything in the docs that suggests this is currently possible, and although I don't really know Erlang, I spent some time looking through the management plugin source and it doesn't look like that functionality exists.
</I>&gt;<i> 
</I>&gt;<i> Besides making it more usable for 3rd party integration, it would allow you to improve the management web interface.  You currently only show a subset of the data on the queues tab, and you only show the top 500, so people with more than 500 queues often can't find the one they want.  With those additions you can make the interface more responsive by only requesting data that is actually shown, and adding a search box to let people show just the queues they are looking for.
</I>&gt;<i> 
</I>&gt;<i> Is this something you guys would consider?  If you guys aren't interested in doing the work but would be interested in a patch, I could give it a shot - I don't really know Erlang yet but this seems like a somewhat simple project to take on.
</I>&gt;<i> 
</I>&gt;<i> Thanks,
</I>&gt;<i> Ian
</I>&gt;<i> 
</I>
</PRE>


















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012659.html">[rabbitmq-discuss] Lightweight query for queues?
</A></li>
	<LI>Next message: <A HREF="012672.html">[rabbitmq-discuss] Lightweight query for queues?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12660">[ date ]</a>
              <a href="thread.html#12660">[ thread ]</a>
              <a href="subject.html#12660">[ subject ]</a>
              <a href="author.html#12660">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
