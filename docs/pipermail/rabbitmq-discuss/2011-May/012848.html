<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Writing to the mnesia table rabbit_queue, bad idea?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Writing%20to%20the%20mnesia%20table%20rabbit_queue%2C%0A%20bad%20idea%3F&In-Reply-To=%3C20110513121035.GE26681%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012835.html">
   <LINK REL="Next"  HREF="012857.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Writing to the mnesia table rabbit_queue, bad idea?</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Writing%20to%20the%20mnesia%20table%20rabbit_queue%2C%0A%20bad%20idea%3F&In-Reply-To=%3C20110513121035.GE26681%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Writing to the mnesia table rabbit_queue, bad idea?">matthew at rabbitmq.com
       </A><BR>
    <I>Fri May 13 13:10:36 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="012835.html">[rabbitmq-discuss] Writing to the mnesia table rabbit_queue, bad idea?
</A></li>
        <LI>Next message: <A HREF="012857.html">[rabbitmq-discuss] Writing to the mnesia table rabbit_queue, bad idea?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12848">[ date ]</a>
              <a href="thread.html#12848">[ thread ]</a>
              <a href="subject.html#12848">[ subject ]</a>
              <a href="author.html#12848">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Fri, May 13, 2011 at 10:58:34AM +0100, Simon MacMullen wrote:
&gt;<i> Depends how you define &quot;bad idea&quot;. In terms of today's
</I>&gt;<i> implementation you should be fine, as long as you don't expect (for
</I>&gt;<i> example) to be able to flip the durability field and have that mean
</I>&gt;<i> something.
</I>
It's a very bad idea. For one thing, Rabbit assumes that the queue
record is unaltered after the queue has been created. Consequently the
amqqueue_process process takes a copy of the #amqqueue record and holds
it in its state. It never updates it. So if you change the copy in
mnesia, then you subsquently have divergence between the queue process's
copy, and the mnesia copy. This can lead to suprising results.

For example if you issue amqqueue:info on a queue then it'll go through
to the queue and not mnesia. Thus you'll find that results in management
and in rabbitmqctl now don't match.

You then have things like the property that queue redeclaration should
fail if arguments do not match (semantically) the original declaration.
But this only goes as far as mnesia. Consequently, you will have the
queue, if you interrogate it, claiming its arguments are one thing, but
if you try to redeclare the queue with those arguments, you can find
it'll fail because the mnesia copy is different.

Finally, you'll have the fact that if the broker is restarted, you'll
have the queues recovered with their arguments taken from mnesia. So
suddenly on startup, you'll have queues being restarted with different
arguments from that which they were last running with.

Matthew
</PRE>









<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012835.html">[rabbitmq-discuss] Writing to the mnesia table rabbit_queue, bad idea?
</A></li>
	<LI>Next message: <A HREF="012857.html">[rabbitmq-discuss] Writing to the mnesia table rabbit_queue, bad idea?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12848">[ date ]</a>
              <a href="thread.html#12848">[ thread ]</a>
              <a href="subject.html#12848">[ subject ]</a>
              <a href="author.html#12848">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
