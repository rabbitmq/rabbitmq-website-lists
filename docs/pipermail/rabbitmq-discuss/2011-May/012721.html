<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] STOMP Heartbeat
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20STOMP%20Heartbeat&In-Reply-To=%3C7A3ABB35-E4BB-4909-B421-2036593984BE%40kinishi.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012719.html">
   <LINK REL="Next"  HREF="012810.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] STOMP Heartbeat</H1>
    <B>Alexander Goldstone</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20STOMP%20Heartbeat&In-Reply-To=%3C7A3ABB35-E4BB-4909-B421-2036593984BE%40kinishi.com%3E"
       TITLE="[rabbitmq-discuss] STOMP Heartbeat">alex at kinishi.com
       </A><BR>
    <I>Fri May  6 23:36:40 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="012719.html">[rabbitmq-discuss] Queues Per Client or Per Company
</A></li>
        <LI>Next message: <A HREF="012810.html">[rabbitmq-discuss] STOMP Heartbeat
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12721">[ date ]</a>
              <a href="thread.html#12721">[ thread ]</a>
              <a href="subject.html#12721">[ subject ]</a>
              <a href="author.html#12721">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
I am running RabbitMQ 2.4.1 with Erlang R13B03 and I have the management and stomp plugins installed.

I have clients connecting via STOMP over GPRS and I have noticed that if the client does not gracefully disconnect from the server then the 'channel' stays open.

The cause seems to be that the mobile network (APN) does not realise that the connection has been closed and so it stays connected to the RabbitMQ server.

The problem with this is that if a message is sent to the remote client and the client does not ACK the message before being non-gracefully disconnected then RabbitMQ does not re-deliver the message to the client the next time it connects to the server.

I assume the mobile network would time-out eventually however I have seen it hold connections for several hours during testing before I give up and restart the RabbitMQ process to kill off the erroneous connections.

I see that the new (version 1.1) STOMP protocol provides a heartbeat feature. Does RabbitMQ support this? My assumption is that RabbitMQ would see that the heartbeat frames had stopped being transmitted by the client and the RabbitMQ server would therefore close the channel even if the mobile network is holding the connection open. Is this correct?

I have not been able to get the heartbeat feature of the STOMP protocol to work however I can see the word &quot;heartbeat&quot; in several locations of the source code implying that it is implemented.

If I sent this to the server:

		CONNECT
		accept-version:1.1
		host:/
		login:guest
		passcode:guest
		prefetch:1
		heart-beat:1,1

Then I receive this:

		CONNECTED
		session:session-lnvfUXmXdtlVdBE7p35KZQ==
		heartbeat:0,0
		version:1.1 

Any feedback as to how I should be using the heartbeat feature of the new STOMP protocol or any other suggestions as to how I solve the underlying problem of channels incorrectly being kept open would be gratefully appreciated.

Regards,

Alex

</PRE>































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012719.html">[rabbitmq-discuss] Queues Per Client or Per Company
</A></li>
	<LI>Next message: <A HREF="012810.html">[rabbitmq-discuss] STOMP Heartbeat
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12721">[ date ]</a>
              <a href="thread.html#12721">[ thread ]</a>
              <a href="subject.html#12721">[ subject ]</a>
              <a href="author.html#12721">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
