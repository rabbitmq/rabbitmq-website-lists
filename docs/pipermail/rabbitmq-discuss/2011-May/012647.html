<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] looks like a memory leak, 2.4.1
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20looks%20like%20a%20memory%20leak%2C%202.4.1&In-Reply-To=%3C1304408765.2451.5.camel%40danstation%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012640.html">
   <LINK REL="Next"  HREF="012653.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] looks like a memory leak, 2.4.1</H1>
    <B>Daniel Maher</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20looks%20like%20a%20memory%20leak%2C%202.4.1&In-Reply-To=%3C1304408765.2451.5.camel%40danstation%3E"
       TITLE="[rabbitmq-discuss] looks like a memory leak, 2.4.1">dmaher at milestonelab.com
       </A><BR>
    <I>Tue May  3 08:46:05 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="012640.html">[rabbitmq-discuss] looks like a memory leak, 2.4.1
</A></li>
        <LI>Next message: <A HREF="012653.html">[rabbitmq-discuss] looks like a memory leak, 2.4.1 (Solution)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12647">[ date ]</a>
              <a href="thread.html#12647">[ thread ]</a>
              <a href="subject.html#12647">[ subject ]</a>
              <a href="author.html#12647">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, 2011-05-02 at 20:29 +0100, Matthias Radestock wrote:
&gt;<i> Gavin M. Roy wrote:
</I>&gt;<i> &gt; On Monday, May 2, 2011 at 2:48 PM, Matthias Radestock wrote:
</I>&gt;<i> &gt;&gt; The above graph shows system memory usage. It is perfectly normal for a
</I>&gt;<i> &gt;&gt; non-idle linux system to gradually fill up all the memory with cached
</I>&gt;<i> &gt;&gt; files.
</I>&gt;<i> &gt; Which I expect in disk buffers in that graph. The inactive memory is 
</I>&gt;<i> &gt; what threw me, going back and re-reading up on it, this is memory that 
</I>&gt;<i> &gt; previously been allocated in vm that can be reclaimed for other use, 
</I>&gt;<i> &gt; correct?
</I>&gt;<i> 
</I>&gt;<i> I have no idea. Consult your resident Linux expert ;)
</I>&gt;<i> 
</I>&gt;<i> As long as the system is not swapping it is probably fine. Have you ever 
</I>&gt;<i> seen it swap?
</I>&gt;<i> 
</I>&gt;<i> &gt;&gt; And, as you say, rabbit thinks it is only using 330MB. Is the
</I>&gt;<i> &gt;&gt; rabbit Erlang process considerably bigger than that?
</I>&gt;<i> &gt; No, it is in that range.
</I>&gt;<i> 
</I>&gt;<i> In which case it's clearly not rabbit that is using the memory. So don't 
</I>&gt;<i> blame the poor bunny.
</I>
We saw exactly this behaviour in our environment as well : steadily
increasing memory usage over time, related to Rabbit virtual memory
usage increasing over time ; however Rabbit real memory usage remained
relatively low.

The culprit in our case was that we had created far too many queues, and
that we weren't clearing them out when they weren't being used.  Once we
started managing this properly (read : architecting our queues more
efficiently, destroying them when not in use) our memory usage plummeted
- real and virtual - plummeted.

Cheers,


-- 
Daniel Maher
&#171; can't talk, too busy calculating computrons. &#187;

</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012640.html">[rabbitmq-discuss] looks like a memory leak, 2.4.1
</A></li>
	<LI>Next message: <A HREF="012653.html">[rabbitmq-discuss] looks like a memory leak, 2.4.1 (Solution)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12647">[ date ]</a>
              <a href="thread.html#12647">[ thread ]</a>
              <a href="subject.html#12647">[ subject ]</a>
              <a href="author.html#12647">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
