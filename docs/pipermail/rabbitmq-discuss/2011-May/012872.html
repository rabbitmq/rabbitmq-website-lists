<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Stress testing RabbitMQ
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Stress%20testing%20RabbitMQ&In-Reply-To=%3C4DD00643.50702%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012868.html">
   <LINK REL="Next"  HREF="012873.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Stress testing RabbitMQ</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Stress%20testing%20RabbitMQ&In-Reply-To=%3C4DD00643.50702%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Stress testing RabbitMQ">matthias at rabbitmq.com
       </A><BR>
    <I>Sun May 15 17:58:43 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="012868.html">[rabbitmq-discuss] Stress testing RabbitMQ
</A></li>
        <LI>Next message: <A HREF="012873.html">[rabbitmq-discuss] Stress testing RabbitMQ
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12872">[ date ]</a>
              <a href="thread.html#12872">[ thread ]</a>
              <a href="subject.html#12872">[ subject ]</a>
              <a href="author.html#12872">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Alvaro,

Alvaro Videla wrote:
&gt;<i> Yes, the binding add/removal is slow. In that case I thought that is
</I>&gt;<i> more common to be routing messages than adding removing bindings.
</I>
Given that you were trying to optimise massive fanout, the binding count 
will be high, so the O(n^2) time complexity on add/remove really hurts 
and imposes a limit on the fanout degree which is way lower than it 
would be otherwise. I am surprised you haven't come up against this in 
your tests.

&gt;<i> Also my goal was to easily get an implementation to see if the route
</I>&gt;<i> part could be improved by skipping the mnesia:dirty_select. One
</I>&gt;<i> reason I thought Mnesia could be a problem was because I started
</I>&gt;<i> getting logs like: Mnesia(<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at mrhyde</A>): ** WARNING ** Mnesia is
</I>&gt;<i> overloaded&#8230;
</I>
These warnings are issued when mnesia's write-behind logic gets too far, 
er, behind. They are generally harmless. More importantly though they 
cannot originate from dirty_select/read operations. So if you are seeing 
these warnings in your tests they are most likely due to binding 
addition/removal, not routing.

&gt;<i> My reasoning was that scanning the table every time a message is
</I>&gt;<i> routed could be slower than just returning a somehow cached list of
</I>&gt;<i> bindings, which is what I tried to do.
</I>
Caching routing results in, say, the channel's process dictionary, can 
indeed yield significant performance gains for some use cases. We have 
experimented with that but trying to apply caching generally turns out 
to be hard. The problem, unsurprisingly, is keeping such caches up to 
date. Particularly when trying to maintain AMQP's quite strict 
visibility guarantees. Another problem is keeping the caches from taking 
up too much memory.


Regards,

Matthias.
</PRE>












<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012868.html">[rabbitmq-discuss] Stress testing RabbitMQ
</A></li>
	<LI>Next message: <A HREF="012873.html">[rabbitmq-discuss] Stress testing RabbitMQ
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12872">[ date ]</a>
              <a href="thread.html#12872">[ thread ]</a>
              <a href="subject.html#12872">[ subject ]</a>
              <a href="author.html#12872">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
