<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ 2.3.1 high CPU usage &amp; disks operations
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%202.3.1%20high%20CPU%20usage%20%26%20disks%0A%20operations&In-Reply-To=%3C20110503211954.GC32391%40wellquite.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012819.html">
   <LINK REL="Next"  HREF="012666.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ 2.3.1 high CPU usage &amp; disks operations</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%202.3.1%20high%20CPU%20usage%20%26%20disks%0A%20operations&In-Reply-To=%3C20110503211954.GC32391%40wellquite.org%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ 2.3.1 high CPU usage &amp; disks operations">matthew at rabbitmq.com
       </A><BR>
    <I>Tue May  3 22:19:55 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="012819.html">[rabbitmq-discuss] rabbitmq-server crashes
</A></li>
        <LI>Next message: <A HREF="012666.html">[rabbitmq-discuss] Where is the code for RabbitMQ HA project?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12665">[ date ]</a>
              <a href="thread.html#12665">[ thread ]</a>
              <a href="subject.html#12665">[ subject ]</a>
              <a href="author.html#12665">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Raphael,

On Mon, Apr 25, 2011 at 03:12:07PM -0700, Raphael Simon wrote:
&gt;<i> Following up on this as we are still having the issue, I've pasted the
</I>&gt;<i> output of etop for a broker in a 'good state' [1] vs. one in a 'bad state'
</I>&gt;<i> [2]. You'll notice that broker1-1 (the one in 'bad state' i.e. using ~120%
</I>&gt;<i> cpu compared to ~20% for the one in 'good state') is spending a lot of time
</I>&gt;<i> in timers and reading from disk. Looking at the timer_server process on 1-1
</I>&gt;<i> shows that it's mostly running rabbit_amqqueue:sync_timeout, this seems to
</I>&gt;<i> be the culprit for the high cpu and disk ops. So what is the purpose of this
</I>&gt;<i> timer? and why would it suddenly trigger more often or at least be more
</I>&gt;<i> expensive to handle?
</I>
Interesting. Are you using confirms when publishing msgs? If you are,
and the msgs are published persistent, then there could be an awful lot
of fsyncs being scheduled which could possibly cause a cascade. Maybe. I
can't come up with any better cause... Or maybe an awful lot of
transactions with persistent msgs?

Matthew
</PRE>






















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012819.html">[rabbitmq-discuss] rabbitmq-server crashes
</A></li>
	<LI>Next message: <A HREF="012666.html">[rabbitmq-discuss] Where is the code for RabbitMQ HA project?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12665">[ date ]</a>
              <a href="thread.html#12665">[ thread ]</a>
              <a href="subject.html#12665">[ subject ]</a>
              <a href="author.html#12665">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
