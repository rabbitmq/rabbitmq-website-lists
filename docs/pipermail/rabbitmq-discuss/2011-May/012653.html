<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] looks like a memory leak, 2.4.1 (Solution)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20looks%20like%20a%20memory%20leak%2C%202.4.1%20%28Solution%29&In-Reply-To=%3C4DC01F07.9010203%40echostar.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012647.html">
   <LINK REL="Next"  HREF="012654.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] looks like a memory leak, 2.4.1 (Solution)</H1>
    <B>Mark Geib</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20looks%20like%20a%20memory%20leak%2C%202.4.1%20%28Solution%29&In-Reply-To=%3C4DC01F07.9010203%40echostar.com%3E"
       TITLE="[rabbitmq-discuss] looks like a memory leak, 2.4.1 (Solution)">mark.geib at echostar.com
       </A><BR>
    <I>Tue May  3 16:28:07 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="012647.html">[rabbitmq-discuss] looks like a memory leak, 2.4.1
</A></li>
        <LI>Next message: <A HREF="012654.html">[rabbitmq-discuss] looks like a memory leak, 2.4.1
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12653">[ date ]</a>
              <a href="thread.html#12653">[ thread ]</a>
              <a href="subject.html#12653">[ subject ]</a>
              <a href="author.html#12653">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Quick update. At least in our case this issue was completely resolved
by upgrading erlang to R14B02, from R14A02.

During our investigation we removed all plugins, with no change. We
have since restored the admin plugins, etc. and see no issues. There
is a slight performance hit it appears with the admin plugins enabled,
but nothing significant.

Mark.

On 05/03/2011 01:46 AM, Daniel Maher wrote:
&gt;<i> On Mon, 2011-05-02 at 20:29 +0100, Matthias Radestock wrote:
</I>&gt;&gt;<i> Gavin M. Roy wrote:
</I>&gt;&gt;&gt;<i> On Monday, May 2, 2011 at 2:48 PM, Matthias Radestock wrote:
</I>&gt;&gt;&gt;&gt;<i> The above graph shows system memory usage. It is perfectly
</I>&gt;&gt;&gt;&gt;<i> normal for a non-idle linux system to gradually fill up all
</I>&gt;&gt;&gt;&gt;<i> the memory with cached files.
</I>&gt;&gt;&gt;<i> Which I expect in disk buffers in that graph. The inactive
</I>&gt;&gt;&gt;<i> memory is what threw me, going back and re-reading up on it,
</I>&gt;&gt;&gt;<i> this is memory that previously been allocated in vm that can be
</I>&gt;&gt;&gt;<i> reclaimed for other use, correct?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I have no idea. Consult your resident Linux expert ;)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> As long as the system is not swapping it is probably fine. Have
</I>&gt;&gt;<i> you ever seen it swap?
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> And, as you say, rabbit thinks it is only using 330MB. Is
</I>&gt;&gt;&gt;&gt;<i> the rabbit Erlang process considerably bigger than that?
</I>&gt;&gt;&gt;<i> No, it is in that range.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> In which case it's clearly not rabbit that is using the memory.
</I>&gt;&gt;<i> So don't blame the poor bunny.
</I>&gt;<i>
</I>&gt;<i> We saw exactly this behaviour in our environment as well :
</I>&gt;<i> steadily increasing memory usage over time, related to Rabbit
</I>&gt;<i> virtual memory usage increasing over time ; however Rabbit real
</I>&gt;<i> memory usage remained relatively low.
</I>&gt;<i>
</I>&gt;<i> The culprit in our case was that we had created far too many
</I>&gt;<i> queues, and that we weren't clearing them out when they weren't
</I>&gt;<i> being used. Once we started managing this properly (read :
</I>&gt;<i> architecting our queues more efficiently, destroying them when not
</I>&gt;<i> in use) our memory usage plummeted - real and virtual - plummeted.
</I>&gt;<i>
</I>&gt;<i> Cheers,
</I>&gt;<i>
</I>&gt;<i>
</I>
- -- 
Principal Engineer
Cheyenne Software Engineering
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">mark.geib at echostar.com</A> / 35-215

PGP fingerprint:6DFC 389D 9796 0188 92E5 58F5 34C5 6B47 D091 76FD
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (GNU/Linux)
Comment: Using GnuPG with Mozilla - <A HREF="http://enigmail.mozdev.org/">http://enigmail.mozdev.org/</A>

iEYEARECAAYFAk3AHwcACgkQNMVrR9CRdv03WQCeIxlszRSb30fdkszhm7PgPSpZ
DcUAnj8tDzALwUR9DCQTBQfvr3yXhzD7
=RVkY
-----END PGP SIGNATURE-----


</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012647.html">[rabbitmq-discuss] looks like a memory leak, 2.4.1
</A></li>
	<LI>Next message: <A HREF="012654.html">[rabbitmq-discuss] looks like a memory leak, 2.4.1
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12653">[ date ]</a>
              <a href="thread.html#12653">[ thread ]</a>
              <a href="subject.html#12653">[ subject ]</a>
              <a href="author.html#12653">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
