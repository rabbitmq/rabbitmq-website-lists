<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] queue hands - timeout
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20queue%20hands%20-%20timeout&In-Reply-To=%3C4DD64A4C.7090602%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012935.html">
   <LINK REL="Next"  HREF="012956.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] queue hands - timeout</H1>
    <B>Emile Joubert</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20queue%20hands%20-%20timeout&In-Reply-To=%3C4DD64A4C.7090602%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] queue hands - timeout">emile at rabbitmq.com
       </A><BR>
    <I>Fri May 20 12:02:36 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="012935.html">[rabbitmq-discuss] queue hands - timeout
</A></li>
        <LI>Next message: <A HREF="012956.html">[rabbitmq-discuss] queue hands - timeout
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12939">[ date ]</a>
              <a href="thread.html#12939">[ thread ]</a>
              <a href="subject.html#12939">[ subject ]</a>
              <a href="author.html#12939">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Thomas,

On 19/05/11 13:35, Thomas Stagl wrote:
&gt;<i> Hello,
</I>&gt;<i>
</I>&gt;<i> we are running a queue in our test environment with different vhosts.
</I>&gt;<i> When we do a long running perf test, we recognise that the responses
</I>&gt;<i> from the queue are timing out and from that moment on, it is not
</I>&gt;<i> possible to connect to the queue again. Neither with the java lib
</I>&gt;<i> (which we use in our application) nor with celery (which I use for
</I>&gt;<i> testing purposes.)
</I>&gt;<i>
</I>&gt;<i> We have recognised that beam.smp is running on 30% CPU time from that
</I>&gt;<i> moment on.
</I>&gt;<i>
</I>&gt;<i> When we trace a connection, we see this with tcpdump: 12:23:52.700093
</I>&gt;<i> IP CLIENT.43248&gt;  RABBIT.amqp: Flags [P.], seq 2421288989:2421289002,
</I>&gt;<i> ack 2617563671, win 54, options [nop,nop,TS val 2047452 ecr
</I>&gt;<i> 1377663677], length 13 12:23:52.700124 IP RABBIT.amqp&gt;  CLIENT.43248:
</I>&gt;<i> Flags [.], ack 13, win 62, options [nop,nop,TS val 1377881158 ecr
</I>&gt;<i> 2047452], length 0
</I>&gt;<i>
</I>&gt;<i> From that moment on, the connection is hanging.
</I>&gt;<i>
</I>&gt;<i> After a restart of the rabbitmq server, everything is running fine
</I>&gt;<i> again, for a certain amount of time.
</I>&gt;<i>
</I>&gt;<i> We also have a second test stack and we switched to the second
</I>&gt;<i> rabbitmq test server, same behaviour here. It worked fine and after a
</I>&gt;<i> couple of hours it stopped responding.
</I>&gt;<i>
</I>&gt;<i> Any ideas? Any though about where we can start debugging would be
</I>&gt;<i> very much appreciated.
</I>
We have brokers that have been running for weeks without exhibiting the 
behaviour you describe. Can you help us to emulate your test environment 
more closely?

What version of Erlang, OS and rabbit are you using?
What is the contents of the rabbit config file?
What exactly does the perf test doing? What is the rate and size of 
messsages, number of producers, consumers, are the messages persistent?
If you have the management plugin installed then a copy of the broker 
configuration may be useful.

Does rabbitmqctl still work when the problem occurs? The output of all 
the list_* commands at the time of failure will be useful.

The broker logfile entries around the onset of the problem will also help.

Were there any other applications running on the same OS as rabbit?

Were the consumers (if any) keeping up with producers at or just before 
the onset of the problem?

What was the memory consumption reported by the management plugin at 
this time?

If you can help us to narrow this down to a specific set of conditions 
that reliably trigger the problem that will be a big step towards a 
solution.



Thanks

Emile
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012935.html">[rabbitmq-discuss] queue hands - timeout
</A></li>
	<LI>Next message: <A HREF="012956.html">[rabbitmq-discuss] queue hands - timeout
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12939">[ date ]</a>
              <a href="thread.html#12939">[ thread ]</a>
              <a href="subject.html#12939">[ subject ]</a>
              <a href="author.html#12939">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
