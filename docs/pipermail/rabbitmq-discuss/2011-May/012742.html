<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Cluster, shovel,	how to accomplish this scenario?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Cluster%2C%20shovel%2C%0A%09how%20to%20accomplish%20this%20scenario%3F&In-Reply-To=%3C9908E041-081A-41D0-9B7A-1C1BB6E34CD6%40jbrisbin.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012732.html">
   <LINK REL="Next"  HREF="012744.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Cluster, shovel,	how to accomplish this scenario?</H1>
    <B>Jon Brisbin</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Cluster%2C%20shovel%2C%0A%09how%20to%20accomplish%20this%20scenario%3F&In-Reply-To=%3C9908E041-081A-41D0-9B7A-1C1BB6E34CD6%40jbrisbin.com%3E"
       TITLE="[rabbitmq-discuss] Cluster, shovel,	how to accomplish this scenario?">jon at jbrisbin.com
       </A><BR>
    <I>Mon May  9 16:10:19 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="012732.html">[rabbitmq-discuss] Cluster, shovel, how to accomplish this scenario?
</A></li>
        <LI>Next message: <A HREF="012744.html">[rabbitmq-discuss] Cluster, shovel,	how to accomplish this scenario?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12742">[ date ]</a>
              <a href="thread.html#12742">[ thread ]</a>
              <a href="subject.html#12742">[ subject ]</a>
              <a href="author.html#12742">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>FWIW- I hinted at this in my blog post about the RabbitMQ &lt;-&gt; Riak integration, but I envisioned a scenario just as you've described (one broker/exchange/whatever knows nothing about the other). I think it would be relatively straightforward to extend this to encompass your other problem (the cache exchange...where you get all the messages historically when binding a new queue) as well.

The Riak exchange type will route messages locally (it's an exchange like any other...you set the type-module argument when declaring the exchange to the erlang module to use when routing the message). When the message gets stored in Riak, the commit hook is triggered, which causes that message to be sent to the configured exchange. You can set what broker, exchange, etc... on a per-bucket basis, so your individual messages don't have to know anything about your routing architecture.

<A HREF="https://github.com/jbrisbin/riak-exchange">https://github.com/jbrisbin/riak-exchange</A>
<A HREF="https://github.com/jbrisbin/riak-rabbitmq-commit-hooks">https://github.com/jbrisbin/riak-rabbitmq-commit-hooks</A>

It would be good to implement something similar but that bypasses an external data store. An exchange type could handle this without forcing the application to know what's going on (you could put broker settings, exchange settings, etc... on the exchange declaration as arguments). It could &quot;echo&quot; the message into that other broker. Such a thing doesn't, as yet, exist. :)


Thanks!

Jon Brisbin

<A HREF="http://jbrisbin.com">http://jbrisbin.com</A>
Twitter: @j_brisbin


On May 8, 2011, at 5:29 PM, Simone wrote:

&gt;<i> Hello, I managed to set up a shovel correctly. I have some doubts about the usage scenarios of this feature. Ideally I would like the shovel to be transparent to my application, but I realized that since you have to create a queue on one side and an exchange on the other side then these two make the applications built to use Rabbit somewhat aware of the shovel. 
</I>&gt;<i> With that I refer to the input queue of the shovel needding to be bound to an exchange, therefore the exchange has to exist and someone has to publish messages to it. The same holds true on the other side of the shovel, where clients need to bind to the shovel exchange.
</I>&gt;<i> All this makes sense and works great, but makes my application aware of the exchanges used by the shovel. 
</I>&gt;<i> 
</I>&gt;<i> Here's a scenario. My application has some publishers publishing to a topic exchange named X and some subscribers with their queues bound to that exchange. Setting up a shovel to have the same subscriber clients running on both sides of the shovel with no client code changes and no configuration changes except for the node url requires that the shovel needs to bind its input queue to exchange X and that an equal exchange X is created to the other end of the shovel so that clients on either side bind their queues their node's X exchange.
</I>&gt;<i> 
</I>&gt;<i> This makes the shovel mechanism somewhat aware of my application internals (the exchanges it uses) and requires that the same exchanges exist as soon as the nodes are started, thus moving (or worse, duplicating) their definition in the shovel configuration file. In addition it limits the flexibility as a new exchange creation which needs to be &quot;mirrored&quot; on the other node requires a change in the configuration of the shovel addin.
</I>&gt;<i> 
</I>&gt;<i> As said this works fine, but ideally I would like this mechanism to be transparent to the application. I read about the federation addin, which from a brief read seems to do exactly this. Any ideas or suggestions?
</I>&gt;<i> 
</I>&gt;<i> Thanks
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>

Thanks!

Jon Brisbin

<A HREF="http://jbrisbin.com">http://jbrisbin.com</A>
Twitter: @j_brisbin


</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012732.html">[rabbitmq-discuss] Cluster, shovel, how to accomplish this scenario?
</A></li>
	<LI>Next message: <A HREF="012744.html">[rabbitmq-discuss] Cluster, shovel,	how to accomplish this scenario?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12742">[ date ]</a>
              <a href="thread.html#12742">[ thread ]</a>
              <a href="subject.html#12742">[ subject ]</a>
              <a href="author.html#12742">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
