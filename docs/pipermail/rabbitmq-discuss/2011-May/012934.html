<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] exessive memory usage and blocked connection, even when no messages left
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20exessive%20memory%20usage%20and%20blocked%20connection%2C%0A%20even%20when%20no%20messages%20left&In-Reply-To=%3C4DD4EEC3.8070803%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012930.html">
   <LINK REL="Next"  HREF="012914.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] exessive memory usage and blocked connection, even when no messages left</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20exessive%20memory%20usage%20and%20blocked%20connection%2C%0A%20even%20when%20no%20messages%20left&In-Reply-To=%3C4DD4EEC3.8070803%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] exessive memory usage and blocked connection, even when no messages left">matthias at rabbitmq.com
       </A><BR>
    <I>Thu May 19 11:19:47 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="012930.html">[rabbitmq-discuss] exessive memory usage and blocked connection, even when no messages left
</A></li>
        <LI>Next message: <A HREF="012914.html">[rabbitmq-discuss] question on the RpcClient class
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12934">[ date ]</a>
              <a href="thread.html#12934">[ thread ]</a>
              <a href="subject.html#12934">[ subject ]</a>
              <a href="author.html#12934">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Theo,

On 19/05/11 11:00, Theo wrote:
&gt;<i> Ok, thanks for the clarification, it makes sense, and it's more or
</I>&gt;<i> less what we figured. I was hoping there was another explanation,
</I>&gt;<i> that would be fixable.
</I>&gt;<i>
</I>&gt;<i> What kind of performance should we expect when running on EC2? It
</I>&gt;<i> feels like 20K messages per second shouldn't be a problem for a four
</I>&gt;<i>  node cluster where each node has 8 CPUs and 7 Gb RAM.
</I>
20kHz shouldn't be a problem even for just a single 4-core machine,
assuming messages sizes are fairly small.

&gt;<i> to get any kind of performance and stability we have had to tune how
</I>&gt;<i> we work with the cluster, making sure that queues are distributed
</I>&gt;<i> over the nodes, that each node has more than one queue, that the
</I>&gt;<i> connections from the producers and consumers are evenly distributed
</I>&gt;<i> over the nodes, etc. even slight asymmetries show up quite quickly
</I>&gt;<i> in the memory usage of a node, and as soon as that happens it's only
</I>&gt;<i> minutes before the whole cluster goes bad.
</I>
You shouldn't have to do that kind of tuning to get 20kHz. As I said in
your previous email, your publishers publish at a rate far higher than
20kHz. And they do that all the time, not just for some brief peak
period. That's why rabbit eventually fills up all memory with buffered
messages and has to pause producers. If you run tests with throttled
producer, e.g. get producers to publish messages at a certain rate, then
rabbit will happily keep up with that rate forever.

&gt;<i> Topic exchanges seem to be completely out of the question, it only
</I>&gt;<i> takes minutes before every node gets overloaded.
</I>
Again, that is due to the fact that the publishers operate at a far 
higher rate than is sustainable.

Regards,

Matthias.
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012930.html">[rabbitmq-discuss] exessive memory usage and blocked connection, even when no messages left
</A></li>
	<LI>Next message: <A HREF="012914.html">[rabbitmq-discuss] question on the RpcClient class
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12934">[ date ]</a>
              <a href="thread.html#12934">[ thread ]</a>
              <a href="subject.html#12934">[ subject ]</a>
              <a href="author.html#12934">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
