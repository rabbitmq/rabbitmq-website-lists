<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] exessive memory usage and blocked connection, even when no messages left
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20exessive%20memory%20usage%20and%20blocked%20connection%2C%0A%20even%20when%20no%20messages%20left&In-Reply-To=%3C07539175-27e8-4899-ab62-04a9910bcde5%40j23g2000yqc.googlegroups.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012912.html">
   <LINK REL="Next"  HREF="012921.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] exessive memory usage and blocked connection, even when no messages left</H1>
    <B>Theo</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20exessive%20memory%20usage%20and%20blocked%20connection%2C%0A%20even%20when%20no%20messages%20left&In-Reply-To=%3C07539175-27e8-4899-ab62-04a9910bcde5%40j23g2000yqc.googlegroups.com%3E"
       TITLE="[rabbitmq-discuss] exessive memory usage and blocked connection, even when no messages left">iconara at gmail.com
       </A><BR>
    <I>Wed May 18 21:47:45 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="012912.html">[rabbitmq-discuss] exessive memory usage and blocked connection, even when no messages left
</A></li>
        <LI>Next message: <A HREF="012921.html">[rabbitmq-discuss] exessive memory usage and blocked connection, even when no messages left
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12915">[ date ]</a>
              <a href="thread.html#12915">[ thread ]</a>
              <a href="subject.html#12915">[ subject ]</a>
              <a href="author.html#12915">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Eventually (a couple of hours without any connections) the node
returned to normal memory usage, so I launched a new batch of tests. I
saw a sustained load of 20K published/delivered/acked for a few
minutes, with the memory usage of each node increasing rapidly. After
perhaps five minutes the cluster rotted completely. No messages
published, nothing delivered, all connections are blocked.

20K messages over four nodes, that shouldn't be a problem? From my
point of view it looks like RabbitMQ is leaking memory badly, but that
couldn't be, could it?

At this point there is no message on any queue, according to the web
UI, but each node is still using over 3Gb RAM.

Theo

On May 18, 6:15&#160;pm, Theo &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">icon... at gmail.com</A>&gt; wrote:
&gt;<i> 2.4.1, should have been more specific. the OS is ubuntu 10.04, btw.
</I>&gt;<i>
</I>&gt;<i> there's a lot of warnings in the log about memory usage, but it's more
</I>&gt;<i> or less the same thing over and over again:
</I>&gt;<i>
</I>&gt;<i> =INFO REPORT==== 18-May-2011::14:37:20 ===
</I>&gt;<i> vm_memory_high_watermark set. Memory used:3327376104 allowed:
</I>&gt;<i> 3006570496
</I>&gt;<i>
</I>&gt;<i> =INFO REPORT==== 18-May-2011::14:37:20 ===
</I>&gt;<i> &#160; &#160; alarm_handler: {set,
</I>&gt;<i> {{<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">vm_memory_high_watermark,rabbit at rfmmqstaging01</A>},[]}}
</I>&gt;<i>
</I>&gt;<i> then I found this, not sure if it's important (pasted it into a gist):
</I>&gt;<i>
</I>&gt;<i> <A HREF="https://gist.github.com/978897">https://gist.github.com/978897</A>
</I>&gt;<i>
</I>&gt;<i> this is the version of erlang:
</I>&gt;<i>
</I>&gt;<i> Erlang R13B03 (erts-5.7.4) [source] [64-bit] [smp:8:8] [rq:8] [async-
</I>&gt;<i> threads:0] [hipe] [kernel-poll:false]
</I>&gt;<i>
</I>&gt;<i> I've been watching the management UI since I posted my first message
</I>&gt;<i> (almost an hour ago) and the memory usage hasn't gone down. can a node
</I>&gt;<i> get bad? the other nodes look ok, but the one that's in the red in the
</I>&gt;<i> screenshot is still in the red. no connections to the server for an
</I>&gt;<i> hour.
</I>&gt;<i>
</I>&gt;<i> T#
</I>&gt;<i>
</I>&gt;<i> On May 18, 6:01&#160;pm, Matthew Sackman &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matt... at rabbitmq.com</A>&gt; wrote:&gt; Hi Theo,
</I>&gt;<i>
</I>&gt;<i> &gt; On Wed, May 18, 2011 at 08:22:13AM -0700, Theo wrote:
</I>&gt;<i> &gt; &gt; More specifics on the setup: the cluster consists of 4 EC2 instances
</I>&gt;<i> &gt; &gt; with 8 CPUs and 7 Gb RAM each (I forget the exact instance name)
</I>&gt;<i> &gt; &gt; running RabbitMQ 2.4.
</I>&gt;<i>
</I>&gt;<i> &gt; Is that 2.4.0 or 2.4.1? If not 2.4.1, please upgrade. Which version of
</I>&gt;<i> &gt; Erlang are you running? Is there anything of note other than connections
</I>&gt;<i> &gt; and memory alarms in any of the logs?
</I>&gt;<i>
</I>&gt;<i> &gt; Matthew
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; rabbitmq-discuss mailing list
</I>&gt;<i> &gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-disc... at lists.rabbitmq.comhttps</A>://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-disc... at lists.rabbitmq.comhttps</A>://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
</I></PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012912.html">[rabbitmq-discuss] exessive memory usage and blocked connection, even when no messages left
</A></li>
	<LI>Next message: <A HREF="012921.html">[rabbitmq-discuss] exessive memory usage and blocked connection, even when no messages left
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12915">[ date ]</a>
              <a href="thread.html#12915">[ thread ]</a>
              <a href="subject.html#12915">[ subject ]</a>
              <a href="author.html#12915">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
