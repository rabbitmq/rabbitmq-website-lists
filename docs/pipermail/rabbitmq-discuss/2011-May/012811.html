<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] STOMP Heartbeat
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20STOMP%20Heartbeat&In-Reply-To=%3C135547F4-AFAB-4851-BFEC-F7374B94E49C%40kinishi.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012810.html">
   <LINK REL="Next"  HREF="012940.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] STOMP Heartbeat</H1>
    <B>Alexander Goldstone</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20STOMP%20Heartbeat&In-Reply-To=%3C135547F4-AFAB-4851-BFEC-F7374B94E49C%40kinishi.com%3E"
       TITLE="[rabbitmq-discuss] STOMP Heartbeat">alex at kinishi.com
       </A><BR>
    <I>Wed May 11 15:31:47 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="012810.html">[rabbitmq-discuss] STOMP Heartbeat
</A></li>
        <LI>Next message: <A HREF="012940.html">[rabbitmq-discuss] STOMP Heartbeat
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12811">[ date ]</a>
              <a href="thread.html#12811">[ thread ]</a>
              <a href="subject.html#12811">[ subject ]</a>
              <a href="author.html#12811">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Thank you Rob. I had not spotted the discrepancy and I can confirm that sending &quot;heartbeat&quot; works exactly as I would have expected and should solve my underlying problem with connections being incorrectly held open by the network.

Much appreciated!

Regards,

Alex


On 11 May 2011, at 15:04, Rob Harrop wrote:

&gt;<i> I spotted the problem, we are spelling the header &quot;heartbeat&quot; but the spec has &quot;heart-beat&quot;.
</I>&gt;<i> 
</I>&gt;<i> If you can tweak your code to send &quot;heartbeat&quot; for now that should work, I'll fix this and get the server to send/receive heart-beat.
</I>&gt;<i> 
</I>&gt;<i> Regards,
</I>&gt;<i> 
</I>&gt;<i> Rob
</I>&gt;<i> 
</I>&gt;<i> Alexander Goldstone wrote:
</I>&gt;&gt;<i> I am running RabbitMQ 2.4.1 with Erlang R13B03 and I have the management and stomp plugins installed.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> I have clients connecting via STOMP over GPRS and I have noticed that if the client does not gracefully disconnect from the server then the 'channel' stays open.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> The cause seems to be that the mobile network (APN) does not realise that the connection has been closed and so it stays connected to the RabbitMQ server.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> The problem with this is that if a message is sent to the remote client and the client does not ACK the message before being non-gracefully disconnected then RabbitMQ does not re-deliver the message to the client the next time it connects to the server.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> I assume the mobile network would time-out eventually however I have seen it hold connections for several hours during testing before I give up and restart the RabbitMQ process to kill off the erroneous connections.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> I see that the new (version 1.1) STOMP protocol provides a heartbeat feature. Does RabbitMQ support this? My assumption is that RabbitMQ would see that the heartbeat frames had stopped being transmitted by the client and the RabbitMQ server would therefore close the channel even if the mobile network is holding the connection open. Is this correct?
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> I have not been able to get the heartbeat feature of the STOMP protocol to work however I can see the word &quot;heartbeat&quot; in several locations of the source code implying that it is implemented.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> If I sent this to the server:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 		CONNECT
</I>&gt;&gt;<i> 		accept-version:1.1
</I>&gt;&gt;<i> 		host:/
</I>&gt;&gt;<i> 		login:guest
</I>&gt;&gt;<i> 		passcode:guest
</I>&gt;&gt;<i> 		prefetch:1
</I>&gt;&gt;<i> 		heart-beat:1,1
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Then I receive this:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 		CONNECTED
</I>&gt;&gt;<i> 		session:session-lnvfUXmXdtlVdBE7p35KZQ==
</I>&gt;&gt;<i> 		heartbeat:0,0
</I>&gt;&gt;<i> 		version:1.1
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Any feedback as to how I should be using the heartbeat feature of the new STOMP protocol or any other suggestions as to how I solve the underlying problem of channels incorrectly being kept open would be gratefully appreciated.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Regards,
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Alex
</I>&gt;&gt;<i> 
</I>
</PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012810.html">[rabbitmq-discuss] STOMP Heartbeat
</A></li>
	<LI>Next message: <A HREF="012940.html">[rabbitmq-discuss] STOMP Heartbeat
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12811">[ date ]</a>
              <a href="thread.html#12811">[ thread ]</a>
              <a href="subject.html#12811">[ subject ]</a>
              <a href="author.html#12811">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
